// =========================
// ðŸ’° SALES MODULE
// =========================

model Sale {
  id         String   @id @default(cuid())
  saleNumber String   @unique // Auto-generated: "SAL-2024-001"
  date       DateTime @default(now())

  agencyId String?
  agency   Agency? @relation(fields: [agencyId], references: [id])

  // Customer Info (denormalized)
  customerId      String?
  customer        Customer? @relation(fields: [customerId], references: [id])
  customerName    String
  customerPhone   String?
  customerAddress String?

  // Sale Source
  source SaleSource @default(WALK_IN)

  // Line Items (Stored as JSON for compatibility with legacy Supabase structure)
  items Json?

  // Financials
  subtotal     Decimal @default(0) @db.Decimal(10, 2)
  discount     Decimal @default(0) @db.Decimal(10, 2)
  discountType String  @default("AMOUNT") // "AMOUNT", "PERCENT"
  taxRate      Decimal @default(0) @db.Decimal(5, 2)
  taxAmount    Decimal @default(0) @db.Decimal(10, 2)
  total        Decimal @default(0) @db.Decimal(10, 2)

  // Payment
  paymentStatus PaymentStatus @default(UNPAID)
  amountPaid    Decimal       @default(0) @db.Decimal(10, 2)
  balance       Decimal       @default(0) @db.Decimal(10, 2)

  // Cash Account
  cashAccountId String?
  cashAccount   CashAccount? @relation(fields: [cashAccountId], references: [id])

  // Multi-tenancy
  branchId String
  branch   Branch @relation(fields: [branchId], references: [id])
  userId   String
  user     User   @relation("SalesCreated", fields: [userId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  categoryId String?
  category   SaleCategory? @relation(fields: [categoryId], references: [id])

  installmentPayments InstallmentPayment[]
  notes               String?

  cashTransactionId String?          @unique
  cashTransaction   CashTransaction? @relation(fields: [cashTransactionId], references: [id])
}

model SalesGoal {
  id        String   @id @default(cuid())
  branchId  String
  branch    Branch   @relation(fields: [branchId], references: [id])
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  target    Decimal  @default(0) @db.Decimal(10, 2)
  current   Decimal  @default(0) @db.Decimal(10, 2)
  period    String   @default("monthly") // daily, weekly, monthly, yearly
  startDate DateTime @default(now())
  endDate   DateTime @default(now())
  status    String   @default("active") // active, completed, failed
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model SaleCategory {
  id   String @id @default(cuid())
  name String @unique

  branchId String
  branch   Branch @relation(fields: [branchId], references: [id])

  userId String
  user   User   @relation(fields: [userId], references: [id])

  sales Sale[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum SaleSource {
  WALK_IN
  ONLINE
  WHATSAPP
  FACEBOOK
  INSTAGRAM
}

enum PaymentStatus {
  UNPAID
  PAID
  PARTIAL
  INSTALLMENT
  CANCELLED
  REFUNDED
  QUOTE
}
