{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/app/actions/analytics.ts"],"sourcesContent":["'use server';\r\n\r\nimport { db } from '../../../prisma/db';\r\n\r\nexport interface InventoryStats {\r\n    totalCostValue: number;\r\n    totalStockValue: number;\r\n    lowStockCount: number;\r\n    outOfStockCount: number;\r\n}\r\n\r\nexport async function getGlobalInventoryStatsAction(businessId: string) {\r\n    try {\r\n        const products = await db.product.findMany({\r\n            where: {\r\n                branchId: businessId,\r\n                deletedAt: null\r\n            },\r\n            select: {\r\n                stockLevel: true,\r\n                minStockLevel: true,\r\n                costPrice: true,\r\n                sellingPrice: true\r\n            }\r\n        });\r\n\r\n        const stats: InventoryStats = products.reduce((acc: InventoryStats, p: any) => {\r\n            const stock = p.stockLevel || 0;\r\n            const cost = p.costPrice || 0;\r\n            const price = p.sellingPrice || 0;\r\n            const minStock = p.minStockLevel || 0;\r\n\r\n            acc.totalCostValue += stock * cost;\r\n            acc.totalStockValue += stock * price;\r\n\r\n            if (stock <= 0) {\r\n                acc.outOfStockCount += 1;\r\n            } else if (stock <= minStock) {\r\n                acc.lowStockCount += 1;\r\n            }\r\n\r\n            return acc;\r\n        }, {\r\n            totalCostValue: 0,\r\n            totalStockValue: 0,\r\n            lowStockCount: 0,\r\n            outOfStockCount: 0\r\n        });\r\n\r\n        return { success: true, data: stats };\r\n    } catch (error: any) {\r\n        console.error('Error fetching global inventory stats:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\nexport async function getTotalExpensesAction(businessId: string, startDate?: string, endDate?: string) {\r\n    try {\r\n        const where: any = {\r\n            locationId: businessId\r\n        };\r\n\r\n        if (startDate || endDate) {\r\n            where.date = {};\r\n            if (startDate) {\r\n                where.date.gte = new Date(startDate);\r\n            }\r\n            if (endDate) {\r\n                where.date.lte = new Date(endDate);\r\n            }\r\n        }\r\n\r\n        const expenses = await db.expense.findMany({\r\n            where,\r\n            select: {\r\n                amount: true\r\n            }\r\n        });\r\n\r\n        const total = expenses.reduce((sum: number, e: any) => sum + Number(e.amount), 0);\r\n\r\n        return { success: true, data: total };\r\n    } catch (error: any) {\r\n        console.error('Error fetching total expenses:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MAwDsB,wBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA,0DAAA"}},
    {"offset": {"line": 21, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useAnalyticsData.ts"],"sourcesContent":["import { useState, useEffect, useMemo, useCallback } from 'react';\r\nimport { Sale, AnalyticsData } from '@/types';\r\nimport {\r\n  isWithinInterval,\r\n  startOfDay,\r\n  endOfDay,\r\n  startOfWeek,\r\n  endOfWeek,\r\n  startOfMonth,\r\n  endOfMonth,\r\n  startOfYear,\r\n  endOfYear,\r\n  subDays,\r\n  subWeeks,\r\n  subMonths,\r\n  isSameDay\r\n} from 'date-fns';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\nimport { getTotalExpensesAction } from '@/app/actions/analytics';\r\n\r\ninterface UseAnalyticsDataProps {\r\n  sales: Sale[];\r\n  dateFilter: string;\r\n  dateRange: { from: Date | undefined; to: Date | undefined; };\r\n  specificDate?: Date | undefined;\r\n  isCustomRange: boolean;\r\n  isSpecificDate?: boolean;\r\n}\r\n\r\nexport function useAnalyticsData({ sales, dateFilter, dateRange, specificDate, isCustomRange, isSpecificDate }: UseAnalyticsDataProps) {\r\n  const [expenses, setExpenses] = useState<number>(0);\r\n  const [isLoadingExpenses, setIsLoadingExpenses] = useState(true);\r\n  const { currentBusiness } = useBusiness();\r\n\r\n  // Memoize the expensive calculations\r\n  const calculateSaleTotals = useCallback((sale: Sale) => {\r\n    // Calculate total sale price after discounts (same logic as revenue calculation)\r\n    const totalSalePrice = sale.items && Array.isArray(sale.items)\r\n      ? sale.items.reduce((sum, item) => {\r\n        const subtotal = item.price * item.quantity;\r\n        const discountAmount = item.discountType === 'amount'\r\n          ? (item.discountAmount || 0)\r\n          : (subtotal * (item.discountPercentage || 0)) / 100;\r\n        return sum + (subtotal - discountAmount);\r\n      }, 0)\r\n      : 0;\r\n\r\n    const totalCost = sale.items && Array.isArray(sale.items)\r\n      ? sale.items.reduce((sum, item) => sum + (item.cost * item.quantity), 0)\r\n      : 0;\r\n\r\n    return { totalSalePrice, totalCost };\r\n  }, []);\r\n\r\n  // Memoize date filtering function\r\n  const matchesDateFilter = useCallback((saleDate: Date): boolean => {\r\n    // Validate the sale date\r\n    if (isNaN(saleDate.getTime())) {\r\n      return false;\r\n    }\r\n\r\n    if (dateFilter === 'all') return true;\r\n\r\n    if (dateFilter === 'custom' && isCustomRange) {\r\n      if (dateRange.from && dateRange.to) {\r\n        return isWithinInterval(saleDate, {\r\n          start: startOfDay(dateRange.from),\r\n          end: endOfDay(dateRange.to)\r\n        });\r\n      }\r\n      return true;\r\n    }\r\n\r\n    if (dateFilter === 'specific' && isSpecificDate) {\r\n      if (specificDate) {\r\n        return isSameDay(saleDate, specificDate);\r\n      }\r\n      return true;\r\n    }\r\n\r\n    const today = new Date();\r\n\r\n    switch (dateFilter) {\r\n      case 'today':\r\n        return isWithinInterval(saleDate, {\r\n          start: startOfDay(today),\r\n          end: endOfDay(today)\r\n        });\r\n      case 'yesterday':\r\n        const yesterday = subDays(today, 1);\r\n        return isWithinInterval(saleDate, {\r\n          start: startOfDay(yesterday),\r\n          end: endOfDay(yesterday)\r\n        });\r\n      case 'this-week':\r\n        return isWithinInterval(saleDate, {\r\n          start: startOfWeek(today, { weekStartsOn: 1 }),\r\n          end: endOfWeek(today, { weekStartsOn: 1 })\r\n        });\r\n      case 'last-week':\r\n        const lastWeekStart = subWeeks(startOfWeek(today, { weekStartsOn: 1 }), 1);\r\n        const lastWeekEnd = endOfWeek(lastWeekStart, { weekStartsOn: 1 });\r\n        return isWithinInterval(saleDate, {\r\n          start: lastWeekStart,\r\n          end: lastWeekEnd\r\n        });\r\n      case 'this-month':\r\n        return isWithinInterval(saleDate, {\r\n          start: startOfMonth(today),\r\n          end: endOfMonth(today)\r\n        });\r\n      case 'last-month':\r\n        const lastMonth = subMonths(today, 1);\r\n        return isWithinInterval(saleDate, {\r\n          start: startOfMonth(lastMonth),\r\n          end: endOfMonth(lastMonth)\r\n        });\r\n      case 'this-year':\r\n        return isWithinInterval(saleDate, {\r\n          start: startOfYear(today),\r\n          end: endOfYear(today)\r\n        });\r\n      default:\r\n        return true;\r\n    }\r\n  }, [dateFilter, isCustomRange, isSpecificDate, dateRange, specificDate]);\r\n\r\n  // Memoize filtered sales calculation\r\n  const filteredSalesData = useMemo(() => {\r\n    const filtered = sales.filter(sale => {\r\n      const saleDate = new Date(sale.date);\r\n      return matchesDateFilter(saleDate);\r\n    });\r\n\r\n    return {\r\n      all: filtered,\r\n      nonQuotes: filtered.filter(sale => sale.paymentStatus !== 'Quote')\r\n    };\r\n  }, [sales, matchesDateFilter]);\r\n\r\n  // Memoize analytics data calculation\r\n  const analyticsData = useMemo((): AnalyticsData => {\r\n    return filteredSalesData.nonQuotes.reduce((acc, sale) => {\r\n      const { totalSalePrice, totalCost } = calculateSaleTotals(sale);\r\n      // Calculate profit from actual revenue and cost to handle old sales correctly\r\n      const actualProfit = totalSalePrice - totalCost;\r\n\r\n      return {\r\n        totalSales: acc.totalSales + totalSalePrice,\r\n        totalProfit: acc.totalProfit + actualProfit,\r\n        totalCost: acc.totalCost + totalCost,\r\n        paidSalesCount: acc.paidSalesCount + (sale.paymentStatus === 'Paid' ? 1 : 0),\r\n        pendingSalesCount: acc.pendingSalesCount + (sale.paymentStatus === 'NOT PAID' ? 1 : 0),\r\n      };\r\n    }, {\r\n      totalSales: 0,\r\n      totalProfit: 0,\r\n      totalCost: 0,\r\n      paidSalesCount: 0,\r\n      pendingSalesCount: 0,\r\n    });\r\n  }, [filteredSalesData.nonQuotes, calculateSaleTotals]);\r\n\r\n  // Memoize bar chart data\r\n  const barChartData = useMemo(() => [\r\n    { name: 'Total Sales', amount: analyticsData.totalSales },\r\n    { name: 'Total Cost', amount: analyticsData.totalCost },\r\n    { name: 'Total Expenses', amount: expenses },\r\n    { name: 'Total Profit', amount: analyticsData.totalProfit },\r\n  ], [analyticsData, expenses]);\r\n\r\n  // Memoize recent sales calculation\r\n  const recentSales = useMemo(() => {\r\n    return [...filteredSalesData.all]\r\n      .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime())\r\n      .slice(0, 20);\r\n  }, [filteredSalesData.all]);\r\n\r\n  // Memoize non-quote sales count\r\n  const nonQuoteSalesCount = useMemo(() => {\r\n    return filteredSalesData.nonQuotes.length;\r\n  }, [filteredSalesData.nonQuotes]);\r\n\r\n  // Fetch expenses data based on the current date filter and business location\r\n  useEffect(() => {\r\n    const fetchExpenses = async () => {\r\n      if (!currentBusiness) {\r\n        setExpenses(0);\r\n        setIsLoadingExpenses(false);\r\n        return;\r\n      }\r\n\r\n      setIsLoadingExpenses(true);\r\n      try {\r\n        let startDate: string | undefined;\r\n        let endDate: string | undefined;\r\n\r\n        if (isCustomRange && dateRange.from && dateRange.to) {\r\n          startDate = dateRange.from.toISOString();\r\n          endDate = dateRange.to.toISOString();\r\n        } else if (isSpecificDate && specificDate) {\r\n          startDate = startOfDay(specificDate).toISOString();\r\n          endDate = endOfDay(specificDate).toISOString();\r\n        } else if (dateFilter !== 'all') {\r\n          const today = new Date();\r\n          switch (dateFilter) {\r\n            case 'today':\r\n              startDate = startOfDay(today).toISOString();\r\n              endDate = endOfDay(today).toISOString();\r\n              break;\r\n            case 'yesterday':\r\n              const yesterday = subDays(today, 1);\r\n              startDate = startOfDay(yesterday).toISOString();\r\n              endDate = endOfDay(yesterday).toISOString();\r\n              break;\r\n            case 'this-week':\r\n              startDate = startOfWeek(today, { weekStartsOn: 1 }).toISOString();\r\n              endDate = endOfWeek(today, { weekStartsOn: 1 }).toISOString();\r\n              break;\r\n            case 'last-week':\r\n              const lastWeekStart = subWeeks(startOfWeek(today, { weekStartsOn: 1 }), 1);\r\n              startDate = lastWeekStart.toISOString();\r\n              endDate = endOfWeek(lastWeekStart, { weekStartsOn: 1 }).toISOString();\r\n              break;\r\n            case 'this-month':\r\n              startDate = startOfMonth(today).toISOString();\r\n              endDate = endOfMonth(today).toISOString();\r\n              break;\r\n            case 'last-month':\r\n              const lastMonth = subMonths(today, 1);\r\n              startDate = startOfMonth(lastMonth).toISOString();\r\n              endDate = endOfMonth(lastMonth).toISOString();\r\n              break;\r\n            case 'this-year':\r\n              startDate = startOfYear(today).toISOString();\r\n              endDate = endOfYear(today).toISOString();\r\n              break;\r\n          }\r\n        }\r\n\r\n        const result = await getTotalExpensesAction(currentBusiness.id, startDate, endDate);\r\n\r\n        if (!result.success) {\r\n          console.error('Error fetching expenses:', result.error);\r\n          return;\r\n        }\r\n\r\n        setExpenses(result.data || 0);\r\n      } catch (error) {\r\n        console.error('Failed to fetch expenses:', error);\r\n      } finally {\r\n        setIsLoadingExpenses(false);\r\n      }\r\n    };\r\n\r\n    fetchExpenses();\r\n  }, [dateFilter, isCustomRange, isSpecificDate, dateRange.from, dateRange.to, specificDate, currentBusiness]);\r\n\r\n  return {\r\n    filteredSales: filteredSalesData.all,\r\n    nonQuoteSales: filteredSalesData.nonQuotes,\r\n    analyticsData,\r\n    barChartData,\r\n    recentSales,\r\n    nonQuoteSalesCount,\r\n    expenses,\r\n    isLoadingExpenses\r\n  };\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAeA;AACA;;;;;;AAWO,SAAS,iBAAiB,EAAE,KAAK,EAAE,UAAU,EAAE,SAAS,EAAE,YAAY,EAAE,aAAa,EAAE,cAAc,EAAyB;;IACnI,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAS;IACjD,MAAM,CAAC,mBAAmB,qBAAqB,GAAG,IAAA,yKAAQ,EAAC;IAC3D,MAAM,EAAE,eAAe,EAAE,GAAG,IAAA,qJAAW;IAEvC,qCAAqC;IACrC,MAAM,sBAAsB,IAAA,4KAAW;6DAAC,CAAC;YACvC,iFAAiF;YACjF,MAAM,iBAAiB,KAAK,KAAK,IAAI,MAAM,OAAO,CAAC,KAAK,KAAK,IACzD,KAAK,KAAK,CAAC,MAAM;qEAAC,CAAC,KAAK;oBACxB,MAAM,WAAW,KAAK,KAAK,GAAG,KAAK,QAAQ;oBAC3C,MAAM,iBAAiB,KAAK,YAAY,KAAK,WACxC,KAAK,cAAc,IAAI,IACxB,AAAC,WAAW,CAAC,KAAK,kBAAkB,IAAI,CAAC,IAAK;oBAClD,OAAO,MAAM,CAAC,WAAW,cAAc;gBACzC;oEAAG,KACD;YAEJ,MAAM,YAAY,KAAK,KAAK,IAAI,MAAM,OAAO,CAAC,KAAK,KAAK,IACpD,KAAK,KAAK,CAAC,MAAM;qEAAC,CAAC,KAAK,OAAS,MAAO,KAAK,IAAI,GAAG,KAAK,QAAQ;oEAAG,KACpE;YAEJ,OAAO;gBAAE;gBAAgB;YAAU;QACrC;4DAAG,EAAE;IAEL,kCAAkC;IAClC,MAAM,oBAAoB,IAAA,4KAAW;2DAAC,CAAC;YACrC,yBAAyB;YACzB,IAAI,MAAM,SAAS,OAAO,KAAK;gBAC7B,OAAO;YACT;YAEA,IAAI,eAAe,OAAO,OAAO;YAEjC,IAAI,eAAe,YAAY,eAAe;gBAC5C,IAAI,UAAU,IAAI,IAAI,UAAU,EAAE,EAAE;oBAClC,OAAO,IAAA,sKAAgB,EAAC,UAAU;wBAChC,OAAO,IAAA,0JAAU,EAAC,UAAU,IAAI;wBAChC,KAAK,IAAA,sJAAQ,EAAC,UAAU,EAAE;oBAC5B;gBACF;gBACA,OAAO;YACT;YAEA,IAAI,eAAe,cAAc,gBAAgB;gBAC/C,IAAI,cAAc;oBAChB,OAAO,IAAA,wJAAS,EAAC,UAAU;gBAC7B;gBACA,OAAO;YACT;YAEA,MAAM,QAAQ,IAAI;YAElB,OAAQ;gBACN,KAAK;oBACH,OAAO,IAAA,sKAAgB,EAAC,UAAU;wBAChC,OAAO,IAAA,0JAAU,EAAC;wBAClB,KAAK,IAAA,sJAAQ,EAAC;oBAChB;gBACF,KAAK;oBACH,MAAM,YAAY,IAAA,oJAAO,EAAC,OAAO;oBACjC,OAAO,IAAA,sKAAgB,EAAC,UAAU;wBAChC,OAAO,IAAA,0JAAU,EAAC;wBAClB,KAAK,IAAA,sJAAQ,EAAC;oBAChB;gBACF,KAAK;oBACH,OAAO,IAAA,sKAAgB,EAAC,UAAU;wBAChC,OAAO,IAAA,4JAAW,EAAC,OAAO;4BAAE,cAAc;wBAAE;wBAC5C,KAAK,IAAA,wJAAS,EAAC,OAAO;4BAAE,cAAc;wBAAE;oBAC1C;gBACF,KAAK;oBACH,MAAM,gBAAgB,IAAA,sJAAQ,EAAC,IAAA,4JAAW,EAAC,OAAO;wBAAE,cAAc;oBAAE,IAAI;oBACxE,MAAM,cAAc,IAAA,wJAAS,EAAC,eAAe;wBAAE,cAAc;oBAAE;oBAC/D,OAAO,IAAA,sKAAgB,EAAC,UAAU;wBAChC,OAAO;wBACP,KAAK;oBACP;gBACF,KAAK;oBACH,OAAO,IAAA,sKAAgB,EAAC,UAAU;wBAChC,OAAO,IAAA,8JAAY,EAAC;wBACpB,KAAK,IAAA,0JAAU,EAAC;oBAClB;gBACF,KAAK;oBACH,MAAM,YAAY,IAAA,wJAAS,EAAC,OAAO;oBACnC,OAAO,IAAA,sKAAgB,EAAC,UAAU;wBAChC,OAAO,IAAA,8JAAY,EAAC;wBACpB,KAAK,IAAA,0JAAU,EAAC;oBAClB;gBACF,KAAK;oBACH,OAAO,IAAA,sKAAgB,EAAC,UAAU;wBAChC,OAAO,IAAA,4JAAW,EAAC;wBACnB,KAAK,IAAA,wJAAS,EAAC;oBACjB;gBACF;oBACE,OAAO;YACX;QACF;0DAAG;QAAC;QAAY;QAAe;QAAgB;QAAW;KAAa;IAEvE,qCAAqC;IACrC,MAAM,oBAAoB,IAAA,wKAAO;uDAAC;YAChC,MAAM,WAAW,MAAM,MAAM;wEAAC,CAAA;oBAC5B,MAAM,WAAW,IAAI,KAAK,KAAK,IAAI;oBACnC,OAAO,kBAAkB;gBAC3B;;YAEA,OAAO;gBACL,KAAK;gBACL,WAAW,SAAS,MAAM;mEAAC,CAAA,OAAQ,KAAK,aAAa,KAAK;;YAC5D;QACF;sDAAG;QAAC;QAAO;KAAkB;IAE7B,qCAAqC;IACrC,MAAM,gBAAgB,IAAA,wKAAO;mDAAC;YAC5B,OAAO,kBAAkB,SAAS,CAAC,MAAM;2DAAC,CAAC,KAAK;oBAC9C,MAAM,EAAE,cAAc,EAAE,SAAS,EAAE,GAAG,oBAAoB;oBAC1D,8EAA8E;oBAC9E,MAAM,eAAe,iBAAiB;oBAEtC,OAAO;wBACL,YAAY,IAAI,UAAU,GAAG;wBAC7B,aAAa,IAAI,WAAW,GAAG;wBAC/B,WAAW,IAAI,SAAS,GAAG;wBAC3B,gBAAgB,IAAI,cAAc,GAAG,CAAC,KAAK,aAAa,KAAK,SAAS,IAAI,CAAC;wBAC3E,mBAAmB,IAAI,iBAAiB,GAAG,CAAC,KAAK,aAAa,KAAK,aAAa,IAAI,CAAC;oBACvF;gBACF;0DAAG;gBACD,YAAY;gBACZ,aAAa;gBACb,WAAW;gBACX,gBAAgB;gBAChB,mBAAmB;YACrB;QACF;kDAAG;QAAC,kBAAkB,SAAS;QAAE;KAAoB;IAErD,yBAAyB;IACzB,MAAM,eAAe,IAAA,wKAAO;kDAAC,IAAM;gBACjC;oBAAE,MAAM;oBAAe,QAAQ,cAAc,UAAU;gBAAC;gBACxD;oBAAE,MAAM;oBAAc,QAAQ,cAAc,SAAS;gBAAC;gBACtD;oBAAE,MAAM;oBAAkB,QAAQ;gBAAS;gBAC3C;oBAAE,MAAM;oBAAgB,QAAQ,cAAc,WAAW;gBAAC;aAC3D;iDAAE;QAAC;QAAe;KAAS;IAE5B,mCAAmC;IACnC,MAAM,cAAc,IAAA,wKAAO;iDAAC;YAC1B,OAAO;mBAAI,kBAAkB,GAAG;aAAC,CAC9B,IAAI;yDAAC,CAAC,GAAG,IAAM,IAAI,KAAK,EAAE,IAAI,EAAE,OAAO,KAAK,IAAI,KAAK,EAAE,IAAI,EAAE,OAAO;wDACpE,KAAK,CAAC,GAAG;QACd;gDAAG;QAAC,kBAAkB,GAAG;KAAC;IAE1B,gCAAgC;IAChC,MAAM,qBAAqB,IAAA,wKAAO;wDAAC;YACjC,OAAO,kBAAkB,SAAS,CAAC,MAAM;QAC3C;uDAAG;QAAC,kBAAkB,SAAS;KAAC;IAEhC,6EAA6E;IAC7E,IAAA,0KAAS;sCAAC;YACR,MAAM;4DAAgB;oBACpB,IAAI,CAAC,iBAAiB;wBACpB,YAAY;wBACZ,qBAAqB;wBACrB;oBACF;oBAEA,qBAAqB;oBACrB,IAAI;wBACF,IAAI;wBACJ,IAAI;wBAEJ,IAAI,iBAAiB,UAAU,IAAI,IAAI,UAAU,EAAE,EAAE;4BACnD,YAAY,UAAU,IAAI,CAAC,WAAW;4BACtC,UAAU,UAAU,EAAE,CAAC,WAAW;wBACpC,OAAO,IAAI,kBAAkB,cAAc;4BACzC,YAAY,IAAA,0JAAU,EAAC,cAAc,WAAW;4BAChD,UAAU,IAAA,sJAAQ,EAAC,cAAc,WAAW;wBAC9C,OAAO,IAAI,eAAe,OAAO;4BAC/B,MAAM,QAAQ,IAAI;4BAClB,OAAQ;gCACN,KAAK;oCACH,YAAY,IAAA,0JAAU,EAAC,OAAO,WAAW;oCACzC,UAAU,IAAA,sJAAQ,EAAC,OAAO,WAAW;oCACrC;gCACF,KAAK;oCACH,MAAM,YAAY,IAAA,oJAAO,EAAC,OAAO;oCACjC,YAAY,IAAA,0JAAU,EAAC,WAAW,WAAW;oCAC7C,UAAU,IAAA,sJAAQ,EAAC,WAAW,WAAW;oCACzC;gCACF,KAAK;oCACH,YAAY,IAAA,4JAAW,EAAC,OAAO;wCAAE,cAAc;oCAAE,GAAG,WAAW;oCAC/D,UAAU,IAAA,wJAAS,EAAC,OAAO;wCAAE,cAAc;oCAAE,GAAG,WAAW;oCAC3D;gCACF,KAAK;oCACH,MAAM,gBAAgB,IAAA,sJAAQ,EAAC,IAAA,4JAAW,EAAC,OAAO;wCAAE,cAAc;oCAAE,IAAI;oCACxE,YAAY,cAAc,WAAW;oCACrC,UAAU,IAAA,wJAAS,EAAC,eAAe;wCAAE,cAAc;oCAAE,GAAG,WAAW;oCACnE;gCACF,KAAK;oCACH,YAAY,IAAA,8JAAY,EAAC,OAAO,WAAW;oCAC3C,UAAU,IAAA,0JAAU,EAAC,OAAO,WAAW;oCACvC;gCACF,KAAK;oCACH,MAAM,YAAY,IAAA,wJAAS,EAAC,OAAO;oCACnC,YAAY,IAAA,8JAAY,EAAC,WAAW,WAAW;oCAC/C,UAAU,IAAA,0JAAU,EAAC,WAAW,WAAW;oCAC3C;gCACF,KAAK;oCACH,YAAY,IAAA,4JAAW,EAAC,OAAO,WAAW;oCAC1C,UAAU,IAAA,wJAAS,EAAC,OAAO,WAAW;oCACtC;4BACJ;wBACF;wBAEA,MAAM,SAAS,MAAM,IAAA,0LAAsB,EAAC,gBAAgB,EAAE,EAAE,WAAW;wBAE3E,IAAI,CAAC,OAAO,OAAO,EAAE;4BACnB,QAAQ,KAAK,CAAC,4BAA4B,OAAO,KAAK;4BACtD;wBACF;wBAEA,YAAY,OAAO,IAAI,IAAI;oBAC7B,EAAE,OAAO,OAAO;wBACd,QAAQ,KAAK,CAAC,6BAA6B;oBAC7C,SAAU;wBACR,qBAAqB;oBACvB;gBACF;;YAEA;QACF;qCAAG;QAAC;QAAY;QAAe;QAAgB,UAAU,IAAI;QAAE,UAAU,EAAE;QAAE;QAAc;KAAgB;IAE3G,OAAO;QACL,eAAe,kBAAkB,GAAG;QACpC,eAAe,kBAAkB,SAAS;QAC1C;QACA;QACA;QACA;QACA;QACA;IACF;AACF;GA/OgB;;QAGc,qJAAW"}},
    {"offset": {"line": 357, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/ui/popover.tsx"],"sourcesContent":["import * as React from \"react\"\r\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst Popover = PopoverPrimitive.Root\r\n\r\nconst PopoverTrigger = PopoverPrimitive.Trigger\r\n\r\nconst PopoverContent = React.forwardRef<\r\n  React.ElementRef<typeof PopoverPrimitive.Content>,\r\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\r\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\r\n  <PopoverPrimitive.Portal>\r\n    <PopoverPrimitive.Content\r\n      ref={ref}\r\n      align={align}\r\n      sideOffset={sideOffset}\r\n      className={cn(\r\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  </PopoverPrimitive.Portal>\r\n))\r\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\r\n\r\nexport { Popover, PopoverTrigger, PopoverContent }\r\n"],"names":[],"mappings":";;;;;;;;;AAAA;AACA;AAEA;;;;;AAEA,MAAM,UAAU,8KAAqB;AAErC,MAAM,iBAAiB,iLAAwB;AAE/C,MAAM,+BAAiB,2KAAgB,MAGrC,CAAC,EAAE,SAAS,EAAE,QAAQ,QAAQ,EAAE,aAAa,CAAC,EAAE,GAAG,OAAO,EAAE,oBAC5D,6LAAC,gLAAuB;kBACtB,cAAA,6LAAC,iLAAwB;YACvB,KAAK;YACL,OAAO;YACP,YAAY;YACZ,WAAW,IAAA,4HAAE,EACX,8aACA;YAED,GAAG,KAAK;;;;;;;;;;;;AAIf,eAAe,WAAW,GAAG,iLAAwB,CAAC,WAAW"}},
    {"offset": {"line": 405, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/ui/calendar.tsx"],"sourcesContent":["\r\nimport * as React from \"react\";\r\nimport { ChevronLeft, ChevronRight } from \"lucide-react\";\r\nimport { DayPicker } from \"react-day-picker\";\r\n\r\nimport { cn } from \"@/lib/utils\";\r\nimport { buttonVariants } from \"@/components/ui/button\";\r\n\r\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>;\r\n\r\nfunction Calendar({\r\n  className,\r\n  classNames,\r\n  showOutsideDays = true,\r\n  ...props\r\n}: CalendarProps) {\r\n  return (\r\n    <DayPicker\r\n      showOutsideDays={showOutsideDays}\r\n      className={cn(\"p-3 pointer-events-auto\", className)}\r\n      classNames={{\r\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\r\n        month: \"space-y-4\",\r\n        caption: \"flex justify-center pt-1 relative items-center\",\r\n        caption_label: \"text-sm font-medium\",\r\n        caption_dropdowns: \"flex justify-center gap-1\",\r\n        nav: \"space-x-1 flex items-center\",\r\n        nav_button: cn(\r\n          buttonVariants({ variant: \"outline\" }),\r\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\r\n        ),\r\n        nav_button_previous: \"absolute left-1\",\r\n        nav_button_next: \"absolute right-1\",\r\n        table: \"w-full border-collapse space-y-1\",\r\n        head_row: \"flex\",\r\n        head_cell:\r\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\r\n        row: \"flex w-full mt-2\",\r\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\r\n        day: cn(\r\n          buttonVariants({ variant: \"ghost\" }),\r\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\r\n        ),\r\n        day_range_end: \"day-range-end\",\r\n        day_selected:\r\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\r\n        day_today: \"bg-accent text-accent-foreground\",\r\n        day_outside:\r\n          \"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30\",\r\n        day_disabled: \"text-muted-foreground opacity-50\",\r\n        day_range_middle:\r\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\r\n        day_hidden: \"invisible\",\r\n        dropdown: \"bg-background rounded-md border p-1 shadow-md\",\r\n        dropdown_month: \"w-[var(--rdp-caption-dropdown-month-width)]\",\r\n        dropdown_year: \"w-[var(--rdp-caption-dropdown-year-width)]\",\r\n        dropdown_icon: \"w-4 h-4\",\r\n        button_reset: \"appearance-none bg-transparent border-none p-0 m-0\",\r\n        vhidden: \"sr-only\",\r\n        ...classNames,\r\n      }}\r\n      components={{\r\n        IconLeft: ({ ..._props }) => <ChevronLeft className=\"h-4 w-4\" />,\r\n        IconRight: ({ ..._props }) => <ChevronRight className=\"h-4 w-4\" />,\r\n      }}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\nCalendar.displayName = \"Calendar\";\r\n\r\nexport { Calendar };\r\n"],"names":[],"mappings":";;;;;AAEA;AAAA;AACA;AAEA;AACA;;;;;;AAIA,SAAS,SAAS,EAChB,SAAS,EACT,UAAU,EACV,kBAAkB,IAAI,EACtB,GAAG,OACW;IACd,qBACE,6LAAC,8KAAS;QACR,iBAAiB;QACjB,WAAW,IAAA,4HAAE,EAAC,2BAA2B;QACzC,YAAY;YACV,QAAQ;YACR,OAAO;YACP,SAAS;YACT,eAAe;YACf,mBAAmB;YACnB,KAAK;YACL,YAAY,IAAA,4HAAE,EACZ,IAAA,uJAAc,EAAC;gBAAE,SAAS;YAAU,IACpC;YAEF,qBAAqB;YACrB,iBAAiB;YACjB,OAAO;YACP,UAAU;YACV,WACE;YACF,KAAK;YACL,MAAM;YACN,KAAK,IAAA,4HAAE,EACL,IAAA,uJAAc,EAAC;gBAAE,SAAS;YAAQ,IAClC;YAEF,eAAe;YACf,cACE;YACF,WAAW;YACX,aACE;YACF,cAAc;YACd,kBACE;YACF,YAAY;YACZ,UAAU;YACV,gBAAgB;YAChB,eAAe;YACf,eAAe;YACf,cAAc;YACd,SAAS;YACT,GAAG,UAAU;QACf;QACA,YAAY;YACV,UAAU,CAAC,EAAE,GAAG,QAAQ,iBAAK,6LAAC,sOAAW;oBAAC,WAAU;;;;;;YACpD,WAAW,CAAC,EAAE,GAAG,QAAQ,iBAAK,6LAAC,yOAAY;oBAAC,WAAU;;;;;;QACxD;QACC,GAAG,KAAK;;;;;;AAGf;KA1DS;AA2DT,SAAS,WAAW,GAAG"}},
    {"offset": {"line": 494, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/analytics/DateRangeFilter.tsx"],"sourcesContent":["\r\nimport React from 'react';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Calendar as CalendarIcon } from \"lucide-react\";\r\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\r\nimport { Calendar } from \"@/components/ui/calendar\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { format } from \"date-fns\";\r\n\r\ninterface DateRangeFilterProps {\r\n  dateFilter: string;\r\n  dateRange: { from: Date | undefined; to: Date | undefined; };\r\n  specificDate?: Date | undefined;\r\n  isCustomRange: boolean;\r\n  isSpecificDate?: boolean;\r\n  onDateFilterChange: (value: string) => void;\r\n  onDateRangeChange: (range: { from: Date | undefined; to: Date | undefined; }) => void;\r\n  onSpecificDateChange?: (date: Date | undefined) => void;\r\n}\r\n\r\nconst DateRangeFilter: React.FC<DateRangeFilterProps> = ({\r\n  dateFilter,\r\n  dateRange,\r\n  specificDate,\r\n  isCustomRange,\r\n  isSpecificDate = false,\r\n  onDateFilterChange,\r\n  onDateRangeChange,\r\n  onSpecificDateChange\r\n}) => {\r\n  // Simplified event prevention\r\n  const preventPropagation = (e: React.MouseEvent | React.TouchEvent) => {\r\n    e.stopPropagation();\r\n  };\r\n  \r\n  return (\r\n    <div \r\n      className=\"flex gap-4 items-center flex-wrap mb-4\"\r\n      onClick={preventPropagation}\r\n    >\r\n      <div className=\"w-[240px] relative\">\r\n        <Select value={dateFilter} onValueChange={onDateFilterChange}>\r\n          <SelectTrigger className=\"bg-white shadow-sm\">\r\n            <SelectValue placeholder=\"Select date range\" />\r\n          </SelectTrigger>\r\n          <SelectContent className=\"z-[9999] bg-white shadow-lg border border-border/50\">\r\n            <SelectItem value=\"today\">Today</SelectItem>\r\n            <SelectItem value=\"yesterday\">Yesterday</SelectItem>\r\n            <SelectItem value=\"this-week\">This Week</SelectItem>\r\n            <SelectItem value=\"last-week\">Last Week</SelectItem>\r\n            <SelectItem value=\"this-month\">This Month</SelectItem>\r\n            <SelectItem value=\"last-month\">Last Month</SelectItem>\r\n            <SelectItem value=\"this-year\">This Year</SelectItem>\r\n            <SelectItem value=\"all\">All Time</SelectItem>\r\n            <SelectItem value=\"specific\">Specific Date</SelectItem>\r\n            <SelectItem value=\"custom\">Custom Range</SelectItem>\r\n          </SelectContent>\r\n        </Select>\r\n      </div>\r\n\r\n      {isSpecificDate && onSpecificDateChange && (\r\n        <div className=\"flex items-center\">\r\n          <Popover>\r\n            <PopoverTrigger asChild>\r\n              <Button\r\n                variant=\"outline\"\r\n                className=\"bg-white flex items-center gap-2 h-10 pl-3 text-left font-normal\"\r\n              >\r\n                <CalendarIcon className=\"h-4 w-4\" />\r\n                <span>{specificDate ? format(specificDate, \"MMM d, yyyy\") : \"Select Date\"}</span>\r\n              </Button>\r\n            </PopoverTrigger>\r\n            <PopoverContent className=\"w-auto p-0 z-[9999] bg-white shadow-lg\" align=\"start\">\r\n              <Calendar\r\n                initialFocus\r\n                mode=\"single\"\r\n                defaultMonth={specificDate}\r\n                selected={specificDate}\r\n                onSelect={onSpecificDateChange}\r\n                className=\"p-3 pointer-events-auto\"\r\n                showOutsideDays={true}\r\n              />\r\n            </PopoverContent>\r\n          </Popover>\r\n        </div>\r\n      )}\r\n\r\n      {isCustomRange && (\r\n        <div className=\"flex items-center space-x-2\">\r\n          <Popover>\r\n            <PopoverTrigger asChild>\r\n              <Button\r\n                variant=\"outline\"\r\n                className=\"bg-white flex items-center gap-2 h-10 pl-3 text-left font-normal\"\r\n              >\r\n                <CalendarIcon className=\"h-4 w-4\" />\r\n                <span>{dateRange.from ? format(dateRange.from, \"MMM d, yyyy\") : \"Start Date\"}</span>\r\n              </Button>\r\n            </PopoverTrigger>\r\n            <PopoverContent className=\"w-auto p-0 z-[9999] bg-white shadow-lg\" align=\"start\">\r\n              <Calendar\r\n                initialFocus\r\n                mode=\"single\"\r\n                defaultMonth={dateRange?.from}\r\n                selected={dateRange?.from}\r\n                onSelect={(date) => onDateRangeChange({ ...dateRange, from: date })}\r\n                className=\"p-3 pointer-events-auto\"\r\n                showOutsideDays={true}\r\n              />\r\n            </PopoverContent>\r\n          </Popover>\r\n          \r\n          <span className=\"text-muted-foreground\">to</span>\r\n          \r\n          <Popover>\r\n            <PopoverTrigger asChild>\r\n              <Button\r\n                variant=\"outline\"\r\n                className=\"bg-white flex items-center gap-2 h-10 pl-3 text-left font-normal\"\r\n              >\r\n                <CalendarIcon className=\"h-4 w-4\" />\r\n                <span>{dateRange.to ? format(dateRange.to, \"MMM d, yyyy\") : \"End Date\"}</span>\r\n              </Button>\r\n            </PopoverTrigger>\r\n            <PopoverContent className=\"w-auto p-0 z-[9999] bg-white shadow-lg\" align=\"start\">\r\n              <Calendar\r\n                initialFocus\r\n                mode=\"single\"\r\n                defaultMonth={dateRange?.to}\r\n                selected={dateRange?.to}\r\n                onSelect={(date) => onDateRangeChange({ ...dateRange, to: date })}\r\n                className=\"p-3 pointer-events-auto\"\r\n                showOutsideDays={true}\r\n              />\r\n            </PopoverContent>\r\n          </Popover>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default DateRangeFilter;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 869, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/analytics/AnalyticsCards.tsx"],"sourcesContent":["\r\nimport React, { memo } from 'react';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { AnalyticsData } from '@/types';\r\nimport { formatNumber } from '@/lib/utils';\r\nimport { useIsMobile } from '@/hooks/use-mobile';\r\nimport { TrendingUp, DollarSign, Percent, UserCheck, CreditCard, Package } from 'lucide-react';\r\n\r\ninterface AnalyticsCardsProps {\r\n  analyticsData: AnalyticsData;\r\n  nonQuoteSalesCount: number;\r\n  currency: string;\r\n  expenses: number;\r\n  inventoryValue: number;\r\n  canViewProfit?: boolean;\r\n  canViewTotalSales?: boolean;\r\n  canViewTotalExpenses?: boolean;\r\n  canViewInventoryValue?: boolean;\r\n  canViewSalesTypes?: boolean;\r\n}\r\n\r\nconst AnalyticsCards: React.FC<AnalyticsCardsProps> = memo(({\r\n  analyticsData,\r\n  nonQuoteSalesCount,\r\n  currency,\r\n  expenses,\r\n  inventoryValue,\r\n  canViewProfit = true,\r\n  canViewTotalSales = true,\r\n  canViewTotalExpenses = true,\r\n  canViewInventoryValue = true,\r\n  canViewSalesTypes = true\r\n}) => {\r\n  const isMobile = useIsMobile();\r\n\r\n  const cards = [\r\n    {\r\n      title: \"Total Sales\",\r\n      value: canViewTotalSales ? `${currency} ${formatNumber(analyticsData.totalSales)}` : '•••',\r\n      description: canViewTotalSales\r\n        ? `From ${nonQuoteSalesCount} transactions (excluding quotes)`\r\n        : \"Requires permission\",\r\n      color: \"text-sales-primary\",\r\n      bgColor: \"bg-blue-50\",\r\n      icon: <DollarSign className=\"h-5 w-5 text-sales-primary\" />,\r\n      visible: true\r\n    },\r\n    {\r\n      title: \"Total Gross Profit\",\r\n      value: canViewProfit ? `${currency} ${formatNumber(analyticsData.totalProfit)}` : '•••',\r\n      description: canViewProfit\r\n        ? (analyticsData.totalProfit > 0\r\n          ? `${(analyticsData.totalProfit / analyticsData.totalSales * 100).toFixed(1)}% profit margin`\r\n          : \"No profit yet\")\r\n        : \"Requires permission\",\r\n      color: \"text-green-600\",\r\n      bgColor: \"bg-green-50\",\r\n      icon: <TrendingUp className=\"h-5 w-5 text-green-600\" />,\r\n      visible: true\r\n    },\r\n    {\r\n      title: \"Total Expenses\",\r\n      value: canViewTotalExpenses ? `${currency} ${formatNumber(expenses)}` : '•••',\r\n      description: canViewTotalExpenses\r\n        ? (expenses > 0 && analyticsData.totalSales > 0\r\n          ? `${(expenses / analyticsData.totalSales * 100).toFixed(1)}% of sales`\r\n          : \"No expenses recorded\")\r\n        : \"Requires permission\",\r\n      color: \"text-[#f05a29]\",\r\n      bgColor: \"bg-orange-50\",\r\n      icon: <Percent className=\"h-5 w-5 text-[#f05a29]\" />,\r\n      visible: true\r\n    },\r\n    {\r\n      title: \"Inventory Value\",\r\n      value: canViewInventoryValue ? `${currency} ${formatNumber(inventoryValue)}` : '•••',\r\n      description: canViewInventoryValue ? \"Total value of current inventory\" : \"Requires permission\",\r\n      color: \"text-green-600\",\r\n      bgColor: \"bg-green-50\",\r\n      icon: <Package className=\"h-5 w-5 text-green-600\" />,\r\n      visible: true\r\n    },\r\n    {\r\n      title: \"Cash Sales\",\r\n      value: canViewSalesTypes ? analyticsData.paidSalesCount.toString() : '•••',\r\n      description: canViewSalesTypes\r\n        ? (analyticsData.paidSalesCount + analyticsData.pendingSalesCount > 0\r\n          ? `${(analyticsData.paidSalesCount / (analyticsData.paidSalesCount + analyticsData.pendingSalesCount) * 100).toFixed(1)}% of total`\r\n          : \"No sales yet\")\r\n        : \"Requires permission\",\r\n      color: \"text-green-600\",\r\n      bgColor: \"bg-green-50\",\r\n      icon: <UserCheck className=\"h-5 w-5 text-green-600\" />,\r\n      visible: true\r\n    },\r\n    {\r\n      title: \"Credit Sales\",\r\n      value: canViewSalesTypes ? analyticsData.pendingSalesCount.toString() : '•••',\r\n      description: canViewSalesTypes\r\n        ? (analyticsData.pendingSalesCount > 0\r\n          ? `${(analyticsData.pendingSalesCount / (analyticsData.paidSalesCount + analyticsData.pendingSalesCount) * 100).toFixed(1)}% of total`\r\n          : \"No credit sales\")\r\n        : \"Requires permission\",\r\n      color: \"text-amber-500\",\r\n      bgColor: \"bg-amber-50\",\r\n      icon: <CreditCard className=\"h-5 w-5 text-amber-500\" />,\r\n      visible: true\r\n    }\r\n  ];\r\n\r\n  const visibleCards = cards.filter(c => c.visible);\r\n\r\n  return (\r\n    <div className={`grid gap-4 w-full ${isMobile\r\n      ? 'grid-cols-2'\r\n      : 'grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6'\r\n      }`}>\r\n      {cards.map((card, index) => (\r\n        <Card key={index} className={`w-full transition-all duration-200 hover:shadow-md ${isMobile ? 'border-l-4 border-l-blue-500' : ''\r\n          }`}>\r\n          <CardContent className={`${isMobile ? 'p-3' : 'p-6'}`}>\r\n            <div className=\"flex items-start justify-between\">\r\n              <div className=\"flex-1\">\r\n                <div className=\"flex items-center gap-2 mb-2\">\r\n                  <div className={`p-1.5 rounded-lg ${card.bgColor} ${isMobile ? 'p-1' : 'p-2'}`}>\r\n                    <div className={isMobile ? 'scale-75' : ''}>\r\n                      {card.icon}\r\n                    </div>\r\n                  </div>\r\n                  <p className={`text-sm font-medium text-gray-600 ${isMobile ? 'text-xs leading-tight' : ''\r\n                    }`}>\r\n                    {card.title}\r\n                  </p>\r\n                </div>\r\n                <div className={`${card.color} font-bold mb-1 ${isMobile ? 'text-lg' : 'text-2xl'\r\n                  }`}>\r\n                  {card.value}\r\n                </div>\r\n                <p className={`text-muted-foreground ${isMobile ? 'text-xs leading-tight' : 'text-xs'\r\n                  }`}>\r\n                  {card.description}\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      ))}\r\n    </div>\r\n  );\r\n});\r\n\r\nexport default AnalyticsCards;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1093, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/analytics/FinancialOverview.tsx"],"sourcesContent":["\r\nimport React from 'react';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport {\r\n  BarChart,\r\n  Bar,\r\n  XAxis,\r\n  YAxis,\r\n  CartesianGrid,\r\n  Tooltip,\r\n  ResponsiveContainer,\r\n  Legend,\r\n  Cell,\r\n  ReferenceLine\r\n} from 'recharts';\r\nimport { Lock as LockIcon } from 'lucide-react';\r\nimport { useIsMobile } from '@/hooks/use-mobile';\r\n\r\ninterface FinancialOverviewProps {\r\n  data: Array<{ name: string, amount: number }>;\r\n  formatCurrency: (value: any) => string;\r\n}\r\n\r\nconst CustomTooltip = ({ active, payload, label, formatCurrency }: any) => {\r\n  if (active && payload && payload.length) {\r\n    return (\r\n      <div className=\"bg-white p-3 border border-gray-200 shadow-lg rounded-lg\">\r\n        <p className=\"font-medium text-sm text-gray-900\">{`${label}`}</p>\r\n        <p className=\"text-sm text-blue-600\">\r\n          <span className=\"font-medium\">{`Amount: `}</span>\r\n          <span className=\"font-bold\">{formatCurrency(payload[0].value)}</span>\r\n        </p>\r\n      </div>\r\n    );\r\n  }\r\n  return null;\r\n};\r\n\r\nconst FinancialOverview: React.FC<FinancialOverviewProps> = ({ data, formatCurrency }) => {\r\n  const isMobile = useIsMobile();\r\n\r\n  // Enhanced color mapping with gradients\r\n  const getBarColor = (entry: any, index: number) => {\r\n    const category = entry.name.toLowerCase();\r\n    if (category.includes('sales')) return '#3B82F6'; // Blue\r\n    if (category.includes('cost')) return '#EF4444'; // Red\r\n    if (category.includes('expenses')) return '#8B5CF6'; // Purple\r\n    if (category.includes('profit')) return '#10B981'; // Green\r\n    return '#6B7280'; // Gray default\r\n  };\r\n\r\n  // Add colors to data for easier rendering\r\n  const enhancedData = data.map((item, index) => ({\r\n    ...item,\r\n    fill: getBarColor(item, index)\r\n  }));\r\n\r\n  return (\r\n    <Card className=\"w-full shadow-sm\">\r\n      <CardHeader className={isMobile ? 'pb-3' : 'pb-4'}>\r\n        <CardTitle className={isMobile ? 'text-lg' : 'text-xl'}>\r\n          Financial Overview\r\n        </CardTitle>\r\n        <CardDescription className={isMobile ? 'text-sm' : ''}>\r\n          Sales, costs, expenses, and profits (excluding quotes)\r\n        </CardDescription>\r\n      </CardHeader>\r\n      <CardContent className={isMobile ? 'p-4 pt-0' : 'p-6 pt-0'}>\r\n        <div className={`w-full ${isMobile ? 'h-64' : 'h-80'}`}>\r\n          {data.length > 0 ? (\r\n            <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n              <BarChart\r\n                data={enhancedData}\r\n                margin={{\r\n                  top: 5,\r\n                  right: isMobile ? 10 : 30,\r\n                  left: isMobile ? 10 : 20,\r\n                  bottom: 5\r\n                }}\r\n              >\r\n                <CartesianGrid\r\n                  strokeDasharray=\"3 3\"\r\n                  stroke=\"#f0f0f0\"\r\n                  opacity={0.5}\r\n                />\r\n                <XAxis\r\n                  dataKey=\"name\"\r\n                  tick={{\r\n                    fontSize: isMobile ? 10 : 12,\r\n                    fill: '#6B7280'\r\n                  }}\r\n                  tickLine={false}\r\n                  axisLine={{ stroke: '#e0e0e0' }}\r\n                  angle={isMobile ? -45 : 0}\r\n                  textAnchor={isMobile ? 'end' : 'middle'}\r\n                  height={isMobile ? 50 : 30}\r\n                />\r\n                <YAxis\r\n                  tickFormatter={(value) => formatCurrency(value)}\r\n                  tick={{\r\n                    fontSize: isMobile ? 10 : 12,\r\n                    fill: '#6B7280'\r\n                  }}\r\n                  tickLine={false}\r\n                  axisLine={{ stroke: '#e0e0e0' }}\r\n                  width={isMobile ? 60 : 80}\r\n                />\r\n                <Tooltip\r\n                  content={<CustomTooltip formatCurrency={formatCurrency} />}\r\n                  cursor={{ fill: 'rgba(59, 130, 246, 0.1)' }}\r\n                />\r\n                {!isMobile && (\r\n                  <Legend\r\n                    wrapperStyle={{\r\n                      paddingTop: 15,\r\n                      fontSize: 12,\r\n                      color: '#6B7280'\r\n                    }}\r\n                  />\r\n                )}\r\n                <Bar\r\n                  dataKey=\"amount\"\r\n                  name=\"Amount\"\r\n                  barSize={isMobile ? 30 : 40}\r\n                  radius={[4, 4, 0, 0]}\r\n                  fillOpacity={0.9}\r\n                >\r\n                  {enhancedData.map((entry, index) => (\r\n                    <Cell\r\n                      key={`cell-${index}`}\r\n                      fill={entry.fill}\r\n                    />\r\n                  ))}\r\n                </Bar>\r\n              </BarChart>\r\n            </ResponsiveContainer>\r\n          ) : (\r\n            <div className=\"flex flex-col items-center justify-center h-full text-muted-foreground space-y-2\">\r\n              <LockIcon className=\"h-8 w-8 opacity-20\" />\r\n              <p>Private data restricted</p>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Mobile Legend */}\r\n        {isMobile && (\r\n          <div className=\"flex flex-wrap justify-center gap-3 mt-4 pt-3 border-t\">\r\n            {enhancedData.map((entry, index) => (\r\n              <div key={index} className=\"flex items-center gap-1\">\r\n                <div\r\n                  className=\"w-3 h-3 rounded-sm\"\r\n                  style={{ backgroundColor: entry.fill }}\r\n                />\r\n                <span className=\"text-xs text-gray-600 font-medium\">\r\n                  {entry.name}\r\n                </span>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default FinancialOverview;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1421, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/ui/progress.tsx"],"sourcesContent":["\r\nimport * as React from \"react\"\r\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst Progress = React.forwardRef<\r\n  React.ElementRef<typeof ProgressPrimitive.Root>,\r\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\r\n>(({ className, value, ...props }, ref) => (\r\n  <ProgressPrimitive.Root\r\n    ref={ref}\r\n    className={cn(\r\n      \"relative h-4 w-full overflow-hidden rounded-full bg-gray-200\",\r\n      className\r\n    )}\r\n    {...props}\r\n  >\r\n    <ProgressPrimitive.Indicator\r\n      className=\"h-full w-full flex-1 transition-all\"\r\n      style={{ \r\n        transform: `translateX(-${100 - (value || 0)}%)`,\r\n        backgroundColor: \"#16a34a\"\r\n      }}\r\n    />\r\n  </ProgressPrimitive.Root>\r\n))\r\nProgress.displayName = ProgressPrimitive.Root.displayName\r\n\r\nexport { Progress }\r\n"],"names":[],"mappings":";;;;;AACA;AACA;AAEA;;;;;AAEA,MAAM,yBAAW,2KAAgB,MAG/B,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,GAAG,OAAO,EAAE,oBACjC,6LAAC,+KAAsB;QACrB,KAAK;QACL,WAAW,IAAA,4HAAE,EACX,gEACA;QAED,GAAG,KAAK;kBAET,cAAA,6LAAC,oLAA2B;YAC1B,WAAU;YACV,OAAO;gBACL,WAAW,CAAC,YAAY,EAAE,MAAM,CAAC,SAAS,CAAC,EAAE,EAAE,CAAC;gBAChD,iBAAiB;YACnB;;;;;;;;;;;;AAIN,SAAS,WAAW,GAAG,+KAAsB,CAAC,WAAW"}},
    {"offset": {"line": 1466, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/ui/tabs.tsx"],"sourcesContent":["import * as React from \"react\"\r\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst Tabs = TabsPrimitive.Root\r\n\r\nconst TabsList = React.forwardRef<\r\n  React.ElementRef<typeof TabsPrimitive.List>,\r\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\r\n>(({ className, ...props }, ref) => (\r\n  <TabsPrimitive.List\r\n    ref={ref}\r\n    className={cn(\r\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nTabsList.displayName = TabsPrimitive.List.displayName\r\n\r\nconst TabsTrigger = React.forwardRef<\r\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\r\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\r\n>(({ className, ...props }, ref) => (\r\n  <TabsPrimitive.Trigger\r\n    ref={ref}\r\n    className={cn(\r\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\r\n\r\nconst TabsContent = React.forwardRef<\r\n  React.ElementRef<typeof TabsPrimitive.Content>,\r\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\r\n>(({ className, ...props }, ref) => (\r\n  <TabsPrimitive.Content\r\n    ref={ref}\r\n    className={cn(\r\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nTabsContent.displayName = TabsPrimitive.Content.displayName\r\n\r\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\r\n"],"names":[],"mappings":";;;;;;;;;;;AAAA;AACA;AAEA;;;;;AAEA,MAAM,OAAO,2KAAkB;AAE/B,MAAM,yBAAW,2KAAgB,MAG/B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,2KAAkB;QACjB,KAAK;QACL,WAAW,IAAA,4HAAE,EACX,8FACA;QAED,GAAG,KAAK;;;;;;;AAGb,SAAS,WAAW,GAAG,2KAAkB,CAAC,WAAW;AAErD,MAAM,4BAAc,2KAAgB,OAGlC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,8KAAqB;QACpB,KAAK;QACL,WAAW,IAAA,4HAAE,EACX,uYACA;QAED,GAAG,KAAK;;;;;;;AAGb,YAAY,WAAW,GAAG,8KAAqB,CAAC,WAAW;AAE3D,MAAM,4BAAc,2KAAgB,OAGlC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,8KAAqB;QACpB,KAAK;QACL,WAAW,IAAA,4HAAE,EACX,mIACA;QAED,GAAG,KAAK;;;;;;;AAGb,YAAY,WAAW,GAAG,8KAAqB,CAAC,WAAW"}},
    {"offset": {"line": 1533, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/app/actions/business-settings.ts"],"sourcesContent":["'use server';\r\n\r\nimport { db } from '../../../prisma/db';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\nexport async function getBusinessSettingsAction(branchId: string) {\r\n    try {\r\n        const settings = await db.branchSettings.findUnique({\r\n            where: { branchId }\r\n        });\r\n\r\n        if (!settings) {\r\n            return null;\r\n        }\r\n\r\n        return {\r\n            id: settings.id,\r\n            business_name: settings.businessName,\r\n            business_address: settings.address,\r\n            business_phone: settings.phone,\r\n            business_email: settings.email,\r\n            business_logo: settings.logo,\r\n            currency: settings.currency,\r\n            signature: settings.signatureImage,\r\n            metadata: settings.metadata || {}\r\n        };\r\n    } catch (error) {\r\n        console.error('Error fetching business settings:', error);\r\n        return null;\r\n    }\r\n}\r\n\r\nexport async function upsertBusinessSettingsAction(branchId: string, userId: string, updateData: any) {\r\n    try {\r\n        // Validate user access to branch\r\n        const branch = await db.branch.findFirst({\r\n            where: {\r\n                id: branchId,\r\n                OR: [\r\n                    { adminId: userId },\r\n                    { users: { some: { id: userId } } }\r\n                ]\r\n            }\r\n        });\r\n\r\n        if (!branch) {\r\n            return { success: false, error: 'Unauthorized to update branch settings' };\r\n        }\r\n\r\n        const data = {\r\n            businessName: updateData.business_name,\r\n            address: updateData.business_address,\r\n            phone: updateData.business_phone,\r\n            email: updateData.business_email,\r\n            logo: updateData.business_logo,\r\n            currency: updateData.currency,\r\n            signatureImage: updateData.signature,\r\n            metadata: updateData.metadata\r\n        };\r\n\r\n        const upserted = await db.branchSettings.upsert({\r\n            where: { branchId: branchId },\r\n            update: data,\r\n            create: {\r\n                branchId: branchId,\r\n                ...data\r\n            }\r\n        });\r\n\r\n        return {\r\n            success: true,\r\n            data: {\r\n                id: upserted.id,\r\n                business_name: upserted.businessName,\r\n                business_address: upserted.address,\r\n                business_phone: upserted.phone,\r\n                business_email: upserted.email,\r\n                business_logo: upserted.logo,\r\n                currency: upserted.currency,\r\n                signature: upserted.signatureImage,\r\n                metadata: upserted.metadata\r\n            }\r\n        };\r\n    } catch (error: any) {\r\n        console.error('Error upserting business settings:', error);\r\n        return { success: false, error: error.message || 'Failed to update settings' };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MAKsB,wBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA,6DAAA"}},
    {"offset": {"line": 1550, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/app/actions/business-settings.ts"],"sourcesContent":["'use server';\r\n\r\nimport { db } from '../../../prisma/db';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\nexport async function getBusinessSettingsAction(branchId: string) {\r\n    try {\r\n        const settings = await db.branchSettings.findUnique({\r\n            where: { branchId }\r\n        });\r\n\r\n        if (!settings) {\r\n            return null;\r\n        }\r\n\r\n        return {\r\n            id: settings.id,\r\n            business_name: settings.businessName,\r\n            business_address: settings.address,\r\n            business_phone: settings.phone,\r\n            business_email: settings.email,\r\n            business_logo: settings.logo,\r\n            currency: settings.currency,\r\n            signature: settings.signatureImage,\r\n            metadata: settings.metadata || {}\r\n        };\r\n    } catch (error) {\r\n        console.error('Error fetching business settings:', error);\r\n        return null;\r\n    }\r\n}\r\n\r\nexport async function upsertBusinessSettingsAction(branchId: string, userId: string, updateData: any) {\r\n    try {\r\n        // Validate user access to branch\r\n        const branch = await db.branch.findFirst({\r\n            where: {\r\n                id: branchId,\r\n                OR: [\r\n                    { adminId: userId },\r\n                    { users: { some: { id: userId } } }\r\n                ]\r\n            }\r\n        });\r\n\r\n        if (!branch) {\r\n            return { success: false, error: 'Unauthorized to update branch settings' };\r\n        }\r\n\r\n        const data = {\r\n            businessName: updateData.business_name,\r\n            address: updateData.business_address,\r\n            phone: updateData.business_phone,\r\n            email: updateData.business_email,\r\n            logo: updateData.business_logo,\r\n            currency: updateData.currency,\r\n            signatureImage: updateData.signature,\r\n            metadata: updateData.metadata\r\n        };\r\n\r\n        const upserted = await db.branchSettings.upsert({\r\n            where: { branchId: branchId },\r\n            update: data,\r\n            create: {\r\n                branchId: branchId,\r\n                ...data\r\n            }\r\n        });\r\n\r\n        return {\r\n            success: true,\r\n            data: {\r\n                id: upserted.id,\r\n                business_name: upserted.businessName,\r\n                business_address: upserted.address,\r\n                business_phone: upserted.phone,\r\n                business_email: upserted.email,\r\n                business_logo: upserted.logo,\r\n                currency: upserted.currency,\r\n                signature: upserted.signatureImage,\r\n                metadata: upserted.metadata\r\n            }\r\n        };\r\n    } catch (error: any) {\r\n        console.error('Error upserting business settings:', error);\r\n        return { success: false, error: error.message || 'Failed to update settings' };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MAgCsB,wBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA,gEAAA"}},
    {"offset": {"line": 1567, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useBusinessSettings.ts"],"sourcesContent":["\r\nimport { useState, useEffect } from 'react';\r\nimport { useQuery } from '@tanstack/react-query';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\nimport { useAuth } from '@/components/auth/AuthProvider';\r\nimport { getBusinessSettingsAction, upsertBusinessSettingsAction } from '@/app/actions/business-settings';\r\n\r\nexport interface BusinessSettings {\r\n  id?: string;\r\n  businessName: string;\r\n  businessAddress: string;\r\n  businessPhone: string;\r\n  businessEmail: string;\r\n  businessLogo?: string;\r\n  currency: string;\r\n  signature?: string;\r\n  paymentInfo?: string;\r\n  defaultPrintFormat?: 'standard' | 'thermal';\r\n  defaultPrinterName?: string;\r\n  defaultPrinterType?: 'USB' | 'Bluetooth';\r\n  printerPaperSize?: '58mm' | '80mm';\r\n}\r\n\r\n// Utility function to parse payment info text into structured format\r\nexport const parsePaymentInfo = (paymentInfo: string): { method: string, accountNumber: string, accountName: string }[] => {\r\n  if (!paymentInfo || paymentInfo.trim() === '') {\r\n    return [];\r\n  }\r\n\r\n  const lines = paymentInfo.split('\\n').filter(line => line.trim() !== '');\r\n  const methods: { method: string, accountNumber: string, accountName: string }[] = [];\r\n\r\n  for (let i = 0; i < lines.length; i += 3) {\r\n    if (i + 2 < lines.length) {\r\n      methods.push({\r\n        method: lines[i].trim(),\r\n        accountNumber: lines[i + 1].trim(),\r\n        accountName: lines[i + 2].trim()\r\n      });\r\n    }\r\n  }\r\n\r\n  return methods;\r\n};\r\n\r\n// Utility function to convert payment methods array back to string format\r\nexport const convertPaymentMethodsToString = (paymentMethods: { method: string, accountNumber: string, accountName: string }[]): string => {\r\n  return paymentMethods\r\n    .filter(pm => pm.method.trim() !== '' || pm.accountNumber.trim() !== '' || pm.accountName.trim() !== '')\r\n    .map(pm => `${pm.method}\\n${pm.accountNumber}\\n${pm.accountName}`)\r\n    .join('\\n');\r\n};\r\n\r\n// Default settings for new businesses\r\nconst getDefaultSettings = (): BusinessSettings => ({\r\n  businessName: '',\r\n  businessAddress: '',\r\n  businessPhone: '',\r\n  businessEmail: '',\r\n  currency: 'UGX',\r\n  paymentInfo: '',\r\n  defaultPrintFormat: 'standard'\r\n});\r\n\r\nexport const useBusinessSettings = () => {\r\n  const [settings, setSettings] = useState<BusinessSettings>(getDefaultSettings());\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const { toast } = useToast();\r\n  const { currentBusiness } = useBusiness();\r\n\r\n  const loadSettings = async (): Promise<BusinessSettings> => {\r\n    if (!currentBusiness) {\r\n      return getDefaultSettings();\r\n    }\r\n\r\n    try {\r\n      const data = await getBusinessSettingsAction(currentBusiness.id);\r\n\r\n      if (data) {\r\n        // Extract payment info from metadata\r\n        const paymentInfo = data.metadata && typeof data.metadata === 'object' ?\r\n          (data.metadata as Record<string, unknown>).payment_info as string || '' : '';\r\n\r\n        return {\r\n          id: data.id,\r\n          businessName: data.business_name,\r\n          businessAddress: data.business_address,\r\n          businessPhone: data.business_phone,\r\n          businessEmail: data.business_email,\r\n          businessLogo: data.business_logo,\r\n          currency: data.currency,\r\n          signature: data.signature,\r\n          paymentInfo: paymentInfo,\r\n          defaultPrintFormat: data.metadata && typeof data.metadata === 'object' ?\r\n            (data.metadata as Record<string, unknown>).default_print_format as 'standard' | 'thermal' || 'standard' : 'standard',\r\n          defaultPrinterName: data.metadata && typeof data.metadata === 'object' ?\r\n            (data.metadata as Record<string, unknown>).default_printer_name as string || '' : '',\r\n          defaultPrinterType: data.metadata && typeof data.metadata === 'object' ?\r\n            (data.metadata as Record<string, unknown>).default_printer_type as 'USB' | 'Bluetooth' || 'USB' : 'USB',\r\n          printerPaperSize: data.metadata && typeof data.metadata === 'object' ?\r\n            (data.metadata as Record<string, unknown>).printer_paper_size as '58mm' | '80mm' || '58mm' : '58mm'\r\n        };\r\n      } else {\r\n        return getDefaultSettings();\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading business settings:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to load business settings. Please try again.\",\r\n        variant: \"destructive\"\r\n      });\r\n      return getDefaultSettings();\r\n    }\r\n  };\r\n\r\n  const updateSettings = async (newSettings: Partial<BusinessSettings>) => {\r\n    if (!currentBusiness) {\r\n      console.error('No business selected for updating settings');\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"No business selected\",\r\n        variant: \"destructive\"\r\n      });\r\n      return false;\r\n    }\r\n\r\n    try {\r\n      const userData = { user: { id: '00000000-0000-0000-0000-000000000000' } }; // Mocked user id for now\r\n\r\n      // Prepare the metadata object with payment info\r\n      const metadata = {\r\n        payment_info: newSettings.hasOwnProperty('paymentInfo') ? newSettings.paymentInfo : settings.paymentInfo || '',\r\n        default_print_format: newSettings.hasOwnProperty('defaultPrintFormat') ? newSettings.defaultPrintFormat : settings.defaultPrintFormat || 'standard',\r\n        default_printer_name: newSettings.hasOwnProperty('defaultPrinterName') ? newSettings.defaultPrinterName : settings.defaultPrinterName || '',\r\n        default_printer_type: newSettings.hasOwnProperty('defaultPrinterType') ? newSettings.defaultPrinterType : settings.defaultPrinterType || 'USB',\r\n        printer_paper_size: newSettings.hasOwnProperty('printerPaperSize') ? newSettings.printerPaperSize : settings.printerPaperSize || '58mm'\r\n      };\r\n\r\n      const updateData = {\r\n        business_name: newSettings.hasOwnProperty('businessName') ? newSettings.businessName : settings.businessName,\r\n        business_address: newSettings.hasOwnProperty('businessAddress') ? newSettings.businessAddress : settings.businessAddress,\r\n        business_phone: newSettings.hasOwnProperty('businessPhone') ? newSettings.businessPhone : settings.businessPhone,\r\n        business_email: newSettings.hasOwnProperty('businessEmail') ? newSettings.businessEmail : settings.businessEmail,\r\n        business_logo: newSettings.hasOwnProperty('businessLogo') ? newSettings.businessLogo : settings.businessLogo,\r\n        currency: newSettings.hasOwnProperty('currency') ? newSettings.currency : settings.currency,\r\n        signature: newSettings.hasOwnProperty('signature') ? newSettings.signature : settings.signature,\r\n        metadata: metadata\r\n      };\r\n\r\n      const response = await upsertBusinessSettingsAction(currentBusiness.id, userData.user.id, updateData);\r\n\r\n      if (!response.success) {\r\n        console.error('Supabase error updating business settings:', response.error);\r\n        throw new Error(response.error);\r\n      }\r\n\r\n      toast({\r\n        title: \"Success\",\r\n        description: \"Business settings updated successfully\"\r\n      });\r\n\r\n      // Refetch settings after update\r\n      refetch();\r\n\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error updating business settings:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to update business settings. Please try again.\",\r\n        variant: \"destructive\"\r\n      });\r\n      return false;\r\n    }\r\n  };\r\n\r\n  // React Query for settings loading with proper caching\r\n  const { data: queriedData, isLoading: isQueryLoading, isFetching, refetch } = useQuery({\r\n    queryKey: ['businessSettings', currentBusiness?.id],\r\n    queryFn: loadSettings,\r\n    enabled: !!currentBusiness?.id,\r\n    staleTime: 5 * 60_000,\r\n    gcTime: 30 * 60_000,\r\n    refetchOnWindowFocus: false,\r\n    refetchOnReconnect: false,\r\n  });\r\n\r\n  // Sync React Query data with local state\r\n  useEffect(() => {\r\n    if (queriedData) {\r\n      setSettings(queriedData);\r\n    } else if (!currentBusiness) {\r\n      setSettings(getDefaultSettings());\r\n    }\r\n  }, [queriedData, currentBusiness]);\r\n\r\n  // Sync loading state from React Query\r\n  useEffect(() => {\r\n    setIsLoading(isQueryLoading || isFetching);\r\n  }, [isQueryLoading, isFetching]);\r\n\r\n  return {\r\n    settings,\r\n    isLoading,\r\n    updateSettings,\r\n    loadSettings\r\n  };\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1772, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/utils/businessGoalTips.ts"],"sourcesContent":["\r\nexport const businessGoalTips = [\r\n  \"💡 Tip: Break your monthly goal into daily targets. Small consistent actions lead to big results!\",\r\n  \"🎯 Focus: Review your progress weekly and adjust your strategies based on what's working.\",\r\n  \"🚀 Motivation: Every successful business started with a single sale. Keep pushing forward!\",\r\n  \"📊 Strategy: Track your conversion rates to identify which sales approaches work best.\",\r\n  \"💪 Mindset: Treat every 'no' as one step closer to your next 'yes'. Persistence pays off!\",\r\n  \"🌟 Excellence: Quality over quantity - focus on building lasting customer relationships.\",\r\n  \"⏰ Efficiency: Time-block your sales activities to maximize productivity and focus.\",\r\n  \"🎉 Celebration: Acknowledge small wins along the way - they fuel motivation for bigger goals!\",\r\n  \"📈 Growth: Analyze your best-performing days and replicate those successful patterns.\",\r\n  \"🤝 Networking: Strong relationships with customers often lead to referrals and repeat business.\",\r\n  \"💼 Professionalism: Your reputation is your most valuable asset - protect and nurture it.\",\r\n  \"🔍 Analysis: Use data to guide your decisions, not just gut feelings.\",\r\n  \"🎨 Creativity: Try new approaches to reach customers and stand out from competitors.\",\r\n  \"⚡ Action: Don't wait for perfect conditions - take imperfect action and adjust as you go.\",\r\n  \"🧠 Learning: Invest time in learning about your industry, customers, and sales techniques.\",\r\n  \"🔄 Consistency: Show up daily - consistent effort compounds over time.\",\r\n  \"👂 Listening: Your customers' feedback is gold. Listen carefully and adapt accordingly.\",\r\n  \"📱 Reach: Leverage all available channels to maximize your market visibility.\",\r\n  \"🧩 Solutions: Focus on solving problems for customers rather than just selling products.\",\r\n  \"⚖️ Balance: Maintain a healthy work-life balance to prevent burnout and stay motivated.\",\r\n  \"📝 Planning: End each day by preparing your top priorities for tomorrow.\",\r\n  \"🌱 Growth: Invest in your skills - the best investment is in yourself.\",\r\n  \"🤔 Reflection: Take time to reflect on what worked and what didn't each week.\",\r\n  \"🏆 Excellence: Set standards higher than your competition to truly stand out.\",\r\n  \"📣 Voice: Develop a unique brand voice that resonates with your target audience.\",\r\n  \"📚 Knowledge: Know your products inside and out - expertise builds customer trust.\",\r\n  \"🎭 Adaptability: Stay flexible and ready to pivot when market conditions change.\",\r\n  \"🔗 Connection: Build genuine connections with customers beyond just transactions.\",\r\n  \"🌐 Expansion: Consider new markets or segments that might benefit from your offerings.\",\r\n  \"🙏 Gratitude: Express appreciation to your customers regularly - loyalty is earned.\"\r\n];\r\n\r\n/**\r\n * Returns a business goal tip based on the current date\r\n * Tips will rotate through the month, resetting each month\r\n */\r\nexport const getTodaysTip = (): string => {\r\n  const today = new Date();\r\n  const dayOfMonth = today.getDate() - 1; // 0-indexed (0-29)\r\n  const tipIndex = dayOfMonth % businessGoalTips.length;\r\n  return businessGoalTips[tipIndex];\r\n};\r\n"],"names":[],"mappings":";;;;;;AACO,MAAM,mBAAmB;IAC9B;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AAMM,MAAM,eAAe;IAC1B,MAAM,QAAQ,IAAI;IAClB,MAAM,aAAa,MAAM,OAAO,KAAK,GAAG,mBAAmB;IAC3D,MAAM,WAAW,aAAa,iBAAiB,MAAM;IACrD,OAAO,gBAAgB,CAAC,SAAS;AACnC"}},
    {"offset": {"line": 1823, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/BusinessGoalsTip.tsx"],"sourcesContent":["\r\nimport React from \"react\";\r\nimport { getTodaysTip } from \"@/utils/businessGoalTips\";\r\nimport { Lightbulb } from \"lucide-react\";\r\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from \"@/components/ui/tooltip\";\r\n\r\nconst BusinessGoalsTip = () => {\r\n  const todaysTip = getTodaysTip();\r\n\r\n  return (\r\n    <div className=\"mt-4 pt-4 border-t border-gray-200\">\r\n      <div className=\"flex items-start gap-2\">\r\n        <Lightbulb className=\"h-4 w-4 text-amber-500 mt-0.5 flex-shrink-0\" />\r\n        <div className=\"text-sm text-gray-600\">\r\n          <span className=\"font-medium text-amber-600\">Business Goals Tip:</span>{\" \"}\r\n          <span>{todaysTip}</span>\r\n          \r\n          <TooltipProvider>\r\n            <Tooltip>\r\n              <TooltipTrigger asChild>\r\n                <span className=\"ml-1 cursor-help text-gray-400 hover:text-gray-600 text-xs\">\r\n                  (New tip daily)\r\n                </span>\r\n              </TooltipTrigger>\r\n              <TooltipContent side=\"bottom\" className=\"max-w-xs\">\r\n                <p className=\"text-xs\">Tips refresh each day to help you stay motivated and reach your sales goals.</p>\r\n              </TooltipContent>\r\n            </Tooltip>\r\n          </TooltipProvider>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default BusinessGoalsTip;\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;;;;;AAEA,MAAM,mBAAmB;IACvB,MAAM,YAAY,IAAA,mJAAY;IAE9B,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC;YAAI,WAAU;;8BACb,6LAAC,4NAAS;oBAAC,WAAU;;;;;;8BACrB,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BAAK,WAAU;sCAA6B;;;;;;wBAA2B;sCACxE,6LAAC;sCAAM;;;;;;sCAEP,6LAAC,yJAAe;sCACd,cAAA,6LAAC,iJAAO;;kDACN,6LAAC,wJAAc;wCAAC,OAAO;kDACrB,cAAA,6LAAC;4CAAK,WAAU;sDAA6D;;;;;;;;;;;kDAI/E,6LAAC,wJAAc;wCAAC,MAAK;wCAAS,WAAU;kDACtC,cAAA,6LAAC;4CAAE,WAAU;sDAAU;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQvC;KA3BM;uCA6BS"}},
    {"offset": {"line": 1942, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useFinancialVisibility.ts"],"sourcesContent":["import { useProfiles } from '@/contexts/ProfileContext';\r\n\r\n/**\r\n * Hook to handle financial data visibility based on permissions\r\n */\r\nexport const useFinancialVisibility = () => {\r\n    const { hasPermission } = useProfiles();\r\n\r\n    const canViewCostPrice = hasPermission('inventory', 'view_cost_price');\r\n    const canViewProfit = hasPermission('inventory', 'view_profit');\r\n    const canViewSellingPrice = hasPermission('inventory', 'view_selling_price');\r\n\r\n    // Dashboard-specific permissions\r\n    const canViewTotalSales = hasPermission('dashboard', 'view_total_sales');\r\n    const canViewTotalGrossProfit = hasPermission('dashboard', 'view_gross_profit');\r\n    const canViewTotalExpenses = hasPermission('dashboard', 'view_total_expenses');\r\n    const canViewInventoryValue = hasPermission('dashboard', 'view_inventory_value');\r\n    const canViewSalesTypes = hasPermission('dashboard', 'view_sales_types');\r\n    const canViewAvgPrice = hasPermission('dashboard', 'view_avg_price');\r\n    const canViewTotalAmount = hasPermission('dashboard', 'view_total_amount');\r\n\r\n    // Finance and Expenses permissions\r\n    const canManageFinanceAccounts = hasPermission('finance', 'manage_accounts');\r\n    const canViewFinance = hasPermission('finance', 'view');\r\n    const canViewExpenses = hasPermission('expenses', 'view');\r\n    const canCreateExpenses = hasPermission('expenses', 'create');\r\n    const canEditExpenses = hasPermission('expenses', 'edit');\r\n    const canDeleteExpenses = hasPermission('expenses', 'delete');\r\n\r\n    /**\r\n     * Format a financial value or return a hidden indicator\r\n     */\r\n    const formatFinancial = (value: number | null | undefined, type: 'cost' | 'selling' | 'profit'): string => {\r\n        const hasAccess =\r\n            (type === 'cost' && canViewCostPrice) ||\r\n            (type === 'selling' && canViewSellingPrice) ||\r\n            (type === 'profit' && canViewProfit);\r\n\r\n        if (!hasAccess) {\r\n            return '•••';\r\n        }\r\n\r\n        return value?.toLocaleString() || '0';\r\n    };\r\n\r\n    return {\r\n        canViewCostPrice,\r\n        canViewProfit,\r\n        canViewSellingPrice,\r\n        canViewTotalSales,\r\n        canViewTotalGrossProfit,\r\n        canViewTotalExpenses,\r\n        canViewInventoryValue,\r\n        canViewSalesTypes,\r\n        canViewAvgPrice,\r\n        canViewTotalAmount,\r\n        canManageFinanceAccounts,\r\n        canViewFinance,\r\n        canViewExpenses,\r\n        canCreateExpenses,\r\n        canEditExpenses,\r\n        canDeleteExpenses,\r\n        formatFinancial,\r\n    };\r\n};\r\n"],"names":[],"mappings":";;;;AAAA;;;AAKO,MAAM,yBAAyB;;IAClC,MAAM,EAAE,aAAa,EAAE,GAAG,IAAA,oJAAW;IAErC,MAAM,mBAAmB,cAAc,aAAa;IACpD,MAAM,gBAAgB,cAAc,aAAa;IACjD,MAAM,sBAAsB,cAAc,aAAa;IAEvD,iCAAiC;IACjC,MAAM,oBAAoB,cAAc,aAAa;IACrD,MAAM,0BAA0B,cAAc,aAAa;IAC3D,MAAM,uBAAuB,cAAc,aAAa;IACxD,MAAM,wBAAwB,cAAc,aAAa;IACzD,MAAM,oBAAoB,cAAc,aAAa;IACrD,MAAM,kBAAkB,cAAc,aAAa;IACnD,MAAM,qBAAqB,cAAc,aAAa;IAEtD,mCAAmC;IACnC,MAAM,2BAA2B,cAAc,WAAW;IAC1D,MAAM,iBAAiB,cAAc,WAAW;IAChD,MAAM,kBAAkB,cAAc,YAAY;IAClD,MAAM,oBAAoB,cAAc,YAAY;IACpD,MAAM,kBAAkB,cAAc,YAAY;IAClD,MAAM,oBAAoB,cAAc,YAAY;IAEpD;;KAEC,GACD,MAAM,kBAAkB,CAAC,OAAkC;QACvD,MAAM,YACF,AAAC,SAAS,UAAU,oBACnB,SAAS,aAAa,uBACtB,SAAS,YAAY;QAE1B,IAAI,CAAC,WAAW;YACZ,OAAO;QACX;QAEA,OAAO,OAAO,oBAAoB;IACtC;IAEA,OAAO;QACH;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;IACJ;AACJ;GA3Da;;QACiB,oJAAW"}},
    {"offset": {"line": 2011, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/SalesGoalTracker.tsx"],"sourcesContent":["import React, { useState, useEffect, useMemo } from \"react\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Progress } from \"@/components/ui/progress\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\r\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useAuth } from \"@/components/auth/AuthProvider\";\r\nimport { useBusiness } from \"@/contexts/BusinessContext\";\r\nimport { useBusinessSettings } from \"@/hooks/useBusinessSettings\";\r\nimport { toast } from \"sonner\";\r\nimport { startOfDay, endOfDay, startOfWeek, endOfWeek, startOfMonth, endOfMonth, format } from \"date-fns\";\r\nimport BusinessGoalsTip from \"@/components/BusinessGoalsTip\";\r\nimport { useFinancialVisibility } from \"@/hooks/useFinancialVisibility\";\r\n\r\ntype GoalType = 'daily' | 'weekly' | 'monthly';\r\n\r\ninterface GoalContentProps {\r\n  goalType: GoalType;\r\n  isLoading: boolean;\r\n  currentGoal: number;\r\n  currentSales: number;\r\n  progress: number;\r\n  periodLabel: string;\r\n  formatCurrency: (amount: number) => string;\r\n  goalInput: string;\r\n  onGoalInputChange: (e: React.ChangeEvent<HTMLInputElement>) => void;\r\n  onUpdateGoal: () => void;\r\n  isUpdating: boolean;\r\n  canViewTotalSales?: boolean;\r\n}\r\n\r\nconst GoalContent = React.memo<GoalContentProps>(({\r\n  goalType,\r\n  isLoading,\r\n  currentGoal,\r\n  currentSales,\r\n  progress,\r\n  periodLabel,\r\n  formatCurrency,\r\n  goalInput,\r\n  onGoalInputChange,\r\n  onUpdateGoal,\r\n  isUpdating,\r\n  canViewTotalSales = true\r\n}) => <div className=\"space-y-4\">\r\n    <div className=\"text-sm text-muted-foreground\">{periodLabel}</div>\r\n\r\n    {isLoading ? <div className=\"text-center py-4\">\r\n      <p className=\"text-muted-foreground\">Loading sales data...</p>\r\n    </div> : <>\r\n      <div className=\"flex items-center justify-between\">\r\n        <span className=\"text-sm font-medium\">{goalType.charAt(0).toUpperCase() + goalType.slice(1)} Goal</span>\r\n        <span className=\"text-sm font-bold\">{canViewTotalSales ? formatCurrency(currentGoal) : '•••'}</span>\r\n      </div>\r\n\r\n      <div className=\"flex items-center justify-between\">\r\n        <span className=\"text-sm font-medium\">Current Sales</span>\r\n        <span className=\"text-sm font-bold\">{canViewTotalSales ? formatCurrency(currentSales || 0) : '•••'}</span>\r\n      </div>\r\n\r\n      <div className=\"space-y-2\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <span className=\"text-sm font-medium\">Progress</span>\r\n          <span className=\"text-sm font-bold\">{progress.toFixed(1)}%</span>\r\n        </div>\r\n        <Progress value={progress} className=\"h-2\" />\r\n      </div>\r\n\r\n      <div className=\"space-y-2\">\r\n        <div className=\"flex gap-2\">\r\n          <Input key={`${goalType}-input`} type=\"number\" placeholder={`Enter ${goalType} goal amount`} value={goalInput} onChange={onGoalInputChange} min=\"0\" step=\"0.01\" className=\"flex-1\" />\r\n          <Button onClick={onUpdateGoal} disabled={isUpdating || !goalInput.trim()}>\r\n            {isUpdating ? \"Updating...\" : \"Set Goal\"}\r\n          </Button>\r\n        </div>\r\n      </div>\r\n\r\n      {currentGoal > 0 && <div className=\"text-xs text-muted-foreground\">\r\n        {currentSales >= currentGoal ? <span className=\"text-green-600 font-medium\">🎉 Goal achieved!</span> : <span>\r\n          {canViewTotalSales ? `${formatCurrency(currentGoal - (currentSales || 0))} remaining to reach goal` : '••• remaining'}\r\n        </span>}\r\n      </div>}\r\n    </>}\r\n  </div>);\r\n\r\nGoalContent.displayName = 'GoalContent';\r\n\r\nconst SalesGoalTracker = () => {\r\n  const {\r\n    user\r\n  } = useAuth();\r\n  const {\r\n    currentBusiness\r\n  } = useBusiness();\r\n  const {\r\n    settings\r\n  } = useBusinessSettings();\r\n  const { canViewTotalSales } = useFinancialVisibility();\r\n  const queryClient = useQueryClient();\r\n\r\n  // Make date values reactive instead of static\r\n  const [currentDate] = useState(() => new Date());\r\n  const currentMonth = currentDate.getMonth() + 1;\r\n  const currentYear = currentDate.getFullYear();\r\n  const [goalInput, setGoalInput] = useState(\"\");\r\n  const [selectedGoalType, setSelectedGoalType] = useState<GoalType>('monthly');\r\n\r\n  // Clear goal input when business changes\r\n  useEffect(() => {\r\n    setGoalInput(\"\");\r\n  }, [currentBusiness?.id]);\r\n\r\n  // Fetch current sales goal with proper dependency array\r\n  const {\r\n    data: salesGoal,\r\n    isLoading: goalLoading\r\n  } = useQuery({\r\n    queryKey: [\"sales-goal\", user?.id, currentBusiness?.id, currentMonth, currentYear],\r\n    queryFn: async () => {\r\n      if (!user?.id || !currentBusiness?.id) return null;\r\n\r\n      const {\r\n        data,\r\n        error\r\n      } = await supabase.from(\"sales_goals\").select(\"*\").eq(\"user_id\", user.id).eq(\"location_id\", currentBusiness.id).eq(\"month\", currentMonth).eq(\"year\", currentYear).maybeSingle();\r\n      if (error) {\r\n        console.error(\"Error fetching sales goal:\", error);\r\n        throw error;\r\n      }\r\n      return data;\r\n    },\r\n    enabled: !!user?.id && !!currentBusiness?.id,\r\n    staleTime: 30000 // Cache for 30 seconds\r\n  });\r\n\r\n  // Fetch current period sales based on selected goal type\r\n  const {\r\n    data: currentSales,\r\n    isLoading: salesLoading\r\n  } = useQuery({\r\n    queryKey: [\"current-period-sales\", user?.id, currentBusiness?.id, selectedGoalType, currentMonth, currentYear],\r\n    queryFn: async () => {\r\n      if (!user?.id || !currentBusiness?.id) return 0;\r\n\r\n      // Calculate date range based on selected goal type\r\n      let startDate: Date, endDate: Date;\r\n      switch (selectedGoalType) {\r\n        case 'daily':\r\n          startDate = startOfDay(currentDate);\r\n          endDate = endOfDay(currentDate);\r\n          break;\r\n        case 'weekly':\r\n          startDate = startOfWeek(currentDate, { weekStartsOn: 1 });\r\n          endDate = endOfWeek(currentDate, { weekStartsOn: 1 });\r\n          break;\r\n        case 'monthly':\r\n          startDate = startOfMonth(currentDate);\r\n          endDate = endOfMonth(currentDate);\r\n          break;\r\n      }\r\n\r\n      // Load all sales with chunked pagination\r\n      let allSales: any[] = [];\r\n      let paginationStart = 0;\r\n      const chunkSize = 1000;\r\n      let hasMore = true;\r\n\r\n      while (hasMore) {\r\n        const { data: chunk, error: chunkError } = await supabase\r\n          .from(\"sales\")\r\n          .select(\"items\")\r\n          .eq(\"user_id\", user.id)\r\n          .eq(\"location_id\", currentBusiness.id)\r\n          .gte(\"date\", startDate.toISOString())\r\n          .lte(\"date\", endDate.toISOString())\r\n          .neq(\"payment_status\", \"Quote\")\r\n          .range(paginationStart, paginationStart + chunkSize - 1);\r\n\r\n        if (chunkError) {\r\n          console.error(\"Error fetching sales chunk:\", chunkError);\r\n          throw chunkError;\r\n        }\r\n\r\n        if (chunk && chunk.length > 0) {\r\n          allSales.push(...chunk);\r\n          paginationStart += chunkSize;\r\n          hasMore = chunk.length === chunkSize;\r\n        } else {\r\n          hasMore = false;\r\n        }\r\n      }\r\n\r\n      const total = allSales.reduce((sum, sale) => {\r\n        const items = Array.isArray(sale.items) ? sale.items : [];\r\n        const saleTotal = items.reduce((itemSum: number, item: any) => {\r\n          const price = typeof item.price === 'number' ? item.price : 0;\r\n          const quantity = typeof item.quantity === 'number' ? item.quantity : 0;\r\n          return itemSum + price * quantity;\r\n        }, 0);\r\n        const validSaleTotal = typeof saleTotal === 'number' ? saleTotal : 0;\r\n        return sum + validSaleTotal;\r\n      }, 0);\r\n      return total;\r\n    },\r\n    enabled: !!user?.id && !!currentBusiness?.id,\r\n    staleTime: 30000 // Cache for 30 seconds\r\n  });\r\n\r\n  // Update sales goal mutation with the correct constraint name\r\n  const updateGoalMutation = useMutation({\r\n    mutationFn: async ({\r\n      goalType,\r\n      amount\r\n    }: {\r\n      goalType: GoalType;\r\n      amount: number;\r\n    }) => {\r\n      if (!user?.id || !currentBusiness?.id) {\r\n        throw new Error(\"User or location not available\");\r\n      }\r\n\r\n      // Prepare the goal data - preserve existing values when updating\r\n      const baseData = {\r\n        user_id: user.id,\r\n        location_id: currentBusiness.id,\r\n        month: currentMonth,\r\n        year: currentYear,\r\n        updated_at: new Date().toISOString()\r\n      };\r\n\r\n      // Build the goal data with only the specific goal type being updated\r\n      const goalData = {\r\n        ...baseData,\r\n        daily_goal: goalType === 'daily' ? amount : salesGoal?.daily_goal || 0,\r\n        weekly_goal: goalType === 'weekly' ? amount : salesGoal?.weekly_goal || 0,\r\n        monthly_goal: goalType === 'monthly' ? amount : salesGoal?.monthly_goal || 0\r\n      };\r\n\r\n      // Use UPSERT with the correct constraint name that allows per-location goals\r\n      const {\r\n        data,\r\n        error\r\n      } = await supabase.from(\"sales_goals\").upsert(goalData, {\r\n        onConflict: 'user_id,location_id,month,year',\r\n        ignoreDuplicates: false\r\n      }).select().single();\r\n      if (error) {\r\n        console.error(\"Error upserting sales goal:\", error);\r\n        throw error;\r\n      }\r\n      return data;\r\n    },\r\n    onSuccess: data => {\r\n      toast.success(`${selectedGoalType.charAt(0).toUpperCase() + selectedGoalType.slice(1)} goal updated successfully!`);\r\n\r\n      // Invalidate and refetch queries\r\n      queryClient.invalidateQueries({\r\n        queryKey: [\"sales-goal\", user?.id, currentBusiness?.id, currentMonth, currentYear]\r\n      });\r\n      queryClient.invalidateQueries({\r\n        queryKey: [\"current-period-sales\", user?.id, currentBusiness?.id, selectedGoalType, currentMonth, currentYear]\r\n      });\r\n      setGoalInput(\"\");\r\n    },\r\n    onError: (error: any) => {\r\n      console.error(\"Failed to update sales goal:\", error);\r\n\r\n      // Provide more specific error messages\r\n      let errorMessage = \"Failed to update sales goal. Please try again.\";\r\n      if (error.message?.includes(\"permission denied\") || error.message?.includes(\"policy\")) {\r\n        errorMessage = \"Permission denied. Please ensure you have access to modify goals for this business.\";\r\n      } else if (error.message?.includes(\"unique constraint\") || error.code === \"23505\") {\r\n        errorMessage = \"Failed to update goal. Please refresh the page and try again.\";\r\n      } else if (error.message?.includes(\"location_id\")) {\r\n        errorMessage = \"Invalid business location. Please select a valid business.\";\r\n      } else if (error.message?.includes(\"violates\")) {\r\n        errorMessage = \"Database constraint violation. Please contact support if this persists.\";\r\n      }\r\n      toast.error(errorMessage);\r\n    }\r\n  });\r\n\r\n  const handleGoalInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const value = e.target.value;\r\n\r\n    // Allow empty string, numbers, and decimal points\r\n    if (value === \"\" || /^\\d*\\.?\\d*$/.test(value)) {\r\n      setGoalInput(value);\r\n    }\r\n  };\r\n\r\n  const handleUpdateGoal = () => {\r\n    const goal = parseFloat(goalInput);\r\n    if (isNaN(goal) || goal < 0) {\r\n      toast.error(\"Please enter a valid goal amount\");\r\n      return;\r\n    }\r\n    updateGoalMutation.mutate({\r\n      goalType: selectedGoalType,\r\n      amount: goal\r\n    });\r\n  };\r\n\r\n  const handleTabChange = (value: string) => {\r\n    setSelectedGoalType(value as GoalType);\r\n  };\r\n\r\n  // Get current goal based on selected type\r\n  const getCurrentGoal = () => {\r\n    if (!salesGoal) return 0;\r\n    switch (selectedGoalType) {\r\n      case 'daily':\r\n        return salesGoal.daily_goal || 0;\r\n      case 'weekly':\r\n        return salesGoal.weekly_goal || 0;\r\n      case 'monthly':\r\n        return salesGoal.monthly_goal || 0;\r\n      default:\r\n        return 0;\r\n    }\r\n  };\r\n\r\n  const currentGoal = getCurrentGoal();\r\n  const progress = useMemo(() =>\r\n    currentGoal > 0 ? Math.min((currentSales || 0) / currentGoal * 100, 100) : 0,\r\n    [currentGoal, currentSales]\r\n  );\r\n  const isLoading = goalLoading || salesLoading;\r\n\r\n  // Memoize period label\r\n  const periodLabel = useMemo(() => {\r\n    switch (selectedGoalType) {\r\n      case 'daily':\r\n        return format(currentDate, 'MMMM d, yyyy');\r\n      case 'weekly':\r\n        return `Week of ${format(startOfWeek(currentDate, {\r\n          weekStartsOn: 1\r\n        }), 'MMM d')}`;\r\n      case 'monthly':\r\n        return format(currentDate, 'MMMM yyyy');\r\n      default:\r\n        return '';\r\n    }\r\n  }, [selectedGoalType, currentDate]);\r\n\r\n  const formatCurrency = useMemo(() => (amount: number) => {\r\n    return new Intl.NumberFormat('en-US', {\r\n      style: 'currency',\r\n      currency: settings?.currency || 'USD',\r\n      minimumFractionDigits: 0,\r\n      maximumFractionDigits: 2\r\n    }).format(amount);\r\n  }, [settings?.currency]);\r\n\r\n  // Early return after all hooks have been called\r\n  if (!user || !currentBusiness) {\r\n    return <Card>\r\n      <CardHeader>\r\n        <CardTitle>Sales Goal Tracker</CardTitle>\r\n      </CardHeader>\r\n      <CardContent>\r\n        <p className=\"text-muted-foreground\">Please select a business location to track sales goals.</p>\r\n      </CardContent>\r\n    </Card>;\r\n  }\r\n\r\n  return <Card>\r\n    <CardHeader>\r\n      <CardTitle>Gonza Sales Goal Tracker</CardTitle>\r\n      <div className=\"text-sm text-muted-foreground\">\r\n        Business: {currentBusiness.name}\r\n      </div>\r\n    </CardHeader>\r\n    <CardContent>\r\n      <Tabs value={selectedGoalType} onValueChange={handleTabChange}>\r\n        <TabsList className=\"grid w-full grid-cols-3\">\r\n          <TabsTrigger value=\"daily\">Daily</TabsTrigger>\r\n          <TabsTrigger value=\"weekly\">Weekly</TabsTrigger>\r\n          <TabsTrigger value=\"monthly\">Monthly</TabsTrigger>\r\n        </TabsList>\r\n\r\n        <TabsContent value=\"daily\">\r\n          <GoalContent goalType=\"daily\" isLoading={isLoading} currentGoal={currentGoal} currentSales={currentSales || 0} progress={progress} periodLabel={periodLabel} formatCurrency={formatCurrency} goalInput={goalInput} onGoalInputChange={handleGoalInputChange} onUpdateGoal={handleUpdateGoal} isUpdating={updateGoalMutation.isPending} canViewTotalSales={canViewTotalSales} />\r\n        </TabsContent>\r\n\r\n        <TabsContent value=\"weekly\">\r\n          <GoalContent goalType=\"weekly\" isLoading={isLoading} currentGoal={currentGoal} currentSales={currentSales || 0} progress={progress} periodLabel={periodLabel} formatCurrency={formatCurrency} goalInput={goalInput} onGoalInputChange={handleGoalInputChange} onUpdateGoal={handleUpdateGoal} isUpdating={updateGoalMutation.isPending} canViewTotalSales={canViewTotalSales} />\r\n        </TabsContent>\r\n\r\n        <TabsContent value=\"monthly\">\r\n          <GoalContent goalType=\"monthly\" isLoading={isLoading} currentGoal={currentGoal} currentSales={currentSales || 0} progress={progress} periodLabel={periodLabel} formatCurrency={formatCurrency} goalInput={goalInput} onGoalInputChange={handleGoalInputChange} onUpdateGoal={handleUpdateGoal} isUpdating={updateGoalMutation.isPending} canViewTotalSales={canViewTotalSales} />\r\n        </TabsContent>\r\n      </Tabs>\r\n\r\n      {/* Add Business Goals Tip */}\r\n      <BusinessGoalsTip />\r\n    </CardContent>\r\n  </Card>;\r\n};\r\n\r\nexport default SalesGoalTracker;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2751, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/analytics/RecentSalesTable.tsx"],"sourcesContent":["\r\nimport React from 'react';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Sale } from '@/types';\r\nimport { formatNumber } from '@/lib/utils';\r\nimport { useIsMobile } from '@/hooks/use-mobile';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport {\r\n  Tooltip,\r\n  TooltipContent,\r\n  TooltipProvider,\r\n  TooltipTrigger,\r\n} from \"@/components/ui/tooltip\";\r\nimport { useFinancialVisibility } from '@/hooks/useFinancialVisibility';\r\n\r\ninterface RecentSalesTableProps {\r\n  recentSales: Sale[];\r\n  currency: string;\r\n}\r\n\r\nconst RecentSalesTable: React.FC<RecentSalesTableProps> = ({ recentSales, currency }) => {\r\n  const isMobile = useIsMobile();\r\n  const navigate = useNavigate();\r\n  const {\r\n    canViewCostPrice,\r\n    canViewProfit,\r\n    canViewAvgPrice,\r\n    canViewTotalAmount\r\n  } = useFinancialVisibility();\r\n\r\n  const handleSaleClick = (sale: Sale) => {\r\n    navigate('/new-sale', {\r\n      state: {\r\n        editSale: sale\r\n      }\r\n    });\r\n  };\r\n\r\n  if (recentSales.length === 0) {\r\n    return (\r\n      <Card>\r\n        <CardHeader className={isMobile ? 'p-4' : ''}>\r\n          <CardTitle className={isMobile ? 'text-lg' : ''}>Recent Sales</CardTitle>\r\n          <CardDescription className={isMobile ? 'text-xs' : ''}>Your latest transactions</CardDescription>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"py-12 text-center\">\r\n            <p className=\"text-muted-foreground\">No recent sales</p>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    );\r\n  }\r\n\r\n  // For mobile view, render cards instead of a table\r\n  if (isMobile) {\r\n    return (\r\n      <Card>\r\n        <CardHeader className=\"p-4\">\r\n          <CardTitle className=\"text-lg\">Recent Sales</CardTitle>\r\n          <CardDescription className=\"text-xs\">Your latest transactions</CardDescription>\r\n        </CardHeader>\r\n        <CardContent className=\"p-4 pt-0\">\r\n          <div className=\"space-y-3\">\r\n            {recentSales.map((sale) => {\r\n              // Calculate subtotal from items with discount considerations\r\n              const subtotal = sale.items.reduce((total, item) => {\r\n                const itemSubtotal = item.price * item.quantity;\r\n                const discountAmount = (itemSubtotal * (item.discountPercentage || 0)) / 100;\r\n                return total + (itemSubtotal - discountAmount);\r\n              }, 0);\r\n\r\n              // Calculate total discount amount\r\n              const totalDiscount = sale.items.reduce((total, item) => {\r\n                const itemSubtotal = item.price * item.quantity;\r\n                const discountAmount = (itemSubtotal * (item.discountPercentage || 0)) / 100;\r\n                return total + discountAmount;\r\n              }, 0);\r\n\r\n              // Calculate tax amount based on subtotal and tax rate\r\n              const taxRate = sale.taxRate || 0;\r\n              const taxAmount = subtotal * (taxRate / 100);\r\n\r\n              // Total including tax\r\n              const saleTotal = subtotal + taxAmount;\r\n\r\n              // Calculate total cost for the sale\r\n              const totalCost = sale.items && Array.isArray(sale.items)\r\n                ? sale.items.reduce((sum, item) => sum + (item.cost * item.quantity), 0)\r\n                : 0;\r\n\r\n              // Get primary item description (or combination)\r\n              let itemDescription = \"No items\";\r\n              if (sale.items && Array.isArray(sale.items) && sale.items.length > 0) {\r\n                itemDescription = sale.items[0].description;\r\n                if (sale.items.length > 1) {\r\n                  itemDescription += ` (+${sale.items.length - 1} more)`;\r\n                }\r\n              }\r\n\r\n              return (\r\n                <div\r\n                  key={sale.id}\r\n                  className=\"bg-white p-4 rounded-lg border border-gray-200 shadow-sm cursor-pointer hover:shadow-md transition-shadow\"\r\n                  onClick={() => handleSaleClick(sale)}\r\n                >\r\n                  <div className=\"flex justify-between items-start mb-3\">\r\n                    <div className=\"flex-1 min-w-0\">\r\n                      <p className=\"font-semibold text-gray-900 text-base truncate\">{sale.customerName}</p>\r\n                      <Tooltip>\r\n                        <TooltipTrigger asChild>\r\n                          <p className=\"text-sm text-gray-600 mt-1 line-clamp-1 cursor-help\">\r\n                            {itemDescription}\r\n                          </p>\r\n                        </TooltipTrigger>\r\n                        <TooltipContent side=\"top\" className=\"max-w-xs\">\r\n                          <div className=\"space-y-1\">\r\n                            <p className=\"font-bold break-words whitespace-normal\">{itemDescription}</p>\r\n                          </div>\r\n                        </TooltipContent>\r\n                      </Tooltip>\r\n                    </div>\r\n                    <span\r\n                      className={`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium whitespace-nowrap ml-2 ${sale.paymentStatus === 'Paid'\r\n                        ? 'bg-green-100 text-green-800'\r\n                        : sale.paymentStatus === 'Quote'\r\n                          ? 'bg-purple-100 text-purple-800'\r\n                          : sale.paymentStatus === 'Installment Sale'\r\n                            ? 'bg-blue-100 text-blue-800'\r\n                            : 'bg-yellow-100 text-yellow-800'\r\n                        }`}\r\n                    >\r\n                      {sale.paymentStatus === 'NOT PAID' ? 'Credit' :\r\n                        sale.paymentStatus === 'Installment Sale' ? 'Installment' :\r\n                          sale.paymentStatus}\r\n                    </span>\r\n                  </div>\r\n\r\n                  {/* Financial data in organized grid */}\r\n                  <div className=\"grid grid-cols-2 gap-4 py-3 bg-gray-50 rounded-lg mb-3\">\r\n                    <div className=\"text-center border-r border-gray-200\">\r\n                      <p className=\"text-xs text-gray-500 mb-1\">Cost</p>\r\n                      <p className=\"text-sm font-semibold text-gray-900\">\r\n                        {canViewCostPrice ? `${currency} ${formatNumber(totalCost)}` : '•••'}\r\n                      </p>\r\n                    </div>\r\n                    <div className=\"text-center\">\r\n                      <p className=\"text-xs text-gray-500 mb-1\">Discount</p>\r\n                      <p className={`text-sm font-semibold ${totalDiscount > 0 ? 'text-orange-600' : 'text-gray-400'}`}>\r\n                        {totalDiscount > 0 ? `-${currency} ${formatNumber(totalDiscount)}` : '-'}\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div className=\"grid grid-cols-2 gap-4 py-3 bg-gray-50 rounded-lg\">\r\n                    <div className=\"text-center border-r border-gray-200\">\r\n                      <p className=\"text-xs text-gray-500 mb-1\">Avg Price</p>\r\n                      <p className=\"text-sm font-semibold text-gray-900\">\r\n                        {canViewAvgPrice ? `${currency} ${formatNumber(saleTotal / sale.items.reduce((total, item) => total + item.quantity, 0))}` : '•••'}\r\n                      </p>\r\n                    </div>\r\n                    <div className=\"text-center\">\r\n                      <p className=\"text-xs text-gray-500 mb-1\">Total Amount</p>\r\n                      <p className=\"text-sm font-semibold text-gray-900\">\r\n                        {canViewTotalAmount ? `${currency} ${formatNumber(saleTotal)}` : '•••'}\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Profit and date row */}\r\n                  <div className=\"flex justify-between items-center mt-3 pt-2 border-t border-gray-100\">\r\n                    <div className=\"text-left\">\r\n                      <p className=\"text-xs text-gray-500\">Profit</p>\r\n                      <p className=\"text-sm font-semibold text-green-600\">\r\n                        {canViewProfit ? `${currency} ${formatNumber(saleTotal - totalCost)}` : '•••'}\r\n                      </p>\r\n                    </div>\r\n                    <div className=\"text-right\">\r\n                      <p className=\"text-xs text-gray-500\">\r\n                        {new Date(sale.date).toLocaleDateString('en-GB')}\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              );\r\n            })}\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    );\r\n  }\r\n\r\n  // Desktop view with table\r\n  return (\r\n    <TooltipProvider>\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle>Recent Sales</CardTitle>\r\n          <CardDescription>Your latest 20 transactions</CardDescription>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"overflow-x-auto\">\r\n            <table className=\"w-full text-sm\">\r\n              <thead>\r\n                <tr className=\"border-b\">\r\n                  <th className=\"py-3 text-left\">Date</th>\r\n                  <th className=\"py-3 text-left\">Receipt #</th>\r\n                  <th className=\"py-3 text-left\">Customer</th>\r\n                  <th className=\"py-3 text-left\">Item</th>\r\n                  <th className=\"py-3 text-right\">Total Qty</th>\r\n                  <th className=\"py-3 text-right\">Avg Price</th>\r\n                  <th className=\"py-3 text-right\">Discount</th>\r\n                  {canViewCostPrice && <th className=\"py-3 text-right\">Cost</th>}\r\n                  {canViewProfit && <th className=\"py-3 text-right\">Profit</th>}\r\n                  <th className=\"py-3 text-right\">Total (incl. Tax)</th>\r\n                  <th className=\"py-3 text-left\">Status</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {recentSales.map((sale) => {\r\n                  // Calculate total quantity\r\n                  const totalQuantity = sale.items.reduce((total, item) => total + item.quantity, 0);\r\n                  // Calculate subtotal from items with discount considerations\r\n                  const subtotal = sale.items.reduce((total, item) => {\r\n                    const itemSubtotal = item.price * item.quantity;\r\n                    const discountAmount = (itemSubtotal * (item.discountPercentage || 0)) / 100;\r\n                    return total + (itemSubtotal - discountAmount);\r\n                  }, 0);\r\n\r\n                  const averagePrice = totalQuantity > 0 ? subtotal / totalQuantity : 0;\r\n\r\n                  // Calculate total discount amount\r\n                  const totalDiscount = sale.items.reduce((total, item) => {\r\n                    const itemSubtotal = item.price * item.quantity;\r\n                    const discountAmount = (itemSubtotal * (item.discountPercentage || 0)) / 100;\r\n                    return total + discountAmount;\r\n                  }, 0);\r\n\r\n                  // Calculate tax amount based on subtotal and tax rate\r\n                  const taxRate = sale.taxRate || 0;\r\n                  const taxAmount = subtotal * (taxRate / 100);\r\n\r\n                  // Total including tax\r\n                  const saleTotal = subtotal + taxAmount;\r\n\r\n                  // Calculate total cost\r\n                  const totalCost = sale.items.reduce((total, item) => total + (item.cost * item.quantity), 0);\r\n\r\n                  // Get primary item description (or combination)\r\n                  let itemDescription = \"No items\";\r\n                  if (sale.items && Array.isArray(sale.items) && sale.items.length > 0) {\r\n                    itemDescription = sale.items[0].description;\r\n                    if (sale.items.length > 1) {\r\n                      itemDescription += ` (+${sale.items.length - 1} more)`;\r\n                    }\r\n                  }\r\n\r\n                  return (\r\n                    <tr\r\n                      key={sale.id}\r\n                      className=\"border-b cursor-pointer hover:bg-gray-50\"\r\n                      onClick={() => handleSaleClick(sale)}\r\n                    >\r\n                      <td className=\"py-3\">\r\n                        {new Date(sale.date).toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' })}\r\n                      </td>\r\n                      <td className=\"py-3\">{sale.receiptNumber}</td>\r\n                      <td className=\"py-3\">{sale.customerName}</td>\r\n                      <td className=\"py-3 max-w-xs truncate\">\r\n                        <Tooltip>\r\n                          <TooltipTrigger asChild>\r\n                            <span className=\"cursor-help\">{itemDescription}</span>\r\n                          </TooltipTrigger>\r\n                          <TooltipContent side=\"top\" className=\"max-w-xs\">\r\n                            <div className=\"space-y-1\">\r\n                              <p className=\"font-bold break-words whitespace-normal\">{itemDescription}</p>\r\n                            </div>\r\n                          </TooltipContent>\r\n                        </Tooltip>\r\n                      </td>\r\n                      <td className=\"py-3 text-right\">{totalQuantity}</td>\r\n                      <td className=\"py-3 text-right\">\r\n                        {canViewAvgPrice ? `${currency} ${formatNumber(averagePrice)}` : '•••'}\r\n                      </td>\r\n                      <td className=\"py-3 text-right\">\r\n                        {totalDiscount > 0 ? (\r\n                          <span className=\"text-orange-600\">\r\n                            -{currency} {formatNumber(totalDiscount)}\r\n                          </span>\r\n                        ) : (\r\n                          <span className=\"text-gray-400\">-</span>\r\n                        )}\r\n                      </td>\r\n                      {canViewCostPrice && (\r\n                        <td className=\"py-3 text-right\">\r\n                          {currency} {formatNumber(totalCost)}\r\n                        </td>\r\n                      )}\r\n                      {canViewProfit && (\r\n                        <td className=\"py-3 text-right\">\r\n                          <span className=\"text-green-600 font-medium\">\r\n                            {currency} {formatNumber(saleTotal - totalCost)}\r\n                          </span>\r\n                        </td>\r\n                      )}\r\n                      <td className=\"py-3 text-right\">\r\n                        {canViewTotalAmount ? (\r\n                          <>\r\n                            {currency} {formatNumber(saleTotal)}\r\n                            {sale.paymentStatus === 'Installment Sale' && sale.amountPaid && (\r\n                              <div className=\"text-xs text-green-600\">\r\n                                Paid: {currency} {formatNumber(sale.amountPaid)}\r\n                              </div>\r\n                            )}\r\n                          </>\r\n                        ) : '•••'}\r\n                      </td>\r\n                      <td className=\"py-3\">\r\n                        <span\r\n                          className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${sale.paymentStatus === 'Paid'\r\n                            ? 'bg-green-100 text-green-800'\r\n                            : sale.paymentStatus === 'Quote'\r\n                              ? 'bg-purple-100 text-purple-800'\r\n                              : sale.paymentStatus === 'Installment Sale'\r\n                                ? 'bg-blue-100 text-blue-800'\r\n                                : 'bg-yellow-100 text-yellow-800'\r\n                            }`}\r\n                        >\r\n                          {sale.paymentStatus === 'NOT PAID' ? 'Credit' :\r\n                            sale.paymentStatus === 'Installment Sale' ? 'Installment' :\r\n                              sale.paymentStatus}\r\n                        </span>\r\n                      </td>\r\n                    </tr>\r\n                  )\r\n                })}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    </TooltipProvider>\r\n  );\r\n};\r\n\r\nexport default RecentSalesTable;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3600, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/analytics/SalesPerformanceChart.tsx"],"sourcesContent":["\r\nimport React, { useState, useEffect } from 'react';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Tabs, TabsList, TabsTrigger, TabsContent } from '@/components/ui/tabs';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport {\r\n  LineChart,\r\n  Line,\r\n  XAxis,\r\n  YAxis,\r\n  CartesianGrid,\r\n  Tooltip,\r\n  Legend,\r\n  ResponsiveContainer\r\n} from 'recharts';\r\nimport { Lock as LockIcon } from 'lucide-react';\r\nimport { Sale } from '@/types';\r\nimport { ChartContainer, ChartTooltip } from '@/components/ui/chart';\r\nimport {\r\n  format,\r\n  startOfWeek,\r\n  endOfWeek,\r\n  startOfMonth,\r\n  endOfMonth,\r\n  startOfYear,\r\n  endOfYear,\r\n  subDays,\r\n  subWeeks,\r\n  subMonths,\r\n  startOfDay,\r\n  endOfDay\r\n} from 'date-fns';\r\nimport { ChartLine } from 'lucide-react';\r\nimport { supabase } from '@/integrations/supabase/client';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\nimport { useFinancialVisibility } from '@/hooks/useFinancialVisibility';\r\n\r\ninterface SalesPerformanceChartProps {\r\n  sales: Sale[];\r\n  formatCurrency: (value: any) => string;\r\n  dateFilter?: string;\r\n  dateRange?: { from: Date | undefined; to: Date | undefined; };\r\n  isCustomRange?: boolean;\r\n}\r\n\r\ninterface DataPoint {\r\n  date: string;\r\n  displayDate: string;\r\n  amount: number;\r\n  expenses: number;\r\n  rawDate: Date;\r\n}\r\n\r\nconst SalesPerformanceChart: React.FC<SalesPerformanceChartProps> = ({\r\n  sales,\r\n  formatCurrency,\r\n  dateFilter = 'this-month',\r\n  dateRange = { from: undefined, to: undefined },\r\n  isCustomRange = false\r\n}) => {\r\n  const { currentBusiness } = useBusiness();\r\n  const { canViewTotalSales, canViewTotalExpenses } = useFinancialVisibility();\r\n  const [timeFrame, setTimeFrame] = useState('monthly');\r\n  const [yearFilter, setYearFilter] = useState(new Date().getFullYear().toString());\r\n  const [expensesData, setExpensesData] = useState<Array<{ date: string, amount: number }>>([]);\r\n\r\n  // Calculate current year and available years for filtering\r\n  const currentYear = new Date().getFullYear();\r\n  const years = Array.from(\r\n    new Set(\r\n      sales.map(sale => new Date(sale.date).getFullYear())\r\n    )\r\n  ).sort((a, b) => b - a); // Sort descending (most recent first)\r\n\r\n  // If no years found (no sales), add current year\r\n  if (years.length === 0) {\r\n    years.push(currentYear);\r\n  }\r\n\r\n  // Filter sales based on the date filter\r\n  const getFilteredSales = () => {\r\n    // First filter sales to exclude quotes\r\n    const nonQuoteSales = sales.filter(sale => sale.paymentStatus !== 'Quote');\r\n\r\n    // For performance chart, show full year by default unless specific filters are applied\r\n    if (isCustomRange && dateRange.from && dateRange.to) {\r\n      return nonQuoteSales.filter(sale => {\r\n        const saleDate = new Date(sale.date);\r\n        return saleDate >= startOfDay(dateRange.from) && saleDate <= endOfDay(dateRange.to);\r\n      });\r\n    } else if (dateFilter && dateFilter !== 'all' && dateFilter !== 'this-month') {\r\n      // Only apply specific date filters (not the default 'this-month')\r\n      const today = new Date();\r\n\r\n      return nonQuoteSales.filter(sale => {\r\n        const saleDate = new Date(sale.date);\r\n\r\n        switch (dateFilter) {\r\n          case 'today':\r\n            return saleDate >= startOfDay(today) && saleDate <= endOfDay(today);\r\n          case 'yesterday':\r\n            const yesterday = subDays(today, 1);\r\n            return saleDate >= startOfDay(yesterday) && saleDate <= endOfDay(yesterday);\r\n          case 'this-week':\r\n            return saleDate >= startOfWeek(today, { weekStartsOn: 1 }) &&\r\n              saleDate <= endOfWeek(today, { weekStartsOn: 1 });\r\n          case 'last-week':\r\n            const lastWeekStart = subWeeks(startOfWeek(today, { weekStartsOn: 1 }), 1);\r\n            const lastWeekEnd = endOfWeek(lastWeekStart, { weekStartsOn: 1 });\r\n            return saleDate >= lastWeekStart && saleDate <= lastWeekEnd;\r\n          case 'last-month':\r\n            const lastMonth = subMonths(today, 1);\r\n            return saleDate >= startOfMonth(lastMonth) && saleDate <= endOfMonth(lastMonth);\r\n          case 'this-year':\r\n            return saleDate >= startOfYear(today) && saleDate <= endOfYear(today);\r\n          default:\r\n            return true;\r\n        }\r\n      });\r\n    }\r\n\r\n    // Default: Filter by selected year for the chart (show full year)\r\n    return nonQuoteSales.filter(sale => {\r\n      const saleDate = new Date(sale.date);\r\n      return saleDate.getFullYear() === parseInt(yearFilter);\r\n    });\r\n  };\r\n\r\n  // Fetch expenses data when timeframe or year changes or date filter changes\r\n  useEffect(() => {\r\n    const fetchExpenses = async () => {\r\n      try {\r\n        // Return early if no business is selected\r\n        if (!currentBusiness?.id) {\r\n          setExpensesData([]);\r\n          return;\r\n        }\r\n\r\n        let query = supabase\r\n          .from('expenses')\r\n          .select('date, amount')\r\n          .eq('location_id', currentBusiness.id);\r\n\r\n        // Apply the same filtering as sales - show full year by default\r\n        if (isCustomRange && dateRange.from && dateRange.to) {\r\n          query = query\r\n            .gte('date', dateRange.from.toISOString())\r\n            .lte('date', dateRange.to.toISOString());\r\n        } else if (dateFilter && dateFilter !== 'all' && dateFilter !== 'this-month') {\r\n          // Only apply specific date filters (not the default 'this-month')\r\n          const today = new Date();\r\n\r\n          switch (dateFilter) {\r\n            case 'today':\r\n              query = query.gte('date', startOfDay(today).toISOString())\r\n                .lte('date', endOfDay(today).toISOString());\r\n              break;\r\n            case 'yesterday':\r\n              const yesterday = subDays(today, 1);\r\n              query = query.gte('date', startOfDay(yesterday).toISOString())\r\n                .lte('date', endOfDay(yesterday).toISOString());\r\n              break;\r\n            case 'this-week':\r\n              query = query.gte('date', startOfWeek(today, { weekStartsOn: 1 }).toISOString())\r\n                .lte('date', endOfWeek(today, { weekStartsOn: 1 }).toISOString());\r\n              break;\r\n            case 'last-week':\r\n              const lastWeekStart = subWeeks(startOfWeek(today, { weekStartsOn: 1 }), 1);\r\n              const lastWeekEnd = endOfWeek(lastWeekStart, { weekStartsOn: 1 });\r\n              query = query.gte('date', lastWeekStart.toISOString())\r\n                .lte('date', lastWeekEnd.toISOString());\r\n              break;\r\n            case 'last-month':\r\n              const lastMonth = subMonths(today, 1);\r\n              query = query.gte('date', startOfMonth(lastMonth).toISOString())\r\n                .lte('date', endOfMonth(lastMonth).toISOString());\r\n              break;\r\n            case 'this-year':\r\n              query = query.gte('date', startOfYear(today).toISOString())\r\n                .lte('date', endOfYear(today).toISOString());\r\n              break;\r\n            default:\r\n              // Default case - show full year\r\n              const selectedYear = parseInt(yearFilter);\r\n              const startDate = new Date(selectedYear, 0, 1); // Jan 1\r\n              const endDate = new Date(selectedYear, 11, 31); // Dec 31\r\n\r\n              query = query\r\n                .gte('date', startDate.toISOString())\r\n                .lte('date', endDate.toISOString());\r\n          }\r\n        } else {\r\n          // Default: show full year for the selected year\r\n          const selectedYear = parseInt(yearFilter);\r\n          const startDate = new Date(selectedYear, 0, 1); // Jan 1\r\n          const endDate = new Date(selectedYear, 11, 31); // Dec 31\r\n\r\n          query = query\r\n            .gte('date', startDate.toISOString())\r\n            .lte('date', endDate.toISOString());\r\n        }\r\n\r\n        const { data, error } = await query;\r\n\r\n        if (error) {\r\n          console.error('Error fetching expenses:', error);\r\n          return;\r\n        }\r\n\r\n        // Convert to format needed for chart\r\n        setExpensesData(data || []);\r\n      } catch (error) {\r\n        console.error('Error fetching expenses data:', error);\r\n      }\r\n    };\r\n\r\n    fetchExpenses();\r\n  }, [timeFrame, yearFilter, dateFilter, dateRange, isCustomRange, currentBusiness?.id]);\r\n\r\n  // Prepare data for the chart based on the selected time frame\r\n  const prepareChartData = () => {\r\n    const filteredSales = getFilteredSales();\r\n\r\n    if (timeFrame === 'weekly') {\r\n      // Get the start and end of the current week\r\n      const now = new Date();\r\n      const weekStart = startOfWeek(now, { weekStartsOn: 1 }); // Monday\r\n      const weekEnd = endOfWeek(now, { weekStartsOn: 1 }); // Sunday\r\n\r\n      // Group by day of the week\r\n      const dailyData: DataPoint[] = [];\r\n\r\n      // Create an array of all days in the week\r\n      for (let i = 0; i < 7; i++) {\r\n        const day = new Date(weekStart);\r\n        day.setDate(weekStart.getDate() + i);\r\n\r\n        // Filter sales for this day\r\n        const salesOnDay = filteredSales.filter(sale => {\r\n          const saleDate = new Date(sale.date);\r\n          return saleDate.toDateString() === day.toDateString();\r\n        });\r\n\r\n        // Calculate total sales amount for this day\r\n        const totalAmount = salesOnDay.reduce((sum, sale) => {\r\n          const saleTotalAmount = sale.items && Array.isArray(sale.items)\r\n            ? sale.items.reduce((itemSum, item) => itemSum + (item.price * item.quantity), 0)\r\n            : 0;\r\n          return sum + saleTotalAmount;\r\n        }, 0);\r\n\r\n        // Filter expenses for this day\r\n        const expensesOnDay = expensesData.filter(expense => {\r\n          const expenseDate = new Date(expense.date);\r\n          return expenseDate.toDateString() === day.toDateString();\r\n        });\r\n\r\n        // Calculate total expenses for this day\r\n        const totalExpenses = expensesOnDay.reduce((sum, expense) => sum + Number(expense.amount), 0);\r\n\r\n        // Format date for display and as key\r\n        const displayDate = format(day, 'EEE');\r\n        const dateStr = format(day, 'yyyy-MM-dd');\r\n\r\n        dailyData.push({\r\n          date: dateStr,\r\n          displayDate: displayDate,\r\n          amount: totalAmount,\r\n          expenses: totalExpenses,\r\n          rawDate: new Date(day)\r\n        });\r\n      }\r\n\r\n      return dailyData;\r\n    }\r\n    else if (timeFrame === 'monthly') {\r\n      // Group by month\r\n      const monthlyData: DataPoint[] = [];\r\n      const selectedYear = parseInt(yearFilter);\r\n\r\n      // Create array for all 12 months\r\n      for (let month = 0; month < 12; month++) {\r\n        const date = new Date(selectedYear, month, 1);\r\n        const monthStart = startOfMonth(date);\r\n        const monthEnd = endOfMonth(date);\r\n\r\n        // Filter sales for this month\r\n        const salesInMonth = filteredSales.filter(sale => {\r\n          const saleDate = new Date(sale.date);\r\n          return saleDate >= monthStart && saleDate <= monthEnd;\r\n        });\r\n\r\n        // Calculate total sales amount for this month\r\n        const totalAmount = salesInMonth.reduce((sum, sale) => {\r\n          const saleTotalAmount = sale.items && Array.isArray(sale.items)\r\n            ? sale.items.reduce((itemSum, item) => itemSum + (item.price * item.quantity), 0)\r\n            : 0;\r\n          return sum + saleTotalAmount;\r\n        }, 0);\r\n\r\n        // Filter expenses for this month\r\n        const expensesInMonth = expensesData.filter(expense => {\r\n          const expenseDate = new Date(expense.date);\r\n          return expenseDate >= monthStart && expenseDate <= monthEnd;\r\n        });\r\n\r\n        // Calculate total expenses for this month\r\n        const totalExpenses = expensesInMonth.reduce((sum, expense) => sum + Number(expense.amount), 0);\r\n\r\n        // Format date for display and as key\r\n        const displayDate = format(date, 'MMM');\r\n        const dateStr = format(date, 'yyyy-MM');\r\n\r\n        monthlyData.push({\r\n          date: dateStr,\r\n          displayDate: displayDate,\r\n          amount: totalAmount,\r\n          expenses: totalExpenses,\r\n          rawDate: new Date(date)\r\n        });\r\n      }\r\n\r\n      return monthlyData;\r\n    }\r\n    else if (timeFrame === 'yearly') {\r\n      // Group by year\r\n      const yearlyData: DataPoint[] = [];\r\n\r\n      // Use the available years from sales data\r\n      for (const year of years) {\r\n        const yearStart = startOfYear(new Date(year, 0, 1));\r\n        const yearEnd = endOfYear(new Date(year, 0, 1));\r\n\r\n        // Filter sales for this year\r\n        const salesInThisYear = filteredSales.filter(sale => {\r\n          const saleDate = new Date(sale.date);\r\n          return saleDate >= yearStart && saleDate <= yearEnd;\r\n        });\r\n\r\n        // Calculate total sales amount for this year\r\n        const totalAmount = salesInThisYear.reduce((sum, sale) => {\r\n          const saleTotalAmount = sale.items && Array.isArray(sale.items)\r\n            ? sale.items.reduce((itemSum, item) => itemSum + (item.price * item.quantity), 0)\r\n            : 0;\r\n          return sum + saleTotalAmount;\r\n        }, 0);\r\n\r\n        // Filter expenses for this year\r\n        const expensesInYear = expensesData.filter(expense => {\r\n          const expenseDate = new Date(expense.date);\r\n          return expenseDate >= yearStart && expenseDate <= yearEnd;\r\n        });\r\n\r\n        // Calculate total expenses for this year\r\n        const totalExpenses = expensesInYear.reduce((sum, expense) => sum + Number(expense.amount), 0);\r\n\r\n        // Format date for display and as key\r\n        yearlyData.push({\r\n          date: year.toString(),\r\n          displayDate: year.toString(),\r\n          amount: totalAmount,\r\n          expenses: totalExpenses,\r\n          rawDate: new Date(year, 0, 1)\r\n        });\r\n      }\r\n\r\n      return yearlyData;\r\n    }\r\n\r\n    // Default: if no valid timeframe is selected\r\n    return [];\r\n  };\r\n\r\n  const chartData = prepareChartData();\r\n\r\n  // Custom tooltip component for the chart\r\n  const CustomTooltip = ({ active, payload, label }: any) => {\r\n    if (active && payload && payload.length) {\r\n      const dataPoint = payload[0].payload;\r\n      return (\r\n        <div className=\"bg-white p-3 border border-gray-200 shadow-sm rounded-md\">\r\n          <p className=\"font-medium text-sm\">{dataPoint.displayDate}</p>\r\n          {payload.map((entry: any, index: number) => (\r\n            <p key={`tooltip-${index}`} className=\"text-sm\">\r\n              <span className=\"font-medium\">{entry.name}: </span>\r\n              <span>{formatCurrency(entry.value)}</span>\r\n            </p>\r\n          ))}\r\n        </div>\r\n      );\r\n    }\r\n    return null;\r\n  };\r\n\r\n  return (\r\n    <Card className=\"mb-6\">\r\n      <CardHeader>\r\n        <div className=\"flex items-center justify-between\">\r\n          <div>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <ChartLine className=\"h-5 w-5\" /> Performance Analysis\r\n            </CardTitle>\r\n            <CardDescription>Visualize your sales and expenses over time</CardDescription>\r\n          </div>\r\n\r\n          <div className=\"flex items-center gap-2\">\r\n            <Select value={yearFilter} onValueChange={setYearFilter}>\r\n              <SelectTrigger className=\"w-[100px]\">\r\n                <SelectValue placeholder=\"Year\" />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                {years.map((year) => (\r\n                  <SelectItem key={year} value={year.toString()}>\r\n                    {year}\r\n                  </SelectItem>\r\n                ))}\r\n              </SelectContent>\r\n            </Select>\r\n          </div>\r\n        </div>\r\n      </CardHeader>\r\n\r\n      <CardContent>\r\n        <Tabs defaultValue=\"monthly\" value={timeFrame} onValueChange={setTimeFrame} className=\"w-full\">\r\n          <TabsList className=\"mb-4\">\r\n            <TabsTrigger value=\"weekly\">Weekly</TabsTrigger>\r\n            <TabsTrigger value=\"monthly\">Monthly</TabsTrigger>\r\n            <TabsTrigger value=\"yearly\">Yearly</TabsTrigger>\r\n          </TabsList>\r\n\r\n          <div className=\"h-[300px] w-full\">\r\n            {(!canViewTotalSales && !canViewTotalExpenses) ? (\r\n              <div className=\"flex flex-col items-center justify-center h-full text-muted-foreground space-y-2\">\r\n                <LockIcon className=\"h-8 w-8 opacity-20\" />\r\n                <p>Private data restricted</p>\r\n              </div>\r\n            ) : chartData && chartData.length > 0 ? (\r\n              <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                <LineChart\r\n                  data={chartData}\r\n                  margin={{ top: 20, right: 20, left: 30, bottom: 20 }}\r\n                >\r\n                  <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#f0f0f0\" />\r\n                  <XAxis\r\n                    dataKey=\"displayDate\"\r\n                    tick={{ fontSize: 12 }}\r\n                    tickLine={false}\r\n                    axisLine={{ stroke: '#e0e0e0' }}\r\n                  />\r\n                  <YAxis\r\n                    tickFormatter={(value) => formatCurrency(value)}\r\n                    tick={{ fontSize: 12 }}\r\n                    tickLine={false}\r\n                    axisLine={{ stroke: '#e0e0e0' }}\r\n                    width={80}\r\n                  />\r\n                  <Tooltip content={<CustomTooltip />} />\r\n                  <Legend />\r\n                  {canViewTotalSales && (\r\n                    <Line\r\n                      type=\"monotone\"\r\n                      dataKey=\"amount\"\r\n                      name=\"Sales\"\r\n                      stroke=\"#9b87f5\"\r\n                      activeDot={{ r: 8 }}\r\n                      strokeWidth={2}\r\n                    />\r\n                  )}\r\n\r\n                  {canViewTotalExpenses && (\r\n                    <Line\r\n                      type=\"monotone\"\r\n                      dataKey=\"expenses\"\r\n                      name=\"Expenses\"\r\n                      stroke=\"#E76F51\"\r\n                      activeDot={{ r: 6 }}\r\n                      strokeWidth={2}\r\n                    />\r\n                  )}\r\n                </LineChart>\r\n              </ResponsiveContainer>\r\n            ) : (\r\n              <div className=\"flex items-center justify-center h-full text-muted-foreground\">\r\n                No data available for this time period\r\n              </div>\r\n            )}\r\n          </div>\r\n        </Tabs>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default SalesPerformanceChart;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4285, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/types/index.ts"],"sourcesContent":["// Sale item type definition\r\nexport interface SaleItem {\r\n  description: string;\r\n  quantity: number;\r\n  price: number;\r\n  cost: number;\r\n  productId?: string;\r\n  discountPercentage?: number;\r\n  discountType?: 'percentage' | 'amount';\r\n  discountAmount?: number;\r\n}\r\n\r\nexport interface SalesCategory {\r\n  id: string;\r\n  user_id: string;\r\n  location_id?: string;\r\n  name: string;\r\n  is_default: boolean;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface Sale {\r\n  id: string;\r\n  receiptNumber: string;\r\n  customerName: string;\r\n  customerAddress?: string;\r\n  customerContact?: string;\r\n  customerId?: string;\r\n  items: SaleItem[];\r\n  paymentStatus: 'Paid' | 'NOT PAID' | 'Quote' | 'Installment Sale';\r\n  profit: number;\r\n  date: Date;\r\n  taxRate?: number;\r\n  cashTransactionId?: string;\r\n  amountPaid?: number;\r\n  amountDue?: number;\r\n  notes?: string;\r\n  categoryId?: string;\r\n  installments?: Array<{\r\n    date?: string | Date;\r\n    amountPaid?: number;\r\n  }>;\r\n  createdAt: Date;\r\n}\r\n\r\n// Supabase database schema and Json type\r\nexport type Json =\r\n  | string\r\n  | number\r\n  | boolean\r\n  | null\r\n  | { [key: string]: Json | undefined }\r\n  | Json[];\r\n\r\n// Supabase database sale structure\r\nexport interface DbSale {\r\n  id: string;\r\n  user_id: string;\r\n  location_id: string;\r\n  receipt_number: string;\r\n  customer_name: string;\r\n  customer_address?: string | null;\r\n  customer_contact?: string | null;\r\n  customer_id?: string | null;\r\n  items: Json;\r\n  payment_status: string;\r\n  profit: number;\r\n  date: string;\r\n  tax_rate?: number | null;\r\n  created_at: string;\r\n  updated_at: string;\r\n  cash_transaction_id?: string | null;\r\n  amount_paid?: number | null;\r\n  amount_due?: number | null;\r\n  notes?: string | null;\r\n  category_id?: string | null;\r\n}\r\n\r\n// Expense interface - add cashTransactionId field\r\nexport interface Expense {\r\n  id: string;\r\n  amount: number;\r\n  description: string;\r\n  category: string | null;\r\n  date: Date;\r\n  paymentMethod: string | null;\r\n  personInCharge: string | null;\r\n  receiptImage: string | null;\r\n  cashAccountId: string | null;\r\n  cashTransactionId: string | null; // Add this field\r\n  createdAt: Date;\r\n  updatedAt: Date;\r\n}\r\n\r\n// Supabase database expense structure\r\nexport interface DbExpense {\r\n  id: string;\r\n  user_id: string;\r\n  amount: number;\r\n  description: string;\r\n  category: string | null;\r\n  date: string;\r\n  payment_method: string | null;\r\n  person_in_charge: string | null;\r\n  receipt_image: string | null;\r\n  cash_account_id: string | null;\r\n  cash_transaction_id: string | null; // Add this field\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface SaleFormData {\r\n  customerName: string;\r\n  customerAddress: string;\r\n  customerContact: string;\r\n  customerId?: string; // Added customerId field\r\n  items: SaleItem[];\r\n  paymentStatus: \"Paid\" | \"NOT PAID\" | \"Quote\" | \"Installment Sale\";\r\n  receiptNumber?: string;\r\n  taxRate?: number | null;\r\n  amountPaid?: number;\r\n  amountDue?: number;\r\n  notes?: string;\r\n  categoryId?: string;\r\n}\r\n\r\n// Analytics data type\r\nexport interface AnalyticsData {\r\n  totalSales: number;\r\n  totalProfit: number;\r\n  totalCost: number;\r\n  paidSalesCount: number;\r\n  pendingSalesCount: number;\r\n}\r\n\r\n// Form validation errors\r\nexport interface FormErrors {\r\n  customerName?: string;\r\n  customerAddress?: string;\r\n  customerContact?: string;\r\n  itemDescription?: string;\r\n  quantity?: string;\r\n  salePrice?: string;\r\n  costOfProduction?: string;\r\n  taxRate?: string;\r\n}\r\n\r\n// BusinessSettings interface to include paymentInfo\r\nexport interface BusinessSettings {\r\n  businessName: string;\r\n  businessAddress: string;\r\n  businessPhone: string;\r\n  businessEmail: string;\r\n  businessLogo?: string;\r\n  currency: string;\r\n  signature?: string;\r\n  paymentInfo?: string; // Added payment information field\r\n  defaultPrintFormat?: 'standard' | 'thermal'; // Added default print format\r\n  defaultPrinterName?: string; // Added default printer name\r\n  defaultPrinterType?: 'USB' | 'Bluetooth'; // Added default printer type\r\n}\r\n\r\n// Database business settings structure\r\nexport interface DbBusinessSettings {\r\n  id?: string;\r\n  user_id: string; // Make sure this is required, not optional\r\n  business_name: string;\r\n  business_address: string;\r\n  business_phone: string;\r\n  business_email: string;\r\n  business_logo?: string;\r\n  currency: string;\r\n  signature?: string;\r\n  metadata?: Json | null; // Add metadata field\r\n  created_at?: string;\r\n  updated_at?: string;\r\n}\r\n\r\n// Updated UserProfile interface to match the Supabase database structure\r\nexport interface UserProfile {\r\n  id: string;\r\n  full_name: string | null;\r\n  display_name: string | null;\r\n  avatar_url: string | null;\r\n  created_at: string | null;\r\n  updated_at: string | null;\r\n}\r\n\r\n// New interfaces for Product management - ADDED itemNumber\r\nexport interface Product {\r\n  id: string;\r\n  itemNumber: string; // Added item number field\r\n  barcode: string | null; // Added barcode field\r\n  manufacturerBarcode: string | null; // Added manufacturer barcode field\r\n  name: string;\r\n  description: string | null;\r\n  category: string;\r\n  quantity: number;\r\n  costPrice: number;\r\n  sellingPrice: number;\r\n  supplier: string | null;\r\n  imageUrl: string | null;\r\n  minimumStock: number;\r\n  createdAt: Date;\r\n  updatedAt: Date;\r\n}\r\n\r\nexport interface DbProduct {\r\n  id: string;\r\n  user_id: string;\r\n  item_number: string; // Added item number field\r\n  barcode: string | null; // Added barcode field\r\n  manufacturer_barcode: string | null; // Added manufacturer barcode field\r\n  name: string;\r\n  description: string | null;\r\n  category: string;\r\n  quantity: number;\r\n  cost_price: number;\r\n  selling_price: number;\r\n  supplier: string | null;\r\n  image_url: string | null;\r\n  minimum_stock: number;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface ProductFormData {\r\n  name: string;\r\n  barcode?: string; // Added barcode field\r\n  manufacturerBarcode?: string; // Added manufacturer barcode field\r\n  description?: string;\r\n  category?: string;\r\n  quantity: number; // Always a number, never undefined\r\n  costPrice?: number;\r\n  sellingPrice?: number;\r\n  supplier?: string;\r\n  minimumStock?: number;\r\n  imageFile?: File | null;\r\n  imageUrl?: string | null;\r\n  createdAt?: Date; // Added created date field\r\n}\r\n\r\nexport interface ProductCategory {\r\n  id: string;\r\n  name: string;\r\n}\r\n\r\nexport interface DbProductCategory {\r\n  id: string;\r\n  user_id: string;\r\n  name: string;\r\n  created_at: string;\r\n}\r\n\r\nexport interface StockHistoryEntry {\r\n  id: string;\r\n  productId: string;\r\n  oldQuantity: number;\r\n  newQuantity: number;\r\n  changeReason: string;\r\n  referenceId?: string | null;\r\n  receiptNumber?: string;\r\n  createdAt: Date;\r\n  product?: {\r\n    name: string;\r\n    costPrice: number;\r\n    sellingPrice: number;\r\n    itemNumber: string;\r\n  };\r\n}\r\n\r\nexport interface DbStockHistoryEntry {\r\n  id: string;\r\n  user_id: string;\r\n  product_id: string;\r\n  previous_quantity: number;\r\n  new_quantity: number;\r\n  change_reason: string;\r\n  reference_id?: string | null;\r\n  created_at: string;\r\n}\r\n\r\nexport interface ProductFilters {\r\n  search: string;\r\n  category: string;\r\n  stockStatus: 'all' | 'inStock' | 'lowStock' | 'outOfStock';\r\n}\r\n\r\n// Customer management types\r\nexport interface Customer {\r\n  id: string;\r\n  fullName: string;\r\n  email: string | null;\r\n  phoneNumber: string | null;\r\n  birthday: Date | null;\r\n  location: string | null;\r\n  categoryId: string | null; // Added category relationship\r\n  socialMedia: {\r\n    facebook?: string;\r\n    instagram?: string;\r\n    twitter?: string;\r\n    linkedin?: string;\r\n    other?: string;\r\n  } | null;\r\n  gender: string | null;\r\n  tags: string[] | null;\r\n  notes: string | null;\r\n  createdAt: Date;\r\n  updatedAt: Date;\r\n}\r\n\r\nexport interface DbCustomer {\r\n  id: string;\r\n  user_id: string;\r\n  full_name: string;\r\n  email: string | null;\r\n  phone_number: string | null;\r\n  birthday: string | null;\r\n  location: string | null;\r\n  category_id: string | null; // Added category relationship\r\n  social_media: Json | null;\r\n  gender: string | null;\r\n  tags: string[] | null;\r\n  notes: string | null;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface CustomerFormData {\r\n  fullName: string;\r\n  email: string;\r\n  phoneNumber: string;\r\n  birthday: Date | null;\r\n  location: string;\r\n  categoryId: string | null; // Added category field\r\n  socialMedia: {\r\n    facebook?: string;\r\n    instagram?: string;\r\n    twitter?: string;\r\n    linkedin?: string;\r\n    other?: string;\r\n  };\r\n  gender: string;\r\n  tags: string[];\r\n  notes: string;\r\n}\r\n\r\n// Utility functions for database conversions\r\nexport const mapDbSaleToSale = (dbSale: DbSale): Sale => {\r\n  // Parse items and ensure numeric fields are numbers, not strings\r\n  // This is critical for discount calculations to work correctly\r\n  const items = (Array.isArray(dbSale.items) ? dbSale.items : []).map((item: any) => {\r\n    const discountPercentage = item.discountPercentage !== undefined ? Number(item.discountPercentage) : undefined;\r\n    const discountAmount = item.discountAmount !== undefined ? Number(item.discountAmount) : undefined;\r\n\r\n    // Infer discountType if missing (for legacy data)\r\n    let discountType = item.discountType as 'percentage' | 'amount' | undefined;\r\n    if (!discountType) {\r\n      if (discountPercentage && discountPercentage > 0) {\r\n        discountType = 'percentage';\r\n      } else if (discountAmount && discountAmount > 0) {\r\n        discountType = 'amount';\r\n      }\r\n    }\r\n\r\n    return {\r\n      description: item.description || '',\r\n      quantity: Number(item.quantity) || 0,\r\n      price: Number(item.price) || 0,\r\n      cost: Number(item.cost) || 0,\r\n      productId: item.productId || undefined,\r\n      discountType,\r\n      discountPercentage,\r\n      discountAmount,\r\n      createdAt: item.createdAt || undefined,\r\n    };\r\n  }) as SaleItem[];\r\n\r\n  return {\r\n    id: dbSale.id,\r\n    receiptNumber: dbSale.receipt_number,\r\n    customerName: dbSale.customer_name,\r\n    customerAddress: dbSale.customer_address || '',\r\n    customerContact: dbSale.customer_contact || '',\r\n    customerId: dbSale.customer_id || undefined,\r\n    items,\r\n    paymentStatus: dbSale.payment_status as 'Paid' | 'NOT PAID' | 'Quote' | 'Installment Sale',\r\n    profit: Number(dbSale.profit),\r\n    date: new Date(dbSale.date),\r\n    taxRate: dbSale.tax_rate ? Number(dbSale.tax_rate) : 0,\r\n    cashTransactionId: dbSale.cash_transaction_id || undefined,\r\n    amountPaid: dbSale.amount_paid ? Number(dbSale.amount_paid) : undefined,\r\n    amountDue: dbSale.amount_due ? Number(dbSale.amount_due) : undefined,\r\n    notes: dbSale.notes || '',\r\n    categoryId: dbSale.category_id || undefined,\r\n    createdAt: new Date(dbSale.created_at),\r\n  };\r\n};\r\n\r\nexport const mapSaleToDbSale = (\r\n  saleData: SaleFormData,\r\n  selectedDate: Date,\r\n  profit: number,\r\n  receiptNumber: string,\r\n  userId: string,\r\n  locationId: string,\r\n  cashTransactionId?: string | null\r\n): Omit<DbSale, 'id' | 'created_at' | 'updated_at'> => {\r\n  return {\r\n    user_id: userId,\r\n    location_id: locationId,\r\n    receipt_number: receiptNumber,\r\n    customer_name: saleData.customerName,\r\n    customer_address: saleData.customerAddress || null,\r\n    customer_contact: saleData.customerContact || null,\r\n    customer_id: saleData.customerId || null, // Include customer_id\r\n    items: (saleData.items as unknown) as Json,\r\n    payment_status: saleData.paymentStatus,\r\n    profit: profit,\r\n    date: selectedDate.toISOString().split('T')[0],\r\n    tax_rate: saleData.taxRate || 0,\r\n    cash_transaction_id: cashTransactionId || null,\r\n    amount_paid: saleData.amountPaid || null,\r\n    amount_due: saleData.amountDue || null,\r\n    notes: saleData.notes || null,\r\n    category_id: saleData.categoryId || null,\r\n  };\r\n};\r\n\r\n// Conversion functions for business settings\r\nexport const mapDbBusinessSettingsToBusinessSettings = (dbSettings: DbBusinessSettings): BusinessSettings => {\r\n  return {\r\n    businessName: dbSettings.business_name,\r\n    businessAddress: dbSettings.business_address,\r\n    businessPhone: dbSettings.business_phone,\r\n    businessEmail: dbSettings.business_email,\r\n    businessLogo: dbSettings.business_logo,\r\n    currency: dbSettings.currency,\r\n    signature: dbSettings.signature,\r\n    paymentInfo: dbSettings.metadata && typeof dbSettings.metadata === 'object' ?\r\n      (dbSettings.metadata as Record<string, unknown>).payment_info as string || '' : '',\r\n    defaultPrintFormat: dbSettings.metadata && typeof dbSettings.metadata === 'object' ?\r\n      (dbSettings.metadata as Record<string, unknown>).default_print_format as 'standard' | 'thermal' || 'standard' : 'standard',\r\n    defaultPrinterName: dbSettings.metadata && typeof dbSettings.metadata === 'object' ?\r\n      (dbSettings.metadata as Record<string, unknown>).default_printer_name as string || '' : '',\r\n    defaultPrinterType: dbSettings.metadata && typeof dbSettings.metadata === 'object' ?\r\n      (dbSettings.metadata as Record<string, unknown>).default_printer_type as 'USB' | 'Bluetooth' || 'USB' : 'USB'\r\n  };\r\n};\r\n\r\nexport const mapBusinessSettingsToDbBusinessSettings = (\r\n  settings: BusinessSettings,\r\n  userId: string\r\n): DbBusinessSettings => {\r\n  // Create metadata object with payment_info\r\n  const metadata: Json = {\r\n    payment_info: settings.paymentInfo || '',\r\n    default_print_format: settings.defaultPrintFormat || 'standard',\r\n    default_printer_name: settings.defaultPrinterName || '',\r\n    default_printer_type: settings.defaultPrinterType || 'USB'\r\n  };\r\n\r\n  return {\r\n    user_id: userId,\r\n    business_name: settings.businessName,\r\n    business_address: settings.businessAddress,\r\n    business_phone: settings.businessPhone,\r\n    business_email: settings.businessEmail,\r\n    business_logo: settings.businessLogo,\r\n    currency: settings.currency,\r\n    signature: settings.signature,\r\n    metadata: metadata, // Include metadata in the return object\r\n    updated_at: new Date().toISOString()\r\n  };\r\n};\r\n\r\n// Conversion functions for products and categories - ADDED itemNumber\r\nexport const mapDbProductToProduct = (dbProduct: DbProduct): Product => {\r\n  return {\r\n    id: dbProduct.id,\r\n    itemNumber: dbProduct.item_number, // Added item number mapping\r\n    barcode: dbProduct.barcode, // Added barcode mapping\r\n    manufacturerBarcode: dbProduct.manufacturer_barcode, // Added manufacturer barcode mapping\r\n    name: dbProduct.name,\r\n    description: dbProduct.description,\r\n    category: dbProduct.category,\r\n    quantity: dbProduct.quantity,\r\n    costPrice: Number(dbProduct.cost_price),\r\n    sellingPrice: Number(dbProduct.selling_price),\r\n    supplier: dbProduct.supplier,\r\n    imageUrl: dbProduct.image_url,\r\n    minimumStock: dbProduct.minimum_stock,\r\n    createdAt: new Date(dbProduct.created_at),\r\n    updatedAt: new Date(dbProduct.updated_at)\r\n  };\r\n};\r\n\r\nexport const mapProductToDbProduct = (product: Partial<Product>, userId: string): Partial<DbProduct> => {\r\n  const result: Partial<DbProduct> = {\r\n    user_id: userId\r\n  };\r\n\r\n  if (product.id) result.id = product.id;\r\n  if (product.itemNumber) result.item_number = product.itemNumber; // Added item number mapping\r\n  if (product.barcode !== undefined) result.barcode = product.barcode; // Added barcode mapping\r\n  if (product.manufacturerBarcode !== undefined) result.manufacturer_barcode = product.manufacturerBarcode; // Added manufacturer barcode mapping\r\n  if (product.name) result.name = product.name;\r\n  result.description = product.description;\r\n  if (product.category) result.category = product.category;\r\n  if (product.quantity !== undefined) result.quantity = product.quantity;\r\n  if (product.costPrice !== undefined) {\r\n    result.cost_price = product.costPrice;\r\n    console.log(`DEBUG: Mapping costPrice ${product.costPrice} to cost_price`);\r\n  }\r\n  if (product.sellingPrice !== undefined) {\r\n    result.selling_price = product.sellingPrice;\r\n    console.log(`DEBUG: Mapping sellingPrice ${product.sellingPrice} to selling_price`);\r\n  }\r\n  result.supplier = product.supplier;\r\n  result.image_url = product.imageUrl;\r\n  if (product.minimumStock !== undefined) result.minimum_stock = product.minimumStock;\r\n\r\n  return result;\r\n};\r\n\r\nexport const mapDbProductCategoryToProductCategory = (dbCategory: DbProductCategory): ProductCategory => {\r\n  return {\r\n    id: dbCategory.id,\r\n    name: dbCategory.name\r\n  };\r\n};\r\n\r\nexport const mapDbStockHistoryToStockHistory = (dbHistory: DbStockHistoryEntry): StockHistoryEntry => {\r\n  return {\r\n    id: dbHistory.id,\r\n    productId: dbHistory.product_id,\r\n    oldQuantity: dbHistory.previous_quantity,\r\n    newQuantity: dbHistory.new_quantity,\r\n    changeReason: dbHistory.change_reason,\r\n    referenceId: dbHistory.reference_id || null,\r\n    createdAt: new Date(dbHistory.created_at)\r\n  };\r\n};\r\n\r\n// Updated Customer mapping functions to include categoryId\r\nexport const mapDbCustomerToCustomer = (dbCustomer: DbCustomer): Customer => {\r\n  let birthday = null;\r\n\r\n  if (dbCustomer.birthday) {\r\n    try {\r\n      const birthdayStr = String(dbCustomer.birthday);\r\n      const [year, month, day] = birthdayStr.split('-').map(Number);\r\n\r\n      if (!isNaN(year) && !isNaN(month) && !isNaN(day)) {\r\n        birthday = new Date(Date.UTC(year, month - 1, day, 12, 0, 0));\r\n\r\n        console.log(\r\n          'Converting DB birthday to Date object:',\r\n          dbCustomer.birthday,\r\n          '→',\r\n          birthday,\r\n          '(UTC string:',\r\n          birthday.toISOString(),\r\n          ')'\r\n        );\r\n      } else {\r\n        console.error('Invalid date components in birthday:', dbCustomer.birthday);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error parsing birthday:', error, dbCustomer.birthday);\r\n    }\r\n  }\r\n\r\n  return {\r\n    id: dbCustomer.id,\r\n    fullName: dbCustomer.full_name,\r\n    email: dbCustomer.email,\r\n    phoneNumber: dbCustomer.phone_number,\r\n    birthday: birthday,\r\n    location: dbCustomer.location,\r\n    categoryId: dbCustomer.category_id, // Added category mapping\r\n    socialMedia: dbCustomer.social_media as any,\r\n    gender: dbCustomer.gender,\r\n    tags: dbCustomer.tags,\r\n    notes: dbCustomer.notes,\r\n    createdAt: new Date(dbCustomer.created_at),\r\n    updatedAt: new Date(dbCustomer.updated_at)\r\n  };\r\n};\r\n\r\nexport const mapCustomerToDbCustomer = (customer: Partial<Customer>, userId: string): Partial<DbCustomer> => {\r\n  const result: Partial<DbCustomer> = {\r\n    user_id: userId\r\n  };\r\n\r\n  if (customer.id) result.id = customer.id;\r\n  if (customer.fullName) result.full_name = customer.fullName;\r\n  result.email = customer.email;\r\n  result.phone_number = customer.phoneNumber;\r\n  if (customer.birthday) result.birthday = customer.birthday.toISOString().split('T')[0];\r\n  result.location = customer.location;\r\n  result.category_id = customer.categoryId; // Added category mapping\r\n  result.social_media = customer.socialMedia as Json;\r\n  result.gender = customer.gender;\r\n  result.tags = customer.tags;\r\n  result.notes = customer.notes;\r\n\r\n  return result;\r\n};\r\n\r\n// Conversion functions for expenses\r\nexport const mapDbExpenseToExpense = (dbExpense: DbExpense): Expense => {\r\n  return {\r\n    id: dbExpense.id,\r\n    amount: Number(dbExpense.amount),\r\n    description: dbExpense.description,\r\n    category: dbExpense.category,\r\n    date: new Date(dbExpense.date),\r\n    paymentMethod: dbExpense.payment_method,\r\n    personInCharge: dbExpense.person_in_charge,\r\n    receiptImage: dbExpense.receipt_image,\r\n    cashAccountId: dbExpense.cash_account_id,\r\n    cashTransactionId: dbExpense.cash_transaction_id,\r\n    createdAt: new Date(dbExpense.created_at),\r\n    updatedAt: new Date(dbExpense.updated_at)\r\n  };\r\n};\r\n\r\nexport const mapExpenseToDbExpense = (expense: Partial<Expense>, userId: string): Partial<DbExpense> => {\r\n  const result: Partial<DbExpense> = {\r\n    user_id: userId\r\n  };\r\n\r\n  if (expense.id) result.id = expense.id;\r\n  if (expense.amount !== undefined) result.amount = expense.amount;\r\n  if (expense.description) result.description = expense.description;\r\n  result.category = expense.category;\r\n  if (expense.date) result.date = expense.date.toISOString().split('T')[0];\r\n  result.payment_method = expense.paymentMethod;\r\n  result.person_in_charge = expense.personInCharge;\r\n  result.receipt_image = expense.receiptImage;\r\n  result.cash_account_id = expense.cashAccountId;\r\n  result.cash_transaction_id = expense.cashTransactionId;\r\n\r\n  return result;\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4565, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useProductsBase.ts"],"sourcesContent":["\r\nimport { useState, useEffect } from 'react';\r\nimport { supabase } from '@/integrations/supabase/client';\r\nimport { Product, DbProduct, mapDbProductToProduct } from '@/types';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\n\r\n/**\r\n * Base hook for fetching and storing products\r\n */\r\nexport const useProductsBase = (userId: string | undefined) => {\r\n  const [products, setProducts] = useState<Product[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const { toast } = useToast();\r\n  const { currentBusiness } = useBusiness();\r\n\r\n  const loadProducts = async () => {\r\n    try {\r\n      if (!userId || !currentBusiness) return;\r\n      \r\n      setIsLoading(true);\r\n      const { data, error } = await supabase\r\n        .from('products')\r\n        .select('*')\r\n        .eq('location_id', currentBusiness.id)\r\n        .order('created_at', { ascending: false }); // Changed to show newest first\r\n\r\n      if (error) {\r\n        throw error;\r\n      }\r\n\r\n      // Convert from DB format to frontend format\r\n      const formattedProducts: Product[] = data ? \r\n        data.map((item: any) => mapDbProductToProduct(item as DbProduct)) : [];\r\n      \r\n      setProducts(formattedProducts);\r\n      return formattedProducts;\r\n    } catch (error) {\r\n      console.error('Error loading products:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to load products. Please try again.\",\r\n        variant: \"destructive\"\r\n      });\r\n      return [];\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    loadProducts();\r\n  }, [userId, currentBusiness?.id]);\r\n\r\n  return {\r\n    products,\r\n    isLoading,\r\n    setProducts,\r\n    loadProducts\r\n  };\r\n};\r\n"],"names":[],"mappings":";;;;AACA;AACA;AACA;AACA;AACA;;;;;;;AAKO,MAAM,kBAAkB,CAAC;;IAC9B,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAY,EAAE;IACtD,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAC;IAC3C,MAAM,EAAE,KAAK,EAAE,GAAG,IAAA,2IAAQ;IAC1B,MAAM,EAAE,eAAe,EAAE,GAAG,IAAA,qJAAW;IAEvC,MAAM,eAAe;QACnB,IAAI;YACF,IAAI,CAAC,UAAU,CAAC,iBAAiB;YAEjC,aAAa;YACb,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,wJAAQ,CACnC,IAAI,CAAC,YACL,MAAM,CAAC,KACP,EAAE,CAAC,eAAe,gBAAgB,EAAE,EACpC,KAAK,CAAC,cAAc;gBAAE,WAAW;YAAM,IAAI,+BAA+B;YAE7E,IAAI,OAAO;gBACT,MAAM;YACR;YAEA,4CAA4C;YAC5C,MAAM,oBAA+B,OACnC,KAAK,GAAG,CAAC,CAAC,OAAc,IAAA,iJAAqB,EAAC,SAAsB,EAAE;YAExE,YAAY;YACZ,OAAO;QACT,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,2BAA2B;YACzC,MAAM;gBACJ,OAAO;gBACP,aAAa;gBACb,SAAS;YACX;YACA,OAAO,EAAE;QACX,SAAU;YACR,aAAa;QACf;IACF;IAEA,IAAA,0KAAS;qCAAC;YACR;QACF;oCAAG;QAAC;QAAQ,iBAAiB;KAAG;IAEhC,OAAO;QACL;QACA;QACA;QACA;IACF;AACF;GAlDa;;QAGO,2IAAQ;QACE,qJAAW"}},
    {"offset": {"line": 4640, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/AnalyticsDashboard.tsx"],"sourcesContent":["import React, { useState, useEffect, useMemo, memo } from 'react';\r\nimport { Sale, BusinessSettings, Product } from '@/types';\r\nimport { useAnalyticsData } from '@/hooks/useAnalyticsData';\r\nimport { formatNumber } from '@/lib/utils';\r\nimport { useIsMobile } from '@/hooks/use-mobile';\r\nimport DateRangeFilter from './analytics/DateRangeFilter';\r\nimport AnalyticsCards from './analytics/AnalyticsCards';\r\nimport FinancialOverview from './analytics/FinancialOverview';\r\nimport SalesGoalTracker from './SalesGoalTracker';\r\nimport RecentSalesTable from './analytics/RecentSalesTable';\r\nimport SalesPerformanceChart from './analytics/SalesPerformanceChart';\r\nimport { useProductsBase } from '@/hooks/useProductsBase';\r\nimport { useAuth } from '@/components/auth/AuthProvider';\r\nimport { useFinancialVisibility } from '@/hooks/useFinancialVisibility';\r\n\r\ninterface AnalyticsDashboardProps {\r\n  sales: Sale[];\r\n  currency?: string;\r\n}\r\n\r\nconst DEFAULT_SETTINGS: BusinessSettings = {\r\n  businessName: 'Your Business Name',\r\n  businessAddress: 'Your Business Address',\r\n  businessPhone: '(123) 456-7890',\r\n  businessEmail: 'support@yourbusiness.com',\r\n  businessLogo: '',\r\n  currency: 'UGX',\r\n};\r\n\r\nconst AnalyticsDashboard = memo<AnalyticsDashboardProps>(({ sales, currency = 'UGX' }) => {\r\n  const isMobile = useIsMobile();\r\n  const { user } = useAuth();\r\n  const [settings, setSettings] = useState<BusinessSettings>({ ...DEFAULT_SETTINGS, currency });\r\n  const [dateFilter, setDateFilter] = useState('this-month');\r\n  const [dateRange, setDateRange] = useState<{ from: Date | undefined; to: Date | undefined; }>({\r\n    from: undefined,\r\n    to: undefined,\r\n  });\r\n  const [specificDate, setSpecificDate] = useState<Date | undefined>(undefined);\r\n  const [isCustomRange, setIsCustomRange] = useState(false);\r\n  const [isSpecificDate, setIsSpecificDate] = useState(false);\r\n  const { products, isLoading: isLoadingProducts } = useProductsBase(user?.id);\r\n  const {\r\n    canViewCostPrice,\r\n    canViewTotalSales,\r\n    canViewTotalGrossProfit,\r\n    canViewTotalExpenses,\r\n    canViewInventoryValue,\r\n    canViewSalesTypes\r\n  } = useFinancialVisibility();\r\n\r\n  // Memoize inventory value calculation\r\n  const inventoryValue = useMemo(() => {\r\n    if (!products || products.length === 0) return 0;\r\n    if (!canViewCostPrice) return 0;\r\n    return products.reduce((sum, product) => sum + (product.costPrice * product.quantity), 0);\r\n  }, [products, canViewCostPrice]);\r\n\r\n  // Memoize settings update\r\n  const memoizedSettings = useMemo(() => {\r\n    const baseSettings = { ...DEFAULT_SETTINGS, currency };\r\n    const savedSettings = localStorage.getItem('businessSettings');\r\n    if (savedSettings) {\r\n      try {\r\n        const parsed = JSON.parse(savedSettings);\r\n        return { ...parsed, currency: currency || parsed.currency };\r\n      } catch {\r\n        return baseSettings;\r\n      }\r\n    }\r\n    return baseSettings;\r\n  }, [currency]);\r\n\r\n  useEffect(() => {\r\n    setSettings(memoizedSettings);\r\n  }, [memoizedSettings]);\r\n\r\n  // Memoize date filter handlers\r\n  const handleDateFilterChange = useMemo(() => (value: string) => {\r\n    setDateFilter(value);\r\n    if (value === 'custom') {\r\n      setIsCustomRange(true);\r\n      setIsSpecificDate(false);\r\n      setSpecificDate(undefined);\r\n    } else if (value === 'specific') {\r\n      setIsSpecificDate(true);\r\n      setIsCustomRange(false);\r\n      setDateRange({ from: undefined, to: undefined });\r\n    } else {\r\n      setIsCustomRange(false);\r\n      setIsSpecificDate(false);\r\n      setDateRange({ from: undefined, to: undefined });\r\n      setSpecificDate(undefined);\r\n    }\r\n  }, []);\r\n\r\n  const handleRangeSelect = useMemo(() => (range: { from: Date | undefined; to: Date | undefined; }) => {\r\n    setDateRange(range);\r\n    if (range.from && range.to) {\r\n      setIsCustomRange(true);\r\n      setDateFilter('custom');\r\n    }\r\n  }, []);\r\n\r\n  const handleSpecificDateChange = useMemo(() => (date: Date | undefined) => {\r\n    setSpecificDate(date);\r\n    if (date) {\r\n      setIsSpecificDate(true);\r\n      setDateFilter('specific');\r\n    }\r\n  }, []);\r\n\r\n  const { analyticsData, barChartData, recentSales, nonQuoteSalesCount, expenses, isLoadingExpenses } = useAnalyticsData({\r\n    sales,\r\n    dateFilter,\r\n    dateRange,\r\n    specificDate,\r\n    isCustomRange,\r\n    isSpecificDate\r\n  });\r\n\r\n  const formatCurrency = (value: any) => {\r\n    return `${settings.currency} ${formatNumber(value)}`;\r\n  };\r\n\r\n  const isLoading = isLoadingExpenses || isLoadingProducts;\r\n\r\n  return (\r\n    <div className=\"space-y-6 w-full\">\r\n      <DateRangeFilter\r\n        dateFilter={dateFilter}\r\n        dateRange={dateRange}\r\n        specificDate={specificDate}\r\n        isCustomRange={isCustomRange}\r\n        isSpecificDate={isSpecificDate}\r\n        onDateFilterChange={handleDateFilterChange}\r\n        onDateRangeChange={handleRangeSelect}\r\n        onSpecificDateChange={handleSpecificDateChange}\r\n      />\r\n\r\n      <AnalyticsCards\r\n        analyticsData={analyticsData}\r\n        nonQuoteSalesCount={nonQuoteSalesCount}\r\n        currency={settings.currency}\r\n        expenses={expenses}\r\n        inventoryValue={inventoryValue}\r\n        canViewProfit={canViewTotalGrossProfit}\r\n        canViewTotalSales={canViewTotalSales}\r\n        canViewTotalExpenses={canViewTotalExpenses}\r\n        canViewInventoryValue={canViewInventoryValue}\r\n        canViewSalesTypes={canViewSalesTypes}\r\n      />\r\n\r\n      <SalesPerformanceChart\r\n        sales={sales}\r\n        formatCurrency={formatCurrency}\r\n        dateFilter={dateFilter}\r\n        dateRange={dateRange}\r\n        isCustomRange={isCustomRange}\r\n      />\r\n\r\n      <div className=\"grid grid-cols-1 xl:grid-cols-3 gap-6\">\r\n        <div className=\"xl:col-span-2\">\r\n          <FinancialOverview\r\n            data={barChartData.filter(d => {\r\n              const name = d.name.toLowerCase();\r\n              if (name.includes('sales')) return canViewTotalSales;\r\n              if (name.includes('cost') || name.includes('expenses')) return canViewTotalExpenses;\r\n              if (name.includes('profit')) return canViewTotalGrossProfit;\r\n              return true;\r\n            })}\r\n            formatCurrency={formatCurrency}\r\n          />\r\n        </div>\r\n\r\n        <div className=\"xl:col-span-1\">\r\n          <SalesGoalTracker />\r\n        </div>\r\n      </div>\r\n\r\n      <RecentSalesTable recentSales={recentSales} currency={settings.currency} />\r\n    </div>\r\n  );\r\n});\r\n\r\nAnalyticsDashboard.displayName = 'AnalyticsDashboard';\r\n\r\nexport default AnalyticsDashboard;\r\n"],"names":[],"mappings":"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"}}]
}