{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useCashAccounts.ts"],"sourcesContent":["import { useState, useEffect, useMemo, useCallback } from 'react';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\nimport { useAuth } from '@/components/auth/AuthProvider';\r\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\r\nimport { CashAccount } from '@/types/cash';\r\nimport {\r\n  getCashAccountsAction,\r\n  createCashAccountAction,\r\n  updateCashAccountAction,\r\n  deleteCashAccountAction,\r\n  deleteCashAccountWithTransactionsAction,\r\n  getCashAccountBalanceAction\r\n} from '@/app/actions/finance';\r\n\r\nexport const useCashAccounts = () => {\r\n  const [accounts, setAccounts] = useState<CashAccount[]>([]);\r\n  const { toast } = useToast();\r\n  const { currentBusiness } = useBusiness();\r\n  const { user } = useAuth();\r\n  const queryClient = useQueryClient();\r\n\r\n  const loadAccounts = useCallback(async (): Promise<CashAccount[]> => {\r\n    if (!currentBusiness?.id) return [];\r\n\r\n    try {\r\n      const result = await getCashAccountsAction(currentBusiness.id);\r\n\r\n      if (!result.success || !result.data) {\r\n        throw new Error(result.error || 'Failed to fetch accounts');\r\n      }\r\n\r\n      return result.data.map((account: any) => ({\r\n        ...account,\r\n        createdAt: new Date(account.createdAt),\r\n        updatedAt: new Date(account.updatedAt)\r\n      }));\r\n    } catch (error) {\r\n      console.error('Error loading cash accounts:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to load cash accounts\",\r\n        variant: \"destructive\"\r\n      });\r\n      return [];\r\n    }\r\n  }, [currentBusiness?.id, toast]);\r\n\r\n  const queryKey = ['cash_accounts', currentBusiness?.id];\r\n  const { data: queriedAccounts, isLoading: isQueryLoading } = useQuery({\r\n    queryKey,\r\n    queryFn: loadAccounts,\r\n    enabled: !!currentBusiness?.id,\r\n    staleTime: 30_000,\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (queriedAccounts) {\r\n      setAccounts(queriedAccounts);\r\n    }\r\n  }, [queriedAccounts]);\r\n\r\n  const isLoading = isQueryLoading && !queriedAccounts;\r\n\r\n  const refreshAccounts = useCallback(() => {\r\n    queryClient.invalidateQueries({ queryKey });\r\n  }, [queryClient, queryKey]);\r\n\r\n  const createAccount = useCallback(async (accountData: {\r\n    name: string;\r\n    description?: string;\r\n    openingBalance: number;\r\n    isDefault?: boolean;\r\n  }) => {\r\n    if (!currentBusiness?.id || !user?.id) return null;\r\n\r\n    try {\r\n      const result = await createCashAccountAction({\r\n        ...accountData,\r\n        userId: user.id,\r\n        locationId: currentBusiness.id\r\n      });\r\n\r\n      if (!result.success || !result.data) throw new Error(result.error);\r\n\r\n      queryClient.invalidateQueries({ queryKey });\r\n      toast({\r\n        title: \"Success\",\r\n        description: \"Cash account created successfully\"\r\n      });\r\n\r\n      return result.data;\r\n    } catch (error) {\r\n      console.error('Error creating cash account:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to create cash account\",\r\n        variant: \"destructive\"\r\n      });\r\n      return null;\r\n    }\r\n  }, [currentBusiness?.id, user?.id, queryClient, queryKey, toast]);\r\n\r\n  const updateAccount = async (id: string, updates: Partial<CashAccount>) => {\r\n    if (!currentBusiness?.id) return false;\r\n\r\n    try {\r\n      const result = await updateCashAccountAction(id, {\r\n        ...updates,\r\n        locationId: currentBusiness.id\r\n      });\r\n\r\n      if (!result.success) throw new Error(result.error);\r\n\r\n      queryClient.invalidateQueries({ queryKey });\r\n      toast({\r\n        title: \"Success\",\r\n        description: \"Cash account updated successfully\"\r\n      });\r\n\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error updating cash account:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to update cash account\",\r\n        variant: \"destructive\"\r\n      });\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const deleteAccount = async (id: string, onDeleted?: () => void) => {\r\n    if (!currentBusiness?.id) return { success: false, hasTransactions: false };\r\n\r\n    try {\r\n      const result = await deleteCashAccountAction(id, currentBusiness.id);\r\n\r\n      if (result.success) {\r\n        queryClient.invalidateQueries({ queryKey });\r\n        toast({\r\n          title: \"Success\",\r\n          description: \"Cash account deleted successfully\"\r\n        });\r\n        if (onDeleted) onDeleted();\r\n      }\r\n\r\n      return result as any;\r\n    } catch (error) {\r\n      console.error('Error deleting cash account:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to delete cash account\",\r\n        variant: \"destructive\"\r\n      });\r\n      return { success: false, hasTransactions: false };\r\n    }\r\n  };\r\n\r\n  const deleteAccountWithTransactions = async (id: string, deleteTransactions: boolean = false, onDeleted?: () => void) => {\r\n    if (!currentBusiness?.id) return false;\r\n\r\n    try {\r\n      const result = await deleteCashAccountWithTransactionsAction(id, currentBusiness.id, deleteTransactions);\r\n\r\n      if (!result.success) throw new Error(result.error);\r\n\r\n      queryClient.invalidateQueries({ queryKey });\r\n      toast({\r\n        title: \"Success\",\r\n        description: deleteTransactions\r\n          ? \"Account and transactions deleted\"\r\n          : \"Account deleted (records unlinked)\"\r\n      });\r\n      if (onDeleted) onDeleted();\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error deleting cash account:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to delete cash account\",\r\n        variant: \"destructive\"\r\n      });\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const getAccountBalance = useCallback(async (accountId: string): Promise<number> => {\r\n    if (!currentBusiness?.id) return 0;\r\n    try {\r\n      const result = await getCashAccountBalanceAction(accountId, currentBusiness.id);\r\n      if (result.success) return result.data as number;\r\n      return 0;\r\n    } catch (error) {\r\n      console.error('Error getting balance:', error);\r\n      return 0;\r\n    }\r\n  }, [currentBusiness?.id]);\r\n\r\n  return useMemo(() => ({\r\n    accounts,\r\n    isLoading,\r\n    createAccount,\r\n    updateAccount,\r\n    deleteAccount,\r\n    deleteAccountWithTransactions,\r\n    getAccountBalance,\r\n    loadAccounts,\r\n    refreshAccounts\r\n  }), [accounts, isLoading, createAccount, updateAccount, deleteAccount, deleteAccountWithTransactions, getAccountBalance, loadAccounts, refreshAccounts]);\r\n};\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;AASO,MAAM,kBAAkB;;IAC7B,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAgB,EAAE;IAC1D,MAAM,EAAE,KAAK,EAAE,GAAG,IAAA,2IAAQ;IAC1B,MAAM,EAAE,eAAe,EAAE,GAAG,IAAA,qJAAW;IACvC,MAAM,EAAE,IAAI,EAAE,GAAG,IAAA,wJAAO;IACxB,MAAM,cAAc,IAAA,2MAAc;IAElC,MAAM,eAAe,IAAA,4KAAW;qDAAC;YAC/B,IAAI,CAAC,iBAAiB,IAAI,OAAO,EAAE;YAEnC,IAAI;gBACF,MAAM,SAAS,MAAM,IAAA,yLAAqB,EAAC,gBAAgB,EAAE;gBAE7D,IAAI,CAAC,OAAO,OAAO,IAAI,CAAC,OAAO,IAAI,EAAE;oBACnC,MAAM,IAAI,MAAM,OAAO,KAAK,IAAI;gBAClC;gBAEA,OAAO,OAAO,IAAI,CAAC,GAAG;iEAAC,CAAC,UAAiB,CAAC;4BACxC,GAAG,OAAO;4BACV,WAAW,IAAI,KAAK,QAAQ,SAAS;4BACrC,WAAW,IAAI,KAAK,QAAQ,SAAS;wBACvC,CAAC;;YACH,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,gCAAgC;gBAC9C,MAAM;oBACJ,OAAO;oBACP,aAAa;oBACb,SAAS;gBACX;gBACA,OAAO,EAAE;YACX;QACF;oDAAG;QAAC,iBAAiB;QAAI;KAAM;IAE/B,MAAM,WAAW;QAAC;QAAiB,iBAAiB;KAAG;IACvD,MAAM,EAAE,MAAM,eAAe,EAAE,WAAW,cAAc,EAAE,GAAG,IAAA,0LAAQ,EAAC;QACpE;QACA,SAAS;QACT,SAAS,CAAC,CAAC,iBAAiB;QAC5B,WAAW;IACb;IAEA,IAAA,0KAAS;qCAAC;YACR,IAAI,iBAAiB;gBACnB,YAAY;YACd;QACF;oCAAG;QAAC;KAAgB;IAEpB,MAAM,YAAY,kBAAkB,CAAC;IAErC,MAAM,kBAAkB,IAAA,4KAAW;wDAAC;YAClC,YAAY,iBAAiB,CAAC;gBAAE;YAAS;QAC3C;uDAAG;QAAC;QAAa;KAAS;IAE1B,MAAM,gBAAgB,IAAA,4KAAW;sDAAC,OAAO;YAMvC,IAAI,CAAC,iBAAiB,MAAM,CAAC,MAAM,IAAI,OAAO;YAE9C,IAAI;gBACF,MAAM,SAAS,MAAM,IAAA,2LAAuB,EAAC;oBAC3C,GAAG,WAAW;oBACd,QAAQ,KAAK,EAAE;oBACf,YAAY,gBAAgB,EAAE;gBAChC;gBAEA,IAAI,CAAC,OAAO,OAAO,IAAI,CAAC,OAAO,IAAI,EAAE,MAAM,IAAI,MAAM,OAAO,KAAK;gBAEjE,YAAY,iBAAiB,CAAC;oBAAE;gBAAS;gBACzC,MAAM;oBACJ,OAAO;oBACP,aAAa;gBACf;gBAEA,OAAO,OAAO,IAAI;YACpB,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,gCAAgC;gBAC9C,MAAM;oBACJ,OAAO;oBACP,aAAa;oBACb,SAAS;gBACX;gBACA,OAAO;YACT;QACF;qDAAG;QAAC,iBAAiB;QAAI,MAAM;QAAI;QAAa;QAAU;KAAM;IAEhE,MAAM,gBAAgB,OAAO,IAAY;QACvC,IAAI,CAAC,iBAAiB,IAAI,OAAO;QAEjC,IAAI;YACF,MAAM,SAAS,MAAM,IAAA,2LAAuB,EAAC,IAAI;gBAC/C,GAAG,OAAO;gBACV,YAAY,gBAAgB,EAAE;YAChC;YAEA,IAAI,CAAC,OAAO,OAAO,EAAE,MAAM,IAAI,MAAM,OAAO,KAAK;YAEjD,YAAY,iBAAiB,CAAC;gBAAE;YAAS;YACzC,MAAM;gBACJ,OAAO;gBACP,aAAa;YACf;YAEA,OAAO;QACT,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,gCAAgC;YAC9C,MAAM;gBACJ,OAAO;gBACP,aAAa;gBACb,SAAS;YACX;YACA,OAAO;QACT;IACF;IAEA,MAAM,gBAAgB,OAAO,IAAY;QACvC,IAAI,CAAC,iBAAiB,IAAI,OAAO;YAAE,SAAS;YAAO,iBAAiB;QAAM;QAE1E,IAAI;YACF,MAAM,SAAS,MAAM,IAAA,2LAAuB,EAAC,IAAI,gBAAgB,EAAE;YAEnE,IAAI,OAAO,OAAO,EAAE;gBAClB,YAAY,iBAAiB,CAAC;oBAAE;gBAAS;gBACzC,MAAM;oBACJ,OAAO;oBACP,aAAa;gBACf;gBACA,IAAI,WAAW;YACjB;YAEA,OAAO;QACT,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,gCAAgC;YAC9C,MAAM;gBACJ,OAAO;gBACP,aAAa;gBACb,SAAS;YACX;YACA,OAAO;gBAAE,SAAS;gBAAO,iBAAiB;YAAM;QAClD;IACF;IAEA,MAAM,gCAAgC,OAAO,IAAY,qBAA8B,KAAK,EAAE;QAC5F,IAAI,CAAC,iBAAiB,IAAI,OAAO;QAEjC,IAAI;YACF,MAAM,SAAS,MAAM,IAAA,2MAAuC,EAAC,IAAI,gBAAgB,EAAE,EAAE;YAErF,IAAI,CAAC,OAAO,OAAO,EAAE,MAAM,IAAI,MAAM,OAAO,KAAK;YAEjD,YAAY,iBAAiB,CAAC;gBAAE;YAAS;YACzC,MAAM;gBACJ,OAAO;gBACP,aAAa,qBACT,qCACA;YACN;YACA,IAAI,WAAW;YACf,OAAO;QACT,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,gCAAgC;YAC9C,MAAM;gBACJ,OAAO;gBACP,aAAa;gBACb,SAAS;YACX;YACA,OAAO;QACT;IACF;IAEA,MAAM,oBAAoB,IAAA,4KAAW;0DAAC,OAAO;YAC3C,IAAI,CAAC,iBAAiB,IAAI,OAAO;YACjC,IAAI;gBACF,MAAM,SAAS,MAAM,IAAA,+LAA2B,EAAC,WAAW,gBAAgB,EAAE;gBAC9E,IAAI,OAAO,OAAO,EAAE,OAAO,OAAO,IAAI;gBACtC,OAAO;YACT,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,0BAA0B;gBACxC,OAAO;YACT;QACF;yDAAG;QAAC,iBAAiB;KAAG;IAExB,OAAO,IAAA,wKAAO;mCAAC,IAAM,CAAC;gBACpB;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;YACF,CAAC;kCAAG;QAAC;QAAU;QAAW;QAAe;QAAe;QAAe;QAA+B;QAAmB;QAAc;KAAgB;AACzJ;GAnMa;;QAEO,2IAAQ;QACE,qJAAW;QACtB,wJAAO;QACJ,2MAAc;QA6B2B,0LAAQ"}},
    {"offset": {"line": 264, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useCashTransactions.ts"],"sourcesContent":["import { useState, useEffect, useMemo, useCallback } from 'react';\r\nimport { useAuth } from '@/components/auth/AuthProvider';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\r\nimport {\r\n  CashTransaction,\r\n  DbCashTransaction,\r\n  CashTransactionFormData,\r\n  DailyCashSummary,\r\n  mapDbCashTransactionToCashTransaction\r\n} from '@/types/cash';\r\nimport {\r\n  getCashTransactionsAction,\r\n  createCashTransactionAction,\r\n  updateCashTransactionAction,\r\n  deleteCashTransactionAction,\r\n  getAccountOpeningBalanceAction,\r\n  createBulkCashTransactionsAction\r\n} from '@/app/actions/finance';\r\n\r\nexport const useCashTransactions = (accountId?: string) => {\r\n  const { user } = useAuth();\r\n  const { currentBusiness } = useBusiness();\r\n  const { toast } = useToast();\r\n  const queryClient = useQueryClient();\r\n\r\n  const loadTransactions = useCallback(async (): Promise<CashTransaction[]> => {\r\n    try {\r\n      if (!user || !currentBusiness) {\r\n        return [];\r\n      }\r\n\r\n      const result = await getCashTransactionsAction(currentBusiness.id, accountId);\r\n\r\n      if (!result.success || !result.data) {\r\n        throw new Error(result.error || 'Failed to fetch transactions');\r\n      }\r\n\r\n      // Format all transactions\r\n      const formattedTransactions = result.data.map((item: any) => {\r\n        const dbTransaction: DbCashTransaction = {\r\n          id: item.id,\r\n          user_id: item.user_id,\r\n          account_id: item.account_id,\r\n          amount: Number(item.amount),\r\n          transaction_type: item.transaction_type,\r\n          category: item.category,\r\n          description: item.description,\r\n          person_in_charge: item.person_in_charge,\r\n          tags: item.tags,\r\n          date: item.date,\r\n          payment_method: item.payment_method,\r\n          receipt_image: item.receipt_image,\r\n          created_at: item.created_at,\r\n          updated_at: item.updated_at\r\n        };\r\n        return mapDbCashTransactionToCashTransaction(dbTransaction);\r\n      });\r\n\r\n      // Sort\r\n      formattedTransactions.sort((a, b) => {\r\n        const dateCompare = new Date(b.date).getTime() - new Date(a.date).getTime();\r\n        if (dateCompare !== 0) return dateCompare;\r\n        return new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime();\r\n      });\r\n\r\n      return formattedTransactions;\r\n    } catch (error) {\r\n      console.error('Error loading cash transactions:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to load cash transactions\",\r\n        variant: \"destructive\"\r\n      });\r\n      return [];\r\n    }\r\n  }, [user, currentBusiness?.id, accountId, toast]);\r\n\r\n  const queryKey = useMemo(() => ['cash_transactions', currentBusiness?.id, user?.id, accountId], [currentBusiness?.id, user?.id, accountId]);\r\n\r\n  const { data: transactions = [], isLoading: isQueryLoading } = useQuery({\r\n    queryKey,\r\n    queryFn: loadTransactions,\r\n    enabled: !!user && !!currentBusiness?.id,\r\n    staleTime: 30_000,\r\n  });\r\n\r\n  const isLoading = isQueryLoading && transactions.length === 0;\r\n\r\n  const createTransaction = async (transactionData: CashTransactionFormData) => {\r\n    try {\r\n      if (!user || !currentBusiness) throw new Error('User not authenticated');\r\n\r\n      const result = await createCashTransactionAction({\r\n        ...transactionData,\r\n        userId: user.id,\r\n        locationId: currentBusiness.id\r\n      });\r\n\r\n      if (!result.success) throw new Error(result.error);\r\n\r\n      toast({\r\n        title: \"Success\",\r\n        description: transactionData.transactionType === 'transfer'\r\n          ? \"Transfer completed successfully\"\r\n          : \"Cash transaction created successfully\"\r\n      });\r\n\r\n      queryClient.invalidateQueries({ queryKey });\r\n\r\n      return Array.isArray(result.data)\r\n        ? mapDbCashTransactionToCashTransaction(result.data[0])\r\n        : mapDbCashTransactionToCashTransaction(result.data as any);\r\n    } catch (error) {\r\n      console.error('Error creating cash transaction:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to create cash transaction\",\r\n        variant: \"destructive\"\r\n      });\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  const createBulkTransactions = async (transactionsData: CashTransactionFormData[]) => {\r\n    try {\r\n      if (!user || !currentBusiness) throw new Error('User not authenticated');\r\n\r\n      const payloads = transactionsData.map(t => ({\r\n        ...t,\r\n        userId: user.id,\r\n        locationId: currentBusiness.id\r\n      }));\r\n\r\n      const result = await createBulkCashTransactionsAction(payloads);\r\n\r\n      if (!result.success) throw new Error(result.error);\r\n\r\n      toast({\r\n        title: \"Success\",\r\n        description: `Successfully created ${transactionsData.length} transactions`\r\n      });\r\n\r\n      queryClient.invalidateQueries({ queryKey });\r\n      return (result.data as any[]).map((item: any) => mapDbCashTransactionToCashTransaction(item));\r\n    } catch (error) {\r\n      console.error('Error creating bulk transactions:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to create bulk transactions\",\r\n        variant: \"destructive\"\r\n      });\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  const updateTransaction = async (id: string, updates: Partial<CashTransactionFormData>) => {\r\n    try {\r\n      const result = await updateCashTransactionAction(id, updates);\r\n      if (!result.success) throw new Error(result.error);\r\n\r\n      toast({\r\n        title: \"Success\",\r\n        description: \"Transaction updated successfully\"\r\n      });\r\n\r\n      queryClient.invalidateQueries({ queryKey });\r\n      return mapDbCashTransactionToCashTransaction(result.data as any);\r\n    } catch (error) {\r\n      console.error('Error updating cash transaction:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to update transaction\",\r\n        variant: \"destructive\"\r\n      });\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const deleteTransaction = async (id: string, onDeleted?: () => void) => {\r\n    try {\r\n      if (!currentBusiness) throw new Error('No business selected');\r\n      const result = await deleteCashTransactionAction(id, currentBusiness.id);\r\n      if (!result.success) throw new Error(result.error);\r\n\r\n      toast({\r\n        title: \"Success\",\r\n        description: \"Cash transaction deleted successfully\"\r\n      });\r\n\r\n      queryClient.invalidateQueries({ queryKey });\r\n      if (onDeleted) onDeleted();\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error deleting cash transaction:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to delete cash transaction\",\r\n        variant: \"destructive\"\r\n      });\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const getAccountOpeningBalance = useCallback(async (accountId: string): Promise<number> => {\r\n    try {\r\n      if (!currentBusiness) return 0;\r\n      const result = await getAccountOpeningBalanceAction(accountId, currentBusiness.id);\r\n      return result.success ? result.data : 0;\r\n    } catch (error) {\r\n      return 0;\r\n    }\r\n  }, [currentBusiness?.id]);\r\n\r\n  const getDailySummary = useCallback(async (date: Date, accountId?: string): Promise<DailyCashSummary> => {\r\n    const dateStr = date.toISOString().split('T')[0];\r\n\r\n    let filteredTransactions = transactions.filter(t =>\r\n      t.date.toISOString().split('T')[0] === dateStr\r\n    );\r\n\r\n    if (accountId) {\r\n      filteredTransactions = filteredTransactions.filter(t => t.accountId === accountId);\r\n    }\r\n\r\n    const cashIn = filteredTransactions\r\n      .filter(t => t.transactionType === 'cash_in' || t.transactionType === 'transfer_in')\r\n      .reduce((sum, t) => sum + t.amount, 0);\r\n\r\n    const cashOut = filteredTransactions\r\n      .filter(t => t.transactionType === 'cash_out' || t.transactionType === 'transfer_out')\r\n      .reduce((sum, t) => sum + t.amount, 0);\r\n\r\n    const transfersIn = filteredTransactions\r\n      .filter(t => t.transactionType === 'transfer_in')\r\n      .reduce((sum, t) => sum + t.amount, 0);\r\n\r\n    const transfersOut = filteredTransactions\r\n      .filter(t => t.transactionType === 'transfer_out')\r\n      .reduce((sum, t) => sum + t.amount, 0);\r\n\r\n    const yesterday = new Date(date);\r\n    yesterday.setDate(yesterday.getDate() - 1);\r\n    const yesterdayStr = yesterday.toISOString().split('T')[0];\r\n\r\n    let yesterdayTransactions = transactions.filter(t =>\r\n      t.date.toISOString().split('T')[0] <= yesterdayStr\r\n    );\r\n\r\n    if (accountId) {\r\n      yesterdayTransactions = yesterdayTransactions.filter(t => t.accountId === accountId);\r\n    }\r\n\r\n    const yesterdayCashIn = yesterdayTransactions\r\n      .filter(t => t.transactionType === 'cash_in' || t.transactionType === 'transfer_in')\r\n      .reduce((sum, t) => sum + t.amount, 0);\r\n\r\n    const yesterdayCashOut = yesterdayTransactions\r\n      .filter(t => t.transactionType === 'cash_out' || t.transactionType === 'transfer_out')\r\n      .reduce((sum, t) => sum + t.amount, 0);\r\n\r\n    let accountOpeningBalance = 0;\r\n    if (accountId) {\r\n      accountOpeningBalance = await getAccountOpeningBalance(accountId);\r\n    }\r\n\r\n    const openingBalance = accountOpeningBalance + yesterdayCashIn - yesterdayCashOut;\r\n    const closingBalance = openingBalance + cashIn - cashOut;\r\n\r\n    return {\r\n      date,\r\n      openingBalance,\r\n      cashIn,\r\n      cashOut,\r\n      transfersIn,\r\n      transfersOut,\r\n      closingBalance\r\n    };\r\n  }, [transactions, getAccountOpeningBalance]);\r\n\r\n  const getDateRangeSummary = useCallback(async (startDate: Date, endDate: Date, accountId?: string): Promise<DailyCashSummary> => {\r\n    const startDateStr = startDate.toISOString().split('T')[0];\r\n    const endDateStr = endDate.toISOString().split('T')[0];\r\n\r\n    let filteredTransactions = transactions.filter(t => {\r\n      const transactionDateStr = t.date.toISOString().split('T')[0];\r\n      return transactionDateStr >= startDateStr && transactionDateStr <= endDateStr;\r\n    });\r\n\r\n    if (accountId) {\r\n      filteredTransactions = filteredTransactions.filter(t => t.accountId === accountId);\r\n    }\r\n\r\n    const cashIn = filteredTransactions\r\n      .filter(t => t.transactionType === 'cash_in' || t.transactionType === 'transfer_in')\r\n      .reduce((sum, t) => sum + t.amount, 0);\r\n\r\n    const cashOut = filteredTransactions\r\n      .filter(t => t.transactionType === 'cash_out' || t.transactionType === 'transfer_out')\r\n      .reduce((sum, t) => sum + t.amount, 0);\r\n\r\n    const transfersIn = filteredTransactions\r\n      .filter(t => t.transactionType === 'transfer_in')\r\n      .reduce((sum, t) => sum + t.amount, 0);\r\n\r\n    const transfersOut = filteredTransactions\r\n      .filter(t => t.transactionType === 'transfer_out')\r\n      .reduce((sum, t) => sum + t.amount, 0);\r\n\r\n    const dayBeforeStart = new Date(startDate);\r\n    dayBeforeStart.setDate(dayBeforeStart.getDate() - 1);\r\n    const dayBeforeStartStr = dayBeforeStart.toISOString().split('T')[0];\r\n\r\n    let transactionsBeforeRange = transactions.filter(t =>\r\n      t.date.toISOString().split('T')[0] <= dayBeforeStartStr\r\n    );\r\n\r\n    if (accountId) {\r\n      transactionsBeforeRange = transactionsBeforeRange.filter(t => t.accountId === accountId);\r\n    }\r\n\r\n    const cashInBeforeRange = transactionsBeforeRange\r\n      .filter(t => t.transactionType === 'cash_in' || t.transactionType === 'transfer_in')\r\n      .reduce((sum, t) => sum + t.amount, 0);\r\n\r\n    const cashOutBeforeRange = transactionsBeforeRange\r\n      .filter(t => t.transactionType === 'cash_out' || t.transactionType === 'transfer_out')\r\n      .reduce((sum, t) => sum + t.amount, 0);\r\n\r\n    let accountOpeningBalance = 0;\r\n    if (accountId) {\r\n      accountOpeningBalance = await getAccountOpeningBalance(accountId);\r\n    }\r\n\r\n    const openingBalance = accountOpeningBalance + cashInBeforeRange - cashOutBeforeRange;\r\n    const closingBalance = openingBalance + cashIn - cashOut;\r\n\r\n    return {\r\n      date: startDate,\r\n      openingBalance,\r\n      cashIn,\r\n      cashOut,\r\n      transfersIn,\r\n      transfersOut,\r\n      closingBalance\r\n    };\r\n  }, [transactions, getAccountOpeningBalance]);\r\n\r\n  const refreshTransactions = useCallback(() => {\r\n    queryClient.invalidateQueries({ queryKey });\r\n  }, [queryClient, queryKey]);\r\n\r\n  return useMemo(() => ({\r\n    transactions,\r\n    isLoading,\r\n    createTransaction,\r\n    createBulkTransactions,\r\n    updateTransaction,\r\n    deleteTransaction,\r\n    getDailySummary,\r\n    getDateRangeSummary,\r\n    refreshTransactions\r\n  }), [transactions, isLoading, createTransaction, createBulkTransactions, updateTransaction, deleteTransaction, getDailySummary, getDateRangeSummary, refreshTransactions]);\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 683, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useBusinessSettings.ts"],"sourcesContent":["\r\nimport { useState, useEffect } from 'react';\r\nimport { useQuery } from '@tanstack/react-query';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\nimport { useAuth } from '@/components/auth/AuthProvider';\r\nimport { getBusinessSettingsAction, upsertBusinessSettingsAction } from '@/app/actions/business-settings';\r\n\r\nexport interface BusinessSettings {\r\n  id?: string;\r\n  businessName: string;\r\n  businessAddress: string;\r\n  businessPhone: string;\r\n  businessEmail: string;\r\n  businessLogo?: string;\r\n  currency: string;\r\n  signature?: string;\r\n  paymentInfo?: string;\r\n  defaultPrintFormat?: 'standard' | 'thermal';\r\n  defaultPrinterName?: string;\r\n  defaultPrinterType?: 'USB' | 'Bluetooth';\r\n  printerPaperSize?: '58mm' | '80mm';\r\n}\r\n\r\n// Utility function to parse payment info text into structured format\r\nexport const parsePaymentInfo = (paymentInfo: string): { method: string, accountNumber: string, accountName: string }[] => {\r\n  if (!paymentInfo || paymentInfo.trim() === '') {\r\n    return [];\r\n  }\r\n\r\n  const lines = paymentInfo.split('\\n').filter(line => line.trim() !== '');\r\n  const methods: { method: string, accountNumber: string, accountName: string }[] = [];\r\n\r\n  for (let i = 0; i < lines.length; i += 3) {\r\n    if (i + 2 < lines.length) {\r\n      methods.push({\r\n        method: lines[i].trim(),\r\n        accountNumber: lines[i + 1].trim(),\r\n        accountName: lines[i + 2].trim()\r\n      });\r\n    }\r\n  }\r\n\r\n  return methods;\r\n};\r\n\r\n// Utility function to convert payment methods array back to string format\r\nexport const convertPaymentMethodsToString = (paymentMethods: { method: string, accountNumber: string, accountName: string }[]): string => {\r\n  return paymentMethods\r\n    .filter(pm => pm.method.trim() !== '' || pm.accountNumber.trim() !== '' || pm.accountName.trim() !== '')\r\n    .map(pm => `${pm.method}\\n${pm.accountNumber}\\n${pm.accountName}`)\r\n    .join('\\n');\r\n};\r\n\r\n// Default settings for new businesses\r\nconst getDefaultSettings = (): BusinessSettings => ({\r\n  businessName: '',\r\n  businessAddress: '',\r\n  businessPhone: '',\r\n  businessEmail: '',\r\n  currency: 'UGX',\r\n  paymentInfo: '',\r\n  defaultPrintFormat: 'standard'\r\n});\r\n\r\nexport const useBusinessSettings = () => {\r\n  const [settings, setSettings] = useState<BusinessSettings>(getDefaultSettings());\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const { toast } = useToast();\r\n  const { currentBusiness } = useBusiness();\r\n\r\n  const loadSettings = async (): Promise<BusinessSettings> => {\r\n    if (!currentBusiness) {\r\n      return getDefaultSettings();\r\n    }\r\n\r\n    try {\r\n      const data = await getBusinessSettingsAction(currentBusiness.id);\r\n\r\n      if (data) {\r\n        // Extract payment info from metadata\r\n        const paymentInfo = data.metadata && typeof data.metadata === 'object' ?\r\n          (data.metadata as Record<string, unknown>).payment_info as string || '' : '';\r\n\r\n        return {\r\n          id: data.id,\r\n          businessName: data.business_name,\r\n          businessAddress: data.business_address,\r\n          businessPhone: data.business_phone,\r\n          businessEmail: data.business_email,\r\n          businessLogo: data.business_logo,\r\n          currency: data.currency,\r\n          signature: data.signature,\r\n          paymentInfo: paymentInfo,\r\n          defaultPrintFormat: data.metadata && typeof data.metadata === 'object' ?\r\n            (data.metadata as Record<string, unknown>).default_print_format as 'standard' | 'thermal' || 'standard' : 'standard',\r\n          defaultPrinterName: data.metadata && typeof data.metadata === 'object' ?\r\n            (data.metadata as Record<string, unknown>).default_printer_name as string || '' : '',\r\n          defaultPrinterType: data.metadata && typeof data.metadata === 'object' ?\r\n            (data.metadata as Record<string, unknown>).default_printer_type as 'USB' | 'Bluetooth' || 'USB' : 'USB',\r\n          printerPaperSize: data.metadata && typeof data.metadata === 'object' ?\r\n            (data.metadata as Record<string, unknown>).printer_paper_size as '58mm' | '80mm' || '58mm' : '58mm'\r\n        };\r\n      } else {\r\n        return getDefaultSettings();\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading business settings:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to load business settings. Please try again.\",\r\n        variant: \"destructive\"\r\n      });\r\n      return getDefaultSettings();\r\n    }\r\n  };\r\n\r\n  const updateSettings = async (newSettings: Partial<BusinessSettings>) => {\r\n    if (!currentBusiness) {\r\n      console.error('No business selected for updating settings');\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"No business selected\",\r\n        variant: \"destructive\"\r\n      });\r\n      return false;\r\n    }\r\n\r\n    try {\r\n      const userData = { user: { id: '00000000-0000-0000-0000-000000000000' } }; // Mocked user id for now\r\n\r\n      // Prepare the metadata object with payment info\r\n      const metadata = {\r\n        payment_info: newSettings.hasOwnProperty('paymentInfo') ? newSettings.paymentInfo : settings.paymentInfo || '',\r\n        default_print_format: newSettings.hasOwnProperty('defaultPrintFormat') ? newSettings.defaultPrintFormat : settings.defaultPrintFormat || 'standard',\r\n        default_printer_name: newSettings.hasOwnProperty('defaultPrinterName') ? newSettings.defaultPrinterName : settings.defaultPrinterName || '',\r\n        default_printer_type: newSettings.hasOwnProperty('defaultPrinterType') ? newSettings.defaultPrinterType : settings.defaultPrinterType || 'USB',\r\n        printer_paper_size: newSettings.hasOwnProperty('printerPaperSize') ? newSettings.printerPaperSize : settings.printerPaperSize || '58mm'\r\n      };\r\n\r\n      const updateData = {\r\n        business_name: newSettings.hasOwnProperty('businessName') ? newSettings.businessName : settings.businessName,\r\n        business_address: newSettings.hasOwnProperty('businessAddress') ? newSettings.businessAddress : settings.businessAddress,\r\n        business_phone: newSettings.hasOwnProperty('businessPhone') ? newSettings.businessPhone : settings.businessPhone,\r\n        business_email: newSettings.hasOwnProperty('businessEmail') ? newSettings.businessEmail : settings.businessEmail,\r\n        business_logo: newSettings.hasOwnProperty('businessLogo') ? newSettings.businessLogo : settings.businessLogo,\r\n        currency: newSettings.hasOwnProperty('currency') ? newSettings.currency : settings.currency,\r\n        signature: newSettings.hasOwnProperty('signature') ? newSettings.signature : settings.signature,\r\n        metadata: metadata\r\n      };\r\n\r\n      const response = await upsertBusinessSettingsAction(currentBusiness.id, userData.user.id, updateData);\r\n\r\n      if (!response.success) {\r\n        console.error('Supabase error updating business settings:', response.error);\r\n        throw new Error(response.error);\r\n      }\r\n\r\n      toast({\r\n        title: \"Success\",\r\n        description: \"Business settings updated successfully\"\r\n      });\r\n\r\n      // Refetch settings after update\r\n      refetch();\r\n\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error updating business settings:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to update business settings. Please try again.\",\r\n        variant: \"destructive\"\r\n      });\r\n      return false;\r\n    }\r\n  };\r\n\r\n  // React Query for settings loading with proper caching\r\n  const { data: queriedData, isLoading: isQueryLoading, isFetching, refetch } = useQuery({\r\n    queryKey: ['businessSettings', currentBusiness?.id],\r\n    queryFn: loadSettings,\r\n    enabled: !!currentBusiness?.id,\r\n    staleTime: 5 * 60_000,\r\n    gcTime: 30 * 60_000,\r\n    refetchOnWindowFocus: false,\r\n    refetchOnReconnect: false,\r\n  });\r\n\r\n  // Sync React Query data with local state\r\n  useEffect(() => {\r\n    if (queriedData) {\r\n      setSettings(queriedData);\r\n    } else if (!currentBusiness) {\r\n      setSettings(getDefaultSettings());\r\n    }\r\n  }, [queriedData, currentBusiness]);\r\n\r\n  // Sync loading state from React Query\r\n  useEffect(() => {\r\n    setIsLoading(isQueryLoading || isFetching);\r\n  }, [isQueryLoading, isFetching]);\r\n\r\n  return {\r\n    settings,\r\n    isLoading,\r\n    updateSettings,\r\n    loadSettings\r\n  };\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 888, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useFinancialVisibility.ts"],"sourcesContent":["import { useProfiles } from '@/contexts/ProfileContext';\r\n\r\n/**\r\n * Hook to handle financial data visibility based on permissions\r\n */\r\nexport const useFinancialVisibility = () => {\r\n    const { hasPermission } = useProfiles();\r\n\r\n    const canViewCostPrice = hasPermission('inventory', 'view_cost_price');\r\n    const canViewProfit = hasPermission('inventory', 'view_profit');\r\n    const canViewSellingPrice = hasPermission('inventory', 'view_selling_price');\r\n\r\n    // Dashboard-specific permissions\r\n    const canViewTotalSales = hasPermission('dashboard', 'view_total_sales');\r\n    const canViewTotalGrossProfit = hasPermission('dashboard', 'view_gross_profit');\r\n    const canViewTotalExpenses = hasPermission('dashboard', 'view_total_expenses');\r\n    const canViewInventoryValue = hasPermission('dashboard', 'view_inventory_value');\r\n    const canViewSalesTypes = hasPermission('dashboard', 'view_sales_types');\r\n    const canViewAvgPrice = hasPermission('dashboard', 'view_avg_price');\r\n    const canViewTotalAmount = hasPermission('dashboard', 'view_total_amount');\r\n\r\n    // Finance and Expenses permissions\r\n    const canManageFinanceAccounts = hasPermission('finance', 'manage_accounts');\r\n    const canViewFinance = hasPermission('finance', 'view');\r\n    const canViewExpenses = hasPermission('expenses', 'view');\r\n    const canCreateExpenses = hasPermission('expenses', 'create');\r\n    const canEditExpenses = hasPermission('expenses', 'edit');\r\n    const canDeleteExpenses = hasPermission('expenses', 'delete');\r\n\r\n    /**\r\n     * Format a financial value or return a hidden indicator\r\n     */\r\n    const formatFinancial = (value: number | null | undefined, type: 'cost' | 'selling' | 'profit'): string => {\r\n        const hasAccess =\r\n            (type === 'cost' && canViewCostPrice) ||\r\n            (type === 'selling' && canViewSellingPrice) ||\r\n            (type === 'profit' && canViewProfit);\r\n\r\n        if (!hasAccess) {\r\n            return '•••';\r\n        }\r\n\r\n        return value?.toLocaleString() || '0';\r\n    };\r\n\r\n    return {\r\n        canViewCostPrice,\r\n        canViewProfit,\r\n        canViewSellingPrice,\r\n        canViewTotalSales,\r\n        canViewTotalGrossProfit,\r\n        canViewTotalExpenses,\r\n        canViewInventoryValue,\r\n        canViewSalesTypes,\r\n        canViewAvgPrice,\r\n        canViewTotalAmount,\r\n        canManageFinanceAccounts,\r\n        canViewFinance,\r\n        canViewExpenses,\r\n        canCreateExpenses,\r\n        canEditExpenses,\r\n        canDeleteExpenses,\r\n        formatFinancial,\r\n    };\r\n};\r\n"],"names":[],"mappings":";;;;AAAA;;;AAKO,MAAM,yBAAyB;;IAClC,MAAM,EAAE,aAAa,EAAE,GAAG,IAAA,oJAAW;IAErC,MAAM,mBAAmB,cAAc,aAAa;IACpD,MAAM,gBAAgB,cAAc,aAAa;IACjD,MAAM,sBAAsB,cAAc,aAAa;IAEvD,iCAAiC;IACjC,MAAM,oBAAoB,cAAc,aAAa;IACrD,MAAM,0BAA0B,cAAc,aAAa;IAC3D,MAAM,uBAAuB,cAAc,aAAa;IACxD,MAAM,wBAAwB,cAAc,aAAa;IACzD,MAAM,oBAAoB,cAAc,aAAa;IACrD,MAAM,kBAAkB,cAAc,aAAa;IACnD,MAAM,qBAAqB,cAAc,aAAa;IAEtD,mCAAmC;IACnC,MAAM,2BAA2B,cAAc,WAAW;IAC1D,MAAM,iBAAiB,cAAc,WAAW;IAChD,MAAM,kBAAkB,cAAc,YAAY;IAClD,MAAM,oBAAoB,cAAc,YAAY;IACpD,MAAM,kBAAkB,cAAc,YAAY;IAClD,MAAM,oBAAoB,cAAc,YAAY;IAEpD;;KAEC,GACD,MAAM,kBAAkB,CAAC,OAAkC;QACvD,MAAM,YACF,AAAC,SAAS,UAAU,oBACnB,SAAS,aAAa,uBACtB,SAAS,YAAY;QAE1B,IAAI,CAAC,WAAW;YACZ,OAAO;QACX;QAEA,OAAO,OAAO,oBAAoB;IACtC;IAEA,OAAO;QACH;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;IACJ;AACJ;GA3Da;;QACiB,oJAAW"}},
    {"offset": {"line": 963, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useProducts.ts"],"sourcesContent":["import { useState, useEffect, useCallback, useMemo } from 'react';\r\nimport { supabase } from '@/integrations/supabase/client';\r\nimport { Product, ProductFormData, ProductFilters } from '@/types';\r\nimport { useBusinessSettings } from './useBusinessSettings';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\r\nimport { clearInventoryCaches } from '@/utils/inventoryCacheUtils';\r\n\r\n// Import our new Server Actions\r\nimport {\r\n  getProductsAction,\r\n  createProductAction,\r\n  updateProductAction,\r\n  deleteProductAction,\r\n  updateProductsBulkAction\r\n} from '@/app/actions/products';\r\n\r\nexport const useProducts = (userId: string | undefined, initialPageSize: number = 50) => {\r\n  const [products, setProducts] = useState<Product[]>([]);\r\n  const [page, setPage] = useState(1);\r\n  const [pageSize, setPageSize] = useState(initialPageSize);\r\n  const [totalCount, setTotalCount] = useState(0);\r\n  const [isTyping, setIsTyping] = useState(false);\r\n  const { settings } = useBusinessSettings();\r\n  const { currentBusiness } = useBusiness();\r\n  const queryClient = useQueryClient();\r\n\r\n  const [filters, setFilters] = useState<ProductFilters>({\r\n    search: '',\r\n    category: 'all',\r\n    stockStatus: 'all'\r\n  });\r\n\r\n  const [typingTimer, setTypingTimer] = useState<NodeJS.Timeout | null>(null);\r\n\r\n  const setFiltersWithTypingState = useCallback((newFilters: ProductFilters) => {\r\n    if (newFilters.search !== filters.search) {\r\n      setIsTyping(true);\r\n      if (typingTimer) clearTimeout(typingTimer);\r\n      const timer = setTimeout(() => {\r\n        setIsTyping(false);\r\n      }, 600);\r\n      setTypingTimer(timer);\r\n    }\r\n    setFilters(newFilters);\r\n  }, [filters.search, typingTimer]);\r\n\r\n  // Use Server Action instead of Supabase\r\n  const loadProducts = useCallback(async (): Promise<{ products: Product[], count: number }> => {\r\n    if (!userId || !currentBusiness) {\r\n      return { products: [], count: 0 };\r\n    }\r\n\r\n    try {\r\n      // Server Action call\r\n      const result = await getProductsAction({\r\n        userId,\r\n        businessId: currentBusiness.id,\r\n        page,\r\n        pageSize,\r\n        search: filters.search,\r\n        category: filters.category === 'all' ? undefined : filters.category,\r\n        stockStatus: filters.stockStatus,\r\n      });\r\n      return result as { products: Product[], count: number };\r\n    } catch (error) {\r\n      console.error('Error loading products from server action:', error);\r\n      return { products: [], count: 0 };\r\n    }\r\n  }, [userId, currentBusiness?.id, page, pageSize, filters.search, filters.category, filters.stockStatus]);\r\n\r\n  const baseQueryKey = useMemo(() => ['products', userId, currentBusiness?.id], [userId, currentBusiness?.id]);\r\n  const queryKey = useMemo(() => [...baseQueryKey, page, pageSize, filters.search, filters.category, filters.stockStatus], [baseQueryKey, page, pageSize, filters.search, filters.category, filters.stockStatus]);\r\n\r\n  const { data: queriedData, isLoading: isQueryLoading, isFetching, refetch } = useQuery({\r\n    queryKey,\r\n    queryFn: loadProducts,\r\n    enabled: !!userId && !!currentBusiness?.id,\r\n    staleTime: 30_000,\r\n    gcTime: 30 * 60_000,\r\n    refetchOnWindowFocus: true,\r\n    refetchOnReconnect: true,\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (queriedData) {\r\n      setProducts(queriedData.products);\r\n      setTotalCount(queriedData.count);\r\n    }\r\n  }, [queriedData]);\r\n\r\n  const isLoading = (isQueryLoading && !queriedData) && !isTyping;\r\n\r\n  // Supabase Storage remains untouched since Prisma doesn't do file storage\r\n  // but we isolate it here.\r\n  const uploadProductImage = async (imageFile: File): Promise<string | null> => {\r\n    try {\r\n      if (!userId) return null;\r\n      const fileExt = imageFile.name.split('.').pop();\r\n      const fileName = `${Date.now()}.${fileExt}`;\r\n      const filePath = `${userId}/${fileName}`;\r\n\r\n      const { error: uploadError } = await supabase.storage\r\n        .from('product-images')\r\n        .upload(filePath, imageFile, { upsert: true });\r\n\r\n      if (uploadError) {\r\n        console.error('Error uploading image:', uploadError);\r\n        return null;\r\n      }\r\n\r\n      const { data: { publicUrl } } = supabase.storage\r\n        .from('product-images')\r\n        .getPublicUrl(filePath);\r\n\r\n      return publicUrl;\r\n    } catch (error) {\r\n      console.error('Error in uploadProductImage:', error);\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const createProduct = async (productData: ProductFormData): Promise<Product | null> => {\r\n    try {\r\n      if (!userId || !currentBusiness) return null;\r\n\r\n      const result = await createProductAction({\r\n        ...productData,\r\n        userId,\r\n        businessId: currentBusiness.id\r\n      });\r\n\r\n      if (!result) return null;\r\n\r\n      const newProduct = result as Product;\r\n\r\n      setProducts(prev => [newProduct, ...prev]);\r\n      setTotalCount(c => c + 1);\r\n\r\n      queryClient.invalidateQueries({ queryKey: baseQueryKey });\r\n      clearInventoryCaches(queryClient);\r\n\r\n      return newProduct;\r\n    } catch (error) {\r\n      console.error('Error creating product:', error);\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const updateProduct = async (\r\n    id: string,\r\n    updates: Partial<Product>,\r\n    imageFile?: File | null,\r\n    isFromSale = false,\r\n    customChangeReason?: string,\r\n    adjustmentDate?: Date,\r\n    referenceId?: string,\r\n    receiptNumber?: string\r\n  ): Promise<boolean> => {\r\n    try {\r\n      if (!userId || !currentBusiness) return false;\r\n\r\n      let imageUrl = updates.imageUrl;\r\n      if (imageFile) {\r\n        imageUrl = await uploadProductImage(imageFile);\r\n      }\r\n\r\n      const result = await updateProductAction(id, {\r\n        ...updates,\r\n        imageUrl,\r\n        userId,\r\n        businessId: currentBusiness.id,\r\n        isFromSale,\r\n        customChangeReason,\r\n        referenceId\r\n      });\r\n\r\n      if (!result) return false;\r\n\r\n      queryClient.invalidateQueries({ queryKey: baseQueryKey });\r\n      clearInventoryCaches(queryClient);\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error updating product:', error);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const deleteProduct = async (id: string): Promise<boolean> => {\r\n    try {\r\n      if (!userId) return false;\r\n\r\n      const success = await deleteProductAction(id);\r\n\r\n      if (success) {\r\n        queryClient.invalidateQueries({ queryKey: baseQueryKey });\r\n        clearInventoryCaches(queryClient);\r\n        return true;\r\n      }\r\n      return false;\r\n    } catch (error) {\r\n      console.error('Error deleting product:', error);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const updateProductsBulk = async (\r\n    updates: Array<{ id: string; updated: Partial<Product>; imageFile?: File | null }>,\r\n    userIdForHistory?: string,\r\n    changeReason?: string,\r\n    referenceId?: string,\r\n    adjustmentDate?: Date,\r\n    receiptNumber?: string\r\n  ): Promise<boolean> => {\r\n    try {\r\n      if (!userId || !currentBusiness) return false;\r\n\r\n      const success = await updateProductsBulkAction(\r\n        updates.map(u => ({ id: u.id, updated: u.updated })),\r\n        currentBusiness.id\r\n      );\r\n\r\n      if (success) {\r\n        queryClient.invalidateQueries({ queryKey: baseQueryKey });\r\n        clearInventoryCaches(queryClient);\r\n      }\r\n\r\n      return success;\r\n    } catch (error) {\r\n      console.error('Error in bulk update:', error);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  return {\r\n    products,\r\n    isLoading,\r\n    loadProducts,\r\n    page,\r\n    setPage,\r\n    pageSize,\r\n    setPageSize,\r\n    totalCount,\r\n    createProduct,\r\n    updateProduct,\r\n    updateProductsBulk,\r\n    deleteProduct,\r\n    uploadProductImage,\r\n    refetch,\r\n    isFetching,\r\n    filters,\r\n    setFilters: setFiltersWithTypingState,\r\n  };\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1252, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useInventoryActions.ts"],"sourcesContent":["import { useProducts } from './useProducts';\r\nimport { SaleItem, Product } from '@/types';\r\nimport { toast } from 'sonner';\r\nimport { getProductsByIdsAction } from '@/app/actions/products';\r\n\r\nexport const useInventoryActions = (userId: string | undefined) => {\r\n    const { updateProductsBulk } = useProducts(userId);\r\n\r\n    /**\r\n     * Helper to fetch fresh product data from DB to avoid race conditions/stale data\r\n     */\r\n    const fetchFreshProducts = async (productIds: string[], locationId?: string) => {\r\n        if (!productIds.length) return [];\r\n\r\n        try {\r\n            const result = await getProductsByIdsAction(productIds, locationId);\r\n            return result as Product[];\r\n        } catch (error) {\r\n            console.error('Error fetching fresh products:', error);\r\n            throw error;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Deduct stock for a new sale\r\n     */\r\n    const deductStockForSale = async (\r\n        items: SaleItem[],\r\n        saleId?: string,\r\n        saleDate?: Date,\r\n        receiptNumber?: string,\r\n        locationId?: string\r\n    ): Promise<boolean> => {\r\n        if (!userId) return false;\r\n\r\n        try {\r\n            const itemsWithProductIds = items.filter(item => item.productId);\r\n            if (itemsWithProductIds.length === 0) return true;\r\n\r\n            const uniqueIds = [...new Set(itemsWithProductIds.map(item => item.productId!))];\r\n            const freshProducts = await fetchFreshProducts(uniqueIds, locationId);\r\n\r\n            if (freshProducts.length === 0) return false;\r\n\r\n            // Calculate total quantity to deduct per product\r\n            const quantityChanges = new Map<string, number>();\r\n            for (const item of itemsWithProductIds) {\r\n                const existing = quantityChanges.get(item.productId!) || 0;\r\n                quantityChanges.set(item.productId!, existing + item.quantity);\r\n            }\r\n\r\n            const bulkUpdates = [];\r\n            for (const [productId, quantityToDeduct] of quantityChanges.entries()) {\r\n                const product = freshProducts.find(p => p.id === productId);\r\n                if (!product) continue;\r\n\r\n                const newQuantity = product.quantity - quantityToDeduct;\r\n\r\n                bulkUpdates.push({\r\n                    id: productId,\r\n                    updated: { ...product, quantity: newQuantity }\r\n                });\r\n\r\n                if (newQuantity < 0) {\r\n                    toast.warning(`${product.name} inventory is now negative (${newQuantity}). Please restock soon.`);\r\n                }\r\n            }\r\n\r\n            if (bulkUpdates.length > 0) {\r\n                await updateProductsBulk(bulkUpdates, userId, 'Sale', saleId, saleDate, receiptNumber);\r\n            }\r\n\r\n            return true;\r\n        } catch (error) {\r\n            console.error('Error deducting stock for sale:', error);\r\n            return false;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Restore stock (e.g. when deleting a sale)\r\n     */\r\n    const restoreStockForSale = async (\r\n        items: SaleItem[],\r\n        saleId?: string, // Reference ID for history\r\n        receiptNumber?: string, // Reference receipt number\r\n        locationId?: string\r\n    ): Promise<boolean> => {\r\n        if (!userId) return false;\r\n\r\n        try {\r\n            const itemsWithProductIds = items.filter(item => item.productId);\r\n            if (itemsWithProductIds.length === 0) return true;\r\n\r\n            const uniqueIds = [...new Set(itemsWithProductIds.map(item => item.productId!))];\r\n            const freshProducts = await fetchFreshProducts(uniqueIds, locationId);\r\n\r\n            // Calculate total quantity to restore\r\n            const quantityChanges = new Map<string, number>();\r\n            for (const item of itemsWithProductIds) {\r\n                const existing = quantityChanges.get(item.productId!) || 0;\r\n                quantityChanges.set(item.productId!, existing + item.quantity);\r\n            }\r\n\r\n            const bulkUpdates = [];\r\n            for (const [productId, quantityToRestore] of quantityChanges.entries()) {\r\n                const product = freshProducts.find(p => p.id === productId);\r\n                if (!product) continue;\r\n\r\n                const newQuantity = product.quantity + quantityToRestore;\r\n\r\n                bulkUpdates.push({\r\n                    id: productId,\r\n                    updated: { ...product, quantity: newQuantity }\r\n                });\r\n            }\r\n\r\n            if (bulkUpdates.length > 0) {\r\n                await updateProductsBulk(bulkUpdates, userId, 'Deleted Sale', saleId, undefined, receiptNumber);\r\n            }\r\n\r\n            return true;\r\n        } catch (error) {\r\n            console.error('Error restoring stock for sale:', error);\r\n            return false;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Adjust stock for an edited sale (Handle both adding and removing items)\r\n     */\r\n    const adjustStockForEditedSale = async (\r\n        originalItems: SaleItem[],\r\n        newItems: SaleItem[],\r\n        saleId?: string,\r\n        saleDate?: Date,\r\n        receiptNumber?: string,\r\n        locationId?: string\r\n    ): Promise<boolean> => {\r\n        if (!userId) return false;\r\n\r\n        try {\r\n            const allProductIds = [\r\n                ...originalItems.filter(i => i.productId).map(i => i.productId!),\r\n                ...newItems.filter(i => i.productId).map(i => i.productId!)\r\n            ];\r\n            const uniqueIds = [...new Set(allProductIds)];\r\n            if (uniqueIds.length === 0) return true;\r\n\r\n            const freshProducts = await fetchFreshProducts(uniqueIds, locationId);\r\n\r\n            const productNetChanges = new Map<string, number>();\r\n\r\n            // 1. Restore original items (add back to stock)\r\n            for (const item of originalItems.filter(i => i.productId)) {\r\n                const current = productNetChanges.get(item.productId!) || 0;\r\n                productNetChanges.set(item.productId!, current + item.quantity);\r\n            }\r\n\r\n            // 2. Deduct new items (remove from stock)\r\n            for (const item of newItems.filter(i => i.productId)) {\r\n                const current = productNetChanges.get(item.productId!) || 0;\r\n                productNetChanges.set(item.productId!, current - item.quantity);\r\n            }\r\n\r\n            const bulkUpdates = [];\r\n            for (const [productId, netChange] of productNetChanges.entries()) {\r\n                if (netChange === 0) continue;\r\n\r\n                const product = freshProducts.find(p => p.id === productId);\r\n                if (!product) continue;\r\n\r\n                const newQuantity = product.quantity + netChange;\r\n\r\n                bulkUpdates.push({\r\n                    id: productId,\r\n                    updated: { ...product, quantity: newQuantity }\r\n                });\r\n\r\n                if (newQuantity < 0) {\r\n                    toast.warning(`${product.name} inventory is now negative (${newQuantity}). Please restock soon.`);\r\n                }\r\n            }\r\n\r\n            if (bulkUpdates.length > 0) {\r\n                await updateProductsBulk(bulkUpdates, userId, 'Sale Status/Qty Edit', saleId, saleDate, receiptNumber);\r\n            }\r\n\r\n            return true;\r\n        } catch (error) {\r\n            console.error('Error adjusting stock for edited sale:', error);\r\n            return false;\r\n        }\r\n    };\r\n\r\n    return {\r\n        deductStockForSale,\r\n        restoreStockForSale,\r\n        adjustStockForEditedSale\r\n    };\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1429, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useSalesData.ts"],"sourcesContent":["import { useState, useEffect, useMemo, useCallback } from 'react';\r\nimport { Sale, DbSale, mapDbSaleToSale } from '@/types';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\r\nimport { useActivityLogger } from '@/hooks/useActivityLogger';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\nimport { useProducts } from '@/hooks/useProducts';\r\nimport { useInventoryActions } from '@/hooks/useInventoryActions';\r\nimport { clearInventoryCaches } from '@/utils/inventoryCacheUtils';\r\nimport { getSalesAction, deleteSaleAction } from '@/app/actions/sales';\r\n\r\nexport interface TopCustomer {\r\n  id?: string;\r\n  name: string;\r\n  totalPurchases: number;\r\n  orderCount: number;\r\n}\r\n\r\nexport const useSalesData = (userId: string | undefined, sortOrder: string = 'desc', pageSize?: number) => {\r\n\r\n  const queryClient = useQueryClient();\r\n  const { toast } = useToast();\r\n  const { logActivity } = useActivityLogger();\r\n  const { currentBusiness } = useBusiness();\r\n  const { restoreStockForSale } = useInventoryActions(userId);\r\n\r\n  const loadSales = useCallback(async (): Promise<Sale[]> => {\r\n    try {\r\n      if (!userId || !currentBusiness) {\r\n        return [];\r\n      }\r\n\r\n      // If pageSize is specified, load only that many records\r\n      const salesData = await getSalesAction(currentBusiness.id, sortOrder as any, pageSize);\r\n\r\n      const formattedSales: Sale[] = salesData ? salesData.map((item: any) => {\r\n        const dbSale: DbSale = {\r\n          id: item.id,\r\n          user_id: item.user_id,\r\n          location_id: item.location_id,\r\n          receipt_number: item.receipt_number,\r\n          customer_name: item.customer_name,\r\n          customer_address: item.customer_address,\r\n          customer_contact: item.customer_contact,\r\n          customer_id: item.customer_id,\r\n          items: item.items as any,\r\n          payment_status: item.payment_status,\r\n          profit: item.profit ? Number(item.profit) : 0,\r\n          date: item.date,\r\n          tax_rate: item.tax_rate || 0,\r\n          created_at: item.created_at,\r\n          updated_at: item.updated_at,\r\n          cash_transaction_id: item.cash_transaction_id,\r\n          amount_paid: item.amount_paid ? Number(item.amount_paid) : undefined,\r\n          amount_due: item.amount_due ? Number(item.amount_due) : undefined,\r\n          category_id: item.category_id,\r\n          notes: item.notes\r\n        };\r\n        return mapDbSaleToSale(dbSale);\r\n      }) : [];\r\n\r\n      return formattedSales;\r\n\r\n    } catch (error) {\r\n      console.error('Error loading sales:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to load sales data. Please try again.\",\r\n        variant: \"destructive\"\r\n      });\r\n      return [];\r\n    }\r\n  }, [userId, currentBusiness?.id, sortOrder, pageSize, toast]);\r\n\r\n  // React Query caching with persistent storage for improved performance\r\n  const baseQueryKey = useMemo(() => ['sales', currentBusiness?.id, userId], [currentBusiness?.id, userId]);\r\n  const queryKey = useMemo(() => [...baseQueryKey, sortOrder, pageSize], [baseQueryKey, sortOrder, pageSize]);\r\n\r\n  const {\r\n    data: sales = [],\r\n    isLoading: isQueryLoading,\r\n    isFetching,\r\n    refetch\r\n  } = useQuery({\r\n    queryKey,\r\n    queryFn: loadSales,\r\n    enabled: !!userId && !!currentBusiness?.id,\r\n    staleTime: 30_000,\r\n    gcTime: 30 * 60_000,\r\n    refetchOnWindowFocus: true,\r\n    refetchOnReconnect: true,\r\n  });\r\n\r\n  // Derived loading state\r\n  const isLoading = isQueryLoading || (isFetching && sales.length === 0);\r\n\r\n  const getTopCustomers = useMemo((): TopCustomer[] => {\r\n    // Skip quotes since they're not actual purchases\r\n    const nonQuoteSales = sales.filter(sale => sale.paymentStatus !== \"Quote\");\r\n\r\n    // Group sales by customer name\r\n    const customerMap = new Map<string, { total: number, count: number, customerId?: string }>();\r\n\r\n    nonQuoteSales.forEach(sale => {\r\n      const customerName = sale.customerName;\r\n      const saleTotal = sale.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);\r\n\r\n      if (!customerMap.has(customerName)) {\r\n        customerMap.set(customerName, {\r\n          total: saleTotal,\r\n          count: 1,\r\n          customerId: sale.customerId\r\n        });\r\n      } else {\r\n        const current = customerMap.get(customerName)!;\r\n        customerMap.set(customerName, {\r\n          total: current.total + saleTotal,\r\n          count: current.count + 1,\r\n          customerId: current.customerId || sale.customerId\r\n        });\r\n      }\r\n    });\r\n\r\n    // Convert map to array and sort by total purchases\r\n    return Array.from(customerMap.entries())\r\n      .map(([name, data]) => ({\r\n        id: data.customerId,\r\n        name,\r\n        totalPurchases: data.total,\r\n        orderCount: data.count\r\n      }))\r\n      .sort((a, b) => b.totalPurchases - a.totalPurchases);\r\n  }, [sales]);\r\n\r\n  // Memoize customer lifetime purchases function\r\n  const getCustomerLifetimePurchases = useMemo(() => {\r\n    return (customerName: string) => {\r\n      // Filter sales by customer name and exclude quotes\r\n      const customerSales = sales.filter(sale =>\r\n        sale.customerName.toLowerCase() === customerName.toLowerCase() &&\r\n        sale.paymentStatus !== \"Quote\"\r\n      );\r\n\r\n      // Calculate total purchase amount and count\r\n      const total = customerSales.reduce((sum, sale) =>\r\n        sum + sale.items.reduce((itemSum, item) => itemSum + (item.price * item.quantity), 0), 0\r\n      );\r\n\r\n      return {\r\n        total,\r\n        count: customerSales.length\r\n      };\r\n    };\r\n  }, [sales]);\r\n\r\n  const deleteSale = async (id: string) => {\r\n    try {\r\n      // First, find the sale to get its details for logging\r\n      const saleToDelete = sales.find(sale => sale.id === id);\r\n      if (!saleToDelete) {\r\n        throw new Error('Sale not found');\r\n      }\r\n\r\n      // Restore product quantities back to inventory (Only if it wasn't a quote which doesn't deduct stock)\r\n      if (saleToDelete.paymentStatus !== 'Quote' && saleToDelete.items.length > 0) {\r\n        console.log('Restoring product quantities via useInventoryActions...');\r\n        const success = await restoreStockForSale(saleToDelete.items, id, saleToDelete.receiptNumber, currentBusiness?.id);\r\n\r\n        if (!success) {\r\n          toast({\r\n            title: \"Inventory Update Warning\",\r\n            description: \"Sale deleted, but inventory restoration might have failed. Please check your stock levels.\",\r\n            variant: \"destructive\"\r\n          });\r\n        }\r\n      }\r\n\r\n      // Proceed to delete the sale via API Action\r\n      if (!currentBusiness?.id) {\r\n        throw new Error('Business context missing for deletion');\r\n      }\r\n\r\n      const result = await deleteSaleAction(id, currentBusiness.id);\r\n\r\n      if (!result.success) {\r\n        throw new Error(result.error);\r\n      }\r\n\r\n      // Update React Query cache\r\n      queryClient.setQueryData(queryKey, (oldData: Sale[] | undefined) => {\r\n        return oldData ? oldData.filter(sale => sale.id !== id) : [];\r\n      });\r\n      queryClient.invalidateQueries({ queryKey: baseQueryKey });\r\n\r\n      // Clear sold items cache after deletion\r\n      clearSoldItemsCache();\r\n\r\n      // Log activity for sale deletion\r\n      await logActivity({\r\n        activityType: 'DELETE',\r\n        module: 'SALES',\r\n        entityType: 'sale',\r\n        entityId: id,\r\n        entityName: `Sale #${saleToDelete.receiptNumber}`,\r\n        description: `Deleted sale for ${saleToDelete.customerName} - Total: UGX ${((saleToDelete.amountPaid || 0) + (saleToDelete.amountDue || 0)).toLocaleString()} (Stock restored)`,\r\n        metadata: {\r\n          receiptNumber: saleToDelete.receiptNumber,\r\n          customerName: saleToDelete.customerName,\r\n          customerAddress: saleToDelete.customerAddress,\r\n          customerContact: saleToDelete.customerContact,\r\n          totalAmount: (saleToDelete.amountPaid || 0) + (saleToDelete.amountDue || 0),\r\n          amountPaid: saleToDelete.amountPaid,\r\n          profit: saleToDelete.profit,\r\n          paymentStatus: saleToDelete.paymentStatus,\r\n          taxRate: saleToDelete.taxRate,\r\n          itemCount: saleToDelete.items.length,\r\n          items: saleToDelete.items.map(item => ({\r\n            description: item.description,\r\n            quantity: item.quantity,\r\n            price: item.price,\r\n            cost: item.cost,\r\n            total: item.quantity * item.price,\r\n            discountPercentage: item.discountPercentage,\r\n            discountAmount: item.discountAmount\r\n          })),\r\n          notes: saleToDelete.notes,\r\n          cashTransactionDeleted: !!saleToDelete.cashTransactionId\r\n        }\r\n      });\r\n\r\n      toast({\r\n        title: \"Sale Deleted\",\r\n        description: \"The sale record and associated data have been successfully deleted.\"\r\n      });\r\n\r\n      clearInventoryCaches();\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error deleting sale:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to delete sale. Please try again.\",\r\n        variant: \"destructive\"\r\n      });\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const clearSoldItemsCache = useCallback(() => {\r\n    if (!currentBusiness?.id) return;\r\n    const key = `soldItemsFilters_${currentBusiness.id}`;\r\n    localStorage.removeItem(key);\r\n\r\n    // Also clear legacy keys for safety\r\n    localStorage.removeItem('soldItemsFilters');\r\n  }, [currentBusiness?.id]);\r\n\r\n  const addSale = useCallback((newSale: Sale) => {\r\n    queryClient.setQueryData(queryKey, (oldData: Sale[] | undefined) => {\r\n      return oldData ? [newSale, ...oldData] : [newSale];\r\n    });\r\n    queryClient.invalidateQueries({ queryKey: baseQueryKey });\r\n    clearSoldItemsCache();\r\n    clearInventoryCaches();\r\n  }, [queryClient, queryKey, baseQueryKey, clearSoldItemsCache, clearInventoryCaches]);\r\n\r\n  const updateSale = useCallback((updatedSale: Sale) => {\r\n    queryClient.setQueryData(queryKey, (oldData: Sale[] | undefined) => {\r\n      return oldData ? oldData.map(s => s.id === updatedSale.id ? updatedSale : s) : [updatedSale];\r\n    });\r\n    queryClient.invalidateQueries({ queryKey: baseQueryKey });\r\n    clearSoldItemsCache();\r\n    clearInventoryCaches();\r\n  }, [queryClient, queryKey, baseQueryKey, clearSoldItemsCache, clearInventoryCaches]);\r\n\r\n  return {\r\n    sales,\r\n    isLoading,\r\n    deleteSale,\r\n    addSale,\r\n    updateSale,\r\n    getTopCustomers,\r\n    getCustomerLifetimePurchases,\r\n    clearSoldItemsCache,\r\n    refetch,\r\n    isFetching\r\n  };\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1791, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useExpenses.ts"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\r\nimport {\r\n  getExpensesAction,\r\n  createExpenseAction,\r\n  updateExpenseAction,\r\n  deleteExpenseAction,\r\n  createBulkCashTransactionsAction,\r\n  ExpenseInput\r\n} from '@/app/actions/finance';\r\nimport { useAuth } from '@/components/auth/AuthProvider';\r\n\r\nexport interface Expense {\r\n  id: string;\r\n  amount: number;\r\n  description: string;\r\n  category?: string;\r\n  date: Date;\r\n  paymentMethod?: string;\r\n  personInCharge?: string;\r\n  receiptImage?: string;\r\n  cashAccountId?: string;\r\n  cashTransactionId?: string;\r\n  createdAt: Date;\r\n  updatedAt: Date;\r\n}\r\n\r\nexport const useExpenses = () => {\r\n  const [expenses, setExpenses] = useState<Expense[]>([]);\r\n  const { toast } = useToast();\r\n  const { currentBusiness } = useBusiness();\r\n  const { user } = useAuth();\r\n  const queryClient = useQueryClient();\r\n\r\n  const loadExpenses = useCallback(async (): Promise<Expense[]> => {\r\n    if (!currentBusiness) {\r\n      return [];\r\n    }\r\n\r\n    try {\r\n      const result = await getExpensesAction(currentBusiness.id);\r\n\r\n      if (!result.success || !result.data) {\r\n        throw new Error(result.error || 'Failed to fetch expenses');\r\n      }\r\n\r\n      const formattedExpenses: Expense[] = result.data.map((expense: any) => ({\r\n        id: expense.id,\r\n        amount: Number(expense.amount),\r\n        description: expense.description,\r\n        category: expense.category,\r\n        date: new Date(expense.date),\r\n        paymentMethod: expense.paymentMethod,\r\n        personInCharge: expense.personInCharge,\r\n        receiptImage: expense.receiptImage,\r\n        cashAccountId: expense.cashAccountId,\r\n        cashTransactionId: expense.cashTransactionId,\r\n        createdAt: new Date(expense.createdAt),\r\n        updatedAt: new Date(expense.updatedAt)\r\n      }));\r\n\r\n      return formattedExpenses;\r\n    } catch (error) {\r\n      console.error('Error loading expenses:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to load expenses. Please try again.\",\r\n        variant: \"destructive\"\r\n      });\r\n      return [];\r\n    }\r\n  }, [currentBusiness?.id, toast]);\r\n\r\n  // React Query caching\r\n  const queryKey = ['expenses', currentBusiness?.id];\r\n  const { data: queriedExpenses, isLoading: isQueryLoading, isFetching } = useQuery({\r\n    queryKey,\r\n    queryFn: loadExpenses,\r\n    enabled: !!currentBusiness?.id,\r\n    staleTime: 5 * 60_000,\r\n    gcTime: 30 * 60_000,\r\n    refetchOnWindowFocus: false,\r\n    refetchOnReconnect: false,\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (queriedExpenses) {\r\n      setExpenses(queriedExpenses);\r\n    }\r\n  }, [queriedExpenses]);\r\n\r\n  // Only report loading when there is no cached data yet to avoid skeleton flash\r\n  const isLoading = isQueryLoading && !queriedExpenses;\r\n\r\n  const createExpense = async (expenseData: {\r\n    amount: number;\r\n    description: string;\r\n    category?: string;\r\n    date: Date;\r\n    paymentMethod?: string;\r\n    personInCharge?: string;\r\n    receiptImage?: string;\r\n    linkToCash?: boolean;\r\n    cashAccountId?: string;\r\n  }) => {\r\n    if (!currentBusiness || !user) {\r\n      toast({\r\n        title: \"Error\",\r\n        description: !currentBusiness ? \"No business selected\" : \"User not authenticated\",\r\n        variant: \"destructive\"\r\n      });\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const input: ExpenseInput = {\r\n        amount: expenseData.amount,\r\n        description: expenseData.description,\r\n        category: expenseData.category,\r\n        date: expenseData.date,\r\n        paymentMethod: expenseData.paymentMethod,\r\n        personInCharge: expenseData.personInCharge,\r\n        receiptImage: expenseData.receiptImage,\r\n        cashAccountId: expenseData.cashAccountId,\r\n        userId: user.id,\r\n        locationId: currentBusiness.id\r\n      };\r\n\r\n      const result = await createExpenseAction(input, !!expenseData.linkToCash);\r\n\r\n      if (!result.success || !result.data) {\r\n        throw new Error(result.error);\r\n      }\r\n\r\n      const data = result.data;\r\n      const newExpense: Expense = {\r\n        id: data.id,\r\n        amount: Number(data.amount),\r\n        description: data.description,\r\n        category: data.category,\r\n        date: new Date(data.date),\r\n        paymentMethod: data.paymentMethod,\r\n        personInCharge: data.personInCharge,\r\n        receiptImage: data.receiptImage,\r\n        cashAccountId: data.cashAccountId,\r\n        cashTransactionId: data.cashTransactionId,\r\n        createdAt: new Date(data.createdAt),\r\n        updatedAt: new Date(data.updatedAt)\r\n      };\r\n\r\n      // Update local state and cache\r\n      setExpenses(prev => [newExpense, ...prev]);\r\n      queryClient.setQueryData(queryKey, (oldData: Expense[] | undefined) => {\r\n        return oldData ? [newExpense, ...oldData] : [newExpense];\r\n      });\r\n\r\n      queryClient.invalidateQueries({ queryKey });\r\n\r\n      toast({\r\n        title: \"Success\",\r\n        description: \"Expense created successfully\"\r\n      });\r\n\r\n      return newExpense;\r\n    } catch (error) {\r\n      console.error('Error creating expense:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to create expense. Please try again.\",\r\n        variant: \"destructive\"\r\n      });\r\n    }\r\n  };\r\n\r\n  const updateExpense = async (id: string, updates: Partial<Expense & { linkToCash?: boolean }>) => {\r\n    try {\r\n      const currentExpense = expenses.find(exp => exp.id === id);\r\n      if (!currentExpense) throw new Error('Expense not found');\r\n\r\n      // Prepare update payload\r\n      const updatePayload = {\r\n        amount: updates.amount !== undefined ? updates.amount : currentExpense.amount,\r\n        description: updates.description !== undefined ? updates.description : currentExpense.description,\r\n        category: updates.category !== undefined ? updates.category : currentExpense.category,\r\n        date: updates.date !== undefined ? updates.date : currentExpense.date,\r\n        paymentMethod: updates.paymentMethod !== undefined ? updates.paymentMethod : currentExpense.paymentMethod,\r\n        personInCharge: updates.personInCharge !== undefined ? updates.personInCharge : currentExpense.personInCharge,\r\n        receiptImage: updates.receiptImage !== undefined ? updates.receiptImage : currentExpense.receiptImage,\r\n        cashAccountId: updates.linkToCash ? updates.cashAccountId : (updates.linkToCash === false ? null : currentExpense.cashAccountId)\r\n      };\r\n\r\n      const result = await updateExpenseAction(id, updatePayload, currentExpense);\r\n\r\n      if (!result.success) throw new Error(result.error);\r\n\r\n      queryClient.invalidateQueries({ queryKey });\r\n\r\n      toast({\r\n        title: \"Success\",\r\n        description: \"Expense updated successfully\"\r\n      });\r\n    } catch (error) {\r\n      console.error('Error updating expense:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to update expense. Please try again.\",\r\n        variant: \"destructive\"\r\n      });\r\n    }\r\n  };\r\n\r\n  const deleteExpense = async (id: string) => {\r\n    try {\r\n      const result = await deleteExpenseAction(id);\r\n      if (!result.success) throw new Error(result.error);\r\n\r\n      // Optimistic update\r\n      setExpenses(prev => prev.filter(e => e.id !== id));\r\n      queryClient.setQueryData(queryKey, (old: any) => {\r\n        if (!old) return old;\r\n        return (old as Expense[]).filter(e => e.id !== id);\r\n      });\r\n      queryClient.invalidateQueries({ queryKey });\r\n\r\n      toast({\r\n        title: \"Success\",\r\n        description: \"Expense deleted successfully\"\r\n      });\r\n\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error deleting expense:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to delete expense. Please try again.\",\r\n        variant: \"destructive\"\r\n      });\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const refreshExpenses = async () => {\r\n    queryClient.invalidateQueries({ queryKey });\r\n  };\r\n\r\n  const createBulkExpenses = async (expensesData: {\r\n    amount: number;\r\n    description: string;\r\n    category?: string;\r\n    date: Date;\r\n    paymentMethod?: string;\r\n    personInCharge?: string;\r\n    receiptImage?: string;\r\n    linkToCash?: boolean;\r\n    cashAccountId?: string;\r\n  }[]) => {\r\n    if (!currentBusiness || !user) {\r\n      toast({\r\n        title: \"Error\",\r\n        description: !currentBusiness ? \"No business selected\" : \"User not authenticated\",\r\n        variant: \"destructive\"\r\n      });\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const bulkResults: Expense[] = [];\r\n\r\n      // For bulk, since each might need individual linking logic in the action, \r\n      // we'll loop calling the createExpenseAction or we could implement a bulk action.\r\n      // Reusing createExpenseAction is simpler for now as it handles the transaction.\r\n      for (const data of expensesData) {\r\n        const input: ExpenseInput = {\r\n          amount: data.amount,\r\n          description: data.description,\r\n          category: data.category,\r\n          date: data.date,\r\n          paymentMethod: data.paymentMethod,\r\n          personInCharge: data.personInCharge,\r\n          receiptImage: data.receiptImage,\r\n          cashAccountId: data.cashAccountId,\r\n          userId: user.id,\r\n          locationId: currentBusiness.id\r\n        };\r\n\r\n        const result = await createExpenseAction(input, !!data.linkToCash);\r\n\r\n        if (result.success && result.data) {\r\n          const e = result.data;\r\n          bulkResults.push({\r\n            id: e.id,\r\n            amount: Number(e.amount),\r\n            description: e.description,\r\n            category: e.category,\r\n            date: new Date(e.date),\r\n            paymentMethod: e.paymentMethod,\r\n            personInCharge: e.personInCharge,\r\n            receiptImage: e.receiptImage,\r\n            cashAccountId: e.cashAccountId,\r\n            cashTransactionId: e.cashTransactionId,\r\n            createdAt: new Date(e.createdAt),\r\n            updatedAt: new Date(e.updatedAt)\r\n          });\r\n        }\r\n      }\r\n\r\n      queryClient.invalidateQueries({ queryKey });\r\n\r\n      toast({\r\n        title: \"Success\",\r\n        description: `Successfully created ${bulkResults.length} expenses`\r\n      });\r\n\r\n      return bulkResults;\r\n    } catch (error) {\r\n      console.error('Error creating bulk expenses:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to create bulk expenses. Please try again.\",\r\n        variant: \"destructive\"\r\n      });\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  return {\r\n    expenses,\r\n    isLoading,\r\n    createExpense,\r\n    createBulkExpenses,\r\n    updateExpense,\r\n    deleteExpense,\r\n    refreshExpenses\r\n  };\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2112, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useStockSummaryData.ts"],"sourcesContent":["import { useAuth } from '@/components/auth/AuthProvider';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\r\nimport { supabase } from '@/integrations/supabase/client';\r\n\r\nexport interface StockSummaryData {\r\n  productId: string;\r\n  productName: string;\r\n  itemNumber: string;\r\n  imageUrl?: string | null;\r\n  costPrice: number;\r\n  sellingPrice: number;\r\n  category?: string;\r\n  openingStock: number;\r\n  itemsSold: number;\r\n  stockIn: number;\r\n  transferOut: number;\r\n  returnIn: number;\r\n  returnOut: number;\r\n  returnOut: number;\r\n  adjustmentsIn: number;\r\n  adjustmentsOut: number;\r\n  closingStock: number;\r\n  revaluation: number;\r\n}\r\n\r\nexport const useStockSummaryData = (\r\n  dateRange: { from: Date | undefined; to: Date | undefined }\r\n) => {\r\n  const { user } = useAuth();\r\n  const { currentBusiness } = useBusiness();\r\n  const queryClient = useQueryClient();\r\n\r\n  const fetchStockSummary = async (): Promise<StockSummaryData[]> => {\r\n    if (!user?.id || !currentBusiness?.id || !dateRange?.from || !dateRange?.to) return [];\r\n\r\n    console.log('[StockSummary] Fetching report...', {\r\n      location: currentBusiness.id,\r\n      from: dateRange.from.toISOString(),\r\n      to: dateRange.to.toISOString()\r\n    });\r\n\r\n    // We use \"as any\" to bypass strict type checking during this debug phase\r\n    const { data, error } = await (supabase.rpc as any)('get_stock_summary_report', {\r\n      p_location_id: currentBusiness.id,\r\n      p_start_date: dateRange.from.toISOString(),\r\n      p_end_date: dateRange.to.toISOString()\r\n    });\r\n\r\n    if (error) {\r\n      // LOG AS STRING SO IT IS VISIBLE IN THE USER LOGS\r\n      console.error('[StockSummary] CRITICAL ERROR MESSAGE:', error.message);\r\n      console.error('[StockSummary] FULL ERROR OBJECT:', JSON.stringify(error, null, 2));\r\n      throw error;\r\n    }\r\n\r\n    console.log('[StockSummary] SUCCESS. Rows received:', data?.length || 0);\r\n    return (data || []) as StockSummaryData[];\r\n  };\r\n\r\n  const { data: stockSummaryData = [], isLoading, refetch } = useQuery({\r\n    queryKey: ['stockSummary', currentBusiness?.id, dateRange.from?.toISOString(), dateRange.to?.toISOString()],\r\n    queryFn: fetchStockSummary,\r\n    enabled: !!user?.id && !!currentBusiness?.id && !!dateRange?.from && !!dateRange?.to,\r\n    staleTime: 5 * 60 * 1000,\r\n    gcTime: 30 * 60 * 1000,\r\n  });\r\n\r\n  return {\r\n    stockSummaryData,\r\n    isLoading,\r\n    loadStockSummaryData: refetch,\r\n    clearCache: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['stockSummary'] });\r\n    },\r\n    clearAllLocationCaches: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['stockSummary'] });\r\n    }\r\n  };\r\n};\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AAAA;AACA;;;;;;AAuBO,MAAM,sBAAsB,CACjC;;IAEA,MAAM,EAAE,IAAI,EAAE,GAAG,IAAA,wJAAO;IACxB,MAAM,EAAE,eAAe,EAAE,GAAG,IAAA,qJAAW;IACvC,MAAM,cAAc,IAAA,2MAAc;IAElC,MAAM,oBAAoB;QACxB,IAAI,CAAC,MAAM,MAAM,CAAC,iBAAiB,MAAM,CAAC,WAAW,QAAQ,CAAC,WAAW,IAAI,OAAO,EAAE;QAEtF,QAAQ,GAAG,CAAC,qCAAqC;YAC/C,UAAU,gBAAgB,EAAE;YAC5B,MAAM,UAAU,IAAI,CAAC,WAAW;YAChC,IAAI,UAAU,EAAE,CAAC,WAAW;QAC9B;QAEA,yEAAyE;QACzE,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,AAAC,wJAAQ,CAAC,GAAG,CAAS,4BAA4B;YAC9E,eAAe,gBAAgB,EAAE;YACjC,cAAc,UAAU,IAAI,CAAC,WAAW;YACxC,YAAY,UAAU,EAAE,CAAC,WAAW;QACtC;QAEA,IAAI,OAAO;YACT,kDAAkD;YAClD,QAAQ,KAAK,CAAC,0CAA0C,MAAM,OAAO;YACrE,QAAQ,KAAK,CAAC,qCAAqC,KAAK,SAAS,CAAC,OAAO,MAAM;YAC/E,MAAM;QACR;QAEA,QAAQ,GAAG,CAAC,0CAA0C,MAAM,UAAU;QACtE,OAAQ,QAAQ,EAAE;IACpB;IAEA,MAAM,EAAE,MAAM,mBAAmB,EAAE,EAAE,SAAS,EAAE,OAAO,EAAE,GAAG,IAAA,0LAAQ,EAAC;QACnE,UAAU;YAAC;YAAgB,iBAAiB;YAAI,UAAU,IAAI,EAAE;YAAe,UAAU,EAAE,EAAE;SAAc;QAC3G,SAAS;QACT,SAAS,CAAC,CAAC,MAAM,MAAM,CAAC,CAAC,iBAAiB,MAAM,CAAC,CAAC,WAAW,QAAQ,CAAC,CAAC,WAAW;QAClF,WAAW,IAAI,KAAK;QACpB,QAAQ,KAAK,KAAK;IACpB;IAEA,OAAO;QACL;QACA;QACA,sBAAsB;QACtB,YAAY;YACV,YAAY,iBAAiB,CAAC;gBAAE,UAAU;oBAAC;iBAAe;YAAC;QAC7D;QACA,wBAAwB;YACtB,YAAY,iBAAiB,CAAC;gBAAE,UAAU;oBAAC;iBAAe;YAAC;QAC7D;IACF;AACF;GArDa;;QAGM,wJAAO;QACI,qJAAW;QACnB,2MAAc;QA6B0B,0LAAQ"}},
    {"offset": {"line": 2200, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useCarriageInwards.ts"],"sourcesContent":["\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport { supabase } from '@/integrations/supabase/client';\r\nimport { useAuth } from '@/components/auth/AuthProvider';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\nimport { useToast } from '@/hooks/use-toast';\r\n\r\nexport interface CarriageInward {\r\n  id: string;\r\n  userId: string;\r\n  locationId: string;\r\n  supplierName: string;\r\n  details: string;\r\n  amount: number;\r\n  date: Date;\r\n  cashAccountId?: string;\r\n  cashTransactionId?: string;\r\n  createdAt: Date;\r\n  updatedAt: Date;\r\n}\r\n\r\nexport interface CarriageInwardFormData {\r\n  supplierName: string;\r\n  details: string;\r\n  amount: number;\r\n  date: Date;\r\n  cashAccountId?: string;\r\n}\r\n\r\nexport const useCarriageInwards = () => {\r\n  const [carriageInwards, setCarriageInwards] = useState<CarriageInward[]>([]);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const { user } = useAuth();\r\n  const { currentBusiness } = useBusiness();\r\n  const { toast } = useToast();\r\n\r\n  const loadCarriageInwards = useCallback(async () => {\r\n    try {\r\n      if (!user || !currentBusiness) {\r\n        setCarriageInwards([]);\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n\r\n      setIsLoading(true);\r\n      \r\n      const { data, error } = await supabase\r\n        .from('carriage_inwards')\r\n        .select('*')\r\n        .eq('location_id', currentBusiness.id)\r\n        .order('date', { ascending: false })\r\n        .order('created_at', { ascending: false });\r\n\r\n      if (error) throw error;\r\n\r\n      const formattedData: CarriageInward[] = data?.map(item => ({\r\n        id: item.id,\r\n        userId: item.user_id,\r\n        locationId: item.location_id,\r\n        supplierName: item.supplier_name,\r\n        details: item.details,\r\n        amount: Number(item.amount),\r\n        date: new Date(item.date),\r\n        cashAccountId: item.cash_account_id,\r\n        cashTransactionId: item.cash_transaction_id,\r\n        createdAt: new Date(item.created_at),\r\n        updatedAt: new Date(item.updated_at)\r\n      })) || [];\r\n\r\n      setCarriageInwards(formattedData);\r\n    } catch (error) {\r\n      console.error('Error loading carriage inwards:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to load carriage inwards records. Please try again.\",\r\n        variant: \"destructive\"\r\n      });\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, [user, currentBusiness?.id, toast]);\r\n\r\n  const createCarriageInward = async (data: CarriageInwardFormData) => {\r\n    try {\r\n      if (!user || !currentBusiness) throw new Error('User not authenticated or no business selected');\r\n\r\n      let cashTransactionId = null;\r\n\r\n      // Create cash transaction if cash account is selected\r\n      if (data.cashAccountId) {\r\n        const { data: cashTransaction, error: cashError } = await supabase\r\n          .from('cash_transactions')\r\n          .insert({\r\n            user_id: user.id,\r\n            location_id: currentBusiness.id,\r\n            account_id: data.cashAccountId,\r\n            amount: data.amount,\r\n            transaction_type: 'cash_out',\r\n            category: 'Transport',\r\n            description: `Carriage inwards - ${data.supplierName}: ${data.details}`,\r\n            date: data.date.toISOString().split('T')[0]\r\n          })\r\n          .select()\r\n          .single();\r\n\r\n        if (cashError) throw cashError;\r\n        cashTransactionId = cashTransaction.id;\r\n      }\r\n\r\n      const { data: carriageData, error } = await supabase\r\n        .from('carriage_inwards')\r\n        .insert({\r\n          user_id: user.id,\r\n          location_id: currentBusiness.id,\r\n          supplier_name: data.supplierName,\r\n          details: data.details,\r\n          amount: data.amount,\r\n          date: data.date.toISOString().split('T')[0],\r\n          cash_account_id: data.cashAccountId || null,\r\n          cash_transaction_id: cashTransactionId\r\n        })\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      await loadCarriageInwards();\r\n      \r\n      toast({\r\n        title: \"Success\",\r\n        description: \"Carriage inwards record created successfully\"\r\n      });\r\n\r\n      return carriageData;\r\n    } catch (error) {\r\n      console.error('Error creating carriage inwards:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to create carriage inwards record. Please try again.\",\r\n        variant: \"destructive\"\r\n      });\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  const updateCarriageInward = async (id: string, updates: Partial<CarriageInwardFormData>) => {\r\n    try {\r\n      if (!currentBusiness) throw new Error('No business selected');\r\n\r\n      const updateData: any = {};\r\n      \r\n      if (updates.supplierName !== undefined) updateData.supplier_name = updates.supplierName;\r\n      if (updates.details !== undefined) updateData.details = updates.details;\r\n      if (updates.amount !== undefined) updateData.amount = updates.amount;\r\n      if (updates.date !== undefined) updateData.date = updates.date.toISOString().split('T')[0];\r\n\r\n      const { error } = await supabase\r\n        .from('carriage_inwards')\r\n        .update(updateData)\r\n        .eq('id', id)\r\n        .eq('location_id', currentBusiness.id);\r\n\r\n      if (error) throw error;\r\n\r\n      await loadCarriageInwards();\r\n      \r\n      toast({\r\n        title: \"Success\",\r\n        description: \"Carriage inwards record updated successfully\"\r\n      });\r\n\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error updating carriage inwards:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to update carriage inwards record. Please try again.\",\r\n        variant: \"destructive\"\r\n      });\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const deleteCarriageInward = async (id: string) => {\r\n    try {\r\n      if (!currentBusiness) throw new Error('No business selected');\r\n\r\n      // Get the record to check if it has an associated cash transaction\r\n      const { data: record, error: fetchError } = await supabase\r\n        .from('carriage_inwards')\r\n        .select('cash_transaction_id')\r\n        .eq('id', id)\r\n        .eq('location_id', currentBusiness.id)\r\n        .single();\r\n\r\n      if (fetchError) throw fetchError;\r\n\r\n      // Delete associated cash transaction if exists\r\n      if (record.cash_transaction_id) {\r\n        const { error: cashError } = await supabase\r\n          .from('cash_transactions')\r\n          .delete()\r\n          .eq('id', record.cash_transaction_id)\r\n          .eq('location_id', currentBusiness.id);\r\n\r\n        if (cashError) throw cashError;\r\n      }\r\n\r\n      // Delete the carriage inwards record\r\n      const { error } = await supabase\r\n        .from('carriage_inwards')\r\n        .delete()\r\n        .eq('id', id)\r\n        .eq('location_id', currentBusiness.id);\r\n\r\n      if (error) throw error;\r\n\r\n      await loadCarriageInwards();\r\n      \r\n      toast({\r\n        title: \"Success\",\r\n        description: \"Carriage inwards record deleted successfully\"\r\n      });\r\n\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error deleting carriage inwards:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to delete carriage inwards record. Please try again.\",\r\n        variant: \"destructive\"\r\n      });\r\n      return false;\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    loadCarriageInwards();\r\n  }, [loadCarriageInwards]);\r\n\r\n  return {\r\n    carriageInwards,\r\n    isLoading,\r\n    createCarriageInward,\r\n    updateCarriageInward,\r\n    deleteCarriageInward,\r\n    refreshCarriageInwards: loadCarriageInwards\r\n  };\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2401, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useProfitLossData.ts"],"sourcesContent":["\r\nimport { useState, useEffect, useMemo } from 'react';\r\nimport { useAuth } from '@/components/auth/AuthProvider';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\nimport { useSalesData } from '@/hooks/useSalesData';\r\nimport { useExpenses } from '@/hooks/useExpenses';\r\nimport { useStockSummaryData } from '@/hooks/useStockSummaryData';\r\nimport { useCarriageInwards } from '@/hooks/useCarriageInwards';\r\nimport { getDateRangeFromFilter } from '@/utils/dateFilters';\r\nimport { isSameDay } from 'date-fns';\r\n\r\nexport interface ProfitLossData {\r\n  sales: number;\r\n  salesReturns: number;\r\n  netSales: number;\r\n  openingStock: number;\r\n  purchases: number;\r\n  carriageInwards: number;\r\n  closingStock: number;\r\n  totalCostSales: number; // Added for new COGS calculation\r\n  totalCOGS: number;\r\n  grossProfit: number;\r\n  expensesByCategory: { [key: string]: number };\r\n  totalExpenses: number;\r\n  netProfitLoss: number;\r\n  taxPercentage: number;\r\n  taxAmount: number;\r\n  finalProfitAfterTax: number;\r\n}\r\n\r\nexport const useProfitLossData = (\r\n  dateFilter: string,\r\n  dateRange: { from: Date | undefined; to: Date | undefined },\r\n  specificDate: Date | undefined,\r\n  taxPercentage: number = 0\r\n) => {\r\n  const { user } = useAuth();\r\n  const { currentBusiness } = useBusiness();\r\n  const [isLoading, setIsLoading] = useState(false);\r\n\r\n  // Get data from existing hooks\r\n  const { sales, isLoading: salesLoading } = useSalesData(user?.id);\r\n  const { expenses, isLoading: expensesLoading } = useExpenses();\r\n  const { stockSummaryData, isLoading: stockLoading } = useStockSummaryData(dateRange);\r\n  const { carriageInwards, isLoading: carriageLoading } = useCarriageInwards();\r\n\r\n  const profitLossData = useMemo((): ProfitLossData => {\r\n    // Calculate date range using the same logic as sold items report\r\n    let from: Date, to: Date;\r\n\r\n    if (dateFilter === 'specific' && specificDate) {\r\n      from = new Date(specificDate);\r\n      from.setHours(0, 0, 0, 0);\r\n      to = new Date(specificDate);\r\n      to.setHours(23, 59, 59, 999);\r\n    } else if (dateFilter === 'custom' && dateRange.from && dateRange.to) {\r\n      from = dateRange.from;\r\n      to = dateRange.to;\r\n    } else {\r\n      const range = getDateRangeFromFilter(dateFilter);\r\n      from = range.from;\r\n      to = range.to;\r\n    }\r\n\r\n    // Filter sales by date range and exclude quotes using same logic as sold items report\r\n    const filteredSales = sales.filter(sale => {\r\n      const saleDate = new Date(sale.date);\r\n      \r\n      if (dateFilter === 'specific' && specificDate) {\r\n        return isSameDay(saleDate, specificDate) && sale.paymentStatus !== 'Quote';\r\n      }\r\n      \r\n      return saleDate >= from && saleDate <= to && sale.paymentStatus !== 'Quote';\r\n    });\r\n\r\n    // Filter expenses by date range using same logic\r\n    const filteredExpenses = expenses.filter(expense => {\r\n      const expenseDate = new Date(expense.date);\r\n      \r\n      if (dateFilter === 'specific' && specificDate) {\r\n        return isSameDay(expenseDate, specificDate);\r\n      }\r\n      \r\n      return expenseDate >= from && expenseDate <= to;\r\n    });\r\n\r\n    // Filter carriage inwards by date range using same logic\r\n    const filteredCarriageInwards = carriageInwards.filter(record => {\r\n      const recordDate = new Date(record.date);\r\n      \r\n      if (dateFilter === 'specific' && specificDate) {\r\n        return isSameDay(recordDate, specificDate);\r\n      }\r\n      \r\n      return recordDate >= from && recordDate <= to;\r\n    });\r\n\r\n    // Calculate Sales/Revenue\r\n    const totalSales = filteredSales.reduce((sum, sale) => {\r\n      return sum + sale.items.reduce((itemSum, item) => itemSum + (item.price * item.quantity), 0);\r\n    }, 0);\r\n\r\n    // Calculate Sales Returns (Return In using selling price)\r\n    const totalSalesReturns = stockSummaryData.reduce((sum, item) => {\r\n      return sum + (item.returnIn * item.sellingPrice);\r\n    }, 0);\r\n\r\n    // Net Sales\r\n    const netSales = totalSales - totalSalesReturns;\r\n\r\n    // Calculate Opening Stock value (using cost price)\r\n    const totalOpeningStock = stockSummaryData.reduce((sum, item) => {\r\n      return sum + (item.openingStock * item.costPrice);\r\n    }, 0);\r\n\r\n    // Calculate Purchases (Stock In value using cost price)\r\n    const totalPurchases = stockSummaryData.reduce((sum, item) => {\r\n      return sum + (item.stockIn * item.costPrice);\r\n    }, 0);\r\n\r\n    // Calculate Carriage Inwards\r\n    const totalCarriageInwards = filteredCarriageInwards.reduce((sum, record) => {\r\n      return sum + record.amount;\r\n    }, 0);\r\n\r\n    // Calculate Closing Stock value (using cost price)\r\n    const totalClosingStock = stockSummaryData.reduce((sum, item) => {\r\n      return sum + (item.closingStock * item.costPrice);\r\n    }, 0);\r\n\r\n    // Calculate Total Cost of Sales (cost price of all items sold)\r\n    const totalCostSales = filteredSales.reduce((sum, sale) => {\r\n      return sum + sale.items.reduce((itemSum, item) => itemSum + ((item.cost || 0) * item.quantity), 0);\r\n    }, 0);\r\n\r\n    // Total COGS = Total Cost Sales + Carriage Inwards\r\n    const totalCOGS = totalCostSales + totalCarriageInwards;\r\n\r\n    // Gross Profit\r\n    const grossProfit = netSales - totalCOGS;\r\n\r\n    // Group expenses by category\r\n    const expensesByCategory: { [key: string]: number } = {};\r\n    filteredExpenses.forEach(expense => {\r\n      const category = expense.category || 'Uncategorized';\r\n      expensesByCategory[category] = (expensesByCategory[category] || 0) + expense.amount;\r\n    });\r\n\r\n    // Total Expenses\r\n    const totalExpenses = Object.values(expensesByCategory).reduce((sum, amount) => sum + amount, 0);\r\n\r\n    // Net Profit/Loss\r\n    const netProfitLoss = grossProfit - totalExpenses;\r\n\r\n    // Tax calculations\r\n    const taxAmount = netProfitLoss > 0 ? (netProfitLoss * taxPercentage) / 100 : 0;\r\n    const finalProfitAfterTax = netProfitLoss - taxAmount;\r\n\r\n    return {\r\n      sales: totalSales,\r\n      salesReturns: totalSalesReturns,\r\n      netSales,\r\n      openingStock: totalOpeningStock,\r\n      purchases: totalPurchases,\r\n      carriageInwards: totalCarriageInwards,\r\n      closingStock: totalClosingStock,\r\n      totalCostSales,\r\n      totalCOGS,\r\n      grossProfit,\r\n      expensesByCategory,\r\n      totalExpenses,\r\n      netProfitLoss,\r\n      taxPercentage,\r\n      taxAmount,\r\n      finalProfitAfterTax\r\n    };\r\n  }, [sales, expenses, stockSummaryData, carriageInwards, dateFilter, dateRange, specificDate, taxPercentage]);\r\n\r\n  const loading = useMemo(() => {\r\n    return salesLoading || expensesLoading || stockLoading || carriageLoading;\r\n  }, [salesLoading, expensesLoading, stockLoading, carriageLoading]);\r\n\r\n  return {\r\n    profitLossData,\r\n    isLoading: loading\r\n  };\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2611, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useCashAccountRedirect.ts"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { CashAccount } from '@/types/cash';\r\n\r\nexport const useCashAccountRedirect = (accounts: CashAccount[]) => {\r\n  const navigate = useNavigate();\r\n  const [hasCheckedRedirect, setHasCheckedRedirect] = useState(false);\r\n\r\n  // Check for last visited cash account and redirect if found\r\n  useEffect(() => {\r\n    if (!hasCheckedRedirect && accounts.length > 0) {\r\n      const lastVisitedAccountId = localStorage.getItem('lastVisitedCashAccount');\r\n      const lastVisitedUrl = localStorage.getItem('lastVisitedCashAccountUrl');\r\n      \r\n      if (lastVisitedAccountId && lastVisitedUrl) {\r\n        // Verify the account still exists\r\n        const accountExists = accounts.some(acc => acc.id === lastVisitedAccountId);\r\n        if (accountExists) {\r\n          // Use the complete URL to preserve filters and pagination\r\n          navigate(lastVisitedUrl.replace(window.location.origin, ''));\r\n          return;\r\n        } else {\r\n          // Clean up invalid stored account data\r\n          localStorage.removeItem('lastVisitedCashAccount');\r\n          localStorage.removeItem('lastVisitedCashAccountUrl');\r\n        }\r\n      }\r\n      setHasCheckedRedirect(true);\r\n    }\r\n  }, [accounts, hasCheckedRedirect, navigate]);\r\n\r\n  return { hasCheckedRedirect };\r\n};"],"names":[],"mappings":";;;;AAAA;AACA;;;;AAGO,MAAM,yBAAyB,CAAC;;IACrC,MAAM,WAAW,IAAA,kLAAW;IAC5B,MAAM,CAAC,oBAAoB,sBAAsB,GAAG,IAAA,yKAAQ,EAAC;IAE7D,4DAA4D;IAC5D,IAAA,0KAAS;4CAAC;YACR,IAAI,CAAC,sBAAsB,SAAS,MAAM,GAAG,GAAG;gBAC9C,MAAM,uBAAuB,aAAa,OAAO,CAAC;gBAClD,MAAM,iBAAiB,aAAa,OAAO,CAAC;gBAE5C,IAAI,wBAAwB,gBAAgB;oBAC1C,kCAAkC;oBAClC,MAAM,gBAAgB,SAAS,IAAI;0EAAC,CAAA,MAAO,IAAI,EAAE,KAAK;;oBACtD,IAAI,eAAe;wBACjB,0DAA0D;wBAC1D,SAAS,eAAe,OAAO,CAAC,OAAO,QAAQ,CAAC,MAAM,EAAE;wBACxD;oBACF,OAAO;wBACL,uCAAuC;wBACvC,aAAa,UAAU,CAAC;wBACxB,aAAa,UAAU,CAAC;oBAC1B;gBACF;gBACA,sBAAsB;YACxB;QACF;2CAAG;QAAC;QAAU;QAAoB;KAAS;IAE3C,OAAO;QAAE;IAAmB;AAC9B;GA5Ba;;QACM,kLAAW"}}]
}