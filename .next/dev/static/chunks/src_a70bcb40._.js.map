{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/app/actions/business-settings.ts"],"sourcesContent":["'use server';\r\n\r\nimport { db } from '../../../prisma/db';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\nexport async function getBusinessSettingsAction(branchId: string) {\r\n    try {\r\n        const settings = await db.branchSettings.findUnique({\r\n            where: { branchId }\r\n        });\r\n\r\n        if (!settings) {\r\n            return null;\r\n        }\r\n\r\n        return {\r\n            id: settings.id,\r\n            business_name: settings.businessName,\r\n            business_address: settings.address,\r\n            business_phone: settings.phone,\r\n            business_email: settings.email,\r\n            business_logo: settings.logo,\r\n            currency: settings.currency,\r\n            signature: settings.signatureImage,\r\n            metadata: settings.metadata || {}\r\n        };\r\n    } catch (error) {\r\n        console.error('Error fetching business settings:', error);\r\n        return null;\r\n    }\r\n}\r\n\r\nexport async function upsertBusinessSettingsAction(branchId: string, userId: string, updateData: any) {\r\n    try {\r\n        // Validate user access to branch\r\n        const branch = await db.branch.findFirst({\r\n            where: {\r\n                id: branchId,\r\n                OR: [\r\n                    { adminId: userId },\r\n                    { users: { some: { id: userId } } }\r\n                ]\r\n            }\r\n        });\r\n\r\n        if (!branch) {\r\n            return { success: false, error: 'Unauthorized to update branch settings' };\r\n        }\r\n\r\n        const data = {\r\n            businessName: updateData.business_name,\r\n            address: updateData.business_address,\r\n            phone: updateData.business_phone,\r\n            email: updateData.business_email,\r\n            logo: updateData.business_logo,\r\n            currency: updateData.currency,\r\n            signatureImage: updateData.signature,\r\n            metadata: updateData.metadata\r\n        };\r\n\r\n        const upserted = await db.branchSettings.upsert({\r\n            where: { branchId: branchId },\r\n            update: data,\r\n            create: {\r\n                branchId: branchId,\r\n                ...data\r\n            }\r\n        });\r\n\r\n        return {\r\n            success: true,\r\n            data: {\r\n                id: upserted.id,\r\n                business_name: upserted.businessName,\r\n                business_address: upserted.address,\r\n                business_phone: upserted.phone,\r\n                business_email: upserted.email,\r\n                business_logo: upserted.logo,\r\n                currency: upserted.currency,\r\n                signature: upserted.signatureImage,\r\n                metadata: upserted.metadata\r\n            }\r\n        };\r\n    } catch (error: any) {\r\n        console.error('Error upserting business settings:', error);\r\n        return { success: false, error: error.message || 'Failed to update settings' };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MAKsB,wBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA,6DAAA"}},
    {"offset": {"line": 21, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/app/actions/business-settings.ts"],"sourcesContent":["'use server';\r\n\r\nimport { db } from '../../../prisma/db';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\nexport async function getBusinessSettingsAction(branchId: string) {\r\n    try {\r\n        const settings = await db.branchSettings.findUnique({\r\n            where: { branchId }\r\n        });\r\n\r\n        if (!settings) {\r\n            return null;\r\n        }\r\n\r\n        return {\r\n            id: settings.id,\r\n            business_name: settings.businessName,\r\n            business_address: settings.address,\r\n            business_phone: settings.phone,\r\n            business_email: settings.email,\r\n            business_logo: settings.logo,\r\n            currency: settings.currency,\r\n            signature: settings.signatureImage,\r\n            metadata: settings.metadata || {}\r\n        };\r\n    } catch (error) {\r\n        console.error('Error fetching business settings:', error);\r\n        return null;\r\n    }\r\n}\r\n\r\nexport async function upsertBusinessSettingsAction(branchId: string, userId: string, updateData: any) {\r\n    try {\r\n        // Validate user access to branch\r\n        const branch = await db.branch.findFirst({\r\n            where: {\r\n                id: branchId,\r\n                OR: [\r\n                    { adminId: userId },\r\n                    { users: { some: { id: userId } } }\r\n                ]\r\n            }\r\n        });\r\n\r\n        if (!branch) {\r\n            return { success: false, error: 'Unauthorized to update branch settings' };\r\n        }\r\n\r\n        const data = {\r\n            businessName: updateData.business_name,\r\n            address: updateData.business_address,\r\n            phone: updateData.business_phone,\r\n            email: updateData.business_email,\r\n            logo: updateData.business_logo,\r\n            currency: updateData.currency,\r\n            signatureImage: updateData.signature,\r\n            metadata: updateData.metadata\r\n        };\r\n\r\n        const upserted = await db.branchSettings.upsert({\r\n            where: { branchId: branchId },\r\n            update: data,\r\n            create: {\r\n                branchId: branchId,\r\n                ...data\r\n            }\r\n        });\r\n\r\n        return {\r\n            success: true,\r\n            data: {\r\n                id: upserted.id,\r\n                business_name: upserted.businessName,\r\n                business_address: upserted.address,\r\n                business_phone: upserted.phone,\r\n                business_email: upserted.email,\r\n                business_logo: upserted.logo,\r\n                currency: upserted.currency,\r\n                signature: upserted.signatureImage,\r\n                metadata: upserted.metadata\r\n            }\r\n        };\r\n    } catch (error: any) {\r\n        console.error('Error upserting business settings:', error);\r\n        return { success: false, error: error.message || 'Failed to update settings' };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MAgCsB,wBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA,gEAAA"}},
    {"offset": {"line": 38, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/app/actions/products.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { db } from '../../../prisma/db';\r\nimport { Product, ProductFormData, mapDbProductToProduct, mapProductToDbProduct } from '@/types';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\n// We implement server actions for the products here\r\n\r\nexport async function getProductsAction({\r\n  userId,\r\n  businessId,\r\n  page,\r\n  pageSize,\r\n  search,\r\n  category,\r\n  stockStatus,\r\n}: {\r\n  userId: string;\r\n  businessId: string;\r\n  page: number;\r\n  pageSize: number;\r\n  search?: string;\r\n  category?: string;\r\n  stockStatus?: 'inStock' | 'outOfStock' | 'lowStock' | 'all';\r\n}) {\r\n  if (!userId || !businessId) return { products: [], count: 0 };\r\n\r\n  const skip = (page - 1) * pageSize;\r\n  const take = pageSize;\r\n\r\n  let whereClause: any = {\r\n    userId: userId,\r\n    branchId: businessId,\r\n  };\r\n\r\n  if (search) {\r\n    whereClause.OR = [\r\n      { name: { contains: search, mode: 'insensitive' } },\r\n      { description: { contains: search, mode: 'insensitive' } },\r\n      { sku: { contains: search, mode: 'insensitive' } },\r\n      { barcode: { contains: search, mode: 'insensitive' } },\r\n    ];\r\n  }\r\n\r\n  if (category) {\r\n    whereClause.category = { name: category };\r\n  }\r\n\r\n  if (stockStatus === 'outOfStock') {\r\n    whereClause.stock = 0;\r\n  } else if (stockStatus === 'inStock') {\r\n    whereClause.stock = { gt: 0 };\r\n  } else if (stockStatus === 'lowStock') {\r\n    // Handling lowStock is complex because minStock is compared locally or using direct SQL in Prisma\r\n    // For now, we will handle it with Prisma's raw query or by filtering in memory if necessary\r\n    // Fortunately, since PRISMA 5.0, column comparison still needs raw queries or we can fetch and filter if small\r\n    // Here we'll fetch them all if lowStock is enabled, or add a generated column. \r\n    // We will do a basic fetch and filter later if needed.\r\n  }\r\n\r\n  try {\r\n    const [productsData, totalCount] = await Promise.all([\r\n      db.product.findMany({\r\n        where: whereClause,\r\n        skip,\r\n        take,\r\n        orderBy: [{ createdAt: 'desc' }, { id: 'desc' }],\r\n        include: {\r\n          category: true,\r\n          supplier: true,\r\n        }\r\n      }),\r\n      db.product.count({ where: whereClause })\r\n    ]);\r\n\r\n    // Map the Prisma product model back to the application's Product type\r\n    let formattedProducts = productsData.map((p) => {\r\n      // Assuming mapping exists, we will map it\r\n      return {\r\n        id: p.id,\r\n        name: p.name,\r\n        description: p.description || '',\r\n        category: p.category?.name || 'Uncategorized',\r\n        quantity: p.stock,\r\n        costPrice: p.costPrice,\r\n        sellingPrice: p.sellingPrice,\r\n        supplier: p.supplier?.name,\r\n        imageUrl: p.image,\r\n        barcode: p.barcode,\r\n        itemNumber: p.sku || '',\r\n        minimumStock: p.minStock,\r\n        createdAt: p.createdAt,\r\n      };\r\n    });\r\n\r\n    if (stockStatus === 'lowStock') {\r\n      formattedProducts = formattedProducts.filter(p => p.quantity > 0 && p.quantity <= p.minimumStock);\r\n    }\r\n\r\n    return { products: formattedProducts as any[], count: totalCount };\r\n  } catch (error) {\r\n    console.error('Error fetching products from DB:', error);\r\n    return { products: [], count: 0 };\r\n  }\r\n}\r\n\r\nexport async function createProductAction(data: any) {\r\n  try {\r\n    const product = await db.product.create({\r\n      data: {\r\n        name: data.name,\r\n        description: data.description,\r\n        branchId: data.businessId,\r\n        userId: data.userId,\r\n        // Optional relations\r\n        ...(data.categoryId && { categoryId: data.categoryId }),\r\n        ...(data.supplierId && { supplierId: data.supplierId }),\r\n        sku: data.itemNumber || data.sku,\r\n        barcode: data.barcode,\r\n        image: data.imageUrl,\r\n        costPrice: data.costPrice,\r\n        sellingPrice: data.sellingPrice,\r\n        stock: data.quantity || 0,\r\n        minStock: data.minimumStock || 0,\r\n      }\r\n    });\r\n\r\n    // revalidatePath('/inventory/products');\r\n\r\n    return {\r\n      id: product.id,\r\n      name: product.name,\r\n      description: product.description || '',\r\n      category: 'Uncategorized', // Would need real mapping\r\n      quantity: product.stock,\r\n      costPrice: product.costPrice,\r\n      sellingPrice: product.sellingPrice,\r\n      imageUrl: product.image,\r\n      barcode: product.barcode,\r\n      itemNumber: product.sku || '',\r\n      minimumStock: product.minStock,\r\n      createdAt: product.createdAt,\r\n    };\r\n  } catch (error) {\r\n    console.error('Error creating product:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function updateProductAction(id: string, updates: any) {\r\n  try {\r\n    const updated = await db.product.update({\r\n      where: { id },\r\n      data: {\r\n        name: updates.name,\r\n        description: updates.description,\r\n        ...(updates.categoryId !== undefined && { categoryId: updates.categoryId }),\r\n        ...(updates.supplierId !== undefined && { supplierId: updates.supplierId }),\r\n        sku: updates.itemNumber || updates.sku,\r\n        barcode: updates.barcode,\r\n        image: updates.imageUrl,\r\n        costPrice: updates.costPrice,\r\n        sellingPrice: updates.sellingPrice,\r\n        stock: updates.quantity,\r\n        minStock: updates.minimumStock,\r\n      }\r\n    });\r\n\r\n    // revalidatePath('/inventory/products');\r\n\r\n    return updated;\r\n  } catch (error) {\r\n    console.error('Error updating product:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function deleteProductAction(id: string) {\r\n  try {\r\n    await db.product.delete({\r\n      where: { id }\r\n    });\r\n    // revalidatePath('/inventory/products');\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error deleting product:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\nexport async function updateProductsBulkAction(\r\n  updates: Array<{ id: string; updated: Partial<any> }>,\r\n  businessId: string\r\n) {\r\n  try {\r\n    // Prisma transaction for bulk updates\r\n    const updatePromises = updates.map(u =>\r\n      db.product.update({\r\n        where: { id: u.id },\r\n        data: {\r\n          ...(u.updated.name && { name: u.updated.name }),\r\n          ...(u.updated.description !== undefined && { description: u.updated.description }),\r\n          ...(u.updated.categoryId !== undefined && { categoryId: u.updated.categoryId }),\r\n          ...(u.updated.supplierId !== undefined && { supplierId: u.updated.supplierId }),\r\n          ...(u.updated.sku !== undefined && { sku: u.updated.sku }),\r\n          ...(u.updated.barcode !== undefined && { barcode: u.updated.barcode }),\r\n          ...(u.updated.costPrice !== undefined && { costPrice: u.updated.costPrice }),\r\n          ...(u.updated.sellingPrice !== undefined && { sellingPrice: u.updated.sellingPrice }),\r\n          ...(u.updated.quantity !== undefined && { stock: u.updated.quantity }),\r\n          ...(u.updated.minimumStock !== undefined && { minStock: u.updated.minimumStock }),\r\n        }\r\n      })\r\n    );\r\n\r\n    await db.$transaction(updatePromises);\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error performing bulk update:', error);\r\n    return false;\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MAQsB,wBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA,qDAAA"}},
    {"offset": {"line": 55, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/app/actions/products.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { db } from '../../../prisma/db';\r\nimport { Product, ProductFormData, mapDbProductToProduct, mapProductToDbProduct } from '@/types';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\n// We implement server actions for the products here\r\n\r\nexport async function getProductsAction({\r\n  userId,\r\n  businessId,\r\n  page,\r\n  pageSize,\r\n  search,\r\n  category,\r\n  stockStatus,\r\n}: {\r\n  userId: string;\r\n  businessId: string;\r\n  page: number;\r\n  pageSize: number;\r\n  search?: string;\r\n  category?: string;\r\n  stockStatus?: 'inStock' | 'outOfStock' | 'lowStock' | 'all';\r\n}) {\r\n  if (!userId || !businessId) return { products: [], count: 0 };\r\n\r\n  const skip = (page - 1) * pageSize;\r\n  const take = pageSize;\r\n\r\n  let whereClause: any = {\r\n    userId: userId,\r\n    branchId: businessId,\r\n  };\r\n\r\n  if (search) {\r\n    whereClause.OR = [\r\n      { name: { contains: search, mode: 'insensitive' } },\r\n      { description: { contains: search, mode: 'insensitive' } },\r\n      { sku: { contains: search, mode: 'insensitive' } },\r\n      { barcode: { contains: search, mode: 'insensitive' } },\r\n    ];\r\n  }\r\n\r\n  if (category) {\r\n    whereClause.category = { name: category };\r\n  }\r\n\r\n  if (stockStatus === 'outOfStock') {\r\n    whereClause.stock = 0;\r\n  } else if (stockStatus === 'inStock') {\r\n    whereClause.stock = { gt: 0 };\r\n  } else if (stockStatus === 'lowStock') {\r\n    // Handling lowStock is complex because minStock is compared locally or using direct SQL in Prisma\r\n    // For now, we will handle it with Prisma's raw query or by filtering in memory if necessary\r\n    // Fortunately, since PRISMA 5.0, column comparison still needs raw queries or we can fetch and filter if small\r\n    // Here we'll fetch them all if lowStock is enabled, or add a generated column. \r\n    // We will do a basic fetch and filter later if needed.\r\n  }\r\n\r\n  try {\r\n    const [productsData, totalCount] = await Promise.all([\r\n      db.product.findMany({\r\n        where: whereClause,\r\n        skip,\r\n        take,\r\n        orderBy: [{ createdAt: 'desc' }, { id: 'desc' }],\r\n        include: {\r\n          category: true,\r\n          supplier: true,\r\n        }\r\n      }),\r\n      db.product.count({ where: whereClause })\r\n    ]);\r\n\r\n    // Map the Prisma product model back to the application's Product type\r\n    let formattedProducts = productsData.map((p) => {\r\n      // Assuming mapping exists, we will map it\r\n      return {\r\n        id: p.id,\r\n        name: p.name,\r\n        description: p.description || '',\r\n        category: p.category?.name || 'Uncategorized',\r\n        quantity: p.stock,\r\n        costPrice: p.costPrice,\r\n        sellingPrice: p.sellingPrice,\r\n        supplier: p.supplier?.name,\r\n        imageUrl: p.image,\r\n        barcode: p.barcode,\r\n        itemNumber: p.sku || '',\r\n        minimumStock: p.minStock,\r\n        createdAt: p.createdAt,\r\n      };\r\n    });\r\n\r\n    if (stockStatus === 'lowStock') {\r\n      formattedProducts = formattedProducts.filter(p => p.quantity > 0 && p.quantity <= p.minimumStock);\r\n    }\r\n\r\n    return { products: formattedProducts as any[], count: totalCount };\r\n  } catch (error) {\r\n    console.error('Error fetching products from DB:', error);\r\n    return { products: [], count: 0 };\r\n  }\r\n}\r\n\r\nexport async function createProductAction(data: any) {\r\n  try {\r\n    const product = await db.product.create({\r\n      data: {\r\n        name: data.name,\r\n        description: data.description,\r\n        branchId: data.businessId,\r\n        userId: data.userId,\r\n        // Optional relations\r\n        ...(data.categoryId && { categoryId: data.categoryId }),\r\n        ...(data.supplierId && { supplierId: data.supplierId }),\r\n        sku: data.itemNumber || data.sku,\r\n        barcode: data.barcode,\r\n        image: data.imageUrl,\r\n        costPrice: data.costPrice,\r\n        sellingPrice: data.sellingPrice,\r\n        stock: data.quantity || 0,\r\n        minStock: data.minimumStock || 0,\r\n      }\r\n    });\r\n\r\n    // revalidatePath('/inventory/products');\r\n\r\n    return {\r\n      id: product.id,\r\n      name: product.name,\r\n      description: product.description || '',\r\n      category: 'Uncategorized', // Would need real mapping\r\n      quantity: product.stock,\r\n      costPrice: product.costPrice,\r\n      sellingPrice: product.sellingPrice,\r\n      imageUrl: product.image,\r\n      barcode: product.barcode,\r\n      itemNumber: product.sku || '',\r\n      minimumStock: product.minStock,\r\n      createdAt: product.createdAt,\r\n    };\r\n  } catch (error) {\r\n    console.error('Error creating product:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function updateProductAction(id: string, updates: any) {\r\n  try {\r\n    const updated = await db.product.update({\r\n      where: { id },\r\n      data: {\r\n        name: updates.name,\r\n        description: updates.description,\r\n        ...(updates.categoryId !== undefined && { categoryId: updates.categoryId }),\r\n        ...(updates.supplierId !== undefined && { supplierId: updates.supplierId }),\r\n        sku: updates.itemNumber || updates.sku,\r\n        barcode: updates.barcode,\r\n        image: updates.imageUrl,\r\n        costPrice: updates.costPrice,\r\n        sellingPrice: updates.sellingPrice,\r\n        stock: updates.quantity,\r\n        minStock: updates.minimumStock,\r\n      }\r\n    });\r\n\r\n    // revalidatePath('/inventory/products');\r\n\r\n    return updated;\r\n  } catch (error) {\r\n    console.error('Error updating product:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function deleteProductAction(id: string) {\r\n  try {\r\n    await db.product.delete({\r\n      where: { id }\r\n    });\r\n    // revalidatePath('/inventory/products');\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error deleting product:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\nexport async function updateProductsBulkAction(\r\n  updates: Array<{ id: string; updated: Partial<any> }>,\r\n  businessId: string\r\n) {\r\n  try {\r\n    // Prisma transaction for bulk updates\r\n    const updatePromises = updates.map(u =>\r\n      db.product.update({\r\n        where: { id: u.id },\r\n        data: {\r\n          ...(u.updated.name && { name: u.updated.name }),\r\n          ...(u.updated.description !== undefined && { description: u.updated.description }),\r\n          ...(u.updated.categoryId !== undefined && { categoryId: u.updated.categoryId }),\r\n          ...(u.updated.supplierId !== undefined && { supplierId: u.updated.supplierId }),\r\n          ...(u.updated.sku !== undefined && { sku: u.updated.sku }),\r\n          ...(u.updated.barcode !== undefined && { barcode: u.updated.barcode }),\r\n          ...(u.updated.costPrice !== undefined && { costPrice: u.updated.costPrice }),\r\n          ...(u.updated.sellingPrice !== undefined && { sellingPrice: u.updated.sellingPrice }),\r\n          ...(u.updated.quantity !== undefined && { stock: u.updated.quantity }),\r\n          ...(u.updated.minimumStock !== undefined && { minStock: u.updated.minimumStock }),\r\n        }\r\n      })\r\n    );\r\n\r\n    await db.$transaction(updatePromises);\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error performing bulk update:', error);\r\n    return false;\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MA0GsB,wBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA,uDAAA"}},
    {"offset": {"line": 72, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/app/actions/products.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { db } from '../../../prisma/db';\r\nimport { Product, ProductFormData, mapDbProductToProduct, mapProductToDbProduct } from '@/types';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\n// We implement server actions for the products here\r\n\r\nexport async function getProductsAction({\r\n  userId,\r\n  businessId,\r\n  page,\r\n  pageSize,\r\n  search,\r\n  category,\r\n  stockStatus,\r\n}: {\r\n  userId: string;\r\n  businessId: string;\r\n  page: number;\r\n  pageSize: number;\r\n  search?: string;\r\n  category?: string;\r\n  stockStatus?: 'inStock' | 'outOfStock' | 'lowStock' | 'all';\r\n}) {\r\n  if (!userId || !businessId) return { products: [], count: 0 };\r\n\r\n  const skip = (page - 1) * pageSize;\r\n  const take = pageSize;\r\n\r\n  let whereClause: any = {\r\n    userId: userId,\r\n    branchId: businessId,\r\n  };\r\n\r\n  if (search) {\r\n    whereClause.OR = [\r\n      { name: { contains: search, mode: 'insensitive' } },\r\n      { description: { contains: search, mode: 'insensitive' } },\r\n      { sku: { contains: search, mode: 'insensitive' } },\r\n      { barcode: { contains: search, mode: 'insensitive' } },\r\n    ];\r\n  }\r\n\r\n  if (category) {\r\n    whereClause.category = { name: category };\r\n  }\r\n\r\n  if (stockStatus === 'outOfStock') {\r\n    whereClause.stock = 0;\r\n  } else if (stockStatus === 'inStock') {\r\n    whereClause.stock = { gt: 0 };\r\n  } else if (stockStatus === 'lowStock') {\r\n    // Handling lowStock is complex because minStock is compared locally or using direct SQL in Prisma\r\n    // For now, we will handle it with Prisma's raw query or by filtering in memory if necessary\r\n    // Fortunately, since PRISMA 5.0, column comparison still needs raw queries or we can fetch and filter if small\r\n    // Here we'll fetch them all if lowStock is enabled, or add a generated column. \r\n    // We will do a basic fetch and filter later if needed.\r\n  }\r\n\r\n  try {\r\n    const [productsData, totalCount] = await Promise.all([\r\n      db.product.findMany({\r\n        where: whereClause,\r\n        skip,\r\n        take,\r\n        orderBy: [{ createdAt: 'desc' }, { id: 'desc' }],\r\n        include: {\r\n          category: true,\r\n          supplier: true,\r\n        }\r\n      }),\r\n      db.product.count({ where: whereClause })\r\n    ]);\r\n\r\n    // Map the Prisma product model back to the application's Product type\r\n    let formattedProducts = productsData.map((p) => {\r\n      // Assuming mapping exists, we will map it\r\n      return {\r\n        id: p.id,\r\n        name: p.name,\r\n        description: p.description || '',\r\n        category: p.category?.name || 'Uncategorized',\r\n        quantity: p.stock,\r\n        costPrice: p.costPrice,\r\n        sellingPrice: p.sellingPrice,\r\n        supplier: p.supplier?.name,\r\n        imageUrl: p.image,\r\n        barcode: p.barcode,\r\n        itemNumber: p.sku || '',\r\n        minimumStock: p.minStock,\r\n        createdAt: p.createdAt,\r\n      };\r\n    });\r\n\r\n    if (stockStatus === 'lowStock') {\r\n      formattedProducts = formattedProducts.filter(p => p.quantity > 0 && p.quantity <= p.minimumStock);\r\n    }\r\n\r\n    return { products: formattedProducts as any[], count: totalCount };\r\n  } catch (error) {\r\n    console.error('Error fetching products from DB:', error);\r\n    return { products: [], count: 0 };\r\n  }\r\n}\r\n\r\nexport async function createProductAction(data: any) {\r\n  try {\r\n    const product = await db.product.create({\r\n      data: {\r\n        name: data.name,\r\n        description: data.description,\r\n        branchId: data.businessId,\r\n        userId: data.userId,\r\n        // Optional relations\r\n        ...(data.categoryId && { categoryId: data.categoryId }),\r\n        ...(data.supplierId && { supplierId: data.supplierId }),\r\n        sku: data.itemNumber || data.sku,\r\n        barcode: data.barcode,\r\n        image: data.imageUrl,\r\n        costPrice: data.costPrice,\r\n        sellingPrice: data.sellingPrice,\r\n        stock: data.quantity || 0,\r\n        minStock: data.minimumStock || 0,\r\n      }\r\n    });\r\n\r\n    // revalidatePath('/inventory/products');\r\n\r\n    return {\r\n      id: product.id,\r\n      name: product.name,\r\n      description: product.description || '',\r\n      category: 'Uncategorized', // Would need real mapping\r\n      quantity: product.stock,\r\n      costPrice: product.costPrice,\r\n      sellingPrice: product.sellingPrice,\r\n      imageUrl: product.image,\r\n      barcode: product.barcode,\r\n      itemNumber: product.sku || '',\r\n      minimumStock: product.minStock,\r\n      createdAt: product.createdAt,\r\n    };\r\n  } catch (error) {\r\n    console.error('Error creating product:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function updateProductAction(id: string, updates: any) {\r\n  try {\r\n    const updated = await db.product.update({\r\n      where: { id },\r\n      data: {\r\n        name: updates.name,\r\n        description: updates.description,\r\n        ...(updates.categoryId !== undefined && { categoryId: updates.categoryId }),\r\n        ...(updates.supplierId !== undefined && { supplierId: updates.supplierId }),\r\n        sku: updates.itemNumber || updates.sku,\r\n        barcode: updates.barcode,\r\n        image: updates.imageUrl,\r\n        costPrice: updates.costPrice,\r\n        sellingPrice: updates.sellingPrice,\r\n        stock: updates.quantity,\r\n        minStock: updates.minimumStock,\r\n      }\r\n    });\r\n\r\n    // revalidatePath('/inventory/products');\r\n\r\n    return updated;\r\n  } catch (error) {\r\n    console.error('Error updating product:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function deleteProductAction(id: string) {\r\n  try {\r\n    await db.product.delete({\r\n      where: { id }\r\n    });\r\n    // revalidatePath('/inventory/products');\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error deleting product:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\nexport async function updateProductsBulkAction(\r\n  updates: Array<{ id: string; updated: Partial<any> }>,\r\n  businessId: string\r\n) {\r\n  try {\r\n    // Prisma transaction for bulk updates\r\n    const updatePromises = updates.map(u =>\r\n      db.product.update({\r\n        where: { id: u.id },\r\n        data: {\r\n          ...(u.updated.name && { name: u.updated.name }),\r\n          ...(u.updated.description !== undefined && { description: u.updated.description }),\r\n          ...(u.updated.categoryId !== undefined && { categoryId: u.updated.categoryId }),\r\n          ...(u.updated.supplierId !== undefined && { supplierId: u.updated.supplierId }),\r\n          ...(u.updated.sku !== undefined && { sku: u.updated.sku }),\r\n          ...(u.updated.barcode !== undefined && { barcode: u.updated.barcode }),\r\n          ...(u.updated.costPrice !== undefined && { costPrice: u.updated.costPrice }),\r\n          ...(u.updated.sellingPrice !== undefined && { sellingPrice: u.updated.sellingPrice }),\r\n          ...(u.updated.quantity !== undefined && { stock: u.updated.quantity }),\r\n          ...(u.updated.minimumStock !== undefined && { minStock: u.updated.minimumStock }),\r\n        }\r\n      })\r\n    );\r\n\r\n    await db.$transaction(updatePromises);\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error performing bulk update:', error);\r\n    return false;\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MAqJsB,wBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA,uDAAA"}},
    {"offset": {"line": 89, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/app/actions/products.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { db } from '../../../prisma/db';\r\nimport { Product, ProductFormData, mapDbProductToProduct, mapProductToDbProduct } from '@/types';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\n// We implement server actions for the products here\r\n\r\nexport async function getProductsAction({\r\n  userId,\r\n  businessId,\r\n  page,\r\n  pageSize,\r\n  search,\r\n  category,\r\n  stockStatus,\r\n}: {\r\n  userId: string;\r\n  businessId: string;\r\n  page: number;\r\n  pageSize: number;\r\n  search?: string;\r\n  category?: string;\r\n  stockStatus?: 'inStock' | 'outOfStock' | 'lowStock' | 'all';\r\n}) {\r\n  if (!userId || !businessId) return { products: [], count: 0 };\r\n\r\n  const skip = (page - 1) * pageSize;\r\n  const take = pageSize;\r\n\r\n  let whereClause: any = {\r\n    userId: userId,\r\n    branchId: businessId,\r\n  };\r\n\r\n  if (search) {\r\n    whereClause.OR = [\r\n      { name: { contains: search, mode: 'insensitive' } },\r\n      { description: { contains: search, mode: 'insensitive' } },\r\n      { sku: { contains: search, mode: 'insensitive' } },\r\n      { barcode: { contains: search, mode: 'insensitive' } },\r\n    ];\r\n  }\r\n\r\n  if (category) {\r\n    whereClause.category = { name: category };\r\n  }\r\n\r\n  if (stockStatus === 'outOfStock') {\r\n    whereClause.stock = 0;\r\n  } else if (stockStatus === 'inStock') {\r\n    whereClause.stock = { gt: 0 };\r\n  } else if (stockStatus === 'lowStock') {\r\n    // Handling lowStock is complex because minStock is compared locally or using direct SQL in Prisma\r\n    // For now, we will handle it with Prisma's raw query or by filtering in memory if necessary\r\n    // Fortunately, since PRISMA 5.0, column comparison still needs raw queries or we can fetch and filter if small\r\n    // Here we'll fetch them all if lowStock is enabled, or add a generated column. \r\n    // We will do a basic fetch and filter later if needed.\r\n  }\r\n\r\n  try {\r\n    const [productsData, totalCount] = await Promise.all([\r\n      db.product.findMany({\r\n        where: whereClause,\r\n        skip,\r\n        take,\r\n        orderBy: [{ createdAt: 'desc' }, { id: 'desc' }],\r\n        include: {\r\n          category: true,\r\n          supplier: true,\r\n        }\r\n      }),\r\n      db.product.count({ where: whereClause })\r\n    ]);\r\n\r\n    // Map the Prisma product model back to the application's Product type\r\n    let formattedProducts = productsData.map((p) => {\r\n      // Assuming mapping exists, we will map it\r\n      return {\r\n        id: p.id,\r\n        name: p.name,\r\n        description: p.description || '',\r\n        category: p.category?.name || 'Uncategorized',\r\n        quantity: p.stock,\r\n        costPrice: p.costPrice,\r\n        sellingPrice: p.sellingPrice,\r\n        supplier: p.supplier?.name,\r\n        imageUrl: p.image,\r\n        barcode: p.barcode,\r\n        itemNumber: p.sku || '',\r\n        minimumStock: p.minStock,\r\n        createdAt: p.createdAt,\r\n      };\r\n    });\r\n\r\n    if (stockStatus === 'lowStock') {\r\n      formattedProducts = formattedProducts.filter(p => p.quantity > 0 && p.quantity <= p.minimumStock);\r\n    }\r\n\r\n    return { products: formattedProducts as any[], count: totalCount };\r\n  } catch (error) {\r\n    console.error('Error fetching products from DB:', error);\r\n    return { products: [], count: 0 };\r\n  }\r\n}\r\n\r\nexport async function createProductAction(data: any) {\r\n  try {\r\n    const product = await db.product.create({\r\n      data: {\r\n        name: data.name,\r\n        description: data.description,\r\n        branchId: data.businessId,\r\n        userId: data.userId,\r\n        // Optional relations\r\n        ...(data.categoryId && { categoryId: data.categoryId }),\r\n        ...(data.supplierId && { supplierId: data.supplierId }),\r\n        sku: data.itemNumber || data.sku,\r\n        barcode: data.barcode,\r\n        image: data.imageUrl,\r\n        costPrice: data.costPrice,\r\n        sellingPrice: data.sellingPrice,\r\n        stock: data.quantity || 0,\r\n        minStock: data.minimumStock || 0,\r\n      }\r\n    });\r\n\r\n    // revalidatePath('/inventory/products');\r\n\r\n    return {\r\n      id: product.id,\r\n      name: product.name,\r\n      description: product.description || '',\r\n      category: 'Uncategorized', // Would need real mapping\r\n      quantity: product.stock,\r\n      costPrice: product.costPrice,\r\n      sellingPrice: product.sellingPrice,\r\n      imageUrl: product.image,\r\n      barcode: product.barcode,\r\n      itemNumber: product.sku || '',\r\n      minimumStock: product.minStock,\r\n      createdAt: product.createdAt,\r\n    };\r\n  } catch (error) {\r\n    console.error('Error creating product:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function updateProductAction(id: string, updates: any) {\r\n  try {\r\n    const updated = await db.product.update({\r\n      where: { id },\r\n      data: {\r\n        name: updates.name,\r\n        description: updates.description,\r\n        ...(updates.categoryId !== undefined && { categoryId: updates.categoryId }),\r\n        ...(updates.supplierId !== undefined && { supplierId: updates.supplierId }),\r\n        sku: updates.itemNumber || updates.sku,\r\n        barcode: updates.barcode,\r\n        image: updates.imageUrl,\r\n        costPrice: updates.costPrice,\r\n        sellingPrice: updates.sellingPrice,\r\n        stock: updates.quantity,\r\n        minStock: updates.minimumStock,\r\n      }\r\n    });\r\n\r\n    // revalidatePath('/inventory/products');\r\n\r\n    return updated;\r\n  } catch (error) {\r\n    console.error('Error updating product:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function deleteProductAction(id: string) {\r\n  try {\r\n    await db.product.delete({\r\n      where: { id }\r\n    });\r\n    // revalidatePath('/inventory/products');\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error deleting product:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\nexport async function updateProductsBulkAction(\r\n  updates: Array<{ id: string; updated: Partial<any> }>,\r\n  businessId: string\r\n) {\r\n  try {\r\n    // Prisma transaction for bulk updates\r\n    const updatePromises = updates.map(u =>\r\n      db.product.update({\r\n        where: { id: u.id },\r\n        data: {\r\n          ...(u.updated.name && { name: u.updated.name }),\r\n          ...(u.updated.description !== undefined && { description: u.updated.description }),\r\n          ...(u.updated.categoryId !== undefined && { categoryId: u.updated.categoryId }),\r\n          ...(u.updated.supplierId !== undefined && { supplierId: u.updated.supplierId }),\r\n          ...(u.updated.sku !== undefined && { sku: u.updated.sku }),\r\n          ...(u.updated.barcode !== undefined && { barcode: u.updated.barcode }),\r\n          ...(u.updated.costPrice !== undefined && { costPrice: u.updated.costPrice }),\r\n          ...(u.updated.sellingPrice !== undefined && { sellingPrice: u.updated.sellingPrice }),\r\n          ...(u.updated.quantity !== undefined && { stock: u.updated.quantity }),\r\n          ...(u.updated.minimumStock !== undefined && { minStock: u.updated.minimumStock }),\r\n        }\r\n      })\r\n    );\r\n\r\n    await db.$transaction(updatePromises);\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error performing bulk update:', error);\r\n    return false;\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MAiLsB,wBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA,uDAAA"}},
    {"offset": {"line": 106, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/app/actions/products.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { db } from '../../../prisma/db';\r\nimport { Product, ProductFormData, mapDbProductToProduct, mapProductToDbProduct } from '@/types';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\n// We implement server actions for the products here\r\n\r\nexport async function getProductsAction({\r\n  userId,\r\n  businessId,\r\n  page,\r\n  pageSize,\r\n  search,\r\n  category,\r\n  stockStatus,\r\n}: {\r\n  userId: string;\r\n  businessId: string;\r\n  page: number;\r\n  pageSize: number;\r\n  search?: string;\r\n  category?: string;\r\n  stockStatus?: 'inStock' | 'outOfStock' | 'lowStock' | 'all';\r\n}) {\r\n  if (!userId || !businessId) return { products: [], count: 0 };\r\n\r\n  const skip = (page - 1) * pageSize;\r\n  const take = pageSize;\r\n\r\n  let whereClause: any = {\r\n    userId: userId,\r\n    branchId: businessId,\r\n  };\r\n\r\n  if (search) {\r\n    whereClause.OR = [\r\n      { name: { contains: search, mode: 'insensitive' } },\r\n      { description: { contains: search, mode: 'insensitive' } },\r\n      { sku: { contains: search, mode: 'insensitive' } },\r\n      { barcode: { contains: search, mode: 'insensitive' } },\r\n    ];\r\n  }\r\n\r\n  if (category) {\r\n    whereClause.category = { name: category };\r\n  }\r\n\r\n  if (stockStatus === 'outOfStock') {\r\n    whereClause.stock = 0;\r\n  } else if (stockStatus === 'inStock') {\r\n    whereClause.stock = { gt: 0 };\r\n  } else if (stockStatus === 'lowStock') {\r\n    // Handling lowStock is complex because minStock is compared locally or using direct SQL in Prisma\r\n    // For now, we will handle it with Prisma's raw query or by filtering in memory if necessary\r\n    // Fortunately, since PRISMA 5.0, column comparison still needs raw queries or we can fetch and filter if small\r\n    // Here we'll fetch them all if lowStock is enabled, or add a generated column. \r\n    // We will do a basic fetch and filter later if needed.\r\n  }\r\n\r\n  try {\r\n    const [productsData, totalCount] = await Promise.all([\r\n      db.product.findMany({\r\n        where: whereClause,\r\n        skip,\r\n        take,\r\n        orderBy: [{ createdAt: 'desc' }, { id: 'desc' }],\r\n        include: {\r\n          category: true,\r\n          supplier: true,\r\n        }\r\n      }),\r\n      db.product.count({ where: whereClause })\r\n    ]);\r\n\r\n    // Map the Prisma product model back to the application's Product type\r\n    let formattedProducts = productsData.map((p) => {\r\n      // Assuming mapping exists, we will map it\r\n      return {\r\n        id: p.id,\r\n        name: p.name,\r\n        description: p.description || '',\r\n        category: p.category?.name || 'Uncategorized',\r\n        quantity: p.stock,\r\n        costPrice: p.costPrice,\r\n        sellingPrice: p.sellingPrice,\r\n        supplier: p.supplier?.name,\r\n        imageUrl: p.image,\r\n        barcode: p.barcode,\r\n        itemNumber: p.sku || '',\r\n        minimumStock: p.minStock,\r\n        createdAt: p.createdAt,\r\n      };\r\n    });\r\n\r\n    if (stockStatus === 'lowStock') {\r\n      formattedProducts = formattedProducts.filter(p => p.quantity > 0 && p.quantity <= p.minimumStock);\r\n    }\r\n\r\n    return { products: formattedProducts as any[], count: totalCount };\r\n  } catch (error) {\r\n    console.error('Error fetching products from DB:', error);\r\n    return { products: [], count: 0 };\r\n  }\r\n}\r\n\r\nexport async function createProductAction(data: any) {\r\n  try {\r\n    const product = await db.product.create({\r\n      data: {\r\n        name: data.name,\r\n        description: data.description,\r\n        branchId: data.businessId,\r\n        userId: data.userId,\r\n        // Optional relations\r\n        ...(data.categoryId && { categoryId: data.categoryId }),\r\n        ...(data.supplierId && { supplierId: data.supplierId }),\r\n        sku: data.itemNumber || data.sku,\r\n        barcode: data.barcode,\r\n        image: data.imageUrl,\r\n        costPrice: data.costPrice,\r\n        sellingPrice: data.sellingPrice,\r\n        stock: data.quantity || 0,\r\n        minStock: data.minimumStock || 0,\r\n      }\r\n    });\r\n\r\n    // revalidatePath('/inventory/products');\r\n\r\n    return {\r\n      id: product.id,\r\n      name: product.name,\r\n      description: product.description || '',\r\n      category: 'Uncategorized', // Would need real mapping\r\n      quantity: product.stock,\r\n      costPrice: product.costPrice,\r\n      sellingPrice: product.sellingPrice,\r\n      imageUrl: product.image,\r\n      barcode: product.barcode,\r\n      itemNumber: product.sku || '',\r\n      minimumStock: product.minStock,\r\n      createdAt: product.createdAt,\r\n    };\r\n  } catch (error) {\r\n    console.error('Error creating product:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function updateProductAction(id: string, updates: any) {\r\n  try {\r\n    const updated = await db.product.update({\r\n      where: { id },\r\n      data: {\r\n        name: updates.name,\r\n        description: updates.description,\r\n        ...(updates.categoryId !== undefined && { categoryId: updates.categoryId }),\r\n        ...(updates.supplierId !== undefined && { supplierId: updates.supplierId }),\r\n        sku: updates.itemNumber || updates.sku,\r\n        barcode: updates.barcode,\r\n        image: updates.imageUrl,\r\n        costPrice: updates.costPrice,\r\n        sellingPrice: updates.sellingPrice,\r\n        stock: updates.quantity,\r\n        minStock: updates.minimumStock,\r\n      }\r\n    });\r\n\r\n    // revalidatePath('/inventory/products');\r\n\r\n    return updated;\r\n  } catch (error) {\r\n    console.error('Error updating product:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function deleteProductAction(id: string) {\r\n  try {\r\n    await db.product.delete({\r\n      where: { id }\r\n    });\r\n    // revalidatePath('/inventory/products');\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error deleting product:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\nexport async function updateProductsBulkAction(\r\n  updates: Array<{ id: string; updated: Partial<any> }>,\r\n  businessId: string\r\n) {\r\n  try {\r\n    // Prisma transaction for bulk updates\r\n    const updatePromises = updates.map(u =>\r\n      db.product.update({\r\n        where: { id: u.id },\r\n        data: {\r\n          ...(u.updated.name && { name: u.updated.name }),\r\n          ...(u.updated.description !== undefined && { description: u.updated.description }),\r\n          ...(u.updated.categoryId !== undefined && { categoryId: u.updated.categoryId }),\r\n          ...(u.updated.supplierId !== undefined && { supplierId: u.updated.supplierId }),\r\n          ...(u.updated.sku !== undefined && { sku: u.updated.sku }),\r\n          ...(u.updated.barcode !== undefined && { barcode: u.updated.barcode }),\r\n          ...(u.updated.costPrice !== undefined && { costPrice: u.updated.costPrice }),\r\n          ...(u.updated.sellingPrice !== undefined && { sellingPrice: u.updated.sellingPrice }),\r\n          ...(u.updated.quantity !== undefined && { stock: u.updated.quantity }),\r\n          ...(u.updated.minimumStock !== undefined && { minStock: u.updated.minimumStock }),\r\n        }\r\n      })\r\n    );\r\n\r\n    await db.$transaction(updatePromises);\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error performing bulk update:', error);\r\n    return false;\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MA8LsB,wBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA,4DAAA"}},
    {"offset": {"line": 123, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/app/actions/sales.ts"],"sourcesContent":["'use server';\r\n\r\nimport { db } from '../../../prisma/db';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\nexport async function getSalesAction(businessId: string, sortOrder: 'asc' | 'desc' = 'desc', pageSize?: number) {\r\n    try {\r\n        const queryOptions: any = {\r\n            where: {\r\n                branchId: businessId,\r\n            },\r\n            orderBy: {\r\n                createdAt: sortOrder,\r\n            },\r\n            include: {\r\n                cashTransaction: true,\r\n            }\r\n        };\r\n\r\n        if (pageSize && pageSize > 0) {\r\n            queryOptions.take = pageSize;\r\n        }\r\n\r\n        const sales = await db.sale.findMany(queryOptions);\r\n\r\n        // Provide default mappings to existing React components\r\n        return sales.map((item: any) => ({\r\n            id: item.id,\r\n            user_id: item.userId,\r\n            location_id: item.branchId,\r\n            receipt_number: item.receiptNumber,\r\n            customer_name: item.customerName,\r\n            customer_address: item.customerAddress,\r\n            customer_contact: item.customerContact,\r\n            customer_id: item.customerId,\r\n            items: item.items as any, // jsonb type\r\n            payment_status: item.paymentStatus,\r\n            profit: item.profit,\r\n            date: item.date.toISOString(),\r\n            tax_rate: item.taxRate ? Number(item.taxRate) : 0,\r\n            created_at: item.createdAt.toISOString(),\r\n            updated_at: item.updatedAt.toISOString(),\r\n            cash_transaction_id: item.cashTransactionId,\r\n            amount_paid: item.amountPaid,\r\n            amount_due: item.amountDue,\r\n            category_id: item.categoryId,\r\n            notes: item.notes\r\n        }));\r\n    } catch (error) {\r\n        console.error('Error fetching sales:', error);\r\n        return [];\r\n    }\r\n}\r\n\r\nexport async function deleteSaleAction(id: string, businessId: string) {\r\n    try {\r\n        const sale = await db.sale.findUnique({\r\n            where: { id },\r\n            include: { cashTransaction: true, installments: true }\r\n        });\r\n\r\n        if (!sale || sale.branchId !== businessId) {\r\n            return { success: false, error: 'Sale not found or unauthorized' };\r\n        }\r\n\r\n        // Delete installments\r\n        if (sale.installments && sale.installments.length > 0) {\r\n            await db.installmentPayment.deleteMany({\r\n                where: { saleId: id }\r\n            });\r\n        }\r\n\r\n        // Delete associated cash transaction\r\n        if (sale.cashTransactionId) {\r\n            await db.cashTransaction.delete({\r\n                where: { id: sale.cashTransactionId }\r\n            });\r\n        }\r\n\r\n        // Delete the sale itself\r\n        await db.sale.delete({\r\n            where: { id }\r\n        });\r\n\r\n        return {\r\n            success: true,\r\n            sale: {\r\n                receiptNumber: sale.receiptNumber,\r\n                customerName: sale.customerName,\r\n                customerAddress: sale.customerAddress,\r\n                customerContact: sale.customerContact,\r\n                paymentStatus: sale.paymentStatus,\r\n                cashTransactionId: sale.cashTransactionId,\r\n                items: sale.items as any,\r\n                amountPaid: sale.amountPaid,\r\n                amountDue: sale.amountDue,\r\n                profit: sale.profit,\r\n                taxRate: sale.taxRate,\r\n                notes: sale.notes\r\n            }\r\n        };\r\n    } catch (error) {\r\n        console.error('Error deleting sale:', error);\r\n        return { success: false, error: 'Failed to delete sale' };\r\n    }\r\n}\r\n\r\nexport async function upsertSaleAction(saleDbData: any, isUpdate: boolean, updateId?: string) {\r\n    try {\r\n        const prismaData = {\r\n            userId: saleDbData.user_id,\r\n            branchId: saleDbData.location_id,\r\n            receiptNumber: saleDbData.receipt_number,\r\n            customerName: saleDbData.customer_name,\r\n            customerAddress: saleDbData.customer_address,\r\n            customerContact: saleDbData.customer_contact,\r\n            customerId: saleDbData.customer_id,\r\n            items: saleDbData.items,\r\n            paymentStatus: saleDbData.payment_status,\r\n            profit: saleDbData.profit,\r\n            date: new Date(saleDbData.date),\r\n            taxRate: saleDbData.tax_rate,\r\n            cashTransactionId: saleDbData.cash_transaction_id,\r\n            amountPaid: saleDbData.amount_paid,\r\n            amountDue: saleDbData.amount_due,\r\n            categoryId: saleDbData.category_id,\r\n            notes: saleDbData.notes\r\n        };\r\n\r\n        if (isUpdate && updateId) {\r\n            const updated = await db.sale.update({\r\n                where: { id: updateId },\r\n                data: prismaData\r\n            });\r\n            return { success: true, data: updated };\r\n        } else {\r\n            const created = await db.sale.create({\r\n                data: prismaData\r\n            });\r\n            return { success: true, data: created };\r\n        }\r\n    } catch (error: any) {\r\n        console.error('Error upserting sale:', error);\r\n        return { success: false, error: error.message || 'Failed to preserve sale' };\r\n    }\r\n}\r\n\r\nexport async function createReceiptAction(saleData: any, businessId: string, userId: string) {\r\n    try {\r\n        const created = await db.sale.create({\r\n            data: {\r\n                userId: userId,\r\n                branchId: businessId,\r\n                receiptNumber: saleData.receiptNumber,\r\n                customerName: saleData.customerName,\r\n                customerId: saleData.customerId,\r\n                date: new Date(saleData.date),\r\n                items: saleData.items,\r\n                paymentStatus: saleData.paymentStatus,\r\n                profit: saleData.profit,\r\n                amountPaid: saleData.amountPaid,\r\n                amountDue: saleData.amountDue,\r\n                cashAccountId: saleData.cashAccountId,\r\n                notes: saleData.notes\r\n            }\r\n        });\r\n\r\n        revalidatePath('/sales');\r\n        revalidatePath('/customers');\r\n\r\n        return { success: true, data: created };\r\n    } catch (error: any) {\r\n        console.error('Error creating receipt:', error);\r\n        return { success: false, error: error.message || 'Failed to create receipt' };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MAKsB,wBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA,kDAAA"}},
    {"offset": {"line": 140, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/app/actions/sales.ts"],"sourcesContent":["'use server';\r\n\r\nimport { db } from '../../../prisma/db';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\nexport async function getSalesAction(businessId: string, sortOrder: 'asc' | 'desc' = 'desc', pageSize?: number) {\r\n    try {\r\n        const queryOptions: any = {\r\n            where: {\r\n                branchId: businessId,\r\n            },\r\n            orderBy: {\r\n                createdAt: sortOrder,\r\n            },\r\n            include: {\r\n                cashTransaction: true,\r\n            }\r\n        };\r\n\r\n        if (pageSize && pageSize > 0) {\r\n            queryOptions.take = pageSize;\r\n        }\r\n\r\n        const sales = await db.sale.findMany(queryOptions);\r\n\r\n        // Provide default mappings to existing React components\r\n        return sales.map((item: any) => ({\r\n            id: item.id,\r\n            user_id: item.userId,\r\n            location_id: item.branchId,\r\n            receipt_number: item.receiptNumber,\r\n            customer_name: item.customerName,\r\n            customer_address: item.customerAddress,\r\n            customer_contact: item.customerContact,\r\n            customer_id: item.customerId,\r\n            items: item.items as any, // jsonb type\r\n            payment_status: item.paymentStatus,\r\n            profit: item.profit,\r\n            date: item.date.toISOString(),\r\n            tax_rate: item.taxRate ? Number(item.taxRate) : 0,\r\n            created_at: item.createdAt.toISOString(),\r\n            updated_at: item.updatedAt.toISOString(),\r\n            cash_transaction_id: item.cashTransactionId,\r\n            amount_paid: item.amountPaid,\r\n            amount_due: item.amountDue,\r\n            category_id: item.categoryId,\r\n            notes: item.notes\r\n        }));\r\n    } catch (error) {\r\n        console.error('Error fetching sales:', error);\r\n        return [];\r\n    }\r\n}\r\n\r\nexport async function deleteSaleAction(id: string, businessId: string) {\r\n    try {\r\n        const sale = await db.sale.findUnique({\r\n            where: { id },\r\n            include: { cashTransaction: true, installments: true }\r\n        });\r\n\r\n        if (!sale || sale.branchId !== businessId) {\r\n            return { success: false, error: 'Sale not found or unauthorized' };\r\n        }\r\n\r\n        // Delete installments\r\n        if (sale.installments && sale.installments.length > 0) {\r\n            await db.installmentPayment.deleteMany({\r\n                where: { saleId: id }\r\n            });\r\n        }\r\n\r\n        // Delete associated cash transaction\r\n        if (sale.cashTransactionId) {\r\n            await db.cashTransaction.delete({\r\n                where: { id: sale.cashTransactionId }\r\n            });\r\n        }\r\n\r\n        // Delete the sale itself\r\n        await db.sale.delete({\r\n            where: { id }\r\n        });\r\n\r\n        return {\r\n            success: true,\r\n            sale: {\r\n                receiptNumber: sale.receiptNumber,\r\n                customerName: sale.customerName,\r\n                customerAddress: sale.customerAddress,\r\n                customerContact: sale.customerContact,\r\n                paymentStatus: sale.paymentStatus,\r\n                cashTransactionId: sale.cashTransactionId,\r\n                items: sale.items as any,\r\n                amountPaid: sale.amountPaid,\r\n                amountDue: sale.amountDue,\r\n                profit: sale.profit,\r\n                taxRate: sale.taxRate,\r\n                notes: sale.notes\r\n            }\r\n        };\r\n    } catch (error) {\r\n        console.error('Error deleting sale:', error);\r\n        return { success: false, error: 'Failed to delete sale' };\r\n    }\r\n}\r\n\r\nexport async function upsertSaleAction(saleDbData: any, isUpdate: boolean, updateId?: string) {\r\n    try {\r\n        const prismaData = {\r\n            userId: saleDbData.user_id,\r\n            branchId: saleDbData.location_id,\r\n            receiptNumber: saleDbData.receipt_number,\r\n            customerName: saleDbData.customer_name,\r\n            customerAddress: saleDbData.customer_address,\r\n            customerContact: saleDbData.customer_contact,\r\n            customerId: saleDbData.customer_id,\r\n            items: saleDbData.items,\r\n            paymentStatus: saleDbData.payment_status,\r\n            profit: saleDbData.profit,\r\n            date: new Date(saleDbData.date),\r\n            taxRate: saleDbData.tax_rate,\r\n            cashTransactionId: saleDbData.cash_transaction_id,\r\n            amountPaid: saleDbData.amount_paid,\r\n            amountDue: saleDbData.amount_due,\r\n            categoryId: saleDbData.category_id,\r\n            notes: saleDbData.notes\r\n        };\r\n\r\n        if (isUpdate && updateId) {\r\n            const updated = await db.sale.update({\r\n                where: { id: updateId },\r\n                data: prismaData\r\n            });\r\n            return { success: true, data: updated };\r\n        } else {\r\n            const created = await db.sale.create({\r\n                data: prismaData\r\n            });\r\n            return { success: true, data: created };\r\n        }\r\n    } catch (error: any) {\r\n        console.error('Error upserting sale:', error);\r\n        return { success: false, error: error.message || 'Failed to preserve sale' };\r\n    }\r\n}\r\n\r\nexport async function createReceiptAction(saleData: any, businessId: string, userId: string) {\r\n    try {\r\n        const created = await db.sale.create({\r\n            data: {\r\n                userId: userId,\r\n                branchId: businessId,\r\n                receiptNumber: saleData.receiptNumber,\r\n                customerName: saleData.customerName,\r\n                customerId: saleData.customerId,\r\n                date: new Date(saleData.date),\r\n                items: saleData.items,\r\n                paymentStatus: saleData.paymentStatus,\r\n                profit: saleData.profit,\r\n                amountPaid: saleData.amountPaid,\r\n                amountDue: saleData.amountDue,\r\n                cashAccountId: saleData.cashAccountId,\r\n                notes: saleData.notes\r\n            }\r\n        });\r\n\r\n        revalidatePath('/sales');\r\n        revalidatePath('/customers');\r\n\r\n        return { success: true, data: created };\r\n    } catch (error: any) {\r\n        console.error('Error creating receipt:', error);\r\n        return { success: false, error: error.message || 'Failed to create receipt' };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MAsDsB,wBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA,oDAAA"}},
    {"offset": {"line": 157, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/app/actions/analytics.ts"],"sourcesContent":["'use server';\r\n\r\nimport { db } from '../../../prisma/db';\r\n\r\nexport interface InventoryStats {\r\n    totalCostValue: number;\r\n    totalStockValue: number;\r\n    lowStockCount: number;\r\n    outOfStockCount: number;\r\n}\r\n\r\nexport async function getGlobalInventoryStatsAction(businessId: string) {\r\n    try {\r\n        const products = await db.product.findMany({\r\n            where: {\r\n                branchId: businessId,\r\n                deletedAt: null\r\n            },\r\n            select: {\r\n                stockLevel: true,\r\n                minStockLevel: true,\r\n                costPrice: true,\r\n                sellingPrice: true\r\n            }\r\n        });\r\n\r\n        const stats: InventoryStats = products.reduce((acc, p) => {\r\n            const stock = p.stockLevel || 0;\r\n            const cost = p.costPrice || 0;\r\n            const price = p.sellingPrice || 0;\r\n            const minStock = p.minStockLevel || 0;\r\n\r\n            acc.totalCostValue += stock * cost;\r\n            acc.totalStockValue += stock * price;\r\n\r\n            if (stock <= 0) {\r\n                acc.outOfStockCount += 1;\r\n            } else if (stock <= minStock) {\r\n                acc.lowStockCount += 1;\r\n            }\r\n\r\n            return acc;\r\n        }, {\r\n            totalCostValue: 0,\r\n            totalStockValue: 0,\r\n            lowStockCount: 0,\r\n            outOfStockCount: 0\r\n        });\r\n\r\n        return { success: true, data: stats };\r\n    } catch (error: any) {\r\n        console.error('Error fetching global inventory stats:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\nexport async function getTotalExpensesAction(businessId: string, startDate?: string, endDate?: string) {\r\n    try {\r\n        const where: any = {\r\n            locationId: businessId\r\n        };\r\n\r\n        if (startDate || endDate) {\r\n            where.date = {};\r\n            if (startDate) {\r\n                where.date.gte = new Date(startDate);\r\n            }\r\n            if (endDate) {\r\n                where.date.lte = new Date(endDate);\r\n            }\r\n        }\r\n\r\n        const expenses = await db.expense.findMany({\r\n            where,\r\n            select: {\r\n                amount: true\r\n            }\r\n        });\r\n\r\n        const total = expenses.reduce((sum, e) => sum + Number(e.amount), 0);\r\n\r\n        return { success: true, data: total };\r\n    } catch (error: any) {\r\n        console.error('Error fetching total expenses:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MAWsB,wBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA,iEAAA"}},
    {"offset": {"line": 174, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/utils/searchUtils.ts"],"sourcesContent":["import { Product } from '@/types';\r\n\r\n/**\r\n * Checks if a search term (possibly containing multiple words in any order) matches a product.\r\n * Returns true if every word in the search term is found in at least one searchable field of the product.\r\n */\r\nexport const matchProductSearch = (product: Product, searchTerm: string): boolean => {\r\n    if (!searchTerm || !searchTerm.trim()) return true;\r\n\r\n    const words = searchTerm.toLowerCase().trim().split(/\\s+/);\r\n\r\n    const searchableText = [\r\n        String(product.name || ''),\r\n        String(product.description || ''),\r\n        String(product.category || ''),\r\n        String(product.supplier || ''),\r\n        String(product.itemNumber || ''),\r\n        String(product.barcode || ''),\r\n        String(product.manufacturerBarcode || '')\r\n    ].map(s => s.toLowerCase());\r\n\r\n    // Every word in the search must match at least one searchable field\r\n    return words.every(word =>\r\n        searchableText.some(field => field.includes(word))\r\n    );\r\n};\r\n"],"names":[],"mappings":";;;;AAMO,MAAM,qBAAqB,CAAC,SAAkB;IACjD,IAAI,CAAC,cAAc,CAAC,WAAW,IAAI,IAAI,OAAO;IAE9C,MAAM,QAAQ,WAAW,WAAW,GAAG,IAAI,GAAG,KAAK,CAAC;IAEpD,MAAM,iBAAiB;QACnB,OAAO,QAAQ,IAAI,IAAI;QACvB,OAAO,QAAQ,WAAW,IAAI;QAC9B,OAAO,QAAQ,QAAQ,IAAI;QAC3B,OAAO,QAAQ,QAAQ,IAAI;QAC3B,OAAO,QAAQ,UAAU,IAAI;QAC7B,OAAO,QAAQ,OAAO,IAAI;QAC1B,OAAO,QAAQ,mBAAmB,IAAI;KACzC,CAAC,GAAG,CAAC,CAAA,IAAK,EAAE,WAAW;IAExB,oEAAoE;IACpE,OAAO,MAAM,KAAK,CAAC,CAAA,OACf,eAAe,IAAI,CAAC,CAAA,QAAS,MAAM,QAAQ,CAAC;AAEpD"}},
    {"offset": {"line": 200, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/utils/inventoryCacheUtils.ts"],"sourcesContent":["import { QueryClient } from \"@tanstack/react-query\";\r\n\r\n/**\r\n * Utility to clear inventory-related caches (both localStorage and React Query)\r\n * to ensure real-time data accuracy.\r\n */\r\nexport const clearInventoryCaches = (queryClient?: QueryClient) => {\r\n    if (typeof window === 'undefined') return;\r\n\r\n    // 1. Clear LocalStorage (Legacy / Manual caches)\r\n    const keys = Object.keys(localStorage);\r\n    const patterns = [\r\n        'allProductsStats_',\r\n        'stockSummary_',\r\n        'soldItems_',\r\n        'dashboardData_',\r\n        'analyticsData_'\r\n    ];\r\n\r\n    let clearedCount = 0;\r\n    keys.forEach(key => {\r\n        if (patterns.some(pattern => key.startsWith(pattern))) {\r\n            localStorage.removeItem(key);\r\n            clearedCount++;\r\n        }\r\n    });\r\n\r\n    if (clearedCount > 0) {\r\n        console.log(`[Cache] Cleared ${clearedCount} inventory-related localStorage entries.`);\r\n    }\r\n\r\n    // 2. Invalidate React Query Keys (Modern State)\r\n    if (queryClient) {\r\n        console.log('[Cache] Invalidating React Query inventory keys...');\r\n        // Invalidate specific keys used in the inventory module\r\n        queryClient.invalidateQueries({ queryKey: ['inventory_global_stats'] });\r\n        queryClient.invalidateQueries({ queryKey: ['stockSummary'] });\r\n        queryClient.invalidateQueries({ queryKey: ['products'] });\r\n        queryClient.invalidateQueries({ queryKey: ['sales'] });\r\n        queryClient.invalidateQueries({ queryKey: ['all-products-for-scanner'] });\r\n        queryClient.invalidateQueries({ queryKey: ['all-products'] });\r\n    }\r\n};\r\n"],"names":[],"mappings":";;;;AAMO,MAAM,uBAAuB,CAAC;IACjC;;IAEA,iDAAiD;IACjD,MAAM,OAAO,OAAO,IAAI,CAAC;IACzB,MAAM,WAAW;QACb;QACA;QACA;QACA;QACA;KACH;IAED,IAAI,eAAe;IACnB,KAAK,OAAO,CAAC,CAAA;QACT,IAAI,SAAS,IAAI,CAAC,CAAA,UAAW,IAAI,UAAU,CAAC,WAAW;YACnD,aAAa,UAAU,CAAC;YACxB;QACJ;IACJ;IAEA,IAAI,eAAe,GAAG;QAClB,QAAQ,GAAG,CAAC,CAAC,gBAAgB,EAAE,aAAa,wCAAwC,CAAC;IACzF;IAEA,gDAAgD;IAChD,IAAI,aAAa;QACb,QAAQ,GAAG,CAAC;QACZ,wDAAwD;QACxD,YAAY,iBAAiB,CAAC;YAAE,UAAU;gBAAC;aAAyB;QAAC;QACrE,YAAY,iBAAiB,CAAC;YAAE,UAAU;gBAAC;aAAe;QAAC;QAC3D,YAAY,iBAAiB,CAAC;YAAE,UAAU;gBAAC;aAAW;QAAC;QACvD,YAAY,iBAAiB,CAAC;YAAE,UAAU;gBAAC;aAAQ;QAAC;QACpD,YAAY,iBAAiB,CAAC;YAAE,UAAU;gBAAC;aAA2B;QAAC;QACvE,YAAY,iBAAiB,CAAC;YAAE,UAAU;gBAAC;aAAe;QAAC;IAC/D;AACJ"}},
    {"offset": {"line": 269, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/utils/dateFilters.ts"],"sourcesContent":["\r\nimport { startOfDay, endOfDay, startOfWeek, endOfWeek, startOfMonth, endOfMonth, startOfYear, endOfYear, subDays, subWeeks, subMonths } from 'date-fns';\r\n\r\nexport const getDateRangeFromFilter = (filter: string): { from: Date; to: Date } => {\r\n  const now = new Date();\r\n  const today = startOfDay(now);\r\n  \r\n  switch (filter) {\r\n    case 'today':\r\n      return {\r\n        from: today,\r\n        to: endOfDay(now)\r\n      };\r\n    case 'yesterday':\r\n      const yesterday = subDays(today, 1);\r\n      return {\r\n        from: yesterday,\r\n        to: endOfDay(yesterday)\r\n      };\r\n    case 'this-week':\r\n      return {\r\n        from: startOfWeek(now),\r\n        to: endOfWeek(now)\r\n      };\r\n    case 'last-week':\r\n      const lastWeekStart = startOfWeek(subWeeks(now, 1));\r\n      return {\r\n        from: lastWeekStart,\r\n        to: endOfWeek(lastWeekStart)\r\n      };\r\n    case 'this-month':\r\n      return {\r\n        from: startOfMonth(now),\r\n        to: endOfMonth(now)\r\n      };\r\n    case 'last-month':\r\n      const lastMonthStart = startOfMonth(subMonths(now, 1));\r\n      return {\r\n        from: lastMonthStart,\r\n        to: endOfMonth(lastMonthStart)\r\n      };\r\n    case 'this-year':\r\n      return {\r\n        from: startOfYear(now),\r\n        to: endOfYear(now)\r\n      };\r\n    default:\r\n      // For 'all' or any other case, return a very wide range\r\n      return {\r\n        from: new Date(2000, 0, 1),\r\n        to: endOfDay(now)\r\n      };\r\n  }\r\n};\r\n\r\nexport const isDateInRange = (date: Date, from: Date | undefined, to: Date | undefined): boolean => {\r\n  if (!from && !to) return true;\r\n  if (!from) return date <= to!;\r\n  if (!to) return date >= from;\r\n  return date >= from && date <= to;\r\n};\r\n"],"names":[],"mappings":";;;;;;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAEO,MAAM,yBAAyB,CAAC;IACrC,MAAM,MAAM,IAAI;IAChB,MAAM,QAAQ,IAAA,0JAAU,EAAC;IAEzB,OAAQ;QACN,KAAK;YACH,OAAO;gBACL,MAAM;gBACN,IAAI,IAAA,sJAAQ,EAAC;YACf;QACF,KAAK;YACH,MAAM,YAAY,IAAA,oJAAO,EAAC,OAAO;YACjC,OAAO;gBACL,MAAM;gBACN,IAAI,IAAA,sJAAQ,EAAC;YACf;QACF,KAAK;YACH,OAAO;gBACL,MAAM,IAAA,4JAAW,EAAC;gBAClB,IAAI,IAAA,wJAAS,EAAC;YAChB;QACF,KAAK;YACH,MAAM,gBAAgB,IAAA,4JAAW,EAAC,IAAA,sJAAQ,EAAC,KAAK;YAChD,OAAO;gBACL,MAAM;gBACN,IAAI,IAAA,wJAAS,EAAC;YAChB;QACF,KAAK;YACH,OAAO;gBACL,MAAM,IAAA,8JAAY,EAAC;gBACnB,IAAI,IAAA,0JAAU,EAAC;YACjB;QACF,KAAK;YACH,MAAM,iBAAiB,IAAA,8JAAY,EAAC,IAAA,wJAAS,EAAC,KAAK;YACnD,OAAO;gBACL,MAAM;gBACN,IAAI,IAAA,0JAAU,EAAC;YACjB;QACF,KAAK;YACH,OAAO;gBACL,MAAM,IAAA,4JAAW,EAAC;gBAClB,IAAI,IAAA,wJAAS,EAAC;YAChB;QACF;YACE,wDAAwD;YACxD,OAAO;gBACL,MAAM,IAAI,KAAK,MAAM,GAAG;gBACxB,IAAI,IAAA,sJAAQ,EAAC;YACf;IACJ;AACF;AAEO,MAAM,gBAAgB,CAAC,MAAY,MAAwB;IAChE,IAAI,CAAC,QAAQ,CAAC,IAAI,OAAO;IACzB,IAAI,CAAC,MAAM,OAAO,QAAQ;IAC1B,IAAI,CAAC,IAAI,OAAO,QAAQ;IACxB,OAAO,QAAQ,QAAQ,QAAQ;AACjC"}},
    {"offset": {"line": 350, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/utils/discountCalculations.ts"],"sourcesContent":["import { SaleItem } from '@/types';\r\n\r\n/**\r\n * Calculate the actual amount for a sale item after applying discounts\r\n */\r\nexport const calculateItemActualAmount = (item: SaleItem): number => {\r\n  const subtotal = item.price * item.quantity;\r\n  \r\n  let discountAmount = 0;\r\n  \r\n  // Handle cases where discountType is explicitly set\r\n  if (item.discountType === 'amount') {\r\n    discountAmount = Number(item.discountAmount) || 0;\r\n  } else if (item.discountType === 'percentage') {\r\n    const percentage = Number(item.discountPercentage) || 0;\r\n    discountAmount = (subtotal * percentage) / 100;\r\n  } \r\n  // Fallback: Infer discount type from available data (for legacy sales)\r\n  else if (!item.discountType) {\r\n    const percentage = Number(item.discountPercentage) || 0;\r\n    const amount = Number(item.discountAmount) || 0;\r\n    \r\n    if (percentage > 0) {\r\n      // Treat as percentage discount\r\n      discountAmount = (subtotal * percentage) / 100;\r\n    } else if (amount > 0) {\r\n      // Treat as amount discount\r\n      discountAmount = amount;\r\n    }\r\n  }\r\n  \r\n  return subtotal - discountAmount;\r\n};\r\n\r\n/**\r\n * Calculate the actual selling price per unit after discount\r\n */\r\nexport const calculateItemActualPrice = (item: SaleItem): number => {\r\n  const actualAmount = calculateItemActualAmount(item);\r\n  return actualAmount / item.quantity;\r\n};"],"names":[],"mappings":";;;;;;AAKO,MAAM,4BAA4B,CAAC;IACxC,MAAM,WAAW,KAAK,KAAK,GAAG,KAAK,QAAQ;IAE3C,IAAI,iBAAiB;IAErB,oDAAoD;IACpD,IAAI,KAAK,YAAY,KAAK,UAAU;QAClC,iBAAiB,OAAO,KAAK,cAAc,KAAK;IAClD,OAAO,IAAI,KAAK,YAAY,KAAK,cAAc;QAC7C,MAAM,aAAa,OAAO,KAAK,kBAAkB,KAAK;QACtD,iBAAiB,AAAC,WAAW,aAAc;IAC7C,OAEK,IAAI,CAAC,KAAK,YAAY,EAAE;QAC3B,MAAM,aAAa,OAAO,KAAK,kBAAkB,KAAK;QACtD,MAAM,SAAS,OAAO,KAAK,cAAc,KAAK;QAE9C,IAAI,aAAa,GAAG;YAClB,+BAA+B;YAC/B,iBAAiB,AAAC,WAAW,aAAc;QAC7C,OAAO,IAAI,SAAS,GAAG;YACrB,2BAA2B;YAC3B,iBAAiB;QACnB;IACF;IAEA,OAAO,WAAW;AACpB;AAKO,MAAM,2BAA2B,CAAC;IACvC,MAAM,eAAe,0BAA0B;IAC/C,OAAO,eAAe,KAAK,QAAQ;AACrC"}},
    {"offset": {"line": 389, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/utils/exportSoldItemsToCSV.ts"],"sourcesContent":["\r\ninterface SoldItem {\r\n  description: string;\r\n  totalQuantity: number;\r\n  averagePrice: number;\r\n  totalAmount: number;\r\n  totalCost: number;\r\n  totalProfit: number;\r\n  totalDiscount: number;\r\n  averageCost?: number;\r\n}\r\n\r\nexport const exportSoldItemsToCSV = (soldItems: SoldItem[], period: string, currency: string = 'USD', costOnlyMode: boolean = false) => {\r\n  // Create CSV header based on mode\r\n  const headers = costOnlyMode \r\n    ? ['Item', 'Quantity', 'Average Cost', 'Total Cost']\r\n    : ['Item', 'Quantity', 'Average Price', 'Total Amount', 'Discount', 'Cost Amount', 'Profit'];\r\n  \r\n  // Number formatter without currency symbol and no decimal points\r\n  const numberFormatter = new Intl.NumberFormat('en-US', {\r\n    minimumFractionDigits: 0,\r\n    maximumFractionDigits: 0\r\n  });\r\n  \r\n  // Create CSV rows with clean numeric values based on mode\r\n  const rows = soldItems.map(item => {\r\n    if (costOnlyMode) {\r\n      return [\r\n        item.description,\r\n        item.totalQuantity.toString(),\r\n        numberFormatter.format(item.averageCost || 0),\r\n        numberFormatter.format(item.totalCost)\r\n      ];\r\n    } else {\r\n      return [\r\n        item.description,\r\n        item.totalQuantity.toString(),\r\n        numberFormatter.format(item.averagePrice),\r\n        numberFormatter.format(item.totalAmount),\r\n        numberFormatter.format(item.totalDiscount),\r\n        numberFormatter.format(item.totalCost),\r\n        numberFormatter.format(item.totalProfit)\r\n      ];\r\n    }\r\n  });\r\n  \r\n  // Add summary row based on mode\r\n  const totalQuantity = soldItems.reduce((sum, item) => sum + item.totalQuantity, 0);\r\n  const totalAmount = soldItems.reduce((sum, item) => sum + item.totalAmount, 0);\r\n  const totalDiscount = soldItems.reduce((sum, item) => sum + item.totalDiscount, 0);\r\n  const totalCost = soldItems.reduce((sum, item) => sum + item.totalCost, 0);\r\n  const totalProfit = soldItems.reduce((sum, item) => sum + item.totalProfit, 0);\r\n  \r\n  rows.push(['']); // Empty row\r\n  rows.push(['SUMMARY', '', '', '', '', '', '']);\r\n  rows.push(['Total Items', soldItems.length.toString(), '', '', '', '', '']);\r\n  rows.push(['Total Quantity', totalQuantity.toString(), '', '', '', '', '']);\r\n  \r\n  if (costOnlyMode) {\r\n    rows.push(['Total Cost', '', '', numberFormatter.format(totalCost)]);\r\n  } else {\r\n    rows.push(['Total Revenue', '', '', numberFormatter.format(totalAmount), '', '', '']);\r\n    rows.push(['Total Discount', '', '', '', numberFormatter.format(totalDiscount), '', '']);\r\n    rows.push(['Total Cost', '', '', '', '', numberFormatter.format(totalCost), '']);\r\n    rows.push(['Total Profit', '', '', '', '', '', numberFormatter.format(totalProfit)]);\r\n  }\r\n  \r\n  // Combine headers and rows\r\n  const csvContent = [headers, ...rows]\r\n    .map(row => row.map(cell => `\"${cell}\"`).join(','))\r\n    .join('\\n');\r\n  \r\n  // Create and download the file\r\n  const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\r\n  const link = document.createElement('a');\r\n  const url = URL.createObjectURL(blob);\r\n  \r\n  const modePrefix = costOnlyMode ? 'cost_data_' : '';\r\n  link.setAttribute('href', url);\r\n  link.setAttribute('download', `${modePrefix}sold_items_${period.replace(/\\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.csv`);\r\n  link.style.visibility = 'hidden';\r\n  \r\n  document.body.appendChild(link);\r\n  link.click();\r\n  document.body.removeChild(link);\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 544, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/utils/exportSoldItemsToPDF.ts"],"sourcesContent":["import { formatCashCurrency } from '@/lib/utils';\r\nimport { format } from 'date-fns';\r\nimport jsPDF from 'jspdf';\r\n\r\ninterface SoldItem {\r\n  description: string;\r\n  totalQuantity: number;\r\n  averagePrice: number;\r\n  totalAmount: number;\r\n  totalCost?: number;\r\n  totalProfit?: number;\r\n  totalDiscount?: number;\r\n}\r\n\r\nexport const exportSoldItemsToPDF = (\r\n  soldItems: SoldItem[], \r\n  period: string, \r\n  currency: string = 'USD', \r\n  costOnlyMode: boolean = false,\r\n  dateRange?: { from: Date | undefined; to: Date | undefined },\r\n  businessSettings?: {\r\n    businessName: string;\r\n    businessAddress: string;\r\n    businessPhone: string;\r\n    businessEmail: string;\r\n  }\r\n) => {\r\n  // Create new PDF document in portrait orientation\r\n  const pdf = new jsPDF({\r\n    orientation: 'portrait',\r\n    unit: 'mm',\r\n    format: 'a4',\r\n    compress: true\r\n  });\r\n\r\n  const pageWidth = pdf.internal.pageSize.getWidth();\r\n  const pageHeight = pdf.internal.pageSize.getHeight();\r\n  const margins = { top: 15, right: 15, bottom: 15, left: 15 };\r\n  const contentWidth = pageWidth - margins.left - margins.right;\r\n  \r\n  let currentY = margins.top;\r\n\r\n  // Table setup - adjusted column widths based on mode\r\n  const colWidths = costOnlyMode \r\n    ? [60, 30, 40, 40] // Item, Quantity, Avg Cost, Total Cost\r\n    : [38, 18, 22, 22, 20, 20, 20]; // Item, Quantity, Avg Price, Total, Discount, Cost, Profit\r\n  const rowHeight = 8;\r\n  const headerHeight = 10;\r\n\r\n  // Table headers based on mode\r\n  const headers = costOnlyMode\r\n    ? ['Item', 'Quantity', 'Avg Cost', 'Total Cost']\r\n    : ['Item', 'Quantity', 'Avg Price', 'Total', 'Discount', 'Cost', 'Profit'];\r\n\r\n  // Function to add watermark to current page\r\n  const addWatermark = () => {\r\n    pdf.setFontSize(8);\r\n    pdf.setFont('helvetica', 'normal');\r\n    pdf.setTextColor(150, 150, 150); // Light gray color\r\n    pdf.text('Created By Gonza Systems', pageWidth / 2, pageHeight - 10, { align: 'center' });\r\n    pdf.setTextColor(0, 0, 0); // Reset to black\r\n  };\r\n\r\n  // Function to draw table headers\r\n  const drawTableHeaders = () => {\r\n    // Draw header background\r\n    pdf.setFillColor(243, 244, 246);\r\n    pdf.rect(margins.left, currentY - 2, contentWidth, headerHeight, 'F');\r\n\r\n    // Draw header borders\r\n    pdf.setLineWidth(0.3);\r\n    pdf.rect(margins.left, currentY - 2, contentWidth, headerHeight);\r\n\r\n    // Header text\r\n    pdf.setFontSize(10);\r\n    pdf.setFont('helvetica', 'bold');\r\n    let currentX = margins.left;\r\n    \r\n    headers.forEach((header, index) => {\r\n      const colWidth = colWidths[index];\r\n      const textWidth = pdf.getTextWidth(header);\r\n      const textX = currentX + (colWidth - textWidth) / 2;\r\n      pdf.text(header, textX, currentY + 6);\r\n      \r\n      if (index < headers.length - 1) {\r\n        pdf.line(currentX + colWidth, currentY - 2, currentX + colWidth, currentY + headerHeight - 2);\r\n      }\r\n      \r\n      currentX += colWidth;\r\n    });\r\n\r\n    currentY += headerHeight;\r\n  };\r\n\r\n  // Helper function to check if we need a new page\r\n  const checkPageBreak = (neededHeight: number) => {\r\n    if (currentY + neededHeight > pageHeight - margins.bottom - 15) { // Reserve space for watermark\r\n      addWatermark(); // Add watermark to current page before creating new one\r\n      pdf.addPage();\r\n      currentY = margins.top;\r\n      drawTableHeaders(); // Add headers to new page\r\n      // Reset font to normal after drawing headers on new page\r\n      pdf.setFont('helvetica', 'normal');\r\n      pdf.setFontSize(9);\r\n      return true;\r\n    }\r\n    return false;\r\n  };\r\n\r\n  // Header section with business details on left and title on right\r\n  const headerStartY = currentY;\r\n  \r\n  // Business details on the left\r\n  if (businessSettings) {\r\n    pdf.setFontSize(12);\r\n    pdf.setFont('helvetica', 'bold');\r\n    pdf.text(businessSettings.businessName, margins.left, currentY);\r\n    currentY += 6;\r\n    \r\n    pdf.setFontSize(9);\r\n    pdf.setFont('helvetica', 'normal');\r\n    pdf.text(businessSettings.businessAddress, margins.left, currentY);\r\n    currentY += 5;\r\n    pdf.text(businessSettings.businessPhone, margins.left, currentY);\r\n    currentY += 5;\r\n    pdf.text(businessSettings.businessEmail, margins.left, currentY);\r\n  }\r\n  \r\n  // Reset currentY to header start for right-aligned content\r\n  currentY = headerStartY;\r\n  \r\n  // Title on the right\r\n  pdf.setFontSize(18);\r\n  pdf.setFont('helvetica', 'bold');\r\n  const title = costOnlyMode \r\n    ? `Items Cost Report (${currency})`\r\n    : `Items Sold Report (${currency})`;\r\n  const titleWidth = pdf.getTextWidth(title);\r\n  pdf.text(title, pageWidth - margins.right - titleWidth, currentY);\r\n  currentY += 10;\r\n\r\n  // Date range display - right aligned under title\r\n  if (dateRange?.from && dateRange?.to) {\r\n    pdf.setFontSize(12);\r\n    pdf.setFont('helvetica', 'normal');\r\n    const fromDate = format(dateRange.from, 'dd/MM/yyyy');\r\n    const toDate = format(dateRange.to, 'dd/MM/yyyy');\r\n    \r\n    const dateText = fromDate === toDate ? fromDate : `${fromDate} - ${toDate}`;\r\n    const dateWidth = pdf.getTextWidth(dateText);\r\n    pdf.text(dateText, pageWidth - margins.right - dateWidth, currentY);\r\n    currentY += 12;\r\n  } else {\r\n    // Fallback to current date if no range provided\r\n    pdf.setFontSize(12);\r\n    pdf.setFont('helvetica', 'normal');\r\n    const dateText = format(new Date(), 'dd/MM/yyyy');\r\n    const dateWidth = pdf.getTextWidth(dateText);\r\n    pdf.text(dateText, pageWidth - margins.right - dateWidth, currentY);\r\n    currentY += 12;\r\n  }\r\n  \r\n  // Ensure we have enough space for both sections\r\n  currentY = Math.max(currentY, headerStartY + 25);\r\n\r\n  if (soldItems.length === 0) {\r\n    // No data message\r\n    pdf.setFontSize(14);\r\n    pdf.setFont('helvetica', 'normal');\r\n    const noDataText = 'No items sold in the selected period.';\r\n    const noDataWidth = pdf.getTextWidth(noDataText);\r\n    pdf.text(noDataText, (pageWidth - noDataWidth) / 2, currentY + 30);\r\n  } else {\r\n    // Draw initial table headers\r\n    checkPageBreak(headerHeight + 10);\r\n    drawTableHeaders();\r\n\r\n    // Table data\r\n    pdf.setFont('helvetica', 'normal');\r\n    pdf.setFontSize(8);\r\n\r\n    // Number formatter without currency symbol and no decimal points\r\n    const numberFormatter = new Intl.NumberFormat('en-US', {\r\n      minimumFractionDigits: 0,\r\n      maximumFractionDigits: 0\r\n    });\r\n\r\n    soldItems.forEach((item, index) => {\r\n      checkPageBreak(rowHeight + 5);\r\n\r\n      const rowData = costOnlyMode\r\n        ? [\r\n            item.description,\r\n            item.totalQuantity.toString(),\r\n            numberFormatter.format(item.totalCost / item.totalQuantity), // Average cost\r\n            numberFormatter.format(item.totalCost)\r\n          ]\r\n        : [\r\n            item.description,\r\n            item.totalQuantity.toString(),\r\n            numberFormatter.format(item.averagePrice),\r\n            numberFormatter.format(item.totalAmount),\r\n            numberFormatter.format(item.totalDiscount || 0),\r\n            numberFormatter.format(item.totalCost || 0),\r\n            numberFormatter.format(item.totalProfit || 0)\r\n          ];\r\n\r\n      // Draw row background (alternating)\r\n      if (index % 2 === 0) {\r\n        pdf.setFillColor(249, 250, 251);\r\n        pdf.rect(margins.left, currentY - 1, contentWidth, rowHeight, 'F');\r\n      }\r\n\r\n      // Draw row borders\r\n      pdf.setLineWidth(0.1);\r\n      pdf.rect(margins.left, currentY - 1, contentWidth, rowHeight);\r\n\r\n      let currentX = margins.left;\r\n      \r\n      rowData.forEach((data, colIndex) => {\r\n        const colWidth = colWidths[colIndex];\r\n        let text = data;\r\n        \r\n        // Truncate text if too long\r\n        if (colIndex === 0) { // Item description\r\n          while (pdf.getTextWidth(text) > colWidth - 4 && text.length > 3) {\r\n            text = text.substring(0, text.length - 4) + '...';\r\n          }\r\n        }\r\n        \r\n        let textX = currentX + 2;\r\n        \r\n        // Center align numeric columns (Quantity, Avg Price, Total Amount, Cost Amount, Profit)\r\n        if (colIndex >= 1) {\r\n          const textWidth = pdf.getTextWidth(text);\r\n          textX = currentX + (colWidth - textWidth) / 2;\r\n        }\r\n        \r\n        pdf.text(text, textX, currentY + 5);\r\n        \r\n        if (colIndex < rowData.length - 1) {\r\n          pdf.line(currentX + colWidth, currentY - 1, currentX + colWidth, currentY + rowHeight - 1);\r\n        }\r\n        \r\n        currentX += colWidth;\r\n      });\r\n\r\n      currentY += rowHeight;\r\n    });\r\n\r\n    // Summary section\r\n    currentY += 10;\r\n    checkPageBreak(45);\r\n\r\n    // Summary title\r\n    pdf.setFontSize(16);\r\n    pdf.setFont('helvetica', 'bold');\r\n    pdf.text('Summary', margins.left, currentY);\r\n    currentY += 8;\r\n\r\n    // Calculate totals\r\n    const totalItems = soldItems.length;\r\n    const totalQuantity = soldItems.reduce((sum, item) => sum + item.totalQuantity, 0);\r\n    const totalRevenue = soldItems.reduce((sum, item) => sum + item.totalAmount, 0);\r\n    const totalDiscount = soldItems.reduce((sum, item) => sum + (item.totalDiscount || 0), 0);\r\n    const totalCost = soldItems.reduce((sum, item) => sum + (item.totalCost || 0), 0);\r\n    const totalProfit = soldItems.reduce((sum, item) => sum + (item.totalProfit || 0), 0);\r\n\r\n    // Draw summary box - make it wider to accommodate all content properly\r\n    const summaryBoxHeight = costOnlyMode ? 32 : 56;\r\n    const summaryBoxWidth = contentWidth;\r\n    \r\n    pdf.setFillColor(248, 249, 250);\r\n    pdf.rect(margins.left, currentY - 3, summaryBoxWidth, summaryBoxHeight, 'F');\r\n    pdf.setLineWidth(0.3);\r\n    pdf.setDrawColor(200, 200, 200);\r\n    pdf.rect(margins.left, currentY - 3, summaryBoxWidth, summaryBoxHeight);\r\n\r\n    // Summary data in columns based on mode\r\n    pdf.setFontSize(11);\r\n    pdf.setFont('helvetica', 'normal');\r\n    \r\n    const summaryData = costOnlyMode\r\n      ? [\r\n          ['Total Items:', totalItems.toString()],\r\n          ['Total Quantity:', totalQuantity.toString()],\r\n          ['Total Cost:', numberFormatter.format(totalCost)]\r\n        ]\r\n      : [\r\n          ['Total Items:', totalItems.toString()],\r\n          ['Total Quantity:', totalQuantity.toString()],\r\n          ['Total Revenue:', numberFormatter.format(totalRevenue)],\r\n          ['Total Discount:', numberFormatter.format(totalDiscount)],\r\n          ['Total Cost:', numberFormatter.format(totalCost)],\r\n          ['Total Profit:', numberFormatter.format(totalProfit)]\r\n        ];\r\n\r\n    let summaryY = currentY + 6;\r\n    const summaryX = margins.left + 15;\r\n\r\n    summaryData.forEach(([label, value]) => {\r\n      pdf.setFont('helvetica', 'bold');\r\n      pdf.text(label, summaryX, summaryY);\r\n      pdf.setFont('helvetica', 'normal');\r\n      const labelWidth = pdf.getTextWidth(label);\r\n      const valueX = summaryX + labelWidth + 5;\r\n      \r\n      // Fixed logic: Ensure the value text stays within the summary box bounds\r\n      const maxX = margins.left + summaryBoxWidth - 15;\r\n      const valueWidth = pdf.getTextWidth(value);\r\n      \r\n      // Check if text would overflow, if so right-align it within bounds\r\n      let finalX;\r\n      if (valueX + valueWidth > maxX) {\r\n        finalX = maxX - valueWidth;\r\n      } else {\r\n        finalX = valueX;\r\n      }\r\n      \r\n      pdf.text(value, finalX, summaryY);\r\n      summaryY += 8;\r\n    });\r\n  }\r\n\r\n  // Add watermark to the final page\r\n  addWatermark();\r\n\r\n  // Generate filename based on report date range\r\n  let filename: string;\r\n  const modePrefix = costOnlyMode ? 'cost_data_' : '';\r\n  \r\n  if (dateRange?.from && dateRange?.to) {\r\n    const fromDate = format(dateRange.from, 'yyyy-MM-dd');\r\n    const toDate = format(dateRange.to, 'yyyy-MM-dd');\r\n    \r\n    if (fromDate === toDate) {\r\n      filename = `${modePrefix}sold_items_${fromDate}.pdf`;\r\n    } else {\r\n      filename = `${modePrefix}sold_items_${fromDate}_to_${toDate}.pdf`;\r\n    }\r\n  } else {\r\n    // Fallback to current date if no range provided\r\n    filename = `${modePrefix}sold_items_${format(new Date(), 'yyyy-MM-dd')}.pdf`;\r\n  }\r\n\r\n  pdf.save(filename);\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 877, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/utils/generateReceiptVectorPDF.ts"],"sourcesContent":["import jsPDF from 'jspdf';\r\nimport { ReceiptData } from '@/types/receipt';\r\n\r\ninterface VectorPDFOptions {\r\n  filename?: string;\r\n  orientation?: 'portrait' | 'landscape';\r\n  format?: 'a4' | 'letter';\r\n  margins?: {\r\n    top: number;\r\n    right: number;\r\n    bottom: number;\r\n    left: number;\r\n  };\r\n  returnBlob?: boolean;\r\n}\r\n\r\n// Helper function to format currency properly (e.g., \"Ush 25,000\")\r\nconst formatCurrency = (amount: number, currency: string = 'Ush'): string => {\r\n  const formatted = Math.round(amount).toLocaleString();\r\n  return `${currency} ${formatted}`;\r\n};\r\n\r\nexport const generateReceiptVectorPDF = async (\r\n  receiptData: ReceiptData,\r\n  options: VectorPDFOptions\r\n): Promise<void | Blob> => {\r\n  const {\r\n    filename,\r\n    orientation = 'portrait',\r\n    format = 'a4',\r\n    margins = { top: 20, right: 20, bottom: 20, left: 20 },\r\n    returnBlob = false\r\n  } = options;\r\n\r\n  const pdf = new jsPDF({\r\n    orientation,\r\n    unit: 'mm',\r\n    format,\r\n    compress: true\r\n  });\r\n\r\n  const pageWidth = pdf.internal.pageSize.getWidth();\r\n  const pageHeight = pdf.internal.pageSize.getHeight();\r\n  const contentWidth = pageWidth - margins.left - margins.right;\r\n  let currentY = margins.top;\r\n\r\n  // Define thinner line width\r\n  const STANDARD_LINE_WIDTH = 0.2;\r\n\r\n  // Helper functions\r\n  const setStandardLineWidth = () => {\r\n    pdf.setLineWidth(STANDARD_LINE_WIDTH);\r\n  };\r\n\r\n  const addText = (text: string, x: number, y: number, options: any = {}) => {\r\n    const { fontSize = 10, fontStyle = 'normal', align = 'left', maxWidth } = options;\r\n    pdf.setFontSize(fontSize);\r\n    pdf.setFont('helvetica', fontStyle);\r\n    \r\n    if (maxWidth) {\r\n      const lines = pdf.splitTextToSize(text, maxWidth);\r\n      pdf.text(lines, x, y, { align });\r\n      return lines.length * (fontSize * 0.35);\r\n    } else {\r\n      pdf.text(text, x, y, { align });\r\n      return fontSize * 0.35;\r\n    }\r\n  };\r\n\r\n  const addMultilineText = (text: string, x: number, y: number, maxWidth: number, options: any = {}) => {\r\n    const { fontSize = 10, fontStyle = 'normal', align = 'left', lineHeight = 1.2 } = options;\r\n    pdf.setFontSize(fontSize);\r\n    pdf.setFont('helvetica', fontStyle);\r\n    \r\n    const lines = pdf.splitTextToSize(text, maxWidth);\r\n    const lineSpacing = fontSize * 0.35 * lineHeight;\r\n    \r\n    lines.forEach((line: string, index: number) => {\r\n      pdf.text(line, x, y + (index * lineSpacing), { align });\r\n    });\r\n    \r\n    return lines.length * lineSpacing;\r\n  };\r\n\r\n  const addLine = (x1: number, y1: number, x2: number, y2: number) => {\r\n    setStandardLineWidth();\r\n    pdf.line(x1, y1, x2, y2);\r\n  };\r\n\r\n  const addRect = (x: number, y: number, width: number, height: number, style: 'S' | 'F' | 'FD' = 'S') => {\r\n    setStandardLineWidth();\r\n    pdf.rect(x, y, width, height, style);\r\n  };\r\n\r\n  // Function to draw page border\r\n  const drawPageBorder = () => {\r\n    addRect(margins.left, margins.top, contentWidth, pageHeight - margins.top - margins.bottom, 'S');\r\n  };\r\n\r\n  // Check if we need a new page and draw border\r\n  const checkPageBreak = (requiredSpace: number) => {\r\n    if (currentY + requiredSpace > pageHeight - margins.bottom) {\r\n      pdf.addPage();\r\n      currentY = margins.top + 10; // Add some top margin on new page\r\n      drawPageBorder(); // Draw border on new page\r\n      return true;\r\n    }\r\n    return false;\r\n  };\r\n\r\n  // Draw initial page border\r\n  drawPageBorder();\r\n\r\n  // Add padding inside border\r\n  const innerMargin = 8;\r\n  const innerLeft = margins.left + innerMargin;\r\n  const innerWidth = contentWidth - (innerMargin * 2);\r\n  currentY += innerMargin;\r\n\r\n  // Header section with logo on left, business info on right\r\n  const headerStartY = currentY;\r\n  \r\n  // Logo on the left (if available) - reduced size\r\n  if (receiptData.businessLogo) {\r\n    try {\r\n      const img = new Image();\r\n      img.crossOrigin = 'anonymous';\r\n      \r\n      await new Promise<void>((resolve, reject) => {\r\n        img.onload = () => {\r\n          try {\r\n            const canvas = document.createElement('canvas');\r\n            const ctx = canvas.getContext('2d');\r\n            if (ctx) {\r\n              canvas.width = img.width;\r\n              canvas.height = img.height;\r\n              ctx.drawImage(img, 0, 0);\r\n              \r\n              const dataURL = canvas.toDataURL('image/png');\r\n              \r\n              // Logo dimensions - reduced size for more professional look\r\n              const maxLogoHeight = 15; // Further reduced from 18\r\n              const aspectRatio = img.width / img.height;\r\n              const logoHeight = Math.min(maxLogoHeight, 15);\r\n              const logoWidth = logoHeight * aspectRatio;\r\n              \r\n              // Position logo on the left\r\n              pdf.addImage(dataURL, 'PNG', innerLeft, currentY, logoWidth, logoHeight);\r\n            }\r\n          } catch (error) {\r\n            console.error('Error adding logo to PDF:', error);\r\n          }\r\n          resolve();\r\n        };\r\n        \r\n        img.onerror = () => {\r\n          console.error('Error loading logo image');\r\n          resolve();\r\n        };\r\n        \r\n        img.src = receiptData.businessLogo;\r\n      });\r\n    } catch (error) {\r\n      console.error('Error processing logo:', error);\r\n    }\r\n  }\r\n\r\n  // Business information on the right - extended area with right alignment\r\n  const businessInfoX = innerLeft + innerWidth * 0.25; // Extended area starts earlier\r\n  const businessInfoWidth = innerWidth * 0.75; // Wider area for business info\r\n  const businessInfoRightX = innerLeft + innerWidth; // Right edge for alignment\r\n  let businessY = currentY;\r\n\r\n  if (receiptData.businessName) {\r\n    businessY += addText(receiptData.businessName, businessInfoRightX, businessY, {\r\n      fontSize: 14,\r\n      fontStyle: 'bold',\r\n      align: 'right'\r\n    });\r\n    businessY += 1.5; // Reduced spacing\r\n  }\r\n\r\n  if (receiptData.businessAddress) {\r\n    const lines = pdf.splitTextToSize(receiptData.businessAddress, businessInfoWidth);\r\n    const lineHeight = 10 * 0.35 * 0.9; // Further reduced line height\r\n    \r\n    lines.forEach((line: string, index: number) => {\r\n      pdf.setFontSize(10);\r\n      pdf.setFont('helvetica', 'normal');\r\n      pdf.text(line, businessInfoRightX, businessY + (index * lineHeight), { align: 'right' });\r\n    });\r\n    \r\n    businessY += lines.length * lineHeight + 0.5; // Reduced spacing\r\n  }\r\n\r\n  if (receiptData.businessPhone) {\r\n    businessY += addText(`Phone: ${receiptData.businessPhone}`, businessInfoRightX, businessY, {\r\n      fontSize: 9,\r\n      align: 'right'\r\n    });\r\n    businessY += 0.5; // Reduced spacing\r\n  }\r\n\r\n  if (receiptData.businessEmail) {\r\n    businessY += addText(`Email: ${receiptData.businessEmail}`, businessInfoRightX, businessY, {\r\n      fontSize: 9,\r\n      align: 'right'\r\n    });\r\n    businessY += 0.5; // Reduced spacing\r\n  }\r\n\r\n  // Move currentY to after header section - reduced spacing\r\n  currentY = Math.max(currentY + 18, businessY) + 5; // Further reduced spacing\r\n\r\n  // Check for page break after header\r\n  checkPageBreak(20);\r\n\r\n  // Horizontal line after header\r\n  addLine(innerLeft, currentY, innerLeft + innerWidth, currentY);\r\n  currentY += 6; // Reduced from 8\r\n\r\n  // Document title centered\r\n  currentY += addText(receiptData.documentTitle.toUpperCase(), pageWidth / 2, currentY, {\r\n    fontSize: 16,\r\n    fontStyle: 'bold',\r\n    align: 'center'\r\n  });\r\n  currentY += 4; // Reduced from 6\r\n\r\n  // Receipt details section - further reduced spacing\r\n  const detailsStartY = currentY;\r\n  \r\n  // Left side - Receipt details with minimal spacing\r\n  let leftY = detailsStartY;\r\n  leftY += addText(`${receiptData.documentNumberLabel} ${receiptData.receiptNumber}`, innerLeft, leftY, {\r\n    fontSize: 11,\r\n    fontStyle: 'bold'\r\n  });\r\n  leftY += 2; // Further reduced from 3\r\n  \r\n  leftY += addText(`Date: ${receiptData.date}`, innerLeft, leftY, {\r\n    fontSize: 10\r\n  });\r\n  leftY += 2; // Further reduced from 3\r\n  \r\n  leftY += addText(`Time: ${receiptData.time}`, innerLeft, leftY, {\r\n    fontSize: 10\r\n  });\r\n\r\n  // Right side - Payment status\r\n  const rightX = innerLeft + innerWidth * 0.7;\r\n  addText(`Status: ${receiptData.status}`, rightX, detailsStartY, {\r\n    fontSize: 11,\r\n    fontStyle: 'bold',\r\n    align: 'left'\r\n  });\r\n\r\n  currentY = leftY + 4; // Reduced from 6\r\n\r\n  // Customer information without labels\r\n  if (receiptData.customerName && receiptData.customerName.trim() !== '') {\r\n    checkPageBreak(30);\r\n    \r\n    currentY += addText('Customer Information:', innerLeft, currentY, {\r\n      fontSize: 11,\r\n      fontStyle: 'bold'\r\n    });\r\n    currentY += 3; // Reduced from 4\r\n\r\n    // Customer name without \"Name:\" label\r\n    currentY += addText(receiptData.customerName, innerLeft, currentY, {\r\n      fontSize: 10\r\n    });\r\n    currentY += 2.5; // Reduced spacing\r\n\r\n    if (receiptData.customerAddress && receiptData.customerAddress.trim() !== '') {\r\n      // Customer address without \"Address:\" label\r\n      const addressHeight = addMultilineText(receiptData.customerAddress, innerLeft, currentY, innerWidth * 0.8, {\r\n        fontSize: 10,\r\n        lineHeight: 1.0 // Reduced from 1.1\r\n      });\r\n      currentY += addressHeight;\r\n      currentY += 2.5; // Reduced spacing\r\n    }\r\n\r\n    if (receiptData.customerContact && receiptData.customerContact.trim() !== '') {\r\n      // Customer contact without \"Contact:\" label\r\n      currentY += addText(receiptData.customerContact, innerLeft, currentY, {\r\n        fontSize: 10\r\n      });\r\n      currentY += 2.5; // Reduced spacing\r\n    }\r\n\r\n    currentY += 3; // Reduced from 6\r\n  }\r\n\r\n  // Items table - check if any items have discounts to add discount column\r\n  const hasDiscounts = receiptData.items.some(item => \r\n    (item.discountPercentage || 0) > 0 || (item.discountAmount || 0) > 0\r\n  );\r\n  const tableHeaders = hasDiscounts \r\n    ? ['Description', 'Qty', 'Unit Price', 'Discount', 'Amount']\r\n    : ['Description', 'Qty', 'Unit Price', 'Amount'];\r\n  const colWidths = hasDiscounts\r\n    ? [innerWidth * 0.35, innerWidth * 0.15, innerWidth * 0.18, innerWidth * 0.12, innerWidth * 0.2]\r\n    : [innerWidth * 0.45, innerWidth * 0.15, innerWidth * 0.2, innerWidth * 0.2];\r\n  \r\n  // Table header background\r\n  pdf.setFillColor(245, 245, 245);\r\n  addRect(innerLeft, currentY - 2, innerWidth, 10, 'F');\r\n  \r\n  // Table header borders\r\n  addRect(innerLeft, currentY - 2, innerWidth, 10, 'S');\r\n  \r\n  // Table header text\r\n  let tableX = innerLeft;\r\n  tableHeaders.forEach((header, index) => {\r\n    addText(header, tableX + 3, currentY + 4, {\r\n      fontSize: 10,\r\n      fontStyle: 'bold'\r\n    });\r\n    // Add vertical lines between columns\r\n    if (index < tableHeaders.length - 1) {\r\n      addLine(tableX + colWidths[index], currentY - 2, tableX + colWidths[index], currentY + 8);\r\n    }\r\n    tableX += colWidths[index];\r\n  });\r\n  \r\n  currentY += 10;\r\n  \r\n  // Table rows with proper text wrapping and row separation\r\n  let subtotal = 0;\r\n  const minRowHeight = 8; // Minimum row height\r\n  \r\n  receiptData.items.forEach((item, index) => {\r\n    // Calculate required row height based on description text wrapping\r\n    pdf.setFontSize(9);\r\n    const descriptionLines = pdf.splitTextToSize(item.description, colWidths[0] - 6);\r\n    const calculatedRowHeight = Math.max(minRowHeight, descriptionLines.length * 3.5 + 4);\r\n    \r\n    // Check if we need a new page for this item\r\n    checkPageBreak(calculatedRowHeight + 5);\r\n    \r\n    const itemSubtotal = item.unitPrice * item.quantity;\r\n    const discountAmount = item.discountAmount || 0;\r\n    const itemTotal = item.amount; // This should already be calculated with discount applied\r\n    subtotal += itemTotal;\r\n    \r\n    // Alternate row background for better readability\r\n    if (index % 2 === 1) {\r\n      pdf.setFillColor(250, 250, 250);\r\n      addRect(innerLeft, currentY, innerWidth, calculatedRowHeight, 'F');\r\n    }\r\n    \r\n    // Row border\r\n    addRect(innerLeft, currentY, innerWidth, calculatedRowHeight, 'S');\r\n    \r\n    tableX = innerLeft;\r\n    \r\n    // Description with proper text wrapping\r\n    addMultilineText(item.description, tableX + 3, currentY + 4, colWidths[0] - 6, {\r\n      fontSize: 9,\r\n      lineHeight: 1.1\r\n    });\r\n    tableX += colWidths[0];\r\n    \r\n    // Add vertical line after description\r\n    addLine(tableX, currentY, tableX, currentY + calculatedRowHeight);\r\n    \r\n    // Quantity - centered in cell\r\n    addText(item.quantity.toString(), tableX + colWidths[1] - 3, currentY + calculatedRowHeight/2 + 1.5, {\r\n      fontSize: 9,\r\n      align: 'right'\r\n    });\r\n    tableX += colWidths[1];\r\n    \r\n    // Add vertical line after quantity\r\n    addLine(tableX, currentY, tableX, currentY + calculatedRowHeight);\r\n    \r\n    // Unit Price - right aligned\r\n    addText(formatCurrency(item.unitPrice, receiptData.currency), tableX + colWidths[2] - 3, currentY + calculatedRowHeight/2 + 1.5, {\r\n      fontSize: 9,\r\n      align: 'right'\r\n    });\r\n    tableX += colWidths[2];\r\n    \r\n    // Add vertical line after unit price\r\n    addLine(tableX, currentY, tableX, currentY + calculatedRowHeight);\r\n    \r\n    // Discount column (if applicable)\r\n    if (hasDiscounts) {\r\n      let discountText = '-';\r\n      if ((item.discountPercentage || 0) > 0) {\r\n        discountText = `${item.discountPercentage}%`;\r\n      } else if ((item.discountAmount || 0) > 0) {\r\n        discountText = formatCurrency(item.discountAmount, receiptData.currency);\r\n      }\r\n      addText(discountText, tableX + colWidths[3] - 3, currentY + calculatedRowHeight/2 + 1.5, {\r\n        fontSize: 9,\r\n        align: 'right'\r\n      });\r\n      tableX += colWidths[3];\r\n      \r\n      // Add vertical line after discount\r\n      addLine(tableX, currentY, tableX, currentY + calculatedRowHeight);\r\n    }\r\n    \r\n    // Amount - right aligned (final amount after discount)\r\n    const finalColumnIndex = hasDiscounts ? 4 : 3;\r\n    addText(formatCurrency(itemTotal, receiptData.currency), tableX + colWidths[finalColumnIndex] - 3, currentY + calculatedRowHeight/2 + 1.5, {\r\n      fontSize: 9,\r\n      align: 'right'\r\n    });\r\n    \r\n    currentY += calculatedRowHeight;\r\n    \r\n    // Add separator line between items (except for the last item)\r\n    if (index < receiptData.items.length - 1) {\r\n      addLine(innerLeft, currentY, innerLeft + innerWidth, currentY);\r\n    }\r\n  });\r\n  \r\n  currentY += 5; // Reduced from 10\r\n  \r\n  // Professional totals section with improved layout for large figures\r\n  checkPageBreak(70); // Increased space requirement for installment sales\r\n  \r\n  // Create a proper totals table without header\r\n  const totalsStartX = innerLeft + innerWidth * 0.45;\r\n  const totalsWidth = innerWidth * 0.55;\r\n  const labelWidth = totalsWidth * 0.55;\r\n  const valueWidth = totalsWidth * 0.45;\r\n  \r\n  // Calculate total discount for the totals section\r\n  const totalDiscount = receiptData.items.reduce((total, item) => {\r\n    const itemSubtotal = item.unitPrice * item.quantity;\r\n    const discountAmount = (item.discountType === 'amount') \r\n      ? (item.discountAmount || 0)\r\n      : (itemSubtotal * (item.discountPercentage || 0)) / 100;\r\n    return total + discountAmount;\r\n  }, 0);\r\n  \r\n  // Subtotal (before discount) row - only show if there are discounts\r\n  if (totalDiscount > 0) {\r\n    addRect(totalsStartX, currentY, totalsWidth, 8, 'S');\r\n    pdf.setFillColor(248, 248, 248);\r\n    addRect(totalsStartX, currentY, totalsWidth, 8, 'F');\r\n    \r\n    addText('Subtotal (before discount):', totalsStartX + 4, currentY + 5.5, {\r\n      fontSize: 10,\r\n      fontStyle: 'normal'\r\n    });\r\n    \r\n    // Vertical line separating label and value\r\n    addLine(totalsStartX + labelWidth, currentY, totalsStartX + labelWidth, currentY + 8);\r\n    \r\n    addText(formatCurrency(subtotal + totalDiscount, receiptData.currency), totalsStartX + labelWidth + valueWidth - 4, currentY + 5.5, {\r\n      fontSize: 10,\r\n      fontStyle: 'normal',\r\n      align: 'right'\r\n    });\r\n    currentY += 8;\r\n    \r\n    // Total discount row\r\n    addRect(totalsStartX, currentY, totalsWidth, 8, 'S');\r\n    pdf.setFillColor(255, 240, 220); // Light orange background\r\n    addRect(totalsStartX, currentY, totalsWidth, 8, 'F');\r\n    \r\n    addText('Total Discount:', totalsStartX + 4, currentY + 5.5, {\r\n      fontSize: 10,\r\n      fontStyle: 'normal'\r\n    });\r\n    \r\n    // Vertical line separating label and value\r\n    addLine(totalsStartX + labelWidth, currentY, totalsStartX + labelWidth, currentY + 8);\r\n    \r\n    addText(`-${formatCurrency(totalDiscount, receiptData.currency)}`, totalsStartX + labelWidth + valueWidth - 4, currentY + 5.5, {\r\n      fontSize: 10,\r\n      fontStyle: 'normal',\r\n      align: 'right'\r\n    });\r\n    currentY += 8;\r\n  }\r\n  \r\n  // Subtotal row (after discount or just subtotal if no discounts)\r\n  addRect(totalsStartX, currentY, totalsWidth, 8, 'S');\r\n  pdf.setFillColor(248, 248, 248);\r\n  addRect(totalsStartX, currentY, totalsWidth, 8, 'F');\r\n  \r\n  addText(totalDiscount > 0 ? 'Subtotal (after discount):' : 'Subtotal:', totalsStartX + 4, currentY + 5.5, {\r\n    fontSize: 10,\r\n    fontStyle: 'normal'\r\n  });\r\n  \r\n  // Vertical line separating label and value\r\n  addLine(totalsStartX + labelWidth, currentY, totalsStartX + labelWidth, currentY + 8);\r\n  \r\n  addText(formatCurrency(subtotal, receiptData.currency), totalsStartX + labelWidth + valueWidth - 4, currentY + 5.5, {\r\n    fontSize: 10,\r\n    fontStyle: 'normal',\r\n    align: 'right'\r\n  });\r\n  currentY += 8;\r\n  \r\n  // Tax row (if applicable)\r\n  if (receiptData.showTaxRow && receiptData.taxAmount > 0) {\r\n    addRect(totalsStartX, currentY, totalsWidth, 8, 'S');\r\n    pdf.setFillColor(250, 250, 250);\r\n    addRect(totalsStartX, currentY, totalsWidth, 8, 'F');\r\n    \r\n    addText(`Tax (${receiptData.taxRate}%):`, totalsStartX + 4, currentY + 5.5, {\r\n      fontSize: 10,\r\n      fontStyle: 'normal'\r\n    });\r\n    \r\n    // Vertical line separating label and value\r\n    addLine(totalsStartX + labelWidth, currentY, totalsStartX + labelWidth, currentY + 8);\r\n    \r\n    addText(formatCurrency(receiptData.taxAmount, receiptData.currency), totalsStartX + labelWidth + valueWidth - 4, currentY + 5.5, {\r\n      fontSize: 10,\r\n      fontStyle: 'normal',\r\n      align: 'right'\r\n    });\r\n    currentY += 8;\r\n  }\r\n  \r\n  // Total row with emphasis and larger height for big figures\r\n  addRect(totalsStartX, currentY, totalsWidth, 12, 'S');\r\n  pdf.setFillColor(220, 220, 220);\r\n  addRect(totalsStartX, currentY, totalsWidth, 12, 'F');\r\n  \r\n  addText('TOTAL:', totalsStartX + 4, currentY + 7.5, {\r\n    fontSize: 12,\r\n    fontStyle: 'bold'\r\n  });\r\n  \r\n  // Vertical line separating label and value\r\n  addLine(totalsStartX + labelWidth, currentY, totalsStartX + labelWidth, currentY + 12);\r\n  \r\n  addText(formatCurrency(receiptData.totalAmount, receiptData.currency), totalsStartX + labelWidth + valueWidth - 4, currentY + 7.5, {\r\n    fontSize: 12,\r\n    fontStyle: 'bold',\r\n    align: 'right'\r\n  });\r\n  currentY += 12;\r\n\r\n  // Add Amount Paid and Amount Due for installment sales\r\n  if (receiptData.isInstallmentSale) {\r\n    // Amount Paid row\r\n    if (receiptData.amountPaid !== undefined) {\r\n      addRect(totalsStartX, currentY, totalsWidth, 8, 'S');\r\n      pdf.setFillColor(240, 248, 255); // Light blue background\r\n      addRect(totalsStartX, currentY, totalsWidth, 8, 'F');\r\n      \r\n      addText('Amount Paid:', totalsStartX + 4, currentY + 5.5, {\r\n        fontSize: 10,\r\n        fontStyle: 'bold'\r\n      });\r\n      \r\n      // Vertical line separating label and value\r\n      addLine(totalsStartX + labelWidth, currentY, totalsStartX + labelWidth, currentY + 8);\r\n      \r\n      addText(formatCurrency(receiptData.amountPaid, receiptData.currency), totalsStartX + labelWidth + valueWidth - 4, currentY + 5.5, {\r\n        fontSize: 10,\r\n        fontStyle: 'bold',\r\n        align: 'right'\r\n      });\r\n      currentY += 8;\r\n    }\r\n    \r\n    // Amount Due row\r\n    if (receiptData.amountDue !== undefined) {\r\n      addRect(totalsStartX, currentY, totalsWidth, 8, 'S');\r\n      pdf.setFillColor(255, 240, 240); // Light red background\r\n      addRect(totalsStartX, currentY, totalsWidth, 8, 'F');\r\n      \r\n      addText('Amount Due:', totalsStartX + 4, currentY + 5.5, {\r\n        fontSize: 10,\r\n        fontStyle: 'bold'\r\n      });\r\n      \r\n      // Vertical line separating label and value\r\n      addLine(totalsStartX + labelWidth, currentY, totalsStartX + labelWidth, currentY + 8);\r\n      \r\n      addText(formatCurrency(receiptData.amountDue, receiptData.currency), totalsStartX + labelWidth + valueWidth - 4, currentY + 5.5, {\r\n        fontSize: 10,\r\n        fontStyle: 'bold',\r\n        align: 'right'\r\n      });\r\n      currentY += 8;\r\n    }\r\n  }\r\n  \r\n  currentY += 7; // Reduced from 15\r\n\r\n  // Amount in words with slightly increased spacing\r\n  if (receiptData.totalAmountInWords) {\r\n    checkPageBreak(20);\r\n    \r\n    currentY += 2; // Keep existing spacing\r\n    addText('Amount in words:', innerLeft, currentY, {\r\n      fontSize: 10,\r\n      fontStyle: 'bold'\r\n    });\r\n    currentY += 4; // Increased from 3 to 4\r\n    \r\n    // Better text wrapping for amount in words with increased line height\r\n    const amountText = `${receiptData.currency} ${receiptData.totalAmountInWords} only`;\r\n    const wordsHeight = addMultilineText(amountText, innerLeft, currentY, innerWidth * 0.9, {\r\n      fontSize: 10,\r\n      fontStyle: 'italic',\r\n      lineHeight: 1.4 // Increased from 1.2 to 1.4 for better spacing\r\n    });\r\n    currentY += wordsHeight + 4; // Increased from 3 to 4\r\n  }\r\n\r\n  // Improved Payment information table with reduced spacing\r\n  if (receiptData.hasPaymentInfo && receiptData.paymentMethods && receiptData.paymentMethods.length > 0) {\r\n    checkPageBreak(40);\r\n    \r\n    // Strong separator line with reduced spacing\r\n    addLine(innerLeft, currentY, innerLeft + innerWidth, currentY);\r\n    currentY += 5; // Reduced from 8\r\n\r\n    addText('Payment Information:', innerLeft, currentY, {\r\n      fontSize: 11,\r\n      fontStyle: 'bold'\r\n    });\r\n    currentY += 4; // Reduced from 6\r\n\r\n    // Payment table with better proportions\r\n    const paymentHeaders = ['Payment Method', 'Account Number', 'Account Name'];\r\n    const paymentColWidths = [innerWidth * 0.28, innerWidth * 0.36, innerWidth * 0.36];\r\n    \r\n    // Header background with stronger color\r\n    pdf.setFillColor(240, 240, 240);\r\n    const headerHeight = 10;\r\n    addRect(innerLeft, currentY - 2, innerWidth, headerHeight, 'F');\r\n    addRect(innerLeft, currentY - 2, innerWidth, headerHeight, 'S');\r\n    \r\n    // Header text with proper spacing\r\n    let paymentX = innerLeft;\r\n    paymentHeaders.forEach((header, index) => {\r\n      addText(header, paymentX + 4, currentY + 4, {\r\n        fontSize: 9,\r\n        fontStyle: 'bold'\r\n      });\r\n      if (index < paymentHeaders.length - 1) {\r\n        addLine(paymentX + paymentColWidths[index], currentY - 2, paymentX + paymentColWidths[index], currentY + headerHeight - 2);\r\n      }\r\n      paymentX += paymentColWidths[index];\r\n    });\r\n    \r\n    currentY += headerHeight;\r\n    \r\n    // Payment rows with consistent formatting\r\n    const validPayments = receiptData.paymentMethods.filter(payment => \r\n      payment.method.trim() || payment.accountNumber.trim() || payment.accountName.trim()\r\n    );\r\n    \r\n    validPayments.forEach((payment, index) => {\r\n      const rowHeight = 10;\r\n      checkPageBreak(rowHeight + 5);\r\n      \r\n      // Alternating row colors\r\n      if (index % 2 === 1) {\r\n        pdf.setFillColor(248, 248, 248);\r\n        addRect(innerLeft, currentY, innerWidth, rowHeight, 'F');\r\n      }\r\n      \r\n      // Row border\r\n      addRect(innerLeft, currentY, innerWidth, rowHeight, 'S');\r\n      \r\n      paymentX = innerLeft;\r\n      \r\n      // Payment method\r\n      addText(payment.method, paymentX + 4, currentY + 5, {\r\n        fontSize: 9,\r\n        fontStyle: 'bold'\r\n      });\r\n      paymentX += paymentColWidths[0];\r\n      addLine(paymentX, currentY, paymentX, currentY + rowHeight);\r\n      \r\n      // Account number\r\n      addText(payment.accountNumber, paymentX + 4, currentY + 5, {\r\n        fontSize: 9\r\n      });\r\n      paymentX += paymentColWidths[1];\r\n      addLine(paymentX, currentY, paymentX, currentY + rowHeight);\r\n      \r\n      // Account name\r\n      addText(payment.accountName, paymentX + 4, currentY + 5, {\r\n        fontSize: 9\r\n      });\r\n      \r\n      currentY += rowHeight;\r\n    });\r\n    \r\n    currentY += 4; // Reduced from 8\r\n  }\r\n\r\n  // Notes section (if available)\r\n  if (receiptData.notes && receiptData.notes.trim()) {\r\n    checkPageBreak(25);\r\n    \r\n    // Add separator line\r\n    addLine(innerLeft, currentY, innerLeft + innerWidth, currentY);\r\n    currentY += 4;\r\n    \r\n    // Notes title\r\n    addText('Notes:', innerLeft, currentY, {\r\n      fontSize: 11,\r\n      fontStyle: 'bold'\r\n    });\r\n    currentY += 6;\r\n    \r\n    // Notes content with text wrapping\r\n    const maxWidth = innerWidth - 8;\r\n    const lines = pdf.splitTextToSize(receiptData.notes, maxWidth);\r\n    \r\n    lines.forEach((line: string) => {\r\n      checkPageBreak(8);\r\n      addText(line, innerLeft + 4, currentY, {\r\n        fontSize: 10\r\n      });\r\n      currentY += 5;\r\n    });\r\n    \r\n    currentY += 4;\r\n  }\r\n\r\n  // Signature section (if available) with reduced spacing\r\n  if (receiptData.signature) {\r\n    try {\r\n      checkPageBreak(35);\r\n      \r\n      const img = new Image();\r\n      img.crossOrigin = 'anonymous';\r\n      \r\n      await new Promise<void>((resolve) => {\r\n        img.onload = () => {\r\n          try {\r\n            const canvas = document.createElement('canvas');\r\n            const ctx = canvas.getContext('2d');\r\n            if (ctx) {\r\n              canvas.width = img.width;\r\n              canvas.height = img.height;\r\n              ctx.drawImage(img, 0, 0);\r\n              \r\n              const dataURL = canvas.toDataURL('image/png');\r\n              \r\n              // Calculate signature dimensions while maintaining aspect ratio\r\n              const maxSigWidth = 40;\r\n              const maxSigHeight = 20;\r\n              const aspectRatio = img.width / img.height;\r\n              \r\n              let sigWidth, sigHeight;\r\n              \r\n              // Calculate dimensions based on aspect ratio\r\n              if (aspectRatio > (maxSigWidth / maxSigHeight)) {\r\n                // Image is wider, constrain by width\r\n                sigWidth = maxSigWidth;\r\n                sigHeight = maxSigWidth / aspectRatio;\r\n              } else {\r\n                // Image is taller, constrain by height\r\n                sigHeight = maxSigHeight;\r\n                sigWidth = maxSigHeight * aspectRatio;\r\n              }\r\n              \r\n              // Position signature on the right\r\n              const sigX = innerLeft + innerWidth - sigWidth;\r\n              \r\n              addLine(innerLeft, currentY, innerLeft + innerWidth, currentY);\r\n              currentY += 4; // Reduced from 6\r\n              \r\n              pdf.addImage(dataURL, 'PNG', sigX, currentY, sigWidth, sigHeight);\r\n              currentY += sigHeight + 2; // Reduced from 3\r\n              \r\n              addText('Authorized Signature', sigX + sigWidth / 2, currentY, {\r\n                fontSize: 8,\r\n                align: 'center'\r\n              });\r\n              currentY += 4; // Reduced from 6\r\n            }\r\n          } catch (error) {\r\n            console.error('Error adding signature to PDF:', error);\r\n          }\r\n          resolve();\r\n        };\r\n        \r\n        img.onerror = () => {\r\n          console.error('Error loading signature image');\r\n          resolve();\r\n        };\r\n        \r\n        img.src = receiptData.signature;\r\n      });\r\n    } catch (error) {\r\n      console.error('Error processing signature:', error);\r\n    }\r\n  }\r\n\r\n  // Footer message with reduced spacing\r\n  checkPageBreak(25);\r\n  currentY += 6; // Reduced from 8\r\n  addText('Thank you for your business!', pageWidth / 2, currentY, {\r\n    fontSize: 11,\r\n    fontStyle: 'bold',\r\n    align: 'center'\r\n  });\r\n  \r\n  currentY += 5; // Add spacing between messages\r\n  addText('Created by Gonza Systems', pageWidth / 2, currentY, {\r\n    fontSize: 9,\r\n    align: 'center'\r\n  });\r\n\r\n  // Return blob or download\r\n  if (returnBlob) {\r\n    return pdf.output('blob');\r\n  } else if (filename) {\r\n    pdf.save(filename);\r\n  }\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1576, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/utils/deviceDetection.ts"],"sourcesContent":["// Function to detect iOS devices\r\nexport const isIOS = (): boolean => {\r\n  const ua = navigator.userAgent || \"\";\r\n  // If it's Android, it's NOT iOS\r\n  if (/android/i.test(ua)) return false;\r\n\r\n  return /iPad|iPhone|iPod/.test(ua) ||\r\n    (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);\r\n};\r\n\r\n// Function to detect Android devices\r\nexport const isAndroid = (): boolean => {\r\n  const ua = navigator.userAgent || \"\";\r\n  return /android/i.test(ua);\r\n};\r\n"],"names":[],"mappings":"AAAA,iCAAiC;;;;;;;AAC1B,MAAM,QAAQ;IACnB,MAAM,KAAK,UAAU,SAAS,IAAI;IAClC,gCAAgC;IAChC,IAAI,WAAW,IAAI,CAAC,KAAK,OAAO;IAEhC,OAAO,mBAAmB,IAAI,CAAC,OAC5B,UAAU,QAAQ,KAAK,cAAc,UAAU,cAAc,GAAG;AACrE;AAGO,MAAM,YAAY;IACvB,MAAM,KAAK,UAAU,SAAS,IAAI;IAClC,OAAO,WAAW,IAAI,CAAC;AACzB"}},
    {"offset": {"line": 1600, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/utils/generatePDF.ts"],"sourcesContent":["import { generateReceiptVectorPDF } from './generateReceiptVectorPDF';\r\nimport { isIOS } from './deviceDetection';\r\nimport { ReceiptData } from '@/types/receipt';\r\n\r\ninterface PDFOptions {\r\n  autoPrint?: boolean;\r\n  isReceipt?: boolean;\r\n}\r\n\r\n// Legacy function for non-receipt PDFs (keeping image-based approach for now)\r\nconst generateImagePDF = async (element: HTMLElement, filename: string, options: PDFOptions = {}) => {\r\n  const { generateVectorPDF } = await import('./generateVectorPDF');\r\n  await generateVectorPDF(element, {\r\n    filename,\r\n    orientation: 'landscape',\r\n    format: 'a4',\r\n    margins: { top: 10, right: 10, bottom: 10, left: 10 }\r\n  });\r\n};\r\n\r\nexport const generatePDF = async (\r\n  element: HTMLElement, \r\n  filename: string, \r\n  options: PDFOptions = {}\r\n): Promise<void> => {\r\n  const { autoPrint = false, isReceipt = false } = options;\r\n\r\n  try {\r\n    if (isIOS()) {\r\n      // For iOS, use the original approach\r\n      await generateImagePDF(element, filename, options);\r\n    } else {\r\n      // For receipts, we'll need to extract data from the element\r\n      // For now, fall back to image-based approach for non-receipt PDFs\r\n      if (!isReceipt) {\r\n        await generateImagePDF(element, filename, options);\r\n      } else {\r\n        // This will be handled by the PrintableReceipt component\r\n        // which will call generateReceiptVectorPDF directly with structured data\r\n        await generateImagePDF(element, filename, options);\r\n      }\r\n\r\n      if (autoPrint) {\r\n        setTimeout(() => {\r\n          window.print();\r\n        }, 500);\r\n      }\r\n    }\r\n  } catch (error) {\r\n    console.error('Error generating PDF:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n// Export the new vector PDF function for direct use\r\nexport { generateReceiptVectorPDF };\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAQA,8EAA8E;AAC9E,MAAM,mBAAmB,OAAO,SAAsB,UAAkB,UAAsB,CAAC,CAAC;IAC9F,MAAM,EAAE,iBAAiB,EAAE,GAAG;IAC9B,MAAM,kBAAkB,SAAS;QAC/B;QACA,aAAa;QACb,QAAQ;QACR,SAAS;YAAE,KAAK;YAAI,OAAO;YAAI,QAAQ;YAAI,MAAM;QAAG;IACtD;AACF;AAEO,MAAM,cAAc,OACzB,SACA,UACA,UAAsB,CAAC,CAAC;IAExB,MAAM,EAAE,YAAY,KAAK,EAAE,YAAY,KAAK,EAAE,GAAG;IAEjD,IAAI;QACF,IAAI,IAAA,2IAAK,KAAI;YACX,qCAAqC;YACrC,MAAM,iBAAiB,SAAS,UAAU;QAC5C,OAAO;YACL,4DAA4D;YAC5D,kEAAkE;YAClE,IAAI,CAAC,WAAW;gBACd,MAAM,iBAAiB,SAAS,UAAU;YAC5C,OAAO;gBACL,yDAAyD;gBACzD,yEAAyE;gBACzE,MAAM,iBAAiB,SAAS,UAAU;YAC5C;YAEA,IAAI,WAAW;gBACb,WAAW;oBACT,OAAO,KAAK;gBACd,GAAG;YACL;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,MAAM;IACR;AACF"}},
    {"offset": {"line": 1658, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/utils/directPrint.ts"],"sourcesContent":["\r\n/**\r\n * Triggers the device's native print functionality\r\n * Works on iOS, Android, and desktop browsers\r\n */\r\nexport const directPrint = (element: HTMLElement, documentName?: string, isThermal?: boolean): void => {\r\n  // Create a new window for printing\r\n  const printWindow = window.open('', '_blank');\r\n\r\n  if (!printWindow) {\r\n    // Fallback: use current window print if popup is blocked\r\n    window.print();\r\n    return;\r\n  }\r\n\r\n  // Get all stylesheets from the current document\r\n  const stylesheets = Array.from(document.styleSheets);\r\n  let stylesHtml = '';\r\n\r\n  // Include all CSS rules\r\n  stylesheets.forEach(stylesheet => {\r\n    try {\r\n      if (stylesheet.href) {\r\n        // External stylesheet\r\n        stylesHtml += `<link rel=\"stylesheet\" href=\"${stylesheet.href}\">`;\r\n      } else if (stylesheet.cssRules) {\r\n        // Inline stylesheet\r\n        stylesHtml += '<style>';\r\n        Array.from(stylesheet.cssRules).forEach(rule => {\r\n          stylesHtml += rule.cssText;\r\n        });\r\n        stylesHtml += '</style>';\r\n      }\r\n    } catch (e) {\r\n      // Some stylesheets might not be accessible due to CORS\r\n      console.warn('Could not access stylesheet:', e);\r\n    }\r\n  });\r\n\r\n  // Use the provided document name or default to \"Print\"\r\n  const title = documentName || 'Print';\r\n\r\n  // Thermal-specific CSS for single-sheet printing\r\n  const thermalCSS = isThermal ? `\r\n    @page { \r\n      size: 80mm auto; \r\n      margin: 0; \r\n    }\r\n    .thermal-receipt { \r\n      font-size: 14px !important; \r\n      font-weight: 800 !important;\r\n      padding: 8px !important;\r\n      page-break-after: avoid !important;\r\n    }\r\n    .thermal-receipt .font-extrabold { \r\n      font-weight: 900 !important; \r\n    }\r\n    .thermal-receipt .font-bold { \r\n      font-weight: 800 !important; \r\n    }\r\n  ` : '';\r\n\r\n  // Create the print document\r\n  printWindow.document.write(`\r\n    <!DOCTYPE html>\r\n    <html>\r\n      <head>\r\n        <title>${title}</title>\r\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n        ${stylesHtml}\r\n        <style>\r\n          @media print {\r\n            body { margin: 0; }\r\n            .print\\\\:hidden { display: none !important; }\r\n            ${thermalCSS}\r\n          }\r\n          body {\r\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\r\n            margin: ${isThermal ? '0' : '20px'};\r\n          }\r\n        </style>\r\n      </head>\r\n      <body>\r\n        ${element.outerHTML}\r\n      </body>\r\n    </html>\r\n  `);\r\n\r\n  printWindow.document.close();\r\n\r\n  // Track if we've already handled the cleanup\r\n  let cleanupHandled = false;\r\n\r\n  // Cleanup function to avoid duplicate redirects\r\n  const handleCleanup = () => {\r\n    if (cleanupHandled) return;\r\n    cleanupHandled = true;\r\n\r\n    try {\r\n      if (!printWindow.closed) {\r\n        printWindow.close();\r\n      }\r\n    } catch (error) {\r\n      console.warn('Could not close print window:', error);\r\n    }\r\n\r\n    // No redirect needed - user stays on current page after printing\r\n  };\r\n\r\n  // Wait for content to load, then trigger print\r\n  printWindow.onload = () => {\r\n    printWindow.focus();\r\n    printWindow.print();\r\n\r\n    // Listen for when the print dialog is closed\r\n    printWindow.onafterprint = () => {\r\n      handleCleanup();\r\n    };\r\n\r\n    // Listen for beforeunload to detect cancel scenarios\r\n    printWindow.onbeforeunload = () => {\r\n      if (!cleanupHandled) {\r\n        setTimeout(handleCleanup, 100);\r\n      }\r\n    };\r\n\r\n    // Reduced timeout for better UX - close after 1.5 seconds\r\n    setTimeout(() => {\r\n      handleCleanup();\r\n    }, 1500);\r\n  };\r\n\r\n  // Error handling for window load failure\r\n  printWindow.onerror = () => {\r\n    console.warn('Print window failed to load');\r\n    handleCleanup();\r\n  };\r\n};\r\n"],"names":[],"mappings":"AACA;;;CAGC;;;;AACM,MAAM,cAAc,CAAC,SAAsB,cAAuB;IACvE,mCAAmC;IACnC,MAAM,cAAc,OAAO,IAAI,CAAC,IAAI;IAEpC,IAAI,CAAC,aAAa;QAChB,yDAAyD;QACzD,OAAO,KAAK;QACZ;IACF;IAEA,gDAAgD;IAChD,MAAM,cAAc,MAAM,IAAI,CAAC,SAAS,WAAW;IACnD,IAAI,aAAa;IAEjB,wBAAwB;IACxB,YAAY,OAAO,CAAC,CAAA;QAClB,IAAI;YACF,IAAI,WAAW,IAAI,EAAE;gBACnB,sBAAsB;gBACtB,cAAc,CAAC,6BAA6B,EAAE,WAAW,IAAI,CAAC,EAAE,CAAC;YACnE,OAAO,IAAI,WAAW,QAAQ,EAAE;gBAC9B,oBAAoB;gBACpB,cAAc;gBACd,MAAM,IAAI,CAAC,WAAW,QAAQ,EAAE,OAAO,CAAC,CAAA;oBACtC,cAAc,KAAK,OAAO;gBAC5B;gBACA,cAAc;YAChB;QACF,EAAE,OAAO,GAAG;YACV,uDAAuD;YACvD,QAAQ,IAAI,CAAC,gCAAgC;QAC/C;IACF;IAEA,uDAAuD;IACvD,MAAM,QAAQ,gBAAgB;IAE9B,iDAAiD;IACjD,MAAM,aAAa,YAAY,CAAC;;;;;;;;;;;;;;;;;EAiBhC,CAAC,GAAG;IAEJ,4BAA4B;IAC5B,YAAY,QAAQ,CAAC,KAAK,CAAC,CAAC;;;;eAIf,EAAE,MAAM;;QAEf,EAAE,WAAW;;;;;YAKT,EAAE,WAAW;;;;oBAIL,EAAE,YAAY,MAAM,OAAO;;;;;QAKvC,EAAE,QAAQ,SAAS,CAAC;;;EAG1B,CAAC;IAED,YAAY,QAAQ,CAAC,KAAK;IAE1B,6CAA6C;IAC7C,IAAI,iBAAiB;IAErB,gDAAgD;IAChD,MAAM,gBAAgB;QACpB,IAAI,gBAAgB;QACpB,iBAAiB;QAEjB,IAAI;YACF,IAAI,CAAC,YAAY,MAAM,EAAE;gBACvB,YAAY,KAAK;YACnB;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,IAAI,CAAC,iCAAiC;QAChD;IAEA,iEAAiE;IACnE;IAEA,+CAA+C;IAC/C,YAAY,MAAM,GAAG;QACnB,YAAY,KAAK;QACjB,YAAY,KAAK;QAEjB,6CAA6C;QAC7C,YAAY,YAAY,GAAG;YACzB;QACF;QAEA,qDAAqD;QACrD,YAAY,cAAc,GAAG;YAC3B,IAAI,CAAC,gBAAgB;gBACnB,WAAW,eAAe;YAC5B;QACF;QAEA,0DAA0D;QAC1D,WAAW;YACT;QACF,GAAG;IACL;IAEA,yCAAyC;IACzC,YAAY,OAAO,GAAG;QACpB,QAAQ,IAAI,CAAC;QACb;IACF;AACF"}},
    {"offset": {"line": 1789, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/utils/numberToWords.ts"],"sourcesContent":["\r\n/**\r\n * Converts a number to words representation\r\n * @param num The number to convert to words\r\n * @returns The number expressed in words\r\n */\r\nexport function numberToWords(num: number): string {\r\n  const specialNames = ['', 'thousand', 'million', 'billion', 'trillion', 'quadrillion'];\r\n  const tensNames = ['', 'ten', 'twenty', 'thirty', 'forty', 'fifty', 'sixty', 'seventy', 'eighty', 'ninety'];\r\n  const onesNames = ['', 'one', 'two', 'three', 'four', 'five', 'six', 'seven', 'eight', 'nine', 'ten', \r\n    'eleven', 'twelve', 'thirteen', 'fourteen', 'fifteen', 'sixteen', 'seventeen', 'eighteen', 'nineteen'];\r\n\r\n  // Handles decimals by splitting the number into whole and decimal parts\r\n  const handleDecimals = (n: number): string => {\r\n    const numStr = n.toFixed(2);\r\n    const parts = numStr.split('.');\r\n    const wholeStr = convertNumberToWords(parseInt(parts[0]));\r\n    \r\n    // If there are meaningful decimals (not just .00)\r\n    if (parts.length > 1 && parseInt(parts[1]) > 0) {\r\n      // Format the decimal part as cents\r\n      return `${wholeStr} and ${parts[1]}/100`;\r\n    }\r\n    return wholeStr;\r\n  };\r\n\r\n  // Core conversion function for whole numbers\r\n  const convertNumberToWords = (n: number): string => {\r\n    // Handle zero\r\n    if (n === 0) return 'zero';\r\n    \r\n    // Handle negative numbers\r\n    if (n < 0) return `negative ${convertNumberToWords(Math.abs(n))}`;\r\n    \r\n    let result = '';\r\n    let numIndex = 0;\r\n    \r\n    // Process the number in chunks of three digits\r\n    while (n > 0) {\r\n      if (n % 1000 !== 0) {\r\n        result = `${convertLessThanOneThousand(n % 1000)} ${specialNames[numIndex]} ${result}`;\r\n      }\r\n      n = Math.floor(n / 1000);\r\n      numIndex++;\r\n    }\r\n    \r\n    return result.trim();\r\n  };\r\n\r\n  // Converts a number less than 1000 to words\r\n  const convertLessThanOneThousand = (n: number): string => {\r\n    if (n === 0) return '';\r\n    \r\n    let result = '';\r\n    \r\n    // Handle hundreds\r\n    if (n >= 100) {\r\n      result = `${onesNames[Math.floor(n / 100)]} hundred `;\r\n      n %= 100;\r\n      if (n === 0) return result.trim();\r\n    }\r\n    \r\n    // Handle tens and ones places\r\n    if (n < 20) {\r\n      // For numbers less than 20, use the direct name\r\n      result += onesNames[n];\r\n    } else {\r\n      // For numbers 20 and above, combine tens and ones names\r\n      result += `${tensNames[Math.floor(n / 10)]}`;\r\n      if (n % 10 > 0) {\r\n        result += `-${onesNames[n % 10]}`;\r\n      }\r\n    }\r\n    \r\n    return result.trim();\r\n  };\r\n\r\n  // Start the conversion process\r\n  return handleDecimals(num).trim().charAt(0).toUpperCase() + handleDecimals(num).trim().slice(1);\r\n}\r\n"],"names":[],"mappings":"AACA;;;;CAIC;;;;AACM,SAAS,cAAc,GAAW;IACvC,MAAM,eAAe;QAAC;QAAI;QAAY;QAAW;QAAW;QAAY;KAAc;IACtF,MAAM,YAAY;QAAC;QAAI;QAAO;QAAU;QAAU;QAAS;QAAS;QAAS;QAAW;QAAU;KAAS;IAC3G,MAAM,YAAY;QAAC;QAAI;QAAO;QAAO;QAAS;QAAQ;QAAQ;QAAO;QAAS;QAAS;QAAQ;QAC7F;QAAU;QAAU;QAAY;QAAY;QAAW;QAAW;QAAa;QAAY;KAAW;IAExG,wEAAwE;IACxE,MAAM,iBAAiB,CAAC;QACtB,MAAM,SAAS,EAAE,OAAO,CAAC;QACzB,MAAM,QAAQ,OAAO,KAAK,CAAC;QAC3B,MAAM,WAAW,qBAAqB,SAAS,KAAK,CAAC,EAAE;QAEvD,kDAAkD;QAClD,IAAI,MAAM,MAAM,GAAG,KAAK,SAAS,KAAK,CAAC,EAAE,IAAI,GAAG;YAC9C,mCAAmC;YACnC,OAAO,GAAG,SAAS,KAAK,EAAE,KAAK,CAAC,EAAE,CAAC,IAAI,CAAC;QAC1C;QACA,OAAO;IACT;IAEA,6CAA6C;IAC7C,MAAM,uBAAuB,CAAC;QAC5B,cAAc;QACd,IAAI,MAAM,GAAG,OAAO;QAEpB,0BAA0B;QAC1B,IAAI,IAAI,GAAG,OAAO,CAAC,SAAS,EAAE,qBAAqB,KAAK,GAAG,CAAC,KAAK;QAEjE,IAAI,SAAS;QACb,IAAI,WAAW;QAEf,+CAA+C;QAC/C,MAAO,IAAI,EAAG;YACZ,IAAI,IAAI,SAAS,GAAG;gBAClB,SAAS,GAAG,2BAA2B,IAAI,MAAM,CAAC,EAAE,YAAY,CAAC,SAAS,CAAC,CAAC,EAAE,QAAQ;YACxF;YACA,IAAI,KAAK,KAAK,CAAC,IAAI;YACnB;QACF;QAEA,OAAO,OAAO,IAAI;IACpB;IAEA,4CAA4C;IAC5C,MAAM,6BAA6B,CAAC;QAClC,IAAI,MAAM,GAAG,OAAO;QAEpB,IAAI,SAAS;QAEb,kBAAkB;QAClB,IAAI,KAAK,KAAK;YACZ,SAAS,GAAG,SAAS,CAAC,KAAK,KAAK,CAAC,IAAI,KAAK,CAAC,SAAS,CAAC;YACrD,KAAK;YACL,IAAI,MAAM,GAAG,OAAO,OAAO,IAAI;QACjC;QAEA,8BAA8B;QAC9B,IAAI,IAAI,IAAI;YACV,gDAAgD;YAChD,UAAU,SAAS,CAAC,EAAE;QACxB,OAAO;YACL,wDAAwD;YACxD,UAAU,GAAG,SAAS,CAAC,KAAK,KAAK,CAAC,IAAI,IAAI,EAAE;YAC5C,IAAI,IAAI,KAAK,GAAG;gBACd,UAAU,CAAC,CAAC,EAAE,SAAS,CAAC,IAAI,GAAG,EAAE;YACnC;QACF;QAEA,OAAO,OAAO,IAAI;IACpB;IAEA,+BAA+B;IAC/B,OAAO,eAAe,KAAK,IAAI,GAAG,MAAM,CAAC,GAAG,WAAW,KAAK,eAAe,KAAK,IAAI,GAAG,KAAK,CAAC;AAC/F"}},
    {"offset": {"line": 1903, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/utils/thermalPrinterPlug.ts"],"sourcesContent":["import { Capacitor } from '@capacitor/core';\r\n\r\nexport async function checkBridgeStatus() {\r\n  const addresses = ['http://localhost:5000', 'http://127.0.0.1:5000'];\r\n\r\n  for (const addr of addresses) {\r\n    try {\r\n      const response = await fetch(`${addr}/printers`, {\r\n        signal: AbortSignal.timeout(2000),\r\n        mode: 'cors'\r\n      });\r\n      if (response.ok) {\r\n        return true;\r\n      }\r\n    } catch (error) {\r\n      // Continue to next address\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\nexport async function print(data: string | Uint8Array, printerNameOverride?: string) {\r\n  const platform = Capacitor.getPlatform();\r\n\r\n  if (platform === 'web') {\r\n    // Prefer Printer Bridge if on web\r\n    try {\r\n      const isBinary = data instanceof Uint8Array;\r\n      const endpoint = 'http://localhost:5000/print/receipt';\r\n\r\n      // Use provided printer name, or try to get it from localStorage (fallback to Receipt Printer)\r\n      let printerName = printerNameOverride;\r\n      if (!printerName) {\r\n        try {\r\n          const settings = JSON.parse(localStorage.getItem('business-settings') || '{}');\r\n          printerName = settings.defaultPrinterName;\r\n        } catch (e) {\r\n          // Ignore parse errors\r\n        }\r\n      }\r\n\r\n      if (!printerName) printerName = 'Receipt Printer';\r\n\r\n      const body = {\r\n        PrinterName: printerName,\r\n        Content: isBinary ? String.fromCharCode(...(data as Uint8Array)) : data\r\n      };\r\n\r\n      const response = await fetch(endpoint, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        mode: 'cors',\r\n        body: JSON.stringify(body)\r\n      });\r\n\r\n      if (response.ok) {\r\n        return { success: true, message: 'Print command sent to bridge.' };\r\n      }\r\n    } catch (err) {\r\n      console.warn('Printer Bridge not available, falling back to Web Serial', err);\r\n    }\r\n\r\n    // Fallback to Web Serial for standard text data\r\n    if (typeof data === 'string') {\r\n      const { printWeb } = await import('./thermalPrinterWeb');\r\n      return await printWeb(data);\r\n    } else {\r\n      return { success: false, message: 'Printer Bridge required for binary ESC/POS printing.' };\r\n    }\r\n  } else {\r\n    // Native platforms use Bluetooth\r\n    const { printBluetooth } = await import('./thermalPrinterNative');\r\n    // Native print might only support strings for now, convert if needed\r\n    const stringData = typeof data === 'string' ? data : new TextDecoder().decode(data);\r\n    return await printBluetooth(stringData);\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAEO,eAAe;IACpB,MAAM,YAAY;QAAC;QAAyB;KAAwB;IAEpE,KAAK,MAAM,QAAQ,UAAW;QAC5B,IAAI;YACF,MAAM,WAAW,MAAM,MAAM,GAAG,KAAK,SAAS,CAAC,EAAE;gBAC/C,QAAQ,YAAY,OAAO,CAAC;gBAC5B,MAAM;YACR;YACA,IAAI,SAAS,EAAE,EAAE;gBACf,OAAO;YACT;QACF,EAAE,OAAO,OAAO;QACd,2BAA2B;QAC7B;IACF;IACA,OAAO;AACT;AAEO,eAAe,MAAM,IAAyB,EAAE,mBAA4B;IACjF,MAAM,WAAW,oKAAS,CAAC,WAAW;IAEtC,IAAI,aAAa,OAAO;QACtB,kCAAkC;QAClC,IAAI;YACF,MAAM,WAAW,gBAAgB;YACjC,MAAM,WAAW;YAEjB,8FAA8F;YAC9F,IAAI,cAAc;YAClB,IAAI,CAAC,aAAa;gBAChB,IAAI;oBACF,MAAM,WAAW,KAAK,KAAK,CAAC,aAAa,OAAO,CAAC,wBAAwB;oBACzE,cAAc,SAAS,kBAAkB;gBAC3C,EAAE,OAAO,GAAG;gBACV,sBAAsB;gBACxB;YACF;YAEA,IAAI,CAAC,aAAa,cAAc;YAEhC,MAAM,OAAO;gBACX,aAAa;gBACb,SAAS,WAAW,OAAO,YAAY,IAAK,QAAuB;YACrE;YAEA,MAAM,WAAW,MAAM,MAAM,UAAU;gBACrC,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9C,MAAM;gBACN,MAAM,KAAK,SAAS,CAAC;YACvB;YAEA,IAAI,SAAS,EAAE,EAAE;gBACf,OAAO;oBAAE,SAAS;oBAAM,SAAS;gBAAgC;YACnE;QACF,EAAE,OAAO,KAAK;YACZ,QAAQ,IAAI,CAAC,4DAA4D;QAC3E;QAEA,gDAAgD;QAChD,IAAI,OAAO,SAAS,UAAU;YAC5B,MAAM,EAAE,QAAQ,EAAE,GAAG;YACrB,OAAO,MAAM,SAAS;QACxB,OAAO;YACL,OAAO;gBAAE,SAAS;gBAAO,SAAS;YAAuD;QAC3F;IACF,OAAO;QACL,iCAAiC;QACjC,MAAM,EAAE,cAAc,EAAE,GAAG;QAC3B,qEAAqE;QACrE,MAAM,aAAa,OAAO,SAAS,WAAW,OAAO,IAAI,cAAc,MAAM,CAAC;QAC9E,OAAO,MAAM,eAAe;IAC9B;AACF"}},
    {"offset": {"line": 1995, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/utils/generateThermalReceipt.ts"],"sourcesContent":["import EscPosEncoder from 'esc-pos-encoder';\r\nimport { format } from \"date-fns\";\r\nimport { formatNumber } from \"@/lib/utils\";\r\nimport { numberToWords } from \"@/utils/numberToWords\";\r\nimport { parsePaymentInfo } from \"@/hooks/useBusinessSettings\";\r\n\r\n\r\n\r\n\r\nexport async function generateThermalReceipt(sale: any, settings: any, currency?: string): Promise<Uint8Array> {\r\n    const displayCurrency = currency || settings.currency || '';\r\n    const encoder = new EscPosEncoder();\r\n\r\n    encoder.initialize();\r\n\r\n    const is80mm = settings.printerPaperSize === '80mm';\r\n\r\n    if (is80mm) {\r\n        encoder.raw([0x1d, 0x57, 0x40, 0x02]); // GS W: Set width to 576 dots (80mm)\r\n        encoder.align('left'); // User requested \"far left\" for everything\r\n    } else {\r\n        encoder.raw([0x1d, 0x4c, 0, 0]); // GS L: Reset left margin to 0\r\n        encoder.raw([0x1d, 0x57, 0x80, 0x01]); // GS W: Set printable area width (384 dots = 58mm)\r\n        encoder.align('left');\r\n    }\r\n\r\n\r\n    // ===== Business Header =====\r\n    encoder.align('left');\r\n\r\n    encoder.line(is80mm ? '='.repeat(42) : '='.repeat(32));\r\n\r\n    if (settings.businessName) {\r\n        encoder.size('double').bold(true).line(settings.businessName.toUpperCase()).bold(false).size('normal');\r\n    }\r\n    encoder.line(is80mm ? '='.repeat(42) : '='.repeat(32));\r\n\r\n    if (settings.businessAddress) encoder.line(settings.businessAddress);\r\n    if (settings.businessPhone) encoder.line(`Tel: ${settings.businessPhone}`);\r\n    if (settings.businessEmail) encoder.line(settings.businessEmail);\r\n    encoder.line(is80mm ? '-'.repeat(42) : '-'.repeat(32)); // Wider line for 80mm\r\n\r\n    // ===== Document Title =====\r\n    const titleMap: Record<string, string> = {\r\n        \"Quote\": \"QUOTATION\",\r\n        \"Paid\": \"SALES RECEIPT\",\r\n        \"Installment Sale\": \"INSTALLMENT SALE\",\r\n        \"NOT PAID\": \"INVOICE\",\r\n    };\r\n    const docTitle = titleMap[sale.paymentStatus] || \"INVOICE\";\r\n    encoder.bold(true).line(docTitle).bold(false);\r\n\r\n    encoder.line(is80mm ? '-'.repeat(42) : '-'.repeat(32));\r\n\r\n    // ===== Receipt Info (Apply 10mm margin) =====\r\n    encoder.raw([0x1d, 0x4c, 0, 0]);\r\n    encoder.align('left');\r\n\r\n\r\n    encoder.table(\r\n        [\r\n            { width: 12, align: 'left' },\r\n            { width: 16, align: 'right' }\r\n        ],\r\n        [\r\n            ['Receipt #:', sale.receiptNumber || ''],\r\n            ['Date:', format(new Date(sale.date || Date.now()), \"MMM dd, yyyy\")],\r\n            ['Status:', sale.paymentStatus || '']\r\n        ]\r\n    );\r\n    encoder.line(is80mm ? '-'.repeat(42) : '-'.repeat(32));\r\n\r\n    // ===== Customer Info =====\r\n    if (sale.customerName) {\r\n        encoder.line(`Customer: ${sale.customerName}`);\r\n        if (sale.customerAddress) encoder.line(`Address: ${sale.customerAddress}`);\r\n        if (sale.customerContact) encoder.line(`Contact: ${sale.customerContact}`);\r\n        encoder.line(is80mm ? '-'.repeat(42) : '-'.repeat(32));\r\n    }\r\n\r\n    // ===== Items Table Definition =====\r\n    // 58mm (32 chars): Item(14) + Spacer(3) + Qty(5) + Tot(10) = 32\r\n    // 80mm (42 chars): Item(22) + Spacer(4) + Qty(6) + Tot(10) = 42\r\n    // 58mm (32 chars): Item(12) + Spacer(1) + Qty(5) + Tot(14) = 32\r\n    // 80mm (42 chars): Item(21) + Spacer(1) + Qty(6) + Tot(14) = 42\r\n    const tableColumns = is80mm\r\n        ? [\r\n            { width: 21, align: 'left' },\r\n            { width: 1, align: 'center' },\r\n            { width: 6, align: 'right' },\r\n            { width: 14, align: 'right' }\r\n        ]\r\n        : [\r\n            { width: 12, align: 'left' },\r\n            { width: 1, align: 'center' },\r\n            { width: 5, align: 'right' },\r\n            { width: 14, align: 'right' }\r\n        ];\r\n\r\n    encoder.table(\r\n        tableColumns,\r\n        [\r\n            ['Item', '', 'Qty', `Total`]\r\n        ]\r\n    );\r\n    encoder.line(is80mm ? '-'.repeat(42) : '-'.repeat(32));\r\n\r\n    let subtotalBeforeDiscount = 0;\r\n    let totalDiscountAmount = 0;\r\n\r\n    Array.isArray(sale.items) && sale.items.forEach((item: any) => {\r\n        const quantity = item.quantity || 0;\r\n        const price = item.price || 0;\r\n        const subtotal = quantity * price;\r\n        const discount = item.discountAmount ?? ((subtotal * (item.discountPercentage || 0)) / 100);\r\n        const total = subtotal - discount;\r\n\r\n        subtotalBeforeDiscount += subtotal;\r\n        totalDiscountAmount += discount;\r\n\r\n        encoder.table(\r\n            tableColumns,\r\n            [\r\n                [item.description || '', '', String(quantity), formatNumber(total)]\r\n            ]\r\n        );\r\n\r\n        if (discount > 0) {\r\n            const discText = item.discountType === \"amount\" ? \"\" : `(${item.discountPercentage || 0}%)`;\r\n            encoder.italic(true).table(\r\n                [\r\n                    { width: 22, align: 'left' },\r\n                    { width: 10, align: 'right' }\r\n                ],\r\n                [\r\n                    [`  Discount ${discText}`, `-${formatNumber(discount)}`]\r\n                ]\r\n            ).italic(false);\r\n        }\r\n\r\n        encoder.line(is80mm ? '-'.repeat(42) : '-'.repeat(32));\r\n    });\r\n\r\n    // ===== Totals (Vertical Layout as requested) =====\r\n    const subtotalAfterDiscount = subtotalBeforeDiscount - totalDiscountAmount;\r\n    const taxRate = sale.taxRate || 0;\r\n    const taxAmount = subtotalAfterDiscount * (taxRate / 100);\r\n    const totalAmount = subtotalAfterDiscount + taxAmount;\r\n\r\n    // For installment sales, sum up all payments from history if available\r\n    const totalPaidFromHistory = Array.isArray(sale.payments)\r\n        ? sale.payments.reduce((sum: number, p: any) => sum + (Number(p.amount) || 0), 0)\r\n        : 0;\r\n\r\n    const amountPaid = (sale.paymentStatus === 'Installment Sale' && totalPaidFromHistory > 0)\r\n        ? totalPaidFromHistory\r\n        : (Number(sale.amountPaid) || 0);\r\n\r\n    const amountDue = sale.paymentStatus === 'Installment Sale'\r\n        ? Math.max(0, totalAmount - totalPaidFromHistory)\r\n        : Math.max(0, totalAmount - amountPaid);\r\n\r\n    encoder.newline();\r\n\r\n    const totalsColumns = [\r\n        { width: 14, align: 'left' },\r\n        { width: is80mm ? 28 : 18, align: 'right' }\r\n    ];\r\n\r\n    encoder.table(totalsColumns, [\r\n        [\"Subtotal:\", `${displayCurrency} ${formatNumber(subtotalBeforeDiscount)}`]\r\n    ]);\r\n\r\n    if (totalDiscountAmount > 0) {\r\n        encoder.table(totalsColumns, [\r\n            [\"Total Discount:\", `-${displayCurrency} ${formatNumber(totalDiscountAmount)}`]\r\n        ]);\r\n    }\r\n\r\n    if (taxRate > 0) {\r\n        encoder.table(totalsColumns, [\r\n            [`Tax (${taxRate}%):`, `${displayCurrency} ${formatNumber(taxAmount)}`]\r\n        ]);\r\n    }\r\n\r\n    encoder.bold(true).table(totalsColumns, [\r\n        [\"TOTAL:\", `${displayCurrency} ${formatNumber(totalAmount)}`]\r\n    ]).bold(false);\r\n\r\n    if (sale.paymentStatus === \"Installment Sale\") {\r\n        encoder.table(totalsColumns, [\r\n            [\"Amount Paid:\", `${displayCurrency} ${formatNumber(amountPaid)}`],\r\n            [\"Amount Due:\", `${displayCurrency} ${formatNumber(amountDue)}`]\r\n        ]);\r\n    }\r\n\r\n    encoder.line(is80mm ? '-'.repeat(42) : '-'.repeat(32));\r\n    encoder.text(`Amount in words:\\n${numberToWords(totalAmount)} only\\n`);\r\n    encoder.line(is80mm ? '-'.repeat(42) : '-'.repeat(32));\r\n\r\n    // Reset margin for the rest of the receipt (Payment Info, Signature, Footer)\r\n    encoder.raw([0x1d, 0x4c, 0, 0]);\r\n    encoder.align('left');\r\n\r\n\r\n\r\n    // ===== Payment Info =====\r\n    const paymentMethods = settings.paymentInfo ? parsePaymentInfo(settings.paymentInfo) : [];\r\n    if (Array.isArray(paymentMethods) && paymentMethods.length > 0) {\r\n        paymentMethods.forEach((p: any) => {\r\n            if (p.method || p.accountNumber || p.accountName) {\r\n                encoder.bold(true).line(p.method || '').bold(false);\r\n                if (p.accountNumber) encoder.line(`Acc: ${p.accountNumber}`);\r\n                if (p.accountName) encoder.line(`Name: ${p.accountName}`);\r\n                encoder.line(is80mm ? '-'.repeat(42) : '-'.repeat(32));\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n    // ===== Footer =====\r\n    encoder.line(\"Thank you for your business!\");\r\n    encoder.size('small').line(\"Created by Gonza Systems\").size('normal');\r\n    encoder.line(is80mm ? '='.repeat(42) : '='.repeat(32));\r\n\r\n    // Cut paper\r\n    encoder.newline().newline().newline().cut();\r\n\r\n    return encoder.encode();\r\n}\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2282, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/utils/exportStockSummaryToPDF.ts"],"sourcesContent":["import jsPDF from 'jspdf';\r\nimport { format } from 'date-fns';\r\n\r\ninterface StockSummaryData {\r\n  productId: string;\r\n  productName: string;\r\n  itemNumber: string;\r\n  openingStock: number;\r\n  itemsSold: number;\r\n  stockIn: number;\r\n  transferOut: number;\r\n  returnIn: number;\r\n  returnOut: number;\r\n  closingStock: number;\r\n}\r\n\r\nexport const exportStockSummaryToPDF = (\r\n  data: StockSummaryData[],\r\n  period: string,\r\n  dateRange?: { from: Date | undefined; to: Date | undefined }\r\n) => {\r\n  // Create new PDF document in landscape orientation\r\n  const pdf = new jsPDF({\r\n    orientation: 'landscape',\r\n    unit: 'mm',\r\n    format: 'a4',\r\n    compress: true\r\n  });\r\n\r\n  const pageWidth = pdf.internal.pageSize.getWidth();\r\n  const pageHeight = pdf.internal.pageSize.getHeight();\r\n  const margins = { top: 15, right: 15, bottom: 15, left: 15 };\r\n  const contentWidth = pageWidth - margins.left - margins.right;\r\n  \r\n  let currentY = margins.top;\r\n\r\n  // Function to add watermark to current page\r\n  const addWatermark = () => {\r\n    pdf.setFontSize(8);\r\n    pdf.setFont('helvetica', 'normal');\r\n    pdf.setTextColor(150, 150, 150); // Light gray color\r\n    pdf.text('Created By Gonza Systems', pageWidth / 2, pageHeight - 10, { align: 'center' });\r\n    pdf.setTextColor(0, 0, 0); // Reset to black\r\n  };\r\n\r\n  // Table setup - optimized for landscape orientation\r\n  const colWidths = [20, 50, 30, 25, 25, 25, 25, 25, 25]; // Item #, Product, Opening, Sold, Stock In, Transfer Out, Return In, Return Out, Closing\r\n  const rowHeight = 7;\r\n  const headerHeight = 8;\r\n\r\n  // Table headers\r\n  const headers = [\r\n    'Item #',\r\n    'Product Name',\r\n    'Opening Stock',\r\n    'Items Sold',\r\n    'Stock In',\r\n    'Transfer Out',\r\n    'Return In',\r\n    'Return Out',\r\n    'Closing Stock'\r\n  ];\r\n\r\n  // Function to draw table headers\r\n  const drawTableHeaders = () => {\r\n    // Draw header background\r\n    pdf.setFillColor(243, 244, 246);\r\n    pdf.rect(margins.left, currentY - 2, contentWidth, headerHeight, 'F');\r\n\r\n    // Draw header borders\r\n    pdf.setLineWidth(0.2);\r\n    pdf.rect(margins.left, currentY - 2, contentWidth, headerHeight);\r\n\r\n    // Header text\r\n    pdf.setFontSize(9);\r\n    pdf.setFont('helvetica', 'bold');\r\n    let currentX = margins.left;\r\n    \r\n    headers.forEach((header, index) => {\r\n      const colWidth = colWidths[index];\r\n      const textWidth = pdf.getTextWidth(header);\r\n      const textX = currentX + (colWidth - textWidth) / 2;\r\n      pdf.text(header, textX, currentY + 5);\r\n      \r\n      if (index < headers.length - 1) {\r\n        pdf.line(currentX + colWidth, currentY - 2, currentX + colWidth, currentY + headerHeight - 2);\r\n      }\r\n      \r\n      currentX += colWidth;\r\n    });\r\n\r\n    currentY += headerHeight;\r\n  };\r\n\r\n  // Helper function to check if we need a new page\r\n  const checkPageBreak = (neededHeight: number) => {\r\n    if (currentY + neededHeight > pageHeight - margins.bottom - 15) { // Reserve space for watermark\r\n      addWatermark(); // Add watermark to current page before creating new one\r\n      pdf.addPage();\r\n      currentY = margins.top;\r\n      drawTableHeaders();\r\n      pdf.setFont('helvetica', 'normal');\r\n      pdf.setFontSize(8);\r\n      return true;\r\n    }\r\n    return false;\r\n  };\r\n\r\n  // Title\r\n  pdf.setFontSize(18);\r\n  pdf.setFont('helvetica', 'bold');\r\n  const title = `Stock Summary Report`;\r\n  const titleWidth = pdf.getTextWidth(title);\r\n  pdf.text(title, (pageWidth - titleWidth) / 2, currentY);\r\n  currentY += 8;\r\n\r\n  // Date range display - always show exact dates in DD/MM/YYYY format\r\n  if (dateRange?.from && dateRange?.to) {\r\n    pdf.setFontSize(12);\r\n    pdf.setFont('helvetica', 'normal');\r\n    const fromDate = format(dateRange.from, 'dd/MM/yyyy');\r\n    const toDate = format(dateRange.to, 'dd/MM/yyyy');\r\n    \r\n    const dateText = fromDate === toDate ? fromDate : `${fromDate} - ${toDate}`;\r\n    const dateWidth = pdf.getTextWidth(dateText);\r\n    pdf.text(dateText, (pageWidth - dateWidth) / 2, currentY);\r\n    currentY += 12;\r\n  } else {\r\n    // Fallback to current date if no range provided\r\n    pdf.setFontSize(12);\r\n    pdf.setFont('helvetica', 'normal');\r\n    const dateText = format(new Date(), 'dd/MM/yyyy');\r\n    const dateWidth = pdf.getTextWidth(dateText);\r\n    pdf.text(dateText, (pageWidth - dateWidth) / 2, currentY);\r\n    currentY += 12;\r\n  }\r\n\r\n  if (data.length === 0) {\r\n    // No data message\r\n    pdf.setFontSize(14);\r\n    pdf.setFont('helvetica', 'normal');\r\n    const noDataText = 'No stock data available for the selected period.';\r\n    const noDataWidth = pdf.getTextWidth(noDataText);\r\n    pdf.text(noDataText, (pageWidth - noDataWidth) / 2, currentY + 30);\r\n  } else {\r\n    // Draw initial table headers\r\n    checkPageBreak(headerHeight + 10);\r\n    drawTableHeaders();\r\n\r\n    // Table data\r\n    pdf.setFont('helvetica', 'normal');\r\n    pdf.setFontSize(8);\r\n\r\n    data.forEach((item, index) => {\r\n      checkPageBreak(rowHeight + 5);\r\n\r\n      const rowData = [\r\n        item.itemNumber,\r\n        item.productName,\r\n        item.openingStock.toString(),\r\n        item.itemsSold.toString(),\r\n        item.stockIn.toString(),\r\n        item.transferOut.toString(),\r\n        item.returnIn.toString(),\r\n        item.returnOut.toString(),\r\n        item.closingStock.toString()\r\n      ];\r\n\r\n      // Draw row background (alternating)\r\n      if (index % 2 === 0) {\r\n        pdf.setFillColor(249, 250, 251);\r\n        pdf.rect(margins.left, currentY - 1, contentWidth, rowHeight, 'F');\r\n      }\r\n\r\n      pdf.setLineWidth(0.1);\r\n      pdf.rect(margins.left, currentY - 1, contentWidth, rowHeight);\r\n\r\n      let currentX = margins.left;\r\n      \r\n      rowData.forEach((data, colIndex) => {\r\n        const colWidth = colWidths[colIndex];\r\n        let text = data;\r\n        \r\n        // Truncate text if too long\r\n        if (colIndex === 1) { // Product name\r\n          while (pdf.getTextWidth(text) > colWidth - 2 && text.length > 3) {\r\n            text = text.substring(0, text.length - 4) + '...';\r\n          }\r\n        }\r\n        \r\n        let textX = currentX + 1;\r\n        if (colIndex >= 2) { // Numeric columns\r\n          const textWidth = pdf.getTextWidth(text);\r\n          textX = currentX + colWidth - textWidth - 1;\r\n        } else if (colIndex === 0) { // Item number - center align\r\n          const textWidth = pdf.getTextWidth(text);\r\n          textX = currentX + (colWidth - textWidth) / 2;\r\n        }\r\n        \r\n        pdf.text(text, textX, currentY + 4);\r\n        \r\n        if (colIndex < rowData.length - 1) {\r\n          pdf.line(currentX + colWidth, currentY - 1, currentX + colWidth, currentY + rowHeight - 1);\r\n        }\r\n        \r\n        currentX += colWidth;\r\n      });\r\n\r\n      currentY += rowHeight;\r\n    });\r\n\r\n    // Summary section - Add more space before summary\r\n    currentY += 15;\r\n    checkPageBreak(35);\r\n\r\n    // Summary title\r\n    pdf.setFontSize(16);\r\n    pdf.setFont('helvetica', 'bold');\r\n    pdf.text('Summary', margins.left, currentY);\r\n    currentY += 8;\r\n\r\n    // Calculate totals\r\n    const totalProducts = data.length;\r\n    const totalOpeningStock = data.reduce((sum, item) => sum + item.openingStock, 0);\r\n    const totalItemsSold = data.reduce((sum, item) => sum + item.itemsSold, 0);\r\n    const totalStockIn = data.reduce((sum, item) => sum + item.stockIn, 0);\r\n    const totalClosingStock = data.reduce((sum, item) => sum + item.closingStock, 0);\r\n\r\n    // Draw summary box\r\n    const summaryBoxHeight = 30;\r\n    const summaryBoxWidth = contentWidth * 0.8;\r\n    \r\n    pdf.setFillColor(248, 249, 250);\r\n    pdf.rect(margins.left, currentY - 3, summaryBoxWidth, summaryBoxHeight, 'F');\r\n    pdf.setLineWidth(0.3);\r\n    pdf.setDrawColor(200, 200, 200);\r\n    pdf.rect(margins.left, currentY - 3, summaryBoxWidth, summaryBoxHeight);\r\n\r\n    // Summary data in two columns\r\n    pdf.setFontSize(11);\r\n    pdf.setFont('helvetica', 'normal');\r\n    \r\n    const leftColumn = [\r\n      ['Total Products:', totalProducts.toString()],\r\n      ['Total Opening Stock:', totalOpeningStock.toString()],\r\n      ['Total Items Sold:', totalItemsSold.toString()]\r\n    ];\r\n\r\n    const rightColumn = [\r\n      ['Total Stock In:', totalStockIn.toString()],\r\n      ['Total Closing Stock:', totalClosingStock.toString()]\r\n    ];\r\n\r\n    let summaryY = currentY + 6;\r\n    const leftColumnX = margins.left + 15;\r\n    const rightColumnX = margins.left + summaryBoxWidth / 2 + 15;\r\n\r\n    // Draw left column\r\n    leftColumn.forEach(([label, value]) => {\r\n      pdf.setFont('helvetica', 'bold');\r\n      pdf.text(label, leftColumnX, summaryY);\r\n      pdf.setFont('helvetica', 'normal');\r\n      const labelWidth = pdf.getTextWidth(label);\r\n      pdf.text(value, leftColumnX + labelWidth + 5, summaryY);\r\n      summaryY += 6;\r\n    });\r\n\r\n    // Reset Y for right column\r\n    summaryY = currentY + 6;\r\n\r\n    // Draw right column\r\n    rightColumn.forEach(([label, value]) => {\r\n      pdf.setFont('helvetica', 'bold');\r\n      pdf.text(label, rightColumnX, summaryY);\r\n      pdf.setFont('helvetica', 'normal');\r\n      const labelWidth = pdf.getTextWidth(label);\r\n      pdf.text(value, rightColumnX + labelWidth + 5, summaryY);\r\n      summaryY += 6;\r\n    });\r\n  }\r\n\r\n  // Add watermark to the final page\r\n  addWatermark();\r\n\r\n  // Generate filename based on report date range\r\n  let filename: string;\r\n  \r\n  if (dateRange?.from && dateRange?.to) {\r\n    const fromDate = format(dateRange.from, 'yyyy-MM-dd');\r\n    const toDate = format(dateRange.to, 'yyyy-MM-dd');\r\n    \r\n    if (fromDate === toDate) {\r\n      filename = `stock-summary-${fromDate}.pdf`;\r\n    } else {\r\n      filename = `stock-summary-${fromDate}_to_${toDate}.pdf`;\r\n    }\r\n  } else {\r\n    // Fallback to current date if no range provided\r\n    filename = `stock-summary-${format(new Date(), 'yyyy-MM-dd')}.pdf`;\r\n  }\r\n\r\n  pdf.save(filename);\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2565, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/utils/csvParser.ts"],"sourcesContent":["\r\nexport interface CSVProductRow {\r\n  'Product Name': string;\r\n  'Category': string;\r\n  'Description': string;\r\n  'Supplier': string;\r\n  'Creation Date': string;\r\n  'Initial Stock': string;\r\n  'Minimum Stock Level': string;\r\n  'Cost Price': string;\r\n  'Selling Price': string;\r\n  'Manufacturer Barcode'?: string;\r\n}\r\n\r\nexport interface CSVTransactionRow {\r\n  'Date': string;\r\n  'Type': string;\r\n  'Amount': string;\r\n  'Description': string;\r\n  'Category': string;\r\n  'Payment Method'?: string;\r\n  'Person In Charge'?: string;\r\n  'To Account'?: string;\r\n}\r\n\r\nexport interface CSVExpenseRow {\r\n  'Date': string;\r\n  'Amount': string;\r\n  'Description': string;\r\n  'Category': string;\r\n  'Payment Method'?: string;\r\n  'Person In Charge'?: string;\r\n  'Link to Finance'?: string; // 'true' or 'false'\r\n  'Finance Account'?: string; // Account name\r\n}\r\n\r\nexport interface ValidationError {\r\n  row: number;\r\n  field: string;\r\n  message: string;\r\n}\r\n\r\nexport interface ParsedCSVResult {\r\n  validRows: CSVProductRow[];\r\n  errors: ValidationError[];\r\n  totalRows: number;\r\n}\r\n\r\n// Proper CSV parser that handles quoted fields with commas\r\nconst parseCSVLine = (line: string): string[] => {\r\n  const result: string[] = [];\r\n  let current = '';\r\n  let inQuotes = false;\r\n  let i = 0;\r\n\r\n  while (i < line.length) {\r\n    const char = line[i];\r\n    const nextChar = line[i + 1];\r\n\r\n    if (char === '\"') {\r\n      if (inQuotes && nextChar === '\"') {\r\n        // Escaped quote - add single quote to current field\r\n        current += '\"';\r\n        i += 2; // Skip both quotes\r\n        continue;\r\n      } else {\r\n        // Toggle quote state\r\n        inQuotes = !inQuotes;\r\n      }\r\n    } else if (char === ',' && !inQuotes) {\r\n      // Field separator - push current field and reset\r\n      result.push(current.trim());\r\n      current = '';\r\n    } else {\r\n      // Regular character - add to current field\r\n      current += char;\r\n    }\r\n\r\n    i++;\r\n  }\r\n\r\n  // Push the last field\r\n  result.push(current.trim());\r\n  return result;\r\n};\r\n\r\nexport const parseCSV = (csvText: string): ParsedCSVResult => {\r\n  const lines = csvText.trim().split('\\n');\r\n  const headers = parseCSVLine(lines[0]).map(h => h.trim());\r\n\r\n  const validRows: CSVProductRow[] = [];\r\n  const errors: ValidationError[] = [];\r\n\r\n  for (let i = 1; i < lines.length; i++) {\r\n    const values = parseCSVLine(lines[i]).map(v => v.trim());\r\n    const row: any = {};\r\n\r\n    // Map values to headers\r\n    headers.forEach((header, index) => {\r\n      row[header] = values[index] || '';\r\n    });\r\n\r\n    // Validate required fields\r\n    const rowErrors = validateCSVRow(row, i + 1);\r\n\r\n    if (rowErrors.length === 0) {\r\n      validRows.push(row as CSVProductRow);\r\n    } else {\r\n      errors.push(...rowErrors);\r\n    }\r\n  }\r\n\r\n  return {\r\n    validRows,\r\n    errors,\r\n    totalRows: lines.length - 1\r\n  };\r\n};\r\n\r\nexport interface ParsedTransactionCSVResult {\r\n  validRows: CSVTransactionRow[];\r\n  errors: ValidationError[];\r\n  totalRows: number;\r\n}\r\n\r\nexport const parseTransactionCSV = (csvText: string): ParsedTransactionCSVResult => {\r\n  const lines = csvText.trim().split('\\n');\r\n  if (lines.length < 1) return { validRows: [], errors: [], totalRows: 0 };\r\n\r\n  const headers = parseCSVLine(lines[0]).map(h => h.trim());\r\n\r\n  const validRows: CSVTransactionRow[] = [];\r\n  const errors: ValidationError[] = [];\r\n\r\n  for (let i = 1; i < lines.length; i++) {\r\n    if (!lines[i].trim()) continue;\r\n\r\n    const values = parseCSVLine(lines[i]).map(v => v.trim());\r\n    const row: any = {};\r\n\r\n    // Map values to headers\r\n    headers.forEach((header, index) => {\r\n      row[header] = values[index] || '';\r\n    });\r\n\r\n    // Validate required fields\r\n    const rowErrors = validateTransactionCSVRow(row, i + 1);\r\n\r\n    if (rowErrors.length === 0) {\r\n      validRows.push(row as CSVTransactionRow);\r\n    } else {\r\n      errors.push(...rowErrors);\r\n    }\r\n  }\r\n\r\n  return {\r\n    validRows,\r\n    errors,\r\n    totalRows: lines.length - 1\r\n  };\r\n};\r\n\r\nexport interface ParsedExpenseCSVResult {\r\n  validRows: CSVExpenseRow[];\r\n  errors: ValidationError[];\r\n  totalRows: number;\r\n}\r\n\r\nexport const parseExpenseCSV = (csvText: string): ParsedExpenseCSVResult => {\r\n  const lines = csvText.trim().split('\\n');\r\n  if (lines.length < 1) return { validRows: [], errors: [], totalRows: 0 };\r\n\r\n  const headers = parseCSVLine(lines[0]).map(h => h.trim());\r\n\r\n  const validRows: CSVExpenseRow[] = [];\r\n  const errors: ValidationError[] = [];\r\n\r\n  for (let i = 1; i < lines.length; i++) {\r\n    if (!lines[i].trim()) continue;\r\n\r\n    const values = parseCSVLine(lines[i]).map(v => v.trim());\r\n    const row: any = {};\r\n\r\n    // Map values to headers\r\n    headers.forEach((header, index) => {\r\n      row[header] = values[index] || '';\r\n    });\r\n\r\n    // Validate required fields\r\n    const rowErrors = validateExpenseCSVRow(row, i + 1);\r\n\r\n    if (rowErrors.length === 0) {\r\n      validRows.push(row as CSVExpenseRow);\r\n    } else {\r\n      errors.push(...rowErrors);\r\n    }\r\n  }\r\n\r\n  return {\r\n    validRows,\r\n    errors,\r\n    totalRows: lines.length - 1\r\n  };\r\n};\r\n\r\nconst validateCSVRow = (row: any, rowNumber: number): ValidationError[] => {\r\n  const errors: ValidationError[] = [];\r\n\r\n  // Only validate that Product Name is present\r\n  if (!row['Product Name']?.trim()) {\r\n    errors.push({\r\n      row: rowNumber,\r\n      field: 'Product Name',\r\n      message: 'Product Name is required'\r\n    });\r\n  }\r\n\r\n  return errors;\r\n};\r\n\r\nexport const validateTransactionCSVRow = (row: any, rowNumber: number): ValidationError[] => {\r\n  const errors: ValidationError[] = [];\r\n\r\n  if (!row['Amount'] || isNaN(Number(row['Amount'])) || Number(row['Amount']) <= 0) {\r\n    errors.push({\r\n      row: rowNumber,\r\n      field: 'Amount',\r\n      message: 'Amount must be a positive number'\r\n    });\r\n  }\r\n\r\n  if (!row['Type'] || !['cash_in', 'cash_out', 'transfer'].includes(row['Type'].toLowerCase())) {\r\n    errors.push({\r\n      row: rowNumber,\r\n      field: 'Type',\r\n      message: 'Type must be \"cash_in\", \"cash_out\", or \"transfer\"'\r\n    });\r\n  }\r\n\r\n  if (!row['Description']?.trim()) {\r\n    errors.push({\r\n      row: rowNumber,\r\n      field: 'Description',\r\n      message: 'Description is required'\r\n    });\r\n  }\r\n\r\n  if (row['Type']?.toLowerCase() === 'transfer' && !row['To Account']) {\r\n    errors.push({\r\n      row: rowNumber,\r\n      field: 'To Account',\r\n      message: 'To Account is required for transfers'\r\n    });\r\n  }\r\n\r\n  return errors;\r\n};\r\n\r\nexport const validateExpenseCSVRow = (row: any, rowNumber: number): ValidationError[] => {\r\n  const errors: ValidationError[] = [];\r\n\r\n  if (!row['Amount'] || isNaN(Number(row['Amount'])) || Number(row['Amount']) <= 0) {\r\n    errors.push({\r\n      row: rowNumber,\r\n      field: 'Amount',\r\n      message: 'Amount must be a positive number'\r\n    });\r\n  }\r\n\r\n  if (!row['Description']?.trim()) {\r\n    errors.push({\r\n      row: rowNumber,\r\n      field: 'Description',\r\n      message: 'Description is required'\r\n    });\r\n  }\r\n\r\n  const linkToFinance = row['Link to Finance']?.toString().toLowerCase();\r\n  if (linkToFinance === 'true' && !row['Finance Account']?.trim()) {\r\n    errors.push({\r\n      row: rowNumber,\r\n      field: 'Finance Account',\r\n      message: 'Finance Account is required when Link to Finance is true'\r\n    });\r\n  }\r\n\r\n  return errors;\r\n};\r\n\r\nexport const generateErrorLogCSV = (errors: ValidationError[], filename: string = 'upload_errors.csv') => {\r\n  const headers = ['Row', 'Field', 'Error Message'];\r\n  const csvContent = [\r\n    headers.join(','),\r\n    ...errors.map(error =>\r\n      [error.row, error.field, `\"${error.message}\"`].join(',')\r\n    )\r\n  ].join('\\n');\r\n\r\n  const blob = new Blob([csvContent], { type: 'text/csv' });\r\n  const url = window.URL.createObjectURL(blob);\r\n  const link = document.createElement('a');\r\n  link.href = url;\r\n  link.download = filename;\r\n  document.body.appendChild(link);\r\n  link.click();\r\n  document.body.removeChild(link);\r\n  window.URL.revokeObjectURL(url);\r\n};\r\n\r\nexport const extractUniqueCategories = (validRows: CSVProductRow[]): string[] => {\r\n  const categories = validRows\r\n    .map(row => row['Category']?.trim())\r\n    .filter(category => category && category !== '');\r\n\r\n  return [...new Set(categories)];\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2819, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/utils/csvTemplate.ts"],"sourcesContent":["\r\nexport const generateProductCSVTemplate = () => {\r\n  const headers = [\r\n    'Product Name',\r\n    'Category',\r\n    'Description',\r\n    'Supplier',\r\n    'Creation Date',\r\n    'Initial Stock',\r\n    'Minimum Stock Level',\r\n    'Cost Price',\r\n    'Selling Price'\r\n  ];\r\n\r\n  const sampleData = [\r\n    [\r\n      '\"Sample Product with, commas\"',\r\n      'Electronics',\r\n      '\"A detailed product description, with commas and other punctuation!\"',\r\n      '\"Supplier Name, Inc.\"',\r\n      '15/01/2024',\r\n      '10',\r\n      '5',\r\n      '50.00',\r\n      '75.00'\r\n    ],\r\n    [\r\n      'Simple Product Name',\r\n      'Home & Garden',\r\n      'Basic description without commas',\r\n      'Basic Supplier',\r\n      '2024-01-16',\r\n      '-5',\r\n      '0',\r\n      '-25.50',\r\n      '100.75'\r\n    ]\r\n  ];\r\n\r\n  const csvContent = [\r\n    headers.join(','),\r\n    ...sampleData.map(row => row.join(','))\r\n  ].join('\\n');\r\n\r\n  const blob = new Blob([csvContent], { type: 'text/csv' });\r\n  const url = window.URL.createObjectURL(blob);\r\n  const link = document.createElement('a');\r\n  link.href = url;\r\n  link.download = 'product_template.csv';\r\n  document.body.appendChild(link);\r\n  link.click();\r\n  document.body.removeChild(link);\r\n  window.URL.revokeObjectURL(url);\r\n};\r\n\r\nexport const generateTransactionCSVTemplate = () => {\r\n  const headers = [\r\n    'Date',\r\n    'Type',\r\n    'Amount',\r\n    'Description',\r\n    'Category',\r\n    'Payment Method',\r\n    'Person In Charge',\r\n    'To Account'\r\n  ];\r\n\r\n  const sampleData = [\r\n    [\r\n      '22/12/2025',\r\n      'cash_in',\r\n      '1500.00',\r\n      'Sales income from morning shift',\r\n      'Sales',\r\n      'Cash',\r\n      'John Doe',\r\n      ''\r\n    ],\r\n    [\r\n      '22/12/2025',\r\n      'cash_out',\r\n      '200.50',\r\n      'Purchased cleaning supplies',\r\n      'Expenses',\r\n      'Cash',\r\n      'Jane Smith',\r\n      ''\r\n    ],\r\n    [\r\n      '22/12/2025',\r\n      'transfer',\r\n      '5000.00',\r\n      'Moving funds to main safe',\r\n      'Internal',\r\n      '',\r\n      'Admin',\r\n      'Main Safe'\r\n    ]\r\n  ];\r\n\r\n  const csvContent = [\r\n    headers.join(','),\r\n    ...sampleData.map(row => row.join(','))\r\n  ].join('\\n');\r\n\r\n  const blob = new Blob([csvContent], { type: 'text/csv' });\r\n  const url = window.URL.createObjectURL(blob);\r\n  const link = document.createElement('a');\r\n  link.href = url;\r\n  link.download = 'transaction_template.csv';\r\n  document.body.appendChild(link);\r\n  link.click();\r\n  document.body.removeChild(link);\r\n  window.URL.revokeObjectURL(url);\r\n};\r\n"],"names":[],"mappings":";;;;;;AACO,MAAM,6BAA6B;IACxC,MAAM,UAAU;QACd;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD;IAED,MAAM,aAAa;QACjB;YACE;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;SACD;QACD;YACE;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;SACD;KACF;IAED,MAAM,aAAa;QACjB,QAAQ,IAAI,CAAC;WACV,WAAW,GAAG,CAAC,CAAA,MAAO,IAAI,IAAI,CAAC;KACnC,CAAC,IAAI,CAAC;IAEP,MAAM,OAAO,IAAI,KAAK;QAAC;KAAW,EAAE;QAAE,MAAM;IAAW;IACvD,MAAM,MAAM,OAAO,GAAG,CAAC,eAAe,CAAC;IACvC,MAAM,OAAO,SAAS,aAAa,CAAC;IACpC,KAAK,IAAI,GAAG;IACZ,KAAK,QAAQ,GAAG;IAChB,SAAS,IAAI,CAAC,WAAW,CAAC;IAC1B,KAAK,KAAK;IACV,SAAS,IAAI,CAAC,WAAW,CAAC;IAC1B,OAAO,GAAG,CAAC,eAAe,CAAC;AAC7B;AAEO,MAAM,iCAAiC;IAC5C,MAAM,UAAU;QACd;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD;IAED,MAAM,aAAa;QACjB;YACE;YACA;YACA;YACA;YACA;YACA;YACA;YACA;SACD;QACD;YACE;YACA;YACA;YACA;YACA;YACA;YACA;YACA;SACD;QACD;YACE;YACA;YACA;YACA;YACA;YACA;YACA;YACA;SACD;KACF;IAED,MAAM,aAAa;QACjB,QAAQ,IAAI,CAAC;WACV,WAAW,GAAG,CAAC,CAAA,MAAO,IAAI,IAAI,CAAC;KACnC,CAAC,IAAI,CAAC;IAEP,MAAM,OAAO,IAAI,KAAK;QAAC;KAAW,EAAE;QAAE,MAAM;IAAW;IACvD,MAAM,MAAM,OAAO,GAAG,CAAC,eAAe,CAAC;IACvC,MAAM,OAAO,SAAS,aAAa,CAAC;IACpC,KAAK,IAAI,GAAG;IACZ,KAAK,QAAQ,GAAG;IAChB,SAAS,IAAI,CAAC,WAAW,CAAC;IAC1B,KAAK,KAAK;IACV,SAAS,IAAI,CAAC,WAAW,CAAC;IAC1B,OAAO,GAAG,CAAC,eAAe,CAAC;AAC7B"}},
    {"offset": {"line": 2947, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/utils/exportStockCount.ts"],"sourcesContent":["import { format } from 'date-fns';\r\nimport jsPDF from 'jspdf';\r\nimport autoTable from 'jspdf-autotable';\r\nimport { Product } from '@/types';\r\n\r\ninterface StockCountExportData {\r\n    product: Product;\r\n    actualStock: number;\r\n    variation: number;\r\n}\r\n\r\nexport const exportStockCountToCSV = (data: StockCountExportData[]) => {\r\n    const headers = ['Product Name', 'Barcode', 'System Stock', 'Actual Stock', 'Variation'];\r\n    const rows = data.map(item => [\r\n        item.product.name,\r\n        item.product.barcode || 'N/A',\r\n        item.product.quantity.toString(),\r\n        item.actualStock.toString(),\r\n        item.variation.toString()\r\n    ]);\r\n\r\n    const csvContent = [\r\n        headers.join(','),\r\n        ...rows.map(row => row.map(cell => `\"${cell.replace(/\"/g, '\"\"')}\"`).join(','))\r\n    ].join('\\n');\r\n\r\n    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\r\n    const url = URL.createObjectURL(blob);\r\n    const link = document.createElement('a');\r\n    link.setAttribute('href', url);\r\n    link.setAttribute('download', `stock_count_${format(new Date(), 'yyyy-MM-dd_HHmm')}.csv`);\r\n    document.body.appendChild(link);\r\n    link.click();\r\n    document.body.removeChild(link);\r\n};\r\n\r\nexport const exportStockCountToPDF = (\r\n    data: StockCountExportData[],\r\n    businessName: string = 'Gonza Systems',\r\n    metadata?: { auditorName?: string; contactPerson?: string; auditNumber?: number; auditId?: string }\r\n) => {\r\n    const doc = new jsPDF() as any;\r\n    const pageWidth = doc.internal.pageSize.getWidth();\r\n\r\n    // Header\r\n    doc.setFontSize(20);\r\n    const headerText = metadata?.auditId\r\n        ? `Stock Count Report - ${metadata.auditId}`\r\n        : `Stock Count / Audit Report ${metadata?.auditNumber ? `#${metadata.auditNumber}` : ''}`;\r\n    doc.text(headerText, 14, 22);\r\n    doc.setFontSize(11);\r\n    doc.setTextColor(100);\r\n    doc.text(`Business: ${businessName}`, 14, 30);\r\n    doc.text(`Date: ${format(new Date(), 'PPP p')}`, 14, 36);\r\n\r\n    if (metadata?.auditorName || metadata?.contactPerson) {\r\n        let metaY = 42;\r\n        if (metadata.auditorName) {\r\n            doc.text(`Auditor: ${metadata.auditorName}`, 14, metaY);\r\n            metaY += 6;\r\n        }\r\n        if (metadata.contactPerson) {\r\n            doc.text(`Contact Person: ${metadata.contactPerson}`, 14, metaY);\r\n        }\r\n    }\r\n\r\n    // Table\r\n    const tableColumn = [\"Product Name\", \"Barcode\", \"System\", \"Actual\", \"Variation\"];\r\n    const tableRows = data.map(item => [\r\n        item.product.name,\r\n        item.product.barcode || 'N/A',\r\n        item.product.quantity.toString(),\r\n        item.actualStock.toString(),\r\n        {\r\n            content: item.variation > 0 ? `+${item.variation}` : item.variation.toString(),\r\n            styles: { textColor: (item.variation < 0 ? [220, 38, 38] : item.variation > 0 ? [22, 163, 74] : [100, 116, 139]) as [number, number, number] }\r\n        }\r\n    ]);\r\n\r\n    autoTable(doc, {\r\n        head: [tableColumn],\r\n        body: tableRows,\r\n        startY: metadata?.auditorName || metadata?.contactPerson ? 55 : 45,\r\n        theme: 'striped',\r\n        headStyles: { fillColor: [59, 130, 246] },\r\n        alternateRowStyles: { fillColor: [248, 250, 252] },\r\n        margin: { top: 45 },\r\n    });\r\n\r\n    // Signatures\r\n    const finalY = (doc as any).lastAutoTable.finalY + 25;\r\n    if (finalY < doc.internal.pageSize.getHeight() - 40) {\r\n        doc.setDrawColor(200);\r\n        doc.line(14, finalY, 80, finalY);\r\n        doc.line(pageWidth - 80, finalY, pageWidth - 14, finalY);\r\n\r\n        doc.setFontSize(9);\r\n        doc.setTextColor(50);\r\n        doc.text('Auditor Signature', 14, finalY + 5);\r\n        doc.text('Stock Manager Signature', pageWidth - 80, finalY + 5);\r\n    }\r\n\r\n    // Footer\r\n    const pageCount = (doc as any).internal.getNumberOfPages();\r\n    for (let i = 1; i <= pageCount; i++) {\r\n        doc.setPage(i);\r\n        doc.setFontSize(8);\r\n        doc.setTextColor(150);\r\n        doc.text(\r\n            'Created By Gonza Systems',\r\n            doc.internal.pageSize.getWidth() / 2,\r\n            doc.internal.pageSize.getHeight() - 10,\r\n            { align: 'center' }\r\n        );\r\n    }\r\n\r\n    doc.save(`stock_audit_${format(new Date(), 'yyyy-MM-dd_HHmm')}.pdf`);\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3099, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/types/index.ts"],"sourcesContent":["// Sale item type definition\r\nexport interface SaleItem {\r\n  description: string;\r\n  quantity: number;\r\n  price: number;\r\n  cost: number;\r\n  productId?: string;\r\n  discountPercentage?: number;\r\n  discountType?: 'percentage' | 'amount';\r\n  discountAmount?: number;\r\n}\r\n\r\nexport interface SalesCategory {\r\n  id: string;\r\n  user_id: string;\r\n  location_id?: string;\r\n  name: string;\r\n  is_default: boolean;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface Sale {\r\n  id: string;\r\n  receiptNumber: string;\r\n  customerName: string;\r\n  customerAddress?: string;\r\n  customerContact?: string;\r\n  customerId?: string;\r\n  items: SaleItem[];\r\n  paymentStatus: 'Paid' | 'NOT PAID' | 'Quote' | 'Installment Sale';\r\n  profit: number;\r\n  date: Date;\r\n  taxRate?: number;\r\n  cashTransactionId?: string;\r\n  amountPaid?: number;\r\n  amountDue?: number;\r\n  notes?: string;\r\n  categoryId?: string;\r\n  installments?: Array<{\r\n    date?: string | Date;\r\n    amountPaid?: number;\r\n  }>;\r\n  createdAt: Date;\r\n}\r\n\r\n// Supabase database schema and Json type\r\nexport type Json =\r\n  | string\r\n  | number\r\n  | boolean\r\n  | null\r\n  | { [key: string]: Json | undefined }\r\n  | Json[];\r\n\r\n// Supabase database sale structure\r\nexport interface DbSale {\r\n  id: string;\r\n  user_id: string;\r\n  location_id: string;\r\n  receipt_number: string;\r\n  customer_name: string;\r\n  customer_address?: string | null;\r\n  customer_contact?: string | null;\r\n  customer_id?: string | null;\r\n  items: Json;\r\n  payment_status: string;\r\n  profit: number;\r\n  date: string;\r\n  tax_rate?: number | null;\r\n  created_at: string;\r\n  updated_at: string;\r\n  cash_transaction_id?: string | null;\r\n  amount_paid?: number | null;\r\n  amount_due?: number | null;\r\n  notes?: string | null;\r\n  category_id?: string | null;\r\n}\r\n\r\n// Expense interface - add cashTransactionId field\r\nexport interface Expense {\r\n  id: string;\r\n  amount: number;\r\n  description: string;\r\n  category: string | null;\r\n  date: Date;\r\n  paymentMethod: string | null;\r\n  personInCharge: string | null;\r\n  receiptImage: string | null;\r\n  cashAccountId: string | null;\r\n  cashTransactionId: string | null; // Add this field\r\n  createdAt: Date;\r\n  updatedAt: Date;\r\n}\r\n\r\n// Supabase database expense structure\r\nexport interface DbExpense {\r\n  id: string;\r\n  user_id: string;\r\n  amount: number;\r\n  description: string;\r\n  category: string | null;\r\n  date: string;\r\n  payment_method: string | null;\r\n  person_in_charge: string | null;\r\n  receipt_image: string | null;\r\n  cash_account_id: string | null;\r\n  cash_transaction_id: string | null; // Add this field\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface SaleFormData {\r\n  customerName: string;\r\n  customerAddress: string;\r\n  customerContact: string;\r\n  customerId?: string; // Added customerId field\r\n  items: SaleItem[];\r\n  paymentStatus: \"Paid\" | \"NOT PAID\" | \"Quote\" | \"Installment Sale\";\r\n  receiptNumber?: string;\r\n  taxRate?: number | null;\r\n  amountPaid?: number;\r\n  amountDue?: number;\r\n  notes?: string;\r\n  categoryId?: string;\r\n}\r\n\r\n// Analytics data type\r\nexport interface AnalyticsData {\r\n  totalSales: number;\r\n  totalProfit: number;\r\n  totalCost: number;\r\n  paidSalesCount: number;\r\n  pendingSalesCount: number;\r\n}\r\n\r\n// Form validation errors\r\nexport interface FormErrors {\r\n  customerName?: string;\r\n  customerAddress?: string;\r\n  customerContact?: string;\r\n  itemDescription?: string;\r\n  quantity?: string;\r\n  salePrice?: string;\r\n  costOfProduction?: string;\r\n  taxRate?: string;\r\n}\r\n\r\n// BusinessSettings interface to include paymentInfo\r\nexport interface BusinessSettings {\r\n  businessName: string;\r\n  businessAddress: string;\r\n  businessPhone: string;\r\n  businessEmail: string;\r\n  businessLogo?: string;\r\n  currency: string;\r\n  signature?: string;\r\n  paymentInfo?: string; // Added payment information field\r\n  defaultPrintFormat?: 'standard' | 'thermal'; // Added default print format\r\n  defaultPrinterName?: string; // Added default printer name\r\n  defaultPrinterType?: 'USB' | 'Bluetooth'; // Added default printer type\r\n}\r\n\r\n// Database business settings structure\r\nexport interface DbBusinessSettings {\r\n  id?: string;\r\n  user_id: string; // Make sure this is required, not optional\r\n  business_name: string;\r\n  business_address: string;\r\n  business_phone: string;\r\n  business_email: string;\r\n  business_logo?: string;\r\n  currency: string;\r\n  signature?: string;\r\n  metadata?: Json | null; // Add metadata field\r\n  created_at?: string;\r\n  updated_at?: string;\r\n}\r\n\r\n// Updated UserProfile interface to match the Supabase database structure\r\nexport interface UserProfile {\r\n  id: string;\r\n  full_name: string | null;\r\n  display_name: string | null;\r\n  avatar_url: string | null;\r\n  created_at: string | null;\r\n  updated_at: string | null;\r\n}\r\n\r\n// New interfaces for Product management - ADDED itemNumber\r\nexport interface Product {\r\n  id: string;\r\n  itemNumber: string; // Added item number field\r\n  barcode: string | null; // Added barcode field\r\n  manufacturerBarcode: string | null; // Added manufacturer barcode field\r\n  name: string;\r\n  description: string | null;\r\n  category: string;\r\n  quantity: number;\r\n  costPrice: number;\r\n  sellingPrice: number;\r\n  supplier: string | null;\r\n  imageUrl: string | null;\r\n  minimumStock: number;\r\n  createdAt: Date;\r\n  updatedAt: Date;\r\n}\r\n\r\nexport interface DbProduct {\r\n  id: string;\r\n  user_id: string;\r\n  item_number: string; // Added item number field\r\n  barcode: string | null; // Added barcode field\r\n  manufacturer_barcode: string | null; // Added manufacturer barcode field\r\n  name: string;\r\n  description: string | null;\r\n  category: string;\r\n  quantity: number;\r\n  cost_price: number;\r\n  selling_price: number;\r\n  supplier: string | null;\r\n  image_url: string | null;\r\n  minimum_stock: number;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface ProductFormData {\r\n  name: string;\r\n  barcode?: string; // Added barcode field\r\n  manufacturerBarcode?: string; // Added manufacturer barcode field\r\n  description?: string;\r\n  category?: string;\r\n  quantity: number; // Always a number, never undefined\r\n  costPrice?: number;\r\n  sellingPrice?: number;\r\n  supplier?: string;\r\n  minimumStock?: number;\r\n  imageFile?: File | null;\r\n  imageUrl?: string | null;\r\n  createdAt?: Date; // Added created date field\r\n}\r\n\r\nexport interface ProductCategory {\r\n  id: string;\r\n  name: string;\r\n}\r\n\r\nexport interface DbProductCategory {\r\n  id: string;\r\n  user_id: string;\r\n  name: string;\r\n  created_at: string;\r\n}\r\n\r\nexport interface StockHistoryEntry {\r\n  id: string;\r\n  productId: string;\r\n  oldQuantity: number;\r\n  newQuantity: number;\r\n  changeReason: string;\r\n  referenceId?: string | null;\r\n  receiptNumber?: string;\r\n  createdAt: Date;\r\n  product?: {\r\n    name: string;\r\n    costPrice: number;\r\n    sellingPrice: number;\r\n    itemNumber: string;\r\n  };\r\n}\r\n\r\nexport interface DbStockHistoryEntry {\r\n  id: string;\r\n  user_id: string;\r\n  product_id: string;\r\n  previous_quantity: number;\r\n  new_quantity: number;\r\n  change_reason: string;\r\n  reference_id?: string | null;\r\n  created_at: string;\r\n}\r\n\r\nexport interface ProductFilters {\r\n  search: string;\r\n  category: string;\r\n  stockStatus: 'all' | 'inStock' | 'lowStock' | 'outOfStock';\r\n}\r\n\r\n// Customer management types\r\nexport interface Customer {\r\n  id: string;\r\n  fullName: string;\r\n  email: string | null;\r\n  phoneNumber: string | null;\r\n  birthday: Date | null;\r\n  location: string | null;\r\n  categoryId: string | null; // Added category relationship\r\n  socialMedia: {\r\n    facebook?: string;\r\n    instagram?: string;\r\n    twitter?: string;\r\n    linkedin?: string;\r\n    other?: string;\r\n  } | null;\r\n  gender: string | null;\r\n  tags: string[] | null;\r\n  notes: string | null;\r\n  createdAt: Date;\r\n  updatedAt: Date;\r\n}\r\n\r\nexport interface DbCustomer {\r\n  id: string;\r\n  user_id: string;\r\n  full_name: string;\r\n  email: string | null;\r\n  phone_number: string | null;\r\n  birthday: string | null;\r\n  location: string | null;\r\n  category_id: string | null; // Added category relationship\r\n  social_media: Json | null;\r\n  gender: string | null;\r\n  tags: string[] | null;\r\n  notes: string | null;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface CustomerFormData {\r\n  fullName: string;\r\n  email: string;\r\n  phoneNumber: string;\r\n  birthday: Date | null;\r\n  location: string;\r\n  categoryId: string | null; // Added category field\r\n  socialMedia: {\r\n    facebook?: string;\r\n    instagram?: string;\r\n    twitter?: string;\r\n    linkedin?: string;\r\n    other?: string;\r\n  };\r\n  gender: string;\r\n  tags: string[];\r\n  notes: string;\r\n}\r\n\r\n// Utility functions for database conversions\r\nexport const mapDbSaleToSale = (dbSale: DbSale): Sale => {\r\n  // Parse items and ensure numeric fields are numbers, not strings\r\n  // This is critical for discount calculations to work correctly\r\n  const items = (Array.isArray(dbSale.items) ? dbSale.items : []).map((item: any) => {\r\n    const discountPercentage = item.discountPercentage !== undefined ? Number(item.discountPercentage) : undefined;\r\n    const discountAmount = item.discountAmount !== undefined ? Number(item.discountAmount) : undefined;\r\n\r\n    // Infer discountType if missing (for legacy data)\r\n    let discountType = item.discountType as 'percentage' | 'amount' | undefined;\r\n    if (!discountType) {\r\n      if (discountPercentage && discountPercentage > 0) {\r\n        discountType = 'percentage';\r\n      } else if (discountAmount && discountAmount > 0) {\r\n        discountType = 'amount';\r\n      }\r\n    }\r\n\r\n    return {\r\n      description: item.description || '',\r\n      quantity: Number(item.quantity) || 0,\r\n      price: Number(item.price) || 0,\r\n      cost: Number(item.cost) || 0,\r\n      productId: item.productId || undefined,\r\n      discountType,\r\n      discountPercentage,\r\n      discountAmount,\r\n      createdAt: item.createdAt || undefined,\r\n    };\r\n  }) as SaleItem[];\r\n\r\n  return {\r\n    id: dbSale.id,\r\n    receiptNumber: dbSale.receipt_number,\r\n    customerName: dbSale.customer_name,\r\n    customerAddress: dbSale.customer_address || '',\r\n    customerContact: dbSale.customer_contact || '',\r\n    customerId: dbSale.customer_id || undefined,\r\n    items,\r\n    paymentStatus: dbSale.payment_status as 'Paid' | 'NOT PAID' | 'Quote' | 'Installment Sale',\r\n    profit: Number(dbSale.profit),\r\n    date: new Date(dbSale.date),\r\n    taxRate: dbSale.tax_rate ? Number(dbSale.tax_rate) : 0,\r\n    cashTransactionId: dbSale.cash_transaction_id || undefined,\r\n    amountPaid: dbSale.amount_paid ? Number(dbSale.amount_paid) : undefined,\r\n    amountDue: dbSale.amount_due ? Number(dbSale.amount_due) : undefined,\r\n    notes: dbSale.notes || '',\r\n    categoryId: dbSale.category_id || undefined,\r\n    createdAt: new Date(dbSale.created_at),\r\n  };\r\n};\r\n\r\nexport const mapSaleToDbSale = (\r\n  saleData: SaleFormData,\r\n  selectedDate: Date,\r\n  profit: number,\r\n  receiptNumber: string,\r\n  userId: string,\r\n  locationId: string,\r\n  cashTransactionId?: string | null\r\n): Omit<DbSale, 'id' | 'created_at' | 'updated_at'> => {\r\n  return {\r\n    user_id: userId,\r\n    location_id: locationId,\r\n    receipt_number: receiptNumber,\r\n    customer_name: saleData.customerName,\r\n    customer_address: saleData.customerAddress || null,\r\n    customer_contact: saleData.customerContact || null,\r\n    customer_id: saleData.customerId || null, // Include customer_id\r\n    items: (saleData.items as unknown) as Json,\r\n    payment_status: saleData.paymentStatus,\r\n    profit: profit,\r\n    date: selectedDate.toISOString().split('T')[0],\r\n    tax_rate: saleData.taxRate || 0,\r\n    cash_transaction_id: cashTransactionId || null,\r\n    amount_paid: saleData.amountPaid || null,\r\n    amount_due: saleData.amountDue || null,\r\n    notes: saleData.notes || null,\r\n    category_id: saleData.categoryId || null,\r\n  };\r\n};\r\n\r\n// Conversion functions for business settings\r\nexport const mapDbBusinessSettingsToBusinessSettings = (dbSettings: DbBusinessSettings): BusinessSettings => {\r\n  return {\r\n    businessName: dbSettings.business_name,\r\n    businessAddress: dbSettings.business_address,\r\n    businessPhone: dbSettings.business_phone,\r\n    businessEmail: dbSettings.business_email,\r\n    businessLogo: dbSettings.business_logo,\r\n    currency: dbSettings.currency,\r\n    signature: dbSettings.signature,\r\n    paymentInfo: dbSettings.metadata && typeof dbSettings.metadata === 'object' ?\r\n      (dbSettings.metadata as Record<string, unknown>).payment_info as string || '' : '',\r\n    defaultPrintFormat: dbSettings.metadata && typeof dbSettings.metadata === 'object' ?\r\n      (dbSettings.metadata as Record<string, unknown>).default_print_format as 'standard' | 'thermal' || 'standard' : 'standard',\r\n    defaultPrinterName: dbSettings.metadata && typeof dbSettings.metadata === 'object' ?\r\n      (dbSettings.metadata as Record<string, unknown>).default_printer_name as string || '' : '',\r\n    defaultPrinterType: dbSettings.metadata && typeof dbSettings.metadata === 'object' ?\r\n      (dbSettings.metadata as Record<string, unknown>).default_printer_type as 'USB' | 'Bluetooth' || 'USB' : 'USB'\r\n  };\r\n};\r\n\r\nexport const mapBusinessSettingsToDbBusinessSettings = (\r\n  settings: BusinessSettings,\r\n  userId: string\r\n): DbBusinessSettings => {\r\n  // Create metadata object with payment_info\r\n  const metadata: Json = {\r\n    payment_info: settings.paymentInfo || '',\r\n    default_print_format: settings.defaultPrintFormat || 'standard',\r\n    default_printer_name: settings.defaultPrinterName || '',\r\n    default_printer_type: settings.defaultPrinterType || 'USB'\r\n  };\r\n\r\n  return {\r\n    user_id: userId,\r\n    business_name: settings.businessName,\r\n    business_address: settings.businessAddress,\r\n    business_phone: settings.businessPhone,\r\n    business_email: settings.businessEmail,\r\n    business_logo: settings.businessLogo,\r\n    currency: settings.currency,\r\n    signature: settings.signature,\r\n    metadata: metadata, // Include metadata in the return object\r\n    updated_at: new Date().toISOString()\r\n  };\r\n};\r\n\r\n// Conversion functions for products and categories - ADDED itemNumber\r\nexport const mapDbProductToProduct = (dbProduct: DbProduct): Product => {\r\n  return {\r\n    id: dbProduct.id,\r\n    itemNumber: dbProduct.item_number, // Added item number mapping\r\n    barcode: dbProduct.barcode, // Added barcode mapping\r\n    manufacturerBarcode: dbProduct.manufacturer_barcode, // Added manufacturer barcode mapping\r\n    name: dbProduct.name,\r\n    description: dbProduct.description,\r\n    category: dbProduct.category,\r\n    quantity: dbProduct.quantity,\r\n    costPrice: Number(dbProduct.cost_price),\r\n    sellingPrice: Number(dbProduct.selling_price),\r\n    supplier: dbProduct.supplier,\r\n    imageUrl: dbProduct.image_url,\r\n    minimumStock: dbProduct.minimum_stock,\r\n    createdAt: new Date(dbProduct.created_at),\r\n    updatedAt: new Date(dbProduct.updated_at)\r\n  };\r\n};\r\n\r\nexport const mapProductToDbProduct = (product: Partial<Product>, userId: string): Partial<DbProduct> => {\r\n  const result: Partial<DbProduct> = {\r\n    user_id: userId\r\n  };\r\n\r\n  if (product.id) result.id = product.id;\r\n  if (product.itemNumber) result.item_number = product.itemNumber; // Added item number mapping\r\n  if (product.barcode !== undefined) result.barcode = product.barcode; // Added barcode mapping\r\n  if (product.manufacturerBarcode !== undefined) result.manufacturer_barcode = product.manufacturerBarcode; // Added manufacturer barcode mapping\r\n  if (product.name) result.name = product.name;\r\n  result.description = product.description;\r\n  if (product.category) result.category = product.category;\r\n  if (product.quantity !== undefined) result.quantity = product.quantity;\r\n  if (product.costPrice !== undefined) {\r\n    result.cost_price = product.costPrice;\r\n    console.log(`DEBUG: Mapping costPrice ${product.costPrice} to cost_price`);\r\n  }\r\n  if (product.sellingPrice !== undefined) {\r\n    result.selling_price = product.sellingPrice;\r\n    console.log(`DEBUG: Mapping sellingPrice ${product.sellingPrice} to selling_price`);\r\n  }\r\n  result.supplier = product.supplier;\r\n  result.image_url = product.imageUrl;\r\n  if (product.minimumStock !== undefined) result.minimum_stock = product.minimumStock;\r\n\r\n  return result;\r\n};\r\n\r\nexport const mapDbProductCategoryToProductCategory = (dbCategory: DbProductCategory): ProductCategory => {\r\n  return {\r\n    id: dbCategory.id,\r\n    name: dbCategory.name\r\n  };\r\n};\r\n\r\nexport const mapDbStockHistoryToStockHistory = (dbHistory: DbStockHistoryEntry): StockHistoryEntry => {\r\n  return {\r\n    id: dbHistory.id,\r\n    productId: dbHistory.product_id,\r\n    oldQuantity: dbHistory.previous_quantity,\r\n    newQuantity: dbHistory.new_quantity,\r\n    changeReason: dbHistory.change_reason,\r\n    referenceId: dbHistory.reference_id || null,\r\n    createdAt: new Date(dbHistory.created_at)\r\n  };\r\n};\r\n\r\n// Updated Customer mapping functions to include categoryId\r\nexport const mapDbCustomerToCustomer = (dbCustomer: DbCustomer): Customer => {\r\n  let birthday = null;\r\n\r\n  if (dbCustomer.birthday) {\r\n    try {\r\n      const birthdayStr = String(dbCustomer.birthday);\r\n      const [year, month, day] = birthdayStr.split('-').map(Number);\r\n\r\n      if (!isNaN(year) && !isNaN(month) && !isNaN(day)) {\r\n        birthday = new Date(Date.UTC(year, month - 1, day, 12, 0, 0));\r\n\r\n        console.log(\r\n          'Converting DB birthday to Date object:',\r\n          dbCustomer.birthday,\r\n          '',\r\n          birthday,\r\n          '(UTC string:',\r\n          birthday.toISOString(),\r\n          ')'\r\n        );\r\n      } else {\r\n        console.error('Invalid date components in birthday:', dbCustomer.birthday);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error parsing birthday:', error, dbCustomer.birthday);\r\n    }\r\n  }\r\n\r\n  return {\r\n    id: dbCustomer.id,\r\n    fullName: dbCustomer.full_name,\r\n    email: dbCustomer.email,\r\n    phoneNumber: dbCustomer.phone_number,\r\n    birthday: birthday,\r\n    location: dbCustomer.location,\r\n    categoryId: dbCustomer.category_id, // Added category mapping\r\n    socialMedia: dbCustomer.social_media as any,\r\n    gender: dbCustomer.gender,\r\n    tags: dbCustomer.tags,\r\n    notes: dbCustomer.notes,\r\n    createdAt: new Date(dbCustomer.created_at),\r\n    updatedAt: new Date(dbCustomer.updated_at)\r\n  };\r\n};\r\n\r\nexport const mapCustomerToDbCustomer = (customer: Partial<Customer>, userId: string): Partial<DbCustomer> => {\r\n  const result: Partial<DbCustomer> = {\r\n    user_id: userId\r\n  };\r\n\r\n  if (customer.id) result.id = customer.id;\r\n  if (customer.fullName) result.full_name = customer.fullName;\r\n  result.email = customer.email;\r\n  result.phone_number = customer.phoneNumber;\r\n  if (customer.birthday) result.birthday = customer.birthday.toISOString().split('T')[0];\r\n  result.location = customer.location;\r\n  result.category_id = customer.categoryId; // Added category mapping\r\n  result.social_media = customer.socialMedia as Json;\r\n  result.gender = customer.gender;\r\n  result.tags = customer.tags;\r\n  result.notes = customer.notes;\r\n\r\n  return result;\r\n};\r\n\r\n// Conversion functions for expenses\r\nexport const mapDbExpenseToExpense = (dbExpense: DbExpense): Expense => {\r\n  return {\r\n    id: dbExpense.id,\r\n    amount: Number(dbExpense.amount),\r\n    description: dbExpense.description,\r\n    category: dbExpense.category,\r\n    date: new Date(dbExpense.date),\r\n    paymentMethod: dbExpense.payment_method,\r\n    personInCharge: dbExpense.person_in_charge,\r\n    receiptImage: dbExpense.receipt_image,\r\n    cashAccountId: dbExpense.cash_account_id,\r\n    cashTransactionId: dbExpense.cash_transaction_id,\r\n    createdAt: new Date(dbExpense.created_at),\r\n    updatedAt: new Date(dbExpense.updated_at)\r\n  };\r\n};\r\n\r\nexport const mapExpenseToDbExpense = (expense: Partial<Expense>, userId: string): Partial<DbExpense> => {\r\n  const result: Partial<DbExpense> = {\r\n    user_id: userId\r\n  };\r\n\r\n  if (expense.id) result.id = expense.id;\r\n  if (expense.amount !== undefined) result.amount = expense.amount;\r\n  if (expense.description) result.description = expense.description;\r\n  result.category = expense.category;\r\n  if (expense.date) result.date = expense.date.toISOString().split('T')[0];\r\n  result.payment_method = expense.paymentMethod;\r\n  result.person_in_charge = expense.personInCharge;\r\n  result.receipt_image = expense.receiptImage;\r\n  result.cash_account_id = expense.cashAccountId;\r\n  result.cash_transaction_id = expense.cashTransactionId;\r\n\r\n  return result;\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3379, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/pages/Inventory.tsx"],"sourcesContent":["import React, { useCallback } from 'react';\r\nimport { useAuth } from '@/components/auth/AuthProvider';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\nimport { useProducts } from '@/hooks/useProducts';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { useIsMobile } from '@/hooks/use-mobile';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport InventoryStats from '@/components/inventory/InventoryStats';\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\r\nimport ProductSuggestionsPanel from '@/components/inventory/ProductSuggestionsPanel';\r\nimport { useProductSuggestions } from '@/hooks/useProductSuggestions';\r\nimport { Product } from '@/types';\r\nimport SoldItemsTab from '@/components/inventory/SoldItemsTab';\r\nimport StockSummaryTab from '@/components/inventory/StockSummaryTab';\r\nimport CSVUploadDialog from '@/components/inventory/CSVUploadDialog';\r\nimport { useBulkProducts } from '@/hooks/useBulkProducts';\r\nimport { generateProductCSVTemplate } from '@/utils/csvTemplate';\r\nimport { useCategories } from '@/hooks/useCategories';\r\nimport { useProfiles } from '@/contexts/ProfileContext';\r\nimport BulkStockAddTab from '@/components/inventory/BulkStockAddTab';\r\nimport StockCountTab from '@/components/inventory/StockCountTab';\r\nimport RequisitionTab from '@/components/inventory/RequisitionTab';\r\nimport { useSalesData } from '@/hooks/useSalesData';\r\nimport InventoryPageSkeleton from '@/components/inventory/InventoryPageSkeleton';\r\nimport InventoryHeader from '@/components/inventory/InventoryHeader';\r\nimport InventorySearchBar from '@/components/inventory/InventorySearchBar';\r\nimport TopSellingProductsCard from '@/components/inventory/TopSellingProductsCard';\r\nimport StockLevelOverviewCard from '@/components/inventory/StockLevelOverviewCard';\r\nimport { useInventoryData } from '@/hooks/useInventoryData';\r\nimport { supabase } from '@/integrations/supabase/client';\r\nimport { useGlobalInventoryStats } from '@/hooks/useGlobalInventoryStats';\r\nimport { useQueryClient } from '@tanstack/react-query';\r\n\r\n\r\n\r\nconst Inventory = () => {\r\n  const { user } = useAuth();\r\n  const { currentBusiness, isLoading: businessLoading } = useBusiness();\r\n  const { toast } = useToast();\r\n  const isMobile = useIsMobile();\r\n  const { hasPermission } = useProfiles();\r\n  const navigate = useNavigate();\r\n\r\n  const {\r\n    products,\r\n    isLoading,\r\n    isFetching,\r\n    loadProducts,\r\n    filters,\r\n    setFilters,\r\n    filteredProducts,\r\n    totalCount,\r\n    refetch\r\n  } = useProducts(user?.id);\r\n\r\n  const { categories } = useCategories(user?.id);\r\n  const { bulkCreateProducts } = useBulkProducts();\r\n  const { sales } = useSalesData(user?.id);\r\n\r\n  // Add state for CSV upload dialog\r\n  const [csvUploadOpen, setCsvUploadOpen] = React.useState(false);\r\n\r\n  // Add state for period filtering\r\n  const [period, setPeriod] = React.useState<'today' | 'yesterday' | 'this-week' | 'last-week' | 'this-month' | 'last-month' | 'all-time'>('this-month');\r\n\r\n  // Add live search state for instant suggestions without triggering DB fetches\r\n  const [liveSearch, setLiveSearch] = React.useState(filters.search || '');\r\n\r\n  // Global stats hook\r\n  const { data: globalStats, refetch: refetchGlobalStats } = useGlobalInventoryStats(currentBusiness?.id);\r\n  const queryClient = useQueryClient();\r\n\r\n  // Sync live search when filters change (e.g. on mount or from storage)\r\n  React.useEffect(() => {\r\n    setLiveSearch(filters.search || '');\r\n  }, [filters.search]);\r\n\r\n\r\n  // Real-time synchronization for global stats\r\n  React.useEffect(() => {\r\n    if (!user?.id || !currentBusiness?.id) return;\r\n\r\n    console.log('[Realtime] Subscribing to product changes for stats update');\r\n    const channel = supabase\r\n      .channel('inventory_stats_sync')\r\n      .on('postgres_changes', {\r\n        event: '*',\r\n        schema: 'public',\r\n        table: 'products',\r\n        filter: `location_id=eq.${currentBusiness.id}`\r\n      }, () => {\r\n        console.log('[Realtime] Product change detected, refreshing stats...');\r\n        queryClient.invalidateQueries({ queryKey: ['inventory_global_stats', currentBusiness.id] });\r\n      })\r\n      .subscribe();\r\n\r\n    return () => {\r\n      supabase.removeChannel(channel);\r\n    };\r\n  }, [user?.id, currentBusiness?.id]);\r\n\r\n  // Use inventory data hook\r\n  const { topSellingProducts } = useInventoryData(filteredProducts, sales, period);\r\n\r\n  // Product suggestions hook - uses liveSearch for zero lag\r\n  const {\r\n    suggestions,\r\n    isOpen: panelOpen,\r\n    openPanel,\r\n    closePanel\r\n  } = useProductSuggestions(products, liveSearch);\r\n\r\n  // Memoize handlers to prevent unnecessary re-renders\r\n  const handleRefresh = useCallback(async () => {\r\n    // Clear the specific new cache keys if we want to force EVERYTHING (optional with React Query but good for \"Refresh\" button)\r\n    queryClient.invalidateQueries({ queryKey: ['inventory_global_stats'] });\r\n    queryClient.invalidateQueries({ queryKey: ['products'] });\r\n\r\n    // Force immediate reload of global stats\r\n    await refetchGlobalStats();\r\n\r\n    // Reload products from server\r\n    await refetch();\r\n\r\n    toast({\r\n      title: \"Inventory refreshed\",\r\n      description: \"Your inventory data and stats have been updated with fresh server data.\",\r\n    });\r\n  }, [refetch, toast, refetchGlobalStats, queryClient]);\r\n\r\n\r\n  // Memoize search input changes handler - updates only liveSearch for performance\r\n  const handleSearchChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const searchValue = e.target.value;\r\n    setLiveSearch(searchValue);\r\n\r\n    // Open suggestions panel as user types\r\n    if (searchValue.length >= 1) {\r\n      openPanel();\r\n    } else {\r\n      closePanel();\r\n    }\r\n  }, [openPanel, closePanel]);\r\n\r\n  // Handle Enter key or final search submit\r\n  const handleSearchSubmit = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const searchValue = e.target.value;\r\n    setFilters({\r\n      ...filters,\r\n      search: searchValue\r\n    });\r\n\r\n    // Ensure panel is open if there's content\r\n    if (searchValue.length > 0) {\r\n      openPanel();\r\n    }\r\n  }, [filters, setFilters, openPanel]);\r\n\r\n  // Handle product selection from suggestions - navigate to product details\r\n  const handleProductSelect = (product: Product) => {\r\n    // Update live search too so the input stays in sync if it re-renders\r\n    setLiveSearch(product.name);\r\n    navigate(`/inventory/${product.id}`);\r\n    closePanel();\r\n  };\r\n\r\n  // Handle input focus for desktop search\r\n  const handleSearchFocus = useCallback(() => {\r\n    if (liveSearch) {\r\n      openPanel();\r\n    }\r\n  }, [liveSearch, openPanel]);\r\n\r\n  // Add CSV template download handler\r\n  const handleDownloadTemplate = React.useCallback(() => {\r\n    generateProductCSVTemplate();\r\n    toast({\r\n      title: \"Template downloaded\",\r\n      description: \"CSV template has been downloaded to your device.\",\r\n    });\r\n  }, [toast]);\r\n\r\n  // Add CSV upload handler\r\n  const handleCSVUpload = React.useCallback(async (products: any[]) => {\r\n    try {\r\n      await bulkCreateProducts(products);\r\n      setCsvUploadOpen(false);\r\n      await loadProducts();\r\n    } catch (error) {\r\n      console.error('CSV upload failed:', error);\r\n      toast({\r\n        title: \"Upload failed\",\r\n        description: \"There was an error uploading your products. Please try again.\",\r\n        variant: \"destructive\"\r\n      });\r\n    }\r\n  }, [bulkCreateProducts, loadProducts, toast]);\r\n\r\n  if (businessLoading || !currentBusiness || isLoading) {\r\n    return <InventoryPageSkeleton />;\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-2 md:p-6 space-y-4 md:space-y-6 max-w-full\">\r\n      {/* Header Section */}\r\n      <InventoryHeader\r\n        isLoading={isLoading}\r\n        onRefresh={handleRefresh}\r\n        onDownloadTemplate={handleDownloadTemplate}\r\n        onCSVUpload={() => setCsvUploadOpen(true)}\r\n      />\r\n\r\n      {/* CSV Upload Dialog */}\r\n      <CSVUploadDialog\r\n        open={csvUploadOpen}\r\n        onOpenChange={setCsvUploadOpen}\r\n        onUpload={handleCSVUpload}\r\n        categories={categories.map(cat => cat.name)}\r\n      />\r\n\r\n      {/* Stats Cards */}\r\n      <InventoryStats\r\n        products={products}\r\n        totalCountOverride={totalCount}\r\n        totalCostValueOverride={globalStats?.totalCostValue}\r\n        lowStockOverride={globalStats?.lowStockCount}\r\n        outOfStockOverride={globalStats?.outOfStockCount}\r\n        totalStockValueOverride={globalStats?.totalStockValue}\r\n      />\r\n\r\n      {/* Main Content with Tabs */}\r\n      <Tabs defaultValue=\"overview\" className=\"space-y-3 md:space-y-6\">\r\n        <TabsList className={`grid w-full ${isMobile ? 'grid-cols-4 gap-1' : 'grid-cols-6'} h-auto p-1`}>\r\n          <TabsTrigger value=\"overview\" className=\"text-xs md:text-sm px-1 md:px-2 py-2 min-h-[44px]\">\r\n            {isMobile ? 'Overview' : 'Overview'}\r\n          </TabsTrigger>\r\n          <TabsTrigger value=\"requisition\" className=\"text-xs md:text-sm px-1 md:px-2 py-2 min-h-[44px]\">\r\n            {isMobile ? 'Request' : 'Requisition'}\r\n          </TabsTrigger>\r\n          {hasPermission('inventory', 'stock_adjustment') && (\r\n            <>\r\n              <TabsTrigger value=\"add-stock\" className=\"text-xs md:text-sm px-1 md:px-2 py-2 min-h-[44px]\">\r\n                {isMobile ? 'Restock' : 'Restock'}\r\n              </TabsTrigger>\r\n              <TabsTrigger value=\"stock-count\" className=\"text-xs md:text-sm px-1 md:px-2 py-2 min-h-[44px]\">\r\n                {isMobile ? 'Count' : 'Stock Count'}\r\n              </TabsTrigger>\r\n            </>\r\n          )}\r\n          {!isMobile && (\r\n            <>\r\n              <TabsTrigger value=\"sold-items\" className=\"text-xs md:text-sm px-1 md:px-2 py-2 min-h-[44px]\">\r\n                Items Sold\r\n              </TabsTrigger>\r\n              <TabsTrigger value=\"stock-summary\" className=\"text-xs md:text-sm px-1 md:px-2 py-2 min-h-[44px]\">\r\n                Stock Summary\r\n              </TabsTrigger>\r\n            </>\r\n          )}\r\n        </TabsList>\r\n\r\n        {/* Mobile: Additional tabs in dropdown or secondary row */}\r\n        {isMobile && (\r\n          <div className=\"flex gap-1 overflow-x-auto pb-2\">\r\n            <TabsList className=\"grid grid-cols-2 gap-1 w-auto min-w-fit p-1\">\r\n              <TabsTrigger value=\"sold-items\" className=\"text-xs px-2 py-2 min-h-[44px] whitespace-nowrap\">\r\n                Items Sold\r\n              </TabsTrigger>\r\n              <TabsTrigger value=\"stock-summary\" className=\"text-xs px-2 py-2 min-h-[44px] whitespace-nowrap\">\r\n                Stock Summary\r\n              </TabsTrigger>\r\n            </TabsList>\r\n          </div>\r\n        )}\r\n\r\n        <TabsContent value=\"overview\" className=\"space-y-4 md:space-y-6\">\r\n          {/* Search Bar with Local Suggestions */}\r\n          <div className=\"relative\">\r\n            <InventorySearchBar\r\n              filters={filters}\r\n              setFilters={setFilters}\r\n              products={products}\r\n              onSearchChange={handleSearchChange}\r\n              onSearchSubmit={handleSearchSubmit}\r\n              onSearchFocus={handleSearchFocus}\r\n            />\r\n\r\n            {/* Mobile Suggestions Dropdown - Uses liveSearch for zero lag */}\r\n            {isMobile && (\r\n              <div className=\"absolute top-full left-0 right-0 z-50 mt-1\">\r\n                <ProductSuggestionsPanel\r\n                  suggestions={suggestions}\r\n                  isOpen={panelOpen}\r\n                  onClose={closePanel}\r\n                  onSelectProduct={handleProductSelect}\r\n                  searchTerm={liveSearch}\r\n                  isLoading={isFetching}\r\n                />\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Stock Level Overview Chart */}\r\n          <StockLevelOverviewCard products={products} />\r\n\r\n          {/* Top Selling Products */}\r\n          <TopSellingProductsCard\r\n            topSellingProducts={topSellingProducts}\r\n            period={period}\r\n            onPeriodChange={setPeriod}\r\n          />\r\n        </TabsContent>\r\n\r\n        {hasPermission('inventory', 'stock_adjustment') && (\r\n          <>\r\n            <TabsContent value=\"add-stock\">\r\n              <BulkStockAddTab />\r\n            </TabsContent>\r\n\r\n            <TabsContent value=\"stock-count\">\r\n              <StockCountTab />\r\n            </TabsContent>\r\n          </>\r\n        )}\r\n\r\n        <TabsContent value=\"requisition\">\r\n          <RequisitionTab />\r\n        </TabsContent>\r\n\r\n        <TabsContent value=\"sold-items\">\r\n          <SoldItemsTab />\r\n        </TabsContent>\r\n\r\n        <TabsContent value=\"stock-summary\">\r\n          <StockSummaryTab />\r\n        </TabsContent>\r\n      </Tabs>\r\n\r\n      {/* Desktop Product Suggestions Panel - Uses liveSearch for zero lag */}\r\n      {!isMobile && (\r\n        <ProductSuggestionsPanel\r\n          suggestions={suggestions}\r\n          isOpen={panelOpen}\r\n          onClose={closePanel}\r\n          onSelectProduct={handleProductSelect}\r\n          searchTerm={liveSearch}\r\n          isLoading={isFetching}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Inventory;\r\n"],"names":[],"mappings":"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"}}]
}