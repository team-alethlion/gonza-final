{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/app/actions/business-settings.ts"],"sourcesContent":["'use server';\r\n\r\nimport { db } from '../../../prisma/db';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\nexport async function getBusinessSettingsAction(branchId: string) {\r\n    try {\r\n        const settings = await db.branchSettings.findUnique({\r\n            where: { branchId }\r\n        });\r\n\r\n        if (!settings) {\r\n            return null;\r\n        }\r\n\r\n        return {\r\n            id: settings.id,\r\n            business_name: settings.businessName,\r\n            business_address: settings.address,\r\n            business_phone: settings.phone,\r\n            business_email: settings.email,\r\n            business_logo: settings.logo,\r\n            currency: settings.currency,\r\n            signature: settings.signatureImage,\r\n            metadata: settings.metadata || {}\r\n        };\r\n    } catch (error) {\r\n        console.error('Error fetching business settings:', error);\r\n        return null;\r\n    }\r\n}\r\n\r\nexport async function upsertBusinessSettingsAction(branchId: string, userId: string, updateData: any) {\r\n    try {\r\n        // Validate user access to branch\r\n        const branch = await db.branch.findFirst({\r\n            where: {\r\n                id: branchId,\r\n                OR: [\r\n                    { adminId: userId },\r\n                    { users: { some: { id: userId } } }\r\n                ]\r\n            }\r\n        });\r\n\r\n        if (!branch) {\r\n            return { success: false, error: 'Unauthorized to update branch settings' };\r\n        }\r\n\r\n        const data = {\r\n            businessName: updateData.business_name,\r\n            address: updateData.business_address,\r\n            phone: updateData.business_phone,\r\n            email: updateData.business_email,\r\n            logo: updateData.business_logo,\r\n            currency: updateData.currency,\r\n            signatureImage: updateData.signature,\r\n            metadata: updateData.metadata\r\n        };\r\n\r\n        const upserted = await db.branchSettings.upsert({\r\n            where: { branchId: branchId },\r\n            update: data,\r\n            create: {\r\n                branchId: branchId,\r\n                ...data\r\n            }\r\n        });\r\n\r\n        return {\r\n            success: true,\r\n            data: {\r\n                id: upserted.id,\r\n                business_name: upserted.businessName,\r\n                business_address: upserted.address,\r\n                business_phone: upserted.phone,\r\n                business_email: upserted.email,\r\n                business_logo: upserted.logo,\r\n                currency: upserted.currency,\r\n                signature: upserted.signatureImage,\r\n                metadata: upserted.metadata\r\n            }\r\n        };\r\n    } catch (error: any) {\r\n        console.error('Error upserting business settings:', error);\r\n        return { success: false, error: error.message || 'Failed to update settings' };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MAKsB,wBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA,6DAAA"}},
    {"offset": {"line": 21, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/app/actions/business-settings.ts"],"sourcesContent":["'use server';\r\n\r\nimport { db } from '../../../prisma/db';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\nexport async function getBusinessSettingsAction(branchId: string) {\r\n    try {\r\n        const settings = await db.branchSettings.findUnique({\r\n            where: { branchId }\r\n        });\r\n\r\n        if (!settings) {\r\n            return null;\r\n        }\r\n\r\n        return {\r\n            id: settings.id,\r\n            business_name: settings.businessName,\r\n            business_address: settings.address,\r\n            business_phone: settings.phone,\r\n            business_email: settings.email,\r\n            business_logo: settings.logo,\r\n            currency: settings.currency,\r\n            signature: settings.signatureImage,\r\n            metadata: settings.metadata || {}\r\n        };\r\n    } catch (error) {\r\n        console.error('Error fetching business settings:', error);\r\n        return null;\r\n    }\r\n}\r\n\r\nexport async function upsertBusinessSettingsAction(branchId: string, userId: string, updateData: any) {\r\n    try {\r\n        // Validate user access to branch\r\n        const branch = await db.branch.findFirst({\r\n            where: {\r\n                id: branchId,\r\n                OR: [\r\n                    { adminId: userId },\r\n                    { users: { some: { id: userId } } }\r\n                ]\r\n            }\r\n        });\r\n\r\n        if (!branch) {\r\n            return { success: false, error: 'Unauthorized to update branch settings' };\r\n        }\r\n\r\n        const data = {\r\n            businessName: updateData.business_name,\r\n            address: updateData.business_address,\r\n            phone: updateData.business_phone,\r\n            email: updateData.business_email,\r\n            logo: updateData.business_logo,\r\n            currency: updateData.currency,\r\n            signatureImage: updateData.signature,\r\n            metadata: updateData.metadata\r\n        };\r\n\r\n        const upserted = await db.branchSettings.upsert({\r\n            where: { branchId: branchId },\r\n            update: data,\r\n            create: {\r\n                branchId: branchId,\r\n                ...data\r\n            }\r\n        });\r\n\r\n        return {\r\n            success: true,\r\n            data: {\r\n                id: upserted.id,\r\n                business_name: upserted.businessName,\r\n                business_address: upserted.address,\r\n                business_phone: upserted.phone,\r\n                business_email: upserted.email,\r\n                business_logo: upserted.logo,\r\n                currency: upserted.currency,\r\n                signature: upserted.signatureImage,\r\n                metadata: upserted.metadata\r\n            }\r\n        };\r\n    } catch (error: any) {\r\n        console.error('Error upserting business settings:', error);\r\n        return { success: false, error: error.message || 'Failed to update settings' };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MAgCsB,wBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA,gEAAA"}},
    {"offset": {"line": 38, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/app/actions/products.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { db } from '../../../prisma/db';\r\nimport { Product, ProductFormData, mapDbProductToProduct, mapProductToDbProduct } from '@/types';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\n// We implement server actions for the products here\r\n\r\nexport async function getProductsAction({\r\n  userId,\r\n  businessId,\r\n  page,\r\n  pageSize,\r\n  search,\r\n  category,\r\n  stockStatus,\r\n}: {\r\n  userId: string;\r\n  businessId: string;\r\n  page: number;\r\n  pageSize: number;\r\n  search?: string;\r\n  category?: string;\r\n  stockStatus?: 'inStock' | 'outOfStock' | 'lowStock' | 'all';\r\n}) {\r\n  if (!userId || !businessId) return { products: [], count: 0 };\r\n\r\n  const skip = (page - 1) * pageSize;\r\n  const take = pageSize;\r\n\r\n  let whereClause: any = {\r\n    userId: userId,\r\n    branchId: businessId,\r\n  };\r\n\r\n  if (search) {\r\n    whereClause.OR = [\r\n      { name: { contains: search, mode: 'insensitive' } },\r\n      { description: { contains: search, mode: 'insensitive' } },\r\n      { sku: { contains: search, mode: 'insensitive' } },\r\n      { barcode: { contains: search, mode: 'insensitive' } },\r\n    ];\r\n  }\r\n\r\n  if (category) {\r\n    whereClause.category = { name: category };\r\n  }\r\n\r\n  if (stockStatus === 'outOfStock') {\r\n    whereClause.stock = 0;\r\n  } else if (stockStatus === 'inStock') {\r\n    whereClause.stock = { gt: 0 };\r\n  } else if (stockStatus === 'lowStock') {\r\n    // Handling lowStock is complex because minStock is compared locally or using direct SQL in Prisma\r\n    // For now, we will handle it with Prisma's raw query or by filtering in memory if necessary\r\n    // Fortunately, since PRISMA 5.0, column comparison still needs raw queries or we can fetch and filter if small\r\n    // Here we'll fetch them all if lowStock is enabled, or add a generated column. \r\n    // We will do a basic fetch and filter later if needed.\r\n  }\r\n\r\n  try {\r\n    const [productsData, totalCount] = await Promise.all([\r\n      db.product.findMany({\r\n        where: whereClause,\r\n        skip,\r\n        take,\r\n        orderBy: [{ createdAt: 'desc' }, { id: 'desc' }],\r\n        include: {\r\n          category: true,\r\n          supplier: true,\r\n        }\r\n      }),\r\n      db.product.count({ where: whereClause })\r\n    ]);\r\n\r\n    // Map the Prisma product model back to the application's Product type\r\n    let formattedProducts = productsData.map((p) => {\r\n      // Assuming mapping exists, we will map it\r\n      return {\r\n        id: p.id,\r\n        name: p.name,\r\n        description: p.description || '',\r\n        category: p.category?.name || 'Uncategorized',\r\n        quantity: p.stock,\r\n        costPrice: p.costPrice,\r\n        sellingPrice: p.sellingPrice,\r\n        supplier: p.supplier?.name,\r\n        imageUrl: p.image,\r\n        barcode: p.barcode,\r\n        itemNumber: p.sku || '',\r\n        minimumStock: p.minStock,\r\n        createdAt: p.createdAt,\r\n      };\r\n    });\r\n\r\n    if (stockStatus === 'lowStock') {\r\n      formattedProducts = formattedProducts.filter(p => p.quantity > 0 && p.quantity <= p.minimumStock);\r\n    }\r\n\r\n    return { products: formattedProducts as any[], count: totalCount };\r\n  } catch (error) {\r\n    console.error('Error fetching products from DB:', error);\r\n    return { products: [], count: 0 };\r\n  }\r\n}\r\n\r\nexport async function createProductAction(data: any) {\r\n  try {\r\n    const product = await db.product.create({\r\n      data: {\r\n        name: data.name,\r\n        description: data.description,\r\n        branchId: data.businessId,\r\n        userId: data.userId,\r\n        // Optional relations\r\n        ...(data.categoryId && { categoryId: data.categoryId }),\r\n        ...(data.supplierId && { supplierId: data.supplierId }),\r\n        sku: data.itemNumber || data.sku,\r\n        barcode: data.barcode,\r\n        image: data.imageUrl,\r\n        costPrice: data.costPrice,\r\n        sellingPrice: data.sellingPrice,\r\n        stock: data.quantity || 0,\r\n        minStock: data.minimumStock || 0,\r\n      }\r\n    });\r\n\r\n    // revalidatePath('/inventory/products');\r\n\r\n    return {\r\n      id: product.id,\r\n      name: product.name,\r\n      description: product.description || '',\r\n      category: 'Uncategorized', // Would need real mapping\r\n      quantity: product.stock,\r\n      costPrice: product.costPrice,\r\n      sellingPrice: product.sellingPrice,\r\n      imageUrl: product.image,\r\n      barcode: product.barcode,\r\n      itemNumber: product.sku || '',\r\n      minimumStock: product.minStock,\r\n      createdAt: product.createdAt,\r\n    };\r\n  } catch (error) {\r\n    console.error('Error creating product:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function updateProductAction(id: string, updates: any) {\r\n  try {\r\n    const updated = await db.product.update({\r\n      where: { id },\r\n      data: {\r\n        name: updates.name,\r\n        description: updates.description,\r\n        ...(updates.categoryId !== undefined && { categoryId: updates.categoryId }),\r\n        ...(updates.supplierId !== undefined && { supplierId: updates.supplierId }),\r\n        sku: updates.itemNumber || updates.sku,\r\n        barcode: updates.barcode,\r\n        image: updates.imageUrl,\r\n        costPrice: updates.costPrice,\r\n        sellingPrice: updates.sellingPrice,\r\n        stock: updates.quantity,\r\n        minStock: updates.minimumStock,\r\n      }\r\n    });\r\n\r\n    // revalidatePath('/inventory/products');\r\n\r\n    return updated;\r\n  } catch (error) {\r\n    console.error('Error updating product:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function deleteProductAction(id: string) {\r\n  try {\r\n    await db.product.delete({\r\n      where: { id }\r\n    });\r\n    // revalidatePath('/inventory/products');\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error deleting product:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\nexport async function updateProductsBulkAction(\r\n  updates: Array<{ id: string; updated: Partial<any> }>,\r\n  businessId: string\r\n) {\r\n  try {\r\n    // Prisma transaction for bulk updates\r\n    const updatePromises = updates.map(u =>\r\n      db.product.update({\r\n        where: { id: u.id },\r\n        data: {\r\n          ...(u.updated.name && { name: u.updated.name }),\r\n          ...(u.updated.description !== undefined && { description: u.updated.description }),\r\n          ...(u.updated.categoryId !== undefined && { categoryId: u.updated.categoryId }),\r\n          ...(u.updated.supplierId !== undefined && { supplierId: u.updated.supplierId }),\r\n          ...(u.updated.sku !== undefined && { sku: u.updated.sku }),\r\n          ...(u.updated.barcode !== undefined && { barcode: u.updated.barcode }),\r\n          ...(u.updated.costPrice !== undefined && { costPrice: u.updated.costPrice }),\r\n          ...(u.updated.sellingPrice !== undefined && { sellingPrice: u.updated.sellingPrice }),\r\n          ...(u.updated.quantity !== undefined && { stock: u.updated.quantity }),\r\n          ...(u.updated.minimumStock !== undefined && { minStock: u.updated.minimumStock }),\r\n        }\r\n      })\r\n    );\r\n\r\n    await db.$transaction(updatePromises);\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error performing bulk update:', error);\r\n    return false;\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MAQsB,wBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA,qDAAA"}},
    {"offset": {"line": 55, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/app/actions/products.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { db } from '../../../prisma/db';\r\nimport { Product, ProductFormData, mapDbProductToProduct, mapProductToDbProduct } from '@/types';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\n// We implement server actions for the products here\r\n\r\nexport async function getProductsAction({\r\n  userId,\r\n  businessId,\r\n  page,\r\n  pageSize,\r\n  search,\r\n  category,\r\n  stockStatus,\r\n}: {\r\n  userId: string;\r\n  businessId: string;\r\n  page: number;\r\n  pageSize: number;\r\n  search?: string;\r\n  category?: string;\r\n  stockStatus?: 'inStock' | 'outOfStock' | 'lowStock' | 'all';\r\n}) {\r\n  if (!userId || !businessId) return { products: [], count: 0 };\r\n\r\n  const skip = (page - 1) * pageSize;\r\n  const take = pageSize;\r\n\r\n  let whereClause: any = {\r\n    userId: userId,\r\n    branchId: businessId,\r\n  };\r\n\r\n  if (search) {\r\n    whereClause.OR = [\r\n      { name: { contains: search, mode: 'insensitive' } },\r\n      { description: { contains: search, mode: 'insensitive' } },\r\n      { sku: { contains: search, mode: 'insensitive' } },\r\n      { barcode: { contains: search, mode: 'insensitive' } },\r\n    ];\r\n  }\r\n\r\n  if (category) {\r\n    whereClause.category = { name: category };\r\n  }\r\n\r\n  if (stockStatus === 'outOfStock') {\r\n    whereClause.stock = 0;\r\n  } else if (stockStatus === 'inStock') {\r\n    whereClause.stock = { gt: 0 };\r\n  } else if (stockStatus === 'lowStock') {\r\n    // Handling lowStock is complex because minStock is compared locally or using direct SQL in Prisma\r\n    // For now, we will handle it with Prisma's raw query or by filtering in memory if necessary\r\n    // Fortunately, since PRISMA 5.0, column comparison still needs raw queries or we can fetch and filter if small\r\n    // Here we'll fetch them all if lowStock is enabled, or add a generated column. \r\n    // We will do a basic fetch and filter later if needed.\r\n  }\r\n\r\n  try {\r\n    const [productsData, totalCount] = await Promise.all([\r\n      db.product.findMany({\r\n        where: whereClause,\r\n        skip,\r\n        take,\r\n        orderBy: [{ createdAt: 'desc' }, { id: 'desc' }],\r\n        include: {\r\n          category: true,\r\n          supplier: true,\r\n        }\r\n      }),\r\n      db.product.count({ where: whereClause })\r\n    ]);\r\n\r\n    // Map the Prisma product model back to the application's Product type\r\n    let formattedProducts = productsData.map((p) => {\r\n      // Assuming mapping exists, we will map it\r\n      return {\r\n        id: p.id,\r\n        name: p.name,\r\n        description: p.description || '',\r\n        category: p.category?.name || 'Uncategorized',\r\n        quantity: p.stock,\r\n        costPrice: p.costPrice,\r\n        sellingPrice: p.sellingPrice,\r\n        supplier: p.supplier?.name,\r\n        imageUrl: p.image,\r\n        barcode: p.barcode,\r\n        itemNumber: p.sku || '',\r\n        minimumStock: p.minStock,\r\n        createdAt: p.createdAt,\r\n      };\r\n    });\r\n\r\n    if (stockStatus === 'lowStock') {\r\n      formattedProducts = formattedProducts.filter(p => p.quantity > 0 && p.quantity <= p.minimumStock);\r\n    }\r\n\r\n    return { products: formattedProducts as any[], count: totalCount };\r\n  } catch (error) {\r\n    console.error('Error fetching products from DB:', error);\r\n    return { products: [], count: 0 };\r\n  }\r\n}\r\n\r\nexport async function createProductAction(data: any) {\r\n  try {\r\n    const product = await db.product.create({\r\n      data: {\r\n        name: data.name,\r\n        description: data.description,\r\n        branchId: data.businessId,\r\n        userId: data.userId,\r\n        // Optional relations\r\n        ...(data.categoryId && { categoryId: data.categoryId }),\r\n        ...(data.supplierId && { supplierId: data.supplierId }),\r\n        sku: data.itemNumber || data.sku,\r\n        barcode: data.barcode,\r\n        image: data.imageUrl,\r\n        costPrice: data.costPrice,\r\n        sellingPrice: data.sellingPrice,\r\n        stock: data.quantity || 0,\r\n        minStock: data.minimumStock || 0,\r\n      }\r\n    });\r\n\r\n    // revalidatePath('/inventory/products');\r\n\r\n    return {\r\n      id: product.id,\r\n      name: product.name,\r\n      description: product.description || '',\r\n      category: 'Uncategorized', // Would need real mapping\r\n      quantity: product.stock,\r\n      costPrice: product.costPrice,\r\n      sellingPrice: product.sellingPrice,\r\n      imageUrl: product.image,\r\n      barcode: product.barcode,\r\n      itemNumber: product.sku || '',\r\n      minimumStock: product.minStock,\r\n      createdAt: product.createdAt,\r\n    };\r\n  } catch (error) {\r\n    console.error('Error creating product:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function updateProductAction(id: string, updates: any) {\r\n  try {\r\n    const updated = await db.product.update({\r\n      where: { id },\r\n      data: {\r\n        name: updates.name,\r\n        description: updates.description,\r\n        ...(updates.categoryId !== undefined && { categoryId: updates.categoryId }),\r\n        ...(updates.supplierId !== undefined && { supplierId: updates.supplierId }),\r\n        sku: updates.itemNumber || updates.sku,\r\n        barcode: updates.barcode,\r\n        image: updates.imageUrl,\r\n        costPrice: updates.costPrice,\r\n        sellingPrice: updates.sellingPrice,\r\n        stock: updates.quantity,\r\n        minStock: updates.minimumStock,\r\n      }\r\n    });\r\n\r\n    // revalidatePath('/inventory/products');\r\n\r\n    return updated;\r\n  } catch (error) {\r\n    console.error('Error updating product:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function deleteProductAction(id: string) {\r\n  try {\r\n    await db.product.delete({\r\n      where: { id }\r\n    });\r\n    // revalidatePath('/inventory/products');\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error deleting product:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\nexport async function updateProductsBulkAction(\r\n  updates: Array<{ id: string; updated: Partial<any> }>,\r\n  businessId: string\r\n) {\r\n  try {\r\n    // Prisma transaction for bulk updates\r\n    const updatePromises = updates.map(u =>\r\n      db.product.update({\r\n        where: { id: u.id },\r\n        data: {\r\n          ...(u.updated.name && { name: u.updated.name }),\r\n          ...(u.updated.description !== undefined && { description: u.updated.description }),\r\n          ...(u.updated.categoryId !== undefined && { categoryId: u.updated.categoryId }),\r\n          ...(u.updated.supplierId !== undefined && { supplierId: u.updated.supplierId }),\r\n          ...(u.updated.sku !== undefined && { sku: u.updated.sku }),\r\n          ...(u.updated.barcode !== undefined && { barcode: u.updated.barcode }),\r\n          ...(u.updated.costPrice !== undefined && { costPrice: u.updated.costPrice }),\r\n          ...(u.updated.sellingPrice !== undefined && { sellingPrice: u.updated.sellingPrice }),\r\n          ...(u.updated.quantity !== undefined && { stock: u.updated.quantity }),\r\n          ...(u.updated.minimumStock !== undefined && { minStock: u.updated.minimumStock }),\r\n        }\r\n      })\r\n    );\r\n\r\n    await db.$transaction(updatePromises);\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error performing bulk update:', error);\r\n    return false;\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MA0GsB,wBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA,uDAAA"}},
    {"offset": {"line": 72, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/app/actions/products.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { db } from '../../../prisma/db';\r\nimport { Product, ProductFormData, mapDbProductToProduct, mapProductToDbProduct } from '@/types';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\n// We implement server actions for the products here\r\n\r\nexport async function getProductsAction({\r\n  userId,\r\n  businessId,\r\n  page,\r\n  pageSize,\r\n  search,\r\n  category,\r\n  stockStatus,\r\n}: {\r\n  userId: string;\r\n  businessId: string;\r\n  page: number;\r\n  pageSize: number;\r\n  search?: string;\r\n  category?: string;\r\n  stockStatus?: 'inStock' | 'outOfStock' | 'lowStock' | 'all';\r\n}) {\r\n  if (!userId || !businessId) return { products: [], count: 0 };\r\n\r\n  const skip = (page - 1) * pageSize;\r\n  const take = pageSize;\r\n\r\n  let whereClause: any = {\r\n    userId: userId,\r\n    branchId: businessId,\r\n  };\r\n\r\n  if (search) {\r\n    whereClause.OR = [\r\n      { name: { contains: search, mode: 'insensitive' } },\r\n      { description: { contains: search, mode: 'insensitive' } },\r\n      { sku: { contains: search, mode: 'insensitive' } },\r\n      { barcode: { contains: search, mode: 'insensitive' } },\r\n    ];\r\n  }\r\n\r\n  if (category) {\r\n    whereClause.category = { name: category };\r\n  }\r\n\r\n  if (stockStatus === 'outOfStock') {\r\n    whereClause.stock = 0;\r\n  } else if (stockStatus === 'inStock') {\r\n    whereClause.stock = { gt: 0 };\r\n  } else if (stockStatus === 'lowStock') {\r\n    // Handling lowStock is complex because minStock is compared locally or using direct SQL in Prisma\r\n    // For now, we will handle it with Prisma's raw query or by filtering in memory if necessary\r\n    // Fortunately, since PRISMA 5.0, column comparison still needs raw queries or we can fetch and filter if small\r\n    // Here we'll fetch them all if lowStock is enabled, or add a generated column. \r\n    // We will do a basic fetch and filter later if needed.\r\n  }\r\n\r\n  try {\r\n    const [productsData, totalCount] = await Promise.all([\r\n      db.product.findMany({\r\n        where: whereClause,\r\n        skip,\r\n        take,\r\n        orderBy: [{ createdAt: 'desc' }, { id: 'desc' }],\r\n        include: {\r\n          category: true,\r\n          supplier: true,\r\n        }\r\n      }),\r\n      db.product.count({ where: whereClause })\r\n    ]);\r\n\r\n    // Map the Prisma product model back to the application's Product type\r\n    let formattedProducts = productsData.map((p) => {\r\n      // Assuming mapping exists, we will map it\r\n      return {\r\n        id: p.id,\r\n        name: p.name,\r\n        description: p.description || '',\r\n        category: p.category?.name || 'Uncategorized',\r\n        quantity: p.stock,\r\n        costPrice: p.costPrice,\r\n        sellingPrice: p.sellingPrice,\r\n        supplier: p.supplier?.name,\r\n        imageUrl: p.image,\r\n        barcode: p.barcode,\r\n        itemNumber: p.sku || '',\r\n        minimumStock: p.minStock,\r\n        createdAt: p.createdAt,\r\n      };\r\n    });\r\n\r\n    if (stockStatus === 'lowStock') {\r\n      formattedProducts = formattedProducts.filter(p => p.quantity > 0 && p.quantity <= p.minimumStock);\r\n    }\r\n\r\n    return { products: formattedProducts as any[], count: totalCount };\r\n  } catch (error) {\r\n    console.error('Error fetching products from DB:', error);\r\n    return { products: [], count: 0 };\r\n  }\r\n}\r\n\r\nexport async function createProductAction(data: any) {\r\n  try {\r\n    const product = await db.product.create({\r\n      data: {\r\n        name: data.name,\r\n        description: data.description,\r\n        branchId: data.businessId,\r\n        userId: data.userId,\r\n        // Optional relations\r\n        ...(data.categoryId && { categoryId: data.categoryId }),\r\n        ...(data.supplierId && { supplierId: data.supplierId }),\r\n        sku: data.itemNumber || data.sku,\r\n        barcode: data.barcode,\r\n        image: data.imageUrl,\r\n        costPrice: data.costPrice,\r\n        sellingPrice: data.sellingPrice,\r\n        stock: data.quantity || 0,\r\n        minStock: data.minimumStock || 0,\r\n      }\r\n    });\r\n\r\n    // revalidatePath('/inventory/products');\r\n\r\n    return {\r\n      id: product.id,\r\n      name: product.name,\r\n      description: product.description || '',\r\n      category: 'Uncategorized', // Would need real mapping\r\n      quantity: product.stock,\r\n      costPrice: product.costPrice,\r\n      sellingPrice: product.sellingPrice,\r\n      imageUrl: product.image,\r\n      barcode: product.barcode,\r\n      itemNumber: product.sku || '',\r\n      minimumStock: product.minStock,\r\n      createdAt: product.createdAt,\r\n    };\r\n  } catch (error) {\r\n    console.error('Error creating product:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function updateProductAction(id: string, updates: any) {\r\n  try {\r\n    const updated = await db.product.update({\r\n      where: { id },\r\n      data: {\r\n        name: updates.name,\r\n        description: updates.description,\r\n        ...(updates.categoryId !== undefined && { categoryId: updates.categoryId }),\r\n        ...(updates.supplierId !== undefined && { supplierId: updates.supplierId }),\r\n        sku: updates.itemNumber || updates.sku,\r\n        barcode: updates.barcode,\r\n        image: updates.imageUrl,\r\n        costPrice: updates.costPrice,\r\n        sellingPrice: updates.sellingPrice,\r\n        stock: updates.quantity,\r\n        minStock: updates.minimumStock,\r\n      }\r\n    });\r\n\r\n    // revalidatePath('/inventory/products');\r\n\r\n    return updated;\r\n  } catch (error) {\r\n    console.error('Error updating product:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function deleteProductAction(id: string) {\r\n  try {\r\n    await db.product.delete({\r\n      where: { id }\r\n    });\r\n    // revalidatePath('/inventory/products');\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error deleting product:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\nexport async function updateProductsBulkAction(\r\n  updates: Array<{ id: string; updated: Partial<any> }>,\r\n  businessId: string\r\n) {\r\n  try {\r\n    // Prisma transaction for bulk updates\r\n    const updatePromises = updates.map(u =>\r\n      db.product.update({\r\n        where: { id: u.id },\r\n        data: {\r\n          ...(u.updated.name && { name: u.updated.name }),\r\n          ...(u.updated.description !== undefined && { description: u.updated.description }),\r\n          ...(u.updated.categoryId !== undefined && { categoryId: u.updated.categoryId }),\r\n          ...(u.updated.supplierId !== undefined && { supplierId: u.updated.supplierId }),\r\n          ...(u.updated.sku !== undefined && { sku: u.updated.sku }),\r\n          ...(u.updated.barcode !== undefined && { barcode: u.updated.barcode }),\r\n          ...(u.updated.costPrice !== undefined && { costPrice: u.updated.costPrice }),\r\n          ...(u.updated.sellingPrice !== undefined && { sellingPrice: u.updated.sellingPrice }),\r\n          ...(u.updated.quantity !== undefined && { stock: u.updated.quantity }),\r\n          ...(u.updated.minimumStock !== undefined && { minStock: u.updated.minimumStock }),\r\n        }\r\n      })\r\n    );\r\n\r\n    await db.$transaction(updatePromises);\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error performing bulk update:', error);\r\n    return false;\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MAqJsB,wBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA,uDAAA"}},
    {"offset": {"line": 89, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/app/actions/products.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { db } from '../../../prisma/db';\r\nimport { Product, ProductFormData, mapDbProductToProduct, mapProductToDbProduct } from '@/types';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\n// We implement server actions for the products here\r\n\r\nexport async function getProductsAction({\r\n  userId,\r\n  businessId,\r\n  page,\r\n  pageSize,\r\n  search,\r\n  category,\r\n  stockStatus,\r\n}: {\r\n  userId: string;\r\n  businessId: string;\r\n  page: number;\r\n  pageSize: number;\r\n  search?: string;\r\n  category?: string;\r\n  stockStatus?: 'inStock' | 'outOfStock' | 'lowStock' | 'all';\r\n}) {\r\n  if (!userId || !businessId) return { products: [], count: 0 };\r\n\r\n  const skip = (page - 1) * pageSize;\r\n  const take = pageSize;\r\n\r\n  let whereClause: any = {\r\n    userId: userId,\r\n    branchId: businessId,\r\n  };\r\n\r\n  if (search) {\r\n    whereClause.OR = [\r\n      { name: { contains: search, mode: 'insensitive' } },\r\n      { description: { contains: search, mode: 'insensitive' } },\r\n      { sku: { contains: search, mode: 'insensitive' } },\r\n      { barcode: { contains: search, mode: 'insensitive' } },\r\n    ];\r\n  }\r\n\r\n  if (category) {\r\n    whereClause.category = { name: category };\r\n  }\r\n\r\n  if (stockStatus === 'outOfStock') {\r\n    whereClause.stock = 0;\r\n  } else if (stockStatus === 'inStock') {\r\n    whereClause.stock = { gt: 0 };\r\n  } else if (stockStatus === 'lowStock') {\r\n    // Handling lowStock is complex because minStock is compared locally or using direct SQL in Prisma\r\n    // For now, we will handle it with Prisma's raw query or by filtering in memory if necessary\r\n    // Fortunately, since PRISMA 5.0, column comparison still needs raw queries or we can fetch and filter if small\r\n    // Here we'll fetch them all if lowStock is enabled, or add a generated column. \r\n    // We will do a basic fetch and filter later if needed.\r\n  }\r\n\r\n  try {\r\n    const [productsData, totalCount] = await Promise.all([\r\n      db.product.findMany({\r\n        where: whereClause,\r\n        skip,\r\n        take,\r\n        orderBy: [{ createdAt: 'desc' }, { id: 'desc' }],\r\n        include: {\r\n          category: true,\r\n          supplier: true,\r\n        }\r\n      }),\r\n      db.product.count({ where: whereClause })\r\n    ]);\r\n\r\n    // Map the Prisma product model back to the application's Product type\r\n    let formattedProducts = productsData.map((p) => {\r\n      // Assuming mapping exists, we will map it\r\n      return {\r\n        id: p.id,\r\n        name: p.name,\r\n        description: p.description || '',\r\n        category: p.category?.name || 'Uncategorized',\r\n        quantity: p.stock,\r\n        costPrice: p.costPrice,\r\n        sellingPrice: p.sellingPrice,\r\n        supplier: p.supplier?.name,\r\n        imageUrl: p.image,\r\n        barcode: p.barcode,\r\n        itemNumber: p.sku || '',\r\n        minimumStock: p.minStock,\r\n        createdAt: p.createdAt,\r\n      };\r\n    });\r\n\r\n    if (stockStatus === 'lowStock') {\r\n      formattedProducts = formattedProducts.filter(p => p.quantity > 0 && p.quantity <= p.minimumStock);\r\n    }\r\n\r\n    return { products: formattedProducts as any[], count: totalCount };\r\n  } catch (error) {\r\n    console.error('Error fetching products from DB:', error);\r\n    return { products: [], count: 0 };\r\n  }\r\n}\r\n\r\nexport async function createProductAction(data: any) {\r\n  try {\r\n    const product = await db.product.create({\r\n      data: {\r\n        name: data.name,\r\n        description: data.description,\r\n        branchId: data.businessId,\r\n        userId: data.userId,\r\n        // Optional relations\r\n        ...(data.categoryId && { categoryId: data.categoryId }),\r\n        ...(data.supplierId && { supplierId: data.supplierId }),\r\n        sku: data.itemNumber || data.sku,\r\n        barcode: data.barcode,\r\n        image: data.imageUrl,\r\n        costPrice: data.costPrice,\r\n        sellingPrice: data.sellingPrice,\r\n        stock: data.quantity || 0,\r\n        minStock: data.minimumStock || 0,\r\n      }\r\n    });\r\n\r\n    // revalidatePath('/inventory/products');\r\n\r\n    return {\r\n      id: product.id,\r\n      name: product.name,\r\n      description: product.description || '',\r\n      category: 'Uncategorized', // Would need real mapping\r\n      quantity: product.stock,\r\n      costPrice: product.costPrice,\r\n      sellingPrice: product.sellingPrice,\r\n      imageUrl: product.image,\r\n      barcode: product.barcode,\r\n      itemNumber: product.sku || '',\r\n      minimumStock: product.minStock,\r\n      createdAt: product.createdAt,\r\n    };\r\n  } catch (error) {\r\n    console.error('Error creating product:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function updateProductAction(id: string, updates: any) {\r\n  try {\r\n    const updated = await db.product.update({\r\n      where: { id },\r\n      data: {\r\n        name: updates.name,\r\n        description: updates.description,\r\n        ...(updates.categoryId !== undefined && { categoryId: updates.categoryId }),\r\n        ...(updates.supplierId !== undefined && { supplierId: updates.supplierId }),\r\n        sku: updates.itemNumber || updates.sku,\r\n        barcode: updates.barcode,\r\n        image: updates.imageUrl,\r\n        costPrice: updates.costPrice,\r\n        sellingPrice: updates.sellingPrice,\r\n        stock: updates.quantity,\r\n        minStock: updates.minimumStock,\r\n      }\r\n    });\r\n\r\n    // revalidatePath('/inventory/products');\r\n\r\n    return updated;\r\n  } catch (error) {\r\n    console.error('Error updating product:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function deleteProductAction(id: string) {\r\n  try {\r\n    await db.product.delete({\r\n      where: { id }\r\n    });\r\n    // revalidatePath('/inventory/products');\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error deleting product:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\nexport async function updateProductsBulkAction(\r\n  updates: Array<{ id: string; updated: Partial<any> }>,\r\n  businessId: string\r\n) {\r\n  try {\r\n    // Prisma transaction for bulk updates\r\n    const updatePromises = updates.map(u =>\r\n      db.product.update({\r\n        where: { id: u.id },\r\n        data: {\r\n          ...(u.updated.name && { name: u.updated.name }),\r\n          ...(u.updated.description !== undefined && { description: u.updated.description }),\r\n          ...(u.updated.categoryId !== undefined && { categoryId: u.updated.categoryId }),\r\n          ...(u.updated.supplierId !== undefined && { supplierId: u.updated.supplierId }),\r\n          ...(u.updated.sku !== undefined && { sku: u.updated.sku }),\r\n          ...(u.updated.barcode !== undefined && { barcode: u.updated.barcode }),\r\n          ...(u.updated.costPrice !== undefined && { costPrice: u.updated.costPrice }),\r\n          ...(u.updated.sellingPrice !== undefined && { sellingPrice: u.updated.sellingPrice }),\r\n          ...(u.updated.quantity !== undefined && { stock: u.updated.quantity }),\r\n          ...(u.updated.minimumStock !== undefined && { minStock: u.updated.minimumStock }),\r\n        }\r\n      })\r\n    );\r\n\r\n    await db.$transaction(updatePromises);\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error performing bulk update:', error);\r\n    return false;\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MAiLsB,wBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA,uDAAA"}},
    {"offset": {"line": 106, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/app/actions/products.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { db } from '../../../prisma/db';\r\nimport { Product, ProductFormData, mapDbProductToProduct, mapProductToDbProduct } from '@/types';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\n// We implement server actions for the products here\r\n\r\nexport async function getProductsAction({\r\n  userId,\r\n  businessId,\r\n  page,\r\n  pageSize,\r\n  search,\r\n  category,\r\n  stockStatus,\r\n}: {\r\n  userId: string;\r\n  businessId: string;\r\n  page: number;\r\n  pageSize: number;\r\n  search?: string;\r\n  category?: string;\r\n  stockStatus?: 'inStock' | 'outOfStock' | 'lowStock' | 'all';\r\n}) {\r\n  if (!userId || !businessId) return { products: [], count: 0 };\r\n\r\n  const skip = (page - 1) * pageSize;\r\n  const take = pageSize;\r\n\r\n  let whereClause: any = {\r\n    userId: userId,\r\n    branchId: businessId,\r\n  };\r\n\r\n  if (search) {\r\n    whereClause.OR = [\r\n      { name: { contains: search, mode: 'insensitive' } },\r\n      { description: { contains: search, mode: 'insensitive' } },\r\n      { sku: { contains: search, mode: 'insensitive' } },\r\n      { barcode: { contains: search, mode: 'insensitive' } },\r\n    ];\r\n  }\r\n\r\n  if (category) {\r\n    whereClause.category = { name: category };\r\n  }\r\n\r\n  if (stockStatus === 'outOfStock') {\r\n    whereClause.stock = 0;\r\n  } else if (stockStatus === 'inStock') {\r\n    whereClause.stock = { gt: 0 };\r\n  } else if (stockStatus === 'lowStock') {\r\n    // Handling lowStock is complex because minStock is compared locally or using direct SQL in Prisma\r\n    // For now, we will handle it with Prisma's raw query or by filtering in memory if necessary\r\n    // Fortunately, since PRISMA 5.0, column comparison still needs raw queries or we can fetch and filter if small\r\n    // Here we'll fetch them all if lowStock is enabled, or add a generated column. \r\n    // We will do a basic fetch and filter later if needed.\r\n  }\r\n\r\n  try {\r\n    const [productsData, totalCount] = await Promise.all([\r\n      db.product.findMany({\r\n        where: whereClause,\r\n        skip,\r\n        take,\r\n        orderBy: [{ createdAt: 'desc' }, { id: 'desc' }],\r\n        include: {\r\n          category: true,\r\n          supplier: true,\r\n        }\r\n      }),\r\n      db.product.count({ where: whereClause })\r\n    ]);\r\n\r\n    // Map the Prisma product model back to the application's Product type\r\n    let formattedProducts = productsData.map((p) => {\r\n      // Assuming mapping exists, we will map it\r\n      return {\r\n        id: p.id,\r\n        name: p.name,\r\n        description: p.description || '',\r\n        category: p.category?.name || 'Uncategorized',\r\n        quantity: p.stock,\r\n        costPrice: p.costPrice,\r\n        sellingPrice: p.sellingPrice,\r\n        supplier: p.supplier?.name,\r\n        imageUrl: p.image,\r\n        barcode: p.barcode,\r\n        itemNumber: p.sku || '',\r\n        minimumStock: p.minStock,\r\n        createdAt: p.createdAt,\r\n      };\r\n    });\r\n\r\n    if (stockStatus === 'lowStock') {\r\n      formattedProducts = formattedProducts.filter(p => p.quantity > 0 && p.quantity <= p.minimumStock);\r\n    }\r\n\r\n    return { products: formattedProducts as any[], count: totalCount };\r\n  } catch (error) {\r\n    console.error('Error fetching products from DB:', error);\r\n    return { products: [], count: 0 };\r\n  }\r\n}\r\n\r\nexport async function createProductAction(data: any) {\r\n  try {\r\n    const product = await db.product.create({\r\n      data: {\r\n        name: data.name,\r\n        description: data.description,\r\n        branchId: data.businessId,\r\n        userId: data.userId,\r\n        // Optional relations\r\n        ...(data.categoryId && { categoryId: data.categoryId }),\r\n        ...(data.supplierId && { supplierId: data.supplierId }),\r\n        sku: data.itemNumber || data.sku,\r\n        barcode: data.barcode,\r\n        image: data.imageUrl,\r\n        costPrice: data.costPrice,\r\n        sellingPrice: data.sellingPrice,\r\n        stock: data.quantity || 0,\r\n        minStock: data.minimumStock || 0,\r\n      }\r\n    });\r\n\r\n    // revalidatePath('/inventory/products');\r\n\r\n    return {\r\n      id: product.id,\r\n      name: product.name,\r\n      description: product.description || '',\r\n      category: 'Uncategorized', // Would need real mapping\r\n      quantity: product.stock,\r\n      costPrice: product.costPrice,\r\n      sellingPrice: product.sellingPrice,\r\n      imageUrl: product.image,\r\n      barcode: product.barcode,\r\n      itemNumber: product.sku || '',\r\n      minimumStock: product.minStock,\r\n      createdAt: product.createdAt,\r\n    };\r\n  } catch (error) {\r\n    console.error('Error creating product:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function updateProductAction(id: string, updates: any) {\r\n  try {\r\n    const updated = await db.product.update({\r\n      where: { id },\r\n      data: {\r\n        name: updates.name,\r\n        description: updates.description,\r\n        ...(updates.categoryId !== undefined && { categoryId: updates.categoryId }),\r\n        ...(updates.supplierId !== undefined && { supplierId: updates.supplierId }),\r\n        sku: updates.itemNumber || updates.sku,\r\n        barcode: updates.barcode,\r\n        image: updates.imageUrl,\r\n        costPrice: updates.costPrice,\r\n        sellingPrice: updates.sellingPrice,\r\n        stock: updates.quantity,\r\n        minStock: updates.minimumStock,\r\n      }\r\n    });\r\n\r\n    // revalidatePath('/inventory/products');\r\n\r\n    return updated;\r\n  } catch (error) {\r\n    console.error('Error updating product:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function deleteProductAction(id: string) {\r\n  try {\r\n    await db.product.delete({\r\n      where: { id }\r\n    });\r\n    // revalidatePath('/inventory/products');\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error deleting product:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\nexport async function updateProductsBulkAction(\r\n  updates: Array<{ id: string; updated: Partial<any> }>,\r\n  businessId: string\r\n) {\r\n  try {\r\n    // Prisma transaction for bulk updates\r\n    const updatePromises = updates.map(u =>\r\n      db.product.update({\r\n        where: { id: u.id },\r\n        data: {\r\n          ...(u.updated.name && { name: u.updated.name }),\r\n          ...(u.updated.description !== undefined && { description: u.updated.description }),\r\n          ...(u.updated.categoryId !== undefined && { categoryId: u.updated.categoryId }),\r\n          ...(u.updated.supplierId !== undefined && { supplierId: u.updated.supplierId }),\r\n          ...(u.updated.sku !== undefined && { sku: u.updated.sku }),\r\n          ...(u.updated.barcode !== undefined && { barcode: u.updated.barcode }),\r\n          ...(u.updated.costPrice !== undefined && { costPrice: u.updated.costPrice }),\r\n          ...(u.updated.sellingPrice !== undefined && { sellingPrice: u.updated.sellingPrice }),\r\n          ...(u.updated.quantity !== undefined && { stock: u.updated.quantity }),\r\n          ...(u.updated.minimumStock !== undefined && { minStock: u.updated.minimumStock }),\r\n        }\r\n      })\r\n    );\r\n\r\n    await db.$transaction(updatePromises);\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error performing bulk update:', error);\r\n    return false;\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MA8LsB,wBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA,4DAAA"}},
    {"offset": {"line": 123, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/app/actions/sales.ts"],"sourcesContent":["'use server';\r\n\r\nimport { db } from '../../../prisma/db';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\nexport async function getSalesAction(businessId: string, sortOrder: 'asc' | 'desc' = 'desc', pageSize?: number) {\r\n    try {\r\n        const queryOptions: any = {\r\n            where: {\r\n                branchId: businessId,\r\n            },\r\n            orderBy: {\r\n                createdAt: sortOrder,\r\n            },\r\n            include: {\r\n                cashTransaction: true,\r\n            }\r\n        };\r\n\r\n        if (pageSize && pageSize > 0) {\r\n            queryOptions.take = pageSize;\r\n        }\r\n\r\n        const sales = await db.sale.findMany(queryOptions);\r\n\r\n        // Provide default mappings to existing React components\r\n        return sales.map((item: any) => ({\r\n            id: item.id,\r\n            user_id: item.userId,\r\n            location_id: item.branchId,\r\n            receipt_number: item.receiptNumber,\r\n            customer_name: item.customerName,\r\n            customer_address: item.customerAddress,\r\n            customer_contact: item.customerContact,\r\n            customer_id: item.customerId,\r\n            items: item.items as any, // jsonb type\r\n            payment_status: item.paymentStatus,\r\n            profit: item.profit,\r\n            date: item.date.toISOString(),\r\n            tax_rate: item.taxRate ? Number(item.taxRate) : 0,\r\n            created_at: item.createdAt.toISOString(),\r\n            updated_at: item.updatedAt.toISOString(),\r\n            cash_transaction_id: item.cashTransactionId,\r\n            amount_paid: item.amountPaid,\r\n            amount_due: item.amountDue,\r\n            category_id: item.categoryId,\r\n            notes: item.notes\r\n        }));\r\n    } catch (error) {\r\n        console.error('Error fetching sales:', error);\r\n        return [];\r\n    }\r\n}\r\n\r\nexport async function deleteSaleAction(id: string, businessId: string) {\r\n    try {\r\n        const sale = await db.sale.findUnique({\r\n            where: { id },\r\n            include: { cashTransaction: true, installments: true }\r\n        });\r\n\r\n        if (!sale || sale.branchId !== businessId) {\r\n            return { success: false, error: 'Sale not found or unauthorized' };\r\n        }\r\n\r\n        // Delete installments\r\n        if (sale.installments && sale.installments.length > 0) {\r\n            await db.installmentPayment.deleteMany({\r\n                where: { saleId: id }\r\n            });\r\n        }\r\n\r\n        // Delete associated cash transaction\r\n        if (sale.cashTransactionId) {\r\n            await db.cashTransaction.delete({\r\n                where: { id: sale.cashTransactionId }\r\n            });\r\n        }\r\n\r\n        // Delete the sale itself\r\n        await db.sale.delete({\r\n            where: { id }\r\n        });\r\n\r\n        return {\r\n            success: true,\r\n            sale: {\r\n                receiptNumber: sale.receiptNumber,\r\n                customerName: sale.customerName,\r\n                customerAddress: sale.customerAddress,\r\n                customerContact: sale.customerContact,\r\n                paymentStatus: sale.paymentStatus,\r\n                cashTransactionId: sale.cashTransactionId,\r\n                items: sale.items as any,\r\n                amountPaid: sale.amountPaid,\r\n                amountDue: sale.amountDue,\r\n                profit: sale.profit,\r\n                taxRate: sale.taxRate,\r\n                notes: sale.notes\r\n            }\r\n        };\r\n    } catch (error) {\r\n        console.error('Error deleting sale:', error);\r\n        return { success: false, error: 'Failed to delete sale' };\r\n    }\r\n}\r\n\r\nexport async function upsertSaleAction(saleDbData: any, isUpdate: boolean, updateId?: string) {\r\n    try {\r\n        const prismaData = {\r\n            userId: saleDbData.user_id,\r\n            branchId: saleDbData.location_id,\r\n            receiptNumber: saleDbData.receipt_number,\r\n            customerName: saleDbData.customer_name,\r\n            customerAddress: saleDbData.customer_address,\r\n            customerContact: saleDbData.customer_contact,\r\n            customerId: saleDbData.customer_id,\r\n            items: saleDbData.items,\r\n            paymentStatus: saleDbData.payment_status,\r\n            profit: saleDbData.profit,\r\n            date: new Date(saleDbData.date),\r\n            taxRate: saleDbData.tax_rate,\r\n            cashTransactionId: saleDbData.cash_transaction_id,\r\n            amountPaid: saleDbData.amount_paid,\r\n            amountDue: saleDbData.amount_due,\r\n            categoryId: saleDbData.category_id,\r\n            notes: saleDbData.notes\r\n        };\r\n\r\n        if (isUpdate && updateId) {\r\n            const updated = await db.sale.update({\r\n                where: { id: updateId },\r\n                data: prismaData\r\n            });\r\n            return { success: true, data: updated };\r\n        } else {\r\n            const created = await db.sale.create({\r\n                data: prismaData\r\n            });\r\n            return { success: true, data: created };\r\n        }\r\n    } catch (error: any) {\r\n        console.error('Error upserting sale:', error);\r\n        return { success: false, error: error.message || 'Failed to preserve sale' };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MAKsB,wBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA,kDAAA"}},
    {"offset": {"line": 140, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/app/actions/sales.ts"],"sourcesContent":["'use server';\r\n\r\nimport { db } from '../../../prisma/db';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\nexport async function getSalesAction(businessId: string, sortOrder: 'asc' | 'desc' = 'desc', pageSize?: number) {\r\n    try {\r\n        const queryOptions: any = {\r\n            where: {\r\n                branchId: businessId,\r\n            },\r\n            orderBy: {\r\n                createdAt: sortOrder,\r\n            },\r\n            include: {\r\n                cashTransaction: true,\r\n            }\r\n        };\r\n\r\n        if (pageSize && pageSize > 0) {\r\n            queryOptions.take = pageSize;\r\n        }\r\n\r\n        const sales = await db.sale.findMany(queryOptions);\r\n\r\n        // Provide default mappings to existing React components\r\n        return sales.map((item: any) => ({\r\n            id: item.id,\r\n            user_id: item.userId,\r\n            location_id: item.branchId,\r\n            receipt_number: item.receiptNumber,\r\n            customer_name: item.customerName,\r\n            customer_address: item.customerAddress,\r\n            customer_contact: item.customerContact,\r\n            customer_id: item.customerId,\r\n            items: item.items as any, // jsonb type\r\n            payment_status: item.paymentStatus,\r\n            profit: item.profit,\r\n            date: item.date.toISOString(),\r\n            tax_rate: item.taxRate ? Number(item.taxRate) : 0,\r\n            created_at: item.createdAt.toISOString(),\r\n            updated_at: item.updatedAt.toISOString(),\r\n            cash_transaction_id: item.cashTransactionId,\r\n            amount_paid: item.amountPaid,\r\n            amount_due: item.amountDue,\r\n            category_id: item.categoryId,\r\n            notes: item.notes\r\n        }));\r\n    } catch (error) {\r\n        console.error('Error fetching sales:', error);\r\n        return [];\r\n    }\r\n}\r\n\r\nexport async function deleteSaleAction(id: string, businessId: string) {\r\n    try {\r\n        const sale = await db.sale.findUnique({\r\n            where: { id },\r\n            include: { cashTransaction: true, installments: true }\r\n        });\r\n\r\n        if (!sale || sale.branchId !== businessId) {\r\n            return { success: false, error: 'Sale not found or unauthorized' };\r\n        }\r\n\r\n        // Delete installments\r\n        if (sale.installments && sale.installments.length > 0) {\r\n            await db.installmentPayment.deleteMany({\r\n                where: { saleId: id }\r\n            });\r\n        }\r\n\r\n        // Delete associated cash transaction\r\n        if (sale.cashTransactionId) {\r\n            await db.cashTransaction.delete({\r\n                where: { id: sale.cashTransactionId }\r\n            });\r\n        }\r\n\r\n        // Delete the sale itself\r\n        await db.sale.delete({\r\n            where: { id }\r\n        });\r\n\r\n        return {\r\n            success: true,\r\n            sale: {\r\n                receiptNumber: sale.receiptNumber,\r\n                customerName: sale.customerName,\r\n                customerAddress: sale.customerAddress,\r\n                customerContact: sale.customerContact,\r\n                paymentStatus: sale.paymentStatus,\r\n                cashTransactionId: sale.cashTransactionId,\r\n                items: sale.items as any,\r\n                amountPaid: sale.amountPaid,\r\n                amountDue: sale.amountDue,\r\n                profit: sale.profit,\r\n                taxRate: sale.taxRate,\r\n                notes: sale.notes\r\n            }\r\n        };\r\n    } catch (error) {\r\n        console.error('Error deleting sale:', error);\r\n        return { success: false, error: 'Failed to delete sale' };\r\n    }\r\n}\r\n\r\nexport async function upsertSaleAction(saleDbData: any, isUpdate: boolean, updateId?: string) {\r\n    try {\r\n        const prismaData = {\r\n            userId: saleDbData.user_id,\r\n            branchId: saleDbData.location_id,\r\n            receiptNumber: saleDbData.receipt_number,\r\n            customerName: saleDbData.customer_name,\r\n            customerAddress: saleDbData.customer_address,\r\n            customerContact: saleDbData.customer_contact,\r\n            customerId: saleDbData.customer_id,\r\n            items: saleDbData.items,\r\n            paymentStatus: saleDbData.payment_status,\r\n            profit: saleDbData.profit,\r\n            date: new Date(saleDbData.date),\r\n            taxRate: saleDbData.tax_rate,\r\n            cashTransactionId: saleDbData.cash_transaction_id,\r\n            amountPaid: saleDbData.amount_paid,\r\n            amountDue: saleDbData.amount_due,\r\n            categoryId: saleDbData.category_id,\r\n            notes: saleDbData.notes\r\n        };\r\n\r\n        if (isUpdate && updateId) {\r\n            const updated = await db.sale.update({\r\n                where: { id: updateId },\r\n                data: prismaData\r\n            });\r\n            return { success: true, data: updated };\r\n        } else {\r\n            const created = await db.sale.create({\r\n                data: prismaData\r\n            });\r\n            return { success: true, data: created };\r\n        }\r\n    } catch (error: any) {\r\n        console.error('Error upserting sale:', error);\r\n        return { success: false, error: error.message || 'Failed to preserve sale' };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MAsDsB,wBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA,oDAAA"}},
    {"offset": {"line": 157, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/types/index.ts"],"sourcesContent":["// Sale item type definition\r\nexport interface SaleItem {\r\n  description: string;\r\n  quantity: number;\r\n  price: number;\r\n  cost: number;\r\n  productId?: string;\r\n  discountPercentage?: number;\r\n  discountType?: 'percentage' | 'amount';\r\n  discountAmount?: number;\r\n}\r\n\r\nexport interface SalesCategory {\r\n  id: string;\r\n  user_id: string;\r\n  location_id?: string;\r\n  name: string;\r\n  is_default: boolean;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface Sale {\r\n  id: string;\r\n  receiptNumber: string;\r\n  customerName: string;\r\n  customerAddress?: string;\r\n  customerContact?: string;\r\n  customerId?: string;\r\n  items: SaleItem[];\r\n  paymentStatus: 'Paid' | 'NOT PAID' | 'Quote' | 'Installment Sale';\r\n  profit: number;\r\n  date: Date;\r\n  taxRate?: number;\r\n  cashTransactionId?: string;\r\n  amountPaid?: number;\r\n  amountDue?: number;\r\n  notes?: string;\r\n  categoryId?: string;\r\n  installments?: Array<{\r\n    date?: string | Date;\r\n    amountPaid?: number;\r\n  }>;\r\n  createdAt: Date;\r\n}\r\n\r\n// Supabase database schema and Json type\r\nexport type Json =\r\n  | string\r\n  | number\r\n  | boolean\r\n  | null\r\n  | { [key: string]: Json | undefined }\r\n  | Json[];\r\n\r\n// Supabase database sale structure\r\nexport interface DbSale {\r\n  id: string;\r\n  user_id: string;\r\n  location_id: string;\r\n  receipt_number: string;\r\n  customer_name: string;\r\n  customer_address?: string | null;\r\n  customer_contact?: string | null;\r\n  customer_id?: string | null;\r\n  items: Json;\r\n  payment_status: string;\r\n  profit: number;\r\n  date: string;\r\n  tax_rate?: number | null;\r\n  created_at: string;\r\n  updated_at: string;\r\n  cash_transaction_id?: string | null;\r\n  amount_paid?: number | null;\r\n  amount_due?: number | null;\r\n  notes?: string | null;\r\n  category_id?: string | null;\r\n}\r\n\r\n// Expense interface - add cashTransactionId field\r\nexport interface Expense {\r\n  id: string;\r\n  amount: number;\r\n  description: string;\r\n  category: string | null;\r\n  date: Date;\r\n  paymentMethod: string | null;\r\n  personInCharge: string | null;\r\n  receiptImage: string | null;\r\n  cashAccountId: string | null;\r\n  cashTransactionId: string | null; // Add this field\r\n  createdAt: Date;\r\n  updatedAt: Date;\r\n}\r\n\r\n// Supabase database expense structure\r\nexport interface DbExpense {\r\n  id: string;\r\n  user_id: string;\r\n  amount: number;\r\n  description: string;\r\n  category: string | null;\r\n  date: string;\r\n  payment_method: string | null;\r\n  person_in_charge: string | null;\r\n  receipt_image: string | null;\r\n  cash_account_id: string | null;\r\n  cash_transaction_id: string | null; // Add this field\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface SaleFormData {\r\n  customerName: string;\r\n  customerAddress: string;\r\n  customerContact: string;\r\n  customerId?: string; // Added customerId field\r\n  items: SaleItem[];\r\n  paymentStatus: \"Paid\" | \"NOT PAID\" | \"Quote\" | \"Installment Sale\";\r\n  receiptNumber?: string;\r\n  taxRate?: number | null;\r\n  amountPaid?: number;\r\n  amountDue?: number;\r\n  notes?: string;\r\n  categoryId?: string;\r\n}\r\n\r\n// Analytics data type\r\nexport interface AnalyticsData {\r\n  totalSales: number;\r\n  totalProfit: number;\r\n  totalCost: number;\r\n  paidSalesCount: number;\r\n  pendingSalesCount: number;\r\n}\r\n\r\n// Form validation errors\r\nexport interface FormErrors {\r\n  customerName?: string;\r\n  customerAddress?: string;\r\n  customerContact?: string;\r\n  itemDescription?: string;\r\n  quantity?: string;\r\n  salePrice?: string;\r\n  costOfProduction?: string;\r\n  taxRate?: string;\r\n}\r\n\r\n// BusinessSettings interface to include paymentInfo\r\nexport interface BusinessSettings {\r\n  businessName: string;\r\n  businessAddress: string;\r\n  businessPhone: string;\r\n  businessEmail: string;\r\n  businessLogo?: string;\r\n  currency: string;\r\n  signature?: string;\r\n  paymentInfo?: string; // Added payment information field\r\n  defaultPrintFormat?: 'standard' | 'thermal'; // Added default print format\r\n  defaultPrinterName?: string; // Added default printer name\r\n  defaultPrinterType?: 'USB' | 'Bluetooth'; // Added default printer type\r\n}\r\n\r\n// Database business settings structure\r\nexport interface DbBusinessSettings {\r\n  id?: string;\r\n  user_id: string; // Make sure this is required, not optional\r\n  business_name: string;\r\n  business_address: string;\r\n  business_phone: string;\r\n  business_email: string;\r\n  business_logo?: string;\r\n  currency: string;\r\n  signature?: string;\r\n  metadata?: Json | null; // Add metadata field\r\n  created_at?: string;\r\n  updated_at?: string;\r\n}\r\n\r\n// Updated UserProfile interface to match the Supabase database structure\r\nexport interface UserProfile {\r\n  id: string;\r\n  full_name: string | null;\r\n  display_name: string | null;\r\n  avatar_url: string | null;\r\n  created_at: string | null;\r\n  updated_at: string | null;\r\n}\r\n\r\n// New interfaces for Product management - ADDED itemNumber\r\nexport interface Product {\r\n  id: string;\r\n  itemNumber: string; // Added item number field\r\n  barcode: string | null; // Added barcode field\r\n  manufacturerBarcode: string | null; // Added manufacturer barcode field\r\n  name: string;\r\n  description: string | null;\r\n  category: string;\r\n  quantity: number;\r\n  costPrice: number;\r\n  sellingPrice: number;\r\n  supplier: string | null;\r\n  imageUrl: string | null;\r\n  minimumStock: number;\r\n  createdAt: Date;\r\n  updatedAt: Date;\r\n}\r\n\r\nexport interface DbProduct {\r\n  id: string;\r\n  user_id: string;\r\n  item_number: string; // Added item number field\r\n  barcode: string | null; // Added barcode field\r\n  manufacturer_barcode: string | null; // Added manufacturer barcode field\r\n  name: string;\r\n  description: string | null;\r\n  category: string;\r\n  quantity: number;\r\n  cost_price: number;\r\n  selling_price: number;\r\n  supplier: string | null;\r\n  image_url: string | null;\r\n  minimum_stock: number;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface ProductFormData {\r\n  name: string;\r\n  barcode?: string; // Added barcode field\r\n  manufacturerBarcode?: string; // Added manufacturer barcode field\r\n  description?: string;\r\n  category?: string;\r\n  quantity: number; // Always a number, never undefined\r\n  costPrice?: number;\r\n  sellingPrice?: number;\r\n  supplier?: string;\r\n  minimumStock?: number;\r\n  imageFile?: File | null;\r\n  imageUrl?: string | null;\r\n  createdAt?: Date; // Added created date field\r\n}\r\n\r\nexport interface ProductCategory {\r\n  id: string;\r\n  name: string;\r\n}\r\n\r\nexport interface DbProductCategory {\r\n  id: string;\r\n  user_id: string;\r\n  name: string;\r\n  created_at: string;\r\n}\r\n\r\nexport interface StockHistoryEntry {\r\n  id: string;\r\n  productId: string;\r\n  oldQuantity: number;\r\n  newQuantity: number;\r\n  changeReason: string;\r\n  referenceId?: string | null;\r\n  receiptNumber?: string;\r\n  createdAt: Date;\r\n  product?: {\r\n    name: string;\r\n    costPrice: number;\r\n    sellingPrice: number;\r\n    itemNumber: string;\r\n  };\r\n}\r\n\r\nexport interface DbStockHistoryEntry {\r\n  id: string;\r\n  user_id: string;\r\n  product_id: string;\r\n  previous_quantity: number;\r\n  new_quantity: number;\r\n  change_reason: string;\r\n  reference_id?: string | null;\r\n  created_at: string;\r\n}\r\n\r\nexport interface ProductFilters {\r\n  search: string;\r\n  category: string;\r\n  stockStatus: 'all' | 'inStock' | 'lowStock' | 'outOfStock';\r\n}\r\n\r\n// Customer management types\r\nexport interface Customer {\r\n  id: string;\r\n  fullName: string;\r\n  email: string | null;\r\n  phoneNumber: string | null;\r\n  birthday: Date | null;\r\n  location: string | null;\r\n  categoryId: string | null; // Added category relationship\r\n  socialMedia: {\r\n    facebook?: string;\r\n    instagram?: string;\r\n    twitter?: string;\r\n    linkedin?: string;\r\n    other?: string;\r\n  } | null;\r\n  gender: string | null;\r\n  tags: string[] | null;\r\n  notes: string | null;\r\n  createdAt: Date;\r\n  updatedAt: Date;\r\n}\r\n\r\nexport interface DbCustomer {\r\n  id: string;\r\n  user_id: string;\r\n  full_name: string;\r\n  email: string | null;\r\n  phone_number: string | null;\r\n  birthday: string | null;\r\n  location: string | null;\r\n  category_id: string | null; // Added category relationship\r\n  social_media: Json | null;\r\n  gender: string | null;\r\n  tags: string[] | null;\r\n  notes: string | null;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface CustomerFormData {\r\n  fullName: string;\r\n  email: string;\r\n  phoneNumber: string;\r\n  birthday: Date | null;\r\n  location: string;\r\n  categoryId: string | null; // Added category field\r\n  socialMedia: {\r\n    facebook?: string;\r\n    instagram?: string;\r\n    twitter?: string;\r\n    linkedin?: string;\r\n    other?: string;\r\n  };\r\n  gender: string;\r\n  tags: string[];\r\n  notes: string;\r\n}\r\n\r\n// Utility functions for database conversions\r\nexport const mapDbSaleToSale = (dbSale: DbSale): Sale => {\r\n  // Parse items and ensure numeric fields are numbers, not strings\r\n  // This is critical for discount calculations to work correctly\r\n  const items = (Array.isArray(dbSale.items) ? dbSale.items : []).map((item: any) => {\r\n    const discountPercentage = item.discountPercentage !== undefined ? Number(item.discountPercentage) : undefined;\r\n    const discountAmount = item.discountAmount !== undefined ? Number(item.discountAmount) : undefined;\r\n\r\n    // Infer discountType if missing (for legacy data)\r\n    let discountType = item.discountType as 'percentage' | 'amount' | undefined;\r\n    if (!discountType) {\r\n      if (discountPercentage && discountPercentage > 0) {\r\n        discountType = 'percentage';\r\n      } else if (discountAmount && discountAmount > 0) {\r\n        discountType = 'amount';\r\n      }\r\n    }\r\n\r\n    return {\r\n      description: item.description || '',\r\n      quantity: Number(item.quantity) || 0,\r\n      price: Number(item.price) || 0,\r\n      cost: Number(item.cost) || 0,\r\n      productId: item.productId || undefined,\r\n      discountType,\r\n      discountPercentage,\r\n      discountAmount,\r\n      createdAt: item.createdAt || undefined,\r\n    };\r\n  }) as SaleItem[];\r\n\r\n  return {\r\n    id: dbSale.id,\r\n    receiptNumber: dbSale.receipt_number,\r\n    customerName: dbSale.customer_name,\r\n    customerAddress: dbSale.customer_address || '',\r\n    customerContact: dbSale.customer_contact || '',\r\n    customerId: dbSale.customer_id || undefined,\r\n    items,\r\n    paymentStatus: dbSale.payment_status as 'Paid' | 'NOT PAID' | 'Quote' | 'Installment Sale',\r\n    profit: Number(dbSale.profit),\r\n    date: new Date(dbSale.date),\r\n    taxRate: dbSale.tax_rate ? Number(dbSale.tax_rate) : 0,\r\n    cashTransactionId: dbSale.cash_transaction_id || undefined,\r\n    amountPaid: dbSale.amount_paid ? Number(dbSale.amount_paid) : undefined,\r\n    amountDue: dbSale.amount_due ? Number(dbSale.amount_due) : undefined,\r\n    notes: dbSale.notes || '',\r\n    categoryId: dbSale.category_id || undefined,\r\n    createdAt: new Date(dbSale.created_at),\r\n  };\r\n};\r\n\r\nexport const mapSaleToDbSale = (\r\n  saleData: SaleFormData,\r\n  selectedDate: Date,\r\n  profit: number,\r\n  receiptNumber: string,\r\n  userId: string,\r\n  locationId: string,\r\n  cashTransactionId?: string | null\r\n): Omit<DbSale, 'id' | 'created_at' | 'updated_at'> => {\r\n  return {\r\n    user_id: userId,\r\n    location_id: locationId,\r\n    receipt_number: receiptNumber,\r\n    customer_name: saleData.customerName,\r\n    customer_address: saleData.customerAddress || null,\r\n    customer_contact: saleData.customerContact || null,\r\n    customer_id: saleData.customerId || null, // Include customer_id\r\n    items: (saleData.items as unknown) as Json,\r\n    payment_status: saleData.paymentStatus,\r\n    profit: profit,\r\n    date: selectedDate.toISOString().split('T')[0],\r\n    tax_rate: saleData.taxRate || 0,\r\n    cash_transaction_id: cashTransactionId || null,\r\n    amount_paid: saleData.amountPaid || null,\r\n    amount_due: saleData.amountDue || null,\r\n    notes: saleData.notes || null,\r\n    category_id: saleData.categoryId || null,\r\n  };\r\n};\r\n\r\n// Conversion functions for business settings\r\nexport const mapDbBusinessSettingsToBusinessSettings = (dbSettings: DbBusinessSettings): BusinessSettings => {\r\n  return {\r\n    businessName: dbSettings.business_name,\r\n    businessAddress: dbSettings.business_address,\r\n    businessPhone: dbSettings.business_phone,\r\n    businessEmail: dbSettings.business_email,\r\n    businessLogo: dbSettings.business_logo,\r\n    currency: dbSettings.currency,\r\n    signature: dbSettings.signature,\r\n    paymentInfo: dbSettings.metadata && typeof dbSettings.metadata === 'object' ?\r\n      (dbSettings.metadata as Record<string, unknown>).payment_info as string || '' : '',\r\n    defaultPrintFormat: dbSettings.metadata && typeof dbSettings.metadata === 'object' ?\r\n      (dbSettings.metadata as Record<string, unknown>).default_print_format as 'standard' | 'thermal' || 'standard' : 'standard',\r\n    defaultPrinterName: dbSettings.metadata && typeof dbSettings.metadata === 'object' ?\r\n      (dbSettings.metadata as Record<string, unknown>).default_printer_name as string || '' : '',\r\n    defaultPrinterType: dbSettings.metadata && typeof dbSettings.metadata === 'object' ?\r\n      (dbSettings.metadata as Record<string, unknown>).default_printer_type as 'USB' | 'Bluetooth' || 'USB' : 'USB'\r\n  };\r\n};\r\n\r\nexport const mapBusinessSettingsToDbBusinessSettings = (\r\n  settings: BusinessSettings,\r\n  userId: string\r\n): DbBusinessSettings => {\r\n  // Create metadata object with payment_info\r\n  const metadata: Json = {\r\n    payment_info: settings.paymentInfo || '',\r\n    default_print_format: settings.defaultPrintFormat || 'standard',\r\n    default_printer_name: settings.defaultPrinterName || '',\r\n    default_printer_type: settings.defaultPrinterType || 'USB'\r\n  };\r\n\r\n  return {\r\n    user_id: userId,\r\n    business_name: settings.businessName,\r\n    business_address: settings.businessAddress,\r\n    business_phone: settings.businessPhone,\r\n    business_email: settings.businessEmail,\r\n    business_logo: settings.businessLogo,\r\n    currency: settings.currency,\r\n    signature: settings.signature,\r\n    metadata: metadata, // Include metadata in the return object\r\n    updated_at: new Date().toISOString()\r\n  };\r\n};\r\n\r\n// Conversion functions for products and categories - ADDED itemNumber\r\nexport const mapDbProductToProduct = (dbProduct: DbProduct): Product => {\r\n  return {\r\n    id: dbProduct.id,\r\n    itemNumber: dbProduct.item_number, // Added item number mapping\r\n    barcode: dbProduct.barcode, // Added barcode mapping\r\n    manufacturerBarcode: dbProduct.manufacturer_barcode, // Added manufacturer barcode mapping\r\n    name: dbProduct.name,\r\n    description: dbProduct.description,\r\n    category: dbProduct.category,\r\n    quantity: dbProduct.quantity,\r\n    costPrice: Number(dbProduct.cost_price),\r\n    sellingPrice: Number(dbProduct.selling_price),\r\n    supplier: dbProduct.supplier,\r\n    imageUrl: dbProduct.image_url,\r\n    minimumStock: dbProduct.minimum_stock,\r\n    createdAt: new Date(dbProduct.created_at),\r\n    updatedAt: new Date(dbProduct.updated_at)\r\n  };\r\n};\r\n\r\nexport const mapProductToDbProduct = (product: Partial<Product>, userId: string): Partial<DbProduct> => {\r\n  const result: Partial<DbProduct> = {\r\n    user_id: userId\r\n  };\r\n\r\n  if (product.id) result.id = product.id;\r\n  if (product.itemNumber) result.item_number = product.itemNumber; // Added item number mapping\r\n  if (product.barcode !== undefined) result.barcode = product.barcode; // Added barcode mapping\r\n  if (product.manufacturerBarcode !== undefined) result.manufacturer_barcode = product.manufacturerBarcode; // Added manufacturer barcode mapping\r\n  if (product.name) result.name = product.name;\r\n  result.description = product.description;\r\n  if (product.category) result.category = product.category;\r\n  if (product.quantity !== undefined) result.quantity = product.quantity;\r\n  if (product.costPrice !== undefined) {\r\n    result.cost_price = product.costPrice;\r\n    console.log(`DEBUG: Mapping costPrice ${product.costPrice} to cost_price`);\r\n  }\r\n  if (product.sellingPrice !== undefined) {\r\n    result.selling_price = product.sellingPrice;\r\n    console.log(`DEBUG: Mapping sellingPrice ${product.sellingPrice} to selling_price`);\r\n  }\r\n  result.supplier = product.supplier;\r\n  result.image_url = product.imageUrl;\r\n  if (product.minimumStock !== undefined) result.minimum_stock = product.minimumStock;\r\n\r\n  return result;\r\n};\r\n\r\nexport const mapDbProductCategoryToProductCategory = (dbCategory: DbProductCategory): ProductCategory => {\r\n  return {\r\n    id: dbCategory.id,\r\n    name: dbCategory.name\r\n  };\r\n};\r\n\r\nexport const mapDbStockHistoryToStockHistory = (dbHistory: DbStockHistoryEntry): StockHistoryEntry => {\r\n  return {\r\n    id: dbHistory.id,\r\n    productId: dbHistory.product_id,\r\n    oldQuantity: dbHistory.previous_quantity,\r\n    newQuantity: dbHistory.new_quantity,\r\n    changeReason: dbHistory.change_reason,\r\n    referenceId: dbHistory.reference_id || null,\r\n    createdAt: new Date(dbHistory.created_at)\r\n  };\r\n};\r\n\r\n// Updated Customer mapping functions to include categoryId\r\nexport const mapDbCustomerToCustomer = (dbCustomer: DbCustomer): Customer => {\r\n  let birthday = null;\r\n\r\n  if (dbCustomer.birthday) {\r\n    try {\r\n      const birthdayStr = String(dbCustomer.birthday);\r\n      const [year, month, day] = birthdayStr.split('-').map(Number);\r\n\r\n      if (!isNaN(year) && !isNaN(month) && !isNaN(day)) {\r\n        birthday = new Date(Date.UTC(year, month - 1, day, 12, 0, 0));\r\n\r\n        console.log(\r\n          'Converting DB birthday to Date object:',\r\n          dbCustomer.birthday,\r\n          '',\r\n          birthday,\r\n          '(UTC string:',\r\n          birthday.toISOString(),\r\n          ')'\r\n        );\r\n      } else {\r\n        console.error('Invalid date components in birthday:', dbCustomer.birthday);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error parsing birthday:', error, dbCustomer.birthday);\r\n    }\r\n  }\r\n\r\n  return {\r\n    id: dbCustomer.id,\r\n    fullName: dbCustomer.full_name,\r\n    email: dbCustomer.email,\r\n    phoneNumber: dbCustomer.phone_number,\r\n    birthday: birthday,\r\n    location: dbCustomer.location,\r\n    categoryId: dbCustomer.category_id, // Added category mapping\r\n    socialMedia: dbCustomer.social_media as any,\r\n    gender: dbCustomer.gender,\r\n    tags: dbCustomer.tags,\r\n    notes: dbCustomer.notes,\r\n    createdAt: new Date(dbCustomer.created_at),\r\n    updatedAt: new Date(dbCustomer.updated_at)\r\n  };\r\n};\r\n\r\nexport const mapCustomerToDbCustomer = (customer: Partial<Customer>, userId: string): Partial<DbCustomer> => {\r\n  const result: Partial<DbCustomer> = {\r\n    user_id: userId\r\n  };\r\n\r\n  if (customer.id) result.id = customer.id;\r\n  if (customer.fullName) result.full_name = customer.fullName;\r\n  result.email = customer.email;\r\n  result.phone_number = customer.phoneNumber;\r\n  if (customer.birthday) result.birthday = customer.birthday.toISOString().split('T')[0];\r\n  result.location = customer.location;\r\n  result.category_id = customer.categoryId; // Added category mapping\r\n  result.social_media = customer.socialMedia as Json;\r\n  result.gender = customer.gender;\r\n  result.tags = customer.tags;\r\n  result.notes = customer.notes;\r\n\r\n  return result;\r\n};\r\n\r\n// Conversion functions for expenses\r\nexport const mapDbExpenseToExpense = (dbExpense: DbExpense): Expense => {\r\n  return {\r\n    id: dbExpense.id,\r\n    amount: Number(dbExpense.amount),\r\n    description: dbExpense.description,\r\n    category: dbExpense.category,\r\n    date: new Date(dbExpense.date),\r\n    paymentMethod: dbExpense.payment_method,\r\n    personInCharge: dbExpense.person_in_charge,\r\n    receiptImage: dbExpense.receipt_image,\r\n    cashAccountId: dbExpense.cash_account_id,\r\n    cashTransactionId: dbExpense.cash_transaction_id,\r\n    createdAt: new Date(dbExpense.created_at),\r\n    updatedAt: new Date(dbExpense.updated_at)\r\n  };\r\n};\r\n\r\nexport const mapExpenseToDbExpense = (expense: Partial<Expense>, userId: string): Partial<DbExpense> => {\r\n  const result: Partial<DbExpense> = {\r\n    user_id: userId\r\n  };\r\n\r\n  if (expense.id) result.id = expense.id;\r\n  if (expense.amount !== undefined) result.amount = expense.amount;\r\n  if (expense.description) result.description = expense.description;\r\n  result.category = expense.category;\r\n  if (expense.date) result.date = expense.date.toISOString().split('T')[0];\r\n  result.payment_method = expense.paymentMethod;\r\n  result.person_in_charge = expense.personInCharge;\r\n  result.receipt_image = expense.receiptImage;\r\n  result.cash_account_id = expense.cashAccountId;\r\n  result.cash_transaction_id = expense.cashTransactionId;\r\n\r\n  return result;\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 437, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/utils/searchUtils.ts"],"sourcesContent":["import { Product } from '@/types';\r\n\r\n/**\r\n * Checks if a search term (possibly containing multiple words in any order) matches a product.\r\n * Returns true if every word in the search term is found in at least one searchable field of the product.\r\n */\r\nexport const matchProductSearch = (product: Product, searchTerm: string): boolean => {\r\n    if (!searchTerm || !searchTerm.trim()) return true;\r\n\r\n    const words = searchTerm.toLowerCase().trim().split(/\\s+/);\r\n\r\n    const searchableText = [\r\n        String(product.name || ''),\r\n        String(product.description || ''),\r\n        String(product.category || ''),\r\n        String(product.supplier || ''),\r\n        String(product.itemNumber || ''),\r\n        String(product.barcode || ''),\r\n        String(product.manufacturerBarcode || '')\r\n    ].map(s => s.toLowerCase());\r\n\r\n    // Every word in the search must match at least one searchable field\r\n    return words.every(word =>\r\n        searchableText.some(field => field.includes(word))\r\n    );\r\n};\r\n"],"names":[],"mappings":";;;;AAMO,MAAM,qBAAqB,CAAC,SAAkB;IACjD,IAAI,CAAC,cAAc,CAAC,WAAW,IAAI,IAAI,OAAO;IAE9C,MAAM,QAAQ,WAAW,WAAW,GAAG,IAAI,GAAG,KAAK,CAAC;IAEpD,MAAM,iBAAiB;QACnB,OAAO,QAAQ,IAAI,IAAI;QACvB,OAAO,QAAQ,WAAW,IAAI;QAC9B,OAAO,QAAQ,QAAQ,IAAI;QAC3B,OAAO,QAAQ,QAAQ,IAAI;QAC3B,OAAO,QAAQ,UAAU,IAAI;QAC7B,OAAO,QAAQ,OAAO,IAAI;QAC1B,OAAO,QAAQ,mBAAmB,IAAI;KACzC,CAAC,GAAG,CAAC,CAAA,IAAK,EAAE,WAAW;IAExB,oEAAoE;IACpE,OAAO,MAAM,KAAK,CAAC,CAAA,OACf,eAAe,IAAI,CAAC,CAAA,QAAS,MAAM,QAAQ,CAAC;AAEpD"}},
    {"offset": {"line": 463, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/utils/inventoryCacheUtils.ts"],"sourcesContent":["import { QueryClient } from \"@tanstack/react-query\";\r\n\r\n/**\r\n * Utility to clear inventory-related caches (both localStorage and React Query)\r\n * to ensure real-time data accuracy.\r\n */\r\nexport const clearInventoryCaches = (queryClient?: QueryClient) => {\r\n    if (typeof window === 'undefined') return;\r\n\r\n    // 1. Clear LocalStorage (Legacy / Manual caches)\r\n    const keys = Object.keys(localStorage);\r\n    const patterns = [\r\n        'allProductsStats_',\r\n        'stockSummary_',\r\n        'soldItems_',\r\n        'dashboardData_',\r\n        'analyticsData_'\r\n    ];\r\n\r\n    let clearedCount = 0;\r\n    keys.forEach(key => {\r\n        if (patterns.some(pattern => key.startsWith(pattern))) {\r\n            localStorage.removeItem(key);\r\n            clearedCount++;\r\n        }\r\n    });\r\n\r\n    if (clearedCount > 0) {\r\n        console.log(`[Cache] Cleared ${clearedCount} inventory-related localStorage entries.`);\r\n    }\r\n\r\n    // 2. Invalidate React Query Keys (Modern State)\r\n    if (queryClient) {\r\n        console.log('[Cache] Invalidating React Query inventory keys...');\r\n        // Invalidate specific keys used in the inventory module\r\n        queryClient.invalidateQueries({ queryKey: ['inventory_global_stats'] });\r\n        queryClient.invalidateQueries({ queryKey: ['stockSummary'] });\r\n        queryClient.invalidateQueries({ queryKey: ['products'] });\r\n        queryClient.invalidateQueries({ queryKey: ['sales'] });\r\n        queryClient.invalidateQueries({ queryKey: ['all-products-for-scanner'] });\r\n        queryClient.invalidateQueries({ queryKey: ['all-products'] });\r\n    }\r\n};\r\n"],"names":[],"mappings":";;;;AAMO,MAAM,uBAAuB,CAAC;IACjC;;IAEA,iDAAiD;IACjD,MAAM,OAAO,OAAO,IAAI,CAAC;IACzB,MAAM,WAAW;QACb;QACA;QACA;QACA;QACA;KACH;IAED,IAAI,eAAe;IACnB,KAAK,OAAO,CAAC,CAAA;QACT,IAAI,SAAS,IAAI,CAAC,CAAA,UAAW,IAAI,UAAU,CAAC,WAAW;YACnD,aAAa,UAAU,CAAC;YACxB;QACJ;IACJ;IAEA,IAAI,eAAe,GAAG;QAClB,QAAQ,GAAG,CAAC,CAAC,gBAAgB,EAAE,aAAa,wCAAwC,CAAC;IACzF;IAEA,gDAAgD;IAChD,IAAI,aAAa;QACb,QAAQ,GAAG,CAAC;QACZ,wDAAwD;QACxD,YAAY,iBAAiB,CAAC;YAAE,UAAU;gBAAC;aAAyB;QAAC;QACrE,YAAY,iBAAiB,CAAC;YAAE,UAAU;gBAAC;aAAe;QAAC;QAC3D,YAAY,iBAAiB,CAAC;YAAE,UAAU;gBAAC;aAAW;QAAC;QACvD,YAAY,iBAAiB,CAAC;YAAE,UAAU;gBAAC;aAAQ;QAAC;QACpD,YAAY,iBAAiB,CAAC;YAAE,UAAU;gBAAC;aAA2B;QAAC;QACvE,YAAY,iBAAiB,CAAC;YAAE,UAAU;gBAAC;aAAe;QAAC;IAC/D;AACJ"}},
    {"offset": {"line": 532, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/utils/exportCustomersToCSV.ts"],"sourcesContent":["import { Customer } from '@/hooks/useCustomers';\r\nimport { format } from 'date-fns';\r\n\r\nexport const exportCustomersToCSV = (\r\n  customers: Customer[],\r\n  currency: string = 'UGX',\r\n  getCategoryName: (categoryId: string | null) => string,\r\n  getCustomerLifetimePurchases?: (customerName: string) => { total: number; count: number }\r\n) => {\r\n  if (customers.length === 0) {\r\n    alert('No customers to export');\r\n    return;\r\n  }\r\n\r\n  const headers = [\r\n    'Full Name',\r\n    'Phone Number',\r\n    'Email',\r\n    'Gender',\r\n    'Location',\r\n    'Birthday',\r\n    'Category',\r\n    'Lifetime Value',\r\n    'Total Orders',\r\n    'Notes',\r\n    'Tags',\r\n    'Created Date'\r\n  ];\r\n\r\n  const csvData = customers.map(customer => {\r\n    const lifetimeData = getCustomerLifetimePurchases ? \r\n      getCustomerLifetimePurchases(customer.fullName) : \r\n      { total: 0, count: 0 };\r\n    \r\n    return [\r\n      `\"${(customer.fullName || '').replace(/\"/g, '\"\"')}\"`,\r\n      `\"${(customer.phoneNumber || '').replace(/\"/g, '\"\"')}\"`,\r\n      `\"${(customer.email || '').replace(/\"/g, '\"\"')}\"`,\r\n      `\"${(customer.gender || '').replace(/\"/g, '\"\"')}\"`,\r\n      `\"${(customer.location || '').replace(/\"/g, '\"\"')}\"`,\r\n      customer.birthday ? format(new Date(customer.birthday), 'yyyy-MM-dd') : '',\r\n      `\"${getCategoryName(customer.categoryId || null).replace(/\"/g, '\"\"')}\"`,\r\n      lifetimeData.total.toFixed(2),\r\n      lifetimeData.count.toString(),\r\n      `\"${(customer.notes || '').replace(/\"/g, '\"\"')}\"`,\r\n      `\"${(customer.tags || []).join(', ').replace(/\"/g, '\"\"')}\"`,\r\n      format(new Date(customer.createdAt), 'yyyy-MM-dd HH:mm:ss')\r\n    ];\r\n  });\r\n\r\n  const csvContent = [headers, ...csvData]\r\n    .map(row => row.join(','))\r\n    .join('\\n');\r\n\r\n  const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\r\n  const link = document.createElement('a');\r\n  \r\n  if (link.download !== undefined) {\r\n    const url = URL.createObjectURL(blob);\r\n    link.setAttribute('href', url);\r\n    link.setAttribute('download', `customers-${currency}-${format(new Date(), 'yyyy-MM-dd')}.csv`);\r\n    link.style.visibility = 'hidden';\r\n    document.body.appendChild(link);\r\n    link.click();\r\n    document.body.removeChild(link);\r\n  }\r\n};"],"names":[],"mappings":";;;;AACA;;AAEO,MAAM,uBAAuB,CAClC,WACA,WAAmB,KAAK,EACxB,iBACA;IAEA,IAAI,UAAU,MAAM,KAAK,GAAG;QAC1B,MAAM;QACN;IACF;IAEA,MAAM,UAAU;QACd;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD;IAED,MAAM,UAAU,UAAU,GAAG,CAAC,CAAA;QAC5B,MAAM,eAAe,+BACnB,6BAA6B,SAAS,QAAQ,IAC9C;YAAE,OAAO;YAAG,OAAO;QAAE;QAEvB,OAAO;YACL,CAAC,CAAC,EAAE,CAAC,SAAS,QAAQ,IAAI,EAAE,EAAE,OAAO,CAAC,MAAM,MAAM,CAAC,CAAC;YACpD,CAAC,CAAC,EAAE,CAAC,SAAS,WAAW,IAAI,EAAE,EAAE,OAAO,CAAC,MAAM,MAAM,CAAC,CAAC;YACvD,CAAC,CAAC,EAAE,CAAC,SAAS,KAAK,IAAI,EAAE,EAAE,OAAO,CAAC,MAAM,MAAM,CAAC,CAAC;YACjD,CAAC,CAAC,EAAE,CAAC,SAAS,MAAM,IAAI,EAAE,EAAE,OAAO,CAAC,MAAM,MAAM,CAAC,CAAC;YAClD,CAAC,CAAC,EAAE,CAAC,SAAS,QAAQ,IAAI,EAAE,EAAE,OAAO,CAAC,MAAM,MAAM,CAAC,CAAC;YACpD,SAAS,QAAQ,GAAG,IAAA,kKAAM,EAAC,IAAI,KAAK,SAAS,QAAQ,GAAG,gBAAgB;YACxE,CAAC,CAAC,EAAE,gBAAgB,SAAS,UAAU,IAAI,MAAM,OAAO,CAAC,MAAM,MAAM,CAAC,CAAC;YACvE,aAAa,KAAK,CAAC,OAAO,CAAC;YAC3B,aAAa,KAAK,CAAC,QAAQ;YAC3B,CAAC,CAAC,EAAE,CAAC,SAAS,KAAK,IAAI,EAAE,EAAE,OAAO,CAAC,MAAM,MAAM,CAAC,CAAC;YACjD,CAAC,CAAC,EAAE,CAAC,SAAS,IAAI,IAAI,EAAE,EAAE,IAAI,CAAC,MAAM,OAAO,CAAC,MAAM,MAAM,CAAC,CAAC;YAC3D,IAAA,kKAAM,EAAC,IAAI,KAAK,SAAS,SAAS,GAAG;SACtC;IACH;IAEA,MAAM,aAAa;QAAC;WAAY;KAAQ,CACrC,GAAG,CAAC,CAAA,MAAO,IAAI,IAAI,CAAC,MACpB,IAAI,CAAC;IAER,MAAM,OAAO,IAAI,KAAK;QAAC;KAAW,EAAE;QAAE,MAAM;IAA0B;IACtE,MAAM,OAAO,SAAS,aAAa,CAAC;IAEpC,IAAI,KAAK,QAAQ,KAAK,WAAW;QAC/B,MAAM,MAAM,IAAI,eAAe,CAAC;QAChC,KAAK,YAAY,CAAC,QAAQ;QAC1B,KAAK,YAAY,CAAC,YAAY,CAAC,UAAU,EAAE,SAAS,CAAC,EAAE,IAAA,kKAAM,EAAC,IAAI,QAAQ,cAAc,IAAI,CAAC;QAC7F,KAAK,KAAK,CAAC,UAAU,GAAG;QACxB,SAAS,IAAI,CAAC,WAAW,CAAC;QAC1B,KAAK,KAAK;QACV,SAAS,IAAI,CAAC,WAAW,CAAC;IAC5B;AACF"}},
    {"offset": {"line": 604, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/utils/exportCustomersToPDF.ts"],"sourcesContent":["import jsPDF from 'jspdf';\r\nimport { Customer } from '@/hooks/useCustomers';\r\nimport { format } from 'date-fns';\r\n\r\nexport const exportCustomersToPDF = (\r\n  customers: Customer[],\r\n  getCategoryName: (categoryId: string | null) => string,\r\n  currency?: string,\r\n  businessName?: string,\r\n  businessLogo?: string,\r\n  getCustomerLifetimePurchases?: (customerName: string) => { total: number; count: number }\r\n) => {\r\n  if (customers.length === 0) {\r\n    alert('No customers to export');\r\n    return;\r\n  }\r\n\r\n  const doc = new jsPDF('landscape', 'mm', 'a4');\r\n  const pageWidth = doc.internal.pageSize.getWidth();\r\n  const pageHeight = doc.internal.pageSize.getHeight();\r\n  const margin = 10;\r\n  const lineHeight = 6;\r\n  let yPosition = margin;\r\n\r\n  // Add header\r\n  doc.setFontSize(18);\r\n  doc.setFont('helvetica', 'bold');\r\n  doc.text(businessName || 'Business Name', margin, yPosition);\r\n  yPosition += 8;\r\n\r\n  doc.setFontSize(14);\r\n  doc.text('Customer Report', margin, yPosition);\r\n  yPosition += 6;\r\n\r\n  doc.setFontSize(10);\r\n  doc.setFont('helvetica', 'normal');\r\n  doc.text(`Generated on: ${format(new Date(), 'MMMM dd, yyyy')}`, margin, yPosition);\r\n  yPosition += 4;\r\n  doc.text(`Currency: ${currency || 'UGX'}`, margin, yPosition);\r\n  yPosition += 10;\r\n\r\n  // Summary section\r\n  const totalCustomers = customers.length;\r\n  const categoryCounts: Record<string, number> = {};\r\n  \r\n  customers.forEach(customer => {\r\n    const categoryName = getCategoryName(customer.categoryId || null);\r\n    categoryCounts[categoryName] = (categoryCounts[categoryName] || 0) + 1;\r\n  });\r\n\r\n  doc.setFontSize(12);\r\n  doc.setFont('helvetica', 'bold');\r\n  doc.text('Summary:', margin, yPosition);\r\n  yPosition += lineHeight;\r\n\r\n  doc.setFontSize(10);\r\n  doc.setFont('helvetica', 'normal');\r\n  doc.text(`Total Customers: ${totalCustomers}`, margin + 5, yPosition);\r\n  yPosition += lineHeight;\r\n\r\n  // Category breakdown\r\n  Object.entries(categoryCounts).forEach(([category, count]) => {\r\n    doc.text(`${category}: ${count}`, margin + 5, yPosition);\r\n    yPosition += lineHeight;\r\n  });\r\n\r\n  yPosition += 5;\r\n\r\n  // Table headers\r\n  const headers = ['Name', 'Phone', 'Email', 'Gender', 'Location', 'Birthday', 'Category', 'Lifetime Value', 'Orders'];\r\n  const columnWidths = [30, 20, 30, 12, 25, 18, 20, 25, 15];\r\n  const tableWidth = columnWidths.reduce((sum, width) => sum + width, 0);\r\n  const startX = (pageWidth - tableWidth) / 2;\r\n\r\n  // Function to add page if needed\r\n  const checkPageBreak = (requiredHeight: number) => {\r\n    if (yPosition + requiredHeight > pageHeight - margin) {\r\n      doc.addPage();\r\n      yPosition = margin;\r\n      \r\n      // Add table title on new page\r\n      doc.setFontSize(12);\r\n      doc.setFont('helvetica', 'bold');\r\n      doc.text('Customer List', margin, yPosition);\r\n      yPosition += 8;\r\n      \r\n      // Add table header on new page\r\n      drawTableHeader();\r\n      \r\n      return true;\r\n    }\r\n    return false;\r\n  };\r\n\r\n  // Function to draw table header\r\n  const drawTableHeader = () => {\r\n    doc.setFontSize(10);\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.setFillColor(240, 240, 240);\r\n    doc.rect(startX, yPosition, tableWidth, 8, 'F');\r\n\r\n    let xPosition = startX;\r\n    headers.forEach((header, index) => {\r\n      doc.text(header, xPosition + 2, yPosition + 5);\r\n      xPosition += columnWidths[index];\r\n    });\r\n    yPosition += 8;\r\n  };\r\n\r\n  // Add initial table title\r\n  doc.setFontSize(12);\r\n  doc.setFont('helvetica', 'bold');\r\n  doc.text('Customer List', margin, yPosition);\r\n  yPosition += 8;\r\n\r\n  // Draw table header\r\n  checkPageBreak(15);\r\n  drawTableHeader();\r\n\r\n  // Draw table rows\r\n  doc.setFont('helvetica', 'normal');\r\n  customers.forEach((customer, index) => {\r\n    checkPageBreak(8);\r\n\r\n    // Alternate row colors\r\n    if (index % 2 === 0) {\r\n      doc.setFillColor(248, 248, 248);\r\n      doc.rect(startX, yPosition, tableWidth, 6, 'F');\r\n    }\r\n\r\n    const lifetimeData = getCustomerLifetimePurchases ? \r\n      getCustomerLifetimePurchases(customer.fullName) : \r\n      { total: 0, count: 0 };\r\n\r\n    let xPosition = startX;\r\n    const rowData = [\r\n      customer.fullName || '',\r\n      customer.phoneNumber || '',\r\n      customer.email || '',\r\n      customer.gender || '',\r\n      customer.location || '',\r\n      customer.birthday ? format(new Date(customer.birthday), 'MMM dd') : '',\r\n      getCategoryName(customer.categoryId || null),\r\n      `${currency || 'UGX'} ${lifetimeData.total.toLocaleString()}`,\r\n      lifetimeData.count.toString()\r\n    ];\r\n\r\n    rowData.forEach((data, colIndex) => {\r\n      const cellWidth = columnWidths[colIndex];\r\n      const text = data.toString();\r\n      \r\n      // Truncate text if too long\r\n      const maxChars = Math.floor(cellWidth / 2.5);\r\n      const truncatedText = text.length > maxChars ? text.substring(0, maxChars - 3) + '...' : text;\r\n      \r\n      doc.text(truncatedText, xPosition + 2, yPosition + 4);\r\n      xPosition += cellWidth;\r\n    });\r\n\r\n    yPosition += 6;\r\n  });\r\n\r\n  // Add footer with page numbers\r\n  const totalPages = doc.getNumberOfPages();\r\n  for (let i = 1; i <= totalPages; i++) {\r\n    doc.setPage(i);\r\n    doc.setFontSize(8);\r\n    doc.setFont('helvetica', 'normal');\r\n    doc.text(`Page ${i} of ${totalPages}`, pageWidth - margin - 25, pageHeight - 5);\r\n  }\r\n\r\n  // Save the PDF\r\n  const filename = `customers_report_${currency || 'UGX'}_${format(new Date(), 'yyyy-MM-dd')}.pdf`;\r\n  doc.save(filename);\r\n};"],"names":[],"mappings":"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"}},
    {"offset": {"line": 775, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/utils/generateNoticePDF.ts"],"sourcesContent":["\r\nimport jsPDF from 'jspdf';\r\nimport { format } from 'date-fns';\r\nimport { BusinessSettings } from '@/hooks/useBusinessSettings';\r\nimport { Customer } from '@/types';\r\n\r\ninterface NoticeData {\r\n  customer: Customer;\r\n  subject: string;\r\n  content: string;\r\n  senderName?: string;\r\n}\r\n\r\nexport const generateNoticePDF = async (\r\n  noticeData: NoticeData,\r\n  businessSettings: BusinessSettings\r\n): Promise<void> => {\r\n  const doc = new jsPDF();\r\n  const pageWidth = doc.internal.pageSize.getWidth();\r\n  const pageHeight = doc.internal.pageSize.getHeight();\r\n  const margin = 20;\r\n  let yPosition = margin;\r\n\r\n  // Function to add watermark to current page\r\n  const addWatermark = () => {\r\n    doc.setFontSize(8);\r\n    doc.setFont('helvetica', 'normal');\r\n    doc.setTextColor(150, 150, 150); // Light gray color\r\n    doc.text('Created By Gonza Systems', pageWidth / 2, pageHeight - 10, { align: 'center' });\r\n    doc.setTextColor(0, 0, 0); // Reset to black\r\n  };\r\n\r\n  try {\r\n    // Set default font\r\n    doc.setFont('helvetica', 'normal');\r\n\r\n    // Helper function to check if we need a new page\r\n    const checkPageBreak = (requiredSpace: number): void => {\r\n      if (yPosition + requiredSpace > pageHeight - margin - 15) { // Reserve space for watermark\r\n        addWatermark(); // Add watermark to current page before creating new one\r\n        doc.addPage();\r\n        yPosition = margin;\r\n      }\r\n    };\r\n\r\n    // Helper function to add text with proper word wrapping and page breaks\r\n    const addWrappedText = (text: string, x: number, y: number, maxWidth: number, fontSize: number = 11): number => {\r\n      doc.setFontSize(fontSize);\r\n      const splitText = doc.splitTextToSize(text, maxWidth);\r\n\r\n      let currentY = y;\r\n\r\n      splitText.forEach((line: string) => {\r\n        // Check if we need a new page before adding the line\r\n        checkPageBreak(6); // 6 units space needed for a line\r\n\r\n        doc.text(line, x, yPosition);\r\n        yPosition += 5; // Line spacing\r\n      });\r\n\r\n      return yPosition;\r\n    };\r\n\r\n    // Business Header with Logo on left and details on right\r\n    const headerHeight = 25;\r\n\r\n    // Business Logo on the left (if available)\r\n    if (businessSettings.businessLogo) {\r\n      try {\r\n        // Create a temporary image to get actual dimensions\r\n        const img = new Image();\r\n        img.src = businessSettings.businessLogo;\r\n\r\n        // Wait for image to load to get dimensions\r\n        await new Promise((resolve, reject) => {\r\n          img.onload = resolve;\r\n          img.onerror = reject;\r\n          // If already loaded (cached), resolve immediately\r\n          if (img.complete) resolve(img);\r\n        });\r\n\r\n        // Calculate proper dimensions maintaining aspect ratio\r\n        const maxLogoWidth = 40;\r\n        const maxLogoHeight = 20;\r\n        const aspectRatio = img.width / img.height;\r\n\r\n        let logoWidth = maxLogoWidth;\r\n        let logoHeight = logoWidth / aspectRatio;\r\n\r\n        // If height exceeds max, scale down based on height\r\n        if (logoHeight > maxLogoHeight) {\r\n          logoHeight = maxLogoHeight;\r\n          logoWidth = logoHeight * aspectRatio;\r\n        }\r\n\r\n        // Add logo on the left\r\n        doc.addImage(businessSettings.businessLogo, 'JPEG', margin, yPosition, logoWidth, logoHeight);\r\n      } catch (error) {\r\n        console.error('Error adding business logo:', error);\r\n      }\r\n    }\r\n\r\n    // Business Details on the right with right alignment\r\n    const rightMargin = pageWidth - margin;\r\n    doc.setFontSize(16);\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.text(businessSettings.businessName || 'Business Name', rightMargin, yPosition + 5, { align: 'right' });\r\n\r\n    // Add spacing between business name and details\r\n    yPosition += 12;\r\n\r\n    doc.setFontSize(10);\r\n    doc.setFont('helvetica', 'normal');\r\n\r\n    if (businessSettings.businessAddress) {\r\n      const addressLines = doc.splitTextToSize(businessSettings.businessAddress, 80);\r\n      addressLines.forEach((line: string, index: number) => {\r\n        doc.text(line, rightMargin, yPosition + (index * 4), { align: 'right' });\r\n      });\r\n      yPosition += (addressLines.length * 4) - 4;\r\n    }\r\n\r\n    if (businessSettings.businessPhone) {\r\n      yPosition += 4;\r\n      doc.text(`Phone: ${businessSettings.businessPhone}`, rightMargin, yPosition, { align: 'right' });\r\n    }\r\n\r\n    if (businessSettings.businessEmail) {\r\n      yPosition += 4;\r\n      doc.text(`Email: ${businessSettings.businessEmail}`, rightMargin, yPosition, { align: 'right' });\r\n    }\r\n\r\n    yPosition += 8;\r\n\r\n    // Horizontal line under the header\r\n    doc.setLineWidth(0.5);\r\n    doc.line(margin, yPosition, pageWidth - margin, yPosition);\r\n    yPosition += 15;\r\n\r\n    // Date\r\n    checkPageBreak(15);\r\n    doc.setFontSize(11);\r\n    const currentDate = format(new Date(), 'MMMM d, yyyy');\r\n    doc.text(`Date: ${currentDate}`, margin, yPosition);\r\n    yPosition += 12;\r\n\r\n    // Customer Address Block\r\n    checkPageBreak(25);\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.text(noticeData.customer.fullName || 'Valued Customer', margin, yPosition);\r\n    yPosition += 5;\r\n\r\n    doc.setFont('helvetica', 'normal');\r\n    if (noticeData.customer.location) {\r\n      yPosition = addWrappedText(noticeData.customer.location, margin, yPosition, pageWidth - 2 * margin, 11);\r\n      yPosition += 2;\r\n    }\r\n\r\n    if (noticeData.customer.email) {\r\n      checkPageBreak(8);\r\n      doc.text(noticeData.customer.email, margin, yPosition);\r\n      yPosition += 5;\r\n    }\r\n\r\n    yPosition += 8;\r\n\r\n    // Subject Line\r\n    if (noticeData.subject) {\r\n      checkPageBreak(15);\r\n      doc.setFont('helvetica', 'bold');\r\n      doc.setFontSize(12);\r\n      yPosition = addWrappedText(`Re: ${noticeData.subject}`, margin, yPosition, pageWidth - 2 * margin, 12);\r\n      yPosition += 6;\r\n    }\r\n\r\n    // Salutation\r\n    checkPageBreak(15);\r\n    doc.setFont('helvetica', 'normal');\r\n    doc.setFontSize(11);\r\n    doc.text(`Dear ${noticeData.customer.fullName || 'Valued Customer'},`, margin, yPosition);\r\n    yPosition += 8;\r\n\r\n    // Main Content - Split by paragraphs and handle page breaks\r\n    if (noticeData.content) {\r\n      const paragraphs = noticeData.content.split('\\n\\n').filter(p => p.trim() !== '');\r\n\r\n      paragraphs.forEach((paragraph, index) => {\r\n        // Estimate space needed for this paragraph\r\n        const estimatedLines = Math.ceil(paragraph.length / 80); // Rough estimate\r\n        const estimatedSpace = estimatedLines * 5 + 10; // Line height + some padding\r\n\r\n        checkPageBreak(estimatedSpace);\r\n\r\n        yPosition = addWrappedText(paragraph.trim(), margin, yPosition, pageWidth - 2 * margin, 11);\r\n\r\n        // Add smaller gap between paragraphs (only if not the last paragraph)\r\n        if (index < paragraphs.length - 1) {\r\n          yPosition += 6;\r\n        }\r\n      });\r\n\r\n      yPosition += 10;\r\n    }\r\n\r\n    // Closing and signature section\r\n    checkPageBreak(60); // Reserve space for closing, signature, and sender info\r\n\r\n    doc.text('Yours faithfully,', margin, yPosition);\r\n    yPosition += 20; // Space for signature\r\n\r\n    // Signature (if available from business settings)\r\n    if (businessSettings.signature) {\r\n      try {\r\n        // Create a temporary image to get actual dimensions for signature\r\n        const sigImg = new Image();\r\n        sigImg.src = businessSettings.signature;\r\n\r\n        // Wait for signature image to load to get dimensions\r\n        await new Promise((resolve, reject) => {\r\n          sigImg.onload = resolve;\r\n          sigImg.onerror = reject;\r\n          // If already loaded (cached), resolve immediately\r\n          if (sigImg.complete) resolve(sigImg);\r\n        });\r\n\r\n        // Calculate proper dimensions maintaining aspect ratio for signature\r\n        const maxSigWidth = 50;\r\n        const maxSigHeight = 25;\r\n        const sigAspectRatio = sigImg.width / sigImg.height;\r\n\r\n        let signatureWidth = maxSigWidth;\r\n        let signatureHeight = signatureWidth / sigAspectRatio;\r\n\r\n        // If height exceeds max, scale down based on height\r\n        if (signatureHeight > maxSigHeight) {\r\n          signatureHeight = maxSigHeight;\r\n          signatureWidth = signatureHeight * sigAspectRatio;\r\n        }\r\n\r\n        // Add signature\r\n        doc.addImage(businessSettings.signature, 'JPEG', margin, yPosition, signatureWidth, signatureHeight);\r\n        yPosition += signatureHeight + 5;\r\n      } catch (error) {\r\n        console.error('Error adding signature:', error);\r\n        yPosition += 15; // Add space even if signature fails\r\n      }\r\n    } else {\r\n      yPosition += 15; // Add space for manual signature\r\n    }\r\n\r\n    // Sender name and business\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.setFontSize(11);\r\n    const senderName = noticeData.senderName || businessSettings.businessName || 'Management';\r\n    doc.text(senderName, margin, yPosition);\r\n    yPosition += 5;\r\n\r\n    if (businessSettings.businessName && noticeData.senderName) {\r\n      doc.setFont('helvetica', 'normal');\r\n      doc.text(businessSettings.businessName, margin, yPosition);\r\n    }\r\n\r\n    // Add watermark to the final page\r\n    addWatermark();\r\n\r\n    // Generate filename\r\n    const customerName = noticeData.customer.fullName?.replace(/[^a-zA-Z0-9]/g, '_') || 'Customer';\r\n    const dateStr = format(new Date(), 'yyyy-MM-dd');\r\n    const filename = `Notice_${customerName}_${dateStr}.pdf`;\r\n\r\n    // Save the PDF\r\n    doc.save(filename);\r\n\r\n  } catch (error) {\r\n    console.error('Error generating notice PDF:', error);\r\n    throw new Error('Failed to generate notice PDF. Please try again.');\r\n  }\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1012, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/utils/formalizeText.ts"],"sourcesContent":["\r\n/**\r\n * Transforms casual text into formal business language\r\n */\r\nexport const formalizeText = (text: string): string => {\r\n  if (!text || text.trim() === '') return text;\r\n\r\n  // Common casual to formal replacements\r\n  const replacements: Record<string, string> = {\r\n    // Contractions\r\n    \"can't\": \"cannot\",\r\n    \"won't\": \"will not\",\r\n    \"don't\": \"do not\",\r\n    \"didn't\": \"did not\",\r\n    \"haven't\": \"have not\",\r\n    \"hasn't\": \"has not\",\r\n    \"isn't\": \"is not\",\r\n    \"aren't\": \"are not\",\r\n    \"wasn't\": \"was not\",\r\n    \"weren't\": \"were not\",\r\n    \"I'm\": \"I am\",\r\n    \"you're\": \"you are\",\r\n    \"we're\": \"we are\",\r\n    \"they're\": \"they are\",\r\n    \"it's\": \"it is\",\r\n    \"that's\": \"that is\",\r\n    \"here's\": \"here is\",\r\n    \"there's\": \"there is\",\r\n    \"we've\": \"we have\",\r\n    \"they've\": \"they have\",\r\n    \"I've\": \"I have\",\r\n    \"you've\": \"you have\",\r\n    \r\n    // Casual words to formal\r\n    \"ok\": \"acceptable\",\r\n    \"okay\": \"acceptable\",\r\n    \"thanks\": \"thank you\",\r\n    \"hi\": \"greetings\",\r\n    \"bye\": \"goodbye\",\r\n    \"asap\": \"as soon as possible\",\r\n    \"fyi\": \"for your information\",\r\n    \"btw\": \"incidentally\",\r\n    \"etc\": \"and so forth\",\r\n    \"gonna\": \"going to\",\r\n    \"wanna\": \"want to\",\r\n    \"gotta\": \"have to\",\r\n    \"kinda\": \"somewhat\",\r\n    \"sorta\": \"somewhat\",\r\n    \r\n    // Business improvements\r\n    \"get\": \"receive\",\r\n    \"got\": \"received\",\r\n    \"give\": \"provide\",\r\n    \"gave\": \"provided\",\r\n    \"ask\": \"request\",\r\n    \"asked\": \"requested\",\r\n    \"tell\": \"inform\",\r\n    \"told\": \"informed\",\r\n    \"show\": \"demonstrate\",\r\n    \"showed\": \"demonstrated\",\r\n    \"help\": \"assist\",\r\n    \"helped\": \"assisted\",\r\n    \"fix\": \"resolve\",\r\n    \"fixed\": \"resolved\",\r\n    \"buy\": \"purchase\",\r\n    \"bought\": \"purchased\",\r\n    \"sell\": \"offer\",\r\n    \"sold\": \"provided\"\r\n  };\r\n\r\n  let formalizedText = text;\r\n\r\n  // Apply replacements (case-insensitive for whole words only)\r\n  Object.entries(replacements).forEach(([casual, formal]) => {\r\n    const regex = new RegExp(`\\\\b${casual}\\\\b`, 'gi');\r\n    formalizedText = formalizedText.replace(regex, formal);\r\n  });\r\n\r\n  // Capitalize first letter of sentences\r\n  formalizedText = formalizedText.replace(/(^|\\. )([a-z])/g, (match, prefix, letter) => {\r\n    return prefix + letter.toUpperCase();\r\n  });\r\n\r\n  // Ensure proper sentence ending\r\n  formalizedText = formalizedText.trim();\r\n  if (!formalizedText.endsWith('.') && !formalizedText.endsWith('!') && !formalizedText.endsWith('?')) {\r\n    formalizedText += '.';\r\n  }\r\n\r\n  return formalizedText;\r\n};\r\n\r\n/**\r\n * Enhances text with more professional language and structure\r\n */\r\nexport const enhanceForBusiness = (text: string): string => {\r\n  if (!text || text.trim() === '') return text;\r\n\r\n  let enhanced = formalizeText(text);\r\n\r\n  // Add professional opening phrases if the text seems too direct\r\n  if (!enhanced.toLowerCase().includes('we are') && !enhanced.toLowerCase().includes('we would like') && !enhanced.toLowerCase().includes('please')) {\r\n    if (enhanced.toLowerCase().startsWith('our') || enhanced.toLowerCase().startsWith('the')) {\r\n      enhanced = `We would like to inform you that ${enhanced.charAt(0).toLowerCase() + enhanced.slice(1)}`;\r\n    }\r\n  }\r\n\r\n  // Ensure polite language\r\n  if (enhanced.toLowerCase().includes('you must') || enhanced.toLowerCase().includes('you have to')) {\r\n    enhanced = enhanced.replace(/you must/gi, 'we kindly request that you');\r\n    enhanced = enhanced.replace(/you have to/gi, 'we would appreciate if you could');\r\n  }\r\n\r\n  return enhanced;\r\n};\r\n"],"names":[],"mappings":"AACA;;CAEC;;;;;;AACM,MAAM,gBAAgB,CAAC;IAC5B,IAAI,CAAC,QAAQ,KAAK,IAAI,OAAO,IAAI,OAAO;IAExC,uCAAuC;IACvC,MAAM,eAAuC;QAC3C,eAAe;QACf,SAAS;QACT,SAAS;QACT,SAAS;QACT,UAAU;QACV,WAAW;QACX,UAAU;QACV,SAAS;QACT,UAAU;QACV,UAAU;QACV,WAAW;QACX,OAAO;QACP,UAAU;QACV,SAAS;QACT,WAAW;QACX,QAAQ;QACR,UAAU;QACV,UAAU;QACV,WAAW;QACX,SAAS;QACT,WAAW;QACX,QAAQ;QACR,UAAU;QAEV,yBAAyB;QACzB,MAAM;QACN,QAAQ;QACR,UAAU;QACV,MAAM;QACN,OAAO;QACP,QAAQ;QACR,OAAO;QACP,OAAO;QACP,OAAO;QACP,SAAS;QACT,SAAS;QACT,SAAS;QACT,SAAS;QACT,SAAS;QAET,wBAAwB;QACxB,OAAO;QACP,OAAO;QACP,QAAQ;QACR,QAAQ;QACR,OAAO;QACP,SAAS;QACT,QAAQ;QACR,QAAQ;QACR,QAAQ;QACR,UAAU;QACV,QAAQ;QACR,UAAU;QACV,OAAO;QACP,SAAS;QACT,OAAO;QACP,UAAU;QACV,QAAQ;QACR,QAAQ;IACV;IAEA,IAAI,iBAAiB;IAErB,6DAA6D;IAC7D,OAAO,OAAO,CAAC,cAAc,OAAO,CAAC,CAAC,CAAC,QAAQ,OAAO;QACpD,MAAM,QAAQ,IAAI,OAAO,CAAC,GAAG,EAAE,OAAO,GAAG,CAAC,EAAE;QAC5C,iBAAiB,eAAe,OAAO,CAAC,OAAO;IACjD;IAEA,uCAAuC;IACvC,iBAAiB,eAAe,OAAO,CAAC,mBAAmB,CAAC,OAAO,QAAQ;QACzE,OAAO,SAAS,OAAO,WAAW;IACpC;IAEA,gCAAgC;IAChC,iBAAiB,eAAe,IAAI;IACpC,IAAI,CAAC,eAAe,QAAQ,CAAC,QAAQ,CAAC,eAAe,QAAQ,CAAC,QAAQ,CAAC,eAAe,QAAQ,CAAC,MAAM;QACnG,kBAAkB;IACpB;IAEA,OAAO;AACT;AAKO,MAAM,qBAAqB,CAAC;IACjC,IAAI,CAAC,QAAQ,KAAK,IAAI,OAAO,IAAI,OAAO;IAExC,IAAI,WAAW,cAAc;IAE7B,gEAAgE;IAChE,IAAI,CAAC,SAAS,WAAW,GAAG,QAAQ,CAAC,aAAa,CAAC,SAAS,WAAW,GAAG,QAAQ,CAAC,oBAAoB,CAAC,SAAS,WAAW,GAAG,QAAQ,CAAC,WAAW;QACjJ,IAAI,SAAS,WAAW,GAAG,UAAU,CAAC,UAAU,SAAS,WAAW,GAAG,UAAU,CAAC,QAAQ;YACxF,WAAW,CAAC,iCAAiC,EAAE,SAAS,MAAM,CAAC,GAAG,WAAW,KAAK,SAAS,KAAK,CAAC,IAAI;QACvG;IACF;IAEA,yBAAyB;IACzB,IAAI,SAAS,WAAW,GAAG,QAAQ,CAAC,eAAe,SAAS,WAAW,GAAG,QAAQ,CAAC,gBAAgB;QACjG,WAAW,SAAS,OAAO,CAAC,cAAc;QAC1C,WAAW,SAAS,OAAO,CAAC,iBAAiB;IAC/C;IAEA,OAAO;AACT"}},
    {"offset": {"line": 1122, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/utils/noticeTemplates.ts"],"sourcesContent":["\r\nexport interface NoticeTemplate {\r\n  id: string;\r\n  name: string;\r\n  subject: string;\r\n  content: string;\r\n  category: 'payment' | 'policy' | 'general' | 'announcement' | 'gratitude';\r\n}\r\n\r\nexport const noticeTemplates: NoticeTemplate[] = [\r\n  {\r\n    id: 'payment_reminder',\r\n    name: 'Payment Reminder',\r\n    subject: 'Payment Reminder - Account Status',\r\n    content: `We hope this letter finds you well. We are writing to kindly remind you about your outstanding payment.\r\n\r\nWe appreciate your prompt attention to this matter and thank you for your continued business.`,\r\n    category: 'payment'\r\n  },\r\n  {\r\n    id: 'policy_update',\r\n    name: 'Policy Update',\r\n    subject: 'Important Update to Our Business Policies',\r\n    content: `We are writing to inform you of important updates to our business policies that may affect your account.\r\n\r\nThese changes will take effect shortly. We appreciate your understanding and continued partnership.`,\r\n    category: 'policy'\r\n  },\r\n  {\r\n    id: 'thank_you',\r\n    name: 'Thank You Letter',\r\n    subject: 'Thank You for Your Business',\r\n    content: `We wanted to take a moment to express our sincere gratitude for your continued support and trust in our business.\r\n\r\nWe look forward to serving you for many years to come.`,\r\n    category: 'gratitude'\r\n  },\r\n  {\r\n    id: 'service_announcement',\r\n    name: 'Service Announcement',\r\n    subject: 'Important Service Update',\r\n    content: `We are excited to share some important updates about our services that will enhance your experience with us.\r\n\r\nWe believe these improvements will provide you with even better service and value.`,\r\n    category: 'announcement'\r\n  },\r\n  {\r\n    id: 'account_update',\r\n    name: 'Account Status Update',\r\n    subject: 'Account Status Update',\r\n    content: `We are writing to provide you with an important update regarding your account with us.\r\n\r\nIf you have any questions or concerns, please don't hesitate to contact us.`,\r\n    category: 'general'\r\n  },\r\n  {\r\n    id: 'general_notice',\r\n    name: 'General Business Communication',\r\n    subject: 'Business Communication',\r\n    content: `We hope this message finds you well. We wanted to reach out to you regarding an important matter.\r\n\r\nThank you for your attention to this matter.`,\r\n    category: 'general'\r\n  }\r\n];\r\n\r\nexport const getTemplateById = (id: string): NoticeTemplate | undefined => {\r\n  return noticeTemplates.find(template => template.id === id);\r\n};\r\n\r\nexport const getTemplatesByCategory = (category: string): NoticeTemplate[] => {\r\n  if (category === 'all') return noticeTemplates;\r\n  return noticeTemplates.filter(template => template.category === category);\r\n};\r\n"],"names":[],"mappings":";;;;;;;;AASO,MAAM,kBAAoC;IAC/C;QACE,IAAI;QACJ,MAAM;QACN,SAAS;QACT,SAAS,CAAC;;6FAE+E,CAAC;QAC1F,UAAU;IACZ;IACA;QACE,IAAI;QACJ,MAAM;QACN,SAAS;QACT,SAAS,CAAC;;mGAEqF,CAAC;QAChG,UAAU;IACZ;IACA;QACE,IAAI;QACJ,MAAM;QACN,SAAS;QACT,SAAS,CAAC;;sDAEwC,CAAC;QACnD,UAAU;IACZ;IACA;QACE,IAAI;QACJ,MAAM;QACN,SAAS;QACT,SAAS,CAAC;;kFAEoE,CAAC;QAC/E,UAAU;IACZ;IACA;QACE,IAAI;QACJ,MAAM;QACN,SAAS;QACT,SAAS,CAAC;;2EAE6D,CAAC;QACxE,UAAU;IACZ;IACA;QACE,IAAI;QACJ,MAAM;QACN,SAAS;QACT,SAAS,CAAC;;4CAE8B,CAAC;QACzC,UAAU;IACZ;CACD;AAEM,MAAM,kBAAkB,CAAC;IAC9B,OAAO,gBAAgB,IAAI,CAAC,CAAA,WAAY,SAAS,EAAE,KAAK;AAC1D;AAEO,MAAM,yBAAyB,CAAC;IACrC,IAAI,aAAa,OAAO,OAAO;IAC/B,OAAO,gBAAgB,MAAM,CAAC,CAAA,WAAY,SAAS,QAAQ,KAAK;AAClE"}},
    {"offset": {"line": 1200, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/utils/deviceDetection.ts"],"sourcesContent":["// Function to detect iOS devices\r\nexport const isIOS = (): boolean => {\r\n  const ua = navigator.userAgent || \"\";\r\n  // If it's Android, it's NOT iOS\r\n  if (/android/i.test(ua)) return false;\r\n\r\n  return /iPad|iPhone|iPod/.test(ua) ||\r\n    (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);\r\n};\r\n\r\n// Function to detect Android devices\r\nexport const isAndroid = (): boolean => {\r\n  const ua = navigator.userAgent || \"\";\r\n  return /android/i.test(ua);\r\n};\r\n"],"names":[],"mappings":"AAAA,iCAAiC;;;;;;;AAC1B,MAAM,QAAQ;IACnB,MAAM,KAAK,UAAU,SAAS,IAAI;IAClC,gCAAgC;IAChC,IAAI,WAAW,IAAI,CAAC,KAAK,OAAO;IAEhC,OAAO,mBAAmB,IAAI,CAAC,OAC5B,UAAU,QAAQ,KAAK,cAAc,UAAU,cAAc,GAAG;AACrE;AAGO,MAAM,YAAY;IACvB,MAAM,KAAK,UAAU,SAAS,IAAI;IAClC,OAAO,WAAW,IAAI,CAAC;AACzB"}},
    {"offset": {"line": 1224, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/utils/smsUtils.ts"],"sourcesContent":["\r\nimport { Sale, BusinessSettings } from '@/types';\r\nimport { isIOS } from './deviceDetection';\r\n\r\nexport interface SMSOptions {\r\n  phoneNumber: string;\r\n  message: string;\r\n}\r\n\r\nexport const formatPhoneForSMS = (phoneNumber: string): string => {\r\n  // Remove all non-digit characters except + at the beginning\r\n  const cleaned = phoneNumber.replace(/[^\\d+]/g, '');\r\n\r\n  // If it starts with +, keep it, otherwise just return the digits\r\n  if (cleaned.startsWith('+')) {\r\n    return cleaned;\r\n  }\r\n\r\n  return cleaned;\r\n};\r\n\r\nexport const formatMessageForSMS = (content: string, businessName?: string): string => {\r\n  // Replace non-breaking spaces and other special whitespace with standard spaces\r\n  // \\u00A0 is non-breaking space, \\u200B is zero-width space, etc.\r\n  let sanitized = content.replace(/[\\u00A0\\u1680\\u180e\\u2000-\\u2009\\u200a\\u200b\\u202f\\u205f\\u3000]/g, ' ');\r\n\r\n  // Remove excessive whitespace and format for SMS\r\n  let formatted = sanitized\r\n    .replace(/\\n\\s*\\n/g, '\\n\\n') // Clean up multiple line breaks\r\n    .replace(/^\\s+|\\s+$/g, '') // Trim whitespace\r\n    .substring(0, 800); // Limit to reasonable SMS length\r\n\r\n  // Add business signature if provided\r\n  if (businessName) {\r\n    formatted += `\\n\\n- ${businessName}`;\r\n  }\r\n\r\n  return formatted;\r\n};\r\n\r\nexport const getBirthdayMessage = (customerName: string): string => {\r\n  return ` Happy Birthday ${customerName}! \r\n\r\nWishing you a day filled with joy, love, and great memories. Thank you for being a valued part of our family. We're grateful for your support and wish you nothing but happiness in the year ahead!\r\n\r\nMay this new year of your life bring you wonderful opportunities and amazing experiences.`;\r\n};\r\n\r\nexport const getWeMissYouMessage = (customerName: string): string => {\r\n  return `Dear ${customerName},\r\n\r\nWe Miss You!\r\n\r\nIt's been a while since we last heard from you, and we just wanted to reach out. We truly value you as a customer and would love to see you again.\r\n\r\nIf there's anything we can do to assist you or if you need any help, we're always here for you!\r\n\r\nWe hope to serve you again soon.\r\n\r\nYours faithfully,`;\r\n};\r\n\r\nexport const getThankYouMessage = (sale: Sale, settings: BusinessSettings): string => {\r\n  const saleTotal = sale.items.reduce((total, item) => {\r\n    const itemSubtotal = item.price * item.quantity;\r\n    const discountAmount = item.discountType === 'amount'\r\n      ? (item.discountAmount || 0)\r\n      : (itemSubtotal * (item.discountPercentage || 0)) / 100;\r\n    return total + (itemSubtotal - discountAmount);\r\n  }, 0);\r\n\r\n  // Add tax if applicable\r\n  const taxAmount = saleTotal * ((sale.taxRate || 0) / 100);\r\n  const totalWithTax = saleTotal + taxAmount;\r\n\r\n  // Create items list\r\n  const itemsList = sale.items.map(item =>\r\n    ` ${item.description} (Qty: ${item.quantity})`\r\n  ).join('\\n');\r\n\r\n  return `Dear ${sale.customerName},\r\n\r\nWe wanted to take a moment to express our sincere gratitude for your continued support and trust in our business.\r\n\r\nReceipt Number: ${sale.receiptNumber}\r\n\r\nItems Purchased:\r\n${itemsList}\r\n\r\nTotal Amount: ${settings.currency} ${totalWithTax.toLocaleString()}\r\n\r\nIn case of any inquiries please call ${settings.businessPhone && settings.businessPhone !== '(123) 456-7890' ? settings.businessPhone : 'our office'}.\r\n\r\nWe appreciate your business and look forward to serving you again.\r\n\r\nYours faithfully,\r\n${settings.businessName || 'Management'}`;\r\n};\r\n\r\nexport const openSMSApp = (options: SMSOptions): void => {\r\n  const { phoneNumber, message } = options;\r\n  const formattedPhone = formatPhoneForSMS(phoneNumber);\r\n  const encodedMessage = encodeURIComponent(message);\r\n\r\n  let smsUrl: string;\r\n\r\n  if (isIOS()) {\r\n    // iOS uses sms: scheme\r\n    smsUrl = `sms:${formattedPhone}&body=${encodedMessage}`;\r\n  } else {\r\n    // Android uses sms: scheme with different parameter format\r\n    smsUrl = `sms:${formattedPhone}?body=${encodedMessage}`;\r\n  }\r\n\r\n  try {\r\n    window.open(smsUrl, '_self');\r\n  } catch (error) {\r\n    console.error('Failed to open SMS app:', error);\r\n    // Fallback: copy message to clipboard\r\n    navigator.clipboard?.writeText(message).then(() => {\r\n      alert('SMS app not available. Message copied to clipboard.');\r\n    }).catch(() => {\r\n      alert('SMS app not available and clipboard access denied.');\r\n    });\r\n  }\r\n};\r\n\r\nexport const openWhatsApp = (options: SMSOptions): void => {\r\n  const { phoneNumber, message } = options;\r\n  const formattedPhone = formatPhoneForSMS(phoneNumber);\r\n  const encodedMessage = encodeURIComponent(message);\r\n\r\n  const whatsappUrl = `https://wa.me/${formattedPhone}?text=${encodedMessage}`;\r\n\r\n  try {\r\n    window.open(whatsappUrl, '_blank');\r\n  } catch (error) {\r\n    console.error('Failed to open WhatsApp:', error);\r\n    // Fallback: copy message to clipboard\r\n    navigator.clipboard?.writeText(message).then(() => {\r\n      alert('WhatsApp not available. Message copied to clipboard.');\r\n    }).catch(() => {\r\n      alert('WhatsApp not available and clipboard access denied.');\r\n    });\r\n  }\r\n};\r\n\r\nexport const canSendSMS = (customer: { phoneNumber?: string | null }): boolean => {\r\n  return !!(customer.phoneNumber && customer.phoneNumber.trim());\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1367, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/utils/dateFilters.ts"],"sourcesContent":["\r\nimport { startOfDay, endOfDay, startOfWeek, endOfWeek, startOfMonth, endOfMonth, startOfYear, endOfYear, subDays, subWeeks, subMonths } from 'date-fns';\r\n\r\nexport const getDateRangeFromFilter = (filter: string): { from: Date; to: Date } => {\r\n  const now = new Date();\r\n  const today = startOfDay(now);\r\n  \r\n  switch (filter) {\r\n    case 'today':\r\n      return {\r\n        from: today,\r\n        to: endOfDay(now)\r\n      };\r\n    case 'yesterday':\r\n      const yesterday = subDays(today, 1);\r\n      return {\r\n        from: yesterday,\r\n        to: endOfDay(yesterday)\r\n      };\r\n    case 'this-week':\r\n      return {\r\n        from: startOfWeek(now),\r\n        to: endOfWeek(now)\r\n      };\r\n    case 'last-week':\r\n      const lastWeekStart = startOfWeek(subWeeks(now, 1));\r\n      return {\r\n        from: lastWeekStart,\r\n        to: endOfWeek(lastWeekStart)\r\n      };\r\n    case 'this-month':\r\n      return {\r\n        from: startOfMonth(now),\r\n        to: endOfMonth(now)\r\n      };\r\n    case 'last-month':\r\n      const lastMonthStart = startOfMonth(subMonths(now, 1));\r\n      return {\r\n        from: lastMonthStart,\r\n        to: endOfMonth(lastMonthStart)\r\n      };\r\n    case 'this-year':\r\n      return {\r\n        from: startOfYear(now),\r\n        to: endOfYear(now)\r\n      };\r\n    default:\r\n      // For 'all' or any other case, return a very wide range\r\n      return {\r\n        from: new Date(2000, 0, 1),\r\n        to: endOfDay(now)\r\n      };\r\n  }\r\n};\r\n\r\nexport const isDateInRange = (date: Date, from: Date | undefined, to: Date | undefined): boolean => {\r\n  if (!from && !to) return true;\r\n  if (!from) return date <= to!;\r\n  if (!to) return date >= from;\r\n  return date >= from && date <= to;\r\n};\r\n"],"names":[],"mappings":";;;;;;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAEO,MAAM,yBAAyB,CAAC;IACrC,MAAM,MAAM,IAAI;IAChB,MAAM,QAAQ,IAAA,0JAAU,EAAC;IAEzB,OAAQ;QACN,KAAK;YACH,OAAO;gBACL,MAAM;gBACN,IAAI,IAAA,sJAAQ,EAAC;YACf;QACF,KAAK;YACH,MAAM,YAAY,IAAA,oJAAO,EAAC,OAAO;YACjC,OAAO;gBACL,MAAM;gBACN,IAAI,IAAA,sJAAQ,EAAC;YACf;QACF,KAAK;YACH,OAAO;gBACL,MAAM,IAAA,4JAAW,EAAC;gBAClB,IAAI,IAAA,wJAAS,EAAC;YAChB;QACF,KAAK;YACH,MAAM,gBAAgB,IAAA,4JAAW,EAAC,IAAA,sJAAQ,EAAC,KAAK;YAChD,OAAO;gBACL,MAAM;gBACN,IAAI,IAAA,wJAAS,EAAC;YAChB;QACF,KAAK;YACH,OAAO;gBACL,MAAM,IAAA,8JAAY,EAAC;gBACnB,IAAI,IAAA,0JAAU,EAAC;YACjB;QACF,KAAK;YACH,MAAM,iBAAiB,IAAA,8JAAY,EAAC,IAAA,wJAAS,EAAC,KAAK;YACnD,OAAO;gBACL,MAAM;gBACN,IAAI,IAAA,0JAAU,EAAC;YACjB;QACF,KAAK;YACH,OAAO;gBACL,MAAM,IAAA,4JAAW,EAAC;gBAClB,IAAI,IAAA,wJAAS,EAAC;YAChB;QACF;YACE,wDAAwD;YACxD,OAAO;gBACL,MAAM,IAAI,KAAK,MAAM,GAAG;gBACxB,IAAI,IAAA,sJAAQ,EAAC;YACf;IACJ;AACF;AAEO,MAAM,gBAAgB,CAAC,MAAY,MAAwB;IAChE,IAAI,CAAC,QAAQ,CAAC,IAAI,OAAO;IACzB,IAAI,CAAC,MAAM,OAAO,QAAQ;IAC1B,IAAI,CAAC,IAAI,OAAO,QAAQ;IACxB,OAAO,QAAQ,QAAQ,QAAQ;AACjC"}},
    {"offset": {"line": 1448, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/utils/generateReceiptVectorPDF.ts"],"sourcesContent":["import jsPDF from 'jspdf';\r\nimport { ReceiptData } from '@/types/receipt';\r\n\r\ninterface VectorPDFOptions {\r\n  filename?: string;\r\n  orientation?: 'portrait' | 'landscape';\r\n  format?: 'a4' | 'letter';\r\n  margins?: {\r\n    top: number;\r\n    right: number;\r\n    bottom: number;\r\n    left: number;\r\n  };\r\n  returnBlob?: boolean;\r\n}\r\n\r\n// Helper function to format currency properly (e.g., \"Ush 25,000\")\r\nconst formatCurrency = (amount: number, currency: string = 'Ush'): string => {\r\n  const formatted = Math.round(amount).toLocaleString();\r\n  return `${currency} ${formatted}`;\r\n};\r\n\r\nexport const generateReceiptVectorPDF = async (\r\n  receiptData: ReceiptData,\r\n  options: VectorPDFOptions\r\n): Promise<void | Blob> => {\r\n  const {\r\n    filename,\r\n    orientation = 'portrait',\r\n    format = 'a4',\r\n    margins = { top: 20, right: 20, bottom: 20, left: 20 },\r\n    returnBlob = false\r\n  } = options;\r\n\r\n  const pdf = new jsPDF({\r\n    orientation,\r\n    unit: 'mm',\r\n    format,\r\n    compress: true\r\n  });\r\n\r\n  const pageWidth = pdf.internal.pageSize.getWidth();\r\n  const pageHeight = pdf.internal.pageSize.getHeight();\r\n  const contentWidth = pageWidth - margins.left - margins.right;\r\n  let currentY = margins.top;\r\n\r\n  // Define thinner line width\r\n  const STANDARD_LINE_WIDTH = 0.2;\r\n\r\n  // Helper functions\r\n  const setStandardLineWidth = () => {\r\n    pdf.setLineWidth(STANDARD_LINE_WIDTH);\r\n  };\r\n\r\n  const addText = (text: string, x: number, y: number, options: any = {}) => {\r\n    const { fontSize = 10, fontStyle = 'normal', align = 'left', maxWidth } = options;\r\n    pdf.setFontSize(fontSize);\r\n    pdf.setFont('helvetica', fontStyle);\r\n    \r\n    if (maxWidth) {\r\n      const lines = pdf.splitTextToSize(text, maxWidth);\r\n      pdf.text(lines, x, y, { align });\r\n      return lines.length * (fontSize * 0.35);\r\n    } else {\r\n      pdf.text(text, x, y, { align });\r\n      return fontSize * 0.35;\r\n    }\r\n  };\r\n\r\n  const addMultilineText = (text: string, x: number, y: number, maxWidth: number, options: any = {}) => {\r\n    const { fontSize = 10, fontStyle = 'normal', align = 'left', lineHeight = 1.2 } = options;\r\n    pdf.setFontSize(fontSize);\r\n    pdf.setFont('helvetica', fontStyle);\r\n    \r\n    const lines = pdf.splitTextToSize(text, maxWidth);\r\n    const lineSpacing = fontSize * 0.35 * lineHeight;\r\n    \r\n    lines.forEach((line: string, index: number) => {\r\n      pdf.text(line, x, y + (index * lineSpacing), { align });\r\n    });\r\n    \r\n    return lines.length * lineSpacing;\r\n  };\r\n\r\n  const addLine = (x1: number, y1: number, x2: number, y2: number) => {\r\n    setStandardLineWidth();\r\n    pdf.line(x1, y1, x2, y2);\r\n  };\r\n\r\n  const addRect = (x: number, y: number, width: number, height: number, style: 'S' | 'F' | 'FD' = 'S') => {\r\n    setStandardLineWidth();\r\n    pdf.rect(x, y, width, height, style);\r\n  };\r\n\r\n  // Function to draw page border\r\n  const drawPageBorder = () => {\r\n    addRect(margins.left, margins.top, contentWidth, pageHeight - margins.top - margins.bottom, 'S');\r\n  };\r\n\r\n  // Check if we need a new page and draw border\r\n  const checkPageBreak = (requiredSpace: number) => {\r\n    if (currentY + requiredSpace > pageHeight - margins.bottom) {\r\n      pdf.addPage();\r\n      currentY = margins.top + 10; // Add some top margin on new page\r\n      drawPageBorder(); // Draw border on new page\r\n      return true;\r\n    }\r\n    return false;\r\n  };\r\n\r\n  // Draw initial page border\r\n  drawPageBorder();\r\n\r\n  // Add padding inside border\r\n  const innerMargin = 8;\r\n  const innerLeft = margins.left + innerMargin;\r\n  const innerWidth = contentWidth - (innerMargin * 2);\r\n  currentY += innerMargin;\r\n\r\n  // Header section with logo on left, business info on right\r\n  const headerStartY = currentY;\r\n  \r\n  // Logo on the left (if available) - reduced size\r\n  if (receiptData.businessLogo) {\r\n    try {\r\n      const img = new Image();\r\n      img.crossOrigin = 'anonymous';\r\n      \r\n      await new Promise<void>((resolve, reject) => {\r\n        img.onload = () => {\r\n          try {\r\n            const canvas = document.createElement('canvas');\r\n            const ctx = canvas.getContext('2d');\r\n            if (ctx) {\r\n              canvas.width = img.width;\r\n              canvas.height = img.height;\r\n              ctx.drawImage(img, 0, 0);\r\n              \r\n              const dataURL = canvas.toDataURL('image/png');\r\n              \r\n              // Logo dimensions - reduced size for more professional look\r\n              const maxLogoHeight = 15; // Further reduced from 18\r\n              const aspectRatio = img.width / img.height;\r\n              const logoHeight = Math.min(maxLogoHeight, 15);\r\n              const logoWidth = logoHeight * aspectRatio;\r\n              \r\n              // Position logo on the left\r\n              pdf.addImage(dataURL, 'PNG', innerLeft, currentY, logoWidth, logoHeight);\r\n            }\r\n          } catch (error) {\r\n            console.error('Error adding logo to PDF:', error);\r\n          }\r\n          resolve();\r\n        };\r\n        \r\n        img.onerror = () => {\r\n          console.error('Error loading logo image');\r\n          resolve();\r\n        };\r\n        \r\n        img.src = receiptData.businessLogo;\r\n      });\r\n    } catch (error) {\r\n      console.error('Error processing logo:', error);\r\n    }\r\n  }\r\n\r\n  // Business information on the right - extended area with right alignment\r\n  const businessInfoX = innerLeft + innerWidth * 0.25; // Extended area starts earlier\r\n  const businessInfoWidth = innerWidth * 0.75; // Wider area for business info\r\n  const businessInfoRightX = innerLeft + innerWidth; // Right edge for alignment\r\n  let businessY = currentY;\r\n\r\n  if (receiptData.businessName) {\r\n    businessY += addText(receiptData.businessName, businessInfoRightX, businessY, {\r\n      fontSize: 14,\r\n      fontStyle: 'bold',\r\n      align: 'right'\r\n    });\r\n    businessY += 1.5; // Reduced spacing\r\n  }\r\n\r\n  if (receiptData.businessAddress) {\r\n    const lines = pdf.splitTextToSize(receiptData.businessAddress, businessInfoWidth);\r\n    const lineHeight = 10 * 0.35 * 0.9; // Further reduced line height\r\n    \r\n    lines.forEach((line: string, index: number) => {\r\n      pdf.setFontSize(10);\r\n      pdf.setFont('helvetica', 'normal');\r\n      pdf.text(line, businessInfoRightX, businessY + (index * lineHeight), { align: 'right' });\r\n    });\r\n    \r\n    businessY += lines.length * lineHeight + 0.5; // Reduced spacing\r\n  }\r\n\r\n  if (receiptData.businessPhone) {\r\n    businessY += addText(`Phone: ${receiptData.businessPhone}`, businessInfoRightX, businessY, {\r\n      fontSize: 9,\r\n      align: 'right'\r\n    });\r\n    businessY += 0.5; // Reduced spacing\r\n  }\r\n\r\n  if (receiptData.businessEmail) {\r\n    businessY += addText(`Email: ${receiptData.businessEmail}`, businessInfoRightX, businessY, {\r\n      fontSize: 9,\r\n      align: 'right'\r\n    });\r\n    businessY += 0.5; // Reduced spacing\r\n  }\r\n\r\n  // Move currentY to after header section - reduced spacing\r\n  currentY = Math.max(currentY + 18, businessY) + 5; // Further reduced spacing\r\n\r\n  // Check for page break after header\r\n  checkPageBreak(20);\r\n\r\n  // Horizontal line after header\r\n  addLine(innerLeft, currentY, innerLeft + innerWidth, currentY);\r\n  currentY += 6; // Reduced from 8\r\n\r\n  // Document title centered\r\n  currentY += addText(receiptData.documentTitle.toUpperCase(), pageWidth / 2, currentY, {\r\n    fontSize: 16,\r\n    fontStyle: 'bold',\r\n    align: 'center'\r\n  });\r\n  currentY += 4; // Reduced from 6\r\n\r\n  // Receipt details section - further reduced spacing\r\n  const detailsStartY = currentY;\r\n  \r\n  // Left side - Receipt details with minimal spacing\r\n  let leftY = detailsStartY;\r\n  leftY += addText(`${receiptData.documentNumberLabel} ${receiptData.receiptNumber}`, innerLeft, leftY, {\r\n    fontSize: 11,\r\n    fontStyle: 'bold'\r\n  });\r\n  leftY += 2; // Further reduced from 3\r\n  \r\n  leftY += addText(`Date: ${receiptData.date}`, innerLeft, leftY, {\r\n    fontSize: 10\r\n  });\r\n  leftY += 2; // Further reduced from 3\r\n  \r\n  leftY += addText(`Time: ${receiptData.time}`, innerLeft, leftY, {\r\n    fontSize: 10\r\n  });\r\n\r\n  // Right side - Payment status\r\n  const rightX = innerLeft + innerWidth * 0.7;\r\n  addText(`Status: ${receiptData.status}`, rightX, detailsStartY, {\r\n    fontSize: 11,\r\n    fontStyle: 'bold',\r\n    align: 'left'\r\n  });\r\n\r\n  currentY = leftY + 4; // Reduced from 6\r\n\r\n  // Customer information without labels\r\n  if (receiptData.customerName && receiptData.customerName.trim() !== '') {\r\n    checkPageBreak(30);\r\n    \r\n    currentY += addText('Customer Information:', innerLeft, currentY, {\r\n      fontSize: 11,\r\n      fontStyle: 'bold'\r\n    });\r\n    currentY += 3; // Reduced from 4\r\n\r\n    // Customer name without \"Name:\" label\r\n    currentY += addText(receiptData.customerName, innerLeft, currentY, {\r\n      fontSize: 10\r\n    });\r\n    currentY += 2.5; // Reduced spacing\r\n\r\n    if (receiptData.customerAddress && receiptData.customerAddress.trim() !== '') {\r\n      // Customer address without \"Address:\" label\r\n      const addressHeight = addMultilineText(receiptData.customerAddress, innerLeft, currentY, innerWidth * 0.8, {\r\n        fontSize: 10,\r\n        lineHeight: 1.0 // Reduced from 1.1\r\n      });\r\n      currentY += addressHeight;\r\n      currentY += 2.5; // Reduced spacing\r\n    }\r\n\r\n    if (receiptData.customerContact && receiptData.customerContact.trim() !== '') {\r\n      // Customer contact without \"Contact:\" label\r\n      currentY += addText(receiptData.customerContact, innerLeft, currentY, {\r\n        fontSize: 10\r\n      });\r\n      currentY += 2.5; // Reduced spacing\r\n    }\r\n\r\n    currentY += 3; // Reduced from 6\r\n  }\r\n\r\n  // Items table - check if any items have discounts to add discount column\r\n  const hasDiscounts = receiptData.items.some(item => \r\n    (item.discountPercentage || 0) > 0 || (item.discountAmount || 0) > 0\r\n  );\r\n  const tableHeaders = hasDiscounts \r\n    ? ['Description', 'Qty', 'Unit Price', 'Discount', 'Amount']\r\n    : ['Description', 'Qty', 'Unit Price', 'Amount'];\r\n  const colWidths = hasDiscounts\r\n    ? [innerWidth * 0.35, innerWidth * 0.15, innerWidth * 0.18, innerWidth * 0.12, innerWidth * 0.2]\r\n    : [innerWidth * 0.45, innerWidth * 0.15, innerWidth * 0.2, innerWidth * 0.2];\r\n  \r\n  // Table header background\r\n  pdf.setFillColor(245, 245, 245);\r\n  addRect(innerLeft, currentY - 2, innerWidth, 10, 'F');\r\n  \r\n  // Table header borders\r\n  addRect(innerLeft, currentY - 2, innerWidth, 10, 'S');\r\n  \r\n  // Table header text\r\n  let tableX = innerLeft;\r\n  tableHeaders.forEach((header, index) => {\r\n    addText(header, tableX + 3, currentY + 4, {\r\n      fontSize: 10,\r\n      fontStyle: 'bold'\r\n    });\r\n    // Add vertical lines between columns\r\n    if (index < tableHeaders.length - 1) {\r\n      addLine(tableX + colWidths[index], currentY - 2, tableX + colWidths[index], currentY + 8);\r\n    }\r\n    tableX += colWidths[index];\r\n  });\r\n  \r\n  currentY += 10;\r\n  \r\n  // Table rows with proper text wrapping and row separation\r\n  let subtotal = 0;\r\n  const minRowHeight = 8; // Minimum row height\r\n  \r\n  receiptData.items.forEach((item, index) => {\r\n    // Calculate required row height based on description text wrapping\r\n    pdf.setFontSize(9);\r\n    const descriptionLines = pdf.splitTextToSize(item.description, colWidths[0] - 6);\r\n    const calculatedRowHeight = Math.max(minRowHeight, descriptionLines.length * 3.5 + 4);\r\n    \r\n    // Check if we need a new page for this item\r\n    checkPageBreak(calculatedRowHeight + 5);\r\n    \r\n    const itemSubtotal = item.unitPrice * item.quantity;\r\n    const discountAmount = item.discountAmount || 0;\r\n    const itemTotal = item.amount; // This should already be calculated with discount applied\r\n    subtotal += itemTotal;\r\n    \r\n    // Alternate row background for better readability\r\n    if (index % 2 === 1) {\r\n      pdf.setFillColor(250, 250, 250);\r\n      addRect(innerLeft, currentY, innerWidth, calculatedRowHeight, 'F');\r\n    }\r\n    \r\n    // Row border\r\n    addRect(innerLeft, currentY, innerWidth, calculatedRowHeight, 'S');\r\n    \r\n    tableX = innerLeft;\r\n    \r\n    // Description with proper text wrapping\r\n    addMultilineText(item.description, tableX + 3, currentY + 4, colWidths[0] - 6, {\r\n      fontSize: 9,\r\n      lineHeight: 1.1\r\n    });\r\n    tableX += colWidths[0];\r\n    \r\n    // Add vertical line after description\r\n    addLine(tableX, currentY, tableX, currentY + calculatedRowHeight);\r\n    \r\n    // Quantity - centered in cell\r\n    addText(item.quantity.toString(), tableX + colWidths[1] - 3, currentY + calculatedRowHeight/2 + 1.5, {\r\n      fontSize: 9,\r\n      align: 'right'\r\n    });\r\n    tableX += colWidths[1];\r\n    \r\n    // Add vertical line after quantity\r\n    addLine(tableX, currentY, tableX, currentY + calculatedRowHeight);\r\n    \r\n    // Unit Price - right aligned\r\n    addText(formatCurrency(item.unitPrice, receiptData.currency), tableX + colWidths[2] - 3, currentY + calculatedRowHeight/2 + 1.5, {\r\n      fontSize: 9,\r\n      align: 'right'\r\n    });\r\n    tableX += colWidths[2];\r\n    \r\n    // Add vertical line after unit price\r\n    addLine(tableX, currentY, tableX, currentY + calculatedRowHeight);\r\n    \r\n    // Discount column (if applicable)\r\n    if (hasDiscounts) {\r\n      let discountText = '-';\r\n      if ((item.discountPercentage || 0) > 0) {\r\n        discountText = `${item.discountPercentage}%`;\r\n      } else if ((item.discountAmount || 0) > 0) {\r\n        discountText = formatCurrency(item.discountAmount, receiptData.currency);\r\n      }\r\n      addText(discountText, tableX + colWidths[3] - 3, currentY + calculatedRowHeight/2 + 1.5, {\r\n        fontSize: 9,\r\n        align: 'right'\r\n      });\r\n      tableX += colWidths[3];\r\n      \r\n      // Add vertical line after discount\r\n      addLine(tableX, currentY, tableX, currentY + calculatedRowHeight);\r\n    }\r\n    \r\n    // Amount - right aligned (final amount after discount)\r\n    const finalColumnIndex = hasDiscounts ? 4 : 3;\r\n    addText(formatCurrency(itemTotal, receiptData.currency), tableX + colWidths[finalColumnIndex] - 3, currentY + calculatedRowHeight/2 + 1.5, {\r\n      fontSize: 9,\r\n      align: 'right'\r\n    });\r\n    \r\n    currentY += calculatedRowHeight;\r\n    \r\n    // Add separator line between items (except for the last item)\r\n    if (index < receiptData.items.length - 1) {\r\n      addLine(innerLeft, currentY, innerLeft + innerWidth, currentY);\r\n    }\r\n  });\r\n  \r\n  currentY += 5; // Reduced from 10\r\n  \r\n  // Professional totals section with improved layout for large figures\r\n  checkPageBreak(70); // Increased space requirement for installment sales\r\n  \r\n  // Create a proper totals table without header\r\n  const totalsStartX = innerLeft + innerWidth * 0.45;\r\n  const totalsWidth = innerWidth * 0.55;\r\n  const labelWidth = totalsWidth * 0.55;\r\n  const valueWidth = totalsWidth * 0.45;\r\n  \r\n  // Calculate total discount for the totals section\r\n  const totalDiscount = receiptData.items.reduce((total, item) => {\r\n    const itemSubtotal = item.unitPrice * item.quantity;\r\n    const discountAmount = (item.discountType === 'amount') \r\n      ? (item.discountAmount || 0)\r\n      : (itemSubtotal * (item.discountPercentage || 0)) / 100;\r\n    return total + discountAmount;\r\n  }, 0);\r\n  \r\n  // Subtotal (before discount) row - only show if there are discounts\r\n  if (totalDiscount > 0) {\r\n    addRect(totalsStartX, currentY, totalsWidth, 8, 'S');\r\n    pdf.setFillColor(248, 248, 248);\r\n    addRect(totalsStartX, currentY, totalsWidth, 8, 'F');\r\n    \r\n    addText('Subtotal (before discount):', totalsStartX + 4, currentY + 5.5, {\r\n      fontSize: 10,\r\n      fontStyle: 'normal'\r\n    });\r\n    \r\n    // Vertical line separating label and value\r\n    addLine(totalsStartX + labelWidth, currentY, totalsStartX + labelWidth, currentY + 8);\r\n    \r\n    addText(formatCurrency(subtotal + totalDiscount, receiptData.currency), totalsStartX + labelWidth + valueWidth - 4, currentY + 5.5, {\r\n      fontSize: 10,\r\n      fontStyle: 'normal',\r\n      align: 'right'\r\n    });\r\n    currentY += 8;\r\n    \r\n    // Total discount row\r\n    addRect(totalsStartX, currentY, totalsWidth, 8, 'S');\r\n    pdf.setFillColor(255, 240, 220); // Light orange background\r\n    addRect(totalsStartX, currentY, totalsWidth, 8, 'F');\r\n    \r\n    addText('Total Discount:', totalsStartX + 4, currentY + 5.5, {\r\n      fontSize: 10,\r\n      fontStyle: 'normal'\r\n    });\r\n    \r\n    // Vertical line separating label and value\r\n    addLine(totalsStartX + labelWidth, currentY, totalsStartX + labelWidth, currentY + 8);\r\n    \r\n    addText(`-${formatCurrency(totalDiscount, receiptData.currency)}`, totalsStartX + labelWidth + valueWidth - 4, currentY + 5.5, {\r\n      fontSize: 10,\r\n      fontStyle: 'normal',\r\n      align: 'right'\r\n    });\r\n    currentY += 8;\r\n  }\r\n  \r\n  // Subtotal row (after discount or just subtotal if no discounts)\r\n  addRect(totalsStartX, currentY, totalsWidth, 8, 'S');\r\n  pdf.setFillColor(248, 248, 248);\r\n  addRect(totalsStartX, currentY, totalsWidth, 8, 'F');\r\n  \r\n  addText(totalDiscount > 0 ? 'Subtotal (after discount):' : 'Subtotal:', totalsStartX + 4, currentY + 5.5, {\r\n    fontSize: 10,\r\n    fontStyle: 'normal'\r\n  });\r\n  \r\n  // Vertical line separating label and value\r\n  addLine(totalsStartX + labelWidth, currentY, totalsStartX + labelWidth, currentY + 8);\r\n  \r\n  addText(formatCurrency(subtotal, receiptData.currency), totalsStartX + labelWidth + valueWidth - 4, currentY + 5.5, {\r\n    fontSize: 10,\r\n    fontStyle: 'normal',\r\n    align: 'right'\r\n  });\r\n  currentY += 8;\r\n  \r\n  // Tax row (if applicable)\r\n  if (receiptData.showTaxRow && receiptData.taxAmount > 0) {\r\n    addRect(totalsStartX, currentY, totalsWidth, 8, 'S');\r\n    pdf.setFillColor(250, 250, 250);\r\n    addRect(totalsStartX, currentY, totalsWidth, 8, 'F');\r\n    \r\n    addText(`Tax (${receiptData.taxRate}%):`, totalsStartX + 4, currentY + 5.5, {\r\n      fontSize: 10,\r\n      fontStyle: 'normal'\r\n    });\r\n    \r\n    // Vertical line separating label and value\r\n    addLine(totalsStartX + labelWidth, currentY, totalsStartX + labelWidth, currentY + 8);\r\n    \r\n    addText(formatCurrency(receiptData.taxAmount, receiptData.currency), totalsStartX + labelWidth + valueWidth - 4, currentY + 5.5, {\r\n      fontSize: 10,\r\n      fontStyle: 'normal',\r\n      align: 'right'\r\n    });\r\n    currentY += 8;\r\n  }\r\n  \r\n  // Total row with emphasis and larger height for big figures\r\n  addRect(totalsStartX, currentY, totalsWidth, 12, 'S');\r\n  pdf.setFillColor(220, 220, 220);\r\n  addRect(totalsStartX, currentY, totalsWidth, 12, 'F');\r\n  \r\n  addText('TOTAL:', totalsStartX + 4, currentY + 7.5, {\r\n    fontSize: 12,\r\n    fontStyle: 'bold'\r\n  });\r\n  \r\n  // Vertical line separating label and value\r\n  addLine(totalsStartX + labelWidth, currentY, totalsStartX + labelWidth, currentY + 12);\r\n  \r\n  addText(formatCurrency(receiptData.totalAmount, receiptData.currency), totalsStartX + labelWidth + valueWidth - 4, currentY + 7.5, {\r\n    fontSize: 12,\r\n    fontStyle: 'bold',\r\n    align: 'right'\r\n  });\r\n  currentY += 12;\r\n\r\n  // Add Amount Paid and Amount Due for installment sales\r\n  if (receiptData.isInstallmentSale) {\r\n    // Amount Paid row\r\n    if (receiptData.amountPaid !== undefined) {\r\n      addRect(totalsStartX, currentY, totalsWidth, 8, 'S');\r\n      pdf.setFillColor(240, 248, 255); // Light blue background\r\n      addRect(totalsStartX, currentY, totalsWidth, 8, 'F');\r\n      \r\n      addText('Amount Paid:', totalsStartX + 4, currentY + 5.5, {\r\n        fontSize: 10,\r\n        fontStyle: 'bold'\r\n      });\r\n      \r\n      // Vertical line separating label and value\r\n      addLine(totalsStartX + labelWidth, currentY, totalsStartX + labelWidth, currentY + 8);\r\n      \r\n      addText(formatCurrency(receiptData.amountPaid, receiptData.currency), totalsStartX + labelWidth + valueWidth - 4, currentY + 5.5, {\r\n        fontSize: 10,\r\n        fontStyle: 'bold',\r\n        align: 'right'\r\n      });\r\n      currentY += 8;\r\n    }\r\n    \r\n    // Amount Due row\r\n    if (receiptData.amountDue !== undefined) {\r\n      addRect(totalsStartX, currentY, totalsWidth, 8, 'S');\r\n      pdf.setFillColor(255, 240, 240); // Light red background\r\n      addRect(totalsStartX, currentY, totalsWidth, 8, 'F');\r\n      \r\n      addText('Amount Due:', totalsStartX + 4, currentY + 5.5, {\r\n        fontSize: 10,\r\n        fontStyle: 'bold'\r\n      });\r\n      \r\n      // Vertical line separating label and value\r\n      addLine(totalsStartX + labelWidth, currentY, totalsStartX + labelWidth, currentY + 8);\r\n      \r\n      addText(formatCurrency(receiptData.amountDue, receiptData.currency), totalsStartX + labelWidth + valueWidth - 4, currentY + 5.5, {\r\n        fontSize: 10,\r\n        fontStyle: 'bold',\r\n        align: 'right'\r\n      });\r\n      currentY += 8;\r\n    }\r\n  }\r\n  \r\n  currentY += 7; // Reduced from 15\r\n\r\n  // Amount in words with slightly increased spacing\r\n  if (receiptData.totalAmountInWords) {\r\n    checkPageBreak(20);\r\n    \r\n    currentY += 2; // Keep existing spacing\r\n    addText('Amount in words:', innerLeft, currentY, {\r\n      fontSize: 10,\r\n      fontStyle: 'bold'\r\n    });\r\n    currentY += 4; // Increased from 3 to 4\r\n    \r\n    // Better text wrapping for amount in words with increased line height\r\n    const amountText = `${receiptData.currency} ${receiptData.totalAmountInWords} only`;\r\n    const wordsHeight = addMultilineText(amountText, innerLeft, currentY, innerWidth * 0.9, {\r\n      fontSize: 10,\r\n      fontStyle: 'italic',\r\n      lineHeight: 1.4 // Increased from 1.2 to 1.4 for better spacing\r\n    });\r\n    currentY += wordsHeight + 4; // Increased from 3 to 4\r\n  }\r\n\r\n  // Improved Payment information table with reduced spacing\r\n  if (receiptData.hasPaymentInfo && receiptData.paymentMethods && receiptData.paymentMethods.length > 0) {\r\n    checkPageBreak(40);\r\n    \r\n    // Strong separator line with reduced spacing\r\n    addLine(innerLeft, currentY, innerLeft + innerWidth, currentY);\r\n    currentY += 5; // Reduced from 8\r\n\r\n    addText('Payment Information:', innerLeft, currentY, {\r\n      fontSize: 11,\r\n      fontStyle: 'bold'\r\n    });\r\n    currentY += 4; // Reduced from 6\r\n\r\n    // Payment table with better proportions\r\n    const paymentHeaders = ['Payment Method', 'Account Number', 'Account Name'];\r\n    const paymentColWidths = [innerWidth * 0.28, innerWidth * 0.36, innerWidth * 0.36];\r\n    \r\n    // Header background with stronger color\r\n    pdf.setFillColor(240, 240, 240);\r\n    const headerHeight = 10;\r\n    addRect(innerLeft, currentY - 2, innerWidth, headerHeight, 'F');\r\n    addRect(innerLeft, currentY - 2, innerWidth, headerHeight, 'S');\r\n    \r\n    // Header text with proper spacing\r\n    let paymentX = innerLeft;\r\n    paymentHeaders.forEach((header, index) => {\r\n      addText(header, paymentX + 4, currentY + 4, {\r\n        fontSize: 9,\r\n        fontStyle: 'bold'\r\n      });\r\n      if (index < paymentHeaders.length - 1) {\r\n        addLine(paymentX + paymentColWidths[index], currentY - 2, paymentX + paymentColWidths[index], currentY + headerHeight - 2);\r\n      }\r\n      paymentX += paymentColWidths[index];\r\n    });\r\n    \r\n    currentY += headerHeight;\r\n    \r\n    // Payment rows with consistent formatting\r\n    const validPayments = receiptData.paymentMethods.filter(payment => \r\n      payment.method.trim() || payment.accountNumber.trim() || payment.accountName.trim()\r\n    );\r\n    \r\n    validPayments.forEach((payment, index) => {\r\n      const rowHeight = 10;\r\n      checkPageBreak(rowHeight + 5);\r\n      \r\n      // Alternating row colors\r\n      if (index % 2 === 1) {\r\n        pdf.setFillColor(248, 248, 248);\r\n        addRect(innerLeft, currentY, innerWidth, rowHeight, 'F');\r\n      }\r\n      \r\n      // Row border\r\n      addRect(innerLeft, currentY, innerWidth, rowHeight, 'S');\r\n      \r\n      paymentX = innerLeft;\r\n      \r\n      // Payment method\r\n      addText(payment.method, paymentX + 4, currentY + 5, {\r\n        fontSize: 9,\r\n        fontStyle: 'bold'\r\n      });\r\n      paymentX += paymentColWidths[0];\r\n      addLine(paymentX, currentY, paymentX, currentY + rowHeight);\r\n      \r\n      // Account number\r\n      addText(payment.accountNumber, paymentX + 4, currentY + 5, {\r\n        fontSize: 9\r\n      });\r\n      paymentX += paymentColWidths[1];\r\n      addLine(paymentX, currentY, paymentX, currentY + rowHeight);\r\n      \r\n      // Account name\r\n      addText(payment.accountName, paymentX + 4, currentY + 5, {\r\n        fontSize: 9\r\n      });\r\n      \r\n      currentY += rowHeight;\r\n    });\r\n    \r\n    currentY += 4; // Reduced from 8\r\n  }\r\n\r\n  // Notes section (if available)\r\n  if (receiptData.notes && receiptData.notes.trim()) {\r\n    checkPageBreak(25);\r\n    \r\n    // Add separator line\r\n    addLine(innerLeft, currentY, innerLeft + innerWidth, currentY);\r\n    currentY += 4;\r\n    \r\n    // Notes title\r\n    addText('Notes:', innerLeft, currentY, {\r\n      fontSize: 11,\r\n      fontStyle: 'bold'\r\n    });\r\n    currentY += 6;\r\n    \r\n    // Notes content with text wrapping\r\n    const maxWidth = innerWidth - 8;\r\n    const lines = pdf.splitTextToSize(receiptData.notes, maxWidth);\r\n    \r\n    lines.forEach((line: string) => {\r\n      checkPageBreak(8);\r\n      addText(line, innerLeft + 4, currentY, {\r\n        fontSize: 10\r\n      });\r\n      currentY += 5;\r\n    });\r\n    \r\n    currentY += 4;\r\n  }\r\n\r\n  // Signature section (if available) with reduced spacing\r\n  if (receiptData.signature) {\r\n    try {\r\n      checkPageBreak(35);\r\n      \r\n      const img = new Image();\r\n      img.crossOrigin = 'anonymous';\r\n      \r\n      await new Promise<void>((resolve) => {\r\n        img.onload = () => {\r\n          try {\r\n            const canvas = document.createElement('canvas');\r\n            const ctx = canvas.getContext('2d');\r\n            if (ctx) {\r\n              canvas.width = img.width;\r\n              canvas.height = img.height;\r\n              ctx.drawImage(img, 0, 0);\r\n              \r\n              const dataURL = canvas.toDataURL('image/png');\r\n              \r\n              // Calculate signature dimensions while maintaining aspect ratio\r\n              const maxSigWidth = 40;\r\n              const maxSigHeight = 20;\r\n              const aspectRatio = img.width / img.height;\r\n              \r\n              let sigWidth, sigHeight;\r\n              \r\n              // Calculate dimensions based on aspect ratio\r\n              if (aspectRatio > (maxSigWidth / maxSigHeight)) {\r\n                // Image is wider, constrain by width\r\n                sigWidth = maxSigWidth;\r\n                sigHeight = maxSigWidth / aspectRatio;\r\n              } else {\r\n                // Image is taller, constrain by height\r\n                sigHeight = maxSigHeight;\r\n                sigWidth = maxSigHeight * aspectRatio;\r\n              }\r\n              \r\n              // Position signature on the right\r\n              const sigX = innerLeft + innerWidth - sigWidth;\r\n              \r\n              addLine(innerLeft, currentY, innerLeft + innerWidth, currentY);\r\n              currentY += 4; // Reduced from 6\r\n              \r\n              pdf.addImage(dataURL, 'PNG', sigX, currentY, sigWidth, sigHeight);\r\n              currentY += sigHeight + 2; // Reduced from 3\r\n              \r\n              addText('Authorized Signature', sigX + sigWidth / 2, currentY, {\r\n                fontSize: 8,\r\n                align: 'center'\r\n              });\r\n              currentY += 4; // Reduced from 6\r\n            }\r\n          } catch (error) {\r\n            console.error('Error adding signature to PDF:', error);\r\n          }\r\n          resolve();\r\n        };\r\n        \r\n        img.onerror = () => {\r\n          console.error('Error loading signature image');\r\n          resolve();\r\n        };\r\n        \r\n        img.src = receiptData.signature;\r\n      });\r\n    } catch (error) {\r\n      console.error('Error processing signature:', error);\r\n    }\r\n  }\r\n\r\n  // Footer message with reduced spacing\r\n  checkPageBreak(25);\r\n  currentY += 6; // Reduced from 8\r\n  addText('Thank you for your business!', pageWidth / 2, currentY, {\r\n    fontSize: 11,\r\n    fontStyle: 'bold',\r\n    align: 'center'\r\n  });\r\n  \r\n  currentY += 5; // Add spacing between messages\r\n  addText('Created by Gonza Systems', pageWidth / 2, currentY, {\r\n    fontSize: 9,\r\n    align: 'center'\r\n  });\r\n\r\n  // Return blob or download\r\n  if (returnBlob) {\r\n    return pdf.output('blob');\r\n  } else if (filename) {\r\n    pdf.save(filename);\r\n  }\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2147, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/utils/generatePDF.ts"],"sourcesContent":["import { generateReceiptVectorPDF } from './generateReceiptVectorPDF';\r\nimport { isIOS } from './deviceDetection';\r\nimport { ReceiptData } from '@/types/receipt';\r\n\r\ninterface PDFOptions {\r\n  autoPrint?: boolean;\r\n  isReceipt?: boolean;\r\n}\r\n\r\n// Legacy function for non-receipt PDFs (keeping image-based approach for now)\r\nconst generateImagePDF = async (element: HTMLElement, filename: string, options: PDFOptions = {}) => {\r\n  const { generateVectorPDF } = await import('./generateVectorPDF');\r\n  await generateVectorPDF(element, {\r\n    filename,\r\n    orientation: 'landscape',\r\n    format: 'a4',\r\n    margins: { top: 10, right: 10, bottom: 10, left: 10 }\r\n  });\r\n};\r\n\r\nexport const generatePDF = async (\r\n  element: HTMLElement, \r\n  filename: string, \r\n  options: PDFOptions = {}\r\n): Promise<void> => {\r\n  const { autoPrint = false, isReceipt = false } = options;\r\n\r\n  try {\r\n    if (isIOS()) {\r\n      // For iOS, use the original approach\r\n      await generateImagePDF(element, filename, options);\r\n    } else {\r\n      // For receipts, we'll need to extract data from the element\r\n      // For now, fall back to image-based approach for non-receipt PDFs\r\n      if (!isReceipt) {\r\n        await generateImagePDF(element, filename, options);\r\n      } else {\r\n        // This will be handled by the PrintableReceipt component\r\n        // which will call generateReceiptVectorPDF directly with structured data\r\n        await generateImagePDF(element, filename, options);\r\n      }\r\n\r\n      if (autoPrint) {\r\n        setTimeout(() => {\r\n          window.print();\r\n        }, 500);\r\n      }\r\n    }\r\n  } catch (error) {\r\n    console.error('Error generating PDF:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n// Export the new vector PDF function for direct use\r\nexport { generateReceiptVectorPDF };\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAQA,8EAA8E;AAC9E,MAAM,mBAAmB,OAAO,SAAsB,UAAkB,UAAsB,CAAC,CAAC;IAC9F,MAAM,EAAE,iBAAiB,EAAE,GAAG;IAC9B,MAAM,kBAAkB,SAAS;QAC/B;QACA,aAAa;QACb,QAAQ;QACR,SAAS;YAAE,KAAK;YAAI,OAAO;YAAI,QAAQ;YAAI,MAAM;QAAG;IACtD;AACF;AAEO,MAAM,cAAc,OACzB,SACA,UACA,UAAsB,CAAC,CAAC;IAExB,MAAM,EAAE,YAAY,KAAK,EAAE,YAAY,KAAK,EAAE,GAAG;IAEjD,IAAI;QACF,IAAI,IAAA,2IAAK,KAAI;YACX,qCAAqC;YACrC,MAAM,iBAAiB,SAAS,UAAU;QAC5C,OAAO;YACL,4DAA4D;YAC5D,kEAAkE;YAClE,IAAI,CAAC,WAAW;gBACd,MAAM,iBAAiB,SAAS,UAAU;YAC5C,OAAO;gBACL,yDAAyD;gBACzD,yEAAyE;gBACzE,MAAM,iBAAiB,SAAS,UAAU;YAC5C;YAEA,IAAI,WAAW;gBACb,WAAW;oBACT,OAAO,KAAK;gBACd,GAAG;YACL;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,MAAM;IACR;AACF"}},
    {"offset": {"line": 2205, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/utils/directPrint.ts"],"sourcesContent":["\r\n/**\r\n * Triggers the device's native print functionality\r\n * Works on iOS, Android, and desktop browsers\r\n */\r\nexport const directPrint = (element: HTMLElement, documentName?: string, isThermal?: boolean): void => {\r\n  // Create a new window for printing\r\n  const printWindow = window.open('', '_blank');\r\n\r\n  if (!printWindow) {\r\n    // Fallback: use current window print if popup is blocked\r\n    window.print();\r\n    return;\r\n  }\r\n\r\n  // Get all stylesheets from the current document\r\n  const stylesheets = Array.from(document.styleSheets);\r\n  let stylesHtml = '';\r\n\r\n  // Include all CSS rules\r\n  stylesheets.forEach(stylesheet => {\r\n    try {\r\n      if (stylesheet.href) {\r\n        // External stylesheet\r\n        stylesHtml += `<link rel=\"stylesheet\" href=\"${stylesheet.href}\">`;\r\n      } else if (stylesheet.cssRules) {\r\n        // Inline stylesheet\r\n        stylesHtml += '<style>';\r\n        Array.from(stylesheet.cssRules).forEach(rule => {\r\n          stylesHtml += rule.cssText;\r\n        });\r\n        stylesHtml += '</style>';\r\n      }\r\n    } catch (e) {\r\n      // Some stylesheets might not be accessible due to CORS\r\n      console.warn('Could not access stylesheet:', e);\r\n    }\r\n  });\r\n\r\n  // Use the provided document name or default to \"Print\"\r\n  const title = documentName || 'Print';\r\n\r\n  // Thermal-specific CSS for single-sheet printing\r\n  const thermalCSS = isThermal ? `\r\n    @page { \r\n      size: 80mm auto; \r\n      margin: 0; \r\n    }\r\n    .thermal-receipt { \r\n      font-size: 14px !important; \r\n      font-weight: 800 !important;\r\n      padding: 8px !important;\r\n      page-break-after: avoid !important;\r\n    }\r\n    .thermal-receipt .font-extrabold { \r\n      font-weight: 900 !important; \r\n    }\r\n    .thermal-receipt .font-bold { \r\n      font-weight: 800 !important; \r\n    }\r\n  ` : '';\r\n\r\n  // Create the print document\r\n  printWindow.document.write(`\r\n    <!DOCTYPE html>\r\n    <html>\r\n      <head>\r\n        <title>${title}</title>\r\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n        ${stylesHtml}\r\n        <style>\r\n          @media print {\r\n            body { margin: 0; }\r\n            .print\\\\:hidden { display: none !important; }\r\n            ${thermalCSS}\r\n          }\r\n          body {\r\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\r\n            margin: ${isThermal ? '0' : '20px'};\r\n          }\r\n        </style>\r\n      </head>\r\n      <body>\r\n        ${element.outerHTML}\r\n      </body>\r\n    </html>\r\n  `);\r\n\r\n  printWindow.document.close();\r\n\r\n  // Track if we've already handled the cleanup\r\n  let cleanupHandled = false;\r\n\r\n  // Cleanup function to avoid duplicate redirects\r\n  const handleCleanup = () => {\r\n    if (cleanupHandled) return;\r\n    cleanupHandled = true;\r\n\r\n    try {\r\n      if (!printWindow.closed) {\r\n        printWindow.close();\r\n      }\r\n    } catch (error) {\r\n      console.warn('Could not close print window:', error);\r\n    }\r\n\r\n    // No redirect needed - user stays on current page after printing\r\n  };\r\n\r\n  // Wait for content to load, then trigger print\r\n  printWindow.onload = () => {\r\n    printWindow.focus();\r\n    printWindow.print();\r\n\r\n    // Listen for when the print dialog is closed\r\n    printWindow.onafterprint = () => {\r\n      handleCleanup();\r\n    };\r\n\r\n    // Listen for beforeunload to detect cancel scenarios\r\n    printWindow.onbeforeunload = () => {\r\n      if (!cleanupHandled) {\r\n        setTimeout(handleCleanup, 100);\r\n      }\r\n    };\r\n\r\n    // Reduced timeout for better UX - close after 1.5 seconds\r\n    setTimeout(() => {\r\n      handleCleanup();\r\n    }, 1500);\r\n  };\r\n\r\n  // Error handling for window load failure\r\n  printWindow.onerror = () => {\r\n    console.warn('Print window failed to load');\r\n    handleCleanup();\r\n  };\r\n};\r\n"],"names":[],"mappings":"AACA;;;CAGC;;;;AACM,MAAM,cAAc,CAAC,SAAsB,cAAuB;IACvE,mCAAmC;IACnC,MAAM,cAAc,OAAO,IAAI,CAAC,IAAI;IAEpC,IAAI,CAAC,aAAa;QAChB,yDAAyD;QACzD,OAAO,KAAK;QACZ;IACF;IAEA,gDAAgD;IAChD,MAAM,cAAc,MAAM,IAAI,CAAC,SAAS,WAAW;IACnD,IAAI,aAAa;IAEjB,wBAAwB;IACxB,YAAY,OAAO,CAAC,CAAA;QAClB,IAAI;YACF,IAAI,WAAW,IAAI,EAAE;gBACnB,sBAAsB;gBACtB,cAAc,CAAC,6BAA6B,EAAE,WAAW,IAAI,CAAC,EAAE,CAAC;YACnE,OAAO,IAAI,WAAW,QAAQ,EAAE;gBAC9B,oBAAoB;gBACpB,cAAc;gBACd,MAAM,IAAI,CAAC,WAAW,QAAQ,EAAE,OAAO,CAAC,CAAA;oBACtC,cAAc,KAAK,OAAO;gBAC5B;gBACA,cAAc;YAChB;QACF,EAAE,OAAO,GAAG;YACV,uDAAuD;YACvD,QAAQ,IAAI,CAAC,gCAAgC;QAC/C;IACF;IAEA,uDAAuD;IACvD,MAAM,QAAQ,gBAAgB;IAE9B,iDAAiD;IACjD,MAAM,aAAa,YAAY,CAAC;;;;;;;;;;;;;;;;;EAiBhC,CAAC,GAAG;IAEJ,4BAA4B;IAC5B,YAAY,QAAQ,CAAC,KAAK,CAAC,CAAC;;;;eAIf,EAAE,MAAM;;QAEf,EAAE,WAAW;;;;;YAKT,EAAE,WAAW;;;;oBAIL,EAAE,YAAY,MAAM,OAAO;;;;;QAKvC,EAAE,QAAQ,SAAS,CAAC;;;EAG1B,CAAC;IAED,YAAY,QAAQ,CAAC,KAAK;IAE1B,6CAA6C;IAC7C,IAAI,iBAAiB;IAErB,gDAAgD;IAChD,MAAM,gBAAgB;QACpB,IAAI,gBAAgB;QACpB,iBAAiB;QAEjB,IAAI;YACF,IAAI,CAAC,YAAY,MAAM,EAAE;gBACvB,YAAY,KAAK;YACnB;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,IAAI,CAAC,iCAAiC;QAChD;IAEA,iEAAiE;IACnE;IAEA,+CAA+C;IAC/C,YAAY,MAAM,GAAG;QACnB,YAAY,KAAK;QACjB,YAAY,KAAK;QAEjB,6CAA6C;QAC7C,YAAY,YAAY,GAAG;YACzB;QACF;QAEA,qDAAqD;QACrD,YAAY,cAAc,GAAG;YAC3B,IAAI,CAAC,gBAAgB;gBACnB,WAAW,eAAe;YAC5B;QACF;QAEA,0DAA0D;QAC1D,WAAW;YACT;QACF,GAAG;IACL;IAEA,yCAAyC;IACzC,YAAY,OAAO,GAAG;QACpB,QAAQ,IAAI,CAAC;QACb;IACF;AACF"}},
    {"offset": {"line": 2336, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/utils/numberToWords.ts"],"sourcesContent":["\r\n/**\r\n * Converts a number to words representation\r\n * @param num The number to convert to words\r\n * @returns The number expressed in words\r\n */\r\nexport function numberToWords(num: number): string {\r\n  const specialNames = ['', 'thousand', 'million', 'billion', 'trillion', 'quadrillion'];\r\n  const tensNames = ['', 'ten', 'twenty', 'thirty', 'forty', 'fifty', 'sixty', 'seventy', 'eighty', 'ninety'];\r\n  const onesNames = ['', 'one', 'two', 'three', 'four', 'five', 'six', 'seven', 'eight', 'nine', 'ten', \r\n    'eleven', 'twelve', 'thirteen', 'fourteen', 'fifteen', 'sixteen', 'seventeen', 'eighteen', 'nineteen'];\r\n\r\n  // Handles decimals by splitting the number into whole and decimal parts\r\n  const handleDecimals = (n: number): string => {\r\n    const numStr = n.toFixed(2);\r\n    const parts = numStr.split('.');\r\n    const wholeStr = convertNumberToWords(parseInt(parts[0]));\r\n    \r\n    // If there are meaningful decimals (not just .00)\r\n    if (parts.length > 1 && parseInt(parts[1]) > 0) {\r\n      // Format the decimal part as cents\r\n      return `${wholeStr} and ${parts[1]}/100`;\r\n    }\r\n    return wholeStr;\r\n  };\r\n\r\n  // Core conversion function for whole numbers\r\n  const convertNumberToWords = (n: number): string => {\r\n    // Handle zero\r\n    if (n === 0) return 'zero';\r\n    \r\n    // Handle negative numbers\r\n    if (n < 0) return `negative ${convertNumberToWords(Math.abs(n))}`;\r\n    \r\n    let result = '';\r\n    let numIndex = 0;\r\n    \r\n    // Process the number in chunks of three digits\r\n    while (n > 0) {\r\n      if (n % 1000 !== 0) {\r\n        result = `${convertLessThanOneThousand(n % 1000)} ${specialNames[numIndex]} ${result}`;\r\n      }\r\n      n = Math.floor(n / 1000);\r\n      numIndex++;\r\n    }\r\n    \r\n    return result.trim();\r\n  };\r\n\r\n  // Converts a number less than 1000 to words\r\n  const convertLessThanOneThousand = (n: number): string => {\r\n    if (n === 0) return '';\r\n    \r\n    let result = '';\r\n    \r\n    // Handle hundreds\r\n    if (n >= 100) {\r\n      result = `${onesNames[Math.floor(n / 100)]} hundred `;\r\n      n %= 100;\r\n      if (n === 0) return result.trim();\r\n    }\r\n    \r\n    // Handle tens and ones places\r\n    if (n < 20) {\r\n      // For numbers less than 20, use the direct name\r\n      result += onesNames[n];\r\n    } else {\r\n      // For numbers 20 and above, combine tens and ones names\r\n      result += `${tensNames[Math.floor(n / 10)]}`;\r\n      if (n % 10 > 0) {\r\n        result += `-${onesNames[n % 10]}`;\r\n      }\r\n    }\r\n    \r\n    return result.trim();\r\n  };\r\n\r\n  // Start the conversion process\r\n  return handleDecimals(num).trim().charAt(0).toUpperCase() + handleDecimals(num).trim().slice(1);\r\n}\r\n"],"names":[],"mappings":"AACA;;;;CAIC;;;;AACM,SAAS,cAAc,GAAW;IACvC,MAAM,eAAe;QAAC;QAAI;QAAY;QAAW;QAAW;QAAY;KAAc;IACtF,MAAM,YAAY;QAAC;QAAI;QAAO;QAAU;QAAU;QAAS;QAAS;QAAS;QAAW;QAAU;KAAS;IAC3G,MAAM,YAAY;QAAC;QAAI;QAAO;QAAO;QAAS;QAAQ;QAAQ;QAAO;QAAS;QAAS;QAAQ;QAC7F;QAAU;QAAU;QAAY;QAAY;QAAW;QAAW;QAAa;QAAY;KAAW;IAExG,wEAAwE;IACxE,MAAM,iBAAiB,CAAC;QACtB,MAAM,SAAS,EAAE,OAAO,CAAC;QACzB,MAAM,QAAQ,OAAO,KAAK,CAAC;QAC3B,MAAM,WAAW,qBAAqB,SAAS,KAAK,CAAC,EAAE;QAEvD,kDAAkD;QAClD,IAAI,MAAM,MAAM,GAAG,KAAK,SAAS,KAAK,CAAC,EAAE,IAAI,GAAG;YAC9C,mCAAmC;YACnC,OAAO,GAAG,SAAS,KAAK,EAAE,KAAK,CAAC,EAAE,CAAC,IAAI,CAAC;QAC1C;QACA,OAAO;IACT;IAEA,6CAA6C;IAC7C,MAAM,uBAAuB,CAAC;QAC5B,cAAc;QACd,IAAI,MAAM,GAAG,OAAO;QAEpB,0BAA0B;QAC1B,IAAI,IAAI,GAAG,OAAO,CAAC,SAAS,EAAE,qBAAqB,KAAK,GAAG,CAAC,KAAK;QAEjE,IAAI,SAAS;QACb,IAAI,WAAW;QAEf,+CAA+C;QAC/C,MAAO,IAAI,EAAG;YACZ,IAAI,IAAI,SAAS,GAAG;gBAClB,SAAS,GAAG,2BAA2B,IAAI,MAAM,CAAC,EAAE,YAAY,CAAC,SAAS,CAAC,CAAC,EAAE,QAAQ;YACxF;YACA,IAAI,KAAK,KAAK,CAAC,IAAI;YACnB;QACF;QAEA,OAAO,OAAO,IAAI;IACpB;IAEA,4CAA4C;IAC5C,MAAM,6BAA6B,CAAC;QAClC,IAAI,MAAM,GAAG,OAAO;QAEpB,IAAI,SAAS;QAEb,kBAAkB;QAClB,IAAI,KAAK,KAAK;YACZ,SAAS,GAAG,SAAS,CAAC,KAAK,KAAK,CAAC,IAAI,KAAK,CAAC,SAAS,CAAC;YACrD,KAAK;YACL,IAAI,MAAM,GAAG,OAAO,OAAO,IAAI;QACjC;QAEA,8BAA8B;QAC9B,IAAI,IAAI,IAAI;YACV,gDAAgD;YAChD,UAAU,SAAS,CAAC,EAAE;QACxB,OAAO;YACL,wDAAwD;YACxD,UAAU,GAAG,SAAS,CAAC,KAAK,KAAK,CAAC,IAAI,IAAI,EAAE;YAC5C,IAAI,IAAI,KAAK,GAAG;gBACd,UAAU,CAAC,CAAC,EAAE,SAAS,CAAC,IAAI,GAAG,EAAE;YACnC;QACF;QAEA,OAAO,OAAO,IAAI;IACpB;IAEA,+BAA+B;IAC/B,OAAO,eAAe,KAAK,IAAI,GAAG,MAAM,CAAC,GAAG,WAAW,KAAK,eAAe,KAAK,IAAI,GAAG,KAAK,CAAC;AAC/F"}},
    {"offset": {"line": 2450, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/utils/thermalPrinterPlug.ts"],"sourcesContent":["import { Capacitor } from '@capacitor/core';\r\n\r\nexport async function checkBridgeStatus() {\r\n  const addresses = ['http://localhost:5000', 'http://127.0.0.1:5000'];\r\n\r\n  for (const addr of addresses) {\r\n    try {\r\n      const response = await fetch(`${addr}/printers`, {\r\n        signal: AbortSignal.timeout(2000),\r\n        mode: 'cors'\r\n      });\r\n      if (response.ok) {\r\n        return true;\r\n      }\r\n    } catch (error) {\r\n      // Continue to next address\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\nexport async function print(data: string | Uint8Array, printerNameOverride?: string) {\r\n  const platform = Capacitor.getPlatform();\r\n\r\n  if (platform === 'web') {\r\n    // Prefer Printer Bridge if on web\r\n    try {\r\n      const isBinary = data instanceof Uint8Array;\r\n      const endpoint = 'http://localhost:5000/print/receipt';\r\n\r\n      // Use provided printer name, or try to get it from localStorage (fallback to Receipt Printer)\r\n      let printerName = printerNameOverride;\r\n      if (!printerName) {\r\n        try {\r\n          const settings = JSON.parse(localStorage.getItem('business-settings') || '{}');\r\n          printerName = settings.defaultPrinterName;\r\n        } catch (e) {\r\n          // Ignore parse errors\r\n        }\r\n      }\r\n\r\n      if (!printerName) printerName = 'Receipt Printer';\r\n\r\n      const body = {\r\n        PrinterName: printerName,\r\n        Content: isBinary ? String.fromCharCode(...(data as Uint8Array)) : data\r\n      };\r\n\r\n      const response = await fetch(endpoint, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        mode: 'cors',\r\n        body: JSON.stringify(body)\r\n      });\r\n\r\n      if (response.ok) {\r\n        return { success: true, message: 'Print command sent to bridge.' };\r\n      }\r\n    } catch (err) {\r\n      console.warn('Printer Bridge not available, falling back to Web Serial', err);\r\n    }\r\n\r\n    // Fallback to Web Serial for standard text data\r\n    if (typeof data === 'string') {\r\n      const { printWeb } = await import('./thermalPrinterWeb');\r\n      return await printWeb(data);\r\n    } else {\r\n      return { success: false, message: 'Printer Bridge required for binary ESC/POS printing.' };\r\n    }\r\n  } else {\r\n    // Native platforms use Bluetooth\r\n    const { printBluetooth } = await import('./thermalPrinterNative');\r\n    // Native print might only support strings for now, convert if needed\r\n    const stringData = typeof data === 'string' ? data : new TextDecoder().decode(data);\r\n    return await printBluetooth(stringData);\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAEO,eAAe;IACpB,MAAM,YAAY;QAAC;QAAyB;KAAwB;IAEpE,KAAK,MAAM,QAAQ,UAAW;QAC5B,IAAI;YACF,MAAM,WAAW,MAAM,MAAM,GAAG,KAAK,SAAS,CAAC,EAAE;gBAC/C,QAAQ,YAAY,OAAO,CAAC;gBAC5B,MAAM;YACR;YACA,IAAI,SAAS,EAAE,EAAE;gBACf,OAAO;YACT;QACF,EAAE,OAAO,OAAO;QACd,2BAA2B;QAC7B;IACF;IACA,OAAO;AACT;AAEO,eAAe,MAAM,IAAyB,EAAE,mBAA4B;IACjF,MAAM,WAAW,oKAAS,CAAC,WAAW;IAEtC,IAAI,aAAa,OAAO;QACtB,kCAAkC;QAClC,IAAI;YACF,MAAM,WAAW,gBAAgB;YACjC,MAAM,WAAW;YAEjB,8FAA8F;YAC9F,IAAI,cAAc;YAClB,IAAI,CAAC,aAAa;gBAChB,IAAI;oBACF,MAAM,WAAW,KAAK,KAAK,CAAC,aAAa,OAAO,CAAC,wBAAwB;oBACzE,cAAc,SAAS,kBAAkB;gBAC3C,EAAE,OAAO,GAAG;gBACV,sBAAsB;gBACxB;YACF;YAEA,IAAI,CAAC,aAAa,cAAc;YAEhC,MAAM,OAAO;gBACX,aAAa;gBACb,SAAS,WAAW,OAAO,YAAY,IAAK,QAAuB;YACrE;YAEA,MAAM,WAAW,MAAM,MAAM,UAAU;gBACrC,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9C,MAAM;gBACN,MAAM,KAAK,SAAS,CAAC;YACvB;YAEA,IAAI,SAAS,EAAE,EAAE;gBACf,OAAO;oBAAE,SAAS;oBAAM,SAAS;gBAAgC;YACnE;QACF,EAAE,OAAO,KAAK;YACZ,QAAQ,IAAI,CAAC,4DAA4D;QAC3E;QAEA,gDAAgD;QAChD,IAAI,OAAO,SAAS,UAAU;YAC5B,MAAM,EAAE,QAAQ,EAAE,GAAG;YACrB,OAAO,MAAM,SAAS;QACxB,OAAO;YACL,OAAO;gBAAE,SAAS;gBAAO,SAAS;YAAuD;QAC3F;IACF,OAAO;QACL,iCAAiC;QACjC,MAAM,EAAE,cAAc,EAAE,GAAG;QAC3B,qEAAqE;QACrE,MAAM,aAAa,OAAO,SAAS,WAAW,OAAO,IAAI,cAAc,MAAM,CAAC;QAC9E,OAAO,MAAM,eAAe;IAC9B;AACF"}},
    {"offset": {"line": 2542, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/utils/generateThermalReceipt.ts"],"sourcesContent":["import EscPosEncoder from 'esc-pos-encoder';\r\nimport { format } from \"date-fns\";\r\nimport { formatNumber } from \"@/lib/utils\";\r\nimport { numberToWords } from \"@/utils/numberToWords\";\r\nimport { parsePaymentInfo } from \"@/hooks/useBusinessSettings\";\r\n\r\n\r\n\r\n\r\nexport async function generateThermalReceipt(sale: any, settings: any, currency?: string): Promise<Uint8Array> {\r\n    const displayCurrency = currency || settings.currency || '';\r\n    const encoder = new EscPosEncoder();\r\n\r\n    encoder.initialize();\r\n\r\n    const is80mm = settings.printerPaperSize === '80mm';\r\n\r\n    if (is80mm) {\r\n        encoder.raw([0x1d, 0x57, 0x40, 0x02]); // GS W: Set width to 576 dots (80mm)\r\n        encoder.align('left'); // User requested \"far left\" for everything\r\n    } else {\r\n        encoder.raw([0x1d, 0x4c, 0, 0]); // GS L: Reset left margin to 0\r\n        encoder.raw([0x1d, 0x57, 0x80, 0x01]); // GS W: Set printable area width (384 dots = 58mm)\r\n        encoder.align('left');\r\n    }\r\n\r\n\r\n    // ===== Business Header =====\r\n    encoder.align('left');\r\n\r\n    encoder.line(is80mm ? '='.repeat(42) : '='.repeat(32));\r\n\r\n    if (settings.businessName) {\r\n        encoder.size('double').bold(true).line(settings.businessName.toUpperCase()).bold(false).size('normal');\r\n    }\r\n    encoder.line(is80mm ? '='.repeat(42) : '='.repeat(32));\r\n\r\n    if (settings.businessAddress) encoder.line(settings.businessAddress);\r\n    if (settings.businessPhone) encoder.line(`Tel: ${settings.businessPhone}`);\r\n    if (settings.businessEmail) encoder.line(settings.businessEmail);\r\n    encoder.line(is80mm ? '-'.repeat(42) : '-'.repeat(32)); // Wider line for 80mm\r\n\r\n    // ===== Document Title =====\r\n    const titleMap: Record<string, string> = {\r\n        \"Quote\": \"QUOTATION\",\r\n        \"Paid\": \"SALES RECEIPT\",\r\n        \"Installment Sale\": \"INSTALLMENT SALE\",\r\n        \"NOT PAID\": \"INVOICE\",\r\n    };\r\n    const docTitle = titleMap[sale.paymentStatus] || \"INVOICE\";\r\n    encoder.bold(true).line(docTitle).bold(false);\r\n\r\n    encoder.line(is80mm ? '-'.repeat(42) : '-'.repeat(32));\r\n\r\n    // ===== Receipt Info (Apply 10mm margin) =====\r\n    encoder.raw([0x1d, 0x4c, 0, 0]);\r\n    encoder.align('left');\r\n\r\n\r\n    encoder.table(\r\n        [\r\n            { width: 12, align: 'left' },\r\n            { width: 16, align: 'right' }\r\n        ],\r\n        [\r\n            ['Receipt #:', sale.receiptNumber || ''],\r\n            ['Date:', format(new Date(sale.date || Date.now()), \"MMM dd, yyyy\")],\r\n            ['Status:', sale.paymentStatus || '']\r\n        ]\r\n    );\r\n    encoder.line(is80mm ? '-'.repeat(42) : '-'.repeat(32));\r\n\r\n    // ===== Customer Info =====\r\n    if (sale.customerName) {\r\n        encoder.line(`Customer: ${sale.customerName}`);\r\n        if (sale.customerAddress) encoder.line(`Address: ${sale.customerAddress}`);\r\n        if (sale.customerContact) encoder.line(`Contact: ${sale.customerContact}`);\r\n        encoder.line(is80mm ? '-'.repeat(42) : '-'.repeat(32));\r\n    }\r\n\r\n    // ===== Items Table Definition =====\r\n    // 58mm (32 chars): Item(14) + Spacer(3) + Qty(5) + Tot(10) = 32\r\n    // 80mm (42 chars): Item(22) + Spacer(4) + Qty(6) + Tot(10) = 42\r\n    // 58mm (32 chars): Item(12) + Spacer(1) + Qty(5) + Tot(14) = 32\r\n    // 80mm (42 chars): Item(21) + Spacer(1) + Qty(6) + Tot(14) = 42\r\n    const tableColumns = is80mm\r\n        ? [\r\n            { width: 21, align: 'left' },\r\n            { width: 1, align: 'center' },\r\n            { width: 6, align: 'right' },\r\n            { width: 14, align: 'right' }\r\n        ]\r\n        : [\r\n            { width: 12, align: 'left' },\r\n            { width: 1, align: 'center' },\r\n            { width: 5, align: 'right' },\r\n            { width: 14, align: 'right' }\r\n        ];\r\n\r\n    encoder.table(\r\n        tableColumns,\r\n        [\r\n            ['Item', '', 'Qty', `Total`]\r\n        ]\r\n    );\r\n    encoder.line(is80mm ? '-'.repeat(42) : '-'.repeat(32));\r\n\r\n    let subtotalBeforeDiscount = 0;\r\n    let totalDiscountAmount = 0;\r\n\r\n    Array.isArray(sale.items) && sale.items.forEach((item: any) => {\r\n        const quantity = item.quantity || 0;\r\n        const price = item.price || 0;\r\n        const subtotal = quantity * price;\r\n        const discount = item.discountAmount ?? ((subtotal * (item.discountPercentage || 0)) / 100);\r\n        const total = subtotal - discount;\r\n\r\n        subtotalBeforeDiscount += subtotal;\r\n        totalDiscountAmount += discount;\r\n\r\n        encoder.table(\r\n            tableColumns,\r\n            [\r\n                [item.description || '', '', String(quantity), formatNumber(total)]\r\n            ]\r\n        );\r\n\r\n        if (discount > 0) {\r\n            const discText = item.discountType === \"amount\" ? \"\" : `(${item.discountPercentage || 0}%)`;\r\n            encoder.italic(true).table(\r\n                [\r\n                    { width: 22, align: 'left' },\r\n                    { width: 10, align: 'right' }\r\n                ],\r\n                [\r\n                    [`  Discount ${discText}`, `-${formatNumber(discount)}`]\r\n                ]\r\n            ).italic(false);\r\n        }\r\n\r\n        encoder.line(is80mm ? '-'.repeat(42) : '-'.repeat(32));\r\n    });\r\n\r\n    // ===== Totals (Vertical Layout as requested) =====\r\n    const subtotalAfterDiscount = subtotalBeforeDiscount - totalDiscountAmount;\r\n    const taxRate = sale.taxRate || 0;\r\n    const taxAmount = subtotalAfterDiscount * (taxRate / 100);\r\n    const totalAmount = subtotalAfterDiscount + taxAmount;\r\n\r\n    // For installment sales, sum up all payments from history if available\r\n    const totalPaidFromHistory = Array.isArray(sale.payments)\r\n        ? sale.payments.reduce((sum: number, p: any) => sum + (Number(p.amount) || 0), 0)\r\n        : 0;\r\n\r\n    const amountPaid = (sale.paymentStatus === 'Installment Sale' && totalPaidFromHistory > 0)\r\n        ? totalPaidFromHistory\r\n        : (Number(sale.amountPaid) || 0);\r\n\r\n    const amountDue = sale.paymentStatus === 'Installment Sale'\r\n        ? Math.max(0, totalAmount - totalPaidFromHistory)\r\n        : Math.max(0, totalAmount - amountPaid);\r\n\r\n    encoder.newline();\r\n\r\n    const totalsColumns = [\r\n        { width: 14, align: 'left' },\r\n        { width: is80mm ? 28 : 18, align: 'right' }\r\n    ];\r\n\r\n    encoder.table(totalsColumns, [\r\n        [\"Subtotal:\", `${displayCurrency} ${formatNumber(subtotalBeforeDiscount)}`]\r\n    ]);\r\n\r\n    if (totalDiscountAmount > 0) {\r\n        encoder.table(totalsColumns, [\r\n            [\"Total Discount:\", `-${displayCurrency} ${formatNumber(totalDiscountAmount)}`]\r\n        ]);\r\n    }\r\n\r\n    if (taxRate > 0) {\r\n        encoder.table(totalsColumns, [\r\n            [`Tax (${taxRate}%):`, `${displayCurrency} ${formatNumber(taxAmount)}`]\r\n        ]);\r\n    }\r\n\r\n    encoder.bold(true).table(totalsColumns, [\r\n        [\"TOTAL:\", `${displayCurrency} ${formatNumber(totalAmount)}`]\r\n    ]).bold(false);\r\n\r\n    if (sale.paymentStatus === \"Installment Sale\") {\r\n        encoder.table(totalsColumns, [\r\n            [\"Amount Paid:\", `${displayCurrency} ${formatNumber(amountPaid)}`],\r\n            [\"Amount Due:\", `${displayCurrency} ${formatNumber(amountDue)}`]\r\n        ]);\r\n    }\r\n\r\n    encoder.line(is80mm ? '-'.repeat(42) : '-'.repeat(32));\r\n    encoder.text(`Amount in words:\\n${numberToWords(totalAmount)} only\\n`);\r\n    encoder.line(is80mm ? '-'.repeat(42) : '-'.repeat(32));\r\n\r\n    // Reset margin for the rest of the receipt (Payment Info, Signature, Footer)\r\n    encoder.raw([0x1d, 0x4c, 0, 0]);\r\n    encoder.align('left');\r\n\r\n\r\n\r\n    // ===== Payment Info =====\r\n    const paymentMethods = settings.paymentInfo ? parsePaymentInfo(settings.paymentInfo) : [];\r\n    if (Array.isArray(paymentMethods) && paymentMethods.length > 0) {\r\n        paymentMethods.forEach((p: any) => {\r\n            if (p.method || p.accountNumber || p.accountName) {\r\n                encoder.bold(true).line(p.method || '').bold(false);\r\n                if (p.accountNumber) encoder.line(`Acc: ${p.accountNumber}`);\r\n                if (p.accountName) encoder.line(`Name: ${p.accountName}`);\r\n                encoder.line(is80mm ? '-'.repeat(42) : '-'.repeat(32));\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n    // ===== Footer =====\r\n    encoder.line(\"Thank you for your business!\");\r\n    encoder.size('small').line(\"Created by Gonza Systems\").size('normal');\r\n    encoder.line(is80mm ? '='.repeat(42) : '='.repeat(32));\r\n\r\n    // Cut paper\r\n    encoder.newline().newline().newline().cut();\r\n\r\n    return encoder.encode();\r\n}\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2829, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/utils/generatePaymentReminderPDF.ts"],"sourcesContent":["\r\nimport jsPDF from 'jspdf';\r\nimport autoTable from 'jspdf-autotable';\r\nimport { Customer } from '@/types';\r\nimport { Sale } from '@/types';\r\nimport { BusinessSettings } from '@/types';\r\nimport { format } from 'date-fns';\r\nimport { formatNumber } from '@/lib/utils';\r\nimport { supabase } from '@/integrations/supabase/client';\r\n\r\ninterface InstallmentPayment {\r\n  id: string;\r\n  amount: number;\r\n  payment_date: string;\r\n}\r\n\r\nconst fetchInstallmentPayments = async (saleId: string): Promise<InstallmentPayment[]> => {\r\n  try {\r\n    const { data, error } = await supabase\r\n      .from('installment_payments')\r\n      .select('id, amount, payment_date')\r\n      .eq('sale_id', saleId)\r\n      .order('payment_date', { ascending: false });\r\n\r\n    if (error) throw error;\r\n    return data || [];\r\n  } catch (error) {\r\n    console.error('Error fetching installment payments:', error);\r\n    return [];\r\n  }\r\n};\r\n\r\nexport const generatePaymentReminderPDF = async (\r\n  customer: Customer,\r\n  unpaidSales: Sale[],\r\n  totalAmountDue: number,\r\n  settings: BusinessSettings,\r\n  customMessage?: string,\r\n  outputType: 'save' | 'blob' | 'dataurl' = 'save'\r\n): Promise<string | Blob | void> => {\r\n  try {\r\n    const doc = new jsPDF();\r\n    const pageWidth = doc.internal.pageSize.width;\r\n    const pageHeight = doc.internal.pageSize.height;\r\n    const margin = 20;\r\n\r\n    // Function to add watermark to current page\r\n    const addWatermark = () => {\r\n      doc.setFontSize(8);\r\n      doc.setFont('helvetica', 'normal');\r\n      doc.setTextColor(150, 150, 150); // Light gray color\r\n      doc.text('Created By Gonza Systems', pageWidth / 2, pageHeight - 10, { align: 'center' });\r\n      doc.setTextColor(0, 0, 0); // Reset to black\r\n    };\r\n\r\n    // Header\r\n    doc.setFontSize(20);\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.text('PAYMENT REMINDER NOTICE', pageWidth / 2, 30, { align: 'center' });\r\n\r\n    // Business details\r\n    doc.setFontSize(12);\r\n    doc.setFont('helvetica', 'normal');\r\n    let yPos = 50;\r\n\r\n    doc.text(settings.businessName, margin, yPos);\r\n    yPos += 6;\r\n    doc.text(settings.businessAddress, margin, yPos);\r\n    yPos += 6;\r\n    doc.text(`Phone: ${settings.businessPhone}`, margin, yPos);\r\n    yPos += 6;\r\n    doc.text(`Email: ${settings.businessEmail}`, margin, yPos);\r\n    yPos += 15;\r\n\r\n    // Date and customer info\r\n    doc.text(`Date: ${format(new Date(), 'MMMM d, yyyy')}`, pageWidth - margin - 60, 50, { align: 'left' });\r\n\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.text('TO:', margin, yPos);\r\n    yPos += 8;\r\n    doc.setFont('helvetica', 'normal');\r\n    doc.text(customer.fullName, margin, yPos);\r\n    yPos += 6;\r\n\r\n    if (customer.phoneNumber) {\r\n      doc.text(`Phone: ${customer.phoneNumber}`, margin, yPos);\r\n      yPos += 6;\r\n    }\r\n\r\n    if (customer.email) {\r\n      doc.text(`Email: ${customer.email}`, margin, yPos);\r\n      yPos += 6;\r\n    }\r\n\r\n    if (customer.location) {\r\n      doc.text(`Address: ${customer.location}`, margin, yPos);\r\n      yPos += 6;\r\n    }\r\n\r\n    yPos += 15;\r\n\r\n    // Reminder message\r\n    doc.setFont('helvetica', 'normal');\r\n    doc.text(`Dear ${customer.fullName},`, margin, yPos);\r\n    yPos += 8;\r\n\r\n    // Use custom message if provided, otherwise use default based on sale type\r\n    const hasInstallmentSales = unpaidSales.some(sale => sale.paymentStatus === 'Installment Sale');\r\n    const defaultMessage = hasInstallmentSales\r\n      ? 'Our records show that you have outstanding installment payments for the items purchased. We kindly request you to complete the remaining payments according to your payment schedule.\\n\\nPlease reach out to us if you need any assistance or clarification regarding your installment plan.'\r\n      : 'Our records show that you have pending payments for the following items purchased on credit. We kindly request you to complete payment at your earliest convenience.\\n\\nPlease reach out to us if you need any assistance or clarification.';\r\n\r\n    const reminderText = customMessage || defaultMessage;\r\n\r\n    const splitText = doc.splitTextToSize(reminderText, pageWidth - 2 * margin);\r\n    doc.text(splitText, margin, yPos);\r\n    yPos += splitText.length * 6 + 10;\r\n\r\n    // Separate regular unpaid sales and installment sales\r\n    const regularUnpaidSales = unpaidSales.filter(sale => sale.paymentStatus !== 'Installment Sale');\r\n    const installmentSales = unpaidSales.filter(sale => sale.paymentStatus === 'Installment Sale');\r\n\r\n    // Determine table headers based on sale types\r\n    const hasInstallmentSalesWithDue = installmentSales.length > 0;\r\n    const tableHeaders = hasInstallmentSalesWithDue\r\n      ? ['Invoice #', 'Product Name', 'Qty', 'Paid Amount', 'Outstanding', 'Sale Date', 'Total Sale']\r\n      : ['Invoice #', 'Product Name', 'Qty', 'Price', 'Total', 'Sale Date', 'Sale Total'];\r\n\r\n    // Prepare table data - start with regular unpaid sales\r\n    const unpaidItems = regularUnpaidSales.flatMap(sale => {\r\n      const saleTotal = sale.items.reduce((itemSum, item) => itemSum + (item.price * item.quantity), 0);\r\n      const taxAmount = saleTotal * ((sale.taxRate || 0) / 100);\r\n      const totalWithTax = saleTotal + taxAmount;\r\n\r\n      return sale.items.map(item => [\r\n        sale.receiptNumber,\r\n        item.description,\r\n        item.quantity.toString(),\r\n        `${settings.currency} ${formatNumber(item.price)}`,\r\n        `${settings.currency} ${formatNumber(item.price * item.quantity)}`,\r\n        format(sale.date, 'MMM d, yyyy'),\r\n        `${settings.currency} ${formatNumber(totalWithTax)}` // Add total sale amount\r\n      ]);\r\n    });\r\n\r\n    // Add installment sales with their outstanding balances\r\n    const installmentItems = await Promise.all(\r\n      installmentSales.map(async sale => {\r\n        const payments = await fetchInstallmentPayments(sale.id);\r\n        const totalPaid = payments.reduce((sum, payment) => sum + payment.amount, 0);\r\n        const saleTotal = sale.items.reduce((itemSum, item) => itemSum + (item.price * item.quantity), 0);\r\n        const taxAmount = saleTotal * ((sale.taxRate || 0) / 100);\r\n        const totalWithTax = saleTotal + taxAmount;\r\n        const outstandingBalance = Math.max(0, totalWithTax - totalPaid);\r\n\r\n        // For installment sales, show only a single row with the outstanding balance\r\n        if (outstandingBalance > 0) {\r\n          const mainItem = sale.items[0]; // Use first item as representative\r\n          const itemsDescription = sale.items.length > 1\r\n            ? `${mainItem.description} (+${sale.items.length - 1} more items)`\r\n            : mainItem.description;\r\n\r\n          return [[\r\n            sale.receiptNumber,\r\n            itemsDescription + ' (Installment)',\r\n            sale.items.reduce((sum, item) => sum + item.quantity, 0).toString(),\r\n            `${settings.currency} ${formatNumber(totalPaid)}`,\r\n            `${settings.currency} ${formatNumber(outstandingBalance)}`,\r\n            format(sale.date, 'MMM d, yyyy'),\r\n            `${settings.currency} ${formatNumber(totalWithTax)}` // Add total sale amount\r\n          ]];\r\n        }\r\n        return [];\r\n      })\r\n    );\r\n\r\n    // Flatten installment items\r\n    const flattenedInstallmentItems = installmentItems.flat();\r\n\r\n    // Combine all items\r\n    const allItems = [...unpaidItems, ...flattenedInstallmentItems];\r\n\r\n    // Calculate outstanding balance \r\n    const regularOutstanding = regularUnpaidSales.reduce((sum, sale) => {\r\n      const saleTotal = sale.items.reduce((itemSum, item) => itemSum + (item.price * item.quantity), 0);\r\n      const taxAmount = saleTotal * ((sale.taxRate || 0) / 100);\r\n      return sum + saleTotal + taxAmount;\r\n    }, 0);\r\n\r\n    // Calculate installment outstanding\r\n    const installmentOutstanding = await Promise.all(\r\n      installmentSales.map(async sale => {\r\n        const payments = await fetchInstallmentPayments(sale.id);\r\n        const totalPaid = payments.reduce((sum, payment) => sum + payment.amount, 0);\r\n        const saleTotal = sale.items.reduce((itemSum, item) => itemSum + (item.price * item.quantity), 0);\r\n        const taxAmount = saleTotal * ((sale.taxRate || 0) / 100);\r\n        const totalWithTax = saleTotal + taxAmount;\r\n        return Math.max(0, totalWithTax - totalPaid);\r\n      })\r\n    );\r\n\r\n    const totalInstallmentOutstanding = (await Promise.all(installmentOutstanding)).reduce((sum, amount) => sum + amount, 0);\r\n\r\n    // Total outstanding balance\r\n    const correctedOutstandingBalance = regularOutstanding + totalInstallmentOutstanding;\r\n\r\n    // Add total row\r\n    allItems.push([\r\n      '', '', '', '', 'TOTAL OUTSTANDING:', `${settings.currency} ${formatNumber(correctedOutstandingBalance)}`, ''\r\n    ]);\r\n\r\n    // Create table using autoTable\r\n    autoTable(doc, {\r\n      startY: yPos,\r\n      head: [tableHeaders],\r\n      body: allItems,\r\n      theme: 'grid',\r\n      headStyles: {\r\n        fillColor: [255, 145, 77], // Orange color\r\n        textColor: 255,\r\n        fontStyle: 'bold'\r\n      },\r\n      bodyStyles: {\r\n        fontSize: 10\r\n      },\r\n      didParseCell: function (data: any) {\r\n        // Style the total row\r\n        if (data.row.index === allItems.length - 1) {\r\n          data.cell.styles.fillColor = [255, 200, 150];\r\n          data.cell.styles.fontStyle = 'bold';\r\n        }\r\n\r\n        // Style payment status rows (rows that contain payment information)\r\n        if (data.cell.text && data.cell.text[0] && data.cell.text[0].includes('Payment Status:')) {\r\n          data.cell.styles.fillColor = [230, 230, 255]; // Light blue background\r\n          data.cell.styles.fontStyle = 'italic';\r\n          data.cell.styles.fontSize = 9;\r\n        }\r\n      },\r\n      margin: { left: margin, right: margin }\r\n    });\r\n\r\n    // Footer message\r\n    const finalY = (doc as any).lastAutoTable.finalY + 20;\r\n\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.text('Thank you for your continued support.', margin, finalY);\r\n\r\n    doc.setFont('helvetica', 'normal');\r\n    doc.setFontSize(10);\r\n    doc.text(`${settings.businessName} - Payment Reminder`, margin, finalY + 15);\r\n\r\n    // Add watermark to the final page\r\n    addWatermark();\r\n\r\n    // Output based on requested type\r\n    const fileName = `Payment_Reminder_${customer.fullName.replace(/\\s+/g, '_')}_${format(new Date(), 'yyyy-MM-dd')}.pdf`;\r\n\r\n    if (outputType === 'blob') {\r\n      return doc.output('blob');\r\n    } else if (outputType === 'dataurl') {\r\n      return doc.output('datauristring');\r\n    } else {\r\n      doc.save(fileName);\r\n    }\r\n  } catch (error) {\r\n    console.error('Error generating payment reminder PDF:', error);\r\n    throw new Error('Failed to generate payment reminder PDF');\r\n  }\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3097, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/utils/generateReceiptNumber.ts"],"sourcesContent":["\r\nimport { supabase } from '@/integrations/supabase/client';\r\n\r\n/**\r\n * Generate a sequential receipt number using atomic database function.\r\n * This prevents race conditions when multiple sales are created simultaneously.\r\n */\r\nexport const generateReceiptNumber = async (locationId?: string): Promise<string> => {\r\n  try {\r\n    if (!locationId) {\r\n      console.error('Location ID is required for receipt number generation');\r\n      return '000001';\r\n    }\r\n\r\n    // Use the database function to atomically get the next receipt number\r\n    const { data, error } = await supabase.rpc('get_next_receipt_number', {\r\n      location_uuid: locationId\r\n    });\r\n\r\n    if (error) {\r\n      console.error('Error generating receipt number:', error);\r\n      // Fallback: get max from existing sales and add 1\r\n      return await getFallbackReceiptNumber(locationId);\r\n    }\r\n\r\n    return data || '000001';\r\n  } catch (error) {\r\n    console.error('Error generating receipt number:', error);\r\n    // Fallback: get max from existing sales and add 1\r\n    return await getFallbackReceiptNumber(locationId);\r\n  }\r\n};\r\n\r\n/**\r\n * Fallback method to generate receipt number if database function fails\r\n */\r\nasync function getFallbackReceiptNumber(locationId: string): Promise<string> {\r\n  try {\r\n    const { data: salesData, error } = await supabase\r\n      .from('sales')\r\n      .select('receipt_number')\r\n      .eq('location_id', locationId)\r\n      .order('created_at', { ascending: false })\r\n      .limit(100); // Only check recent sales for performance\r\n\r\n    if (error) {\r\n      console.error('Error in fallback receipt generation:', error);\r\n      return '000001';\r\n    }\r\n\r\n    let maxNumber = 0;\r\n    if (salesData && salesData.length > 0) {\r\n      salesData.forEach(sale => {\r\n        const receiptNumber = sale.receipt_number;\r\n        const numericValue = parseInt(receiptNumber, 10);\r\n        if (!isNaN(numericValue) && numericValue > maxNumber) {\r\n          maxNumber = numericValue;\r\n        }\r\n      });\r\n    }\r\n\r\n    const nextNumber = maxNumber + 1;\r\n    return nextNumber.toString().padStart(6, '0');\r\n  } catch (error) {\r\n    console.error('Error in fallback receipt generation:', error);\r\n    return '000001';\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AACA;;AAMO,MAAM,wBAAwB,OAAO;IAC1C,IAAI;QACF,IAAI,CAAC,YAAY;YACf,QAAQ,KAAK,CAAC;YACd,OAAO;QACT;QAEA,sEAAsE;QACtE,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,wJAAQ,CAAC,GAAG,CAAC,2BAA2B;YACpE,eAAe;QACjB;QAEA,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,oCAAoC;YAClD,kDAAkD;YAClD,OAAO,MAAM,yBAAyB;QACxC;QAEA,OAAO,QAAQ;IACjB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,oCAAoC;QAClD,kDAAkD;QAClD,OAAO,MAAM,yBAAyB;IACxC;AACF;AAEA;;CAEC,GACD,eAAe,yBAAyB,UAAkB;IACxD,IAAI;QACF,MAAM,EAAE,MAAM,SAAS,EAAE,KAAK,EAAE,GAAG,MAAM,wJAAQ,CAC9C,IAAI,CAAC,SACL,MAAM,CAAC,kBACP,EAAE,CAAC,eAAe,YAClB,KAAK,CAAC,cAAc;YAAE,WAAW;QAAM,GACvC,KAAK,CAAC,MAAM,0CAA0C;QAEzD,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,yCAAyC;YACvD,OAAO;QACT;QAEA,IAAI,YAAY;QAChB,IAAI,aAAa,UAAU,MAAM,GAAG,GAAG;YACrC,UAAU,OAAO,CAAC,CAAA;gBAChB,MAAM,gBAAgB,KAAK,cAAc;gBACzC,MAAM,eAAe,SAAS,eAAe;gBAC7C,IAAI,CAAC,MAAM,iBAAiB,eAAe,WAAW;oBACpD,YAAY;gBACd;YACF;QACF;QAEA,MAAM,aAAa,YAAY;QAC/B,OAAO,WAAW,QAAQ,GAAG,QAAQ,CAAC,GAAG;IAC3C,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yCAAyC;QACvD,OAAO;IACT;AACF"}},
    {"offset": {"line": 3160, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/pages/Customers.tsx"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\r\nimport { useAuth } from '@/components/auth/AuthProvider';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\nimport { useCustomers, Customer } from '@/hooks/useCustomers';\r\nimport { useCustomerCategories } from '@/hooks/useCustomerCategories';\r\nimport { useCustomerData } from '@/hooks/useCustomerData';\r\nimport { useBusinessSettings } from '@/hooks/useBusinessSettings';\r\nimport { useSalesData } from '@/hooks/useSalesData';\r\nimport { useLocation } from 'react-router-dom';\r\nimport { supabase } from '@/integrations/supabase/client';\r\nimport CustomerPageSkeleton from '@/components/customers/CustomerPageSkeleton';\r\nimport CustomerHeader from '@/components/customers/CustomerHeader';\r\nimport CustomerStatsCards from '@/components/customers/CustomerStatsCards';\r\nimport CustomerContent from '@/components/customers/CustomerContent';\r\nimport BirthdayCard from '@/components/customers/BirthdayCard';\r\nimport CustomerCategoryManager from '@/components/customers/CustomerCategoryManager';\r\nimport NewCustomerDialog from '@/components/customers/NewCustomerDialog';\r\nimport MergeCustomersDialog from '@/components/customers/MergeCustomersDialog';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Card, CardContent } from '@/components/ui/card';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { toast } from 'sonner';\r\nimport { useProfiles } from '@/contexts/ProfileContext';\r\nimport { Alert, AlertTitle, AlertDescription } from '@/components/ui/alert';\r\nimport { AlertCircle, ArrowLeft } from 'lucide-react';\r\nimport { useNavigate } from 'react-router-dom';\r\n\r\n\r\nconst Customers = () => {\r\n  const { user } = useAuth();\r\n  const { currentBusiness, isLoading: businessLoading } = useBusiness();\r\n  const { customers, isLoading, createCustomer, updateCustomer, deleteCustomer, page, setPage, pageSize, setPageSize, totalCount } = useCustomers(50);\r\n  const { categories } = useCustomerCategories();\r\n  const { settings } = useBusinessSettings();\r\n  const { getCustomerLifetimePurchases } = useSalesData(user?.id);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [selectedCategory, setSelectedCategory] = useState<string>('all');\r\n  const [dateFilter, setDateFilter] = useState<string>('all');\r\n  const [dateRange, setDateRange] = useState<{ from: Date | undefined; to: Date | undefined }>({ from: undefined, to: undefined });\r\n  const [selectedCustomer, setSelectedCustomer] = useState<Customer | null>(null);\r\n  const [newCustomerDialogOpen, setNewCustomerDialogOpen] = useState(false);\r\n  const [customerToEdit, setCustomerToEdit] = useState<Customer | undefined>(undefined);\r\n  const [activeTab, setActiveTab] = useState('list');\r\n  const location = useLocation();\r\n  const navigate = useNavigate();\r\n  const { hasPermission, isLoading: profilesLoading } = useProfiles();\r\n\r\n  // Permissions\r\n  const canView = hasPermission('customers', 'view');\r\n  const canCreate = hasPermission('customers', 'create');\r\n  const canEdit = hasPermission('customers', 'edit');\r\n  const canDelete = hasPermission('customers', 'delete');\r\n\r\n  // Duplicate detection\r\n  const [showDuplicatesDialog, setShowDuplicatesDialog] = useState(false);\r\n  const [duplicateGroups, setDuplicateGroups] = useState<Customer[][]>([]);\r\n  const [selectedDuplicateGroup, setSelectedDuplicateGroup] = useState<Customer[] | null>(null);\r\n  const [showMergeDialog, setShowMergeDialog] = useState(false);\r\n\r\n  // Global customer stats\r\n  const [customersWithBirthdaysAll, setCustomersWithBirthdaysAll] = useState<number | undefined>(undefined);\r\n  const [customersThisMonthAll, setCustomersThisMonthAll] = useState<number | undefined>(undefined);\r\n\r\n  // Fetch global customer stats with 5-min cache\r\n  useEffect(() => {\r\n    let cancelled = false;\r\n    const loadGlobalStats = async () => {\r\n      if (!user?.id || !currentBusiness?.id) return;\r\n\r\n      const cacheKey = `allCustomerStats_${currentBusiness.id}`;\r\n      const cachedRaw = localStorage.getItem(cacheKey);\r\n      try {\r\n        if (cachedRaw) {\r\n          const cached = JSON.parse(cachedRaw) as { withBirthdays: number; thisMonth: number; ts: number };\r\n          if (Date.now() - cached.ts < 5 * 60 * 1000) {\r\n            setCustomersWithBirthdaysAll(cached.withBirthdays);\r\n            setCustomersThisMonthAll(cached.thisMonth);\r\n            return;\r\n          }\r\n        }\r\n      } catch { }\r\n\r\n      const { data, error } = await supabase\r\n        .from('customers')\r\n        .select('birthday, created_at')\r\n        .eq('user_id', user.id)\r\n        .eq('location_id', currentBusiness.id);\r\n\r\n      if (!cancelled && !error && data) {\r\n        const thisMonth = new Date();\r\n        let withBirthdays = 0;\r\n        let thisMonthCount = 0;\r\n\r\n        data.forEach((row: any) => {\r\n          if (row.birthday) withBirthdays++;\r\n\r\n          if (row.created_at) {\r\n            const customerDate = new Date(row.created_at);\r\n            if (customerDate.getMonth() === thisMonth.getMonth() &&\r\n              customerDate.getFullYear() === thisMonth.getFullYear()) {\r\n              thisMonthCount++;\r\n            }\r\n          }\r\n        });\r\n\r\n        setCustomersWithBirthdaysAll(withBirthdays);\r\n        setCustomersThisMonthAll(thisMonthCount);\r\n\r\n        try {\r\n          localStorage.setItem(cacheKey, JSON.stringify({\r\n            withBirthdays,\r\n            thisMonth: thisMonthCount,\r\n            ts: Date.now()\r\n          }));\r\n        } catch { }\r\n      }\r\n    };\r\n\r\n    loadGlobalStats();\r\n    return () => { cancelled = true; };\r\n  }, [user?.id, currentBusiness?.id]);\r\n\r\n  // Use customer data hook for all calculations\r\n  const { validCategories, filteredCustomers, customerStats, getCategoryName } = useCustomerData(\r\n    customers,\r\n    categories,\r\n    searchTerm,\r\n    selectedCategory,\r\n    totalCount,\r\n    customersWithBirthdaysAll,\r\n    customersThisMonthAll\r\n  );\r\n\r\n  useEffect(() => {\r\n    // Check for action=new parameter to auto-open the new customer dialog\r\n    const searchParams = new URLSearchParams(location.search);\r\n    if (searchParams.get('action') === 'new') {\r\n      setNewCustomerDialogOpen(true);\r\n      // Remove the query parameter after processing\r\n      const newUrl = window.location.pathname;\r\n      window.history.replaceState({}, '', newUrl);\r\n    }\r\n\r\n    // Check for view parameter to auto-select a customer\r\n    const viewCustomerId = searchParams.get('view');\r\n    if (viewCustomerId && customers.length > 0) {\r\n      const customer = customers.find(c => c.id === viewCustomerId);\r\n      if (customer) {\r\n        setSelectedCustomer(customer);\r\n        setActiveTab('details');\r\n      }\r\n    }\r\n  }, [location, customers]);\r\n\r\n  // Memoize handlers to prevent unnecessary re-renders\r\n  const handleAddNewCustomer = useCallback(async (customerData: Omit<Customer, 'id' | 'createdAt' | 'updatedAt'>) => {\r\n    if (customerToEdit) {\r\n      await updateCustomer(customerToEdit.id, customerData);\r\n    } else {\r\n      await createCustomer(customerData);\r\n    }\r\n    setNewCustomerDialogOpen(false);\r\n    setCustomerToEdit(undefined);\r\n    return true;\r\n  }, [customerToEdit, updateCustomer, createCustomer]);\r\n\r\n  const handleSelectCustomer = useCallback((customer: Customer) => {\r\n    setSelectedCustomer(customer);\r\n    setActiveTab('details');\r\n  }, []);\r\n\r\n  const handleEditCustomer = useCallback((customer: Customer) => {\r\n    setCustomerToEdit(customer);\r\n    setNewCustomerDialogOpen(true);\r\n  }, []);\r\n\r\n  const handleAddNewCustomerClick = useCallback(() => {\r\n    setCustomerToEdit(undefined);\r\n    setNewCustomerDialogOpen(true);\r\n  }, []);\r\n\r\n  const findDuplicates = useCallback(() => {\r\n    // Group customers by normalized name (lowercase, trimmed)\r\n    const nameMap = new Map<string, Customer[]>();\r\n\r\n    customers.forEach(customer => {\r\n      const normalizedName = customer.fullName.toLowerCase().trim();\r\n      if (!nameMap.has(normalizedName)) {\r\n        nameMap.set(normalizedName, []);\r\n      }\r\n      nameMap.get(normalizedName)!.push(customer);\r\n    });\r\n\r\n    // Filter groups with more than 1 customer (duplicates)\r\n    const duplicates: Customer[][] = [];\r\n    nameMap.forEach((group) => {\r\n      if (group.length > 1) {\r\n        duplicates.push(group);\r\n      }\r\n    });\r\n\r\n    if (duplicates.length === 0) {\r\n      toast.info('No duplicate customers found');\r\n      return;\r\n    }\r\n\r\n    setDuplicateGroups(duplicates);\r\n    setShowDuplicatesDialog(true);\r\n  }, [customers]);\r\n\r\n  const handleMergeGroup = (group: Customer[]) => {\r\n    setSelectedDuplicateGroup(group);\r\n    setShowMergeDialog(true);\r\n  };\r\n\r\n  const handleMergeComplete = () => {\r\n    // Reload customers after merge\r\n    window.location.reload();\r\n  };\r\n\r\n  if (businessLoading || !currentBusiness || isLoading || profilesLoading) {\r\n    return <CustomerPageSkeleton />;\r\n  }\r\n\r\n  if (!canView) {\r\n    return (\r\n      <div className=\"max-w-4xl mx-auto p-6\">\r\n        <Alert variant=\"destructive\">\r\n          <AlertCircle className=\"h-4 w-4\" />\r\n          <AlertTitle>Access Denied</AlertTitle>\r\n          <AlertDescription>\r\n            You do not have permission to view the customers module.\r\n            Please contact your administrator if you believe this is an error.\r\n          </AlertDescription>\r\n        </Alert>\r\n        <div className=\"mt-4\">\r\n          <Button onClick={() => navigate('/')} variant=\"outline\" className=\"gap-2\">\r\n            <ArrowLeft className=\"h-4 w-4\" />\r\n            Back to Dashboard\r\n          </Button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-8\">\r\n      {/* Header Section */}\r\n      <CustomerHeader\r\n        onAddNewCustomer={handleAddNewCustomerClick}\r\n        onFindDuplicates={canEdit ? findDuplicates : undefined}\r\n        customers={filteredCustomers}\r\n        currency={settings.currency}\r\n        businessName={settings.businessName}\r\n        businessLogo={settings.businessLogo}\r\n        getCategoryName={getCategoryName}\r\n        getCustomerLifetimePurchases={getCustomerLifetimePurchases}\r\n        canCreate={canCreate}\r\n      />\r\n\r\n      {/* Stats Cards */}\r\n      <CustomerStatsCards customerStats={customerStats} />\r\n\r\n      {/* Birthday Card - Only show if there are upcoming birthdays */}\r\n      <BirthdayCard customers={customers} />\r\n\r\n      {/* Add Customer Category Manager */}\r\n      <CustomerCategoryManager />\r\n\r\n      {/* Customer Content */}\r\n      <CustomerContent\r\n        activeTab={activeTab}\r\n        setActiveTab={setActiveTab}\r\n        selectedCustomer={selectedCustomer}\r\n        searchTerm={searchTerm}\r\n        setSearchTerm={setSearchTerm}\r\n        selectedCategory={selectedCategory}\r\n        setSelectedCategory={setSelectedCategory}\r\n        dateFilter={dateFilter}\r\n        setDateFilter={setDateFilter}\r\n        dateRange={dateRange}\r\n        setDateRange={setDateRange}\r\n        validCategories={validCategories}\r\n        filteredCustomers={filteredCustomers}\r\n        customers={customers}\r\n        customerStats={customerStats}\r\n        getCategoryName={getCategoryName}\r\n        onSelectCustomer={handleSelectCustomer}\r\n        onEditCustomer={handleEditCustomer}\r\n        onDeleteCustomer={deleteCustomer}\r\n        onUpdateCustomer={updateCustomer}\r\n        setSelectedCustomer={setSelectedCustomer}\r\n        canCreate={canCreate}\r\n        canEdit={canEdit}\r\n        canDelete={canDelete}\r\n      />\r\n\r\n      {/* Pagination Controls */}\r\n      <div className=\"flex items-center justify-between p-3 md:p-4 border rounded\">\r\n        <div className=\"text-xs md:text-sm text-muted-foreground\">\r\n          Showing {(page - 1) * pageSize + 1}{Math.min(page * pageSize, totalCount)} of {totalCount}\r\n        </div>\r\n        <div className=\"flex items-center gap-2\">\r\n          <select\r\n            className=\"border rounded px-2 py-1 text-xs md:text-sm\"\r\n            value={pageSize}\r\n            onChange={(e) => setPageSize(Number(e.target.value))}\r\n          >\r\n            {[20, 50, 100].map(size => (\r\n              <option key={size} value={size}>{size} / page</option>\r\n            ))}\r\n          </select>\r\n          <button\r\n            className=\"border rounded px-2 py-1 text-xs md:text-sm\"\r\n            disabled={page === 1 || isLoading}\r\n            onClick={() => setPage(Math.max(1, page - 1))}\r\n            type=\"button\"\r\n          >\r\n            Prev\r\n          </button>\r\n          <button\r\n            className=\"border rounded px-2 py-1 text-xs md:text-sm\"\r\n            disabled={page * pageSize >= totalCount || isLoading}\r\n            onClick={() => setPage(page + 1)}\r\n            type=\"button\"\r\n          >\r\n            Next\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <NewCustomerDialog\r\n        open={newCustomerDialogOpen}\r\n        onClose={() => {\r\n          setNewCustomerDialogOpen(false);\r\n          setCustomerToEdit(undefined);\r\n        }}\r\n        onAddCustomer={handleAddNewCustomer}\r\n        initialData={customerToEdit}\r\n      />\r\n\r\n      {/* Duplicates Dialog */}\r\n      <Dialog open={showDuplicatesDialog} onOpenChange={setShowDuplicatesDialog}>\r\n        <DialogContent className=\"max-w-3xl max-h-[80vh] overflow-y-auto\">\r\n          <DialogHeader>\r\n            <DialogTitle>Duplicate Customers Found</DialogTitle>\r\n            <DialogDescription>\r\n              Found {duplicateGroups.length} group(s) of duplicate customers. Select a group to merge.\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n\r\n          <div className=\"space-y-4\">\r\n            {duplicateGroups.map((group, index) => (\r\n              <Card key={index} className=\"p-4\">\r\n                <CardContent className=\"p-0\">\r\n                  <div className=\"flex items-start justify-between mb-3\">\r\n                    <div>\r\n                      <div className=\"font-semibold text-lg\">{group[0].fullName}</div>\r\n                      <Badge variant=\"secondary\" className=\"mt-1\">\r\n                        {group.length} duplicates\r\n                      </Badge>\r\n                    </div>\r\n                    <Button onClick={() => handleMergeGroup(group)} size=\"sm\">\r\n                      Merge\r\n                    </Button>\r\n                  </div>\r\n                  <div className=\"space-y-2 text-sm\">\r\n                    {group.map((customer) => (\r\n                      <div key={customer.id} className=\"flex items-center justify-between border-l-2 border-gray-200 pl-3 py-1\">\r\n                        <div>\r\n                          <div>{customer.phoneNumber || 'No phone'}</div>\r\n                          <div className=\"text-muted-foreground text-xs\">\r\n                            Created: {customer.createdAt.toLocaleDateString()}\r\n                          </div>\r\n                        </div>\r\n                        {customer.email && (\r\n                          <div className=\"text-xs text-muted-foreground\">{customer.email}</div>\r\n                        )}\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n            ))}\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* Merge Dialog */}\r\n      {selectedDuplicateGroup && (\r\n        <MergeCustomersDialog\r\n          open={showMergeDialog}\r\n          onOpenChange={setShowMergeDialog}\r\n          customers={selectedDuplicateGroup}\r\n          onMergeComplete={handleMergeComplete}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Customers;\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAIA,MAAM,YAAY;;IAChB,MAAM,EAAE,IAAI,EAAE,GAAG,IAAA,wJAAO;IACxB,MAAM,EAAE,eAAe,EAAE,WAAW,eAAe,EAAE,GAAG,IAAA,qJAAW;IACnE,MAAM,EAAE,SAAS,EAAE,SAAS,EAAE,cAAc,EAAE,cAAc,EAAE,cAAc,EAAE,IAAI,EAAE,OAAO,EAAE,QAAQ,EAAE,WAAW,EAAE,UAAU,EAAE,GAAG,IAAA,+IAAY,EAAC;IAChJ,MAAM,EAAE,UAAU,EAAE,GAAG,IAAA,iKAAqB;IAC5C,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAA,6JAAmB;IACxC,MAAM,EAAE,4BAA4B,EAAE,GAAG,IAAA,+IAAY,EAAC,MAAM;IAC5D,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,yKAAQ,EAAC;IAC7C,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,IAAA,yKAAQ,EAAS;IACjE,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,yKAAQ,EAAS;IACrD,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAmD;QAAE,MAAM;QAAW,IAAI;IAAU;IAC9H,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,IAAA,yKAAQ,EAAkB;IAC1E,MAAM,CAAC,uBAAuB,yBAAyB,GAAG,IAAA,yKAAQ,EAAC;IACnE,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,yKAAQ,EAAuB;IAC3E,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAC;IAC3C,MAAM,WAAW,IAAA,kLAAW;IAC5B,MAAM,WAAW,IAAA,kLAAW;IAC5B,MAAM,EAAE,aAAa,EAAE,WAAW,eAAe,EAAE,GAAG,IAAA,oJAAW;IAEjE,cAAc;IACd,MAAM,UAAU,cAAc,aAAa;IAC3C,MAAM,YAAY,cAAc,aAAa;IAC7C,MAAM,UAAU,cAAc,aAAa;IAC3C,MAAM,YAAY,cAAc,aAAa;IAE7C,sBAAsB;IACtB,MAAM,CAAC,sBAAsB,wBAAwB,GAAG,IAAA,yKAAQ,EAAC;IACjE,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,yKAAQ,EAAe,EAAE;IACvE,MAAM,CAAC,wBAAwB,0BAA0B,GAAG,IAAA,yKAAQ,EAAoB;IACxF,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,yKAAQ,EAAC;IAEvD,wBAAwB;IACxB,MAAM,CAAC,2BAA2B,6BAA6B,GAAG,IAAA,yKAAQ,EAAqB;IAC/F,MAAM,CAAC,uBAAuB,yBAAyB,GAAG,IAAA,yKAAQ,EAAqB;IAEvF,+CAA+C;IAC/C,IAAA,0KAAS;+BAAC;YACR,IAAI,YAAY;YAChB,MAAM;uDAAkB;oBACtB,IAAI,CAAC,MAAM,MAAM,CAAC,iBAAiB,IAAI;oBAEvC,MAAM,WAAW,CAAC,iBAAiB,EAAE,gBAAgB,EAAE,EAAE;oBACzD,MAAM,YAAY,aAAa,OAAO,CAAC;oBACvC,IAAI;wBACF,IAAI,WAAW;4BACb,MAAM,SAAS,KAAK,KAAK,CAAC;4BAC1B,IAAI,KAAK,GAAG,KAAK,OAAO,EAAE,GAAG,IAAI,KAAK,MAAM;gCAC1C,6BAA6B,OAAO,aAAa;gCACjD,yBAAyB,OAAO,SAAS;gCACzC;4BACF;wBACF;oBACF,EAAE,OAAM,CAAE;oBAEV,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,wJAAQ,CACnC,IAAI,CAAC,aACL,MAAM,CAAC,wBACP,EAAE,CAAC,WAAW,KAAK,EAAE,EACrB,EAAE,CAAC,eAAe,gBAAgB,EAAE;oBAEvC,IAAI,CAAC,aAAa,CAAC,SAAS,MAAM;wBAChC,MAAM,YAAY,IAAI;wBACtB,IAAI,gBAAgB;wBACpB,IAAI,iBAAiB;wBAErB,KAAK,OAAO;mEAAC,CAAC;gCACZ,IAAI,IAAI,QAAQ,EAAE;gCAElB,IAAI,IAAI,UAAU,EAAE;oCAClB,MAAM,eAAe,IAAI,KAAK,IAAI,UAAU;oCAC5C,IAAI,aAAa,QAAQ,OAAO,UAAU,QAAQ,MAChD,aAAa,WAAW,OAAO,UAAU,WAAW,IAAI;wCACxD;oCACF;gCACF;4BACF;;wBAEA,6BAA6B;wBAC7B,yBAAyB;wBAEzB,IAAI;4BACF,aAAa,OAAO,CAAC,UAAU,KAAK,SAAS,CAAC;gCAC5C;gCACA,WAAW;gCACX,IAAI,KAAK,GAAG;4BACd;wBACF,EAAE,OAAM,CAAE;oBACZ;gBACF;;YAEA;YACA;uCAAO;oBAAQ,YAAY;gBAAM;;QACnC;8BAAG;QAAC,MAAM;QAAI,iBAAiB;KAAG;IAElC,8CAA8C;IAC9C,MAAM,EAAE,eAAe,EAAE,iBAAiB,EAAE,aAAa,EAAE,eAAe,EAAE,GAAG,IAAA,qJAAe,EAC5F,WACA,YACA,YACA,kBACA,YACA,2BACA;IAGF,IAAA,0KAAS;+BAAC;YACR,sEAAsE;YACtE,MAAM,eAAe,IAAI,gBAAgB,SAAS,MAAM;YACxD,IAAI,aAAa,GAAG,CAAC,cAAc,OAAO;gBACxC,yBAAyB;gBACzB,8CAA8C;gBAC9C,MAAM,SAAS,OAAO,QAAQ,CAAC,QAAQ;gBACvC,OAAO,OAAO,CAAC,YAAY,CAAC,CAAC,GAAG,IAAI;YACtC;YAEA,qDAAqD;YACrD,MAAM,iBAAiB,aAAa,GAAG,CAAC;YACxC,IAAI,kBAAkB,UAAU,MAAM,GAAG,GAAG;gBAC1C,MAAM,WAAW,UAAU,IAAI;oDAAC,CAAA,IAAK,EAAE,EAAE,KAAK;;gBAC9C,IAAI,UAAU;oBACZ,oBAAoB;oBACpB,aAAa;gBACf;YACF;QACF;8BAAG;QAAC;QAAU;KAAU;IAExB,qDAAqD;IACrD,MAAM,uBAAuB,IAAA,4KAAW;uDAAC,OAAO;YAC9C,IAAI,gBAAgB;gBAClB,MAAM,eAAe,eAAe,EAAE,EAAE;YAC1C,OAAO;gBACL,MAAM,eAAe;YACvB;YACA,yBAAyB;YACzB,kBAAkB;YAClB,OAAO;QACT;sDAAG;QAAC;QAAgB;QAAgB;KAAe;IAEnD,MAAM,uBAAuB,IAAA,4KAAW;uDAAC,CAAC;YACxC,oBAAoB;YACpB,aAAa;QACf;sDAAG,EAAE;IAEL,MAAM,qBAAqB,IAAA,4KAAW;qDAAC,CAAC;YACtC,kBAAkB;YAClB,yBAAyB;QAC3B;oDAAG,EAAE;IAEL,MAAM,4BAA4B,IAAA,4KAAW;4DAAC;YAC5C,kBAAkB;YAClB,yBAAyB;QAC3B;2DAAG,EAAE;IAEL,MAAM,iBAAiB,IAAA,4KAAW;iDAAC;YACjC,0DAA0D;YAC1D,MAAM,UAAU,IAAI;YAEpB,UAAU,OAAO;yDAAC,CAAA;oBAChB,MAAM,iBAAiB,SAAS,QAAQ,CAAC,WAAW,GAAG,IAAI;oBAC3D,IAAI,CAAC,QAAQ,GAAG,CAAC,iBAAiB;wBAChC,QAAQ,GAAG,CAAC,gBAAgB,EAAE;oBAChC;oBACA,QAAQ,GAAG,CAAC,gBAAiB,IAAI,CAAC;gBACpC;;YAEA,uDAAuD;YACvD,MAAM,aAA2B,EAAE;YACnC,QAAQ,OAAO;yDAAC,CAAC;oBACf,IAAI,MAAM,MAAM,GAAG,GAAG;wBACpB,WAAW,IAAI,CAAC;oBAClB;gBACF;;YAEA,IAAI,WAAW,MAAM,KAAK,GAAG;gBAC3B,oJAAK,CAAC,IAAI,CAAC;gBACX;YACF;YAEA,mBAAmB;YACnB,wBAAwB;QAC1B;gDAAG;QAAC;KAAU;IAEd,MAAM,mBAAmB,CAAC;QACxB,0BAA0B;QAC1B,mBAAmB;IACrB;IAEA,MAAM,sBAAsB;QAC1B,+BAA+B;QAC/B,OAAO,QAAQ,CAAC,MAAM;IACxB;IAEA,IAAI,mBAAmB,CAAC,mBAAmB,aAAa,iBAAiB;QACvE,qBAAO,6LAAC,qKAAoB;;;;;IAC9B;IAEA,IAAI,CAAC,SAAS;QACZ,qBACE,6LAAC;YAAI,WAAU;;8BACb,6LAAC,6IAAK;oBAAC,SAAQ;;sCACb,6LAAC,sOAAW;4BAAC,WAAU;;;;;;sCACvB,6LAAC,kJAAU;sCAAC;;;;;;sCACZ,6LAAC,wJAAgB;sCAAC;;;;;;;;;;;;8BAKpB,6LAAC;oBAAI,WAAU;8BACb,cAAA,6LAAC,+IAAM;wBAAC,SAAS,IAAM,SAAS;wBAAM,SAAQ;wBAAU,WAAU;;0CAChE,6LAAC,gOAAS;gCAAC,WAAU;;;;;;4BAAY;;;;;;;;;;;;;;;;;;IAM3C;IAEA,qBACE,6LAAC;QAAI,WAAU;;0BAEb,6LAAC,+JAAc;gBACb,kBAAkB;gBAClB,kBAAkB,UAAU,iBAAiB;gBAC7C,WAAW;gBACX,UAAU,SAAS,QAAQ;gBAC3B,cAAc,SAAS,YAAY;gBACnC,cAAc,SAAS,YAAY;gBACnC,iBAAiB;gBACjB,8BAA8B;gBAC9B,WAAW;;;;;;0BAIb,6LAAC,mKAAkB;gBAAC,eAAe;;;;;;0BAGnC,6LAAC,6JAAY;gBAAC,WAAW;;;;;;0BAGzB,6LAAC,wKAAuB;;;;;0BAGxB,6LAAC,gKAAe;gBACd,WAAW;gBACX,cAAc;gBACd,kBAAkB;gBAClB,YAAY;gBACZ,eAAe;gBACf,kBAAkB;gBAClB,qBAAqB;gBACrB,YAAY;gBACZ,eAAe;gBACf,WAAW;gBACX,cAAc;gBACd,iBAAiB;gBACjB,mBAAmB;gBACnB,WAAW;gBACX,eAAe;gBACf,iBAAiB;gBACjB,kBAAkB;gBAClB,gBAAgB;gBAChB,kBAAkB;gBAClB,kBAAkB;gBAClB,qBAAqB;gBACrB,WAAW;gBACX,SAAS;gBACT,WAAW;;;;;;0BAIb,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAI,WAAU;;4BAA2C;4BAC/C,CAAC,OAAO,CAAC,IAAI,WAAW;4BAAE;4BAAE,KAAK,GAAG,CAAC,OAAO,UAAU;4BAAY;4BAAK;;;;;;;kCAElF,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;gCACC,WAAU;gCACV,OAAO;gCACP,UAAU,CAAC,IAAM,YAAY,OAAO,EAAE,MAAM,CAAC,KAAK;0CAEjD;oCAAC;oCAAI;oCAAI;iCAAI,CAAC,GAAG,CAAC,CAAA,qBACjB,6LAAC;wCAAkB,OAAO;;4CAAO;4CAAK;;uCAAzB;;;;;;;;;;0CAGjB,6LAAC;gCACC,WAAU;gCACV,UAAU,SAAS,KAAK;gCACxB,SAAS,IAAM,QAAQ,KAAK,GAAG,CAAC,GAAG,OAAO;gCAC1C,MAAK;0CACN;;;;;;0CAGD,6LAAC;gCACC,WAAU;gCACV,UAAU,OAAO,YAAY,cAAc;gCAC3C,SAAS,IAAM,QAAQ,OAAO;gCAC9B,MAAK;0CACN;;;;;;;;;;;;;;;;;;0BAML,6LAAC,kKAAiB;gBAChB,MAAM;gBACN,SAAS;oBACP,yBAAyB;oBACzB,kBAAkB;gBACpB;gBACA,eAAe;gBACf,aAAa;;;;;;0BAIf,6LAAC,+IAAM;gBAAC,MAAM;gBAAsB,cAAc;0BAChD,cAAA,6LAAC,sJAAa;oBAAC,WAAU;;sCACvB,6LAAC,qJAAY;;8CACX,6LAAC,oJAAW;8CAAC;;;;;;8CACb,6LAAC,0JAAiB;;wCAAC;wCACV,gBAAgB,MAAM;wCAAC;;;;;;;;;;;;;sCAIlC,6LAAC;4BAAI,WAAU;sCACZ,gBAAgB,GAAG,CAAC,CAAC,OAAO,sBAC3B,6LAAC,2IAAI;oCAAa,WAAU;8CAC1B,cAAA,6LAAC,kJAAW;wCAAC,WAAU;;0DACrB,6LAAC;gDAAI,WAAU;;kEACb,6LAAC;;0EACC,6LAAC;gEAAI,WAAU;0EAAyB,KAAK,CAAC,EAAE,CAAC,QAAQ;;;;;;0EACzD,6LAAC,6IAAK;gEAAC,SAAQ;gEAAY,WAAU;;oEAClC,MAAM,MAAM;oEAAC;;;;;;;;;;;;;kEAGlB,6LAAC,+IAAM;wDAAC,SAAS,IAAM,iBAAiB;wDAAQ,MAAK;kEAAK;;;;;;;;;;;;0DAI5D,6LAAC;gDAAI,WAAU;0DACZ,MAAM,GAAG,CAAC,CAAC,yBACV,6LAAC;wDAAsB,WAAU;;0EAC/B,6LAAC;;kFACC,6LAAC;kFAAK,SAAS,WAAW,IAAI;;;;;;kFAC9B,6LAAC;wEAAI,WAAU;;4EAAgC;4EACnC,SAAS,SAAS,CAAC,kBAAkB;;;;;;;;;;;;;4DAGlD,SAAS,KAAK,kBACb,6LAAC;gEAAI,WAAU;0EAAiC,SAAS,KAAK;;;;;;;uDARxD,SAAS,EAAE;;;;;;;;;;;;;;;;mCAflB;;;;;;;;;;;;;;;;;;;;;YAoClB,wCACC,6LAAC,qKAAoB;gBACnB,MAAM;gBACN,cAAc;gBACd,WAAW;gBACX,iBAAiB;;;;;;;;;;;;AAK3B;GAnXM;;QACa,wJAAO;QACgC,qJAAW;QACgE,+IAAY;QACxH,iKAAqB;QACvB,6JAAmB;QACC,+IAAY;QASpC,kLAAW;QACX,kLAAW;QAC0B,oJAAW;QA8Ec,qJAAe;;;KA/F1F;uCAqXS"}}]
}