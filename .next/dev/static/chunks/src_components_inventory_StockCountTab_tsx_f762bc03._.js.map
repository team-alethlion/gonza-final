{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/inventory/StockCountTab.tsx"],"sourcesContent":["import React, { useState, useCallback, useEffect, useMemo, useRef } from 'react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\r\nimport { Trash2, Save, Search, ScanBarcode, TrendingUp, TrendingDown, ClipboardList, Filter, Edit, AlertTriangle } from 'lucide-react';\r\nimport { format } from 'date-fns';\r\nimport { useAuth } from '@/components/auth/AuthProvider';\r\nimport { useProducts } from '@/hooks/useProducts';\r\nimport { toast } from 'sonner';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\nimport { Product, mapDbProductToProduct } from '@/types';\r\nimport { cn } from '@/lib/utils';\r\nimport { exportStockCountToCSV, exportStockCountToPDF } from '@/utils/exportStockCount';\r\nimport {\r\n    AlertDialog,\r\n    AlertDialogAction,\r\n    AlertDialogCancel,\r\n    AlertDialogContent,\r\n    AlertDialogDescription,\r\n    AlertDialogFooter,\r\n    AlertDialogHeader,\r\n    AlertDialogTitle,\r\n} from \"@/components/ui/alert-dialog\";\r\nimport { Download, FileDown, History as HistoryIcon, Clock, ChevronRight, Info } from 'lucide-react';\r\nimport { useStockHistory } from '@/hooks/useStockHistory';\r\nimport { lookupProductByBarcodeAction } from '@/app/actions/products';\r\n\r\n\r\n// State stored in localStorage: Record<productId, actualStock>\r\nconst STORAGE_KEY = 'stockCountData';\r\n\r\n// Sub-component for the tables to keep main component clean\r\nconst AuditTable = ({ rows, onUpdate, onRemove, isAuditMode, lastScannedId }: any) => (\r\n    <div className=\"overflow-x-auto\">\r\n        <Table>\r\n            <TableHeader>\r\n                <TableRow className=\"bg-muted/50 border-b-2\">\r\n                    <TableHead className=\"min-w-[200px] font-bold text-gray-700\">Item Details</TableHead>\r\n                    <TableHead className=\"text-center w-[120px] font-bold text-gray-700\">System</TableHead>\r\n                    <TableHead className=\"text-center w-[150px] font-bold text-gray-700\">Actual Count</TableHead>\r\n                    <TableHead className=\"text-center w-[150px] font-bold text-gray-700\">Variation</TableHead>\r\n                    {!isAuditMode && <TableHead className=\"text-right w-[80px]\"></TableHead>}\r\n                </TableRow>\r\n            </TableHeader>\r\n            <TableBody>\r\n                {rows.length === 0 ? (\r\n                    <TableRow>\r\n                        <TableCell colSpan={isAuditMode ? 4 : 5} className=\"h-48 text-center bg-slate-50\">\r\n                            <div className=\"flex flex-col items-center gap-2 text-muted-foreground\">\r\n                                <Filter className=\"h-8 w-8 opacity-20\" />\r\n                                <p>{isAuditMode ? 'No products match your search' : 'No items recorded yet'}</p>\r\n                            </div>\r\n                        </TableCell>\r\n                    </TableRow>\r\n                ) : (\r\n                    rows.map(({ product, actualStock, variation }: any) => (\r\n                        <TableRow\r\n                            key={product.id}\r\n                            id={`row-${product.id}`}\r\n                            className={cn(\r\n                                \"hover:bg-muted/30 transition-colors\",\r\n                                variation !== 0 && \"bg-orange-50/20\",\r\n                                lastScannedId === product.id && \"row-highlight\"\r\n                            )}\r\n                        >\r\n                            <TableCell className=\"py-4\">\r\n                                <div className=\"font-bold text-gray-900 leading-tight\">{product.name}</div>\r\n                                <div className=\"text-[10px] text-muted-foreground font-mono mt-1 uppercase tracking-tighter\">\r\n                                    {product.barcode || 'NO BARCODE'}\r\n                                </div>\r\n                            </TableCell>\r\n\r\n                            <TableCell className=\"text-center text-sm font-medium text-slate-500\">\r\n                                {product.quantity}\r\n                            </TableCell>\r\n\r\n                            <TableCell className=\"text-center\">\r\n                                <div className=\"flex items-center justify-center gap-2\">\r\n                                    <Button\r\n                                        variant=\"outline\"\r\n                                        size=\"icon\"\r\n                                        className=\"h-8 w-8 rounded-full\"\r\n                                        onClick={() => onUpdate(product, -1, true)}\r\n                                    >\r\n                                        -\r\n                                    </Button>\r\n                                    <Input\r\n                                        type=\"number\"\r\n                                        className=\"w-20 text-center font-black text-lg border-2\"\r\n                                        value={actualStock}\r\n                                        onChange={(e) => onUpdate(product, parseFloat(e.target.value) || 0, false)}\r\n                                    />\r\n                                    <Button\r\n                                        variant=\"outline\"\r\n                                        size=\"icon\"\r\n                                        className=\"h-8 w-8 rounded-full bg-slate-100\"\r\n                                        onClick={() => onUpdate(product, 1, true)}\r\n                                    >\r\n                                        +\r\n                                    </Button>\r\n                                </div>\r\n                            </TableCell>\r\n\r\n                            <TableCell className=\"text-center\">\r\n                                <div className={cn(\r\n                                    \"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-black ring-1\",\r\n                                    variation > 0 ? \"text-emerald-700 bg-emerald-50 ring-emerald-200\" :\r\n                                        variation < 0 ? \"text-rose-700 bg-rose-50 ring-rose-200\" :\r\n                                            \"text-slate-500 bg-slate-50 ring-slate-200\"\r\n                                )}>\r\n                                    {variation > 0 ? <TrendingUp className=\"h-3 w-3 mr-1\" /> : variation < 0 ? <TrendingDown className=\"h-3 w-3 mr-1\" /> : null}\r\n                                    {variation > 0 ? '+' : ''}{variation}\r\n                                </div>\r\n                            </TableCell>\r\n\r\n                            {!isAuditMode && (\r\n                                <TableCell className=\"text-right px-4\">\r\n                                    <Button\r\n                                        variant=\"ghost\"\r\n                                        size=\"icon\"\r\n                                        onClick={() => onRemove(product.id)}\r\n                                        className=\"hover:bg-red-50 hover:text-red-600 rounded-full\"\r\n                                    >\r\n                                        <Trash2 className=\"h-4 w-4\" />\r\n                                    </Button>\r\n                                </TableCell>\r\n                            )}\r\n                        </TableRow>\r\n                    ))\r\n                )}\r\n            </TableBody>\r\n        </Table>\r\n    </div>\r\n);\r\n\r\nconst StockCountTab = () => {\r\n    const { user } = useAuth();\r\n    const userId = user?.id;\r\n    const { currentBusiness } = useBusiness();\r\n    const { products, updateProduct, updateProductsBulk, loadProducts } = useProducts(userId, 10000);\r\n    const [isSubmitting, setIsSubmitting] = useState(false);\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [activeTab, setActiveTab] = useState('quick');\r\n    const [lastScannedId, setLastScannedId] = useState<string | null>(null);\r\n    const [showCommitDialog, setShowCommitDialog] = useState(false);\r\n    const [selectedAuditId, setSelectedAuditId] = useState<string | null>(null);\r\n    const [auditorName, setAuditorName] = useState('');\r\n    const [contactPerson, setContactPerson] = useState('');\r\n    const [editingSessionId, setEditingSessionId] = useState<string | null>(null);\r\n    const [deleteDialogSession, setDeleteDialogSession] = useState<typeof auditSessions[0] | null>(null);\r\n\r\n    const { stockHistory, isLoading: isLoadingHistory, loadStockHistory } = useStockHistory(userId);\r\n\r\n    // Local counts database: productId -> actualCount\r\n    const [counts, setCounts] = useState<Record<string, number>>(() => {\r\n        try {\r\n            const saved = localStorage.getItem(STORAGE_KEY);\r\n            return saved ? JSON.parse(saved) : {};\r\n        } catch (e) {\r\n            return {};\r\n        }\r\n    });\r\n\r\n    // Persist counts\r\n    useEffect(() => {\r\n        localStorage.setItem(STORAGE_KEY, JSON.stringify(counts));\r\n    }, [counts]);\r\n\r\n    // Generate a unique session ID for the audit (proper UUID for database)\r\n    const generateSessionId = () => crypto.randomUUID();\r\n\r\n    // Shared function to update or add a count\r\n    const handleCountUpdate = useCallback((product: Product, value: number, isRelative: boolean = true) => {\r\n        setCounts(prev => {\r\n            const current = prev[product.id] || 0;\r\n            const newValue = isRelative ? current + value : value;\r\n            return {\r\n                ...prev,\r\n                [product.id]: Math.max(0, newValue)\r\n            };\r\n        });\r\n    }, []);\r\n\r\n    const handleScanSuccess = useCallback((product: Product) => {\r\n        handleCountUpdate(product, 1, true);\r\n        setLastScannedId(product.id);\r\n        toast.success(`Tally: ${product.name}`, { duration: 1000, position: 'bottom-center' });\r\n\r\n        // Remove highlight after 2 seconds\r\n        setTimeout(() => setLastScannedId(null), 2000);\r\n    }, [handleCountUpdate]);\r\n\r\n    // Auto-scroll logic\r\n    useEffect(() => {\r\n        if (lastScannedId) {\r\n            const element = document.getElementById(`row-${lastScannedId}`);\r\n            if (element) {\r\n                element.scrollIntoView({ behavior: 'smooth', block: 'center' });\r\n            }\r\n        }\r\n    }, [lastScannedId]);\r\n\r\n    const scannerBufferRef = useRef('');\r\n    const lastKeyTimeRef = useRef(Date.now());\r\n\r\n    // Global Barcode Listener\r\n    useEffect(() => {\r\n        const handleKeyDown = (e: KeyboardEvent) => {\r\n            const target = e.target as HTMLElement;\r\n            const currentTime = Date.now();\r\n            const delay = currentTime - lastKeyTimeRef.current;\r\n            lastKeyTimeRef.current = currentTime;\r\n\r\n            // Threshold increased to 60ms for broader scanner compatibility\r\n            const isRapidTyping = delay < 60;\r\n            const isAlphanumeric = /^[a-zA-Z0-9\\-_]$/.test(e.key);\r\n\r\n            // Aggressive Interception: If NOT in an input field, suppress ALL alphanumeric keys\r\n            const isInput = target.tagName === 'INPUT' || target.tagName === 'TEXTAREA' || target.contentEditable === 'true';\r\n            if (!isInput && isAlphanumeric) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n            }\r\n\r\n            if (e.key === 'Enter') {\r\n                const scannedBarcode = scannerBufferRef.current.trim();\r\n                if (scannedBarcode.length >= 2) {\r\n                    // Always prevent Enter/Return from being processed by browser/console\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n\r\n                    console.log(`[StockCount Scanner] Processing: \"${scannedBarcode}\"`);\r\n\r\n                    // Perform direct server-side lookup via Prisma action\r\n                    const performServerLookup = async (code: string): Promise<Product | null> => {\r\n                        const result = await lookupProductByBarcodeAction(code, currentBusiness?.id || '');\r\n                        return result ? mapDbProductToProduct(result) : null;\r\n                    };\r\n\r\n\r\n                    const handleScan = async () => {\r\n                        const product = await performServerLookup(scannedBarcode);\r\n\r\n                        if (product) {\r\n                            const referenceCode = product.barcode || product.itemNumber || scannedBarcode;\r\n                            console.log(`[StockCount Scanner] âœ… Server Match: ${product.name}`);\r\n                            console.log(`[StockCount Scanner] ðŸ”— Mapping \"${scannedBarcode}\" -> System Code \"${referenceCode}\"`);\r\n\r\n                            handleScanSuccess(product);\r\n                        } else {\r\n                            console.warn(`[StockCount Scanner] âŒ No server match for: \"${scannedBarcode}\"`);\r\n                        }\r\n                    };\r\n\r\n                    handleScan();\r\n                    scannerBufferRef.current = '';\r\n                    return;\r\n                }\r\n\r\n                // Always clear and block Enter if not in input\r\n                if (!isInput || scannedBarcode.length >= 2) {\r\n                    scannerBufferRef.current = '';\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                }\r\n                return;\r\n            }\r\n\r\n            if (e.key.length === 1) {\r\n                // Only prevent default if this is rapid typing (scanner) AND in an input field\r\n                // OR if not in an input field at all\r\n                if (isRapidTyping && isInput && isAlphanumeric) {\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                }\r\n\r\n                // Update buffer\r\n                if (delay > 100) {\r\n                    scannerBufferRef.current = e.key;\r\n                } else {\r\n                    scannerBufferRef.current += e.key;\r\n                }\r\n            }\r\n        };\r\n\r\n\r\n        window.addEventListener('keydown', handleKeyDown, true);\r\n        return () => window.removeEventListener('keydown', handleKeyDown, true);\r\n    }, [userId, currentBusiness?.id]);\r\n\r\n    // Main data for the \"Full List\" table\r\n    const tableRows = useMemo(() => {\r\n        return products\r\n            .filter(p => {\r\n                // When editing an audit, only show products from that audit session\r\n                if (editingSessionId) {\r\n                    return counts.hasOwnProperty(p.id);\r\n                }\r\n                // Otherwise show products that have counts recorded\r\n                return counts.hasOwnProperty(p.id);\r\n            })\r\n            .map(product => {\r\n                const actualStock = counts[product.id];\r\n                if (actualStock === undefined) return null;\r\n                return {\r\n                    product,\r\n                    actualStock,\r\n                    variation: Number((actualStock - product.quantity).toFixed(2))\r\n                };\r\n            })\r\n            .filter((row): row is NonNullable<typeof row> => row !== null);\r\n    }, [counts, products, editingSessionId]);\r\n\r\n    // Derived data for the Quick Scan table (same as tableRows for now)\r\n    const quickRows = tableRows;\r\n\r\n    // Filtered data for the Audit List table\r\n    const auditRows = useMemo(() => {\r\n        const searchLow = searchTerm.toLowerCase();\r\n        return products\r\n            .filter(p => !searchTerm ||\r\n                p.name.toLowerCase().includes(searchLow) ||\r\n                (p.barcode && p.barcode.toLowerCase().includes(searchLow)) ||\r\n                (p.itemNumber && p.itemNumber.toLowerCase().includes(searchLow)) ||\r\n                (p.manufacturerBarcode && p.manufacturerBarcode.toLowerCase().includes(searchLow))\r\n            )\r\n            .map(product => {\r\n                const actualStock = counts[product.id] ?? 0;\r\n                return {\r\n                    product,\r\n                    actualStock,\r\n                    variation: Number((actualStock - product.quantity).toFixed(2))\r\n                };\r\n            });\r\n    }, [counts, products, searchTerm]);\r\n\r\n    const commitStockCount = async (shouldUpdateInventory: boolean) => {\r\n        const affectedIds = Object.keys(counts);\r\n        if (affectedIds.length === 0) return;\r\n\r\n        // Guard against double-submission\r\n        if (isSubmitting) {\r\n            console.warn('âš ï¸ Commit already in progress, ignoring duplicate call');\r\n            return;\r\n        }\r\n\r\n        setIsSubmitting(true);\r\n        setShowCommitDialog(false);\r\n\r\n        const sessionId = editingSessionId || generateSessionId();\r\n\r\n        // Generate user-friendly audit ID (AUD-0001 format)\r\n        const auditCount = auditSessions.length + 1;\r\n        const auditId = `AUD-${String(auditCount).padStart(4, '0')}`;\r\n\r\n        const reasonPrefix = editingSessionId ? 'Stock Count Edit' : 'Stock Count Update';\r\n        const finalReason = `${auditId} | ${reasonPrefix}${auditorName ? ` | Auditor: ${auditorName}` : ''}${contactPerson ? ` | Contact: ${contactPerson}` : ''}`;\r\n\r\n        console.log('ðŸ” Stock Count Commit Debug:', {\r\n            shouldUpdateInventory,\r\n            affectedIds,\r\n            sessionId,\r\n            auditId,\r\n            finalReason,\r\n            userId,\r\n            updateCount: affectedIds.length\r\n        });\r\n\r\n        try {\r\n            if (shouldUpdateInventory) {\r\n                const updates = affectedIds.map(id => {\r\n                    const product = products.find(p => p.id === id);\r\n                    if (!product) return null;\r\n                    return {\r\n                        id,\r\n                        updated: { quantity: counts[id] }\r\n                    };\r\n                }).filter((u): u is NonNullable<typeof u> => u !== null);\r\n\r\n                if (updates.length > 0) {\r\n                    if (editingSessionId) {\r\n                        // REVERT OLD AUDIT FIRST\r\n                        const sessionToDelete = auditSessions.find(s => s.id === editingSessionId);\r\n                        if (sessionToDelete) {\r\n                            const entryIds = sessionToDelete.items.map(i => i.id);\r\n                            const poductIds = Array.from(new Set(sessionToDelete.items.map(i => i.productId)));\r\n\r\n                            await deleteMultipleStockHistoryEntries(entryIds);\r\n                            for (const pid of poductIds) {\r\n                                await recalculateStockChain(pid);\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    const success = await updateProductsBulk(\r\n                        updates,\r\n                        userId,\r\n                        finalReason,\r\n                        sessionId\r\n                    );\r\n                    if (success) {\r\n                        toast.success(`Inventory updated! ${updates.length} items corrected.`);\r\n                    } else {\r\n                        throw new Error(\"Bulk update failed\");\r\n                    }\r\n                }\r\n            } else {\r\n                toast.success(`Audit completed and cleared (Inventory not changed).`);\r\n            }\r\n\r\n            setCounts({});\r\n            setAuditorName('');\r\n            setContactPerson('');\r\n            setEditingSessionId(null);\r\n            localStorage.removeItem(STORAGE_KEY);\r\n            await loadProducts();\r\n\r\n            // Force reload stock history to show new audit immediately\r\n            await loadStockHistory();\r\n        } catch (error) {\r\n            console.error(\"Commit error:\", error);\r\n            toast.error(\"An error occurred during completion.\");\r\n        } finally {\r\n            setIsSubmitting(false);\r\n        }\r\n    };\r\n\r\n    const handleExportCSV = () => {\r\n        const data = activeTab === 'quick' ? quickRows : auditRows;\r\n\r\n        if (data.length === 0) {\r\n            toast.error(\"No items to export.\");\r\n            return;\r\n        }\r\n        exportStockCountToCSV(data);\r\n    };\r\n\r\n    const handleExportPDF = () => {\r\n        const data = activeTab === 'quick' ? quickRows : auditRows;\r\n\r\n        if (data.length === 0) {\r\n            toast.error(\"No items to export.\");\r\n            return;\r\n        }\r\n        exportStockCountToPDF(data, currentBusiness?.name, {\r\n            auditorName,\r\n            contactPerson\r\n        });\r\n    };\r\n\r\n    const clearAll = () => {\r\n        if (Object.keys(counts).length === 0) return;\r\n        if (window.confirm(\"Clear all recorded counts? progress will be lost.\")) {\r\n            setCounts({});\r\n            localStorage.removeItem(STORAGE_KEY);\r\n            toast.info(\"Progress cleared.\");\r\n        }\r\n    };\r\n\r\n    // Process history for the \"History\" tab\r\n    const auditSessions = useMemo(() => {\r\n        const auditEntries = stockHistory.filter(h =>\r\n            h.changeReason?.includes('Stock Count Update') || h.changeReason?.includes('Stock Count Edit')\r\n        );\r\n        const groups: Record<string, { id: string, date: Date, items: typeof auditEntries, auditId?: string, isEdited?: boolean }> = {};\r\n\r\n        auditEntries.forEach(entry => {\r\n            const sessionId = entry.referenceId || 'unknown';\r\n\r\n            // Extract audit ID from change reason (AUD-0001 format)\r\n            const auditIdMatch = entry.changeReason?.match(/AUD-\\d{4}/);\r\n            const auditId = auditIdMatch ? auditIdMatch[0] : undefined;\r\n\r\n            // Check if this entry was from an edit\r\n            const isEdited = entry.changeReason?.includes('Stock Count Edit') || false;\r\n\r\n            if (!groups[sessionId]) {\r\n                groups[sessionId] = {\r\n                    id: sessionId,\r\n                    date: entry.createdAt,\r\n                    items: [],\r\n                    auditId,\r\n                    isEdited: false\r\n                };\r\n            }\r\n\r\n            // Mark session as edited if any entry is an edit\r\n            if (isEdited) {\r\n                groups[sessionId].isEdited = true;\r\n            }\r\n\r\n            // Defensive: Only add if this specific history ID isn't already in the group\r\n            if (!groups[sessionId].items.find(item => item.id === entry.id)) {\r\n                groups[sessionId].items.push(entry);\r\n            }\r\n        });\r\n\r\n        const sorted = Object.values(groups).sort((a, b) => a.date.getTime() - b.date.getTime());\r\n        // Assign sequence numbers based on chronological order\r\n        return sorted.map((session, index) => ({\r\n            ...session,\r\n            auditNumber: index + 1\r\n        })).reverse(); // Newest first for display\r\n    }, [stockHistory]);\r\n\r\n    const handleSessionExportCSV = (session: typeof auditSessions[0]) => {\r\n        const data = session.items.map(item => ({\r\n            product: {\r\n                ...item.product,\r\n                id: item.productId,\r\n                quantity: item.oldQuantity // System stock at time of audit\r\n            } as Product,\r\n            actualStock: item.newQuantity,\r\n            variation: item.newQuantity - item.oldQuantity\r\n        }));\r\n        exportStockCountToCSV(data);\r\n    };\r\n\r\n    const handleSessionExportPDF = (session: typeof auditSessions[0]) => {\r\n        const data = session.items.map(item => ({\r\n            product: {\r\n                ...item.product,\r\n                id: item.productId,\r\n                quantity: item.oldQuantity // System stock at time of audit\r\n            } as Product,\r\n            actualStock: item.newQuantity,\r\n            variation: item.newQuantity - item.oldQuantity\r\n        }));\r\n\r\n        // Try to extract auditor/contact from changeReason\r\n        const firstReason = session.items[0]?.changeReason || '';\r\n        const auditorMatch = firstReason.match(/Auditor: ([^|]*)/);\r\n        const contactMatch = firstReason.match(/Contact: ([^|]*)/);\r\n\r\n        exportStockCountToPDF(data, currentBusiness?.name, {\r\n            auditNumber: session.auditNumber,\r\n            auditorName: auditorMatch ? auditorMatch[1].trim() : undefined,\r\n            contactPerson: contactMatch ? contactMatch[1].trim() : undefined,\r\n            auditId: session.auditId\r\n        });\r\n    };\r\n\r\n    const handleSessionEdit = (session: typeof auditSessions[0]) => {\r\n        const editCounts: Record<string, number> = {};\r\n        session.items.forEach(item => {\r\n            editCounts[item.productId] = item.newQuantity;\r\n        });\r\n\r\n        const firstReason = session.items[0]?.changeReason || '';\r\n        const auditorMatch = firstReason.match(/Auditor: ([^|]*)/);\r\n        const contactMatch = firstReason.match(/Contact: ([^|]*)/);\r\n\r\n        setCounts(editCounts);\r\n        setAuditorName(auditorMatch ? auditorMatch[1].trim() : '');\r\n        setContactPerson(contactMatch ? contactMatch[1].trim() : '');\r\n        setEditingSessionId(session.id);\r\n        setActiveTab('audit');\r\n        toast.info(`Editing Audit #${session.auditNumber}`);\r\n    };\r\n\r\n    const { deleteMultipleStockHistoryEntries, recalculateStockChain } = useStockHistory(userId);\r\n\r\n    const handleSessionDelete = async (session: typeof auditSessions[0]) => {\r\n        setDeleteDialogSession(null);\r\n        setIsSubmitting(true);\r\n        try {\r\n            const entryIds = session.items.map(i => i.id);\r\n            const productIds = Array.from(new Set(session.items.map(i => i.productId)));\r\n\r\n            // Delete entries\r\n            const success = await deleteMultipleStockHistoryEntries(entryIds);\r\n\r\n            if (success) {\r\n                // Recalculate chain for each affected product to restore stock\r\n                for (const pid of productIds) {\r\n                    await recalculateStockChain(pid);\r\n                }\r\n                toast.success(\"Audit deleted and stock restored!\");\r\n                await loadProducts(); // Refresh UI stock\r\n            } else {\r\n                toast.error(\"Failed to delete audit.\");\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Delete session error:\", error);\r\n            toast.error(\"An error occurred.\");\r\n        } finally {\r\n            setIsSubmitting(false);\r\n        }\r\n    };\r\n\r\n    const removeProduct = (id: string) => {\r\n        const newCounts = { ...counts };\r\n        delete newCounts[id];\r\n        setCounts(newCounts);\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-4\">\r\n            <style dangerouslySetInnerHTML={{\r\n                __html: `\r\n                @keyframes highlight-fade {\r\n                    0% { background-color: rgba(59, 130, 246, 0.2); }\r\n                    100% { background-color: transparent; }\r\n                }\r\n                .row-highlight {\r\n                    animation: highlight-fade 2s ease-out forwards;\r\n                }\r\n            `}} />\r\n            <Card className=\"shadow-sm border-2\">\r\n                <CardHeader className=\"pb-3 px-4 md:px-6 bg-muted/20\">\r\n                    <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\r\n                        <div>\r\n                            <CardTitle className=\"text-xl flex items-center gap-2\">\r\n                                <ScanBarcode className=\"h-6 w-6 text-sales-primary\" />\r\n                                Inventory Audit\r\n                            </CardTitle>\r\n                            <p className=\"text-sm text-muted-foreground mt-1\">\r\n                                Counts are saved locally. Click \"Complete Audit\" to update the system.\r\n                            </p>\r\n                        </div>\r\n                        <div className=\"flex flex-wrap gap-2\">\r\n                            <div className=\"flex gap-1 mr-2 border-r pr-2\">\r\n                                <Button\r\n                                    variant=\"outline\"\r\n                                    size=\"sm\"\r\n                                    onClick={handleExportCSV}\r\n                                    disabled={activeTab === 'history' || (activeTab === 'quick' && quickRows.length === 0) || (activeTab === 'audit' && auditRows.length === 0)}\r\n                                    className=\"h-9 gap-2\"\r\n                                >\r\n                                    <Download className=\"h-4 w-4\" />\r\n                                    CSV\r\n                                </Button>\r\n                                <Button\r\n                                    variant=\"outline\"\r\n                                    size=\"sm\"\r\n                                    onClick={handleExportPDF}\r\n                                    disabled={activeTab === 'history' || (activeTab === 'quick' && quickRows.length === 0) || (activeTab === 'audit' && auditRows.length === 0)}\r\n                                    className=\"h-9 gap-2\"\r\n                                >\r\n                                    <FileDown className=\"h-4 w-4\" />\r\n                                    PDF\r\n                                </Button>\r\n                            </div>\r\n                            <Button\r\n                                variant=\"outline\"\r\n                                onClick={clearAll}\r\n                                disabled={isSubmitting || Object.keys(counts).length === 0}\r\n                                className=\"text-red-500 border-red-200 hover:bg-red-50 h-9\"\r\n                            >\r\n                                <Trash2 className=\"h-4 w-4 mr-2\" />\r\n                                Reset\r\n                            </Button>\r\n                            <Button\r\n                                onClick={() => setShowCommitDialog(true)}\r\n                                disabled={isSubmitting || Object.keys(counts).length === 0}\r\n                                className=\"gap-2 bg-sales-primary hover:bg-sales-primary/90 shadow-md h-9 px-4\"\r\n                            >\r\n                                <Save className=\"h-4 w-4\" />\r\n                                {isSubmitting ? 'Syncing...' : 'Complete Audit'}\r\n                            </Button>\r\n                        </div>\r\n                    </div>\r\n                </CardHeader>\r\n\r\n                <CardContent className=\"p-0\">\r\n                    <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\r\n                        <div className=\"px-4 md:px-6 pt-4 border-b\">\r\n                            <TabsList className=\"flex w-full md:w-[450px] mb-4 overflow-x-auto\">\r\n                                <TabsTrigger value=\"quick\" className=\"flex-1 gap-2 whitespace-nowrap\">\r\n                                    <ScanBarcode className=\"h-4 w-4\" />\r\n                                    Quick Scan\r\n                                </TabsTrigger>\r\n                                <TabsTrigger value=\"audit\" className=\"flex-1 gap-2 whitespace-nowrap\">\r\n                                    <ClipboardList className=\"h-4 w-4\" />\r\n                                    Full List\r\n                                </TabsTrigger>\r\n                                <TabsTrigger value=\"history\" className=\"flex-1 gap-2 whitespace-nowrap\">\r\n                                    <HistoryIcon className=\"h-4 w-4\" />\r\n                                    Audit History\r\n                                </TabsTrigger>\r\n                            </TabsList>\r\n                        </div>\r\n\r\n                        <TabsContent value=\"quick\" className=\"m-0\">\r\n                            <div className=\"p-6 text-center bg-sales-primary/5 border-b\">\r\n                                <div className=\"inline-flex items-center justify-center p-3 rounded-full bg-white shadow-sm mb-4\">\r\n                                    <ScanBarcode className=\"h-8 w-8 text-sales-primary animate-pulse\" />\r\n                                </div>\r\n                                <h3 className=\"text-lg font-semibold text-gray-900\">Scan to Start</h3>\r\n                                <p className=\"text-sm text-muted-foreground max-w-xs mx-auto\">\r\n                                    Just start scanning barcodes. Scanned items will appear below.\r\n                                </p>\r\n                            </div>\r\n\r\n                            <AuditTable\r\n                                rows={quickRows}\r\n                                onUpdate={handleCountUpdate}\r\n                                onRemove={removeProduct}\r\n                                isAuditMode={false}\r\n                                lastScannedId={lastScannedId}\r\n                            />\r\n                        </TabsContent>\r\n\r\n                        <TabsContent value=\"audit\" className=\"space-y-4\">\r\n                            {editingSessionId && (\r\n                                <div className=\"bg-amber-50 border border-amber-200 rounded-lg p-3 flex items-center gap-2 mx-4 md:mx-6 mt-4\">\r\n                                    <Edit className=\"h-4 w-4 text-amber-600\" />\r\n                                    <span className=\"text-sm font-medium text-amber-900\">\r\n                                        Editing Mode: Only showing items from this audit session\r\n                                    </span>\r\n                                </div>\r\n                            )}\r\n                            <div className=\"p-4 border-b flex items-center gap-4 bg-muted/10\">\r\n                                <div className=\"relative flex-1 max-w-md\">\r\n                                    <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\r\n                                    <Input\r\n                                        placeholder=\"Search name or barcode...\"\r\n                                        className=\"pl-10 barcode-friendly\"\r\n                                        value={searchTerm}\r\n                                        onChange={(e) => setSearchTerm(e.target.value)}\r\n                                    />\r\n                                </div>\r\n                                <div className=\"text-sm font-medium text-muted-foreground\">\r\n                                    Showing {auditRows.length} of {products.length} items\r\n                                </div>\r\n                            </div>\r\n\r\n                            <AuditTable\r\n                                rows={auditRows}\r\n                                onUpdate={handleCountUpdate}\r\n                                isAuditMode={true}\r\n                                lastScannedId={lastScannedId}\r\n                            />\r\n                        </TabsContent>\r\n\r\n                        <TabsContent value=\"history\" className=\"m-0 bg-slate-50/50\">\r\n                            <div className=\"p-4 md:p-8\">\r\n                                <div className=\"max-w-4xl mx-auto space-y-6\">\r\n                                    {isLoadingHistory ? (\r\n                                        <div className=\"flex flex-col items-center justify-center py-20 gap-4\">\r\n                                            <div className=\"w-8 h-8 border-4 border-sales-primary border-t-transparent rounded-full animate-spin\" />\r\n                                            <p className=\"text-sm text-muted-foreground\">Loading history...</p>\r\n                                        </div>\r\n                                    ) : auditSessions.length === 0 ? (\r\n                                        <div className=\"flex flex-col items-center justify-center py-20 text-center space-y-3 bg-white border-2 border-dashed rounded-3xl\">\r\n                                            <div className=\"p-4 rounded-full bg-slate-50\">\r\n                                                <HistoryIcon className=\"h-10 w-10 text-slate-300\" />\r\n                                            </div>\r\n                                            <div>\r\n                                                <h3 className=\"text-xl font-bold text-gray-900\">No Audits Found</h3>\r\n                                                <p className=\"text-sm text-muted-foreground\">Once you complete a stock count, it will appear here.</p>\r\n                                            </div>\r\n                                        </div>\r\n                                    ) : (\r\n                                        <div className=\"space-y-4\">\r\n                                            {auditSessions.map((session) => (\r\n                                                <div\r\n                                                    key={session.id}\r\n                                                    className=\"bg-white rounded-2xl shadow-sm border overflow-hidden hover:shadow-md transition-all cursor-pointer group\"\r\n                                                    onClick={() => setSelectedAuditId(selectedAuditId === session.id ? null : session.id)}\r\n                                                >\r\n                                                    <div className=\"p-5 flex items-center justify-between gap-4\">\r\n                                                        <div className=\"flex items-center gap-4\">\r\n                                                            <div className=\"h-12 w-12 rounded-xl bg-sales-primary/10 flex items-center justify-center\">\r\n                                                                <Clock className=\"h-6 w-6 text-sales-primary\" />\r\n                                                            </div>\r\n                                                            <div className=\"flex items-center justify-between\">\r\n                                                                <div>\r\n                                                                    <div className=\"font-bold text-gray-900 flex items-center gap-2\">\r\n                                                                        {session.auditId && (\r\n                                                                            <span className=\"inline-flex items-center px-2 py-0.5 rounded text-xs font-mono font-bold bg-blue-100 text-blue-700 border border-blue-200\">\r\n                                                                                {session.auditId}\r\n                                                                            </span>\r\n                                                                        )}\r\n                                                                        <span>Audit #{session.auditNumber} â€” {format(session.date, 'PPP')}</span>\r\n                                                                        {session.isEdited && (\r\n                                                                            <span className=\"inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold bg-amber-100 text-amber-700 border border-amber-200\">\r\n                                                                                Edited\r\n                                                                            </span>\r\n                                                                        )}\r\n                                                                    </div>\r\n                                                                    <div className=\"text-xs text-muted-foreground flex items-center gap-2\">\r\n                                                                        <span className=\"font-medium bg-slate-100 px-2 py-0.5 rounded-full\">{session.items.length} Items</span>\r\n                                                                        <span>â€¢</span>\r\n                                                                        <span>{format(session.date, 'p')}</span>\r\n                                                                    </div>\r\n                                                                </div>\r\n                                                            </div>\r\n                                                        </div>\r\n                                                        <div className=\"flex items-center gap-3\">\r\n                                                            <div className=\"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity mr-2\">\r\n                                                                <Button\r\n                                                                    variant=\"outline\"\r\n                                                                    size=\"icon\"\r\n                                                                    className=\"h-8 w-8 rounded-lg\"\r\n                                                                    onClick={(e) => { e.stopPropagation(); handleSessionExportCSV(session); }}\r\n                                                                    title=\"Export CSV\"\r\n                                                                >\r\n                                                                    <Download className=\"h-4 w-4\" />\r\n                                                                </Button>\r\n                                                                <Button\r\n                                                                    variant=\"outline\"\r\n                                                                    size=\"icon\"\r\n                                                                    className=\"h-8 w-8 rounded-lg\"\r\n                                                                    onClick={(e) => { e.stopPropagation(); handleSessionExportPDF(session); }}\r\n                                                                    title=\"Export PDF\"\r\n                                                                >\r\n                                                                    <FileDown className=\"h-4 w-4\" />\r\n                                                                </Button>\r\n                                                                <Button\r\n                                                                    variant=\"outline\"\r\n                                                                    size=\"icon\"\r\n                                                                    className=\"h-8 w-8 rounded-lg text-amber-600 hover:bg-amber-50 hover:text-amber-700 border-amber-100\"\r\n                                                                    onClick={(e) => { e.stopPropagation(); handleSessionEdit(session); }}\r\n                                                                    title=\"Edit Audit\"\r\n                                                                >\r\n                                                                    <Edit className=\"h-4 w-4\" />\r\n                                                                </Button>\r\n                                                                <Button\r\n                                                                    variant=\"outline\"\r\n                                                                    size=\"icon\"\r\n                                                                    className=\"h-8 w-8 rounded-lg text-red-500 hover:bg-red-50 hover:text-red-600 border-red-100\"\r\n                                                                    onClick={(e) => {\r\n                                                                        e.stopPropagation();\r\n                                                                        setDeleteDialogSession(session);\r\n                                                                    }}\r\n                                                                    title=\"Delete & Restore Stock\"\r\n                                                                >\r\n                                                                    <Trash2 className=\"h-4 w-4\" />\r\n                                                                </Button>\r\n                                                            </div>\r\n                                                            <Button variant=\"ghost\" size=\"icon\" className={cn(\"rounded-full transition-transform\", selectedAuditId === session.id && \"rotate-90\")}>\r\n                                                                <ChevronRight className=\"h-5 w-5\" />\r\n                                                            </Button>\r\n                                                        </div>\r\n                                                    </div>\r\n\r\n                                                    {selectedAuditId === session.id && (\r\n                                                        <div className=\"border-t bg-slate-50 p-5 pt-0\">\r\n                                                            <div className=\"overflow-x-auto\">\r\n                                                                <Table>\r\n                                                                    <TableHeader>\r\n                                                                        <TableRow className=\"border-b bg-transparent hover:bg-transparent px-0\">\r\n                                                                            <TableHead className=\"h-10 px-0\">Product</TableHead>\r\n                                                                            <TableHead className=\"h-10 text-center\">System</TableHead>\r\n                                                                            <TableHead className=\"h-10 text-center\">Actual</TableHead>\r\n                                                                            <TableHead className=\"h-10 text-right\">Var</TableHead>\r\n                                                                        </TableRow>\r\n                                                                    </TableHeader>\r\n                                                                    <TableBody>\r\n                                                                        {session.items.map((entry) => (\r\n                                                                            <TableRow key={entry.id} className=\"hover:bg-transparent px-0\">\r\n                                                                                <TableCell className=\"px-0 py-3\">\r\n                                                                                    <div className=\"flex items-center gap-2\">\r\n                                                                                        <div className=\"font-medium text-sm\">{entry.product?.name || 'Deleted Product'}</div>\r\n                                                                                        {entry.changeReason?.includes('Stock Count Edit') && (\r\n                                                                                            <span className=\"inline-flex items-center px-1.5 py-0.5 rounded text-[10px] font-bold bg-amber-100 text-amber-700 border border-amber-200\">\r\n                                                                                                EDITED\r\n                                                                                            </span>\r\n                                                                                        )}\r\n                                                                                    </div>\r\n                                                                                    {entry.referenceId && entry.referenceId !== 'unknown' && (\r\n                                                                                        <div className=\"text-[10px] text-muted-foreground font-mono opacity-50\">Session: {entry.referenceId.split('-').pop()}</div>\r\n                                                                                    )}\r\n                                                                                </TableCell>\r\n                                                                                <TableCell className=\"text-center text-sm py-3\">{entry.oldQuantity}</TableCell>\r\n                                                                                <TableCell className=\"text-center text-sm py-3 font-bold\">{entry.newQuantity}</TableCell>\r\n                                                                                <TableCell className=\"text-right py-3\">\r\n                                                                                    <span className={cn(\r\n                                                                                        \"text-xs font-bold px-2 py-0.5 rounded-full\",\r\n                                                                                        entry.newQuantity > entry.oldQuantity ? \"text-emerald-700 bg-emerald-100\" :\r\n                                                                                            entry.newQuantity < entry.oldQuantity ? \"text-rose-700 bg-rose-100\" :\r\n                                                                                                \"text-slate-600 bg-slate-100\"\r\n                                                                                    )}>\r\n                                                                                        {entry.newQuantity - entry.oldQuantity > 0 ? '+' : ''}\r\n                                                                                        {entry.newQuantity - entry.oldQuantity}\r\n                                                                                    </span>\r\n                                                                                </TableCell>\r\n                                                                            </TableRow>\r\n                                                                        ))}\r\n                                                                    </TableBody>\r\n                                                                </Table>\r\n                                                            </div>\r\n                                                        </div>\r\n                                                    )}\r\n                                                </div>\r\n                                            ))}\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        </TabsContent>\r\n                    </Tabs>\r\n                </CardContent>\r\n            </Card>\r\n\r\n            {/* Background Overlay Hint */}\r\n            <div className=\"fixed bottom-6 right-6 pointer-events-none active:opacity-50 transition-opacity\">\r\n                <div className=\"bg-black/80 text-white px-4 py-3 rounded-2xl shadow-2xl flex items-center gap-3 backdrop-blur-md border border-white/20\">\r\n                    <div className=\"w-2 h-2 rounded-full bg-green-500 animate-pulse\" />\r\n                    <span className=\"text-xs font-bold tracking-widest uppercase\">Scanner Active</span>\r\n                </div>\r\n            </div>\r\n\r\n            <AlertDialog open={showCommitDialog} onOpenChange={setShowCommitDialog}>\r\n                <AlertDialogContent className=\"w-[95vw] sm:max-w-md rounded-xl\">\r\n                    <AlertDialogHeader>\r\n                        <AlertDialogTitle>Complete Stock Audit</AlertDialogTitle>\r\n                        <AlertDialogDescription className=\"flex flex-col gap-2\">\r\n                            <span>You have recorded counts for {Object.keys(counts).length} items.</span>\r\n                            {editingSessionId ? (\r\n                                <span className=\"p-2 bg-amber-50 text-amber-800 rounded border border-amber-100 text-xs flex items-center gap-2\">\r\n                                    <Info className=\"h-4 w-4 shrink-0 text-amber-500\" />\r\n                                    This will replace the previous records for this audit session with your new counts. All changes will be logged.\r\n                                </span>\r\n                            ) : (\r\n                                <span>Fill in the details below to complete this session.</span>\r\n                            )}\r\n                        </AlertDialogDescription>\r\n                    </AlertDialogHeader>\r\n\r\n                    <div className=\"space-y-4 py-4\">\r\n                        <div className=\"grid grid-cols-2 gap-4\">\r\n                            <div className=\"space-y-2\">\r\n                                <label className=\"text-xs font-bold text-muted-foreground uppercase\">Name</label>\r\n                                <Input\r\n                                    placeholder=\"Auditor name...\"\r\n                                    value={auditorName}\r\n                                    onChange={(e) => setAuditorName(e.target.value)}\r\n                                    className=\"h-10\"\r\n                                />\r\n                            </div>\r\n                            <div className=\"space-y-2\">\r\n                                <label className=\"text-xs font-bold text-muted-foreground uppercase\">Phone Number</label>\r\n                                <Input\r\n                                    placeholder=\"Contact number...\"\r\n                                    value={contactPerson}\r\n                                    onChange={(e) => setContactPerson(e.target.value)}\r\n                                    className=\"h-10\"\r\n                                    type=\"tel\"\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"pt-2 border-t\">\r\n                            <label className=\"text-xs font-bold text-muted-foreground uppercase block mb-3\">Action</label>\r\n                            <div className=\"grid grid-cols-1 gap-3\">\r\n                                <Button\r\n                                    className=\"w-full justify-start h-auto py-4 px-6 flex flex-col items-start gap-1 whitespace-normal text-left\"\r\n                                    onClick={() => commitStockCount(true)}\r\n                                >\r\n                                    <span className=\"font-bold flex items-center gap-2 w-full text-left\">\r\n                                        <Save className=\"h-4 w-4 shrink-0\" />\r\n                                        Update Inventory Stock\r\n                                    </span>\r\n                                    <span className=\"text-xs font-normal opacity-80 w-full text-left\">\r\n                                        This will change the quantities in your system to match what you counted.\r\n                                    </span>\r\n                                </Button>\r\n                                <Button\r\n                                    variant=\"outline\"\r\n                                    className=\"w-full justify-start h-auto py-4 px-6 flex flex-col items-start gap-1 border-2 whitespace-normal text-left\"\r\n                                    onClick={() => commitStockCount(false)}\r\n                                >\r\n                                    <span className=\"font-bold flex items-center gap-2 w-full text-left\">\r\n                                        <ClipboardList className=\"h-4 w-4 shrink-0\" />\r\n                                        Finish Without Updating\r\n                                    </span>\r\n                                    <span className=\"text-xs font-normal text-muted-foreground w-full text-left\">\r\n                                        Just clear the list and finish. Use this if you already updated manually or just wanted a report.\r\n                                    </span>\r\n                                </Button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <AlertDialogFooter>\r\n                        <AlertDialogCancel className=\"w-full\">Cancel</AlertDialogCancel>\r\n                    </AlertDialogFooter>\r\n                </AlertDialogContent>\r\n            </AlertDialog>\r\n\r\n            {/* Delete Confirmation Dialog */}\r\n            <AlertDialog open={!!deleteDialogSession} onOpenChange={(open) => !open && setDeleteDialogSession(null)}>\r\n                <AlertDialogContent className=\"w-[95vw] sm:max-w-lg\">\r\n                    <AlertDialogHeader>\r\n                        <div className=\"flex items-center gap-3 mb-2\">\r\n                            <div className=\"h-12 w-12 rounded-full bg-red-100 flex items-center justify-center\">\r\n                                <AlertTriangle className=\"h-6 w-6 text-red-600\" />\r\n                            </div>\r\n                            <div>\r\n                                <AlertDialogTitle className=\"text-lg\">Delete Audit Session?</AlertDialogTitle>\r\n                                {deleteDialogSession && (\r\n                                    <p className=\"text-sm text-muted-foreground mt-1\">\r\n                                        {deleteDialogSession.auditId || `Audit #${deleteDialogSession.auditNumber}`} â€¢ {format(deleteDialogSession.date, 'PPP')}\r\n                                    </p>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                        <AlertDialogDescription className=\"space-y-3 pt-2\">\r\n                            <p className=\"text-base\">\r\n                                This action will <strong>permanently delete</strong> this audit session and all its records.\r\n                            </p>\r\n                            <div className=\"p-3 bg-amber-50 border border-amber-200 rounded-lg\">\r\n                                <p className=\"text-sm text-amber-900 font-medium\">\r\n                                    âš ï¸ Stock levels will be recalculated as if this audit never happened.\r\n                                </p>\r\n                            </div>\r\n                            {deleteDialogSession && (\r\n                                <div className=\"text-sm text-muted-foreground\">\r\n                                    <strong>{deleteDialogSession.items.length} product entries</strong> will be removed from history.\r\n                                </div>\r\n                            )}\r\n                            <p className=\"text-sm font-medium text-red-600\">\r\n                                This action cannot be undone.\r\n                            </p>\r\n                        </AlertDialogDescription>\r\n                    </AlertDialogHeader>\r\n                    <AlertDialogFooter className=\"gap-2 sm:gap-2\">\r\n                        <AlertDialogCancel className=\"flex-1\">Cancel</AlertDialogCancel>\r\n                        <Button\r\n                            variant=\"destructive\"\r\n                            className=\"flex-1\"\r\n                            onClick={() => deleteDialogSession && handleSessionDelete(deleteDialogSession)}\r\n                        >\r\n                            <Trash2 className=\"h-4 w-4 mr-2\" />\r\n                            Delete Audit\r\n                        </Button>\r\n                    </AlertDialogFooter>\r\n                </AlertDialogContent>\r\n            </AlertDialog>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default StockCountTab;\r\n"],"names":[],"mappings":"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"}}]
}