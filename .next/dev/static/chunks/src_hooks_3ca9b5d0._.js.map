{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useBusinessSettings.ts"],"sourcesContent":["\r\nimport { useState, useEffect } from 'react';\r\nimport { useQuery } from '@tanstack/react-query';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\nimport { useAuth } from '@/components/auth/AuthProvider';\r\nimport { getBusinessSettingsAction, upsertBusinessSettingsAction } from '@/app/actions/business-settings';\r\n\r\nexport interface BusinessSettings {\r\n  id?: string;\r\n  businessName: string;\r\n  businessAddress: string;\r\n  businessPhone: string;\r\n  businessEmail: string;\r\n  businessLogo?: string;\r\n  currency: string;\r\n  signature?: string;\r\n  paymentInfo?: string;\r\n  defaultPrintFormat?: 'standard' | 'thermal';\r\n  defaultPrinterName?: string;\r\n  defaultPrinterType?: 'USB' | 'Bluetooth';\r\n  printerPaperSize?: '58mm' | '80mm';\r\n}\r\n\r\n// Utility function to parse payment info text into structured format\r\nexport const parsePaymentInfo = (paymentInfo: string): { method: string, accountNumber: string, accountName: string }[] => {\r\n  if (!paymentInfo || paymentInfo.trim() === '') {\r\n    return [];\r\n  }\r\n\r\n  const lines = paymentInfo.split('\\n').filter(line => line.trim() !== '');\r\n  const methods: { method: string, accountNumber: string, accountName: string }[] = [];\r\n\r\n  for (let i = 0; i < lines.length; i += 3) {\r\n    if (i + 2 < lines.length) {\r\n      methods.push({\r\n        method: lines[i].trim(),\r\n        accountNumber: lines[i + 1].trim(),\r\n        accountName: lines[i + 2].trim()\r\n      });\r\n    }\r\n  }\r\n\r\n  return methods;\r\n};\r\n\r\n// Utility function to convert payment methods array back to string format\r\nexport const convertPaymentMethodsToString = (paymentMethods: { method: string, accountNumber: string, accountName: string }[]): string => {\r\n  return paymentMethods\r\n    .filter(pm => pm.method.trim() !== '' || pm.accountNumber.trim() !== '' || pm.accountName.trim() !== '')\r\n    .map(pm => `${pm.method}\\n${pm.accountNumber}\\n${pm.accountName}`)\r\n    .join('\\n');\r\n};\r\n\r\n// Default settings for new businesses\r\nconst getDefaultSettings = (): BusinessSettings => ({\r\n  businessName: '',\r\n  businessAddress: '',\r\n  businessPhone: '',\r\n  businessEmail: '',\r\n  currency: 'UGX',\r\n  paymentInfo: '',\r\n  defaultPrintFormat: 'standard'\r\n});\r\n\r\nexport const useBusinessSettings = () => {\r\n  const [settings, setSettings] = useState<BusinessSettings>(getDefaultSettings());\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const { toast } = useToast();\r\n  const { currentBusiness } = useBusiness();\r\n\r\n  const loadSettings = async (): Promise<BusinessSettings> => {\r\n    if (!currentBusiness) {\r\n      return getDefaultSettings();\r\n    }\r\n\r\n    try {\r\n      const data = await getBusinessSettingsAction(currentBusiness.id);\r\n\r\n      if (data) {\r\n        // Extract payment info from metadata\r\n        const paymentInfo = data.metadata && typeof data.metadata === 'object' ?\r\n          (data.metadata as Record<string, unknown>).payment_info as string || '' : '';\r\n\r\n        return {\r\n          id: data.id,\r\n          businessName: data.business_name || '',\r\n          businessAddress: data.business_address || '',\r\n          businessPhone: data.business_phone || '',\r\n          businessEmail: data.business_email || '',\r\n          businessLogo: data.business_logo || undefined,\r\n          currency: data.currency || 'UGX',\r\n          signature: data.signature || undefined,\r\n          paymentInfo: paymentInfo,\r\n          defaultPrintFormat: data.metadata && typeof data.metadata === 'object' ?\r\n            (data.metadata as Record<string, unknown>).default_print_format as 'standard' | 'thermal' || 'standard' : 'standard',\r\n          defaultPrinterName: data.metadata && typeof data.metadata === 'object' ?\r\n            (data.metadata as Record<string, unknown>).default_printer_name as string || '' : '',\r\n          defaultPrinterType: data.metadata && typeof data.metadata === 'object' ?\r\n            (data.metadata as Record<string, unknown>).default_printer_type as 'USB' | 'Bluetooth' || 'USB' : 'USB',\r\n          printerPaperSize: data.metadata && typeof data.metadata === 'object' ?\r\n            (data.metadata as Record<string, unknown>).printer_paper_size as '58mm' | '80mm' || '58mm' : '58mm'\r\n        };\r\n      } else {\r\n        return getDefaultSettings();\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading business settings:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to load business settings. Please try again.\",\r\n        variant: \"destructive\"\r\n      });\r\n      return getDefaultSettings();\r\n    }\r\n  };\r\n\r\n  const updateSettings = async (newSettings: Partial<BusinessSettings>) => {\r\n    if (!currentBusiness) {\r\n      console.error('No business selected for updating settings');\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"No business selected\",\r\n        variant: \"destructive\"\r\n      });\r\n      return false;\r\n    }\r\n\r\n    try {\r\n      const userData = { user: { id: '00000000-0000-0000-0000-000000000000' } }; // Mocked user id for now\r\n\r\n      // Prepare the metadata object with payment info\r\n      const metadata = {\r\n        payment_info: newSettings.hasOwnProperty('paymentInfo') ? newSettings.paymentInfo : settings.paymentInfo || '',\r\n        default_print_format: newSettings.hasOwnProperty('defaultPrintFormat') ? newSettings.defaultPrintFormat : settings.defaultPrintFormat || 'standard',\r\n        default_printer_name: newSettings.hasOwnProperty('defaultPrinterName') ? newSettings.defaultPrinterName : settings.defaultPrinterName || '',\r\n        default_printer_type: newSettings.hasOwnProperty('defaultPrinterType') ? newSettings.defaultPrinterType : settings.defaultPrinterType || 'USB',\r\n        printer_paper_size: newSettings.hasOwnProperty('printerPaperSize') ? newSettings.printerPaperSize : settings.printerPaperSize || '58mm'\r\n      };\r\n\r\n      const updateData = {\r\n        business_name: newSettings.hasOwnProperty('businessName') ? newSettings.businessName : settings.businessName,\r\n        business_address: newSettings.hasOwnProperty('businessAddress') ? newSettings.businessAddress : settings.businessAddress,\r\n        business_phone: newSettings.hasOwnProperty('businessPhone') ? newSettings.businessPhone : settings.businessPhone,\r\n        business_email: newSettings.hasOwnProperty('businessEmail') ? newSettings.businessEmail : settings.businessEmail,\r\n        business_logo: newSettings.hasOwnProperty('businessLogo') ? newSettings.businessLogo : settings.businessLogo,\r\n        currency: newSettings.hasOwnProperty('currency') ? newSettings.currency : settings.currency,\r\n        signature: newSettings.hasOwnProperty('signature') ? newSettings.signature : settings.signature,\r\n        metadata: metadata\r\n      };\r\n\r\n      const response = await upsertBusinessSettingsAction(currentBusiness.id, userData.user.id, updateData);\r\n\r\n      if (!response.success) {\r\n        console.error('Supabase error updating business settings:', response.error);\r\n        throw new Error(response.error);\r\n      }\r\n\r\n      toast({\r\n        title: \"Success\",\r\n        description: \"Business settings updated successfully\"\r\n      });\r\n\r\n      // Refetch settings after update\r\n      refetch();\r\n\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error updating business settings:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to update business settings. Please try again.\",\r\n        variant: \"destructive\"\r\n      });\r\n      return false;\r\n    }\r\n  };\r\n\r\n  // React Query for settings loading with proper caching\r\n  const { data: queriedData, isLoading: isQueryLoading, isFetching, refetch } = useQuery({\r\n    queryKey: ['businessSettings', currentBusiness?.id],\r\n    queryFn: loadSettings,\r\n    enabled: !!currentBusiness?.id,\r\n    staleTime: 5 * 60_000,\r\n    gcTime: 30 * 60_000,\r\n    refetchOnWindowFocus: false,\r\n    refetchOnReconnect: false,\r\n  });\r\n\r\n  // Sync React Query data with local state\r\n  useEffect(() => {\r\n    if (queriedData) {\r\n      setSettings(queriedData);\r\n    } else if (!currentBusiness) {\r\n      setSettings(getDefaultSettings());\r\n    }\r\n  }, [queriedData, currentBusiness]);\r\n\r\n  // Sync loading state from React Query\r\n  useEffect(() => {\r\n    setIsLoading(isQueryLoading || isFetching);\r\n  }, [isQueryLoading, isFetching]);\r\n\r\n  return {\r\n    settings,\r\n    isLoading,\r\n    updateSettings,\r\n    loadSettings\r\n  };\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 209, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useSaleDraft.ts"],"sourcesContent":["import { useState, useEffect, useCallback, useMemo } from 'react';\r\nimport { SaleFormData } from '@/types';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\n\r\nexport const useSaleDraft = () => {\r\n  const [hasDraft, setHasDraft] = useState(false);\r\n  const { currentBusiness } = useBusiness();\r\n\r\n  const DRAFT_STORAGE_KEY = useMemo(() =>\r\n    currentBusiness?.id ? `sale_draft_${currentBusiness.id}` : 'sale_draft'\r\n    , [currentBusiness?.id]);\r\n\r\n  // Check if draft exists\r\n  const checkForDraft = useCallback(() => {\r\n    const draft = localStorage.getItem(DRAFT_STORAGE_KEY);\r\n    const draftExists = !!draft;\r\n    setHasDraft(draftExists);\r\n    return draftExists;\r\n  }, [DRAFT_STORAGE_KEY]);\r\n\r\n  // Check for draft on mount and when business changes\r\n  useEffect(() => {\r\n    if (currentBusiness?.id) {\r\n      checkForDraft();\r\n    }\r\n  }, [checkForDraft, currentBusiness?.id]);\r\n\r\n  const saveDraft = useCallback((formData: SaleFormData, selectedDate: Date) => {\r\n    if (!currentBusiness?.id) return;\r\n\r\n    const draftData = {\r\n      formData,\r\n      selectedDate: selectedDate.toISOString(),\r\n      savedAt: new Date().toISOString()\r\n    };\r\n\r\n    localStorage.setItem(DRAFT_STORAGE_KEY, JSON.stringify(draftData));\r\n    setHasDraft(true);\r\n  }, [DRAFT_STORAGE_KEY, currentBusiness?.id]);\r\n\r\n  const loadDraft = useCallback(() => {\r\n    const draft = localStorage.getItem(DRAFT_STORAGE_KEY);\r\n    if (draft) {\r\n      try {\r\n        const parsedDraft = JSON.parse(draft);\r\n        return {\r\n          formData: parsedDraft.formData,\r\n          selectedDate: new Date(parsedDraft.selectedDate),\r\n          savedAt: new Date(parsedDraft.savedAt)\r\n        };\r\n      } catch (error) {\r\n        console.error('Error parsing draft:', error);\r\n        localStorage.removeItem(DRAFT_STORAGE_KEY);\r\n        setHasDraft(false);\r\n        return null;\r\n      }\r\n    }\r\n    return null;\r\n  }, [DRAFT_STORAGE_KEY]);\r\n\r\n  const clearDraft = useCallback(() => {\r\n    localStorage.removeItem(DRAFT_STORAGE_KEY);\r\n    setHasDraft(false);\r\n  }, [DRAFT_STORAGE_KEY]);\r\n\r\n  return {\r\n    hasDraft,\r\n    saveDraft,\r\n    loadDraft,\r\n    clearDraft,\r\n    checkForDraft\r\n  };\r\n};\r\n"],"names":[],"mappings":";;;;AAAA;AAEA;;;;AAEO,MAAM,eAAe;;IAC1B,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAC;IACzC,MAAM,EAAE,eAAe,EAAE,GAAG,IAAA,qJAAW;IAEvC,MAAM,oBAAoB,IAAA,wKAAO;mDAAC,IAChC,iBAAiB,KAAK,CAAC,WAAW,EAAE,gBAAgB,EAAE,EAAE,GAAG;kDACzD;QAAC,iBAAiB;KAAG;IAEzB,wBAAwB;IACxB,MAAM,gBAAgB,IAAA,4KAAW;mDAAC;YAChC,MAAM,QAAQ,aAAa,OAAO,CAAC;YACnC,MAAM,cAAc,CAAC,CAAC;YACtB,YAAY;YACZ,OAAO;QACT;kDAAG;QAAC;KAAkB;IAEtB,qDAAqD;IACrD,IAAA,0KAAS;kCAAC;YACR,IAAI,iBAAiB,IAAI;gBACvB;YACF;QACF;iCAAG;QAAC;QAAe,iBAAiB;KAAG;IAEvC,MAAM,YAAY,IAAA,4KAAW;+CAAC,CAAC,UAAwB;YACrD,IAAI,CAAC,iBAAiB,IAAI;YAE1B,MAAM,YAAY;gBAChB;gBACA,cAAc,aAAa,WAAW;gBACtC,SAAS,IAAI,OAAO,WAAW;YACjC;YAEA,aAAa,OAAO,CAAC,mBAAmB,KAAK,SAAS,CAAC;YACvD,YAAY;QACd;8CAAG;QAAC;QAAmB,iBAAiB;KAAG;IAE3C,MAAM,YAAY,IAAA,4KAAW;+CAAC;YAC5B,MAAM,QAAQ,aAAa,OAAO,CAAC;YACnC,IAAI,OAAO;gBACT,IAAI;oBACF,MAAM,cAAc,KAAK,KAAK,CAAC;oBAC/B,OAAO;wBACL,UAAU,YAAY,QAAQ;wBAC9B,cAAc,IAAI,KAAK,YAAY,YAAY;wBAC/C,SAAS,IAAI,KAAK,YAAY,OAAO;oBACvC;gBACF,EAAE,OAAO,OAAO;oBACd,QAAQ,KAAK,CAAC,wBAAwB;oBACtC,aAAa,UAAU,CAAC;oBACxB,YAAY;oBACZ,OAAO;gBACT;YACF;YACA,OAAO;QACT;8CAAG;QAAC;KAAkB;IAEtB,MAAM,aAAa,IAAA,4KAAW;gDAAC;YAC7B,aAAa,UAAU,CAAC;YACxB,YAAY;QACd;+CAAG;QAAC;KAAkB;IAEtB,OAAO;QACL;QACA;QACA;QACA;QACA;IACF;AACF;GApEa;;QAEiB,qJAAW"}},
    {"offset": {"line": 315, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useNewSaleDraft.ts"],"sourcesContent":["import { useEffect, useState } from 'react';\r\nimport { useSaleDraft } from '@/hooks/useSaleDraft';\r\nimport { Sale } from '@/types';\r\n\r\nexport const useNewSaleDraft = (editSale?: Sale) => {\r\n  const [showDraftNotification, setShowDraftNotification] = useState(false);\r\n  const [draftData, setDraftData] = useState<any>(null);\r\n\r\n  const { hasDraft, loadDraft, clearDraft, checkForDraft } = useSaleDraft();\r\n\r\n  // Automatically load draft on component mount\r\n  useEffect(() => {\r\n    if (!editSale) {\r\n      const loadDraftAutomatically = () => {\r\n        if (checkForDraft()) {\r\n          const draft = loadDraft();\r\n          if (draft) {\r\n            setDraftData(draft);\r\n          }\r\n        }\r\n      };\r\n\r\n      // Load immediately\r\n      loadDraftAutomatically();\r\n    }\r\n  }, [editSale, checkForDraft, loadDraft]);\r\n\r\n  const handleLoadDraft = () => {\r\n    // Clear the draft data after it's been loaded into the form\r\n    setDraftData(null);\r\n  };\r\n\r\n  const handleDismissDraft = () => {\r\n    clearDraft();\r\n    setShowDraftNotification(false);\r\n    setDraftData(null);\r\n  };\r\n\r\n  return {\r\n    showDraftNotification: false, // Always false for seamless auto-loading\r\n    draftData,\r\n    handleLoadDraft,\r\n    handleDismissDraft,\r\n    clearDraft\r\n  };\r\n};"],"names":[],"mappings":";;;;AAAA;AACA;;;;AAGO,MAAM,kBAAkB,CAAC;;IAC9B,MAAM,CAAC,uBAAuB,yBAAyB,GAAG,IAAA,yKAAQ,EAAC;IACnE,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAM;IAEhD,MAAM,EAAE,QAAQ,EAAE,SAAS,EAAE,UAAU,EAAE,aAAa,EAAE,GAAG,IAAA,+IAAY;IAEvE,8CAA8C;IAC9C,IAAA,0KAAS;qCAAC;YACR,IAAI,CAAC,UAAU;gBACb,MAAM;wEAAyB;wBAC7B,IAAI,iBAAiB;4BACnB,MAAM,QAAQ;4BACd,IAAI,OAAO;gCACT,aAAa;4BACf;wBACF;oBACF;;gBAEA,mBAAmB;gBACnB;YACF;QACF;oCAAG;QAAC;QAAU;QAAe;KAAU;IAEvC,MAAM,kBAAkB;QACtB,4DAA4D;QAC5D,aAAa;IACf;IAEA,MAAM,qBAAqB;QACzB;QACA,yBAAyB;QACzB,aAAa;IACf;IAEA,OAAO;QACL,uBAAuB;QACvB;QACA;QACA;QACA;IACF;AACF;GAzCa;;QAIgD,+IAAY"}},
    {"offset": {"line": 381, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useCurrentUser.ts"],"sourcesContent":["import { useAuth } from '@/components/auth/AuthProvider';\r\n\r\nexport const useCurrentUser = () => {\r\n  const { user } = useAuth();\r\n  return { userId: user?.id };\r\n};"],"names":[],"mappings":";;;;AAAA;;;AAEO,MAAM,iBAAiB;;IAC5B,MAAM,EAAE,IAAI,EAAE,GAAG,IAAA,wJAAO;IACxB,OAAO;QAAE,QAAQ,MAAM;IAAG;AAC5B;GAHa;;QACM,wJAAO"}},
    {"offset": {"line": 407, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useActivityLogger.ts"],"sourcesContent":["import { logActivityAction, ActivityLogInput } from '@/app/actions/activity';\r\nimport { useCurrentUser } from './useCurrentUser';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\nimport { useProfiles } from '@/contexts/ProfileContext';\r\n\r\nexport type ActivityType = 'CREATE' | 'UPDATE' | 'DELETE';\r\nexport type ModuleType = 'SALES' | 'INVENTORY' | 'EXPENSES' | 'FINANCE' | 'CUSTOMERS' | 'TASKS';\r\n\r\nexport interface ActivityLogData {\r\n  activityType: ActivityType;\r\n  module: ModuleType;\r\n  entityType: string;\r\n  entityId?: string;\r\n  entityName: string;\r\n  description: string;\r\n  metadata?: any;\r\n}\r\n\r\nexport const useActivityLogger = () => {\r\n  const { userId } = useCurrentUser();\r\n  const { currentBusiness } = useBusiness();\r\n\r\n  // Safely get current profile, handle case where ProfileProvider isn't available\r\n  let currentProfile = null;\r\n  try {\r\n    const { currentProfile: profile } = useProfiles();\r\n    currentProfile = profile;\r\n  } catch {\r\n    // ProfileProvider not available, continue without profile\r\n    currentProfile = null;\r\n  }\r\n\r\n  const logActivity = async (data: ActivityLogData) => {\r\n    if (!userId || !currentBusiness?.id) {\r\n      console.warn('Cannot log activity: missing user or business context');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const result = await logActivityAction({\r\n        userId: userId,\r\n        locationId: currentBusiness.id,\r\n        activityType: data.activityType as any,\r\n        module: data.module as any,\r\n        entityType: data.entityType,\r\n        entityId: data.entityId || undefined,\r\n        entityName: data.entityName,\r\n        description: data.description,\r\n        metadata: data.metadata || undefined,\r\n        profileId: currentProfile?.id || undefined,\r\n        profileName: currentProfile?.profile_name || undefined\r\n      });\r\n\r\n      if (!result.success) {\r\n        console.error('Error logging activity:', result.error);\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to log activity:', error);\r\n    }\r\n  };\r\n\r\n  return { logActivity };\r\n};"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;;AAeO,MAAM,oBAAoB;;IAC/B,MAAM,EAAE,MAAM,EAAE,GAAG,IAAA,mJAAc;IACjC,MAAM,EAAE,eAAe,EAAE,GAAG,IAAA,qJAAW;IAEvC,gFAAgF;IAChF,IAAI,iBAAiB;IACrB,IAAI;QACF,MAAM,EAAE,gBAAgB,OAAO,EAAE,GAAG,IAAA,oJAAW;QAC/C,iBAAiB;IACnB,EAAE,OAAM;QACN,0DAA0D;QAC1D,iBAAiB;IACnB;IAEA,MAAM,cAAc,OAAO;QACzB,IAAI,CAAC,UAAU,CAAC,iBAAiB,IAAI;YACnC,QAAQ,IAAI,CAAC;YACb;QACF;QAEA,IAAI;YACF,MAAM,SAAS,MAAM,IAAA,qLAAiB,EAAC;gBACrC,QAAQ;gBACR,YAAY,gBAAgB,EAAE;gBAC9B,cAAc,KAAK,YAAY;gBAC/B,QAAQ,KAAK,MAAM;gBACnB,YAAY,KAAK,UAAU;gBAC3B,UAAU,KAAK,QAAQ,IAAI;gBAC3B,YAAY,KAAK,UAAU;gBAC3B,aAAa,KAAK,WAAW;gBAC7B,UAAU,KAAK,QAAQ,IAAI;gBAC3B,WAAW,gBAAgB,MAAM;gBACjC,aAAa,gBAAgB,gBAAgB;YAC/C;YAEA,IAAI,CAAC,OAAO,OAAO,EAAE;gBACnB,QAAQ,KAAK,CAAC,2BAA2B,OAAO,KAAK;YACvD;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,2BAA2B;QAC3C;IACF;IAEA,OAAO;QAAE;IAAY;AACvB;GA5Ca;;QACQ,mJAAc;QACL,qJAAW"}},
    {"offset": {"line": 476, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useCustomers.ts"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\nimport { useActivityLogger } from '@/hooks/useActivityLogger';\r\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\r\nimport { getCustomersAction, createCustomerAction, updateCustomerAction, deleteCustomerAction } from '@/app/actions/customers';\r\nimport { useAuth } from '@/components/auth/AuthProvider';\r\n\r\nexport interface Customer {\r\n  id: string;\r\n  fullName: string;\r\n  phoneNumber: string | null;\r\n  email: string | null;\r\n  birthday: Date | null;\r\n  gender: string | null;\r\n  location: string | null;\r\n  categoryId: string | null; // Added category field\r\n  notes: string | null;\r\n  tags: string[] | null;\r\n  socialMedia: {\r\n    instagram?: string;\r\n    facebook?: string;\r\n    twitter?: string;\r\n    linkedin?: string;\r\n  } | null;\r\n  createdAt: Date;\r\n  updatedAt: Date;\r\n}\r\n\r\nexport const useCustomers = (initialPageSize: number = 50) => {\r\n  const [customers, setCustomers] = useState<Customer[]>([]);\r\n  const [page, setPage] = useState(1);\r\n  const [pageSize, setPageSize] = useState(initialPageSize);\r\n  const [totalCount, setTotalCount] = useState(0);\r\n  const { toast } = useToast();\r\n  const { currentBusiness } = useBusiness();\r\n  const { user } = useAuth();\r\n  const { logActivity } = useActivityLogger();\r\n  const queryClient = useQueryClient();\r\n\r\n  const loadCustomers = useCallback(async (): Promise<{ customers: Customer[], count: number }> => {\r\n    if (!currentBusiness) {\r\n      return { customers: [], count: 0 };\r\n    }\r\n\r\n    try {\r\n      const result = await getCustomersAction(currentBusiness.id);\r\n\r\n      if (!result.success) {\r\n        throw new Error(result.error);\r\n      }\r\n\r\n      const formattedCustomers: Customer[] = (result.data?.customers || []).map((customer: any) => ({\r\n        id: customer.id,\r\n        fullName: customer.fullName || customer.name,\r\n        phoneNumber: customer.phoneNumber || customer.phone,\r\n        email: customer.email,\r\n        birthday: customer.birthday ? new Date(customer.birthday) : null,\r\n        gender: customer.gender,\r\n        location: customer.location || customer.address,\r\n        categoryId: customer.categoryId,\r\n        notes: customer.notes,\r\n        tags: customer.tags,\r\n        socialMedia: customer.socialMedia || null,\r\n        createdAt: new Date(customer.createdAt),\r\n        updatedAt: new Date(customer.updatedAt)\r\n      }));\r\n\r\n      return { customers: formattedCustomers, count: result.data?.count || 0 };\r\n    } catch (error) {\r\n      console.error('Error loading customers:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to load customers. Please try again.\",\r\n        variant: \"destructive\"\r\n      });\r\n      return { customers: [], count: 0 };\r\n    }\r\n  }, [currentBusiness?.id, toast]);\r\n\r\n  // React Query caching\r\n  const queryKey = ['customers', currentBusiness?.id];\r\n  const { data: queriedData, isLoading: isQueryLoading, isFetching } = useQuery({\r\n    queryKey,\r\n    queryFn: loadCustomers,\r\n    enabled: !!currentBusiness?.id,\r\n    staleTime: 5 * 60_000,\r\n    gcTime: 30 * 60_000,\r\n    refetchOnWindowFocus: false,\r\n    refetchOnReconnect: false,\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (queriedData) {\r\n      setCustomers(queriedData.customers);\r\n      setTotalCount(queriedData.count);\r\n    }\r\n  }, [queriedData]);\r\n\r\n  // Derived loading state to avoid flash on background refetch\r\n  const isLoading = isQueryLoading && !queriedData;\r\n\r\n  const createCustomer = async (customerData: Omit<Customer, 'id' | 'createdAt' | 'updatedAt'>) => {\r\n    if (!currentBusiness) {\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"No business selected\",\r\n        variant: \"destructive\"\r\n      });\r\n      return null;\r\n    }\r\n\r\n    try {\r\n      if (!user) throw new Error('User not authenticated');\r\n\r\n      const insertData = {\r\n        fullName: customerData.fullName,\r\n        phoneNumber: customerData.phoneNumber || null,\r\n        email: customerData.email || null,\r\n        birthday: customerData.birthday?.toISOString().split('T')[0] || null,\r\n        gender: customerData.gender || null,\r\n        location: customerData.location || null,\r\n        categoryId: customerData.categoryId || null,\r\n        notes: customerData.notes || null,\r\n        tags: customerData.tags || null,\r\n        socialMedia: customerData.socialMedia || null\r\n      };\r\n\r\n      const result = await createCustomerAction(currentBusiness.id, user.id, insertData);\r\n\r\n      if (!result.success || !result.data) {\r\n        throw new Error(result.error || 'Failed to create customer');\r\n      }\r\n\r\n      const data = result.data;\r\n\r\n      // Format the new customer and update cache immediately\r\n      const newCustomer: Customer = {\r\n        id: data.id,\r\n        fullName: data.name || data.fullName,\r\n        phoneNumber: data.phone || data.phoneNumber,\r\n        email: data.email,\r\n        birthday: data.birthday ? new Date(data.birthday) : null,\r\n        gender: data.gender,\r\n        location: data.address || data.location,\r\n        categoryId: data.categoryId,\r\n        notes: data.notes,\r\n        tags: data.tags,\r\n        socialMedia: data.socialMedia,\r\n        createdAt: new Date(data.createdAt),\r\n        updatedAt: new Date(data.updatedAt)\r\n      };\r\n\r\n      // Update local state immediately\r\n      setCustomers(prev => [newCustomer, ...prev]);\r\n      setTotalCount(c => c + 1);\r\n\r\n      // Update React Query cache immediately\r\n      queryClient.setQueryData(queryKey, (oldData: any) => {\r\n        if (!oldData) return { customers: [newCustomer], count: 1 };\r\n        return {\r\n          customers: [newCustomer, ...oldData.customers],\r\n          count: (oldData.count || 0) + 1\r\n        };\r\n      });\r\n\r\n      // Log activity\r\n      await logActivity({\r\n        activityType: 'CREATE',\r\n        module: 'CUSTOMERS',\r\n        entityType: 'customer',\r\n        entityId: data.id,\r\n        entityName: customerData.fullName,\r\n        description: `Created customer \"${customerData.fullName}\"`,\r\n        metadata: {\r\n          phoneNumber: customerData.phoneNumber,\r\n          email: customerData.email,\r\n          location: customerData.location\r\n        }\r\n      });\r\n\r\n      toast({\r\n        title: \"Success\",\r\n        description: \"Customer created successfully\"\r\n      });\r\n\r\n      return data;\r\n    } catch (error) {\r\n      console.error('Error creating customer:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to create customer. Please try again.\",\r\n        variant: \"destructive\"\r\n      });\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const addCustomer = createCustomer;\r\n\r\n  const updateCustomer = async (id: string, updates: Partial<Customer>) => {\r\n    try {\r\n      const updateData: any = {};\r\n\r\n      if (updates.fullName !== undefined) updateData.fullName = updates.fullName;\r\n      if (updates.phoneNumber !== undefined) updateData.phoneNumber = updates.phoneNumber;\r\n      if (updates.email !== undefined) updateData.email = updates.email;\r\n      if (updates.birthday !== undefined) updateData.birthday = updates.birthday?.toISOString();\r\n      if (updates.gender !== undefined) updateData.gender = updates.gender;\r\n      if (updates.location !== undefined) updateData.location = updates.location;\r\n      if (updates.categoryId !== undefined) updateData.categoryId = updates.categoryId;\r\n      if (updates.notes !== undefined) updateData.notes = updates.notes;\r\n      if (updates.tags !== undefined) updateData.tags = updates.tags;\r\n      if (updates.socialMedia !== undefined) updateData.socialMedia = updates.socialMedia;\r\n\r\n      const result = await updateCustomerAction(id, updateData);\r\n\r\n      if (!result.success) throw new Error(result.error || 'Failed to update customer');\r\n\r\n      // Update local state immediately\r\n      setCustomers(prev => prev.map(c => c.id === id ? { ...c, ...updates } : c));\r\n\r\n      // Update React Query cache immediately\r\n      queryClient.setQueryData(queryKey, (oldData: any) => {\r\n        if (!oldData) return oldData;\r\n        return {\r\n          ...oldData,\r\n          customers: oldData.customers.map((c: Customer) =>\r\n            c.id === id ? { ...c, ...updates } : c\r\n          )\r\n        };\r\n      });\r\n\r\n      // Log activity\r\n      const customer = customers.find(c => c.id === id);\r\n      if (customer) {\r\n        await logActivity({\r\n          activityType: 'UPDATE',\r\n          module: 'CUSTOMERS',\r\n          entityType: 'customer',\r\n          entityId: id,\r\n          entityName: customer.fullName,\r\n          description: `Updated customer \"${customer.fullName}\"`,\r\n          metadata: { updates }\r\n        });\r\n      }\r\n\r\n      toast({\r\n        title: \"Success\",\r\n        description: \"Customer updated successfully\"\r\n      });\r\n\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error updating customer:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to update customer. Please try again.\",\r\n        variant: \"destructive\"\r\n      });\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const deleteCustomer = async (id: string) => {\r\n    try {\r\n      // Get customer details before deletion\r\n      const customer = customers.find(c => c.id === id);\r\n\r\n      const result = await deleteCustomerAction(id);\r\n\r\n      if (!result.success) throw new Error(result.error || 'Failed to delete customer');\r\n      // Optimistic update: remove locally\r\n      setCustomers(prev => prev.filter(c => c.id !== id));\r\n      setTotalCount(c => Math.max(0, c - 1));\r\n      // Update cache immediately for current page\r\n      queryClient.setQueryData(queryKey, (old: any) => {\r\n        if (!old) return old;\r\n        const { customers: oldCustomers, count } = old;\r\n        const newCustomers = (oldCustomers as Customer[]).filter(c => c.id !== id);\r\n        return { customers: newCustomers, count: Math.max(0, (count || 0) - 1) };\r\n      });\r\n      queryClient.invalidateQueries({ queryKey });\r\n\r\n      // Log activity\r\n      if (customer) {\r\n        await logActivity({\r\n          activityType: 'DELETE',\r\n          module: 'CUSTOMERS',\r\n          entityType: 'customer',\r\n          entityId: id,\r\n          entityName: customer.fullName,\r\n          description: `Deleted customer \"${customer.fullName}\"`,\r\n          metadata: {\r\n            phoneNumber: customer.phoneNumber,\r\n            email: customer.email\r\n          }\r\n        });\r\n      }\r\n\r\n      toast({\r\n        title: \"Success\",\r\n        description: \"Customer deleted successfully\"\r\n      });\r\n\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error deleting customer:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to delete customer. Please try again.\",\r\n        variant: \"destructive\"\r\n      });\r\n      return false;\r\n    }\r\n  };\r\n\r\n  // Initial load handled by React Query; no manual trigger needed\r\n\r\n  // Realtime: invalidate customer list when changes occur for this location\r\n  // Commented out since we are moving away from Supabase client realtime subscriptions\r\n  // useEffect(() => {\r\n  //   if (!currentBusiness?.id) return;\r\n\r\n  //   const channel = supabase\r\n  //     .channel('customers_changes')\r\n  //     .on('postgres_changes', {\r\n  //       event: '*',\r\n  //       schema: 'public',\r\n  //       table: 'customers',\r\n  //       filter: `location_id=eq.${currentBusiness.id}`\r\n  //     }, () => {\r\n  //       queryClient.invalidateQueries({ queryKey });\r\n  //     })\r\n  //     .subscribe();\r\n\r\n  //   return () => {\r\n  //     supabase.removeChannel(channel);\r\n  //   };\r\n  // }, [currentBusiness?.id, page, pageSize]);\r\n\r\n  return {\r\n    customers,\r\n    isLoading,\r\n    createCustomer,\r\n    addCustomer,\r\n    updateCustomer,\r\n    deleteCustomer,\r\n    loadCustomers,\r\n    page,\r\n    setPage,\r\n    pageSize,\r\n    setPageSize,\r\n    totalCount\r\n  };\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 848, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useProducts.ts"],"sourcesContent":["import { useState, useEffect, useCallback, useMemo } from 'react';\r\nimport { Product, ProductFormData, ProductFilters } from '@/types';\r\nimport { useBusinessSettings } from './useBusinessSettings';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\r\nimport { clearInventoryCaches } from '@/utils/inventoryCacheUtils';\r\n\r\n// Import our new Server Actions\r\nimport {\r\n  getProductsAction,\r\n  createProductAction,\r\n  updateProductAction,\r\n  deleteProductAction,\r\n  updateProductsBulkAction\r\n} from '@/app/actions/products';\r\n\r\nexport const useProducts = (userId: string | undefined, initialPageSize: number = 50) => {\r\n  const [products, setProducts] = useState<Product[]>([]);\r\n  const [page, setPage] = useState(1);\r\n  const [pageSize, setPageSize] = useState(initialPageSize);\r\n  const [totalCount, setTotalCount] = useState(0);\r\n  const [isTyping, setIsTyping] = useState(false);\r\n  const { settings } = useBusinessSettings();\r\n  const { currentBusiness } = useBusiness();\r\n  const queryClient = useQueryClient();\r\n\r\n  const [filters, setFilters] = useState<ProductFilters>({\r\n    search: '',\r\n    category: 'all',\r\n    stockStatus: 'all'\r\n  });\r\n\r\n  const [typingTimer, setTypingTimer] = useState<NodeJS.Timeout | null>(null);\r\n\r\n  const setFiltersWithTypingState = useCallback((newFilters: ProductFilters) => {\r\n    if (newFilters.search !== filters.search) {\r\n      setIsTyping(true);\r\n      if (typingTimer) clearTimeout(typingTimer);\r\n      const timer = setTimeout(() => {\r\n        setIsTyping(false);\r\n      }, 600);\r\n      setTypingTimer(timer);\r\n    }\r\n    setFilters(newFilters);\r\n  }, [filters.search, typingTimer]);\r\n\r\n  // Use Server Action instead of Supabase\r\n  const loadProducts = useCallback(async (): Promise<{ products: Product[], count: number }> => {\r\n    if (!userId || !currentBusiness) {\r\n      return { products: [], count: 0 };\r\n    }\r\n\r\n    try {\r\n      // Server Action call\r\n      const result = await getProductsAction({\r\n        userId,\r\n        businessId: currentBusiness.id,\r\n        page,\r\n        pageSize,\r\n        search: filters.search,\r\n        category: filters.category === 'all' ? undefined : filters.category,\r\n        stockStatus: filters.stockStatus,\r\n      });\r\n      return result as { products: Product[], count: number };\r\n    } catch (error) {\r\n      console.error('Error loading products from server action:', error);\r\n      return { products: [], count: 0 };\r\n    }\r\n  }, [userId, currentBusiness?.id, page, pageSize, filters.search, filters.category, filters.stockStatus]);\r\n\r\n  const baseQueryKey = useMemo(() => ['products', userId, currentBusiness?.id], [userId, currentBusiness?.id]);\r\n  const queryKey = useMemo(() => [...baseQueryKey, page, pageSize, filters.search, filters.category, filters.stockStatus], [baseQueryKey, page, pageSize, filters.search, filters.category, filters.stockStatus]);\r\n\r\n  const { data: queriedData, isLoading: isQueryLoading, isFetching, refetch } = useQuery({\r\n    queryKey,\r\n    queryFn: loadProducts,\r\n    enabled: !!userId && !!currentBusiness?.id,\r\n    staleTime: 30_000,\r\n    gcTime: 30 * 60_000,\r\n    refetchOnWindowFocus: true,\r\n    refetchOnReconnect: true,\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (queriedData) {\r\n      setProducts(queriedData.products);\r\n      setTotalCount(queriedData.count);\r\n    }\r\n  }, [queriedData]);\r\n\r\n  const isLoading = (isQueryLoading && !queriedData) && !isTyping;\r\n\r\n  // Supabase Storage remains untouched since Prisma doesn't do file storage\r\n  // but we isolate it here.\r\n  const uploadProductImage = async (imageFile: File): Promise<string | null> => {\r\n    try {\r\n      if (!userId) return null;\r\n\r\n      // We will implement a server action for this. \r\n      // For now, let's assume we have an uploadImageAction.\r\n      // const formData = new FormData();\r\n      // formData.append('file', imageFile);\r\n      // formData.append('userId', userId);\r\n      // const result = await uploadImageAction(formData);\r\n      // return result.url;\r\n\r\n      console.warn('Image upload redirecting to server action (TODO)');\r\n      return null;\r\n    } catch (error) {\r\n      console.error('Error in uploadProductImage:', error);\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const createProduct = async (productData: ProductFormData): Promise<Product | null> => {\r\n    try {\r\n      if (!userId || !currentBusiness) return null;\r\n\r\n      const result = await createProductAction({\r\n        ...productData,\r\n        userId,\r\n        businessId: currentBusiness.id\r\n      });\r\n\r\n      if (!result) return null;\r\n\r\n      const newProduct = result as Product;\r\n\r\n      setProducts(prev => [newProduct, ...prev]);\r\n      setTotalCount(c => c + 1);\r\n\r\n      queryClient.invalidateQueries({ queryKey: baseQueryKey });\r\n      clearInventoryCaches(queryClient);\r\n\r\n      return newProduct;\r\n    } catch (error) {\r\n      console.error('Error creating product:', error);\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const updateProduct = async (\r\n    id: string,\r\n    updates: Partial<Product>,\r\n    imageFile?: File | null,\r\n    isFromSale = false,\r\n    customChangeReason?: string,\r\n    adjustmentDate?: Date,\r\n    referenceId?: string,\r\n    receiptNumber?: string\r\n  ): Promise<boolean> => {\r\n    try {\r\n      if (!userId || !currentBusiness) return false;\r\n\r\n      let imageUrl = updates.imageUrl;\r\n      if (imageFile) {\r\n        imageUrl = await uploadProductImage(imageFile);\r\n      }\r\n\r\n      const result = await updateProductAction(id, {\r\n        ...updates,\r\n        imageUrl,\r\n        userId,\r\n        businessId: currentBusiness.id,\r\n        isFromSale,\r\n        customChangeReason,\r\n        referenceId\r\n      });\r\n\r\n      if (!result) return false;\r\n\r\n      queryClient.invalidateQueries({ queryKey: baseQueryKey });\r\n      clearInventoryCaches(queryClient);\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error updating product:', error);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const deleteProduct = async (id: string): Promise<boolean> => {\r\n    try {\r\n      if (!userId) return false;\r\n\r\n      const success = await deleteProductAction(id);\r\n\r\n      if (success) {\r\n        queryClient.invalidateQueries({ queryKey: baseQueryKey });\r\n        clearInventoryCaches(queryClient);\r\n        return true;\r\n      }\r\n      return false;\r\n    } catch (error) {\r\n      console.error('Error deleting product:', error);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const updateProductsBulk = async (\r\n    updates: Array<{ id: string; updated: Partial<Product>; imageFile?: File | null }>,\r\n    userIdForHistory?: string,\r\n    changeReason?: string,\r\n    referenceId?: string,\r\n    adjustmentDate?: Date,\r\n    receiptNumber?: string\r\n  ): Promise<boolean> => {\r\n    try {\r\n      if (!userId || !currentBusiness) return false;\r\n\r\n      const success = await updateProductsBulkAction(\r\n        updates.map(u => ({ id: u.id, updated: u.updated })),\r\n        currentBusiness.id\r\n      );\r\n\r\n      if (success) {\r\n        queryClient.invalidateQueries({ queryKey: baseQueryKey });\r\n        clearInventoryCaches(queryClient);\r\n      }\r\n\r\n      return success;\r\n    } catch (error) {\r\n      console.error('Error in bulk update:', error);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  return {\r\n    products,\r\n    isLoading,\r\n    loadProducts,\r\n    page,\r\n    setPage,\r\n    pageSize,\r\n    setPageSize,\r\n    totalCount,\r\n    createProduct,\r\n    updateProduct,\r\n    updateProductsBulk,\r\n    deleteProduct,\r\n    uploadProductImage,\r\n    refetch,\r\n    isFetching,\r\n    filters,\r\n    setFilters: setFiltersWithTypingState,\r\n  };\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1132, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useInventoryActions.ts"],"sourcesContent":["import { useProducts } from './useProducts';\r\nimport { SaleItem, Product } from '@/types';\r\nimport { toast } from 'sonner';\r\nimport { getProductsByIdsAction } from '@/app/actions/products';\r\n\r\nexport const useInventoryActions = (userId: string | undefined) => {\r\n    const { updateProductsBulk } = useProducts(userId);\r\n\r\n    /**\r\n     * Helper to fetch fresh product data from DB to avoid race conditions/stale data\r\n     */\r\n    const fetchFreshProducts = async (productIds: string[], locationId?: string) => {\r\n        if (!productIds.length) return [];\r\n\r\n        try {\r\n            const result = await getProductsByIdsAction(productIds, locationId);\r\n            return result as Product[];\r\n        } catch (error) {\r\n            console.error('Error fetching fresh products:', error);\r\n            throw error;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Deduct stock for a new sale\r\n     */\r\n    const deductStockForSale = async (\r\n        items: SaleItem[],\r\n        saleId?: string,\r\n        saleDate?: Date,\r\n        receiptNumber?: string,\r\n        locationId?: string\r\n    ): Promise<boolean> => {\r\n        if (!userId) return false;\r\n\r\n        try {\r\n            const itemsWithProductIds = items.filter(item => item.productId);\r\n            if (itemsWithProductIds.length === 0) return true;\r\n\r\n            const uniqueIds = [...new Set(itemsWithProductIds.map(item => item.productId!))];\r\n            const freshProducts = await fetchFreshProducts(uniqueIds, locationId);\r\n\r\n            if (freshProducts.length === 0) return false;\r\n\r\n            // Calculate total quantity to deduct per product\r\n            const quantityChanges = new Map<string, number>();\r\n            for (const item of itemsWithProductIds) {\r\n                const existing = quantityChanges.get(item.productId!) || 0;\r\n                quantityChanges.set(item.productId!, existing + item.quantity);\r\n            }\r\n\r\n            const bulkUpdates = [];\r\n            for (const [productId, quantityToDeduct] of quantityChanges.entries()) {\r\n                const product = freshProducts.find(p => p.id === productId);\r\n                if (!product) continue;\r\n\r\n                const newQuantity = product.quantity - quantityToDeduct;\r\n\r\n                bulkUpdates.push({\r\n                    id: productId,\r\n                    updated: { ...product, quantity: newQuantity }\r\n                });\r\n\r\n                if (newQuantity < 0) {\r\n                    toast.warning(`${product.name} inventory is now negative (${newQuantity}). Please restock soon.`);\r\n                }\r\n            }\r\n\r\n            if (bulkUpdates.length > 0) {\r\n                await updateProductsBulk(bulkUpdates, userId, 'Sale', saleId, saleDate, receiptNumber);\r\n            }\r\n\r\n            return true;\r\n        } catch (error) {\r\n            console.error('Error deducting stock for sale:', error);\r\n            return false;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Restore stock (e.g. when deleting a sale)\r\n     */\r\n    const restoreStockForSale = async (\r\n        items: SaleItem[],\r\n        saleId?: string, // Reference ID for history\r\n        receiptNumber?: string, // Reference receipt number\r\n        locationId?: string\r\n    ): Promise<boolean> => {\r\n        if (!userId) return false;\r\n\r\n        try {\r\n            const itemsWithProductIds = items.filter(item => item.productId);\r\n            if (itemsWithProductIds.length === 0) return true;\r\n\r\n            const uniqueIds = [...new Set(itemsWithProductIds.map(item => item.productId!))];\r\n            const freshProducts = await fetchFreshProducts(uniqueIds, locationId);\r\n\r\n            // Calculate total quantity to restore\r\n            const quantityChanges = new Map<string, number>();\r\n            for (const item of itemsWithProductIds) {\r\n                const existing = quantityChanges.get(item.productId!) || 0;\r\n                quantityChanges.set(item.productId!, existing + item.quantity);\r\n            }\r\n\r\n            const bulkUpdates = [];\r\n            for (const [productId, quantityToRestore] of quantityChanges.entries()) {\r\n                const product = freshProducts.find(p => p.id === productId);\r\n                if (!product) continue;\r\n\r\n                const newQuantity = product.quantity + quantityToRestore;\r\n\r\n                bulkUpdates.push({\r\n                    id: productId,\r\n                    updated: { ...product, quantity: newQuantity }\r\n                });\r\n            }\r\n\r\n            if (bulkUpdates.length > 0) {\r\n                await updateProductsBulk(bulkUpdates, userId, 'Deleted Sale', saleId, undefined, receiptNumber);\r\n            }\r\n\r\n            return true;\r\n        } catch (error) {\r\n            console.error('Error restoring stock for sale:', error);\r\n            return false;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Adjust stock for an edited sale (Handle both adding and removing items)\r\n     */\r\n    const adjustStockForEditedSale = async (\r\n        originalItems: SaleItem[],\r\n        newItems: SaleItem[],\r\n        saleId?: string,\r\n        saleDate?: Date,\r\n        receiptNumber?: string,\r\n        locationId?: string\r\n    ): Promise<boolean> => {\r\n        if (!userId) return false;\r\n\r\n        try {\r\n            const allProductIds = [\r\n                ...originalItems.filter(i => i.productId).map(i => i.productId!),\r\n                ...newItems.filter(i => i.productId).map(i => i.productId!)\r\n            ];\r\n            const uniqueIds = [...new Set(allProductIds)];\r\n            if (uniqueIds.length === 0) return true;\r\n\r\n            const freshProducts = await fetchFreshProducts(uniqueIds, locationId);\r\n\r\n            const productNetChanges = new Map<string, number>();\r\n\r\n            // 1. Restore original items (add back to stock)\r\n            for (const item of originalItems.filter(i => i.productId)) {\r\n                const current = productNetChanges.get(item.productId!) || 0;\r\n                productNetChanges.set(item.productId!, current + item.quantity);\r\n            }\r\n\r\n            // 2. Deduct new items (remove from stock)\r\n            for (const item of newItems.filter(i => i.productId)) {\r\n                const current = productNetChanges.get(item.productId!) || 0;\r\n                productNetChanges.set(item.productId!, current - item.quantity);\r\n            }\r\n\r\n            const bulkUpdates = [];\r\n            for (const [productId, netChange] of productNetChanges.entries()) {\r\n                if (netChange === 0) continue;\r\n\r\n                const product = freshProducts.find(p => p.id === productId);\r\n                if (!product) continue;\r\n\r\n                const newQuantity = product.quantity + netChange;\r\n\r\n                bulkUpdates.push({\r\n                    id: productId,\r\n                    updated: { ...product, quantity: newQuantity }\r\n                });\r\n\r\n                if (newQuantity < 0) {\r\n                    toast.warning(`${product.name} inventory is now negative (${newQuantity}). Please restock soon.`);\r\n                }\r\n            }\r\n\r\n            if (bulkUpdates.length > 0) {\r\n                await updateProductsBulk(bulkUpdates, userId, 'Sale Status/Qty Edit', saleId, saleDate, receiptNumber);\r\n            }\r\n\r\n            return true;\r\n        } catch (error) {\r\n            console.error('Error adjusting stock for edited sale:', error);\r\n            return false;\r\n        }\r\n    };\r\n\r\n    return {\r\n        deductStockForSale,\r\n        restoreStockForSale,\r\n        adjustStockForEditedSale\r\n    };\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1309, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useSalesData.ts"],"sourcesContent":["import { useState, useEffect, useMemo, useCallback } from 'react';\r\nimport { Sale, DbSale, mapDbSaleToSale } from '@/types';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\r\nimport { useActivityLogger } from '@/hooks/useActivityLogger';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\nimport { useProducts } from '@/hooks/useProducts';\r\nimport { useInventoryActions } from '@/hooks/useInventoryActions';\r\nimport { clearInventoryCaches } from '@/utils/inventoryCacheUtils';\r\nimport { getSalesAction, deleteSaleAction } from '@/app/actions/sales';\r\n\r\nexport interface TopCustomer {\r\n  id?: string;\r\n  name: string;\r\n  totalPurchases: number;\r\n  orderCount: number;\r\n}\r\n\r\nexport const useSalesData = (userId: string | undefined, sortOrder: string = 'desc', pageSize?: number) => {\r\n\r\n  const queryClient = useQueryClient();\r\n  const { toast } = useToast();\r\n  const { logActivity } = useActivityLogger();\r\n  const { currentBusiness } = useBusiness();\r\n  const { restoreStockForSale } = useInventoryActions(userId);\r\n\r\n  const loadSales = useCallback(async (): Promise<Sale[]> => {\r\n    try {\r\n      if (!userId || !currentBusiness) {\r\n        return [];\r\n      }\r\n\r\n      // If pageSize is specified, load only that many records\r\n      const salesData = await getSalesAction(currentBusiness.id, sortOrder as any, pageSize);\r\n\r\n      const formattedSales: Sale[] = salesData ? salesData.map((item: any) => {\r\n        const dbSale: DbSale = {\r\n          id: item.id,\r\n          user_id: item.user_id,\r\n          location_id: item.location_id,\r\n          receipt_number: item.receipt_number,\r\n          customer_name: item.customer_name,\r\n          customer_address: item.customer_address,\r\n          customer_contact: item.customer_contact,\r\n          customer_id: item.customer_id,\r\n          items: item.items as any,\r\n          payment_status: item.payment_status,\r\n          profit: item.profit ? Number(item.profit) : 0,\r\n          date: item.date,\r\n          tax_rate: item.tax_rate || 0,\r\n          created_at: item.created_at,\r\n          updated_at: item.updated_at,\r\n          cash_transaction_id: item.cash_transaction_id,\r\n          amount_paid: item.amount_paid ? Number(item.amount_paid) : undefined,\r\n          amount_due: item.amount_due ? Number(item.amount_due) : undefined,\r\n          category_id: item.category_id,\r\n          notes: item.notes\r\n        };\r\n        return mapDbSaleToSale(dbSale);\r\n      }) : [];\r\n\r\n      return formattedSales;\r\n\r\n    } catch (error) {\r\n      console.error('Error loading sales:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to load sales data. Please try again.\",\r\n        variant: \"destructive\"\r\n      });\r\n      return [];\r\n    }\r\n  }, [userId, currentBusiness?.id, sortOrder, pageSize, toast]);\r\n\r\n  // React Query caching with persistent storage for improved performance\r\n  const baseQueryKey = useMemo(() => ['sales', currentBusiness?.id, userId], [currentBusiness?.id, userId]);\r\n  const queryKey = useMemo(() => [...baseQueryKey, sortOrder, pageSize], [baseQueryKey, sortOrder, pageSize]);\r\n\r\n  const {\r\n    data: sales = [],\r\n    isLoading: isQueryLoading,\r\n    isFetching,\r\n    refetch\r\n  } = useQuery({\r\n    queryKey,\r\n    queryFn: loadSales,\r\n    enabled: !!userId && !!currentBusiness?.id,\r\n    staleTime: 30_000,\r\n    gcTime: 30 * 60_000,\r\n    refetchOnWindowFocus: true,\r\n    refetchOnReconnect: true,\r\n  });\r\n\r\n  // Derived loading state\r\n  const isLoading = isQueryLoading || (isFetching && sales.length === 0);\r\n\r\n  const getTopCustomers = useMemo((): TopCustomer[] => {\r\n    // Skip quotes since they're not actual purchases\r\n    const nonQuoteSales = sales.filter(sale => sale.paymentStatus !== \"Quote\");\r\n\r\n    // Group sales by customer name\r\n    const customerMap = new Map<string, { total: number, count: number, customerId?: string }>();\r\n\r\n    nonQuoteSales.forEach(sale => {\r\n      const customerName = sale.customerName;\r\n      const saleTotal = sale.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);\r\n\r\n      if (!customerMap.has(customerName)) {\r\n        customerMap.set(customerName, {\r\n          total: saleTotal,\r\n          count: 1,\r\n          customerId: sale.customerId\r\n        });\r\n      } else {\r\n        const current = customerMap.get(customerName)!;\r\n        customerMap.set(customerName, {\r\n          total: current.total + saleTotal,\r\n          count: current.count + 1,\r\n          customerId: current.customerId || sale.customerId\r\n        });\r\n      }\r\n    });\r\n\r\n    // Convert map to array and sort by total purchases\r\n    return Array.from(customerMap.entries())\r\n      .map(([name, data]) => ({\r\n        id: data.customerId,\r\n        name,\r\n        totalPurchases: data.total,\r\n        orderCount: data.count\r\n      }))\r\n      .sort((a, b) => b.totalPurchases - a.totalPurchases);\r\n  }, [sales]);\r\n\r\n  // Memoize customer lifetime purchases function\r\n  const getCustomerLifetimePurchases = useMemo(() => {\r\n    return (customerName: string) => {\r\n      // Filter sales by customer name and exclude quotes\r\n      const customerSales = sales.filter(sale =>\r\n        sale.customerName.toLowerCase() === customerName.toLowerCase() &&\r\n        sale.paymentStatus !== \"Quote\"\r\n      );\r\n\r\n      // Calculate total purchase amount and count\r\n      const total = customerSales.reduce((sum, sale) =>\r\n        sum + sale.items.reduce((itemSum, item) => itemSum + (item.price * item.quantity), 0), 0\r\n      );\r\n\r\n      return {\r\n        total,\r\n        count: customerSales.length\r\n      };\r\n    };\r\n  }, [sales]);\r\n\r\n  const deleteSale = async (id: string) => {\r\n    try {\r\n      // First, find the sale to get its details for logging\r\n      const saleToDelete = sales.find(sale => sale.id === id);\r\n      if (!saleToDelete) {\r\n        throw new Error('Sale not found');\r\n      }\r\n\r\n      // Restore product quantities back to inventory (Only if it wasn't a quote which doesn't deduct stock)\r\n      if (saleToDelete.paymentStatus !== 'Quote' && saleToDelete.items.length > 0) {\r\n        console.log('Restoring product quantities via useInventoryActions...');\r\n        const success = await restoreStockForSale(saleToDelete.items, id, saleToDelete.receiptNumber, currentBusiness?.id);\r\n\r\n        if (!success) {\r\n          toast({\r\n            title: \"Inventory Update Warning\",\r\n            description: \"Sale deleted, but inventory restoration might have failed. Please check your stock levels.\",\r\n            variant: \"destructive\"\r\n          });\r\n        }\r\n      }\r\n\r\n      // Proceed to delete the sale via API Action\r\n      if (!currentBusiness?.id) {\r\n        throw new Error('Business context missing for deletion');\r\n      }\r\n\r\n      const result = await deleteSaleAction(id, currentBusiness.id);\r\n\r\n      if (!result.success) {\r\n        throw new Error(result.error);\r\n      }\r\n\r\n      // Update React Query cache\r\n      queryClient.setQueryData(queryKey, (oldData: Sale[] | undefined) => {\r\n        return oldData ? oldData.filter(sale => sale.id !== id) : [];\r\n      });\r\n      queryClient.invalidateQueries({ queryKey: baseQueryKey });\r\n\r\n      // Clear sold items cache after deletion\r\n      clearSoldItemsCache();\r\n\r\n      // Log activity for sale deletion\r\n      await logActivity({\r\n        activityType: 'DELETE',\r\n        module: 'SALES',\r\n        entityType: 'sale',\r\n        entityId: id,\r\n        entityName: `Sale #${saleToDelete.receiptNumber}`,\r\n        description: `Deleted sale for ${saleToDelete.customerName} - Total: UGX ${((saleToDelete.amountPaid || 0) + (saleToDelete.amountDue || 0)).toLocaleString()} (Stock restored)`,\r\n        metadata: {\r\n          receiptNumber: saleToDelete.receiptNumber,\r\n          customerName: saleToDelete.customerName,\r\n          customerAddress: saleToDelete.customerAddress,\r\n          customerContact: saleToDelete.customerContact,\r\n          totalAmount: (saleToDelete.amountPaid || 0) + (saleToDelete.amountDue || 0),\r\n          amountPaid: saleToDelete.amountPaid,\r\n          profit: saleToDelete.profit,\r\n          paymentStatus: saleToDelete.paymentStatus,\r\n          taxRate: saleToDelete.taxRate,\r\n          itemCount: saleToDelete.items.length,\r\n          items: saleToDelete.items.map(item => ({\r\n            description: item.description,\r\n            quantity: item.quantity,\r\n            price: item.price,\r\n            cost: item.cost,\r\n            total: item.quantity * item.price,\r\n            discountPercentage: item.discountPercentage,\r\n            discountAmount: item.discountAmount\r\n          })),\r\n          notes: saleToDelete.notes,\r\n          cashTransactionDeleted: !!saleToDelete.cashTransactionId\r\n        }\r\n      });\r\n\r\n      toast({\r\n        title: \"Sale Deleted\",\r\n        description: \"The sale record and associated data have been successfully deleted.\"\r\n      });\r\n\r\n      clearInventoryCaches();\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error deleting sale:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to delete sale. Please try again.\",\r\n        variant: \"destructive\"\r\n      });\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const clearSoldItemsCache = useCallback(() => {\r\n    if (!currentBusiness?.id) return;\r\n    const key = `soldItemsFilters_${currentBusiness.id}`;\r\n    localStorage.removeItem(key);\r\n\r\n    // Also clear legacy keys for safety\r\n    localStorage.removeItem('soldItemsFilters');\r\n  }, [currentBusiness?.id]);\r\n\r\n  const addSale = useCallback((newSale: Sale) => {\r\n    queryClient.setQueryData(queryKey, (oldData: Sale[] | undefined) => {\r\n      return oldData ? [newSale, ...oldData] : [newSale];\r\n    });\r\n    queryClient.invalidateQueries({ queryKey: baseQueryKey });\r\n    clearSoldItemsCache();\r\n    clearInventoryCaches();\r\n  }, [queryClient, queryKey, baseQueryKey, clearSoldItemsCache, clearInventoryCaches]);\r\n\r\n  const updateSale = useCallback((updatedSale: Sale) => {\r\n    queryClient.setQueryData(queryKey, (oldData: Sale[] | undefined) => {\r\n      return oldData ? oldData.map(s => s.id === updatedSale.id ? updatedSale : s) : [updatedSale];\r\n    });\r\n    queryClient.invalidateQueries({ queryKey: baseQueryKey });\r\n    clearSoldItemsCache();\r\n    clearInventoryCaches();\r\n  }, [queryClient, queryKey, baseQueryKey, clearSoldItemsCache, clearInventoryCaches]);\r\n\r\n  return {\r\n    sales,\r\n    isLoading,\r\n    deleteSale,\r\n    addSale,\r\n    updateSale,\r\n    getTopCustomers,\r\n    getCustomerLifetimePurchases,\r\n    clearSoldItemsCache,\r\n    refetch,\r\n    isFetching\r\n  };\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1671, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useSaleProductSelection.ts"],"sourcesContent":["import { useState } from 'react';\r\nimport { Product, SaleItem } from '@/types';\r\nimport { useProducts } from './useProducts';\r\nimport { useInventoryActions } from './useInventoryActions';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\n\r\nexport const useSaleProductSelection = (userId: string | undefined) => {\r\n  const { products } = useProducts(userId);\r\n  const { currentBusiness } = useBusiness();\r\n  const { deductStockForSale, adjustStockForEditedSale } = useInventoryActions(userId);\r\n  const [selectedProducts, setSelectedProducts] = useState<Record<string, string | null>>({});\r\n\r\n  const selectProduct = (itemIndex: number, productId: string | null) => {\r\n    setSelectedProducts(prev => ({\r\n      ...prev,\r\n      [itemIndex]: productId\r\n    }));\r\n  };\r\n\r\n  const getProductForItem = (itemIndex: number): Product | null => {\r\n    const productId = selectedProducts[itemIndex];\r\n    if (!productId) return null;\r\n\r\n    return products.find(p => p.id === productId) || null;\r\n  };\r\n\r\n  const updateInventoryForSale = async (\r\n    items: SaleItem[],\r\n    paymentStatus?: string,\r\n    saleDate?: Date,\r\n    saleId?: string,\r\n    receiptNumber?: string\r\n  ) => {\r\n    // Only skip inventory if still a quote\r\n    if (paymentStatus === 'Quote') return true;\r\n\r\n    return deductStockForSale(items, saleId, saleDate, receiptNumber, currentBusiness?.id);\r\n  };\r\n\r\n\r\n  const updateInventoryForEditedSale = async (\r\n    originalItems: SaleItem[],\r\n    newItems: SaleItem[],\r\n    newStatus?: string,\r\n    saleDate?: Date,\r\n    saleId?: string,\r\n    receiptNumber?: string,\r\n    originalStatus?: string\r\n  ) => {\r\n    // Determine if we should add back original items and deduct new items\r\n    const shouldRestoreOriginal = originalStatus !== 'Quote';\r\n    const shouldDeductNew = newStatus !== 'Quote';\r\n\r\n    // If neither status affects inventory, we can skip\r\n    if (!shouldRestoreOriginal && !shouldDeductNew) return true;\r\n\r\n    // Filter lists based on status. \r\n    // If original was Quote, we DO NOT restore (empty list).\r\n    // If new is Quote, we DO NOT deduct (empty list).\r\n    const itemsToRestore = shouldRestoreOriginal ? originalItems : [];\r\n    const itemsToDeduct = shouldDeductNew ? newItems : [];\r\n\r\n    return adjustStockForEditedSale(itemsToRestore, itemsToDeduct, saleId, saleDate, receiptNumber, currentBusiness?.id);\r\n  };\r\n\r\n  return {\r\n    products,\r\n    selectedProducts,\r\n    selectProduct,\r\n    getProductForItem,\r\n    updateInventoryForSale,\r\n    updateInventoryForEditedSale\r\n  };\r\n};\r\n"],"names":[],"mappings":";;;;AAAA;AAEA;AACA;AACA;;;;;;AAEO,MAAM,0BAA0B,CAAC;;IACtC,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAA,6IAAW,EAAC;IACjC,MAAM,EAAE,eAAe,EAAE,GAAG,IAAA,qJAAW;IACvC,MAAM,EAAE,kBAAkB,EAAE,wBAAwB,EAAE,GAAG,IAAA,6JAAmB,EAAC;IAC7E,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,IAAA,yKAAQ,EAAgC,CAAC;IAEzF,MAAM,gBAAgB,CAAC,WAAmB;QACxC,oBAAoB,CAAA,OAAQ,CAAC;gBAC3B,GAAG,IAAI;gBACP,CAAC,UAAU,EAAE;YACf,CAAC;IACH;IAEA,MAAM,oBAAoB,CAAC;QACzB,MAAM,YAAY,gBAAgB,CAAC,UAAU;QAC7C,IAAI,CAAC,WAAW,OAAO;QAEvB,OAAO,SAAS,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,cAAc;IACnD;IAEA,MAAM,yBAAyB,OAC7B,OACA,eACA,UACA,QACA;QAEA,uCAAuC;QACvC,IAAI,kBAAkB,SAAS,OAAO;QAEtC,OAAO,mBAAmB,OAAO,QAAQ,UAAU,eAAe,iBAAiB;IACrF;IAGA,MAAM,+BAA+B,OACnC,eACA,UACA,WACA,UACA,QACA,eACA;QAEA,sEAAsE;QACtE,MAAM,wBAAwB,mBAAmB;QACjD,MAAM,kBAAkB,cAAc;QAEtC,mDAAmD;QACnD,IAAI,CAAC,yBAAyB,CAAC,iBAAiB,OAAO;QAEvD,iCAAiC;QACjC,yDAAyD;QACzD,kDAAkD;QAClD,MAAM,iBAAiB,wBAAwB,gBAAgB,EAAE;QACjE,MAAM,gBAAgB,kBAAkB,WAAW,EAAE;QAErD,OAAO,yBAAyB,gBAAgB,eAAe,QAAQ,UAAU,eAAe,iBAAiB;IACnH;IAEA,OAAO;QACL;QACA;QACA;QACA;QACA;QACA;IACF;AACF;GAnEa;;QACU,6IAAW;QACJ,qJAAW;QACkB,6JAAmB"}},
    {"offset": {"line": 1742, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useNewSaleActions.ts"],"sourcesContent":["import { useState, useCallback } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { useAuth } from '@/components/auth/AuthProvider';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { useCustomers, Customer } from '@/hooks/useCustomers';\r\nimport { useSalesData } from '@/hooks/useSalesData';\r\nimport { useSaleProductSelection } from '@/hooks/useSaleProductSelection';\r\nimport { Sale } from '@/types';\r\nimport { toast } from 'sonner';\r\nimport { useActivityLogger } from '@/hooks/useActivityLogger';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\nimport { generateThermalReceipt } from '@/utils/generateThermalReceipt';\r\nimport { print } from '@/utils/thermalPrinterPlug';\r\nimport { useBusinessSettings } from '@/hooks/useBusinessSettings';\r\nimport { getCustomerByNameAction, updateSaleCustomerAction, deleteSaleAction } from '@/app/actions/sales';\r\n\r\nexport const useNewSaleActions = (editSale?: Sale, onSaveSuccess?: () => void) => {\r\n  const router = useRouter();\r\n  const { user } = useAuth();\r\n  const { toast: uiToast } = useToast();\r\n  const { customers, createCustomer } = useCustomers();\r\n  const { addSale, updateSale } = useSalesData(user?.id);\r\n  const { updateInventoryForSale, updateInventoryForEditedSale } = useSaleProductSelection(user?.id);\r\n  const { logActivity } = useActivityLogger();\r\n  const { currentBusiness } = useBusiness();\r\n  const { settings } = useBusinessSettings();\r\n\r\n  const [isReceiptOpen, setIsReceiptOpen] = useState(false);\r\n  const [completedSale, setCompletedSale] = useState<Sale | null>(null);\r\n  const [newCustomerDialogOpen, setNewCustomerDialogOpen] = useState(false);\r\n  const [includePaymentInfo, setIncludePaymentInfo] = useState(true);\r\n\r\n  const handleSaleComplete = useCallback(async (\r\n    sale: Sale,\r\n    showReceipt: boolean = false,\r\n    includePaymentInfo: boolean = true,\r\n    selectedCategoryId?: string,\r\n    clearDraft?: () => void,\r\n    saleDate?: Date,\r\n    thermalPrintAfterSave: boolean = false\r\n  ) => {\r\n    // Clear draft when sale is completed\r\n    if (!editSale && clearDraft) {\r\n      clearDraft();\r\n    }\r\n\r\n    // Only save customer to customers database if they don't exist already\r\n    if (user?.id && sale.customerName.trim()) {\r\n      let customerId = sale.customerId;\r\n\r\n      // If no customerId provided, check if customer already exists by name\r\n      if (!customerId) {\r\n        const existingCustomer = await getCustomerByNameAction(\r\n          currentBusiness?.id || '',\r\n          sale.customerName.trim()\r\n        );\r\n\r\n        if (existingCustomer) {\r\n          customerId = existingCustomer.id;\r\n        } else {\r\n          try {\r\n            const newCustomer = await createCustomer({\r\n              fullName: sale.customerName,\r\n              phoneNumber: sale.customerContact || null,\r\n              location: sale.customerAddress || null,\r\n              email: null,\r\n              birthday: null,\r\n              gender: null,\r\n              categoryId: selectedCategoryId || null,\r\n              notes: null,\r\n              tags: null,\r\n              socialMedia: null\r\n            });\r\n            if (newCustomer) {\r\n              customerId = newCustomer.id;\r\n              toast.success(`Added ${sale.customerName} to your customers list`);\r\n            }\r\n          } catch (error) {\r\n            console.error('Error adding customer:', error);\r\n          }\r\n        }\r\n      }\r\n\r\n      if (customerId && sale.id) {\r\n        try {\r\n          await updateSaleCustomerAction(sale.id, customerId);\r\n        } catch (error) {\r\n          console.error('Error associating sale with customer:', error);\r\n        }\r\n      }\r\n    }\r\n\r\n    // Update inventory for sale (new or edit)\r\n    let inventorySuccess = false;\r\n    if (editSale) {\r\n      // For edits, restore original items and subtract new ones\r\n      inventorySuccess = await updateInventoryForEditedSale(editSale.items, sale.items, sale.paymentStatus, undefined, sale.id, sale.receiptNumber, editSale.paymentStatus);\r\n    } else {\r\n      // For new sale, subtract sold items\r\n      // Use provided saleDate or undefined (which defaults to current time in updateInventoryForSale)\r\n      inventorySuccess = await updateInventoryForSale(sale.items, sale.paymentStatus, saleDate, sale.id, sale.receiptNumber);\r\n    }\r\n\r\n    if (!inventorySuccess) {\r\n      console.error('Inventory update failed. Initiating rollback...');\r\n\r\n      // ROLLBACK STRATEGY\r\n      if (!editSale) {\r\n        const rollbackSuccess = await deleteSaleAction(sale.id, currentBusiness?.id || '');\r\n        if (!rollbackSuccess) {\r\n          console.error('CRITICAL: Failed to rollback sale after inventory failure');\r\n          uiToast({\r\n            title: \"Critical Error\",\r\n            description: \"Inventory failed to update, and we could not cancel the sale. Please contact support.\",\r\n            variant: \"destructive\"\r\n          });\r\n        } else {\r\n          uiToast({\r\n            title: \"Sale Cancelled\",\r\n            description: \"Inventory update failed, so the sale was cancelled to ensure data consistency.\",\r\n            variant: \"destructive\"\r\n          });\r\n        }\r\n      } else {\r\n        // If it was an edit, we might want to revert the sale changes in the database\r\n        // For now, we just warn the user that inventory wasn't updated\r\n        uiToast({\r\n          title: \"Inventory Update Failed\",\r\n          description: \"The sale was saved, but inventory could not be updated. Please check stock levels manually.\",\r\n          variant: \"destructive\"\r\n        });\r\n        // Ideally we would revert the DB update here too, but that requires passing the original DB state\r\n      }\r\n\r\n      // STOP PROCESSING\r\n      throw new Error('Inventory update failed');\r\n    }\r\n\r\n    // Calculate total amount from items for accurate logging\r\n    const itemsTotal = sale.items.reduce((sum, item) => {\r\n      const itemTotal = item.price * item.quantity;\r\n      const discountAmount = item.discountType === 'amount'\r\n        ? (item.discountAmount || 0)\r\n        : (itemTotal * (item.discountPercentage || 0) / 100);\r\n      return sum + (itemTotal - discountAmount);\r\n    }, 0);\r\n\r\n    const taxAmount = sale.taxRate ? (itemsTotal * sale.taxRate / 100) : 0;\r\n    const grandTotal = itemsTotal + taxAmount;\r\n\r\n    // Log activity with comprehensive details\r\n    await logActivity({\r\n      activityType: editSale ? 'UPDATE' : 'CREATE',\r\n      module: 'SALES',\r\n      entityType: 'sale',\r\n      entityId: sale.id,\r\n      entityName: `Sale #${sale.receiptNumber}`,\r\n      description: `${editSale ? 'Updated' : 'Created'} sale for ${sale.customerName} - Total: UGX ${grandTotal.toLocaleString()}`,\r\n      metadata: {\r\n        receiptNumber: sale.receiptNumber,\r\n        customerName: sale.customerName,\r\n        customerAddress: sale.customerAddress,\r\n        customerContact: sale.customerContact,\r\n        totalAmount: grandTotal,\r\n        amountPaid: sale.amountPaid,\r\n        profit: sale.profit,\r\n        paymentStatus: sale.paymentStatus,\r\n        taxRate: sale.taxRate,\r\n        itemCount: sale.items.length,\r\n        items: sale.items.map(item => ({\r\n          description: item.description,\r\n          quantity: item.quantity,\r\n          price: item.price,\r\n          cost: item.cost,\r\n          total: item.quantity * item.price,\r\n          discountPercentage: item.discountPercentage,\r\n          discountAmount: item.discountAmount\r\n        })),\r\n        notes: sale.notes\r\n      }\r\n    });\r\n\r\n    uiToast({\r\n      title: editSale ? \"Sale Updated\" : \"Sale Created\",\r\n      description: `${editSale ? \"Updated\" : \"Created\"} sale for ${sale.customerName}. ${sale.paymentStatus === 'NOT PAID' ? 'Inventory has been updated for this credit sale.' : ''}`,\r\n    });\r\n\r\n    // Clear sold items cache to force refresh\r\n    const keys = Object.keys(localStorage);\r\n    keys.forEach(key => {\r\n      if (key.startsWith('soldItems_')) {\r\n        localStorage.removeItem(key);\r\n      }\r\n    });\r\n\r\n    // Store the completed sale\r\n    setCompletedSale(sale);\r\n\r\n    //  INSTANT UPDATE: Add/update sale in cache immediately (like your campaign example)\r\n    if (editSale) {\r\n      updateSale(sale);\r\n    } else {\r\n      addSale(sale);\r\n    }\r\n\r\n    // Store payment info preference\r\n    setIncludePaymentInfo(includePaymentInfo);\r\n\r\n    // Show receipt dialog if requested\r\n    if (showReceipt) {\r\n      setIsReceiptOpen(true);\r\n\r\n      // If thermal auto-print is enabled, trigger it\r\n      if (thermalPrintAfterSave) {\r\n        try {\r\n          const thermalData = await generateThermalReceipt(sale, settings);\r\n          await print(thermalData, settings.defaultPrinterName);\r\n        } catch (printErr) {\r\n          console.error('Auto-print failed:', printErr);\r\n          toast.error('Automated thermal printing failed');\r\n        }\r\n      }\r\n    } else {\r\n      // If it's a new sale and we have a success callback, use it (to clear form)\r\n      // Otherwise navigate to sales list\r\n      if (!editSale && onSaveSuccess) {\r\n        onSaveSuccess();\r\n      } else {\r\n        router.push('/sales');\r\n      }\r\n    }\r\n  }, [user?.id, createCustomer, editSale, uiToast, router, logActivity, addSale, updateSale, onSaveSuccess]);\r\n\r\n  const handleReceiptClose = useCallback(() => {\r\n    setIsReceiptOpen(false);\r\n    // If it's a new sale and we have a success callback, use it (to clear form)\r\n    // Otherwise navigate to sales list\r\n    if (!editSale && onSaveSuccess) {\r\n      onSaveSuccess();\r\n    } else {\r\n      router.push('/sales');\r\n    }\r\n  }, [router, editSale, onSaveSuccess]);\r\n\r\n  const handleAddCustomer = useCallback(async (customerData: Omit<Customer, 'id' | 'createdAt' | 'updatedAt'>) => {\r\n    if (!user?.id) return false;\r\n    try {\r\n      const newCustomer = await createCustomer(customerData);\r\n      if (newCustomer) {\r\n        setNewCustomerDialogOpen(false);\r\n        return true;\r\n      }\r\n      return false;\r\n    } catch (error) {\r\n      console.error('Error adding customer:', error);\r\n      return false;\r\n    }\r\n  }, [user?.id, createCustomer]);\r\n\r\n  const handleOpenNewCustomerDialog = useCallback(() => {\r\n    setNewCustomerDialogOpen(true);\r\n  }, []);\r\n\r\n  return {\r\n    isReceiptOpen,\r\n    completedSale,\r\n    newCustomerDialogOpen,\r\n    includePaymentInfo,\r\n    customers,\r\n    handleSaleComplete,\r\n    handleReceiptClose,\r\n    handleAddCustomer,\r\n    handleOpenNewCustomerDialog,\r\n    setNewCustomerDialogOpen\r\n  };\r\n};"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2052, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useCashAccounts.ts"],"sourcesContent":["import { useState, useEffect, useMemo, useCallback } from 'react';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\nimport { useAuth } from '@/components/auth/AuthProvider';\r\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\r\nimport { CashAccount } from '@/types/cash';\r\nimport {\r\n  getCashAccountsAction,\r\n  createCashAccountAction,\r\n  updateCashAccountAction,\r\n  deleteCashAccountAction,\r\n  deleteCashAccountWithTransactionsAction,\r\n  getCashAccountBalanceAction\r\n} from '@/app/actions/finance';\r\n\r\nexport const useCashAccounts = () => {\r\n  const [accounts, setAccounts] = useState<CashAccount[]>([]);\r\n  const { toast } = useToast();\r\n  const { currentBusiness } = useBusiness();\r\n  const { user } = useAuth();\r\n  const queryClient = useQueryClient();\r\n\r\n  const loadAccounts = useCallback(async (): Promise<CashAccount[]> => {\r\n    if (!currentBusiness?.id) return [];\r\n\r\n    try {\r\n      const result = await getCashAccountsAction(currentBusiness.id);\r\n\r\n      if (!result.success || !result.data) {\r\n        throw new Error(result.error || 'Failed to fetch accounts');\r\n      }\r\n\r\n      return result.data.map((account: any) => ({\r\n        ...account,\r\n        createdAt: new Date(account.createdAt),\r\n        updatedAt: new Date(account.updatedAt)\r\n      }));\r\n    } catch (error) {\r\n      console.error('Error loading cash accounts:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to load cash accounts\",\r\n        variant: \"destructive\"\r\n      });\r\n      return [];\r\n    }\r\n  }, [currentBusiness?.id, toast]);\r\n\r\n  const queryKey = ['cash_accounts', currentBusiness?.id];\r\n  const { data: queriedAccounts, isLoading: isQueryLoading } = useQuery({\r\n    queryKey,\r\n    queryFn: loadAccounts,\r\n    enabled: !!currentBusiness?.id,\r\n    staleTime: 30_000,\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (queriedAccounts) {\r\n      setAccounts(queriedAccounts);\r\n    }\r\n  }, [queriedAccounts]);\r\n\r\n  const isLoading = isQueryLoading && !queriedAccounts;\r\n\r\n  const refreshAccounts = useCallback(() => {\r\n    queryClient.invalidateQueries({ queryKey });\r\n  }, [queryClient, queryKey]);\r\n\r\n  const createAccount = useCallback(async (accountData: {\r\n    name: string;\r\n    description?: string;\r\n    openingBalance: number;\r\n    isDefault?: boolean;\r\n  }) => {\r\n    if (!currentBusiness?.id || !user?.id) return null;\r\n\r\n    try {\r\n      const result = await createCashAccountAction({\r\n        ...accountData,\r\n        userId: user.id,\r\n        locationId: currentBusiness.id\r\n      });\r\n\r\n      if (!result.success || !result.data) throw new Error(result.error);\r\n\r\n      queryClient.invalidateQueries({ queryKey });\r\n      toast({\r\n        title: \"Success\",\r\n        description: \"Cash account created successfully\"\r\n      });\r\n\r\n      return result.data;\r\n    } catch (error) {\r\n      console.error('Error creating cash account:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to create cash account\",\r\n        variant: \"destructive\"\r\n      });\r\n      return null;\r\n    }\r\n  }, [currentBusiness?.id, user?.id, queryClient, queryKey, toast]);\r\n\r\n  const updateAccount = async (id: string, updates: Partial<CashAccount>) => {\r\n    if (!currentBusiness?.id) return false;\r\n\r\n    try {\r\n      const result = await updateCashAccountAction(id, {\r\n        ...updates,\r\n        locationId: currentBusiness.id\r\n      });\r\n\r\n      if (!result.success) throw new Error(result.error);\r\n\r\n      queryClient.invalidateQueries({ queryKey });\r\n      toast({\r\n        title: \"Success\",\r\n        description: \"Cash account updated successfully\"\r\n      });\r\n\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error updating cash account:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to update cash account\",\r\n        variant: \"destructive\"\r\n      });\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const deleteAccount = async (id: string, onDeleted?: () => void) => {\r\n    if (!currentBusiness?.id) return { success: false, hasTransactions: false };\r\n\r\n    try {\r\n      const result = await deleteCashAccountAction(id, currentBusiness.id);\r\n\r\n      if (result.success) {\r\n        queryClient.invalidateQueries({ queryKey });\r\n        toast({\r\n          title: \"Success\",\r\n          description: \"Cash account deleted successfully\"\r\n        });\r\n        if (onDeleted) onDeleted();\r\n      }\r\n\r\n      return result as any;\r\n    } catch (error) {\r\n      console.error('Error deleting cash account:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to delete cash account\",\r\n        variant: \"destructive\"\r\n      });\r\n      return { success: false, hasTransactions: false };\r\n    }\r\n  };\r\n\r\n  const deleteAccountWithTransactions = async (id: string, deleteTransactions: boolean = false, onDeleted?: () => void) => {\r\n    if (!currentBusiness?.id) return false;\r\n\r\n    try {\r\n      const result = await deleteCashAccountWithTransactionsAction(id, currentBusiness.id, deleteTransactions);\r\n\r\n      if (!result.success) throw new Error(result.error);\r\n\r\n      queryClient.invalidateQueries({ queryKey });\r\n      toast({\r\n        title: \"Success\",\r\n        description: deleteTransactions\r\n          ? \"Account and transactions deleted\"\r\n          : \"Account deleted (records unlinked)\"\r\n      });\r\n      if (onDeleted) onDeleted();\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error deleting cash account:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to delete cash account\",\r\n        variant: \"destructive\"\r\n      });\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const getAccountBalance = useCallback(async (accountId: string): Promise<number> => {\r\n    if (!currentBusiness?.id) return 0;\r\n    try {\r\n      const result = await getCashAccountBalanceAction(accountId, currentBusiness.id);\r\n      if (result.success) return result.data as number;\r\n      return 0;\r\n    } catch (error) {\r\n      console.error('Error getting balance:', error);\r\n      return 0;\r\n    }\r\n  }, [currentBusiness?.id]);\r\n\r\n  return useMemo(() => ({\r\n    accounts,\r\n    isLoading,\r\n    createAccount,\r\n    updateAccount,\r\n    deleteAccount,\r\n    deleteAccountWithTransactions,\r\n    getAccountBalance,\r\n    loadAccounts,\r\n    refreshAccounts\r\n  }), [accounts, isLoading, createAccount, updateAccount, deleteAccount, deleteAccountWithTransactions, getAccountBalance, loadAccounts, refreshAccounts]);\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2312, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/sale-form/useFormState.ts"],"sourcesContent":["import { useState, useCallback, useEffect } from 'react';\r\nimport { SaleFormData, FormErrors, SaleItem } from '@/types';\r\n\r\nconst emptyItem: SaleItem = {\r\n  description: '',\r\n  quantity: 1,\r\n  price: 0,\r\n  cost: 0,\r\n};\r\n\r\ninterface UseFormStateProps {\r\n  initialData?: any;\r\n  defaultPaymentStatus: string;\r\n}\r\n\r\nexport const useFormState = ({ initialData, defaultPaymentStatus }: UseFormStateProps) => {\r\n  const [formData, setFormData] = useState<SaleFormData>({\r\n    customerName: initialData?.customerName || '',\r\n    customerAddress: initialData?.customerAddress || '',\r\n    customerContact: initialData?.customerContact || '',\r\n    customerId: initialData?.customerId || '', // Added customerId\r\n    items: initialData?.items || [{ ...emptyItem }],\r\n    paymentStatus: defaultPaymentStatus as 'Paid' | 'NOT PAID' | 'Quote' | 'Installment Sale',\r\n    taxRate: initialData?.taxRate || 0,\r\n    amountPaid: (initialData && initialData.paymentStatus === 'Installment Sale') ? 0 : (initialData?.amountPaid || 0),\r\n    amountDue: initialData?.amountDue || 0,\r\n    notes: initialData?.notes || '',\r\n    categoryId: initialData?.categoryId || ''\r\n  });\r\n\r\n  const [errors, setErrors] = useState<FormErrors>({});\r\n  const [taxRateInput, setTaxRateInput] = useState<string>(\r\n    initialData?.taxRate ? initialData.taxRate.toString() : ''\r\n  );\r\n  const [printAfterSave, setPrintAfterSave] = useState<boolean>(true);\r\n  const [thermalPrintAfterSave, setThermalPrintAfterSave] = useState<boolean>(false);\r\n  const [includePaymentInfo, setIncludePaymentInfo] = useState<boolean>(true);\r\n  const [selectedCustomerCategoryId, setSelectedCustomerCategoryId] = useState<string>('');\r\n  const [paymentDate, setPaymentDate] = useState<Date>(new Date());\r\n\r\n  // Cash account integration states\r\n  const [linkToCash, setLinkToCash] = useState<boolean>(false);\r\n  const [selectedCashAccountId, setSelectedCashAccountId] = useState<string>('');\r\n  const [cashTransactionId, setCashTransactionId] = useState<string | null>(null);\r\n  const [originalPaymentStatus, setOriginalPaymentStatus] = useState<string>(defaultPaymentStatus);\r\n  const [formRecentlyCleared, setFormRecentlyCleared] = useState<boolean>(false);\r\n\r\n  const clearFormState = useCallback((onDateReset?: () => void) => {\r\n    setFormData({\r\n      customerName: '',\r\n      customerAddress: '',\r\n      customerContact: '',\r\n      customerId: '', // Clear customerId\r\n      items: [{ ...emptyItem }],\r\n      paymentStatus: defaultPaymentStatus as 'Paid' | 'NOT PAID' | 'Quote' | 'Installment Sale',\r\n      taxRate: 0,\r\n      amountPaid: 0,\r\n      amountDue: 0,\r\n      notes: '',\r\n      categoryId: ''\r\n    });\r\n    setTaxRateInput('');\r\n    setSelectedCustomerCategoryId('');\r\n    setPaymentDate(new Date());\r\n    setLinkToCash(false);\r\n    setErrors({});\r\n    setFormRecentlyCleared(true);\r\n    if (onDateReset) {\r\n      onDateReset();\r\n    }\r\n  }, [defaultPaymentStatus]);\r\n\r\n  // Sync with initialData if it arrives late or changes\r\n  useEffect(() => {\r\n    if (initialData) {\r\n      setFormData(prev => ({\r\n        ...prev,\r\n        customerName: initialData.customerName || prev.customerName,\r\n        customerAddress: initialData.customerAddress || prev.customerAddress,\r\n        customerContact: initialData.customerContact || prev.customerContact,\r\n        customerId: initialData.customerId || prev.customerId,\r\n        // Only override items if we have them in initialData and current items are empty/default\r\n        items: (initialData.items && initialData.items.length > 0) ? initialData.items : prev.items,\r\n        // Ensure payment status syncs\r\n        paymentStatus: (initialData.paymentStatus as 'Paid' | 'NOT PAID' | 'Quote' | 'Installment Sale') || prev.paymentStatus,\r\n        taxRate: initialData.taxRate !== undefined ? initialData.taxRate : prev.taxRate,\r\n        amountPaid: initialData.amountPaid !== undefined ? initialData.amountPaid : prev.amountPaid,\r\n        amountDue: initialData.amountDue !== undefined ? initialData.amountDue : prev.amountDue,\r\n        notes: initialData.notes || prev.notes,\r\n        categoryId: initialData.categoryId || prev.categoryId // Sync Category ID\r\n      }));\r\n\r\n      if (initialData.categoryId) {\r\n        // Also ensure formRecentlyCleared doesn't block it\r\n        setFormRecentlyCleared(false);\r\n      }\r\n\r\n      // Update tax rate input too\r\n      if (initialData.taxRate !== undefined) {\r\n        setTaxRateInput(initialData.taxRate.toString());\r\n      }\r\n    }\r\n  }, [initialData]);\r\n\r\n  return {\r\n    // State\r\n    formData,\r\n    errors,\r\n    taxRateInput,\r\n    printAfterSave,\r\n    thermalPrintAfterSave,\r\n    includePaymentInfo,\r\n    selectedCustomerCategoryId,\r\n    paymentDate,\r\n    linkToCash,\r\n    selectedCashAccountId,\r\n    cashTransactionId,\r\n    originalPaymentStatus,\r\n    formRecentlyCleared,\r\n\r\n    // Setters\r\n    setFormData,\r\n    setErrors,\r\n    setTaxRateInput,\r\n    setPrintAfterSave,\r\n    setThermalPrintAfterSave,\r\n    setIncludePaymentInfo,\r\n    setSelectedCustomerCategoryId,\r\n    setPaymentDate,\r\n    setLinkToCash,\r\n    setSelectedCashAccountId,\r\n    setCashTransactionId,\r\n    setOriginalPaymentStatus,\r\n    setFormRecentlyCleared,\r\n\r\n    // Actions\r\n    clearFormState,\r\n  };\r\n};"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2465, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/sale-form/useFormHandlers.ts"],"sourcesContent":["import { useCallback } from 'react';\r\nimport { SaleFormData, FormErrors } from '@/types';\r\n\r\ninterface UseFormHandlersProps {\r\n  formData: SaleFormData;\r\n  setFormData: React.Dispatch<React.SetStateAction<SaleFormData>>;\r\n  errors: FormErrors;\r\n  setErrors: React.Dispatch<React.SetStateAction<FormErrors>>;\r\n  setTaxRateInput: React.Dispatch<React.SetStateAction<string>>;\r\n  setLinkToCash: React.Dispatch<React.SetStateAction<boolean>>;\r\n}\r\n\r\nexport const useFormHandlers = ({\r\n  formData,\r\n  setFormData,\r\n  errors,\r\n  setErrors,\r\n  setTaxRateInput,\r\n  setLinkToCash,\r\n}: UseFormHandlersProps) => {\r\n  const handleChange = useCallback((e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {\r\n    const { name, value } = e.target;\r\n\r\n    if (name === 'taxRate') {\r\n      setTaxRateInput(value);\r\n      const normalizedValue = value.replace(/,/g, '');\r\n      const numValue = normalizedValue === '' ? 0 : parseFloat(normalizedValue);\r\n      setFormData(prev => ({ ...prev, taxRate: isNaN(numValue) ? 0 : numValue }));\r\n    } else {\r\n      setFormData(prev => ({ ...prev, [name]: value }));\r\n    }\r\n\r\n    if (errors[name as keyof FormErrors]) {\r\n      setErrors(prev => ({ ...prev, [name]: undefined }));\r\n    }\r\n  }, [errors, setFormData, setErrors, setTaxRateInput]);\r\n\r\n  const handleSelectChange = useCallback((value: string) => {\r\n    const newPaymentStatus = value as 'Paid' | 'NOT PAID' | 'Quote' | 'Installment Sale';\r\n    setFormData(prev => ({ ...prev, paymentStatus: newPaymentStatus }));\r\n\r\n    if (value !== 'Paid' && value !== 'Installment Sale') {\r\n      setLinkToCash(false);\r\n    }\r\n\r\n    if (value !== 'Installment Sale') {\r\n      setFormData(prev => ({\r\n        ...prev,\r\n        paymentStatus: newPaymentStatus,\r\n        amountPaid: 0,\r\n        amountDue: 0\r\n      }));\r\n    }\r\n  }, [setFormData, setLinkToCash]);\r\n\r\n  const handleAmountPaidChange = useCallback((amount: number, grandTotal: number) => {\r\n    const amountDue = Math.max(0, grandTotal - amount);\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      amountPaid: amount,\r\n      amountDue: amountDue,\r\n    }));\r\n  }, [setFormData]);\r\n\r\n  const handlePaymentDateChange = useCallback((date: Date) => {\r\n    // This will be handled by the parent component's setPaymentDate\r\n  }, []);\r\n\r\n  return {\r\n    handleChange,\r\n    handleSelectChange,\r\n    handleAmountPaidChange,\r\n    handlePaymentDateChange,\r\n  };\r\n};"],"names":[],"mappings":";;;;AAAA;;;AAYO,MAAM,kBAAkB,CAAC,EAC9B,QAAQ,EACR,WAAW,EACX,MAAM,EACN,SAAS,EACT,eAAe,EACf,aAAa,EACQ;;IACrB,MAAM,eAAe,IAAA,4KAAW;qDAAC,CAAC;YAChC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,EAAE,MAAM;YAEhC,IAAI,SAAS,WAAW;gBACtB,gBAAgB;gBAChB,MAAM,kBAAkB,MAAM,OAAO,CAAC,MAAM;gBAC5C,MAAM,WAAW,oBAAoB,KAAK,IAAI,WAAW;gBACzD;iEAAY,CAAA,OAAQ,CAAC;4BAAE,GAAG,IAAI;4BAAE,SAAS,MAAM,YAAY,IAAI;wBAAS,CAAC;;YAC3E,OAAO;gBACL;iEAAY,CAAA,OAAQ,CAAC;4BAAE,GAAG,IAAI;4BAAE,CAAC,KAAK,EAAE;wBAAM,CAAC;;YACjD;YAEA,IAAI,MAAM,CAAC,KAAyB,EAAE;gBACpC;iEAAU,CAAA,OAAQ,CAAC;4BAAE,GAAG,IAAI;4BAAE,CAAC,KAAK,EAAE;wBAAU,CAAC;;YACnD;QACF;oDAAG;QAAC;QAAQ;QAAa;QAAW;KAAgB;IAEpD,MAAM,qBAAqB,IAAA,4KAAW;2DAAC,CAAC;YACtC,MAAM,mBAAmB;YACzB;mEAAY,CAAA,OAAQ,CAAC;wBAAE,GAAG,IAAI;wBAAE,eAAe;oBAAiB,CAAC;;YAEjE,IAAI,UAAU,UAAU,UAAU,oBAAoB;gBACpD,cAAc;YAChB;YAEA,IAAI,UAAU,oBAAoB;gBAChC;uEAAY,CAAA,OAAQ,CAAC;4BACnB,GAAG,IAAI;4BACP,eAAe;4BACf,YAAY;4BACZ,WAAW;wBACb,CAAC;;YACH;QACF;0DAAG;QAAC;QAAa;KAAc;IAE/B,MAAM,yBAAyB,IAAA,4KAAW;+DAAC,CAAC,QAAgB;YAC1D,MAAM,YAAY,KAAK,GAAG,CAAC,GAAG,aAAa;YAC3C;uEAAY,CAAA,OAAQ,CAAC;wBACnB,GAAG,IAAI;wBACP,YAAY;wBACZ,WAAW;oBACb,CAAC;;QACH;8DAAG;QAAC;KAAY;IAEhB,MAAM,0BAA0B,IAAA,4KAAW;gEAAC,CAAC;QAC3C,gEAAgE;QAClE;+DAAG,EAAE;IAEL,OAAO;QACL;QACA;QACA;QACA;IACF;AACF;GA9Da"}},
    {"offset": {"line": 2571, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/sale-form/useItemManagement.ts"],"sourcesContent":["import { useCallback } from 'react';\r\nimport { SaleFormData, SaleItem } from '@/types';\r\n\r\nconst emptyItem: SaleItem = {\r\n  description: '',\r\n  quantity: 1,\r\n  price: 0,\r\n  cost: 0,\r\n};\r\n\r\ninterface UseItemManagementProps {\r\n  formData: SaleFormData;\r\n  setFormData: React.Dispatch<React.SetStateAction<SaleFormData>>;\r\n}\r\n\r\nexport const useItemManagement = ({ formData, setFormData }: UseItemManagementProps) => {\r\n  const handleAddItem = useCallback(() => {\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      items: [...prev.items, { ...emptyItem }]\r\n    }));\r\n  }, [setFormData]);\r\n\r\n  const handleAddItemWithProduct = useCallback((product: any) => {\r\n    setFormData(prev => {\r\n      // Check if product already exists in items\r\n      const existingItemIndex = prev.items.findIndex(item => item.productId === product.id);\r\n\r\n      if (existingItemIndex !== -1) {\r\n        const newItems = [...prev.items];\r\n        newItems[existingItemIndex] = {\r\n          ...newItems[existingItemIndex],\r\n          quantity: newItems[existingItemIndex].quantity + 1\r\n        };\r\n        return { ...prev, items: newItems };\r\n      }\r\n\r\n      const newItem: SaleItem = {\r\n        productId: product.id,\r\n        description: product.name,\r\n        quantity: 1,\r\n        price: product.sellingPrice,\r\n        cost: product.costPrice,\r\n      };\r\n\r\n      // If the first item is empty, replace it\r\n      if (prev.items.length === 1 && !prev.items[0].description && !prev.items[0].productId) {\r\n        return { ...prev, items: [newItem] };\r\n      }\r\n\r\n      return { ...prev, items: [...prev.items, newItem] };\r\n    });\r\n  }, [setFormData]);\r\n\r\n  const handleUpdateItem = useCallback((index: number, updatedItem: SaleItem) => {\r\n    setFormData(prev => {\r\n      // If this item has a productId, check if it already exists in another row\r\n      if (updatedItem.productId) {\r\n        const existingItemIndex = prev.items.findIndex((item, i) =>\r\n          i !== index && item.productId === updatedItem.productId\r\n        );\r\n\r\n        if (existingItemIndex !== -1) {\r\n          // Duplicate found! Merge this item into the existing one\r\n          const newItems = [...prev.items];\r\n          const existingItem = newItems[existingItemIndex];\r\n\r\n          newItems[existingItemIndex] = {\r\n            ...existingItem,\r\n            quantity: existingItem.quantity + updatedItem.quantity\r\n          };\r\n\r\n          // If there's more than one item, remove the current (duplicate) row\r\n          if (newItems.length > 1) {\r\n            newItems.splice(index, 1);\r\n          } else {\r\n            // If it's the only item (unlikely for a duplicate but safe), reset it\r\n            newItems[index] = { ...emptyItem };\r\n          }\r\n\r\n          return { ...prev, items: newItems };\r\n        }\r\n      }\r\n\r\n      const newItems = [...prev.items];\r\n      newItems[index] = updatedItem;\r\n      return { ...prev, items: newItems };\r\n    });\r\n  }, [setFormData]);\r\n\r\n  const handleRemoveItem = useCallback((index: number) => {\r\n    setFormData(prev => {\r\n      if (prev.items.length === 1) return prev;\r\n      const newItems = prev.items.filter((_, i) => i !== index);\r\n      return { ...prev, items: newItems };\r\n    });\r\n  }, [setFormData]);\r\n\r\n  return {\r\n    handleAddItem,\r\n    handleAddItemWithProduct,\r\n    handleUpdateItem,\r\n    handleRemoveItem,\r\n  };\r\n};"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2734, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/sale-form/useCustomerSelection.ts"],"sourcesContent":["import { useCallback } from 'react';\r\nimport { SaleFormData, Customer } from '@/types';\r\n\r\ninterface UseCustomerSelectionProps {\r\n  setFormData: React.Dispatch<React.SetStateAction<SaleFormData>>;\r\n  setSelectedCustomerCategoryId: React.Dispatch<React.SetStateAction<string>>;\r\n}\r\n\r\nexport const useCustomerSelection = ({\r\n  setFormData,\r\n  setSelectedCustomerCategoryId,\r\n}: UseCustomerSelectionProps) => {\r\n  const handleSelectCustomer = useCallback((customer: Customer) => {\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      customerName: customer.fullName,\r\n      customerAddress: customer.location || '',\r\n      customerContact: customer.phoneNumber || '',\r\n      customerId: customer.id, // Save customer ID\r\n    }));\r\n    setSelectedCustomerCategoryId(customer.categoryId || '');\r\n  }, [setFormData, setSelectedCustomerCategoryId]);\r\n\r\n  const handleCategoryChange = useCallback((categoryId: string) => {\r\n    setSelectedCustomerCategoryId(categoryId);\r\n  }, [setSelectedCustomerCategoryId]);\r\n\r\n  return {\r\n    handleSelectCustomer,\r\n    handleCategoryChange,\r\n  };\r\n};"],"names":[],"mappings":";;;;AAAA;;;AAQO,MAAM,uBAAuB,CAAC,EACnC,WAAW,EACX,6BAA6B,EACH;;IAC1B,MAAM,uBAAuB,IAAA,4KAAW;kEAAC,CAAC;YACxC;0EAAY,CAAA,OAAQ,CAAC;wBACnB,GAAG,IAAI;wBACP,cAAc,SAAS,QAAQ;wBAC/B,iBAAiB,SAAS,QAAQ,IAAI;wBACtC,iBAAiB,SAAS,WAAW,IAAI;wBACzC,YAAY,SAAS,EAAE;oBACzB,CAAC;;YACD,8BAA8B,SAAS,UAAU,IAAI;QACvD;iEAAG;QAAC;QAAa;KAA8B;IAE/C,MAAM,uBAAuB,IAAA,4KAAW;kEAAC,CAAC;YACxC,8BAA8B;QAChC;iEAAG;QAAC;KAA8B;IAElC,OAAO;QACL;QACA;IACF;AACF;GAvBa"}},
    {"offset": {"line": 2780, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/sale-form/useFormValidation.ts"],"sourcesContent":["import { useCallback } from 'react';\r\nimport { SaleFormData, FormErrors } from '@/types';\r\n\r\ninterface UseFormValidationProps {\r\n  formData: SaleFormData;\r\n  linkToCash: boolean;\r\n  selectedCashAccountId: string;\r\n  initialData?: any;\r\n  formRecentlyCleared: boolean;\r\n  setErrors: React.Dispatch<React.SetStateAction<FormErrors>>;\r\n}\r\n\r\nexport const useFormValidation = ({\r\n  formData,\r\n  linkToCash,\r\n  selectedCashAccountId,\r\n  initialData,\r\n  formRecentlyCleared,\r\n  setErrors,\r\n}: UseFormValidationProps) => {\r\n  const validateForm = useCallback((grandTotal: number, saleDate?: Date): boolean => {\r\n    const newErrors: FormErrors = {};\r\n\r\n    if (!formData.customerName.trim()) {\r\n      newErrors.customerName = 'Customer name is required';\r\n    }\r\n\r\n    if (formData.taxRate < 0) {\r\n      newErrors.taxRate = 'Tax rate cannot be negative';\r\n    }\r\n\r\n    // Filter out completely empty items (placeholder items)\r\n    const nonEmptyItems = formData.items.filter(item =>\r\n      item.description.trim() !== '' || item.quantity > 0 || item.price > 0\r\n    );\r\n\r\n    const hasInvalidItems = nonEmptyItems.some(item =>\r\n      !item.description.trim() ||\r\n      item.quantity <= 0 ||\r\n      item.price < 0 ||\r\n      item.cost < 0\r\n    );\r\n\r\n    if (hasInvalidItems) {\r\n      newErrors.items = 'All items must have a description, positive quantity, and non-negative price/cost';\r\n    }\r\n\r\n    // Note: Removed product creation date validation as it was too strict\r\n    // and prevented loading drafts. Products can exist before a sale is backdated.\r\n    // The validation was: if product createdAt > saleDate, reject the sale\r\n    // This is overly restrictive for legitimate use cases like loading drafts.\r\n\r\n\r\n    if (linkToCash && (formData.paymentStatus === 'Paid' || formData.paymentStatus === 'Installment Sale') && !selectedCashAccountId) {\r\n      newErrors.cashAccount = 'Select a cash account when linking payments';\r\n    }\r\n\r\n    if (formData.paymentStatus === 'Installment Sale' && !initialData) {\r\n      if (!formData.amountPaid || formData.amountPaid <= 0) {\r\n        newErrors.amountPaid = 'Enter an initial payment greater than 0';\r\n      }\r\n      if (formData.amountPaid && formData.amountPaid > grandTotal) {\r\n        newErrors.amountPaid = 'Amount paid cannot exceed total';\r\n      }\r\n    }\r\n\r\n    if (formData.paymentStatus === 'Installment Sale' && initialData && formData.amountPaid) {\r\n      if (formData.amountPaid > grandTotal) {\r\n        newErrors.amountPaid = 'Amount paid cannot exceed total';\r\n      }\r\n    }\r\n    setErrors(newErrors);\r\n    return Object.keys(newErrors).length === 0;\r\n  }, [formData, linkToCash, selectedCashAccountId, initialData, formRecentlyCleared, setErrors]);\r\n\r\n  return {\r\n    validateForm,\r\n  };\r\n};"],"names":[],"mappings":";;;;AAAA;;;AAYO,MAAM,oBAAoB,CAAC,EAChC,QAAQ,EACR,UAAU,EACV,qBAAqB,EACrB,WAAW,EACX,mBAAmB,EACnB,SAAS,EACc;;IACvB,MAAM,eAAe,IAAA,4KAAW;uDAAC,CAAC,YAAoB;YACpD,MAAM,YAAwB,CAAC;YAE/B,IAAI,CAAC,SAAS,YAAY,CAAC,IAAI,IAAI;gBACjC,UAAU,YAAY,GAAG;YAC3B;YAEA,IAAI,SAAS,OAAO,GAAG,GAAG;gBACxB,UAAU,OAAO,GAAG;YACtB;YAEA,wDAAwD;YACxD,MAAM,gBAAgB,SAAS,KAAK,CAAC,MAAM;6EAAC,CAAA,OAC1C,KAAK,WAAW,CAAC,IAAI,OAAO,MAAM,KAAK,QAAQ,GAAG,KAAK,KAAK,KAAK,GAAG;;YAGtE,MAAM,kBAAkB,cAAc,IAAI;+EAAC,CAAA,OACzC,CAAC,KAAK,WAAW,CAAC,IAAI,MACtB,KAAK,QAAQ,IAAI,KACjB,KAAK,KAAK,GAAG,KACb,KAAK,IAAI,GAAG;;YAGd,IAAI,iBAAiB;gBACnB,UAAU,KAAK,GAAG;YACpB;YAEA,sEAAsE;YACtE,+EAA+E;YAC/E,uEAAuE;YACvE,2EAA2E;YAG3E,IAAI,cAAc,CAAC,SAAS,aAAa,KAAK,UAAU,SAAS,aAAa,KAAK,kBAAkB,KAAK,CAAC,uBAAuB;gBAChI,UAAU,WAAW,GAAG;YAC1B;YAEA,IAAI,SAAS,aAAa,KAAK,sBAAsB,CAAC,aAAa;gBACjE,IAAI,CAAC,SAAS,UAAU,IAAI,SAAS,UAAU,IAAI,GAAG;oBACpD,UAAU,UAAU,GAAG;gBACzB;gBACA,IAAI,SAAS,UAAU,IAAI,SAAS,UAAU,GAAG,YAAY;oBAC3D,UAAU,UAAU,GAAG;gBACzB;YACF;YAEA,IAAI,SAAS,aAAa,KAAK,sBAAsB,eAAe,SAAS,UAAU,EAAE;gBACvF,IAAI,SAAS,UAAU,GAAG,YAAY;oBACpC,UAAU,UAAU,GAAG;gBACzB;YACF;YACA,UAAU;YACV,OAAO,OAAO,IAAI,CAAC,WAAW,MAAM,KAAK;QAC3C;sDAAG;QAAC;QAAU;QAAY;QAAuB;QAAa;QAAqB;KAAU;IAE7F,OAAO;QACL;IACF;AACF;GAlEa"}},
    {"offset": {"line": 2851, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/sale-form/useFormCalculations.ts"],"sourcesContent":["import { useCallback } from 'react';\r\nimport { SaleItem } from '@/types';\r\n\r\ninterface UseFormCalculationsProps {\r\n  taxRate: number;\r\n}\r\n\r\nexport const useFormCalculations = ({ taxRate }: UseFormCalculationsProps) => {\r\n  const calculateTotalAmount = useCallback((items: SaleItem[]): number => {\r\n    return items.reduce((total, item) => {\r\n      const subtotal = item.price * item.quantity;\r\n      const discountAmount = item.discountType === 'amount' \r\n        ? (item.discountAmount || 0)\r\n        : (subtotal * (item.discountPercentage || 0)) / 100;\r\n      return total + (subtotal - discountAmount);\r\n    }, 0);\r\n  }, []);\r\n\r\n  const calculateTaxAmount = useCallback((total: number): number => {\r\n    return total * (taxRate / 100);\r\n  }, [taxRate]);\r\n\r\n  return {\r\n    calculateTotalAmount,\r\n    calculateTaxAmount,\r\n  };\r\n};"],"names":[],"mappings":";;;;AAAA;;;AAOO,MAAM,sBAAsB,CAAC,EAAE,OAAO,EAA4B;;IACvE,MAAM,uBAAuB,IAAA,4KAAW;iEAAC,CAAC;YACxC,OAAO,MAAM,MAAM;yEAAC,CAAC,OAAO;oBAC1B,MAAM,WAAW,KAAK,KAAK,GAAG,KAAK,QAAQ;oBAC3C,MAAM,iBAAiB,KAAK,YAAY,KAAK,WACxC,KAAK,cAAc,IAAI,IACxB,AAAC,WAAW,CAAC,KAAK,kBAAkB,IAAI,CAAC,IAAK;oBAClD,OAAO,QAAQ,CAAC,WAAW,cAAc;gBAC3C;wEAAG;QACL;gEAAG,EAAE;IAEL,MAAM,qBAAqB,IAAA,4KAAW;+DAAC,CAAC;YACtC,OAAO,QAAQ,CAAC,UAAU,GAAG;QAC/B;8DAAG;QAAC;KAAQ;IAEZ,OAAO;QACL;QACA;IACF;AACF;GAnBa"}},
    {"offset": {"line": 2891, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useInstallmentPayments.ts"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { useAuth } from '@/components/auth/AuthProvider';\r\nimport {\r\n  getInstallmentPaymentsAction,\r\n  createInstallmentPaymentAction,\r\n  updateInstallmentPaymentAction,\r\n  deleteInstallmentPaymentAction,\r\n  linkInstallmentToCashAction,\r\n  unlinkInstallmentFromCashAction\r\n} from '@/app/actions/finance';\r\n\r\nexport interface InstallmentPayment {\r\n  id: string;\r\n  saleId: string;\r\n  userId: string;\r\n  amount: number;\r\n  paymentDate: Date;\r\n  notes?: string;\r\n  cashTransactionId?: string;\r\n  createdAt: Date;\r\n  updatedAt: Date;\r\n}\r\n\r\nexport const useInstallmentPayments = (saleId?: string) => {\r\n  const [payments, setPayments] = useState<InstallmentPayment[]>([]);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const { toast } = useToast();\r\n  const { user } = useAuth();\r\n\r\n  const fetchPayments = useCallback(async (targetSaleId: string) => {\r\n    try {\r\n      setIsLoading(true);\r\n      const result = await getInstallmentPaymentsAction(targetSaleId);\r\n\r\n      if (!result.success || !result.data) throw new Error(result.error);\r\n\r\n      const formattedPayments: InstallmentPayment[] = result.data.map((payment: any) => ({\r\n        ...payment,\r\n        paymentDate: new Date(payment.paymentDate),\r\n        createdAt: new Date(payment.createdAt),\r\n        updatedAt: new Date(payment.updatedAt)\r\n      }));\r\n\r\n      setPayments(formattedPayments);\r\n    } catch (error) {\r\n      console.error('Error fetching installment payments:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to load payment history\",\r\n        variant: \"destructive\"\r\n      });\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, [toast]);\r\n\r\n  const createPayment = async (payment: {\r\n    saleId: string;\r\n    amount: number;\r\n    notes?: string;\r\n    accountId?: string;\r\n    locationId?: string;\r\n    paymentDate?: Date;\r\n  }) => {\r\n    if (!user) return null;\r\n\r\n    try {\r\n      const result = await createInstallmentPaymentAction({\r\n        ...payment,\r\n        userId: user.id,\r\n        paymentDate: payment.paymentDate?.toISOString()\r\n      });\r\n\r\n      if (!result.success || !result.data) throw new Error(result.error);\r\n\r\n      const newPayment: InstallmentPayment = {\r\n        ...result.data,\r\n        paymentDate: new Date(result.data.paymentDate),\r\n        createdAt: new Date(result.data.createdAt),\r\n        updatedAt: new Date(result.data.updatedAt)\r\n      };\r\n\r\n      setPayments(prev => [newPayment, ...prev]);\r\n      return newPayment;\r\n    } catch (error) {\r\n      console.error('Error creating payment:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to record payment\",\r\n        variant: \"destructive\"\r\n      });\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const updatePayment = async (paymentId: string, updates: {\r\n    amount?: number;\r\n    notes?: string;\r\n    paymentDate?: Date;\r\n  }) => {\r\n    try {\r\n      const result = await updateInstallmentPaymentAction(paymentId, {\r\n        ...updates,\r\n        paymentDate: updates.paymentDate?.toISOString()\r\n      });\r\n\r\n      if (!result.success || !result.data) throw new Error(result.error);\r\n\r\n      const updatedPayment: InstallmentPayment = {\r\n        ...result.data,\r\n        paymentDate: new Date(result.data.paymentDate),\r\n        createdAt: new Date(result.data.createdAt),\r\n        updatedAt: new Date(result.data.updatedAt)\r\n      };\r\n\r\n      setPayments(prev => prev.map(p => p.id === paymentId ? updatedPayment : p));\r\n      toast({\r\n        title: \"Success\",\r\n        description: \"Payment updated successfully\",\r\n      });\r\n      return updatedPayment;\r\n    } catch (error: any) {\r\n      console.error('Error updating payment:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: error.message || \"Failed to update payment\",\r\n        variant: \"destructive\"\r\n      });\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const deletePayment = async (paymentId: string) => {\r\n    try {\r\n      const result = await deleteInstallmentPaymentAction(paymentId);\r\n      if (!result.success) throw new Error(result.error);\r\n\r\n      setPayments(prev => prev.filter(p => p.id !== paymentId));\r\n      toast({\r\n        title: \"Success\",\r\n        description: \"Payment deleted successfully\",\r\n      });\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error deleting payment:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to delete payment\",\r\n        variant: \"destructive\"\r\n      });\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const linkPaymentToCashAccount = async (paymentId: string, accountId: string, locationId: string) => {\r\n    if (!user) return;\r\n    try {\r\n      const result = await linkInstallmentToCashAction(paymentId, accountId, locationId, user.id);\r\n      if (!result.success || !result.data) throw new Error(result.error);\r\n\r\n      setPayments(prev => prev.map(p =>\r\n        p.id === paymentId\r\n          ? { ...p, cashTransactionId: result.data.id }\r\n          : p\r\n      ));\r\n\r\n      toast({\r\n        title: \"Success\",\r\n        description: \"Payment linked to cash account successfully\",\r\n      });\r\n    } catch (error: any) {\r\n      console.error('Error linking payment:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: error.message || \"Failed to link payment\",\r\n        variant: \"destructive\"\r\n      });\r\n    }\r\n  };\r\n\r\n  const unlinkPaymentFromCashAccount = async (paymentId: string) => {\r\n    try {\r\n      const result = await unlinkInstallmentFromCashAction(paymentId);\r\n      if (!result.success) throw new Error(result.error);\r\n\r\n      setPayments(prev => prev.map(p =>\r\n        p.id === paymentId\r\n          ? { ...p, cashTransactionId: undefined }\r\n          : p\r\n      ));\r\n\r\n      toast({\r\n        title: \"Success\",\r\n        description: \"Payment unlinked from cash account successfully\",\r\n      });\r\n    } catch (error: any) {\r\n      console.error('Error unlinking payment:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: error.message || \"Failed to unlink payment\",\r\n        variant: \"destructive\"\r\n      });\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (saleId) {\r\n      fetchPayments(saleId);\r\n    }\r\n  }, [saleId, fetchPayments]);\r\n\r\n  return {\r\n    payments,\r\n    isLoading,\r\n    fetchPayments,\r\n    createPayment,\r\n    updatePayment,\r\n    deletePayment,\r\n    linkPaymentToCashAccount,\r\n    unlinkPaymentFromCashAccount\r\n  };\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3100, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useLocalPaymentChanges.ts"],"sourcesContent":["\r\nimport { useState } from 'react';\r\nimport { InstallmentPayment } from '@/hooks/useInstallmentPayments';\r\n\r\nexport interface PaymentChange {\r\n  id: string;\r\n  type: 'update' | 'delete';\r\n  originalPayment: InstallmentPayment;\r\n  updatedData?: { amount?: number; notes?: string; paymentDate?: Date; };\r\n}\r\n\r\nexport const useLocalPaymentChanges = () => {\r\n  const [pendingChanges, setPendingChanges] = useState<PaymentChange[]>([]);\r\n\r\n  const addPaymentChange = (change: PaymentChange) => {\r\n    setPendingChanges(prev => {\r\n      // Remove any existing change for this payment\r\n      const filtered = prev.filter(c => c.id !== change.id);\r\n      return [...filtered, change];\r\n    });\r\n  };\r\n\r\n  const removePaymentChange = (paymentId: string) => {\r\n    setPendingChanges(prev => prev.filter(c => c.id !== paymentId));\r\n  };\r\n\r\n  const clearChanges = () => {\r\n    setPendingChanges([]);\r\n  };\r\n\r\n  const getModifiedPayments = (originalPayments: InstallmentPayment[]): InstallmentPayment[] => {\r\n    return originalPayments\r\n      .filter(payment => {\r\n        // Filter out deleted payments\r\n        const deleteChange = pendingChanges.find(c => c.id === payment.id && c.type === 'delete');\r\n        return !deleteChange;\r\n      })\r\n      .map(payment => {\r\n        // Apply updates to payments\r\n        const updateChange = pendingChanges.find(c => c.id === payment.id && c.type === 'update');\r\n        if (updateChange && updateChange.updatedData) {\r\n          return {\r\n            ...payment,\r\n            amount: updateChange.updatedData.amount ?? payment.amount,\r\n            notes: updateChange.updatedData.notes ?? payment.notes,\r\n            paymentDate: updateChange.updatedData.paymentDate ?? payment.paymentDate,\r\n          };\r\n        }\r\n        return payment;\r\n      });\r\n  };\r\n\r\n  const hasChanges = pendingChanges.length > 0;\r\n\r\n  return {\r\n    pendingChanges,\r\n    addPaymentChange,\r\n    removePaymentChange,\r\n    clearChanges,\r\n    getModifiedPayments,\r\n    hasChanges\r\n  };\r\n};\r\n"],"names":[],"mappings":";;;;AACA;;;AAUO,MAAM,yBAAyB;;IACpC,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,yKAAQ,EAAkB,EAAE;IAExE,MAAM,mBAAmB,CAAC;QACxB,kBAAkB,CAAA;YAChB,8CAA8C;YAC9C,MAAM,WAAW,KAAK,MAAM,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,OAAO,EAAE;YACpD,OAAO;mBAAI;gBAAU;aAAO;QAC9B;IACF;IAEA,MAAM,sBAAsB,CAAC;QAC3B,kBAAkB,CAAA,OAAQ,KAAK,MAAM,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;IACtD;IAEA,MAAM,eAAe;QACnB,kBAAkB,EAAE;IACtB;IAEA,MAAM,sBAAsB,CAAC;QAC3B,OAAO,iBACJ,MAAM,CAAC,CAAA;YACN,8BAA8B;YAC9B,MAAM,eAAe,eAAe,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,QAAQ,EAAE,IAAI,EAAE,IAAI,KAAK;YAChF,OAAO,CAAC;QACV,GACC,GAAG,CAAC,CAAA;YACH,4BAA4B;YAC5B,MAAM,eAAe,eAAe,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,QAAQ,EAAE,IAAI,EAAE,IAAI,KAAK;YAChF,IAAI,gBAAgB,aAAa,WAAW,EAAE;gBAC5C,OAAO;oBACL,GAAG,OAAO;oBACV,QAAQ,aAAa,WAAW,CAAC,MAAM,IAAI,QAAQ,MAAM;oBACzD,OAAO,aAAa,WAAW,CAAC,KAAK,IAAI,QAAQ,KAAK;oBACtD,aAAa,aAAa,WAAW,CAAC,WAAW,IAAI,QAAQ,WAAW;gBAC1E;YACF;YACA,OAAO;QACT;IACJ;IAEA,MAAM,aAAa,eAAe,MAAM,GAAG;IAE3C,OAAO;QACL;QACA;QACA;QACA;QACA;QACA;IACF;AACF;GAnDa"}},
    {"offset": {"line": 3163, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/sale-form/usePaymentOperations.ts"],"sourcesContent":["import { useCallback } from 'react';\r\nimport { useInstallmentPayments } from '@/hooks/useInstallmentPayments';\r\nimport { useLocalPaymentChanges } from '@/hooks/useLocalPaymentChanges';\r\n\r\ninterface UsePaymentOperationsProps {\r\n  initialDataId?: string;\r\n}\r\n\r\nexport const usePaymentOperations = ({ initialDataId }: UsePaymentOperationsProps) => {\r\n  const { \r\n    payments, \r\n    createPayment: createInstallmentPayment, \r\n    updatePayment: updateInstallmentPayment, \r\n    deletePayment: deleteInstallmentPayment \r\n  } = useInstallmentPayments(initialDataId);\r\n\r\n  const { \r\n    pendingChanges, \r\n    addPaymentChange, \r\n    clearChanges, \r\n    getModifiedPayments, \r\n    hasChanges \r\n  } = useLocalPaymentChanges();\r\n\r\n  const processPendingPaymentChanges = useCallback(async () => {\r\n    for (const change of pendingChanges) {\r\n      if (change.type === 'update') {\r\n        await updateInstallmentPayment(change.id, change.updatedData);\r\n      } else if (change.type === 'delete') {\r\n        await deleteInstallmentPayment(change.id);\r\n      }\r\n    }\r\n    clearChanges();\r\n  }, [pendingChanges, updateInstallmentPayment, deleteInstallmentPayment, clearChanges]);\r\n\r\n  return {\r\n    // Payment state\r\n    payments,\r\n    pendingChanges,\r\n    hasChanges,\r\n    \r\n    // Payment methods\r\n    createInstallmentPayment,\r\n    updateInstallmentPayment,\r\n    deleteInstallmentPayment,\r\n    addPaymentChange,\r\n    clearChanges,\r\n    getModifiedPayments,\r\n    processPendingPaymentChanges,\r\n  };\r\n};"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;;AAMO,MAAM,uBAAuB,CAAC,EAAE,aAAa,EAA6B;;IAC/E,MAAM,EACJ,QAAQ,EACR,eAAe,wBAAwB,EACvC,eAAe,wBAAwB,EACvC,eAAe,wBAAwB,EACxC,GAAG,IAAA,mKAAsB,EAAC;IAE3B,MAAM,EACJ,cAAc,EACd,gBAAgB,EAChB,YAAY,EACZ,mBAAmB,EACnB,UAAU,EACX,GAAG,IAAA,mKAAsB;IAE1B,MAAM,+BAA+B,IAAA,4KAAW;0EAAC;YAC/C,KAAK,MAAM,UAAU,eAAgB;gBACnC,IAAI,OAAO,IAAI,KAAK,UAAU;oBAC5B,MAAM,yBAAyB,OAAO,EAAE,EAAE,OAAO,WAAW;gBAC9D,OAAO,IAAI,OAAO,IAAI,KAAK,UAAU;oBACnC,MAAM,yBAAyB,OAAO,EAAE;gBAC1C;YACF;YACA;QACF;yEAAG;QAAC;QAAgB;QAA0B;QAA0B;KAAa;IAErF,OAAO;QACL,gBAAgB;QAChB;QACA;QACA;QAEA,kBAAkB;QAClB;QACA;QACA;QACA;QACA;QACA;QACA;IACF;AACF;GA1Ca;;QAMP,mKAAsB;QAQtB,mKAAsB"}},
    {"offset": {"line": 3223, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useSaleFormLogic.ts"],"sourcesContent":["import { useCallback } from 'react';\r\nimport { useFormState } from './sale-form/useFormState';\r\nimport { useFormHandlers } from './sale-form/useFormHandlers';\r\nimport { useItemManagement } from './sale-form/useItemManagement';\r\nimport { useCustomerSelection } from './sale-form/useCustomerSelection';\r\nimport { useFormValidation } from './sale-form/useFormValidation';\r\nimport { useFormCalculations } from './sale-form/useFormCalculations';\r\nimport { usePaymentOperations } from './sale-form/usePaymentOperations';\r\n\r\ninterface UseSaleFormLogicProps {\r\n  initialData?: any;\r\n  defaultPaymentStatus: string;\r\n  cashAccounts: any[];\r\n}\r\n\r\nexport const useSaleFormLogic = ({\r\n  initialData,\r\n  defaultPaymentStatus,\r\n  cashAccounts\r\n}: UseSaleFormLogicProps) => {\r\n  // Form state management\r\n  const {\r\n    formData,\r\n    errors,\r\n    taxRateInput,\r\n    printAfterSave,\r\n    thermalPrintAfterSave,\r\n    includePaymentInfo,\r\n    selectedCustomerCategoryId,\r\n    paymentDate,\r\n    linkToCash,\r\n    selectedCashAccountId,\r\n    cashTransactionId,\r\n    originalPaymentStatus,\r\n    formRecentlyCleared,\r\n    setFormData,\r\n    setErrors,\r\n    setTaxRateInput,\r\n    setPrintAfterSave,\r\n    setThermalPrintAfterSave,\r\n    setIncludePaymentInfo,\r\n    setSelectedCustomerCategoryId,\r\n    setPaymentDate,\r\n    setLinkToCash,\r\n    setSelectedCashAccountId,\r\n    setCashTransactionId,\r\n    setOriginalPaymentStatus,\r\n    setFormRecentlyCleared,\r\n    clearFormState,\r\n  } = useFormState({ initialData, defaultPaymentStatus });\r\n\r\n  // Form handlers\r\n  const {\r\n    handleChange,\r\n    handleSelectChange,\r\n    handleAmountPaidChange,\r\n    handlePaymentDateChange,\r\n  } = useFormHandlers({\r\n    formData,\r\n    setFormData,\r\n    errors,\r\n    setErrors,\r\n    setTaxRateInput,\r\n    setLinkToCash,\r\n  });\r\n\r\n  // Item management\r\n  const {\r\n    handleAddItem,\r\n    handleAddItemWithProduct,\r\n    handleUpdateItem,\r\n    handleRemoveItem,\r\n  } = useItemManagement({ formData, setFormData });\r\n\r\n  // Customer selection\r\n  const {\r\n    handleSelectCustomer,\r\n    handleCategoryChange,\r\n  } = useCustomerSelection({\r\n    setFormData,\r\n    setSelectedCustomerCategoryId,\r\n  });\r\n\r\n  // Form validation\r\n  const { validateForm } = useFormValidation({\r\n    formData,\r\n    linkToCash,\r\n    selectedCashAccountId,\r\n    initialData,\r\n    formRecentlyCleared,\r\n    setErrors,\r\n  });\r\n\r\n  // Calculations\r\n  const {\r\n    calculateTotalAmount,\r\n    calculateTaxAmount,\r\n  } = useFormCalculations({ taxRate: formData.taxRate });\r\n\r\n  // Payment operations\r\n  const {\r\n    payments,\r\n    pendingChanges,\r\n    hasChanges,\r\n    createInstallmentPayment,\r\n    updateInstallmentPayment,\r\n    deleteInstallmentPayment,\r\n    addPaymentChange,\r\n    clearChanges,\r\n    getModifiedPayments,\r\n    processPendingPaymentChanges,\r\n  } = usePaymentOperations({ initialDataId: initialData?.id });\r\n\r\n  // Enhanced payment date change handler\r\n  const handlePaymentDateChangeEnhanced = useCallback((date: Date) => {\r\n    setPaymentDate(date);\r\n  }, [setPaymentDate]);\r\n\r\n  // Enhanced clear form that can reset date and draft\r\n  const clearForm = useCallback((onDateReset?: () => void, onDraftClear?: () => void) => {\r\n    clearFormState(onDateReset);\r\n    clearChanges();\r\n    if (onDraftClear) {\r\n      onDraftClear();\r\n    }\r\n  }, [clearFormState, clearChanges]);\r\n\r\n  // Enhanced handlers that reset the formRecentlyCleared flag\r\n  const handleChangeEnhanced = useCallback((e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {\r\n    if (formRecentlyCleared) {\r\n      setFormRecentlyCleared(false);\r\n    }\r\n    handleChange(e);\r\n  }, [formRecentlyCleared, setFormRecentlyCleared, handleChange]);\r\n\r\n  const handleSelectChangeEnhanced = useCallback((value: string) => {\r\n    if (formRecentlyCleared) {\r\n      setFormRecentlyCleared(false);\r\n    }\r\n    handleSelectChange(value);\r\n  }, [formRecentlyCleared, setFormRecentlyCleared, handleSelectChange]);\r\n\r\n  // Enhanced item handlers that reset the formRecentlyCleared flag\r\n  const handleAddItemEnhanced = useCallback((product?: any) => {\r\n    if (formRecentlyCleared) {\r\n      setFormRecentlyCleared(false);\r\n    }\r\n\r\n    // Check if product is actually an event (from onClick) or a valid product object\r\n    // Events have 'type' or 'target' properties, products have 'id' or 'name'\r\n    const isEvent = product && (product.nativeEvent || product.preventDefault || product.stopPropagation || (product.type && product.target));\r\n\r\n    if (product && !isEvent) {\r\n      handleAddItemWithProduct(product);\r\n    } else {\r\n      handleAddItem();\r\n    }\r\n  }, [formRecentlyCleared, setFormRecentlyCleared, handleAddItem, handleAddItemWithProduct]);\r\n\r\n  const handleUpdateItemEnhanced = useCallback((index: number, updatedItem: any) => {\r\n    if (formRecentlyCleared) {\r\n      setFormRecentlyCleared(false);\r\n    }\r\n    handleUpdateItem(index, updatedItem);\r\n  }, [formRecentlyCleared, setFormRecentlyCleared, handleUpdateItem]);\r\n\r\n  const handleRemoveItemEnhanced = useCallback((index: number) => {\r\n    if (formRecentlyCleared) {\r\n      setFormRecentlyCleared(false);\r\n    }\r\n    handleRemoveItem(index);\r\n  }, [formRecentlyCleared, setFormRecentlyCleared, handleRemoveItem]);\r\n\r\n  // Enhanced customer handlers that reset the formRecentlyCleared flag\r\n  const handleSelectCustomerEnhanced = useCallback((customer: any) => {\r\n    if (formRecentlyCleared) {\r\n      setFormRecentlyCleared(false);\r\n    }\r\n    handleSelectCustomer(customer);\r\n  }, [formRecentlyCleared, setFormRecentlyCleared, handleSelectCustomer]);\r\n\r\n  const handleCategoryChangeEnhanced = useCallback((categoryId: string) => {\r\n    if (formRecentlyCleared) {\r\n      setFormRecentlyCleared(false);\r\n    }\r\n    handleCategoryChange(categoryId);\r\n  }, [formRecentlyCleared, setFormRecentlyCleared, handleCategoryChange]);\r\n\r\n  // Sales category change handler\r\n  const handleSalesCategoryChange = useCallback((categoryId: string) => {\r\n    if (formRecentlyCleared) {\r\n      setFormRecentlyCleared(false);\r\n    }\r\n    setFormData(prev => ({ ...prev, categoryId }));\r\n  }, [formRecentlyCleared, setFormRecentlyCleared, setFormData]);\r\n\r\n  return {\r\n    // State\r\n    formData,\r\n    errors,\r\n    taxRateInput,\r\n    printAfterSave,\r\n    thermalPrintAfterSave,\r\n    includePaymentInfo,\r\n    selectedCustomerCategoryId,\r\n    paymentDate,\r\n    linkToCash,\r\n    selectedCashAccountId,\r\n    cashTransactionId,\r\n    originalPaymentStatus,\r\n    formRecentlyCleared,\r\n    payments,\r\n    pendingChanges,\r\n    hasChanges,\r\n\r\n    // Setters\r\n    setFormData,\r\n    setTaxRateInput,\r\n    setPrintAfterSave,\r\n    setThermalPrintAfterSave,\r\n    setIncludePaymentInfo,\r\n    setLinkToCash,\r\n    setSelectedCashAccountId,\r\n    setCashTransactionId,\r\n    setOriginalPaymentStatus,\r\n\r\n    // Handlers\r\n    handleChange: handleChangeEnhanced,\r\n    handleSelectChange: handleSelectChangeEnhanced,\r\n    handleAddItem: handleAddItemEnhanced,\r\n    handleUpdateItem: handleUpdateItemEnhanced,\r\n    handleRemoveItem: handleRemoveItemEnhanced,\r\n    handleSelectCustomer: handleSelectCustomerEnhanced,\r\n    handleCategoryChange: handleCategoryChangeEnhanced,\r\n    handleSalesCategoryChange,\r\n    handleAmountPaidChange,\r\n    handlePaymentDateChange: handlePaymentDateChangeEnhanced,\r\n    clearForm,\r\n\r\n    // Utils\r\n    calculateTotalAmount,\r\n    calculateTaxAmount,\r\n    validateForm,\r\n    processPendingPaymentChanges,\r\n\r\n    // Payment methods\r\n    createInstallmentPayment,\r\n    updateInstallmentPayment,\r\n    deleteInstallmentPayment,\r\n    addPaymentChange,\r\n    clearChanges,\r\n    getModifiedPayments,\r\n  };\r\n};"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3493, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useCashTransactions.ts"],"sourcesContent":["import { useState, useEffect, useMemo, useCallback } from 'react';\r\nimport { useAuth } from '@/components/auth/AuthProvider';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\r\nimport {\r\n  CashTransaction,\r\n  DbCashTransaction,\r\n  CashTransactionFormData,\r\n  DailyCashSummary,\r\n  mapDbCashTransactionToCashTransaction\r\n} from '@/types/cash';\r\nimport {\r\n  getCashTransactionsAction,\r\n  createCashTransactionAction,\r\n  updateCashTransactionAction,\r\n  deleteCashTransactionAction,\r\n  getAccountOpeningBalanceAction,\r\n  createBulkCashTransactionsAction\r\n} from '@/app/actions/finance';\r\n\r\nexport const useCashTransactions = (accountId?: string) => {\r\n  const { user } = useAuth();\r\n  const { currentBusiness } = useBusiness();\r\n  const { toast } = useToast();\r\n  const queryClient = useQueryClient();\r\n\r\n  const loadTransactions = useCallback(async (): Promise<CashTransaction[]> => {\r\n    try {\r\n      if (!user || !currentBusiness) {\r\n        return [];\r\n      }\r\n\r\n      const result = await getCashTransactionsAction(currentBusiness.id, accountId);\r\n\r\n      if (!result.success || !result.data) {\r\n        throw new Error(result.error || 'Failed to fetch transactions');\r\n      }\r\n\r\n      // Format all transactions\r\n      const formattedTransactions = result.data.map((item: any) => {\r\n        const dbTransaction: DbCashTransaction = {\r\n          id: item.id,\r\n          user_id: item.user_id,\r\n          account_id: item.account_id,\r\n          amount: Number(item.amount),\r\n          transaction_type: item.transaction_type,\r\n          category: item.category,\r\n          description: item.description,\r\n          person_in_charge: item.person_in_charge,\r\n          tags: item.tags,\r\n          date: item.date,\r\n          payment_method: item.payment_method,\r\n          receipt_image: item.receipt_image,\r\n          created_at: item.created_at,\r\n          updated_at: item.updated_at\r\n        };\r\n        return mapDbCashTransactionToCashTransaction(dbTransaction);\r\n      });\r\n\r\n      // Sort\r\n      formattedTransactions.sort((a, b) => {\r\n        const dateCompare = new Date(b.date).getTime() - new Date(a.date).getTime();\r\n        if (dateCompare !== 0) return dateCompare;\r\n        return new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime();\r\n      });\r\n\r\n      return formattedTransactions;\r\n    } catch (error) {\r\n      console.error('Error loading cash transactions:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to load cash transactions\",\r\n        variant: \"destructive\"\r\n      });\r\n      return [];\r\n    }\r\n  }, [user, currentBusiness?.id, accountId, toast]);\r\n\r\n  const queryKey = useMemo(() => ['cash_transactions', currentBusiness?.id, user?.id, accountId], [currentBusiness?.id, user?.id, accountId]);\r\n\r\n  const { data: transactions = [], isLoading: isQueryLoading } = useQuery({\r\n    queryKey,\r\n    queryFn: loadTransactions,\r\n    enabled: !!user && !!currentBusiness?.id,\r\n    staleTime: 30_000,\r\n  });\r\n\r\n  const isLoading = isQueryLoading && transactions.length === 0;\r\n\r\n  const createTransaction = async (transactionData: CashTransactionFormData) => {\r\n    try {\r\n      if (!user || !currentBusiness) throw new Error('User not authenticated');\r\n\r\n      const result = await createCashTransactionAction({\r\n        ...transactionData,\r\n        userId: user.id,\r\n        locationId: currentBusiness.id\r\n      });\r\n\r\n      if (!result.success) throw new Error(result.error);\r\n\r\n      toast({\r\n        title: \"Success\",\r\n        description: transactionData.transactionType === 'transfer'\r\n          ? \"Transfer completed successfully\"\r\n          : \"Cash transaction created successfully\"\r\n      });\r\n\r\n      queryClient.invalidateQueries({ queryKey });\r\n\r\n      return Array.isArray(result.data)\r\n        ? mapDbCashTransactionToCashTransaction(result.data[0])\r\n        : mapDbCashTransactionToCashTransaction(result.data as any);\r\n    } catch (error) {\r\n      console.error('Error creating cash transaction:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to create cash transaction\",\r\n        variant: \"destructive\"\r\n      });\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  const createBulkTransactions = async (transactionsData: CashTransactionFormData[]) => {\r\n    try {\r\n      if (!user || !currentBusiness) throw new Error('User not authenticated');\r\n\r\n      const payloads = transactionsData.map(t => ({\r\n        ...t,\r\n        userId: user.id,\r\n        locationId: currentBusiness.id\r\n      }));\r\n\r\n      const result = await createBulkCashTransactionsAction(payloads);\r\n\r\n      if (!result.success) throw new Error(result.error);\r\n\r\n      toast({\r\n        title: \"Success\",\r\n        description: `Successfully created ${transactionsData.length} transactions`\r\n      });\r\n\r\n      queryClient.invalidateQueries({ queryKey });\r\n      return (result.data as any[]).map((item: any) => mapDbCashTransactionToCashTransaction(item));\r\n    } catch (error) {\r\n      console.error('Error creating bulk transactions:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to create bulk transactions\",\r\n        variant: \"destructive\"\r\n      });\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  const updateTransaction = async (id: string, updates: Partial<CashTransactionFormData>) => {\r\n    try {\r\n      const result = await updateCashTransactionAction(id, updates);\r\n      if (!result.success) throw new Error(result.error);\r\n\r\n      toast({\r\n        title: \"Success\",\r\n        description: \"Transaction updated successfully\"\r\n      });\r\n\r\n      queryClient.invalidateQueries({ queryKey });\r\n      return mapDbCashTransactionToCashTransaction(result.data as any);\r\n    } catch (error) {\r\n      console.error('Error updating cash transaction:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to update transaction\",\r\n        variant: \"destructive\"\r\n      });\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const deleteTransaction = async (id: string, onDeleted?: () => void) => {\r\n    try {\r\n      if (!currentBusiness) throw new Error('No business selected');\r\n      const result = await deleteCashTransactionAction(id, currentBusiness.id);\r\n      if (!result.success) throw new Error(result.error);\r\n\r\n      toast({\r\n        title: \"Success\",\r\n        description: \"Cash transaction deleted successfully\"\r\n      });\r\n\r\n      queryClient.invalidateQueries({ queryKey });\r\n      if (onDeleted) onDeleted();\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error deleting cash transaction:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to delete cash transaction\",\r\n        variant: \"destructive\"\r\n      });\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const getAccountOpeningBalance = useCallback(async (accountId: string): Promise<number> => {\r\n    try {\r\n      if (!currentBusiness) return 0;\r\n      const result = await getAccountOpeningBalanceAction(accountId, currentBusiness.id);\r\n      return result.success ? result.data : 0;\r\n    } catch (error) {\r\n      return 0;\r\n    }\r\n  }, [currentBusiness?.id]);\r\n\r\n  const getDailySummary = useCallback(async (date: Date, accountId?: string): Promise<DailyCashSummary> => {\r\n    const dateStr = date.toISOString().split('T')[0];\r\n\r\n    let filteredTransactions = transactions.filter(t =>\r\n      t.date.toISOString().split('T')[0] === dateStr\r\n    );\r\n\r\n    if (accountId) {\r\n      filteredTransactions = filteredTransactions.filter(t => t.accountId === accountId);\r\n    }\r\n\r\n    const cashIn = filteredTransactions\r\n      .filter(t => t.transactionType === 'cash_in' || t.transactionType === 'transfer_in')\r\n      .reduce((sum, t) => sum + t.amount, 0);\r\n\r\n    const cashOut = filteredTransactions\r\n      .filter(t => t.transactionType === 'cash_out' || t.transactionType === 'transfer_out')\r\n      .reduce((sum, t) => sum + t.amount, 0);\r\n\r\n    const transfersIn = filteredTransactions\r\n      .filter(t => t.transactionType === 'transfer_in')\r\n      .reduce((sum, t) => sum + t.amount, 0);\r\n\r\n    const transfersOut = filteredTransactions\r\n      .filter(t => t.transactionType === 'transfer_out')\r\n      .reduce((sum, t) => sum + t.amount, 0);\r\n\r\n    const yesterday = new Date(date);\r\n    yesterday.setDate(yesterday.getDate() - 1);\r\n    const yesterdayStr = yesterday.toISOString().split('T')[0];\r\n\r\n    let yesterdayTransactions = transactions.filter(t =>\r\n      t.date.toISOString().split('T')[0] <= yesterdayStr\r\n    );\r\n\r\n    if (accountId) {\r\n      yesterdayTransactions = yesterdayTransactions.filter(t => t.accountId === accountId);\r\n    }\r\n\r\n    const yesterdayCashIn = yesterdayTransactions\r\n      .filter(t => t.transactionType === 'cash_in' || t.transactionType === 'transfer_in')\r\n      .reduce((sum, t) => sum + t.amount, 0);\r\n\r\n    const yesterdayCashOut = yesterdayTransactions\r\n      .filter(t => t.transactionType === 'cash_out' || t.transactionType === 'transfer_out')\r\n      .reduce((sum, t) => sum + t.amount, 0);\r\n\r\n    let accountOpeningBalance = 0;\r\n    if (accountId) {\r\n      accountOpeningBalance = await getAccountOpeningBalance(accountId);\r\n    }\r\n\r\n    const openingBalance = accountOpeningBalance + yesterdayCashIn - yesterdayCashOut;\r\n    const closingBalance = openingBalance + cashIn - cashOut;\r\n\r\n    return {\r\n      date,\r\n      openingBalance,\r\n      cashIn,\r\n      cashOut,\r\n      transfersIn,\r\n      transfersOut,\r\n      closingBalance\r\n    };\r\n  }, [transactions, getAccountOpeningBalance]);\r\n\r\n  const getDateRangeSummary = useCallback(async (startDate: Date, endDate: Date, accountId?: string): Promise<DailyCashSummary> => {\r\n    const startDateStr = startDate.toISOString().split('T')[0];\r\n    const endDateStr = endDate.toISOString().split('T')[0];\r\n\r\n    let filteredTransactions = transactions.filter(t => {\r\n      const transactionDateStr = t.date.toISOString().split('T')[0];\r\n      return transactionDateStr >= startDateStr && transactionDateStr <= endDateStr;\r\n    });\r\n\r\n    if (accountId) {\r\n      filteredTransactions = filteredTransactions.filter(t => t.accountId === accountId);\r\n    }\r\n\r\n    const cashIn = filteredTransactions\r\n      .filter(t => t.transactionType === 'cash_in' || t.transactionType === 'transfer_in')\r\n      .reduce((sum, t) => sum + t.amount, 0);\r\n\r\n    const cashOut = filteredTransactions\r\n      .filter(t => t.transactionType === 'cash_out' || t.transactionType === 'transfer_out')\r\n      .reduce((sum, t) => sum + t.amount, 0);\r\n\r\n    const transfersIn = filteredTransactions\r\n      .filter(t => t.transactionType === 'transfer_in')\r\n      .reduce((sum, t) => sum + t.amount, 0);\r\n\r\n    const transfersOut = filteredTransactions\r\n      .filter(t => t.transactionType === 'transfer_out')\r\n      .reduce((sum, t) => sum + t.amount, 0);\r\n\r\n    const dayBeforeStart = new Date(startDate);\r\n    dayBeforeStart.setDate(dayBeforeStart.getDate() - 1);\r\n    const dayBeforeStartStr = dayBeforeStart.toISOString().split('T')[0];\r\n\r\n    let transactionsBeforeRange = transactions.filter(t =>\r\n      t.date.toISOString().split('T')[0] <= dayBeforeStartStr\r\n    );\r\n\r\n    if (accountId) {\r\n      transactionsBeforeRange = transactionsBeforeRange.filter(t => t.accountId === accountId);\r\n    }\r\n\r\n    const cashInBeforeRange = transactionsBeforeRange\r\n      .filter(t => t.transactionType === 'cash_in' || t.transactionType === 'transfer_in')\r\n      .reduce((sum, t) => sum + t.amount, 0);\r\n\r\n    const cashOutBeforeRange = transactionsBeforeRange\r\n      .filter(t => t.transactionType === 'cash_out' || t.transactionType === 'transfer_out')\r\n      .reduce((sum, t) => sum + t.amount, 0);\r\n\r\n    let accountOpeningBalance = 0;\r\n    if (accountId) {\r\n      accountOpeningBalance = await getAccountOpeningBalance(accountId);\r\n    }\r\n\r\n    const openingBalance = accountOpeningBalance + cashInBeforeRange - cashOutBeforeRange;\r\n    const closingBalance = openingBalance + cashIn - cashOut;\r\n\r\n    return {\r\n      date: startDate,\r\n      openingBalance,\r\n      cashIn,\r\n      cashOut,\r\n      transfersIn,\r\n      transfersOut,\r\n      closingBalance\r\n    };\r\n  }, [transactions, getAccountOpeningBalance]);\r\n\r\n  const refreshTransactions = useCallback(() => {\r\n    queryClient.invalidateQueries({ queryKey });\r\n  }, [queryClient, queryKey]);\r\n\r\n  return useMemo(() => ({\r\n    transactions,\r\n    isLoading,\r\n    createTransaction,\r\n    createBulkTransactions,\r\n    updateTransaction,\r\n    deleteTransaction,\r\n    getDailySummary,\r\n    getDateRangeSummary,\r\n    refreshTransactions\r\n  }), [transactions, isLoading, createTransaction, createBulkTransactions, updateTransaction, deleteTransaction, getDailySummary, getDateRangeSummary, refreshTransactions]);\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3912, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useCashTransactionOperations.ts"],"sourcesContent":["import { useCallback } from 'react';\r\nimport { toast } from 'sonner';\r\nimport { useCashTransactions } from '@/hooks/useCashTransactions';\r\nimport { findCashTransactionAction } from '@/app/actions/finance';\r\n\r\nexport const useCashTransactionOperations = () => {\r\n  const {\r\n    createTransaction: createCashTransaction,\r\n    updateTransaction: updateCashTransaction,\r\n    deleteTransaction: deleteCashTransaction\r\n  } = useCashTransactions();\r\n\r\n  const createCashTransactionForSale = useCallback(async (\r\n    sale: any,\r\n    amount: number,\r\n    linkToCash: boolean,\r\n    selectedCashAccountId: string,\r\n    selectedDate: Date,\r\n    paymentStatus: string\r\n  ) => {\r\n    if (!linkToCash || !selectedCashAccountId || paymentStatus !== 'Paid') {\r\n      return null;\r\n    }\r\n\r\n    try {\r\n      const description = `Sale to ${sale.customerName || sale.customer_name || 'Customer'} - Receipt #${sale.receiptNumber || sale.receipt_number || 'N/A'}`;\r\n\r\n      const cashTransaction = await createCashTransaction({\r\n        accountId: selectedCashAccountId,\r\n        amount: amount,\r\n        transactionType: 'cash_in',\r\n        category: 'Cash sale',\r\n        description: description,\r\n        date: selectedDate,\r\n        personInCharge: '',\r\n        tags: [],\r\n        paymentMethod: '',\r\n        receiptImage: ''\r\n      });\r\n\r\n      return cashTransaction?.id || null;\r\n    } catch (error) {\r\n      console.error('Error creating cash transaction:', error);\r\n      toast.error('Failed to create cash transaction');\r\n      return null;\r\n    }\r\n  }, [createCashTransaction]);\r\n\r\n  const updateCashTransactionForSale = useCallback(async (\r\n    sale: any,\r\n    amount: number,\r\n    cashTransactionId: string | null,\r\n    originalPaymentStatus: string,\r\n    paymentStatus: string,\r\n    linkToCash: boolean,\r\n    selectedCashAccountId: string,\r\n    selectedDate: Date\r\n  ) => {\r\n    try {\r\n      const description = `Sale to ${sale.customerName || sale.customer_name || 'Customer'} - Receipt #${sale.receiptNumber || sale.receipt_number || 'N/A'}`;\r\n\r\n      const validCashAccountId = selectedCashAccountId && selectedCashAccountId.trim() !== '';\r\n\r\n      if (!cashTransactionId && linkToCash && paymentStatus === 'Paid' && validCashAccountId) {\r\n        const cashTransaction = await createCashTransaction({\r\n          accountId: selectedCashAccountId,\r\n          amount: amount,\r\n          transactionType: 'cash_in',\r\n          category: 'Cash sale',\r\n          description: description,\r\n          date: selectedDate,\r\n          personInCharge: '',\r\n          tags: [],\r\n          paymentMethod: '',\r\n          receiptImage: ''\r\n        });\r\n        return cashTransaction?.id || null;\r\n      }\r\n\r\n      if (!cashTransactionId) {\r\n        return null;\r\n      }\r\n\r\n      if (originalPaymentStatus === 'Paid' && paymentStatus === 'Installment Sale') {\r\n        await deleteCashTransaction(cashTransactionId);\r\n        return null;\r\n      }\r\n\r\n      if (linkToCash && paymentStatus === 'Paid' && validCashAccountId) {\r\n        await updateCashTransaction(cashTransactionId, {\r\n          amount: amount,\r\n          category: 'Cash sale',\r\n          description: description,\r\n          date: selectedDate\r\n        });\r\n        return cashTransactionId;\r\n      } else {\r\n        await deleteCashTransaction(cashTransactionId);\r\n        return null;\r\n      }\r\n    } catch (error) {\r\n      console.error('Error updating cash transaction:', error);\r\n      toast.error('Failed to update cash transaction');\r\n      return cashTransactionId;\r\n    }\r\n  }, [createCashTransaction, updateCashTransaction, deleteCashTransaction]);\r\n\r\n  const createInstallmentPaymentWithCash = useCallback(async (\r\n    saleId: string,\r\n    amount: number,\r\n    saleDescription: string,\r\n    linkToCash: boolean,\r\n    selectedCashAccountId: string,\r\n    locationId: string,\r\n    createInstallmentPayment: any\r\n  ) => {\r\n    if (amount <= 0) {\r\n      return null;\r\n    }\r\n\r\n    if (!linkToCash || !selectedCashAccountId) {\r\n      return await createInstallmentPayment({\r\n        saleId,\r\n        amount\r\n      });\r\n    }\r\n\r\n    return await createInstallmentPayment({\r\n      saleId,\r\n      amount,\r\n      accountId: selectedCashAccountId,\r\n      locationId,\r\n      date: new Date()\r\n    });\r\n  }, []);\r\n\r\n  const findCashTransactionForSale = useCallback(async (cashTransactionId: string) => {\r\n    try {\r\n      const result = await findCashTransactionAction(cashTransactionId);\r\n      if (result.success && result.data) {\r\n        return result.data.accountId;\r\n      }\r\n    } catch (error) {\r\n      console.error('Error finding cash transaction:', error);\r\n    }\r\n    return null;\r\n  }, []);\r\n\r\n  return {\r\n    createCashTransactionForSale,\r\n    updateCashTransactionForSale,\r\n    createInstallmentPaymentWithCash,\r\n    findCashTransactionForSale,\r\n  };\r\n};"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4059, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useStockHistory.ts"],"sourcesContent":["\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport { StockHistoryEntry } from '@/types';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\nimport {\r\n  getStockHistoryAction,\r\n  createStockHistoryAction,\r\n  recalculateStockChainAction,\r\n  deleteStockHistoryEntriesByReferenceAction,\r\n  updateStockHistoryDatesByReferenceAction,\r\n  repairStockChainsAction,\r\n  getStockRepairsPreviewAction\r\n} from '@/app/actions/inventory';\r\nimport { useAuth } from '@/components/auth/AuthProvider';\r\n\r\nexport interface ChainRepairBreakEntry {\r\n  entryId: string;\r\n  createdAt: string;\r\n  changeReason: string;\r\n  currentPrevQty: number;\r\n  currentNewQty: number;\r\n  fixedPrevQty: number;\r\n  fixedNewQty: number;\r\n}\r\n\r\nexport interface ChainRepairPreview {\r\n  productId: string;\r\n  productName: string;\r\n  totalEntries: number;\r\n  brokenEntries: ChainRepairBreakEntry[];\r\n  finalFixedQty: number;\r\n  currentProductQty: number;\r\n}\r\n\r\nexport const useStockHistory = (userId: string | undefined, productId?: string) => {\r\n  const [stockHistory, setStockHistory] = useState<StockHistoryEntry[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const { currentBusiness } = useBusiness();\r\n\r\n  const loadStockHistory = useCallback(async () => {\r\n    if (!userId || !currentBusiness) {\r\n      setStockHistory([]);\r\n      setIsLoading(false);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setIsLoading(true);\r\n      const result = await getStockHistoryAction(currentBusiness.id, productId);\r\n\r\n      if (!result.success || !result.data) {\r\n        throw new Error(result.error || 'Failed to fetch stock history');\r\n      }\r\n\r\n      const formattedHistory: StockHistoryEntry[] = result.data.map((entry: any) => ({\r\n        id: entry.id,\r\n        productId: entry.productId,\r\n        oldQuantity: entry.oldQuantity,\r\n        newQuantity: entry.newQuantity,\r\n        changeReason: entry.changeReason,\r\n        createdAt: new Date(entry.createdAt),\r\n        referenceId: entry.referenceId,\r\n        receiptNumber: entry.receiptNumber,\r\n        product: entry.product\r\n      }));\r\n\r\n      setStockHistory(formattedHistory);\r\n    } catch (error) {\r\n      console.error('Error loading stock history:', error);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, [userId, currentBusiness?.id, productId]);\r\n\r\n  useEffect(() => {\r\n    loadStockHistory();\r\n  }, [loadStockHistory]);\r\n\r\n  const createStockHistoryEntry = async (\r\n    targetProductId: string,\r\n    previousQuantity: number,\r\n    newQuantity: number,\r\n    reason: string,\r\n    referenceId?: string,\r\n    entryDate?: Date,\r\n    receiptNumber?: string,\r\n    productName?: string\r\n  ) => {\r\n    try {\r\n      if (!userId || !currentBusiness) return false;\r\n\r\n      const snapshottedReason = productName\r\n        ? `[${productName}] | ${reason}`\r\n        : reason;\r\n\r\n      const result = await createStockHistoryAction({\r\n        userId,\r\n        locationId: currentBusiness.id,\r\n        productId: targetProductId,\r\n        previousQuantity,\r\n        newQuantity,\r\n        changeReason: snapshottedReason,\r\n        referenceId,\r\n        receiptNumber,\r\n        createdAt: entryDate?.toISOString()\r\n      });\r\n\r\n      if (!result.success) {\r\n        console.error('Error creating stock history entry:', result.error);\r\n        return false;\r\n      }\r\n\r\n      await loadStockHistory();\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error creating stock history:', error);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const deleteMultipleStockHistoryEntriesByReference = async (referenceId: string) => {\r\n    try {\r\n      if (!currentBusiness) return false;\r\n      const result = await deleteStockHistoryEntriesByReferenceAction(referenceId, currentBusiness.id);\r\n      if (!result.success) throw new Error(result.error);\r\n\r\n      await loadStockHistory();\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error deleting stock history entries:', error);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const recalculateStockChain = async (targetProductId: string) => {\r\n    try {\r\n      if (!currentBusiness) return false;\r\n      const result = await recalculateStockChainAction(targetProductId, currentBusiness.id);\r\n      if (!result.success) throw new Error(result.error);\r\n\r\n      await loadStockHistory();\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error recalculating stock chain:', error);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const updateStockHistoryDatesBySaleId = async (saleId: string, newDate: Date) => {\r\n    try {\r\n      if (!currentBusiness) return false;\r\n      const result = await updateStockHistoryDatesByReferenceAction(saleId, currentBusiness.id, newDate.toISOString());\r\n      if (!result.success) throw new Error(result.error);\r\n\r\n      await loadStockHistory();\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error updating stock history dates:', error);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const repairAllStockChains = async (progressCallback?: (current: number, total: number) => void) => {\r\n    try {\r\n      if (!currentBusiness) return { repaired: 0, failed: 0 };\r\n      const result = await repairStockChainsAction(currentBusiness.id);\r\n      if (result.success && result.data) return result.data;\r\n      return { repaired: 0, failed: 0 };\r\n    } catch (error) {\r\n      console.error('Error repairing all chains:', error);\r\n      return { repaired: 0, failed: 0 };\r\n    }\r\n  }\r\n\r\n  const previewStockChainRepairs = async (progressCallback?: (current: number, total: number) => void) => {\r\n    try {\r\n      if (!currentBusiness) return [];\r\n      const result = await getStockRepairsPreviewAction(currentBusiness.id);\r\n      if (result.success && result.data) return result.data;\r\n      return [];\r\n    } catch (error) {\r\n      console.error('Error previewing repairs:', error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  return {\r\n    stockHistory,\r\n    isLoading,\r\n    createStockHistoryEntry,\r\n    deleteMultipleStockHistoryEntriesByReference,\r\n    recalculateStockChain,\r\n    updateStockHistoryDatesBySaleId,\r\n    repairAllStockChains,\r\n    previewStockChainRepairs,\r\n    refreshHistory: loadStockHistory\r\n  };\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4243, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useMessages.ts"],"sourcesContent":["// hooks/useMessages.ts\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\nimport { useProfiles } from '@/contexts/ProfileContext';\r\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\r\nimport { toast } from '@/hooks/use-toast';\r\nimport {\r\n  getMessagesAction,\r\n  createMessageAction,\r\n  getMessageTemplatesAction,\r\n  createMessageTemplateAction,\r\n  updateMessageTemplateAction,\r\n  deleteMessageTemplateAction\r\n} from '@/app/actions/messaging';\r\n\r\nexport interface Message {\r\n  id: string;\r\n  userId: string;\r\n  locationId: string;\r\n  profileId?: string;\r\n  customerId?: string;\r\n  phoneNumber: string;\r\n  content: string;\r\n  status: 'pending' | 'sent' | 'delivered' | 'failed';\r\n  smsCreditsUsed: number;\r\n  templateId?: string;\r\n  errorMessage?: string;\r\n  sentAt?: string;\r\n  deliveredAt?: string;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n  metadata?: any;\r\n}\r\n\r\nexport interface MessageTemplate {\r\n  id: string;\r\n  userId: string;\r\n  locationId: string;\r\n  name: string;\r\n  content: string;\r\n  category: string | null;\r\n  variables: string[];\r\n  isDefault: boolean;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n}\r\n\r\nexport interface Purchase {\r\n  id: string;\r\n  userId: string;\r\n  locationId: string;\r\n  profileId?: string;\r\n  creditsAmount: number;\r\n  totalCost: number;\r\n  paymentPhoneNumber: string;\r\n  paymentStatus: string;\r\n  pesapalTrackingId?: string;\r\n  pesapalMerchantReference?: string;\r\n  pesapalRedirectUrl?: string;\r\n  paymentMethod?: string;\r\n  paymentCompletedAt?: string;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n}\r\n\r\nconst formatPhoneNumber = (phone: string) => {\r\n  let cleaned = phone.replace(/[\\s\\-\\(\\)]/g, '');\r\n  if (cleaned.startsWith('+')) return cleaned;\r\n  if (cleaned.startsWith('256')) return '+' + cleaned;\r\n  if (cleaned.startsWith('0')) return '+256' + cleaned.substring(1);\r\n  if (cleaned.length === 9 && cleaned.match(/^[7]\\d{8}$/)) return '+256' + cleaned;\r\n  return '+256' + cleaned;\r\n};\r\n\r\nexport const useMessages = (userId?: string) => {\r\n  const [messages, setMessages] = useState<Message[]>([]);\r\n  const [templates, setTemplates] = useState<any[]>([]);\r\n  const [purchases, setPurchases] = useState<Purchase[]>([]);\r\n  const [liveCredits, setLiveCredits] = useState<number>(0);\r\n\r\n  const { currentBusiness } = useBusiness();\r\n  const { currentProfile } = useProfiles();\r\n  const queryClient = useQueryClient();\r\n\r\n  const fetchLiveCredits = async () => {\r\n    // In our new system, credits might be on the user or profile model\r\n    // but for now we simplify by using currentProfile state if it's already refactored\r\n    if (currentProfile?.sms_credits !== undefined) {\r\n      setLiveCredits(currentProfile.sms_credits);\r\n    }\r\n  };\r\n\r\n  const createTemplate = async (templateData: Omit<MessageTemplate, 'id' | 'userId' | 'locationId' | 'createdAt' | 'updatedAt'>) => {\r\n    if (!userId || !currentBusiness?.id) return null;\r\n\r\n    try {\r\n      const result = await createMessageTemplateAction({\r\n        userId,\r\n        locationId: currentBusiness.id,\r\n        name: templateData.name,\r\n        content: templateData.content,\r\n        category: templateData.category,\r\n        variables: templateData.variables,\r\n        isDefault: templateData.isDefault\r\n      });\r\n\r\n      if (result.success && result.data) {\r\n        fetchTemplates();\r\n        return result.data;\r\n      }\r\n      throw new Error(result.error);\r\n    } catch (error: any) {\r\n      console.error('Error creating template:', error);\r\n      toast({ title: 'Error', description: 'Failed to create template', variant: 'destructive' });\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const updateTemplate = async (id: string, updates: Partial<MessageTemplate>) => {\r\n    try {\r\n      const result = await updateMessageTemplateAction(id, updates);\r\n      if (result.success) {\r\n        fetchTemplates();\r\n      } else {\r\n        throw new Error(result.error);\r\n      }\r\n    } catch (error: any) {\r\n      console.error('Error updating template:', error);\r\n      toast({ title: 'Error', description: 'Failed to update template', variant: 'destructive' });\r\n    }\r\n  };\r\n\r\n  const deleteTemplate = async (id: string) => {\r\n    try {\r\n      const result = await deleteMessageTemplateAction(id);\r\n      if (result.success) {\r\n        setTemplates(prev => prev.filter(t => t.id !== id));\r\n      } else {\r\n        throw new Error(result.error);\r\n      }\r\n    } catch (error: any) {\r\n      console.error('Error deleting template:', error);\r\n      toast({ title: 'Error', description: 'Failed to delete template', variant: 'destructive' });\r\n    }\r\n  };\r\n\r\n  const fetchMessages = useCallback(async (): Promise<Message[]> => {\r\n    if (!userId || !currentBusiness?.id) return [];\r\n    try {\r\n      const result = await getMessagesAction(userId, currentBusiness.id);\r\n      if (result.success && result.data) {\r\n        return result.data as Message[];\r\n      }\r\n      return [];\r\n    } catch (error) {\r\n      console.error('Error fetching messages:', error);\r\n      return [];\r\n    }\r\n  }, [userId, currentBusiness?.id]);\r\n\r\n  const messagesQueryKey = ['messages', userId, currentBusiness?.id];\r\n  const { data: queriedMessages, isLoading: messagesLoading } = useQuery({\r\n    queryKey: messagesQueryKey,\r\n    queryFn: fetchMessages,\r\n    enabled: !!userId && !!currentBusiness?.id,\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (queriedMessages) setMessages(queriedMessages);\r\n  }, [queriedMessages]);\r\n\r\n  const fetchTemplates = async () => {\r\n    if (!userId || !currentBusiness?.id) return;\r\n    try {\r\n      const result = await getMessageTemplatesAction(userId, currentBusiness.id);\r\n      if (result.success && result.data) {\r\n        setTemplates(result.data);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching templates:', error);\r\n    }\r\n  };\r\n\r\n  const fetchPurchases = async () => {\r\n    // Placeholder - implement when billing is migrated\r\n    setPurchases([]);\r\n  };\r\n\r\n  const createMessage = async (messageData: { phoneNumber: string; content: string; customerId?: string; templateId?: string; metadata?: any }) => {\r\n    if (!userId || !currentBusiness?.id || !currentProfile) return null;\r\n\r\n    const formattedPhone = formatPhoneNumber(messageData.phoneNumber);\r\n    const creditsNeeded = Math.ceil(messageData.content.length / 160);\r\n\r\n    // Basic credit check before calling action\r\n    if (currentProfile.sms_credits < creditsNeeded) {\r\n      toast({ title: 'Error', description: 'Insufficient credits', variant: 'destructive' });\r\n      return null;\r\n    }\r\n\r\n    try {\r\n      const result = await createMessageAction({\r\n        userId,\r\n        locationId: currentBusiness.id,\r\n        profileId: currentProfile.id,\r\n        customerId: messageData.customerId,\r\n        phoneNumber: formattedPhone,\r\n        content: messageData.content,\r\n        templateId: messageData.templateId,\r\n        smsCreditsUsed: creditsNeeded,\r\n        status: 'sent', // For now we assume successfully sent since we don't have gateway integration\r\n        metadata: messageData.metadata\r\n      });\r\n\r\n      if (result.success && result.data) {\r\n        const newMessage = { ...result.data, createdAt: result.data.createdAt.toISOString() };\r\n        setMessages(prev => [newMessage, ...prev]);\r\n        queryClient.invalidateQueries({ queryKey: messagesQueryKey });\r\n        toast({ title: 'Success', description: 'Message sent successfully' });\r\n        return newMessage;\r\n      }\r\n      throw new Error(result.error);\r\n    } catch (error: any) {\r\n      console.error('Error sending message:', error);\r\n      toast({ title: 'Error', description: 'Failed to send message', variant: 'destructive' });\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const createBulkMessages = async (messageData: { customerIds: string[]; content: string; templateId?: string; metadata?: any }) => {\r\n    // Simplified bulk implementation for now\r\n    let successCount = 0;\r\n    for (const customerId of messageData.customerIds) {\r\n      // In a real app we'd fetch the customer phone first\r\n      // But for this migration, we are just proving the Prisma works\r\n      successCount++;\r\n    }\r\n    return { success: successCount, failed: 0, errors: [] };\r\n  };\r\n\r\n  const initiateCreditPurchase = async (creditsAmount: number, phoneNumber: string) => {\r\n    toast({ title: 'Info', description: 'Credit purchase migration in progress' });\r\n    return null;\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (userId && currentBusiness?.id) {\r\n      fetchTemplates();\r\n      fetchPurchases();\r\n      fetchLiveCredits();\r\n    }\r\n  }, [userId, currentBusiness?.id, currentProfile?.id]);\r\n\r\n  const isLoading = messagesLoading && !queriedMessages;\r\n\r\n  const getMessageStats = () => {\r\n    const total = messages.length;\r\n    const sent = messages.filter(m => m.status === 'sent' || m.status === 'delivered').length;\r\n    const failed = messages.filter(m => m.status === 'failed').length;\r\n    const pending = messages.filter(m => m.status === 'pending').length;\r\n    const totalCreditsUsed = messages.reduce((sum, m) => sum + m.smsCreditsUsed, 0);\r\n\r\n    return { total, sent, failed, pending, totalCreditsUsed, creditsRemaining: liveCredits };\r\n  };\r\n\r\n  return {\r\n    messages,\r\n    templates,\r\n    purchases,\r\n    liveCredits,\r\n    isLoading,\r\n    createMessage,\r\n    createBulkMessages,\r\n    createTemplate,\r\n    updateTemplate,\r\n    deleteTemplate,\r\n    getMessageStats,\r\n    initiateCreditPurchase,\r\n    refresh: () => { queryClient.invalidateQueries({ queryKey: messagesQueryKey }); fetchTemplates(); fetchPurchases(); fetchLiveCredits(); }\r\n  };\r\n};\r\n"],"names":[],"mappings":";;;;AAAA,uBAAuB;AACvB;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;AA2DA,MAAM,oBAAoB,CAAC;IACzB,IAAI,UAAU,MAAM,OAAO,CAAC,eAAe;IAC3C,IAAI,QAAQ,UAAU,CAAC,MAAM,OAAO;IACpC,IAAI,QAAQ,UAAU,CAAC,QAAQ,OAAO,MAAM;IAC5C,IAAI,QAAQ,UAAU,CAAC,MAAM,OAAO,SAAS,QAAQ,SAAS,CAAC;IAC/D,IAAI,QAAQ,MAAM,KAAK,KAAK,QAAQ,KAAK,CAAC,eAAe,OAAO,SAAS;IACzE,OAAO,SAAS;AAClB;AAEO,MAAM,cAAc,CAAC;;IAC1B,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAY,EAAE;IACtD,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAQ,EAAE;IACpD,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAa,EAAE;IACzD,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,yKAAQ,EAAS;IAEvD,MAAM,EAAE,eAAe,EAAE,GAAG,IAAA,qJAAW;IACvC,MAAM,EAAE,cAAc,EAAE,GAAG,IAAA,oJAAW;IACtC,MAAM,cAAc,IAAA,2MAAc;IAElC,MAAM,mBAAmB;QACvB,mEAAmE;QACnE,mFAAmF;QACnF,IAAI,gBAAgB,gBAAgB,WAAW;YAC7C,eAAe,eAAe,WAAW;QAC3C;IACF;IAEA,MAAM,iBAAiB,OAAO;QAC5B,IAAI,CAAC,UAAU,CAAC,iBAAiB,IAAI,OAAO;QAE5C,IAAI;YACF,MAAM,SAAS,MAAM,IAAA,+LAA2B,EAAC;gBAC/C;gBACA,YAAY,gBAAgB,EAAE;gBAC9B,MAAM,aAAa,IAAI;gBACvB,SAAS,aAAa,OAAO;gBAC7B,UAAU,aAAa,QAAQ;gBAC/B,WAAW,aAAa,SAAS;gBACjC,WAAW,aAAa,SAAS;YACnC;YAEA,IAAI,OAAO,OAAO,IAAI,OAAO,IAAI,EAAE;gBACjC;gBACA,OAAO,OAAO,IAAI;YACpB;YACA,MAAM,IAAI,MAAM,OAAO,KAAK;QAC9B,EAAE,OAAO,OAAY;YACnB,QAAQ,KAAK,CAAC,4BAA4B;YAC1C,IAAA,wIAAK,EAAC;gBAAE,OAAO;gBAAS,aAAa;gBAA6B,SAAS;YAAc;YACzF,OAAO;QACT;IACF;IAEA,MAAM,iBAAiB,OAAO,IAAY;QACxC,IAAI;YACF,MAAM,SAAS,MAAM,IAAA,+LAA2B,EAAC,IAAI;YACrD,IAAI,OAAO,OAAO,EAAE;gBAClB;YACF,OAAO;gBACL,MAAM,IAAI,MAAM,OAAO,KAAK;YAC9B;QACF,EAAE,OAAO,OAAY;YACnB,QAAQ,KAAK,CAAC,4BAA4B;YAC1C,IAAA,wIAAK,EAAC;gBAAE,OAAO;gBAAS,aAAa;gBAA6B,SAAS;YAAc;QAC3F;IACF;IAEA,MAAM,iBAAiB,OAAO;QAC5B,IAAI;YACF,MAAM,SAAS,MAAM,IAAA,+LAA2B,EAAC;YACjD,IAAI,OAAO,OAAO,EAAE;gBAClB,aAAa,CAAA,OAAQ,KAAK,MAAM,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;YACjD,OAAO;gBACL,MAAM,IAAI,MAAM,OAAO,KAAK;YAC9B;QACF,EAAE,OAAO,OAAY;YACnB,QAAQ,KAAK,CAAC,4BAA4B;YAC1C,IAAA,wIAAK,EAAC;gBAAE,OAAO;gBAAS,aAAa;gBAA6B,SAAS;YAAc;QAC3F;IACF;IAEA,MAAM,gBAAgB,IAAA,4KAAW;kDAAC;YAChC,IAAI,CAAC,UAAU,CAAC,iBAAiB,IAAI,OAAO,EAAE;YAC9C,IAAI;gBACF,MAAM,SAAS,MAAM,IAAA,qLAAiB,EAAC,QAAQ,gBAAgB,EAAE;gBACjE,IAAI,OAAO,OAAO,IAAI,OAAO,IAAI,EAAE;oBACjC,OAAO,OAAO,IAAI;gBACpB;gBACA,OAAO,EAAE;YACX,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,4BAA4B;gBAC1C,OAAO,EAAE;YACX;QACF;iDAAG;QAAC;QAAQ,iBAAiB;KAAG;IAEhC,MAAM,mBAAmB;QAAC;QAAY;QAAQ,iBAAiB;KAAG;IAClE,MAAM,EAAE,MAAM,eAAe,EAAE,WAAW,eAAe,EAAE,GAAG,IAAA,0LAAQ,EAAC;QACrE,UAAU;QACV,SAAS;QACT,SAAS,CAAC,CAAC,UAAU,CAAC,CAAC,iBAAiB;IAC1C;IAEA,IAAA,0KAAS;iCAAC;YACR,IAAI,iBAAiB,YAAY;QACnC;gCAAG;QAAC;KAAgB;IAEpB,MAAM,iBAAiB;QACrB,IAAI,CAAC,UAAU,CAAC,iBAAiB,IAAI;QACrC,IAAI;YACF,MAAM,SAAS,MAAM,IAAA,6LAAyB,EAAC,QAAQ,gBAAgB,EAAE;YACzE,IAAI,OAAO,OAAO,IAAI,OAAO,IAAI,EAAE;gBACjC,aAAa,OAAO,IAAI;YAC1B;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,6BAA6B;QAC7C;IACF;IAEA,MAAM,iBAAiB;QACrB,mDAAmD;QACnD,aAAa,EAAE;IACjB;IAEA,MAAM,gBAAgB,OAAO;QAC3B,IAAI,CAAC,UAAU,CAAC,iBAAiB,MAAM,CAAC,gBAAgB,OAAO;QAE/D,MAAM,iBAAiB,kBAAkB,YAAY,WAAW;QAChE,MAAM,gBAAgB,KAAK,IAAI,CAAC,YAAY,OAAO,CAAC,MAAM,GAAG;QAE7D,2CAA2C;QAC3C,IAAI,eAAe,WAAW,GAAG,eAAe;YAC9C,IAAA,wIAAK,EAAC;gBAAE,OAAO;gBAAS,aAAa;gBAAwB,SAAS;YAAc;YACpF,OAAO;QACT;QAEA,IAAI;YACF,MAAM,SAAS,MAAM,IAAA,uLAAmB,EAAC;gBACvC;gBACA,YAAY,gBAAgB,EAAE;gBAC9B,WAAW,eAAe,EAAE;gBAC5B,YAAY,YAAY,UAAU;gBAClC,aAAa;gBACb,SAAS,YAAY,OAAO;gBAC5B,YAAY,YAAY,UAAU;gBAClC,gBAAgB;gBAChB,QAAQ;gBACR,UAAU,YAAY,QAAQ;YAChC;YAEA,IAAI,OAAO,OAAO,IAAI,OAAO,IAAI,EAAE;gBACjC,MAAM,aAAa;oBAAE,GAAG,OAAO,IAAI;oBAAE,WAAW,OAAO,IAAI,CAAC,SAAS,CAAC,WAAW;gBAAG;gBACpF,YAAY,CAAA,OAAQ;wBAAC;2BAAe;qBAAK;gBACzC,YAAY,iBAAiB,CAAC;oBAAE,UAAU;gBAAiB;gBAC3D,IAAA,wIAAK,EAAC;oBAAE,OAAO;oBAAW,aAAa;gBAA4B;gBACnE,OAAO;YACT;YACA,MAAM,IAAI,MAAM,OAAO,KAAK;QAC9B,EAAE,OAAO,OAAY;YACnB,QAAQ,KAAK,CAAC,0BAA0B;YACxC,IAAA,wIAAK,EAAC;gBAAE,OAAO;gBAAS,aAAa;gBAA0B,SAAS;YAAc;YACtF,OAAO;QACT;IACF;IAEA,MAAM,qBAAqB,OAAO;QAChC,yCAAyC;QACzC,IAAI,eAAe;QACnB,KAAK,MAAM,cAAc,YAAY,WAAW,CAAE;YAChD,oDAAoD;YACpD,+DAA+D;YAC/D;QACF;QACA,OAAO;YAAE,SAAS;YAAc,QAAQ;YAAG,QAAQ,EAAE;QAAC;IACxD;IAEA,MAAM,yBAAyB,OAAO,eAAuB;QAC3D,IAAA,wIAAK,EAAC;YAAE,OAAO;YAAQ,aAAa;QAAwC;QAC5E,OAAO;IACT;IAEA,IAAA,0KAAS;iCAAC;YACR,IAAI,UAAU,iBAAiB,IAAI;gBACjC;gBACA;gBACA;YACF;QACF;gCAAG;QAAC;QAAQ,iBAAiB;QAAI,gBAAgB;KAAG;IAEpD,MAAM,YAAY,mBAAmB,CAAC;IAEtC,MAAM,kBAAkB;QACtB,MAAM,QAAQ,SAAS,MAAM;QAC7B,MAAM,OAAO,SAAS,MAAM,CAAC,CAAA,IAAK,EAAE,MAAM,KAAK,UAAU,EAAE,MAAM,KAAK,aAAa,MAAM;QACzF,MAAM,SAAS,SAAS,MAAM,CAAC,CAAA,IAAK,EAAE,MAAM,KAAK,UAAU,MAAM;QACjE,MAAM,UAAU,SAAS,MAAM,CAAC,CAAA,IAAK,EAAE,MAAM,KAAK,WAAW,MAAM;QACnE,MAAM,mBAAmB,SAAS,MAAM,CAAC,CAAC,KAAK,IAAM,MAAM,EAAE,cAAc,EAAE;QAE7E,OAAO;YAAE;YAAO;YAAM;YAAQ;YAAS;YAAkB,kBAAkB;QAAY;IACzF;IAEA,OAAO;QACL;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,SAAS;YAAQ,YAAY,iBAAiB,CAAC;gBAAE,UAAU;YAAiB;YAAI;YAAkB;YAAkB;QAAoB;IAC1I;AACF;GA9Ma;;QAMiB,qJAAW;QACZ,oJAAW;QAClB,2MAAc;QA+E4B,0LAAQ"}},
    {"offset": {"line": 4545, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useCustomerCategories.ts"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\nimport { toast } from '@/hooks/use-toast';\r\nimport { useAuth } from '@/components/auth/AuthProvider';\r\nimport {\r\n  getCustomerCategoriesAction,\r\n  createCustomerCategoryAction,\r\n  updateCustomerCategoryAction,\r\n  deleteCustomerCategoryAction\r\n} from '@/app/actions/customers';\r\n\r\nexport interface CustomerCategory {\r\n  id: string;\r\n  name: string;\r\n  isDefault: boolean;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n}\r\n\r\nexport const useCustomerCategories = () => {\r\n  const [categories, setCategories] = useState<CustomerCategory[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const { currentBusiness } = useBusiness();\r\n  const { user } = useAuth();\r\n\r\n  const fetchCategories = async () => {\r\n    if (!currentBusiness) {\r\n      setCategories([]);\r\n      setIsLoading(false);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const result = await getCustomerCategoriesAction(currentBusiness.id);\r\n      if (result.success && result.data) {\r\n        setCategories(result.data as any);\r\n      } else {\r\n        throw new Error(result.error);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching customer categories:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to fetch customer categories\",\r\n        variant: \"destructive\",\r\n      });\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchCategories();\r\n  }, [currentBusiness]);\r\n\r\n  const createCategory = async (name: string) => {\r\n    if (!currentBusiness || !user) {\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"No business selected or user not authenticated\",\r\n        variant: \"destructive\",\r\n      });\r\n      return false;\r\n    }\r\n\r\n    try {\r\n      const result = await createCustomerCategoryAction(currentBusiness.id, user.id, name);\r\n      if (result.success) {\r\n        toast({\r\n          title: \"Success\",\r\n          description: \"Customer category created successfully\",\r\n        });\r\n        fetchCategories();\r\n        return true;\r\n      } else {\r\n        throw new Error(result.error);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error creating customer category:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to create customer category\",\r\n        variant: \"destructive\",\r\n      });\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const updateCategory = async (id: string, name: string) => {\r\n    try {\r\n      const result = await updateCustomerCategoryAction(id, name);\r\n      if (result.success) {\r\n        toast({\r\n          title: \"Success\",\r\n          description: \"Customer category updated successfully\",\r\n        });\r\n        fetchCategories();\r\n        return true;\r\n      } else {\r\n        throw new Error(result.error);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error updating customer category:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to update customer category\",\r\n        variant: \"destructive\",\r\n      });\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const deleteCategory = async (id: string) => {\r\n    try {\r\n      const result = await deleteCustomerCategoryAction(id);\r\n      if (result.success) {\r\n        toast({\r\n          title: \"Success\",\r\n          description: \"Customer category deleted successfully\",\r\n        });\r\n        fetchCategories();\r\n        return true;\r\n      } else {\r\n        throw new Error(result.error);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error deleting customer category:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to delete customer category\",\r\n        variant: \"destructive\",\r\n      });\r\n      return false;\r\n    }\r\n  };\r\n\r\n  return {\r\n    categories,\r\n    isLoading,\r\n    createCategory,\r\n    updateCategory,\r\n    deleteCategory,\r\n    refetch: fetchCategories,\r\n  };\r\n};\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;;;;;;;AAeO,MAAM,wBAAwB;;IACnC,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,yKAAQ,EAAqB,EAAE;IACnE,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAC;IAC3C,MAAM,EAAE,eAAe,EAAE,GAAG,IAAA,qJAAW;IACvC,MAAM,EAAE,IAAI,EAAE,GAAG,IAAA,wJAAO;IAExB,MAAM,kBAAkB;QACtB,IAAI,CAAC,iBAAiB;YACpB,cAAc,EAAE;YAChB,aAAa;YACb;QACF;QAEA,IAAI;YACF,MAAM,SAAS,MAAM,IAAA,+LAA2B,EAAC,gBAAgB,EAAE;YACnE,IAAI,OAAO,OAAO,IAAI,OAAO,IAAI,EAAE;gBACjC,cAAc,OAAO,IAAI;YAC3B,OAAO;gBACL,MAAM,IAAI,MAAM,OAAO,KAAK;YAC9B;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,uCAAuC;YACrD,IAAA,wIAAK,EAAC;gBACJ,OAAO;gBACP,aAAa;gBACb,SAAS;YACX;QACF,SAAU;YACR,aAAa;QACf;IACF;IAEA,IAAA,0KAAS;2CAAC;YACR;QACF;0CAAG;QAAC;KAAgB;IAEpB,MAAM,iBAAiB,OAAO;QAC5B,IAAI,CAAC,mBAAmB,CAAC,MAAM;YAC7B,IAAA,wIAAK,EAAC;gBACJ,OAAO;gBACP,aAAa;gBACb,SAAS;YACX;YACA,OAAO;QACT;QAEA,IAAI;YACF,MAAM,SAAS,MAAM,IAAA,gMAA4B,EAAC,gBAAgB,EAAE,EAAE,KAAK,EAAE,EAAE;YAC/E,IAAI,OAAO,OAAO,EAAE;gBAClB,IAAA,wIAAK,EAAC;oBACJ,OAAO;oBACP,aAAa;gBACf;gBACA;gBACA,OAAO;YACT,OAAO;gBACL,MAAM,IAAI,MAAM,OAAO,KAAK;YAC9B;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,qCAAqC;YACnD,IAAA,wIAAK,EAAC;gBACJ,OAAO;gBACP,aAAa;gBACb,SAAS;YACX;YACA,OAAO;QACT;IACF;IAEA,MAAM,iBAAiB,OAAO,IAAY;QACxC,IAAI;YACF,MAAM,SAAS,MAAM,IAAA,gMAA4B,EAAC,IAAI;YACtD,IAAI,OAAO,OAAO,EAAE;gBAClB,IAAA,wIAAK,EAAC;oBACJ,OAAO;oBACP,aAAa;gBACf;gBACA;gBACA,OAAO;YACT,OAAO;gBACL,MAAM,IAAI,MAAM,OAAO,KAAK;YAC9B;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,qCAAqC;YACnD,IAAA,wIAAK,EAAC;gBACJ,OAAO;gBACP,aAAa;gBACb,SAAS;YACX;YACA,OAAO;QACT;IACF;IAEA,MAAM,iBAAiB,OAAO;QAC5B,IAAI;YACF,MAAM,SAAS,MAAM,IAAA,gMAA4B,EAAC;YAClD,IAAI,OAAO,OAAO,EAAE;gBAClB,IAAA,wIAAK,EAAC;oBACJ,OAAO;oBACP,aAAa;gBACf;gBACA;gBACA,OAAO;YACT,OAAO;gBACL,MAAM,IAAI,MAAM,OAAO,KAAK;YAC9B;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,qCAAqC;YACnD,IAAA,wIAAK,EAAC;gBACJ,OAAO;gBACP,aAAa;gBACb,SAAS;YACX;YACA,OAAO;QACT;IACF;IAEA,OAAO;QACL;QACA;QACA;QACA;QACA;QACA,SAAS;IACX;AACF;GA7Ha;;QAGiB,qJAAW;QACtB,wJAAO"}},
    {"offset": {"line": 4699, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useFinancialVisibility.ts"],"sourcesContent":["import { useProfiles } from '@/contexts/ProfileContext';\r\n\r\n/**\r\n * Hook to handle financial data visibility based on permissions\r\n */\r\nexport const useFinancialVisibility = () => {\r\n    const { hasPermission } = useProfiles();\r\n\r\n    const canViewCostPrice = hasPermission('inventory', 'view_cost_price');\r\n    const canViewProfit = hasPermission('inventory', 'view_profit');\r\n    const canViewSellingPrice = hasPermission('inventory', 'view_selling_price');\r\n\r\n    // Dashboard-specific permissions\r\n    const canViewTotalSales = hasPermission('dashboard', 'view_total_sales');\r\n    const canViewTotalGrossProfit = hasPermission('dashboard', 'view_gross_profit');\r\n    const canViewTotalExpenses = hasPermission('dashboard', 'view_total_expenses');\r\n    const canViewInventoryValue = hasPermission('dashboard', 'view_inventory_value');\r\n    const canViewSalesTypes = hasPermission('dashboard', 'view_sales_types');\r\n    const canViewAvgPrice = hasPermission('dashboard', 'view_avg_price');\r\n    const canViewTotalAmount = hasPermission('dashboard', 'view_total_amount');\r\n\r\n    // Finance and Expenses permissions\r\n    const canManageFinanceAccounts = hasPermission('finance', 'manage_accounts');\r\n    const canViewFinance = hasPermission('finance', 'view');\r\n    const canViewExpenses = hasPermission('expenses', 'view');\r\n    const canCreateExpenses = hasPermission('expenses', 'create');\r\n    const canEditExpenses = hasPermission('expenses', 'edit');\r\n    const canDeleteExpenses = hasPermission('expenses', 'delete');\r\n\r\n    /**\r\n     * Format a financial value or return a hidden indicator\r\n     */\r\n    const formatFinancial = (value: number | null | undefined, type: 'cost' | 'selling' | 'profit'): string => {\r\n        const hasAccess =\r\n            (type === 'cost' && canViewCostPrice) ||\r\n            (type === 'selling' && canViewSellingPrice) ||\r\n            (type === 'profit' && canViewProfit);\r\n\r\n        if (!hasAccess) {\r\n            return '';\r\n        }\r\n\r\n        return value?.toLocaleString() || '0';\r\n    };\r\n\r\n    return {\r\n        canViewCostPrice,\r\n        canViewProfit,\r\n        canViewSellingPrice,\r\n        canViewTotalSales,\r\n        canViewTotalGrossProfit,\r\n        canViewTotalExpenses,\r\n        canViewInventoryValue,\r\n        canViewSalesTypes,\r\n        canViewAvgPrice,\r\n        canViewTotalAmount,\r\n        canManageFinanceAccounts,\r\n        canViewFinance,\r\n        canViewExpenses,\r\n        canCreateExpenses,\r\n        canEditExpenses,\r\n        canDeleteExpenses,\r\n        formatFinancial,\r\n    };\r\n};\r\n"],"names":[],"mappings":";;;;AAAA;;;AAKO,MAAM,yBAAyB;;IAClC,MAAM,EAAE,aAAa,EAAE,GAAG,IAAA,oJAAW;IAErC,MAAM,mBAAmB,cAAc,aAAa;IACpD,MAAM,gBAAgB,cAAc,aAAa;IACjD,MAAM,sBAAsB,cAAc,aAAa;IAEvD,iCAAiC;IACjC,MAAM,oBAAoB,cAAc,aAAa;IACrD,MAAM,0BAA0B,cAAc,aAAa;IAC3D,MAAM,uBAAuB,cAAc,aAAa;IACxD,MAAM,wBAAwB,cAAc,aAAa;IACzD,MAAM,oBAAoB,cAAc,aAAa;IACrD,MAAM,kBAAkB,cAAc,aAAa;IACnD,MAAM,qBAAqB,cAAc,aAAa;IAEtD,mCAAmC;IACnC,MAAM,2BAA2B,cAAc,WAAW;IAC1D,MAAM,iBAAiB,cAAc,WAAW;IAChD,MAAM,kBAAkB,cAAc,YAAY;IAClD,MAAM,oBAAoB,cAAc,YAAY;IACpD,MAAM,kBAAkB,cAAc,YAAY;IAClD,MAAM,oBAAoB,cAAc,YAAY;IAEpD;;KAEC,GACD,MAAM,kBAAkB,CAAC,OAAkC;QACvD,MAAM,YACF,AAAC,SAAS,UAAU,oBACnB,SAAS,aAAa,uBACtB,SAAS,YAAY;QAE1B,IAAI,CAAC,WAAW;YACZ,OAAO;QACX;QAEA,OAAO,OAAO,oBAAoB;IACtC;IAEA,OAAO;QACH;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;IACJ;AACJ;GA3Da;;QACiB,oJAAW"}},
    {"offset": {"line": 4768, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useSalesCategories.ts"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport { SalesCategory } from '@/types';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\nimport { toast } from '@/hooks/use-toast';\r\nimport { useAuth } from '@/components/auth/AuthProvider';\r\nimport {\r\n  getSalesCategoriesAction,\r\n  createSalesCategoryAction,\r\n  updateSalesCategoryAction,\r\n  deleteSalesCategoryAction\r\n} from '@/app/actions/sales';\r\n\r\nexport const useSalesCategories = () => {\r\n  const [categories, setCategories] = useState<SalesCategory[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const { currentBusiness } = useBusiness();\r\n  const { user } = useAuth();\r\n\r\n  const fetchCategories = async () => {\r\n    if (!currentBusiness) {\r\n      setCategories([]);\r\n      setIsLoading(false);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const result = await getSalesCategoriesAction(currentBusiness.id);\r\n      if (result.success && result.data) {\r\n        setCategories(result.data as any);\r\n      } else {\r\n        throw new Error(result.error);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching sales categories:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to fetch sales categories\",\r\n        variant: \"destructive\",\r\n      });\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchCategories();\r\n  }, [currentBusiness]);\r\n\r\n  const createCategory = async (name: string) => {\r\n    if (!currentBusiness || !user) {\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"No business selected or user not authenticated\",\r\n        variant: \"destructive\",\r\n      });\r\n      return false;\r\n    }\r\n\r\n    try {\r\n      const result = await createSalesCategoryAction(currentBusiness.id, user.id, name);\r\n      if (result.success) {\r\n        toast({\r\n          title: \"Success\",\r\n          description: \"Sales category created successfully\",\r\n        });\r\n        fetchCategories();\r\n        return true;\r\n      } else {\r\n        throw new Error(result.error);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error creating sales category:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to create sales category\",\r\n        variant: \"destructive\",\r\n      });\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const updateCategory = async (id: string, name: string) => {\r\n    try {\r\n      const result = await updateSalesCategoryAction(id, name);\r\n      if (result.success) {\r\n        toast({\r\n          title: \"Success\",\r\n          description: \"Sales category updated successfully\",\r\n        });\r\n        fetchCategories();\r\n        return true;\r\n      } else {\r\n        throw new Error(result.error);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error updating sales category:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to update sales category\",\r\n        variant: \"destructive\",\r\n      });\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const deleteCategory = async (id: string) => {\r\n    try {\r\n      const result = await deleteSalesCategoryAction(id);\r\n      if (result.success) {\r\n        toast({\r\n          title: \"Success\",\r\n          description: \"Sales category deleted successfully\",\r\n        });\r\n        fetchCategories();\r\n        return true;\r\n      } else {\r\n        throw new Error(result.error);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error deleting sales category:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to delete sales category\",\r\n        variant: \"destructive\",\r\n      });\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const createDefaultCategories = async () => {\r\n    if (!currentBusiness || !user) return;\r\n\r\n    const defaultCategories = ['Retail', 'Online', 'Wholesale'];\r\n\r\n    try {\r\n      for (const name of defaultCategories) {\r\n        await createSalesCategoryAction(currentBusiness.id, user.id, name, true);\r\n      }\r\n      fetchCategories();\r\n    } catch (error) {\r\n      console.error('Error creating default categories:', error);\r\n    }\r\n  };\r\n\r\n  return {\r\n    categories,\r\n    isLoading,\r\n    createCategory,\r\n    updateCategory,\r\n    deleteCategory,\r\n    createDefaultCategories,\r\n    refetch: fetchCategories,\r\n  };\r\n};"],"names":[],"mappings":"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"}}]
}