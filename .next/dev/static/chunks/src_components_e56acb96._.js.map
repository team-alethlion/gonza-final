{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/sales/NewSaleLoadingState.tsx"],"sourcesContent":["import React from 'react';\r\n\r\n\r\nconst NewSaleLoadingState: React.FC = () => {\r\n  return (\r\n    <div className=\"max-w-4xl mx-auto p-6\">\r\n      <div className=\"animate-pulse\">\r\n        <div className=\"h-8 bg-gray-200 rounded w-48 mb-4\"></div>\r\n        <div className=\"h-64 bg-gray-200 rounded\"></div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default NewSaleLoadingState;"],"names":[],"mappings":";;;;;;AAGA,MAAM,sBAAgC;IACpC,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC;YAAI,WAAU;;8BACb,6LAAC;oBAAI,WAAU;;;;;;8BACf,6LAAC;oBAAI,WAAU;;;;;;;;;;;;;;;;;AAIvB;KATM;uCAWS"}},
    {"offset": {"line": 53, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/sales/NewSaleNoBusinessState.tsx"],"sourcesContent":["import React from 'react';\r\nimport { useRouter } from 'next/navigation';\r\n\r\nconst NewSaleNoBusinessState: React.FC = () => {\r\n  const router = useRouter();\r\n\r\n  return (\r\n    <div className=\"max-w-4xl mx-auto p-6\">\r\n      <div className=\"bg-amber-50 border border-amber-200 p-4 rounded-md\">\r\n        <p className=\"text-amber-800 mb-4\">\r\n          No business location found. Please create a business location to manage sales.\r\n        </p>\r\n        <button\r\n          onClick={() => router.push('/business-management')}\r\n          className=\"bg-amber-600 text-white px-4 py-2 rounded hover:bg-amber-700\"\r\n        >\r\n          Manage Business Locations\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default NewSaleNoBusinessState;"],"names":[],"mappings":";;;;;AACA;;;;AAEA,MAAM,yBAAmC;;IACvC,MAAM,SAAS,IAAA,kJAAS;IAExB,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC;YAAI,WAAU;;8BACb,6LAAC;oBAAE,WAAU;8BAAsB;;;;;;8BAGnC,6LAAC;oBACC,SAAS,IAAM,OAAO,IAAI,CAAC;oBAC3B,WAAU;8BACX;;;;;;;;;;;;;;;;;AAMT;GAlBM;;QACW,kJAAS;;;KADpB;uCAoBS"}},
    {"offset": {"line": 115, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/sales/NewSaleAuthWarning.tsx"],"sourcesContent":["import React from 'react';\r\n\r\nconst NewSaleAuthWarning: React.FC = () => {\r\n  return (\r\n    <div className=\"bg-amber-50 border border-amber-200 p-4 rounded-md mb-6\">\r\n      <p className=\"text-amber-800\">\r\n        You need to be signed in to create or edit sales. All sales are saved to your Supabase database.\r\n      </p>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default NewSaleAuthWarning;"],"names":[],"mappings":";;;;;;AAEA,MAAM,qBAA+B;IACnC,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC;YAAE,WAAU;sBAAiB;;;;;;;;;;;AAKpC;KARM;uCAUS"}},
    {"offset": {"line": 149, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/ui/calendar.tsx"],"sourcesContent":["\r\nimport * as React from \"react\";\r\nimport { ChevronLeft, ChevronRight } from \"lucide-react\";\r\nimport { DayPicker } from \"react-day-picker\";\r\n\r\nimport { cn } from \"@/lib/utils\";\r\nimport { buttonVariants } from \"@/components/ui/button\";\r\n\r\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>;\r\n\r\nfunction Calendar({\r\n  className,\r\n  classNames,\r\n  showOutsideDays = true,\r\n  ...props\r\n}: CalendarProps) {\r\n  return (\r\n    <DayPicker\r\n      showOutsideDays={showOutsideDays}\r\n      className={cn(\"p-3 pointer-events-auto\", className)}\r\n      classNames={{\r\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\r\n        month: \"space-y-4\",\r\n        caption: \"flex justify-center pt-1 relative items-center\",\r\n        caption_label: \"text-sm font-medium\",\r\n        caption_dropdowns: \"flex justify-center gap-1\",\r\n        nav: \"space-x-1 flex items-center\",\r\n        nav_button: cn(\r\n          buttonVariants({ variant: \"outline\" }),\r\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\r\n        ),\r\n        nav_button_previous: \"absolute left-1\",\r\n        nav_button_next: \"absolute right-1\",\r\n        table: \"w-full border-collapse space-y-1\",\r\n        head_row: \"flex\",\r\n        head_cell:\r\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\r\n        row: \"flex w-full mt-2\",\r\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\r\n        day: cn(\r\n          buttonVariants({ variant: \"ghost\" }),\r\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\r\n        ),\r\n        day_range_end: \"day-range-end\",\r\n        day_selected:\r\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\r\n        day_today: \"bg-accent text-accent-foreground\",\r\n        day_outside:\r\n          \"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30\",\r\n        day_disabled: \"text-muted-foreground opacity-50\",\r\n        day_range_middle:\r\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\r\n        day_hidden: \"invisible\",\r\n        dropdown: \"bg-background rounded-md border p-1 shadow-md\",\r\n        dropdown_month: \"w-[var(--rdp-caption-dropdown-month-width)]\",\r\n        dropdown_year: \"w-[var(--rdp-caption-dropdown-year-width)]\",\r\n        dropdown_icon: \"w-4 h-4\",\r\n        button_reset: \"appearance-none bg-transparent border-none p-0 m-0\",\r\n        vhidden: \"sr-only\",\r\n        ...classNames,\r\n      }}\r\n      components={{\r\n        IconLeft: ({ ..._props }) => <ChevronLeft className=\"h-4 w-4\" />,\r\n        IconRight: ({ ..._props }) => <ChevronRight className=\"h-4 w-4\" />,\r\n      }}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\nCalendar.displayName = \"Calendar\";\r\n\r\nexport { Calendar };\r\n"],"names":[],"mappings":";;;;;AAEA;AAAA;AACA;AAEA;AACA;;;;;;AAIA,SAAS,SAAS,EAChB,SAAS,EACT,UAAU,EACV,kBAAkB,IAAI,EACtB,GAAG,OACW;IACd,qBACE,6LAAC,8KAAS;QACR,iBAAiB;QACjB,WAAW,IAAA,4HAAE,EAAC,2BAA2B;QACzC,YAAY;YACV,QAAQ;YACR,OAAO;YACP,SAAS;YACT,eAAe;YACf,mBAAmB;YACnB,KAAK;YACL,YAAY,IAAA,4HAAE,EACZ,IAAA,uJAAc,EAAC;gBAAE,SAAS;YAAU,IACpC;YAEF,qBAAqB;YACrB,iBAAiB;YACjB,OAAO;YACP,UAAU;YACV,WACE;YACF,KAAK;YACL,MAAM;YACN,KAAK,IAAA,4HAAE,EACL,IAAA,uJAAc,EAAC;gBAAE,SAAS;YAAQ,IAClC;YAEF,eAAe;YACf,cACE;YACF,WAAW;YACX,aACE;YACF,cAAc;YACd,kBACE;YACF,YAAY;YACZ,UAAU;YACV,gBAAgB;YAChB,eAAe;YACf,eAAe;YACf,cAAc;YACd,SAAS;YACT,GAAG,UAAU;QACf;QACA,YAAY;YACV,UAAU,CAAC,EAAE,GAAG,QAAQ,iBAAK,6LAAC,sOAAW;oBAAC,WAAU;;;;;;YACpD,WAAW,CAAC,EAAE,GAAG,QAAQ,iBAAK,6LAAC,yOAAY;oBAAC,WAAU;;;;;;QACxD;QACC,GAAG,KAAK;;;;;;AAGf;KA1DS;AA2DT,SAAS,WAAW,GAAG"}},
    {"offset": {"line": 238, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/ui/popover.tsx"],"sourcesContent":["import * as React from \"react\"\r\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst Popover = PopoverPrimitive.Root\r\n\r\nconst PopoverTrigger = PopoverPrimitive.Trigger\r\n\r\nconst PopoverContent = React.forwardRef<\r\n  React.ElementRef<typeof PopoverPrimitive.Content>,\r\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\r\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\r\n  <PopoverPrimitive.Portal>\r\n    <PopoverPrimitive.Content\r\n      ref={ref}\r\n      align={align}\r\n      sideOffset={sideOffset}\r\n      className={cn(\r\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  </PopoverPrimitive.Portal>\r\n))\r\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\r\n\r\nexport { Popover, PopoverTrigger, PopoverContent }\r\n"],"names":[],"mappings":";;;;;;;;;AAAA;AACA;AAEA;;;;;AAEA,MAAM,UAAU,8KAAqB;AAErC,MAAM,iBAAiB,iLAAwB;AAE/C,MAAM,+BAAiB,2KAAgB,MAGrC,CAAC,EAAE,SAAS,EAAE,QAAQ,QAAQ,EAAE,aAAa,CAAC,EAAE,GAAG,OAAO,EAAE,oBAC5D,6LAAC,gLAAuB;kBACtB,cAAA,6LAAC,iLAAwB;YACvB,KAAK;YACL,OAAO;YACP,YAAY;YACZ,WAAW,IAAA,4HAAE,EACX,8aACA;YAED,GAAG,KAAK;;;;;;;;;;;;AAIf,eAAe,WAAW,GAAG,iLAAwB,CAAC,WAAW"}},
    {"offset": {"line": 286, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/sales/SaleDatePicker.tsx"],"sourcesContent":["\r\nimport React from \"react\";\r\nimport { format } from \"date-fns\";\r\nimport { CalendarIcon } from \"lucide-react\";\r\nimport { Calendar } from \"@/components/ui/calendar\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\ninterface SaleDatePickerProps {\r\n  selectedDate: Date;\r\n  onDateChange: (date: Date) => void;\r\n}\r\n\r\nconst SaleDatePicker: React.FC<SaleDatePickerProps> = ({\r\n  selectedDate,\r\n  onDateChange,\r\n}) => {\r\n  const handleDateSelect = (date: Date | undefined) => {\r\n    if (date) {\r\n      // Ensure the date is set to noon to avoid timezone issues\r\n      const adjustedDate = new Date(date.getFullYear(), date.getMonth(), date.getDate(), 12, 0, 0);\r\n      onDateChange(adjustedDate);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"grid gap-3\">\r\n      <Label htmlFor=\"date\">Date</Label>\r\n      <Popover>\r\n        <PopoverTrigger asChild>\r\n          <Button\r\n            variant={\"outline\"}\r\n            className={cn(\r\n              \"w-full justify-start text-left font-normal\",\r\n              !selectedDate && \"text-muted-foreground\"\r\n            )}\r\n          >\r\n            <CalendarIcon className=\"mr-2 h-4 w-4\" />\r\n            {selectedDate ? format(selectedDate, \"PPP\") : <span>Pick a date</span>}\r\n          </Button>\r\n        </PopoverTrigger>\r\n        <PopoverContent className=\"w-auto p-0\" align=\"start\">\r\n          <Calendar\r\n            mode=\"single\"\r\n            selected={selectedDate}\r\n            onSelect={handleDateSelect}\r\n            initialFocus\r\n            className={cn(\"p-3 pointer-events-auto\")}\r\n          />\r\n        </PopoverContent>\r\n      </Popover>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SaleDatePicker;\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AAOA,MAAM,iBAAgD,CAAC,EACrD,YAAY,EACZ,YAAY,EACb;IACC,MAAM,mBAAmB,CAAC;QACxB,IAAI,MAAM;YACR,0DAA0D;YAC1D,MAAM,eAAe,IAAI,KAAK,KAAK,WAAW,IAAI,KAAK,QAAQ,IAAI,KAAK,OAAO,IAAI,IAAI,GAAG;YAC1F,aAAa;QACf;IACF;IAEA,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC,6IAAK;gBAAC,SAAQ;0BAAO;;;;;;0BACtB,6LAAC,iJAAO;;kCACN,6LAAC,wJAAc;wBAAC,OAAO;kCACrB,cAAA,6LAAC,+IAAM;4BACL,SAAS;4BACT,WAAW,IAAA,4HAAE,EACX,8CACA,CAAC,gBAAgB;;8CAGnB,6LAAC,iOAAY;oCAAC,WAAU;;;;;;gCACvB,eAAe,IAAA,kKAAM,EAAC,cAAc,uBAAS,6LAAC;8CAAK;;;;;;;;;;;;;;;;;kCAGxD,6LAAC,wJAAc;wBAAC,WAAU;wBAAa,OAAM;kCAC3C,cAAA,6LAAC,mJAAQ;4BACP,MAAK;4BACL,UAAU;4BACV,UAAU;4BACV,YAAY;4BACZ,WAAW,IAAA,4HAAE,EAAC;;;;;;;;;;;;;;;;;;;;;;;AAM1B;KAxCM;uCA0CS"}},
    {"offset": {"line": 401, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/sales/CustomerInformation.tsx"],"sourcesContent":["\r\nimport React, { useState, useEffect } from \"react\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Customer } from \"@/types\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Check } from \"lucide-react\";\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport { useCustomerCategories } from \"@/hooks/useCustomerCategories\";\r\n\r\ninterface CustomerInformationProps {\r\n  customerName: string;\r\n  customerAddress: string;\r\n  customerContact: string;\r\n  notes?: string;\r\n  onCustomerInfoChange: (e: React.ChangeEvent<HTMLInputElement>) => void;\r\n  errors: {\r\n    customerName?: string;\r\n  };\r\n  customers?: Customer[];\r\n  onAddNewCustomer?: () => void;\r\n  onSelectCustomer?: (customer: Customer) => void;\r\n  selectedCategoryId?: string;\r\n  onCategoryChange?: (categoryId: string) => void;\r\n}\r\n\r\nconst CustomerInformation: React.FC<CustomerInformationProps> = ({\r\n  customerName,\r\n  customerAddress,\r\n  customerContact,\r\n  notes = '',\r\n  onCustomerInfoChange,\r\n  errors,\r\n  customers = [],\r\n  onAddNewCustomer,\r\n  onSelectCustomer,\r\n  selectedCategoryId,\r\n  onCategoryChange,\r\n}) => {\r\n  const [showSuggestions, setShowSuggestions] = useState(false);\r\n  const [searchValue, setSearchValue] = useState(\"\");\r\n  const [selectedCustomerCategory, setSelectedCustomerCategory] = useState<string>(\"\");\r\n  const { categories } = useCustomerCategories();\r\n\r\n  // Filter customers based on search input\r\n  const filteredCustomers = customers?.filter((customer) =>\r\n    customer.fullName.toLowerCase().includes(searchValue.toLowerCase())\r\n  ) || [];\r\n\r\n  // Reset search value when customerName changes externally\r\n  useEffect(() => {\r\n    setSearchValue(customerName);\r\n\r\n    // Update customer category when customer name changes\r\n    if (customerName.trim()) {\r\n      const customer = customers.find(c => c.fullName === customerName);\r\n      if (customer && customer.categoryId) {\r\n        const category = categories.find(cat => cat.id === customer.categoryId);\r\n        setSelectedCustomerCategory(category?.name || \"\");\r\n      } else {\r\n        setSelectedCustomerCategory(\"\");\r\n      }\r\n    } else {\r\n      setSelectedCustomerCategory(\"\");\r\n    }\r\n  }, [customerName, customers, categories]);\r\n\r\n  // Update selected category display when selectedCategoryId changes\r\n  useEffect(() => {\r\n    if (selectedCategoryId) {\r\n      const category = categories.find(cat => cat.id === selectedCategoryId);\r\n      setSelectedCustomerCategory(category?.name || \"\");\r\n    } else {\r\n      setSelectedCustomerCategory(\"\");\r\n    }\r\n  }, [selectedCategoryId, categories]);\r\n\r\n  // Handle customer selection\r\n  const handleSelectCustomer = (customer: Customer) => {\r\n    setShowSuggestions(false);\r\n    if (onSelectCustomer) {\r\n      onSelectCustomer(customer);\r\n    }\r\n\r\n    // Update category when customer is selected\r\n    if (customer.categoryId) {\r\n      const category = categories.find(cat => cat.id === customer.categoryId);\r\n      setSelectedCustomerCategory(category?.name || \"\");\r\n      if (onCategoryChange) {\r\n        onCategoryChange(customer.categoryId);\r\n      }\r\n    } else {\r\n      setSelectedCustomerCategory(\"\");\r\n      if (onCategoryChange) {\r\n        onCategoryChange(\"\");\r\n      }\r\n    }\r\n  };\r\n\r\n  // Handle search input change\r\n  const handleSearchChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const value = e.target.value;\r\n    setSearchValue(value);\r\n    onCustomerInfoChange(e);\r\n\r\n    // Show suggestions when typing\r\n    if (value.trim()) {\r\n      setShowSuggestions(true);\r\n    } else {\r\n      setShowSuggestions(false);\r\n      setSelectedCustomerCategory(\"\");\r\n      if (onCategoryChange) {\r\n        onCategoryChange(\"\");\r\n      }\r\n    }\r\n  };\r\n\r\n  // Handle blur event - hide suggestions after a delay\r\n  const handleBlur = () => {\r\n    setTimeout(() => {\r\n      setShowSuggestions(false);\r\n    }, 200);\r\n  };\r\n\r\n  // Handle category selection for new customers\r\n  const handleCategorySelect = (categoryId: string) => {\r\n    if (categoryId === \"none\") {\r\n      setSelectedCustomerCategory(\"\");\r\n      if (onCategoryChange) {\r\n        onCategoryChange(\"\");\r\n      }\r\n    } else {\r\n      const category = categories.find(cat => cat.id === categoryId);\r\n      if (category) {\r\n        setSelectedCustomerCategory(category.name);\r\n        if (onCategoryChange) {\r\n          onCategoryChange(categoryId);\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  // Get category name by ID\r\n  const getCategoryName = (categoryId: string | null) => {\r\n    if (!categoryId) return null;\r\n    const category = categories.find(cat => cat.id === categoryId);\r\n    return category?.name || null;\r\n  };\r\n\r\n  // Check if this is an existing customer (has a match in customers list)\r\n  const isExistingCustomer = customerName.trim() && customers.some(c => c.fullName === customerName);\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      <h3 className=\"text-lg font-semibold\">Customer Information</h3>\r\n\r\n      <div className=\"grid gap-3\">\r\n        <Label htmlFor=\"customerName\">Customer Name</Label>\r\n        <div className=\"flex flex-col space-y-2 relative\">\r\n          <Input\r\n            id=\"customerName\"\r\n            name=\"customerName\"\r\n            value={customerName}\r\n            onChange={handleSearchChange}\r\n            onFocus={() => searchValue.trim() && setShowSuggestions(true)}\r\n            onBlur={handleBlur}\r\n            onKeyDown={(e) => {\r\n              if (e.key === 'Enter') {\r\n                e.preventDefault();\r\n                document.getElementById('customerAddress')?.focus();\r\n              }\r\n            }}\r\n            className={cn(\r\n              errors.customerName ? 'border-red-500' : '',\r\n              \"w-full\"\r\n            )}\r\n            placeholder=\"Start typing customer name...\"\r\n            autoComplete=\"off\"\r\n          />\r\n\r\n          {/* Suggestions dropdown */}\r\n          {showSuggestions && (\r\n            <div className=\"absolute top-full left-0 right-0 mt-1 bg-white dark:bg-gray-800 border rounded-md shadow-lg z-50 max-h-60 overflow-y-auto\">\r\n              {filteredCustomers.length > 0 ? (\r\n                filteredCustomers.map((customer) => {\r\n                  const categoryName = getCategoryName(customer.categoryId || null);\r\n                  return (\r\n                    <div\r\n                      key={customer.id}\r\n                      className=\"px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer border-b last:border-0 border-gray-100 dark:border-gray-700 transition-colors\"\r\n                      onMouseDown={(e) => {\r\n                        e.preventDefault(); // Prevent input blur from firing before selection\r\n                        handleSelectCustomer(customer);\r\n                      }}\r\n                    >\r\n                      <div className=\"flex items-start justify-between gap-2\">\r\n                        <div className=\"flex-1 min-w-0\">\r\n                          <div className=\"flex items-center gap-2 mb-0.5\">\r\n                            {customerName === customer.fullName && (\r\n                              <Check className=\"h-4 w-4 text-green-500 shrink-0\" />\r\n                            )}\r\n                            <span className=\"font-medium text-sm truncate uppercase tracking-tight\">\r\n                              {customer.fullName}\r\n                            </span>\r\n                            {categoryName && (\r\n                              <span className=\"text-[10px] font-bold bg-primary/10 text-primary px-1.5 py-0.5 rounded leading-none uppercase\">\r\n                                {categoryName}\r\n                              </span>\r\n                            )}\r\n                          </div>\r\n\r\n                          <div className=\"flex flex-wrap gap-x-3 gap-y-1 text-xs text-muted-foreground mt-1\">\r\n                            {customer.location && (\r\n                              <span className=\"flex items-center gap-1\">\r\n                                <span className=\"opacity-70 italic text-[11px]\">at</span> {customer.location}\r\n                              </span>\r\n                            )}\r\n                            {customer.phoneNumber && (\r\n                              <span className=\"flex items-center gap-1\">\r\n                                <span className=\"opacity-70 tabular-nums\">{customer.phoneNumber}</span>\r\n                              </span>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  );\r\n                })\r\n              ) : (\r\n                <div className=\"px-4 py-6 text-center text-muted-foreground\">\r\n                  <p className=\"text-sm\">No customers found</p>\r\n                  <p className=\"text-xs opacity-70 mt-1\">Try a different search or add a new customer</p>\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          {errors.customerName && (\r\n            <p className=\"text-red-500 text-xs\">{errors.customerName}</p>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"grid gap-3\">\r\n        <Label htmlFor=\"customerAddress\">Customer Address</Label>\r\n        <Input\r\n          id=\"customerAddress\"\r\n          name=\"customerAddress\"\r\n          value={customerAddress}\r\n          onChange={onCustomerInfoChange}\r\n          onKeyDown={(e) => {\r\n            if (e.key === 'Enter') {\r\n              e.preventDefault();\r\n              document.getElementById('customerContact')?.focus();\r\n            }\r\n          }}\r\n        />\r\n      </div>\r\n\r\n      <div className=\"grid gap-3\">\r\n        <Label htmlFor=\"customerContact\">Customer Contact</Label>\r\n        <Input\r\n          id=\"customerContact\"\r\n          name=\"customerContact\"\r\n          value={customerContact}\r\n          onChange={onCustomerInfoChange}\r\n          onKeyDown={(e) => {\r\n            if (e.key === 'Enter') {\r\n              e.preventDefault();\r\n              const categoryInput = document.getElementById('customerCategory');\r\n              const categorySelect = document.querySelector('[role=\"combobox\"]') as HTMLElement;\r\n              if (categoryInput) {\r\n                categoryInput.focus();\r\n              } else if (categorySelect) {\r\n                categorySelect.focus();\r\n              } else {\r\n                document.getElementById('description-0')?.focus();\r\n              }\r\n            }\r\n          }}\r\n        />\r\n      </div>\r\n\r\n      <div className=\"grid gap-3\">\r\n        <Label htmlFor=\"customerCategory\">Customer Category</Label>\r\n        {isExistingCustomer ? (\r\n          <Input\r\n            id=\"customerCategory\"\r\n            value={selectedCustomerCategory}\r\n            readOnly\r\n            className=\"bg-gray-50 dark:bg-gray-800\"\r\n            placeholder=\"Category from existing customer\"\r\n            onKeyDown={(e) => {\r\n              if (e.key === 'Enter') {\r\n                e.preventDefault();\r\n                document.getElementById('description-0')?.focus();\r\n              }\r\n            }}\r\n          />\r\n        ) : (\r\n          <Select\r\n            value={selectedCategoryId || \"none\"}\r\n            onValueChange={handleCategorySelect}\r\n            onOpenChange={(open) => {\r\n              if (!open) {\r\n                // When select closes, focus next field after a brief delay\r\n                setTimeout(() => {\r\n                  document.getElementById('description-0')?.focus();\r\n                }, 100);\r\n              }\r\n            }}\r\n          >\r\n            <SelectTrigger\r\n              onKeyDown={(e) => {\r\n                if (e.key === 'Enter') {\r\n                  // Let the select handle the Enter key, then focus next field\r\n                  setTimeout(() => {\r\n                    document.getElementById('description-0')?.focus();\r\n                  }, 100);\r\n                }\r\n              }}\r\n            >\r\n              <SelectValue placeholder=\"Select a category\" />\r\n            </SelectTrigger>\r\n            <SelectContent>\r\n              <SelectItem value=\"none\">No Category</SelectItem>\r\n              {categories\r\n                .filter(category => category.id && category.id.trim() !== \"\")\r\n                .map((category) => (\r\n                  <SelectItem key={category.id} value={category.id}>\r\n                    {category.name}\r\n                  </SelectItem>\r\n                ))\r\n              }\r\n            </SelectContent>\r\n          </Select>\r\n        )}\r\n      </div>\r\n\r\n\r\n      {onAddNewCustomer && (\r\n        <Button\r\n          type=\"button\"\r\n          variant=\"outline\"\r\n          onClick={onAddNewCustomer}\r\n          className=\"w-full mt-2\"\r\n        >\r\n          Add New Customer\r\n        </Button>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CustomerInformation;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 947, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/sales/SaleFormHeader.tsx"],"sourcesContent":["import React from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { ArrowLeft, RotateCcw } from 'lucide-react';\r\nimport SaleDatePicker from '@/components/sales/SaleDatePicker';\r\nimport CustomerInformation from '@/components/sales/CustomerInformation';\r\nimport { Customer, FormErrors } from '@/types';\r\n\r\ninterface SaleFormHeaderProps {\r\n  isEditing: boolean;\r\n  selectedDate: Date;\r\n  onDateChange: (date: Date) => void;\r\n  customerName: string;\r\n  customerAddress: string;\r\n  customerContact: string;\r\n  notes?: string;\r\n  onCustomerInfoChange: (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => void;\r\n  errors: FormErrors;\r\n  customers: Customer[];\r\n  onAddNewCustomer?: () => void;\r\n  onSelectCustomer: (customer: Customer) => void;\r\n  selectedCategoryId: string;\r\n  onCategoryChange: (categoryId: string) => void;\r\n  onClearForm?: () => void;\r\n}\r\n\r\nconst SaleFormHeader: React.FC<SaleFormHeaderProps> = ({\r\n  isEditing,\r\n  selectedDate,\r\n  onDateChange,\r\n  customerName,\r\n  customerAddress,\r\n  customerContact,\r\n  notes,\r\n  onCustomerInfoChange,\r\n  errors,\r\n  customers,\r\n  onAddNewCustomer,\r\n  onSelectCustomer,\r\n  selectedCategoryId,\r\n  onCategoryChange,\r\n  onClearForm,\r\n}) => {\r\n  const router = useRouter();\r\n\r\n  const handleBackClick = () => {\r\n    router.push('/sales');\r\n  };\r\n\r\n  return (\r\n    <Card className=\"mb-6\">\r\n      <CardHeader>\r\n        <div className=\"flex items-center justify-between\">\r\n          <div className=\"flex items-center gap-3\">\r\n            <Button\r\n              variant=\"ghost\"\r\n              size=\"icon\"\r\n              onClick={handleBackClick}\r\n              type=\"button\"\r\n              className=\"h-8 w-8\"\r\n            >\r\n              <ArrowLeft className=\"h-4 w-4\" />\r\n            </Button>\r\n\r\n            <div>\r\n              <CardTitle>{isEditing ? 'Edit Sale' : 'New Sale'}</CardTitle>\r\n              <CardDescription>Enter the sale details below</CardDescription>\r\n            </div>\r\n          </div>\r\n          {!isEditing && onClearForm && (\r\n            <Button\r\n              variant=\"outline\"\r\n              size=\"sm\"\r\n              onClick={onClearForm}\r\n              type=\"button\"\r\n              className=\"flex items-center gap-2\"\r\n            >\r\n              <RotateCcw className=\"h-4 w-4\" />\r\n              Clear Form\r\n            </Button>\r\n          )}\r\n        </div>\r\n      </CardHeader>\r\n      <CardContent className=\"space-y-6\">\r\n        <SaleDatePicker\r\n          selectedDate={selectedDate}\r\n          onDateChange={onDateChange}\r\n        />\r\n\r\n        <CustomerInformation\r\n          customerName={customerName}\r\n          customerAddress={customerAddress}\r\n          customerContact={customerContact}\r\n          notes={notes}\r\n          onCustomerInfoChange={onCustomerInfoChange}\r\n          errors={errors}\r\n          customers={customers}\r\n          onAddNewCustomer={onAddNewCustomer}\r\n          onSelectCustomer={onSelectCustomer}\r\n          selectedCategoryId={selectedCategoryId}\r\n          onCategoryChange={onCategoryChange}\r\n        />\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default SaleFormHeader;"],"names":[],"mappings":";;;;;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;;;;;;;;;AAqBA,MAAM,iBAAgD,CAAC,EACrD,SAAS,EACT,YAAY,EACZ,YAAY,EACZ,YAAY,EACZ,eAAe,EACf,eAAe,EACf,KAAK,EACL,oBAAoB,EACpB,MAAM,EACN,SAAS,EACT,gBAAgB,EAChB,gBAAgB,EAChB,kBAAkB,EAClB,gBAAgB,EAChB,WAAW,EACZ;;IACC,MAAM,SAAS,IAAA,kJAAS;IAExB,MAAM,kBAAkB;QACtB,OAAO,IAAI,CAAC;IACd;IAEA,qBACE,6LAAC,2IAAI;QAAC,WAAU;;0BACd,6LAAC,iJAAU;0BACT,cAAA,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BAAI,WAAU;;8CACb,6LAAC,+IAAM;oCACL,SAAQ;oCACR,MAAK;oCACL,SAAS;oCACT,MAAK;oCACL,WAAU;8CAEV,cAAA,6LAAC,gOAAS;wCAAC,WAAU;;;;;;;;;;;8CAGvB,6LAAC;;sDACC,6LAAC,gJAAS;sDAAE,YAAY,cAAc;;;;;;sDACtC,6LAAC,sJAAe;sDAAC;;;;;;;;;;;;;;;;;;wBAGpB,CAAC,aAAa,6BACb,6LAAC,+IAAM;4BACL,SAAQ;4BACR,MAAK;4BACL,SAAS;4BACT,MAAK;4BACL,WAAU;;8CAEV,6LAAC,gOAAS;oCAAC,WAAU;;;;;;gCAAY;;;;;;;;;;;;;;;;;;0BAMzC,6LAAC,kJAAW;gBAAC,WAAU;;kCACrB,6LAAC,2JAAc;wBACb,cAAc;wBACd,cAAc;;;;;;kCAGhB,6LAAC,gKAAmB;wBAClB,cAAc;wBACd,iBAAiB;wBACjB,iBAAiB;wBACjB,OAAO;wBACP,sBAAsB;wBACtB,QAAQ;wBACR,WAAW;wBACX,kBAAkB;wBAClB,kBAAkB;wBAClB,oBAAoB;wBACpB,kBAAkB;;;;;;;;;;;;;;;;;;AAK5B;GA/EM;;QAiBW,kJAAS;;;KAjBpB;uCAiFS"}},
    {"offset": {"line": 1118, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/ui/textarea.tsx"],"sourcesContent":["import * as React from \"react\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nexport interface TextareaProps\r\n  extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {}\r\n\r\nconst Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(\r\n  ({ className, ...props }, ref) => {\r\n    return (\r\n      <textarea\r\n        className={cn(\r\n          \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\r\n          className\r\n        )}\r\n        ref={ref}\r\n        {...props}\r\n      />\r\n    )\r\n  }\r\n)\r\nTextarea.displayName = \"Textarea\"\r\n\r\nexport { Textarea }\r\n"],"names":[],"mappings":";;;;;AAAA;AAEA;;;;AAKA,MAAM,yBAAW,2KAAgB,MAC/B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE;IACxB,qBACE,6LAAC;QACC,WAAW,IAAA,4HAAE,EACX,wSACA;QAEF,KAAK;QACJ,GAAG,KAAK;;;;;;AAGf;;AAEF,SAAS,WAAW,GAAG"}},
    {"offset": {"line": 1152, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/inventory/ProductImage.tsx"],"sourcesContent":["\r\nimport React from 'react';\r\nimport { Image as ImageIcon } from 'lucide-react';\r\n\r\ninterface ProductImageProps {\r\n  imageUrl?: string | null;\r\n  alt: string;\r\n  size?: 'sm' | 'md';\r\n}\r\n\r\nconst ProductImage: React.FC<ProductImageProps> = ({\r\n  imageUrl,\r\n  alt,\r\n  size = 'md'\r\n}) => {\r\n  const dimensions = size === 'sm' ? 'w-10 h-10' : 'w-12 h-12';\r\n  \r\n  if (imageUrl) {\r\n    return (\r\n      <img \r\n        src={imageUrl} \r\n        alt={alt} \r\n        className={`${dimensions} object-cover rounded-md`}\r\n      />\r\n    );\r\n  }\r\n  \r\n  return (\r\n    <div className={`${dimensions} bg-gray-100 flex items-center justify-center rounded-md`}>\r\n      <ImageIcon size={size === 'sm' ? 16 : 18} className=\"text-gray-400\" />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ProductImage;\r\n"],"names":[],"mappings":";;;;;AAEA;;;AAQA,MAAM,eAA4C,CAAC,EACjD,QAAQ,EACR,GAAG,EACH,OAAO,IAAI,EACZ;IACC,MAAM,aAAa,SAAS,OAAO,cAAc;IAEjD,IAAI,UAAU;QACZ,qBACE,6LAAC;YACC,KAAK;YACL,KAAK;YACL,WAAW,GAAG,WAAW,wBAAwB,CAAC;;;;;;IAGxD;IAEA,qBACE,6LAAC;QAAI,WAAW,GAAG,WAAW,wDAAwD,CAAC;kBACrF,cAAA,6LAAC,gNAAS;YAAC,MAAM,SAAS,OAAO,KAAK;YAAI,WAAU;;;;;;;;;;;AAG1D;KAtBM;uCAwBS"}},
    {"offset": {"line": 1200, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/ui/badge.tsx"],"sourcesContent":["\r\nimport * as React from \"react\"\r\nimport { cva, type VariantProps } from \"class-variance-authority\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst badgeVariants = cva(\r\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default:\r\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\r\n        secondary:\r\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\r\n        destructive:\r\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\r\n        outline: \"text-foreground\",\r\n        warning:\r\n          \"border-transparent bg-amber-500 text-white hover:bg-amber-600\",\r\n        success:\r\n          \"border-transparent bg-green-600 text-white hover:bg-green-700\",\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: \"default\",\r\n    },\r\n  }\r\n)\r\n\r\nexport interface BadgeProps\r\n  extends React.HTMLAttributes<HTMLDivElement>,\r\n    VariantProps<typeof badgeVariants> {}\r\n\r\nfunction Badge({ className, variant, ...props }: BadgeProps) {\r\n  return (\r\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\r\n  )\r\n}\r\n\r\nexport { Badge, badgeVariants }\r\n"],"names":[],"mappings":";;;;;;;AAEA;AAEA;;;;AAEA,MAAM,gBAAgB,IAAA,0KAAG,EACvB,0KACA;IACE,UAAU;QACR,SAAS;YACP,SACE;YACF,WACE;YACF,aACE;YACF,SAAS;YACT,SACE;YACF,SACE;QACJ;IACF;IACA,iBAAiB;QACf,SAAS;IACX;AACF;AAOF,SAAS,MAAM,EAAE,SAAS,EAAE,OAAO,EAAE,GAAG,OAAmB;IACzD,qBACE,6LAAC;QAAI,WAAW,IAAA,4HAAE,EAAC,cAAc;YAAE;QAAQ,IAAI;QAAa,GAAG,KAAK;;;;;;AAExE;KAJS"}},
    {"offset": {"line": 1250, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/ProductSaleItemInput.tsx"],"sourcesContent":["import React, { useState, useEffect, useCallback, useMemo } from 'react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Textarea } from '@/components/ui/textarea';\r\nimport { Trash2, Eye, EyeOff, Eraser } from 'lucide-react';\r\nimport { SaleItem } from '@/types';\r\nimport { formatNumber, formatNumberInput, parseNumberInput } from '@/lib/utils';\r\nimport { useBusinessSettings } from '@/hooks/useBusinessSettings';\r\nimport { Product } from '@/types';\r\nimport { getAllProductsAction } from '@/app/actions/products';\r\nimport { useAuth } from '@/components/auth/AuthProvider';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\nimport { toast } from 'sonner';\r\nimport { useIsMobile } from '@/hooks/use-mobile';\r\nimport ProductImage from '@/components/inventory/ProductImage';\r\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from '@/components/ui/tooltip';\r\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from '@/components/ui/collapsible';\r\nimport { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { useQuery } from '@tanstack/react-query';\r\n// Removed direct Supabase import\r\n\r\nimport { matchProductSearch } from '@/utils/searchUtils';\r\nimport { useFinancialVisibility } from '@/hooks/useFinancialVisibility';\r\n\r\ninterface ProductSaleItemInputProps {\r\n  item: SaleItem;\r\n  index: number;\r\n  onUpdate: (index: number, item: SaleItem) => void;\r\n  onRemove: (index: number) => void;\r\n  saleDate?: string;\r\n}\r\n\r\nconst ProductSaleItemInput: React.FC<ProductSaleItemInputProps> = ({\r\n  item,\r\n  index,\r\n  onUpdate,\r\n  onRemove,\r\n  saleDate\r\n}) => {\r\n  const {\r\n    settings\r\n  } = useBusinessSettings();\r\n  const currency = settings.currency || 'USD';\r\n  const {\r\n    user\r\n  } = useAuth();\r\n  const { currentBusiness } = useBusiness();\r\n  const { canViewCostPrice, canViewSellingPrice, formatFinancial } = useFinancialVisibility();\r\n  const [newProductName, setNewProductName] = useState<string>(item.description || '');\r\n  const isMobile = useIsMobile();\r\n  const [costVisible, setCostVisible] = useState(false);\r\n  const [showSuggestions, setShowSuggestions] = useState(false);\r\n\r\n  // Local state for numeric inputs with smart formatting (commas + decimals)\r\n  const [quantityInput, setQuantityInput] = useState(formatNumberInput(item.quantity?.toString() || '0'));\r\n  const [priceInput, setPriceInput] = useState(formatNumberInput(item.price?.toString() || '0'));\r\n  const [costInput, setCostInput] = useState(formatNumberInput(item.cost?.toString() || '0'));\r\n  const [discountAmountInput, setDiscountAmountInput] = useState(formatNumberInput(item.discountAmount?.toString() || '0'));\r\n  const [discountPercentInput, setDiscountPercentInput] = useState(formatNumberInput(item.discountPercentage?.toString() || '0'));\r\n\r\n  // Debounce search term to prevent filtering on every keystroke\r\n  const [debouncedSearchTerm, setDebouncedSearchTerm] = useState(item.description || '');\r\n\r\n  useEffect(() => {\r\n    const timer = setTimeout(() => {\r\n      setDebouncedSearchTerm(newProductName);\r\n    }, 300); // 300ms debounce\r\n    return () => clearTimeout(timer);\r\n  }, [newProductName]);\r\n\r\n  // Load all products directly with React Query (bypass useProducts filtering)\r\n  const { data: allProducts = [] } = useQuery({\r\n    queryKey: ['all-products', user?.id, currentBusiness?.id],\r\n    queryFn: async () => {\r\n      if (!user?.id || !currentBusiness?.id) return [];\r\n      return await getAllProductsAction(user.id, currentBusiness.id);\r\n    },\r\n    enabled: !!user?.id && !!currentBusiness?.id,\r\n    staleTime: 5 * 60_000, // Cache for 5 minutes\r\n  });\r\n\r\n  // Instant client-side filtering (now debounced and supporting multi-word search)\r\n  const filteredProducts = useMemo(() => {\r\n    if (!debouncedSearchTerm.trim()) {\r\n      return [];\r\n    }\r\n\r\n    return allProducts\r\n      .filter(product => matchProductSearch(product, debouncedSearchTerm))\r\n      .slice(0, 20); // Limit to 20 results for display\r\n  }, [allProducts, debouncedSearchTerm]);\r\n\r\n  // Update state when item changes (important for edit mode or external updates)\r\n  useEffect(() => {\r\n    setNewProductName(item.description || '');\r\n\r\n    // Only update local state if the numeric value actually changed from outside\r\n    // This prevents cursor jumping or formatting issues while typing\r\n    const currentQty = parseFloat(quantityInput.replace(/,/g, '')) || 0;\r\n    if (Math.abs(currentQty - item.quantity) > 0.001) {\r\n      setQuantityInput(item.quantity === 0 && quantityInput === '' ? '' : item.quantity.toString());\r\n    }\r\n\r\n    const currentPrice = parseFloat(priceInput.replace(/,/g, '')) || 0;\r\n    if (Math.abs(currentPrice - item.price) > 0.001) {\r\n      setPriceInput(item.price === 0 && priceInput === '' ? '' : item.price.toString());\r\n    }\r\n\r\n    const currentCost = parseFloat(costInput.replace(/,/g, '')) || 0;\r\n    if (Math.abs(currentCost - item.cost) > 0.001) {\r\n      setCostInput(item.cost === 0 && costInput === '' ? '' : item.cost.toString());\r\n    }\r\n\r\n    const currentDiscAmount = parseFloat(discountAmountInput.replace(/,/g, '')) || 0;\r\n    if (Math.abs(currentDiscAmount - (item.discountAmount || 0)) > 0.001) {\r\n      setDiscountAmountInput(item.discountAmount?.toString() || '0');\r\n    }\r\n\r\n    const currentDiscPercent = parseFloat(discountPercentInput.replace(/,/g, '')) || 0;\r\n    if (Math.abs(currentDiscPercent - (item.discountPercentage || 0)) > 0.001) {\r\n      setDiscountPercentInput(item.discountPercentage?.toString() || '0');\r\n    }\r\n  }, [item.description, item.quantity, item.price, item.cost, item.discountAmount, item.discountPercentage]);\r\n\r\n\r\n  // Calculate the total for this item\r\n  const subtotal = item.price * item.quantity;\r\n  const discountAmount = item.discountType === 'amount'\r\n    ? (item.discountAmount || 0)\r\n    : (subtotal * (item.discountPercentage || 0)) / 100;\r\n  const itemTotal = subtotal - discountAmount;\r\n\r\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {\r\n    const {\r\n      name,\r\n      value\r\n    } = e.target;\r\n\r\n    if (name === 'description') {\r\n      setNewProductName(value);\r\n      // Show suggestions when typing in the description field\r\n      setShowSuggestions(value.trim() !== '');\r\n      return;\r\n    }\r\n\r\n    // Handle numeric inputs with smart formatting (commas + decimals)\r\n    const formatted = formatNumberInput(value);\r\n    const numValue = parseNumberInput(value);\r\n\r\n    if (name === 'quantity') {\r\n      setQuantityInput(formatted);\r\n      onUpdate(index, { ...item, quantity: numValue });\r\n      return;\r\n    }\r\n\r\n    if (name === 'price') {\r\n      setPriceInput(formatted);\r\n      onUpdate(index, { ...item, price: numValue });\r\n      return;\r\n    }\r\n\r\n    if (name === 'cost') {\r\n      setCostInput(formatted);\r\n      onUpdate(index, { ...item, cost: numValue });\r\n      return;\r\n    }\r\n\r\n    if (name === 'discountAmount') {\r\n      setDiscountAmountInput(formatted);\r\n      onUpdate(index, { ...item, discountAmount: numValue });\r\n      return;\r\n    }\r\n\r\n    if (name === 'discountPercentage') {\r\n      setDiscountPercentInput(formatted);\r\n      onUpdate(index, { ...item, discountPercentage: numValue });\r\n      return;\r\n    }\r\n\r\n    // Default fallback\r\n    const updatedItem = {\r\n      ...item,\r\n      [name]: numValue\r\n    };\r\n    onUpdate(index, updatedItem);\r\n  };\r\n\r\n  const handleDescriptionBlur = () => {\r\n    if (newProductName !== item.description) {\r\n      onUpdate(index, { ...item, description: newProductName });\r\n    }\r\n  };\r\n\r\n\r\n  const handleTotalCostChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const value = parseNumberInput(e.target.value);\r\n    // If setting total cost, we calculate unit cost\r\n    const quantity = item.quantity || 1;\r\n    const newUnitCost = value / quantity;\r\n\r\n    // Update local state for cost with formatting\r\n    setCostInput(formatNumberInput(newUnitCost.toString()));\r\n\r\n    const updatedItem = {\r\n      ...item,\r\n      cost: newUnitCost\r\n    };\r\n    onUpdate(index, updatedItem);\r\n  };\r\n\r\n  // Toggle cost visibility\r\n  const toggleCostVisibility = () => {\r\n    setCostVisible(!costVisible);\r\n  };\r\n\r\n  // Handle clear form button click\r\n  const handleClearForm = () => {\r\n    // Reset states\r\n    setNewProductName('');\r\n    setShowSuggestions(false);\r\n\r\n    // Keep current quantity but reset everything else\r\n    const currentQuantity = item.quantity;\r\n    const clearedItem = {\r\n      ...item,\r\n      description: '',\r\n      price: 0,\r\n      cost: 0,\r\n      productId: null,\r\n      discountAmount: 0,\r\n      discountPercentage: 0\r\n    };\r\n\r\n    // Explicitly set inputs\r\n    setPriceInput('0');\r\n    setCostInput('0');\r\n    setDiscountAmountInput('0');\r\n    setDiscountPercentInput('0');\r\n    // Quantity input stays same as current valid quantity\r\n    // setQuantityInput(currentQuantity.toString()); \r\n\r\n    // Update the item\r\n    onUpdate(index, clearedItem);\r\n\r\n    toast.success('Item cleared');\r\n  };\r\n\r\n  // Handle product selection from suggestions\r\n  const handleProductSelect = (product: Product) => {\r\n    setNewProductName(product.name);\r\n    setShowSuggestions(false);\r\n\r\n    // Update local inputs with formatting\r\n    setPriceInput(formatNumberInput(product.sellingPrice.toString()));\r\n    setCostInput(formatNumberInput(product.costPrice.toString()));\r\n\r\n    const updatedItem = {\r\n      ...item,\r\n      description: product.name,\r\n      price: product.sellingPrice,\r\n      cost: product.costPrice,\r\n      productId: product.id\r\n    };\r\n    onUpdate(index, updatedItem);\r\n  };\r\n\r\n  // Check if selected product was created after the sale date\r\n  const selectedProduct = item.productId ? filteredProducts.find(p => p.id === item.productId) : null;\r\n  const showDateWarning = selectedProduct && saleDate && (() => {\r\n    const productCreatedDate = new Date(selectedProduct.createdAt);\r\n    const saleDateOnly = new Date(saleDate).setHours(0, 0, 0, 0);\r\n    const productCreatedDateOnly = new Date(productCreatedDate.getFullYear(), productCreatedDate.getMonth(), productCreatedDate.getDate()).getTime();\r\n    return productCreatedDateOnly > saleDateOnly;\r\n  })();\r\n\r\n  return (\r\n    <div className=\"space-y-4 p-4 border rounded-lg bg-gray-50\">\r\n      <div className=\"flex justify-between items-start\">\r\n        <h3 className=\"text-sm font-medium\">Item {index + 1}</h3>\r\n        <div className=\"flex space-x-2\">\r\n          {/* Clear form button */}\r\n          <Button\r\n            variant=\"outline\"\r\n            size=\"sm\"\r\n            onClick={handleClearForm}\r\n            className=\"text-gray-600 hover:text-gray-800\"\r\n          >\r\n            <Eraser className=\"h-4 w-4 mr-1\" />\r\n            <span className=\"hidden sm:inline\">Clear</span>\r\n          </Button>\r\n\r\n          <Button\r\n            variant=\"ghost\"\r\n            size=\"sm\"\r\n            onClick={() => onRemove(index)}\r\n            className=\"text-destructive hover:text-destructive\"\r\n          >\r\n            <Trash2 className=\"h-4 w-4\" />\r\n            <span className=\"sr-only\">Remove Item</span>\r\n          </Button>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"space-y-2\">\r\n        <Label htmlFor={`description-${index}`} className=\"text-sm font-medium\">Product / Service</Label>\r\n        <div className=\"flex space-x-2\">\r\n          <div className=\"flex-grow relative\">\r\n            <Textarea\r\n              id={`description-${index}`}\r\n              name=\"description\"\r\n              value={newProductName}\r\n              onChange={handleChange}\r\n              placeholder=\"Enter product name\"\r\n              onFocus={() => newProductName.trim() !== '' && setShowSuggestions(true)}\r\n              onBlur={handleDescriptionBlur}\r\n              onKeyDown={(e) => {\r\n                if (e.key === 'Enter' && !e.shiftKey) {\r\n                  e.preventDefault();\r\n                  document.getElementById(`quantity-${index}`)?.focus();\r\n                }\r\n              }}\r\n              className={isMobile ? \"min-h-16 text-base\" : \"\"}\r\n            />\r\n\r\n            {/* Display auto-suggestions when typing */}\r\n            {showSuggestions && newProductName.trim() !== '' && filteredProducts.length > 0 && (\r\n              <div className=\"absolute z-10 mt-1 w-full bg-white border rounded-md shadow-lg max-h-60 overflow-auto\">\r\n                {filteredProducts.map((product) => (\r\n                  <div\r\n                    key={product.id}\r\n                    className=\"px-4 py-2 hover:bg-gray-100 cursor-pointer flex justify-between items-center\"\r\n                    onClick={() => handleProductSelect(product)}\r\n                  >\r\n                    <div className=\"flex items-center\">\r\n                      <ProductImage imageUrl={product.imageUrl} alt={product.name} size=\"sm\" />\r\n                      <div className=\"ml-3\">\r\n                        <div className=\"font-medium flex items-center gap-2\">\r\n                          {product.name}\r\n                          {product.category && (\r\n                            <Badge variant=\"secondary\" className=\"text-[10px] px-1.5 py-0 h-4 bg-gray-100 text-gray-500 font-normal\">\r\n                              {product.category}\r\n                            </Badge>\r\n                          )}\r\n                        </div>\r\n                        <div className=\"text-xs text-gray-500\">\r\n                          {canViewSellingPrice ? `${currency} ${product.sellingPrice.toFixed(2)}` : 'Price Hidden'}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"text-xs\">\r\n                      {parseFloat(product.quantity.toFixed(5)).toString()} in stock\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Date warning */}\r\n          {showDateWarning && (\r\n            <div className=\"mt-2 p-3 bg-red-50 border border-red-200 rounded-md\">\r\n              <p className=\"text-sm text-red-700 font-medium\">\r\n                 Error: This product was created after the sale date. The sale cannot be created or updated.\r\n              </p>\r\n              <p className=\"text-xs text-red-600 mt-1\">\r\n                Please adjust the sale date or select a different product to continue.\r\n              </p>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {isMobile ? (\r\n        // Mobile layout: 2x2 grid for better touch experience\r\n        <div className=\"space-y-4\">\r\n          {/* First row: Quantity and Price */}\r\n          <div className=\"grid grid-cols-2 gap-3\">\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor={`quantity-${index}`} className=\"text-sm font-medium\">Quantity</Label>\r\n              <Input\r\n                id={`quantity-${index}`}\r\n                name=\"quantity\"\r\n                type=\"text\"\r\n                inputMode=\"decimal\"\r\n                value={quantityInput}\r\n                onChange={handleChange}\r\n                onKeyDown={(e) => {\r\n                  if (e.key === 'Enter') {\r\n                    e.preventDefault();\r\n                    document.getElementById(`price-${index}`)?.focus();\r\n                  }\r\n                }}\r\n                className=\"h-12 text-lg\"\r\n              />\r\n            </div>\r\n\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor={`price-${index}`} className=\"text-sm font-medium\">Price per unit</Label>\r\n              <Input\r\n                id={`price-${index}`}\r\n                name=\"price\"\r\n                type=\"text\"\r\n                inputMode=\"decimal\"\r\n                value={priceInput}\r\n                onChange={handleChange}\r\n                onKeyDown={(e) => {\r\n                  if (e.key === 'Enter') {\r\n                    e.preventDefault();\r\n                    const nextField = document.getElementById(`price-${index}`) as HTMLElement;\r\n                    nextField?.focus();\r\n                  }\r\n                }}\r\n                className=\"h-12 text-lg\"\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n\r\n          {/* Second row: Discount and Cost */}\r\n          <div className=\"grid grid-cols-2 gap-3\">\r\n            <div className=\"space-y-2\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <Label className=\"text-sm font-medium\">Discount</Label>\r\n                <select\r\n                  value={item.discountType || 'percentage'}\r\n                  onChange={(e) => {\r\n                    const discountType = e.target.value as 'percentage' | 'amount';\r\n                    const updatedItem = { ...item, discountType };\r\n                    if (discountType === 'percentage') {\r\n                      updatedItem.discountAmount = 0;\r\n                      setDiscountAmountInput('0');\r\n                    } else {\r\n                      updatedItem.discountPercentage = 0;\r\n                      setDiscountPercentInput('0');\r\n                    }\r\n                    onUpdate(index, updatedItem);\r\n                  }}\r\n                  className=\"flex-shrink-0 w-12 h-8 text-xs border border-input bg-background px-1 rounded-md\"\r\n                >\r\n                  <option value=\"percentage\">%</option>\r\n                  <option value=\"amount\">{currency}</option>\r\n                </select>\r\n              </div>\r\n              <Input\r\n                name={item.discountType === 'amount' ? 'discountAmount' : 'discountPercentage'}\r\n                type=\"text\"\r\n                inputMode=\"decimal\"\r\n                value={item.discountType === 'amount' ? discountAmountInput : discountPercentInput}\r\n                onChange={handleChange}\r\n                placeholder=\"0\"\r\n                onKeyDown={(e) => {\r\n                  if (e.key === 'Enter') {\r\n                    e.preventDefault();\r\n                    document.getElementById('taxRate')?.focus();\r\n                  }\r\n                }}\r\n                className=\"h-12 text-lg\"\r\n              />\r\n            </div>\r\n\r\n            {canViewCostPrice && (\r\n              <div className=\"space-y-2\">\r\n                <Collapsible open={costVisible} onOpenChange={setCostVisible}>\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <Label className=\"text-sm font-medium text-gray-500\">\r\n                      Cost Info\r\n                    </Label>\r\n                    <CollapsibleTrigger asChild>\r\n                      <Button variant=\"ghost\" size=\"sm\" className=\"p-1 h-8 w-8\">\r\n                        {costVisible ? <EyeOff className=\"h-4 w-4 text-gray-500\" /> : <Eye className=\"h-4 w-4 text-gray-500\" />}\r\n                      </Button>\r\n                    </CollapsibleTrigger>\r\n                  </div>\r\n                  <CollapsibleContent className=\"space-y-4 pt-2\">\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor={`cost-${index}`} className=\"text-xs text-gray-500\">Cost per unit</Label>\r\n                      <Input\r\n                        id={`cost-${index}`}\r\n                        name=\"cost\"\r\n                        type=\"text\"\r\n                        inputMode=\"decimal\"\r\n                        value={costInput}\r\n                        onChange={handleChange}\r\n                        className=\"h-12 text-lg\"\r\n                      />\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor={`total-cost-${index}`} className=\"text-xs text-gray-500\">Total Cost</Label>\r\n                      <Input\r\n                        id={`total-cost-${index}`}\r\n                        name=\"totalCost\"\r\n                        type=\"text\"\r\n                        inputMode=\"decimal\"\r\n                        value={formatNumber(item.cost * item.quantity)}\r\n                        onChange={handleTotalCostChange}\r\n                        className=\"h-12 text-lg font-semibold bg-gray-50\"\r\n                      />\r\n                    </div>\r\n                    <p className=\"text-xs text-muted-foreground\">(Internal use only)</p>\r\n                  </CollapsibleContent>\r\n                </Collapsible>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      ) : (\r\n        // Desktop layout: Original 4-column grid\r\n        <div className=\"grid grid-cols-4 gap-4\">\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor={`quantity-${index}`}>Quantity</Label>\r\n            <Input\r\n              id={`quantity-${index}`}\r\n              name=\"quantity\"\r\n              type=\"text\"\r\n              inputMode=\"decimal\"\r\n              value={quantityInput}\r\n              onChange={handleChange}\r\n              onKeyDown={(e) => {\r\n                if (e.key === 'Enter') {\r\n                  e.preventDefault();\r\n                  document.getElementById(`price-${index}`)?.focus();\r\n                }\r\n              }}\r\n            />\r\n          </div>\r\n\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor={`price-${index}`}>Price per unit</Label>\r\n            <Input\r\n              id={`price-${index}`}\r\n              name=\"price\"\r\n              type=\"text\"\r\n              inputMode=\"decimal\"\r\n              value={priceInput}\r\n              onChange={handleChange}\r\n              onKeyDown={(e) => {\r\n                if (e.key === 'Enter') {\r\n                  e.preventDefault();\r\n                  const nextField = document.querySelector(`input[name=\"${item.discountType === 'amount' ? 'discountAmount' : 'discountPercentage'}\"]`) as HTMLElement;\r\n                  nextField?.focus();\r\n                }\r\n              }}\r\n            />\r\n          </div>\r\n\r\n\r\n          <div className=\"space-y-2\">\r\n            <Label>Discount</Label>\r\n            <div className=\"flex gap-1\">\r\n              <select\r\n                value={item.discountType || 'percentage'}\r\n                onChange={(e) => {\r\n                  const discountType = e.target.value as 'percentage' | 'amount';\r\n                  const updatedItem = { ...item, discountType };\r\n                  if (discountType === 'percentage') {\r\n                    updatedItem.discountAmount = 0;\r\n                    setDiscountAmountInput('0');\r\n                  } else {\r\n                    updatedItem.discountPercentage = 0;\r\n                    setDiscountPercentInput('0');\r\n                  }\r\n                  onUpdate(index, updatedItem);\r\n                }}\r\n                className=\"flex-shrink-0 w-12 text-xs border border-input bg-background px-1 py-2 rounded-md\"\r\n              >\r\n                <option value=\"percentage\">%</option>\r\n                <option value=\"amount\">{currency}</option>\r\n              </select>\r\n              <Input\r\n                name={item.discountType === 'amount' ? 'discountAmount' : 'discountPercentage'}\r\n                type=\"text\"\r\n                inputMode=\"decimal\"\r\n                value={item.discountType === 'amount' ? discountAmountInput : discountPercentInput}\r\n                onChange={handleChange}\r\n                placeholder=\"0\"\r\n                onKeyDown={(e) => {\r\n                  if (e.key === 'Enter') {\r\n                    e.preventDefault();\r\n                    document.getElementById('taxRate')?.focus();\r\n                  }\r\n                }}\r\n                className=\"flex-1\"\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          {canViewCostPrice && (\r\n            <div className=\"space-y-2\">\r\n              <Popover>\r\n                <div className=\"flex items-center justify-between\">\r\n                  <Label className=\"text-gray-500\">\r\n                    Cost Info\r\n                  </Label>\r\n                  <TooltipProvider>\r\n                    <Tooltip>\r\n                      <TooltipTrigger asChild>\r\n                        <PopoverTrigger asChild>\r\n                          <Button variant=\"ghost\" size=\"sm\" className=\"p-0 h-6 w-6\">\r\n                            <Eye className=\"h-4 w-4 text-gray-500\" />\r\n                          </Button>\r\n                        </PopoverTrigger>\r\n                      </TooltipTrigger>\r\n                      <TooltipContent>\r\n                        <p>Click to view/edit cost</p>\r\n                      </TooltipContent>\r\n                    </Tooltip>\r\n                  </TooltipProvider>\r\n                </div>\r\n                <PopoverContent className=\"w-64 p-4 bg-white shadow-xl border\">\r\n                  <div className=\"space-y-4\">\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor={`cost-popover-${index}`} className=\"text-xs\">Cost per unit</Label>\r\n                      <Input\r\n                        id={`cost-popover-${index}`}\r\n                        name=\"cost\"\r\n                        type=\"text\"\r\n                        inputMode=\"decimal\"\r\n                        value={costInput}\r\n                        onChange={handleChange}\r\n                      />\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor={`total-cost-popover-${index}`} className=\"text-xs\">Total Cost (for {item.quantity} units)</Label>\r\n                      <Input\r\n                        id={`total-cost-popover-${index}`}\r\n                        name=\"totalCost\"\r\n                        type=\"text\"\r\n                        value={formatNumber(item.cost * item.quantity)}\r\n                        onChange={handleTotalCostChange}\r\n                        className=\"font-bold bg-gray-50\"\r\n                      />\r\n                    </div>\r\n                    <div className=\"pt-2 border-t\">\r\n                      <p className=\"text-[10px] text-muted-foreground\">Costs entered here only apply to this specific sale and do not change the product's base price in inventory.</p>\r\n                    </div>\r\n                  </div>\r\n                </PopoverContent>\r\n              </Popover>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {/* Item Total */}\r\n      <div className=\"pt-2 border-t mt-2\">\r\n        <div className=\"flex justify-end items-center space-y-1 flex-col\">\r\n          {((item.discountPercentage || 0) > 0 || (item.discountAmount || 0) > 0) && (\r\n            <div className=\"flex justify-end items-center w-full\">\r\n              <span className=\"text-xs text-muted-foreground mr-2\">Subtotal:</span>\r\n              <span className=\"text-xs text-muted-foreground line-through\">\r\n                {currency} {formatNumber(subtotal)}\r\n              </span>\r\n            </div>\r\n          )}\r\n          {((item.discountPercentage || 0) > 0 || (item.discountAmount || 0) > 0) && (\r\n            <div className=\"flex justify-end items-center w-full\">\r\n              <span className=\"text-xs text-green-600 mr-2\">\r\n                Discount {item.discountType === 'amount' ? '' : `(${item.discountPercentage}%)`}:\r\n              </span>\r\n              <span className=\"text-xs text-green-600\">\r\n                -{currency} {formatNumber(discountAmount)}\r\n              </span>\r\n            </div>\r\n          )}\r\n          <div className=\"flex justify-end items-center w-full\">\r\n            <span className=\"text-sm font-medium mr-2\">Total:</span>\r\n            <span className=\"text-sm font-bold\">\r\n              {currency} {formatNumber(itemTotal)}\r\n            </span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ProductSaleItemInput;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2604, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/sales/SaleItems.tsx"],"sourcesContent":["\r\nimport React from \"react\";\r\nimport { Plus } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { SaleItem } from \"@/types\";\r\nimport ProductSaleItemInput from \"@/components/ProductSaleItemInput\";\r\n\r\ninterface SaleItemsProps {\r\n  items: SaleItem[];\r\n  onAddItem: () => void;\r\n  onUpdateItem: (index: number, updatedItem: SaleItem) => void;\r\n  onRemoveItem: (index: number) => void;\r\n  saleDate?: string;\r\n}\r\n\r\nconst SaleItems: React.FC<SaleItemsProps> = ({\r\n  items,\r\n  onAddItem,\r\n  onUpdateItem,\r\n  onRemoveItem,\r\n  saleDate,\r\n}) => {\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      <h3 className=\"text-lg font-semibold\">Items/Services</h3>\r\n\r\n      <div className=\"space-y-4\">\r\n        {items.map((item, index) => (\r\n          <div\r\n            key={index}\r\n            id={`sale-item-${index}`}\r\n          >\r\n            <ProductSaleItemInput\r\n              item={item}\r\n              index={index}\r\n              onUpdate={onUpdateItem}\r\n              onRemove={onRemoveItem}\r\n              saleDate={saleDate}\r\n            />\r\n          </div>\r\n        ))}\r\n\r\n        <Button\r\n          type=\"button\"\r\n          variant=\"outline\"\r\n          size=\"sm\"\r\n          onClick={() => onAddItem()}\r\n          className=\"gap-1 w-full mt-2\"\r\n        >\r\n          <Plus className=\"h-4 w-4\" />\r\n          Add Item\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SaleItems;\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAEA;;;;;AAUA,MAAM,YAAsC,CAAC,EAC3C,KAAK,EACL,SAAS,EACT,YAAY,EACZ,YAAY,EACZ,QAAQ,EACT;IACC,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC;gBAAG,WAAU;0BAAwB;;;;;;0BAEtC,6LAAC;gBAAI,WAAU;;oBACZ,MAAM,GAAG,CAAC,CAAC,MAAM,sBAChB,6LAAC;4BAEC,IAAI,CAAC,UAAU,EAAE,OAAO;sCAExB,cAAA,6LAAC,wJAAoB;gCACnB,MAAM;gCACN,OAAO;gCACP,UAAU;gCACV,UAAU;gCACV,UAAU;;;;;;2BARP;;;;;kCAaT,6LAAC,+IAAM;wBACL,MAAK;wBACL,SAAQ;wBACR,MAAK;wBACL,SAAS,IAAM;wBACf,WAAU;;0CAEV,6LAAC,6MAAI;gCAAC,WAAU;;;;;;4BAAY;;;;;;;;;;;;;;;;;;;AAMtC;KAxCM;uCA0CS"}},
    {"offset": {"line": 2694, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/sales/TaxRateInput.tsx"],"sourcesContent":["\r\nimport React from \"react\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\n\r\ninterface TaxRateInputProps {\r\n  taxRateInput: string;\r\n  onTaxRateChange: (e: React.ChangeEvent<HTMLInputElement>) => void;\r\n  errors: {\r\n    taxRate?: string;\r\n  };\r\n}\r\n\r\nconst TaxRateInput: React.FC<TaxRateInputProps> = ({\r\n  taxRateInput,\r\n  onTaxRateChange,\r\n  errors,\r\n}) => {\r\n  return (\r\n    <div className=\"grid gap-3\">\r\n      <Label htmlFor=\"taxRate\">Tax Rate (%)</Label>\r\n      <Input\r\n        id=\"taxRate\"\r\n        name=\"taxRate\"\r\n        type=\"text\"\r\n        inputMode=\"decimal\"\r\n        value={taxRateInput}\r\n        onChange={onTaxRateChange}\r\n        onKeyDown={(e) => {\r\n          if (e.key === 'Enter') {\r\n            e.preventDefault();\r\n            // Focus the payment status selector\r\n            const paymentStatusSelect = document.querySelector('[data-payment-status-select=\"true\"]') as HTMLElement;\r\n            if (paymentStatusSelect) {\r\n              paymentStatusSelect.focus();\r\n            } else {\r\n              // Fallback to submit button\r\n              const submitButton = document.querySelector('button[type=\"submit\"]') as HTMLElement;\r\n              submitButton?.focus();\r\n            }\r\n          }\r\n        }}\r\n        className={errors.taxRate ? 'border-red-500' : ''}\r\n      />\r\n      {errors.taxRate && (\r\n        <p className=\"text-red-500 text-xs\">{errors.taxRate}</p>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default TaxRateInput;\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;;;;AAUA,MAAM,eAA4C,CAAC,EACjD,YAAY,EACZ,eAAe,EACf,MAAM,EACP;IACC,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC,6IAAK;gBAAC,SAAQ;0BAAU;;;;;;0BACzB,6LAAC,6IAAK;gBACJ,IAAG;gBACH,MAAK;gBACL,MAAK;gBACL,WAAU;gBACV,OAAO;gBACP,UAAU;gBACV,WAAW,CAAC;oBACV,IAAI,EAAE,GAAG,KAAK,SAAS;wBACrB,EAAE,cAAc;wBAChB,oCAAoC;wBACpC,MAAM,sBAAsB,SAAS,aAAa,CAAC;wBACnD,IAAI,qBAAqB;4BACvB,oBAAoB,KAAK;wBAC3B,OAAO;4BACL,4BAA4B;4BAC5B,MAAM,eAAe,SAAS,aAAa,CAAC;4BAC5C,cAAc;wBAChB;oBACF;gBACF;gBACA,WAAW,OAAO,OAAO,GAAG,mBAAmB;;;;;;YAEhD,OAAO,OAAO,kBACb,6LAAC;gBAAE,WAAU;0BAAwB,OAAO,OAAO;;;;;;;;;;;;AAI3D;KApCM;uCAsCS"}},
    {"offset": {"line": 2769, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/sales/SaleTotals.tsx"],"sourcesContent":["\r\nimport React from \"react\";\r\nimport { formatNumber } from \"@/lib/utils\";\r\n\r\ninterface SaleTotalsProps {\r\n  totalAmount: number;\r\n  taxAmount: number;\r\n  grandTotal: number;\r\n  taxRate: number;\r\n  currency: string;\r\n}\r\n\r\nconst SaleTotals: React.FC<SaleTotalsProps> = ({\r\n  totalAmount,\r\n  taxAmount,\r\n  grandTotal,\r\n  taxRate,\r\n  currency,\r\n}) => {\r\n  // Check if we should show the tax row\r\n  const showTaxRow = taxRate > 0;\r\n\r\n  return (\r\n    <div className=\"bg-slate-50 p-4 rounded-md border\">\r\n      <div className=\"flex flex-col space-y-2\">\r\n        <div className=\"flex justify-between items-center bg-gray-100 px-2 py-1 rounded-sm\">\r\n          <h3 className=\"font-medium\">Subtotal</h3>\r\n          <span className=\"font-medium\">\r\n            {currency} {formatNumber(totalAmount)}\r\n          </span>\r\n        </div>\r\n        {showTaxRow && (\r\n          <div className=\"flex justify-between items-center bg-gray-100 px-2 py-1 rounded-sm\">\r\n            <h3 className=\"font-medium\">Tax ({taxRate}%)</h3>\r\n            <span className=\"font-medium\">\r\n              {currency} {formatNumber(taxAmount)}\r\n            </span>\r\n          </div>\r\n        )}\r\n        <div className=\"h-px bg-gray-300 my-1\"></div>\r\n        <div className=\"flex justify-between items-center bg-gray-100 px-2 py-1 rounded-sm\">\r\n          <h3 className=\"font-semibold\">Grand Total</h3>\r\n          <span className=\"text-xl font-bold\">\r\n            {currency} {formatNumber(grandTotal)}\r\n          </span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SaleTotals;\r\n"],"names":[],"mappings":";;;;;AAEA;;;AAUA,MAAM,aAAwC,CAAC,EAC7C,WAAW,EACX,SAAS,EACT,UAAU,EACV,OAAO,EACP,QAAQ,EACT;IACC,sCAAsC;IACtC,MAAM,aAAa,UAAU;IAE7B,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC;YAAI,WAAU;;8BACb,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BAAG,WAAU;sCAAc;;;;;;sCAC5B,6LAAC;4BAAK,WAAU;;gCACb;gCAAS;gCAAE,IAAA,sIAAY,EAAC;;;;;;;;;;;;;gBAG5B,4BACC,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BAAG,WAAU;;gCAAc;gCAAM;gCAAQ;;;;;;;sCAC1C,6LAAC;4BAAK,WAAU;;gCACb;gCAAS;gCAAE,IAAA,sIAAY,EAAC;;;;;;;;;;;;;8BAI/B,6LAAC;oBAAI,WAAU;;;;;;8BACf,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BAAG,WAAU;sCAAgB;;;;;;sCAC9B,6LAAC;4BAAK,WAAU;;gCACb;gCAAS;gCAAE,IAAA,sIAAY,EAAC;;;;;;;;;;;;;;;;;;;;;;;;AAMrC;KArCM;uCAuCS"}},
    {"offset": {"line": 2906, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/sales/SaleItemsManager.tsx"],"sourcesContent":["import React from 'react';\r\nimport { Card, CardContent } from '@/components/ui/card';\r\nimport SaleItems from '@/components/sales/SaleItems';\r\nimport TaxRateInput from '@/components/sales/TaxRateInput';\r\nimport SaleTotals from '@/components/sales/SaleTotals';\r\nimport { SaleItem, FormErrors } from '@/types';\r\n\r\ninterface SaleItemsManagerProps {\r\n  items: SaleItem[];\r\n  onAddItem: () => void;\r\n  onUpdateItem: (index: number, updatedItem: SaleItem) => void;\r\n  onRemoveItem: (index: number) => void;\r\n  taxRateInput: string;\r\n  onTaxRateChange: (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => void;\r\n  errors: FormErrors;\r\n  totalAmount: number;\r\n  taxAmount: number;\r\n  grandTotal: number;\r\n  taxRate: number;\r\n  currency: string;\r\n  saleDate?: string;\r\n}\r\n\r\nconst SaleItemsManager: React.FC<SaleItemsManagerProps> = ({\r\n  items,\r\n  onAddItem,\r\n  onUpdateItem,\r\n  onRemoveItem,\r\n  taxRateInput,\r\n  onTaxRateChange,\r\n  errors,\r\n  totalAmount,\r\n  taxAmount,\r\n  grandTotal,\r\n  taxRate,\r\n  currency,\r\n  saleDate,\r\n}) => {\r\n  // Track previous items to detect changes\r\n  const prevItemsRef = React.useRef<SaleItem[]>(items);\r\n\r\n  // Auto-scroll to the SPECIFIC item that was added or updated\r\n  React.useEffect(() => {\r\n    const prevItems = prevItemsRef.current;\r\n\r\n    // Find the index of the item that changed\r\n    let changedIndex = -1;\r\n\r\n    // Case 1: Item added (new array is longer)\r\n    if (items.length > prevItems.length) {\r\n      changedIndex = items.length - 1;\r\n    }\r\n    // Case 2: Item updated (length same, check quantities)\r\n    else if (items.length === prevItems.length) {\r\n      changedIndex = items.findIndex((item, index) => {\r\n        const prevItem = prevItems[index];\r\n        return prevItem && item.quantity !== prevItem.quantity;\r\n      });\r\n    }\r\n\r\n    // Update previous ref for next render\r\n    prevItemsRef.current = items;\r\n\r\n    // Perform scroll if a change was detected\r\n    if (changedIndex !== -1) {\r\n      // Use setTimeout to ensure DOM has updated\r\n      setTimeout(() => {\r\n        const element = document.getElementById(`sale-item-${changedIndex}`);\r\n        if (element) {\r\n          element.scrollIntoView({ behavior: 'smooth', block: 'center' });\r\n        }\r\n      }, 150);\r\n    }\r\n  }, [items]);\r\n\r\n  return (\r\n    <Card className=\"mb-6\">\r\n      <CardContent className=\"pt-6 space-y-6\">\r\n        <SaleItems\r\n          items={items}\r\n          onAddItem={onAddItem}\r\n          onUpdateItem={onUpdateItem}\r\n          onRemoveItem={onRemoveItem}\r\n          saleDate={saleDate}\r\n        />\r\n\r\n        <TaxRateInput\r\n          taxRateInput={taxRateInput}\r\n          onTaxRateChange={onTaxRateChange}\r\n          errors={errors}\r\n        />\r\n\r\n        <SaleTotals\r\n          totalAmount={totalAmount}\r\n          taxAmount={taxAmount}\r\n          grandTotal={grandTotal}\r\n          taxRate={taxRate}\r\n          currency={currency}\r\n        />\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default SaleItemsManager;"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AACA;AACA;;;;;;;;AAmBA,MAAM,mBAAoD,CAAC,EACzD,KAAK,EACL,SAAS,EACT,YAAY,EACZ,YAAY,EACZ,YAAY,EACZ,eAAe,EACf,MAAM,EACN,WAAW,EACX,SAAS,EACT,UAAU,EACV,OAAO,EACP,QAAQ,EACR,QAAQ,EACT;;IACC,yCAAyC;IACzC,MAAM,eAAe,wKAAK,CAAC,MAAM,CAAa;IAE9C,6DAA6D;IAC7D,wKAAK,CAAC,SAAS;sCAAC;YACd,MAAM,YAAY,aAAa,OAAO;YAEtC,0CAA0C;YAC1C,IAAI,eAAe,CAAC;YAEpB,2CAA2C;YAC3C,IAAI,MAAM,MAAM,GAAG,UAAU,MAAM,EAAE;gBACnC,eAAe,MAAM,MAAM,GAAG;YAChC,OAEK,IAAI,MAAM,MAAM,KAAK,UAAU,MAAM,EAAE;gBAC1C,eAAe,MAAM,SAAS;kDAAC,CAAC,MAAM;wBACpC,MAAM,WAAW,SAAS,CAAC,MAAM;wBACjC,OAAO,YAAY,KAAK,QAAQ,KAAK,SAAS,QAAQ;oBACxD;;YACF;YAEA,sCAAsC;YACtC,aAAa,OAAO,GAAG;YAEvB,0CAA0C;YAC1C,IAAI,iBAAiB,CAAC,GAAG;gBACvB,2CAA2C;gBAC3C;kDAAW;wBACT,MAAM,UAAU,SAAS,cAAc,CAAC,CAAC,UAAU,EAAE,cAAc;wBACnE,IAAI,SAAS;4BACX,QAAQ,cAAc,CAAC;gCAAE,UAAU;gCAAU,OAAO;4BAAS;wBAC/D;oBACF;iDAAG;YACL;QACF;qCAAG;QAAC;KAAM;IAEV,qBACE,6LAAC,2IAAI;QAAC,WAAU;kBACd,cAAA,6LAAC,kJAAW;YAAC,WAAU;;8BACrB,6LAAC,sJAAS;oBACR,OAAO;oBACP,WAAW;oBACX,cAAc;oBACd,cAAc;oBACd,UAAU;;;;;;8BAGZ,6LAAC,yJAAY;oBACX,cAAc;oBACd,iBAAiB;oBACjB,QAAQ;;;;;;8BAGV,6LAAC,uJAAU;oBACT,aAAa;oBACb,WAAW;oBACX,YAAY;oBACZ,SAAS;oBACT,UAAU;;;;;;;;;;;;;;;;;AAKpB;GA/EM;KAAA;uCAiFS"}},
    {"offset": {"line": 3025, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/sales/PaymentStatusSelector.tsx"],"sourcesContent":["\r\nimport React from \"react\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\n\r\ninterface PaymentStatusSelectorProps {\r\n  paymentStatus: string;\r\n  onPaymentStatusChange: (value: string) => void;\r\n}\r\n\r\nconst PaymentStatusSelector: React.FC<PaymentStatusSelectorProps> = ({\r\n  paymentStatus,\r\n  onPaymentStatusChange,\r\n}) => {\r\n  return (\r\n    <div className=\"grid gap-3\">\r\n      <Label htmlFor=\"paymentStatus\">Payment Status</Label>\r\n      <Select\r\n        value={paymentStatus}\r\n        onValueChange={onPaymentStatusChange}\r\n      >\r\n        <SelectTrigger \r\n          className=\"w-full\"\r\n          data-payment-status-select=\"true\"\r\n          onKeyDown={(e) => {\r\n            if (e.key === 'Enter') {\r\n              e.preventDefault();\r\n              // Focus the cash account switch\r\n              const cashAccountSwitch = document.querySelector('[data-cash-account-switch=\"true\"]') as HTMLElement;\r\n              if (cashAccountSwitch) {\r\n                cashAccountSwitch.focus();\r\n              } else {\r\n                // Fallback to submit button if no cash account section\r\n                const submitButton = document.querySelector('button[type=\"submit\"]') as HTMLElement;\r\n                submitButton?.focus();\r\n              }\r\n            }\r\n          }}\r\n        >\r\n          <SelectValue placeholder=\"Select payment status\" />\r\n        </SelectTrigger>\r\n        <SelectContent>\r\n          <SelectItem value=\"Paid\">Paid</SelectItem>\r\n          <SelectItem value=\"NOT PAID\">NOT PAID</SelectItem>\r\n          <SelectItem value=\"Quote\">Quote</SelectItem>\r\n          <SelectItem value=\"Installment Sale\">Installment Sale</SelectItem>\r\n        </SelectContent>\r\n      </Select>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PaymentStatusSelector;\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;;;;AAOA,MAAM,wBAA8D,CAAC,EACnE,aAAa,EACb,qBAAqB,EACtB;IACC,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC,6IAAK;gBAAC,SAAQ;0BAAgB;;;;;;0BAC/B,6LAAC,+IAAM;gBACL,OAAO;gBACP,eAAe;;kCAEf,6LAAC,sJAAa;wBACZ,WAAU;wBACV,8BAA2B;wBAC3B,WAAW,CAAC;4BACV,IAAI,EAAE,GAAG,KAAK,SAAS;gCACrB,EAAE,cAAc;gCAChB,gCAAgC;gCAChC,MAAM,oBAAoB,SAAS,aAAa,CAAC;gCACjD,IAAI,mBAAmB;oCACrB,kBAAkB,KAAK;gCACzB,OAAO;oCACL,uDAAuD;oCACvD,MAAM,eAAe,SAAS,aAAa,CAAC;oCAC5C,cAAc;gCAChB;4BACF;wBACF;kCAEA,cAAA,6LAAC,oJAAW;4BAAC,aAAY;;;;;;;;;;;kCAE3B,6LAAC,sJAAa;;0CACZ,6LAAC,mJAAU;gCAAC,OAAM;0CAAO;;;;;;0CACzB,6LAAC,mJAAU;gCAAC,OAAM;0CAAW;;;;;;0CAC7B,6LAAC,mJAAU;gCAAC,OAAM;0CAAQ;;;;;;0CAC1B,6LAAC,mJAAU;gCAAC,OAAM;0CAAmB;;;;;;;;;;;;;;;;;;;;;;;;AAK/C;KAxCM;uCA0CS"}},
    {"offset": {"line": 3144, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/ui/table.tsx"],"sourcesContent":["import * as React from \"react\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst Table = React.forwardRef<\r\n  HTMLTableElement,\r\n  React.HTMLAttributes<HTMLTableElement>\r\n>(({ className, ...props }, ref) => (\r\n  <div className=\"relative w-full overflow-auto\">\r\n    <table\r\n      ref={ref}\r\n      className={cn(\"w-full caption-bottom text-sm\", className)}\r\n      {...props}\r\n    />\r\n  </div>\r\n))\r\nTable.displayName = \"Table\"\r\n\r\nconst TableHeader = React.forwardRef<\r\n  HTMLTableSectionElement,\r\n  React.HTMLAttributes<HTMLTableSectionElement>\r\n>(({ className, ...props }, ref) => (\r\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\r\n))\r\nTableHeader.displayName = \"TableHeader\"\r\n\r\nconst TableBody = React.forwardRef<\r\n  HTMLTableSectionElement,\r\n  React.HTMLAttributes<HTMLTableSectionElement>\r\n>(({ className, ...props }, ref) => (\r\n  <tbody\r\n    ref={ref}\r\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\r\n    {...props}\r\n  />\r\n))\r\nTableBody.displayName = \"TableBody\"\r\n\r\nconst TableFooter = React.forwardRef<\r\n  HTMLTableSectionElement,\r\n  React.HTMLAttributes<HTMLTableSectionElement>\r\n>(({ className, ...props }, ref) => (\r\n  <tfoot\r\n    ref={ref}\r\n    className={cn(\r\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nTableFooter.displayName = \"TableFooter\"\r\n\r\nconst TableRow = React.forwardRef<\r\n  HTMLTableRowElement,\r\n  React.HTMLAttributes<HTMLTableRowElement>\r\n>(({ className, ...props }, ref) => (\r\n  <tr\r\n    ref={ref}\r\n    className={cn(\r\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nTableRow.displayName = \"TableRow\"\r\n\r\nconst TableHead = React.forwardRef<\r\n  HTMLTableCellElement,\r\n  React.ThHTMLAttributes<HTMLTableCellElement>\r\n>(({ className, ...props }, ref) => (\r\n  <th\r\n    ref={ref}\r\n    className={cn(\r\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nTableHead.displayName = \"TableHead\"\r\n\r\nconst TableCell = React.forwardRef<\r\n  HTMLTableCellElement,\r\n  React.TdHTMLAttributes<HTMLTableCellElement>\r\n>(({ className, ...props }, ref) => (\r\n  <td\r\n    ref={ref}\r\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\r\n    {...props}\r\n  />\r\n))\r\nTableCell.displayName = \"TableCell\"\r\n\r\nconst TableCaption = React.forwardRef<\r\n  HTMLTableCaptionElement,\r\n  React.HTMLAttributes<HTMLTableCaptionElement>\r\n>(({ className, ...props }, ref) => (\r\n  <caption\r\n    ref={ref}\r\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\r\n    {...props}\r\n  />\r\n))\r\nTableCaption.displayName = \"TableCaption\"\r\n\r\nexport {\r\n  Table,\r\n  TableHeader,\r\n  TableBody,\r\n  TableFooter,\r\n  TableHead,\r\n  TableRow,\r\n  TableCell,\r\n  TableCaption,\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAAA;AAEA;;;;AAEA,MAAM,sBAAQ,2KAAgB,MAG5B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC;YACC,KAAK;YACL,WAAW,IAAA,4HAAE,EAAC,iCAAiC;YAC9C,GAAG,KAAK;;;;;;;;;;;;AAIf,MAAM,WAAW,GAAG;AAEpB,MAAM,4BAAc,2KAAgB,OAGlC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QAAM,KAAK;QAAK,WAAW,IAAA,4HAAE,EAAC,mBAAmB;QAAa,GAAG,KAAK;;;;;;;AAEzE,YAAY,WAAW,GAAG;AAE1B,MAAM,0BAAY,2KAAgB,OAGhC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,4HAAE,EAAC,8BAA8B;QAC3C,GAAG,KAAK;;;;;;;AAGb,UAAU,WAAW,GAAG;AAExB,MAAM,4BAAc,2KAAgB,OAGlC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,4HAAE,EACX,2DACA;QAED,GAAG,KAAK;;;;;;;AAGb,YAAY,WAAW,GAAG;AAE1B,MAAM,yBAAW,2KAAgB,OAG/B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,4HAAE,EACX,+EACA;QAED,GAAG,KAAK;;;;;;;AAGb,SAAS,WAAW,GAAG;AAEvB,MAAM,0BAAY,2KAAgB,QAGhC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,4HAAE,EACX,oGACA;QAED,GAAG,KAAK;;;;;;;AAGb,UAAU,WAAW,GAAG;AAExB,MAAM,0BAAY,2KAAgB,QAGhC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,4HAAE,EAAC,kDAAkD;QAC/D,GAAG,KAAK;;;;;;;AAGb,UAAU,WAAW,GAAG;AAExB,MAAM,6BAAe,2KAAgB,QAGnC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,4HAAE,EAAC,sCAAsC;QACnD,GAAG,KAAK;;;;;;;AAGb,aAAa,WAAW,GAAG"}},
    {"offset": {"line": 3288, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/sales/InstallmentPaymentHistory.tsx"],"sourcesContent":["import React, { useState } from 'react';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Calendar } from '@/components/ui/calendar';\r\nimport { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover';\r\nimport { formatNumber, cn } from '@/lib/utils';\r\nimport { InstallmentPayment } from '@/hooks/useInstallmentPayments';\r\nimport { PaymentChange } from '@/hooks/useLocalPaymentChanges';\r\nimport { format } from 'date-fns';\r\nimport { Trash2, Clock, Check, X, Edit3, Link, CalendarIcon } from 'lucide-react';\r\n\r\ninterface CashAccount {\r\n  id: string;\r\n  name: string;\r\n  description?: string;\r\n  isDefault: boolean;\r\n}\r\n\r\ninterface InstallmentPaymentHistoryProps {\r\n  payments: InstallmentPayment[];\r\n  currency: string;\r\n  isLoading?: boolean;\r\n  pendingChanges?: PaymentChange[];\r\n  isLocalMode?: boolean;\r\n  onStageChange?: (change: PaymentChange) => void;\r\n  cashAccounts?: CashAccount[];\r\n  onLinkToCash?: (paymentId: string, accountId: string) => Promise<void>;\r\n  onUpdatePayment?: (paymentId: string, updates: { amount?: number; notes?: string; paymentDate?: Date }) => Promise<void>;\r\n}\r\n\r\nconst InstallmentPaymentHistory: React.FC<InstallmentPaymentHistoryProps> = ({\r\n  payments,\r\n  currency,\r\n  isLoading,\r\n  pendingChanges = [],\r\n  isLocalMode = false,\r\n  onStageChange,\r\n  cashAccounts = [],\r\n  onLinkToCash,\r\n  onUpdatePayment,\r\n}) => {\r\n  const [editingPayment, setEditingPayment] = useState<string | null>(null);\r\n  const [editingField, setEditingField] = useState<'amount' | 'notes' | 'date' | null>(null);\r\n  const [editAmount, setEditAmount] = useState<string>(''); // Changed to string to allow empty value\r\n  const [editNotes, setEditNotes] = useState<string>('');\r\n  const [editDate, setEditDate] = useState<Date | undefined>(undefined);\r\n  const [linkingPayment, setLinkingPayment] = useState<string | null>(null);\r\n  const [selectedAccountId, setSelectedAccountId] = useState<string>('');\r\n\r\n  const handleStartEdit = (payment: InstallmentPayment, field?: 'amount' | 'notes' | 'date') => {\r\n    setEditingPayment(payment.id);\r\n    setEditingField(field || null);\r\n    setEditAmount(getDisplayAmount(payment).toString()); // Convert to string\r\n    setEditNotes(getDisplayNotes(payment) || '');\r\n    setEditDate(payment.paymentDate);\r\n  };\r\n\r\n  const handleDoubleClickAmount = (payment: InstallmentPayment) => {\r\n    if (!isLocalMode || !onStageChange) return;\r\n    const status = getPaymentStatus(payment.id);\r\n    if (status === 'deleted') return;\r\n    \r\n    handleStartEdit(payment, 'amount');\r\n  };\r\n\r\n  const handleDoubleClickNotes = (payment: InstallmentPayment) => {\r\n    if (!isLocalMode || !onStageChange) return;\r\n    const status = getPaymentStatus(payment.id);\r\n    if (status === 'deleted') return;\r\n    \r\n    handleStartEdit(payment, 'notes');\r\n  };\r\n\r\n  const handleDoubleClickDate = async (payment: InstallmentPayment) => {\r\n    if (!onUpdatePayment) return;\r\n    const status = getPaymentStatus(payment.id);\r\n    if (status === 'deleted') return;\r\n    \r\n    handleStartEdit(payment, 'date');\r\n  };\r\n\r\n  const handleDateSelect = async (payment: InstallmentPayment, date: Date | undefined) => {\r\n    if (!date || !onUpdatePayment) return;\r\n    \r\n    console.log(' Date selected:', {\r\n      paymentId: payment.id,\r\n      oldDate: payment.paymentDate,\r\n      newDate: date,\r\n      formattedNew: format(date, 'yyyy-MM-dd')\r\n    });\r\n    \r\n    try {\r\n      await onUpdatePayment(payment.id, { paymentDate: date });\r\n      console.log(' Date update successful');\r\n      \r\n      // Update local state immediately for instant UI feedback\r\n      if (onStageChange) {\r\n        onStageChange({\r\n          id: payment.id,\r\n          type: 'update',\r\n          originalPayment: payment,\r\n          updatedData: { paymentDate: date }\r\n        });\r\n      }\r\n      \r\n      // Clear editing state only after successful update\r\n      setEditingPayment(null);\r\n      setEditingField(null);\r\n      setEditDate(undefined);\r\n    } catch (error) {\r\n      console.error(' Error updating payment date:', error);\r\n      // Reset to original date on error\r\n      setEditDate(payment.paymentDate);\r\n    }\r\n  };\r\n\r\n  const handleSaveEdit = async (payment: InstallmentPayment) => {\r\n    if (!onStageChange && !onUpdatePayment) return;\r\n\r\n    // Convert string back to number, default to 0 if empty or invalid\r\n    const numericAmount = editAmount === '' ? 0 : parseFloat(editAmount) || 0;\r\n\r\n    if (onStageChange) {\r\n      // Local mode - stage the update\r\n      onStageChange({\r\n        id: payment.id,\r\n        type: 'update',\r\n        originalPayment: payment,\r\n        updatedData: {\r\n          amount: numericAmount,\r\n          notes: editNotes.trim() || undefined\r\n        }\r\n      });\r\n    } else if (onUpdatePayment) {\r\n      // Direct update mode - skip date updates as they're handled separately\r\n      await onUpdatePayment(payment.id, {\r\n        amount: editingField === 'amount' ? numericAmount : undefined,\r\n        notes: editingField === 'notes' ? (editNotes.trim() || undefined) : undefined,\r\n      });\r\n    }\r\n\r\n    setEditingPayment(null);\r\n    setEditingField(null);\r\n  };\r\n\r\n  const handleCancelEdit = () => {\r\n    setEditingPayment(null);\r\n    setEditingField(null);\r\n    setEditAmount('');\r\n    setEditNotes('');\r\n    setEditDate(undefined);\r\n  };\r\n\r\n  const handleStageDelete = (payment: InstallmentPayment) => {\r\n    if (!onStageChange) return;\r\n    \r\n    // Show different confirmation messages based on payment amount\r\n    const isZeroPayment = payment.amount === 0;\r\n    const confirmMessage = isZeroPayment \r\n      ? 'Are you sure you want to remove this zero-amount payment entry?'\r\n      : 'Are you sure you want to mark this payment for deletion?';\r\n    \r\n    if (window.confirm(confirmMessage)) {\r\n      console.log(' STAGING deletion locally - NO DATABASE CALL');\r\n      \r\n      // Stage the deletion directly without any async operations\r\n      onStageChange({\r\n        id: payment.id,\r\n        type: 'delete',\r\n        originalPayment: payment\r\n      });\r\n      \r\n      console.log(' Deletion staged successfully');\r\n    }\r\n  };\r\n\r\n  const getPaymentStatus = (paymentId: string) => {\r\n    const change = pendingChanges.find(c => c.id === paymentId);\r\n    if (change?.type === 'delete') return 'deleted';\r\n    if (change?.type === 'update') return 'modified';\r\n    return 'original';\r\n  };\r\n\r\n  const getDisplayAmount = (payment: InstallmentPayment) => {\r\n    const change = pendingChanges.find(c => c.id === payment.id && c.type === 'update');\r\n    return change?.updatedData?.amount || payment.amount;\r\n  };\r\n\r\n  const getDisplayNotes = (payment: InstallmentPayment) => {\r\n    const change = pendingChanges.find(c => c.id === payment.id && c.type === 'update');\r\n    return change?.updatedData?.notes || payment.notes;\r\n  };\r\n\r\n  // Helper function to check if a payment can be deleted\r\n  const canDeletePayment = (payment: InstallmentPayment) => {\r\n    if (!isLocalMode || !onStageChange) return false;\r\n    const status = getPaymentStatus(payment.id);\r\n    return status !== 'deleted'; // Allow deletion of any payment that's not already marked for deletion\r\n  };\r\n\r\n  const handleStartCashLink = (paymentId: string) => {\r\n    setLinkingPayment(paymentId);\r\n    setSelectedAccountId('');\r\n  };\r\n\r\n  const handleCancelCashLink = () => {\r\n    setLinkingPayment(null);\r\n    setSelectedAccountId('');\r\n  };\r\n\r\n  const handleConfirmCashLink = async (payment: InstallmentPayment) => {\r\n    if (!onLinkToCash || !selectedAccountId) return;\r\n    \r\n    try {\r\n      await onLinkToCash(payment.id, selectedAccountId);\r\n      setLinkingPayment(null);\r\n      setSelectedAccountId('');\r\n    } catch (error) {\r\n      console.error('Error linking payment to cash account:', error);\r\n    }\r\n  };\r\n\r\n  const getCashAccountName = (cashTransactionId?: string) => {\r\n    if (!cashTransactionId) return null;\r\n    // This is a simplified version - in a real implementation, you might want to\r\n    // fetch the actual account name or pass it as part of the payment data\r\n    return 'Linked';\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <Card className=\"border-blue-200 bg-blue-50\">\r\n        <CardHeader className=\"pb-3\">\r\n          <CardTitle className=\"text-sm text-blue-800\">Payment History</CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"text-sm text-muted-foreground\">Loading payment history...</div>\r\n        </CardContent>\r\n      </Card>\r\n    );\r\n  }\r\n\r\n  if (payments.length === 0) {\r\n    return (\r\n      <Card className=\"border-blue-200 bg-blue-50\">\r\n        <CardHeader className=\"pb-3\">\r\n          <CardTitle className=\"text-sm text-blue-800\">Payment History</CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"text-sm text-muted-foreground\">No payments recorded yet</div>\r\n        </CardContent>\r\n      </Card>\r\n    );\r\n  }\r\n\r\n  const totalPaid = payments.reduce((sum, payment) => {\r\n    const status = getPaymentStatus(payment.id);\r\n    if (status === 'deleted') return sum;\r\n    return sum + getDisplayAmount(payment);\r\n  }, 0);\r\n\r\n  const showInlineEdit = isLocalMode && onStageChange;\r\n  console.log('InstallmentPaymentHistory - isLocalMode:', isLocalMode, 'onStageChange:', !!onStageChange, 'showInlineEdit:', showInlineEdit);\r\n\r\n  return (\r\n    <Card className=\"border-blue-200 bg-blue-50\">\r\n      <CardHeader className=\"pb-3\">\r\n        <CardTitle className=\"text-sm text-blue-800 flex items-center justify-between\">\r\n          <div className=\"flex items-center gap-2\">\r\n            Payment History\r\n            {isLocalMode && <Clock className=\"h-3 w-3 text-amber-600\" />}\r\n            {pendingChanges.length > 0 && (\r\n              <Badge variant=\"outline\" className=\"text-xs bg-amber-100 text-amber-800 border-amber-300\">\r\n                {pendingChanges.length} staged\r\n              </Badge>\r\n            )}\r\n          </div>\r\n          <Badge variant=\"secondary\" className=\"bg-blue-100 text-blue-800 text-xs\">\r\n            Total: {currency} {formatNumber(totalPaid)}\r\n          </Badge>\r\n        </CardTitle>\r\n      </CardHeader>\r\n      <CardContent className=\"p-3 sm:p-6\">\r\n        {/* Desktop editing instructions */}\r\n        {showInlineEdit && (\r\n          <div className=\"hidden sm:block mb-4 text-xs text-muted-foreground bg-blue-50 p-2 rounded border border-blue-200\">\r\n             Double-click on amount or notes to edit. Click delete button to remove payments (including zero amounts).\r\n          </div>\r\n        )}\r\n\r\n        {/* Mobile Card Layout */}\r\n        <div className=\"block sm:hidden space-y-3\">\r\n          {payments.map((payment) => {\r\n            const status = getPaymentStatus(payment.id);\r\n            const displayAmount = getDisplayAmount(payment);\r\n            const displayNotes = getDisplayNotes(payment);\r\n            const isEditing = editingPayment === payment.id;\r\n            const canDelete = canDeletePayment(payment);\r\n            \r\n            return (\r\n              <div \r\n                key={payment.id} \r\n                className={`bg-white rounded-lg p-3 border shadow-sm ${\r\n                  status === 'deleted' ? 'border-red-200 bg-red-50 opacity-60' :\r\n                  status === 'modified' ? 'border-amber-200 bg-amber-50' :\r\n                  'border-gray-200'\r\n                }`}\r\n              >\r\n                 <div className=\"flex justify-between items-start mb-2\">\r\n                   <div className=\"flex items-center gap-2\">\r\n                     {isEditing && editingField === 'date' ? (\r\n                       <Popover>\r\n                         <PopoverTrigger asChild>\r\n                           <Button\r\n                             variant=\"outline\"\r\n                             size=\"sm\"\r\n                             className={cn(\r\n                               \"h-7 text-xs justify-start text-left font-normal\",\r\n                               !editDate && \"text-muted-foreground\"\r\n                             )}\r\n                           >\r\n                             <CalendarIcon className=\"mr-2 h-3 w-3\" />\r\n                             {editDate ? format(editDate, \"MMM dd, yyyy\") : <span>Pick a date</span>}\r\n                           </Button>\r\n                         </PopoverTrigger>\r\n                         <PopoverContent className=\"w-auto p-0\" align=\"start\">\r\n                            <Calendar\r\n                              mode=\"single\"\r\n                              selected={editDate}\r\n                              onSelect={(date) => handleDateSelect(payment, date)}\r\n                              initialFocus\r\n                              className={cn(\"p-3 pointer-events-auto\")}\r\n                            />\r\n                         </PopoverContent>\r\n                       </Popover>\r\n                     ) : (\r\n                       <div \r\n                         className={`text-xs text-muted-foreground ${onUpdatePayment ? 'cursor-pointer hover:text-blue-600' : ''}`}\r\n                         onClick={() => onUpdatePayment && handleDoubleClickDate(payment)}\r\n                         title={onUpdatePayment ? 'Click to edit date' : ''}\r\n                       >\r\n                         {format(payment.paymentDate, 'MMM dd, yyyy')}\r\n                       </div>\r\n                     )}\r\n                     {status === 'deleted' && (\r\n                       <Badge variant=\"outline\" className=\"text-xs bg-red-100 text-red-800 border-red-300\">\r\n                         To Delete\r\n                       </Badge>\r\n                     )}\r\n                     {status === 'modified' && (\r\n                       <Badge variant=\"outline\" className=\"text-xs bg-amber-100 text-amber-800 border-amber-300\">\r\n                         Modified\r\n                       </Badge>\r\n                     )}\r\n                   </div>\r\n                   {isEditing && editingField === 'amount' ? (\r\n                     <div className=\"flex flex-col gap-2 min-w-0 flex-1 ml-2\">\r\n                       <Input\r\n                         type=\"number\"\r\n                         value={editAmount}\r\n                         onChange={(e) => setEditAmount(e.target.value)} // Allow empty string\r\n                         className=\"h-7 text-xs\"\r\n                         step=\"0.01\"\r\n                         min=\"0\"\r\n                         placeholder=\"0\"\r\n                       />\r\n                     </div>\r\n                   ) : (\r\n                     <div className={`text-sm font-semibold ${status === 'deleted' ? 'line-through' : ''}`}>\r\n                       {currency} {formatNumber(displayAmount)}\r\n                     </div>\r\n                   )}\r\n                </div>\r\n                 \r\n                 {isEditing ? (\r\n                   <div className=\"space-y-2\">\r\n                     {editingField === 'notes' && (\r\n                       <Input\r\n                         value={editNotes}\r\n                         onChange={(e) => setEditNotes(e.target.value)}\r\n                         placeholder=\"Payment notes\"\r\n                         className=\"h-7 text-xs\"\r\n                       />\r\n                     )}\r\n                     <div className=\"flex justify-end gap-2\">\r\n                       <Button\r\n                         size=\"sm\"\r\n                         variant=\"outline\"\r\n                         className=\"h-6 px-2 text-xs\"\r\n                         onClick={handleCancelEdit}\r\n                       >\r\n                         <X className=\"h-3 w-3\" />\r\n                       </Button>\r\n                       <Button\r\n                         size=\"sm\"\r\n                         className=\"h-6 px-2 text-xs\"\r\n                         onClick={() => handleSaveEdit(payment)}\r\n                       >\r\n                         <Check className=\"h-3 w-3\" />\r\n                       </Button>\r\n                     </div>\r\n                   </div>\r\n                 ) : (\r\n                  <>\r\n                     {displayNotes && (\r\n                       <div \r\n                         className={`text-xs text-muted-foreground mb-3 ${status === 'deleted' ? 'line-through' : ''} ${onUpdatePayment ? 'cursor-pointer hover:text-blue-600' : ''}`}\r\n                         onClick={() => onUpdatePayment && handleStartEdit(payment, 'notes')}\r\n                         title={onUpdatePayment ? 'Click to edit notes' : ''}\r\n                       >\r\n                         {displayNotes}\r\n                       </div>\r\n                     )}\r\n                    \r\n                    {/* Cash Account Section for Mobile */}\r\n                    <div className=\"mb-3\">\r\n                      <div className=\"text-xs text-muted-foreground mb-1\">Cash Account:</div>\r\n                      {linkingPayment === payment.id ? (\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <Select\r\n                            value={selectedAccountId}\r\n                            onValueChange={setSelectedAccountId}\r\n                          >\r\n                            <SelectTrigger className=\"h-7 text-xs flex-1\">\r\n                              <SelectValue placeholder=\"Select account\" />\r\n                            </SelectTrigger>\r\n                            <SelectContent>\r\n                              {cashAccounts.map((account) => (\r\n                                <SelectItem key={account.id} value={account.id}>\r\n                                  <div className=\"flex items-center\">\r\n                                    <span>{account.name}</span>\r\n                                    {account.isDefault && (\r\n                                      <span className=\"ml-1 text-xs bg-blue-100 text-blue-800 px-1 py-0.5 rounded\">\r\n                                        Default\r\n                                      </span>\r\n                                    )}\r\n                                  </div>\r\n                                </SelectItem>\r\n                              ))}\r\n                            </SelectContent>\r\n                          </Select>\r\n                          <Button\r\n                            size=\"sm\"\r\n                            variant=\"ghost\"\r\n                            className=\"h-7 w-7 p-0 text-gray-500 hover:text-gray-700\"\r\n                            onClick={handleCancelCashLink}\r\n                          >\r\n                            <X className=\"h-3 w-3\" />\r\n                          </Button>\r\n                          <Button\r\n                            size=\"sm\"\r\n                            variant=\"ghost\"\r\n                            className=\"h-7 w-7 p-0 text-green-500 hover:text-green-700\"\r\n                            onClick={() => handleConfirmCashLink(payment)}\r\n                            disabled={!selectedAccountId}\r\n                          >\r\n                            <Check className=\"h-3 w-3\" />\r\n                          </Button>\r\n                        </div>\r\n                      ) : (\r\n                         <div className=\"flex items-center gap-2\">\r\n                           {payment.cashTransactionId ? (\r\n                             <Badge variant=\"outline\" className=\"text-xs bg-green-100 text-green-800 border-green-300\">\r\n                               Linked\r\n                             </Badge>\r\n                           ) : (\r\n                             <>\r\n                               <span className=\"text-xs text-muted-foreground\">Not linked</span>\r\n                               {onLinkToCash && cashAccounts.length > 0 && (\r\n                                 <Button\r\n                                   size=\"sm\"\r\n                                   variant=\"ghost\"\r\n                                   className=\"h-7 w-7 p-0 text-blue-500 hover:text-blue-700\"\r\n                                   onClick={() => handleStartCashLink(payment.id)}\r\n                                   title=\"Link to cash account\"\r\n                                 >\r\n                                   <Link className=\"h-3 w-3\" />\r\n                                 </Button>\r\n                               )}\r\n                             </>\r\n                           )}\r\n                         </div>\r\n                      )}\r\n                    </div>\r\n                    \r\n                    {showInlineEdit && canDelete && (\r\n                      <div className=\"flex justify-end gap-2\">\r\n                        <Button\r\n                          size=\"sm\"\r\n                          variant=\"outline\"\r\n                          className=\"h-7 px-2 text-xs text-blue-600 hover:text-blue-700 border-blue-200 hover:border-blue-300\"\r\n                          onClick={() => handleStartEdit(payment)}\r\n                        >\r\n                          <Edit3 className=\"h-3 w-3 mr-1\" />\r\n                          Edit\r\n                        </Button>\r\n                        <Button\r\n                          size=\"sm\"\r\n                          variant=\"outline\"\r\n                          className=\"h-7 px-2 text-xs text-red-600 hover:text-red-700 border-red-200 hover:border-red-300\"\r\n                          onClick={() => handleStageDelete(payment)}\r\n                        >\r\n                          <Trash2 className=\"h-3 w-3 mr-1\" />\r\n                          Delete\r\n                        </Button>\r\n                      </div>\r\n                    )}\r\n                  </>\r\n                )}\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n\r\n        {/* Desktop Table Layout */}\r\n        <div className=\"hidden sm:block overflow-x-auto\">\r\n          <Table>\r\n            <TableHeader>\r\n              <TableRow>\r\n                <TableHead className=\"text-xs\">Date</TableHead>\r\n                <TableHead className=\"text-xs text-right\">Amount</TableHead>\r\n                <TableHead className=\"text-xs\">Notes</TableHead>\r\n                <TableHead className=\"text-xs\">Cash Account</TableHead>\r\n                {showInlineEdit && (\r\n                  <TableHead className=\"text-xs w-16\">Actions</TableHead>\r\n                )}\r\n              </TableRow>\r\n            </TableHeader>\r\n            <TableBody>\r\n              {payments.map((payment) => {\r\n                const status = getPaymentStatus(payment.id);\r\n                const displayAmount = getDisplayAmount(payment);\r\n                const displayNotes = getDisplayNotes(payment);\r\n                const isEditingThis = editingPayment === payment.id;\r\n                const isEditingAmount = isEditingThis && editingField === 'amount';\r\n                const isEditingNotes = isEditingThis && editingField === 'notes';\r\n                const canDelete = canDeletePayment(payment);\r\n                \r\n                return (\r\n                  <TableRow \r\n                    key={payment.id}\r\n                    className={\r\n                      status === 'deleted' ? 'bg-red-50 opacity-60' : \r\n                      status === 'modified' ? 'bg-amber-50' : ''\r\n                    }\r\n                  >\r\n                     <TableCell className=\"text-xs\">\r\n                       <div className=\"flex items-center gap-2\">\r\n                         {editingPayment === payment.id && editingField === 'date' ? (\r\n                           <div className=\"flex items-center gap-1\">\r\n                             <Popover>\r\n                               <PopoverTrigger asChild>\r\n                                 <Button\r\n                                   variant=\"outline\"\r\n                                   size=\"sm\"\r\n                                   className={cn(\r\n                                     \"h-7 text-xs justify-start text-left font-normal w-32\",\r\n                                     !editDate && \"text-muted-foreground\"\r\n                                   )}\r\n                                 >\r\n                                   <CalendarIcon className=\"mr-2 h-3 w-3\" />\r\n                                   {editDate ? format(editDate, \"MMM dd, yyyy\") : <span>Pick a date</span>}\r\n                                 </Button>\r\n                               </PopoverTrigger>\r\n                               <PopoverContent className=\"w-auto p-0\" align=\"start\">\r\n                         <Calendar\r\n                           mode=\"single\"\r\n                           selected={editDate}\r\n                           onSelect={(date) => handleDateSelect(payment, date)}\r\n                           initialFocus\r\n                           className={cn(\"p-3 pointer-events-auto\")}\r\n                         />\r\n                               </PopoverContent>\r\n                             </Popover>\r\n                             <Button\r\n                               size=\"sm\"\r\n                               variant=\"ghost\"\r\n                               className=\"h-6 w-6 p-0 text-gray-500 hover:text-gray-700\"\r\n                               onClick={handleCancelEdit}\r\n                             >\r\n                               <X className=\"h-3 w-3\" />\r\n                             </Button>\r\n                             <Button\r\n                               size=\"sm\"\r\n                               variant=\"ghost\"\r\n                               className=\"h-6 w-6 p-0 text-green-500 hover:text-green-700\"\r\n                               onClick={() => handleSaveEdit(payment)}\r\n                             >\r\n                               <Check className=\"h-3 w-3\" />\r\n                             </Button>\r\n                           </div>\r\n                         ) : (\r\n                           <span \r\n                             className={`cursor-pointer hover:bg-gray-100 px-2 py-1 rounded ${\r\n                               status === 'deleted' ? 'line-through' : ''\r\n                             } ${onUpdatePayment ? 'hover:bg-blue-50' : ''}`}\r\n                             onClick={() => onUpdatePayment && handleDoubleClickDate(payment)}\r\n                             title={onUpdatePayment ? 'Click to edit date' : ''}\r\n                           >\r\n                             {format(payment.paymentDate, 'MMM dd, yyyy')}\r\n                           </span>\r\n                         )}\r\n                         {status === 'deleted' && (\r\n                           <Badge variant=\"outline\" className=\"text-xs bg-red-100 text-red-800 border-red-300\">\r\n                             To Delete\r\n                           </Badge>\r\n                         )}\r\n                         {status === 'modified' && (\r\n                           <Badge variant=\"outline\" className=\"text-xs bg-amber-100 text-amber-800 border-amber-300\">\r\n                             Modified\r\n                           </Badge>\r\n                         )}\r\n                       </div>\r\n                     </TableCell>\r\n                    <TableCell className=\"text-xs text-right\">\r\n                      {isEditingAmount ? (\r\n                        <div className=\"flex items-center gap-1 justify-end\">\r\n                          <Input\r\n                            type=\"number\"\r\n                            value={editAmount}\r\n                            onChange={(e) => setEditAmount(e.target.value)} // Allow empty string\r\n                            className=\"h-7 text-xs w-24\"\r\n                            step=\"0.01\"\r\n                            min=\"0\"\r\n                            autoFocus\r\n                            placeholder=\"0\"\r\n                          />\r\n                          <Button\r\n                            size=\"sm\"\r\n                            variant=\"ghost\"\r\n                            className=\"h-6 w-6 p-0 text-gray-500 hover:text-gray-700\"\r\n                            onClick={handleCancelEdit}\r\n                          >\r\n                            <X className=\"h-3 w-3\" />\r\n                          </Button>\r\n                          <Button\r\n                            size=\"sm\"\r\n                            variant=\"ghost\"\r\n                            className=\"h-6 w-6 p-0 text-green-500 hover:text-green-700\"\r\n                            onClick={() => handleSaveEdit(payment)}\r\n                          >\r\n                            <Check className=\"h-3 w-3\" />\r\n                          </Button>\r\n                        </div>\r\n                      ) : (\r\n                        <span \r\n                          className={`font-medium cursor-pointer hover:bg-gray-100 px-2 py-1 rounded ${\r\n                            status === 'deleted' ? 'line-through' : ''\r\n                          } ${showInlineEdit && canDelete ? 'hover:bg-blue-50' : ''}`}\r\n                          onDoubleClick={() => handleDoubleClickAmount(payment)}\r\n                          title={showInlineEdit && canDelete ? 'Double-click to edit' : ''}\r\n                        >\r\n                          {currency} {formatNumber(displayAmount)}\r\n                        </span>\r\n                      )}\r\n                    </TableCell>\r\n                    <TableCell className=\"text-xs\">\r\n                      {isEditingNotes ? (\r\n                        <div className=\"flex items-center gap-1\">\r\n                          <Input\r\n                            value={editNotes}\r\n                            onChange={(e) => setEditNotes(e.target.value)}\r\n                            placeholder=\"Payment notes\"\r\n                            className=\"h-7 text-xs\"\r\n                            autoFocus\r\n                          />\r\n                          <Button\r\n                            size=\"sm\"\r\n                            variant=\"ghost\"\r\n                            className=\"h-6 w-6 p-0 text-gray-500 hover:text-gray-700\"\r\n                            onClick={handleCancelEdit}\r\n                          >\r\n                            <X className=\"h-3 w-3\" />\r\n                          </Button>\r\n                          <Button\r\n                            size=\"sm\"\r\n                            variant=\"ghost\"\r\n                            className=\"h-6 w-6 p-0 text-green-500 hover:text-green-700\"\r\n                            onClick={() => handleSaveEdit(payment)}\r\n                          >\r\n                            <Check className=\"h-3 w-3\" />\r\n                          </Button>\r\n                        </div>\r\n                      ) : (\r\n                        <span \r\n                          className={`text-muted-foreground cursor-pointer hover:bg-gray-100 px-2 py-1 rounded ${\r\n                            status === 'deleted' ? 'line-through' : ''\r\n                          } ${showInlineEdit && canDelete ? 'hover:bg-blue-50' : ''}`}\r\n                          onDoubleClick={() => handleDoubleClickNotes(payment)}\r\n                          title={showInlineEdit && canDelete ? 'Double-click to edit' : ''}\r\n                        >\r\n                          {displayNotes || '-'}\r\n                        </span>\r\n                       )}\r\n                     </TableCell>\r\n                     <TableCell className=\"text-xs\">\r\n                       {linkingPayment === payment.id ? (\r\n                         <div className=\"flex items-center gap-1\">\r\n                           <Select\r\n                             value={selectedAccountId}\r\n                             onValueChange={setSelectedAccountId}\r\n                           >\r\n                             <SelectTrigger className=\"h-7 text-xs w-32\">\r\n                               <SelectValue placeholder=\"Select account\" />\r\n                             </SelectTrigger>\r\n                             <SelectContent>\r\n                               {cashAccounts.map((account) => (\r\n                                 <SelectItem key={account.id} value={account.id}>\r\n                                   <div className=\"flex items-center\">\r\n                                     <span>{account.name}</span>\r\n                                     {account.isDefault && (\r\n                                       <span className=\"ml-1 text-xs bg-blue-100 text-blue-800 px-1 py-0.5 rounded\">\r\n                                         Default\r\n                                       </span>\r\n                                     )}\r\n                                   </div>\r\n                                 </SelectItem>\r\n                               ))}\r\n                             </SelectContent>\r\n                           </Select>\r\n                           <Button\r\n                             size=\"sm\"\r\n                             variant=\"ghost\"\r\n                             className=\"h-6 w-6 p-0 text-gray-500 hover:text-gray-700\"\r\n                             onClick={handleCancelCashLink}\r\n                           >\r\n                             <X className=\"h-3 w-3\" />\r\n                           </Button>\r\n                           <Button\r\n                             size=\"sm\"\r\n                             variant=\"ghost\"\r\n                             className=\"h-6 w-6 p-0 text-green-500 hover:text-green-700\"\r\n                             onClick={() => handleConfirmCashLink(payment)}\r\n                             disabled={!selectedAccountId}\r\n                           >\r\n                             <Check className=\"h-3 w-3\" />\r\n                           </Button>\r\n                         </div>\r\n                       ) : (\r\n                          <div className=\"flex items-center gap-1\">\r\n                            {payment.cashTransactionId ? (\r\n                              <Badge variant=\"outline\" className=\"text-xs bg-green-100 text-green-800 border-green-300\">\r\n                                Linked\r\n                              </Badge>\r\n                            ) : (\r\n                              onLinkToCash && cashAccounts.length > 0 && (\r\n                                <Button\r\n                                  size=\"sm\"\r\n                                  variant=\"ghost\"\r\n                                  className=\"h-6 w-6 p-0 text-blue-500 hover:text-blue-700\"\r\n                                  onClick={() => handleStartCashLink(payment.id)}\r\n                                  title=\"Link to cash account\"\r\n                                >\r\n                                  <Link className=\"h-3 w-3\" />\r\n                                </Button>\r\n                              )\r\n                            )}\r\n                          </div>\r\n                       )}\r\n                     </TableCell>\r\n                    {showInlineEdit && (\r\n                      <TableCell className=\"text-xs\">\r\n                        {!isEditingThis && canDelete && (\r\n                          <Button\r\n                            size=\"sm\"\r\n                            variant=\"ghost\"\r\n                            className=\"h-6 w-6 p-0 text-red-500 hover:text-red-700\"\r\n                            onClick={() => handleStageDelete(payment)}\r\n                            title=\"Delete payment\"\r\n                          >\r\n                            <Trash2 className=\"h-3 w-3\" />\r\n                          </Button>\r\n                        )}\r\n                      </TableCell>\r\n                    )}\r\n                  </TableRow>\r\n                );\r\n              })}\r\n            </TableBody>\r\n          </Table>\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default InstallmentPaymentHistory;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4671, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/sales/InstallmentPaymentInput.tsx"],"sourcesContent":["\r\nimport React, { useState } from 'react';\r\nimport { format } from 'date-fns';\r\nimport { CalendarIcon } from 'lucide-react';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Calendar } from '@/components/ui/calendar';\r\nimport { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover';\r\nimport { formatNumber, formatNumberInput, parseNumberInput, cn } from '@/lib/utils';\r\nimport { InstallmentPayment } from '@/hooks/useInstallmentPayments';\r\nimport { PaymentChange } from '@/hooks/useLocalPaymentChanges';\r\nimport InstallmentPaymentHistory from './InstallmentPaymentHistory';\r\n\r\ninterface InstallmentPaymentInputProps {\r\n  amountPaid: number;\r\n  amountDue: number;\r\n  grandTotal: number;\r\n  currency: string;\r\n  onAmountPaidChange: (amount: number) => void;\r\n  onPaymentDateChange?: (date: Date) => void;\r\n  paymentDate?: Date;\r\n  maxAmount: number;\r\n  saleId?: string;\r\n  onPaymentStatusChange?: (status: 'Paid' | 'Installment Sale') => void;\r\n  isEditing?: boolean;\r\n  payments?: InstallmentPayment[];\r\n  pendingChanges?: PaymentChange[];\r\n  onStagePaymentChange?: (change: PaymentChange) => void;\r\n  cashAccounts?: any[];\r\n  onLinkToCash?: (paymentId: string, accountId: string) => Promise<void>;\r\n  onUpdatePayment?: (paymentId: string, updates: { amount?: number; notes?: string; paymentDate?: Date }) => Promise<void>;\r\n}\r\n\r\nconst InstallmentPaymentInput: React.FC<InstallmentPaymentInputProps> = ({\r\n  amountPaid,\r\n  amountDue,\r\n  grandTotal,\r\n  currency,\r\n  onAmountPaidChange,\r\n  onPaymentDateChange,\r\n  paymentDate,\r\n  maxAmount,\r\n  saleId,\r\n  onPaymentStatusChange,\r\n  isEditing = false,\r\n  payments = [],\r\n  pendingChanges = [],\r\n  onStagePaymentChange,\r\n  cashAccounts = [],\r\n  onLinkToCash,\r\n  onUpdatePayment,\r\n}) => {\r\n  const [selectedDate, setSelectedDate] = useState<Date>(paymentDate || new Date());\r\n\r\n  // Local string state for amount input with smart formatting (commas + decimals)\r\n  const [amountPaidInput, setAmountPaidInput] = useState(formatNumberInput(amountPaid?.toString() || '0'));\r\n\r\n  // Sync local state when prop changes externally\r\n  React.useEffect(() => {\r\n    // Only update if the numeric deviation is significant to avoid fighting with the user's typing\r\n    const currentVal = parseNumberInput(amountPaidInput);\r\n    if (Math.abs(currentVal - amountPaid) > 0.001) {\r\n      setAmountPaidInput(formatNumberInput(amountPaid.toString()));\r\n    }\r\n  }, [amountPaid]);\r\n\r\n\r\n  // Calculate total from payment history, considering pending changes\r\n  const getModifiedPayments = () => {\r\n    return payments\r\n      .filter(payment => {\r\n        // Filter out deleted payments\r\n        const deleteChange = pendingChanges.find(c => c.id === payment.id && c.type === 'delete');\r\n        return !deleteChange;\r\n      })\r\n      .map(payment => {\r\n        // Apply updates to payments\r\n        const updateChange = pendingChanges.find(c => c.id === payment.id && c.type === 'update');\r\n        if (updateChange && updateChange.updatedData) {\r\n          return {\r\n            ...payment,\r\n            amount: updateChange.updatedData.amount ?? payment.amount,\r\n            notes: updateChange.updatedData.notes ?? payment.notes,\r\n          };\r\n        }\r\n        return payment;\r\n      });\r\n  };\r\n\r\n  const modifiedPayments = getModifiedPayments();\r\n  const totalPaidFromHistory = modifiedPayments.reduce((sum, payment) => sum + payment.amount, 0);\r\n  const remainingAmount = Math.max(0, grandTotal - totalPaidFromHistory);\r\n  const isFullyPaid = totalPaidFromHistory >= grandTotal;\r\n\r\n  const handleAmountPaidChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const rawInput = e.target.value;\r\n\r\n    // Apply smart formatting (commas + decimals preserved)\r\n    const formatted = formatNumberInput(rawInput);\r\n    setAmountPaidInput(formatted);\r\n\r\n    const value = parseNumberInput(rawInput);\r\n\r\n    // Ensure amount paid doesn't exceed remaining amount\r\n    const validAmount = Math.min(value, remainingAmount);\r\n\r\n    onAmountPaidChange(validAmount);\r\n  };\r\n\r\n  const handleDateChange = (date: Date | undefined) => {\r\n    if (date) {\r\n      setSelectedDate(date);\r\n      onPaymentDateChange?.(date);\r\n    }\r\n  };\r\n\r\n  // Force current payment to 0 if fully paid\r\n  const displayAmountPaid = isFullyPaid ? 0 : (amountPaid || 0);\r\n\r\n  console.log('InstallmentPaymentInput - isEditing:', isEditing, 'has onStagePaymentChange:', !!onStagePaymentChange);\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      <Card className=\"border-blue-200 bg-blue-50\">\r\n        <CardHeader className=\"pb-3\">\r\n          <CardTitle className=\"text-sm text-blue-800\">Installment Payment Details</CardTitle>\r\n        </CardHeader>\r\n        <CardContent className=\"space-y-4\">\r\n          <div className=\"grid gap-3\">\r\n            <Label htmlFor=\"amountPaid\" className=\"text-sm font-medium\">Amount Paid (Current Payment)</Label>\r\n            <Input\r\n              id=\"amountPaid\"\r\n              type=\"text\"\r\n              inputMode=\"decimal\"\r\n              value={amountPaidInput}\r\n              onChange={handleAmountPaidChange}\r\n              placeholder=\"Enter amount paid\"\r\n              disabled={isFullyPaid}\r\n              className=\"text-base\"\r\n            />\r\n          </div>\r\n\r\n          <div className=\"grid gap-3\">\r\n            <Label className=\"text-sm font-medium\">Payment Date</Label>\r\n            <Popover>\r\n              <PopoverTrigger asChild>\r\n                <Button\r\n                  variant=\"outline\"\r\n                  className={cn(\r\n                    \"w-full justify-start text-left font-normal\",\r\n                    !selectedDate && \"text-muted-foreground\"\r\n                  )}\r\n                  disabled={isFullyPaid}\r\n                >\r\n                  <CalendarIcon className=\"mr-2 h-4 w-4\" />\r\n                  {selectedDate ? format(selectedDate, \"PPP\") : <span>Pick a date</span>}\r\n                </Button>\r\n              </PopoverTrigger>\r\n              <PopoverContent className=\"w-auto p-0\" align=\"start\">\r\n                <Calendar\r\n                  mode=\"single\"\r\n                  selected={selectedDate}\r\n                  onSelect={handleDateChange}\r\n                  initialFocus\r\n                  className={cn(\"p-3 pointer-events-auto\")}\r\n                />\r\n              </PopoverContent>\r\n            </Popover>\r\n          </div>\r\n\r\n          {/* Mobile-first responsive grid */}\r\n          <div className=\"space-y-3 sm:space-y-0 sm:grid sm:grid-cols-2 sm:gap-4\">\r\n            <div className=\"flex justify-between sm:block\">\r\n              <span className=\"text-sm text-muted-foreground\">Total Amount:</span>\r\n              <span className=\"text-sm font-semibold sm:block\">{currency} {formatNumber(grandTotal)}</span>\r\n            </div>\r\n            <div className=\"flex justify-between sm:block\">\r\n              <span className=\"text-sm text-muted-foreground\">Total Paid (History):</span>\r\n              <span className=\"text-sm font-semibold text-green-600 sm:block\">{currency} {formatNumber(totalPaidFromHistory)}</span>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"space-y-3 sm:space-y-0 sm:grid sm:grid-cols-2 sm:gap-4\">\r\n            <div className=\"flex justify-between sm:block\">\r\n              <span className=\"text-sm text-muted-foreground\">Current Payment:</span>\r\n              <span className=\"text-sm font-semibold text-blue-600 sm:block\">{currency} {formatNumber(displayAmountPaid)}</span>\r\n            </div>\r\n            <div className=\"flex justify-between sm:block\">\r\n              <span className=\"text-sm text-muted-foreground\">Amount Due:</span>\r\n              <span className=\"text-sm font-semibold text-red-600 sm:block\">{currency} {formatNumber(Math.max(0, remainingAmount - displayAmountPaid))}</span>\r\n            </div>\r\n          </div>\r\n\r\n          {(totalPaidFromHistory + displayAmountPaid) >= grandTotal && displayAmountPaid > 0 && (\r\n            <div className=\"text-sm text-green-600 font-medium bg-green-50 p-3 rounded border border-green-200\">\r\n               Full payment received - you can manually change status to Paid if needed\r\n            </div>\r\n          )}\r\n\r\n          {isFullyPaid && (\r\n            <div className=\"text-sm text-green-600 font-medium bg-green-50 p-3 rounded border border-green-200\">\r\n               Sale fully paid - you can manually change status to Paid if needed\r\n            </div>\r\n          )}\r\n\r\n          {/* Show notice when editing with pending changes */}\r\n          {isEditing && pendingChanges.length > 0 && (\r\n            <div className=\"text-sm text-amber-600 font-medium bg-amber-50 p-3 rounded border border-amber-200\">\r\n               {pendingChanges.length} payment change(s) staged. Changes will be saved when you click \"Update Sale\".\r\n            </div>\r\n          )}\r\n\r\n          {/* Show notice when editing without pending changes */}\r\n          {isEditing && pendingChanges.length === 0 && payments.length > 0 && (\r\n            <div className=\"text-sm text-blue-600 font-medium bg-blue-50 p-3 rounded border border-blue-200\">\r\n               You can edit payment history. Changes will be saved when you click \"Update Sale\".\r\n            </div>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {saleId && (\r\n        <InstallmentPaymentHistory\r\n          payments={payments}\r\n          currency={currency}\r\n          isLoading={false}\r\n          pendingChanges={pendingChanges}\r\n          isLocalMode={isEditing}\r\n          onStageChange={onStagePaymentChange}\r\n          cashAccounts={cashAccounts}\r\n          onLinkToCash={onLinkToCash}\r\n          onUpdatePayment={onUpdatePayment}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default InstallmentPaymentInput;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5107, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/ui/switch.tsx"],"sourcesContent":["import * as React from \"react\"\r\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst Switch = React.forwardRef<\r\n  React.ElementRef<typeof SwitchPrimitives.Root>,\r\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\r\n>(({ className, ...props }, ref) => (\r\n  <SwitchPrimitives.Root\r\n    className={cn(\r\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\r\n      className\r\n    )}\r\n    {...props}\r\n    ref={ref}\r\n  >\r\n    <SwitchPrimitives.Thumb\r\n      className={cn(\r\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\r\n      )}\r\n    />\r\n  </SwitchPrimitives.Root>\r\n))\r\nSwitch.displayName = SwitchPrimitives.Root.displayName\r\n\r\nexport { Switch }\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;AAEA;;;;;AAEA,MAAM,uBAAS,2KAAgB,MAG7B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,6KAAqB;QACpB,WAAW,IAAA,4HAAE,EACX,sXACA;QAED,GAAG,KAAK;QACT,KAAK;kBAEL,cAAA,6LAAC,8KAAsB;YACrB,WAAW,IAAA,4HAAE,EACX;;;;;;;;;;;;AAKR,OAAO,WAAW,GAAG,6KAAqB,CAAC,WAAW"}},
    {"offset": {"line": 5148, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/sales/CashAccountSelection.tsx"],"sourcesContent":["\r\nimport React from 'react';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Switch } from '@/components/ui/switch';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\n\r\ninterface CashAccount {\r\n  id: string;\r\n  name: string;\r\n  description?: string;\r\n  isDefault: boolean;\r\n}\r\n\r\ninterface CashAccountSelectionProps {\r\n  linkToCash: boolean;\r\n  onLinkToCashChange: (checked: boolean) => void;\r\n  selectedCashAccountId: string;\r\n  onCashAccountChange: (accountId: string) => void;\r\n  cashAccounts: CashAccount[];\r\n  paymentStatus: string;\r\n}\r\n\r\nconst CashAccountSelection: React.FC<CashAccountSelectionProps> = ({\r\n  linkToCash,\r\n  onLinkToCashChange,\r\n  selectedCashAccountId,\r\n  onCashAccountChange,\r\n  cashAccounts,\r\n  paymentStatus\r\n}) => {\r\n  // Only show cash account selection for Paid and Installment Sale statuses\r\n  const shouldShowCashSelection = paymentStatus === 'Paid' || paymentStatus === 'Installment Sale';\r\n  \r\n  if (!shouldShowCashSelection) {\r\n    return null;\r\n  }\r\n\r\n  const getCardTitle = () => {\r\n    if (paymentStatus === 'Installment Sale') {\r\n      return 'Link Partial Payment to Cash Account';\r\n    }\r\n    return 'Link to Cash Account';\r\n  };\r\n\r\n  const getDescription = () => {\r\n    if (paymentStatus === 'Installment Sale') {\r\n      return 'Record the partial payment in a cash account';\r\n    }\r\n    return 'Record this payment in a cash account';\r\n  };\r\n\r\n  return (\r\n    <Card className=\"border-green-200 bg-green-50\">\r\n      <CardHeader className=\"pb-3\">\r\n        <CardTitle className=\"text-sm text-green-800\">{getCardTitle()}</CardTitle>\r\n      </CardHeader>\r\n      <CardContent className=\"space-y-4\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <div className=\"space-y-0.5\">\r\n            <Label htmlFor=\"link-to-cash\">Link to Cash Account</Label>\r\n            <div className=\"text-sm text-muted-foreground\">\r\n              {getDescription()}\r\n            </div>\r\n          </div>\r\n          <Switch\r\n            id=\"link-to-cash\"\r\n            checked={linkToCash}\r\n            onCheckedChange={onLinkToCashChange}\r\n            data-cash-account-switch=\"true\"\r\n            onKeyDown={(e: React.KeyboardEvent) => {\r\n              if (e.key === 'Enter') {\r\n                e.preventDefault();\r\n                if (linkToCash) {\r\n                  // Focus the cash account select if enabled\r\n                  const cashAccountSelect = document.querySelector('[data-cash-account-select=\"true\"]') as HTMLElement;\r\n                  cashAccountSelect?.focus();\r\n                } else {\r\n                  // Go to submit button if not enabled\r\n                  const submitButton = document.querySelector('button[type=\"submit\"]') as HTMLElement;\r\n                  submitButton?.focus();\r\n                }\r\n              }\r\n            }}\r\n          />\r\n        </div>\r\n        \r\n        {linkToCash && (\r\n          <div className=\"grid gap-3\">\r\n            <Label htmlFor=\"cash-account\">Select Cash Account</Label>\r\n            <Select\r\n              value={selectedCashAccountId}\r\n              onValueChange={onCashAccountChange}\r\n            >\r\n              <SelectTrigger \r\n                className=\"w-full\"\r\n                data-cash-account-select=\"true\"\r\n                onKeyDown={(e) => {\r\n                  if (e.key === 'Enter') {\r\n                    e.preventDefault();\r\n                    // Focus the create sale button\r\n                    const submitButton = document.querySelector('button[type=\"submit\"]') as HTMLElement;\r\n                    submitButton?.focus();\r\n                  }\r\n                }}\r\n              >\r\n                <SelectValue placeholder=\"Select a cash account\" />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                {cashAccounts.map((account) => (\r\n                  <SelectItem key={account.id} value={account.id}>\r\n                    <div className=\"flex items-center\">\r\n                      <span>{account.name}</span>\r\n                      {account.isDefault && (\r\n                        <span className=\"ml-2 text-xs bg-blue-100 text-blue-800 px-1.5 py-0.5 rounded\">\r\n                          Default\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                  </SelectItem>\r\n                ))}\r\n              </SelectContent>\r\n            </Select>\r\n            {selectedCashAccountId && (\r\n              <div className=\"text-sm text-muted-foreground\">\r\n                {paymentStatus === 'Installment Sale' \r\n                  ? 'The partial payment amount will be recorded in this account'\r\n                  : 'The full payment amount will be recorded in this account'\r\n                }\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default CashAccountSelection;\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;;;;;;AAkBA,MAAM,uBAA4D,CAAC,EACjE,UAAU,EACV,kBAAkB,EAClB,qBAAqB,EACrB,mBAAmB,EACnB,YAAY,EACZ,aAAa,EACd;IACC,0EAA0E;IAC1E,MAAM,0BAA0B,kBAAkB,UAAU,kBAAkB;IAE9E,IAAI,CAAC,yBAAyB;QAC5B,OAAO;IACT;IAEA,MAAM,eAAe;QACnB,IAAI,kBAAkB,oBAAoB;YACxC,OAAO;QACT;QACA,OAAO;IACT;IAEA,MAAM,iBAAiB;QACrB,IAAI,kBAAkB,oBAAoB;YACxC,OAAO;QACT;QACA,OAAO;IACT;IAEA,qBACE,6LAAC,2IAAI;QAAC,WAAU;;0BACd,6LAAC,iJAAU;gBAAC,WAAU;0BACpB,cAAA,6LAAC,gJAAS;oBAAC,WAAU;8BAA0B;;;;;;;;;;;0BAEjD,6LAAC,kJAAW;gBAAC,WAAU;;kCACrB,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;gCAAI,WAAU;;kDACb,6LAAC,6IAAK;wCAAC,SAAQ;kDAAe;;;;;;kDAC9B,6LAAC;wCAAI,WAAU;kDACZ;;;;;;;;;;;;0CAGL,6LAAC,+IAAM;gCACL,IAAG;gCACH,SAAS;gCACT,iBAAiB;gCACjB,4BAAyB;gCACzB,WAAW,CAAC;oCACV,IAAI,EAAE,GAAG,KAAK,SAAS;wCACrB,EAAE,cAAc;wCAChB,IAAI,YAAY;4CACd,2CAA2C;4CAC3C,MAAM,oBAAoB,SAAS,aAAa,CAAC;4CACjD,mBAAmB;wCACrB,OAAO;4CACL,qCAAqC;4CACrC,MAAM,eAAe,SAAS,aAAa,CAAC;4CAC5C,cAAc;wCAChB;oCACF;gCACF;;;;;;;;;;;;oBAIH,4BACC,6LAAC;wBAAI,WAAU;;0CACb,6LAAC,6IAAK;gCAAC,SAAQ;0CAAe;;;;;;0CAC9B,6LAAC,+IAAM;gCACL,OAAO;gCACP,eAAe;;kDAEf,6LAAC,sJAAa;wCACZ,WAAU;wCACV,4BAAyB;wCACzB,WAAW,CAAC;4CACV,IAAI,EAAE,GAAG,KAAK,SAAS;gDACrB,EAAE,cAAc;gDAChB,+BAA+B;gDAC/B,MAAM,eAAe,SAAS,aAAa,CAAC;gDAC5C,cAAc;4CAChB;wCACF;kDAEA,cAAA,6LAAC,oJAAW;4CAAC,aAAY;;;;;;;;;;;kDAE3B,6LAAC,sJAAa;kDACX,aAAa,GAAG,CAAC,CAAC,wBACjB,6LAAC,mJAAU;gDAAkB,OAAO,QAAQ,EAAE;0DAC5C,cAAA,6LAAC;oDAAI,WAAU;;sEACb,6LAAC;sEAAM,QAAQ,IAAI;;;;;;wDAClB,QAAQ,SAAS,kBAChB,6LAAC;4DAAK,WAAU;sEAA+D;;;;;;;;;;;;+CAJpE,QAAQ,EAAE;;;;;;;;;;;;;;;;4BAahC,uCACC,6LAAC;gCAAI,WAAU;0CACZ,kBAAkB,qBACf,gEACA;;;;;;;;;;;;;;;;;;;;;;;;AASpB;KAjHM;uCAmHS"}},
    {"offset": {"line": 5378, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/sales/SaleCategorySelector.tsx"],"sourcesContent":["import React from 'react';\r\nimport { Label } from '@/components/ui/label';\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from '@/components/ui/select';\r\nimport { useSalesCategories } from '@/hooks/useSalesCategories';\r\nimport { SalesCategory } from '@/types';\r\n\r\ninterface SaleCategorySelectorProps {\r\n  value?: string;\r\n  onChange: (value: string) => void;\r\n  label?: string;\r\n  placeholder?: string;\r\n}\r\n\r\nconst SaleCategorySelector: React.FC<SaleCategorySelectorProps> = ({\r\n  value,\r\n  onChange,\r\n  label = \"Sales Source\",\r\n  placeholder = \"Select category (optional)\"\r\n}) => {\r\n  const { categories, isLoading } = useSalesCategories();\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"space-y-2\">\r\n        <Label>{label}</Label>\r\n        <Select disabled>\r\n          <SelectTrigger>\r\n            <SelectValue placeholder=\"Loading...\" />\r\n          </SelectTrigger>\r\n        </Select>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-2\">\r\n      <Label>{label}</Label>\r\n      <Select value={value || \"none\"} onValueChange={(val) => {\r\n        onChange(val === \"none\" ? \"\" : val);\r\n      }}>\r\n        <SelectTrigger>\r\n          <SelectValue placeholder={placeholder} />\r\n        </SelectTrigger>\r\n        <SelectContent>\r\n          <SelectItem value=\"none\">No source</SelectItem>\r\n          {categories.map((category: SalesCategory) => (\r\n            <SelectItem key={category.id} value={category.id}>\r\n              {category.name}\r\n            </SelectItem>\r\n          ))}\r\n        </SelectContent>\r\n      </Select>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SaleCategorySelector;"],"names":[],"mappings":";;;;;AACA;AACA;AAOA;;;;;;AAUA,MAAM,uBAA4D,CAAC,EACjE,KAAK,EACL,QAAQ,EACR,QAAQ,cAAc,EACtB,cAAc,4BAA4B,EAC3C;;IACC,MAAM,EAAE,UAAU,EAAE,SAAS,EAAE,GAAG,IAAA,2JAAkB;IAEpD,IAAI,WAAW;QACb,qBACE,6LAAC;YAAI,WAAU;;8BACb,6LAAC,6IAAK;8BAAE;;;;;;8BACR,6LAAC,+IAAM;oBAAC,QAAQ;8BACd,cAAA,6LAAC,sJAAa;kCACZ,cAAA,6LAAC,oJAAW;4BAAC,aAAY;;;;;;;;;;;;;;;;;;;;;;IAKnC;IAEA,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC,6IAAK;0BAAE;;;;;;0BACR,6LAAC,+IAAM;gBAAC,OAAO,SAAS;gBAAQ,eAAe,CAAC;oBAC9C,SAAS,QAAQ,SAAS,KAAK;gBACjC;;kCACE,6LAAC,sJAAa;kCACZ,cAAA,6LAAC,oJAAW;4BAAC,aAAa;;;;;;;;;;;kCAE5B,6LAAC,sJAAa;;0CACZ,6LAAC,mJAAU;gCAAC,OAAM;0CAAO;;;;;;4BACxB,WAAW,GAAG,CAAC,CAAC,yBACf,6LAAC,mJAAU;oCAAmB,OAAO,SAAS,EAAE;8CAC7C,SAAS,IAAI;mCADC,SAAS,EAAE;;;;;;;;;;;;;;;;;;;;;;;AAQxC;GAzCM;;QAM8B,2JAAkB;;;KANhD;uCA2CS"}},
    {"offset": {"line": 5514, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/sales/SalePaymentSection.tsx"],"sourcesContent":["import React from 'react';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport PaymentStatusSelector from '@/components/sales/PaymentStatusSelector';\r\nimport InstallmentPaymentInput from '@/components/sales/InstallmentPaymentInput';\r\nimport InstallmentPaymentHistory from '@/components/sales/InstallmentPaymentHistory';\r\nimport CashAccountSelection from '@/components/sales/CashAccountSelection';\r\nimport SaleCategorySelector from '@/components/sales/SaleCategorySelector';\r\nimport { PaymentChange } from '@/hooks/useLocalPaymentChanges';\r\n\r\ninterface SalePaymentSectionProps {\r\n  paymentStatus: string;\r\n  onPaymentStatusChange: (value: string) => void;\r\n  isInstallmentSale: boolean;\r\n  amountPaid: number;\r\n  amountDue: number;\r\n  grandTotal: number;\r\n  currency: string;\r\n  onAmountPaidChange: (amount: number) => void;\r\n  onPaymentDateChange?: (date: Date) => void;\r\n  paymentDate?: Date;\r\n  saleId?: string;\r\n  onPaymentStatusChangeFromInstallment: (newStatus: string, saleId?: string) => Promise<void>;\r\n  isEditing: boolean;\r\n  payments: any[];\r\n  pendingChanges: any[];\r\n  onStagePaymentChange?: (change: PaymentChange) => void;\r\n  linkToCash: boolean;\r\n  onLinkToCashChange: (value: boolean) => void;\r\n  selectedCashAccountId: string;\r\n  onCashAccountChange: (value: string) => void;\r\n  cashAccounts: any[];\r\n  hasPaidWithHistory: boolean;\r\n  onLinkPaymentToCash?: (paymentId: string, accountId: string) => Promise<void>;\r\n  onUpdatePayment?: (paymentId: string, updates: { amount?: number; notes?: string; paymentDate?: Date }) => Promise<void>;\r\n  notes?: string;\r\n  onNotesChange?: (e: React.ChangeEvent<HTMLInputElement>) => void;\r\n  categoryId?: string;\r\n  onCategoryChange?: (value: string) => void;\r\n}\r\n\r\nconst SalePaymentSection: React.FC<SalePaymentSectionProps> = ({\r\n  paymentStatus,\r\n  onPaymentStatusChange,\r\n  isInstallmentSale,\r\n  amountPaid,\r\n  amountDue,\r\n  grandTotal,\r\n  currency,\r\n  onAmountPaidChange,\r\n  onPaymentDateChange,\r\n  paymentDate,\r\n  saleId,\r\n  onPaymentStatusChangeFromInstallment,\r\n  isEditing,\r\n  payments,\r\n  pendingChanges,\r\n  onStagePaymentChange,\r\n  linkToCash,\r\n  onLinkToCashChange,\r\n  selectedCashAccountId,\r\n  onCashAccountChange,\r\n  cashAccounts,\r\n  hasPaidWithHistory,\r\n  onLinkPaymentToCash,\r\n  onUpdatePayment,\r\n  notes = '',\r\n  onNotesChange,\r\n  categoryId = '',\r\n  onCategoryChange,\r\n}) => {\r\n  return (\r\n    <Card className=\"mb-6\">\r\n      <CardHeader>\r\n        <CardTitle>Payment Information</CardTitle>\r\n      </CardHeader>\r\n      <CardContent className=\"space-y-6\">\r\n        <PaymentStatusSelector\r\n          paymentStatus={paymentStatus}\r\n          onPaymentStatusChange={onPaymentStatusChange}\r\n        />\r\n\r\n        {isInstallmentSale && (\r\n          <InstallmentPaymentInput\r\n            amountPaid={amountPaid}\r\n            amountDue={amountDue}\r\n            grandTotal={grandTotal}\r\n            currency={currency}\r\n            onAmountPaidChange={onAmountPaidChange}\r\n            onPaymentDateChange={onPaymentDateChange}\r\n            paymentDate={paymentDate}\r\n            maxAmount={grandTotal}\r\n            saleId={saleId}\r\n            onPaymentStatusChange={onPaymentStatusChangeFromInstallment}\r\n            isEditing={isEditing}\r\n            payments={payments}\r\n            pendingChanges={pendingChanges}\r\n            onStagePaymentChange={isEditing ? onStagePaymentChange : undefined}\r\n            cashAccounts={cashAccounts}\r\n            onLinkToCash={onLinkPaymentToCash}\r\n            onUpdatePayment={onUpdatePayment}\r\n          />\r\n        )}\r\n\r\n        {hasPaidWithHistory && (\r\n          <Card className=\"border-green-200 bg-green-50\">\r\n            <CardHeader className=\"pb-3\">\r\n              <CardTitle className=\"text-sm text-green-800\">Payment History (Sale Completed)</CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <InstallmentPaymentHistory\r\n                payments={payments}\r\n                currency={currency}\r\n                isLoading={false}\r\n                pendingChanges={pendingChanges}\r\n                isLocalMode={isEditing}\r\n                onStageChange={isEditing ? onStagePaymentChange : undefined}\r\n                cashAccounts={cashAccounts}\r\n                onLinkToCash={onLinkPaymentToCash}\r\n                onUpdatePayment={onUpdatePayment}\r\n              />\r\n            </CardContent>\r\n          </Card>\r\n        )}\r\n\r\n        <CashAccountSelection\r\n          linkToCash={linkToCash}\r\n          onLinkToCashChange={onLinkToCashChange}\r\n          selectedCashAccountId={selectedCashAccountId}\r\n          onCashAccountChange={onCashAccountChange}\r\n          cashAccounts={cashAccounts}\r\n          paymentStatus={paymentStatus}\r\n        />\r\n\r\n        {onCategoryChange && (\r\n          <SaleCategorySelector\r\n            value={categoryId}\r\n            onChange={onCategoryChange}\r\n          />\r\n        )}\r\n\r\n        <div className=\"grid gap-3\">\r\n          <Label htmlFor=\"saleNotes\">Notes</Label>\r\n          <Input\r\n            id=\"saleNotes\"\r\n            name=\"notes\"\r\n            value={notes}\r\n            onChange={onNotesChange}\r\n            placeholder=\"Order notes (will appear on receipt)\"\r\n          />\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default SalePaymentSection;"],"names":[],"mappings":";;;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;AAkCA,MAAM,qBAAwD,CAAC,EAC7D,aAAa,EACb,qBAAqB,EACrB,iBAAiB,EACjB,UAAU,EACV,SAAS,EACT,UAAU,EACV,QAAQ,EACR,kBAAkB,EAClB,mBAAmB,EACnB,WAAW,EACX,MAAM,EACN,oCAAoC,EACpC,SAAS,EACT,QAAQ,EACR,cAAc,EACd,oBAAoB,EACpB,UAAU,EACV,kBAAkB,EAClB,qBAAqB,EACrB,mBAAmB,EACnB,YAAY,EACZ,kBAAkB,EAClB,mBAAmB,EACnB,eAAe,EACf,QAAQ,EAAE,EACV,aAAa,EACb,aAAa,EAAE,EACf,gBAAgB,EACjB;IACC,qBACE,6LAAC,2IAAI;QAAC,WAAU;;0BACd,6LAAC,iJAAU;0BACT,cAAA,6LAAC,gJAAS;8BAAC;;;;;;;;;;;0BAEb,6LAAC,kJAAW;gBAAC,WAAU;;kCACrB,6LAAC,kKAAqB;wBACpB,eAAe;wBACf,uBAAuB;;;;;;oBAGxB,mCACC,6LAAC,oKAAuB;wBACtB,YAAY;wBACZ,WAAW;wBACX,YAAY;wBACZ,UAAU;wBACV,oBAAoB;wBACpB,qBAAqB;wBACrB,aAAa;wBACb,WAAW;wBACX,QAAQ;wBACR,uBAAuB;wBACvB,WAAW;wBACX,UAAU;wBACV,gBAAgB;wBAChB,sBAAsB,YAAY,uBAAuB;wBACzD,cAAc;wBACd,cAAc;wBACd,iBAAiB;;;;;;oBAIpB,oCACC,6LAAC,2IAAI;wBAAC,WAAU;;0CACd,6LAAC,iJAAU;gCAAC,WAAU;0CACpB,cAAA,6LAAC,gJAAS;oCAAC,WAAU;8CAAyB;;;;;;;;;;;0CAEhD,6LAAC,kJAAW;0CACV,cAAA,6LAAC,sKAAyB;oCACxB,UAAU;oCACV,UAAU;oCACV,WAAW;oCACX,gBAAgB;oCAChB,aAAa;oCACb,eAAe,YAAY,uBAAuB;oCAClD,cAAc;oCACd,cAAc;oCACd,iBAAiB;;;;;;;;;;;;;;;;;kCAMzB,6LAAC,iKAAoB;wBACnB,YAAY;wBACZ,oBAAoB;wBACpB,uBAAuB;wBACvB,qBAAqB;wBACrB,cAAc;wBACd,eAAe;;;;;;oBAGhB,kCACC,6LAAC,iKAAoB;wBACnB,OAAO;wBACP,UAAU;;;;;;kCAId,6LAAC;wBAAI,WAAU;;0CACb,6LAAC,6IAAK;gCAAC,SAAQ;0CAAY;;;;;;0CAC3B,6LAAC,6IAAK;gCACJ,IAAG;gCACH,MAAK;gCACL,OAAO;gCACP,UAAU;gCACV,aAAY;;;;;;;;;;;;;;;;;;;;;;;;AAMxB;KAjHM;uCAmHS"}},
    {"offset": {"line": 5704, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/ui/checkbox.tsx"],"sourcesContent":["import * as React from \"react\"\r\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\r\nimport { Check } from \"lucide-react\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst Checkbox = React.forwardRef<\r\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\r\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\r\n>(({ className, ...props }, ref) => (\r\n  <CheckboxPrimitive.Root\r\n    ref={ref}\r\n    className={cn(\r\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\r\n      className\r\n    )}\r\n    {...props}\r\n  >\r\n    <CheckboxPrimitive.Indicator\r\n      className={cn(\"flex items-center justify-center text-current\")}\r\n    >\r\n      <Check className=\"h-4 w-4\" />\r\n    </CheckboxPrimitive.Indicator>\r\n  </CheckboxPrimitive.Root>\r\n))\r\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\r\n\r\nexport { Checkbox }\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AAEA;;;;;;AAEA,MAAM,yBAAW,2KAAgB,MAG/B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,+KAAsB;QACrB,KAAK;QACL,WAAW,IAAA,4HAAE,EACX,kTACA;QAED,GAAG,KAAK;kBAET,cAAA,6LAAC,oLAA2B;YAC1B,WAAW,IAAA,4HAAE,EAAC;sBAEd,cAAA,6LAAC,gNAAK;gBAAC,WAAU;;;;;;;;;;;;;;;;;AAIvB,SAAS,WAAW,GAAG,+KAAsB,CAAC,WAAW"}},
    {"offset": {"line": 5754, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/sales/SaleFormActions.tsx"],"sourcesContent":["import React, { useEffect, useState, useMemo } from \"react\";\r\nimport { useBusiness } from \"@/contexts/BusinessContext\";\r\nimport { useBusinessSettings } from \"@/hooks/useBusinessSettings\";\r\nimport { useAuth } from \"@/components/auth/AuthProvider\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Checkbox } from \"@/components/ui/checkbox\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Card, CardContent } from \"@/components/ui/card\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { Loader2, MessageSquare, Printer } from \"lucide-react\";\r\nimport { useMessages } from \"@/hooks/useMessages\";\r\nimport { checkBridgeStatus } from \"@/utils/thermalPrinterPlug\";\r\nimport {\r\n  Select,\r\n  SelectTrigger,\r\n  SelectValue,\r\n  SelectContent,\r\n  SelectItem,\r\n} from \"@/components/ui/select\";\r\n\r\ninterface SaleFormActionsProps {\r\n  loading: boolean;\r\n  isEditing: boolean;\r\n  onCancel: () => void;\r\n  onClearForm?: () => void;\r\n  printAfterSave: boolean;\r\n  onPrintAfterSaveChange: (checked: boolean) => void;\r\n  thermalPrintAfterSave?: boolean;\r\n  onThermalPrintAfterSaveChange?: (checked: boolean) => void;\r\n  paymentStatus: string;\r\n  includePaymentInfo: boolean;\r\n  onIncludePaymentInfoChange: (checked: boolean) => void;\r\n  hasPendingPaymentChanges?: boolean;\r\n\r\n  sendSMS?: boolean;\r\n  onSendSMSChange?: (checked: boolean) => void;\r\n  smsMessage?: string;\r\n  onSMSMessageChange?: (message: string) => void;\r\n  customerName?: string;\r\n  customerHasPhone?: boolean;\r\n  disabled?: boolean;\r\n}\r\n\r\nconst SaleFormActions: React.FC<SaleFormActionsProps> = ({\r\n  loading,\r\n  isEditing,\r\n  onCancel,\r\n  onClearForm,\r\n  printAfterSave,\r\n  onPrintAfterSaveChange,\r\n  thermalPrintAfterSave = false,\r\n  onThermalPrintAfterSaveChange,\r\n  paymentStatus,\r\n  includePaymentInfo,\r\n  onIncludePaymentInfoChange,\r\n  hasPendingPaymentChanges = false,\r\n  sendSMS = false,\r\n  onSendSMSChange,\r\n  smsMessage = \"\",\r\n  onSMSMessageChange,\r\n  customerName = \"\",\r\n  customerHasPhone = false,\r\n  disabled = false,\r\n}) => {\r\n  const { user } = useAuth();\r\n  const userId = user?.id;\r\n  const { currentBusiness } = useBusiness();\r\n  const { settings } = useBusinessSettings();\r\n  const [isBridgeOnline, setIsBridgeOnline] = useState(false);\r\n\r\n  const { templates = [], isLoading: templatesLoading } = useMessages(userId);\r\n\r\n  const [selectedTemplateId, setSelectedTemplateId] = useState<string>(\"\");\r\n\r\n  useEffect(() => {\r\n    const checkBridge = async () => {\r\n      const isOnline = await checkBridgeStatus();\r\n      setIsBridgeOnline(isOnline);\r\n    };\r\n    checkBridge();\r\n  }, []);\r\n\r\n  const FALLBACK_PLACEHOLDER =\r\n    \"Thank you for your purchase, {customer_name}! We appreciate your business.\";\r\n\r\n  // Comprehensive default template\r\n  // Comprehensive default template\r\n  const DEFAULT_TEMPLATE = \"Thank you for your purchase from {business_name} We truly appreciate your support and trust in our Business. If you need any assistance or have any questions about your order, please feel free to reach out, on {business_number} We look forward to servingyouagain!\";\r\n\r\n  // --- Utility function moved up ---\r\n  const fillTemplate = (template: string, name: string) => {\r\n    let result = template;\r\n    if (name) {\r\n      result = result\r\n        .replace(/\\{customer_name\\}/gi, name)\r\n        .replace(/\\{first_name\\}/gi, name.split(\" \")[0] || \"\")\r\n        .replace(/\\{last_name\\}/gi, name.split(\" \").slice(1).join(\" \") || \"\");\r\n    }\r\n    // Replace business placeholders\r\n    result = result\r\n      .replace(/\\{business_name\\}/gi, currentBusiness?.name || \"[Business Name]\")\r\n      .replace(/\\{business_number\\}/gi, settings.businessPhone || \"[Business Number]\");\r\n    return result;\r\n  };\r\n\r\n  // Filter ThankYou templates\r\n  const thankYouTemplates = useMemo(() => {\r\n    return templates.filter(\r\n      (t) => t.category && String(t.category).trim() === \"ThankYou\"\r\n    );\r\n  }, [templates]);\r\n\r\n  // --- Unified effect for template auto-fill ---\r\n  useEffect(() => {\r\n    if (!sendSMS || !onSMSMessageChange) return;\r\n\r\n    let templateToUse = DEFAULT_TEMPLATE;\r\n\r\n    // Handle template selection\r\n    if (selectedTemplateId === 'default') {\r\n      templateToUse = DEFAULT_TEMPLATE;\r\n    } else if (selectedTemplateId && thankYouTemplates.length > 0) {\r\n      const tpl = thankYouTemplates.find((t) => t.id === selectedTemplateId);\r\n      if (tpl) {\r\n        templateToUse = tpl.content;\r\n      }\r\n    } else if (!selectedTemplateId) {\r\n      // Auto-set to default\r\n      setSelectedTemplateId('default');\r\n    }\r\n\r\n    const filledMessage = fillTemplate(templateToUse, customerName);\r\n    onSMSMessageChange(filledMessage);\r\n  }, [\r\n    sendSMS,\r\n    customerName,\r\n    thankYouTemplates,\r\n    selectedTemplateId,\r\n    onSMSMessageChange,\r\n  ]);\r\n\r\n  const handleTemplateChange = (id: string) => {\r\n    setSelectedTemplateId(id);\r\n\r\n    let templateContent = DEFAULT_TEMPLATE;\r\n    if (id === 'default') {\r\n      templateContent = DEFAULT_TEMPLATE;\r\n    } else {\r\n      const tpl = thankYouTemplates.find((t) => t.id === id);\r\n      if (tpl) {\r\n        templateContent = tpl.content;\r\n      }\r\n    }\r\n\r\n    const filled = fillTemplate(templateContent, customerName);\r\n    onSMSMessageChange?.(filled);\r\n  };\r\n\r\n  const messageLength = smsMessage.length;\r\n  const smsCredits = Math.ceil(messageLength / 160) || 1;\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      {/* Print & Payment Options */}\r\n      <Card className=\"border-gray-200\">\r\n        <CardContent className=\"pt-6 space-y-4\">\r\n          <div className=\"flex items-center space-x-2\">\r\n            <Checkbox\r\n              id=\"printAfterSave\"\r\n              checked={printAfterSave}\r\n              onCheckedChange={onPrintAfterSaveChange}\r\n            />\r\n            <Label className=\"text-sm\">\r\n              Show receipt after {isEditing ? \"updating\" : \"creating\"} sale\r\n            </Label>\r\n          </div>\r\n\r\n          {isBridgeOnline && onThermalPrintAfterSaveChange && (\r\n            <div className=\"flex items-center space-x-2\">\r\n              <Checkbox\r\n                id=\"thermalPrintAfterSave\"\r\n                checked={thermalPrintAfterSave}\r\n                onCheckedChange={onThermalPrintAfterSaveChange}\r\n              />\r\n              <Label className=\"text-sm flex items-center gap-1.5 text-green-700 font-medium\">\r\n                <Printer className=\"w-3.5 h-3.5\" />\r\n                Auto-print (Thermal Bridge)\r\n              </Label>\r\n            </div>\r\n          )}\r\n\r\n          {(paymentStatus === \"Paid\" || paymentStatus === \"Installment Sale\") && (\r\n            <div className=\"flex items-center space-x-2\">\r\n              <Checkbox\r\n                id=\"includePaymentInfo\"\r\n                checked={includePaymentInfo}\r\n                onCheckedChange={onIncludePaymentInfoChange}\r\n              />\r\n              <Label className=\"text-sm\">\r\n                Include payment information in receipt\r\n              </Label>\r\n            </div>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* SMS Section */}\r\n      {onSendSMSChange && onSMSMessageChange && (\r\n        <Card\r\n          className={`border-blue-200 ${sendSMS ? \"bg-blue-50/50\" : \"bg-gray-50\"\r\n            }`}\r\n        >\r\n          <CardContent className=\"pt-6 space-y-4\">\r\n            <div className=\"flex items-start space-x-3\">\r\n              <Checkbox\r\n                id=\"sendSMS\"\r\n                checked={sendSMS}\r\n                onCheckedChange={onSendSMSChange}\r\n                disabled={!customerHasPhone}\r\n              />\r\n              <div className=\"flex-1\">\r\n                <Label className=\"text-base font-medium flex items-center gap-2\">\r\n                  <MessageSquare className=\"w-5 h-5 text-blue-600\" />\r\n                  Send Thank You SMS\r\n                </Label>\r\n                {!customerHasPhone && (\r\n                  <p className=\"text-xs text-amber-600 mt-1\">\r\n                    Customer phone number required to send SMS\r\n                  </p>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {sendSMS && customerHasPhone && (\r\n              <div className=\"space-y-4 pl-8 border-l-4 border-blue-300 bg-blue-50/30 -m-4 p-4 rounded-r-lg\">\r\n                {/* Template Selector */}\r\n                <div>\r\n                  <Label className=\"text-sm font-medium\">Template</Label>\r\n                  {templatesLoading ? (\r\n                    <div className=\"text-sm text-gray-500 flex items-center gap-2 mt-1\">\r\n                      <Loader2 className=\"w-4 h-4 animate-spin\" />\r\n                      Loading templates...\r\n                    </div>\r\n                  ) : (\r\n                    <Select\r\n                      value={selectedTemplateId || \"default\"}\r\n                      onValueChange={handleTemplateChange}\r\n                    >\r\n                      <SelectTrigger className=\"mt-1\">\r\n                        <SelectValue placeholder=\"Choose a thank you template...\" />\r\n                      </SelectTrigger>\r\n                      <SelectContent>\r\n                        <SelectItem value=\"default\">\r\n                          Default Template\r\n                        </SelectItem>\r\n                        {thankYouTemplates.map((t) => (\r\n                          <SelectItem key={t.id} value={t.id}>\r\n                            {t.name}\r\n                          </SelectItem>\r\n                        ))}\r\n                      </SelectContent>\r\n                    </Select>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Message */}\r\n                <div>\r\n                  <Label className=\"text-sm font-medium\">Message</Label>\r\n                  <Textarea\r\n                    value={smsMessage}\r\n                    onChange={(e) => onSMSMessageChange?.(e.target.value)}\r\n                    placeholder=\"Your message will appear here...\"\r\n                    rows={4}\r\n                    className=\"mt-1 resize-none text-sm font-medium\"\r\n                  />\r\n                  <div className=\"flex justify-between items-center mt-2 text-xs text-gray-600\">\r\n                    <span>{messageLength} characters</span>\r\n                    <span className=\"font-semibold text-blue-600\">\r\n                      {smsCredits} SMS credit{smsCredits > 1 ? \"s\" : \"\"} will\r\n                      be used\r\n                    </span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {/* Rest of your buttons */}\r\n      {hasPendingPaymentChanges && (\r\n        <div className=\"text-sm text-amber-600 bg-amber-50 p-3 rounded border border-amber-200\">\r\n          Pending payment changes will be applied when updating.\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"flex gap-4 pt-4\">\r\n        <Button\r\n          type=\"button\"\r\n          variant=\"outline\"\r\n          onClick={onCancel}\r\n          disabled={loading}\r\n          className=\"flex-1\"\r\n        >\r\n          Cancel\r\n        </Button>\r\n        {!isEditing && onClearForm && (\r\n          <Button\r\n            type=\"button\"\r\n            variant=\"outline\"\r\n            onClick={onClearForm}\r\n            disabled={loading}\r\n            className=\"flex-1\"\r\n          >\r\n            Clear Form\r\n          </Button>\r\n        )}\r\n        <Button\r\n          type=\"submit\"\r\n          disabled={loading || disabled}\r\n          className=\"flex-1 bg-blue-600 hover:bg-blue-700\"\r\n        >\r\n          {loading ? (\r\n            <>\r\n              <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\r\n              {isEditing ? \"Updating...\" : \"Creating...\"}\r\n            </>\r\n          ) : isEditing ? (\r\n            \"Update Sale\"\r\n          ) : (\r\n            \"Create Sale\"\r\n          )}\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SaleFormActions;\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;;;;;;;;;;;;;;;;AA+BA,MAAM,kBAAkD,CAAC,EACvD,OAAO,EACP,SAAS,EACT,QAAQ,EACR,WAAW,EACX,cAAc,EACd,sBAAsB,EACtB,wBAAwB,KAAK,EAC7B,6BAA6B,EAC7B,aAAa,EACb,kBAAkB,EAClB,0BAA0B,EAC1B,2BAA2B,KAAK,EAChC,UAAU,KAAK,EACf,eAAe,EACf,aAAa,EAAE,EACf,kBAAkB,EAClB,eAAe,EAAE,EACjB,mBAAmB,KAAK,EACxB,WAAW,KAAK,EACjB;;IACC,MAAM,EAAE,IAAI,EAAE,GAAG,IAAA,wJAAO;IACxB,MAAM,SAAS,MAAM;IACrB,MAAM,EAAE,eAAe,EAAE,GAAG,IAAA,qJAAW;IACvC,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAA,6JAAmB;IACxC,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,yKAAQ,EAAC;IAErD,MAAM,EAAE,YAAY,EAAE,EAAE,WAAW,gBAAgB,EAAE,GAAG,IAAA,6IAAW,EAAC;IAEpE,MAAM,CAAC,oBAAoB,sBAAsB,GAAG,IAAA,yKAAQ,EAAS;IAErE,IAAA,0KAAS;qCAAC;YACR,MAAM;yDAAc;oBAClB,MAAM,WAAW,MAAM,IAAA,0JAAiB;oBACxC,kBAAkB;gBACpB;;YACA;QACF;oCAAG,EAAE;IAEL,MAAM,uBACJ;IAEF,iCAAiC;IACjC,iCAAiC;IACjC,MAAM,mBAAmB;IAEzB,oCAAoC;IACpC,MAAM,eAAe,CAAC,UAAkB;QACtC,IAAI,SAAS;QACb,IAAI,MAAM;YACR,SAAS,OACN,OAAO,CAAC,uBAAuB,MAC/B,OAAO,CAAC,oBAAoB,KAAK,KAAK,CAAC,IAAI,CAAC,EAAE,IAAI,IAClD,OAAO,CAAC,mBAAmB,KAAK,KAAK,CAAC,KAAK,KAAK,CAAC,GAAG,IAAI,CAAC,QAAQ;QACtE;QACA,gCAAgC;QAChC,SAAS,OACN,OAAO,CAAC,uBAAuB,iBAAiB,QAAQ,mBACxD,OAAO,CAAC,yBAAyB,SAAS,aAAa,IAAI;QAC9D,OAAO;IACT;IAEA,4BAA4B;IAC5B,MAAM,oBAAoB,IAAA,wKAAO;sDAAC;YAChC,OAAO,UAAU,MAAM;8DACrB,CAAC,IAAM,EAAE,QAAQ,IAAI,OAAO,EAAE,QAAQ,EAAE,IAAI,OAAO;;QAEvD;qDAAG;QAAC;KAAU;IAEd,gDAAgD;IAChD,IAAA,0KAAS;qCAAC;YACR,IAAI,CAAC,WAAW,CAAC,oBAAoB;YAErC,IAAI,gBAAgB;YAEpB,4BAA4B;YAC5B,IAAI,uBAAuB,WAAW;gBACpC,gBAAgB;YAClB,OAAO,IAAI,sBAAsB,kBAAkB,MAAM,GAAG,GAAG;gBAC7D,MAAM,MAAM,kBAAkB,IAAI;qDAAC,CAAC,IAAM,EAAE,EAAE,KAAK;;gBACnD,IAAI,KAAK;oBACP,gBAAgB,IAAI,OAAO;gBAC7B;YACF,OAAO,IAAI,CAAC,oBAAoB;gBAC9B,sBAAsB;gBACtB,sBAAsB;YACxB;YAEA,MAAM,gBAAgB,aAAa,eAAe;YAClD,mBAAmB;QACrB;oCAAG;QACD;QACA;QACA;QACA;QACA;KACD;IAED,MAAM,uBAAuB,CAAC;QAC5B,sBAAsB;QAEtB,IAAI,kBAAkB;QACtB,IAAI,OAAO,WAAW;YACpB,kBAAkB;QACpB,OAAO;YACL,MAAM,MAAM,kBAAkB,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;YACnD,IAAI,KAAK;gBACP,kBAAkB,IAAI,OAAO;YAC/B;QACF;QAEA,MAAM,SAAS,aAAa,iBAAiB;QAC7C,qBAAqB;IACvB;IAEA,MAAM,gBAAgB,WAAW,MAAM;IACvC,MAAM,aAAa,KAAK,IAAI,CAAC,gBAAgB,QAAQ;IAErD,qBACE,6LAAC;QAAI,WAAU;;0BAEb,6LAAC,2IAAI;gBAAC,WAAU;0BACd,cAAA,6LAAC,kJAAW;oBAAC,WAAU;;sCACrB,6LAAC;4BAAI,WAAU;;8CACb,6LAAC,mJAAQ;oCACP,IAAG;oCACH,SAAS;oCACT,iBAAiB;;;;;;8CAEnB,6LAAC,6IAAK;oCAAC,WAAU;;wCAAU;wCACL,YAAY,aAAa;wCAAW;;;;;;;;;;;;;wBAI3D,kBAAkB,+CACjB,6LAAC;4BAAI,WAAU;;8CACb,6LAAC,mJAAQ;oCACP,IAAG;oCACH,SAAS;oCACT,iBAAiB;;;;;;8CAEnB,6LAAC,6IAAK;oCAAC,WAAU;;sDACf,6LAAC,sNAAO;4CAAC,WAAU;;;;;;wCAAgB;;;;;;;;;;;;;wBAMxC,CAAC,kBAAkB,UAAU,kBAAkB,kBAAkB,mBAChE,6LAAC;4BAAI,WAAU;;8CACb,6LAAC,mJAAQ;oCACP,IAAG;oCACH,SAAS;oCACT,iBAAiB;;;;;;8CAEnB,6LAAC,6IAAK;oCAAC,WAAU;8CAAU;;;;;;;;;;;;;;;;;;;;;;;YASlC,mBAAmB,oCAClB,6LAAC,2IAAI;gBACH,WAAW,CAAC,gBAAgB,EAAE,UAAU,kBAAkB,cACtD;0BAEJ,cAAA,6LAAC,kJAAW;oBAAC,WAAU;;sCACrB,6LAAC;4BAAI,WAAU;;8CACb,6LAAC,mJAAQ;oCACP,IAAG;oCACH,SAAS;oCACT,iBAAiB;oCACjB,UAAU,CAAC;;;;;;8CAEb,6LAAC;oCAAI,WAAU;;sDACb,6LAAC,6IAAK;4CAAC,WAAU;;8DACf,6LAAC,4OAAa;oDAAC,WAAU;;;;;;gDAA0B;;;;;;;wCAGpD,CAAC,kCACA,6LAAC;4CAAE,WAAU;sDAA8B;;;;;;;;;;;;;;;;;;wBAOhD,WAAW,kCACV,6LAAC;4BAAI,WAAU;;8CAEb,6LAAC;;sDACC,6LAAC,6IAAK;4CAAC,WAAU;sDAAsB;;;;;;wCACtC,iCACC,6LAAC;4CAAI,WAAU;;8DACb,6LAAC,+NAAO;oDAAC,WAAU;;;;;;gDAAyB;;;;;;qGAI9C,6LAAC,+IAAM;4CACL,OAAO,sBAAsB;4CAC7B,eAAe;;8DAEf,6LAAC,sJAAa;oDAAC,WAAU;8DACvB,cAAA,6LAAC,oJAAW;wDAAC,aAAY;;;;;;;;;;;8DAE3B,6LAAC,sJAAa;;sEACZ,6LAAC,mJAAU;4DAAC,OAAM;sEAAU;;;;;;wDAG3B,kBAAkB,GAAG,CAAC,CAAC,kBACtB,6LAAC,mJAAU;gEAAY,OAAO,EAAE,EAAE;0EAC/B,EAAE,IAAI;+DADQ,EAAE,EAAE;;;;;;;;;;;;;;;;;;;;;;;8CAU/B,6LAAC;;sDACC,6LAAC,6IAAK;4CAAC,WAAU;sDAAsB;;;;;;sDACvC,6LAAC,mJAAQ;4CACP,OAAO;4CACP,UAAU,CAAC,IAAM,qBAAqB,EAAE,MAAM,CAAC,KAAK;4CACpD,aAAY;4CACZ,MAAM;4CACN,WAAU;;;;;;sDAEZ,6LAAC;4CAAI,WAAU;;8DACb,6LAAC;;wDAAM;wDAAc;;;;;;;8DACrB,6LAAC;oDAAK,WAAU;;wDACb;wDAAW;wDAAY,aAAa,IAAI,MAAM;wDAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;YAYjE,0CACC,6LAAC;gBAAI,WAAU;0BAAyE;;;;;;0BAK1F,6LAAC;gBAAI,WAAU;;kCACb,6LAAC,+IAAM;wBACL,MAAK;wBACL,SAAQ;wBACR,SAAS;wBACT,UAAU;wBACV,WAAU;kCACX;;;;;;oBAGA,CAAC,aAAa,6BACb,6LAAC,+IAAM;wBACL,MAAK;wBACL,SAAQ;wBACR,SAAS;wBACT,UAAU;wBACV,WAAU;kCACX;;;;;;kCAIH,6LAAC,+IAAM;wBACL,MAAK;wBACL,UAAU,WAAW;wBACrB,WAAU;kCAET,wBACC;;8CACE,6LAAC,+NAAO;oCAAC,WAAU;;;;;;gCAClB,YAAY,gBAAgB;;2CAE7B,YACF,gBAEA;;;;;;;;;;;;;;;;;;AAMZ;GArSM;;QAqBa,wJAAO;QAEI,qJAAW;QAClB,6JAAmB;QAGgB,6IAAW;;;KA3B/D;uCAuSS"}},
    {"offset": {"line": 6293, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/SalesForm.tsx"],"sourcesContent":["// SalesForm.tsx\r\nimport React, { useState, useEffect, useRef, useMemo } from 'react';\r\nimport { useRouter, useSearchParams } from 'next/navigation';\r\nimport { toast } from 'sonner';\r\nimport { Sale, SaleFormData, SaleItem, mapSaleToDbSale, Customer, Product } from '@/types';\r\nimport { useAuth } from '@/components/auth/AuthProvider';\r\nimport { calculateProfit } from '@/utils/calculateProfit';\r\nimport { generateReceiptNumber } from '@/utils/generateReceiptNumber';\r\nimport { lookupProductByBarcodeAction, getProductsForBarcodeScannerAction, updateSaleCashTransactionAction } from '@/app/actions/products';\r\nimport { useBusinessSettings } from '@/hooks/useBusinessSettings';\r\nimport { useProducts } from '@/hooks/useProducts';\r\nimport { useSaleProductSelection } from '@/hooks/useSaleProductSelection';\r\nimport { useCashAccounts } from '@/hooks/useCashAccounts';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\nimport { useSaleDraft } from '@/hooks/useSaleDraft';\r\nimport { useSaleFormLogic } from '@/hooks/useSaleFormLogic';\r\nimport { useCashTransactionOperations } from '@/hooks/useCashTransactionOperations';\r\nimport { useInstallmentPayments } from '@/hooks/useInstallmentPayments';\r\nimport { useStockHistory } from '@/hooks/useStockHistory';\r\nimport { useMessages } from '@/hooks/useMessages'; // This is the key fix!\r\nimport { useQuery } from '@tanstack/react-query';\r\nimport { upsertSaleAction } from '@/app/actions/sales';\r\n\r\n// Components\r\nimport SaleFormHeader from '@/components/sales/SaleFormHeader';\r\nimport SaleItemsManager from '@/components/sales/SaleItemsManager';\r\nimport SalePaymentSection from '@/components/sales/SalePaymentSection';\r\nimport SaleFormActions from '@/components/sales/SaleFormActions';\r\nimport SaleCategorySelector from '@/components/sales/SaleCategorySelector';\r\nimport { mapDbProductToProduct } from '@/types';\r\n\r\ninterface SalesFormProps {\r\n  initialData?: Sale;\r\n  onSaleComplete?: (sale: Sale, showReceipt?: boolean, includePaymentInfo?: boolean, selectedCustomerCategoryId?: string, onClearDraft?: () => void, saleDate?: Date, thermalPrintAfterSave?: boolean) => void;\r\n  currency?: string;\r\n  customers?: Customer[];\r\n  onAddNewCustomer?: () => void;\r\n  draftData?: any;\r\n  onClearDraft?: () => void;\r\n}\r\n\r\nconst SalesForm: React.FC<SalesFormProps> = ({\r\n  initialData,\r\n  onSaleComplete,\r\n  currency = 'USD',\r\n  customers = [],\r\n  onAddNewCustomer,\r\n  draftData,\r\n  onClearDraft,\r\n}) => {\r\n  const router = useRouter();\r\n  const searchParams = useSearchParams();\r\n  const [loading, setLoading] = useState(false);\r\n  const [selectedDate, setSelectedDate] = useState<Date>(initialData?.date || new Date());\r\n\r\n  // Note: defaultPaymentStatus might need to come from props since we don't have location.state\r\n  const defaultPaymentStatus = initialData?.paymentStatus || 'Paid';\r\n\r\n  const { settings } = useBusinessSettings();\r\n  const { user } = useAuth();\r\n  const { updateInventoryForSale, updateInventoryForEditedSale } = useSaleProductSelection(user?.id);\r\n  const { accounts: cashAccounts } = useCashAccounts();\r\n  const { currentBusiness } = useBusiness();\r\n\r\n  // DEBUG: Check if initialData has categoryId\r\n  useEffect(() => {\r\n    if (initialData) {\r\n      console.log('SalesForm initialData:', initialData);\r\n      console.log('SalesForm initialData.categoryId:', initialData.categoryId);\r\n      console.log('SalesForm initialData.notes:', initialData.notes);\r\n    }\r\n  }, [initialData]);\r\n\r\n  const { saveDraft } = useSaleDraft();\r\n  const { updateStockHistoryDatesBySaleId } = useStockHistory(user?.id);\r\n  const autoSaveTimeoutRef = useRef<NodeJS.Timeout>();\r\n  const isClearingRef = useRef(false);\r\n\r\n  const [isSubmitted, setIsSubmitted] = useState(false);\r\n\r\n  // Key: Use the proper messaging hook\r\n  const { createMessage, templates = [] } = useMessages(user?.id);\r\n  const [selectedTemplateId, setSelectedTemplateId] = useState<string | null>(null);\r\n  const [sendSMS, setSendSMS] = useState(true);\r\n\r\n  // Comprehensive default SMS template\r\n  // Comprehensive default SMS template\r\n  const defaultSMSTemplate = \"Thank you for your purchase from {business_name} We truly appreciate your support and trust in our Business. If you need any assistance or have any questions about your order, please feel free to reach out, on {business_number} We look forward to servingyouagain!\";\r\n\r\n  const [smsMessage, setSMSMessage] = useState(defaultSMSTemplate);\r\n\r\n  // Custom hooks\r\n  const {\r\n    formData,\r\n    errors,\r\n    taxRateInput,\r\n    printAfterSave,\r\n    thermalPrintAfterSave,\r\n    includePaymentInfo,\r\n    selectedCustomerCategoryId,\r\n    paymentDate,\r\n    linkToCash,\r\n    selectedCashAccountId,\r\n    cashTransactionId,\r\n    originalPaymentStatus,\r\n    formRecentlyCleared,\r\n    payments,\r\n    pendingChanges,\r\n    hasChanges,\r\n    setFormData,\r\n    setTaxRateInput,\r\n    setPrintAfterSave,\r\n    setThermalPrintAfterSave,\r\n    setIncludePaymentInfo,\r\n    setLinkToCash,\r\n    setSelectedCashAccountId,\r\n    setCashTransactionId,\r\n    setOriginalPaymentStatus,\r\n    handleChange,\r\n    handleSelectChange,\r\n    handleAddItem,\r\n    handleUpdateItem,\r\n    handleRemoveItem,\r\n    handleSelectCustomer,\r\n    handleCategoryChange,\r\n    handleSalesCategoryChange,\r\n    handleAmountPaidChange,\r\n    handlePaymentDateChange,\r\n    calculateTotalAmount,\r\n    calculateTaxAmount,\r\n    validateForm,\r\n    processPendingPaymentChanges,\r\n    createInstallmentPayment,\r\n    updateInstallmentPayment,\r\n    deleteInstallmentPayment,\r\n    addPaymentChange,\r\n    clearChanges,\r\n    getModifiedPayments,\r\n    clearForm,\r\n  } = useSaleFormLogic({\r\n    initialData,\r\n    defaultPaymentStatus,\r\n    cashAccounts\r\n  });\r\n\r\n  const {\r\n    createCashTransactionForSale,\r\n    updateCashTransactionForSale,\r\n    createInstallmentPaymentWithCash,\r\n    findCashTransactionForSale,\r\n  } = useCashTransactionOperations();\r\n\r\n  const {\r\n    payments: installmentPayments,\r\n    linkPaymentToCashAccount,\r\n    unlinkPaymentFromCashAccount,\r\n    updatePayment: updatePaymentOriginal\r\n  } = useInstallmentPayments(initialData?.id);\r\n\r\n  const updatePayment = async (paymentId: string, updates: { amount?: number; notes?: string; paymentDate?: Date }) => {\r\n    await updatePaymentOriginal(paymentId, updates);\r\n  };\r\n\r\n  const [saleCompleted, setSaleCompleted] = useState(false);\r\n\r\n  // Wrapper for clear form to manage the ref and prevent race conditions\r\n  const handleClearForm = () => {\r\n    isClearingRef.current = true;\r\n    if (clearForm) {\r\n      clearForm(() => setSelectedDate(new Date()), onClearDraft);\r\n    }\r\n  };\r\n\r\n  // Reset ref after render\r\n  useEffect(() => {\r\n    isClearingRef.current = false;\r\n  });\r\n\r\n  // Auto-save draft\r\n  const autoSaveDraft = React.useCallback(() => {\r\n    // Check ref to prevent saving during clear operation\r\n    if (isClearingRef.current) return;\r\n\r\n    if (!initialData && !loading && !saleCompleted && !formRecentlyCleared) {\r\n      const hasData = formData.customerName.trim() ||\r\n        formData.customerAddress.trim() ||\r\n        formData.customerContact.trim() ||\r\n        formData.items.some(item => item.description.trim() || item.quantity !== 1 || item.price !== 0);\r\n\r\n      if (hasData) {\r\n        saveDraft(formData, selectedDate);\r\n      }\r\n    }\r\n  }, [formData, selectedDate, initialData, loading, saveDraft, saleCompleted, formRecentlyCleared]);\r\n\r\n  useEffect(() => {\r\n    if (autoSaveTimeoutRef.current) clearTimeout(autoSaveTimeoutRef.current);\r\n    autoSaveTimeoutRef.current = setTimeout(autoSaveDraft, 2000);\r\n    return () => {\r\n      if (autoSaveTimeoutRef.current) clearTimeout(autoSaveTimeoutRef.current);\r\n      autoSaveDraft(); // Save on unmount to capture data before navigation\r\n    };\r\n  }, [autoSaveDraft]);\r\n\r\n  useEffect(() => {\r\n    const handleBeforeUnload = () => autoSaveDraft();\r\n    const handleVisibilityChange = () => document.hidden && autoSaveDraft();\r\n    window.addEventListener('beforeunload', handleBeforeUnload);\r\n    document.addEventListener('visibilitychange', handleVisibilityChange);\r\n    return () => {\r\n      window.removeEventListener('beforeunload', handleBeforeUnload);\r\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\r\n    };\r\n  }, [autoSaveDraft]);\r\n\r\n  useEffect(() => {\r\n    if (draftData && !initialData) {\r\n      setFormData(draftData.formData);\r\n      setSelectedDate(draftData.selectedDate);\r\n      setTaxRateInput(draftData.formData.taxRate?.toString() || '');\r\n      // Removed onClearDraft call to keep draft until sale is saved/completed\r\n    }\r\n  }, [draftData, initialData, setFormData, setTaxRateInput]);\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      if (initialData?.cashTransactionId) {\r\n        setLinkToCash(true);\r\n        setCashTransactionId(initialData.cashTransactionId);\r\n        const accountId = await findCashTransactionForSale(initialData.cashTransactionId);\r\n        if (accountId) setSelectedCashAccountId(accountId);\r\n      }\r\n      if (cashAccounts.length > 0 && !selectedCashAccountId && !initialData?.cashTransactionId) {\r\n        const defaultAccount = cashAccounts.find(acc => acc.isDefault) || cashAccounts[0];\r\n        setSelectedCashAccountId(defaultAccount.id);\r\n      }\r\n    })();\r\n  }, [initialData, cashAccounts, findCashTransactionForSale, setSelectedCashAccountId]);\r\n\r\n  const calculateTotalProfit = (items: SaleItem[]) => {\r\n    return items.reduce((total, item) => {\r\n      // Calculate the effective price after discount (same logic as revenue calculation)\r\n      const subtotal = item.price * item.quantity;\r\n      const discountAmount = item.discountType === 'amount'\r\n        ? (item.discountAmount || 0)\r\n        : (subtotal * (item.discountPercentage || 0)) / 100;\r\n      const effectiveRevenue = subtotal - discountAmount;\r\n      const totalCost = item.cost * item.quantity;\r\n      const itemProfit = effectiveRevenue - totalCost;\r\n\r\n      return total + itemProfit;\r\n    }, 0);\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n\r\n    const totalAmount = calculateTotalAmount(formData.items);\r\n    const taxAmount = calculateTaxAmount(totalAmount);\r\n    const grandTotal = totalAmount + taxAmount;\r\n\r\n    if (!validateForm(grandTotal, selectedDate)) {\r\n      // Show specific error from errors object if available\r\n      if (errors.customerName) {\r\n        toast.error(errors.customerName);\r\n      } else if (errors.taxRate) {\r\n        toast.error(errors.taxRate);\r\n      } else {\r\n        toast.error('Please fill in all required fields correctly');\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (formData.items.length === 0 || formData.items.every(item => !item.description.trim())) {\r\n      toast.error('Please add at least one valid item');\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    try {\r\n      let receiptNumber = initialData?.receiptNumber || await generateReceiptNumber(currentBusiness?.id || '');\r\n      const profit = calculateTotalProfit(formData.items);\r\n      let finalCashTransactionId = cashTransactionId;\r\n\r\n      if (initialData) {\r\n        finalCashTransactionId = await updateCashTransactionForSale(\r\n          { id: initialData.id, customerName: formData.customerName, receiptNumber: initialData.receiptNumber, items: formData.items },\r\n          grandTotal, cashTransactionId, originalPaymentStatus, formData.paymentStatus, linkToCash, selectedCashAccountId, selectedDate\r\n        );\r\n        setCashTransactionId(finalCashTransactionId);\r\n      }\r\n\r\n      const saleDbData = mapSaleToDbSale(\r\n        formData,\r\n        selectedDate,\r\n        profit,\r\n        receiptNumber,\r\n        user?.id || '',\r\n        currentBusiness?.id || '',\r\n        finalCashTransactionId\r\n      );\r\n\r\n      const { success, data: saleResult, error } = await upsertSaleAction(saleDbData, !!initialData, initialData?.id);\r\n\r\n      if (!success || !saleResult) throw new Error(error || 'Failed to save sale');\r\n      const result = saleResult as any;\r\n\r\n      const sale: Sale = {\r\n        id: result.id,\r\n        receiptNumber: result.receiptNumber,\r\n        customerName: result.customerName,\r\n        customerAddress: result.customerAddress || '',\r\n        customerContact: result.customerContact || '',\r\n        customerId: result.customerId || undefined,\r\n        items: result.items,\r\n        paymentStatus: result.paymentStatus,\r\n        profit: result.profit,\r\n        date: new Date(result.date),\r\n        taxRate: result.taxRate ? Number(result.taxRate) : 0,\r\n        cashTransactionId: result.cashTransactionId || undefined,\r\n        amountPaid: result.amountPaid ? Number(result.amountPaid) : undefined,\r\n        amountDue: result.amountDue ? Number(result.amountDue) : undefined,\r\n        notes: result.notes || '',\r\n        categoryId: result.categoryId || undefined,\r\n        createdAt: new Date(result.createdAt),\r\n      };\r\n\r\n      // Handle inventory, payments, etc.\r\n      if (initialData) {\r\n        // Inventory updates for edits are now handled in onSaleComplete callback in useNewSaleActions.ts\r\n        // This prevents double deduction bug where stock was reduced twice for edited sales\r\n\r\n        if (hasChanges) await processPendingPaymentChanges();\r\n        if (formData.paymentStatus === 'Installment Sale' && formData.amountPaid) {\r\n          await createInstallmentPayment({ saleId: sale.id, amount: formData.amountPaid, notes: sale.items.map(i => i.description).join(', '), paymentDate, accountId: linkToCash ? selectedCashAccountId : undefined, locationId: currentBusiness?.id });\r\n          setFormData(prev => ({ ...prev, amountPaid: 0 }));\r\n        }\r\n\r\n\r\n        if (initialData.date.getTime() !== selectedDate.getTime()) {\r\n          await updateStockHistoryDatesBySaleId(sale.id, selectedDate);\r\n        }\r\n      } else {\r\n        const newCashId = await createCashTransactionForSale(sale, grandTotal, linkToCash, selectedCashAccountId, selectedDate, formData.paymentStatus);\r\n        if (newCashId) {\r\n          await updateSaleCashTransactionAction(sale.id, newCashId);\r\n          sale.cashTransactionId = newCashId;\r\n        }\r\n        if (formData.paymentStatus === 'Installment Sale' && formData.amountPaid) {\r\n          await createInstallmentPaymentWithCash(sale.id, formData.amountPaid, sale.items.map(i => i.description).join(', '), linkToCash, selectedCashAccountId, currentBusiness?.id || '', createInstallmentPayment);\r\n        }\r\n        // Inventory update removed from here - it's handled by onSaleComplete callback in useNewSaleActions.ts\r\n        // This prevents double deduction bug where stock was reduced twice for new sales\r\n      }\r\n\r\n      // Clear draft\r\n      if (draftData && onClearDraft) onClearDraft();\r\n\r\n      // IMPORTANT: execute onSaleComplete (which updates inventory) BEFORE showing success\r\n      // If inventory fails, it will throw, identifying the sale as failed\r\n      if (onSaleComplete) {\r\n        await onSaleComplete(sale, printAfterSave, includePaymentInfo, selectedCustomerCategoryId, undefined, selectedDate, thermalPrintAfterSave);\r\n      }\r\n\r\n      toast.success(initialData ? 'Sale updated successfully!' : 'Sale recorded successfully!');\r\n\r\n      // Send Thank You SMS with comprehensive template\r\n      if (sendSMS && formData.customerContact && !initialData) {\r\n        // Generate items list\r\n        const itemsList = formData.items\r\n          .map(item => ` ${item.description} (Qty: ${item.quantity})`)\r\n          .join('\\r\\n');\r\n\r\n        const personalizedMessage = smsMessage\r\n          .replace(/\\{customer_name\\}/gi, formData.customerName || 'Valued Customer')\r\n          .replace(/\\{receipt_number\\}/gi, sale.receiptNumber)\r\n          .replace(/\\{items_list\\}/gi, itemsList)\r\n          .replace(/\\{currency\\}/gi, settings.currency || 'UGX')\r\n          .replace(/\\{amount\\}/gi, grandTotal.toLocaleString())\r\n          .replace(/\\{business_contact\\}/gi, settings.businessPhone || 'our office')\r\n          .replace(/\\{business_name\\}/gi, currentBusiness?.name || 'Our Business');\r\n\r\n        try {\r\n          await createMessage({\r\n            phoneNumber: formData.customerContact,\r\n            content: personalizedMessage,\r\n            customerId: customers.find(c => c.phoneNumber === formData.customerContact)?.id,\r\n            metadata: { sale_id: sale.id, receipt_number: sale.receiptNumber, type: 'thank_you' }\r\n          });\r\n          toast.success('Thank you SMS sent successfully!');\r\n        } catch (smsError: any) {\r\n          toast.error('Sale saved, but failed to send SMS: ' + smsError.message);\r\n        }\r\n      }\r\n\r\n      setSaleCompleted(true);\r\n      setIsSubmitted(true);\r\n\r\n      setSaleCompleted(true);\r\n      setIsSubmitted(true);\r\n\r\n      if (!onSaleComplete) {\r\n        router.push('/sales');\r\n      }\r\n\r\n    } catch (error: any) {\r\n      console.error('Error submitting sale:', error);\r\n      setIsSubmitted(false);\r\n      toast.error(error.message || 'An error occurred. Please try again.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  //  Performance: Memoize expensive calculations to prevent recomputing on every render\r\n  const totalAmount = useMemo(\r\n    () => calculateTotalAmount(formData.items),\r\n    [formData.items]\r\n  );\r\n\r\n  const taxAmount = useMemo(\r\n    () => calculateTaxAmount(totalAmount),\r\n    [totalAmount, formData.taxRate]\r\n  );\r\n\r\n  const grandTotal = useMemo(\r\n    () => totalAmount + taxAmount,\r\n    [totalAmount, taxAmount]\r\n  );\r\n\r\n  // Barcode Scanner Integration\r\n  const { data: allProducts = [] } = useQuery({\r\n    queryKey: ['all-products-for-scanner', user?.id, currentBusiness?.id],\r\n    queryFn: async () => {\r\n      if (!user?.id || !currentBusiness?.id) return [];\r\n      const data = await getProductsForBarcodeScannerAction(currentBusiness.id);\r\n      return (data || []).map(mapDbProductToProduct) as Product[];\r\n    },\r\n    enabled: !!user?.id && !!currentBusiness?.id,\r\n    staleTime: 5 * 60_000,\r\n  });\r\n\r\n  const scannerBufferRef = useRef('');\r\n  const lastKeyTimeRef = useRef(Date.now());\r\n\r\n  useEffect(() => {\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      const target = e.target as HTMLElement;\r\n      const currentTime = Date.now();\r\n      const delay = currentTime - lastKeyTimeRef.current;\r\n      lastKeyTimeRef.current = currentTime;\r\n\r\n      // Ignore special keys\r\n      if (e.key === 'Shift' || e.key === 'Control' || e.key === 'Alt' || e.key === 'Meta') {\r\n        return;\r\n      }\r\n\r\n      // Threshold increased to 60ms for broader scanner compatibility\r\n      const isRapidTyping = delay < 60;\r\n      const isAlphanumeric = /^[a-zA-Z0-9\\-_]$/.test(e.key);\r\n\r\n      // Aggressive Interception: If NOT in an input field, suppress ALL alphanumeric keys\r\n      // This prevents the \"leakage\" into the console that causes ReferenceError.\r\n      const isInput = target.tagName === 'INPUT' || target.tagName === 'TEXTAREA' || target.contentEditable === 'true';\r\n      if (!isInput && isAlphanumeric) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      }\r\n\r\n      // Handle Enter key - this is typically the suffix of a scan\r\n      if (e.key === 'Enter') {\r\n        const scannedBarcode = scannerBufferRef.current.trim();\r\n        if (scannedBarcode.length >= 2) {\r\n          // Always prevent Enter from being processed by browser/console\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n\r\n          console.log(`[Scanner] Processing: \"${scannedBarcode}\"`);\r\n\r\n          // Perform direct server-side lookup via Prisma action\r\n          const performServerLookup = async (code: string): Promise<Product | null> => {\r\n            const result = await lookupProductByBarcodeAction(code, currentBusiness?.id || '');\r\n            return result ? mapDbProductToProduct(result) : null;\r\n          };\r\n\r\n          const handleScan = async () => {\r\n            const product = await performServerLookup(scannedBarcode);\r\n\r\n            if (product) {\r\n              const referenceCode = product.barcode || product.itemNumber || scannedBarcode;\r\n              console.log(`[Scanner]  Server Match: ${product.name}`);\r\n              console.log(`[Scanner]  Mapping \"${scannedBarcode}\" -> System Code \"${referenceCode}\"`);\r\n\r\n              handleAddItem(product);\r\n              toast.success(`Scanned: ${product.name} (${referenceCode})`);\r\n            } else {\r\n              console.warn(`[Scanner]  No server match for: \"${scannedBarcode}\"`);\r\n            }\r\n          };\r\n\r\n          handleScan();\r\n          scannerBufferRef.current = '';\r\n          return;\r\n        }\r\n        scannerBufferRef.current = '';\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        return;\r\n      }\r\n\r\n      // Add character to buffer\r\n      if (e.key.length === 1) {\r\n        // Only prevent default if this is rapid typing (scanner) AND in an input field\r\n        // OR if not in an input field at all\r\n        if (isRapidTyping && isInput && isAlphanumeric) {\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n        }\r\n\r\n        // Update buffer\r\n        if (delay > 100) {\r\n          scannerBufferRef.current = e.key;\r\n        } else {\r\n          scannerBufferRef.current += e.key;\r\n        }\r\n      }\r\n    };\r\n\r\n    window.addEventListener('keydown', handleKeyDown, true);\r\n    return () => window.removeEventListener('keydown', handleKeyDown, true);\r\n  }, [user?.id, currentBusiness?.id]);\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n      <SaleFormHeader\r\n        isEditing={!!initialData}\r\n        selectedDate={selectedDate}\r\n        onDateChange={setSelectedDate}\r\n        customerName={formData.customerName}\r\n        customerAddress={formData.customerAddress}\r\n        customerContact={formData.customerContact}\r\n        notes={formData.notes}\r\n        onCustomerInfoChange={handleChange}\r\n        errors={errors}\r\n        customers={customers}\r\n        onAddNewCustomer={onAddNewCustomer}\r\n        onSelectCustomer={handleSelectCustomer}\r\n        selectedCategoryId={selectedCustomerCategoryId}\r\n        onCategoryChange={handleCategoryChange}\r\n        onClearForm={!initialData ? handleClearForm : undefined}\r\n      />\r\n\r\n\r\n      <SaleItemsManager\r\n        items={formData.items}\r\n        onAddItem={handleAddItem}\r\n        onUpdateItem={handleUpdateItem}\r\n        onRemoveItem={handleRemoveItem}\r\n        taxRateInput={taxRateInput}\r\n        onTaxRateChange={handleChange}\r\n        errors={errors}\r\n        totalAmount={totalAmount}\r\n        taxAmount={taxAmount}\r\n        grandTotal={grandTotal}\r\n        taxRate={formData.taxRate || 0}\r\n        currency={settings.currency}\r\n        saleDate={selectedDate.toISOString()}\r\n      />\r\n\r\n      <SalePaymentSection\r\n        paymentStatus={formData.paymentStatus}\r\n        onPaymentStatusChange={handleSelectChange}\r\n        isInstallmentSale={formData.paymentStatus === 'Installment Sale'}\r\n        amountPaid={formData.amountPaid || 0}\r\n        amountDue={formData.amountDue || 0}\r\n        grandTotal={grandTotal}\r\n        currency={settings.currency}\r\n        onAmountPaidChange={(amount) => handleAmountPaidChange(amount, grandTotal)}\r\n        onPaymentDateChange={handlePaymentDateChange}\r\n        paymentDate={paymentDate}\r\n        saleId={initialData?.id}\r\n        isEditing={!!initialData}\r\n        payments={getModifiedPayments(payments)}\r\n        pendingChanges={pendingChanges}\r\n        onStagePaymentChange={initialData ? addPaymentChange : undefined}\r\n        linkToCash={linkToCash}\r\n        onLinkToCashChange={setLinkToCash}\r\n        selectedCashAccountId={selectedCashAccountId}\r\n        onCashAccountChange={setSelectedCashAccountId}\r\n        cashAccounts={cashAccounts}\r\n        hasPaidWithHistory={formData.paymentStatus === 'Paid' && payments.length > 0}\r\n        onLinkPaymentToCash={(paymentId, accountId) => linkPaymentToCashAccount(paymentId, accountId, currentBusiness?.id || '')}\r\n        onUpdatePayment={updatePayment}\r\n        onPaymentStatusChangeFromInstallment={async (newStatus) => handleSelectChange(newStatus)}\r\n        notes={formData.notes}\r\n        onNotesChange={handleChange}\r\n        categoryId={formData.categoryId || ''}\r\n        onCategoryChange={handleSalesCategoryChange}\r\n      />\r\n\r\n      <SaleFormActions\r\n        loading={loading}\r\n        isEditing={!!initialData}\r\n        onCancel={() => router.push('/sales')}\r\n        onClearForm={!initialData ? handleClearForm : undefined}\r\n        printAfterSave={printAfterSave}\r\n        onPrintAfterSaveChange={setPrintAfterSave}\r\n        thermalPrintAfterSave={thermalPrintAfterSave}\r\n        onThermalPrintAfterSaveChange={setThermalPrintAfterSave}\r\n        paymentStatus={formData.paymentStatus}\r\n        includePaymentInfo={includePaymentInfo}\r\n        onIncludePaymentInfoChange={setIncludePaymentInfo}\r\n        hasPendingPaymentChanges={hasChanges}\r\n        sendSMS={sendSMS}\r\n        onSendSMSChange={setSendSMS}\r\n        smsMessage={smsMessage}\r\n        onSMSMessageChange={setSMSMessage}\r\n        customerHasPhone={!!formData.customerContact}\r\n        customerName={formData.customerName}\r\n        disabled={isSubmitted}\r\n      />\r\n\r\n    </form>\r\n  );\r\n};\r\n\r\nexport default SalesForm;"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6919, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/ui/drawer.tsx"],"sourcesContent":["import * as React from \"react\"\r\nimport { Drawer as DrawerPrimitive } from \"vaul\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst Drawer = ({\r\n  shouldScaleBackground = true,\r\n  ...props\r\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\r\n  <DrawerPrimitive.Root\r\n    shouldScaleBackground={shouldScaleBackground}\r\n    {...props}\r\n  />\r\n)\r\nDrawer.displayName = \"Drawer\"\r\n\r\nconst DrawerTrigger = DrawerPrimitive.Trigger\r\n\r\nconst DrawerPortal = DrawerPrimitive.Portal\r\n\r\nconst DrawerClose = DrawerPrimitive.Close\r\n\r\nconst DrawerOverlay = React.forwardRef<\r\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\r\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\r\n>(({ className, ...props }, ref) => (\r\n  <DrawerPrimitive.Overlay\r\n    ref={ref}\r\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\r\n    {...props}\r\n  />\r\n))\r\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\r\n\r\nconst DrawerContent = React.forwardRef<\r\n  React.ElementRef<typeof DrawerPrimitive.Content>,\r\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\r\n>(({ className, children, ...props }, ref) => (\r\n  <DrawerPortal>\r\n    <DrawerOverlay />\r\n    <DrawerPrimitive.Content\r\n      ref={ref}\r\n      className={cn(\r\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\r\n        className\r\n      )}\r\n      {...props}\r\n    >\r\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\r\n      {children}\r\n    </DrawerPrimitive.Content>\r\n  </DrawerPortal>\r\n))\r\nDrawerContent.displayName = \"DrawerContent\"\r\n\r\nconst DrawerHeader = ({\r\n  className,\r\n  ...props\r\n}: React.HTMLAttributes<HTMLDivElement>) => (\r\n  <div\r\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\r\n    {...props}\r\n  />\r\n)\r\nDrawerHeader.displayName = \"DrawerHeader\"\r\n\r\nconst DrawerFooter = ({\r\n  className,\r\n  ...props\r\n}: React.HTMLAttributes<HTMLDivElement>) => (\r\n  <div\r\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\r\n    {...props}\r\n  />\r\n)\r\nDrawerFooter.displayName = \"DrawerFooter\"\r\n\r\nconst DrawerTitle = React.forwardRef<\r\n  React.ElementRef<typeof DrawerPrimitive.Title>,\r\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\r\n>(({ className, ...props }, ref) => (\r\n  <DrawerPrimitive.Title\r\n    ref={ref}\r\n    className={cn(\r\n      \"text-lg font-semibold leading-none tracking-tight\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\r\n\r\nconst DrawerDescription = React.forwardRef<\r\n  React.ElementRef<typeof DrawerPrimitive.Description>,\r\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\r\n>(({ className, ...props }, ref) => (\r\n  <DrawerPrimitive.Description\r\n    ref={ref}\r\n    className={cn(\"text-sm text-muted-foreground\", className)}\r\n    {...props}\r\n  />\r\n))\r\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\r\n\r\nexport {\r\n  Drawer,\r\n  DrawerPortal,\r\n  DrawerOverlay,\r\n  DrawerTrigger,\r\n  DrawerClose,\r\n  DrawerContent,\r\n  DrawerHeader,\r\n  DrawerFooter,\r\n  DrawerTitle,\r\n  DrawerDescription,\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AAEA;;;;;AAEA,MAAM,SAAS,CAAC,EACd,wBAAwB,IAAI,EAC5B,GAAG,OAC+C,iBAClD,6LAAC,mJAAe,CAAC,IAAI;QACnB,uBAAuB;QACtB,GAAG,KAAK;;;;;;KANP;AASN,OAAO,WAAW,GAAG;AAErB,MAAM,gBAAgB,mJAAe,CAAC,OAAO;AAE7C,MAAM,eAAe,mJAAe,CAAC,MAAM;AAE3C,MAAM,cAAc,mJAAe,CAAC,KAAK;AAEzC,MAAM,8BAAgB,2KAAgB,CAGpC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,mJAAe,CAAC,OAAO;QACtB,KAAK;QACL,WAAW,IAAA,4HAAE,EAAC,kCAAkC;QAC/C,GAAG,KAAK;;;;;;MAPP;AAUN,cAAc,WAAW,GAAG,mJAAe,CAAC,OAAO,CAAC,WAAW;AAE/D,MAAM,8BAAgB,2KAAgB,OAGpC,CAAC,EAAE,SAAS,EAAE,QAAQ,EAAE,GAAG,OAAO,EAAE,oBACpC,6LAAC;;0BACC,6LAAC;;;;;0BACD,6LAAC,mJAAe,CAAC,OAAO;gBACtB,KAAK;gBACL,WAAW,IAAA,4HAAE,EACX,kGACA;gBAED,GAAG,KAAK;;kCAET,6LAAC;wBAAI,WAAU;;;;;;oBACd;;;;;;;;;;;;;;AAIP,cAAc,WAAW,GAAG;AAE5B,MAAM,eAAe,CAAC,EACpB,SAAS,EACT,GAAG,OACkC,iBACrC,6LAAC;QACC,WAAW,IAAA,4HAAE,EAAC,6CAA6C;QAC1D,GAAG,KAAK;;;;;;MANP;AASN,aAAa,WAAW,GAAG;AAE3B,MAAM,eAAe,CAAC,EACpB,SAAS,EACT,GAAG,OACkC,iBACrC,6LAAC;QACC,WAAW,IAAA,4HAAE,EAAC,mCAAmC;QAChD,GAAG,KAAK;;;;;;MANP;AASN,aAAa,WAAW,GAAG;AAE3B,MAAM,4BAAc,2KAAgB,OAGlC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,mJAAe,CAAC,KAAK;QACpB,KAAK;QACL,WAAW,IAAA,4HAAE,EACX,qDACA;QAED,GAAG,KAAK;;;;;;;AAGb,YAAY,WAAW,GAAG,mJAAe,CAAC,KAAK,CAAC,WAAW;AAE3D,MAAM,kCAAoB,2KAAgB,OAGxC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,mJAAe,CAAC,WAAW;QAC1B,KAAK;QACL,WAAW,IAAA,4HAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;;AAGb,kBAAkB,WAAW,GAAG,mJAAe,CAAC,WAAW,CAAC,WAAW"}},
    {"offset": {"line": 7068, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/ThermalReceipt.tsx"],"sourcesContent":["\r\nimport React, { useRef, useEffect, useState } from 'react';\r\nimport { Sale, BusinessSettings } from '@/types';\r\nimport { format } from 'date-fns';\r\nimport { formatNumber } from '@/lib/utils';\r\nimport { parsePaymentInfo, useBusinessSettings } from '@/hooks/useBusinessSettings';\r\nimport { numberToWords } from '@/utils/numberToWords';\r\nimport { useInstallmentPayments } from '@/hooks/useInstallmentPayments';\r\n\r\ninterface ThermalReceiptProps {\r\n  sale: Sale;\r\n  currency?: string;\r\n  includePaymentInfo?: boolean;\r\n}\r\n\r\nconst ThermalReceipt: React.FC<ThermalReceiptProps> = ({\r\n  sale,\r\n  currency,\r\n  includePaymentInfo = true\r\n}) => {\r\n  const { settings, isLoading: settingsLoading } = useBusinessSettings();\r\n  const { payments } = useInstallmentPayments(sale.id);\r\n\r\n  if (settingsLoading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center p-12 bg-gray-50 rounded-lg\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto mb-4\"></div>\r\n          <p className=\"text-sm text-gray-500 font-mono\">Preparing receipt...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const getDocumentTitle = () => {\r\n    switch (sale.paymentStatus) {\r\n      case 'Quote': return 'QUOTATION';\r\n      case 'Paid': return 'SALES RECEIPT';\r\n      case 'Installment Sale': return 'INSTALLMENT SALE';\r\n      case 'NOT PAID':\r\n      default: return 'INVOICE';\r\n    }\r\n  };\r\n\r\n  const getDocumentNumberLabel = () => {\r\n    switch (sale.paymentStatus) {\r\n      case 'Quote': return 'Quote #:';\r\n      case 'Paid': return 'Receipt #:';\r\n      case 'Installment Sale': return 'Installment #:';\r\n      default: return 'Invoice #:';\r\n    }\r\n  };\r\n\r\n  const subtotalBeforeDiscount = sale.items.reduce((total, item) => total + (item.price * item.quantity), 0);\r\n  const totalDiscountAmount = sale.items.reduce((total, item) => {\r\n    const itemSubtotal = item.price * item.quantity;\r\n    const discountAmount = item.discountType === 'amount'\r\n      ? (item.discountAmount || 0)\r\n      : (itemSubtotal * (item.discountPercentage || 0)) / 100;\r\n    return total + discountAmount;\r\n  }, 0);\r\n\r\n  const subtotalAfterDiscount = subtotalBeforeDiscount - totalDiscountAmount;\r\n  const taxRate = sale.taxRate || 0;\r\n  const taxAmount = subtotalAfterDiscount * (taxRate / 100);\r\n  const totalAmount = subtotalAfterDiscount + taxAmount;\r\n  const totalPaidFromHistory = (payments || []).reduce((sum, p) => sum + (p.amount || 0), 0);\r\n\r\n  const displayAmountPaid = sale.paymentStatus === 'Installment Sale' || (sale.paymentStatus === 'Paid' && totalPaidFromHistory > 0)\r\n    ? totalPaidFromHistory\r\n    : (sale.amountPaid || totalAmount);\r\n\r\n  const displayAmountDue = sale.paymentStatus === 'Installment Sale'\r\n    ? Math.max(0, totalAmount - totalPaidFromHistory)\r\n    : (sale.amountDue || 0);\r\n\r\n  const paymentMethods = settings.paymentInfo ? parsePaymentInfo(settings.paymentInfo) : [];\r\n  const hasPaymentInfo = includePaymentInfo &&\r\n    paymentMethods.length > 0 &&\r\n    paymentMethods.some(pm => pm.method.trim() !== '' || pm.accountNumber.trim() !== '' || pm.accountName.trim() !== '');\r\n\r\n  const displayCurrency = currency || settings.currency;\r\n  const receiptDate = new Date(sale.date);\r\n  const currentDateTime = new Date();\r\n\r\n  return (\r\n    <div className=\"flex justify-center bg-gray-100 p-4 sm:p-8 overflow-hidden\">\r\n      {/* Simulation of Thermal Paper */}\r\n      <div\r\n        className=\"relative bg-white shadow-2xl font-mono text-[11px] leading-tight text-black flex flex-col mx-auto\"\r\n        style={{\r\n          width: '58mm',\r\n          minHeight: '140mm',\r\n          padding: '6mm 4mm',\r\n          boxShadow: '0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1)',\r\n          borderTop: '1px dashed #e5e7eb',\r\n          borderBottom: '1px dashed #e5e7eb',\r\n        }}\r\n      >\r\n        {/* Serrated Edge Pattern (Top) */}\r\n        <div className=\"absolute top-0 left-0 w-full h-1 overflow-hidden flex\" style={{ opacity: 0.2 }}>\r\n          {Array.from({ length: 20 }).map((_, i) => (\r\n            <div key={i} className=\"w-4 h-4 bg-gray-300 transform rotate-45 -translate-y-2 translate-x-1\" />\r\n          ))}\r\n        </div>\r\n\r\n        {/* Header Section */}\r\n        <div className=\"flex flex-col items-center mb-4 text-center\">\r\n          {settings.businessLogo && (\r\n            <div className=\"mb-2 w-full flex justify-center\">\r\n              <img\r\n                src={settings.businessLogo}\r\n                alt=\"Logo\"\r\n                className=\"h-12 w-auto object-contain max-w-[40mm]\"\r\n              />\r\n            </div>\r\n          )}\r\n          <div className=\"text-[14px] font-black uppercase tracking-tight mb-0.5\">{settings.businessName}</div>\r\n          <div className=\"text-[9px] font-bold opacity-80\">{settings.businessAddress}</div>\r\n          <div className=\"text-[9px] font-bold opacity-80\">TEL: {settings.businessPhone}</div>\r\n          {settings.businessEmail && (\r\n            <div className=\"text-[9px] font-bold opacity-80 lowercase\">{settings.businessEmail}</div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Separator */}\r\n        <div className=\"border-b border-black border-dashed w-full my-2\"></div>\r\n\r\n        {/* Document Title & Basic Info */}\r\n        <div className=\"text-center mb-3\">\r\n          <div className=\"text-[12px] font-black underline mb-1\">{getDocumentTitle()}</div>\r\n          <div className=\"flex justify-between text-[9px] font-bold\">\r\n            <span>{getDocumentNumberLabel()}</span>\r\n            <span>{sale.receiptNumber}</span>\r\n          </div>\r\n          <div className=\"flex justify-between text-[9px]\">\r\n            <span>DATE:</span>\r\n            <span>{format(receiptDate, 'dd/MM/yyyy')}</span>\r\n          </div>\r\n          <div className=\"flex justify-between text-[9px]\">\r\n            <span>TIME:</span>\r\n            <span>{format(currentDateTime, 'HH:mm')}</span>\r\n          </div>\r\n          <div className=\"flex justify-between text-[9px] font-black\">\r\n            <span>STATUS:</span>\r\n            <span>{sale.paymentStatus.toUpperCase()}</span>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Customer Section */}\r\n        {sale.customerName && (\r\n          <div className=\"mb-3 bg-gray-50 p-1.5 border border-gray-100 italic\">\r\n            <div className=\"font-black text-[9px] not-italic uppercase mb-0.5\">Customer:</div>\r\n            <div className=\"font-bold\">{sale.customerName}</div>\r\n            {sale.customerAddress && <div className=\"text-[9px] opacity-70\">{sale.customerAddress}</div>}\r\n            {sale.customerContact && <div className=\"text-[9px] opacity-70\">{sale.customerContact}</div>}\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"border-b border-black border-dashed w-full my-2\"></div>\r\n\r\n        {/* Items Table */}\r\n        <div className=\"mb-4\">\r\n          <div className=\"flex justify-between font-black text-[9px] pb-1 border-b border-black mb-1.5 uppercase\">\r\n            <span className=\"w-[60%]\">Description</span>\r\n            <span className=\"w-[15%] text-right\">Qty</span>\r\n            <span className=\"w-[25%] text-right\">Amt</span>\r\n          </div>\r\n\r\n          {sale.items.map((item, index) => {\r\n            const itemSubtotal = item.quantity * item.price;\r\n            const discountAmount = item.discountType === 'amount'\r\n              ? (item.discountAmount || 0)\r\n              : (itemSubtotal * (item.discountPercentage || 0)) / 100;\r\n            const finalAmount = itemSubtotal - discountAmount;\r\n\r\n            return (\r\n              <div key={index} className=\"mb-2 last:mb-0\">\r\n                <div className=\"font-bold text-[10px] break-words uppercase\">{item.description}</div>\r\n                <div className=\"flex justify-between text-[9px] items-center\">\r\n                  <span className=\"text-gray-600 font-bold truncate\">\r\n                    {formatNumber(item.price)}\r\n                  </span>\r\n                  <div className=\"flex-1 border-b border-dotted border-gray-300 mx-2\"></div>\r\n                  <span className=\"font-bold\">\r\n                    {formatNumber(item.quantity).padStart(2, '0')}x {formatNumber(finalAmount)}\r\n                  </span>\r\n                </div>\r\n                {discountAmount > 0 && (\r\n                  <div className=\"flex justify-between text-[8px] italic text-gray-500 font-bold\">\r\n                    <span>- DISCOUNT {item.discountType === 'percentage' ? `(${item.discountPercentage}%)` : ''}</span>\r\n                    <span>-{formatNumber(discountAmount)}</span>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n\r\n        <div className=\"border-b border-black border-dashed w-full my-2\"></div>\r\n\r\n        {/* Totals Section */}\r\n        <div className=\"mb-4 space-y-0.5\">\r\n          <div className=\"flex justify-between font-bold\">\r\n            <span>SUBTOTAL:</span>\r\n            <span>{displayCurrency} {formatNumber(subtotalBeforeDiscount)}</span>\r\n          </div>\r\n          {totalDiscountAmount > 0 && (\r\n            <div className=\"flex justify-between font-bold italic opacity-70\">\r\n              <span>DISCOUNT:</span>\r\n              <span>-{displayCurrency} {formatNumber(totalDiscountAmount)}</span>\r\n            </div>\r\n          )}\r\n          {taxRate > 0 && (\r\n            <div className=\"flex justify-between font-bold\">\r\n              <span>TAX ({taxRate}%):</span>\r\n              <span>{displayCurrency} {formatNumber(taxAmount)}</span>\r\n            </div>\r\n          )}\r\n          <div className=\"flex justify-between font-black text-[13px] border-t border-black pt-1.5 mt-1\">\r\n            <span>TOTAL:</span>\r\n            <span>{displayCurrency} {formatNumber(totalAmount)}</span>\r\n          </div>\r\n\r\n          {sale.paymentStatus === 'Installment Sale' && (\r\n            <div className=\"mt-2 pt-1 border-t border-gray-200 border-dotted\">\r\n              <div className=\"flex justify-between font-bold\">\r\n                <span>PAID:</span>\r\n                <span>{displayCurrency} {formatNumber(displayAmountPaid)}</span>\r\n              </div>\r\n              <div className=\"flex justify-between font-black text-red-600\">\r\n                <span>DUE:</span>\r\n                <span>{displayCurrency} {formatNumber(displayAmountDue)}</span>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Amount in Words */}\r\n        <div className=\"mb-4 text-[9px] italic opacity-80 border-t border-b border-gray-100 py-1\">\r\n          <span className=\"font-black not-italic uppercase\">Words:</span> {displayCurrency} {numberToWords(totalAmount)} only.\r\n        </div>\r\n\r\n        {/* Payment Info */}\r\n        {hasPaymentInfo && (\r\n          <div className=\"mb-4 text-[9px]\">\r\n            <div className=\"font-black underline mb-1 uppercase\">Payment Channels:</div>\r\n            {paymentMethods\r\n              .filter(p => p.method.trim() !== '' || p.accountNumber.trim() !== '' || p.accountName.trim() !== '')\r\n              .map((p, i) => (\r\n                <div key={i} className=\"mb-1 last:mb-0 font-bold\">\r\n                  <div className=\"flex justify-between\">\r\n                    <span className=\"uppercase\">{p.method}:</span>\r\n                    <span>{p.accountNumber}</span>\r\n                  </div>\r\n                  <div className=\"text-[8px] opacity-70 italic text-right\">{p.accountName}</div>\r\n                </div>\r\n              ))\r\n            }\r\n          </div>\r\n        )}\r\n\r\n        {/* Notes */}\r\n        {sale.notes && (\r\n          <div className=\"mb-4 text-[9px] border border-gray-100 p-1 bg-gray-50\">\r\n            <div className=\"font-black uppercase mb-0.5\">Notes:</div>\r\n            <div className=\"font-bold opacity-70 whitespace-pre-wrap italic\">{sale.notes}</div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Signature Section */}\r\n        <div className=\"mt-auto pt-6 flex flex-col items-center\">\r\n          {settings.signature ? (\r\n            <div className=\"flex flex-col items-center\">\r\n              <img\r\n                src={settings.signature}\r\n                alt=\"Signature\"\r\n                className=\"h-10 w-auto object-contain mb-1 mix-blend-multiply opacity-90\"\r\n              />\r\n              <div className=\"w-[80%] border-t border-black border-dashed\"></div>\r\n              <div className=\"text-[8px] font-black uppercase mt-1\">Authorized Signature</div>\r\n            </div>\r\n          ) : (\r\n            <div className=\"w-full flex flex-col items-center\">\r\n              <div className=\"w-[80%] border-t border-black border-dashed pt-1\"></div>\r\n              <div className=\"text-[8px] font-black uppercase mt-1\">Authorized Signature</div>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Footer */}\r\n        <div className=\"text-center mt-6\">\r\n          <div className=\"text-[10px] font-black mb-1 italic\">THANK YOU!</div>\r\n          <div className=\"text-[8px] font-bold opacity-60\">\r\n            GONZA SYSTEMS SUPPORT\r\n            <br />\r\n            PRINTED AT {format(new Date(), 'HH:mm dd/MM/yy')}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Serrated Edge Pattern (Bottom) */}\r\n        <div className=\"absolute bottom-0 left-0 w-full h-1 overflow-hidden flex\" style={{ opacity: 0.2 }}>\r\n          {Array.from({ length: 20 }).map((_, i) => (\r\n            <div key={i} className=\"w-4 h-4 bg-gray-300 transform rotate-45 translate-y-2 translate-x-1\" />\r\n          ))}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ThermalReceipt;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 7995, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/PrintableReceipt.tsx"],"sourcesContent":["import React, { useRef, useEffect, useState } from 'react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Share2 } from \"lucide-react\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Sale, BusinessSettings } from '@/types';\r\nimport { generatePDF } from '@/utils/generatePDF';\r\nimport { directPrint } from '@/utils/directPrint';\r\nimport { format } from 'date-fns';\r\nimport { Printer, Download, Loader2, Smartphone } from 'lucide-react';\r\nimport { formatNumber } from '@/lib/utils';\r\nimport { Separator } from '@/components/ui/separator';\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\r\nimport { parsePaymentInfo, useBusinessSettings } from '@/hooks/useBusinessSettings';\r\nimport { numberToWords } from '@/utils/numberToWords';\r\nimport { useIsMobile } from '@/hooks/use-mobile';\r\nimport { isIOS, isAndroid } from '@/utils/deviceDetection';\r\nimport ThermalReceipt from './ThermalReceipt';\r\nimport { toast } from 'sonner';\r\nimport { useInstallmentPayments } from '@/hooks/useInstallmentPayments';\r\nimport { print, checkBridgeStatus } from \"@/utils/thermalPrinterPlug\";\r\nimport { generateThermalText } from \"@/utils/generateThermalText\";\r\nimport { generateThermalReceipt } from \"@/utils/generateThermalReceipt\";\r\n\r\ninterface PrintableReceiptProps {\r\n  sale: Sale;\r\n  currency?: string;\r\n  isMobile?: boolean;\r\n  includePaymentInfo?: boolean;\r\n}\r\n\r\ntype ReceiptType = 'standard' | 'thermal';\r\n\r\nconst PrintableReceipt: React.FC<PrintableReceiptProps> = ({\r\n  sale,\r\n  currency,\r\n  isMobile,\r\n  includePaymentInfo = true\r\n}) => {\r\n  const receiptRef = useRef<HTMLDivElement>(null);\r\n  const thermalReceiptRef = useRef<HTMLDivElement>(null);\r\n  const { settings, isLoading: settingsLoading } = useBusinessSettings();\r\n  const { payments } = useInstallmentPayments(sale.id);\r\n  const [receiptType, setReceiptType] = useState<ReceiptType>('standard');\r\n  const [isPrinting, setIsPrinting] = useState(false);\r\n  const [isDownloading, setIsDownloading] = useState(false);\r\n  const [isSharing, setIsSharing] = useState(false);\r\n  const [isBridgeOnline, setIsBridgeOnline] = useState(false);\r\n  const isMobileDevice = useIsMobile();\r\n\r\n  // Update receipt type when settings are loaded\r\n  useEffect(() => {\r\n    if (settings.defaultPrintFormat) {\r\n      setReceiptType(settings.defaultPrintFormat);\r\n    }\r\n\r\n    // Check bridge status on mount\r\n    const checkBridge = async () => {\r\n      const isOnline = await checkBridgeStatus();\r\n      setIsBridgeOnline(isOnline);\r\n    };\r\n    checkBridge();\r\n  }, [settings.defaultPrintFormat]);\r\n\r\n  // Determine document title based on payment status\r\n  const getDocumentTitle = () => {\r\n    switch (sale.paymentStatus) {\r\n      case 'Quote':\r\n        return 'QUOTATION';\r\n      case 'Paid':\r\n        return 'SALES RECEIPT';\r\n      case 'Installment Sale':\r\n        return 'INVOICE';\r\n      case 'NOT PAID':\r\n      default:\r\n        return 'INVOICE';\r\n    }\r\n  };\r\n\r\n  const getDocumentNumberLabel = () => {\r\n    switch (sale.paymentStatus) {\r\n      case 'Quote':\r\n        return 'Quote #:';\r\n      case 'Paid':\r\n        return 'Receipt #:';\r\n      case 'Installment Sale':\r\n        return 'Installment #:';\r\n      case 'NOT PAID':\r\n      default:\r\n        return 'Invoice #:';\r\n    }\r\n  };\r\n\r\n  const documentTitle = getDocumentTitle();\r\n  const documentNumberLabel = getDocumentNumberLabel();\r\n\r\n  // Calculate subtotal with discounts\r\n  const subtotal = sale.items.reduce((total, item) => {\r\n    const itemSubtotal = item.price * item.quantity;\r\n    const discountAmount = item.discountType === 'amount'\r\n      ? (item.discountAmount || 0)\r\n      : (itemSubtotal * (item.discountPercentage || 0)) / 100;\r\n    return total + (itemSubtotal - discountAmount);\r\n  }, 0);\r\n\r\n  // Calculate tax amount based on taxRate (default to 0 if not present)\r\n  const taxRate = sale.taxRate || 0;\r\n  const taxAmount = subtotal * (taxRate / 100);\r\n\r\n  // Total amount including tax\r\n  const totalAmount = subtotal + taxAmount;\r\n\r\n  // For installment sales, use payment history total; for others use the provided amounts\r\n  const totalPaidFromHistory = payments.reduce((sum, payment) => sum + payment.amount, 0);\r\n  const displayAmountPaid = sale.paymentStatus === 'Installment Sale' || (sale.paymentStatus === 'Paid' && totalPaidFromHistory > 0)\r\n    ? totalPaidFromHistory\r\n    : (sale.amountPaid || totalAmount);\r\n  const displayAmountDue = sale.paymentStatus === 'Installment Sale'\r\n    ? Math.max(0, totalAmount - totalPaidFromHistory)\r\n    : (sale.amountDue || 0);\r\n\r\n  // Get the total amount in words\r\n  const totalAmountInWords = numberToWords(totalAmount);\r\n\r\n  // Check if we should show the tax row\r\n  const showTaxRow = taxRate > 0;\r\n\r\n  // Check if this is an installment sale\r\n  const isInstallmentSale = sale.paymentStatus === 'Installment Sale';\r\n\r\n  // Parse payment info into structured format\r\n  const paymentMethods = settings.paymentInfo ? parsePaymentInfo(settings.paymentInfo) : [];\r\n  // Only show payment methods table if there are valid payment methods AND includePaymentInfo is true\r\n  const hasPaymentInfo = includePaymentInfo &&\r\n    paymentMethods.length > 0 &&\r\n    paymentMethods.some(pm => pm.method.trim() !== '' || pm.accountNumber.trim() !== '' || pm.accountName.trim() !== '');\r\n\r\n  // Use the currency prop if provided, otherwise use the one from settings\r\n  const displayCurrency = currency || settings.currency;\r\n\r\n  // Check if device is iOS or Android\r\n  const isIOSDevice = isIOS();\r\n  const isAndroidDevice = isAndroid();\r\n\r\n  // Get the receipt date and current time for display\r\n  const receiptDate = new Date(sale.date);\r\n  const currentDateTime = new Date();\r\n\r\n  // Helper function to create structured receipt data\r\n  const createReceiptData = () => {\r\n    const receiptDate = new Date(sale.date);\r\n    const currentDateTime = new Date();\r\n    const paymentMethods = settings.paymentInfo ? parsePaymentInfo(settings.paymentInfo) : [];\r\n    const hasPaymentInfo = includePaymentInfo &&\r\n      paymentMethods.length > 0 &&\r\n      paymentMethods.some(pm => pm.method.trim() !== '' || pm.accountNumber.trim() !== '' || pm.accountName.trim() !== '');\r\n\r\n    return {\r\n      documentTitle: getDocumentTitle(),\r\n      documentNumberLabel: getDocumentNumberLabel(),\r\n      receiptNumber: sale.receiptNumber,\r\n      date: format(receiptDate, 'MMM dd, yyyy'),\r\n      time: format(currentDateTime, 'hh:mm a'),\r\n      status: sale.paymentStatus,\r\n      businessName: settings.businessName,\r\n      businessAddress: settings.businessAddress,\r\n      businessPhone: settings.businessPhone,\r\n      businessEmail: settings.businessEmail,\r\n      businessLogo: settings.businessLogo,\r\n      signature: settings.signature,\r\n      customerName: sale.customerName,\r\n      customerAddress: sale.customerAddress,\r\n      customerContact: sale.customerContact,\r\n      items: sale.items.map(item => {\r\n        const itemSubtotal = item.quantity * item.price;\r\n        const discountAmount = item.discountType === 'amount'\r\n          ? (item.discountAmount || 0)\r\n          : (itemSubtotal * (item.discountPercentage || 0)) / 100;\r\n        return {\r\n          description: item.description,\r\n          quantity: item.quantity,\r\n          unitPrice: item.price,\r\n          discountPercentage: item.discountPercentage || 0,\r\n          discountAmount,\r\n          discountType: item.discountType || 'percentage',\r\n          amount: itemSubtotal - discountAmount\r\n        };\r\n      }),\r\n      subtotal,\r\n      taxRate,\r\n      taxAmount,\r\n      totalAmount,\r\n      amountPaid: displayAmountPaid,\r\n      amountDue: displayAmountDue,\r\n      isInstallmentSale,\r\n      totalAmountInWords,\r\n      paymentMethods: hasPaymentInfo ? paymentMethods.filter(pm =>\r\n        pm.method.trim() !== '' || pm.accountNumber.trim() !== '' || pm.accountName.trim() !== ''\r\n      ) : undefined,\r\n      currency: displayCurrency,\r\n      showTaxRow,\r\n      hasPaymentInfo,\r\n      notes: sale.notes\r\n    };\r\n  };\r\n\r\n  // Optimized download handler with vector PDF for standard receipts\r\n  const handleDownloadPDF = async () => {\r\n    if (!receiptRef.current) return;\r\n\r\n    setIsDownloading(true);\r\n\r\n    try {\r\n      toast.success('Preparing download...');\r\n\r\n      const filePrefix = sale.paymentStatus === 'Quote'\r\n        ? 'Quote'\r\n        : (sale.paymentStatus === 'Paid' ? 'Receipt' : 'Invoice');\r\n\r\n      const fileName = receiptType === 'thermal'\r\n        ? `${filePrefix}_Thermal-${sale.receiptNumber}.pdf`\r\n        : `${filePrefix}-${sale.receiptNumber}.pdf`;\r\n\r\n      if (receiptType === 'standard') {\r\n        // Use new vector PDF generation for standard receipts\r\n        const { generateReceiptVectorPDF } = await import('@/utils/generateReceiptVectorPDF');\r\n        const receiptData = createReceiptData();\r\n        await generateReceiptVectorPDF(receiptData, {\r\n          filename: fileName,\r\n          orientation: 'portrait',\r\n          format: 'a4',\r\n          margins: { top: 20, right: 20, bottom: 20, left: 20 }\r\n        });\r\n      } else {\r\n        // Use existing method for thermal receipts\r\n        await generatePDF(receiptRef.current, fileName, { isReceipt: true });\r\n      }\r\n\r\n      toast.success('Receipt downloaded successfully!');\r\n    } catch (error) {\r\n      console.error('Error downloading receipt:', error);\r\n      toast.error('Failed to download receipt. Please try again.');\r\n    } finally {\r\n      setIsDownloading(false);\r\n    }\r\n  };\r\n\r\n  // Share handle share\r\n  const handleShare = async () => {\r\n    setIsSharing(true);\r\n    try {\r\n      const { generateReceiptVectorPDF } = await import('@/utils/generateReceiptVectorPDF');\r\n      const receiptData = createReceiptData();\r\n      const pdfBlob = await generateReceiptVectorPDF(receiptData, { returnBlob: true });\r\n      if (!pdfBlob) return;\r\n\r\n      //  Use dynamic prefix same as download\r\n      const filePrefix =\r\n        sale.paymentStatus === 'Quote'\r\n          ? 'Quotation'\r\n          : sale.paymentStatus === 'Paid'\r\n            ? 'Receipt'\r\n            : 'Invoice';\r\n\r\n      const fileName = `${filePrefix}-${sale.receiptNumber}.pdf`;\r\n\r\n      const file = new File([pdfBlob], fileName, { type: 'application/pdf' });\r\n\r\n      if (navigator.canShare && navigator.canShare({ files: [file] })) {\r\n        await navigator.share({\r\n          files: [file],\r\n          title: `${filePrefix} - ${sale.receiptNumber}`,\r\n          text: `${filePrefix} #${sale.receiptNumber}`,\r\n        });\r\n        toast.success(`${filePrefix} shared successfully!`);\r\n      } else {\r\n        toast.error('Sharing not supported on this device.');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error sharing document:', error);\r\n      toast.error('Failed to share document.');\r\n    } finally {\r\n      setIsSharing(false);\r\n    }\r\n  };\r\n\r\n  // Optimized print handler with PDF generation for desktop\r\n  const handlePrint = async () => {\r\n    const printElement =\r\n      receiptType === 'thermal' ? thermalReceiptRef.current : receiptRef.current;\r\n    if (!printElement) return;\r\n\r\n    setIsPrinting(true);\r\n\r\n    try {\r\n      if (receiptType === 'thermal') {\r\n        const saleWithPayments = { ...sale, payments: payments || [] };\r\n        const receiptData = await generateThermalReceipt(saleWithPayments, settings, displayCurrency);\r\n\r\n        // Always use public API (prefers bridge now)\r\n        const result = await print(receiptData, settings.defaultPrinterName);\r\n        const { success, message } = result || { success: false, message: 'Unknown print error' };\r\n\r\n        success ? toast.success(message) : toast.error(message);\r\n        return;\r\n      }\r\n\r\n      toast.success('Preparing receipt for printing...');\r\n\r\n      if (isMobileDevice) {\r\n        const baseDocumentName =\r\n          sale.paymentStatus === 'Quote'\r\n            ? 'Quotation'\r\n            : sale.paymentStatus === 'Paid'\r\n              ? 'Receipt'\r\n              : 'Invoice';\r\n\r\n        directPrint(printElement, baseDocumentName);\r\n        toast.success('Print dialog opened!');\r\n      } else {\r\n        const { generateReceiptVectorPDF } = await import(\r\n          '@/utils/generateReceiptVectorPDF'\r\n        );\r\n        const receiptData = createReceiptData();\r\n        const pdfBlob = await generateReceiptVectorPDF(receiptData, {\r\n          returnBlob: true,\r\n        });\r\n\r\n        if (pdfBlob) {\r\n          const blobUrl = URL.createObjectURL(pdfBlob);\r\n          const printWindow = window.open(blobUrl, '_blank');\r\n\r\n          if (printWindow) {\r\n            printWindow.addEventListener('load', () => {\r\n              setTimeout(() => {\r\n                printWindow.focus();\r\n                printWindow.print();\r\n                printWindow.addEventListener('afterprint', () => printWindow.close());\r\n              }, 500);\r\n            });\r\n          }\r\n\r\n          setTimeout(() => URL.revokeObjectURL(blobUrl), 30000);\r\n        }\r\n\r\n        toast.success('Print dialog opened!');\r\n      }\r\n    } catch (error: any) {\r\n      console.error('Error printing receipt:', error);\r\n      toast.error(error?.message || 'Failed to print receipt. Please try again.');\r\n    } finally {\r\n      setIsPrinting(false);\r\n    }\r\n  };\r\n\r\n  const handleDirectThermalPrint = async () => {\r\n    setIsPrinting(true);\r\n    try {\r\n      const saleWithPayments = { ...sale, payments };\r\n      const receiptData = await generateThermalReceipt(saleWithPayments, settings, displayCurrency);\r\n      const result = await print(receiptData, settings.defaultPrinterName);\r\n      const { success, message } = result || { success: false, message: 'Unknown print error' };\r\n\r\n      if (success) {\r\n        toast.success(message || 'Sent to thermal printer');\r\n      } else {\r\n        toast.error(message || 'Thermal printing failed');\r\n      }\r\n    } catch (error: any) {\r\n      console.error('Error in direct thermal print:', error);\r\n      toast.error(error?.message || 'Failed to print thermal receipt');\r\n    } finally {\r\n      setIsPrinting(false);\r\n    }\r\n  };\r\n\r\n\r\n  // Show loading state while business settings are loading\r\n  if (settingsLoading) {\r\n    return (\r\n      <div className={`bg-white ${isMobile ? 'p-2' : 'p-6'} rounded-lg shadow-md`}>\r\n        <div className=\"mb-4 flex justify-between items-center flex-wrap\">\r\n          <h2 className={`${isMobile ? 'text-xl' : 'text-2xl'} font-bold text-sales-primary`}>{documentTitle}</h2>\r\n        </div>\r\n        <div className=\"flex items-center justify-center py-12\">\r\n          <div className=\"text-center\">\r\n            <Loader2 className=\"h-8 w-8 animate-spin mx-auto mb-4 text-muted-foreground\" />\r\n            <p className=\"text-muted-foreground\">Loading business settings...</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className={`bg-white ${isMobile ? 'p-2' : 'p-6'} rounded-lg shadow-md`}>\r\n      <div className=\"mb-4 flex justify-between items-center flex-wrap\">\r\n        <h2 className={`${isMobile ? 'text-xl' : 'text-2xl'} font-bold text-sales-primary`}>{documentTitle}</h2>\r\n\r\n        <div className=\"print:hidden flex space-x-2 mt-2 sm:mt-0\">\r\n          {/* Smart Print button - handles both Standard (System Print) and Thermal (Direct/Bridge) */}\r\n          {!isMobile && (\r\n            <Button\r\n              variant=\"default\"\r\n              size=\"default\"\r\n              onClick={handlePrint}\r\n              disabled={isPrinting || isDownloading || isSharing}\r\n              className=\"flex items-center\"\r\n              title=\"Print\"\r\n            >\r\n              {isPrinting ? (\r\n                <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n              ) : (\r\n                <Printer className=\"h-4 w-4\" />\r\n              )}\r\n            </Button>\r\n          )}\r\n\r\n          {/* Other actions moved to a dropdown or kept separate? User said 'just one print button'. \r\n              I'll keep Download and Share but grouped to keep 'Print' as the ONE print action. */}\r\n          <div className=\"flex gap-2\">\r\n            <Button\r\n              variant=\"outline\"\r\n              size={isMobile ? \"sm\" : \"default\"}\r\n              onClick={handleDownloadPDF}\r\n              disabled={isPrinting || isDownloading || isSharing}\r\n              className=\"flex items-center\"\r\n              title=\"Download PDF\"\r\n            >\r\n              {isDownloading ? (\r\n                <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n              ) : (\r\n                <Download className=\"h-4 w-4\" />\r\n              )}\r\n            </Button>\r\n            <Button\r\n              variant=\"outline\"\r\n              size={isMobile ? \"sm\" : \"default\"}\r\n              onClick={handleShare}\r\n              disabled={isPrinting || isDownloading || isSharing}\r\n              className=\"flex items-center\"\r\n              title=\"Share\"\r\n            >\r\n              {isSharing ? (\r\n                <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n              ) : (\r\n                <Share2 className=\"h-4 w-4\" />\r\n              )}\r\n            </Button>\r\n\r\n            {/* Mobile Bluetooth Print App Integration - Visible only on mobile for the app */}\r\n            {isMobile && (\r\n              <Button\r\n                variant=\"outline\"\r\n                size={isMobile ? \"sm\" : \"default\"}\r\n                onClick={async () => {\r\n                  const ua = navigator.userAgent || \"\";\r\n                  const isAndroidActual = /android/i.test(ua);\r\n                  const isIOSActual = !isAndroidActual && (/iPad|iPhone|iPod/.test(ua) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1));\r\n\r\n                  // Diagnostics\r\n                  console.warn('--- MOBILE PRINT START ---');\r\n                  console.warn('User Agent:', ua);\r\n                  console.warn('isAndroid (Direct Check):', isAndroidActual);\r\n                  console.warn('isIOS (Direct Check):', isIOSActual);\r\n\r\n                  const platformParam = isAndroidActual ? 'platform=android' : (isIOSActual ? 'platform=ios' : 'default');\r\n                  const anonKey = process.env.NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY;\r\n                  const functionUrl = `${process.env.NEXT_PUBLIC_SUPABASE_URL}/functions/v1/print-receipt?id=${sale.id}&${platformParam}&apikey=${anonKey}`;\r\n\r\n                  setIsPrinting(true);\r\n                  try {\r\n                    console.log('Fetching from:', functionUrl);\r\n                    const response = await fetch(functionUrl);\r\n\r\n                    if (!response.ok) {\r\n                      const errorBody = await response.text();\r\n                      console.error('Print Function Error:', response.status, errorBody);\r\n                      throw new Error(`Server ${response.status}: ${errorBody || 'Bad Request'}`);\r\n                    }\r\n\r\n                    const data = await response.json();\r\n                    console.log('Data fetched successfully');\r\n\r\n                    if (isAndroidActual) {\r\n                      console.log('Redirecting to Android App using RAW URL...');\r\n                      window.location.href = `my.bluetoothprint.scheme://${functionUrl}`;\r\n                    } else if (isIOSActual) {\r\n                      console.log('Redirecting to iOS App (Direct Push)...');\r\n                      const encodedJSON = encodeURIComponent(JSON.stringify(data));\r\n                      window.location.href = `thermer://print?data=${encodedJSON}`;\r\n                    } else {\r\n                      toast.error('Mobile printing is optimized for iOS and Android');\r\n                    }\r\n                  } catch (error: any) {\r\n                    console.error('Unified Print Error:', error);\r\n                    toast.error(error.message || 'Failed to prepare receipt');\r\n                  } finally {\r\n                    setIsPrinting(false);\r\n                    console.warn('--- MOBILE PRINT END ---');\r\n                  }\r\n                }}\r\n                className=\"flex items-center text-blue-600 border-blue-200 hover:bg-blue-50\"\r\n                title=\"Print\"\r\n              >\r\n                {isPrinting ? (\r\n                  <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                ) : (\r\n                  <Printer className=\"h-4 w-4\" />\r\n                )}\r\n              </Button>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n      </div>\r\n\r\n      <div className=\"mb-4 print:hidden\">\r\n        <div className=\"flex items-center space-x-3\">\r\n          <label htmlFor=\"receipt-type\" className=\"text-sm font-medium\">\r\n            Receipt Format:\r\n          </label>\r\n          <Select value={receiptType} onValueChange={(value: ReceiptType) => setReceiptType(value)}>\r\n            <SelectTrigger className=\"w-48\">\r\n              <SelectValue placeholder=\"Select receipt type\" />\r\n            </SelectTrigger>\r\n            <SelectContent>\r\n              <SelectItem value=\"standard\">Standard Receipt</SelectItem>\r\n              <SelectItem value=\"thermal\">Thermal Receipt</SelectItem>\r\n            </SelectContent>\r\n          </Select>\r\n        </div>\r\n      </div>\r\n\r\n      <div ref={receiptRef}>\r\n        {receiptType === 'thermal' ? (\r\n          <div ref={thermalReceiptRef}>\r\n            <ThermalReceipt\r\n              sale={sale}\r\n              currency={displayCurrency}\r\n              includePaymentInfo={includePaymentInfo}\r\n            />\r\n          </div>\r\n        ) : (\r\n          <div className={`border-[1.5px] border-black ${isMobile ? 'p-3' : 'p-6'} rounded-md`}>\r\n            <div className=\"flex flex-col items-center mb-4 gap-2 text-center w-full\">\r\n              <div className=\"w-full\">\r\n                <div className=\"text-lg sm:text-2xl font-bold text-gray-900 mb-1\">{settings.businessName?.toUpperCase()}</div>\r\n                <div className={`${isMobile ? 'text-xs' : 'text-sm'} text-gray-600 font-medium`}>{settings.businessAddress}</div>\r\n                <div className=\"text-xs sm:text-sm text-gray-600\">Phone: {settings.businessPhone} | Email: {settings.businessEmail}</div>\r\n              </div>\r\n            </div>\r\n\r\n            <Separator className=\"my-3 sm:my-4 border-black border-t-[1.5px]\" />\r\n\r\n            <div className=\"text-center mb-4\">\r\n              <h1 className={`font-bold ${isMobile ? 'text-xl' : 'text-2xl'} uppercase tracking-wider text-gray-900`}>\r\n                {sale.paymentStatus === 'Quote' ? 'QUOTATION' : (sale.paymentStatus === 'Paid' ? 'SALES RECEIPT' : 'INVOICE')}\r\n              </h1>\r\n            </div>\r\n\r\n            <div className=\"flex justify-between mb-4 sm:mb-6 text-sm flex-wrap gap-2\">\r\n              <div>\r\n                <div className=\"font-semibold\">{documentNumberLabel} {sale.receiptNumber}</div>\r\n                <div>Date: {format(receiptDate, 'MMM dd, yyyy')}</div>\r\n              </div>\r\n              <div className=\"text-right\">\r\n                <div className=\"font-semibold\">{sale.paymentStatus}</div>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"mb-4 sm:mb-6\">\r\n              <h3 className=\"font-semibold mb-2 text-sm\">Customer Information:</h3>\r\n              <div className=\"text-sm\">\r\n                <div>{sale.customerName}</div>\r\n                <div>{sale.customerAddress}</div>\r\n                <div>{sale.customerContact}</div>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"overflow-x-auto\">\r\n              {/* Desktop Table View */}\r\n              <div className=\"hidden sm:block\">\r\n                <table className=\"w-full mb-4 sm:mb-6 text-sm\">\r\n                  <thead>\r\n                    <tr className=\"border-b border-black border-b-[1.5px]\">\r\n                      <th className=\"py-2 text-left bg-gray-200 px-2\">Description</th>\r\n                      <th className=\"py-2 text-right bg-gray-200 px-2\">Qty</th>\r\n                      <th className=\"py-2 text-right bg-gray-200 px-2\">Unit Price</th>\r\n                      <th className=\"py-2 text-right bg-gray-200 px-2\">Discount</th>\r\n                      <th className=\"py-2 text-right bg-gray-200 px-2\">Amount</th>\r\n                    </tr>\r\n                  </thead>\r\n                  <tbody>\r\n                    {sale.items.map((item, index) => {\r\n                      const itemSubtotal = item.quantity * item.price;\r\n                      const discountAmount = item.discountType === 'amount'\r\n                        ? (item.discountAmount || 0)\r\n                        : (itemSubtotal * (item.discountPercentage || 0)) / 100;\r\n                      const finalAmount = itemSubtotal - discountAmount;\r\n\r\n                      return (\r\n                        <tr key={index} className=\"border-b border-black\">\r\n                          <td className=\"py-2 sm:py-3 break-all whitespace-normal\">{item.description}</td>\r\n                          <td className=\"py-2 sm:py-3 text-right\">{formatNumber(item.quantity)}</td>\r\n                          <td className=\"py-2 sm:py-3 text-right\">{displayCurrency} {formatNumber(item.price)}</td>\r\n                          <td className=\"py-2 sm:py-3 text-right\">\r\n                            {item.discountType === 'amount'\r\n                              ? (item.discountAmount && item.discountAmount > 0 ? `${displayCurrency} ${formatNumber(item.discountAmount)}` : '-')\r\n                              : ((item.discountPercentage || 0) > 0 ? `${item.discountPercentage}%` : '-')\r\n                            }\r\n                          </td>\r\n                          <td className=\"py-2 sm:py-3 text-right\">{displayCurrency} {formatNumber(finalAmount)}</td>\r\n                        </tr>\r\n                      );\r\n                    })}\r\n                  </tbody>\r\n                  <tfoot>\r\n                    {(() => {\r\n                      const totalDiscount = sale.items.reduce((total, item) => {\r\n                        const itemSubtotal = item.quantity * item.price;\r\n                        const discountAmount = item.discountType === 'amount'\r\n                          ? (item.discountAmount || 0)\r\n                          : (itemSubtotal * (item.discountPercentage || 0)) / 100;\r\n                        return total + discountAmount;\r\n                      }, 0);\r\n\r\n                      return (\r\n                        <>\r\n                          <tr className=\"border-t border-black border-t-[1.5px]\">\r\n                            <td colSpan={4} className=\"py-2 text-right font-medium bg-gray-200 px-2\">Subtotal (before discount):</td>\r\n                            <td className=\"py-2 text-right bg-gray-200 px-2\">{displayCurrency} {formatNumber(subtotal + totalDiscount)}</td>\r\n                          </tr>\r\n                          {totalDiscount > 0 && (\r\n                            <tr>\r\n                              <td colSpan={4} className=\"py-2 text-right font-medium bg-orange-100 px-2\">Total Discount:</td>\r\n                              <td className=\"py-2 text-right bg-orange-100 px-2\">-{displayCurrency} {formatNumber(totalDiscount)}</td>\r\n                            </tr>\r\n                          )}\r\n                          <tr>\r\n                            <td colSpan={4} className=\"py-2 text-right font-medium bg-gray-200 px-2\">Subtotal:</td>\r\n                            <td className=\"py-2 text-right bg-gray-200 px-2\">{displayCurrency} {formatNumber(subtotal)}</td>\r\n                          </tr>\r\n                        </>\r\n                      );\r\n                    })()}\r\n                    {showTaxRow && (\r\n                      <tr>\r\n                        <td colSpan={4} className=\"py-2 text-right font-medium bg-gray-200 px-2\">Tax ({taxRate}%):</td>\r\n                        <td className=\"py-2 text-right bg-gray-200 px-2\">{displayCurrency} {formatNumber(taxAmount)}</td>\r\n                      </tr>\r\n                    )}\r\n                    <tr className=\"border-t border-black border-t-[1.5px] font-bold\">\r\n                      <td colSpan={4} className=\"py-2 sm:py-3 text-right bg-gray-300 px-2\">Total:</td>\r\n                      <td className=\"py-2 sm:py-3 text-right bg-gray-300 px-2\">{displayCurrency} {formatNumber(totalAmount)}</td>\r\n                    </tr>\r\n                    {isInstallmentSale && (\r\n                      <>\r\n                        <tr>\r\n                          <td colSpan={4} className=\"py-2 text-right font-medium bg-blue-100 px-2\">Amount Paid:</td>\r\n                          <td className=\"py-2 text-right bg-blue-100 px-2\">{displayCurrency} {formatNumber(displayAmountPaid)}</td>\r\n                        </tr>\r\n                        <tr>\r\n                          <td colSpan={4} className=\"py-2 text-right font-medium bg-red-100 px-2\">Amount Due:</td>\r\n                          <td className=\"py-2 text-right bg-red-100 px-2\">{displayCurrency} {formatNumber(displayAmountDue)}</td>\r\n                        </tr>\r\n                      </>\r\n                    )}\r\n                    <tr>\r\n                      <td colSpan={5} className=\"py-2 sm:py-3 text-left border-t border-black px-2 italic\">\r\n                        <span className=\"font-medium\">Amount in words:</span> {displayCurrency} {totalAmountInWords} only\r\n                      </td>\r\n                    </tr>\r\n                  </tfoot>\r\n                </table>\r\n              </div>\r\n\r\n              {/* Mobile Stacked View */}\r\n              <div className=\"block sm:hidden\">\r\n                <div className=\"border-b-2 border-black mb-2 pb-1 font-bold\">Items</div>\r\n                {sale.items.map((item, index) => {\r\n                  const itemSubtotal = item.quantity * item.price;\r\n                  const discountAmount = item.discountType === 'amount'\r\n                    ? (item.discountAmount || 0)\r\n                    : (itemSubtotal * (item.discountPercentage || 0)) / 100;\r\n                  const finalAmount = itemSubtotal - discountAmount;\r\n\r\n                  return (\r\n                    <div key={index} className=\"mb-3 border-b border-gray-200 pb-2 last:border-0\">\r\n                      <div className=\"font-bold text-sm mb-1 break-all whitespace-normal\">{item.description}</div>\r\n                      <div className=\"flex justify-between text-sm\">\r\n                        <div className=\"text-gray-600\">\r\n                          {formatNumber(item.quantity)} x {displayCurrency} {formatNumber(item.price)}\r\n                        </div>\r\n                        <div className=\"font-bold\">\r\n                          {displayCurrency} {formatNumber(finalAmount)}\r\n                        </div>\r\n                      </div>\r\n                      {discountAmount > 0 && (\r\n                        <div className=\"flex justify-between text-xs text-orange-600 italic mt-0.5\">\r\n                          <span>Discount {item.discountType === 'percentage' ? `(${item.discountPercentage}%)` : ''}</span>\r\n                          <span>-{displayCurrency} {formatNumber(discountAmount)}</span>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  );\r\n                })}\r\n\r\n                {/* Mobile Totals */}\r\n                <div className=\"mt-4 border-t-2 border-black pt-2 space-y-1\">\r\n                  {(() => {\r\n                    const totalDiscount = sale.items.reduce((total, item) => {\r\n                      const itemSubtotal = item.quantity * item.price;\r\n                      const discountAmount = item.discountType === 'amount'\r\n                        ? (item.discountAmount || 0)\r\n                        : (itemSubtotal * (item.discountPercentage || 0)) / 100;\r\n                      return total + discountAmount;\r\n                    }, 0);\r\n\r\n                    return (\r\n                      <>\r\n                        <div className=\"flex justify-between text-sm\">\r\n                          <span className=\"font-medium\">Subtotal (before disc):</span>\r\n                          <span>{displayCurrency} {formatNumber(subtotal + totalDiscount)}</span>\r\n                        </div>\r\n                        {totalDiscount > 0 && (\r\n                          <div className=\"flex justify-between text-sm text-orange-600\">\r\n                            <span className=\"font-medium\">Total Discount:</span>\r\n                            <span>-{displayCurrency} {formatNumber(totalDiscount)}</span>\r\n                          </div>\r\n                        )}\r\n                        <div className=\"flex justify-between text-sm\">\r\n                          <span className=\"font-medium\">Subtotal:</span>\r\n                          <span>{displayCurrency} {formatNumber(subtotal)}</span>\r\n                        </div>\r\n                      </>\r\n                    );\r\n                  })()}\r\n\r\n                  {showTaxRow && (\r\n                    <div className=\"flex justify-between text-sm\">\r\n                      <span className=\"font-medium\">Tax ({taxRate}%):</span>\r\n                      <span>{displayCurrency} {formatNumber(taxAmount)}</span>\r\n                    </div>\r\n                  )}\r\n\r\n                  <div className=\"flex justify-between text-base font-bold border-t border-black pt-1 mt-1\">\r\n                    <span>Total:</span>\r\n                    <span>{displayCurrency} {formatNumber(totalAmount)}</span>\r\n                  </div>\r\n\r\n                  {isInstallmentSale && (\r\n                    <>\r\n                      <div className=\"flex justify-between text-sm text-blue-600 pt-1\">\r\n                        <span className=\"font-medium\">Amount Paid:</span>\r\n                        <span>{displayCurrency} {formatNumber(displayAmountPaid)}</span>\r\n                      </div>\r\n                      <div className=\"flex justify-between text-sm text-red-600\">\r\n                        <span className=\"font-medium\">Amount Due:</span>\r\n                        <span>{displayCurrency} {formatNumber(displayAmountDue)}</span>\r\n                      </div>\r\n                    </>\r\n                  )}\r\n\r\n                  <div className=\"pt-2 text-xs italic border-t border-gray-200 mt-2\">\r\n                    <span className=\"font-medium\">Words:</span> {displayCurrency} {totalAmountInWords} only\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {hasPaymentInfo && (\r\n              <div className=\"mt-4 pt-3 border-t border-black\">\r\n                <h3 className=\"font-semibold text-sm mb-2\">Payment Information:</h3>\r\n                <div className=\"overflow-x-auto\">\r\n                  <table className=\"w-full text-sm\">\r\n                    <thead>\r\n                      <tr className=\"bg-gray-200\">\r\n                        <th className=\"font-medium py-1 px-2 text-left\">Payment Method</th>\r\n                        <th className=\"font-medium py-1 px-2 text-left\">Account Number</th>\r\n                        <th className=\"font-medium py-1 px-2 text-left\">Account Name</th>\r\n                      </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                      {paymentMethods\r\n                        .filter(payment => payment.method.trim() !== '' || payment.accountNumber.trim() !== '' || payment.accountName.trim() !== '')\r\n                        .map((payment, index) => (\r\n                          <tr key={index}>\r\n                            <td className=\"py-1 px-2 font-medium\">{payment.method}</td>\r\n                            <td className=\"py-1 px-2\">{payment.accountNumber}</td>\r\n                            <td className=\"py-1 px-2\">{payment.accountName}</td>\r\n                          </tr>\r\n                        ))\r\n                      }\r\n                    </tbody>\r\n                  </table>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {sale.notes && (\r\n              <div className=\"mt-4 pt-3 border-t border-black\">\r\n                <h3 className=\"font-semibold text-sm mb-2\">Notes:</h3>\r\n                <div className=\"text-sm whitespace-pre-wrap\">{sale.notes}</div>\r\n              </div>\r\n            )}\r\n\r\n\r\n            <div className=\"text-center text-xs sm:text-sm mt-4 sm:mt-8\">\r\n              <p className=\"font-medium\">Thank you for your business!</p>\r\n              <p className=\"text-gray-600 text-xs mt-3\">Created by Gonza Systems</p>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div >\r\n  );\r\n};\r\n\r\nexport default PrintableReceipt;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 9796, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/sales/ReceiptDialog.tsx"],"sourcesContent":["\r\nimport React from 'react';\r\nimport { Sale } from '@/types';\r\nimport { Dialog, DialogContent } from '@/components/ui/dialog';\r\nimport { \r\n  Drawer, \r\n  DrawerContent,\r\n  DrawerClose,\r\n  DrawerTrigger\r\n} from '@/components/ui/drawer';\r\nimport PrintableReceipt from '@/components/PrintableReceipt';\r\nimport { useIsMobile } from '@/hooks/use-mobile';\r\nimport { X } from 'lucide-react';\r\nimport { ScrollArea } from '@/components/ui/scroll-area';\r\n\r\ninterface ReceiptDialogProps {\r\n  isOpen: boolean;\r\n  sale: Sale | null;\r\n  currency: string;\r\n  onOpenChange: (open: boolean) => void;\r\n  includePaymentInfo?: boolean;\r\n}\r\n\r\nconst ReceiptDialog: React.FC<ReceiptDialogProps> = ({ \r\n  isOpen, \r\n  sale, \r\n  currency,\r\n  onOpenChange,\r\n  includePaymentInfo = true\r\n}) => {\r\n  const isMobile = useIsMobile();\r\n\r\n  if (isMobile) {\r\n    return (\r\n      <Drawer open={isOpen} onOpenChange={onOpenChange}>\r\n        <DrawerContent className=\"max-h-[85vh]\">\r\n          <div className=\"relative px-4 py-6 pb-8\">\r\n            <DrawerClose className=\"absolute right-4 top-4 rounded-sm opacity-70 hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring\">\r\n              <X className=\"h-4 w-4\" />\r\n              <span className=\"sr-only\">Close</span>\r\n            </DrawerClose>\r\n            <ScrollArea className=\"h-[75vh] pr-4 pb-4\">\r\n              {sale && <PrintableReceipt sale={sale} currency={currency} isMobile={true} includePaymentInfo={includePaymentInfo} />}\r\n            </ScrollArea>\r\n          </div>\r\n        </DrawerContent>\r\n      </Drawer>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Dialog open={isOpen} onOpenChange={onOpenChange}>\r\n      <DialogContent className=\"max-w-3xl max-h-[90vh]\">\r\n        <ScrollArea className=\"h-[80vh] pr-4\">\r\n          {sale && <PrintableReceipt sale={sale} currency={currency} includePaymentInfo={includePaymentInfo} />}\r\n        </ScrollArea>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default ReceiptDialog;\r\n"],"names":[],"mappings":";;;;;AAGA;AACA;AAMA;AACA;AACA;AACA;;;;;;;;;AAUA,MAAM,gBAA8C,CAAC,EACnD,MAAM,EACN,IAAI,EACJ,QAAQ,EACR,YAAY,EACZ,qBAAqB,IAAI,EAC1B;;IACC,MAAM,WAAW,IAAA,gJAAW;IAE5B,IAAI,UAAU;QACZ,qBACE,6LAAC,+IAAM;YAAC,MAAM;YAAQ,cAAc;sBAClC,cAAA,6LAAC,sJAAa;gBAAC,WAAU;0BACvB,cAAA,6LAAC;oBAAI,WAAU;;sCACb,6LAAC,oJAAW;4BAAC,WAAU;;8CACrB,6LAAC,oMAAC;oCAAC,WAAU;;;;;;8CACb,6LAAC;oCAAK,WAAU;8CAAU;;;;;;;;;;;;sCAE5B,6LAAC,2JAAU;4BAAC,WAAU;sCACnB,sBAAQ,6LAAC,oJAAgB;gCAAC,MAAM;gCAAM,UAAU;gCAAU,UAAU;gCAAM,oBAAoB;;;;;;;;;;;;;;;;;;;;;;;;;;;IAM3G;IAEA,qBACE,6LAAC,+IAAM;QAAC,MAAM;QAAQ,cAAc;kBAClC,cAAA,6LAAC,sJAAa;YAAC,WAAU;sBACvB,cAAA,6LAAC,2JAAU;gBAAC,WAAU;0BACnB,sBAAQ,6LAAC,oJAAgB;oBAAC,MAAM;oBAAM,UAAU;oBAAU,oBAAoB;;;;;;;;;;;;;;;;;;;;;AAKzF;GApCM;;QAOa,gJAAW;;;KAPxB;uCAsCS"}},
    {"offset": {"line": 9933, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/customers/CustomerForm.tsx"],"sourcesContent":["\r\nimport React from \"react\";\r\nimport { Customer } from \"@/types\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Calendar as CalendarIcon } from \"lucide-react\";\r\nimport { Calendar } from \"@/components/ui/calendar\";\r\nimport {\r\n  Popover,\r\n  PopoverContent,\r\n  PopoverTrigger,\r\n} from \"@/components/ui/popover\";\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport { format } from \"date-fns\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { X } from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { useForm } from \"react-hook-form\";\r\nimport { DialogFooter } from \"@/components/ui/dialog\";\r\nimport { useCustomerCategories } from \"@/hooks/useCustomerCategories\";\r\n\r\ninterface CustomerFormProps {\r\n  initialData?: Customer;\r\n  onSubmit: (data: Partial<Customer>) => Promise<boolean>;\r\n  onCancel: () => void;\r\n}\r\n\r\nconst CustomerForm: React.FC<CustomerFormProps> = ({\r\n  initialData,\r\n  onSubmit,\r\n  onCancel,\r\n}) => {\r\n  const [isSubmitting, setIsSubmitting] = React.useState(false);\r\n  const { categories } = useCustomerCategories();\r\n  \r\n  // Initialize date state with proper timezone handling \r\n  const [date, setDate] = React.useState<Date | undefined>(() => {\r\n    if (initialData?.birthday) {\r\n      console.log('Initial birthday from props:', initialData.birthday);\r\n      return initialData.birthday;\r\n    }\r\n    return undefined;\r\n  });\r\n  \r\n  // Initialize category selection - use \"none\" instead of empty string\r\n  const [selectedCategoryId, setSelectedCategoryId] = React.useState<string>(\r\n    initialData?.categoryId || \"none\"\r\n  );\r\n  \r\n  // Log the initial birthday from props to help debug\r\n  React.useEffect(() => {\r\n    if (initialData?.birthday) {\r\n      console.log('Initial birthday from props:', initialData.birthday);\r\n      console.log('Is Date object:', initialData.birthday instanceof Date);\r\n      console.log('Date string:', initialData.birthday.toString());\r\n    }\r\n  }, [initialData?.birthday]);\r\n  \r\n  const [socialMedia, setSocialMedia] = React.useState({\r\n    facebook: initialData?.socialMedia?.facebook || \"\",\r\n    instagram: initialData?.socialMedia?.instagram || \"\",\r\n    twitter: initialData?.socialMedia?.twitter || \"\",\r\n    linkedin: initialData?.socialMedia?.linkedin || \"\",\r\n    other: initialData?.socialMedia?.other || \"\",\r\n  });\r\n  \r\n  const [tags, setTags] = React.useState<string[]>(initialData?.tags || []);\r\n  const [tagInput, setTagInput] = React.useState(\"\");\r\n  const [selectedGender, setSelectedGender] = React.useState(initialData?.gender || \"\");\r\n\r\n  const { register, handleSubmit, formState: { errors } } = useForm({\r\n    defaultValues: {\r\n      fullName: initialData?.fullName || \"\",\r\n      email: initialData?.email || \"\",\r\n      phoneNumber: initialData?.phoneNumber || \"\",\r\n      location: initialData?.location || \"\",\r\n      gender: initialData?.gender || \"\",\r\n      notes: initialData?.notes || \"\",\r\n    },\r\n  });\r\n\r\n  const addTag = () => {\r\n    if (tagInput.trim() !== \"\" && !tags.includes(tagInput.trim())) {\r\n      setTags([...tags, tagInput.trim()]);\r\n      setTagInput(\"\");\r\n    }\r\n  };\r\n\r\n  const removeTag = (tagToRemove: string) => {\r\n    setTags(tags.filter((tag) => tag !== tagToRemove));\r\n  };\r\n\r\n  const handleSocialMediaChange = (\r\n    e: React.ChangeEvent<HTMLInputElement>,\r\n    platform: string\r\n  ) => {\r\n    setSocialMedia({\r\n      ...socialMedia,\r\n      [platform]: e.target.value,\r\n    });\r\n  };\r\n\r\n  const onFormSubmit = async (data: any) => {\r\n    setIsSubmitting(true);\r\n    try {\r\n      // Log the date to help debug\r\n      console.log('Selected date before submission:', date);\r\n      \r\n      const customerData: Partial<Customer> = {\r\n        ...data,\r\n        gender: selectedGender,\r\n        birthday: date, // This is the Date object that needs to be correctly handled\r\n        categoryId: selectedCategoryId === \"none\" ? null : selectedCategoryId, // Convert \"none\" back to null\r\n        socialMedia: Object.keys(socialMedia).length > 0 ? socialMedia : null,\r\n        tags: tags.length > 0 ? tags : null,\r\n      };\r\n      \r\n      console.log('Submitting customer data:', customerData);\r\n      await onSubmit(customerData);\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  // Generate years for the dropdown (100 years back from current year)\r\n  const currentYear = new Date().getFullYear();\r\n  const years = Array.from({ length: 100 }, (_, i) => currentYear - i);\r\n  \r\n  // Months array for the dropdown\r\n  const months = [\r\n    { value: 0, label: \"January\" },\r\n    { value: 1, label: \"February\" },\r\n    { value: 2, label: \"March\" },\r\n    { value: 3, label: \"April\" },\r\n    { value: 4, label: \"May\" },\r\n    { value: 5, label: \"June\" },\r\n    { value: 6, label: \"July\" },\r\n    { value: 7, label: \"August\" },\r\n    { value: 8, label: \"September\" },\r\n    { value: 9, label: \"October\" },\r\n    { value: 10, label: \"November\" },\r\n    { value: 11, label: \"December\" },\r\n  ];\r\n\r\n  // Handle date selection directly from calendar\r\n  const handleDateSelect = (selectedDate: Date | undefined) => {\r\n    console.log('Date selected from calendar:', selectedDate);\r\n    \r\n    if (selectedDate) {\r\n      // When selecting a date, set it at noon UTC to avoid timezone issues\r\n      const year = selectedDate.getFullYear();\r\n      const month = selectedDate.getMonth();\r\n      const day = selectedDate.getDate();\r\n      \r\n      // Create new date at UTC noon to prevent date shifts\r\n      const correctedDate = new Date(Date.UTC(year, month, day, 12, 0, 0));\r\n      console.log('Corrected date with UTC noon:', correctedDate);\r\n      \r\n      setDate(correctedDate);\r\n    } else {\r\n      setDate(undefined);\r\n    }\r\n  };\r\n\r\n  // Handle year selection with proper date validation\r\n  const handleYearSelect = (year: string) => {\r\n    try {\r\n      const yearNum = parseInt(year);\r\n      const newDate = date ? new Date(date) : new Date();\r\n      \r\n      // Create a UTC date at noon to prevent timezone issues\r\n      const correctedDate = new Date(Date.UTC(\r\n        yearNum,\r\n        newDate.getMonth(),\r\n        newDate.getDate(),\r\n        12, 0, 0\r\n      ));\r\n      \r\n      // Check if the resulting date is valid\r\n      if (!isNaN(correctedDate.getTime())) {\r\n        setDate(correctedDate);\r\n        console.log('Year selected, new date:', correctedDate);\r\n      } else {\r\n        console.error('Invalid date after setting year:', year);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error setting year:', error);\r\n    }\r\n  };\r\n\r\n  // Handle month selection with proper date validation\r\n  const handleMonthSelect = (month: string) => {\r\n    try {\r\n      const monthNum = parseInt(month);\r\n      const newDate = date ? new Date(date) : new Date();\r\n      \r\n      // Create a UTC date at noon to prevent timezone issues\r\n      const correctedDate = new Date(Date.UTC(\r\n        newDate.getFullYear(),\r\n        monthNum,\r\n        newDate.getDate(),\r\n        12, 0, 0\r\n      ));\r\n      \r\n      // Check if the resulting date is valid\r\n      if (!isNaN(correctedDate.getTime())) {\r\n        setDate(correctedDate);\r\n        console.log('Month selected, new date:', correctedDate);\r\n      } else {\r\n        console.error('Invalid date after setting month:', month);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error setting month:', error);\r\n    }\r\n  };\r\n\r\n  // Filter categories to ensure no empty IDs\r\n  const validCategories = categories.filter(category => category.id && category.id.trim() !== '');\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit(onFormSubmit)}>\r\n      <div className=\"space-y-6\">\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"fullName\">Full Name*</Label>\r\n            <Input\r\n              id=\"fullName\"\r\n              {...register(\"fullName\", { required: \"Name is required\" })}\r\n              className={cn(errors.fullName && \"border-red-500\")}\r\n            />\r\n            {errors.fullName && (\r\n              <p className=\"text-red-500 text-xs\">\r\n                {errors.fullName.message as string}\r\n              </p>\r\n            )}\r\n          </div>\r\n\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"category\">Category</Label>\r\n            <Select\r\n              value={selectedCategoryId}\r\n              onValueChange={setSelectedCategoryId}\r\n            >\r\n              <SelectTrigger id=\"category\">\r\n                <SelectValue placeholder=\"Select category\" />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                <SelectItem value=\"none\">No Category</SelectItem>\r\n                {validCategories.map((category) => (\r\n                  <SelectItem key={category.id} value={category.id}>\r\n                    {category.name}\r\n                  </SelectItem>\r\n                ))}\r\n              </SelectContent>\r\n            </Select>\r\n          </div>\r\n\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"email\">Email Address</Label>\r\n            <Input\r\n              id=\"email\"\r\n              type=\"email\"\r\n              {...register(\"email\", {\r\n                pattern: {\r\n                  value: /^[A-Z0-9._%+-]+@[A-Z0-9.-]+\\.[A-Z]{2,}$/i,\r\n                  message: \"Invalid email address\",\r\n                },\r\n              })}\r\n              className={cn(errors.email && \"border-red-500\")}\r\n            />\r\n            {errors.email && (\r\n              <p className=\"text-red-500 text-xs\">{errors.email.message as string}</p>\r\n            )}\r\n          </div>\r\n\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"phoneNumber\">Phone Number</Label>\r\n            <Input id=\"phoneNumber\" {...register(\"phoneNumber\")} />\r\n          </div>\r\n\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"location\">Location</Label>\r\n            <Input id=\"location\" {...register(\"location\")} />\r\n          </div>\r\n\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"gender\">Gender</Label>\r\n            <Select\r\n              value={selectedGender}\r\n              onValueChange={setSelectedGender}\r\n            >\r\n              <SelectTrigger id=\"gender\">\r\n                <SelectValue placeholder=\"Select gender\" />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                <SelectItem value=\"male\">Male</SelectItem>\r\n                <SelectItem value=\"female\">Female</SelectItem>\r\n                <SelectItem value=\"non-binary\">Non-binary</SelectItem>\r\n                <SelectItem value=\"prefer-not-to-say\">\r\n                  Prefer not to say\r\n                </SelectItem>\r\n              </SelectContent>\r\n            </Select>\r\n          </div>\r\n\r\n          <div className=\"space-y-2\">\r\n            <Label>Birthday</Label>\r\n            <div className=\"flex flex-col gap-2\">\r\n              <div className=\"flex flex-row gap-2\">\r\n                <div className=\"flex-1\">\r\n                  <Popover>\r\n                    <PopoverTrigger asChild>\r\n                      <Button\r\n                        variant=\"outline\"\r\n                        className=\"w-full justify-between\"\r\n                      >\r\n                        {date ? date.getDate() : \"Day\"}\r\n                        <CalendarIcon className=\"h-4 w-4 opacity-50\" />\r\n                      </Button>\r\n                    </PopoverTrigger>\r\n                    <PopoverContent className=\"w-auto p-0\" align=\"start\">\r\n                      <Calendar\r\n                        mode=\"single\"\r\n                        selected={date}\r\n                        onSelect={handleDateSelect}\r\n                        initialFocus\r\n                        captionLayout=\"buttons\"\r\n                        className=\"p-3 pointer-events-auto\"\r\n                        classNames={{\r\n                          caption_label: \"hidden\",\r\n                          dropdown: \"hidden\",\r\n                        }}\r\n                      />\r\n                    </PopoverContent>\r\n                  </Popover>\r\n                </div>\r\n                <div className=\"flex-1\">\r\n                  <Select\r\n                    value={date ? String(date.getMonth()) : undefined}\r\n                    onValueChange={handleMonthSelect}\r\n                  >\r\n                    <SelectTrigger>\r\n                      <SelectValue placeholder=\"Month\" />\r\n                    </SelectTrigger>\r\n                    <SelectContent>\r\n                      {months.map((month) => (\r\n                        <SelectItem key={month.value} value={String(month.value)}>\r\n                          {month.label}\r\n                        </SelectItem>\r\n                      ))}\r\n                    </SelectContent>\r\n                  </Select>\r\n                </div>\r\n                <div className=\"flex-1\">\r\n                  <Select\r\n                    value={date ? String(date.getFullYear()) : undefined}\r\n                    onValueChange={handleYearSelect}\r\n                  >\r\n                    <SelectTrigger>\r\n                      <SelectValue placeholder=\"Year\" />\r\n                    </SelectTrigger>\r\n                    <SelectContent>\r\n                      {years.map((year) => (\r\n                        <SelectItem key={year} value={String(year)}>\r\n                          {year}\r\n                        </SelectItem>\r\n                      ))}\r\n                    </SelectContent>\r\n                  </Select>\r\n                </div>\r\n              </div>\r\n              {date && (\r\n                <div className=\"text-sm text-muted-foreground\">\r\n                  Selected: {date ? format(date, \"PPP\") : \"No date selected\"}\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"space-y-2\">\r\n          <Label>Tags</Label>\r\n          <div className=\"flex flex-wrap gap-1 mb-2\">\r\n            {tags.map((tag) => (\r\n              <Badge key={tag} variant=\"secondary\">\r\n                {tag}\r\n                <button\r\n                  type=\"button\"\r\n                  className=\"ml-1 rounded-full hover:bg-gray-200\"\r\n                  onClick={() => removeTag(tag)}\r\n                >\r\n                  <X className=\"h-3 w-3\" />\r\n                  <span className=\"sr-only\">Remove tag</span>\r\n                </button>\r\n              </Badge>\r\n            ))}\r\n          </div>\r\n          <div className=\"flex gap-2\">\r\n            <Input\r\n              value={tagInput}\r\n              onChange={(e) => setTagInput(e.target.value)}\r\n              placeholder=\"Add tag\"\r\n              onKeyDown={(e) => e.key === \"Enter\" && (e.preventDefault(), addTag())}\r\n            />\r\n            <Button type=\"button\" onClick={addTag} variant=\"outline\">\r\n              Add\r\n            </Button>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"space-y-2\">\r\n          <Label>Social Media</Label>\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\r\n            <div className=\"space-y-1\">\r\n              <Label htmlFor=\"facebook\" className=\"text-xs\">\r\n                Facebook\r\n              </Label>\r\n              <Input\r\n                id=\"facebook\"\r\n                value={socialMedia.facebook}\r\n                onChange={(e) => handleSocialMediaChange(e, \"facebook\")}\r\n                placeholder=\"Username or URL\"\r\n              />\r\n            </div>\r\n            <div className=\"space-y-1\">\r\n              <Label htmlFor=\"instagram\" className=\"text-xs\">\r\n                Instagram\r\n              </Label>\r\n              <Input\r\n                id=\"instagram\"\r\n                value={socialMedia.instagram}\r\n                onChange={(e) => handleSocialMediaChange(e, \"instagram\")}\r\n                placeholder=\"Username without @\"\r\n              />\r\n            </div>\r\n            <div className=\"space-y-1\">\r\n              <Label htmlFor=\"twitter\" className=\"text-xs\">\r\n                Twitter/X\r\n              </Label>\r\n              <Input\r\n                id=\"twitter\"\r\n                value={socialMedia.twitter}\r\n                onChange={(e) => handleSocialMediaChange(e, \"twitter\")}\r\n                placeholder=\"Username without @\"\r\n              />\r\n            </div>\r\n            <div className=\"space-y-1\">\r\n              <Label htmlFor=\"linkedin\" className=\"text-xs\">\r\n                LinkedIn\r\n              </Label>\r\n              <Input\r\n                id=\"linkedin\"\r\n                value={socialMedia.linkedin}\r\n                onChange={(e) => handleSocialMediaChange(e, \"linkedin\")}\r\n                placeholder=\"Profile URL or username\"\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"space-y-2\">\r\n          <Label>Birthday</Label>\r\n          <div className=\"flex flex-col gap-2\">\r\n            <div className=\"flex flex-row gap-2\">\r\n              <div className=\"flex-1\">\r\n                <Popover>\r\n                  <PopoverTrigger asChild>\r\n                    <Button\r\n                      variant=\"outline\"\r\n                      className=\"w-full justify-between\"\r\n                    >\r\n                      {date ? date.getDate() : \"Day\"}\r\n                      <CalendarIcon className=\"h-4 w-4 opacity-50\" />\r\n                    </Button>\r\n                  </PopoverTrigger>\r\n                  <PopoverContent className=\"w-auto p-0\" align=\"start\">\r\n                    <Calendar\r\n                      mode=\"single\"\r\n                      selected={date}\r\n                      onSelect={handleDateSelect}\r\n                      initialFocus\r\n                      captionLayout=\"buttons\"\r\n                      className=\"p-3 pointer-events-auto\"\r\n                      classNames={{\r\n                        caption_label: \"hidden\",\r\n                        dropdown: \"hidden\",\r\n                      }}\r\n                    />\r\n                  </PopoverContent>\r\n                </Popover>\r\n              </div>\r\n              <div className=\"flex-1\">\r\n                <Select\r\n                  value={date ? String(date.getMonth()) : undefined}\r\n                  onValueChange={handleMonthSelect}\r\n                >\r\n                  <SelectTrigger>\r\n                    <SelectValue placeholder=\"Month\" />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    {months.map((month) => (\r\n                      <SelectItem key={month.value} value={String(month.value)}>\r\n                        {month.label}\r\n                      </SelectItem>\r\n                    ))}\r\n                  </SelectContent>\r\n                </Select>\r\n              </div>\r\n              <div className=\"flex-1\">\r\n                <Select\r\n                  value={date ? String(date.getFullYear()) : undefined}\r\n                  onValueChange={handleYearSelect}\r\n                >\r\n                  <SelectTrigger>\r\n                    <SelectValue placeholder=\"Year\" />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    {years.map((year) => (\r\n                      <SelectItem key={year} value={String(year)}>\r\n                        {year}\r\n                      </SelectItem>\r\n                    ))}\r\n                  </SelectContent>\r\n                </Select>\r\n              </div>\r\n            </div>\r\n            {date && (\r\n              <div className=\"text-sm text-muted-foreground\">\r\n                Selected: {date ? format(date, \"PPP\") : \"No date selected\"}\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"space-y-2\">\r\n          <Label htmlFor=\"notes\">Notes</Label>\r\n          <Textarea\r\n            id=\"notes\"\r\n            {...register(\"notes\")}\r\n            rows={4}\r\n            placeholder=\"Add any notes about this customer...\"\r\n          />\r\n        </div>\r\n\r\n        <DialogFooter>\r\n          <Button variant=\"outline\" type=\"button\" onClick={onCancel}>\r\n            Cancel\r\n          </Button>\r\n          <Button type=\"submit\" disabled={isSubmitting}>\r\n            {isSubmitting ? \"Saving...\" : \"Save Changes\"}\r\n          </Button>\r\n        </DialogFooter>\r\n      </div>\r\n    </form>\r\n  );\r\n};\r\n\r\nexport default CustomerForm;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 11155, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/customers/NewCustomerDialog.tsx"],"sourcesContent":["\r\nimport React from 'react';\r\nimport { \r\n  Dialog, \r\n  DialogContent, \r\n  DialogDescription, \r\n  DialogHeader, \r\n  DialogTitle \r\n} from '@/components/ui/dialog';\r\nimport { Customer } from '@/types';\r\nimport CustomerForm from './CustomerForm';\r\nimport { ScrollArea } from '@/components/ui/scroll-area';\r\n\r\ninterface NewCustomerDialogProps {\r\n  open: boolean;\r\n  onClose: () => void;\r\n  onAddCustomer: (data: Partial<Customer>) => void;\r\n  initialData?: Customer;\r\n}\r\n\r\nconst NewCustomerDialog: React.FC<NewCustomerDialogProps> = ({ \r\n  open, \r\n  onClose, \r\n  onAddCustomer, \r\n  initialData \r\n}) => {\r\n  const handleSubmit = async (data: Partial<Customer>) => {\r\n    onAddCustomer(data);\r\n    return true;\r\n  };\r\n\r\n  const isEditing = !!initialData;\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={onClose}>\r\n      <DialogContent className=\"max-w-2xl max-h-[90vh]\">\r\n        <DialogHeader>\r\n          <DialogTitle>{isEditing ? 'Edit Customer' : 'Add New Customer'}</DialogTitle>\r\n          <DialogDescription>\r\n            Fill in the customer details below. Only name is required.\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n        <ScrollArea className=\"h-[calc(80vh-8rem)]\">\r\n          <div className=\"px-1\">\r\n            <CustomerForm \r\n              onSubmit={handleSubmit}\r\n              onCancel={onClose}\r\n              initialData={initialData}\r\n            />\r\n          </div>\r\n        </ScrollArea>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default NewCustomerDialog;\r\n"],"names":[],"mappings":";;;;;AAEA;AAQA;AACA;;;;;AASA,MAAM,oBAAsD,CAAC,EAC3D,IAAI,EACJ,OAAO,EACP,aAAa,EACb,WAAW,EACZ;IACC,MAAM,eAAe,OAAO;QAC1B,cAAc;QACd,OAAO;IACT;IAEA,MAAM,YAAY,CAAC,CAAC;IAEpB,qBACE,6LAAC,+IAAM;QAAC,MAAM;QAAM,cAAc;kBAChC,cAAA,6LAAC,sJAAa;YAAC,WAAU;;8BACvB,6LAAC,qJAAY;;sCACX,6LAAC,oJAAW;sCAAE,YAAY,kBAAkB;;;;;;sCAC5C,6LAAC,0JAAiB;sCAAC;;;;;;;;;;;;8BAIrB,6LAAC,2JAAU;oBAAC,WAAU;8BACpB,cAAA,6LAAC;wBAAI,WAAU;kCACb,cAAA,6LAAC,6JAAY;4BACX,UAAU;4BACV,UAAU;4BACV,aAAa;;;;;;;;;;;;;;;;;;;;;;;;;;;AAO3B;KAlCM;uCAoCS"}},
    {"offset": {"line": 11247, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/sales/DraftNotification.tsx"],"sourcesContent":["\r\nimport React from 'react';\r\nimport { Alert, AlertDescription } from '@/components/ui/alert';\r\nimport { Button } from '@/components/ui/button';\r\nimport { FileText, X } from 'lucide-react';\r\n\r\ninterface DraftNotificationProps {\r\n  onLoadDraft: () => void;\r\n  onDismiss: () => void;\r\n  savedAt: Date;\r\n}\r\n\r\nconst DraftNotification: React.FC<DraftNotificationProps> = ({\r\n  onLoadDraft,\r\n  onDismiss,\r\n  savedAt\r\n}) => {\r\n  const formatTime = (date: Date) => {\r\n    return date.toLocaleString(undefined, {\r\n      month: 'short',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    });\r\n  };\r\n\r\n  return (\r\n    <Alert className=\"mb-4 border-blue-200 bg-blue-50\">\r\n      <FileText className=\"h-4 w-4 text-blue-600\" />\r\n      <AlertDescription className=\"flex items-center justify-between\">\r\n        <div className=\"flex-1\">\r\n          <span className=\"text-blue-800 font-medium\">Draft found!</span>\r\n          <span className=\"text-blue-700 ml-2\">\r\n            Saved on {formatTime(savedAt)}\r\n          </span>\r\n        </div>\r\n        <div className=\"flex gap-2 ml-4\">\r\n          <Button\r\n            size=\"sm\"\r\n            onClick={onLoadDraft}\r\n            className=\"bg-blue-600 hover:bg-blue-700 text-white\"\r\n          >\r\n            Load Draft\r\n          </Button>\r\n          <Button\r\n            size=\"sm\"\r\n            variant=\"ghost\"\r\n            onClick={onDismiss}\r\n            className=\"text-blue-600 hover:text-blue-700 hover:bg-blue-100\"\r\n          >\r\n            <X className=\"h-4 w-4\" />\r\n          </Button>\r\n        </div>\r\n      </AlertDescription>\r\n    </Alert>\r\n  );\r\n};\r\n\r\nexport default DraftNotification;\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAAA;;;;;AAQA,MAAM,oBAAsD,CAAC,EAC3D,WAAW,EACX,SAAS,EACT,OAAO,EACR;IACC,MAAM,aAAa,CAAC;QAClB,OAAO,KAAK,cAAc,CAAC,WAAW;YACpC,OAAO;YACP,KAAK;YACL,MAAM;YACN,QAAQ;QACV;IACF;IAEA,qBACE,6LAAC,6IAAK;QAAC,WAAU;;0BACf,6LAAC,6NAAQ;gBAAC,WAAU;;;;;;0BACpB,6LAAC,wJAAgB;gBAAC,WAAU;;kCAC1B,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;gCAAK,WAAU;0CAA4B;;;;;;0CAC5C,6LAAC;gCAAK,WAAU;;oCAAqB;oCACzB,WAAW;;;;;;;;;;;;;kCAGzB,6LAAC;wBAAI,WAAU;;0CACb,6LAAC,+IAAM;gCACL,MAAK;gCACL,SAAS;gCACT,WAAU;0CACX;;;;;;0CAGD,6LAAC,+IAAM;gCACL,MAAK;gCACL,SAAQ;gCACR,SAAS;gCACT,WAAU;0CAEV,cAAA,6LAAC,oMAAC;oCAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAMzB;KA5CM;uCA8CS"}},
    {"offset": {"line": 11370, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/sales/NewSaleContent.tsx"],"sourcesContent":["import React from 'react';\r\nimport SalesForm from '@/components/SalesForm';\r\nimport ReceiptDialog from '@/components/sales/ReceiptDialog';\r\nimport NewCustomerDialog from '@/components/customers/NewCustomerDialog';\r\nimport DraftNotification from '@/components/sales/DraftNotification';\r\nimport { Sale } from '@/types';\r\n\r\ninterface NewSaleContentProps {\r\n  editSale?: Sale;\r\n  currency: string;\r\n  showDraftNotification: boolean;\r\n  draftData: any;\r\n  onLoadDraft: () => void;\r\n  onDismissDraft: () => void;\r\n  onSaleComplete: (sale: Sale, showReceipt?: boolean, includePaymentInfo?: boolean, selectedCategoryId?: string, onClearDraft?: () => void, saleDate?: Date, thermalPrintAfterSave?: boolean) => void;\r\n  onClearDraft: () => void;\r\n  customers: any[];\r\n  onAddNewCustomer: () => void;\r\n  isReceiptOpen: boolean;\r\n  completedSale: Sale | null;\r\n  includePaymentInfo: boolean;\r\n  onReceiptClose: () => void;\r\n  newCustomerDialogOpen: boolean;\r\n  onCloseNewCustomerDialog: () => void;\r\n  onAddCustomer: (customerData: any) => Promise<boolean>;\r\n}\r\n\r\nconst NewSaleContent: React.FC<NewSaleContentProps> = ({\r\n  editSale,\r\n  currency,\r\n  showDraftNotification,\r\n  draftData,\r\n  onLoadDraft,\r\n  onDismissDraft,\r\n  onSaleComplete,\r\n  onClearDraft,\r\n  customers,\r\n  onAddNewCustomer,\r\n  isReceiptOpen,\r\n  completedSale,\r\n  includePaymentInfo,\r\n  onReceiptClose,\r\n  newCustomerDialogOpen,\r\n  onCloseNewCustomerDialog,\r\n  onAddCustomer\r\n}) => {\r\n  return (\r\n    <>\r\n      {showDraftNotification && draftData && (\r\n        <DraftNotification\r\n          onLoadDraft={onLoadDraft}\r\n          onDismiss={onDismissDraft}\r\n          savedAt={draftData.savedAt}\r\n        />\r\n      )}\r\n\r\n      <SalesForm\r\n        initialData={editSale}\r\n        onSaleComplete={onSaleComplete}\r\n        currency={currency}\r\n        customers={customers}\r\n        onAddNewCustomer={onAddNewCustomer}\r\n        draftData={draftData}\r\n        onClearDraft={onClearDraft}\r\n      />\r\n\r\n      <ReceiptDialog\r\n        isOpen={isReceiptOpen}\r\n        sale={completedSale}\r\n        currency={currency}\r\n        onOpenChange={onReceiptClose}\r\n        includePaymentInfo={includePaymentInfo}\r\n      />\r\n\r\n      <NewCustomerDialog\r\n        open={newCustomerDialogOpen}\r\n        onClose={onCloseNewCustomerDialog}\r\n        onAddCustomer={onAddCustomer}\r\n      />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default NewSaleContent;"],"names":[],"mappings":";;;;;AACA;AACA;AACA;AACA;;;;;;AAuBA,MAAM,iBAAgD,CAAC,EACrD,QAAQ,EACR,QAAQ,EACR,qBAAqB,EACrB,SAAS,EACT,WAAW,EACX,cAAc,EACd,cAAc,EACd,YAAY,EACZ,SAAS,EACT,gBAAgB,EAChB,aAAa,EACb,aAAa,EACb,kBAAkB,EAClB,cAAc,EACd,qBAAqB,EACrB,wBAAwB,EACxB,aAAa,EACd;IACC,qBACE;;YACG,yBAAyB,2BACxB,6LAAC,8JAAiB;gBAChB,aAAa;gBACb,WAAW;gBACX,SAAS,UAAU,OAAO;;;;;;0BAI9B,6LAAC,6IAAS;gBACR,aAAa;gBACb,gBAAgB;gBAChB,UAAU;gBACV,WAAW;gBACX,kBAAkB;gBAClB,WAAW;gBACX,cAAc;;;;;;0BAGhB,6LAAC,0JAAa;gBACZ,QAAQ;gBACR,MAAM;gBACN,UAAU;gBACV,cAAc;gBACd,oBAAoB;;;;;;0BAGtB,6LAAC,kKAAiB;gBAChB,MAAM;gBACN,SAAS;gBACT,eAAe;;;;;;;;AAIvB;KAtDM;uCAwDS"}}]
}