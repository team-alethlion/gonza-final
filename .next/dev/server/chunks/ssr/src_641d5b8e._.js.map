{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/app/actions/analytics.ts"],"sourcesContent":["'use server';\r\n\r\nimport { db } from '../../../prisma/db';\r\n\r\nexport interface InventoryStats {\r\n    totalCostValue: number;\r\n    totalStockValue: number;\r\n    lowStockCount: number;\r\n    outOfStockCount: number;\r\n}\r\n\r\nexport async function getGlobalInventoryStatsAction(businessId: string) {\r\n    try {\r\n        const products = await db.product.findMany({\r\n            where: {\r\n                branchId: businessId,\r\n            },\r\n            select: {\r\n                stock: true,\r\n                minStock: true,\r\n                costPrice: true,\r\n                sellingPrice: true\r\n            }\r\n        });\r\n\r\n        const stats: InventoryStats = products.reduce((acc: InventoryStats, p: any) => {\r\n            const stock = p.stock || 0;\r\n            const cost = p.costPrice || 0;\r\n            const price = p.sellingPrice || 0;\r\n            const minStock = p.minStock || 0;\r\n\r\n            acc.totalCostValue += stock * cost;\r\n            acc.totalStockValue += stock * price;\r\n\r\n            if (stock <= 0) {\r\n                acc.outOfStockCount += 1;\r\n            } else if (stock <= minStock) {\r\n                acc.lowStockCount += 1;\r\n            }\r\n\r\n            return acc;\r\n        }, {\r\n            totalCostValue: 0,\r\n            totalStockValue: 0,\r\n            lowStockCount: 0,\r\n            outOfStockCount: 0\r\n        });\r\n\r\n        return { success: true, data: stats };\r\n    } catch (error: any) {\r\n        console.error('Error fetching global inventory stats:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\nexport async function getTotalExpensesAction(businessId: string, startDate?: string, endDate?: string) {\r\n    try {\r\n        const where: any = {\r\n            branchId: businessId\r\n        };\r\n\r\n        if (startDate || endDate) {\r\n            where.date = {};\r\n            if (startDate) {\r\n                where.date.gte = new Date(startDate);\r\n            }\r\n            if (endDate) {\r\n                where.date.lte = new Date(endDate);\r\n            }\r\n        }\r\n\r\n        const expenses = await db.expense.findMany({\r\n            where,\r\n            select: {\r\n                amount: true\r\n            }\r\n        });\r\n\r\n        const total = expenses.reduce((sum: number, e: any) => sum + Number(e.amount), 0);\r\n\r\n        return { success: true, data: total };\r\n    } catch (error: any) {\r\n        console.error('Error fetching total expenses:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MAuDsB,wBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA,0DAAA"}},
    {"offset": {"line": 18, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useAnalyticsData.ts"],"sourcesContent":["import { useState, useEffect, useMemo, useCallback } from 'react';\r\nimport { Sale, AnalyticsData } from '@/types';\r\nimport {\r\n  isWithinInterval,\r\n  startOfDay,\r\n  endOfDay,\r\n  startOfWeek,\r\n  endOfWeek,\r\n  startOfMonth,\r\n  endOfMonth,\r\n  startOfYear,\r\n  endOfYear,\r\n  subDays,\r\n  subWeeks,\r\n  subMonths,\r\n  isSameDay\r\n} from 'date-fns';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\nimport { getTotalExpensesAction } from '@/app/actions/analytics';\r\n\r\ninterface UseAnalyticsDataProps {\r\n  sales: Sale[];\r\n  dateFilter: string;\r\n  dateRange: { from: Date | undefined; to: Date | undefined; };\r\n  specificDate?: Date | undefined;\r\n  isCustomRange: boolean;\r\n  isSpecificDate?: boolean;\r\n}\r\n\r\nexport function useAnalyticsData({ sales, dateFilter, dateRange, specificDate, isCustomRange, isSpecificDate }: UseAnalyticsDataProps) {\r\n  const [expenses, setExpenses] = useState<number>(0);\r\n  const [isLoadingExpenses, setIsLoadingExpenses] = useState(true);\r\n  const { currentBusiness } = useBusiness();\r\n\r\n  // Memoize the expensive calculations\r\n  const calculateSaleTotals = useCallback((sale: Sale) => {\r\n    // Calculate total sale price after discounts (same logic as revenue calculation)\r\n    const totalSalePrice = sale.items && Array.isArray(sale.items)\r\n      ? sale.items.reduce((sum, item) => {\r\n        const subtotal = item.price * item.quantity;\r\n        const discountAmount = item.discountType === 'amount'\r\n          ? (item.discountAmount || 0)\r\n          : (subtotal * (item.discountPercentage || 0)) / 100;\r\n        return sum + (subtotal - discountAmount);\r\n      }, 0)\r\n      : 0;\r\n\r\n    const totalCost = sale.items && Array.isArray(sale.items)\r\n      ? sale.items.reduce((sum, item) => sum + (item.cost * item.quantity), 0)\r\n      : 0;\r\n\r\n    return { totalSalePrice, totalCost };\r\n  }, []);\r\n\r\n  // Memoize date filtering function\r\n  const matchesDateFilter = useCallback((saleDate: Date): boolean => {\r\n    // Validate the sale date\r\n    if (isNaN(saleDate.getTime())) {\r\n      return false;\r\n    }\r\n\r\n    if (dateFilter === 'all') return true;\r\n\r\n    if (dateFilter === 'custom' && isCustomRange) {\r\n      if (dateRange.from && dateRange.to) {\r\n        return isWithinInterval(saleDate, {\r\n          start: startOfDay(dateRange.from),\r\n          end: endOfDay(dateRange.to)\r\n        });\r\n      }\r\n      return true;\r\n    }\r\n\r\n    if (dateFilter === 'specific' && isSpecificDate) {\r\n      if (specificDate) {\r\n        return isSameDay(saleDate, specificDate);\r\n      }\r\n      return true;\r\n    }\r\n\r\n    const today = new Date();\r\n\r\n    switch (dateFilter) {\r\n      case 'today':\r\n        return isWithinInterval(saleDate, {\r\n          start: startOfDay(today),\r\n          end: endOfDay(today)\r\n        });\r\n      case 'yesterday':\r\n        const yesterday = subDays(today, 1);\r\n        return isWithinInterval(saleDate, {\r\n          start: startOfDay(yesterday),\r\n          end: endOfDay(yesterday)\r\n        });\r\n      case 'this-week':\r\n        return isWithinInterval(saleDate, {\r\n          start: startOfWeek(today, { weekStartsOn: 1 }),\r\n          end: endOfWeek(today, { weekStartsOn: 1 })\r\n        });\r\n      case 'last-week':\r\n        const lastWeekStart = subWeeks(startOfWeek(today, { weekStartsOn: 1 }), 1);\r\n        const lastWeekEnd = endOfWeek(lastWeekStart, { weekStartsOn: 1 });\r\n        return isWithinInterval(saleDate, {\r\n          start: lastWeekStart,\r\n          end: lastWeekEnd\r\n        });\r\n      case 'this-month':\r\n        return isWithinInterval(saleDate, {\r\n          start: startOfMonth(today),\r\n          end: endOfMonth(today)\r\n        });\r\n      case 'last-month':\r\n        const lastMonth = subMonths(today, 1);\r\n        return isWithinInterval(saleDate, {\r\n          start: startOfMonth(lastMonth),\r\n          end: endOfMonth(lastMonth)\r\n        });\r\n      case 'this-year':\r\n        return isWithinInterval(saleDate, {\r\n          start: startOfYear(today),\r\n          end: endOfYear(today)\r\n        });\r\n      default:\r\n        return true;\r\n    }\r\n  }, [dateFilter, isCustomRange, isSpecificDate, dateRange, specificDate]);\r\n\r\n  // Memoize filtered sales calculation\r\n  const filteredSalesData = useMemo(() => {\r\n    const filtered = sales.filter(sale => {\r\n      const saleDate = new Date(sale.date);\r\n      return matchesDateFilter(saleDate);\r\n    });\r\n\r\n    return {\r\n      all: filtered,\r\n      nonQuotes: filtered.filter(sale => sale.paymentStatus !== 'Quote')\r\n    };\r\n  }, [sales, matchesDateFilter]);\r\n\r\n  // Memoize analytics data calculation\r\n  const analyticsData = useMemo((): AnalyticsData => {\r\n    return filteredSalesData.nonQuotes.reduce((acc, sale) => {\r\n      const { totalSalePrice, totalCost } = calculateSaleTotals(sale);\r\n      // Calculate profit from actual revenue and cost to handle old sales correctly\r\n      const actualProfit = totalSalePrice - totalCost;\r\n\r\n      return {\r\n        totalSales: acc.totalSales + totalSalePrice,\r\n        totalProfit: acc.totalProfit + actualProfit,\r\n        totalCost: acc.totalCost + totalCost,\r\n        paidSalesCount: acc.paidSalesCount + (sale.paymentStatus === 'Paid' ? 1 : 0),\r\n        pendingSalesCount: acc.pendingSalesCount + (sale.paymentStatus === 'NOT PAID' ? 1 : 0),\r\n      };\r\n    }, {\r\n      totalSales: 0,\r\n      totalProfit: 0,\r\n      totalCost: 0,\r\n      paidSalesCount: 0,\r\n      pendingSalesCount: 0,\r\n    });\r\n  }, [filteredSalesData.nonQuotes, calculateSaleTotals]);\r\n\r\n  // Memoize bar chart data\r\n  const barChartData = useMemo(() => [\r\n    { name: 'Total Sales', amount: analyticsData.totalSales },\r\n    { name: 'Total Cost', amount: analyticsData.totalCost },\r\n    { name: 'Total Expenses', amount: expenses },\r\n    { name: 'Total Profit', amount: analyticsData.totalProfit },\r\n  ], [analyticsData, expenses]);\r\n\r\n  // Memoize recent sales calculation\r\n  const recentSales = useMemo(() => {\r\n    return [...filteredSalesData.all]\r\n      .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime())\r\n      .slice(0, 20);\r\n  }, [filteredSalesData.all]);\r\n\r\n  // Memoize non-quote sales count\r\n  const nonQuoteSalesCount = useMemo(() => {\r\n    return filteredSalesData.nonQuotes.length;\r\n  }, [filteredSalesData.nonQuotes]);\r\n\r\n  // Fetch expenses data based on the current date filter and business location\r\n  useEffect(() => {\r\n    const fetchExpenses = async () => {\r\n      if (!currentBusiness) {\r\n        setExpenses(0);\r\n        setIsLoadingExpenses(false);\r\n        return;\r\n      }\r\n\r\n      setIsLoadingExpenses(true);\r\n      try {\r\n        let startDate: string | undefined;\r\n        let endDate: string | undefined;\r\n\r\n        if (isCustomRange && dateRange.from && dateRange.to) {\r\n          startDate = dateRange.from.toISOString();\r\n          endDate = dateRange.to.toISOString();\r\n        } else if (isSpecificDate && specificDate) {\r\n          startDate = startOfDay(specificDate).toISOString();\r\n          endDate = endOfDay(specificDate).toISOString();\r\n        } else if (dateFilter !== 'all') {\r\n          const today = new Date();\r\n          switch (dateFilter) {\r\n            case 'today':\r\n              startDate = startOfDay(today).toISOString();\r\n              endDate = endOfDay(today).toISOString();\r\n              break;\r\n            case 'yesterday':\r\n              const yesterday = subDays(today, 1);\r\n              startDate = startOfDay(yesterday).toISOString();\r\n              endDate = endOfDay(yesterday).toISOString();\r\n              break;\r\n            case 'this-week':\r\n              startDate = startOfWeek(today, { weekStartsOn: 1 }).toISOString();\r\n              endDate = endOfWeek(today, { weekStartsOn: 1 }).toISOString();\r\n              break;\r\n            case 'last-week':\r\n              const lastWeekStart = subWeeks(startOfWeek(today, { weekStartsOn: 1 }), 1);\r\n              startDate = lastWeekStart.toISOString();\r\n              endDate = endOfWeek(lastWeekStart, { weekStartsOn: 1 }).toISOString();\r\n              break;\r\n            case 'this-month':\r\n              startDate = startOfMonth(today).toISOString();\r\n              endDate = endOfMonth(today).toISOString();\r\n              break;\r\n            case 'last-month':\r\n              const lastMonth = subMonths(today, 1);\r\n              startDate = startOfMonth(lastMonth).toISOString();\r\n              endDate = endOfMonth(lastMonth).toISOString();\r\n              break;\r\n            case 'this-year':\r\n              startDate = startOfYear(today).toISOString();\r\n              endDate = endOfYear(today).toISOString();\r\n              break;\r\n          }\r\n        }\r\n\r\n        const result = await getTotalExpensesAction(currentBusiness.id, startDate, endDate);\r\n\r\n        if (!result.success) {\r\n          console.error('Error fetching expenses:', result.error);\r\n          return;\r\n        }\r\n\r\n        setExpenses(result.data || 0);\r\n      } catch (error) {\r\n        console.error('Failed to fetch expenses:', error);\r\n      } finally {\r\n        setIsLoadingExpenses(false);\r\n      }\r\n    };\r\n\r\n    fetchExpenses();\r\n  }, [dateFilter, isCustomRange, isSpecificDate, dateRange.from, dateRange.to, specificDate, currentBusiness]);\r\n\r\n  return {\r\n    filteredSales: filteredSalesData.all,\r\n    nonQuoteSales: filteredSalesData.nonQuotes,\r\n    analyticsData,\r\n    barChartData,\r\n    recentSales,\r\n    nonQuoteSalesCount,\r\n    expenses,\r\n    isLoadingExpenses\r\n  };\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 314, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/ui/popover.tsx"],"sourcesContent":["import * as React from \"react\"\r\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst Popover = PopoverPrimitive.Root\r\n\r\nconst PopoverTrigger = PopoverPrimitive.Trigger\r\n\r\nconst PopoverContent = React.forwardRef<\r\n  React.ElementRef<typeof PopoverPrimitive.Content>,\r\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\r\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\r\n  <PopoverPrimitive.Portal>\r\n    <PopoverPrimitive.Content\r\n      ref={ref}\r\n      align={align}\r\n      sideOffset={sideOffset}\r\n      className={cn(\r\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  </PopoverPrimitive.Portal>\r\n))\r\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\r\n\r\nexport { Popover, PopoverTrigger, PopoverContent }\r\n"],"names":[],"mappings":";;;;;;;;;AAAA;AACA;AAEA;;;;;AAEA,MAAM,UAAU,2KAAqB;AAErC,MAAM,iBAAiB,8KAAwB;AAE/C,MAAM,+BAAiB,mNAAgB,CAGrC,CAAC,EAAE,SAAS,EAAE,QAAQ,QAAQ,EAAE,aAAa,CAAC,EAAE,GAAG,OAAO,EAAE,oBAC5D,8OAAC,6KAAuB;kBACtB,cAAA,8OAAC,8KAAwB;YACvB,KAAK;YACL,OAAO;YACP,YAAY;YACZ,WAAW,IAAA,yHAAE,EACX,8aACA;YAED,GAAG,KAAK;;;;;;;;;;;AAIf,eAAe,WAAW,GAAG,8KAAwB,CAAC,WAAW"}},
    {"offset": {"line": 355, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/ui/calendar.tsx"],"sourcesContent":["\r\nimport * as React from \"react\";\r\nimport { ChevronLeft, ChevronRight } from \"lucide-react\";\r\nimport { DayPicker } from \"react-day-picker\";\r\n\r\nimport { cn } from \"@/lib/utils\";\r\nimport { buttonVariants } from \"@/components/ui/button\";\r\n\r\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>;\r\n\r\nfunction Calendar({\r\n  className,\r\n  classNames,\r\n  showOutsideDays = true,\r\n  ...props\r\n}: CalendarProps) {\r\n  return (\r\n    <DayPicker\r\n      showOutsideDays={showOutsideDays}\r\n      className={cn(\"p-3 pointer-events-auto\", className)}\r\n      classNames={{\r\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\r\n        month: \"space-y-4\",\r\n        caption: \"flex justify-center pt-1 relative items-center\",\r\n        caption_label: \"text-sm font-medium\",\r\n        caption_dropdowns: \"flex justify-center gap-1\",\r\n        nav: \"space-x-1 flex items-center\",\r\n        nav_button: cn(\r\n          buttonVariants({ variant: \"outline\" }),\r\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\r\n        ),\r\n        nav_button_previous: \"absolute left-1\",\r\n        nav_button_next: \"absolute right-1\",\r\n        table: \"w-full border-collapse space-y-1\",\r\n        head_row: \"flex\",\r\n        head_cell:\r\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\r\n        row: \"flex w-full mt-2\",\r\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\r\n        day: cn(\r\n          buttonVariants({ variant: \"ghost\" }),\r\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\r\n        ),\r\n        day_range_end: \"day-range-end\",\r\n        day_selected:\r\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\r\n        day_today: \"bg-accent text-accent-foreground\",\r\n        day_outside:\r\n          \"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30\",\r\n        day_disabled: \"text-muted-foreground opacity-50\",\r\n        day_range_middle:\r\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\r\n        day_hidden: \"invisible\",\r\n        dropdown: \"bg-background rounded-md border p-1 shadow-md\",\r\n        dropdown_month: \"w-[var(--rdp-caption-dropdown-month-width)]\",\r\n        dropdown_year: \"w-[var(--rdp-caption-dropdown-year-width)]\",\r\n        dropdown_icon: \"w-4 h-4\",\r\n        button_reset: \"appearance-none bg-transparent border-none p-0 m-0\",\r\n        vhidden: \"sr-only\",\r\n        ...classNames,\r\n      }}\r\n      components={{\r\n        IconLeft: ({ ..._props }) => <ChevronLeft className=\"h-4 w-4\" />,\r\n        IconRight: ({ ..._props }) => <ChevronRight className=\"h-4 w-4\" />,\r\n      }}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\nCalendar.displayName = \"Calendar\";\r\n\r\nexport { Calendar };\r\n"],"names":[],"mappings":";;;;;AAEA;AAAA;AACA;AAEA;AACA;;;;;;AAIA,SAAS,SAAS,EAChB,SAAS,EACT,UAAU,EACV,kBAAkB,IAAI,EACtB,GAAG,OACW;IACd,qBACE,8OAAC,2KAAS;QACR,iBAAiB;QACjB,WAAW,IAAA,yHAAE,EAAC,2BAA2B;QACzC,YAAY;YACV,QAAQ;YACR,OAAO;YACP,SAAS;YACT,eAAe;YACf,mBAAmB;YACnB,KAAK;YACL,YAAY,IAAA,yHAAE,EACZ,IAAA,oJAAc,EAAC;gBAAE,SAAS;YAAU,IACpC;YAEF,qBAAqB;YACrB,iBAAiB;YACjB,OAAO;YACP,UAAU;YACV,WACE;YACF,KAAK;YACL,MAAM;YACN,KAAK,IAAA,yHAAE,EACL,IAAA,oJAAc,EAAC;gBAAE,SAAS;YAAQ,IAClC;YAEF,eAAe;YACf,cACE;YACF,WAAW;YACX,aACE;YACF,cAAc;YACd,kBACE;YACF,YAAY;YACZ,UAAU;YACV,gBAAgB;YAChB,eAAe;YACf,eAAe;YACf,cAAc;YACd,SAAS;YACT,GAAG,UAAU;QACf;QACA,YAAY;YACV,UAAU,CAAC,EAAE,GAAG,QAAQ,iBAAK,8OAAC,mOAAW;oBAAC,WAAU;;;;;;YACpD,WAAW,CAAC,EAAE,GAAG,QAAQ,iBAAK,8OAAC,sOAAY;oBAAC,WAAU;;;;;;QACxD;QACC,GAAG,KAAK;;;;;;AAGf;AACA,SAAS,WAAW,GAAG"}},
    {"offset": {"line": 438, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/analytics/DateRangeFilter.tsx"],"sourcesContent":["\r\nimport React from 'react';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Calendar as CalendarIcon } from \"lucide-react\";\r\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\r\nimport { Calendar } from \"@/components/ui/calendar\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { format } from \"date-fns\";\r\n\r\ninterface DateRangeFilterProps {\r\n  dateFilter: string;\r\n  dateRange: { from: Date | undefined; to: Date | undefined; };\r\n  specificDate?: Date | undefined;\r\n  isCustomRange: boolean;\r\n  isSpecificDate?: boolean;\r\n  onDateFilterChange: (value: string) => void;\r\n  onDateRangeChange: (range: { from: Date | undefined; to: Date | undefined; }) => void;\r\n  onSpecificDateChange?: (date: Date | undefined) => void;\r\n}\r\n\r\nconst DateRangeFilter: React.FC<DateRangeFilterProps> = ({\r\n  dateFilter,\r\n  dateRange,\r\n  specificDate,\r\n  isCustomRange,\r\n  isSpecificDate = false,\r\n  onDateFilterChange,\r\n  onDateRangeChange,\r\n  onSpecificDateChange\r\n}) => {\r\n  // Simplified event prevention\r\n  const preventPropagation = (e: React.MouseEvent | React.TouchEvent) => {\r\n    e.stopPropagation();\r\n  };\r\n  \r\n  return (\r\n    <div \r\n      className=\"flex gap-4 items-center flex-wrap mb-4\"\r\n      onClick={preventPropagation}\r\n    >\r\n      <div className=\"w-[240px] relative\">\r\n        <Select value={dateFilter} onValueChange={onDateFilterChange}>\r\n          <SelectTrigger className=\"bg-white shadow-sm\">\r\n            <SelectValue placeholder=\"Select date range\" />\r\n          </SelectTrigger>\r\n          <SelectContent className=\"z-[9999] bg-white shadow-lg border border-border/50\">\r\n            <SelectItem value=\"today\">Today</SelectItem>\r\n            <SelectItem value=\"yesterday\">Yesterday</SelectItem>\r\n            <SelectItem value=\"this-week\">This Week</SelectItem>\r\n            <SelectItem value=\"last-week\">Last Week</SelectItem>\r\n            <SelectItem value=\"this-month\">This Month</SelectItem>\r\n            <SelectItem value=\"last-month\">Last Month</SelectItem>\r\n            <SelectItem value=\"this-year\">This Year</SelectItem>\r\n            <SelectItem value=\"all\">All Time</SelectItem>\r\n            <SelectItem value=\"specific\">Specific Date</SelectItem>\r\n            <SelectItem value=\"custom\">Custom Range</SelectItem>\r\n          </SelectContent>\r\n        </Select>\r\n      </div>\r\n\r\n      {isSpecificDate && onSpecificDateChange && (\r\n        <div className=\"flex items-center\">\r\n          <Popover>\r\n            <PopoverTrigger asChild>\r\n              <Button\r\n                variant=\"outline\"\r\n                className=\"bg-white flex items-center gap-2 h-10 pl-3 text-left font-normal\"\r\n              >\r\n                <CalendarIcon className=\"h-4 w-4\" />\r\n                <span>{specificDate ? format(specificDate, \"MMM d, yyyy\") : \"Select Date\"}</span>\r\n              </Button>\r\n            </PopoverTrigger>\r\n            <PopoverContent className=\"w-auto p-0 z-[9999] bg-white shadow-lg\" align=\"start\">\r\n              <Calendar\r\n                initialFocus\r\n                mode=\"single\"\r\n                defaultMonth={specificDate}\r\n                selected={specificDate}\r\n                onSelect={onSpecificDateChange}\r\n                className=\"p-3 pointer-events-auto\"\r\n                showOutsideDays={true}\r\n              />\r\n            </PopoverContent>\r\n          </Popover>\r\n        </div>\r\n      )}\r\n\r\n      {isCustomRange && (\r\n        <div className=\"flex items-center space-x-2\">\r\n          <Popover>\r\n            <PopoverTrigger asChild>\r\n              <Button\r\n                variant=\"outline\"\r\n                className=\"bg-white flex items-center gap-2 h-10 pl-3 text-left font-normal\"\r\n              >\r\n                <CalendarIcon className=\"h-4 w-4\" />\r\n                <span>{dateRange.from ? format(dateRange.from, \"MMM d, yyyy\") : \"Start Date\"}</span>\r\n              </Button>\r\n            </PopoverTrigger>\r\n            <PopoverContent className=\"w-auto p-0 z-[9999] bg-white shadow-lg\" align=\"start\">\r\n              <Calendar\r\n                initialFocus\r\n                mode=\"single\"\r\n                defaultMonth={dateRange?.from}\r\n                selected={dateRange?.from}\r\n                onSelect={(date) => onDateRangeChange({ ...dateRange, from: date })}\r\n                className=\"p-3 pointer-events-auto\"\r\n                showOutsideDays={true}\r\n              />\r\n            </PopoverContent>\r\n          </Popover>\r\n          \r\n          <span className=\"text-muted-foreground\">to</span>\r\n          \r\n          <Popover>\r\n            <PopoverTrigger asChild>\r\n              <Button\r\n                variant=\"outline\"\r\n                className=\"bg-white flex items-center gap-2 h-10 pl-3 text-left font-normal\"\r\n              >\r\n                <CalendarIcon className=\"h-4 w-4\" />\r\n                <span>{dateRange.to ? format(dateRange.to, \"MMM d, yyyy\") : \"End Date\"}</span>\r\n              </Button>\r\n            </PopoverTrigger>\r\n            <PopoverContent className=\"w-auto p-0 z-[9999] bg-white shadow-lg\" align=\"start\">\r\n              <Calendar\r\n                initialFocus\r\n                mode=\"single\"\r\n                defaultMonth={dateRange?.to}\r\n                selected={dateRange?.to}\r\n                onSelect={(date) => onDateRangeChange({ ...dateRange, to: date })}\r\n                className=\"p-3 pointer-events-auto\"\r\n                showOutsideDays={true}\r\n              />\r\n            </PopoverContent>\r\n          </Popover>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default DateRangeFilter;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 807, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/analytics/AnalyticsCards.tsx"],"sourcesContent":["\r\nimport React, { memo } from 'react';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { AnalyticsData } from '@/types';\r\nimport { formatNumber } from '@/lib/utils';\r\nimport { useIsMobile } from '@/hooks/use-mobile';\r\nimport { TrendingUp, DollarSign, Percent, UserCheck, CreditCard, Package } from 'lucide-react';\r\n\r\ninterface AnalyticsCardsProps {\r\n  analyticsData: AnalyticsData;\r\n  nonQuoteSalesCount: number;\r\n  currency: string;\r\n  expenses: number;\r\n  inventoryValue: number;\r\n  canViewProfit?: boolean;\r\n  canViewTotalSales?: boolean;\r\n  canViewTotalExpenses?: boolean;\r\n  canViewInventoryValue?: boolean;\r\n  canViewSalesTypes?: boolean;\r\n}\r\n\r\nconst AnalyticsCards: React.FC<AnalyticsCardsProps> = memo(({\r\n  analyticsData,\r\n  nonQuoteSalesCount,\r\n  currency,\r\n  expenses,\r\n  inventoryValue,\r\n  canViewProfit = true,\r\n  canViewTotalSales = true,\r\n  canViewTotalExpenses = true,\r\n  canViewInventoryValue = true,\r\n  canViewSalesTypes = true\r\n}) => {\r\n  const isMobile = useIsMobile();\r\n\r\n  const cards = [\r\n    {\r\n      title: \"Total Sales\",\r\n      value: canViewTotalSales ? `${currency} ${formatNumber(analyticsData.totalSales)}` : '•••',\r\n      description: canViewTotalSales\r\n        ? `From ${nonQuoteSalesCount} transactions (excluding quotes)`\r\n        : \"Requires permission\",\r\n      color: \"text-sales-primary\",\r\n      bgColor: \"bg-blue-50\",\r\n      icon: <DollarSign className=\"h-5 w-5 text-sales-primary\" />,\r\n      visible: true\r\n    },\r\n    {\r\n      title: \"Total Gross Profit\",\r\n      value: canViewProfit ? `${currency} ${formatNumber(analyticsData.totalProfit)}` : '•••',\r\n      description: canViewProfit\r\n        ? (analyticsData.totalProfit > 0\r\n          ? `${(analyticsData.totalProfit / analyticsData.totalSales * 100).toFixed(1)}% profit margin`\r\n          : \"No profit yet\")\r\n        : \"Requires permission\",\r\n      color: \"text-green-600\",\r\n      bgColor: \"bg-green-50\",\r\n      icon: <TrendingUp className=\"h-5 w-5 text-green-600\" />,\r\n      visible: true\r\n    },\r\n    {\r\n      title: \"Total Expenses\",\r\n      value: canViewTotalExpenses ? `${currency} ${formatNumber(expenses)}` : '•••',\r\n      description: canViewTotalExpenses\r\n        ? (expenses > 0 && analyticsData.totalSales > 0\r\n          ? `${(expenses / analyticsData.totalSales * 100).toFixed(1)}% of sales`\r\n          : \"No expenses recorded\")\r\n        : \"Requires permission\",\r\n      color: \"text-[#f05a29]\",\r\n      bgColor: \"bg-orange-50\",\r\n      icon: <Percent className=\"h-5 w-5 text-[#f05a29]\" />,\r\n      visible: true\r\n    },\r\n    {\r\n      title: \"Inventory Value\",\r\n      value: canViewInventoryValue ? `${currency} ${formatNumber(inventoryValue)}` : '•••',\r\n      description: canViewInventoryValue ? \"Total value of current inventory\" : \"Requires permission\",\r\n      color: \"text-green-600\",\r\n      bgColor: \"bg-green-50\",\r\n      icon: <Package className=\"h-5 w-5 text-green-600\" />,\r\n      visible: true\r\n    },\r\n    {\r\n      title: \"Cash Sales\",\r\n      value: canViewSalesTypes ? analyticsData.paidSalesCount.toString() : '•••',\r\n      description: canViewSalesTypes\r\n        ? (analyticsData.paidSalesCount + analyticsData.pendingSalesCount > 0\r\n          ? `${(analyticsData.paidSalesCount / (analyticsData.paidSalesCount + analyticsData.pendingSalesCount) * 100).toFixed(1)}% of total`\r\n          : \"No sales yet\")\r\n        : \"Requires permission\",\r\n      color: \"text-green-600\",\r\n      bgColor: \"bg-green-50\",\r\n      icon: <UserCheck className=\"h-5 w-5 text-green-600\" />,\r\n      visible: true\r\n    },\r\n    {\r\n      title: \"Credit Sales\",\r\n      value: canViewSalesTypes ? analyticsData.pendingSalesCount.toString() : '•••',\r\n      description: canViewSalesTypes\r\n        ? (analyticsData.pendingSalesCount > 0\r\n          ? `${(analyticsData.pendingSalesCount / (analyticsData.paidSalesCount + analyticsData.pendingSalesCount) * 100).toFixed(1)}% of total`\r\n          : \"No credit sales\")\r\n        : \"Requires permission\",\r\n      color: \"text-amber-500\",\r\n      bgColor: \"bg-amber-50\",\r\n      icon: <CreditCard className=\"h-5 w-5 text-amber-500\" />,\r\n      visible: true\r\n    }\r\n  ];\r\n\r\n  const visibleCards = cards.filter(c => c.visible);\r\n\r\n  return (\r\n    <div className={`grid gap-4 w-full ${isMobile\r\n      ? 'grid-cols-2'\r\n      : 'grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6'\r\n      }`}>\r\n      {cards.map((card, index) => (\r\n        <Card key={index} className={`w-full transition-all duration-200 hover:shadow-md ${isMobile ? 'border-l-4 border-l-blue-500' : ''\r\n          }`}>\r\n          <CardContent className={`${isMobile ? 'p-3' : 'p-6'}`}>\r\n            <div className=\"flex items-start justify-between\">\r\n              <div className=\"flex-1\">\r\n                <div className=\"flex items-center gap-2 mb-2\">\r\n                  <div className={`p-1.5 rounded-lg ${card.bgColor} ${isMobile ? 'p-1' : 'p-2'}`}>\r\n                    <div className={isMobile ? 'scale-75' : ''}>\r\n                      {card.icon}\r\n                    </div>\r\n                  </div>\r\n                  <p className={`text-sm font-medium text-gray-600 ${isMobile ? 'text-xs leading-tight' : ''\r\n                    }`}>\r\n                    {card.title}\r\n                  </p>\r\n                </div>\r\n                <div className={`${card.color} font-bold mb-1 ${isMobile ? 'text-lg' : 'text-2xl'\r\n                  }`}>\r\n                  {card.value}\r\n                </div>\r\n                <p className={`text-muted-foreground ${isMobile ? 'text-xs leading-tight' : 'text-xs'\r\n                  }`}>\r\n                  {card.description}\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      ))}\r\n    </div>\r\n  );\r\n});\r\n\r\nexport default AnalyticsCards;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1014, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/analytics/FinancialOverview.tsx"],"sourcesContent":["\r\nimport React from 'react';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport {\r\n  BarChart,\r\n  Bar,\r\n  XAxis,\r\n  YAxis,\r\n  CartesianGrid,\r\n  Tooltip,\r\n  ResponsiveContainer,\r\n  Legend,\r\n  Cell,\r\n  ReferenceLine\r\n} from 'recharts';\r\nimport { Lock as LockIcon } from 'lucide-react';\r\nimport { useIsMobile } from '@/hooks/use-mobile';\r\n\r\ninterface FinancialOverviewProps {\r\n  data: Array<{ name: string, amount: number }>;\r\n  formatCurrency: (value: any) => string;\r\n}\r\n\r\nconst CustomTooltip = ({ active, payload, label, formatCurrency }: any) => {\r\n  if (active && payload && payload.length) {\r\n    return (\r\n      <div className=\"bg-white p-3 border border-gray-200 shadow-lg rounded-lg\">\r\n        <p className=\"font-medium text-sm text-gray-900\">{`${label}`}</p>\r\n        <p className=\"text-sm text-blue-600\">\r\n          <span className=\"font-medium\">{`Amount: `}</span>\r\n          <span className=\"font-bold\">{formatCurrency(payload[0].value)}</span>\r\n        </p>\r\n      </div>\r\n    );\r\n  }\r\n  return null;\r\n};\r\n\r\nconst FinancialOverview: React.FC<FinancialOverviewProps> = ({ data, formatCurrency }) => {\r\n  const isMobile = useIsMobile();\r\n\r\n  // Enhanced color mapping with gradients\r\n  const getBarColor = (entry: any, index: number) => {\r\n    const category = entry.name.toLowerCase();\r\n    if (category.includes('sales')) return '#3B82F6'; // Blue\r\n    if (category.includes('cost')) return '#EF4444'; // Red\r\n    if (category.includes('expenses')) return '#8B5CF6'; // Purple\r\n    if (category.includes('profit')) return '#10B981'; // Green\r\n    return '#6B7280'; // Gray default\r\n  };\r\n\r\n  // Add colors to data for easier rendering\r\n  const enhancedData = data.map((item, index) => ({\r\n    ...item,\r\n    fill: getBarColor(item, index)\r\n  }));\r\n\r\n  return (\r\n    <Card className=\"w-full shadow-sm\">\r\n      <CardHeader className={isMobile ? 'pb-3' : 'pb-4'}>\r\n        <CardTitle className={isMobile ? 'text-lg' : 'text-xl'}>\r\n          Financial Overview\r\n        </CardTitle>\r\n        <CardDescription className={isMobile ? 'text-sm' : ''}>\r\n          Sales, costs, expenses, and profits (excluding quotes)\r\n        </CardDescription>\r\n      </CardHeader>\r\n      <CardContent className={isMobile ? 'p-4 pt-0' : 'p-6 pt-0'}>\r\n        <div className={`w-full ${isMobile ? 'h-64' : 'h-80'}`}>\r\n          {data.length > 0 ? (\r\n            <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n              <BarChart\r\n                data={enhancedData}\r\n                margin={{\r\n                  top: 5,\r\n                  right: isMobile ? 10 : 30,\r\n                  left: isMobile ? 10 : 20,\r\n                  bottom: 5\r\n                }}\r\n              >\r\n                <CartesianGrid\r\n                  strokeDasharray=\"3 3\"\r\n                  stroke=\"#f0f0f0\"\r\n                  opacity={0.5}\r\n                />\r\n                <XAxis\r\n                  dataKey=\"name\"\r\n                  tick={{\r\n                    fontSize: isMobile ? 10 : 12,\r\n                    fill: '#6B7280'\r\n                  }}\r\n                  tickLine={false}\r\n                  axisLine={{ stroke: '#e0e0e0' }}\r\n                  angle={isMobile ? -45 : 0}\r\n                  textAnchor={isMobile ? 'end' : 'middle'}\r\n                  height={isMobile ? 50 : 30}\r\n                />\r\n                <YAxis\r\n                  tickFormatter={(value) => formatCurrency(value)}\r\n                  tick={{\r\n                    fontSize: isMobile ? 10 : 12,\r\n                    fill: '#6B7280'\r\n                  }}\r\n                  tickLine={false}\r\n                  axisLine={{ stroke: '#e0e0e0' }}\r\n                  width={isMobile ? 60 : 80}\r\n                />\r\n                <Tooltip\r\n                  content={<CustomTooltip formatCurrency={formatCurrency} />}\r\n                  cursor={{ fill: 'rgba(59, 130, 246, 0.1)' }}\r\n                />\r\n                {!isMobile && (\r\n                  <Legend\r\n                    wrapperStyle={{\r\n                      paddingTop: 15,\r\n                      fontSize: 12,\r\n                      color: '#6B7280'\r\n                    }}\r\n                  />\r\n                )}\r\n                <Bar\r\n                  dataKey=\"amount\"\r\n                  name=\"Amount\"\r\n                  barSize={isMobile ? 30 : 40}\r\n                  radius={[4, 4, 0, 0]}\r\n                  fillOpacity={0.9}\r\n                >\r\n                  {enhancedData.map((entry, index) => (\r\n                    <Cell\r\n                      key={`cell-${index}`}\r\n                      fill={entry.fill}\r\n                    />\r\n                  ))}\r\n                </Bar>\r\n              </BarChart>\r\n            </ResponsiveContainer>\r\n          ) : (\r\n            <div className=\"flex flex-col items-center justify-center h-full text-muted-foreground space-y-2\">\r\n              <LockIcon className=\"h-8 w-8 opacity-20\" />\r\n              <p>Private data restricted</p>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Mobile Legend */}\r\n        {isMobile && (\r\n          <div className=\"flex flex-wrap justify-center gap-3 mt-4 pt-3 border-t\">\r\n            {enhancedData.map((entry, index) => (\r\n              <div key={index} className=\"flex items-center gap-1\">\r\n                <div\r\n                  className=\"w-3 h-3 rounded-sm\"\r\n                  style={{ backgroundColor: entry.fill }}\r\n                />\r\n                <span className=\"text-xs text-gray-600 font-medium\">\r\n                  {entry.name}\r\n                </span>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default FinancialOverview;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1327, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/ui/progress.tsx"],"sourcesContent":["\r\nimport * as React from \"react\"\r\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst Progress = React.forwardRef<\r\n  React.ElementRef<typeof ProgressPrimitive.Root>,\r\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\r\n>(({ className, value, ...props }, ref) => (\r\n  <ProgressPrimitive.Root\r\n    ref={ref}\r\n    className={cn(\r\n      \"relative h-4 w-full overflow-hidden rounded-full bg-gray-200\",\r\n      className\r\n    )}\r\n    {...props}\r\n  >\r\n    <ProgressPrimitive.Indicator\r\n      className=\"h-full w-full flex-1 transition-all\"\r\n      style={{ \r\n        transform: `translateX(-${100 - (value || 0)}%)`,\r\n        backgroundColor: \"#16a34a\"\r\n      }}\r\n    />\r\n  </ProgressPrimitive.Root>\r\n))\r\nProgress.displayName = ProgressPrimitive.Root.displayName\r\n\r\nexport { Progress }\r\n"],"names":[],"mappings":";;;;;AACA;AACA;AAEA;;;;;AAEA,MAAM,yBAAW,mNAAgB,CAG/B,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,GAAG,OAAO,EAAE,oBACjC,8OAAC,4KAAsB;QACrB,KAAK;QACL,WAAW,IAAA,yHAAE,EACX,gEACA;QAED,GAAG,KAAK;kBAET,cAAA,8OAAC,iLAA2B;YAC1B,WAAU;YACV,OAAO;gBACL,WAAW,CAAC,YAAY,EAAE,MAAM,CAAC,SAAS,CAAC,EAAE,EAAE,CAAC;gBAChD,iBAAiB;YACnB;;;;;;;;;;;AAIN,SAAS,WAAW,GAAG,4KAAsB,CAAC,WAAW"}},
    {"offset": {"line": 1365, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/ui/tabs.tsx"],"sourcesContent":["import * as React from \"react\"\r\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst Tabs = TabsPrimitive.Root\r\n\r\nconst TabsList = React.forwardRef<\r\n  React.ElementRef<typeof TabsPrimitive.List>,\r\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\r\n>(({ className, ...props }, ref) => (\r\n  <TabsPrimitive.List\r\n    ref={ref}\r\n    className={cn(\r\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nTabsList.displayName = TabsPrimitive.List.displayName\r\n\r\nconst TabsTrigger = React.forwardRef<\r\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\r\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\r\n>(({ className, ...props }, ref) => (\r\n  <TabsPrimitive.Trigger\r\n    ref={ref}\r\n    className={cn(\r\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\r\n\r\nconst TabsContent = React.forwardRef<\r\n  React.ElementRef<typeof TabsPrimitive.Content>,\r\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\r\n>(({ className, ...props }, ref) => (\r\n  <TabsPrimitive.Content\r\n    ref={ref}\r\n    className={cn(\r\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nTabsContent.displayName = TabsPrimitive.Content.displayName\r\n\r\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\r\n"],"names":[],"mappings":";;;;;;;;;;;AAAA;AACA;AAEA;;;;;AAEA,MAAM,OAAO,wKAAkB;AAE/B,MAAM,yBAAW,mNAAgB,CAG/B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC,wKAAkB;QACjB,KAAK;QACL,WAAW,IAAA,yHAAE,EACX,8FACA;QAED,GAAG,KAAK;;;;;;AAGb,SAAS,WAAW,GAAG,wKAAkB,CAAC,WAAW;AAErD,MAAM,4BAAc,mNAAgB,CAGlC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC,2KAAqB;QACpB,KAAK;QACL,WAAW,IAAA,yHAAE,EACX,uYACA;QAED,GAAG,KAAK;;;;;;AAGb,YAAY,WAAW,GAAG,2KAAqB,CAAC,WAAW;AAE3D,MAAM,4BAAc,mNAAgB,CAGlC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC,2KAAqB;QACpB,KAAK;QACL,WAAW,IAAA,yHAAE,EACX,mIACA;QAED,GAAG,KAAK;;;;;;AAGb,YAAY,WAAW,GAAG,2KAAqB,CAAC,WAAW"}},
    {"offset": {"line": 1419, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/app/actions/business-settings.ts"],"sourcesContent":["'use server';\r\n\r\nimport { db } from '../../../prisma/db';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\nexport async function getBusinessSettingsAction(branchId: string) {\r\n    try {\r\n        const settings = await db.branchSettings.findUnique({\r\n            where: { branchId }\r\n        });\r\n\r\n        if (!settings) {\r\n            return null;\r\n        }\r\n\r\n        return {\r\n            id: settings.id,\r\n            business_name: settings.businessName,\r\n            business_address: settings.address,\r\n            business_phone: settings.phone,\r\n            business_email: settings.email,\r\n            business_logo: settings.logo,\r\n            currency: settings.currency,\r\n            signature: settings.signatureImage,\r\n            metadata: settings.metadata || {}\r\n        };\r\n    } catch (error) {\r\n        console.error('Error fetching business settings:', error);\r\n        return null;\r\n    }\r\n}\r\n\r\nexport async function upsertBusinessSettingsAction(branchId: string, userId: string, updateData: any) {\r\n    try {\r\n        // Validate user access to branch\r\n        const branch = await db.branch.findFirst({\r\n            where: {\r\n                id: branchId,\r\n                OR: [\r\n                    { adminId: userId },\r\n                    { users: { some: { id: userId } } }\r\n                ]\r\n            }\r\n        });\r\n\r\n        if (!branch) {\r\n            return { success: false, error: 'Unauthorized to update branch settings' };\r\n        }\r\n\r\n        const data = {\r\n            businessName: updateData.business_name,\r\n            address: updateData.business_address,\r\n            phone: updateData.business_phone,\r\n            email: updateData.business_email,\r\n            logo: updateData.business_logo,\r\n            currency: updateData.currency,\r\n            signatureImage: updateData.signature,\r\n            metadata: updateData.metadata\r\n        };\r\n\r\n        const upserted = await db.branchSettings.upsert({\r\n            where: { branchId: branchId },\r\n            update: data,\r\n            create: {\r\n                branchId: branchId,\r\n                ...data\r\n            }\r\n        });\r\n\r\n        return {\r\n            success: true,\r\n            data: {\r\n                id: upserted.id,\r\n                business_name: upserted.businessName,\r\n                business_address: upserted.address,\r\n                business_phone: upserted.phone,\r\n                business_email: upserted.email,\r\n                business_logo: upserted.logo,\r\n                currency: upserted.currency,\r\n                signature: upserted.signatureImage,\r\n                metadata: upserted.metadata\r\n            }\r\n        };\r\n    } catch (error: any) {\r\n        console.error('Error upserting business settings:', error);\r\n        return { success: false, error: error.message || 'Failed to update settings' };\r\n    }\r\n}\r\n\r\nexport async function getAccountStatusAction(userId: string) {\r\n    try {\r\n        const user = await db.user.findUnique({\r\n            where: { id: userId },\r\n            select: {\r\n                isFrozen: true,\r\n                createdAt: true,\r\n                subscriptions: {\r\n                    where: { status: 'active' },\r\n                    orderBy: { endDate: 'desc' },\r\n                    take: 1\r\n                },\r\n                branches: {\r\n                    select: { id: true }\r\n                }\r\n            }\r\n        });\r\n\r\n        if (!user) return null;\r\n\r\n        const activeSub = user.subscriptions[0];\r\n        const now = new Date();\r\n        const daysRemaining = activeSub ? Math.ceil((activeSub.endDate.getTime() - now.getTime()) / (1000 * 60 * 60 * 24)) : 0;\r\n\r\n        return {\r\n            is_frozen: user.isFrozen,\r\n            location_limit: 1, // Traditional limit or from subscription\r\n            billing_amount: activeSub ? Number(activeSub.amount) : 50000,\r\n            billing_duration: 'Monthly',\r\n            days_remaining: Math.max(0, daysRemaining),\r\n            next_billing_date: activeSub?.endDate.toISOString() || ''\r\n        };\r\n    } catch (error) {\r\n        console.error('Error fetching account status:', error);\r\n        return { is_frozen: false, location_limit: 1, billing_amount: 50000, billing_duration: 'Monthly', days_remaining: 30, next_billing_date: '' };\r\n    }\r\n}\r\n\r\nexport async function getOnboardingStatusAction(locationId: string) {\r\n    try {\r\n        const settings = await db.branchSettings.findUnique({\r\n            where: { branchId: locationId }\r\n        });\r\n\r\n        if (!settings) return null;\r\n\r\n        return {\r\n            id: settings.id,\r\n            location_id: settings.branchId,\r\n            business_name: settings.businessName,\r\n            business_address: settings.address,\r\n            business_phone: settings.phone,\r\n            business_email: settings.email,\r\n            business_logo: settings.logo,\r\n            completed: !!settings.businessName && !!settings.phone, // Simplified completion check\r\n            is_frozen: false // Should come from branch or user status\r\n        };\r\n    } catch (error) {\r\n        console.error('Error fetching onboarding status:', error);\r\n        return null;\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MAKsB,wBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA,6DAAA"}},
    {"offset": {"line": 1433, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useBusinessSettings.ts"],"sourcesContent":["\r\nimport { useState, useEffect } from 'react';\r\nimport { useQuery } from '@tanstack/react-query';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\nimport { useAuth } from '@/components/auth/AuthProvider';\r\nimport { getBusinessSettingsAction, upsertBusinessSettingsAction } from '@/app/actions/business-settings';\r\n\r\nexport interface BusinessSettings {\r\n  id?: string;\r\n  businessName: string;\r\n  businessAddress: string;\r\n  businessPhone: string;\r\n  businessEmail: string;\r\n  businessLogo?: string;\r\n  currency: string;\r\n  signature?: string;\r\n  paymentInfo?: string;\r\n  defaultPrintFormat?: 'standard' | 'thermal';\r\n  defaultPrinterName?: string;\r\n  defaultPrinterType?: 'USB' | 'Bluetooth';\r\n  printerPaperSize?: '58mm' | '80mm';\r\n}\r\n\r\n// Utility function to parse payment info text into structured format\r\nexport const parsePaymentInfo = (paymentInfo: string): { method: string, accountNumber: string, accountName: string }[] => {\r\n  if (!paymentInfo || paymentInfo.trim() === '') {\r\n    return [];\r\n  }\r\n\r\n  const lines = paymentInfo.split('\\n').filter(line => line.trim() !== '');\r\n  const methods: { method: string, accountNumber: string, accountName: string }[] = [];\r\n\r\n  for (let i = 0; i < lines.length; i += 3) {\r\n    if (i + 2 < lines.length) {\r\n      methods.push({\r\n        method: lines[i].trim(),\r\n        accountNumber: lines[i + 1].trim(),\r\n        accountName: lines[i + 2].trim()\r\n      });\r\n    }\r\n  }\r\n\r\n  return methods;\r\n};\r\n\r\n// Utility function to convert payment methods array back to string format\r\nexport const convertPaymentMethodsToString = (paymentMethods: { method: string, accountNumber: string, accountName: string }[]): string => {\r\n  return paymentMethods\r\n    .filter(pm => pm.method.trim() !== '' || pm.accountNumber.trim() !== '' || pm.accountName.trim() !== '')\r\n    .map(pm => `${pm.method}\\n${pm.accountNumber}\\n${pm.accountName}`)\r\n    .join('\\n');\r\n};\r\n\r\n// Default settings for new businesses\r\nconst getDefaultSettings = (): BusinessSettings => ({\r\n  businessName: '',\r\n  businessAddress: '',\r\n  businessPhone: '',\r\n  businessEmail: '',\r\n  currency: 'UGX',\r\n  paymentInfo: '',\r\n  defaultPrintFormat: 'standard'\r\n});\r\n\r\nexport const useBusinessSettings = () => {\r\n  const [settings, setSettings] = useState<BusinessSettings>(getDefaultSettings());\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const { toast } = useToast();\r\n  const { currentBusiness } = useBusiness();\r\n\r\n  const loadSettings = async (): Promise<BusinessSettings> => {\r\n    if (!currentBusiness) {\r\n      return getDefaultSettings();\r\n    }\r\n\r\n    try {\r\n      const data = await getBusinessSettingsAction(currentBusiness.id);\r\n\r\n      if (data) {\r\n        // Extract payment info from metadata\r\n        const paymentInfo = data.metadata && typeof data.metadata === 'object' ?\r\n          (data.metadata as Record<string, unknown>).payment_info as string || '' : '';\r\n\r\n        return {\r\n          id: data.id,\r\n          businessName: data.business_name || '',\r\n          businessAddress: data.business_address || '',\r\n          businessPhone: data.business_phone || '',\r\n          businessEmail: data.business_email || '',\r\n          businessLogo: data.business_logo || undefined,\r\n          currency: data.currency || 'UGX',\r\n          signature: data.signature || undefined,\r\n          paymentInfo: paymentInfo,\r\n          defaultPrintFormat: data.metadata && typeof data.metadata === 'object' ?\r\n            (data.metadata as Record<string, unknown>).default_print_format as 'standard' | 'thermal' || 'standard' : 'standard',\r\n          defaultPrinterName: data.metadata && typeof data.metadata === 'object' ?\r\n            (data.metadata as Record<string, unknown>).default_printer_name as string || '' : '',\r\n          defaultPrinterType: data.metadata && typeof data.metadata === 'object' ?\r\n            (data.metadata as Record<string, unknown>).default_printer_type as 'USB' | 'Bluetooth' || 'USB' : 'USB',\r\n          printerPaperSize: data.metadata && typeof data.metadata === 'object' ?\r\n            (data.metadata as Record<string, unknown>).printer_paper_size as '58mm' | '80mm' || '58mm' : '58mm'\r\n        };\r\n      } else {\r\n        return getDefaultSettings();\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading business settings:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to load business settings. Please try again.\",\r\n        variant: \"destructive\"\r\n      });\r\n      return getDefaultSettings();\r\n    }\r\n  };\r\n\r\n  const updateSettings = async (newSettings: Partial<BusinessSettings>) => {\r\n    if (!currentBusiness) {\r\n      console.error('No business selected for updating settings');\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"No business selected\",\r\n        variant: \"destructive\"\r\n      });\r\n      return false;\r\n    }\r\n\r\n    try {\r\n      const userData = { user: { id: '00000000-0000-0000-0000-000000000000' } }; // Mocked user id for now\r\n\r\n      // Prepare the metadata object with payment info\r\n      const metadata = {\r\n        payment_info: newSettings.hasOwnProperty('paymentInfo') ? newSettings.paymentInfo : settings.paymentInfo || '',\r\n        default_print_format: newSettings.hasOwnProperty('defaultPrintFormat') ? newSettings.defaultPrintFormat : settings.defaultPrintFormat || 'standard',\r\n        default_printer_name: newSettings.hasOwnProperty('defaultPrinterName') ? newSettings.defaultPrinterName : settings.defaultPrinterName || '',\r\n        default_printer_type: newSettings.hasOwnProperty('defaultPrinterType') ? newSettings.defaultPrinterType : settings.defaultPrinterType || 'USB',\r\n        printer_paper_size: newSettings.hasOwnProperty('printerPaperSize') ? newSettings.printerPaperSize : settings.printerPaperSize || '58mm'\r\n      };\r\n\r\n      const updateData = {\r\n        business_name: newSettings.hasOwnProperty('businessName') ? newSettings.businessName : settings.businessName,\r\n        business_address: newSettings.hasOwnProperty('businessAddress') ? newSettings.businessAddress : settings.businessAddress,\r\n        business_phone: newSettings.hasOwnProperty('businessPhone') ? newSettings.businessPhone : settings.businessPhone,\r\n        business_email: newSettings.hasOwnProperty('businessEmail') ? newSettings.businessEmail : settings.businessEmail,\r\n        business_logo: newSettings.hasOwnProperty('businessLogo') ? newSettings.businessLogo : settings.businessLogo,\r\n        currency: newSettings.hasOwnProperty('currency') ? newSettings.currency : settings.currency,\r\n        signature: newSettings.hasOwnProperty('signature') ? newSettings.signature : settings.signature,\r\n        metadata: metadata\r\n      };\r\n\r\n      const response = await upsertBusinessSettingsAction(currentBusiness.id, userData.user.id, updateData);\r\n\r\n      if (!response.success) {\r\n        console.error('Supabase error updating business settings:', response.error);\r\n        throw new Error(response.error);\r\n      }\r\n\r\n      toast({\r\n        title: \"Success\",\r\n        description: \"Business settings updated successfully\"\r\n      });\r\n\r\n      // Refetch settings after update\r\n      refetch();\r\n\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error updating business settings:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to update business settings. Please try again.\",\r\n        variant: \"destructive\"\r\n      });\r\n      return false;\r\n    }\r\n  };\r\n\r\n  // React Query for settings loading with proper caching\r\n  const { data: queriedData, isLoading: isQueryLoading, isFetching, refetch } = useQuery({\r\n    queryKey: ['businessSettings', currentBusiness?.id],\r\n    queryFn: loadSettings,\r\n    enabled: !!currentBusiness?.id,\r\n    staleTime: 5 * 60_000,\r\n    gcTime: 30 * 60_000,\r\n    refetchOnWindowFocus: false,\r\n    refetchOnReconnect: false,\r\n  });\r\n\r\n  // Sync React Query data with local state\r\n  useEffect(() => {\r\n    if (queriedData) {\r\n      setSettings(queriedData);\r\n    } else if (!currentBusiness) {\r\n      setSettings(getDefaultSettings());\r\n    }\r\n  }, [queriedData, currentBusiness]);\r\n\r\n  // Sync loading state from React Query\r\n  useEffect(() => {\r\n    setIsLoading(isQueryLoading || isFetching);\r\n  }, [isQueryLoading, isFetching]);\r\n\r\n  return {\r\n    settings,\r\n    isLoading,\r\n    updateSettings,\r\n    loadSettings\r\n  };\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1622, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/utils/businessGoalTips.ts"],"sourcesContent":["\r\nexport const businessGoalTips = [\r\n  \"💡 Tip: Break your monthly goal into daily targets. Small consistent actions lead to big results!\",\r\n  \"🎯 Focus: Review your progress weekly and adjust your strategies based on what's working.\",\r\n  \"🚀 Motivation: Every successful business started with a single sale. Keep pushing forward!\",\r\n  \"📊 Strategy: Track your conversion rates to identify which sales approaches work best.\",\r\n  \"💪 Mindset: Treat every 'no' as one step closer to your next 'yes'. Persistence pays off!\",\r\n  \"🌟 Excellence: Quality over quantity - focus on building lasting customer relationships.\",\r\n  \"⏰ Efficiency: Time-block your sales activities to maximize productivity and focus.\",\r\n  \"🎉 Celebration: Acknowledge small wins along the way - they fuel motivation for bigger goals!\",\r\n  \"📈 Growth: Analyze your best-performing days and replicate those successful patterns.\",\r\n  \"🤝 Networking: Strong relationships with customers often lead to referrals and repeat business.\",\r\n  \"💼 Professionalism: Your reputation is your most valuable asset - protect and nurture it.\",\r\n  \"🔍 Analysis: Use data to guide your decisions, not just gut feelings.\",\r\n  \"🎨 Creativity: Try new approaches to reach customers and stand out from competitors.\",\r\n  \"⚡ Action: Don't wait for perfect conditions - take imperfect action and adjust as you go.\",\r\n  \"🧠 Learning: Invest time in learning about your industry, customers, and sales techniques.\",\r\n  \"🔄 Consistency: Show up daily - consistent effort compounds over time.\",\r\n  \"👂 Listening: Your customers' feedback is gold. Listen carefully and adapt accordingly.\",\r\n  \"📱 Reach: Leverage all available channels to maximize your market visibility.\",\r\n  \"🧩 Solutions: Focus on solving problems for customers rather than just selling products.\",\r\n  \"⚖️ Balance: Maintain a healthy work-life balance to prevent burnout and stay motivated.\",\r\n  \"📝 Planning: End each day by preparing your top priorities for tomorrow.\",\r\n  \"🌱 Growth: Invest in your skills - the best investment is in yourself.\",\r\n  \"🤔 Reflection: Take time to reflect on what worked and what didn't each week.\",\r\n  \"🏆 Excellence: Set standards higher than your competition to truly stand out.\",\r\n  \"📣 Voice: Develop a unique brand voice that resonates with your target audience.\",\r\n  \"📚 Knowledge: Know your products inside and out - expertise builds customer trust.\",\r\n  \"🎭 Adaptability: Stay flexible and ready to pivot when market conditions change.\",\r\n  \"🔗 Connection: Build genuine connections with customers beyond just transactions.\",\r\n  \"🌐 Expansion: Consider new markets or segments that might benefit from your offerings.\",\r\n  \"🙏 Gratitude: Express appreciation to your customers regularly - loyalty is earned.\"\r\n];\r\n\r\n/**\r\n * Returns a business goal tip based on the current date\r\n * Tips will rotate through the month, resetting each month\r\n */\r\nexport const getTodaysTip = (): string => {\r\n  const today = new Date();\r\n  const dayOfMonth = today.getDate() - 1; // 0-indexed (0-29)\r\n  const tipIndex = dayOfMonth % businessGoalTips.length;\r\n  return businessGoalTips[tipIndex];\r\n};\r\n"],"names":[],"mappings":";;;;;;AACO,MAAM,mBAAmB;IAC9B;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AAMM,MAAM,eAAe;IAC1B,MAAM,QAAQ,IAAI;IAClB,MAAM,aAAa,MAAM,OAAO,KAAK,GAAG,mBAAmB;IAC3D,MAAM,WAAW,aAAa,iBAAiB,MAAM;IACrD,OAAO,gBAAgB,CAAC,SAAS;AACnC"}},
    {"offset": {"line": 1670, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/BusinessGoalsTip.tsx"],"sourcesContent":["\r\nimport React from \"react\";\r\nimport { getTodaysTip } from \"@/utils/businessGoalTips\";\r\nimport { Lightbulb } from \"lucide-react\";\r\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from \"@/components/ui/tooltip\";\r\n\r\nconst BusinessGoalsTip = () => {\r\n  const todaysTip = getTodaysTip();\r\n\r\n  return (\r\n    <div className=\"mt-4 pt-4 border-t border-gray-200\">\r\n      <div className=\"flex items-start gap-2\">\r\n        <Lightbulb className=\"h-4 w-4 text-amber-500 mt-0.5 flex-shrink-0\" />\r\n        <div className=\"text-sm text-gray-600\">\r\n          <span className=\"font-medium text-amber-600\">Business Goals Tip:</span>{\" \"}\r\n          <span>{todaysTip}</span>\r\n          \r\n          <TooltipProvider>\r\n            <Tooltip>\r\n              <TooltipTrigger asChild>\r\n                <span className=\"ml-1 cursor-help text-gray-400 hover:text-gray-600 text-xs\">\r\n                  (New tip daily)\r\n                </span>\r\n              </TooltipTrigger>\r\n              <TooltipContent side=\"bottom\" className=\"max-w-xs\">\r\n                <p className=\"text-xs\">Tips refresh each day to help you stay motivated and reach your sales goals.</p>\r\n              </TooltipContent>\r\n            </Tooltip>\r\n          </TooltipProvider>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default BusinessGoalsTip;\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;;;;;AAEA,MAAM,mBAAmB;IACvB,MAAM,YAAY,IAAA,gJAAY;IAE9B,qBACE,8OAAC;QAAI,WAAU;kBACb,cAAA,8OAAC;YAAI,WAAU;;8BACb,8OAAC,yNAAS;oBAAC,WAAU;;;;;;8BACrB,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAK,WAAU;sCAA6B;;;;;;wBAA2B;sCACxE,8OAAC;sCAAM;;;;;;sCAEP,8OAAC,sJAAe;sCACd,cAAA,8OAAC,8IAAO;;kDACN,8OAAC,qJAAc;wCAAC,OAAO;kDACrB,cAAA,8OAAC;4CAAK,WAAU;sDAA6D;;;;;;;;;;;kDAI/E,8OAAC,qJAAc;wCAAC,MAAK;wCAAS,WAAU;kDACtC,cAAA,8OAAC;4CAAE,WAAU;sDAAU;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQvC;uCAEe"}},
    {"offset": {"line": 1783, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useFinancialVisibility.ts"],"sourcesContent":["import { useProfiles } from '@/contexts/ProfileContext';\r\n\r\n/**\r\n * Hook to handle financial data visibility based on permissions\r\n */\r\nexport const useFinancialVisibility = () => {\r\n    const { hasPermission } = useProfiles();\r\n\r\n    const canViewCostPrice = hasPermission('inventory', 'view_cost_price');\r\n    const canViewProfit = hasPermission('inventory', 'view_profit');\r\n    const canViewSellingPrice = hasPermission('inventory', 'view_selling_price');\r\n\r\n    // Dashboard-specific permissions\r\n    const canViewTotalSales = hasPermission('dashboard', 'view_total_sales');\r\n    const canViewTotalGrossProfit = hasPermission('dashboard', 'view_gross_profit');\r\n    const canViewTotalExpenses = hasPermission('dashboard', 'view_total_expenses');\r\n    const canViewInventoryValue = hasPermission('dashboard', 'view_inventory_value');\r\n    const canViewSalesTypes = hasPermission('dashboard', 'view_sales_types');\r\n    const canViewAvgPrice = hasPermission('dashboard', 'view_avg_price');\r\n    const canViewTotalAmount = hasPermission('dashboard', 'view_total_amount');\r\n\r\n    // Finance and Expenses permissions\r\n    const canManageFinanceAccounts = hasPermission('finance', 'manage_accounts');\r\n    const canViewFinance = hasPermission('finance', 'view');\r\n    const canViewExpenses = hasPermission('expenses', 'view');\r\n    const canCreateExpenses = hasPermission('expenses', 'create');\r\n    const canEditExpenses = hasPermission('expenses', 'edit');\r\n    const canDeleteExpenses = hasPermission('expenses', 'delete');\r\n\r\n    /**\r\n     * Format a financial value or return a hidden indicator\r\n     */\r\n    const formatFinancial = (value: number | null | undefined, type: 'cost' | 'selling' | 'profit'): string => {\r\n        const hasAccess =\r\n            (type === 'cost' && canViewCostPrice) ||\r\n            (type === 'selling' && canViewSellingPrice) ||\r\n            (type === 'profit' && canViewProfit);\r\n\r\n        if (!hasAccess) {\r\n            return '•••';\r\n        }\r\n\r\n        return value?.toLocaleString() || '0';\r\n    };\r\n\r\n    return {\r\n        canViewCostPrice,\r\n        canViewProfit,\r\n        canViewSellingPrice,\r\n        canViewTotalSales,\r\n        canViewTotalGrossProfit,\r\n        canViewTotalExpenses,\r\n        canViewInventoryValue,\r\n        canViewSalesTypes,\r\n        canViewAvgPrice,\r\n        canViewTotalAmount,\r\n        canManageFinanceAccounts,\r\n        canViewFinance,\r\n        canViewExpenses,\r\n        canCreateExpenses,\r\n        canEditExpenses,\r\n        canDeleteExpenses,\r\n        formatFinancial,\r\n    };\r\n};\r\n"],"names":[],"mappings":";;;;AAAA;;AAKO,MAAM,yBAAyB;IAClC,MAAM,EAAE,aAAa,EAAE,GAAG,IAAA,iJAAW;IAErC,MAAM,mBAAmB,cAAc,aAAa;IACpD,MAAM,gBAAgB,cAAc,aAAa;IACjD,MAAM,sBAAsB,cAAc,aAAa;IAEvD,iCAAiC;IACjC,MAAM,oBAAoB,cAAc,aAAa;IACrD,MAAM,0BAA0B,cAAc,aAAa;IAC3D,MAAM,uBAAuB,cAAc,aAAa;IACxD,MAAM,wBAAwB,cAAc,aAAa;IACzD,MAAM,oBAAoB,cAAc,aAAa;IACrD,MAAM,kBAAkB,cAAc,aAAa;IACnD,MAAM,qBAAqB,cAAc,aAAa;IAEtD,mCAAmC;IACnC,MAAM,2BAA2B,cAAc,WAAW;IAC1D,MAAM,iBAAiB,cAAc,WAAW;IAChD,MAAM,kBAAkB,cAAc,YAAY;IAClD,MAAM,oBAAoB,cAAc,YAAY;IACpD,MAAM,kBAAkB,cAAc,YAAY;IAClD,MAAM,oBAAoB,cAAc,YAAY;IAEpD;;KAEC,GACD,MAAM,kBAAkB,CAAC,OAAkC;QACvD,MAAM,YACF,AAAC,SAAS,UAAU,oBACnB,SAAS,aAAa,uBACtB,SAAS,YAAY;QAE1B,IAAI,CAAC,WAAW;YACZ,OAAO;QACX;QAEA,OAAO,OAAO,oBAAoB;IACtC;IAEA,OAAO;QACH;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;IACJ;AACJ"}},
    {"offset": {"line": 1842, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/app/actions/sales.ts"],"sourcesContent":["'use server';\r\n\r\nimport { db } from '../../../prisma/db';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\nexport async function getSalesAction(businessId: string, sortOrder: 'asc' | 'desc' = 'desc', pageSize?: number) {\r\n    try {\r\n        const queryOptions: any = {\r\n            where: {\r\n                branchId: businessId,\r\n            },\r\n            orderBy: {\r\n                createdAt: sortOrder,\r\n            },\r\n            include: {\r\n                cashTransaction: true,\r\n            }\r\n        };\r\n\r\n        if (pageSize && pageSize > 0) {\r\n            queryOptions.take = pageSize;\r\n        }\r\n\r\n        const sales = await db.sale.findMany(queryOptions);\r\n\r\n        // Provide default mappings to existing React components\r\n        return sales.map((item: any) => ({\r\n            id: item.id,\r\n            user_id: item.userId,\r\n            location_id: item.branchId,\r\n            receipt_number: item.saleNumber,\r\n            customer_name: item.customerName,\r\n            customer_address: item.customerAddress,\r\n            customer_contact: item.customerPhone,\r\n            customer_id: item.customerId,\r\n            items: item.items as any, // jsonb type\r\n            payment_status: item.paymentStatus,\r\n            profit: 0, // Profit not stored directly\r\n            date: item.date.toISOString(),\r\n            tax_rate: item.taxRate ? Number(item.taxRate) : 0,\r\n            created_at: item.createdAt.toISOString(),\r\n            updated_at: item.updatedAt.toISOString(),\r\n            cash_transaction_id: item.cashTransactionId,\r\n            amount_paid: Number(item.amountPaid),\r\n            amount_due: Number(item.balance),\r\n            category_id: item.categoryId,\r\n            notes: item.notes\r\n        }));\r\n    } catch (error) {\r\n        console.error('Error fetching sales:', error);\r\n        return [];\r\n    }\r\n}\r\n\r\nexport async function deleteSaleAction(id: string, businessId: string) {\r\n    try {\r\n        const sale = await db.sale.findUnique({\r\n            where: { id },\r\n            include: { cashTransaction: true, installmentPayments: true }\r\n        });\r\n\r\n        if (!sale || sale.branchId !== businessId) {\r\n            return { success: false, error: 'Sale not found or unauthorized' };\r\n        }\r\n\r\n        await db.$transaction(async (tx) => {\r\n            // Delete installments\r\n            await tx.installmentPayment.deleteMany({\r\n                where: { saleId: id }\r\n            });\r\n\r\n            // Delete associated cash transaction\r\n            if (sale.cashTransactionId) {\r\n                await tx.cashTransaction.delete({\r\n                    where: { id: sale.cashTransactionId }\r\n                });\r\n            }\r\n\r\n            // Delete the sale itself\r\n            await tx.sale.delete({\r\n                where: { id }\r\n            });\r\n        });\r\n\r\n        return {\r\n            success: true,\r\n            sale: {\r\n                receiptNumber: sale.saleNumber,\r\n                customerName: sale.customerName,\r\n                customerAddress: sale.customerAddress,\r\n                customerContact: sale.customerPhone,\r\n                paymentStatus: sale.paymentStatus,\r\n                cashTransactionId: sale.cashTransactionId,\r\n                items: sale.items as any,\r\n                amountPaid: Number(sale.amountPaid),\r\n                amountDue: Number(sale.balance),\r\n                profit: 0,\r\n                taxRate: Number(sale.taxRate),\r\n                notes: sale.notes\r\n            }\r\n        };\r\n    } catch (error: any) {\r\n        console.error('Error deleting sale:', error);\r\n        return { success: false, error: error.message || 'Failed to delete sale' };\r\n    }\r\n}\r\n\r\nexport async function upsertSaleAction(saleDbData: any, isUpdate: boolean, updateId?: string) {\r\n    try {\r\n        // Map PaymentStatus if needed\r\n        let status = saleDbData.payment_status;\r\n        if (status === 'NOT PAID') status = 'UNPAID';\r\n        else if (status === 'Installment Sale') status = 'INSTALLMENT';\r\n        else if (status === 'Paid') status = 'PAID';\r\n        else if (status === 'Quote') status = 'QUOTE';\r\n\r\n        const prismaData: any = {\r\n            userId: saleDbData.user_id,\r\n            branchId: saleDbData.location_id,\r\n            saleNumber: saleDbData.receipt_number,\r\n            customerName: saleDbData.customer_name,\r\n            customerAddress: saleDbData.customer_address,\r\n            customerPhone: saleDbData.customer_contact,\r\n            customerId: saleDbData.customer_id,\r\n            items: saleDbData.items,\r\n            paymentStatus: status,\r\n            date: new Date(saleDbData.date),\r\n            taxRate: saleDbData.tax_rate,\r\n            cashTransactionId: saleDbData.cash_transaction_id,\r\n            amountPaid: saleDbData.amount_paid,\r\n            balance: saleDbData.amount_due,\r\n            categoryId: saleDbData.category_id,\r\n            notes: saleDbData.notes,\r\n            subtotal: 0, // Placeholder\r\n            total: 0,     // Placeholder\r\n        };\r\n\r\n        if (isUpdate && updateId) {\r\n            const updated = await db.sale.update({\r\n                where: { id: updateId },\r\n                data: prismaData\r\n            });\r\n            return { success: true, data: updated };\r\n        } else {\r\n            const created = await db.sale.create({\r\n                data: prismaData\r\n            });\r\n            return { success: true, data: created };\r\n        }\r\n    } catch (error: any) {\r\n        console.error('Error upserting sale:', error);\r\n        return { success: false, error: error.message || 'Failed to preserve sale' };\r\n    }\r\n}\r\n\r\nexport async function createReceiptAction(saleData: any, businessId: string, userId: string) {\r\n    try {\r\n        let status = saleData.paymentStatus;\r\n        if (status === 'NOT PAID') status = 'UNPAID';\r\n        else if (status === 'Installment Sale') status = 'INSTALLMENT';\r\n        else if (status === 'Paid') status = 'PAID';\r\n        else if (status === 'Quote') status = 'QUOTE';\r\n\r\n        const created = await db.sale.create({\r\n            data: {\r\n                userId: userId,\r\n                branchId: businessId,\r\n                saleNumber: saleData.receiptNumber,\r\n                customerName: saleData.customerName,\r\n                customerId: saleData.customerId,\r\n                date: new Date(saleData.date),\r\n                items: saleData.items,\r\n                paymentStatus: status,\r\n                amountPaid: saleData.amountPaid || 0,\r\n                balance: saleData.amountDue || 0,\r\n                cashAccountId: saleData.cashAccountId,\r\n                notes: saleData.notes,\r\n                subtotal: 0,\r\n                total: 0,\r\n            }\r\n        });\r\n\r\n        revalidatePath('/sales');\r\n        revalidatePath('/customers');\r\n\r\n        return { success: true, data: created };\r\n    } catch (error: any) {\r\n        console.error('Error creating receipt:', error);\r\n        return { success: false, error: error.message || 'Failed to create receipt' };\r\n    }\r\n}\r\n\r\n// --- SALES CATEGORIES ---\r\n\r\nexport async function getSalesCategoriesAction(businessId: string) {\r\n    try {\r\n        const categories = await db.saleCategory.findMany({\r\n            where: { branchId: businessId },\r\n            orderBy: { name: 'asc' }\r\n        });\r\n\r\n        return { success: true, data: categories };\r\n    } catch (error: any) {\r\n        console.error('Error fetching sales categories:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\nexport async function createSalesCategoryAction(businessId: string, userId: string, name: string, isDefault: boolean = false) {\r\n    try {\r\n        const category = await db.saleCategory.create({\r\n            data: {\r\n                branchId: businessId,\r\n                userId,\r\n                name,\r\n                is_default: isDefault\r\n            }\r\n        });\r\n\r\n        revalidatePath('/sales');\r\n        return { success: true, data: category };\r\n    } catch (error: any) {\r\n        console.error('Error creating sales category:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\nexport async function updateSalesCategoryAction(id: string, name: string) {\r\n    try {\r\n        const category = await db.saleCategory.update({\r\n            where: { id },\r\n            data: { name }\r\n        });\r\n\r\n        revalidatePath('/sales');\r\n        return { success: true, data: category };\r\n    } catch (error: any) {\r\n        console.error('Error updating sales category:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\nexport async function deleteSalesCategoryAction(id: string) {\r\n    try {\r\n        await db.saleCategory.delete({\r\n            where: { id }\r\n        });\r\n\r\n        revalidatePath('/sales');\r\n        return { success: true };\r\n    } catch (error: any) {\r\n        console.error('Error deleting sales category:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\n// --- CUSTOMER LOOKUP ---\r\n\r\nexport async function getCustomerByNameAction(branchId: string, name: string) {\r\n    if (!branchId || !name) return null;\r\n    try {\r\n        const customer = await db.customer.findFirst({\r\n            where: {\r\n                branchId,\r\n                name: { contains: name, mode: 'insensitive' }\r\n            },\r\n            select: { id: true, name: true }\r\n        });\r\n        return customer;\r\n    } catch (error) {\r\n        console.error('Error looking up customer by name:', error);\r\n        return null;\r\n    }\r\n}\r\n\r\nexport async function updateSaleCustomerAction(saleId: string, customerId: string) {\r\n    try {\r\n        await db.sale.update({\r\n            where: { id: saleId },\r\n            data: { customerId }\r\n        });\r\n        return { success: true };\r\n    } catch (error: any) {\r\n        console.error('Error updating sale customer:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\n// --- SALES GOALS ---\r\n\r\nexport async function getSalesGoalAction(userId: string, branchId: string, month: number, year: number) {\r\n    try {\r\n        const goal = await db.salesGoal.findFirst({\r\n            where: { userId, branchId, period: `${year}-${String(month).padStart(2, '0')}` }\r\n        });\r\n        return { success: true, data: goal };\r\n    } catch (error: any) {\r\n        console.error('Error fetching sales goal:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\nexport async function upsertSalesGoalAction(\r\n    userId: string,\r\n    branchId: string,\r\n    month: number,\r\n    year: number,\r\n    amount: number,\r\n    existingGoalId?: string | null\r\n) {\r\n    try {\r\n        const period = `${year}-${String(month).padStart(2, '0')}`;\r\n\r\n        if (existingGoalId) {\r\n            const updated = await db.salesGoal.update({\r\n                where: { id: existingGoalId },\r\n                data: { target: amount }\r\n            });\r\n            revalidatePath('/');\r\n            return { success: true, data: updated };\r\n        } else {\r\n            const created = await db.salesGoal.create({\r\n                data: {\r\n                    userId,\r\n                    branchId,\r\n                    target: amount,\r\n                    current: 0,\r\n                    period,\r\n                    startDate: new Date(year, month - 1, 1),\r\n                    endDate: new Date(year, month, 0),\r\n                    status: 'active'\r\n                }\r\n            });\r\n            revalidatePath('/');\r\n            return { success: true, data: created };\r\n        }\r\n    } catch (error: any) {\r\n        console.error('Error upserting sales goal:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\nexport async function getPeriodSalesAction(branchId: string, startDate: Date, endDate: Date) {\r\n    try {\r\n        const sales = await db.sale.findMany({\r\n            where: {\r\n                branchId,\r\n                date: { gte: startDate, lte: endDate },\r\n                paymentStatus: { not: 'QUOTE' }\r\n            },\r\n            select: { amountPaid: true }\r\n        });\r\n\r\n        const total = sales.reduce((sum, sale) => sum + Number(sale.amountPaid || 0), 0);\r\n        return { success: true, data: total };\r\n    } catch (error: any) {\r\n        console.error('Error fetching period sales:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MAkSsB,yBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA,uDAAA"}},
    {"offset": {"line": 1856, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/app/actions/sales.ts"],"sourcesContent":["'use server';\r\n\r\nimport { db } from '../../../prisma/db';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\nexport async function getSalesAction(businessId: string, sortOrder: 'asc' | 'desc' = 'desc', pageSize?: number) {\r\n    try {\r\n        const queryOptions: any = {\r\n            where: {\r\n                branchId: businessId,\r\n            },\r\n            orderBy: {\r\n                createdAt: sortOrder,\r\n            },\r\n            include: {\r\n                cashTransaction: true,\r\n            }\r\n        };\r\n\r\n        if (pageSize && pageSize > 0) {\r\n            queryOptions.take = pageSize;\r\n        }\r\n\r\n        const sales = await db.sale.findMany(queryOptions);\r\n\r\n        // Provide default mappings to existing React components\r\n        return sales.map((item: any) => ({\r\n            id: item.id,\r\n            user_id: item.userId,\r\n            location_id: item.branchId,\r\n            receipt_number: item.saleNumber,\r\n            customer_name: item.customerName,\r\n            customer_address: item.customerAddress,\r\n            customer_contact: item.customerPhone,\r\n            customer_id: item.customerId,\r\n            items: item.items as any, // jsonb type\r\n            payment_status: item.paymentStatus,\r\n            profit: 0, // Profit not stored directly\r\n            date: item.date.toISOString(),\r\n            tax_rate: item.taxRate ? Number(item.taxRate) : 0,\r\n            created_at: item.createdAt.toISOString(),\r\n            updated_at: item.updatedAt.toISOString(),\r\n            cash_transaction_id: item.cashTransactionId,\r\n            amount_paid: Number(item.amountPaid),\r\n            amount_due: Number(item.balance),\r\n            category_id: item.categoryId,\r\n            notes: item.notes\r\n        }));\r\n    } catch (error) {\r\n        console.error('Error fetching sales:', error);\r\n        return [];\r\n    }\r\n}\r\n\r\nexport async function deleteSaleAction(id: string, businessId: string) {\r\n    try {\r\n        const sale = await db.sale.findUnique({\r\n            where: { id },\r\n            include: { cashTransaction: true, installmentPayments: true }\r\n        });\r\n\r\n        if (!sale || sale.branchId !== businessId) {\r\n            return { success: false, error: 'Sale not found or unauthorized' };\r\n        }\r\n\r\n        await db.$transaction(async (tx) => {\r\n            // Delete installments\r\n            await tx.installmentPayment.deleteMany({\r\n                where: { saleId: id }\r\n            });\r\n\r\n            // Delete associated cash transaction\r\n            if (sale.cashTransactionId) {\r\n                await tx.cashTransaction.delete({\r\n                    where: { id: sale.cashTransactionId }\r\n                });\r\n            }\r\n\r\n            // Delete the sale itself\r\n            await tx.sale.delete({\r\n                where: { id }\r\n            });\r\n        });\r\n\r\n        return {\r\n            success: true,\r\n            sale: {\r\n                receiptNumber: sale.saleNumber,\r\n                customerName: sale.customerName,\r\n                customerAddress: sale.customerAddress,\r\n                customerContact: sale.customerPhone,\r\n                paymentStatus: sale.paymentStatus,\r\n                cashTransactionId: sale.cashTransactionId,\r\n                items: sale.items as any,\r\n                amountPaid: Number(sale.amountPaid),\r\n                amountDue: Number(sale.balance),\r\n                profit: 0,\r\n                taxRate: Number(sale.taxRate),\r\n                notes: sale.notes\r\n            }\r\n        };\r\n    } catch (error: any) {\r\n        console.error('Error deleting sale:', error);\r\n        return { success: false, error: error.message || 'Failed to delete sale' };\r\n    }\r\n}\r\n\r\nexport async function upsertSaleAction(saleDbData: any, isUpdate: boolean, updateId?: string) {\r\n    try {\r\n        // Map PaymentStatus if needed\r\n        let status = saleDbData.payment_status;\r\n        if (status === 'NOT PAID') status = 'UNPAID';\r\n        else if (status === 'Installment Sale') status = 'INSTALLMENT';\r\n        else if (status === 'Paid') status = 'PAID';\r\n        else if (status === 'Quote') status = 'QUOTE';\r\n\r\n        const prismaData: any = {\r\n            userId: saleDbData.user_id,\r\n            branchId: saleDbData.location_id,\r\n            saleNumber: saleDbData.receipt_number,\r\n            customerName: saleDbData.customer_name,\r\n            customerAddress: saleDbData.customer_address,\r\n            customerPhone: saleDbData.customer_contact,\r\n            customerId: saleDbData.customer_id,\r\n            items: saleDbData.items,\r\n            paymentStatus: status,\r\n            date: new Date(saleDbData.date),\r\n            taxRate: saleDbData.tax_rate,\r\n            cashTransactionId: saleDbData.cash_transaction_id,\r\n            amountPaid: saleDbData.amount_paid,\r\n            balance: saleDbData.amount_due,\r\n            categoryId: saleDbData.category_id,\r\n            notes: saleDbData.notes,\r\n            subtotal: 0, // Placeholder\r\n            total: 0,     // Placeholder\r\n        };\r\n\r\n        if (isUpdate && updateId) {\r\n            const updated = await db.sale.update({\r\n                where: { id: updateId },\r\n                data: prismaData\r\n            });\r\n            return { success: true, data: updated };\r\n        } else {\r\n            const created = await db.sale.create({\r\n                data: prismaData\r\n            });\r\n            return { success: true, data: created };\r\n        }\r\n    } catch (error: any) {\r\n        console.error('Error upserting sale:', error);\r\n        return { success: false, error: error.message || 'Failed to preserve sale' };\r\n    }\r\n}\r\n\r\nexport async function createReceiptAction(saleData: any, businessId: string, userId: string) {\r\n    try {\r\n        let status = saleData.paymentStatus;\r\n        if (status === 'NOT PAID') status = 'UNPAID';\r\n        else if (status === 'Installment Sale') status = 'INSTALLMENT';\r\n        else if (status === 'Paid') status = 'PAID';\r\n        else if (status === 'Quote') status = 'QUOTE';\r\n\r\n        const created = await db.sale.create({\r\n            data: {\r\n                userId: userId,\r\n                branchId: businessId,\r\n                saleNumber: saleData.receiptNumber,\r\n                customerName: saleData.customerName,\r\n                customerId: saleData.customerId,\r\n                date: new Date(saleData.date),\r\n                items: saleData.items,\r\n                paymentStatus: status,\r\n                amountPaid: saleData.amountPaid || 0,\r\n                balance: saleData.amountDue || 0,\r\n                cashAccountId: saleData.cashAccountId,\r\n                notes: saleData.notes,\r\n                subtotal: 0,\r\n                total: 0,\r\n            }\r\n        });\r\n\r\n        revalidatePath('/sales');\r\n        revalidatePath('/customers');\r\n\r\n        return { success: true, data: created };\r\n    } catch (error: any) {\r\n        console.error('Error creating receipt:', error);\r\n        return { success: false, error: error.message || 'Failed to create receipt' };\r\n    }\r\n}\r\n\r\n// --- SALES CATEGORIES ---\r\n\r\nexport async function getSalesCategoriesAction(businessId: string) {\r\n    try {\r\n        const categories = await db.saleCategory.findMany({\r\n            where: { branchId: businessId },\r\n            orderBy: { name: 'asc' }\r\n        });\r\n\r\n        return { success: true, data: categories };\r\n    } catch (error: any) {\r\n        console.error('Error fetching sales categories:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\nexport async function createSalesCategoryAction(businessId: string, userId: string, name: string, isDefault: boolean = false) {\r\n    try {\r\n        const category = await db.saleCategory.create({\r\n            data: {\r\n                branchId: businessId,\r\n                userId,\r\n                name,\r\n                is_default: isDefault\r\n            }\r\n        });\r\n\r\n        revalidatePath('/sales');\r\n        return { success: true, data: category };\r\n    } catch (error: any) {\r\n        console.error('Error creating sales category:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\nexport async function updateSalesCategoryAction(id: string, name: string) {\r\n    try {\r\n        const category = await db.saleCategory.update({\r\n            where: { id },\r\n            data: { name }\r\n        });\r\n\r\n        revalidatePath('/sales');\r\n        return { success: true, data: category };\r\n    } catch (error: any) {\r\n        console.error('Error updating sales category:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\nexport async function deleteSalesCategoryAction(id: string) {\r\n    try {\r\n        await db.saleCategory.delete({\r\n            where: { id }\r\n        });\r\n\r\n        revalidatePath('/sales');\r\n        return { success: true };\r\n    } catch (error: any) {\r\n        console.error('Error deleting sales category:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\n// --- CUSTOMER LOOKUP ---\r\n\r\nexport async function getCustomerByNameAction(branchId: string, name: string) {\r\n    if (!branchId || !name) return null;\r\n    try {\r\n        const customer = await db.customer.findFirst({\r\n            where: {\r\n                branchId,\r\n                name: { contains: name, mode: 'insensitive' }\r\n            },\r\n            select: { id: true, name: true }\r\n        });\r\n        return customer;\r\n    } catch (error) {\r\n        console.error('Error looking up customer by name:', error);\r\n        return null;\r\n    }\r\n}\r\n\r\nexport async function updateSaleCustomerAction(saleId: string, customerId: string) {\r\n    try {\r\n        await db.sale.update({\r\n            where: { id: saleId },\r\n            data: { customerId }\r\n        });\r\n        return { success: true };\r\n    } catch (error: any) {\r\n        console.error('Error updating sale customer:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\n// --- SALES GOALS ---\r\n\r\nexport async function getSalesGoalAction(userId: string, branchId: string, month: number, year: number) {\r\n    try {\r\n        const goal = await db.salesGoal.findFirst({\r\n            where: { userId, branchId, period: `${year}-${String(month).padStart(2, '0')}` }\r\n        });\r\n        return { success: true, data: goal };\r\n    } catch (error: any) {\r\n        console.error('Error fetching sales goal:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\nexport async function upsertSalesGoalAction(\r\n    userId: string,\r\n    branchId: string,\r\n    month: number,\r\n    year: number,\r\n    amount: number,\r\n    existingGoalId?: string | null\r\n) {\r\n    try {\r\n        const period = `${year}-${String(month).padStart(2, '0')}`;\r\n\r\n        if (existingGoalId) {\r\n            const updated = await db.salesGoal.update({\r\n                where: { id: existingGoalId },\r\n                data: { target: amount }\r\n            });\r\n            revalidatePath('/');\r\n            return { success: true, data: updated };\r\n        } else {\r\n            const created = await db.salesGoal.create({\r\n                data: {\r\n                    userId,\r\n                    branchId,\r\n                    target: amount,\r\n                    current: 0,\r\n                    period,\r\n                    startDate: new Date(year, month - 1, 1),\r\n                    endDate: new Date(year, month, 0),\r\n                    status: 'active'\r\n                }\r\n            });\r\n            revalidatePath('/');\r\n            return { success: true, data: created };\r\n        }\r\n    } catch (error: any) {\r\n        console.error('Error upserting sales goal:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\nexport async function getPeriodSalesAction(branchId: string, startDate: Date, endDate: Date) {\r\n    try {\r\n        const sales = await db.sale.findMany({\r\n            where: {\r\n                branchId,\r\n                date: { gte: startDate, lte: endDate },\r\n                paymentStatus: { not: 'QUOTE' }\r\n            },\r\n            select: { amountPaid: true }\r\n        });\r\n\r\n        const total = sales.reduce((sum, sale) => sum + Number(sale.amountPaid || 0), 0);\r\n        return { success: true, data: total };\r\n    } catch (error: any) {\r\n        console.error('Error fetching period sales:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MA8SsB,yBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA,0DAAA"}},
    {"offset": {"line": 1870, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/app/actions/sales.ts"],"sourcesContent":["'use server';\r\n\r\nimport { db } from '../../../prisma/db';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\nexport async function getSalesAction(businessId: string, sortOrder: 'asc' | 'desc' = 'desc', pageSize?: number) {\r\n    try {\r\n        const queryOptions: any = {\r\n            where: {\r\n                branchId: businessId,\r\n            },\r\n            orderBy: {\r\n                createdAt: sortOrder,\r\n            },\r\n            include: {\r\n                cashTransaction: true,\r\n            }\r\n        };\r\n\r\n        if (pageSize && pageSize > 0) {\r\n            queryOptions.take = pageSize;\r\n        }\r\n\r\n        const sales = await db.sale.findMany(queryOptions);\r\n\r\n        // Provide default mappings to existing React components\r\n        return sales.map((item: any) => ({\r\n            id: item.id,\r\n            user_id: item.userId,\r\n            location_id: item.branchId,\r\n            receipt_number: item.saleNumber,\r\n            customer_name: item.customerName,\r\n            customer_address: item.customerAddress,\r\n            customer_contact: item.customerPhone,\r\n            customer_id: item.customerId,\r\n            items: item.items as any, // jsonb type\r\n            payment_status: item.paymentStatus,\r\n            profit: 0, // Profit not stored directly\r\n            date: item.date.toISOString(),\r\n            tax_rate: item.taxRate ? Number(item.taxRate) : 0,\r\n            created_at: item.createdAt.toISOString(),\r\n            updated_at: item.updatedAt.toISOString(),\r\n            cash_transaction_id: item.cashTransactionId,\r\n            amount_paid: Number(item.amountPaid),\r\n            amount_due: Number(item.balance),\r\n            category_id: item.categoryId,\r\n            notes: item.notes\r\n        }));\r\n    } catch (error) {\r\n        console.error('Error fetching sales:', error);\r\n        return [];\r\n    }\r\n}\r\n\r\nexport async function deleteSaleAction(id: string, businessId: string) {\r\n    try {\r\n        const sale = await db.sale.findUnique({\r\n            where: { id },\r\n            include: { cashTransaction: true, installmentPayments: true }\r\n        });\r\n\r\n        if (!sale || sale.branchId !== businessId) {\r\n            return { success: false, error: 'Sale not found or unauthorized' };\r\n        }\r\n\r\n        await db.$transaction(async (tx) => {\r\n            // Delete installments\r\n            await tx.installmentPayment.deleteMany({\r\n                where: { saleId: id }\r\n            });\r\n\r\n            // Delete associated cash transaction\r\n            if (sale.cashTransactionId) {\r\n                await tx.cashTransaction.delete({\r\n                    where: { id: sale.cashTransactionId }\r\n                });\r\n            }\r\n\r\n            // Delete the sale itself\r\n            await tx.sale.delete({\r\n                where: { id }\r\n            });\r\n        });\r\n\r\n        return {\r\n            success: true,\r\n            sale: {\r\n                receiptNumber: sale.saleNumber,\r\n                customerName: sale.customerName,\r\n                customerAddress: sale.customerAddress,\r\n                customerContact: sale.customerPhone,\r\n                paymentStatus: sale.paymentStatus,\r\n                cashTransactionId: sale.cashTransactionId,\r\n                items: sale.items as any,\r\n                amountPaid: Number(sale.amountPaid),\r\n                amountDue: Number(sale.balance),\r\n                profit: 0,\r\n                taxRate: Number(sale.taxRate),\r\n                notes: sale.notes\r\n            }\r\n        };\r\n    } catch (error: any) {\r\n        console.error('Error deleting sale:', error);\r\n        return { success: false, error: error.message || 'Failed to delete sale' };\r\n    }\r\n}\r\n\r\nexport async function upsertSaleAction(saleDbData: any, isUpdate: boolean, updateId?: string) {\r\n    try {\r\n        // Map PaymentStatus if needed\r\n        let status = saleDbData.payment_status;\r\n        if (status === 'NOT PAID') status = 'UNPAID';\r\n        else if (status === 'Installment Sale') status = 'INSTALLMENT';\r\n        else if (status === 'Paid') status = 'PAID';\r\n        else if (status === 'Quote') status = 'QUOTE';\r\n\r\n        const prismaData: any = {\r\n            userId: saleDbData.user_id,\r\n            branchId: saleDbData.location_id,\r\n            saleNumber: saleDbData.receipt_number,\r\n            customerName: saleDbData.customer_name,\r\n            customerAddress: saleDbData.customer_address,\r\n            customerPhone: saleDbData.customer_contact,\r\n            customerId: saleDbData.customer_id,\r\n            items: saleDbData.items,\r\n            paymentStatus: status,\r\n            date: new Date(saleDbData.date),\r\n            taxRate: saleDbData.tax_rate,\r\n            cashTransactionId: saleDbData.cash_transaction_id,\r\n            amountPaid: saleDbData.amount_paid,\r\n            balance: saleDbData.amount_due,\r\n            categoryId: saleDbData.category_id,\r\n            notes: saleDbData.notes,\r\n            subtotal: 0, // Placeholder\r\n            total: 0,     // Placeholder\r\n        };\r\n\r\n        if (isUpdate && updateId) {\r\n            const updated = await db.sale.update({\r\n                where: { id: updateId },\r\n                data: prismaData\r\n            });\r\n            return { success: true, data: updated };\r\n        } else {\r\n            const created = await db.sale.create({\r\n                data: prismaData\r\n            });\r\n            return { success: true, data: created };\r\n        }\r\n    } catch (error: any) {\r\n        console.error('Error upserting sale:', error);\r\n        return { success: false, error: error.message || 'Failed to preserve sale' };\r\n    }\r\n}\r\n\r\nexport async function createReceiptAction(saleData: any, businessId: string, userId: string) {\r\n    try {\r\n        let status = saleData.paymentStatus;\r\n        if (status === 'NOT PAID') status = 'UNPAID';\r\n        else if (status === 'Installment Sale') status = 'INSTALLMENT';\r\n        else if (status === 'Paid') status = 'PAID';\r\n        else if (status === 'Quote') status = 'QUOTE';\r\n\r\n        const created = await db.sale.create({\r\n            data: {\r\n                userId: userId,\r\n                branchId: businessId,\r\n                saleNumber: saleData.receiptNumber,\r\n                customerName: saleData.customerName,\r\n                customerId: saleData.customerId,\r\n                date: new Date(saleData.date),\r\n                items: saleData.items,\r\n                paymentStatus: status,\r\n                amountPaid: saleData.amountPaid || 0,\r\n                balance: saleData.amountDue || 0,\r\n                cashAccountId: saleData.cashAccountId,\r\n                notes: saleData.notes,\r\n                subtotal: 0,\r\n                total: 0,\r\n            }\r\n        });\r\n\r\n        revalidatePath('/sales');\r\n        revalidatePath('/customers');\r\n\r\n        return { success: true, data: created };\r\n    } catch (error: any) {\r\n        console.error('Error creating receipt:', error);\r\n        return { success: false, error: error.message || 'Failed to create receipt' };\r\n    }\r\n}\r\n\r\n// --- SALES CATEGORIES ---\r\n\r\nexport async function getSalesCategoriesAction(businessId: string) {\r\n    try {\r\n        const categories = await db.saleCategory.findMany({\r\n            where: { branchId: businessId },\r\n            orderBy: { name: 'asc' }\r\n        });\r\n\r\n        return { success: true, data: categories };\r\n    } catch (error: any) {\r\n        console.error('Error fetching sales categories:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\nexport async function createSalesCategoryAction(businessId: string, userId: string, name: string, isDefault: boolean = false) {\r\n    try {\r\n        const category = await db.saleCategory.create({\r\n            data: {\r\n                branchId: businessId,\r\n                userId,\r\n                name,\r\n                is_default: isDefault\r\n            }\r\n        });\r\n\r\n        revalidatePath('/sales');\r\n        return { success: true, data: category };\r\n    } catch (error: any) {\r\n        console.error('Error creating sales category:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\nexport async function updateSalesCategoryAction(id: string, name: string) {\r\n    try {\r\n        const category = await db.saleCategory.update({\r\n            where: { id },\r\n            data: { name }\r\n        });\r\n\r\n        revalidatePath('/sales');\r\n        return { success: true, data: category };\r\n    } catch (error: any) {\r\n        console.error('Error updating sales category:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\nexport async function deleteSalesCategoryAction(id: string) {\r\n    try {\r\n        await db.saleCategory.delete({\r\n            where: { id }\r\n        });\r\n\r\n        revalidatePath('/sales');\r\n        return { success: true };\r\n    } catch (error: any) {\r\n        console.error('Error deleting sales category:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\n// --- CUSTOMER LOOKUP ---\r\n\r\nexport async function getCustomerByNameAction(branchId: string, name: string) {\r\n    if (!branchId || !name) return null;\r\n    try {\r\n        const customer = await db.customer.findFirst({\r\n            where: {\r\n                branchId,\r\n                name: { contains: name, mode: 'insensitive' }\r\n            },\r\n            select: { id: true, name: true }\r\n        });\r\n        return customer;\r\n    } catch (error) {\r\n        console.error('Error looking up customer by name:', error);\r\n        return null;\r\n    }\r\n}\r\n\r\nexport async function updateSaleCustomerAction(saleId: string, customerId: string) {\r\n    try {\r\n        await db.sale.update({\r\n            where: { id: saleId },\r\n            data: { customerId }\r\n        });\r\n        return { success: true };\r\n    } catch (error: any) {\r\n        console.error('Error updating sale customer:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\n// --- SALES GOALS ---\r\n\r\nexport async function getSalesGoalAction(userId: string, branchId: string, month: number, year: number) {\r\n    try {\r\n        const goal = await db.salesGoal.findFirst({\r\n            where: { userId, branchId, period: `${year}-${String(month).padStart(2, '0')}` }\r\n        });\r\n        return { success: true, data: goal };\r\n    } catch (error: any) {\r\n        console.error('Error fetching sales goal:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\nexport async function upsertSalesGoalAction(\r\n    userId: string,\r\n    branchId: string,\r\n    month: number,\r\n    year: number,\r\n    amount: number,\r\n    existingGoalId?: string | null\r\n) {\r\n    try {\r\n        const period = `${year}-${String(month).padStart(2, '0')}`;\r\n\r\n        if (existingGoalId) {\r\n            const updated = await db.salesGoal.update({\r\n                where: { id: existingGoalId },\r\n                data: { target: amount }\r\n            });\r\n            revalidatePath('/');\r\n            return { success: true, data: updated };\r\n        } else {\r\n            const created = await db.salesGoal.create({\r\n                data: {\r\n                    userId,\r\n                    branchId,\r\n                    target: amount,\r\n                    current: 0,\r\n                    period,\r\n                    startDate: new Date(year, month - 1, 1),\r\n                    endDate: new Date(year, month, 0),\r\n                    status: 'active'\r\n                }\r\n            });\r\n            revalidatePath('/');\r\n            return { success: true, data: created };\r\n        }\r\n    } catch (error: any) {\r\n        console.error('Error upserting sales goal:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\nexport async function getPeriodSalesAction(branchId: string, startDate: Date, endDate: Date) {\r\n    try {\r\n        const sales = await db.sale.findMany({\r\n            where: {\r\n                branchId,\r\n                date: { gte: startDate, lte: endDate },\r\n                paymentStatus: { not: 'QUOTE' }\r\n            },\r\n            select: { amountPaid: true }\r\n        });\r\n\r\n        const total = sales.reduce((sum, sale) => sum + Number(sale.amountPaid || 0), 0);\r\n        return { success: true, data: total };\r\n    } catch (error: any) {\r\n        console.error('Error fetching period sales:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MAsVsB,yBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA,yDAAA"}},
    {"offset": {"line": 1884, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/SalesGoalTracker.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useState, useEffect, useMemo } from \"react\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Progress } from \"@/components/ui/progress\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\r\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport { useAuth } from \"@/components/auth/AuthProvider\";\r\nimport { useBusiness } from \"@/contexts/BusinessContext\";\r\nimport { useBusinessSettings } from \"@/hooks/useBusinessSettings\";\r\nimport { toast } from \"sonner\";\r\nimport { startOfDay, endOfDay, startOfWeek, endOfWeek, startOfMonth, endOfMonth, format } from \"date-fns\";\r\nimport BusinessGoalsTip from \"@/components/BusinessGoalsTip\";\r\nimport { useFinancialVisibility } from \"@/hooks/useFinancialVisibility\";\r\nimport {\r\n  getSalesGoalAction,\r\n  upsertSalesGoalAction,\r\n  getPeriodSalesAction,\r\n} from \"@/app/actions/sales\";\r\n\r\ntype GoalType = 'daily' | 'weekly' | 'monthly';\r\n\r\ninterface GoalContentProps {\r\n  goalType: GoalType;\r\n  isLoading: boolean;\r\n  currentGoal: number;\r\n  currentSales: number;\r\n  progress: number;\r\n  periodLabel: string;\r\n  formatCurrency: (amount: number) => string;\r\n  goalInput: string;\r\n  onGoalInputChange: (e: React.ChangeEvent<HTMLInputElement>) => void;\r\n  onUpdateGoal: () => void;\r\n  isUpdating: boolean;\r\n  canViewTotalSales?: boolean;\r\n}\r\n\r\nconst GoalContent = React.memo<GoalContentProps>(({\r\n  goalType,\r\n  isLoading,\r\n  currentGoal,\r\n  currentSales,\r\n  progress,\r\n  periodLabel,\r\n  formatCurrency,\r\n  goalInput,\r\n  onGoalInputChange,\r\n  onUpdateGoal,\r\n  isUpdating,\r\n  canViewTotalSales = true\r\n}) => <div className=\"space-y-4\">\r\n    <div className=\"text-sm text-muted-foreground\">{periodLabel}</div>\r\n\r\n    {isLoading ? <div className=\"text-center py-4\">\r\n      <p className=\"text-muted-foreground\">Loading sales data...</p>\r\n    </div> : <>\r\n      <div className=\"flex items-center justify-between\">\r\n        <span className=\"text-sm font-medium\">{goalType.charAt(0).toUpperCase() + goalType.slice(1)} Goal</span>\r\n        <span className=\"text-sm font-bold\">{canViewTotalSales ? formatCurrency(currentGoal) : '•••'}</span>\r\n      </div>\r\n\r\n      <div className=\"flex items-center justify-between\">\r\n        <span className=\"text-sm font-medium\">Current Sales</span>\r\n        <span className=\"text-sm font-bold\">{canViewTotalSales ? formatCurrency(currentSales || 0) : '•••'}</span>\r\n      </div>\r\n\r\n      <div className=\"space-y-2\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <span className=\"text-sm font-medium\">Progress</span>\r\n          <span className=\"text-sm font-bold\">{progress.toFixed(1)}%</span>\r\n        </div>\r\n        <Progress value={progress} className=\"h-2\" />\r\n      </div>\r\n\r\n      <div className=\"space-y-2\">\r\n        <div className=\"flex gap-2\">\r\n          <Input key={`${goalType}-input`} type=\"number\" placeholder={`Enter ${goalType} goal amount`} value={goalInput} onChange={onGoalInputChange} min=\"0\" step=\"0.01\" className=\"flex-1\" />\r\n          <Button onClick={onUpdateGoal} disabled={isUpdating || !goalInput.trim()}>\r\n            {isUpdating ? \"Updating...\" : \"Set Goal\"}\r\n          </Button>\r\n        </div>\r\n      </div>\r\n\r\n      {currentGoal > 0 && <div className=\"text-xs text-muted-foreground\">\r\n        {currentSales >= currentGoal ? <span className=\"text-green-600 font-medium\">🎉 Goal achieved!</span> : <span>\r\n          {canViewTotalSales ? `${formatCurrency(currentGoal - (currentSales || 0))} remaining to reach goal` : '••• remaining'}\r\n        </span>}\r\n      </div>}\r\n    </>}\r\n  </div>);\r\n\r\nGoalContent.displayName = 'GoalContent';\r\n\r\nconst SalesGoalTracker = () => {\r\n  const { user } = useAuth();\r\n  const { currentBusiness } = useBusiness();\r\n  const { settings } = useBusinessSettings();\r\n  const { canViewTotalSales } = useFinancialVisibility();\r\n  const queryClient = useQueryClient();\r\n\r\n  const [currentDate] = useState(() => new Date());\r\n  const currentMonth = currentDate.getMonth() + 1;\r\n  const currentYear = currentDate.getFullYear();\r\n  const [goalInput, setGoalInput] = useState(\"\");\r\n  const [selectedGoalType, setSelectedGoalType] = useState<GoalType>('monthly');\r\n\r\n  useEffect(() => {\r\n    setGoalInput(\"\");\r\n  }, [currentBusiness?.id]);\r\n\r\n  // Fetch current sales goal\r\n  const { data: salesGoal, isLoading: goalLoading } = useQuery({\r\n    queryKey: [\"sales-goal\", user?.id, currentBusiness?.id, currentMonth, currentYear],\r\n    queryFn: async () => {\r\n      if (!user?.id || !currentBusiness?.id) return null;\r\n      const result = await getSalesGoalAction(user.id, currentBusiness.id, currentMonth, currentYear);\r\n      if (!result.success) throw new Error(result.error);\r\n      return result.data;\r\n    },\r\n    enabled: !!user?.id && !!currentBusiness?.id,\r\n    staleTime: 30000,\r\n  });\r\n\r\n  // Fetch current period sales\r\n  const { data: currentSales, isLoading: salesLoading } = useQuery({\r\n    queryKey: [\"current-period-sales\", currentBusiness?.id, selectedGoalType, currentMonth, currentYear],\r\n    queryFn: async () => {\r\n      if (!currentBusiness?.id) return 0;\r\n\r\n      let startDate: Date, endDate: Date;\r\n      switch (selectedGoalType) {\r\n        case 'daily':\r\n          startDate = startOfDay(currentDate);\r\n          endDate = endOfDay(currentDate);\r\n          break;\r\n        case 'weekly':\r\n          startDate = startOfWeek(currentDate, { weekStartsOn: 1 });\r\n          endDate = endOfWeek(currentDate, { weekStartsOn: 1 });\r\n          break;\r\n        case 'monthly':\r\n        default:\r\n          startDate = startOfMonth(currentDate);\r\n          endDate = endOfMonth(currentDate);\r\n          break;\r\n      }\r\n\r\n      const result = await getPeriodSalesAction(currentBusiness.id, startDate, endDate);\r\n      if (!result.success) throw new Error(result.error);\r\n      return result.data ?? 0;\r\n    },\r\n    enabled: !!currentBusiness?.id,\r\n    staleTime: 30000,\r\n  });\r\n\r\n  // Update sales goal mutation\r\n  const updateGoalMutation = useMutation({\r\n    mutationFn: async ({ amount }: { amount: number }) => {\r\n      if (!user?.id || !currentBusiness?.id) throw new Error(\"User or location not available\");\r\n      const result = await upsertSalesGoalAction(\r\n        user.id,\r\n        currentBusiness.id,\r\n        currentMonth,\r\n        currentYear,\r\n        amount,\r\n        salesGoal?.id ?? null\r\n      );\r\n      if (!result.success) throw new Error(result.error);\r\n      return result.data;\r\n    },\r\n    onSuccess: () => {\r\n      toast.success(`${selectedGoalType.charAt(0).toUpperCase() + selectedGoalType.slice(1)} goal updated successfully!`);\r\n      queryClient.invalidateQueries({ queryKey: [\"sales-goal\", user?.id, currentBusiness?.id, currentMonth, currentYear] });\r\n      queryClient.invalidateQueries({ queryKey: [\"current-period-sales\", currentBusiness?.id, selectedGoalType, currentMonth, currentYear] });\r\n      setGoalInput(\"\");\r\n    },\r\n    onError: (error: any) => {\r\n      console.error(\"Failed to update sales goal:\", error);\r\n      toast.error(error.message || \"Failed to update sales goal. Please try again.\");\r\n    }\r\n  });\r\n\r\n  const handleGoalInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const value = e.target.value;\r\n    if (value === \"\" || /^\\d*\\.?\\d*$/.test(value)) {\r\n      setGoalInput(value);\r\n    }\r\n  };\r\n\r\n  const handleUpdateGoal = () => {\r\n    const goal = parseFloat(goalInput);\r\n    if (isNaN(goal) || goal < 0) {\r\n      toast.error(\"Please enter a valid goal amount\");\r\n      return;\r\n    }\r\n    updateGoalMutation.mutate({ amount: goal });\r\n  };\r\n\r\n  const handleTabChange = (value: string) => {\r\n    setSelectedGoalType(value as GoalType);\r\n  };\r\n\r\n  const currentGoal = Number(salesGoal?.target ?? 0);\r\n  const progress = useMemo(\r\n    () => currentGoal > 0 ? Math.min(((currentSales ?? 0) / currentGoal) * 100, 100) : 0,\r\n    [currentGoal, currentSales]\r\n  );\r\n  const isLoading = goalLoading || salesLoading;\r\n\r\n  const periodLabel = useMemo(() => {\r\n    switch (selectedGoalType) {\r\n      case 'daily': return format(currentDate, 'MMMM d, yyyy');\r\n      case 'weekly': return `Week of ${format(startOfWeek(currentDate, { weekStartsOn: 1 }), 'MMM d')}`;\r\n      case 'monthly': return format(currentDate, 'MMMM yyyy');\r\n      default: return '';\r\n    }\r\n  }, [selectedGoalType, currentDate]);\r\n\r\n  const formatCurrency = useMemo(() => (amount: number) => {\r\n    return new Intl.NumberFormat('en-US', {\r\n      style: 'currency',\r\n      currency: settings?.currency || 'USD',\r\n      minimumFractionDigits: 0,\r\n      maximumFractionDigits: 2,\r\n    }).format(amount);\r\n  }, [settings?.currency]);\r\n\r\n  if (!user || !currentBusiness) {\r\n    return <Card>\r\n      <CardHeader>\r\n        <CardTitle>Sales Goal Tracker</CardTitle>\r\n      </CardHeader>\r\n      <CardContent>\r\n        <p className=\"text-muted-foreground\">Please select a business location to track sales goals.</p>\r\n      </CardContent>\r\n    </Card>;\r\n  }\r\n\r\n  return <Card>\r\n    <CardHeader>\r\n      <CardTitle>Gonza Sales Goal Tracker</CardTitle>\r\n      <div className=\"text-sm text-muted-foreground\">\r\n        Business: {currentBusiness.name}\r\n      </div>\r\n    </CardHeader>\r\n    <CardContent>\r\n      <Tabs value={selectedGoalType} onValueChange={handleTabChange}>\r\n        <TabsList className=\"grid w-full grid-cols-3\">\r\n          <TabsTrigger value=\"daily\">Daily</TabsTrigger>\r\n          <TabsTrigger value=\"weekly\">Weekly</TabsTrigger>\r\n          <TabsTrigger value=\"monthly\">Monthly</TabsTrigger>\r\n        </TabsList>\r\n\r\n        <TabsContent value=\"daily\">\r\n          <GoalContent goalType=\"daily\" isLoading={isLoading} currentGoal={currentGoal} currentSales={currentSales ?? 0} progress={progress} periodLabel={periodLabel} formatCurrency={formatCurrency} goalInput={goalInput} onGoalInputChange={handleGoalInputChange} onUpdateGoal={handleUpdateGoal} isUpdating={updateGoalMutation.isPending} canViewTotalSales={canViewTotalSales} />\r\n        </TabsContent>\r\n\r\n        <TabsContent value=\"weekly\">\r\n          <GoalContent goalType=\"weekly\" isLoading={isLoading} currentGoal={currentGoal} currentSales={currentSales ?? 0} progress={progress} periodLabel={periodLabel} formatCurrency={formatCurrency} goalInput={goalInput} onGoalInputChange={handleGoalInputChange} onUpdateGoal={handleUpdateGoal} isUpdating={updateGoalMutation.isPending} canViewTotalSales={canViewTotalSales} />\r\n        </TabsContent>\r\n\r\n        <TabsContent value=\"monthly\">\r\n          <GoalContent goalType=\"monthly\" isLoading={isLoading} currentGoal={currentGoal} currentSales={currentSales ?? 0} progress={progress} periodLabel={periodLabel} formatCurrency={formatCurrency} goalInput={goalInput} onGoalInputChange={handleGoalInputChange} onUpdateGoal={handleUpdateGoal} isUpdating={updateGoalMutation.isPending} canViewTotalSales={canViewTotalSales} />\r\n        </TabsContent>\r\n      </Tabs>\r\n\r\n      <BusinessGoalsTip />\r\n    </CardContent>\r\n  </Card>;\r\n};\r\n\r\nexport default SalesGoalTracker;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2491, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/analytics/RecentSalesTable.tsx"],"sourcesContent":["\r\nimport React from 'react';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Sale } from '@/types';\r\nimport { formatNumber } from '@/lib/utils';\r\nimport { useIsMobile } from '@/hooks/use-mobile';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport {\r\n  Tooltip,\r\n  TooltipContent,\r\n  TooltipProvider,\r\n  TooltipTrigger,\r\n} from \"@/components/ui/tooltip\";\r\nimport { useFinancialVisibility } from '@/hooks/useFinancialVisibility';\r\n\r\ninterface RecentSalesTableProps {\r\n  recentSales: Sale[];\r\n  currency: string;\r\n}\r\n\r\nconst RecentSalesTable: React.FC<RecentSalesTableProps> = ({ recentSales, currency }) => {\r\n  const isMobile = useIsMobile();\r\n  const navigate = useNavigate();\r\n  const {\r\n    canViewCostPrice,\r\n    canViewProfit,\r\n    canViewAvgPrice,\r\n    canViewTotalAmount\r\n  } = useFinancialVisibility();\r\n\r\n  const handleSaleClick = (sale: Sale) => {\r\n    navigate('/new-sale', {\r\n      state: {\r\n        editSale: sale\r\n      }\r\n    });\r\n  };\r\n\r\n  if (recentSales.length === 0) {\r\n    return (\r\n      <Card>\r\n        <CardHeader className={isMobile ? 'p-4' : ''}>\r\n          <CardTitle className={isMobile ? 'text-lg' : ''}>Recent Sales</CardTitle>\r\n          <CardDescription className={isMobile ? 'text-xs' : ''}>Your latest transactions</CardDescription>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"py-12 text-center\">\r\n            <p className=\"text-muted-foreground\">No recent sales</p>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    );\r\n  }\r\n\r\n  // For mobile view, render cards instead of a table\r\n  if (isMobile) {\r\n    return (\r\n      <Card>\r\n        <CardHeader className=\"p-4\">\r\n          <CardTitle className=\"text-lg\">Recent Sales</CardTitle>\r\n          <CardDescription className=\"text-xs\">Your latest transactions</CardDescription>\r\n        </CardHeader>\r\n        <CardContent className=\"p-4 pt-0\">\r\n          <div className=\"space-y-3\">\r\n            {recentSales.map((sale) => {\r\n              // Calculate subtotal from items with discount considerations\r\n              const subtotal = sale.items.reduce((total, item) => {\r\n                const itemSubtotal = item.price * item.quantity;\r\n                const discountAmount = (itemSubtotal * (item.discountPercentage || 0)) / 100;\r\n                return total + (itemSubtotal - discountAmount);\r\n              }, 0);\r\n\r\n              // Calculate total discount amount\r\n              const totalDiscount = sale.items.reduce((total, item) => {\r\n                const itemSubtotal = item.price * item.quantity;\r\n                const discountAmount = (itemSubtotal * (item.discountPercentage || 0)) / 100;\r\n                return total + discountAmount;\r\n              }, 0);\r\n\r\n              // Calculate tax amount based on subtotal and tax rate\r\n              const taxRate = sale.taxRate || 0;\r\n              const taxAmount = subtotal * (taxRate / 100);\r\n\r\n              // Total including tax\r\n              const saleTotal = subtotal + taxAmount;\r\n\r\n              // Calculate total cost for the sale\r\n              const totalCost = sale.items && Array.isArray(sale.items)\r\n                ? sale.items.reduce((sum, item) => sum + (item.cost * item.quantity), 0)\r\n                : 0;\r\n\r\n              // Get primary item description (or combination)\r\n              let itemDescription = \"No items\";\r\n              if (sale.items && Array.isArray(sale.items) && sale.items.length > 0) {\r\n                itemDescription = sale.items[0].description;\r\n                if (sale.items.length > 1) {\r\n                  itemDescription += ` (+${sale.items.length - 1} more)`;\r\n                }\r\n              }\r\n\r\n              return (\r\n                <div\r\n                  key={sale.id}\r\n                  className=\"bg-white p-4 rounded-lg border border-gray-200 shadow-sm cursor-pointer hover:shadow-md transition-shadow\"\r\n                  onClick={() => handleSaleClick(sale)}\r\n                >\r\n                  <div className=\"flex justify-between items-start mb-3\">\r\n                    <div className=\"flex-1 min-w-0\">\r\n                      <p className=\"font-semibold text-gray-900 text-base truncate\">{sale.customerName}</p>\r\n                      <Tooltip>\r\n                        <TooltipTrigger asChild>\r\n                          <p className=\"text-sm text-gray-600 mt-1 line-clamp-1 cursor-help\">\r\n                            {itemDescription}\r\n                          </p>\r\n                        </TooltipTrigger>\r\n                        <TooltipContent side=\"top\" className=\"max-w-xs\">\r\n                          <div className=\"space-y-1\">\r\n                            <p className=\"font-bold break-words whitespace-normal\">{itemDescription}</p>\r\n                          </div>\r\n                        </TooltipContent>\r\n                      </Tooltip>\r\n                    </div>\r\n                    <span\r\n                      className={`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium whitespace-nowrap ml-2 ${sale.paymentStatus === 'Paid'\r\n                        ? 'bg-green-100 text-green-800'\r\n                        : sale.paymentStatus === 'Quote'\r\n                          ? 'bg-purple-100 text-purple-800'\r\n                          : sale.paymentStatus === 'Installment Sale'\r\n                            ? 'bg-blue-100 text-blue-800'\r\n                            : 'bg-yellow-100 text-yellow-800'\r\n                        }`}\r\n                    >\r\n                      {sale.paymentStatus === 'NOT PAID' ? 'Credit' :\r\n                        sale.paymentStatus === 'Installment Sale' ? 'Installment' :\r\n                          sale.paymentStatus}\r\n                    </span>\r\n                  </div>\r\n\r\n                  {/* Financial data in organized grid */}\r\n                  <div className=\"grid grid-cols-2 gap-4 py-3 bg-gray-50 rounded-lg mb-3\">\r\n                    <div className=\"text-center border-r border-gray-200\">\r\n                      <p className=\"text-xs text-gray-500 mb-1\">Cost</p>\r\n                      <p className=\"text-sm font-semibold text-gray-900\">\r\n                        {canViewCostPrice ? `${currency} ${formatNumber(totalCost)}` : '•••'}\r\n                      </p>\r\n                    </div>\r\n                    <div className=\"text-center\">\r\n                      <p className=\"text-xs text-gray-500 mb-1\">Discount</p>\r\n                      <p className={`text-sm font-semibold ${totalDiscount > 0 ? 'text-orange-600' : 'text-gray-400'}`}>\r\n                        {totalDiscount > 0 ? `-${currency} ${formatNumber(totalDiscount)}` : '-'}\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div className=\"grid grid-cols-2 gap-4 py-3 bg-gray-50 rounded-lg\">\r\n                    <div className=\"text-center border-r border-gray-200\">\r\n                      <p className=\"text-xs text-gray-500 mb-1\">Avg Price</p>\r\n                      <p className=\"text-sm font-semibold text-gray-900\">\r\n                        {canViewAvgPrice ? `${currency} ${formatNumber(saleTotal / sale.items.reduce((total, item) => total + item.quantity, 0))}` : '•••'}\r\n                      </p>\r\n                    </div>\r\n                    <div className=\"text-center\">\r\n                      <p className=\"text-xs text-gray-500 mb-1\">Total Amount</p>\r\n                      <p className=\"text-sm font-semibold text-gray-900\">\r\n                        {canViewTotalAmount ? `${currency} ${formatNumber(saleTotal)}` : '•••'}\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Profit and date row */}\r\n                  <div className=\"flex justify-between items-center mt-3 pt-2 border-t border-gray-100\">\r\n                    <div className=\"text-left\">\r\n                      <p className=\"text-xs text-gray-500\">Profit</p>\r\n                      <p className=\"text-sm font-semibold text-green-600\">\r\n                        {canViewProfit ? `${currency} ${formatNumber(saleTotal - totalCost)}` : '•••'}\r\n                      </p>\r\n                    </div>\r\n                    <div className=\"text-right\">\r\n                      <p className=\"text-xs text-gray-500\">\r\n                        {new Date(sale.date).toLocaleDateString('en-GB')}\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              );\r\n            })}\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    );\r\n  }\r\n\r\n  // Desktop view with table\r\n  return (\r\n    <TooltipProvider>\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle>Recent Sales</CardTitle>\r\n          <CardDescription>Your latest 20 transactions</CardDescription>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"overflow-x-auto\">\r\n            <table className=\"w-full text-sm\">\r\n              <thead>\r\n                <tr className=\"border-b\">\r\n                  <th className=\"py-3 text-left\">Date</th>\r\n                  <th className=\"py-3 text-left\">Receipt #</th>\r\n                  <th className=\"py-3 text-left\">Customer</th>\r\n                  <th className=\"py-3 text-left\">Item</th>\r\n                  <th className=\"py-3 text-right\">Total Qty</th>\r\n                  <th className=\"py-3 text-right\">Avg Price</th>\r\n                  <th className=\"py-3 text-right\">Discount</th>\r\n                  {canViewCostPrice && <th className=\"py-3 text-right\">Cost</th>}\r\n                  {canViewProfit && <th className=\"py-3 text-right\">Profit</th>}\r\n                  <th className=\"py-3 text-right\">Total (incl. Tax)</th>\r\n                  <th className=\"py-3 text-left\">Status</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {recentSales.map((sale) => {\r\n                  // Calculate total quantity\r\n                  const totalQuantity = sale.items.reduce((total, item) => total + item.quantity, 0);\r\n                  // Calculate subtotal from items with discount considerations\r\n                  const subtotal = sale.items.reduce((total, item) => {\r\n                    const itemSubtotal = item.price * item.quantity;\r\n                    const discountAmount = (itemSubtotal * (item.discountPercentage || 0)) / 100;\r\n                    return total + (itemSubtotal - discountAmount);\r\n                  }, 0);\r\n\r\n                  const averagePrice = totalQuantity > 0 ? subtotal / totalQuantity : 0;\r\n\r\n                  // Calculate total discount amount\r\n                  const totalDiscount = sale.items.reduce((total, item) => {\r\n                    const itemSubtotal = item.price * item.quantity;\r\n                    const discountAmount = (itemSubtotal * (item.discountPercentage || 0)) / 100;\r\n                    return total + discountAmount;\r\n                  }, 0);\r\n\r\n                  // Calculate tax amount based on subtotal and tax rate\r\n                  const taxRate = sale.taxRate || 0;\r\n                  const taxAmount = subtotal * (taxRate / 100);\r\n\r\n                  // Total including tax\r\n                  const saleTotal = subtotal + taxAmount;\r\n\r\n                  // Calculate total cost\r\n                  const totalCost = sale.items.reduce((total, item) => total + (item.cost * item.quantity), 0);\r\n\r\n                  // Get primary item description (or combination)\r\n                  let itemDescription = \"No items\";\r\n                  if (sale.items && Array.isArray(sale.items) && sale.items.length > 0) {\r\n                    itemDescription = sale.items[0].description;\r\n                    if (sale.items.length > 1) {\r\n                      itemDescription += ` (+${sale.items.length - 1} more)`;\r\n                    }\r\n                  }\r\n\r\n                  return (\r\n                    <tr\r\n                      key={sale.id}\r\n                      className=\"border-b cursor-pointer hover:bg-gray-50\"\r\n                      onClick={() => handleSaleClick(sale)}\r\n                    >\r\n                      <td className=\"py-3\">\r\n                        {new Date(sale.date).toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' })}\r\n                      </td>\r\n                      <td className=\"py-3\">{sale.receiptNumber}</td>\r\n                      <td className=\"py-3\">{sale.customerName}</td>\r\n                      <td className=\"py-3 max-w-xs truncate\">\r\n                        <Tooltip>\r\n                          <TooltipTrigger asChild>\r\n                            <span className=\"cursor-help\">{itemDescription}</span>\r\n                          </TooltipTrigger>\r\n                          <TooltipContent side=\"top\" className=\"max-w-xs\">\r\n                            <div className=\"space-y-1\">\r\n                              <p className=\"font-bold break-words whitespace-normal\">{itemDescription}</p>\r\n                            </div>\r\n                          </TooltipContent>\r\n                        </Tooltip>\r\n                      </td>\r\n                      <td className=\"py-3 text-right\">{totalQuantity}</td>\r\n                      <td className=\"py-3 text-right\">\r\n                        {canViewAvgPrice ? `${currency} ${formatNumber(averagePrice)}` : '•••'}\r\n                      </td>\r\n                      <td className=\"py-3 text-right\">\r\n                        {totalDiscount > 0 ? (\r\n                          <span className=\"text-orange-600\">\r\n                            -{currency} {formatNumber(totalDiscount)}\r\n                          </span>\r\n                        ) : (\r\n                          <span className=\"text-gray-400\">-</span>\r\n                        )}\r\n                      </td>\r\n                      {canViewCostPrice && (\r\n                        <td className=\"py-3 text-right\">\r\n                          {currency} {formatNumber(totalCost)}\r\n                        </td>\r\n                      )}\r\n                      {canViewProfit && (\r\n                        <td className=\"py-3 text-right\">\r\n                          <span className=\"text-green-600 font-medium\">\r\n                            {currency} {formatNumber(saleTotal - totalCost)}\r\n                          </span>\r\n                        </td>\r\n                      )}\r\n                      <td className=\"py-3 text-right\">\r\n                        {canViewTotalAmount ? (\r\n                          <>\r\n                            {currency} {formatNumber(saleTotal)}\r\n                            {sale.paymentStatus === 'Installment Sale' && sale.amountPaid && (\r\n                              <div className=\"text-xs text-green-600\">\r\n                                Paid: {currency} {formatNumber(sale.amountPaid)}\r\n                              </div>\r\n                            )}\r\n                          </>\r\n                        ) : '•••'}\r\n                      </td>\r\n                      <td className=\"py-3\">\r\n                        <span\r\n                          className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${sale.paymentStatus === 'Paid'\r\n                            ? 'bg-green-100 text-green-800'\r\n                            : sale.paymentStatus === 'Quote'\r\n                              ? 'bg-purple-100 text-purple-800'\r\n                              : sale.paymentStatus === 'Installment Sale'\r\n                                ? 'bg-blue-100 text-blue-800'\r\n                                : 'bg-yellow-100 text-yellow-800'\r\n                            }`}\r\n                        >\r\n                          {sale.paymentStatus === 'NOT PAID' ? 'Credit' :\r\n                            sale.paymentStatus === 'Installment Sale' ? 'Installment' :\r\n                              sale.paymentStatus}\r\n                        </span>\r\n                      </td>\r\n                    </tr>\r\n                  )\r\n                })}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    </TooltipProvider>\r\n  );\r\n};\r\n\r\nexport default RecentSalesTable;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3325, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/app/actions/expenses.ts"],"sourcesContent":["'use server';\r\n\r\nimport { db } from '../../../prisma/db';\r\n\r\nexport async function getExpensesForChartAction(\r\n    branchId: string,\r\n    from?: string,\r\n    to?: string\r\n): Promise<{ date: string; amount: number }[]> {\r\n    try {\r\n        const where: any = { branchId };\r\n        if (from || to) {\r\n            where.date = {};\r\n            if (from) where.date.gte = new Date(from);\r\n            if (to) where.date.lte = new Date(to);\r\n        }\r\n        const expenses = await db.expense.findMany({\r\n            where,\r\n            select: { date: true, amount: true },\r\n        });\r\n        return expenses.map((e: any) => ({\r\n            date: e.date.toISOString(),\r\n            amount: Number(e.amount),\r\n        }));\r\n    } catch (error) {\r\n        console.error('[getExpensesForChartAction]', error);\r\n        return [];\r\n    }\r\n}\r\n\r\nexport async function getBusinessBackupDataAction(userId: string, branchId: string) {\r\n    try {\r\n        const [\r\n            products,\r\n            categories,\r\n            stockHistory,\r\n            sales,\r\n            customers,\r\n            expenses,\r\n            expenseCategories,\r\n            tasks,\r\n            taskCategories,\r\n            carriageInwards,\r\n        ] = await Promise.all([\r\n            db.product.findMany({ where: { branchId } }),\r\n            db.category.findMany({ where: { branchId } }),\r\n            db.productHistory.findMany({ where: { locationId: branchId } }),\r\n            db.sale.findMany({ where: { branchId } }),\r\n            db.customer.findMany({ where: { branchId } }),\r\n            db.expense.findMany({ where: { branchId } }),\r\n            db.expenseCategory.findMany({ where: { branchId } }),\r\n            db.task.findMany({ where: { branchId } }),\r\n            db.taskCategory.findMany({ where: { branchId } }),\r\n            db.carriageInward.findMany({ where: { branchId } }),\r\n        ]);\r\n\r\n        return {\r\n            success: true,\r\n            data: {\r\n                products,\r\n                product_categories: categories,\r\n                stock_history: stockHistory,\r\n                sales,\r\n                customers,\r\n                expenses,\r\n                expense_categories: expenseCategories,\r\n                tasks,\r\n                task_categories: taskCategories,\r\n                carriage_inwards: carriageInwards,\r\n            },\r\n        };\r\n    } catch (error: any) {\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\nexport async function createSubscriptionPaymentAction(\r\n    purchaseId: string,\r\n    userId: string,\r\n    branchId: string,\r\n    amount: number,\r\n    billingCycle: string\r\n) {\r\n    try {\r\n        // Use a raw query or custom model if subscription_payments is not in Prisma schema\r\n        // For now, log and return – implement when schema supports it\r\n        console.log('[createSubscriptionPaymentAction] Payment record:', { purchaseId, userId, branchId, amount, billingCycle });\r\n        return { success: true };\r\n    } catch (error: any) {\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\nexport async function getLatestSubscriptionPaymentAction(userId: string) {\r\n    try {\r\n        // Return null if subscription_payments table isn't in Prisma schema yet\r\n        return { success: true, data: null };\r\n    } catch (error: any) {\r\n        return { success: false, data: null, error: error.message };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MAIsB,wBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA,6DAAA"}},
    {"offset": {"line": 3339, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/analytics/SalesPerformanceChart.tsx"],"sourcesContent":["\r\nimport React, { useState, useEffect } from 'react';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Tabs, TabsList, TabsTrigger } from '@/components/ui/tabs';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport {\r\n  LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer\r\n} from 'recharts';\r\nimport { Lock as LockIcon, ChartLine } from 'lucide-react';\r\nimport { Sale } from '@/types';\r\nimport {\r\n  format, startOfWeek, endOfWeek, startOfMonth, endOfMonth,\r\n  startOfYear, endOfYear, subDays, subWeeks, subMonths, startOfDay, endOfDay\r\n} from 'date-fns';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\nimport { useFinancialVisibility } from '@/hooks/useFinancialVisibility';\r\nimport { getExpensesForChartAction } from '@/app/actions/expenses';\r\n\r\ninterface SalesPerformanceChartProps {\r\n  sales: Sale[];\r\n  formatCurrency: (value: any) => string;\r\n  dateFilter?: string;\r\n  dateRange?: { from: Date | undefined; to: Date | undefined };\r\n  isCustomRange?: boolean;\r\n}\r\n\r\ninterface DataPoint {\r\n  date: string;\r\n  displayDate: string;\r\n  amount: number;\r\n  expenses: number;\r\n  rawDate: Date;\r\n}\r\n\r\nconst SalesPerformanceChart: React.FC<SalesPerformanceChartProps> = ({\r\n  sales,\r\n  formatCurrency,\r\n  dateFilter = 'this-month',\r\n  dateRange = { from: undefined, to: undefined },\r\n  isCustomRange = false,\r\n}) => {\r\n  const { currentBusiness } = useBusiness();\r\n  const { canViewTotalSales, canViewTotalExpenses } = useFinancialVisibility();\r\n  const [timeFrame, setTimeFrame] = useState('monthly');\r\n  const [yearFilter, setYearFilter] = useState(new Date().getFullYear().toString());\r\n  const [expensesData, setExpensesData] = useState<{ date: string; amount: number }[]>([]);\r\n\r\n  const currentYear = new Date().getFullYear();\r\n  const years = [\r\n    ...new Set(sales.map(s => new Date(s.date).getFullYear()))\r\n  ].sort((a, b) => b - a);\r\n  if (years.length === 0) years.push(currentYear);\r\n\r\n  const getFilteredSales = () => {\r\n    const nonQuote = sales.filter(s => s.paymentStatus !== 'Quote');\r\n    if (isCustomRange && dateRange.from && dateRange.to) {\r\n      return nonQuote.filter(s => {\r\n        const d = new Date(s.date);\r\n        return d >= startOfDay(dateRange.from!) && d <= endOfDay(dateRange.to!);\r\n      });\r\n    }\r\n    if (dateFilter && dateFilter !== 'all' && dateFilter !== 'this-month') {\r\n      const today = new Date();\r\n      return nonQuote.filter(s => {\r\n        const d = new Date(s.date);\r\n        switch (dateFilter) {\r\n          case 'today': return d >= startOfDay(today) && d <= endOfDay(today);\r\n          case 'yesterday': { const y = subDays(today, 1); return d >= startOfDay(y) && d <= endOfDay(y); }\r\n          case 'this-week': return d >= startOfWeek(today, { weekStartsOn: 1 }) && d <= endOfWeek(today, { weekStartsOn: 1 });\r\n          case 'last-week': { const lws = subWeeks(startOfWeek(today, { weekStartsOn: 1 }), 1); return d >= lws && d <= endOfWeek(lws, { weekStartsOn: 1 }); }\r\n          case 'last-month': { const lm = subMonths(today, 1); return d >= startOfMonth(lm) && d <= endOfMonth(lm); }\r\n          case 'this-year': return d >= startOfYear(today) && d <= endOfYear(today);\r\n          default: return true;\r\n        }\r\n      });\r\n    }\r\n    return nonQuote.filter(s => new Date(s.date).getFullYear() === parseInt(yearFilter));\r\n  };\r\n\r\n  useEffect(() => {\r\n    const fetchExpenses = async () => {\r\n      if (!currentBusiness?.id) { setExpensesData([]); return; }\r\n\r\n      let from: string | undefined;\r\n      let to: string | undefined;\r\n\r\n      if (isCustomRange && dateRange.from && dateRange.to) {\r\n        from = dateRange.from.toISOString();\r\n        to = dateRange.to.toISOString();\r\n      } else if (dateFilter && dateFilter !== 'all' && dateFilter !== 'this-month') {\r\n        const today = new Date();\r\n        switch (dateFilter) {\r\n          case 'today': from = startOfDay(today).toISOString(); to = endOfDay(today).toISOString(); break;\r\n          case 'yesterday': { const y = subDays(today, 1); from = startOfDay(y).toISOString(); to = endOfDay(y).toISOString(); break; }\r\n          case 'this-week': from = startOfWeek(today, { weekStartsOn: 1 }).toISOString(); to = endOfWeek(today, { weekStartsOn: 1 }).toISOString(); break;\r\n          case 'last-week': { const lws = subWeeks(startOfWeek(today, { weekStartsOn: 1 }), 1); from = lws.toISOString(); to = endOfWeek(lws, { weekStartsOn: 1 }).toISOString(); break; }\r\n          case 'last-month': { const lm = subMonths(today, 1); from = startOfMonth(lm).toISOString(); to = endOfMonth(lm).toISOString(); break; }\r\n          case 'this-year': from = startOfYear(today).toISOString(); to = endOfYear(today).toISOString(); break;\r\n          default: { const yr = parseInt(yearFilter); from = new Date(yr, 0, 1).toISOString(); to = new Date(yr, 11, 31).toISOString(); }\r\n        }\r\n      } else {\r\n        const yr = parseInt(yearFilter);\r\n        from = new Date(yr, 0, 1).toISOString();\r\n        to = new Date(yr, 11, 31).toISOString();\r\n      }\r\n\r\n      try {\r\n        const result = await getExpensesForChartAction(currentBusiness.id, from, to);\r\n        setExpensesData(result || []);\r\n      } catch (e) {\r\n        console.error('Error fetching expenses data:', e);\r\n      }\r\n    };\r\n    fetchExpenses();\r\n  }, [timeFrame, yearFilter, dateFilter, dateRange, isCustomRange, currentBusiness?.id]);\r\n\r\n  const salesTotal = (arr: Sale[]) =>\r\n    arr.reduce((sum, s) => sum + (Array.isArray(s.items) ? (s.items as any[]).reduce((a: number, i: any) => a + i.price * i.quantity, 0) : 0), 0);\r\n  const expTotal = (arr: { date: string; amount: number }[]) =>\r\n    arr.reduce((sum, e) => sum + Number(e.amount), 0);\r\n\r\n  const prepareChartData = (): DataPoint[] => {\r\n    const filtered = getFilteredSales();\r\n\r\n    if (timeFrame === 'weekly') {\r\n      const ws = startOfWeek(new Date(), { weekStartsOn: 1 });\r\n      return Array.from({ length: 7 }, (_, i) => {\r\n        const day = new Date(ws); day.setDate(ws.getDate() + i);\r\n        const ds = day.toDateString();\r\n        return {\r\n          date: format(day, 'yyyy-MM-dd'), displayDate: format(day, 'EEE'),\r\n          amount: salesTotal(filtered.filter(s => new Date(s.date).toDateString() === ds)),\r\n          expenses: expTotal(expensesData.filter(e => new Date(e.date).toDateString() === ds)),\r\n          rawDate: day,\r\n        };\r\n      });\r\n    }\r\n\r\n    if (timeFrame === 'monthly') {\r\n      const yr = parseInt(yearFilter);\r\n      return Array.from({ length: 12 }, (_, month) => {\r\n        const d = new Date(yr, month, 1);\r\n        const ms = startOfMonth(d), me = endOfMonth(d);\r\n        return {\r\n          date: format(d, 'yyyy-MM'), displayDate: format(d, 'MMM'),\r\n          amount: salesTotal(filtered.filter(s => { const sd = new Date(s.date); return sd >= ms && sd <= me; })),\r\n          expenses: expTotal(expensesData.filter(e => { const ed = new Date(e.date); return ed >= ms && ed <= me; })),\r\n          rawDate: d,\r\n        };\r\n      });\r\n    }\r\n\r\n    if (timeFrame === 'yearly') {\r\n      return years.map(year => {\r\n        const ys = startOfYear(new Date(year, 0, 1)), ye = endOfYear(new Date(year, 0, 1));\r\n        return {\r\n          date: year.toString(), displayDate: year.toString(),\r\n          amount: salesTotal(filtered.filter(s => { const sd = new Date(s.date); return sd >= ys && sd <= ye; })),\r\n          expenses: expTotal(expensesData.filter(e => { const ed = new Date(e.date); return ed >= ys && ed <= ye; })),\r\n          rawDate: new Date(year, 0, 1),\r\n        };\r\n      });\r\n    }\r\n\r\n    return [];\r\n  };\r\n\r\n  const chartData = prepareChartData();\r\n\r\n  const CustomTooltip = ({ active, payload }: any) => {\r\n    if (!active || !payload?.length) return null;\r\n    const dp = payload[0].payload;\r\n    return (\r\n      <div className=\"bg-white p-3 border border-gray-200 shadow-sm rounded-md\">\r\n        <p className=\"font-medium text-sm\">{dp.displayDate}</p>\r\n        {payload.map((entry: any, i: number) => (\r\n          <p key={i} className=\"text-sm\">\r\n            <span className=\"font-medium\">{entry.name}: </span>{formatCurrency(entry.value)}\r\n          </p>\r\n        ))}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <Card className=\"mb-6\">\r\n      <CardHeader>\r\n        <div className=\"flex items-center justify-between\">\r\n          <div>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <ChartLine className=\"h-5 w-5\" /> Performance Analysis\r\n            </CardTitle>\r\n            <CardDescription>Visualize your sales and expenses over time</CardDescription>\r\n          </div>\r\n          <Select value={yearFilter} onValueChange={setYearFilter}>\r\n            <SelectTrigger className=\"w-[100px]\"><SelectValue placeholder=\"Year\" /></SelectTrigger>\r\n            <SelectContent>\r\n              {years.map(yr => <SelectItem key={yr} value={yr.toString()}>{yr}</SelectItem>)}\r\n            </SelectContent>\r\n          </Select>\r\n        </div>\r\n      </CardHeader>\r\n      <CardContent>\r\n        <Tabs defaultValue=\"monthly\" value={timeFrame} onValueChange={setTimeFrame} className=\"w-full\">\r\n          <TabsList className=\"mb-4\">\r\n            <TabsTrigger value=\"weekly\">Weekly</TabsTrigger>\r\n            <TabsTrigger value=\"monthly\">Monthly</TabsTrigger>\r\n            <TabsTrigger value=\"yearly\">Yearly</TabsTrigger>\r\n          </TabsList>\r\n          <div className=\"h-[300px] w-full\">\r\n            {(!canViewTotalSales && !canViewTotalExpenses) ? (\r\n              <div className=\"flex flex-col items-center justify-center h-full text-muted-foreground space-y-2\">\r\n                <LockIcon className=\"h-8 w-8 opacity-20\" />\r\n                <p>Private data restricted</p>\r\n              </div>\r\n            ) : chartData.length > 0 ? (\r\n              <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                <LineChart data={chartData} margin={{ top: 20, right: 20, left: 30, bottom: 20 }}>\r\n                  <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#f0f0f0\" />\r\n                  <XAxis dataKey=\"displayDate\" tick={{ fontSize: 12 }} tickLine={false} axisLine={{ stroke: '#e0e0e0' }} />\r\n                  <YAxis tickFormatter={formatCurrency} tick={{ fontSize: 12 }} tickLine={false} axisLine={{ stroke: '#e0e0e0' }} width={80} />\r\n                  <Tooltip content={<CustomTooltip />} />\r\n                  <Legend />\r\n                  {canViewTotalSales && (\r\n                    <Line type=\"monotone\" dataKey=\"amount\" name=\"Sales\" stroke=\"#9b87f5\" activeDot={{ r: 8 }} strokeWidth={2} />\r\n                  )}\r\n                  {canViewTotalExpenses && (\r\n                    <Line type=\"monotone\" dataKey=\"expenses\" name=\"Expenses\" stroke=\"#E76F51\" activeDot={{ r: 6 }} strokeWidth={2} />\r\n                  )}\r\n                </LineChart>\r\n              </ResponsiveContainer>\r\n            ) : (\r\n              <div className=\"flex items-center justify-center h-full text-muted-foreground\">\r\n                No data available for this time period\r\n              </div>\r\n            )}\r\n          </div>\r\n        </Tabs>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default SalesPerformanceChart;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3929, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/app/actions/products.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { db } from '../../../prisma/db';\r\nimport { Product, ProductFormData, mapDbProductToProduct, mapProductToDbProduct } from '@/types';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\n// We implement server actions for the products here\r\n\r\nexport async function getProductsAction({\r\n  userId,\r\n  businessId,\r\n  page,\r\n  pageSize,\r\n  search,\r\n  category,\r\n  stockStatus,\r\n}: {\r\n  userId: string;\r\n  businessId: string;\r\n  page: number;\r\n  pageSize: number;\r\n  search?: string;\r\n  category?: string;\r\n  stockStatus?: 'inStock' | 'outOfStock' | 'lowStock' | 'all';\r\n}) {\r\n  if (!userId || !businessId) return { products: [], count: 0 };\r\n\r\n  const skip = (page - 1) * pageSize;\r\n  const take = pageSize;\r\n\r\n  let whereClause: any = {\r\n    userId: userId,\r\n    branchId: businessId,\r\n  };\r\n\r\n  if (search) {\r\n    whereClause.OR = [\r\n      { name: { contains: search, mode: 'insensitive' } },\r\n      { description: { contains: search, mode: 'insensitive' } },\r\n      { sku: { contains: search, mode: 'insensitive' } },\r\n      { barcode: { contains: search, mode: 'insensitive' } },\r\n    ];\r\n  }\r\n\r\n  if (category) {\r\n    whereClause.category = { name: category };\r\n  }\r\n\r\n  if (stockStatus === 'outOfStock') {\r\n    whereClause.stock = 0;\r\n  } else if (stockStatus === 'inStock') {\r\n    whereClause.stock = { gt: 0 };\r\n  } else if (stockStatus === 'lowStock') {\r\n    // Handling lowStock is complex because minStock is compared locally or using direct SQL in Prisma\r\n    // For now, we will handle it with Prisma's raw query or by filtering in memory if necessary\r\n    // Fortunately, since PRISMA 5.0, column comparison still needs raw queries or we can fetch and filter if small\r\n    // Here we'll fetch them all if lowStock is enabled, or add a generated column. \r\n    // We will do a basic fetch and filter later if needed.\r\n  }\r\n\r\n  try {\r\n    const [productsData, totalCount] = await Promise.all([\r\n      db.product.findMany({\r\n        where: whereClause,\r\n        skip,\r\n        take,\r\n        orderBy: [{ createdAt: 'desc' }, { id: 'desc' }],\r\n        include: {\r\n          category: true,\r\n          supplier: true,\r\n        }\r\n      }),\r\n      db.product.count({ where: whereClause })\r\n    ]);\r\n\r\n    // Map the Prisma product model back to the application's Product type\r\n    let formattedProducts = productsData.map((p: any) => {\r\n      // Assuming mapping exists, we will map it\r\n      return {\r\n        id: p.id,\r\n        name: p.name,\r\n        description: p.description || '',\r\n        category: p.category?.name || 'Uncategorized',\r\n        quantity: p.stock,\r\n        costPrice: p.costPrice,\r\n        sellingPrice: p.sellingPrice,\r\n        supplier: p.supplier?.name,\r\n        imageUrl: p.image,\r\n        barcode: p.barcode,\r\n        itemNumber: p.sku || '',\r\n        minimumStock: p.minStock,\r\n        createdAt: p.createdAt,\r\n      };\r\n    });\r\n\r\n    if (stockStatus === 'lowStock') {\r\n      formattedProducts = formattedProducts.filter((p: any) => p.quantity > 0 && p.quantity <= p.minimumStock);\r\n    }\r\n\r\n    return { products: formattedProducts as any[], count: totalCount };\r\n  } catch (error) {\r\n    console.error('Error fetching products from DB:', error);\r\n    return { products: [], count: 0 };\r\n  }\r\n}\r\n\r\nexport async function getAllProductsAction(userId: string, businessId: string) {\r\n  if (!userId || !businessId) return [];\r\n\r\n  try {\r\n    const productsData = await db.product.findMany({\r\n      where: {\r\n        userId: userId,\r\n        branchId: businessId,\r\n      },\r\n      orderBy: [{ createdAt: 'desc' }, { id: 'desc' }],\r\n      include: {\r\n        category: true,\r\n        supplier: true,\r\n      }\r\n    });\r\n\r\n    return productsData.map((p: any) => ({\r\n      id: p.id,\r\n      name: p.name,\r\n      description: p.description || '',\r\n      category: p.category?.name || 'Uncategorized',\r\n      quantity: Number(p.stock),\r\n      costPrice: Number(p.costPrice),\r\n      sellingPrice: Number(p.sellingPrice),\r\n      supplier: p.supplier?.name,\r\n      imageUrl: p.image,\r\n      barcode: p.barcode,\r\n      itemNumber: p.sku || '',\r\n      minimumStock: Number(p.minStock),\r\n      createdAt: p.createdAt,\r\n    }));\r\n  } catch (error) {\r\n    console.error('Error fetching all products from DB:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\nexport async function getProductsByIdsAction(ids: string[], businessId?: string) {\r\n  try {\r\n    const where: any = {\r\n      id: { in: ids }\r\n    };\r\n    if (businessId) {\r\n      where.branchId = businessId;\r\n    }\r\n\r\n    const products = await db.product.findMany({\r\n      where,\r\n      include: {\r\n        category: true,\r\n        supplier: true,\r\n      }\r\n    });\r\n\r\n    return products.map((p: any) => ({\r\n      id: p.id,\r\n      name: p.name,\r\n      description: p.description || '',\r\n      category: p.category?.name || 'Uncategorized',\r\n      quantity: p.stock,\r\n      costPrice: p.costPrice,\r\n      sellingPrice: p.sellingPrice,\r\n      supplier: p.supplier?.name,\r\n      imageUrl: p.image,\r\n      barcode: p.barcode,\r\n      itemNumber: p.sku || '',\r\n      minimumStock: p.minStock,\r\n      createdAt: p.createdAt,\r\n    }));\r\n  } catch (error) {\r\n    console.error('Error fetching products by ids:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\nexport async function createProductAction(data: any) {\r\n  try {\r\n    const result = await db.$transaction(async (tx: any) => {\r\n      // 1. Generate next SKU/itemNumber for this branch\r\n      const lastProduct = await tx.product.findFirst({\r\n        where: { branchId: data.businessId },\r\n        orderBy: { sku: 'desc' },\r\n        select: { sku: true }\r\n      });\r\n\r\n      let nextSku = \"PROD-0001\";\r\n      if (lastProduct && lastProduct.sku) {\r\n        const currentNumber = parseInt(lastProduct.sku.replace(\"PROD-\", \"\")) || 0;\r\n        nextSku = `PROD-${(currentNumber + 1).toString().padStart(4, '0')}`;\r\n      }\r\n\r\n      // 2. Create the product\r\n      const product = await tx.product.create({\r\n        data: {\r\n          name: data.name,\r\n          description: data.description,\r\n          branchId: data.businessId,\r\n          userId: data.userId,\r\n          categoryId: data.categoryId || null,\r\n          supplierId: data.supplierId || null,\r\n          sku: nextSku,\r\n          barcode: data.barcode,\r\n          image: data.imageUrl,\r\n          costPrice: data.costPrice || 0,\r\n          sellingPrice: data.sellingPrice || 0,\r\n          stock: data.quantity || 0,\r\n          minStock: data.minimumStock || 0,\r\n          createdAt: data.createdAt ? new Date(data.createdAt) : new Date(),\r\n        },\r\n        include: {\r\n          category: true,\r\n          supplier: true,\r\n        }\r\n      });\r\n\r\n      // 3. Create initial stock history if quantity > 0\r\n      if (data.quantity > 0) {\r\n        await tx.productHistory.create({\r\n          data: {\r\n            userId: data.userId,\r\n            productId: product.id,\r\n            type: 'CREATED',\r\n            oldStock: 0,\r\n            newStock: data.quantity,\r\n            quantityChange: data.quantity,\r\n            reason: `[${product.name}] | Initial stock`,\r\n            createdAt: data.createdAt ? new Date(data.createdAt) : new Date(),\r\n          }\r\n        });\r\n      }\r\n\r\n      return product;\r\n    });\r\n\r\n    return {\r\n      id: result.id,\r\n      name: result.name,\r\n      description: result.description || '',\r\n      category: result.category?.name || 'Uncategorized',\r\n      quantity: result.stock,\r\n      costPrice: result.costPrice,\r\n      sellingPrice: result.sellingPrice,\r\n      supplier: result.supplier?.name,\r\n      imageUrl: result.image,\r\n      barcode: result.barcode,\r\n      itemNumber: result.sku || '',\r\n      minimumStock: result.minStock,\r\n      createdAt: result.createdAt,\r\n    };\r\n  } catch (error) {\r\n    console.error('Error creating product:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function updateProductAction(id: string, updates: any) {\r\n  try {\r\n    const result = await db.$transaction(async (tx: any) => {\r\n      // 1. Get current product state\r\n      const current = await tx.product.findUnique({\r\n        where: { id },\r\n        select: { stock: true, name: true }\r\n      });\r\n\r\n      if (!current) throw new Error(\"Product not found\");\r\n\r\n      // 2. Perform update\r\n      const updated = await tx.product.update({\r\n        where: { id },\r\n        data: {\r\n          name: updates.name,\r\n          description: updates.description,\r\n          categoryId: updates.categoryId !== undefined ? updates.categoryId : undefined,\r\n          supplierId: updates.supplierId !== undefined ? updates.supplierId : undefined,\r\n          sku: updates.itemNumber || updates.sku,\r\n          barcode: updates.barcode,\r\n          image: updates.imageUrl,\r\n          costPrice: updates.costPrice,\r\n          sellingPrice: updates.sellingPrice,\r\n          stock: updates.quantity,\r\n          minStock: updates.minimumStock,\r\n        }\r\n      });\r\n\r\n      // 3. Create history if quantity changed\r\n      if (updates.quantity !== undefined && updates.quantity !== current.stock && updates.customChangeReason !== 'skip-history') {\r\n        let changeReason = updates.customChangeReason;\r\n        if (!changeReason) {\r\n          if (updates.isFromSale) changeReason = \"Sale\";\r\n          else if (updates.quantity > current.stock) changeReason = \"Manual stock addition\";\r\n          else changeReason = \"Manual stock reduction\";\r\n        }\r\n\r\n        const snapshottedReason = `[${updated.name}] | ${changeReason}`;\r\n\r\n        await tx.productHistory.create({\r\n          data: {\r\n            userId: updates.userId,\r\n            productId: updated.id,\r\n            type: updates.isFromSale ? 'SALE' : (updates.quantity > current.stock ? 'RESTOCK' : 'ADJUSTMENT'),\r\n            oldStock: current.stock,\r\n            newStock: updates.quantity,\r\n            quantityChange: updates.quantity - current.stock,\r\n            reason: snapshottedReason,\r\n            referenceId: updates.referenceId || null,\r\n          }\r\n        });\r\n      }\r\n\r\n      return updated;\r\n    });\r\n\r\n    return result;\r\n  } catch (error) {\r\n    console.error('Error updating product:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function deleteProductAction(id: string) {\r\n  try {\r\n    await db.product.delete({\r\n      where: { id }\r\n    });\r\n    // revalidatePath('/inventory/products');\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error deleting product:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\nexport async function updateProductsBulkAction(\r\n  updates: Array<{ id: string; updated: Partial<any> }>,\r\n  businessId: string\r\n) {\r\n  try {\r\n    // Prisma transaction for bulk updates\r\n    const updatePromises = updates.map(u =>\r\n      db.product.update({\r\n        where: { id: u.id },\r\n        data: {\r\n          ...(u.updated.name && { name: u.updated.name }),\r\n          ...(u.updated.description !== undefined && { description: u.updated.description }),\r\n          ...(u.updated.categoryId !== undefined && { categoryId: u.updated.categoryId }),\r\n          ...(u.updated.supplierId !== undefined && { supplierId: u.updated.supplierId }),\r\n          ...(u.updated.sku !== undefined && { sku: u.updated.sku }),\r\n          ...(u.updated.barcode !== undefined && { barcode: u.updated.barcode }),\r\n          ...(u.updated.costPrice !== undefined && { costPrice: u.updated.costPrice }),\r\n          ...(u.updated.sellingPrice !== undefined && { sellingPrice: u.updated.sellingPrice }),\r\n          ...(u.updated.quantity !== undefined && { stock: u.updated.quantity }),\r\n          ...(u.updated.minimumStock !== undefined && { minStock: u.updated.minimumStock }),\r\n        }\r\n      })\r\n    );\r\n\r\n    await db.$transaction(updatePromises);\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error performing bulk update:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\n// --- PRODUCT CATEGORIES ---\r\n\r\nexport async function getProductCategoriesAction(locationId: string) {\r\n  try {\r\n    const categories = await db.category.findMany({\r\n      where: { branchId: locationId },\r\n      orderBy: { name: 'asc' }\r\n    });\r\n\r\n    return {\r\n      success: true,\r\n      data: categories.map((c: any) => ({\r\n        id: c.id,\r\n        name: c.name,\r\n        created_at: c.createdAt.toISOString(),\r\n      }))\r\n    };\r\n  } catch (error: any) {\r\n    console.error('Error fetching categories:', error);\r\n    return { success: false, error: error.message };\r\n  }\r\n}\r\n\r\nexport async function createProductCategoryAction(locationId: string, userId: string, name: string) {\r\n  try {\r\n    const category = await db.category.create({\r\n      data: {\r\n        branchId: locationId,\r\n        userId,\r\n        name\r\n      }\r\n    });\r\n\r\n    revalidatePath('/inventory');\r\n    return { success: true, data: category };\r\n  } catch (error: any) {\r\n    console.error('Error creating category:', error);\r\n    return { success: false, error: error.message };\r\n  }\r\n}\r\n\r\nexport async function updateProductCategoryAction(id: string, name: string) {\r\n  try {\r\n    const category = await db.category.update({\r\n      where: { id },\r\n      data: { name }\r\n    });\r\n\r\n    revalidatePath('/inventory');\r\n    return { success: true, data: category };\r\n  } catch (error: any) {\r\n    console.error('Error updating category:', error);\r\n    return { success: false, error: error.message };\r\n  }\r\n}\r\n\r\nexport async function deleteProductCategoryAction(id: string) {\r\n  try {\r\n    // Check if any products are using this category\r\n    const usageCount = await db.product.count({\r\n      where: { categoryId: id }\r\n    });\r\n\r\n    if (usageCount > 0) {\r\n      return {\r\n        success: false,\r\n        error: 'Cannot delete category: it is being used by one or more products.'\r\n      };\r\n    }\r\n\r\n    await db.category.delete({\r\n      where: { id }\r\n    });\r\n\r\n    revalidatePath('/inventory');\r\n    return { success: true };\r\n  } catch (error: any) {\r\n    console.error('Error deleting category:', error);\r\n    return { success: false, error: error.message };\r\n  }\r\n}\r\n\r\n// --- PRODUCT STATS ---\r\n\r\nexport async function getProductStatsAction(businessId: string) {\r\n  if (!businessId) return { costValue: 0, lowStock: 0, outOfStock: 0, stockValue: 0 };\r\n\r\n  try {\r\n    const products = await db.product.findMany({\r\n      where: { branchId: businessId },\r\n      select: {\r\n        stock: true,\r\n        costPrice: true,\r\n        sellingPrice: true,\r\n        minStock: true,\r\n      }\r\n    });\r\n\r\n    let costValue = 0;\r\n    let lowStock = 0;\r\n    let outOfStock = 0;\r\n    let stockValue = 0;\r\n\r\n    products.forEach((p: any) => {\r\n      const qty = Number(p.stock) || 0;\r\n      const cost = Number(p.costPrice) || 0;\r\n      const selling = Number(p.sellingPrice) || 0;\r\n      const minStock = Number(p.minStock) || 0;\r\n\r\n      costValue += cost * qty;\r\n      stockValue += selling * qty;\r\n\r\n      if (qty === 0) {\r\n        outOfStock++;\r\n      } else if (qty > 0 && qty <= minStock) {\r\n        lowStock++;\r\n      }\r\n    });\r\n\r\n    return { costValue, lowStock, outOfStock, stockValue };\r\n  } catch (error) {\r\n    console.error('Error fetching product stats:', error);\r\n    return { costValue: 0, lowStock: 0, outOfStock: 0, stockValue: 0 };\r\n  }\r\n}\r\n\r\n// --- BARCODE LOOKUP ---\r\n\r\nexport async function lookupProductByBarcodeAction(code: string, branchId: string) {\r\n  if (!code || !branchId) return null;\r\n  try {\r\n    const lowerCode = code.toLowerCase();\r\n    const product = await db.product.findFirst({\r\n      where: {\r\n        branchId,\r\n        OR: [\r\n          { barcode: { contains: lowerCode, mode: 'insensitive' } },\r\n          { sku: { contains: lowerCode, mode: 'insensitive' } },\r\n        ]\r\n      }\r\n    });\r\n    return product;\r\n  } catch (error) {\r\n    console.error('[lookupProductByBarcodeAction] Error:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n// --- BARCODE SCANNER (all products for scanner preload) ---\r\n\r\nexport async function getProductsForBarcodeScannerAction(branchId: string) {\r\n  if (!branchId) return [];\r\n  try {\r\n    const products = await db.product.findMany({\r\n      where: { branchId },\r\n      select: {\r\n        id: true, name: true, barcode: true, sku: true,\r\n        sellingPrice: true, costPrice: true, stock: true,\r\n        description: true, categoryId: true, branchId: true,\r\n        minStock: true, imageUrl: true, createdAt: true, updatedAt: true,\r\n      },\r\n    });\r\n    return products;\r\n  } catch (error) {\r\n    console.error('[getProductsForBarcodeScannerAction] Error:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\n// --- SALE CASH TRANSACTION ID UPDATE ---\r\n\r\nexport async function updateSaleCashTransactionAction(saleId: string, cashTransactionId: string) {\r\n  try {\r\n    await db.sale.update({\r\n      where: { id: saleId },\r\n      data: { cashTransactionId },\r\n    });\r\n    return { success: true };\r\n  } catch (error: any) {\r\n    console.error('[updateSaleCashTransactionAction] Error:', error);\r\n    return { success: false, error: error.message };\r\n  }\r\n}\r\n\r\n// --- FILTERED PRODUCTS FOR EXPORT (all pages) ---\r\n\r\nexport async function getFilteredProductsForExportAction(\r\n  branchId: string,\r\n  filters?: { search?: string; category?: string; stockStatus?: string }\r\n) {\r\n  if (!branchId) return [];\r\n  try {\r\n    const where: any = { branchId };\r\n\r\n    if (filters?.search) {\r\n      const s = filters.search;\r\n      where.OR = [\r\n        { name: { contains: s, mode: 'insensitive' } },\r\n        { description: { contains: s, mode: 'insensitive' } },\r\n        { sku: { contains: s, mode: 'insensitive' } },\r\n      ];\r\n    }\r\n\r\n    if (filters?.stockStatus === 'outOfStock') {\r\n      where.stock = 0;\r\n    } else if (filters?.stockStatus === 'inStock') {\r\n      where.stock = { gt: 0 };\r\n    }\r\n\r\n    const products = await db.product.findMany({\r\n      where,\r\n      orderBy: { createdAt: 'desc' },\r\n    });\r\n\r\n    return products;\r\n  } catch (error) {\r\n    console.error('[getFilteredProductsForExportAction] Error:', error);\r\n    return [];\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MAQsB,wBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA,qDAAA"}},
    {"offset": {"line": 3943, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/hooks/useProductsBase.ts"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport { Product } from '@/types';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\nimport { getProductsAction } from '@/app/actions/products';\r\n\r\n/**\r\n * Base hook for fetching and storing products using Prisma\r\n */\r\nexport const useProductsBase = (userId: string | undefined) => {\r\n  const [products, setProducts] = useState<Product[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const { toast } = useToast();\r\n  const { currentBusiness } = useBusiness();\r\n\r\n  const loadProducts = async () => {\r\n    try {\r\n      if (!userId || !currentBusiness) return;\r\n\r\n      setIsLoading(true);\r\n      const result = await getProductsAction({\r\n        userId,\r\n        businessId: currentBusiness.id,\r\n        page: 1,\r\n        pageSize: 1000, // Fetch all for base hook\r\n      });\r\n\r\n      setProducts(result.products as Product[]);\r\n      return result.products as Product[];\r\n    } catch (error) {\r\n      console.error('Error loading products:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to load products. Please try again.\",\r\n        variant: \"destructive\"\r\n      });\r\n      return [];\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    loadProducts();\r\n  }, [userId, currentBusiness?.id]);\r\n\r\n  return {\r\n    products,\r\n    isLoading,\r\n    setProducts,\r\n    loadProducts\r\n  };\r\n};\r\n"],"names":[],"mappings":";;;;AAAA;AAEA;AACA;AACA;;;;;AAKO,MAAM,kBAAkB,CAAC;IAC9B,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,iNAAQ,EAAY,EAAE;IACtD,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAC;IAC3C,MAAM,EAAE,KAAK,EAAE,GAAG,IAAA,wIAAQ;IAC1B,MAAM,EAAE,eAAe,EAAE,GAAG,IAAA,kJAAW;IAEvC,MAAM,eAAe;QACnB,IAAI;YACF,IAAI,CAAC,UAAU,CAAC,iBAAiB;YAEjC,aAAa;YACb,MAAM,SAAS,MAAM,IAAA,kLAAiB,EAAC;gBACrC;gBACA,YAAY,gBAAgB,EAAE;gBAC9B,MAAM;gBACN,UAAU;YACZ;YAEA,YAAY,OAAO,QAAQ;YAC3B,OAAO,OAAO,QAAQ;QACxB,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,2BAA2B;YACzC,MAAM;gBACJ,OAAO;gBACP,aAAa;gBACb,SAAS;YACX;YACA,OAAO,EAAE;QACX,SAAU;YACR,aAAa;QACf;IACF;IAEA,IAAA,kNAAS,EAAC;QACR;IACF,GAAG;QAAC;QAAQ,iBAAiB;KAAG;IAEhC,OAAO;QACL;QACA;QACA;QACA;IACF;AACF"}},
    {"offset": {"line": 4001, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/FINAL/src/components/AnalyticsDashboard.tsx"],"sourcesContent":["import React, { useState, useEffect, useMemo, memo } from 'react';\r\nimport { Sale, BusinessSettings, Product } from '@/types';\r\nimport { useAnalyticsData } from '@/hooks/useAnalyticsData';\r\nimport { formatNumber } from '@/lib/utils';\r\nimport { useIsMobile } from '@/hooks/use-mobile';\r\nimport DateRangeFilter from './analytics/DateRangeFilter';\r\nimport AnalyticsCards from './analytics/AnalyticsCards';\r\nimport FinancialOverview from './analytics/FinancialOverview';\r\nimport SalesGoalTracker from './SalesGoalTracker';\r\nimport RecentSalesTable from './analytics/RecentSalesTable';\r\nimport SalesPerformanceChart from './analytics/SalesPerformanceChart';\r\nimport { useProductsBase } from '@/hooks/useProductsBase';\r\nimport { useAuth } from '@/components/auth/AuthProvider';\r\nimport { useFinancialVisibility } from '@/hooks/useFinancialVisibility';\r\n\r\ninterface AnalyticsDashboardProps {\r\n  sales: Sale[];\r\n  currency?: string;\r\n}\r\n\r\nconst DEFAULT_SETTINGS: BusinessSettings = {\r\n  businessName: 'Your Business Name',\r\n  businessAddress: 'Your Business Address',\r\n  businessPhone: '(123) 456-7890',\r\n  businessEmail: 'support@yourbusiness.com',\r\n  businessLogo: '',\r\n  currency: 'UGX',\r\n};\r\n\r\nconst AnalyticsDashboard = memo<AnalyticsDashboardProps>(({ sales, currency = 'UGX' }) => {\r\n  const isMobile = useIsMobile();\r\n  const { user } = useAuth();\r\n  const [settings, setSettings] = useState<BusinessSettings>({ ...DEFAULT_SETTINGS, currency });\r\n  const [dateFilter, setDateFilter] = useState('this-month');\r\n  const [dateRange, setDateRange] = useState<{ from: Date | undefined; to: Date | undefined; }>({\r\n    from: undefined,\r\n    to: undefined,\r\n  });\r\n  const [specificDate, setSpecificDate] = useState<Date | undefined>(undefined);\r\n  const [isCustomRange, setIsCustomRange] = useState(false);\r\n  const [isSpecificDate, setIsSpecificDate] = useState(false);\r\n  const { products, isLoading: isLoadingProducts } = useProductsBase(user?.id);\r\n  const {\r\n    canViewCostPrice,\r\n    canViewTotalSales,\r\n    canViewTotalGrossProfit,\r\n    canViewTotalExpenses,\r\n    canViewInventoryValue,\r\n    canViewSalesTypes\r\n  } = useFinancialVisibility();\r\n\r\n  // Memoize inventory value calculation\r\n  const inventoryValue = useMemo(() => {\r\n    if (!products || products.length === 0) return 0;\r\n    if (!canViewCostPrice) return 0;\r\n    return products.reduce((sum, product) => sum + (product.costPrice * product.quantity), 0);\r\n  }, [products, canViewCostPrice]);\r\n\r\n  // Memoize settings update\r\n  const memoizedSettings = useMemo(() => {\r\n    const baseSettings = { ...DEFAULT_SETTINGS, currency };\r\n    const savedSettings = localStorage.getItem('businessSettings');\r\n    if (savedSettings) {\r\n      try {\r\n        const parsed = JSON.parse(savedSettings);\r\n        return { ...parsed, currency: currency || parsed.currency };\r\n      } catch {\r\n        return baseSettings;\r\n      }\r\n    }\r\n    return baseSettings;\r\n  }, [currency]);\r\n\r\n  useEffect(() => {\r\n    setSettings(memoizedSettings);\r\n  }, [memoizedSettings]);\r\n\r\n  // Memoize date filter handlers\r\n  const handleDateFilterChange = useMemo(() => (value: string) => {\r\n    setDateFilter(value);\r\n    if (value === 'custom') {\r\n      setIsCustomRange(true);\r\n      setIsSpecificDate(false);\r\n      setSpecificDate(undefined);\r\n    } else if (value === 'specific') {\r\n      setIsSpecificDate(true);\r\n      setIsCustomRange(false);\r\n      setDateRange({ from: undefined, to: undefined });\r\n    } else {\r\n      setIsCustomRange(false);\r\n      setIsSpecificDate(false);\r\n      setDateRange({ from: undefined, to: undefined });\r\n      setSpecificDate(undefined);\r\n    }\r\n  }, []);\r\n\r\n  const handleRangeSelect = useMemo(() => (range: { from: Date | undefined; to: Date | undefined; }) => {\r\n    setDateRange(range);\r\n    if (range.from && range.to) {\r\n      setIsCustomRange(true);\r\n      setDateFilter('custom');\r\n    }\r\n  }, []);\r\n\r\n  const handleSpecificDateChange = useMemo(() => (date: Date | undefined) => {\r\n    setSpecificDate(date);\r\n    if (date) {\r\n      setIsSpecificDate(true);\r\n      setDateFilter('specific');\r\n    }\r\n  }, []);\r\n\r\n  const { analyticsData, barChartData, recentSales, nonQuoteSalesCount, expenses, isLoadingExpenses } = useAnalyticsData({\r\n    sales,\r\n    dateFilter,\r\n    dateRange,\r\n    specificDate,\r\n    isCustomRange,\r\n    isSpecificDate\r\n  });\r\n\r\n  const formatCurrency = (value: any) => {\r\n    return `${settings.currency} ${formatNumber(value)}`;\r\n  };\r\n\r\n  const isLoading = isLoadingExpenses || isLoadingProducts;\r\n\r\n  return (\r\n    <div className=\"space-y-6 w-full\">\r\n      <DateRangeFilter\r\n        dateFilter={dateFilter}\r\n        dateRange={dateRange}\r\n        specificDate={specificDate}\r\n        isCustomRange={isCustomRange}\r\n        isSpecificDate={isSpecificDate}\r\n        onDateFilterChange={handleDateFilterChange}\r\n        onDateRangeChange={handleRangeSelect}\r\n        onSpecificDateChange={handleSpecificDateChange}\r\n      />\r\n\r\n      <AnalyticsCards\r\n        analyticsData={analyticsData}\r\n        nonQuoteSalesCount={nonQuoteSalesCount}\r\n        currency={settings.currency}\r\n        expenses={expenses}\r\n        inventoryValue={inventoryValue}\r\n        canViewProfit={canViewTotalGrossProfit}\r\n        canViewTotalSales={canViewTotalSales}\r\n        canViewTotalExpenses={canViewTotalExpenses}\r\n        canViewInventoryValue={canViewInventoryValue}\r\n        canViewSalesTypes={canViewSalesTypes}\r\n      />\r\n\r\n      <SalesPerformanceChart\r\n        sales={sales}\r\n        formatCurrency={formatCurrency}\r\n        dateFilter={dateFilter}\r\n        dateRange={dateRange}\r\n        isCustomRange={isCustomRange}\r\n      />\r\n\r\n      <div className=\"grid grid-cols-1 xl:grid-cols-3 gap-6\">\r\n        <div className=\"xl:col-span-2\">\r\n          <FinancialOverview\r\n            data={barChartData.filter(d => {\r\n              const name = d.name.toLowerCase();\r\n              if (name.includes('sales')) return canViewTotalSales;\r\n              if (name.includes('cost') || name.includes('expenses')) return canViewTotalExpenses;\r\n              if (name.includes('profit')) return canViewTotalGrossProfit;\r\n              return true;\r\n            })}\r\n            formatCurrency={formatCurrency}\r\n          />\r\n        </div>\r\n\r\n        <div className=\"xl:col-span-1\">\r\n          <SalesGoalTracker />\r\n        </div>\r\n      </div>\r\n\r\n      <RecentSalesTable recentSales={recentSales} currency={settings.currency} />\r\n    </div>\r\n  );\r\n});\r\n\r\nAnalyticsDashboard.displayName = 'AnalyticsDashboard';\r\n\r\nexport default AnalyticsDashboard;\r\n"],"names":[],"mappings":"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"}}]
}