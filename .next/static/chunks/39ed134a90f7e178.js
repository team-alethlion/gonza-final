(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,388474,e=>{"use strict";var t=e.i(271645),r=e.i(820783),a=e.i(30030),i=e.i(981140),s=e.i(369340),c=e.i(999682),o=e.i(635804),n=e.i(296626),l=e.i(248425),d=e.i(843476),u="Checkbox",[f,h]=(0,a.createContextScope)(u),[p,m]=f(u);function v(e){let{__scopeCheckbox:r,checked:a,children:i,defaultChecked:c,disabled:o,form:n,name:l,onCheckedChange:f,required:h,value:m="on",internal_do_not_use_render:v}=e,[y,g]=(0,s.useControllableState)({prop:a,defaultProp:c??!1,onChange:f,caller:u}),[b,S]=t.useState(null),[x,w]=t.useState(null),C=t.useRef(!1),R=!b||!!n||!!b.closest("form"),N={checked:y,disabled:o,setChecked:g,control:b,setControl:S,name:l,form:n,value:m,hasConsumerStoppedPropagationRef:C,required:h,defaultChecked:!j(c)&&c,isFormControl:R,bubbleInput:x,setBubbleInput:w};return(0,d.jsx)(p,{scope:r,...N,children:"function"==typeof v?v(N):i})}var y="CheckboxTrigger",g=t.forwardRef(({__scopeCheckbox:e,onKeyDown:a,onClick:s,...c},o)=>{let{control:n,value:u,disabled:f,checked:h,required:p,setControl:v,setChecked:g,hasConsumerStoppedPropagationRef:b,isFormControl:S,bubbleInput:x}=m(y,e),w=(0,r.useComposedRefs)(o,v),C=t.useRef(h);return t.useEffect(()=>{let e=n?.form;if(e){let t=()=>g(C.current);return e.addEventListener("reset",t),()=>e.removeEventListener("reset",t)}},[n,g]),(0,d.jsx)(l.Primitive.button,{type:"button",role:"checkbox","aria-checked":j(h)?"mixed":h,"aria-required":p,"data-state":R(h),"data-disabled":f?"":void 0,disabled:f,value:u,...c,ref:w,onKeyDown:(0,i.composeEventHandlers)(a,e=>{"Enter"===e.key&&e.preventDefault()}),onClick:(0,i.composeEventHandlers)(s,e=>{g(e=>!!j(e)||!e),x&&S&&(b.current=e.isPropagationStopped(),b.current||e.stopPropagation())})})});g.displayName=y;var b=t.forwardRef((e,t)=>{let{__scopeCheckbox:r,name:a,checked:i,defaultChecked:s,required:c,disabled:o,value:n,onCheckedChange:l,form:u,...f}=e;return(0,d.jsx)(v,{__scopeCheckbox:r,checked:i,defaultChecked:s,disabled:o,required:c,onCheckedChange:l,name:a,form:u,value:n,internal_do_not_use_render:({isFormControl:e})=>(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(g,{...f,ref:t,__scopeCheckbox:r}),e&&(0,d.jsx)(C,{__scopeCheckbox:r})]})})});b.displayName=u;var S="CheckboxIndicator",x=t.forwardRef((e,t)=>{let{__scopeCheckbox:r,forceMount:a,...i}=e,s=m(S,r);return(0,d.jsx)(n.Presence,{present:a||j(s.checked)||!0===s.checked,children:(0,d.jsx)(l.Primitive.span,{"data-state":R(s.checked),"data-disabled":s.disabled?"":void 0,...i,ref:t,style:{pointerEvents:"none",...e.style}})})});x.displayName=S;var w="CheckboxBubbleInput",C=t.forwardRef(({__scopeCheckbox:e,...a},i)=>{let{control:s,hasConsumerStoppedPropagationRef:n,checked:u,defaultChecked:f,required:h,disabled:p,name:v,value:y,form:g,bubbleInput:b,setBubbleInput:S}=m(w,e),x=(0,r.useComposedRefs)(i,S),C=(0,c.usePrevious)(u),R=(0,o.useSize)(s);t.useEffect(()=>{if(!b)return;let e=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set,t=!n.current;if(C!==u&&e){let r=new Event("click",{bubbles:t});b.indeterminate=j(u),e.call(b,!j(u)&&u),b.dispatchEvent(r)}},[b,C,u,n]);let N=t.useRef(!j(u)&&u);return(0,d.jsx)(l.Primitive.input,{type:"checkbox","aria-hidden":!0,defaultChecked:f??N.current,required:h,disabled:p,name:v,value:y,form:g,...a,tabIndex:-1,ref:x,style:{...a.style,...R,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});function j(e){return"indeterminate"===e}function R(e){return j(e)?"indeterminate":e?"checked":"unchecked"}C.displayName=w,e.s(["Checkbox",()=>b,"CheckboxIndicator",()=>x,"Indicator",()=>x,"Root",()=>b,"createCheckboxScope",()=>h,"unstable_BubbleInput",()=>C,"unstable_CheckboxBubbleInput",()=>C,"unstable_CheckboxProvider",()=>v,"unstable_CheckboxTrigger",()=>g,"unstable_Provider",()=>v,"unstable_Trigger",()=>g])},257428,e=>{"use strict";var t=e.i(843476),r=e.i(271645),a=e.i(388474),i=e.i(643531),s=e.i(975157);let c=r.forwardRef(({className:e,...r},c)=>(0,t.jsx)(a.Root,{ref:c,className:(0,s.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...r,children:(0,t.jsx)(a.Indicator,{className:(0,s.cn)("flex items-center justify-center text-current"),children:(0,t.jsx)(i.Check,{className:"h-4 w-4"})})}));c.displayName=a.Root.displayName,e.s(["Checkbox",()=>c])},871689,e=>{"use strict";let t=(0,e.i(475254).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>t],871689)},57287,e=>{"use strict";var t=e.i(271645),r=e.i(981140),a=e.i(820783),i=e.i(30030),s=e.i(369340),c=e.i(999682),o=e.i(635804),n=e.i(248425),l=e.i(843476),d="Switch",[u,f]=(0,i.createContextScope)(d),[h,p]=u(d),m=t.forwardRef((e,i)=>{let{__scopeSwitch:c,name:o,checked:u,defaultChecked:f,required:p,disabled:m,value:v="on",onCheckedChange:y,form:S,...x}=e,[w,C]=t.useState(null),j=(0,a.useComposedRefs)(i,e=>C(e)),R=t.useRef(!1),N=!w||S||!!w.closest("form"),[k,E]=(0,s.useControllableState)({prop:u,defaultProp:f??!1,onChange:y,caller:d});return(0,l.jsxs)(h,{scope:c,checked:k,disabled:m,children:[(0,l.jsx)(n.Primitive.button,{type:"button",role:"switch","aria-checked":k,"aria-required":p,"data-state":b(k),"data-disabled":m?"":void 0,disabled:m,value:v,...x,ref:j,onClick:(0,r.composeEventHandlers)(e.onClick,e=>{E(e=>!e),N&&(R.current=e.isPropagationStopped(),R.current||e.stopPropagation())})}),N&&(0,l.jsx)(g,{control:w,bubbles:!R.current,name:o,value:v,checked:k,required:p,disabled:m,form:S,style:{transform:"translateX(-100%)"}})]})});m.displayName=d;var v="SwitchThumb",y=t.forwardRef((e,t)=>{let{__scopeSwitch:r,...a}=e,i=p(v,r);return(0,l.jsx)(n.Primitive.span,{"data-state":b(i.checked),"data-disabled":i.disabled?"":void 0,...a,ref:t})});y.displayName=v;var g=t.forwardRef(({__scopeSwitch:e,control:r,checked:i,bubbles:s=!0,...n},d)=>{let u=t.useRef(null),f=(0,a.useComposedRefs)(u,d),h=(0,c.usePrevious)(i),p=(0,o.useSize)(r);return t.useEffect(()=>{let e=u.current;if(!e)return;let t=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(h!==i&&t){let r=new Event("click",{bubbles:s});t.call(e,i),e.dispatchEvent(r)}},[h,i,s]),(0,l.jsx)("input",{type:"checkbox","aria-hidden":!0,defaultChecked:i,...n,tabIndex:-1,ref:f,style:{...n.style,...p,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});function b(e){return e?"checked":"unchecked"}g.displayName="SwitchBubbleInput",e.s(["Root",()=>m,"Switch",()=>m,"SwitchThumb",()=>y,"Thumb",()=>y,"createSwitchScope",()=>f])},699375,e=>{"use strict";var t=e.i(843476),r=e.i(271645),a=e.i(57287),i=e.i(975157);let s=r.forwardRef(({className:e,...r},s)=>(0,t.jsx)(a.Root,{className:(0,i.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",e),...r,ref:s,children:(0,t.jsx)(a.Thumb,{className:(0,i.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));s.displayName=a.Root.displayName,e.s(["Switch",()=>s])},367240,e=>{"use strict";let t=(0,e.i(475254).default)("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);e.s(["RotateCcw",()=>t],367240)},899426,e=>{"use strict";e.s(["matchProductSearch",0,(e,t)=>{if(!t||!t.trim())return!0;let r=t.toLowerCase().trim().split(/\s+/),a=[String(e.name||""),String(e.description||""),String(e.category||""),String(e.supplier||""),String(e.itemNumber||""),String(e.barcode||""),String(e.manufacturerBarcode||"")].map(e=>e.toLowerCase());return r.every(e=>a.some(t=>t.includes(e)))}])},669469,e=>{"use strict";var t=e.i(843476);let r=(0,e.i(475254).default)("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);e.s(["default",0,({imageUrl:e,alt:a,size:i="md"})=>{let s="sm"===i?"w-10 h-10":"w-12 h-12";return e?(0,t.jsx)("img",{src:e,alt:a,className:`${s} object-cover rounded-md`}):(0,t.jsx)("div",{className:`${s} bg-gray-100 flex items-center justify-center rounded-md`,children:(0,t.jsx)(r,{size:"sm"===i?16:18,className:"text-gray-400"})})}],669469)},503116,e=>{"use strict";let t=(0,e.i(475254).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);e.s(["Clock",()=>t],503116)},44686,e=>{"use strict";var t=e.i(271645),r=e.i(422713),a=e.i(37451),i=e.i(654550),s=e.i(172720),c=e.i(489855),o=e.i(933289),n=e.i(752304),l=e.i(634076);e.s(["useStockHistory",0,(e,d)=>{let[u,f]=(0,t.useState)([]),[h,p]=(0,t.useState)(!0),{currentBusiness:m}=(0,r.useBusiness)(),v=(0,t.useCallback)(async()=>{if(!e||!m){f([]),p(!1);return}try{p(!0);let e=await (0,a.getStockHistoryAction)(m.id,d);if(!e.success||!e.data)throw Error(e.error||"Failed to fetch stock history");let t=e.data.map(e=>({id:e.id,productId:e.productId,oldQuantity:e.oldQuantity,newQuantity:e.newQuantity,changeReason:e.changeReason,createdAt:new Date(e.createdAt),referenceId:e.referenceId,receiptNumber:e.receiptNumber,product:e.product}));f(t)}catch(e){console.error("Error loading stock history:",e)}finally{p(!1)}},[e,m?.id,d]);return(0,t.useEffect)(()=>{v()},[v]),{stockHistory:u,isLoading:h,createStockHistoryEntry:async(t,r,a,s,c,o,n,l)=>{try{if(!e||!m)return!1;let d=l?`[${l}] | ${s}`:s,u=await (0,i.createStockHistoryAction)({userId:e,locationId:m.id,productId:t,previousQuantity:r,newQuantity:a,changeReason:d,referenceId:c,receiptNumber:n,createdAt:o?.toISOString()});if(!u.success)return console.error("Error creating stock history entry:",u.error),!1;return await v(),!0}catch(e){return console.error("Error creating stock history:",e),!1}},deleteMultipleStockHistoryEntriesByReference:async e=>{try{if(!m)return!1;let t=await (0,c.deleteStockHistoryEntriesByReferenceAction)(e,m.id);if(!t.success)throw Error(t.error);return await v(),!0}catch(e){return console.error("Error deleting stock history entries:",e),!1}},recalculateStockChain:async e=>{try{if(!m)return!1;let t=await (0,s.recalculateStockChainAction)(e,m.id);if(!t.success)throw Error(t.error);return await v(),!0}catch(e){return console.error("Error recalculating stock chain:",e),!1}},updateStockHistoryDatesBySaleId:async(e,t)=>{try{if(!m)return!1;let r=await (0,o.updateStockHistoryDatesByReferenceAction)(e,m.id,t.toISOString());if(!r.success)throw Error(r.error);return await v(),!0}catch(e){return console.error("Error updating stock history dates:",e),!1}},repairAllStockChains:async e=>{try{if(!m)return{repaired:0,failed:0};let e=await (0,n.repairStockChainsAction)(m.id);if(e.success&&e.data)return e.data;return{repaired:0,failed:0}}catch(e){return console.error("Error repairing all chains:",e),{repaired:0,failed:0}}},previewStockChainRepairs:async e=>{try{if(!m)return[];let e=await (0,l.getStockRepairsPreviewAction)(m.id);if(e.success&&e.data)return e.data;return[]}catch(e){return console.error("Error previewing repairs:",e),[]}},refreshHistory:v}}])},304228,e=>{"use strict";var t=e.i(271645),r=e.i(422713),a=e.i(777624),i=e.i(266027),s=e.i(912598),c=e.i(908406),o=e.i(95187);let n=(0,o.createServerReference)("600b97f3c90242ca4be1574d304e260e5e07e3c8cf",o.callServer,void 0,o.findSourceMapURL,"getMessagesAction"),l=(0,o.createServerReference)("40fae8e3cd20e274d8835c219996fbcfcdde06446f",o.callServer,void 0,o.findSourceMapURL,"createMessageAction"),d=(0,o.createServerReference)("608c56e751f1517abf78af3f8f4b1eb817c5efcecc",o.callServer,void 0,o.findSourceMapURL,"getMessageTemplatesAction"),u=(0,o.createServerReference)("4012401c60d205ed481a496ad745ca64dfad82e200",o.callServer,void 0,o.findSourceMapURL,"createMessageTemplateAction"),f=(0,o.createServerReference)("60a4c2261958cabb4ed4ad155b1559b15bd9b1c7a3",o.callServer,void 0,o.findSourceMapURL,"updateMessageTemplateAction"),h=(0,o.createServerReference)("406dfcb8705c888c32dc2bb1380b80464b3977c05d",o.callServer,void 0,o.findSourceMapURL,"deleteMessageTemplateAction");e.s(["useMessages",0,e=>{let[o,p]=(0,t.useState)([]),[m,v]=(0,t.useState)([]),[y,g]=(0,t.useState)([]),[b,S]=(0,t.useState)(0),{currentBusiness:x}=(0,r.useBusiness)(),{currentProfile:w}=(0,a.useProfiles)(),C=(0,s.useQueryClient)(),j=async()=>{w?.sms_credits!==void 0&&S(w.sms_credits)},R=async t=>{if(!e||!x?.id)return null;try{let r=await u({userId:e,locationId:x.id,name:t.name,content:t.content,category:t.category,variables:t.variables,isDefault:t.isDefault});if(r.success&&r.data)return M(),r.data;throw Error(r.error)}catch(e){return console.error("Error creating template:",e),(0,c.toast)({title:"Error",description:"Failed to create template",variant:"destructive"}),null}},N=async(e,t)=>{try{let r=await f(e,t);if(r.success)M();else throw Error(r.error)}catch(e){console.error("Error updating template:",e),(0,c.toast)({title:"Error",description:"Failed to update template",variant:"destructive"})}},k=async e=>{try{let t=await h(e);if(t.success)v(t=>t.filter(t=>t.id!==e));else throw Error(t.error)}catch(e){console.error("Error deleting template:",e),(0,c.toast)({title:"Error",description:"Failed to delete template",variant:"destructive"})}},E=(0,t.useCallback)(async()=>{if(!e||!x?.id)return[];try{let t=await n(e,x.id);if(t.success&&t.data)return t.data;return[]}catch(e){return console.error("Error fetching messages:",e),[]}},[e,x?.id]),A=["messages",e,x?.id],{data:I,isLoading:T}=(0,i.useQuery)({queryKey:A,queryFn:E,enabled:!!e&&!!x?.id});(0,t.useEffect)(()=>{I&&p(I)},[I]);let M=async()=>{if(e&&x?.id)try{let t=await d(e,x.id);t.success&&t.data&&v(t.data)}catch(e){console.error("Error fetching templates:",e)}},L=async()=>{g([])},D=async t=>{let r;if(!e||!x?.id||!w)return null;let a=(r=t.phoneNumber.replace(/[\s\-\(\)]/g,"")).startsWith("+")?r:r.startsWith("256")?"+"+r:r.startsWith("0")?"+256"+r.substring(1):(9===r.length&&r.match(/^[7]\d{8}$/),"+256"+r),i=Math.ceil(t.content.length/160);if(w.sms_credits<i)return(0,c.toast)({title:"Error",description:"Insufficient credits",variant:"destructive"}),null;try{let r=await l({userId:e,locationId:x.id,profileId:w.id,customerId:t.customerId,phoneNumber:a,content:t.content,templateId:t.templateId,smsCreditsUsed:i,status:"sent",metadata:t.metadata});if(r.success&&r.data){let e={...r.data,createdAt:r.data.createdAt.toISOString()};return p(t=>[e,...t]),C.invalidateQueries({queryKey:A}),(0,c.toast)({title:"Success",description:"Message sent successfully"}),e}throw Error(r.error)}catch(e){return console.error("Error sending message:",e),(0,c.toast)({title:"Error",description:"Failed to send message",variant:"destructive"}),null}},U=async e=>{let t=0;for(let r of e.customerIds)t++;return{success:t,failed:0,errors:[]}},_=async(e,t)=>((0,c.toast)({title:"Info",description:"Credit purchase migration in progress"}),null);return(0,t.useEffect)(()=>{e&&x?.id&&(M(),L(),j())},[e,x?.id,w?.id]),{messages:o,templates:m,purchases:y,liveCredits:b,isLoading:T&&!I,createMessage:D,createBulkMessages:U,createTemplate:R,updateTemplate:N,deleteTemplate:k,getMessageStats:()=>{let e=o.length,t=o.filter(e=>"sent"===e.status||"delivered"===e.status).length,r=o.filter(e=>"failed"===e.status).length;return{total:e,sent:t,failed:r,pending:o.filter(e=>"pending"===e.status).length,totalCreditsUsed:o.reduce((e,t)=>e+t.smsCreditsUsed,0),creditsRemaining:b}},initiateCreditPurchase:_,refresh:()=>{C.invalidateQueries({queryKey:A}),M(),L(),j()}}}],304228)},966265,e=>{"use strict";var t=e.i(271645),r=e.i(908406),a=e.i(422713),i=e.i(102594),s=e.i(266027),c=e.i(912598),o=e.i(95187);let n=(0,o.createServerReference)("408055c65091de6e86656304d04a002881aed3acc6",o.callServer,void 0,o.findSourceMapURL,"getCashAccountsAction"),l=(0,o.createServerReference)("40fec0c16d5b967e0b7b13b4f39e9f33caa55d98fd",o.callServer,void 0,o.findSourceMapURL,"createCashAccountAction"),d=(0,o.createServerReference)("60cff6e1bde4cdde91ed3aaa29411ed65f1ac6b8ba",o.callServer,void 0,o.findSourceMapURL,"updateCashAccountAction"),u=(0,o.createServerReference)("609fff12b333f8481f6eaa00c9f6ed0ca7485d5f62",o.callServer,void 0,o.findSourceMapURL,"deleteCashAccountAction"),f=(0,o.createServerReference)("701a700c12f80accdeeab232d537f79439d8fe9e50",o.callServer,void 0,o.findSourceMapURL,"deleteCashAccountWithTransactionsAction"),h=(0,o.createServerReference)("60a22285198ef838d83b1b4a602809518cbd22267e",o.callServer,void 0,o.findSourceMapURL,"getCashAccountBalanceAction");e.s(["useCashAccounts",0,()=>{let[e,o]=(0,t.useState)([]),{toast:p}=(0,r.useToast)(),{currentBusiness:m}=(0,a.useBusiness)(),{user:v}=(0,i.useAuth)(),y=(0,c.useQueryClient)(),g=(0,t.useCallback)(async()=>{if(!m?.id)return[];try{let e=await n(m.id);if(!e.success||!e.data)throw Error(e.error||"Failed to fetch accounts");return e.data.map(e=>({...e,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)}))}catch(e){return console.error("Error loading cash accounts:",e),p({title:"Error",description:"Failed to load cash accounts",variant:"destructive"}),[]}},[m?.id,p]),b=["cash_accounts",m?.id],{data:S,isLoading:x}=(0,s.useQuery)({queryKey:b,queryFn:g,enabled:!!m?.id,staleTime:3e4});(0,t.useEffect)(()=>{S&&o(S)},[S]);let w=x&&!S,C=(0,t.useCallback)(()=>{y.invalidateQueries({queryKey:b})},[y,b]),j=(0,t.useCallback)(async e=>{if(!m?.id||!v?.id)return null;try{let t=await l({...e,userId:v.id,locationId:m.id});if(!t.success||!t.data)throw Error(t.error);return y.invalidateQueries({queryKey:b}),p({title:"Success",description:"Cash account created successfully"}),t.data}catch(e){return console.error("Error creating cash account:",e),p({title:"Error",description:"Failed to create cash account",variant:"destructive"}),null}},[m?.id,v?.id,y,b,p]),R=async(e,t)=>{if(!m?.id)return!1;try{let r=await d(e,{...t,locationId:m.id});if(!r.success)throw Error(r.error);return y.invalidateQueries({queryKey:b}),p({title:"Success",description:"Cash account updated successfully"}),!0}catch(e){return console.error("Error updating cash account:",e),p({title:"Error",description:"Failed to update cash account",variant:"destructive"}),!1}},N=async(e,t)=>{if(!m?.id)return{success:!1,hasTransactions:!1};try{let r=await u(e,m.id);return r.success&&(y.invalidateQueries({queryKey:b}),p({title:"Success",description:"Cash account deleted successfully"}),t&&t()),r}catch(e){return console.error("Error deleting cash account:",e),p({title:"Error",description:"Failed to delete cash account",variant:"destructive"}),{success:!1,hasTransactions:!1}}},k=async(e,t=!1,r)=>{if(!m?.id)return!1;try{let a=await f(e,m.id,t);if(!a.success)throw Error(a.error);return y.invalidateQueries({queryKey:b}),p({title:"Success",description:t?"Account and transactions deleted":"Account deleted (records unlinked)"}),r&&r(),!0}catch(e){return console.error("Error deleting cash account:",e),p({title:"Error",description:"Failed to delete cash account",variant:"destructive"}),!1}},E=(0,t.useCallback)(async e=>{if(!m?.id)return 0;try{let t=await h(e,m.id);if(t.success)return t.data;return 0}catch(e){return console.error("Error getting balance:",e),0}},[m?.id]);return(0,t.useMemo)(()=>({accounts:e,isLoading:w,createAccount:j,updateAccount:R,deleteAccount:N,deleteAccountWithTransactions:k,getAccountBalance:E,loadAccounts:g,refreshAccounts:C}),[e,w,j,R,N,k,E,g,C])}],966265)},98363,e=>{"use strict";var t=e.i(271645),r=e.i(102594),a=e.i(422713),i=e.i(908406),s=e.i(266027),c=e.i(912598);let o=e=>({id:e.id,accountId:e.account_id,amount:Number(e.amount),transactionType:e.transaction_type,category:e.category,description:e.description,personInCharge:e.person_in_charge,tags:e.tags,date:new Date(e.date),paymentMethod:e.payment_method,receiptImage:e.receipt_image,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)});var n=e.i(95187);let l=(0,n.createServerReference)("6050d5e4425dec9de12384682af8632685a43503f6",n.callServer,void 0,n.findSourceMapURL,"getCashTransactionsAction"),d=(0,n.createServerReference)("4064724fc471e698ee76d294a980e2a65c0a9c856a",n.callServer,void 0,n.findSourceMapURL,"createCashTransactionAction"),u=(0,n.createServerReference)("60e4c60d7aa378a229209542057eb77c66409f1850",n.callServer,void 0,n.findSourceMapURL,"updateCashTransactionAction"),f=(0,n.createServerReference)("605e333b82184dfc91eaa2d1fe6090163e41e2aa78",n.callServer,void 0,n.findSourceMapURL,"deleteCashTransactionAction"),h=(0,n.createServerReference)("60233cf66a8bd607780138afb600e5b4300ab3ce36",n.callServer,void 0,n.findSourceMapURL,"getAccountOpeningBalanceAction"),p=(0,n.createServerReference)("402f81bafe02611b5b5687b2b85c12e36ea9604ccf",n.callServer,void 0,n.findSourceMapURL,"createBulkCashTransactionsAction");e.s(["useCashTransactions",0,e=>{let{user:n}=(0,r.useAuth)(),{currentBusiness:m}=(0,a.useBusiness)(),{toast:v}=(0,i.useToast)(),y=(0,c.useQueryClient)(),g=(0,t.useCallback)(async()=>{try{if(!n||!m)return[];let t=await l(m.id,e);if(!t.success||!t.data)throw Error(t.error||"Failed to fetch transactions");let r=t.data.map(e=>{let t={id:e.id,user_id:e.user_id,account_id:e.account_id,amount:Number(e.amount),transaction_type:e.transaction_type,category:e.category,description:e.description,person_in_charge:e.person_in_charge,tags:e.tags,date:e.date,payment_method:e.payment_method,receipt_image:e.receipt_image,created_at:e.created_at,updated_at:e.updated_at};return o(t)});return r.sort((e,t)=>{let r=new Date(t.date).getTime()-new Date(e.date).getTime();return 0!==r?r:new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()}),r}catch(e){return console.error("Error loading cash transactions:",e),v({title:"Error",description:"Failed to load cash transactions",variant:"destructive"}),[]}},[n,m?.id,e,v]),b=(0,t.useMemo)(()=>["cash_transactions",m?.id,n?.id,e],[m?.id,n?.id,e]),{data:S=[],isLoading:x}=(0,s.useQuery)({queryKey:b,queryFn:g,enabled:!!n&&!!m?.id,staleTime:3e4}),w=x&&0===S.length,C=async e=>{try{if(!n||!m)throw Error("User not authenticated");let t=await d({...e,userId:n.id,locationId:m.id});if(!t.success)throw Error(t.error);return v({title:"Success",description:"transfer"===e.transactionType?"Transfer completed successfully":"Cash transaction created successfully"}),y.invalidateQueries({queryKey:b}),Array.isArray(t.data)?o(t.data[0]):o(t.data)}catch(e){throw console.error("Error creating cash transaction:",e),v({title:"Error",description:"Failed to create cash transaction",variant:"destructive"}),e}},j=async e=>{try{if(!n||!m)throw Error("User not authenticated");let t=e.map(e=>({...e,userId:n.id,locationId:m.id})),r=await p(t);if(!r.success)throw Error(r.error);return v({title:"Success",description:`Successfully created ${e.length} transactions`}),y.invalidateQueries({queryKey:b}),r.data.map(e=>o(e))}catch(e){throw console.error("Error creating bulk transactions:",e),v({title:"Error",description:"Failed to create bulk transactions",variant:"destructive"}),e}},R=async(e,t)=>{try{let r=await u(e,t);if(!r.success)throw Error(r.error);return v({title:"Success",description:"Transaction updated successfully"}),y.invalidateQueries({queryKey:b}),o(r.data)}catch(e){return console.error("Error updating cash transaction:",e),v({title:"Error",description:"Failed to update transaction",variant:"destructive"}),null}},N=async(e,t)=>{try{if(!m)throw Error("No business selected");let r=await f(e,m.id);if(!r.success)throw Error(r.error);return v({title:"Success",description:"Cash transaction deleted successfully"}),y.invalidateQueries({queryKey:b}),t&&t(),!0}catch(e){return console.error("Error deleting cash transaction:",e),v({title:"Error",description:"Failed to delete cash transaction",variant:"destructive"}),!1}},k=(0,t.useCallback)(async e=>{try{if(!m)return 0;let t=await h(e,m.id);return t.success?t.data:0}catch(e){return 0}},[m?.id]),E=(0,t.useCallback)(async(e,t)=>{let r=e.toISOString().split("T")[0],a=S.filter(e=>e.date.toISOString().split("T")[0]===r);t&&(a=a.filter(e=>e.accountId===t));let i=a.filter(e=>"cash_in"===e.transactionType||"transfer_in"===e.transactionType).reduce((e,t)=>e+t.amount,0),s=a.filter(e=>"cash_out"===e.transactionType||"transfer_out"===e.transactionType).reduce((e,t)=>e+t.amount,0),c=a.filter(e=>"transfer_in"===e.transactionType).reduce((e,t)=>e+t.amount,0),o=a.filter(e=>"transfer_out"===e.transactionType).reduce((e,t)=>e+t.amount,0),n=new Date(e);n.setDate(n.getDate()-1);let l=n.toISOString().split("T")[0],d=S.filter(e=>e.date.toISOString().split("T")[0]<=l);t&&(d=d.filter(e=>e.accountId===t));let u=d.filter(e=>"cash_in"===e.transactionType||"transfer_in"===e.transactionType).reduce((e,t)=>e+t.amount,0),f=d.filter(e=>"cash_out"===e.transactionType||"transfer_out"===e.transactionType).reduce((e,t)=>e+t.amount,0),h=0;t&&(h=await k(t));let p=h+u-f;return{date:e,openingBalance:p,cashIn:i,cashOut:s,transfersIn:c,transfersOut:o,closingBalance:p+i-s}},[S,k]),A=(0,t.useCallback)(async(e,t,r)=>{let a=e.toISOString().split("T")[0],i=t.toISOString().split("T")[0],s=S.filter(e=>{let t=e.date.toISOString().split("T")[0];return t>=a&&t<=i});r&&(s=s.filter(e=>e.accountId===r));let c=s.filter(e=>"cash_in"===e.transactionType||"transfer_in"===e.transactionType).reduce((e,t)=>e+t.amount,0),o=s.filter(e=>"cash_out"===e.transactionType||"transfer_out"===e.transactionType).reduce((e,t)=>e+t.amount,0),n=s.filter(e=>"transfer_in"===e.transactionType).reduce((e,t)=>e+t.amount,0),l=s.filter(e=>"transfer_out"===e.transactionType).reduce((e,t)=>e+t.amount,0),d=new Date(e);d.setDate(d.getDate()-1);let u=d.toISOString().split("T")[0],f=S.filter(e=>e.date.toISOString().split("T")[0]<=u);r&&(f=f.filter(e=>e.accountId===r));let h=f.filter(e=>"cash_in"===e.transactionType||"transfer_in"===e.transactionType).reduce((e,t)=>e+t.amount,0),p=f.filter(e=>"cash_out"===e.transactionType||"transfer_out"===e.transactionType).reduce((e,t)=>e+t.amount,0),m=0;r&&(m=await k(r));let v=m+h-p;return{date:e,openingBalance:v,cashIn:c,cashOut:o,transfersIn:n,transfersOut:l,closingBalance:v+c-o}},[S,k]),I=(0,t.useCallback)(()=>{y.invalidateQueries({queryKey:b})},[y,b]);return(0,t.useMemo)(()=>({transactions:S,isLoading:w,createTransaction:C,createBulkTransactions:j,updateTransaction:R,deleteTransaction:N,getDailySummary:E,getDateRangeSummary:A,refreshTransactions:I}),[S,w,C,j,R,N,E,A,I])}],98363)},618566,(e,t,r)=>{t.exports=e.r(976562)},830999,e=>{"use strict";var t=e.i(271645),r=e.i(422713),a=e.i(908406),i=e.i(102594),s=e.i(95187);let c=(0,s.createServerReference)("40d192c7133b72d6eb22105e9bdccca4dd09d6c312",s.callServer,void 0,s.findSourceMapURL,"getSalesCategoriesAction"),o=(0,s.createServerReference)("78f34606537592502556e5eff8bf435c75821848df",s.callServer,void 0,s.findSourceMapURL,"createSalesCategoryAction"),n=(0,s.createServerReference)("601c76a41759792ff7ede8d55df9ffa468b0da22c2",s.callServer,void 0,s.findSourceMapURL,"updateSalesCategoryAction"),l=(0,s.createServerReference)("4048df543ea89e6b499e78c5496b2ff9ac8b3367ff",s.callServer,void 0,s.findSourceMapURL,"deleteSalesCategoryAction");e.s(["useSalesCategories",0,()=>{let[e,s]=(0,t.useState)([]),[d,u]=(0,t.useState)(!0),{currentBusiness:f}=(0,r.useBusiness)(),{user:h}=(0,i.useAuth)(),p=async()=>{if(!f){s([]),u(!1);return}try{let e=await c(f.id);if(e.success&&e.data)s(e.data);else throw Error(e.error)}catch(e){console.error("Error fetching sales categories:",e),(0,a.toast)({title:"Error",description:"Failed to fetch sales categories",variant:"destructive"})}finally{u(!1)}};return(0,t.useEffect)(()=>{p()},[f]),{categories:e,isLoading:d,createCategory:async e=>{if(!f||!h)return(0,a.toast)({title:"Error",description:"No business selected or user not authenticated",variant:"destructive"}),!1;try{let t=await o(f.id,h.id,e);if(t.success)return(0,a.toast)({title:"Success",description:"Sales category created successfully"}),p(),!0;throw Error(t.error)}catch(e){return console.error("Error creating sales category:",e),(0,a.toast)({title:"Error",description:"Failed to create sales category",variant:"destructive"}),!1}},updateCategory:async(e,t)=>{try{let r=await n(e,t);if(r.success)return(0,a.toast)({title:"Success",description:"Sales category updated successfully"}),p(),!0;throw Error(r.error)}catch(e){return console.error("Error updating sales category:",e),(0,a.toast)({title:"Error",description:"Failed to update sales category",variant:"destructive"}),!1}},deleteCategory:async e=>{try{let t=await l(e);if(t.success)return(0,a.toast)({title:"Success",description:"Sales category deleted successfully"}),p(),!0;throw Error(t.error)}catch(e){return console.error("Error deleting sales category:",e),(0,a.toast)({title:"Error",description:"Failed to delete sales category",variant:"destructive"}),!1}},createDefaultCategories:async()=>{if(f&&h)try{for(let e of["Retail","Online","Wholesale"])await o(f.id,h.id,e,!0);p()}catch(e){console.error("Error creating default categories:",e)}},refetch:p}}],830999)},39725,e=>{"use strict";var t=e.i(271645),r=e.i(908406),a=e.i(422713),i=e.i(457786),s=e.i(266027),c=e.i(912598),o=e.i(95187);let n=(0,o.createServerReference)("40227d1c2ed5cbf6324cf519682235031f0a3138a5",o.callServer,void 0,o.findSourceMapURL,"getCustomersAction"),l=(0,o.createServerReference)("708938753470d59bd6fa4ddf41a8a3581263dd393b",o.callServer,void 0,o.findSourceMapURL,"createCustomerAction"),d=(0,o.createServerReference)("609ad415d8b556837c750a19320a30ea6d4beaf896",o.callServer,void 0,o.findSourceMapURL,"updateCustomerAction"),u=(0,o.createServerReference)("40f9d32b0ea15e5c8f0b3441eec79ddb30815f1c83",o.callServer,void 0,o.findSourceMapURL,"deleteCustomerAction");var f=e.i(102594);e.s(["useCustomers",0,(e=50)=>{let[o,h]=(0,t.useState)([]),[p,m]=(0,t.useState)(1),[v,y]=(0,t.useState)(e),[g,b]=(0,t.useState)(0),{toast:S}=(0,r.useToast)(),{currentBusiness:x}=(0,a.useBusiness)(),{user:w}=(0,f.useAuth)(),{logActivity:C}=(0,i.useActivityLogger)(),j=(0,c.useQueryClient)(),R=(0,t.useCallback)(async()=>{if(!x)return{customers:[],count:0};try{let e=await n(x.id);if(!e.success)throw Error(e.error);return{customers:(e.data?.customers||[]).map(e=>({id:e.id,fullName:e.fullName||e.name,phoneNumber:e.phoneNumber||e.phone,email:e.email,birthday:e.birthday?new Date(e.birthday):null,gender:e.gender,location:e.location||e.address,categoryId:e.categoryId,notes:e.notes,tags:e.tags,socialMedia:e.socialMedia||null,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)})),count:e.data?.count||0}}catch(e){return console.error("Error loading customers:",e),S({title:"Error",description:"Failed to load customers. Please try again.",variant:"destructive"}),{customers:[],count:0}}},[x?.id,S]),N=["customers",x?.id],{data:k,isLoading:E,isFetching:A}=(0,s.useQuery)({queryKey:N,queryFn:R,enabled:!!x?.id,staleTime:3e5,gcTime:18e5,refetchOnWindowFocus:!1,refetchOnReconnect:!1});(0,t.useEffect)(()=>{k&&(h(k.customers),b(k.count))},[k]);let I=async e=>{if(!x)return S({title:"Error",description:"No business selected",variant:"destructive"}),null;try{if(!w)throw Error("User not authenticated");let t={fullName:e.fullName,phoneNumber:e.phoneNumber||null,email:e.email||null,birthday:e.birthday?.toISOString().split("T")[0]||null,gender:e.gender||null,location:e.location||null,categoryId:e.categoryId||null,notes:e.notes||null,tags:e.tags||null,socialMedia:e.socialMedia||null},r=await l(x.id,w.id,t);if(!r.success||!r.data)throw Error(r.error||"Failed to create customer");let a=r.data,i={id:a.id,fullName:a.name||a.fullName,phoneNumber:a.phone||a.phoneNumber,email:a.email,birthday:a.birthday?new Date(a.birthday):null,gender:a.gender,location:a.address||a.location,categoryId:a.categoryId,notes:a.notes,tags:a.tags,socialMedia:a.socialMedia,createdAt:new Date(a.createdAt),updatedAt:new Date(a.updatedAt)};return h(e=>[i,...e]),b(e=>e+1),j.setQueryData(N,e=>e?{customers:[i,...e.customers],count:(e.count||0)+1}:{customers:[i],count:1}),await C({activityType:"CREATE",module:"CUSTOMERS",entityType:"customer",entityId:a.id,entityName:e.fullName,description:`Created customer "${e.fullName}"`,metadata:{phoneNumber:e.phoneNumber,email:e.email,location:e.location}}),S({title:"Success",description:"Customer created successfully"}),a}catch(e){return console.error("Error creating customer:",e),S({title:"Error",description:"Failed to create customer. Please try again.",variant:"destructive"}),null}},T=async(e,t)=>{try{let r={};void 0!==t.fullName&&(r.fullName=t.fullName),void 0!==t.phoneNumber&&(r.phoneNumber=t.phoneNumber),void 0!==t.email&&(r.email=t.email),void 0!==t.birthday&&(r.birthday=t.birthday?.toISOString()),void 0!==t.gender&&(r.gender=t.gender),void 0!==t.location&&(r.location=t.location),void 0!==t.categoryId&&(r.categoryId=t.categoryId),void 0!==t.notes&&(r.notes=t.notes),void 0!==t.tags&&(r.tags=t.tags),void 0!==t.socialMedia&&(r.socialMedia=t.socialMedia);let a=await d(e,r);if(!a.success)throw Error(a.error||"Failed to update customer");h(r=>r.map(r=>r.id===e?{...r,...t}:r)),j.setQueryData(N,r=>r?{...r,customers:r.customers.map(r=>r.id===e?{...r,...t}:r)}:r);let i=o.find(t=>t.id===e);return i&&await C({activityType:"UPDATE",module:"CUSTOMERS",entityType:"customer",entityId:e,entityName:i.fullName,description:`Updated customer "${i.fullName}"`,metadata:{updates:t}}),S({title:"Success",description:"Customer updated successfully"}),!0}catch(e){return console.error("Error updating customer:",e),S({title:"Error",description:"Failed to update customer. Please try again.",variant:"destructive"}),!1}},M=async e=>{try{let t=o.find(t=>t.id===e),r=await u(e);if(!r.success)throw Error(r.error||"Failed to delete customer");return h(t=>t.filter(t=>t.id!==e)),b(e=>Math.max(0,e-1)),j.setQueryData(N,t=>{if(!t)return t;let{customers:r,count:a}=t;return{customers:r.filter(t=>t.id!==e),count:Math.max(0,(a||0)-1)}}),j.invalidateQueries({queryKey:N}),t&&await C({activityType:"DELETE",module:"CUSTOMERS",entityType:"customer",entityId:e,entityName:t.fullName,description:`Deleted customer "${t.fullName}"`,metadata:{phoneNumber:t.phoneNumber,email:t.email}}),S({title:"Success",description:"Customer deleted successfully"}),!0}catch(e){return console.error("Error deleting customer:",e),S({title:"Error",description:"Failed to delete customer. Please try again.",variant:"destructive"}),!1}};return{customers:o,isLoading:E&&!k,createCustomer:I,addCustomer:I,updateCustomer:T,deleteCustomer:M,loadCustomers:R,page:p,setPage:m,pageSize:v,setPageSize:y,totalCount:g}}],39725)},903711,e=>{"use strict";var t=e.i(95187);let r=(0,t.createServerReference)("605a5ac8c70aa01eb0dd29483cb3c24316ae309de0",t.callServer,void 0,t.findSourceMapURL,"getProductReconciliationAction");e.s(["getProductReconciliationAction",()=>r])},37451,172720,489855,933289,e=>{"use strict";var t=e.i(95187);let r=(0,t.createServerReference)("6055d418bbb34217108fb09f6c6e07a1977765bffb",t.callServer,void 0,t.findSourceMapURL,"getStockHistoryAction");e.s(["getStockHistoryAction",()=>r],37451);let a=(0,t.createServerReference)("60b4fb287dfbc2b628cca363587f00d76a36f3623b",t.callServer,void 0,t.findSourceMapURL,"recalculateStockChainAction");e.s(["recalculateStockChainAction",()=>a],172720);let i=(0,t.createServerReference)("60428e59105c2448bb202e52e31bf2d4492d8468f7",t.callServer,void 0,t.findSourceMapURL,"deleteStockHistoryEntriesByReferenceAction");e.s(["deleteStockHistoryEntriesByReferenceAction",()=>i],489855);let s=(0,t.createServerReference)("70e0c90d8c965637b3ae61b1f0dd8fc9a41ea083d6",t.callServer,void 0,t.findSourceMapURL,"updateStockHistoryDatesByReferenceAction");e.s(["updateStockHistoryDatesByReferenceAction",()=>s],933289)},960014,e=>{"use strict";var t=e.i(95187);let r=(0,t.createServerReference)("7022b270c26116cc720c0fe09926fa8749c32b0ea9",t.callServer,void 0,t.findSourceMapURL,"getStockSummaryReportAction");e.s(["getStockSummaryReportAction",()=>r])},654550,e=>{"use strict";var t=e.i(95187);let r=(0,t.createServerReference)("40193ce83d40b7dbf7c2991866f6d090da71bf2f59",t.callServer,void 0,t.findSourceMapURL,"createStockHistoryAction");e.s(["createStockHistoryAction",()=>r])},634076,e=>{"use strict";var t=e.i(95187);let r=(0,t.createServerReference)("406e0d925bc965618c40bddb0b2011bea951e9b025",t.callServer,void 0,t.findSourceMapURL,"getStockRepairsPreviewAction");e.s(["getStockRepairsPreviewAction",()=>r])},752304,e=>{"use strict";var t=e.i(95187);let r=(0,t.createServerReference)("60a33152b65e6ef5593ff2b5c1d0a77d09216fe7e5",t.callServer,void 0,t.findSourceMapURL,"repairStockChainsAction");e.s(["repairStockChainsAction",()=>r])},598130,390326,872716,656080,e=>{"use strict";var t=e.i(95187);let r=(0,t.createServerReference)("60048cacdf8f6ab02d12e637338fb3a82838e3ab18",t.callServer,void 0,t.findSourceMapURL,"getRequisitionsAction");e.s(["getRequisitionsAction",()=>r],598130);let a=(0,t.createServerReference)("40e343dbe89cc3fb8304b10c9c62480d17ad426333",t.callServer,void 0,t.findSourceMapURL,"createRequisitionAction");e.s(["createRequisitionAction",()=>a],390326);let i=(0,t.createServerReference)("701e152aafbc4d4daee38965467b93e083a6e967b4",t.callServer,void 0,t.findSourceMapURL,"updateRequisitionAction");e.s(["updateRequisitionAction",()=>i],872716);let s=(0,t.createServerReference)("605622308fa711a2f7465dc0a63c7e00dbe7c0418e",t.callServer,void 0,t.findSourceMapURL,"deleteRequisitionAction");e.s(["deleteRequisitionAction",()=>s],656080)},532436,712654,e=>{"use strict";var t=e.i(95187);let r=(0,t.createServerReference)("4035262824370ccd2af8788671f3cc8435d165a93b",t.callServer,void 0,t.findSourceMapURL,"getActivityByEntityIdsAction");e.s(["getActivityByEntityIdsAction",()=>r],532436);let a=(0,t.createServerReference)("60eb8a3f21a0957ca35a2a3606c2b8e1d21977469d",t.callServer,void 0,t.findSourceMapURL,"updateStockHistoryDatesAction");e.s(["updateStockHistoryDatesAction",()=>a],712654)},230994,e=>{"use strict";e.s([],264041),e.i(264041),e.i(37451),e.i(654550),e.i(172720),e.i(489855),e.i(933289),e.i(598130),e.i(390326),e.i(872716),e.i(656080),e.i(960014),e.i(903711),e.i(634076),e.i(752304),e.i(532436),e.i(712654);var t=e.i(349479);let r=async e=>{try{if(!e)return console.error("Location ID is required for receipt number generation"),"000001";let r=await (0,t.getNextReceiptNumberAction)(e);if(r.success&&r.data)return r.data;return console.error("Error generating receipt number:",r.error),"000001"}catch(e){return console.error("Error generating receipt number:",e),"000001"}};e.s(["generateReceiptNumber",0,r],230994)},965901,e=>{"use strict";var t=e.i(271645),r=e.i(422713),a=e.i(908406),i=e.i(102594),s=e.i(95187);let c=(0,s.createServerReference)("40696a4456c7690d29b12ef602356cbc9be3c34a97",s.callServer,void 0,s.findSourceMapURL,"getCustomerCategoriesAction"),o=(0,s.createServerReference)("70b04375c8b1e7a5a64b19d8153628c90f1150c267",s.callServer,void 0,s.findSourceMapURL,"createCustomerCategoryAction"),n=(0,s.createServerReference)("605890db4ca201299b68a3100db491232317cf530d",s.callServer,void 0,s.findSourceMapURL,"updateCustomerCategoryAction"),l=(0,s.createServerReference)("4032dd367fa6b4bfc08062e47a1ca2ffb5e5eb04b0",s.callServer,void 0,s.findSourceMapURL,"deleteCustomerCategoryAction");e.s(["useCustomerCategories",0,()=>{let[e,s]=(0,t.useState)([]),[d,u]=(0,t.useState)(!0),{currentBusiness:f}=(0,r.useBusiness)(),{user:h}=(0,i.useAuth)(),p=async()=>{if(!f){s([]),u(!1);return}try{let e=await c(f.id);if(e.success&&e.data)s(e.data);else throw Error(e.error)}catch(e){console.error("Error fetching customer categories:",e),(0,a.toast)({title:"Error",description:"Failed to fetch customer categories",variant:"destructive"})}finally{u(!1)}};return(0,t.useEffect)(()=>{p()},[f]),{categories:e,isLoading:d,createCategory:async e=>{if(!f||!h)return(0,a.toast)({title:"Error",description:"No business selected or user not authenticated",variant:"destructive"}),!1;try{let t=await o(f.id,h.id,e);if(t.success)return(0,a.toast)({title:"Success",description:"Customer category created successfully"}),p(),!0;throw Error(t.error)}catch(e){return console.error("Error creating customer category:",e),(0,a.toast)({title:"Error",description:"Failed to create customer category",variant:"destructive"}),!1}},updateCategory:async(e,t)=>{try{let r=await n(e,t);if(r.success)return(0,a.toast)({title:"Success",description:"Customer category updated successfully"}),p(),!0;throw Error(r.error)}catch(e){return console.error("Error updating customer category:",e),(0,a.toast)({title:"Error",description:"Failed to update customer category",variant:"destructive"}),!1}},deleteCategory:async e=>{try{let t=await l(e);if(t.success)return(0,a.toast)({title:"Success",description:"Customer category deleted successfully"}),p(),!0;throw Error(t.error)}catch(e){return console.error("Error deleting customer category:",e),(0,a.toast)({title:"Error",description:"Failed to delete customer category",variant:"destructive"}),!1}},refetch:p}}],965901)},283627,e=>{"use strict";let t=(0,e.i(475254).default)("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);e.s(["Edit3",()=>t],283627)},221345,e=>{"use strict";let t=(0,e.i(475254).default)("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);e.s(["Link",()=>t],221345)},375050,e=>{"use strict";var t=e.i(843476),r=e.i(271645),a=e.i(793479),i=e.i(110204),s=e.i(624687),c=e.i(519455),o=e.i(87316),n=e.i(227766),l=e.i(337822),d=e.i(967489),u=e.i(401851),f=e.i(487486),h=e.i(37727),p=e.i(975157),m=e.i(653145),v=e.i(776639),y=e.i(965901);e.s(["default",0,({initialData:e,onSubmit:g,onCancel:b})=>{let[S,x]=r.default.useState(!1),{categories:w}=(0,y.useCustomerCategories)(),[C,j]=r.default.useState(()=>{if(e?.birthday)return console.log("Initial birthday from props:",e.birthday),e.birthday}),[R,N]=r.default.useState(e?.categoryId||"none");r.default.useEffect(()=>{e?.birthday&&(console.log("Initial birthday from props:",e.birthday),console.log("Is Date object:",e.birthday instanceof Date),console.log("Date string:",e.birthday.toString()))},[e?.birthday]);let[k,E]=r.default.useState({facebook:e?.socialMedia?.facebook||"",instagram:e?.socialMedia?.instagram||"",twitter:e?.socialMedia?.twitter||"",linkedin:e?.socialMedia?.linkedin||"",other:e?.socialMedia?.other||""}),[A,I]=r.default.useState(e?.tags||[]),[T,M]=r.default.useState(""),[L,D]=r.default.useState(e?.gender||""),{register:U,handleSubmit:_,formState:{errors:F}}=(0,m.useForm)({defaultValues:{fullName:e?.fullName||"",email:e?.email||"",phoneNumber:e?.phoneNumber||"",location:e?.location||"",gender:e?.gender||"",notes:e?.notes||""}}),P=()=>{""===T.trim()||A.includes(T.trim())||(I([...A,T.trim()]),M(""))},B=(e,t)=>{E({...k,[t]:e.target.value})},O=async e=>{x(!0);try{console.log("Selected date before submission:",C);let t={...e,gender:L,birthday:C,categoryId:"none"===R?null:R,socialMedia:Object.keys(k).length>0?k:null,tags:A.length>0?A:null};console.log("Submitting customer data:",t),await g(t)}finally{x(!1)}},Q=new Date().getFullYear(),H=Array.from({length:100},(e,t)=>Q-t),q=[{value:0,label:"January"},{value:1,label:"February"},{value:2,label:"March"},{value:3,label:"April"},{value:4,label:"May"},{value:5,label:"June"},{value:6,label:"July"},{value:7,label:"August"},{value:8,label:"September"},{value:9,label:"October"},{value:10,label:"November"},{value:11,label:"December"}],V=e=>{if(console.log("Date selected from calendar:",e),e){let t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),12,0,0));console.log("Corrected date with UTC noon:",t),j(t)}else j(void 0)},$=e=>{try{let t=parseInt(e),r=C?new Date(C):new Date,a=new Date(Date.UTC(t,r.getMonth(),r.getDate(),12,0,0));isNaN(a.getTime())?console.error("Invalid date after setting year:",e):(j(a),console.log("Year selected, new date:",a))}catch(e){console.error("Error setting year:",e)}},Y=e=>{try{let t=parseInt(e),r=C?new Date(C):new Date,a=new Date(Date.UTC(r.getFullYear(),t,r.getDate(),12,0,0));isNaN(a.getTime())?console.error("Invalid date after setting month:",e):(j(a),console.log("Month selected, new date:",a))}catch(e){console.error("Error setting month:",e)}},K=w.filter(e=>e.id&&""!==e.id.trim());return(0,t.jsx)("form",{onSubmit:_(O),children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{htmlFor:"fullName",children:"Full Name*"}),(0,t.jsx)(a.Input,{id:"fullName",...U("fullName",{required:"Name is required"}),className:(0,p.cn)(F.fullName&&"border-red-500")}),F.fullName&&(0,t.jsx)("p",{className:"text-red-500 text-xs",children:F.fullName.message})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{htmlFor:"category",children:"Category"}),(0,t.jsxs)(d.Select,{value:R,onValueChange:N,children:[(0,t.jsx)(d.SelectTrigger,{id:"category",children:(0,t.jsx)(d.SelectValue,{placeholder:"Select category"})}),(0,t.jsxs)(d.SelectContent,{children:[(0,t.jsx)(d.SelectItem,{value:"none",children:"No Category"}),K.map(e=>(0,t.jsx)(d.SelectItem,{value:e.id,children:e.name},e.id))]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{htmlFor:"email",children:"Email Address"}),(0,t.jsx)(a.Input,{id:"email",type:"email",...U("email",{pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Invalid email address"}}),className:(0,p.cn)(F.email&&"border-red-500")}),F.email&&(0,t.jsx)("p",{className:"text-red-500 text-xs",children:F.email.message})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{htmlFor:"phoneNumber",children:"Phone Number"}),(0,t.jsx)(a.Input,{id:"phoneNumber",...U("phoneNumber")})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{htmlFor:"location",children:"Location"}),(0,t.jsx)(a.Input,{id:"location",...U("location")})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{htmlFor:"gender",children:"Gender"}),(0,t.jsxs)(d.Select,{value:L,onValueChange:D,children:[(0,t.jsx)(d.SelectTrigger,{id:"gender",children:(0,t.jsx)(d.SelectValue,{placeholder:"Select gender"})}),(0,t.jsxs)(d.SelectContent,{children:[(0,t.jsx)(d.SelectItem,{value:"male",children:"Male"}),(0,t.jsx)(d.SelectItem,{value:"female",children:"Female"}),(0,t.jsx)(d.SelectItem,{value:"non-binary",children:"Non-binary"}),(0,t.jsx)(d.SelectItem,{value:"prefer-not-to-say",children:"Prefer not to say"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{children:"Birthday"}),(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)(l.Popover,{children:[(0,t.jsx)(l.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)(c.Button,{variant:"outline",className:"w-full justify-between",children:[C?C.getDate():"Day",(0,t.jsx)(o.Calendar,{className:"h-4 w-4 opacity-50"})]})}),(0,t.jsx)(l.PopoverContent,{className:"w-auto p-0",align:"start",children:(0,t.jsx)(n.Calendar,{mode:"single",selected:C,onSelect:V,initialFocus:!0,captionLayout:"buttons",className:"p-3 pointer-events-auto",classNames:{caption_label:"hidden",dropdown:"hidden"}})})]})}),(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)(d.Select,{value:C?String(C.getMonth()):void 0,onValueChange:Y,children:[(0,t.jsx)(d.SelectTrigger,{children:(0,t.jsx)(d.SelectValue,{placeholder:"Month"})}),(0,t.jsx)(d.SelectContent,{children:q.map(e=>(0,t.jsx)(d.SelectItem,{value:String(e.value),children:e.label},e.value))})]})}),(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)(d.Select,{value:C?String(C.getFullYear()):void 0,onValueChange:$,children:[(0,t.jsx)(d.SelectTrigger,{children:(0,t.jsx)(d.SelectValue,{placeholder:"Year"})}),(0,t.jsx)(d.SelectContent,{children:H.map(e=>(0,t.jsx)(d.SelectItem,{value:String(e),children:e},e))})]})})]}),C&&(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Selected: ",C?(0,u.format)(C,"PPP"):"No date selected"]})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{children:"Tags"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1 mb-2",children:A.map(e=>(0,t.jsxs)(f.Badge,{variant:"secondary",children:[e,(0,t.jsxs)("button",{type:"button",className:"ml-1 rounded-full hover:bg-gray-200",onClick:()=>{I(A.filter(t=>t!==e))},children:[(0,t.jsx)(h.X,{className:"h-3 w-3"}),(0,t.jsx)("span",{className:"sr-only",children:"Remove tag"})]})]},e))}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(a.Input,{value:T,onChange:e=>M(e.target.value),placeholder:"Add tag",onKeyDown:e=>"Enter"===e.key&&(e.preventDefault(),P())}),(0,t.jsx)(c.Button,{type:"button",onClick:P,variant:"outline",children:"Add"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{children:"Social Media"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)(i.Label,{htmlFor:"facebook",className:"text-xs",children:"Facebook"}),(0,t.jsx)(a.Input,{id:"facebook",value:k.facebook,onChange:e=>B(e,"facebook"),placeholder:"Username or URL"})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)(i.Label,{htmlFor:"instagram",className:"text-xs",children:"Instagram"}),(0,t.jsx)(a.Input,{id:"instagram",value:k.instagram,onChange:e=>B(e,"instagram"),placeholder:"Username without @"})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)(i.Label,{htmlFor:"twitter",className:"text-xs",children:"Twitter/X"}),(0,t.jsx)(a.Input,{id:"twitter",value:k.twitter,onChange:e=>B(e,"twitter"),placeholder:"Username without @"})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)(i.Label,{htmlFor:"linkedin",className:"text-xs",children:"LinkedIn"}),(0,t.jsx)(a.Input,{id:"linkedin",value:k.linkedin,onChange:e=>B(e,"linkedin"),placeholder:"Profile URL or username"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{children:"Birthday"}),(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)(l.Popover,{children:[(0,t.jsx)(l.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)(c.Button,{variant:"outline",className:"w-full justify-between",children:[C?C.getDate():"Day",(0,t.jsx)(o.Calendar,{className:"h-4 w-4 opacity-50"})]})}),(0,t.jsx)(l.PopoverContent,{className:"w-auto p-0",align:"start",children:(0,t.jsx)(n.Calendar,{mode:"single",selected:C,onSelect:V,initialFocus:!0,captionLayout:"buttons",className:"p-3 pointer-events-auto",classNames:{caption_label:"hidden",dropdown:"hidden"}})})]})}),(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)(d.Select,{value:C?String(C.getMonth()):void 0,onValueChange:Y,children:[(0,t.jsx)(d.SelectTrigger,{children:(0,t.jsx)(d.SelectValue,{placeholder:"Month"})}),(0,t.jsx)(d.SelectContent,{children:q.map(e=>(0,t.jsx)(d.SelectItem,{value:String(e.value),children:e.label},e.value))})]})}),(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)(d.Select,{value:C?String(C.getFullYear()):void 0,onValueChange:$,children:[(0,t.jsx)(d.SelectTrigger,{children:(0,t.jsx)(d.SelectValue,{placeholder:"Year"})}),(0,t.jsx)(d.SelectContent,{children:H.map(e=>(0,t.jsx)(d.SelectItem,{value:String(e),children:e},e))})]})})]}),C&&(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Selected: ",C?(0,u.format)(C,"PPP"):"No date selected"]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{htmlFor:"notes",children:"Notes"}),(0,t.jsx)(s.Textarea,{id:"notes",...U("notes"),rows:4,placeholder:"Add any notes about this customer..."})]}),(0,t.jsxs)(v.DialogFooter,{children:[(0,t.jsx)(c.Button,{variant:"outline",type:"button",onClick:b,children:"Cancel"}),(0,t.jsx)(c.Button,{type:"submit",disabled:S,children:S?"Saving...":"Save Changes"})]})]})})}])},639054,e=>{"use strict";var t=e.i(843476),r=e.i(776639),a=e.i(375050),i=e.i(759684);e.s(["default",0,({open:e,onClose:s,onAddCustomer:c,initialData:o})=>{let n=async e=>(c(e),!0),l=!!o;return(0,t.jsx)(r.Dialog,{open:e,onOpenChange:s,children:(0,t.jsxs)(r.DialogContent,{className:"max-w-2xl max-h-[90vh]",children:[(0,t.jsxs)(r.DialogHeader,{children:[(0,t.jsx)(r.DialogTitle,{children:l?"Edit Customer":"Add New Customer"}),(0,t.jsx)(r.DialogDescription,{children:"Fill in the customer details below. Only name is required."})]}),(0,t.jsx)(i.ScrollArea,{className:"h-[calc(80vh-8rem)]",children:(0,t.jsx)("div",{className:"px-1",children:(0,t.jsx)(a.default,{onSubmit:n,onCancel:s,initialData:o})})})]})})}])},386651,e=>{"use strict";var t=e.i(843476),r=e.i(271645),a=e.i(904792),i=e.i(102594),s=e.i(160615),c=e.i(422713),o=e.i(289844),n=e.i(349609),l=e.i(197704),d=e.i(611747),u=e.i(365722),f=e.i(630680),h=e.i(777624),p=e.i(63209),m=e.i(929592),v=e.i(519455);e.s(["default",0,()=>{let e=(0,a.useNavigate)(),y=(0,a.useLocation)(),{user:g}=(0,i.useAuth)(),{settings:b}=(0,s.useBusinessSettings)(),{currentBusiness:S,isLoading:x}=(0,c.useBusiness)(),{hasPermission:w,isLoading:C}=(0,h.useProfiles)(),j=y.state?.editSale,[R,N]=r.default.useState(0),k=r.default.useCallback(()=>{N(e=>e+1)},[]),{showDraftNotification:E,draftData:A,handleLoadDraft:I,handleDismissDraft:T,clearDraft:M}=(0,o.useNewSaleDraft)(j),{isReceiptOpen:L,completedSale:D,newCustomerDialogOpen:U,includePaymentInfo:_,customers:F,handleSaleComplete:P,handleReceiptClose:B,handleAddCustomer:O,handleOpenNewCustomerDialog:Q,setNewCustomerDialogOpen:H}=(0,n.useNewSaleActions)(j,k);if(x||C)return(0,t.jsx)(l.default,{});if(!S)return(0,t.jsx)(d.default,{});let q=!j||w("sales","edit"),V=!!j||w("sales","create");return q&&V?(0,t.jsxs)("div",{className:"max-w-4xl mx-auto",children:[!g&&(0,t.jsx)(u.default,{}),(0,t.jsx)(f.default,{editSale:j,currency:b.currency,showDraftNotification:E,draftData:A,onLoadDraft:I,onDismissDraft:T,onSaleComplete:(e,t,r,a,i,s,c)=>P(e,t,r,a,M||i,s,c),onClearDraft:M,customers:F||[],onAddNewCustomer:Q,isReceiptOpen:L,completedSale:D,includePaymentInfo:_,onReceiptClose:B,newCustomerDialogOpen:U,onCloseNewCustomerDialog:()=>H(!1),onAddCustomer:O},R)]}):(0,t.jsxs)("div",{className:"max-w-4xl mx-auto p-6",children:[(0,t.jsxs)(m.Alert,{variant:"destructive",children:[(0,t.jsx)(p.AlertCircle,{className:"h-4 w-4"}),(0,t.jsx)(m.AlertTitle,{children:"Access Denied"}),(0,t.jsxs)(m.AlertDescription,{children:["You do not have permission to ",j?"edit this sale":"create a new sale",". Please contact your administrator if you believe this is an error."]})]}),(0,t.jsx)("div",{className:"mt-4",children:(0,t.jsx)(v.Button,{onClick:()=>e("/sales"),variant:"outline",children:"Back to Sales"})})]})}])},559216,e=>{e.v(t=>Promise.all(["static/chunks/a76007d487b7285f.js"].map(t=>e.l(t))).then(()=>t(65054)))},569521,e=>{e.v(t=>Promise.all(["static/chunks/45728a0ccba874c7.js"].map(t=>e.l(t))).then(()=>t(981474)))},48503,e=>{e.v(t=>Promise.all(["static/chunks/034945ea23f7a8ce.js"].map(t=>e.l(t))).then(()=>t(915833)))},870653,e=>{e.v(t=>Promise.all(["static/chunks/63eee2351f5394d5.js"].map(t=>e.l(t))).then(()=>t(424154)))},195111,e=>{e.v(t=>Promise.all(["static/chunks/f66634c84e3526bd.js"].map(t=>e.l(t))).then(()=>t(38201)))},210699,e=>{e.v(t=>Promise.all(["static/chunks/11539ca7394ee4b6.js","static/chunks/034945ea23f7a8ce.js"].map(t=>e.l(t))).then(()=>t(53945)))},756667,e=>{e.v(e=>Promise.resolve().then(()=>e(804760)))}]);