(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,388474,e=>{"use strict";var t=e.i(271645),r=e.i(820783),a=e.i(30030),s=e.i(981140),i=e.i(369340),n=e.i(999682),o=e.i(635804),c=e.i(296626),l=e.i(248425),d=e.i(843476),u="Checkbox",[m,f]=(0,a.createContextScope)(u),[p,h]=m(u);function g(e){let{__scopeCheckbox:r,checked:a,children:s,defaultChecked:n,disabled:o,form:c,name:l,onCheckedChange:m,required:f,value:h="on",internal_do_not_use_render:g}=e,[y,x]=(0,i.useControllableState)({prop:a,defaultProp:n??!1,onChange:m,caller:u}),[b,v]=t.useState(null),[S,w]=t.useState(null),C=t.useRef(!1),N=!b||!!c||!!b.closest("form"),T={checked:y,disabled:o,setChecked:x,control:b,setControl:v,name:l,form:c,value:h,hasConsumerStoppedPropagationRef:C,required:f,defaultChecked:!j(n)&&n,isFormControl:N,bubbleInput:S,setBubbleInput:w};return(0,d.jsx)(p,{scope:r,...T,children:"function"==typeof g?g(T):s})}var y="CheckboxTrigger",x=t.forwardRef(({__scopeCheckbox:e,onKeyDown:a,onClick:i,...n},o)=>{let{control:c,value:u,disabled:m,checked:f,required:p,setControl:g,setChecked:x,hasConsumerStoppedPropagationRef:b,isFormControl:v,bubbleInput:S}=h(y,e),w=(0,r.useComposedRefs)(o,g),C=t.useRef(f);return t.useEffect(()=>{let e=c?.form;if(e){let t=()=>x(C.current);return e.addEventListener("reset",t),()=>e.removeEventListener("reset",t)}},[c,x]),(0,d.jsx)(l.Primitive.button,{type:"button",role:"checkbox","aria-checked":j(f)?"mixed":f,"aria-required":p,"data-state":N(f),"data-disabled":m?"":void 0,disabled:m,value:u,...n,ref:w,onKeyDown:(0,s.composeEventHandlers)(a,e=>{"Enter"===e.key&&e.preventDefault()}),onClick:(0,s.composeEventHandlers)(i,e=>{x(e=>!!j(e)||!e),S&&v&&(b.current=e.isPropagationStopped(),b.current||e.stopPropagation())})})});x.displayName=y;var b=t.forwardRef((e,t)=>{let{__scopeCheckbox:r,name:a,checked:s,defaultChecked:i,required:n,disabled:o,value:c,onCheckedChange:l,form:u,...m}=e;return(0,d.jsx)(g,{__scopeCheckbox:r,checked:s,defaultChecked:i,disabled:o,required:n,onCheckedChange:l,name:a,form:u,value:c,internal_do_not_use_render:({isFormControl:e})=>(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(x,{...m,ref:t,__scopeCheckbox:r}),e&&(0,d.jsx)(C,{__scopeCheckbox:r})]})})});b.displayName=u;var v="CheckboxIndicator",S=t.forwardRef((e,t)=>{let{__scopeCheckbox:r,forceMount:a,...s}=e,i=h(v,r);return(0,d.jsx)(c.Presence,{present:a||j(i.checked)||!0===i.checked,children:(0,d.jsx)(l.Primitive.span,{"data-state":N(i.checked),"data-disabled":i.disabled?"":void 0,...s,ref:t,style:{pointerEvents:"none",...e.style}})})});S.displayName=v;var w="CheckboxBubbleInput",C=t.forwardRef(({__scopeCheckbox:e,...a},s)=>{let{control:i,hasConsumerStoppedPropagationRef:c,checked:u,defaultChecked:m,required:f,disabled:p,name:g,value:y,form:x,bubbleInput:b,setBubbleInput:v}=h(w,e),S=(0,r.useComposedRefs)(s,v),C=(0,n.usePrevious)(u),N=(0,o.useSize)(i);t.useEffect(()=>{if(!b)return;let e=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set,t=!c.current;if(C!==u&&e){let r=new Event("click",{bubbles:t});b.indeterminate=j(u),e.call(b,!j(u)&&u),b.dispatchEvent(r)}},[b,C,u,c]);let T=t.useRef(!j(u)&&u);return(0,d.jsx)(l.Primitive.input,{type:"checkbox","aria-hidden":!0,defaultChecked:m??T.current,required:f,disabled:p,name:g,value:y,form:x,...a,tabIndex:-1,ref:S,style:{...a.style,...N,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});function j(e){return"indeterminate"===e}function N(e){return j(e)?"indeterminate":e?"checked":"unchecked"}C.displayName=w,e.s(["Checkbox",()=>b,"CheckboxIndicator",()=>S,"Indicator",()=>S,"Root",()=>b,"createCheckboxScope",()=>f,"unstable_BubbleInput",()=>C,"unstable_CheckboxBubbleInput",()=>C,"unstable_CheckboxProvider",()=>g,"unstable_CheckboxTrigger",()=>x,"unstable_Provider",()=>g,"unstable_Trigger",()=>x])},257428,e=>{"use strict";var t=e.i(843476),r=e.i(271645),a=e.i(388474),s=e.i(643531),i=e.i(975157);let n=r.forwardRef(({className:e,...r},n)=>(0,t.jsx)(a.Root,{ref:n,className:(0,i.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...r,children:(0,t.jsx)(a.Indicator,{className:(0,i.cn)("flex items-center justify-center text-current"),children:(0,t.jsx)(s.Check,{className:"h-4 w-4"})})}));n.displayName=a.Root.displayName,e.s(["Checkbox",()=>n])},541071,e=>{"use strict";let t=(0,e.i(475254).default)("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);e.s(["MoreHorizontal",()=>t],541071)},966265,e=>{"use strict";var t=e.i(271645),r=e.i(908406),a=e.i(422713),s=e.i(102594),i=e.i(266027),n=e.i(912598),o=e.i(95187);let c=(0,o.createServerReference)("408055c65091de6e86656304d04a002881aed3acc6",o.callServer,void 0,o.findSourceMapURL,"getCashAccountsAction"),l=(0,o.createServerReference)("40fec0c16d5b967e0b7b13b4f39e9f33caa55d98fd",o.callServer,void 0,o.findSourceMapURL,"createCashAccountAction"),d=(0,o.createServerReference)("60cff6e1bde4cdde91ed3aaa29411ed65f1ac6b8ba",o.callServer,void 0,o.findSourceMapURL,"updateCashAccountAction"),u=(0,o.createServerReference)("609fff12b333f8481f6eaa00c9f6ed0ca7485d5f62",o.callServer,void 0,o.findSourceMapURL,"deleteCashAccountAction"),m=(0,o.createServerReference)("701a700c12f80accdeeab232d537f79439d8fe9e50",o.callServer,void 0,o.findSourceMapURL,"deleteCashAccountWithTransactionsAction"),f=(0,o.createServerReference)("60a22285198ef838d83b1b4a602809518cbd22267e",o.callServer,void 0,o.findSourceMapURL,"getCashAccountBalanceAction");e.s(["useCashAccounts",0,()=>{let[e,o]=(0,t.useState)([]),{toast:p}=(0,r.useToast)(),{currentBusiness:h}=(0,a.useBusiness)(),{user:g}=(0,s.useAuth)(),y=(0,n.useQueryClient)(),x=(0,t.useCallback)(async()=>{if(!h?.id)return[];try{let e=await c(h.id);if(!e.success||!e.data)throw Error(e.error||"Failed to fetch accounts");return e.data.map(e=>({...e,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)}))}catch(e){return console.error("Error loading cash accounts:",e),p({title:"Error",description:"Failed to load cash accounts",variant:"destructive"}),[]}},[h?.id,p]),b=["cash_accounts",h?.id],{data:v,isLoading:S}=(0,i.useQuery)({queryKey:b,queryFn:x,enabled:!!h?.id,staleTime:3e4});(0,t.useEffect)(()=>{v&&o(v)},[v]);let w=S&&!v,C=(0,t.useCallback)(()=>{y.invalidateQueries({queryKey:b})},[y,b]),j=(0,t.useCallback)(async e=>{if(!h?.id||!g?.id)return null;try{let t=await l({...e,userId:g.id,locationId:h.id});if(!t.success||!t.data)throw Error(t.error);return y.invalidateQueries({queryKey:b}),p({title:"Success",description:"Cash account created successfully"}),t.data}catch(e){return console.error("Error creating cash account:",e),p({title:"Error",description:"Failed to create cash account",variant:"destructive"}),null}},[h?.id,g?.id,y,b,p]),N=async(e,t)=>{if(!h?.id)return!1;try{let r=await d(e,{...t,locationId:h.id});if(!r.success)throw Error(r.error);return y.invalidateQueries({queryKey:b}),p({title:"Success",description:"Cash account updated successfully"}),!0}catch(e){return console.error("Error updating cash account:",e),p({title:"Error",description:"Failed to update cash account",variant:"destructive"}),!1}},T=async(e,t)=>{if(!h?.id)return{success:!1,hasTransactions:!1};try{let r=await u(e,h.id);return r.success&&(y.invalidateQueries({queryKey:b}),p({title:"Success",description:"Cash account deleted successfully"}),t&&t()),r}catch(e){return console.error("Error deleting cash account:",e),p({title:"Error",description:"Failed to delete cash account",variant:"destructive"}),{success:!1,hasTransactions:!1}}},A=async(e,t=!1,r)=>{if(!h?.id)return!1;try{let a=await m(e,h.id,t);if(!a.success)throw Error(a.error);return y.invalidateQueries({queryKey:b}),p({title:"Success",description:t?"Account and transactions deleted":"Account deleted (records unlinked)"}),r&&r(),!0}catch(e){return console.error("Error deleting cash account:",e),p({title:"Error",description:"Failed to delete cash account",variant:"destructive"}),!1}},D=(0,t.useCallback)(async e=>{if(!h?.id)return 0;try{let t=await f(e,h.id);if(t.success)return t.data;return 0}catch(e){return console.error("Error getting balance:",e),0}},[h?.id]);return(0,t.useMemo)(()=>({accounts:e,isLoading:w,createAccount:j,updateAccount:N,deleteAccount:T,deleteAccountWithTransactions:A,getAccountBalance:D,loadAccounts:x,refreshAccounts:C}),[e,w,j,N,T,A,D,x,C])}],966265)},98363,e=>{"use strict";var t=e.i(271645),r=e.i(102594),a=e.i(422713),s=e.i(908406),i=e.i(266027),n=e.i(912598);let o=e=>({id:e.id,accountId:e.account_id,amount:Number(e.amount),transactionType:e.transaction_type,category:e.category,description:e.description,personInCharge:e.person_in_charge,tags:e.tags,date:new Date(e.date),paymentMethod:e.payment_method,receiptImage:e.receipt_image,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)});var c=e.i(95187);let l=(0,c.createServerReference)("6050d5e4425dec9de12384682af8632685a43503f6",c.callServer,void 0,c.findSourceMapURL,"getCashTransactionsAction"),d=(0,c.createServerReference)("4064724fc471e698ee76d294a980e2a65c0a9c856a",c.callServer,void 0,c.findSourceMapURL,"createCashTransactionAction"),u=(0,c.createServerReference)("60e4c60d7aa378a229209542057eb77c66409f1850",c.callServer,void 0,c.findSourceMapURL,"updateCashTransactionAction"),m=(0,c.createServerReference)("605e333b82184dfc91eaa2d1fe6090163e41e2aa78",c.callServer,void 0,c.findSourceMapURL,"deleteCashTransactionAction"),f=(0,c.createServerReference)("60233cf66a8bd607780138afb600e5b4300ab3ce36",c.callServer,void 0,c.findSourceMapURL,"getAccountOpeningBalanceAction"),p=(0,c.createServerReference)("402f81bafe02611b5b5687b2b85c12e36ea9604ccf",c.callServer,void 0,c.findSourceMapURL,"createBulkCashTransactionsAction");e.s(["useCashTransactions",0,e=>{let{user:c}=(0,r.useAuth)(),{currentBusiness:h}=(0,a.useBusiness)(),{toast:g}=(0,s.useToast)(),y=(0,n.useQueryClient)(),x=(0,t.useCallback)(async()=>{try{if(!c||!h)return[];let t=await l(h.id,e);if(!t.success||!t.data)throw Error(t.error||"Failed to fetch transactions");let r=t.data.map(e=>{let t={id:e.id,user_id:e.user_id,account_id:e.account_id,amount:Number(e.amount),transaction_type:e.transaction_type,category:e.category,description:e.description,person_in_charge:e.person_in_charge,tags:e.tags,date:e.date,payment_method:e.payment_method,receipt_image:e.receipt_image,created_at:e.created_at,updated_at:e.updated_at};return o(t)});return r.sort((e,t)=>{let r=new Date(t.date).getTime()-new Date(e.date).getTime();return 0!==r?r:new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()}),r}catch(e){return console.error("Error loading cash transactions:",e),g({title:"Error",description:"Failed to load cash transactions",variant:"destructive"}),[]}},[c,h?.id,e,g]),b=(0,t.useMemo)(()=>["cash_transactions",h?.id,c?.id,e],[h?.id,c?.id,e]),{data:v=[],isLoading:S}=(0,i.useQuery)({queryKey:b,queryFn:x,enabled:!!c&&!!h?.id,staleTime:3e4}),w=S&&0===v.length,C=async e=>{try{if(!c||!h)throw Error("User not authenticated");let t=await d({...e,userId:c.id,locationId:h.id});if(!t.success)throw Error(t.error);return g({title:"Success",description:"transfer"===e.transactionType?"Transfer completed successfully":"Cash transaction created successfully"}),y.invalidateQueries({queryKey:b}),Array.isArray(t.data)?o(t.data[0]):o(t.data)}catch(e){throw console.error("Error creating cash transaction:",e),g({title:"Error",description:"Failed to create cash transaction",variant:"destructive"}),e}},j=async e=>{try{if(!c||!h)throw Error("User not authenticated");let t=e.map(e=>({...e,userId:c.id,locationId:h.id})),r=await p(t);if(!r.success)throw Error(r.error);return g({title:"Success",description:`Successfully created ${e.length} transactions`}),y.invalidateQueries({queryKey:b}),r.data.map(e=>o(e))}catch(e){throw console.error("Error creating bulk transactions:",e),g({title:"Error",description:"Failed to create bulk transactions",variant:"destructive"}),e}},N=async(e,t)=>{try{let r=await u(e,t);if(!r.success)throw Error(r.error);return g({title:"Success",description:"Transaction updated successfully"}),y.invalidateQueries({queryKey:b}),o(r.data)}catch(e){return console.error("Error updating cash transaction:",e),g({title:"Error",description:"Failed to update transaction",variant:"destructive"}),null}},T=async(e,t)=>{try{if(!h)throw Error("No business selected");let r=await m(e,h.id);if(!r.success)throw Error(r.error);return g({title:"Success",description:"Cash transaction deleted successfully"}),y.invalidateQueries({queryKey:b}),t&&t(),!0}catch(e){return console.error("Error deleting cash transaction:",e),g({title:"Error",description:"Failed to delete cash transaction",variant:"destructive"}),!1}},A=(0,t.useCallback)(async e=>{try{if(!h)return 0;let t=await f(e,h.id);return t.success?t.data:0}catch(e){return 0}},[h?.id]),D=(0,t.useCallback)(async(e,t)=>{let r=e.toISOString().split("T")[0],a=v.filter(e=>e.date.toISOString().split("T")[0]===r);t&&(a=a.filter(e=>e.accountId===t));let s=a.filter(e=>"cash_in"===e.transactionType||"transfer_in"===e.transactionType).reduce((e,t)=>e+t.amount,0),i=a.filter(e=>"cash_out"===e.transactionType||"transfer_out"===e.transactionType).reduce((e,t)=>e+t.amount,0),n=a.filter(e=>"transfer_in"===e.transactionType).reduce((e,t)=>e+t.amount,0),o=a.filter(e=>"transfer_out"===e.transactionType).reduce((e,t)=>e+t.amount,0),c=new Date(e);c.setDate(c.getDate()-1);let l=c.toISOString().split("T")[0],d=v.filter(e=>e.date.toISOString().split("T")[0]<=l);t&&(d=d.filter(e=>e.accountId===t));let u=d.filter(e=>"cash_in"===e.transactionType||"transfer_in"===e.transactionType).reduce((e,t)=>e+t.amount,0),m=d.filter(e=>"cash_out"===e.transactionType||"transfer_out"===e.transactionType).reduce((e,t)=>e+t.amount,0),f=0;t&&(f=await A(t));let p=f+u-m;return{date:e,openingBalance:p,cashIn:s,cashOut:i,transfersIn:n,transfersOut:o,closingBalance:p+s-i}},[v,A]),I=(0,t.useCallback)(async(e,t,r)=>{let a=e.toISOString().split("T")[0],s=t.toISOString().split("T")[0],i=v.filter(e=>{let t=e.date.toISOString().split("T")[0];return t>=a&&t<=s});r&&(i=i.filter(e=>e.accountId===r));let n=i.filter(e=>"cash_in"===e.transactionType||"transfer_in"===e.transactionType).reduce((e,t)=>e+t.amount,0),o=i.filter(e=>"cash_out"===e.transactionType||"transfer_out"===e.transactionType).reduce((e,t)=>e+t.amount,0),c=i.filter(e=>"transfer_in"===e.transactionType).reduce((e,t)=>e+t.amount,0),l=i.filter(e=>"transfer_out"===e.transactionType).reduce((e,t)=>e+t.amount,0),d=new Date(e);d.setDate(d.getDate()-1);let u=d.toISOString().split("T")[0],m=v.filter(e=>e.date.toISOString().split("T")[0]<=u);r&&(m=m.filter(e=>e.accountId===r));let f=m.filter(e=>"cash_in"===e.transactionType||"transfer_in"===e.transactionType).reduce((e,t)=>e+t.amount,0),p=m.filter(e=>"cash_out"===e.transactionType||"transfer_out"===e.transactionType).reduce((e,t)=>e+t.amount,0),h=0;r&&(h=await A(r));let g=h+f-p;return{date:e,openingBalance:g,cashIn:n,cashOut:o,transfersIn:c,transfersOut:l,closingBalance:g+n-o}},[v,A]),E=(0,t.useCallback)(()=>{y.invalidateQueries({queryKey:b})},[y,b]);return(0,t.useMemo)(()=>({transactions:v,isLoading:w,createTransaction:C,createBulkTransactions:j,updateTransaction:N,deleteTransaction:T,getDailySummary:D,getDateRangeSummary:I,refreshTransactions:E}),[v,w,C,j,N,T,D,I,E])}],98363)},631422,e=>{"use strict";var t=e.i(585890),r=e.i(145963),a=e.i(614522),s=e.i(707935),i=e.i(608199),n=e.i(39978),o=e.i(668113),c=e.i(885697),l=e.i(751371),d=e.i(585341),u=e.i(619578);e.s(["getDateRangeFromFilter",0,e=>{let m=new Date,f=(0,t.startOfDay)(m);switch(e){case"today":return{from:f,to:(0,r.endOfDay)(m)};case"yesterday":let p=(0,l.subDays)(f,1);return{from:p,to:(0,r.endOfDay)(p)};case"this-week":return{from:(0,a.startOfWeek)(m),to:(0,s.endOfWeek)(m)};case"last-week":let h=(0,a.startOfWeek)((0,d.subWeeks)(m,1));return{from:h,to:(0,s.endOfWeek)(h)};case"this-month":return{from:(0,i.startOfMonth)(m),to:(0,n.endOfMonth)(m)};case"last-month":let g=(0,i.startOfMonth)((0,u.subMonths)(m,1));return{from:g,to:(0,n.endOfMonth)(g)};case"this-year":return{from:(0,o.startOfYear)(m),to:(0,c.endOfYear)(m)};default:return{from:new Date(2e3,0,1),to:(0,r.endOfDay)(m)}}},"isDateInRange",0,(e,t,r)=>!t&&!r||(t?r?e>=t&&e<=r:e>=t:e<=r)])},691162,e=>{"use strict";let t;var r=e.i(271645),a=e.i(30030),s=e.i(820783),i=e.i(326999),n=e.i(981140),o=e.i(843476),c=Symbol("radix.slottable"),l="AlertDialog",[d,u]=(0,a.createContextScope)(l,[i.createDialogScope]),m=(0,i.createDialogScope)(),f=e=>{let{__scopeAlertDialog:t,...r}=e,a=m(t);return(0,o.jsx)(i.Root,{...a,...r,modal:!0})};f.displayName=l;var p=r.forwardRef((e,t)=>{let{__scopeAlertDialog:r,...a}=e,s=m(r);return(0,o.jsx)(i.Trigger,{...s,...a,ref:t})});p.displayName="AlertDialogTrigger";var h=e=>{let{__scopeAlertDialog:t,...r}=e,a=m(t);return(0,o.jsx)(i.Portal,{...a,...r})};h.displayName="AlertDialogPortal";var g=r.forwardRef((e,t)=>{let{__scopeAlertDialog:r,...a}=e,s=m(r);return(0,o.jsx)(i.Overlay,{...s,...a,ref:t})});g.displayName="AlertDialogOverlay";var y="AlertDialogContent",[x,b]=d(y),v=((t=({children:e})=>(0,o.jsx)(o.Fragment,{children:e})).displayName="AlertDialogContent.Slottable",t.__radixId=c,t),S=r.forwardRef((e,t)=>{let{__scopeAlertDialog:a,children:c,...l}=e,d=m(a),u=r.useRef(null),f=(0,s.useComposedRefs)(t,u),p=r.useRef(null);return(0,o.jsx)(i.WarningProvider,{contentName:y,titleName:w,docsSlug:"alert-dialog",children:(0,o.jsx)(x,{scope:a,cancelRef:p,children:(0,o.jsxs)(i.Content,{role:"alertdialog",...d,...l,ref:f,onOpenAutoFocus:(0,n.composeEventHandlers)(l.onOpenAutoFocus,e=>{e.preventDefault(),p.current?.focus({preventScroll:!0})}),onPointerDownOutside:e=>e.preventDefault(),onInteractOutside:e=>e.preventDefault(),children:[(0,o.jsx)(v,{children:c}),(0,o.jsx)(I,{contentRef:u})]})})})});S.displayName=y;var w="AlertDialogTitle",C=r.forwardRef((e,t)=>{let{__scopeAlertDialog:r,...a}=e,s=m(r);return(0,o.jsx)(i.Title,{...s,...a,ref:t})});C.displayName=w;var j="AlertDialogDescription",N=r.forwardRef((e,t)=>{let{__scopeAlertDialog:r,...a}=e,s=m(r);return(0,o.jsx)(i.Description,{...s,...a,ref:t})});N.displayName=j;var T=r.forwardRef((e,t)=>{let{__scopeAlertDialog:r,...a}=e,s=m(r);return(0,o.jsx)(i.Close,{...s,...a,ref:t})});T.displayName="AlertDialogAction";var A="AlertDialogCancel",D=r.forwardRef((e,t)=>{let{__scopeAlertDialog:r,...a}=e,{cancelRef:n}=b(A,r),c=m(r),l=(0,s.useComposedRefs)(t,n);return(0,o.jsx)(i.Close,{...c,...a,ref:l})});D.displayName=A;var I=({contentRef:e})=>{let t=`\`${y}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${y}\` by passing a \`${j}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${y}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return r.useEffect(()=>{document.getElementById(e.current?.getAttribute("aria-describedby"))||console.warn(t)},[t,e]),null};e.s(["Action",()=>T,"AlertDialog",()=>f,"AlertDialogAction",()=>T,"AlertDialogCancel",()=>D,"AlertDialogContent",()=>S,"AlertDialogDescription",()=>N,"AlertDialogOverlay",()=>g,"AlertDialogPortal",()=>h,"AlertDialogTitle",()=>C,"AlertDialogTrigger",()=>p,"Cancel",()=>D,"Content",()=>S,"Description",()=>N,"Overlay",()=>g,"Portal",()=>h,"Root",()=>f,"Title",()=>C,"Trigger",()=>p,"createAlertDialogScope",()=>u],691162)},868499,e=>{"use strict";var t=e.i(843476),r=e.i(271645),a=e.i(691162),s=e.i(975157),i=e.i(519455);let n=a.Root,o=a.Trigger,c=a.Portal,l=r.forwardRef(({className:e,...r},i)=>(0,t.jsx)(a.Overlay,{className:(0,s.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...r,ref:i}));l.displayName=a.Overlay.displayName;let d=r.forwardRef(({className:e,...r},i)=>(0,t.jsxs)(c,{children:[(0,t.jsx)(l,{}),(0,t.jsx)(a.Content,{ref:i,className:(0,s.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...r})]}));d.displayName=a.Content.displayName;let u=({className:e,...r})=>(0,t.jsx)("div",{className:(0,s.cn)("flex flex-col space-y-2 text-center sm:text-left",e),...r});u.displayName="AlertDialogHeader";let m=({className:e,...r})=>(0,t.jsx)("div",{className:(0,s.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...r});m.displayName="AlertDialogFooter";let f=r.forwardRef(({className:e,...r},i)=>(0,t.jsx)(a.Title,{ref:i,className:(0,s.cn)("text-lg font-semibold",e),...r}));f.displayName=a.Title.displayName;let p=r.forwardRef(({className:e,...r},i)=>(0,t.jsx)(a.Description,{ref:i,className:(0,s.cn)("text-sm text-muted-foreground",e),...r}));p.displayName=a.Description.displayName;let h=r.forwardRef(({className:e,...r},n)=>(0,t.jsx)(a.Action,{ref:n,className:(0,s.cn)((0,i.buttonVariants)(),e),...r}));h.displayName=a.Action.displayName;let g=r.forwardRef(({className:e,...r},n)=>(0,t.jsx)(a.Cancel,{ref:n,className:(0,s.cn)((0,i.buttonVariants)({variant:"outline"}),"mt-2 sm:mt-0",e),...r}));g.displayName=a.Cancel.displayName,e.s(["AlertDialog",()=>n,"AlertDialogAction",()=>h,"AlertDialogCancel",()=>g,"AlertDialogContent",()=>d,"AlertDialogDescription",()=>p,"AlertDialogFooter",()=>m,"AlertDialogHeader",()=>u,"AlertDialogTitle",()=>f,"AlertDialogTrigger",()=>o])},885697,585341,e=>{"use strict";var t=e.i(281092);function r(e,r){let a=(0,t.toDate)(e,r?.in),s=a.getFullYear();return a.setFullYear(s+1,0,0),a.setHours(23,59,59,999),a}e.s(["endOfYear",()=>r],885697);var a=e.i(433331);function s(e,t,r){return(0,a.addWeeks)(e,-t,r)}e.s(["subWeeks",()=>s],585341)},926209,e=>{"use strict";var t=e.i(271645),r=e.i(981140),a=e.i(30030),s=e.i(842727),i=e.i(296626),n=e.i(248425),o=e.i(586318),c=e.i(369340),l=e.i(610772),d=e.i(843476),u="Tabs",[m,f]=(0,a.createContextScope)(u,[s.createRovingFocusGroupScope]),p=(0,s.createRovingFocusGroupScope)(),[h,g]=m(u),y=t.forwardRef((e,t)=>{let{__scopeTabs:r,value:a,onValueChange:s,defaultValue:i,orientation:m="horizontal",dir:f,activationMode:p="automatic",...g}=e,y=(0,o.useDirection)(f),[x,b]=(0,c.useControllableState)({prop:a,onChange:s,defaultProp:i??"",caller:u});return(0,d.jsx)(h,{scope:r,baseId:(0,l.useId)(),value:x,onValueChange:b,orientation:m,dir:y,activationMode:p,children:(0,d.jsx)(n.Primitive.div,{dir:y,"data-orientation":m,...g,ref:t})})});y.displayName=u;var x="TabsList",b=t.forwardRef((e,t)=>{let{__scopeTabs:r,loop:a=!0,...i}=e,o=g(x,r),c=p(r);return(0,d.jsx)(s.Root,{asChild:!0,...c,orientation:o.orientation,dir:o.dir,loop:a,children:(0,d.jsx)(n.Primitive.div,{role:"tablist","aria-orientation":o.orientation,...i,ref:t})})});b.displayName=x;var v="TabsTrigger",S=t.forwardRef((e,t)=>{let{__scopeTabs:a,value:i,disabled:o=!1,...c}=e,l=g(v,a),u=p(a),m=j(l.baseId,i),f=N(l.baseId,i),h=i===l.value;return(0,d.jsx)(s.Item,{asChild:!0,...u,focusable:!o,active:h,children:(0,d.jsx)(n.Primitive.button,{type:"button",role:"tab","aria-selected":h,"aria-controls":f,"data-state":h?"active":"inactive","data-disabled":o?"":void 0,disabled:o,id:m,...c,ref:t,onMouseDown:(0,r.composeEventHandlers)(e.onMouseDown,e=>{o||0!==e.button||!1!==e.ctrlKey?e.preventDefault():l.onValueChange(i)}),onKeyDown:(0,r.composeEventHandlers)(e.onKeyDown,e=>{[" ","Enter"].includes(e.key)&&l.onValueChange(i)}),onFocus:(0,r.composeEventHandlers)(e.onFocus,()=>{let e="manual"!==l.activationMode;h||o||!e||l.onValueChange(i)})})})});S.displayName=v;var w="TabsContent",C=t.forwardRef((e,r)=>{let{__scopeTabs:a,value:s,forceMount:o,children:c,...l}=e,u=g(w,a),m=j(u.baseId,s),f=N(u.baseId,s),p=s===u.value,h=t.useRef(p);return t.useEffect(()=>{let e=requestAnimationFrame(()=>h.current=!1);return()=>cancelAnimationFrame(e)},[]),(0,d.jsx)(i.Presence,{present:o||p,children:({present:t})=>(0,d.jsx)(n.Primitive.div,{"data-state":p?"active":"inactive","data-orientation":u.orientation,role:"tabpanel","aria-labelledby":m,hidden:!t,id:f,tabIndex:0,...l,ref:r,style:{...e.style,animationDuration:h.current?"0s":void 0},children:t&&c})})});function j(e,t){return`${e}-trigger-${t}`}function N(e,t){return`${e}-content-${t}`}C.displayName=w,e.s(["Content",()=>C,"List",()=>b,"Root",()=>y,"Tabs",()=>y,"TabsContent",()=>C,"TabsList",()=>b,"TabsTrigger",()=>S,"Trigger",()=>S,"createTabsScope",()=>f])},677572,e=>{"use strict";var t=e.i(843476),r=e.i(271645),a=e.i(926209),s=e.i(975157);let i=a.Root,n=r.forwardRef(({className:e,...r},i)=>(0,t.jsx)(a.List,{ref:i,className:(0,s.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...r}));n.displayName=a.List.displayName;let o=r.forwardRef(({className:e,...r},i)=>(0,t.jsx)(a.Trigger,{ref:i,className:(0,s.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...r}));o.displayName=a.Trigger.displayName;let c=r.forwardRef(({className:e,...r},i)=>(0,t.jsx)(a.Content,{ref:i,className:(0,s.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...r}));c.displayName=a.Content.displayName,e.s(["Tabs",()=>i,"TabsContent",()=>c,"TabsList",()=>n,"TabsTrigger",()=>o])},619578,e=>{"use strict";var t=e.i(688594);function r(e,r,a){return(0,t.addMonths)(e,-r,a)}e.s(["subMonths",()=>r])},145963,e=>{"use strict";var t=e.i(281092);function r(e,r){let a=(0,t.toDate)(e,r?.in);return a.setHours(23,59,59,999),a}e.s(["endOfDay",()=>r])},960014,e=>{"use strict";var t=e.i(95187);let r=(0,t.createServerReference)("7022b270c26116cc720c0fe09926fa8749c32b0ea9",t.callServer,void 0,t.findSourceMapURL,"getStockSummaryReportAction");e.s(["getStockSummaryReportAction",()=>r])},986387,e=>{"use strict";var t=e.i(102594);e.s(["useCurrentUser",0,()=>{let{user:e}=(0,t.useAuth)();return{userId:e?.id}}])},178583,e=>{"use strict";let t=(0,e.i(475254).default)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);e.s(["FileText",()=>t],178583)},555781,(e,t,r)=>{let a=Error("Could not parse module '[project]/src/app/actions/products.ts'\n\n'import', and 'export' cannot be used outside of module code");throw a.code="MODULE_UNPARSABLE",a},908962,224410,e=>{"use strict";var t=e.i(271645),r=e.i(160615),a=e.i(422713),s=e.i(266027),i=e.i(912598);let n=e=>{let t=Object.keys(localStorage),r=["allProductsStats_","stockSummary_","soldItems_","dashboardData_","analyticsData_"],a=0;t.forEach(e=>{r.some(t=>e.startsWith(t))&&(localStorage.removeItem(e),a++)}),a>0&&console.log(`[Cache] Cleared ${a} inventory-related localStorage entries.`),e&&(console.log("[Cache] Invalidating React Query inventory keys..."),e.invalidateQueries({queryKey:["inventory_global_stats"]}),e.invalidateQueries({queryKey:["stockSummary"]}),e.invalidateQueries({queryKey:["products"]}),e.invalidateQueries({queryKey:["sales"]}),e.invalidateQueries({queryKey:["all-products-for-scanner"]}),e.invalidateQueries({queryKey:["all-products"]}))};e.s(["clearInventoryCaches",0,n],224410);var o=e.i(555781);e.s(["useProducts",0,(e,c=50)=>{let[l,d]=(0,t.useState)([]),[u,m]=(0,t.useState)(1),[f,p]=(0,t.useState)(c),[h,g]=(0,t.useState)(0),[y,x]=(0,t.useState)(!1),{settings:b}=(0,r.useBusinessSettings)(),{currentBusiness:v}=(0,a.useBusiness)(),S=(0,i.useQueryClient)(),[w,C]=(0,t.useState)({search:"",category:"all",stockStatus:"all"}),[j,N]=(0,t.useState)(null),T=(0,t.useCallback)(e=>{e.search!==w.search&&(x(!0),j&&clearTimeout(j),N(setTimeout(()=>{x(!1)},600))),C(e)},[w.search,j]),A=(0,t.useCallback)(async()=>{if(!e||!v)return{products:[],count:0};try{return await (0,o.getProductsAction)({userId:e,businessId:v.id,page:u,pageSize:f,search:w.search,category:"all"===w.category?void 0:w.category,stockStatus:w.stockStatus})}catch(e){return console.error("Error loading products from server action:",e),{products:[],count:0}}},[e,v?.id,u,f,w.search,w.category,w.stockStatus]),D=(0,t.useMemo)(()=>["products",e,v?.id],[e,v?.id]),I=(0,t.useMemo)(()=>[...D,u,f,w.search,w.category,w.stockStatus],[D,u,f,w.search,w.category,w.stockStatus]),{data:E,isLoading:P,isFetching:_,refetch:M}=(0,s.useQuery)({queryKey:I,queryFn:A,enabled:!!e&&!!v?.id,staleTime:3e4,gcTime:18e5,refetchOnWindowFocus:!0,refetchOnReconnect:!0});(0,t.useEffect)(()=>{E&&(d(E.products),g(E.count))},[E]);let k=async t=>{try{if(!e)return null;return console.warn("Image upload redirecting to server action (TODO)"),null}catch(e){return console.error("Error in uploadProductImage:",e),null}};return{products:l,isLoading:P&&!E&&!y,loadProducts:A,page:u,setPage:m,pageSize:f,setPageSize:p,totalCount:h,createProduct:async t=>{try{if(!e||!v)return null;let r=await (0,o.createProductAction)({...t,userId:e,businessId:v.id});if(!r)return null;return d(e=>[r,...e]),g(e=>e+1),S.invalidateQueries({queryKey:D}),n(S),r}catch(e){return console.error("Error creating product:",e),null}},updateProduct:async(t,r,a,s=!1,i,c,l,d)=>{try{if(!e||!v)return!1;let c=r.imageUrl;if(a&&(c=await k(a)),!await (0,o.updateProductAction)(t,{...r,imageUrl:c,userId:e,businessId:v.id,isFromSale:s,customChangeReason:i,referenceId:l}))return!1;return S.invalidateQueries({queryKey:D}),n(S),!0}catch(e){return console.error("Error updating product:",e),!1}},updateProductsBulk:async(t,r,a,s,i,c)=>{try{if(!e||!v)return!1;let r=await (0,o.updateProductsBulkAction)(t.map(e=>({id:e.id,updated:e.updated})),v.id);return r&&(S.invalidateQueries({queryKey:D}),n(S)),r}catch(e){return console.error("Error in bulk update:",e),!1}},deleteProduct:async t=>{try{if(!e)return!1;if(await (0,o.deleteProductAction)(t))return S.invalidateQueries({queryKey:D}),n(S),!0;return!1}catch(e){return console.error("Error deleting product:",e),!1}},uploadProductImage:k,refetch:M,isFetching:_,filters:w,setFilters:T}}],908962)},589271,e=>{"use strict";e.s(["mapDbProductToProduct",0,e=>({id:e.id,itemNumber:e.item_number,barcode:e.barcode,manufacturerBarcode:e.manufacturer_barcode,name:e.name,description:e.description,category:e.category,quantity:e.quantity,costPrice:Number(e.cost_price),sellingPrice:Number(e.selling_price),supplier:e.supplier,imageUrl:e.image_url,minimumStock:e.minimum_stock,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}),"mapDbSaleToSale",0,e=>{let t=(Array.isArray(e.items)?e.items:[]).map(e=>{let t=void 0!==e.discountPercentage?Number(e.discountPercentage):void 0,r=void 0!==e.discountAmount?Number(e.discountAmount):void 0,a=e.discountType;return!a&&(t&&t>0?a="percentage":r&&r>0&&(a="amount")),{description:e.description||"",quantity:Number(e.quantity)||0,price:Number(e.price)||0,cost:Number(e.cost)||0,productId:e.productId||void 0,discountType:a,discountPercentage:t,discountAmount:r,createdAt:e.createdAt||void 0}});return{id:e.id,receiptNumber:e.receipt_number,customerName:e.customer_name,customerAddress:e.customer_address||"",customerContact:e.customer_contact||"",customerId:e.customer_id||void 0,items:t,paymentStatus:e.payment_status,profit:Number(e.profit),date:new Date(e.date),taxRate:e.tax_rate?Number(e.tax_rate):0,cashTransactionId:e.cash_transaction_id||void 0,amountPaid:e.amount_paid?Number(e.amount_paid):void 0,amountDue:e.amount_due?Number(e.amount_due):void 0,notes:e.notes||"",categoryId:e.category_id||void 0,createdAt:new Date(e.created_at)}},"mapSaleToDbSale",0,(e,t,r,a,s,i,n)=>({user_id:s,location_id:i,receipt_number:a,customer_name:e.customerName,customer_address:e.customerAddress||null,customer_contact:e.customerContact||null,customer_id:e.customerId||null,items:e.items,payment_status:e.paymentStatus,profit:r,date:t.toISOString().split("T")[0],tax_rate:e.taxRate||0,cash_transaction_id:n||null,amount_paid:e.amountPaid||null,amount_due:e.amountDue||null,notes:e.notes||null,category_id:e.categoryId||null})])},457786,e=>{"use strict";var t=e.i(95187);let r=(0,t.createServerReference)("401d907b5cd7e0b2f207e9b555ac4fe2e14de08444",t.callServer,void 0,t.findSourceMapURL,"logActivityAction");var a=e.i(986387),s=e.i(422713),i=e.i(777624);e.s(["useActivityLogger",0,()=>{let{userId:e}=(0,a.useCurrentUser)(),{currentBusiness:t}=(0,s.useBusiness)(),n=null;try{let{currentProfile:e}=(0,i.useProfiles)();n=e}catch{n=null}return{logActivity:async a=>{if(!e||!t?.id)return void console.warn("Cannot log activity: missing user or business context");try{let s=await r({userId:e,locationId:t.id,activityType:a.activityType,module:a.module,entityType:a.entityType,entityId:a.entityId||void 0,entityName:a.entityName,description:a.description,metadata:a.metadata||void 0,profileId:n?.id||void 0,profileName:n?.profile_name||void 0});s.success||console.error("Error logging activity:",s.error)}catch(e){console.error("Failed to log activity:",e)}}}}],457786)},146786,850823,617318,e=>{"use strict";var t=e.i(271645),r=e.i(589271),a=e.i(908406),s=e.i(266027),i=e.i(912598),n=e.i(457786),o=e.i(422713),c=e.i(908962),l=e.i(846696),d=e.i(555781);let u=e=>{let{updateProductsBulk:t}=(0,c.useProducts)(e),r=async(e,t)=>{if(!e.length)return[];try{return await (0,d.getProductsByIdsAction)(e,t)}catch(e){throw console.error("Error fetching fresh products:",e),e}};return{deductStockForSale:async(a,s,i,n,o)=>{if(!e)return!1;try{let c=a.filter(e=>e.productId);if(0===c.length)return!0;let d=[...new Set(c.map(e=>e.productId))],u=await r(d,o);if(0===u.length)return!1;let m=new Map;for(let e of c){let t=m.get(e.productId)||0;m.set(e.productId,t+e.quantity)}let f=[];for(let[e,t]of m.entries()){let r=u.find(t=>t.id===e);if(!r)continue;let a=r.quantity-t;f.push({id:e,updated:{...r,quantity:a}}),a<0&&l.toast.warning(`${r.name} inventory is now negative (${a}). Please restock soon.`)}return f.length>0&&await t(f,e,"Sale",s,i,n),!0}catch(e){return console.error("Error deducting stock for sale:",e),!1}},restoreStockForSale:async(a,s,i,n)=>{if(!e)return!1;try{let o=a.filter(e=>e.productId);if(0===o.length)return!0;let c=[...new Set(o.map(e=>e.productId))],l=await r(c,n),d=new Map;for(let e of o){let t=d.get(e.productId)||0;d.set(e.productId,t+e.quantity)}let u=[];for(let[e,t]of d.entries()){let r=l.find(t=>t.id===e);if(!r)continue;let a=r.quantity+t;u.push({id:e,updated:{...r,quantity:a}})}return u.length>0&&await t(u,e,"Deleted Sale",s,void 0,i),!0}catch(e){return console.error("Error restoring stock for sale:",e),!1}},adjustStockForEditedSale:async(a,s,i,n,o,c)=>{if(!e)return!1;try{let d=[...a.filter(e=>e.productId).map(e=>e.productId),...s.filter(e=>e.productId).map(e=>e.productId)],u=[...new Set(d)];if(0===u.length)return!0;let m=await r(u,c),f=new Map;for(let e of a.filter(e=>e.productId)){let t=f.get(e.productId)||0;f.set(e.productId,t+e.quantity)}for(let e of s.filter(e=>e.productId)){let t=f.get(e.productId)||0;f.set(e.productId,t-e.quantity)}let p=[];for(let[e,t]of f.entries()){if(0===t)continue;let r=m.find(t=>t.id===e);if(!r)continue;let a=r.quantity+t;p.push({id:e,updated:{...r,quantity:a}}),a<0&&l.toast.warning(`${r.name} inventory is now negative (${a}). Please restock soon.`)}return p.length>0&&await t(p,e,"Sale Status/Qty Edit",i,n,o),!0}catch(e){return console.error("Error adjusting stock for edited sale:",e),!1}}}};e.s(["useInventoryActions",0,u],850823);var m=e.i(224410),f=e.i(95187);let p=(0,f.createServerReference)("703e9376bfaf2adbf9aba886e70ba6b561f6bf5e0c",f.callServer,void 0,f.findSourceMapURL,"getSalesAction"),h=(0,f.createServerReference)("40d9064371ce5c0811194879498fdc849fbf872b8a",f.callServer,void 0,f.findSourceMapURL,"deleteSaleAction");e.s(["deleteSaleAction",()=>h],617318),e.s(["useSalesData",0,(e,c="desc",l)=>{let d=(0,i.useQueryClient)(),{toast:f}=(0,a.useToast)(),{logActivity:g}=(0,n.useActivityLogger)(),{currentBusiness:y}=(0,o.useBusiness)(),{restoreStockForSale:x}=u(e),b=(0,t.useCallback)(async()=>{try{if(!e||!y)return[];let t=await p(y.id,c,l);return t?t.map(e=>{let t={id:e.id,user_id:e.user_id,location_id:e.location_id,receipt_number:e.receipt_number,customer_name:e.customer_name,customer_address:e.customer_address,customer_contact:e.customer_contact,customer_id:e.customer_id,items:e.items,payment_status:e.payment_status,profit:e.profit?Number(e.profit):0,date:e.date,tax_rate:e.tax_rate||0,created_at:e.created_at,updated_at:e.updated_at,cash_transaction_id:e.cash_transaction_id,amount_paid:e.amount_paid?Number(e.amount_paid):void 0,amount_due:e.amount_due?Number(e.amount_due):void 0,category_id:e.category_id,notes:e.notes};return(0,r.mapDbSaleToSale)(t)}):[]}catch(e){return console.error("Error loading sales:",e),f({title:"Error",description:"Failed to load sales data. Please try again.",variant:"destructive"}),[]}},[e,y?.id,c,l,f]),v=(0,t.useMemo)(()=>["sales",y?.id,e],[y?.id,e]),S=(0,t.useMemo)(()=>[...v,c,l],[v,c,l]),{data:w=[],isLoading:C,isFetching:j,refetch:N}=(0,s.useQuery)({queryKey:S,queryFn:b,enabled:!!e&&!!y?.id,staleTime:3e4,gcTime:18e5,refetchOnWindowFocus:!0,refetchOnReconnect:!0}),T=C||j&&0===w.length,A=(0,t.useMemo)(()=>{let e=w.filter(e=>"Quote"!==e.paymentStatus),t=new Map;return e.forEach(e=>{let r=e.customerName,a=e.items.reduce((e,t)=>e+t.price*t.quantity,0);if(t.has(r)){let s=t.get(r);t.set(r,{total:s.total+a,count:s.count+1,customerId:s.customerId||e.customerId})}else t.set(r,{total:a,count:1,customerId:e.customerId})}),Array.from(t.entries()).map(([e,t])=>({id:t.customerId,name:e,totalPurchases:t.total,orderCount:t.count})).sort((e,t)=>t.totalPurchases-e.totalPurchases)},[w]),D=(0,t.useMemo)(()=>e=>{let t=w.filter(t=>t.customerName.toLowerCase()===e.toLowerCase()&&"Quote"!==t.paymentStatus);return{total:t.reduce((e,t)=>e+t.items.reduce((e,t)=>e+t.price*t.quantity,0),0),count:t.length}},[w]),I=async e=>{try{let t=w.find(t=>t.id===e);if(!t)throw Error("Sale not found");if("Quote"!==t.paymentStatus&&t.items.length>0&&(console.log("Restoring product quantities via useInventoryActions..."),await x(t.items,e,t.receiptNumber,y?.id)||f({title:"Inventory Update Warning",description:"Sale deleted, but inventory restoration might have failed. Please check your stock levels.",variant:"destructive"})),!y?.id)throw Error("Business context missing for deletion");let r=await h(e,y.id);if(!r.success)throw Error(r.error);return d.setQueryData(S,t=>t?t.filter(t=>t.id!==e):[]),d.invalidateQueries({queryKey:v}),E(),await g({activityType:"DELETE",module:"SALES",entityType:"sale",entityId:e,entityName:`Sale #${t.receiptNumber}`,description:`Deleted sale for ${t.customerName} - Total: UGX ${((t.amountPaid||0)+(t.amountDue||0)).toLocaleString()} (Stock restored)`,metadata:{receiptNumber:t.receiptNumber,customerName:t.customerName,customerAddress:t.customerAddress,customerContact:t.customerContact,totalAmount:(t.amountPaid||0)+(t.amountDue||0),amountPaid:t.amountPaid,profit:t.profit,paymentStatus:t.paymentStatus,taxRate:t.taxRate,itemCount:t.items.length,items:t.items.map(e=>({description:e.description,quantity:e.quantity,price:e.price,cost:e.cost,total:e.quantity*e.price,discountPercentage:e.discountPercentage,discountAmount:e.discountAmount})),notes:t.notes,cashTransactionDeleted:!!t.cashTransactionId}}),f({title:"Sale Deleted",description:"The sale record and associated data have been successfully deleted."}),(0,m.clearInventoryCaches)(),!0}catch(e){return console.error("Error deleting sale:",e),f({title:"Error",description:"Failed to delete sale. Please try again.",variant:"destructive"}),!1}},E=(0,t.useCallback)(()=>{if(!y?.id)return;let e=`soldItemsFilters_${y.id}`;localStorage.removeItem(e),localStorage.removeItem("soldItemsFilters")},[y?.id]);return{sales:w,isLoading:T,deleteSale:I,addSale:(0,t.useCallback)(e=>{d.setQueryData(S,t=>t?[e,...t]:[e]),d.invalidateQueries({queryKey:v}),E(),(0,m.clearInventoryCaches)()},[d,S,v,E,m.clearInventoryCaches]),updateSale:(0,t.useCallback)(e=>{d.setQueryData(S,t=>t?t.map(t=>t.id===e.id?e:t):[e]),d.invalidateQueries({queryKey:v}),E(),(0,m.clearInventoryCaches)()},[d,S,v,E,m.clearInventoryCaches]),getTopCustomers:A,getCustomerLifetimePurchases:D,clearSoldItemsCache:E,refetch:N,isFetching:j}}],146786)},531278,e=>{"use strict";let t=(0,e.i(475254).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],531278)},624687,e=>{"use strict";var t=e.i(843476),r=e.i(271645),a=e.i(975157);let s=r.forwardRef(({className:e,...r},s)=>(0,t.jsx)("textarea",{className:(0,a.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:s,...r}));s.displayName="Textarea",e.s(["Textarea",()=>s])},784774,e=>{"use strict";var t=e.i(843476),r=e.i(271645),a=e.i(975157);let s=r.forwardRef(({className:e,...r},s)=>(0,t.jsx)("div",{className:"relative w-full overflow-auto",children:(0,t.jsx)("table",{ref:s,className:(0,a.cn)("w-full caption-bottom text-sm",e),...r})}));s.displayName="Table";let i=r.forwardRef(({className:e,...r},s)=>(0,t.jsx)("thead",{ref:s,className:(0,a.cn)("[&_tr]:border-b",e),...r}));i.displayName="TableHeader";let n=r.forwardRef(({className:e,...r},s)=>(0,t.jsx)("tbody",{ref:s,className:(0,a.cn)("[&_tr:last-child]:border-0",e),...r}));n.displayName="TableBody",r.forwardRef(({className:e,...r},s)=>(0,t.jsx)("tfoot",{ref:s,className:(0,a.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...r})).displayName="TableFooter";let o=r.forwardRef(({className:e,...r},s)=>(0,t.jsx)("tr",{ref:s,className:(0,a.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...r}));o.displayName="TableRow";let c=r.forwardRef(({className:e,...r},s)=>(0,t.jsx)("th",{ref:s,className:(0,a.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...r}));c.displayName="TableHead";let l=r.forwardRef(({className:e,...r},s)=>(0,t.jsx)("td",{ref:s,className:(0,a.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...r}));l.displayName="TableCell",r.forwardRef(({className:e,...r},s)=>(0,t.jsx)("caption",{ref:s,className:(0,a.cn)("mt-4 text-sm text-muted-foreground",e),...r})).displayName="TableCaption",e.s(["Table",()=>s,"TableBody",()=>n,"TableCell",()=>l,"TableHead",()=>c,"TableHeader",()=>i,"TableRow",()=>o])},410160,e=>{"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e.s(["default",()=>t])},160615,e=>{"use strict";var t=e.i(271645),r=e.i(266027),a=e.i(908406),s=e.i(422713),i=e.i(95187);let n=(0,i.createServerReference)("40290a4fc6b8571a026afeb877566edb807919e482",i.callServer,void 0,i.findSourceMapURL,"getBusinessSettingsAction");var o=e.i(709239);let c=()=>({businessName:"",businessAddress:"",businessPhone:"",businessEmail:"",currency:"UGX",paymentInfo:"",defaultPrintFormat:"standard"});e.s(["convertPaymentMethodsToString",0,e=>e.filter(e=>""!==e.method.trim()||""!==e.accountNumber.trim()||""!==e.accountName.trim()).map(e=>`${e.method}
${e.accountNumber}
${e.accountName}`).join("\n"),"parsePaymentInfo",0,e=>{if(!e||""===e.trim())return[];let t=e.split("\n").filter(e=>""!==e.trim()),r=[];for(let e=0;e<t.length;e+=3)e+2<t.length&&r.push({method:t[e].trim(),accountNumber:t[e+1].trim(),accountName:t[e+2].trim()});return r},"useBusinessSettings",0,()=>{let[e,i]=(0,t.useState)(c()),[l,d]=(0,t.useState)(!1),{toast:u}=(0,a.useToast)(),{currentBusiness:m}=(0,s.useBusiness)(),f=async()=>{if(!m)return c();try{let e=await n(m.id);if(!e)return c();{let t=e.metadata&&"object"==typeof e.metadata&&e.metadata.payment_info||"";return{id:e.id,businessName:e.business_name||"",businessAddress:e.business_address||"",businessPhone:e.business_phone||"",businessEmail:e.business_email||"",businessLogo:e.business_logo||void 0,currency:e.currency||"UGX",signature:e.signature||void 0,paymentInfo:t,defaultPrintFormat:e.metadata&&"object"==typeof e.metadata&&e.metadata.default_print_format||"standard",defaultPrinterName:e.metadata&&"object"==typeof e.metadata&&e.metadata.default_printer_name||"",defaultPrinterType:e.metadata&&"object"==typeof e.metadata&&e.metadata.default_printer_type||"USB",printerPaperSize:e.metadata&&"object"==typeof e.metadata&&e.metadata.printer_paper_size||"58mm"}}}catch(e){return console.error("Error loading business settings:",e),u({title:"Error",description:"Failed to load business settings. Please try again.",variant:"destructive"}),c()}},p=async t=>{if(!m)return console.error("No business selected for updating settings"),u({title:"Error",description:"No business selected",variant:"destructive"}),!1;try{let r={payment_info:t.hasOwnProperty("paymentInfo")?t.paymentInfo:e.paymentInfo||"",default_print_format:t.hasOwnProperty("defaultPrintFormat")?t.defaultPrintFormat:e.defaultPrintFormat||"standard",default_printer_name:t.hasOwnProperty("defaultPrinterName")?t.defaultPrinterName:e.defaultPrinterName||"",default_printer_type:t.hasOwnProperty("defaultPrinterType")?t.defaultPrinterType:e.defaultPrinterType||"USB",printer_paper_size:t.hasOwnProperty("printerPaperSize")?t.printerPaperSize:e.printerPaperSize||"58mm"},a={business_name:t.hasOwnProperty("businessName")?t.businessName:e.businessName,business_address:t.hasOwnProperty("businessAddress")?t.businessAddress:e.businessAddress,business_phone:t.hasOwnProperty("businessPhone")?t.businessPhone:e.businessPhone,business_email:t.hasOwnProperty("businessEmail")?t.businessEmail:e.businessEmail,business_logo:t.hasOwnProperty("businessLogo")?t.businessLogo:e.businessLogo,currency:t.hasOwnProperty("currency")?t.currency:e.currency,signature:t.hasOwnProperty("signature")?t.signature:e.signature,metadata:r},s=await (0,o.upsertBusinessSettingsAction)(m.id,"00000000-0000-0000-0000-000000000000",a);if(!s.success)throw console.error("Supabase error updating business settings:",s.error),Error(s.error);return u({title:"Success",description:"Business settings updated successfully"}),x(),!0}catch(e){return console.error("Error updating business settings:",e),u({title:"Error",description:"Failed to update business settings. Please try again.",variant:"destructive"}),!1}},{data:h,isLoading:g,isFetching:y,refetch:x}=(0,r.useQuery)({queryKey:["businessSettings",m?.id],queryFn:f,enabled:!!m?.id,staleTime:3e5,gcTime:18e5,refetchOnWindowFocus:!1,refetchOnReconnect:!1});return(0,t.useEffect)(()=>{h?i(h):m||i(c())},[h,m]),(0,t.useEffect)(()=>{d(g||y)},[g,y]),{settings:e,isLoading:l,updateSettings:p,loadSettings:f}}],160615)},63209,e=>{"use strict";let t=(0,e.i(475254).default)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);e.s(["AlertCircle",()=>t],63209)},487486,e=>{"use strict";var t=e.i(843476),r=e.i(225913),a=e.i(975157);let s=(0,r.cva)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground",warning:"border-transparent bg-amber-500 text-white hover:bg-amber-600",success:"border-transparent bg-green-600 text-white hover:bg-green-700"}},defaultVariants:{variant:"default"}});function i({className:e,variant:r,...i}){return(0,t.jsx)("div",{className:(0,a.cn)(s({variant:r}),e),...i})}e.s(["Badge",()=>i])},392401,e=>{"use strict";var t=e.i(777624);e.s(["useFinancialVisibility",0,()=>{let{hasPermission:e}=(0,t.useProfiles)(),r=e("inventory","view_cost_price"),a=e("inventory","view_profit"),s=e("inventory","view_selling_price"),i=e("dashboard","view_total_sales"),n=e("dashboard","view_gross_profit"),o=e("dashboard","view_total_expenses"),c=e("dashboard","view_inventory_value"),l=e("dashboard","view_sales_types"),d=e("dashboard","view_avg_price"),u=e("dashboard","view_total_amount"),m=e("finance","manage_accounts"),f=e("finance","view"),p=e("expenses","view"),h=e("expenses","create"),g=e("expenses","edit");return{canViewCostPrice:r,canViewProfit:a,canViewSellingPrice:s,canViewTotalSales:i,canViewTotalGrossProfit:n,canViewTotalExpenses:o,canViewInventoryValue:c,canViewSalesTypes:l,canViewAvgPrice:d,canViewTotalAmount:u,canManageFinanceAccounts:m,canViewFinance:f,canViewExpenses:p,canCreateExpenses:h,canEditExpenses:g,canDeleteExpenses:e("expenses","delete"),formatFinancial:(e,t)=>"cost"===t&&r||"selling"===t&&s||"profit"===t&&a?e?.toLocaleString()||"0":""}}])},840710,e=>{"use strict";var t=e.i(102594),r=e.i(422713),a=e.i(266027),s=e.i(912598),i=e.i(960014);e.s(["useStockSummaryData",0,e=>{let{user:n}=(0,t.useAuth)(),{currentBusiness:o}=(0,r.useBusiness)(),c=(0,s.useQueryClient)(),l=async()=>{if(!n?.id||!o?.id||!e?.from||!e?.to)return[];try{let t=await (0,i.getStockSummaryReportAction)(o.id,e.from.toISOString(),e.to.toISOString());if(t.success&&t.data)return t.data;throw Error(t.error)}catch(e){throw console.error("[StockSummary] Error fetching report:",e.message),e}},{data:d=[],isLoading:u,refetch:m}=(0,a.useQuery)({queryKey:["stockSummary",o?.id,e.from?.toISOString(),e.to?.toISOString()],queryFn:l,enabled:!!n?.id&&!!o?.id&&!!e?.from&&!!e?.to,staleTime:3e5,gcTime:18e5});return{stockSummaryData:d,isLoading:u,loadStockSummaryData:m,clearCache:()=>{c.invalidateQueries({queryKey:["stockSummary"]})},clearAllLocationCaches:()=>{c.invalidateQueries({queryKey:["stockSummary"]})}}}])},983747,e=>{"use strict";var t=e.i(271645),r=e.i(102594),a=e.i(422713),s=e.i(908406),i=e.i(95187);let n=(0,i.createServerReference)("4062f5167d8450401fb1c1894fd92a5d62fc63ab55",i.callServer,void 0,i.findSourceMapURL,"getCarriageInwardsAction"),o=(0,i.createServerReference)("70092a7345137d042552225207b9c87626a83302fb",i.callServer,void 0,i.findSourceMapURL,"createCarriageInwardAction"),c=(0,i.createServerReference)("7098b1956be922b248aeaf6a1abbd5218f57924a7c",i.callServer,void 0,i.findSourceMapURL,"updateCarriageInwardAction"),l=(0,i.createServerReference)("60d170a5cfe5bd35fcab0395360e5c1b90e317f15a",i.callServer,void 0,i.findSourceMapURL,"deleteCarriageInwardAction");e.s(["useCarriageInwards",0,()=>{let[e,i]=(0,t.useState)([]),[d,u]=(0,t.useState)(!1),{user:m}=(0,r.useAuth)(),{currentBusiness:f}=(0,a.useBusiness)(),{toast:p}=(0,s.useToast)(),h=(0,t.useCallback)(async()=>{if(!m||!f){i([]),u(!1);return}u(!0);try{let e=await n(f.id);if(!e.success)throw Error(e.error);i((e.data||[]).map(e=>({...e,date:new Date(e.date),createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)})))}catch(e){console.error("Error loading carriage inwards:",e),p({title:"Error",description:"Failed to load carriage inwards records.",variant:"destructive"})}finally{u(!1)}},[m,f?.id,p]),g=async e=>{if(!m||!f)throw Error("User not authenticated or no business selected");let t=await o(m.id,f.id,e);if(!t.success)throw Error(t.error);return await h(),p({title:"Success",description:"Carriage inwards record created successfully"}),t.data},y=async(e,t)=>{if(!f)throw Error("No business selected");let r=await c(e,f.id,t);if(!r.success)throw Error(r.error);return await h(),p({title:"Success",description:"Carriage inwards record updated successfully"}),!0},x=async e=>{if(!f)throw Error("No business selected");let t=await l(e,f.id);if(!t.success)throw Error(t.error);return await h(),p({title:"Success",description:"Carriage inwards record deleted successfully"}),!0};return(0,t.useEffect)(()=>{h()},[h]),{carriageInwards:e,isLoading:d,createCarriageInward:g,updateCarriageInward:y,deleteCarriageInward:x,refreshCarriageInwards:h}}],983747)},115057,10813,941554,e=>{"use strict";var t=e.i(475254);let r=(0,t.default)("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);e.s(["ArrowUpRight",()=>r],115057);let a=(0,t.default)("ArrowDownRight",[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]]);e.s(["ArrowDownRight",()=>a],10813);var s=e.i(843476),i=e.i(271645),n=e.i(653145),o=e.i(776639),c=e.i(519455),l=e.i(793479),d=e.i(110204),u=e.i(624687),m=e.i(257428),f=e.i(160615);e.s(["default",0,({open:e,onOpenChange:t,onSubmit:r,title:a,initialData:p,isSubmitting:h=!1})=>{let{settings:g}=(0,f.useBusinessSettings)(),{register:y,handleSubmit:x,formState:{errors:b},reset:v,watch:S,setValue:w}=(0,n.useForm)({defaultValues:{name:"",description:"",isDefault:!1,...p}});i.default.useEffect(()=>{e&&p?v({name:p.name||"",description:p.description||"",openingBalance:p.openingBalance||0,isDefault:p.isDefault||!1}):e&&v({name:"",description:"",openingBalance:void 0,isDefault:!1})},[e,p,v]);let C=S("isDefault"),j=g.currency||"UGX";return(0,s.jsx)(o.Dialog,{open:e,onOpenChange:t,children:(0,s.jsxs)(o.DialogContent,{className:"sm:max-w-[425px]",children:[(0,s.jsx)(o.DialogHeader,{children:(0,s.jsx)(o.DialogTitle,{children:a})}),(0,s.jsxs)("form",{onSubmit:x(e=>{r(e)}),className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(d.Label,{htmlFor:"name",children:"Account Name"}),(0,s.jsx)(l.Input,{id:"name",...y("name",{required:"Account name is required"}),placeholder:"e.g., Main Cash, Petty Cash",disabled:h}),b.name&&(0,s.jsx)("p",{className:"text-sm text-red-600",children:b.name.message})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(d.Label,{htmlFor:"description",children:"Description (Optional)"}),(0,s.jsx)(u.Textarea,{id:"description",...y("description"),placeholder:"Brief description of this account",rows:3,disabled:h})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)(d.Label,{htmlFor:"openingBalance",children:["Opening Balance (",j,")"]}),(0,s.jsx)(l.Input,{id:"openingBalance",type:"number",step:"0.01",...y("openingBalance",{required:"Opening balance is required",min:{value:0,message:"Opening balance cannot be negative"}}),placeholder:"0.00",disabled:h}),b.openingBalance&&(0,s.jsx)("p",{className:"text-sm text-red-600",children:b.openingBalance.message})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(m.Checkbox,{id:"isDefault",checked:C,onCheckedChange:e=>w("isDefault",e),disabled:h}),(0,s.jsx)(d.Label,{htmlFor:"isDefault",className:"text-sm",children:"Set as default account"})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[(0,s.jsx)(c.Button,{type:"button",variant:"outline",onClick:()=>t(!1),disabled:h,children:"Cancel"}),(0,s.jsx)(c.Button,{type:"submit",disabled:h,children:h?p?"Updating...":"Creating...":p?"Update Account":"Create Account"})]})]})]})})}],941554)},310929,e=>{"use strict";var t=e.i(843476),r=e.i(967489),a=e.i(519455),s=e.i(87316),i=e.i(337822),n=e.i(227766),o=e.i(401851);e.s(["default",0,({dateFilter:e,dateRange:c,specificDate:l,isCustomRange:d,isSpecificDate:u=!1,onDateFilterChange:m,onDateRangeChange:f,onSpecificDateChange:p})=>(0,t.jsxs)("div",{className:"flex gap-4 items-center flex-wrap mb-4",onClick:e=>{e.stopPropagation()},children:[(0,t.jsx)("div",{className:"w-[240px] relative",children:(0,t.jsxs)(r.Select,{value:e,onValueChange:m,children:[(0,t.jsx)(r.SelectTrigger,{className:"bg-white shadow-sm",children:(0,t.jsx)(r.SelectValue,{placeholder:"Select date range"})}),(0,t.jsxs)(r.SelectContent,{className:"z-[9999] bg-white shadow-lg border border-border/50",children:[(0,t.jsx)(r.SelectItem,{value:"today",children:"Today"}),(0,t.jsx)(r.SelectItem,{value:"yesterday",children:"Yesterday"}),(0,t.jsx)(r.SelectItem,{value:"this-week",children:"This Week"}),(0,t.jsx)(r.SelectItem,{value:"last-week",children:"Last Week"}),(0,t.jsx)(r.SelectItem,{value:"this-month",children:"This Month"}),(0,t.jsx)(r.SelectItem,{value:"last-month",children:"Last Month"}),(0,t.jsx)(r.SelectItem,{value:"this-year",children:"This Year"}),(0,t.jsx)(r.SelectItem,{value:"all",children:"All Time"}),(0,t.jsx)(r.SelectItem,{value:"specific",children:"Specific Date"}),(0,t.jsx)(r.SelectItem,{value:"custom",children:"Custom Range"})]})]})}),u&&p&&(0,t.jsx)("div",{className:"flex items-center",children:(0,t.jsxs)(i.Popover,{children:[(0,t.jsx)(i.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)(a.Button,{variant:"outline",className:"bg-white flex items-center gap-2 h-10 pl-3 text-left font-normal",children:[(0,t.jsx)(s.Calendar,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:l?(0,o.format)(l,"MMM d, yyyy"):"Select Date"})]})}),(0,t.jsx)(i.PopoverContent,{className:"w-auto p-0 z-[9999] bg-white shadow-lg",align:"start",children:(0,t.jsx)(n.Calendar,{initialFocus:!0,mode:"single",defaultMonth:l,selected:l,onSelect:p,className:"p-3 pointer-events-auto",showOutsideDays:!0})})]})}),d&&(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsxs)(i.Popover,{children:[(0,t.jsx)(i.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)(a.Button,{variant:"outline",className:"bg-white flex items-center gap-2 h-10 pl-3 text-left font-normal",children:[(0,t.jsx)(s.Calendar,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:c.from?(0,o.format)(c.from,"MMM d, yyyy"):"Start Date"})]})}),(0,t.jsx)(i.PopoverContent,{className:"w-auto p-0 z-[9999] bg-white shadow-lg",align:"start",children:(0,t.jsx)(n.Calendar,{initialFocus:!0,mode:"single",defaultMonth:c?.from,selected:c?.from,onSelect:e=>f({...c,from:e}),className:"p-3 pointer-events-auto",showOutsideDays:!0})})]}),(0,t.jsx)("span",{className:"text-muted-foreground",children:"to"}),(0,t.jsxs)(i.Popover,{children:[(0,t.jsx)(i.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)(a.Button,{variant:"outline",className:"bg-white flex items-center gap-2 h-10 pl-3 text-left font-normal",children:[(0,t.jsx)(s.Calendar,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:c.to?(0,o.format)(c.to,"MMM d, yyyy"):"End Date"})]})}),(0,t.jsx)(i.PopoverContent,{className:"w-auto p-0 z-[9999] bg-white shadow-lg",align:"start",children:(0,t.jsx)(n.Calendar,{initialFocus:!0,mode:"single",defaultMonth:c?.to,selected:c?.to,onSelect:e=>f({...c,to:e}),className:"p-3 pointer-events-auto",showOutsideDays:!0})})]})]})]})])},299634,e=>{"use strict";var t=e.i(271645),r=e.i(908406),a=e.i(422713),s=e.i(266027),i=e.i(912598),n=e.i(95187);let o=(0,n.createServerReference)("403ecd539ba07dc1ae97e837a5af133a7339b5cb64",n.callServer,void 0,n.findSourceMapURL,"getExpensesAction"),c=(0,n.createServerReference)("60ff4a4d37b8cdb46933c77d4c2feddf840c5c9e12",n.callServer,void 0,n.findSourceMapURL,"createExpenseAction"),l=(0,n.createServerReference)("70d8f9fd83845cd0ba1effc4e3ccdba420d97bade6",n.callServer,void 0,n.findSourceMapURL,"updateExpenseAction"),d=(0,n.createServerReference)("40f5e1fa124fe3ebdec7f34b54a6837a1c32f5d22d",n.callServer,void 0,n.findSourceMapURL,"deleteExpenseAction");var u=e.i(102594);e.s(["useExpenses",0,()=>{let[e,n]=(0,t.useState)([]),{toast:m}=(0,r.useToast)(),{currentBusiness:f}=(0,a.useBusiness)(),{user:p}=(0,u.useAuth)(),h=(0,i.useQueryClient)(),g=(0,t.useCallback)(async()=>{if(!f)return[];try{let e=await o(f.id);if(!e.success||!e.data)throw Error(e.error||"Failed to fetch expenses");return e.data.map(e=>({id:e.id,amount:Number(e.amount),description:e.description,category:e.category,date:new Date(e.date),paymentMethod:e.paymentMethod,personInCharge:e.personInCharge,receiptImage:e.receiptImage,cashAccountId:e.cashAccountId,cashTransactionId:e.cashTransactionId,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)}))}catch(e){return console.error("Error loading expenses:",e),m({title:"Error",description:"Failed to load expenses. Please try again.",variant:"destructive"}),[]}},[f?.id,m]),y=["expenses",f?.id],{data:x,isLoading:b,isFetching:v}=(0,s.useQuery)({queryKey:y,queryFn:g,enabled:!!f?.id,staleTime:3e5,gcTime:18e5,refetchOnWindowFocus:!1,refetchOnReconnect:!1});(0,t.useEffect)(()=>{x&&n(x)},[x]);let S=async(t,r)=>{try{let a=e.find(e=>e.id===t);if(!a)throw Error("Expense not found");let s={amount:void 0!==r.amount?r.amount:a.amount,description:void 0!==r.description?r.description:a.description,category:void 0!==r.category?r.category:a.category,date:void 0!==r.date?r.date:a.date,paymentMethod:void 0!==r.paymentMethod?r.paymentMethod:a.paymentMethod,personInCharge:void 0!==r.personInCharge?r.personInCharge:a.personInCharge,receiptImage:void 0!==r.receiptImage?r.receiptImage:a.receiptImage,cashAccountId:r.linkToCash?r.cashAccountId:!1===r.linkToCash?null:a.cashAccountId},i=await l(t,s,a);if(!i.success)throw Error(i.error);h.invalidateQueries({queryKey:y}),m({title:"Success",description:"Expense updated successfully"})}catch(e){console.error("Error updating expense:",e),m({title:"Error",description:"Failed to update expense. Please try again.",variant:"destructive"})}};return{expenses:e,isLoading:b&&!x,createExpense:async e=>{if(!f||!p)return void m({title:"Error",description:f?"User not authenticated":"No business selected",variant:"destructive"});try{let t={amount:e.amount,description:e.description,category:e.category,date:e.date,paymentMethod:e.paymentMethod,personInCharge:e.personInCharge,receiptImage:e.receiptImage,cashAccountId:e.cashAccountId,userId:p.id,locationId:f.id},r=await c(t,!!e.linkToCash);if(!r.success||!r.data)throw Error(r.error);let a=r.data,s={id:a.id,amount:Number(a.amount),description:a.description,category:a.category,date:new Date(a.date),paymentMethod:a.paymentMethod,personInCharge:a.personInCharge,receiptImage:a.receiptImage,cashAccountId:a.cashAccountId,cashTransactionId:a.cashTransactionId,createdAt:new Date(a.createdAt),updatedAt:new Date(a.updatedAt)};return n(e=>[s,...e]),h.setQueryData(y,e=>e?[s,...e]:[s]),h.invalidateQueries({queryKey:y}),m({title:"Success",description:"Expense created successfully"}),s}catch(e){console.error("Error creating expense:",e),m({title:"Error",description:"Failed to create expense. Please try again.",variant:"destructive"})}},createBulkExpenses:async e=>{if(!f||!p)return void m({title:"Error",description:f?"User not authenticated":"No business selected",variant:"destructive"});try{let t=[];for(let r of e){let e={amount:r.amount,description:r.description,category:r.category,date:r.date,paymentMethod:r.paymentMethod,personInCharge:r.personInCharge,receiptImage:r.receiptImage,cashAccountId:r.cashAccountId,userId:p.id,locationId:f.id},a=await c(e,!!r.linkToCash);if(a.success&&a.data){let e=a.data;t.push({id:e.id,amount:Number(e.amount),description:e.description,category:e.category,date:new Date(e.date),paymentMethod:e.paymentMethod,personInCharge:e.personInCharge,receiptImage:e.receiptImage,cashAccountId:e.cashAccountId,cashTransactionId:e.cashTransactionId,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)})}}return h.invalidateQueries({queryKey:y}),m({title:"Success",description:`Successfully created ${t.length} expenses`}),t}catch(e){throw console.error("Error creating bulk expenses:",e),m({title:"Error",description:"Failed to create bulk expenses. Please try again.",variant:"destructive"}),e}},updateExpense:S,deleteExpense:async e=>{try{let t=await d(e);if(!t.success)throw Error(t.error);return n(t=>t.filter(t=>t.id!==e)),h.setQueryData(y,t=>t?t.filter(t=>t.id!==e):t),h.invalidateQueries({queryKey:y}),m({title:"Success",description:"Expense deleted successfully"}),!0}catch(e){return console.error("Error deleting expense:",e),m({title:"Error",description:"Failed to delete expense. Please try again.",variant:"destructive"}),!1}},refreshExpenses:async()=>{h.invalidateQueries({queryKey:y})}}}],299634)},52658,e=>{"use strict";var t=e.i(843476),r=e.i(271645),a=e.i(422713),s=e.i(966265),i=e.i(677572),n=e.i(107233),o=e.i(519455),c=e.i(414877);let l=({onCreateAccount:e,canCreate:r=!0})=>((0,c.useIsMobile)(),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"Cash Accounts"}),r&&(0,t.jsxs)(o.Button,{onClick:e,className:"gap-2",size:"default",children:[(0,t.jsx)(n.Plus,{className:"h-4 w-4"}),"New Cash Account"]})]}));var d=e.i(904792),u=e.i(515288),m=e.i(487486),f=e.i(541071),p=e.i(115057),h=e.i(10813),g=e.i(252754),y=e.i(531278),x=e.i(755146),b=e.i(98363),v=e.i(160615),S=e.i(868499);let w=({open:e,onOpenChange:r,account:a,transactionCount:s=0,details:i,onConfirm:n})=>{if(!a)return null;let o=s>0;return(0,t.jsx)(S.AlertDialog,{open:e,onOpenChange:r,children:(0,t.jsxs)(S.AlertDialogContent,{children:[(0,t.jsxs)(S.AlertDialogHeader,{children:[(0,t.jsx)(S.AlertDialogTitle,{children:"Delete Cash Account"}),(0,t.jsxs)(S.AlertDialogDescription,{className:"space-y-2",children:[(0,t.jsxs)("span",{className:"block",children:['Are you sure you want to delete the cash account "',a.name,'"?']}),o&&(0,t.jsxs)("span",{className:"block text-amber-600 font-medium",children:["This account has ",i||`${s} linked records`,"."]})]})]}),(0,t.jsxs)(S.AlertDialogFooter,{className:o?"flex-col gap-2 sm:flex-col":"",children:[(0,t.jsx)(S.AlertDialogCancel,{children:"Cancel"}),o?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(S.AlertDialogAction,{onClick:()=>n(!1),className:"bg-blue-600 hover:bg-blue-700",children:"Delete Account Only (Unlink Records)"}),(0,t.jsx)(S.AlertDialogAction,{onClick:()=>n(!0),className:"bg-red-600 hover:bg-red-700",children:"Delete Account & All Records"})]}):(0,t.jsx)(S.AlertDialogAction,{onClick:()=>n(!1),className:"bg-red-600 hover:bg-red-700",children:"Delete Account"})]})]})})};var C=e.i(975157),j=e.i(777624),N=e.i(392401);let T=({account:e,onAccountDeleted:a})=>{let i=(0,d.useNavigate)(),n=(0,c.useIsMobile)(),{deleteAccount:l,deleteAccountWithTransactions:S}=(0,s.useCashAccounts)(),{getDailySummary:T}=(0,b.useCashTransactions)(e.id),{settings:A}=(0,v.useBusinessSettings)(),{hasPermission:D}=(0,j.useProfiles)(),{canManageFinanceAccounts:I}=(0,N.useFinancialVisibility)(),E=D("finance","delete"),[P,_]=(0,r.useState)(!0),[M,k]=(0,r.useState)(!1),[R,O]=(0,r.useState)(0),[F,L]=(0,r.useState)(""),[B,$]=(0,r.useState)({date:new Date,openingBalance:0,cashIn:0,cashOut:0,transfersIn:0,transfersOut:0,closingBalance:0}),U=(0,r.useMemo)(()=>e=>(0,C.formatCashAmount)(e,A.currency||"USD"),[A.currency]),q=(0,r.useCallback)(async()=>{_(!0);try{let t=await T(new Date,e.id);$(t)}catch(e){console.error("Error loading today's summary:",e)}finally{_(!1)}},[T,e.id]);(0,r.useEffect)(()=>{q()},[q]);let Q=(0,r.useCallback)(async()=>{console.log("Delete button clicked for account:",e.id);try{let t=await l(e.id,a);console.log("Delete result:",t),t&&"object"==typeof t&&"hasTransactions"in t&&(t.hasTransactions?(console.log("Account has transactions, showing dialog"),O(t.transactionCount||0),L(t.details||""),k(!0)):t.success?console.log("Account deleted successfully without dialog"):console.log("Account deletion failed"))}catch(e){console.error("Unexpected error during deletion:",e)}},[l,e.id,a]),H=(0,r.useCallback)(async t=>{console.log("Confirm delete called with deleteTransactions:",t);try{let r=await S(e.id,t,a);console.log("Delete with transactions result:",r),r?(k(!1),console.log("Deletion successful, dialog closed")):console.log("Deletion failed")}catch(e){console.error("Error in handleConfirmDelete:",e)}},[S,e.id,a]),z=(0,r.useCallback)(()=>{i(`/cash/${e.id}`)},[i,e.id]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(u.Card,{className:`hover:shadow-lg transition-all duration-200 cursor-pointer ${n?"shadow-sm border-gray-200":"hover:shadow-md"}`,children:[(0,t.jsxs)(u.CardHeader,{className:`flex flex-row items-center justify-between space-y-0 ${n?"pb-3":"pb-2"}`,children:[(0,t.jsxs)(u.CardTitle,{className:`${n?"text-base":"text-sm"} font-semibold flex items-center gap-2 text-gray-900`,children:[(0,t.jsx)(g.Wallet,{className:`${n?"h-5 w-5":"h-4 w-4"} text-primary`}),(0,t.jsx)("span",{className:"truncate",children:e.name}),e.isDefault&&(0,t.jsx)(m.Badge,{variant:"secondary",className:`${n?"text-xs px-2 py-0.5":"text-xs"} bg-primary/10 text-primary border-primary/20`,children:"Default"})]}),(0,t.jsxs)(x.DropdownMenu,{children:[(0,t.jsx)(x.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(o.Button,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-gray-100",children:(0,t.jsx)(f.MoreHorizontal,{className:"h-4 w-4 text-gray-500"})})}),(0,t.jsxs)(x.DropdownMenuContent,{align:"end",className:"bg-white border border-gray-200 shadow-lg",children:[(0,t.jsx)(x.DropdownMenuItem,{onClick:z,className:"hover:bg-gray-50",children:"View Details"}),E&&(0,t.jsx)(x.DropdownMenuItem,{onClick:Q,className:"text-red-600 hover:bg-red-50",children:"Delete Account"})]})]})]}),(0,t.jsx)(u.CardContent,{onClick:z,className:n?"px-4 pb-4":"",children:(0,t.jsxs)("div",{className:`space-y-${n?"4":"3"}`,children:[(0,t.jsxs)("div",{className:n?"space-y-1":"",children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-gray-900 flex items-center",children:P?(0,t.jsx)(y.Loader2,{className:"h-6 w-6 animate-spin text-muted-foreground"}):I?U(B.closingBalance):""}),(0,t.jsx)("p",{className:`${n?"text-sm":"text-xs"} text-gray-500 font-medium`,children:"Current Balance"})]}),e.description&&(0,t.jsx)("p",{className:`${n?"text-sm leading-relaxed":"text-sm"} text-gray-600 line-clamp-2`,children:e.description}),(0,t.jsxs)("div",{className:`grid grid-cols-1 ${n?"gap-3":"gap-2"} text-sm`,children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-2 bg-green-50 rounded-md",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-green-700",children:[(0,t.jsx)(p.ArrowUpRight,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"font-medium",children:"Opening"})]}),(0,t.jsx)("span",{className:"font-semibold text-green-800 flex items-center",children:P?(0,t.jsx)(y.Loader2,{className:"h-4 w-4 animate-spin text-green-600"}):I?U(B.openingBalance):""})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between p-2 bg-blue-50 rounded-md",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-blue-700",children:[(0,t.jsx)(h.ArrowDownRight,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"font-medium",children:"Today's Close"})]}),(0,t.jsx)("span",{className:"font-semibold text-blue-800 flex items-center",children:P?(0,t.jsx)(y.Loader2,{className:"h-4 w-4 animate-spin text-blue-600"}):I?U(B.closingBalance):""})]})]}),(0,t.jsx)("div",{className:"pt-2",children:(0,t.jsx)(o.Button,{variant:"outline",size:n?"default":"sm",className:`w-full font-medium hover:bg-primary hover:text-white transition-colors ${n?"h-10":""}`,onClick:e=>{e.stopPropagation(),z()},children:"Manage Account"})})]})})]}),(0,t.jsx)(w,{open:M,onOpenChange:k,account:e,transactionCount:R,details:F,onConfirm:H})]})},A=({accounts:e,isLoading:r,onCreateAccount:a,onAccountDeleted:s,canCreate:i=!0})=>((0,c.useIsMobile)(),r)?(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:[1,2,3].map(e=>(0,t.jsx)("div",{className:"h-64 bg-gray-100 animate-pulse rounded-lg"},e))}):0===e.length?(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No cash accounts"}),(0,t.jsx)("p",{className:"text-gray-500 mb-4",children:"Get started by creating your first cash account."}),i&&(0,t.jsxs)(o.Button,{onClick:a,className:"gap-2",children:[(0,t.jsx)(n.Plus,{className:"h-4 w-4"}),"Create Cash Account"]})]}):(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:e.map(e=>(0,t.jsx)(T,{account:e,onAccountDeleted:s},e.id))});var D=e.i(941554),I=e.i(102594),E=e.i(146786),P=e.i(299634),_=e.i(840710),M=e.i(983747),k=e.i(631422),R=e.i(550516),O=e.i(310929),F=e.i(784774),L=e.i(302747),B=e.i(793479),$=e.i(110204);let U=({taxPercentage:e,onTaxChange:r,netProfitLoss:a,formatCurrency:s})=>(0,t.jsxs)("div",{className:"flex items-center gap-4 p-4 bg-gray-50 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)($.Label,{htmlFor:"tax-percentage",className:"text-sm font-medium",children:"Tax %:"}),(0,t.jsx)(B.Input,{id:"tax-percentage",type:"number",min:"0",max:"100",step:"0.1",value:e,onChange:e=>{r(Math.max(0,Math.min(100,parseFloat(e.target.value)||0)))},className:"w-20 h-8 text-center"})]}),(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Tax Amount: "}),(0,t.jsx)("span",{className:"font-medium",children:s(a>0?a*e/100:0)})]})]});var q=e.i(440160),Q=e.i(178583);let H=(0,e.i(475254).default)("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);var z=e.i(401851),G=e.i(255749);let V=async e=>{let{data:t,dateRange:r,currency:a,businessName:s,dateFilter:i}=e,n=new G.default({orientation:"portrait",unit:"mm",format:"a4"}),o=n.internal.pageSize.getWidth(),c=n.internal.pageSize.getHeight(),l=20,d=()=>{n.setFontSize(8),n.setFont("helvetica","normal"),n.setTextColor(150,150,150),n.text("Created By Gonza Systems",o/2,c-10,{align:"center"}),n.setTextColor(0,0,0)},u=e=>`${a} ${e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`;if(s){n.setFontSize(18),n.setFont("helvetica","bold");let e=n.getTextWidth(s);n.text(s,(o-e)/2,l),l+=10}n.setFontSize(16),n.setFont("helvetica","bold");let m="Profit & Loss Account",f=n.getTextWidth(m);n.text(m,(o-f)/2,l),l+=8,n.setFontSize(11),n.setFont("helvetica","normal");let p=((e,t)=>{if(t.from&&t.to){let r=t.from.getMonth()===t.to.getMonth()&&t.from.getFullYear()===t.to.getFullYear();if(t.from.toDateString()===t.to.toDateString())return(0,z.format)(t.from,"MMM dd, yyyy");if(r&&"this-month"===e)return(0,z.format)(t.from,"MMMM yyyy");if("this-year"===e)return(0,z.format)(t.from,"yyyy");else if("last-month"===e)return(0,z.format)(t.from,"MMMM yyyy");else if("this-week"===e||"last-week"===e)return`Week of ${(0,z.format)(t.from,"MMM dd")} - ${(0,z.format)(t.to,"MMM dd, yyyy")}`;else return`Custom Period: ${(0,z.format)(t.from,"MM/dd/yyyy")} - ${(0,z.format)(t.to,"MM/dd/yyyy")}`}return t.from?(0,z.format)(t.from,"MMM dd, yyyy"):"All Periods"})(i,r),h=n.getTextWidth(p);n.text(p,(o-h)/2,l),l+=15;let g=e=>{l>c-40&&(d(),n.addPage(),l=20),n.setFontSize(12),n.setFont("helvetica","bold"),n.text(e,20,l),l+=6},y=(e,t,r={})=>{let{isBold:a=!1,isSubtraction:s=!1,isTotal:i=!1,indent:m=!1,showNegativeSign:f=!1}=r;if(l>c-25&&(d(),n.addPage(),l=20),n.setFontSize(10),n.setFont("helvetica",a?"bold":"normal"),n.text(e,m?30:20,l),null!==t){let e;e=f&&t<0?`-${u(Math.abs(t))}`:s?`(${u(Math.abs(t))})`:u(Math.abs(t));let r=n.getTextWidth(e);n.text(e,o-20-r,l)}i&&(n.setLineWidth(.3),n.line(20,l+2,o-20,l+2),l+=2),l+=5},x=(e=3)=>{l+=e};g("SALES/REVENUE"),y("Sales/Revenue",t.sales,{indent:!0}),y("Sales Returns",t.salesReturns,{isSubtraction:!0,indent:!0}),y("NET SALES",t.netSales,{isBold:!0,isTotal:!0}),x(5),g("COST OF GOODS SOLD (COGS)"),y("Total Cost Sales",t.totalCostSales,{indent:!0}),y("Carriage Inwards",t.carriageInwards,{indent:!0}),y("TOTAL COST OF GOODS SOLD (COGS)",t.totalCOGS,{isBold:!0,isTotal:!0}),x(5),y("GROSS PROFIT",t.grossProfit,{isBold:!0,isTotal:!0,showNegativeSign:!0}),x(3),g("EXPENSES"),Object.entries(t.expensesByCategory).forEach(([e,t])=>{y(e.charAt(0).toUpperCase()+e.slice(1).toLowerCase(),t,{indent:!0})}),y("TOTAL EXPENSES",t.totalExpenses,{isBold:!0,isTotal:!0}),x(5),y("NET PROFIT / LOSS",t.netProfitLoss,{isBold:!0,isTotal:!0,showNegativeSign:!0}),y(`Tax (${t.taxPercentage}%)`,t.taxAmount,{indent:!0}),y("FINAL PROFIT AFTER TAX",t.finalProfitAfterTax,{isBold:!0,isTotal:!0,showNegativeSign:!0}),d();let b=`profit_loss_${r.from?(0,z.format)(r.from,"yyyy-MM-dd"):"current"}_to_${r.to?(0,z.format)(r.to,"yyyy-MM-dd"):"current"}.pdf`;n.save(b)};var W=e.i(908406);let K=({data:e,dateRange:a,currency:s,businessName:i,businessLogo:n,dateFilter:c})=>{let[l,d]=(0,r.useState)(!1),{toast:u}=(0,W.useToast)(),m=async()=>{try{d(!0),(e=>{let{data:t,dateRange:r,currency:a,businessName:s,dateFilter:i}=e,n=(e,t=!1)=>t&&e<0?`-${Math.abs(e).toFixed(0)}`:e.toFixed(0),o=[];o.push("PROFIT & LOSS ACCOUNT"),o.push(""),s&&o.push(`Business,${s}`),o.push(`Period,${((e,t)=>{if(t.from&&t.to){let r=t.from.getMonth()===t.to.getMonth()&&t.from.getFullYear()===t.to.getFullYear();if(t.from.toDateString()===t.to.toDateString())return(0,z.format)(t.from,"MMM dd, yyyy");if(r&&"this-month"===e)return(0,z.format)(t.from,"MMMM yyyy");if("this-year"===e)return(0,z.format)(t.from,"yyyy");else if("last-month"===e)return(0,z.format)(t.from,"MMMM yyyy");else if("this-week"===e||"last-week"===e)return`Week of ${(0,z.format)(t.from,"MMM dd")} - ${(0,z.format)(t.to,"MMM dd, yyyy")}`;else return`Custom Period: ${(0,z.format)(t.from,"MM/dd/yyyy")} - ${(0,z.format)(t.to,"MM/dd/yyyy")}`}return t.from?(0,z.format)(t.from,"MMM dd, yyyy"):"All Periods"})(i,r)}`),o.push(`Generated,${(0,z.format)(new Date,"MMM dd yyyy HH:mm")}`),o.push(`Currency,${a}`),o.push(""),o.push("DETAILS,AMOUNT"),o.push(""),o.push("SALES/REVENUE,"),o.push(`Sales/Revenue,${n(t.sales)}`),o.push(`Sales Returns,(${n(t.salesReturns)})`),o.push(`NET SALES,${n(t.netSales)}`),o.push(""),o.push("COST OF GOODS SOLD (COGS),"),o.push(`Total Cost Sales,${n(t.totalCostSales)}`),o.push(`Carriage Inwards,${n(t.carriageInwards)}`),o.push(`TOTAL COST OF GOODS SOLD (COGS),${n(t.totalCOGS)}`),o.push(""),o.push(`GROSS PROFIT,${n(t.grossProfit,!0)}`),o.push(""),o.push("EXPENSES,"),Object.entries(t.expensesByCategory).forEach(([e,t])=>{let r=e.charAt(0).toUpperCase()+e.slice(1).toLowerCase();o.push(`${r},${n(t)}`)}),o.push(`TOTAL EXPENSES,${n(t.totalExpenses)}`),o.push(""),o.push(`NET PROFIT / LOSS,${n(t.netProfitLoss,!0)}`),o.push(`Tax (${t.taxPercentage}%),${n(t.taxAmount)}`),o.push(`FINAL PROFIT AFTER TAX,${n(t.finalProfitAfterTax,!0)}`);let c=new Blob([o.join("\n")],{type:"text/csv;charset=utf-8;"}),l=document.createElement("a");if(void 0!==l.download){let e=URL.createObjectURL(c);l.setAttribute("href",e);let t=`profit_loss_${r.from?(0,z.format)(r.from,"yyyy-MM-dd"):"current"}_to_${r.to?(0,z.format)(r.to,"yyyy-MM-dd"):"current"}.csv`;l.setAttribute("download",t),l.style.visibility="hidden",document.body.appendChild(l),l.click(),document.body.removeChild(l)}})({data:e,dateRange:a,currency:s,businessName:i,dateFilter:c}),u({title:"Export Successful",description:"Profit & Loss Account exported to CSV successfully."})}catch(e){console.error("Error exporting CSV:",e),u({title:"Export Failed",description:"Failed to export Profit & Loss Account to CSV.",variant:"destructive"})}finally{d(!1)}},f=async()=>{try{d(!0),await V({data:e,dateRange:a,currency:s,businessName:i,businessLogo:n,dateFilter:c}),u({title:"Export Successful",description:"Profit & Loss Account exported to PDF successfully."})}catch(e){console.error("Error exporting PDF:",e),u({title:"Export Failed",description:"Failed to export Profit & Loss Account to PDF.",variant:"destructive"})}finally{d(!1)}};return(0,t.jsxs)(x.DropdownMenu,{children:[(0,t.jsx)(x.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(o.Button,{variant:"outline",size:"sm",disabled:l,children:[(0,t.jsx)(q.Download,{className:"h-4 w-4 mr-2"}),"Export"]})}),(0,t.jsxs)(x.DropdownMenuContent,{children:[(0,t.jsxs)(x.DropdownMenuItem,{onClick:m,disabled:l,children:[(0,t.jsx)(H,{className:"h-4 w-4 mr-2"}),"Export as CSV"]}),(0,t.jsxs)(x.DropdownMenuItem,{onClick:f,disabled:l,children:[(0,t.jsx)(Q.FileText,{className:"h-4 w-4 mr-2"}),"Export as PDF"]})]})]})},X=({data:e,isLoading:r,formatCurrency:a,onTaxChange:s,dateRange:i,businessName:n,businessLogo:o,currency:c,dateFilter:l})=>{if(r)return(0,t.jsxs)(u.Card,{children:[(0,t.jsx)(u.CardHeader,{children:(0,t.jsx)(u.CardTitle,{children:"Profit & Loss Account"})}),(0,t.jsx)(u.CardContent,{children:(0,t.jsx)("div",{className:"space-y-3",children:[...Array(15)].map((e,r)=>(0,t.jsx)(L.Skeleton,{className:"h-8 w-full"},r))})})]});let d=[{detail:"SALES/REVENUE",amount:e.sales,isBold:!0},{detail:"SALES RETURNS",amount:e.salesReturns,isSubtraction:!0},{detail:"NET SALES",amount:e.netSales,isBold:!0,isTotal:!0},{detail:"",amount:null,isSpacer:!0},{detail:"COST OF GOODS SOLD (COGS)",amount:null,isHeader:!0},{detail:"TOTAL COST SALES",amount:e.totalCostSales},{detail:"CARRIAGE INWARDS",amount:e.carriageInwards},{detail:"TOTAL COST OF GOODS SOLD (COGS)",amount:e.totalCOGS,isBold:!0,isTotal:!0},{detail:"",amount:null,isSpacer:!0},{detail:"GROSS PROFIT",amount:e.grossProfit,isBold:!0,isTotal:!0},{detail:"",amount:null,isSpacer:!0},{detail:"EXPENSES",amount:null,isHeader:!0}];Object.entries(e.expensesByCategory).forEach(([e,t])=>{d.push({detail:e.toUpperCase(),amount:t})}),d.push({detail:"TOTAL EXPENSES",amount:e.totalExpenses,isBold:!0,isTotal:!0},{detail:"",amount:null,isSpacer:!0},{detail:"NET PROFIT / LOSS",amount:e.netProfitLoss,isBold:!0,isTotal:!0},{detail:"TAX",amount:e.taxAmount},{detail:"FINAL PROFIT AFTER TAX",amount:e.finalProfitAfterTax,isBold:!0,isTotal:!0});let m=e=>e.amount<0?"text-red-600":e.detail?.includes("PROFIT")&&e.amount>0?"text-green-600":e.detail?.includes("EXPENSE")||e.detail?.includes("TAX")?"text-red-600":"text-gray-900";return(0,t.jsxs)(u.Card,{children:[(0,t.jsx)(u.CardHeader,{children:(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)(u.CardTitle,{children:"Profit & Loss Account"}),(0,t.jsx)(K,{data:e,dateRange:i,currency:c,businessName:n,businessLogo:o,dateFilter:l})]})}),(0,t.jsxs)(u.CardContent,{className:"space-y-4",children:[(0,t.jsx)(U,{taxPercentage:e.taxPercentage,onTaxChange:s,netProfitLoss:e.netProfitLoss,formatCurrency:a}),(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)(F.Table,{children:[(0,t.jsx)(F.TableHeader,{children:(0,t.jsxs)(F.TableRow,{children:[(0,t.jsx)(F.TableHead,{className:"font-bold text-left",children:"DETAILS"}),(0,t.jsx)(F.TableHead,{className:"font-bold text-right",children:"AMOUNT"})]})}),(0,t.jsx)(F.TableBody,{children:d.map((e,r)=>e.isSpacer?(0,t.jsx)(F.TableRow,{children:(0,t.jsx)(F.TableCell,{colSpan:2,className:"h-4 border-0"})},r):e.isHeader?(0,t.jsx)(F.TableRow,{children:(0,t.jsx)(F.TableCell,{colSpan:2,className:"font-bold text-gray-800 bg-gray-50 border-0",children:e.detail})},r):(0,t.jsxs)(F.TableRow,{className:e.isTotal?"border-t-2 border-gray-300":"",children:[(0,t.jsx)(F.TableCell,{className:`${e.isBold?"font-bold":""} ${m(e)}`,children:e.detail}),(0,t.jsx)(F.TableCell,{className:`text-right ${e.isBold?"font-bold":""} ${m(e)}`,children:null!==e.amount?(0,t.jsxs)("span",{children:[e.isSubtraction&&"(",a(Math.abs(e.amount)),e.isSubtraction&&")"]}):null})]},r))})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-6",children:[(0,t.jsx)(u.Card,{className:"border-blue-200 bg-blue-50",children:(0,t.jsxs)(u.CardContent,{className:"p-4 text-center",children:[(0,t.jsx)("p",{className:"text-sm text-blue-600 font-medium",children:"Gross Profit"}),(0,t.jsx)("p",{className:"text-lg font-bold text-blue-800",children:a(e.grossProfit)})]})}),(0,t.jsx)(u.Card,{className:`border-${e.netProfitLoss>=0?"green":"red"}-200 bg-${e.netProfitLoss>=0?"green":"red"}-50`,children:(0,t.jsxs)(u.CardContent,{className:"p-4 text-center",children:[(0,t.jsxs)("p",{className:`text-sm text-${e.netProfitLoss>=0?"green":"red"}-600 font-medium`,children:["Net ",e.netProfitLoss>=0?"Profit":"Loss"]}),(0,t.jsx)("p",{className:`text-lg font-bold text-${e.netProfitLoss>=0?"green":"red"}-800`,children:a(Math.abs(e.netProfitLoss))})]})}),(0,t.jsx)(u.Card,{className:`border-${e.finalProfitAfterTax>=0?"green":"red"}-200 bg-${e.finalProfitAfterTax>=0?"green":"red"}-50`,children:(0,t.jsxs)(u.CardContent,{className:"p-4 text-center",children:[(0,t.jsxs)("p",{className:`text-sm text-${e.finalProfitAfterTax>=0?"green":"red"}-600 font-medium`,children:["Final ",e.finalProfitAfterTax>=0?"Profit":"Loss"," After Tax"]}),(0,t.jsx)("p",{className:`text-lg font-bold text-${e.finalProfitAfterTax>=0?"green":"red"}-800`,children:a(Math.abs(e.finalProfitAfterTax))})]})})]})]})]})},Y=()=>{let{currentBusiness:e}=(0,a.useBusiness)(),{settings:s}=(0,v.useBusinessSettings)(),[i,n]=(0,r.useState)("this-month"),[o,c]=(0,r.useState)({from:void 0,to:void 0}),[l,d]=(0,r.useState)(void 0),[u,m]=(0,r.useState)(0),f="custom"===i,p="specific"===i;(0,r.useEffect)(()=>{"custom"===i?d(void 0):"specific"===i?c({from:void 0,to:void 0}):(c({from:void 0,to:void 0}),d(void 0))},[i]);let h=s?.currency||"USD",{profitLossData:g,isLoading:y}=((e,t,s,i=0)=>{let{user:n}=(0,I.useAuth)(),{currentBusiness:o}=(0,a.useBusiness)(),[c,l]=(0,r.useState)(!1),{sales:d,isLoading:u}=(0,E.useSalesData)(n?.id),{expenses:m,isLoading:f}=(0,P.useExpenses)(),{stockSummaryData:p,isLoading:h}=(0,_.useStockSummaryData)(t),{carriageInwards:g,isLoading:y}=(0,M.useCarriageInwards)();return{profitLossData:(0,r.useMemo)(()=>{let r,a;if("specific"===e&&s)(r=new Date(s)).setHours(0,0,0,0),(a=new Date(s)).setHours(23,59,59,999);else if("custom"===e&&t.from&&t.to)r=t.from,a=t.to;else{let t=(0,k.getDateRangeFromFilter)(e);r=t.from,a=t.to}let n=d.filter(t=>{let i=new Date(t.date);return"specific"===e&&s?(0,R.isSameDay)(i,s)&&"Quote"!==t.paymentStatus:i>=r&&i<=a&&"Quote"!==t.paymentStatus}),o=m.filter(t=>{let i=new Date(t.date);return"specific"===e&&s?(0,R.isSameDay)(i,s):i>=r&&i<=a}),c=g.filter(t=>{let i=new Date(t.date);return"specific"===e&&s?(0,R.isSameDay)(i,s):i>=r&&i<=a}),l=n.reduce((e,t)=>e+t.items.reduce((e,t)=>e+t.price*t.quantity,0),0),u=p.reduce((e,t)=>e+t.returnIn*t.sellingPrice,0),f=l-u,h=p.reduce((e,t)=>e+t.openingStock*t.costPrice,0),y=p.reduce((e,t)=>e+t.stockIn*t.costPrice,0),x=c.reduce((e,t)=>e+t.amount,0),b=p.reduce((e,t)=>e+t.closingStock*t.costPrice,0),v=n.reduce((e,t)=>e+t.items.reduce((e,t)=>e+(t.cost||0)*t.quantity,0),0),S=v+x,w=f-S,C={};o.forEach(e=>{let t=e.category||"Uncategorized";C[t]=(C[t]||0)+e.amount});let j=Object.values(C).reduce((e,t)=>e+t,0),N=w-j,T=N>0?N*i/100:0;return{sales:l,salesReturns:u,netSales:f,openingStock:h,purchases:y,carriageInwards:x,closingStock:b,totalCostSales:v,totalCOGS:S,grossProfit:w,expensesByCategory:C,totalExpenses:j,netProfitLoss:N,taxPercentage:i,taxAmount:T,finalProfitAfterTax:N-T}},[d,m,p,g,e,t,s,i]),isLoading:(0,r.useMemo)(()=>u||f||h||y,[u,f,h,y])}})(i,o,l,u),x=(0,r.useMemo)(()=>"custom"===i&&o.from&&o.to?o:"specific"===i&&l?{from:l,to:l}:"custom"!==i&&"specific"!==i?(0,k.getDateRangeFromFilter)(i):{from:void 0,to:void 0},[i,o,l]);return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Profit & Loss Account"}),(0,t.jsx)(O.default,{dateFilter:i,dateRange:o,specificDate:l,isCustomRange:f,isSpecificDate:p,onDateFilterChange:n,onDateRangeChange:c,onSpecificDateChange:d})]}),(0,t.jsx)(X,{data:g,isLoading:y,formatCurrency:e=>new Intl.NumberFormat("en-US",{style:"currency",currency:h,minimumFractionDigits:2}).format(e),onTaxChange:m,dateRange:x,businessName:e?.name,businessLogo:s?.businessLogo,currency:h,dateFilter:i})]})},Z=({accounts:e,isLoading:a,isDialogOpen:s,onDialogOpenChange:n,onCreateAccount:o,onAccountDeleted:c,canCreate:d=!0})=>{let[u,m]=r.default.useState(!1),f=()=>n(!0),p=async e=>{m(!0);try{await o(e)}finally{m(!1)}};return(0,t.jsxs)(i.Tabs,{defaultValue:"cash-accounts",className:"w-full",children:[(0,t.jsxs)(i.TabsList,{className:"grid w-full grid-cols-2",children:[(0,t.jsx)(i.TabsTrigger,{value:"cash-accounts",children:"Cash Accounts"}),(0,t.jsx)(i.TabsTrigger,{value:"profit-loss",children:"Profit & Loss"})]}),(0,t.jsxs)(i.TabsContent,{value:"cash-accounts",className:"space-y-6",children:[(0,t.jsx)(l,{onCreateAccount:f,canCreate:d}),(0,t.jsx)(A,{accounts:e,isLoading:a,onCreateAccount:f,onAccountDeleted:c,canCreate:d}),(0,t.jsx)(D.default,{open:s,onOpenChange:n,onSubmit:p,title:"Create New Cash Account",isSubmitting:u})]}),(0,t.jsx)(i.TabsContent,{value:"profit-loss",children:(0,t.jsx)(Y,{})})]})};var J=e.i(929592),ee=e.i(63209);e.s(["default",0,()=>{let{currentBusiness:e,isLoading:i}=(0,a.useBusiness)(),n=(0,d.useNavigate)(),{accounts:c,isLoading:l,createAccount:u,refreshAccounts:m}=(0,s.useCashAccounts)(),{hasPermission:f,isLoading:p}=(0,j.useProfiles)(),[h,g]=(0,r.useState)(!1);(e=>{let t=(0,d.useNavigate)(),[a,s]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{if(!a&&e.length>0){let r=localStorage.getItem("lastVisitedCashAccount"),a=localStorage.getItem("lastVisitedCashAccountUrl");if(r&&a){if(e.some(e=>e.id===r))return void t(a.replace(window.location.origin,""));localStorage.removeItem("lastVisitedCashAccount"),localStorage.removeItem("lastVisitedCashAccountUrl")}s(!0)}},[e,a,t])})(c);let y=async e=>{try{await u(e),g(!1)}catch(e){console.error("Error creating account:",e)}},x=async()=>{await m()};if(i||l||p)return(0,t.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})});if(!f("finance","view"))return(0,t.jsxs)("div",{className:"max-w-4xl mx-auto p-6",children:[(0,t.jsxs)(J.Alert,{variant:"destructive",children:[(0,t.jsx)(ee.AlertCircle,{className:"h-4 w-4"}),(0,t.jsx)(J.AlertTitle,{children:"Access Denied"}),(0,t.jsx)(J.AlertDescription,{children:"You do not have permission to view finance/cash accounts. Please contact your administrator if you believe this is an error."})]}),(0,t.jsx)("div",{className:"mt-4",children:(0,t.jsx)(o.Button,{onClick:()=>n("/"),variant:"outline",children:"Back to Dashboard"})})]});let b=f("finance","create");return(0,t.jsxs)("div",{className:"space-y-6 p-4 md:p-0",children:[(0,t.jsx)("h1",{className:"text-2xl md:text-3xl font-bold",children:"Finance"}),(0,t.jsx)(Z,{accounts:c,isLoading:i||!e||l,isDialogOpen:h,onDialogOpenChange:g,onCreateAccount:y,onAccountDeleted:x,canCreate:b})]})}],52658)},48503,e=>{e.v(t=>Promise.all(["static/chunks/034945ea23f7a8ce.js"].map(t=>e.l(t))).then(()=>t(915833)))},870653,e=>{e.v(t=>Promise.all(["static/chunks/63eee2351f5394d5.js"].map(t=>e.l(t))).then(()=>t(424154)))},195111,e=>{e.v(t=>Promise.all(["static/chunks/f66634c84e3526bd.js"].map(t=>e.l(t))).then(()=>t(38201)))}]);