(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,862587,e=>{"use strict";var t=e.i(843476),s=e.i(271645),a=e.i(102594),r=e.i(422713),l=e.i(908962),n=e.i(908406),i=e.i(414877),o=e.i(904792),c=e.i(184244),d=e.i(677572),m=e.i(487486),u=e.i(488844),x=e.i(555436),h=e.i(37727),p=e.i(160615),g=e.i(669469),f=e.i(980376),j=e.i(519455),y=e.i(759684);let b=({suggestions:e,isOpen:s,onClose:a,onSelectProduct:r,searchTerm:l,isLoading:n=!1})=>{let{settings:o}=(0,p.useBusinessSettings)(),c=(0,i.useIsMobile)(),d=(e,s)=>{if(!s)return e;let a=s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),r=RegExp(`(${a})`,"gi");return e.split(r).map((e,s)=>r.test(e)?(0,t.jsx)("span",{className:"bg-yellow-200 font-medium",children:e},s):(0,t.jsx)("span",{children:e},s))},b=e=>{r(e),a()};return c?s&&(0!==e.length||n)?(0,t.jsxs)("div",{className:"bg-white border border-gray-200 rounded-md shadow-lg max-h-80 overflow-y-auto",children:[(0,t.jsxs)("div",{className:"p-2 border-b bg-gray-50",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(x.Search,{className:"h-4 w-4 text-gray-600"}),(0,t.jsx)("span",{className:"text-sm font-medium",children:"Suggestions"})]}),(0,t.jsx)(j.Button,{variant:"ghost",size:"icon",onClick:a,className:"h-6 w-6",children:(0,t.jsx)(h.X,{className:"h-3 w-3"})})]}),(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:n?"Searching for products...":e.length>0?`Found ${e.length} product${e.length>1?"s":""}`:"No products found"})]}),n&&(0,t.jsxs)("div",{className:"p-8 text-center bg-white",children:[(0,t.jsx)("div",{className:"h-6 w-6 border-2 border-primary border-t-transparent animate-spin rounded-full mx-auto mb-2"}),(0,t.jsx)("span",{className:"text-xs text-gray-500",children:"Searching..."})]}),!n&&e.length>0&&(0,t.jsx)("div",{className:"max-h-64 overflow-y-auto bg-primary",children:e.map(e=>(0,t.jsx)("div",{className:"p-3 hover:bg-primary-foreground/20 cursor-pointer border-b border-primary-foreground/20 last:border-b-0 bg-white mx-1 my-1 rounded",onClick:()=>b(e),children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)(g.default,{imageUrl:e.imageUrl,alt:e.name,size:"sm"}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsx)(u.Package,{className:"h-4 w-4 text-gray-400 flex-shrink-0"}),(0,t.jsx)("div",{className:"font-medium text-sm truncate",children:d(e.name,l)})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(m.Badge,{variant:"outline",className:"text-xs",children:e.category}),(0,t.jsxs)("span",{className:"text-xs text-gray-500",children:["Item #: ",d(e.itemNumber,l)]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-1",children:[(0,t.jsxs)("span",{children:["Qty: ",e.quantity%1==0?e.quantity:e.quantity.toFixed(2)]}),(0,t.jsxs)("span",{className:"font-medium",children:[o.currency," ",e.sellingPrice.toFixed(2)]})]}),e.description&&(0,t.jsx)("div",{className:"text-xs text-gray-500 truncate",children:d(e.description,l)}),e.supplier&&(0,t.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["Supplier: ",d(e.supplier,l)]})]})]})},e.id))}),!n&&0===e.length&&(0,t.jsxs)("div",{className:"p-8 text-center bg-white",children:[(0,t.jsx)(x.Search,{className:"h-8 w-8 text-gray-300 mx-auto mb-2"}),(0,t.jsxs)("p",{className:"text-xs text-gray-500",children:['No products found matching "',l,'"']})]}),e.length>=50&&(0,t.jsx)("div",{className:"p-3 border-t bg-primary text-center",children:(0,t.jsx)("span",{className:"text-xs text-primary-foreground",children:"Showing top 50 results. Keep typing to refine..."})})]}):null:(0,t.jsx)(f.Sheet,{open:s,onOpenChange:a,modal:!1,children:(0,t.jsxs)(f.SheetContent,{className:"w-full sm:w-[400px] sm:max-w-[400px] p-0 z-[100] pointer-events-auto flex flex-col bg-primary",side:"right",onOpenAutoFocus:e=>e.preventDefault(),onCloseAutoFocus:e=>e.preventDefault(),children:[(0,t.jsxs)(f.SheetHeader,{className:"p-4 border-b border-primary-foreground/20 bg-primary flex-shrink-0",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(x.Search,{className:"h-4 w-4 text-primary-foreground"}),(0,t.jsx)(f.SheetTitle,{className:"text-base text-primary-foreground",children:"Product Suggestions"})]}),(0,t.jsx)(j.Button,{variant:"ghost",size:"icon",onClick:a,className:"h-8 w-8 text-primary-foreground hover:bg-primary-foreground/20",children:(0,t.jsx)(h.X,{className:"h-4 w-4"})})]}),(0,t.jsx)(f.SheetDescription,{className:"text-left text-primary-foreground/80",children:n?"Searching for products...":e.length>0?`Found ${e.length} product${e.length>1?"s":""} matching "${l}"`:`No products found matching "${l}"`})]}),n?(0,t.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center p-8 text-primary-foreground bg-primary",children:[(0,t.jsx)("div",{className:"h-8 w-8 border-2 border-primary-foreground border-t-transparent animate-spin rounded-full mb-4"}),(0,t.jsx)("p",{className:"text-sm",children:"Searching products..."})]}):e.length>0?(0,t.jsx)(y.ScrollArea,{className:"flex-1 h-0 bg-primary",children:(0,t.jsx)("div",{className:"p-2",children:e.map(e=>(0,t.jsx)("div",{className:"p-3 hover:bg-primary-foreground/20 cursor-pointer border-b border-primary-foreground/20 last:border-b-0 rounded-md mx-1 my-1 hover:shadow-sm transition-all bg-white",onClick:()=>b(e),children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)(g.default,{imageUrl:e.imageUrl,alt:e.name,size:"sm"}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsx)(u.Package,{className:"h-4 w-4 text-gray-400 flex-shrink-0"}),(0,t.jsx)("div",{className:"font-medium text-sm truncate",children:d(e.name,l)})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(m.Badge,{variant:"outline",className:"text-xs",children:e.category}),(0,t.jsxs)("span",{className:"text-xs text-gray-500",children:["Item #: ",d(e.itemNumber,l)]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-1",children:[(0,t.jsxs)("span",{children:["Qty: ",e.quantity%1==0?e.quantity:e.quantity.toFixed(2)]}),(0,t.jsxs)("span",{className:"font-medium",children:[o.currency," ",e.sellingPrice.toFixed(2)]})]}),e.description&&(0,t.jsx)("div",{className:"text-xs text-gray-500 truncate",children:d(e.description,l)}),e.supplier&&(0,t.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["Supplier: ",d(e.supplier,l)]})]})]})},e.id))})}):(0,t.jsxs)("div",{className:"p-8 text-center text-primary-foreground flex-1 flex flex-col items-center justify-center bg-primary",children:[(0,t.jsx)(x.Search,{className:"h-12 w-12 mx-auto mb-4 text-primary-foreground/50"}),(0,t.jsx)("p",{className:"text-sm",children:"No products found"}),(0,t.jsx)("p",{className:"text-xs mt-1",children:"Try adjusting your search term"})]}),e.length>=50&&(0,t.jsx)("div",{className:"p-3 border-t bg-primary text-center flex-shrink-0",children:(0,t.jsx)("span",{className:"text-xs text-primary-foreground",children:"Showing top 50 results. Keep typing to refine..."})})]})})};var v=e.i(899426);let N=(e,t)=>{let[a,r]=(0,s.useState)(!1),l=(0,s.useMemo)(()=>{if(!t||t.length<1)return[];let s=e.filter(e=>(0,v.matchProductSearch)(e,t)),a=t.toLowerCase();return s.sort((e,t)=>{let s=String(e.name||"").toLowerCase(),r=String(t.name||"").toLowerCase(),l=String(e.itemNumber||"").toLowerCase(),n=String(t.itemNumber||"").toLowerCase();return l===a?-1:n===a?1:s===a?-1:r===a?1:l.startsWith(a)&&!n.startsWith(a)?-1:n.startsWith(a)&&!l.startsWith(a)?1:s.startsWith(a)&&!r.startsWith(a)?-1:r.startsWith(a)&&!s.startsWith(a)?1:s.localeCompare(r)}).slice(0,100)},[e,t]);return(0,s.useEffect)(()=>{t.length>=1&&l.length>0?r(!0):0===t.length&&r(!1)},[t,l.length]),{suggestions:l,isOpen:a,openPanel:()=>{r(!0)},closePanel:()=>{r(!1)}}};var w=e.i(515288),C=e.i(793479),S=e.i(967489),T=e.i(440160),k=e.i(178583),I=e.i(747697),D=e.i(146786),P=e.i(631422),A=e.i(550516);let R=e=>{let t=e.price*e.quantity,s=0;if("amount"===e.discountType)s=Number(e.discountAmount)||0;else if("percentage"===e.discountType)s=t*(Number(e.discountPercentage)||0)/100;else if(!e.discountType){let a=Number(e.discountPercentage)||0,r=Number(e.discountAmount)||0;a>0?s=t*a/100:r>0&&(s=r)}return t-s},F=e=>R(e)/e.quantity;var M=e.i(266027),$=e.i(555781),E=e.i(784774),O=e.i(975157),z=e.i(975252),_=e.i(401851),q=e.i(255749),B=e.i(302747),H=e.i(337822),L=e.i(227766),Q=e.i(776639),U=e.i(688511),W=e.i(303281),V=e.i(11381),Y=e.i(777624),K=e.i(392401);let G=({isOpen:e,onOpenChange:a,itemDescription:r,sales:l,currency:n,dateFilter:i,dateRange:c,specificDate:d})=>{let u=(0,o.useNavigate)(),{hasPermission:x}=(0,Y.useProfiles)(),{canViewSellingPrice:h}=(0,K.useFinancialVisibility)(),[p,g]=(0,s.useState)(null),[f,y]=(0,s.useState)(!1),b=(()=>{let e,t;if("specific-date"===i&&d)(e=new Date(d)).setHours(0,0,0,0),(t=new Date(d)).setHours(23,59,59,999);else if("custom"===i&&c.from&&c.to)e=c.from,t=c.to;else{let s=(0,P.getDateRangeFromFilter)(i);e=s.from,t=s.to}return l.filter(s=>{let a=new Date(s.date),l=!1;l="specific-date"===i&&d?(0,A.isSameDay)(a,d):a>=e&&a<=t;let n=s.items.some(e=>e.description===r),o="Quote"!==s.paymentStatus;return l&&n&&o})})();return(0,t.jsxs)(Q.Dialog,{open:e,onOpenChange:a,children:[(0,t.jsxs)(Q.DialogContent,{className:"max-w-5xl max-h-[80vh] overflow-y-auto",children:[(0,t.jsxs)(Q.DialogHeader,{children:[(0,t.jsxs)(Q.DialogTitle,{children:['Sales for "',r,'"']}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:[b.length," sale",1!==b.length?"s":""," found in the selected period"]})]}),0===b.length?(0,t.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No sales found for this item in the selected period."}):(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)(E.Table,{children:[(0,t.jsx)(E.TableHeader,{children:(0,t.jsxs)(E.TableRow,{children:[(0,t.jsx)(E.TableHead,{children:"Date"}),(0,t.jsx)(E.TableHead,{children:"Receipt #"}),(0,t.jsx)(E.TableHead,{children:"Customer"}),(0,t.jsx)(E.TableHead,{className:"text-right",children:"Quantity"}),(0,t.jsx)(E.TableHead,{className:"text-right",children:"Unit Price"}),(0,t.jsx)(E.TableHead,{className:"text-right",children:"Total"}),(0,t.jsx)(E.TableHead,{children:"Status"}),(0,t.jsx)(E.TableHead,{className:"text-center",children:"Actions"})]})}),(0,t.jsx)(E.TableBody,{children:b.map(e=>{let s=e.items.find(e=>e.description===r);return s?(0,t.jsxs)(E.TableRow,{children:[(0,t.jsx)(E.TableCell,{children:(0,_.format)(e.date,"MMM d, yyyy")}),(0,t.jsxs)(E.TableCell,{className:"font-medium",children:["#",e.receiptNumber]}),(0,t.jsx)(E.TableCell,{children:e.customerName}),(0,t.jsx)(E.TableCell,{className:"text-right",children:s.quantity}),(0,t.jsx)(E.TableCell,{className:"text-right",children:h?(0,O.formatCashCurrency)(s.price,n):"•••"}),(0,t.jsx)(E.TableCell,{className:"text-right",children:h?(0,O.formatCashCurrency)(s.price*s.quantity,n):"•••"}),(0,t.jsx)(E.TableCell,{children:(0,t.jsx)(m.Badge,{variant:"Paid"===e.paymentStatus?"default":"NOT PAID"===e.paymentStatus?"destructive":"secondary",children:e.paymentStatus})}),(0,t.jsx)(E.TableCell,{className:"text-center",children:(0,t.jsxs)("div",{className:"flex justify-center gap-1",children:[(0,t.jsxs)(j.Button,{variant:"ghost",size:"sm",onClick:()=>{g(e),y(!0)},className:"h-8 w-8 p-0",title:"View Receipt",children:[(0,t.jsx)(W.Printer,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"View Receipt"})]}),x("sales","edit")&&(0,t.jsxs)(j.Button,{variant:"ghost",size:"sm",onClick:()=>{u("/new-sale",{state:{editSale:e}}),a(!1)},className:"h-8 w-8 p-0",title:"Edit Sale",children:[(0,t.jsx)(U.Edit,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Edit Sale"})]})]})})]},e.id):null})})]})})]}),(0,t.jsx)(V.default,{isOpen:f,sale:p,currency:n,onOpenChange:()=>{y(!1),g(null)}})]})};var J=e.i(257428),X=e.i(746798);let Z=()=>{let{user:e}=(0,a.useAuth)(),{currentBusiness:l}=(0,r.useBusiness)(),i=(()=>{let[e,t]=(0,s.useState)({pageSize:20,enableVirtualScrolling:!1,reducedAnimations:!1,compactView:!1});return(0,s.useEffect)(()=>{let e=()=>{let e=window.innerWidth<768;t({pageSize:e?15:20,enableVirtualScrolling:e,reducedAnimations:"connection"in navigator&&navigator.connection?.effectiveType==="slow-2g"||navigator.connection?.effectiveType==="2g",compactView:e})};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),e})(),{sales:o}=(0,D.useSalesData)(e?.id,"desc"),{settings:c,isLoading:d}=(0,p.useBusinessSettings)(),{canViewCostPrice:m,canViewProfit:u,canViewSellingPrice:h}=(0,K.useFinancialVisibility)(),{toast:g}=(0,n.useToast)(),f=(0,s.useMemo)(()=>l?.id?`soldItemsFilters_${l.id}`:"soldItemsFilters",[l?.id]),y=(0,s.useCallback)(()=>{try{let e=localStorage.getItem(f);if(e){let t=JSON.parse(e);return{dateFilter:t.dateFilter||"this-month",dateRange:t.dateRange?{from:t.dateRange.from?new Date(t.dateRange.from):void 0,to:t.dateRange.to?new Date(t.dateRange.to):void 0}:{from:void 0,to:void 0},specificDate:t.specificDate?new Date(t.specificDate):void 0,showOnlyNotInInventory:t.showOnlyNotInInventory||!1,showOnlyCostData:t.showOnlyCostData||!1}}}catch(e){console.error("Error loading persisted sold items filters:",e)}return{dateFilter:"this-month",dateRange:{from:void 0,to:void 0},specificDate:void 0,showOnlyNotInInventory:!1,showOnlyCostData:!1}},[f]),b=(0,s.useMemo)(()=>y(),[y]),[v,N]=(0,s.useState)(b.dateFilter),[Q,U]=(0,s.useState)(b.dateRange),[W,V]=(0,s.useState)(b.specificDate),[Y,Z]=(0,s.useState)(null),[ee,et]=(0,s.useState)(!1),[es,ea]=(0,s.useState)(""),[er,el]=(0,s.useState)(b.showOnlyNotInInventory),[en,ei]=(0,s.useState)(b.showOnlyCostData),{soldItems:eo,isLoading:ec}=((e,t,l,n)=>{let{user:i}=(0,a.useAuth)(),{currentBusiness:o}=(0,r.useBusiness)(),{sales:c,isLoading:d,clearSoldItemsCache:m}=(0,D.useSalesData)(i?.id,"desc"),{data:u,isLoading:x}=(0,M.useQuery)({queryKey:["inventory_check_map",o?.id],queryFn:async()=>{if(!o?.id||!i?.id)return new Map;let e=await (0,$.getProductsAction)({userId:i.id,businessId:o.id,pageSize:1e3}),t=new Map;return e&&e.products&&e.products.forEach(e=>{e.id&&t.set(e.id,!0),e.name&&t.set(e.name.trim().toLowerCase(),!0)}),t},enabled:!!o?.id&&!!i?.id,staleTime:3e5,gcTime:18e5});return{soldItems:(0,s.useMemo)(()=>{let s,a;if(!c||0===c.length)return[];if("specific-date"===e&&l)(s=new Date(l)).setHours(0,0,0,0),(a=new Date(l)).setHours(23,59,59,999);else if("custom"===e&&t.from&&t.to)s=t.from,a=t.to;else{let t=(0,P.getDateRangeFromFilter)(e);s=t.from,a=t.to}let r=c.filter(t=>{let r=new Date(t.date);return"specific-date"===e&&l?(0,A.isSameDay)(r,l)&&"Quote"!==t.paymentStatus:r>=s&&r<=a&&"Quote"!==t.paymentStatus}),i=new Map;r.forEach(e=>{e.items.forEach(e=>{let t=e.description,s=e.price*e.quantity,a=R(e),r=s-a,l=(e.cost||0)*e.quantity,n=a-l,o=F(e);if(i.has(t)){let s=i.get(t);s.totalQuantity+=e.quantity,s.totalAmount+=a,s.totalCost+=l,s.totalProfit+=n,s.totalDiscount+=r,s.prices.push(o),s.costs.push(e.cost||0),e.productId&&!s.productIds.includes(e.productId)&&s.productIds.push(e.productId)}else i.set(t,{totalQuantity:e.quantity,totalAmount:a,totalCost:l,totalProfit:n,totalDiscount:r,prices:[o],costs:[e.cost||0],productIds:e.productId?[e.productId]:[]})})});let o=Array.from(i.entries()).map(([e,t])=>({description:e,totalQuantity:t.totalQuantity,averagePrice:t.prices.reduce((e,t)=>e+t,0)/t.prices.length,totalAmount:t.totalAmount,totalCost:t.totalCost,totalProfit:t.totalProfit,totalDiscount:t.totalDiscount,averageCost:t.costs.reduce((e,t)=>e+t,0)/t.costs.length,productIds:t.productIds})).sort((e,t)=>t.totalAmount-e.totalAmount);return n&&u?o.filter(e=>{if(e.productIds.some(e=>u.has(e)))return!1;let t=e.description.trim().toLowerCase();return!u.has(t)}):o},[c,e,t,l,u,n]),isLoading:d||x,loadSoldItemsData:()=>{m()}}})(v,Q,W,er);(0,s.useEffect)(()=>{let e={dateFilter:v,dateRange:{from:Q.from?.toISOString(),to:Q.to?.toISOString()},specificDate:W?.toISOString(),showOnlyNotInInventory:er,showOnlyCostData:en};localStorage.setItem(f,JSON.stringify(e))},[v,Q,W,er,en,f]);let ed=(0,s.useMemo)(()=>{if(!es.trim())return eo;let e=es.toLowerCase();return eo.filter(t=>t.description.toLowerCase().includes(e))},[eo,es]);return ec?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)(B.Skeleton,{className:"h-8 w-32"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(B.Skeleton,{className:"h-8 w-20"}),(0,t.jsx)(B.Skeleton,{className:"h-8 w-20"})]})]}),(0,t.jsx)(B.Skeleton,{className:"h-48"})]}):(0,t.jsx)(X.TooltipProvider,{children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,t.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 items-start md:items-center",children:[(0,t.jsxs)(S.Select,{value:v,onValueChange:N,children:[(0,t.jsx)(S.SelectTrigger,{className:"w-full md:w-48",children:(0,t.jsx)(S.SelectValue,{placeholder:"Select period"})}),(0,t.jsxs)(S.SelectContent,{children:[(0,t.jsx)(S.SelectItem,{value:"today",children:"Today"}),(0,t.jsx)(S.SelectItem,{value:"yesterday",children:"Yesterday"}),(0,t.jsx)(S.SelectItem,{value:"this-week",children:"This Week"}),(0,t.jsx)(S.SelectItem,{value:"last-week",children:"Last Week"}),(0,t.jsx)(S.SelectItem,{value:"this-month",children:"This Month"}),(0,t.jsx)(S.SelectItem,{value:"last-month",children:"Last Month"}),(0,t.jsx)(S.SelectItem,{value:"this-year",children:"This Year"}),(0,t.jsx)(S.SelectItem,{value:"specific-date",children:"Specific Date"}),(0,t.jsx)(S.SelectItem,{value:"custom",children:"Custom Range"})]})]}),"specific-date"===v&&(0,t.jsx)("div",{className:"w-full md:w-auto",children:(0,t.jsxs)(H.Popover,{children:[(0,t.jsx)(H.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)(j.Button,{variant:"outline",className:(0,O.cn)("w-full md:w-[240px] justify-start text-left font-normal bg-white",!W&&"text-muted-foreground"),children:[(0,t.jsx)(I.CalendarIcon,{className:"mr-2 h-4 w-4"}),W?(0,_.format)(W,"PPP"):(0,t.jsx)("span",{children:"Pick a specific date"})]})}),(0,t.jsx)(H.PopoverContent,{className:"w-auto p-0 z-[100] bg-white shadow-lg",align:"start",children:(0,t.jsx)(L.Calendar,{mode:"single",selected:W,onSelect:V,initialFocus:!0,className:"p-3 pointer-events-auto"})})]})}),"custom"===v&&(0,t.jsx)(z.default,{dateRange:Q,onDateRangeChange:U})]}),(0,t.jsxs)("div",{className:"flex flex-col md:flex-row gap-2",children:[(0,t.jsxs)(j.Button,{variant:"outline",onClick:()=>{"specific-date"===v&&W||"custom"===v&&Q.from&&Q.to||(0,P.getDateRangeFromFilter)(v),((e,t,s="USD",a=!1)=>{let r=new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}),l=e.map(e=>a?[e.description,e.totalQuantity.toString(),r.format(e.averageCost||0),r.format(e.totalCost)]:[e.description,e.totalQuantity.toString(),r.format(e.averagePrice),r.format(e.totalAmount),r.format(e.totalDiscount),r.format(e.totalCost),r.format(e.totalProfit)]),n=e.reduce((e,t)=>e+t.totalQuantity,0),i=e.reduce((e,t)=>e+t.totalAmount,0),o=e.reduce((e,t)=>e+t.totalDiscount,0),c=e.reduce((e,t)=>e+t.totalCost,0),d=e.reduce((e,t)=>e+t.totalProfit,0);l.push([""]),l.push(["SUMMARY","","","","","",""]),l.push(["Total Items",e.length.toString(),"","","","",""]),l.push(["Total Quantity",n.toString(),"","","","",""]),a?l.push(["Total Cost","","",r.format(c)]):(l.push(["Total Revenue","","",r.format(i),"","",""]),l.push(["Total Discount","","","",r.format(o),"",""]),l.push(["Total Cost","","","","",r.format(c),""]),l.push(["Total Profit","","","","","",r.format(d)]));let m=new Blob([[a?["Item","Quantity","Average Cost","Total Cost"]:["Item","Quantity","Average Price","Total Amount","Discount","Cost Amount","Profit"],...l].map(e=>e.map(e=>`"${e}"`).join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),u=document.createElement("a"),x=URL.createObjectURL(m);u.setAttribute("href",x),u.setAttribute("download",`${a?"cost_data_":""}sold_items_${t.replace(/\s+/g,"_")}_${new Date().toISOString().split("T")[0]}.csv`),u.style.visibility="hidden",document.body.appendChild(u),u.click(),document.body.removeChild(u)})(ed,"Current Period",c.currency,en),g({title:"Export successful",description:"Sold items exported to CSV file."})},className:"gap-2 w-full md:w-auto",children:[(0,t.jsx)(k.FileText,{className:"h-4 w-4"}),"Export CSV"]}),(0,t.jsxs)(j.Button,{variant:"outline",onClick:()=>{let e;d?g({title:"Please wait",description:"Business settings are still loading. Please try again in a moment.",variant:"destructive"}):(e="specific-date"===v&&W?{from:W,to:W}:"custom"===v&&Q.from&&Q.to?Q:(0,P.getDateRangeFromFilter)(v),((e,t,s="USD",a=!1,r,l)=>{let n,i=new q.default({orientation:"portrait",unit:"mm",format:"a4",compress:!0}),o=i.internal.pageSize.getWidth(),c=i.internal.pageSize.getHeight(),d=o-15-15,m=15,u=a?[60,30,40,40]:[38,18,22,22,20,20,20],x=a?["Item","Quantity","Avg Cost","Total Cost"]:["Item","Quantity","Avg Price","Total","Discount","Cost","Profit"],h=()=>{i.setFontSize(8),i.setFont("helvetica","normal"),i.setTextColor(150,150,150),i.text("Created By Gonza Systems",o/2,c-10,{align:"center"}),i.setTextColor(0,0,0)},p=()=>{i.setFillColor(243,244,246),i.rect(15,m-2,d,10,"F"),i.setLineWidth(.3),i.rect(15,m-2,d,10),i.setFontSize(10),i.setFont("helvetica","bold");let e=15;x.forEach((t,s)=>{let a=u[s],r=i.getTextWidth(t),l=e+(a-r)/2;i.text(t,l,m+6),s<x.length-1&&i.line(e+a,m-2,e+a,m+10-2),e+=a}),m+=10},g=e=>m+e>c-15-15&&(h(),i.addPage(),m=15,p(),i.setFont("helvetica","normal"),i.setFontSize(9),!0),f=m;l&&(i.setFontSize(12),i.setFont("helvetica","bold"),i.text(l.businessName,15,m),m+=6,i.setFontSize(9),i.setFont("helvetica","normal"),i.text(l.businessAddress,15,m),m+=5,i.text(l.businessPhone,15,m),m+=5,i.text(l.businessEmail,15,m)),m=f,i.setFontSize(18),i.setFont("helvetica","bold");let j=a?`Items Cost Report (${s})`:`Items Sold Report (${s})`,y=i.getTextWidth(j);if(i.text(j,o-15-y,m),m+=10,r?.from&&r?.to){i.setFontSize(12),i.setFont("helvetica","normal");let e=(0,_.format)(r.from,"dd/MM/yyyy"),t=(0,_.format)(r.to,"dd/MM/yyyy"),s=e===t?e:`${e} - ${t}`,a=i.getTextWidth(s);i.text(s,o-15-a,m),m+=12}else{i.setFontSize(12),i.setFont("helvetica","normal");let e=(0,_.format)(new Date,"dd/MM/yyyy"),t=i.getTextWidth(e);i.text(e,o-15-t,m),m+=12}if(m=Math.max(m,f+25),0===e.length){i.setFontSize(14),i.setFont("helvetica","normal");let e="No items sold in the selected period.",t=i.getTextWidth(e);i.text(e,(o-t)/2,m+30)}else{g(20),p(),i.setFont("helvetica","normal"),i.setFontSize(8);let t=new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0});e.forEach((e,s)=>{g(13);let r=a?[e.description,e.totalQuantity.toString(),t.format(e.totalCost/e.totalQuantity),t.format(e.totalCost)]:[e.description,e.totalQuantity.toString(),t.format(e.averagePrice),t.format(e.totalAmount),t.format(e.totalDiscount||0),t.format(e.totalCost||0),t.format(e.totalProfit||0)];s%2==0&&(i.setFillColor(249,250,251),i.rect(15,m-1,d,8,"F")),i.setLineWidth(.1),i.rect(15,m-1,d,8);let l=15;r.forEach((e,t)=>{let s=u[t],a=e;if(0===t)for(;i.getTextWidth(a)>s-4&&a.length>3;)a=a.substring(0,a.length-4)+"...";let n=l+2;if(t>=1){let e=i.getTextWidth(a);n=l+(s-e)/2}i.text(a,n,m+5),t<r.length-1&&i.line(l+s,m-1,l+s,m+8-1),l+=s}),m+=8}),m+=10,g(45),i.setFontSize(16),i.setFont("helvetica","bold"),i.text("Summary",15,m),m+=8;let s=e.length,r=e.reduce((e,t)=>e+t.totalQuantity,0),l=e.reduce((e,t)=>e+t.totalAmount,0),n=e.reduce((e,t)=>e+(t.totalDiscount||0),0),o=e.reduce((e,t)=>e+(t.totalCost||0),0),c=e.reduce((e,t)=>e+(t.totalProfit||0),0),x=a?32:56;i.setFillColor(248,249,250),i.rect(15,m-3,d,x,"F"),i.setLineWidth(.3),i.setDrawColor(200,200,200),i.rect(15,m-3,d,x),i.setFontSize(11),i.setFont("helvetica","normal");let h=a?[["Total Items:",s.toString()],["Total Quantity:",r.toString()],["Total Cost:",t.format(o)]]:[["Total Items:",s.toString()],["Total Quantity:",r.toString()],["Total Revenue:",t.format(l)],["Total Discount:",t.format(n)],["Total Cost:",t.format(o)],["Total Profit:",t.format(c)]],f=m+6,j=30;h.forEach(([e,t])=>{i.setFont("helvetica","bold"),i.text(e,j,f),i.setFont("helvetica","normal");let s=j+i.getTextWidth(e)+5,a=15+d-15,r=i.getTextWidth(t);i.text(t,s+r>a?a-r:s,f),f+=8})}h();let b=a?"cost_data_":"";if(r?.from&&r?.to){let e=(0,_.format)(r.from,"yyyy-MM-dd"),t=(0,_.format)(r.to,"yyyy-MM-dd");n=e===t?`${b}sold_items_${e}.pdf`:`${b}sold_items_${e}_to_${t}.pdf`}else n=`${b}sold_items_${(0,_.format)(new Date,"yyyy-MM-dd")}.pdf`;i.save(n)})(ed,0,c.currency,en,e,{businessName:c.businessName,businessAddress:c.businessAddress,businessPhone:c.businessPhone,businessEmail:c.businessEmail}),g({title:"Export successful",description:"Sold items exported to PDF file."}))},className:"gap-2 w-full md:w-auto",children:[(0,t.jsx)(T.Download,{className:"h-4 w-4"}),"Export PDF"]})]})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(x.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(C.Input,{placeholder:"Search items...",value:es,onChange:e=>ea(e.target.value),className:"pl-10"})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(J.Checkbox,{id:"not-in-inventory",checked:er,onCheckedChange:e=>{el(!0===e)}}),(0,t.jsx)("label",{htmlFor:"not-in-inventory",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Show only items not in inventory"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(J.Checkbox,{id:"cost-data-only",checked:en,onCheckedChange:e=>{ei(!0===e)},disabled:!m}),(0,t.jsx)("label",{htmlFor:"cost-data-only",className:(0,O.cn)("text-sm font-medium leading-none",!m&&"opacity-50 cursor-not-allowed"),children:"Show only cost data (Item, Quantity, Average Cost, Total Cost)"})]})]})]}),(0,t.jsxs)(w.Card,{children:[(0,t.jsxs)(w.CardHeader,{children:[(0,t.jsxs)(w.CardTitle,{className:"text-lg",children:["Items Sold - ",(()=>{if("specific-date"===v&&W)return(0,_.format)(W,"dd/MM/yyyy");{if("custom"===v&&Q.from&&Q.to)return`${(0,_.format)(Q.from,"dd/MM/yyyy")} to ${(0,_.format)(Q.to,"dd/MM/yyyy")}`;let e=(0,P.getDateRangeFromFilter)(v);return e.from.toDateString()===e.to.toDateString()?(0,_.format)(e.from,"dd/MM/yyyy"):`${(0,_.format)(e.from,"dd/MM/yyyy")} to ${(0,_.format)(e.to,"dd/MM/yyyy")}`}})()]}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Click on an item to view all sales containing that item",es&&` • Showing ${ed.length} of ${eo.length} items`,er&&` • Filtered to show only items not in current inventory`,en&&` • Showing only cost data`]})]}),(0,t.jsx)(w.CardContent,{className:"p-0",children:0===ed.length?(0,t.jsx)("div",{className:"p-8 text-center text-muted-foreground",children:es?"No items found matching your search.":er?"No sold items found that are not in current inventory.":"No items sold in the selected period."}):(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)(E.Table,{children:[(0,t.jsx)(E.TableHeader,{children:(0,t.jsxs)(E.TableRow,{children:[(0,t.jsx)(E.TableHead,{children:"Item"}),(0,t.jsx)(E.TableHead,{className:"text-right",children:"Qty"}),en?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(E.TableHead,{className:"text-right",children:"Avg Cost"}),(0,t.jsx)(E.TableHead,{className:"text-right",children:"Total Cost"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(E.TableHead,{className:"text-right",children:"Avg Price"}),(0,t.jsx)(E.TableHead,{className:"text-right font-bold",children:"Total"}),(0,t.jsx)(E.TableHead,{className:"text-right hidden sm:table-cell",children:"Discount"}),m&&(0,t.jsx)(E.TableHead,{className:"text-right",children:"Cost"}),u&&(0,t.jsx)(E.TableHead,{className:"text-right",children:"Profit"})]})]})}),(0,t.jsx)(E.TableBody,{children:ed.slice(0,2*i.pageSize).map((e,s)=>(0,t.jsxs)(E.TableRow,{className:"cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>{Z(e.description),et(!0)},children:[(0,t.jsx)(E.TableCell,{className:"font-medium max-w-[200px] truncate",children:(0,t.jsxs)(X.Tooltip,{children:[(0,t.jsx)(X.TooltipTrigger,{asChild:!0,children:(0,t.jsx)("span",{className:"cursor-help",children:e.description})}),(0,t.jsx)(X.TooltipContent,{side:"top",className:"max-w-xs",children:(0,t.jsx)("div",{className:"space-y-1",children:(0,t.jsx)("p",{className:"font-bold break-words whitespace-normal",children:e.description})})})]})}),(0,t.jsx)(E.TableCell,{className:"text-right",children:e.totalQuantity}),en?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(E.TableCell,{className:"text-right",children:m?(0,O.formatCashCurrency)(e.averageCost||0,c.currency):"•••"}),(0,t.jsx)(E.TableCell,{className:"text-right",children:m?(0,O.formatCashCurrency)(e.totalCost,c.currency):"•••"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(E.TableCell,{className:"text-right",children:h?(0,O.formatCashCurrency)(e.averagePrice,c.currency):"•••"}),(0,t.jsx)(E.TableCell,{className:"text-right font-medium",children:h?(0,O.formatCashCurrency)(e.totalAmount,c.currency):"•••"}),(0,t.jsx)(E.TableCell,{className:"text-right hidden sm:table-cell",children:h?(0,O.formatCashCurrency)(e.totalDiscount,c.currency):"•••"}),m&&(0,t.jsx)(E.TableCell,{className:"text-right text-sales-dark",children:(0,O.formatCashCurrency)(e.totalCost,c.currency)}),u&&(0,t.jsx)(E.TableCell,{className:"text-right font-semibold text-green-600",children:(0,O.formatCashCurrency)(e.totalProfit,c.currency)})]})]},s))})]})})})]}),ed.length>0&&(0,t.jsx)(w.Card,{children:(0,t.jsx)(w.CardContent,{className:"pt-6",children:en?(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 text-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Items"}),(0,t.jsx)("p",{className:"text-lg md:text-2xl font-bold",children:ed.length})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Quantity"}),(0,t.jsx)("p",{className:"text-lg md:text-2xl font-bold",children:ed.reduce((e,t)=>e+t.totalQuantity,0)})]}),(0,t.jsxs)("div",{className:"flex flex-col items-center",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Total Cost"}),(0,t.jsx)("p",{className:"text-lg md:text-2xl font-bold",children:m?(0,O.formatCashCurrency)(ed.reduce((e,t)=>e+t.totalCost,0),c.currency):"•••"})]})]}):(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Items"}),(0,t.jsx)("p",{className:"text-base sm:text-lg md:text-xl font-bold truncate",children:ed.length})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Quantity"}),(0,t.jsx)("p",{className:"text-base sm:text-lg md:text-xl font-bold truncate",children:ed.reduce((e,t)=>e+t.totalQuantity,0)})]}),(0,t.jsxs)("div",{className:"flex flex-col items-center",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Revenue"}),(0,t.jsx)("p",{className:"text-base sm:text-lg md:text-xl font-bold truncate",children:h?(0,O.formatCashCurrency)(ed.reduce((e,t)=>e+t.totalAmount,0),c.currency):"•••"})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Discount"}),(0,t.jsx)("p",{className:"text-base sm:text-lg md:text-xl font-bold truncate",children:h?(0,O.formatCashCurrency)(ed.reduce((e,t)=>e+t.totalDiscount,0),c.currency):"•••"})]}),m&&(0,t.jsxs)("div",{className:"flex flex-col items-center",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Cost"}),(0,t.jsx)("p",{className:"text-base sm:text-lg md:text-xl font-bold truncate",children:(0,O.formatCashCurrency)(ed.reduce((e,t)=>e+t.totalCost,0),c.currency)})]}),u&&(0,t.jsxs)("div",{className:"flex flex-col items-center",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Profit"}),(0,t.jsx)("p",{className:"text-base sm:text-lg md:text-xl font-bold truncate",children:(0,O.formatCashCurrency)(ed.reduce((e,t)=>e+t.totalProfit,0),c.currency)})]})]})]})})}),(0,t.jsx)(G,{isOpen:ee,onOpenChange:et,itemDescription:Y||"",sales:o,currency:c.currency,dateFilter:v,dateRange:Q,specificDate:W})]})})};var ee=e.i(16715),et=e.i(585890),es=e.i(145963),ea=e.i(614522),er=e.i(707935),el=e.i(608199),en=e.i(39978);let ei=({period:e,setPeriod:s,dateRange:a,setDateRange:r,specificDay:l,setSpecificDay:n,onExportCSV:i,onExportPDF:o})=>(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Stock Summary"}),(0,t.jsxs)("div",{className:"flex flex-col md:flex-row gap-2",children:[(0,t.jsxs)(j.Button,{onClick:i,variant:"outline",size:"sm",children:[(0,t.jsx)(T.Download,{className:"h-4 w-4 mr-2"}),"CSV"]}),(0,t.jsxs)(j.Button,{onClick:o,variant:"outline",size:"sm",children:[(0,t.jsx)(k.FileText,{className:"h-4 w-4 mr-2"}),"PDF"]})]})]}),(0,t.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,t.jsx)("div",{className:"w-full md:w-[200px]",children:(0,t.jsxs)(S.Select,{value:e,onValueChange:e=>s(e),children:[(0,t.jsx)(S.SelectTrigger,{className:"bg-white",children:(0,t.jsx)(S.SelectValue,{placeholder:"Select period"})}),(0,t.jsxs)(S.SelectContent,{className:"bg-white",children:[(0,t.jsx)(S.SelectItem,{value:"today",children:"Today"}),(0,t.jsx)(S.SelectItem,{value:"yesterday",children:"Yesterday"}),(0,t.jsx)(S.SelectItem,{value:"this-week",children:"This Week"}),(0,t.jsx)(S.SelectItem,{value:"last-week",children:"Last Week"}),(0,t.jsx)(S.SelectItem,{value:"this-month",children:"This Month"}),(0,t.jsx)(S.SelectItem,{value:"last-month",children:"Last Month"}),(0,t.jsx)(S.SelectItem,{value:"this-year",children:"This Year"}),(0,t.jsx)(S.SelectItem,{value:"all-time",children:"All Time"}),(0,t.jsx)(S.SelectItem,{value:"specific-day",children:"Specific Day"}),(0,t.jsx)(S.SelectItem,{value:"custom",children:"Custom Range"})]})]})}),"specific-day"===e&&(0,t.jsx)("div",{className:"w-full md:w-auto",children:(0,t.jsxs)(H.Popover,{children:[(0,t.jsx)(H.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)(j.Button,{variant:"outline",className:(0,O.cn)("w-full md:w-[240px] justify-start text-left font-normal bg-white",!l&&"text-muted-foreground"),children:[(0,t.jsx)(I.CalendarIcon,{className:"mr-2 h-4 w-4"}),l?(0,_.format)(l,"PPP"):(0,t.jsx)("span",{children:"Pick a specific day"})]})}),(0,t.jsx)(H.PopoverContent,{className:"w-auto p-0 z-[100] bg-white shadow-lg",align:"start",children:(0,t.jsx)(L.Calendar,{mode:"single",selected:l,onSelect:n,initialFocus:!0,className:"p-3 pointer-events-auto"})})]})}),"custom"===e&&(0,t.jsx)(z.default,{dateRange:a,onDateRangeChange:r})]}),(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Showing data for: ",(0,t.jsx)("span",{className:"font-medium",children:(()=>{switch(e){case"today":return"Today";case"yesterday":return"Yesterday";case"this-week":return"This Week";case"last-week":return"Last Week";case"this-month":default:return"This Month";case"last-month":return"Last Month";case"this-year":return"This Year";case"all-time":return"All Time";case"specific-day":return"Specific Day";case"custom":return"Custom Range"}})()}),"specific-day"===e&&l&&(0,t.jsxs)("span",{className:"ml-2",children:["(",(0,_.format)(l,"MMM d, yyyy"),")"]}),"custom"===e&&a?.from&&a?.to&&(0,t.jsxs)("span",{className:"ml-2",children:["(",(0,_.format)(a.from,"MMM d, yyyy")," - ",(0,_.format)(a.to,"MMM d, yyyy"),")"]})]})]});var eo=e.i(475254);let ec=(0,eo.default)("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);var ed=e.i(975558),em=e.i(425063),eu=e.i(261246),ex=e.i(658512);let eh=({data:e,isLoading:a,onProductClick:l,onFilteredDataChange:n,currentProducts:i=[]})=>{let{currentBusiness:o}=(0,r.useBusiness)(),{canViewCostPrice:c}=(0,K.useFinancialVisibility)(),d=()=>`stockSummaryTableFilters_${o?.id||"default"}`,u=(()=>{try{let e=localStorage.getItem(d());if(e)return JSON.parse(e)}catch(e){console.warn("Error loading persisted table filters:",e)}return{searchTerm:"",categoryFilter:"all",stockStatusFilter:"all",sortField:"productName",sortOrder:"asc"}})(),[h,p]=(0,s.useState)(u.searchTerm),[f,y]=(0,s.useState)(u.categoryFilter),[b,v]=(0,s.useState)(u.stockStatusFilter),[N,w]=(0,s.useState)(u.sortField),[T,k]=(0,s.useState)(u.sortOrder),[I,D]=(0,s.useState)(1);(0,s.useEffect)(()=>{localStorage.setItem(d(),JSON.stringify({searchTerm:h,categoryFilter:f,stockStatusFilter:b,sortField:N,sortOrder:T}))},[h,f,b,N,T,o?.id]);let P=(0,s.useMemo)(()=>Array.from(new Set(e.map(e=>e.category).filter(Boolean))).sort(),[e]),A=(0,s.useMemo)(()=>{let t=e.filter(e=>{if(h){let t=h.toLowerCase();if(!(e.productName.toLowerCase().includes(t)||e.itemNumber.toLowerCase().includes(t)||e.category&&e.category.toLowerCase().includes(t)))return!1}return("all"===f||e.category===f)&&("all"===b||("in-stock"!==b||!(e.closingStock<=0))&&("out-of-stock"!==b||!(e.closingStock>0))&&("low-stock"!==b||!(e.closingStock>10)&&!(e.closingStock<=0)))&&!0});return t.sort((e,t)=>{let s=0;switch(N){case"productName":s=e.productName.localeCompare(t.productName);break;case"category":s=(e.category||"").localeCompare(t.category||"");break;case"openingStock":s=e.openingStock-t.openingStock;break;case"itemsSold":s=e.itemsSold-t.itemsSold;break;case"stockIn":s=e.stockIn-t.stockIn;break;case"transferOut":s=e.transferOut-t.transferOut;break;case"returnIn":s=e.returnIn-t.returnIn;break;case"returnOut":s=e.returnOut-t.returnOut;break;case"closingStock":s=e.closingStock-t.closingStock}return"asc"===T?s:-s}),t},[e,h,f,b,N,T]),R=Math.ceil(A.length/15),F=(I-1)*15,M=A.slice(F,F+15);(0,s.useEffect)(()=>{D(1)},[h,f,b]),(0,s.useEffect)(()=>{n&&n(A)},[A,n]);let $=e=>{N===e?k("asc"===T?"desc":"asc"):(w(e),k("asc"))},O=e=>N!==e?(0,t.jsx)(ec,{className:"h-4 w-4"}):"asc"===T?(0,t.jsx)(ed.ArrowUp,{className:"h-4 w-4"}):(0,t.jsx)(em.ArrowDown,{className:"h-4 w-4"}),z=s.default.useMemo(()=>A.reduce((e,t)=>({openingStock:e.openingStock+t.openingStock,itemsSold:e.itemsSold+t.itemsSold,stockIn:e.stockIn+t.stockIn,transferOut:e.transferOut+t.transferOut,returnIn:e.returnIn+t.returnIn,returnOut:e.returnOut+t.returnOut,returnOut:e.returnOut+t.returnOut,adjustmentsIn:e.adjustmentsIn+(t.adjustmentsIn||0),adjustmentsOut:e.adjustmentsOut+(t.adjustmentsOut||0),closingStock:e.closingStock+t.closingStock}),{openingStock:0,itemsSold:0,stockIn:0,transferOut:0,returnIn:0,returnOut:0,adjustmentsIn:0,adjustmentsOut:0,closingStock:0}),[A]),_=e=>{D(e)};return a?(0,t.jsx)("div",{className:"flex justify-center py-8",children:(0,t.jsx)(eu.default,{})}):(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center relative flex-grow",children:[(0,t.jsx)(x.Search,{className:"h-4 w-4 absolute left-3 text-gray-400"}),(0,t.jsx)(C.Input,{placeholder:"Search products...",className:"pl-9",value:h,onChange:e=>p(e.target.value)})]}),(0,t.jsx)("div",{className:"min-w-[180px]",children:(0,t.jsxs)(S.Select,{value:f,onValueChange:y,children:[(0,t.jsx)(S.SelectTrigger,{children:(0,t.jsx)(S.SelectValue,{placeholder:"All Categories"})}),(0,t.jsxs)(S.SelectContent,{children:[(0,t.jsx)(S.SelectItem,{value:"all",children:"All Categories"}),P.map(e=>(0,t.jsx)(S.SelectItem,{value:e,children:e},e))]})]})}),(0,t.jsx)("div",{className:"min-w-[150px]",children:(0,t.jsxs)(S.Select,{value:b,onValueChange:v,children:[(0,t.jsx)(S.SelectTrigger,{children:(0,t.jsx)(S.SelectValue,{placeholder:"Stock Status"})}),(0,t.jsxs)(S.SelectContent,{children:[(0,t.jsx)(S.SelectItem,{value:"all",children:"All Stock"}),(0,t.jsx)(S.SelectItem,{value:"in-stock",children:"In Stock"}),(0,t.jsx)(S.SelectItem,{value:"low-stock",children:"Low Stock (≤10)"}),(0,t.jsx)(S.SelectItem,{value:"out-of-stock",children:"Out of Stock"})]})]})}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)(m.Badge,{variant:"secondary",className:"text-xs",children:[A.length," ",1===A.length?"product":"products"," found"]}),R>1&&(0,t.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Page ",I," of ",R]})]})]}),(0,t.jsxs)(X.TooltipProvider,{children:[(0,t.jsxs)("div",{className:"overflow-x-auto",children:[(0,t.jsxs)(E.Table,{children:[(0,t.jsx)(E.TableHeader,{children:(0,t.jsxs)(E.TableRow,{children:[(0,t.jsx)(E.TableHead,{className:"w-[80px]",children:"Image"}),(0,t.jsx)(E.TableHead,{children:"Item #"}),(0,t.jsx)(E.TableHead,{children:(0,t.jsxs)(j.Button,{variant:"ghost",onClick:()=>$("productName"),className:"h-auto p-0 font-medium text-left justify-start hover:bg-transparent",children:["Product Name ",O("productName")]})}),(0,t.jsx)(E.TableHead,{children:(0,t.jsxs)(j.Button,{variant:"ghost",onClick:()=>$("category"),className:"h-auto p-0 font-medium text-left justify-start hover:bg-transparent",children:["Category ",O("category")]})}),(0,t.jsx)(E.TableHead,{className:"text-right",children:(0,t.jsxs)(j.Button,{variant:"ghost",onClick:()=>$("openingStock"),className:"h-auto p-0 font-medium text-right justify-end hover:bg-transparent",children:["Opening Stock ",O("openingStock")]})}),(0,t.jsx)(E.TableHead,{className:"text-right",children:(0,t.jsxs)(j.Button,{variant:"ghost",onClick:()=>$("stockIn"),className:"h-auto p-0 font-medium text-right justify-end hover:bg-transparent",children:["Stock In ",O("stockIn")]})}),(0,t.jsx)(E.TableHead,{className:"text-right",children:(0,t.jsx)(j.Button,{variant:"ghost",onClick:()=>$("transferOut"),className:"h-auto p-0 font-medium text-right justify-end hover:bg-transparent",children:"Stock Out"})}),(0,t.jsx)(E.TableHead,{className:"text-right",children:(0,t.jsxs)(j.Button,{variant:"ghost",onClick:()=>$("closingStock"),className:"h-auto p-0 font-medium text-right justify-end hover:bg-transparent",children:["Closing Stock ",O("closingStock")]})})]})}),(0,t.jsxs)(E.TableBody,{children:[M.map(e=>{let s;return(0,t.jsxs)(E.TableRow,{className:`cursor-pointer hover:bg-muted/50 transition-colors ${(s=i.find(t=>t.id===e.productId))&&s.quantity!==e.closingStock?"bg-red-50 hover:bg-red-100 border-l-4 border-l-red-500":""}`,onClick:()=>l(e.productId),children:[(0,t.jsx)(E.TableCell,{children:(0,t.jsx)(g.default,{imageUrl:e.imageUrl,alt:e.productName,size:"sm"})}),(0,t.jsxs)(E.TableCell,{className:"font-medium truncate max-w-[120px]",children:["#",e.itemNumber]}),(0,t.jsx)(E.TableCell,{className:"truncate max-w-[200px]",children:(0,t.jsxs)(X.Tooltip,{children:[(0,t.jsx)(X.TooltipTrigger,{asChild:!0,children:(0,t.jsx)("span",{className:"cursor-help",children:e.productName})}),(0,t.jsx)(X.TooltipContent,{side:"top",className:"max-w-xs",children:(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("p",{className:"font-bold break-words whitespace-normal",children:e.productName}),e.category&&(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Category: ",e.category]})]})})]})}),(0,t.jsx)(E.TableCell,{children:e.category||"-"}),(0,t.jsx)(E.TableCell,{className:"text-right",children:e.openingStock}),(0,t.jsx)(E.TableCell,{className:"text-right text-green-600 font-medium",children:e.stockIn+e.returnIn+(e.adjustmentsIn||0)}),(0,t.jsx)(E.TableCell,{className:"text-right text-red-600 font-medium",children:e.itemsSold+e.transferOut+e.returnOut+(e.adjustmentsOut||0)}),(0,t.jsx)(E.TableCell,{className:"text-right font-bold",children:e.closingStock})]},e.productId)}),A.length>0&&(0,t.jsxs)(E.TableRow,{className:"font-semibold bg-muted/50 border-t-2",children:[(0,t.jsx)(E.TableCell,{colSpan:4,children:"Total"}),(0,t.jsx)(E.TableCell,{className:"text-right",children:z.openingStock}),(0,t.jsx)(E.TableCell,{className:"text-right text-green-700",children:z.stockIn+z.returnIn+z.adjustmentsIn}),(0,t.jsx)(E.TableCell,{className:"text-right text-red-700",children:z.itemsSold+z.transferOut+z.returnOut+z.adjustmentsOut}),(0,t.jsx)(E.TableCell,{className:"text-right",children:z.closingStock})]})]})]}),0===A.length&&!a&&(0,t.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No products found matching your filters."})]}),R>1&&(0,t.jsx)("div",{className:"flex justify-center mt-6",children:(0,t.jsx)(ex.Pagination,{children:(0,t.jsxs)(ex.PaginationContent,{children:[(0,t.jsx)(ex.PaginationItem,{children:(0,t.jsx)(ex.PaginationPrevious,{onClick:()=>_(Math.max(1,I-1)),className:1===I?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:Math.min(5,R)},(e,s)=>{let a;return a=R<=5||I<=3?s+1:I>=R-2?R-4+s:I-2+s,(0,t.jsx)(ex.PaginationItem,{children:(0,t.jsx)(ex.PaginationLink,{onClick:()=>_(a),isActive:I===a,className:"cursor-pointer",children:a})},a)}),(0,t.jsx)(ex.PaginationItem,{children:(0,t.jsx)(ex.PaginationNext,{onClick:()=>_(Math.min(R,I+1)),className:I===R?"pointer-events-none opacity-50":"cursor-pointer"})})]})})})]})]})},ep=({data:e})=>{let{canViewCostPrice:a}=(0,K.useFinancialVisibility)(),{settings:r}=(0,p.useBusinessSettings)(),l=r?.currency||"UGX",n=e=>`${l} ${(0,O.formatNumber)(e)}`,i=s.default.useMemo(()=>{let t=e.reduce((e,t)=>({openingStock:e.openingStock+t.openingStock*t.costPrice,stockIn:e.stockIn+(t.stockIn+t.returnIn+(t.adjustmentsIn||0))*t.costPrice,stockOut:e.stockOut+(t.itemsSold+t.transferOut+t.returnOut+(t.adjustmentsOut||0))*t.costPrice}),{openingStock:0,stockIn:0,stockOut:0}),s=t.openingStock+t.stockIn-t.stockOut;return{...t,closingStock:s}},[e]);return 0===e.length?null:(0,t.jsxs)(w.Card,{children:[(0,t.jsx)(w.CardHeader,{children:(0,t.jsx)(w.CardTitle,{children:"Stock Summary Overview"})}),(0,t.jsx)(w.CardContent,{children:(0,t.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground font-medium uppercase",children:"Opening Stock Value"}),(0,t.jsx)("p",{className:"text-xl font-bold text-blue-600",children:a?n(i.openingStock):"•••"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground font-medium uppercase",children:"Total Stock In Value"}),(0,t.jsx)("p",{className:"text-xl font-bold text-green-600",children:a?n(i.stockIn):"•••"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground font-medium uppercase",children:"Total Stock Out Value"}),(0,t.jsx)("p",{className:"text-xl font-bold text-red-600",children:a?n(i.stockOut):"•••"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground font-medium uppercase",children:"Closing Stock Value"}),(0,t.jsx)("p",{className:"text-xl font-bold text-purple-600",children:a?n(i.closingStock):"•••"})]})]})})]})};var eg=e.i(840710);let ef=()=>{let e=(0,o.useNavigate)(),{user:r}=(0,a.useAuth)(),{products:n}=(0,l.useProducts)(r?.id,1e4),i=(()=>{try{let e=localStorage.getItem("stockSummaryFilters");if(e){let t=JSON.parse(e);return{period:t.period||"this-month",dateRange:t.dateRange?{from:t.dateRange.from?new Date(t.dateRange.from):(0,el.startOfMonth)(new Date),to:t.dateRange.to?new Date(t.dateRange.to):(0,en.endOfMonth)(new Date)}:{from:(0,el.startOfMonth)(new Date),to:(0,en.endOfMonth)(new Date)},specificDay:t.specificDay?new Date(t.specificDay):void 0}}}catch(e){console.error("Error loading persisted stock summary filters:",e)}return{period:"all-time",dateRange:{from:new Date(2020,0,1),to:(0,es.endOfDay)(new Date)},specificDay:void 0}})(),[c,d]=(0,s.useState)("all-time"),[m,u]=(0,s.useState)(i.dateRange),[x,h]=(0,s.useState)(i.specificDay),[p,g]=(0,s.useState)([]),{stockSummaryData:f,isLoading:y,loadStockSummaryData:b,clearCache:v}=(0,eg.useStockSummaryData)(m),N=async()=>{v(),await b()};return(0,s.useEffect)(()=>{let e=()=>{console.log("Stock updated, refreshing stock summary data"),v(),b()};return window.addEventListener("stock-updated",e),()=>{window.removeEventListener("stock-updated",e)}},[v,b]),(0,s.useEffect)(()=>{let e={period:c,dateRange:{from:m.from?.toISOString(),to:m.to?.toISOString()},specificDay:x?.toISOString()};localStorage.setItem("stockSummaryFilters",JSON.stringify(e))},[c,m,x]),(0,s.useEffect)(()=>{let e,t=new Date;switch(c){case"today":e={from:(0,et.startOfDay)(t),to:(0,es.endOfDay)(t)};break;case"yesterday":let s=new Date(t);s.setDate(s.getDate()-1),e={from:(0,et.startOfDay)(s),to:(0,es.endOfDay)(s)};break;case"this-week":e={from:(0,ea.startOfWeek)(t),to:(0,er.endOfWeek)(t)};break;case"last-week":let a=new Date(t);a.setDate(a.getDate()-7),e={from:(0,ea.startOfWeek)(a),to:(0,er.endOfWeek)(a)};break;case"this-month":e={from:(0,el.startOfMonth)(t),to:(0,en.endOfMonth)(t)};break;case"last-month":let r=new Date(t);r.setMonth(r.getMonth()-1),e={from:(0,el.startOfMonth)(r),to:(0,en.endOfMonth)(r)};break;case"this-year":e={from:new Date(t.getFullYear(),0,1),to:new Date(t.getFullYear(),11,31)};break;case"all-time":e={from:new Date(2020,0,1),to:(0,es.endOfDay)(t)};break;case"specific-day":if(!x)return;e={from:(0,et.startOfDay)(x),to:(0,es.endOfDay)(x)};break;default:return}u(e)},[c,x]),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)(w.Card,{children:(0,t.jsxs)(w.CardContent,{className:"pt-6",children:[(0,t.jsx)("div",{className:"flex items-center justify-end mb-4",children:(0,t.jsxs)(j.Button,{onClick:N,variant:"outline",size:"sm",disabled:y,className:"gap-2",children:[(0,t.jsx)(ee.RefreshCw,{className:`h-4 w-4 ${y?"animate-spin":""}`}),"Refresh Data"]})}),(0,t.jsx)(ei,{period:c,setPeriod:d,dateRange:m,setDateRange:u,specificDay:x,setSpecificDay:h,onExportCSV:()=>{let e=new Blob([["Item Number,Product Name,Category,Opening Stock,Items Sold,Stock In,Transfer Out,Return In,Return Out,Closing Stock",...p.map(e=>[e.itemNumber,e.productName,e.category||"",e.openingStock.toString(),e.itemsSold.toString(),e.stockIn.toString(),e.transferOut.toString(),e.returnIn.toString(),e.returnOut.toString(),e.closingStock.toString()]).map(e=>e.map(e=>`"${e}"`).join(","))].join("\n")],{type:"text/csv"}),t=window.URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download=`stock-summary-filtered-${(0,_.format)(m?.from||new Date,"yyyy-MM-dd")}.csv`,s.click(),window.URL.revokeObjectURL(t)},onExportPDF:()=>{((e,t,s)=>{let a,r=new q.default({orientation:"landscape",unit:"mm",format:"a4",compress:!0}),l=r.internal.pageSize.getWidth(),n=r.internal.pageSize.getHeight(),i=l-15-15,o=15,c=()=>{r.setFontSize(8),r.setFont("helvetica","normal"),r.setTextColor(150,150,150),r.text("Created By Gonza Systems",l/2,n-10,{align:"center"}),r.setTextColor(0,0,0)},d=[20,50,30,25,25,25,25,25,25],m=["Item #","Product Name","Opening Stock","Items Sold","Stock In","Transfer Out","Return In","Return Out","Closing Stock"],u=()=>{r.setFillColor(243,244,246),r.rect(15,o-2,i,8,"F"),r.setLineWidth(.2),r.rect(15,o-2,i,8),r.setFontSize(9),r.setFont("helvetica","bold");let e=15;m.forEach((t,s)=>{let a=d[s],l=r.getTextWidth(t),n=e+(a-l)/2;r.text(t,n,o+5),s<m.length-1&&r.line(e+a,o-2,e+a,o+8-2),e+=a}),o+=8},x=e=>o+e>n-15-15&&(c(),r.addPage(),o=15,u(),r.setFont("helvetica","normal"),r.setFontSize(8),!0);r.setFontSize(18),r.setFont("helvetica","bold");let h="Stock Summary Report",p=r.getTextWidth(h);if(r.text(h,(l-p)/2,o),o+=8,s?.from&&s?.to){r.setFontSize(12),r.setFont("helvetica","normal");let e=(0,_.format)(s.from,"dd/MM/yyyy"),t=(0,_.format)(s.to,"dd/MM/yyyy"),a=e===t?e:`${e} - ${t}`,n=r.getTextWidth(a);r.text(a,(l-n)/2,o),o+=12}else{r.setFontSize(12),r.setFont("helvetica","normal");let e=(0,_.format)(new Date,"dd/MM/yyyy"),t=r.getTextWidth(e);r.text(e,(l-t)/2,o),o+=12}if(0===e.length){r.setFontSize(14),r.setFont("helvetica","normal");let e="No stock data available for the selected period.",t=r.getTextWidth(e);r.text(e,(l-t)/2,o+30)}else{x(18),u(),r.setFont("helvetica","normal"),r.setFontSize(8),e.forEach((e,t)=>{x(12);let s=[e.itemNumber,e.productName,e.openingStock.toString(),e.itemsSold.toString(),e.stockIn.toString(),e.transferOut.toString(),e.returnIn.toString(),e.returnOut.toString(),e.closingStock.toString()];t%2==0&&(r.setFillColor(249,250,251),r.rect(15,o-1,i,7,"F")),r.setLineWidth(.1),r.rect(15,o-1,i,7);let a=15;s.forEach((e,t)=>{let l=d[t],n=e;if(1===t)for(;r.getTextWidth(n)>l-2&&n.length>3;)n=n.substring(0,n.length-4)+"...";let i=a+1;if(t>=2){let e=r.getTextWidth(n);i=a+l-e-1}else if(0===t){let e=r.getTextWidth(n);i=a+(l-e)/2}r.text(n,i,o+4),t<s.length-1&&r.line(a+l,o-1,a+l,o+7-1),a+=l}),o+=7}),o+=15,x(35),r.setFontSize(16),r.setFont("helvetica","bold"),r.text("Summary",15,o),o+=8;let t=e.length,s=e.reduce((e,t)=>e+t.openingStock,0),a=e.reduce((e,t)=>e+t.itemsSold,0),l=e.reduce((e,t)=>e+t.stockIn,0),n=e.reduce((e,t)=>e+t.closingStock,0),c=.8*i;r.setFillColor(248,249,250),r.rect(15,o-3,c,30,"F"),r.setLineWidth(.3),r.setDrawColor(200,200,200),r.rect(15,o-3,c,30),r.setFontSize(11),r.setFont("helvetica","normal");let m=[["Total Products:",t.toString()],["Total Opening Stock:",s.toString()],["Total Items Sold:",a.toString()]],h=[["Total Stock In:",l.toString()],["Total Closing Stock:",n.toString()]],p=o+6,g=30,f=15+c/2+15;m.forEach(([e,t])=>{r.setFont("helvetica","bold"),r.text(e,g,p),r.setFont("helvetica","normal");let s=r.getTextWidth(e);r.text(t,g+s+5,p),p+=6}),p=o+6,h.forEach(([e,t])=>{r.setFont("helvetica","bold"),r.text(e,f,p),r.setFont("helvetica","normal");let s=r.getTextWidth(e);r.text(t,f+s+5,p),p+=6})}if(c(),s?.from&&s?.to){let e=(0,_.format)(s.from,"yyyy-MM-dd"),t=(0,_.format)(s.to,"yyyy-MM-dd");a=e===t?`stock-summary-${e}.pdf`:`stock-summary-${e}_to_${t}.pdf`}else a=`stock-summary-${(0,_.format)(new Date,"yyyy-MM-dd")}.pdf`;r.save(a)})(p,0,m)}})]})}),(0,t.jsx)(w.Card,{children:(0,t.jsx)(w.CardContent,{className:"pt-6",children:(0,t.jsx)(eh,{data:f,isLoading:y,onProductClick:t=>{e(`/inventory/${t}`)},onFilteredDataChange:e=>{g(e)},currentProducts:n})})}),(0,t.jsx)(ep,{data:p})]})};var ej=e.i(501504),ey=e.i(553366),eb=e.i(483969),ev=e.i(908482),eN=e.i(107233),ew=e.i(727612),eC=e.i(356909),eS=e.i(655900),eT=e.i(664659),ek=e.i(44686),eI=e.i(532436),eD=e.i(712654),eP=e.i(227516),eA=e.i(87316);let eR=({selectedFilter:e,onFilterChange:s})=>(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(eA.Calendar,{size:16}),(0,t.jsxs)(S.Select,{value:e,onValueChange:s,children:[(0,t.jsx)(S.SelectTrigger,{className:"w-[180px]",children:(0,t.jsx)(S.SelectValue,{placeholder:"Select date range"})}),(0,t.jsxs)(S.SelectContent,{children:[(0,t.jsx)(S.SelectItem,{value:"today",children:"Today"}),(0,t.jsx)(S.SelectItem,{value:"yesterday",children:"Yesterday"}),(0,t.jsx)(S.SelectItem,{value:"this-week",children:"This Week"}),(0,t.jsx)(S.SelectItem,{value:"last-week",children:"Last Week"}),(0,t.jsx)(S.SelectItem,{value:"this-month",children:"This Month"}),(0,t.jsx)(S.SelectItem,{value:"last-month",children:"Last Month"}),(0,t.jsx)(S.SelectItem,{value:"this-year",children:"This Year"}),(0,t.jsx)(S.SelectItem,{value:"all",children:"All Time"})]})]})]});var eF=e.i(21722),eM=e.i(110204);let e$=({open:e,onOpenChange:r,group:i,onConfirm:o})=>{let{user:c}=(0,a.useAuth)(),{products:d}=(0,l.useProducts)(c?.id),[m,u]=(0,s.useState)(""),[x,h]=(0,s.useState)(!1),[p,g]=(0,s.useState)(""),{toast:f}=(0,n.useToast)();(0,s.useEffect)(()=>{i&&(u((0,_.format)(new Date(i.date),"yyyy-MM-dd")),g(""))},[i]);let y=async()=>{if(i&&m&&(()=>{if(!i||!m)return!1;let e=new Date(m);for(let t of(e.setHours(23,59,59,999),i.entries)){let s=d.find(e=>e.id===t.productId);if(s&&s.createdAt){let t=new Date(s.createdAt);if(e<t)return g(`New date cannot be earlier than product creation date (${(0,_.format)(t,"PP")}) for ${s.name}.`),!1}}return!0})()){h(!0);try{await o(new Date(m))&&(f({title:"Dates updated",description:"All entries in this invoice have been updated to the new date."}),r(!1))}catch(e){console.error("Error updating group date:",e),f({title:"Update failed",description:"An error occurred while updating the dates.",variant:"destructive"})}finally{h(!1)}}};return i?(0,t.jsx)(Q.Dialog,{open:e,onOpenChange:r,children:(0,t.jsxs)(Q.DialogContent,{className:"sm:max-w-md",children:[(0,t.jsxs)(Q.DialogHeader,{children:[(0,t.jsx)(Q.DialogTitle,{children:"Edit Invoice Date"}),(0,t.jsxs)(Q.DialogDescription,{children:["This will update the date for all ",i.entries.length," items in this invoice. Time settings for each item will be preserved."]})]}),(0,t.jsxs)("div",{className:"space-y-4 py-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(eM.Label,{htmlFor:"date",children:"New Date"}),(0,t.jsx)(C.Input,{id:"date",type:"date",value:m,onChange:e=>{u(e.target.value),g("")},className:p?"border-destructive":""}),p&&(0,t.jsx)("p",{className:"text-sm text-destructive",children:p})]}),(0,t.jsxs)("div",{className:"bg-muted p-3 rounded-lg text-sm space-y-1",children:[i.supplier&&(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Supplier:"})," ",i.supplier]}),i.invoice&&(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Invoice:"})," ",i.invoice]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Current Date:"})," ",(0,_.format)(new Date(i.date),"PP")]})]})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-2 mt-4",children:[(0,t.jsx)(j.Button,{variant:"outline",onClick:()=>r(!1),disabled:x,children:"Cancel"}),(0,t.jsx)(j.Button,{onClick:y,disabled:x,children:x?"Updating...":"Update Dates"})]})]})}):null};var eE=e.i(505883),eO=e.i(868499);let ez=({open:e,onOpenChange:s,group:a,onConfirm:r})=>{let l=async()=>{if(!a)return;let e=a.entries.map(e=>e.id);await r(e)&&s(!1)};return a?(0,t.jsx)(eO.AlertDialog,{open:e,onOpenChange:s,children:(0,t.jsxs)(eO.AlertDialogContent,{children:[(0,t.jsxs)(eO.AlertDialogHeader,{children:[(0,t.jsx)(eO.AlertDialogTitle,{children:"Delete Entire Invoice"}),(0,t.jsxs)(eO.AlertDialogDescription,{className:"space-y-2",children:[(0,t.jsx)("p",{children:"Are you sure you want to delete all stock entries for this invoice?"}),(0,t.jsxs)("div",{className:"bg-muted p-3 rounded-lg",children:[(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Supplier:"})," ",a.supplier]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Invoice:"})," ",a.invoice]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Items:"})," ",a.entries.length," products will be affected"]})]}),(0,t.jsx)("p",{className:"text-destructive text-sm",children:"This will permanently remove all stock history entries for this purchase and recalculate stock levels. This action cannot be undone."})]})]}),(0,t.jsxs)(eO.AlertDialogFooter,{children:[(0,t.jsx)(eO.AlertDialogCancel,{children:"Cancel"}),(0,t.jsx)(eO.AlertDialogAction,{onClick:l,className:"bg-destructive hover:bg-destructive/90",children:"Delete Invoice"})]})]})}):null},e_=()=>{var e;let r,{user:n}=(0,a.useAuth)(),i=(0,o.useNavigate)(),{stockHistory:c,isLoading:d,updateStockHistoryEntry:m,deleteStockHistoryEntry:u,deleteMultipleStockHistoryEntries:h,recalculateProductStock:g,loadStockHistory:f}=(0,ek.useStockHistory)(n?.id),{products:y,loadProducts:b}=(0,l.useProducts)(n?.id,1e4),{settings:v}=(0,p.useBusinessSettings)(),{clearAllLocationCaches:N}=(0,eg.useStockSummaryData)({from:void 0,to:void 0}),{formatFinancial:S,canViewCostPrice:T}=(0,K.useFinancialVisibility)(),[k,I]=(0,s.useState)("this-month"),[D,A]=(0,s.useState)(""),[R,F]=(0,s.useState)(""),[M,$]=(0,s.useState)({open:!1,entry:null}),[O,z]=(0,s.useState)({open:!1,group:null}),[q,B]=(0,s.useState)({open:!1,entry:null}),[H,L]=(0,s.useState)({open:!1,group:null}),[Q,W]=(0,s.useState)({}),[V,Y]=(0,s.useState)(!1);(0,s.useEffect)(()=>{let e=setTimeout(()=>{F(D)},300);return()=>clearTimeout(e)},[D]);let G={USD:"$",EUR:"€",GBP:"£",NGN:"₦",GHS:"₵",KES:"KSh",ZAR:"R",EGP:"E£"}[e=v.currency]||e;(0,s.useEffect)(()=>{let e=()=>{f()};return window.addEventListener("stock-history-updated",e),()=>{window.removeEventListener("stock-history-updated",e)}},[f]),(0,s.useEffect)(()=>{(async()=>{if(!c.length||0===y.length||V)return;let e=Array.from(new Set(c.map(e=>e.productId).filter(e=>!!e&&!y.some(t=>t.id===e||t.itemNumber===e)&&!Q[e])));if(0!==e.length){Y(!0);try{let t=await (0,eI.getActivityByEntityIdsAction)(e),s={...Q};t.success&&t.data&&t.data.forEach(e=>{e.entityId&&e.entityName&&!s[e.entityId]&&(s[e.entityId]=e.entityName)}),Object.keys(s).length>Object.keys(Q).length&&W(s)}catch(e){console.error("Error scavenging names:",e)}finally{Y(!1)}}})()},[c,y,V,Q]);let J=e=>parseFloat(e.toFixed(5)).toLocaleString(),Z="all"===k?null:(0,P.getDateRangeFromFilter)(k),{filteredBulkGroups:ee,filteredRegularGroups:et}=(0,s.useMemo)(()=>{try{if(d||!c.length)return{filteredBulkGroups:[],filteredRegularGroups:[]};let e=c.filter(e=>{try{let t=new Date(e.createdAt),s=!0;return Z&&(s=t>=Z.from&&t<=Z.to),s&&e.newQuantity>e.oldQuantity}catch{return!1}}),t=e.filter(e=>{let t=e.changeReason?.toLowerCase()||"";return t.includes("purchase:")||t.includes("invoice:")||t.includes("supplier:")||t.includes("session:")}),s=e.filter(e=>{let t=e.changeReason?.toLowerCase()||"";return!t.includes("purchase:")&&!t.includes("invoice:")&&!t.includes("supplier:")&&!t.includes("session:")}),a=t.reduce((e,t)=>{try{let s=t.changeReason?.match(/Session: (\d+)/),a=s?s[1]:t.createdAt.toString();if(!e[a]){let s=t.changeReason?.match(/Purchase: ([^|]+)/),r=t.changeReason?.match(/Invoice: ([^|]+)/);e[a]={date:t.createdAt,sessionId:a,supplier:s?s[1].trim():"Unknown Supplier",invoice:r?r[1].trim():"N/A",entries:[]}}return e[a].entries.push(t),e}catch{return e}},{});Object.values(a).forEach(e=>{try{e.entries.sort((e,t)=>{let s=e.changeReason?.match(/Seq: (\d+)/),a=t.changeReason?.match(/Seq: (\d+)/);return s&&a?parseInt(s[1])-parseInt(a[1]):new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime()})}catch{}});let r=s.reduce((e,t)=>{try{let s=(0,_.format)(new Date(t.createdAt),"yyyy-MM-dd");return e[s]||(e[s]={date:t.createdAt,entries:[]}),e[s].entries.push(t),e}catch{return e}},{});Object.values(r).forEach(e=>{try{e.entries.sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime())}catch{}});let l=Object.values(a).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()),n=Object.values(r).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()),i=l.filter(e=>{if(!R.trim())return!0;try{let t=R.toLowerCase().trim(),s=e.supplier?.toLowerCase()?.includes(t)||!1,a=e.invoice?.toLowerCase()?.includes(t)||!1,r=e.entries.some(e=>{if(!e?.productId)return!1;try{return es(e).name.toLowerCase().includes(t)}catch{return!1}});return s||a||r}catch{return!1}}),o=n.filter(e=>{if(!R.trim())return!0;try{let t=R.toLowerCase().trim();return e.entries.some(e=>{try{if(!e?.productId)return e.changeReason?.toLowerCase()?.includes(t)||!1;let s=es(e).name.toLowerCase().includes(t),a=e.changeReason?.toLowerCase()?.includes(t)||!1;return s||a}catch{return!1}})}catch{return!1}});return{filteredBulkGroups:i,filteredRegularGroups:o}}catch(e){return console.error("Error in filtering logic:",e),{filteredBulkGroups:[],filteredRegularGroups:[]}}},[c,y,Z,R,d]),es=(0,s.useCallback)(e=>{try{if(!e)return{name:"Unknown",costPrice:0,sellingPrice:0};let{productId:t,changeReason:s,product:a}=e;if(a)return{name:a.name,costPrice:a.costPrice,sellingPrice:a.sellingPrice};let r=y.find(e=>e.id===t||e.itemNumber===t);if(r)return{name:r.name,costPrice:r.costPrice,sellingPrice:r.sellingPrice};if(s){let e=s.match(/^\[(.*?)\]\s*\|/);if(e)return{name:e[1],costPrice:0,sellingPrice:0}}if(Q[t])return{name:Q[t],costPrice:0,sellingPrice:0};let l=t||"";return{name:`Deleted Product (${l.length>8?l.slice(-8):l})`,costPrice:0,sellingPrice:0}}catch(e){return console.error("Error in getProductDetails:",e),{name:"Deleted Product",costPrice:0,sellingPrice:0}}},[y,Q]),ea=e=>e.reduce((e,t)=>{let s=es(t),a=t.newQuantity-t.oldQuantity,r=a*s.costPrice;return{totalQty:e.totalQty+a,totalAmount:e.totalAmount+r}},{totalQty:0,totalAmount:0}),er=e=>{i(`/inventory/${e}`)},el=async(e,t,s,a)=>{let r=c.find(t=>t.id===e);if(!r)return!1;let l=await m(e,t,s,a);return l&&(N(),await Promise.all([g(r.productId),f()])),l},en=async e=>{let t=c.find(t=>t.id===e);if(!t)return!1;let s=await u(e);return s&&(N(),await Promise.all([g(t.productId),f()])),s},ei=async e=>{if(!O.group)return!1;let t=O.group.entries.map(e=>e.id),s=Array.from(new Set(O.group.entries.map(e=>e.productId)));try{let a=await (0,eD.updateStockHistoryDatesAction)(t,e.toISOString());if(!a.success)throw Error(a.error);return await Promise.all(s.map(e=>g(e))),N(),await Promise.all([f(),b()]),!0}catch(e){return console.error("Error updating invoice date:",e),!1}},eo=async e=>{let t=await h(e);return t&&(N(),await Promise.all([f(),b()]),window.dispatchEvent(new CustomEvent("stock-updated"))),t};return(0,t.jsxs)(w.Card,{className:"mt-6 shadow-sm",children:[(0,t.jsxs)(w.CardHeader,{className:"pb-3 md:pb-6",children:[(0,t.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(eP.History,{size:20}),(0,t.jsxs)("div",{children:[(0,t.jsx)(w.CardTitle,{className:"text-base md:text-lg",children:"Stock Input History"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"View all stock additions and increases"})]})]}),(0,t.jsx)(eR,{selectedFilter:k,onFilterChange:I})]}),(0,t.jsx)("div",{className:"mt-4",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(x.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),(0,t.jsx)(C.Input,{placeholder:"Search by supplier, invoice, or item name...",value:D,onChange:e=>A(e.target.value),className:"pl-10"})]})})]}),(0,t.jsx)(w.CardContent,{className:"p-0",children:d?(0,t.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Loading history..."})}):0===ee.length&&0===et.length?(0,t.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,t.jsx)(eP.History,{size:48,className:"mx-auto mb-4 opacity-50"}),(0,t.jsx)("p",{children:D.trim()?"No matching stock history found.":"No stock input history found for the selected date range."})]}):(0,t.jsx)(X.TooltipProvider,{children:(0,t.jsxs)("div",{className:"space-y-6 p-4",children:[ee.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-primary",children:"Stock Purchases"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Stock purchased from suppliers"})]}),(0,t.jsx)("div",{className:"space-y-6",children:ee.map((e,s)=>{let a=ea(e.entries);return(0,t.jsxs)("div",{className:"border rounded-lg overflow-hidden",children:[(0,t.jsx)("div",{className:"bg-primary/5 px-4 py-3 border-b",children:(0,t.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("h4",{className:"font-semibold text-base",children:(0,_.format)(new Date(e.date),"PPP")}),(0,t.jsxs)("span",{className:"text-xs bg-primary/20 text-primary px-2 py-1 rounded-full",children:[e.entries.length," item",e.entries.length>1?"s":""]})]}),(0,t.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center gap-1 md:gap-4 text-sm text-muted-foreground",children:[(0,t.jsxs)("span",{children:[(0,t.jsx)("strong",{children:"Supplier:"})," ",e.supplier]}),(0,t.jsxs)("span",{children:[(0,t.jsx)("strong",{children:"Invoice:"})," ",e.invoice]})]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(j.Button,{variant:"outline",size:"sm",onClick:()=>{z({open:!0,group:e})},className:"h-8 px-3 text-xs",children:[(0,t.jsx)(U.Edit,{className:"h-3 w-3 mr-1"}),"Edit Date"]}),(0,t.jsxs)(j.Button,{variant:"ghost",size:"sm",onClick:()=>{L({open:!0,group:e})},className:"h-8 px-3 text-xs text-destructive hover:text-destructive",children:[(0,t.jsx)(ew.Trash2,{className:"h-3 w-3 mr-1"}),"Delete Invoice"]})]})]})}),(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)(E.Table,{children:[(0,t.jsx)(E.TableHeader,{children:(0,t.jsxs)(E.TableRow,{children:[(0,t.jsx)(E.TableHead,{className:"w-[200px]",children:"Item"}),(0,t.jsx)(E.TableHead,{className:"w-[100px]",children:"Qty Added"}),(0,t.jsx)(E.TableHead,{className:"w-[100px]",children:"Price"}),(0,t.jsx)(E.TableHead,{className:"w-[100px]",children:"Amount"}),(0,t.jsx)(E.TableHead,{className:"w-[100px]",children:"Time"}),(0,t.jsx)(E.TableHead,{className:"w-[60px]",children:"Actions"})]})}),(0,t.jsxs)(E.TableBody,{children:[e.entries.map(e=>{let s=es(e),a=e.newQuantity-e.oldQuantity,r=s.costPrice,l=y.some(t=>t.id===e.productId||t.itemNumber===e.productId);return(0,t.jsxs)(E.TableRow,{children:[(0,t.jsx)(E.TableCell,{className:"font-medium",children:l?(0,t.jsxs)(X.Tooltip,{children:[(0,t.jsx)(X.TooltipTrigger,{asChild:!0,children:(0,t.jsx)("button",{onClick:()=>er(e.productId),className:"text-left hover:text-primary hover:underline cursor-pointer transition-colors max-w-[200px] truncate",children:s.name})}),(0,t.jsx)(X.TooltipContent,{side:"top",className:"max-w-xs",children:(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("p",{className:"font-bold break-words whitespace-normal",children:s.name}),e.changeReason&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:e.changeReason})]})})]}):(0,t.jsx)("span",{className:"max-w-[200px] truncate block",children:s.name})}),(0,t.jsxs)(E.TableCell,{className:"text-green-700 bg-green-50 font-medium px-3 py-2 rounded-lg border border-green-200",children:[e.oldQuantity," → ",e.newQuantity," (+",J(a),")"]}),(0,t.jsx)(E.TableCell,{children:T?`${G}${S(r,"cost")}`:"•••"}),(0,t.jsx)(E.TableCell,{className:"font-medium",children:T?`${G}${J(a*r)}`:"•••"}),(0,t.jsx)(E.TableCell,{className:"text-sm text-muted-foreground",children:(0,_.format)(new Date(e.createdAt),"p")}),(0,t.jsx)(E.TableCell,{children:(0,t.jsxs)("div",{className:"flex gap-1",children:[(0,t.jsx)(j.Button,{variant:"ghost",size:"sm",onClick:()=>$({open:!0,entry:e}),className:"h-8 w-8 p-0",children:(0,t.jsx)(U.Edit,{className:"h-4 w-4"})}),(0,t.jsx)(j.Button,{variant:"ghost",size:"sm",onClick:()=>B({open:!0,entry:e}),className:"h-8 w-8 p-0 text-destructive hover:text-destructive",children:(0,t.jsx)(ew.Trash2,{className:"h-4 w-4"})})]})})]},e.id)}),(0,t.jsxs)(E.TableRow,{className:"bg-primary/5 font-semibold border-t-2",children:[(0,t.jsx)(E.TableCell,{className:"font-bold",children:"Total"}),(0,t.jsxs)(E.TableCell,{className:"text-green-700 bg-green-50 font-bold px-3 py-2 rounded-lg border border-green-200",children:["Total: +",J(a.totalQty)]}),(0,t.jsx)(E.TableCell,{children:"-"}),(0,t.jsx)(E.TableCell,{className:"font-bold",children:T?`${G}${J(a.totalAmount)}`:"•••"}),(0,t.jsx)(E.TableCell,{children:"-"}),(0,t.jsx)(E.TableCell,{children:"-"})]})]})]})})]},`purchase-${s}`)})})]}),et.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-muted-foreground",children:"Regular Stock Additions"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Individual stock additions and manual adjustments"})]}),(0,t.jsx)("div",{className:"space-y-4",children:et.map((e,s)=>{let a=ea(e.entries);return(0,t.jsxs)("div",{className:"border rounded-lg overflow-hidden",children:[(0,t.jsx)("div",{className:"bg-muted/50 px-4 py-2 border-b",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h4",{className:"font-medium text-sm",children:(0,_.format)(new Date(e.date),"PPP")}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsxs)("span",{className:"text-xs text-muted-foreground",children:[e.entries.length," item",e.entries.length>1?"s":""]})})]})}),(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)(E.Table,{children:[(0,t.jsx)(E.TableHeader,{children:(0,t.jsxs)(E.TableRow,{children:[(0,t.jsx)(E.TableHead,{className:"w-[200px]",children:"Item"}),(0,t.jsx)(E.TableHead,{className:"w-[100px]",children:"Qty Added"}),(0,t.jsx)(E.TableHead,{className:"w-[100px]",children:"Price"}),(0,t.jsx)(E.TableHead,{className:"w-[100px]",children:"Amount"}),(0,t.jsx)(E.TableHead,{className:"w-[100px]",children:"Time"}),(0,t.jsx)(E.TableHead,{className:"w-[120px]",children:"Type"})]})}),(0,t.jsxs)(E.TableBody,{children:[e.entries.map(e=>{let s=es(e),a=e.newQuantity-e.oldQuantity,r=s.costPrice,l=y.some(t=>t.id===e.productId||t.itemNumber===e.productId);return(0,t.jsxs)(E.TableRow,{children:[(0,t.jsx)(E.TableCell,{className:"font-medium",children:l?(0,t.jsxs)(X.Tooltip,{children:[(0,t.jsx)(X.TooltipTrigger,{asChild:!0,children:(0,t.jsx)("button",{onClick:()=>er(e.productId),className:"text-left hover:text-primary hover:underline cursor-pointer transition-colors max-w-[200px] truncate",children:s.name})}),(0,t.jsx)(X.TooltipContent,{side:"top",className:"max-w-xs",children:(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("p",{className:"font-bold break-words whitespace-normal",children:s.name}),e.changeReason&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:e.changeReason})]})})]}):(0,t.jsx)("span",{className:"max-w-[200px] truncate block",children:s.name})}),(0,t.jsxs)(E.TableCell,{className:"text-green-700 bg-green-50 font-medium px-3 py-2 rounded-lg border border-green-200",children:[e.oldQuantity," → ",e.newQuantity," (+",J(a),")"]}),(0,t.jsx)(E.TableCell,{children:T?`${G}${S(r,"cost")}`:"•••"}),(0,t.jsx)(E.TableCell,{className:"font-medium",children:T?`${G}${J(a*r)}`:"•••"}),(0,t.jsx)(E.TableCell,{className:"text-sm text-muted-foreground",children:(0,_.format)(new Date(e.createdAt),"p")}),(0,t.jsx)(E.TableCell,{children:(0,t.jsx)("span",{className:"text-xs bg-muted text-muted-foreground px-2 py-1 rounded-full",children:e.changeReason})})]},e.id)}),(0,t.jsxs)(E.TableRow,{className:"bg-muted/30 font-semibold border-t-2",children:[(0,t.jsx)(E.TableCell,{className:"font-bold",children:"Total"}),(0,t.jsxs)(E.TableCell,{className:"text-green-700 bg-green-50 font-bold px-3 py-2 rounded-lg border border-green-200",children:["Total: +",J(a.totalQty)]}),(0,t.jsx)(E.TableCell,{children:"-"}),(0,t.jsx)(E.TableCell,{className:"font-bold",children:T?`${G}${J(a.totalAmount)}`:"•••"}),(0,t.jsx)(E.TableCell,{children:"-"}),(0,t.jsx)(E.TableCell,{children:"-"})]})]})]})})]},`regular-${s}`)})})]})]})})}),(0,t.jsx)(eF.default,{open:M.open,onOpenChange:e=>$({open:e,entry:null}),entry:M.entry,onConfirm:el,productCreatedAt:M.entry&&(r=y.find(e=>e.id===M.entry?.productId))?new Date(r.createdAt):void 0}),(0,t.jsx)(eE.default,{open:q.open,onOpenChange:e=>B({open:e,entry:null}),entry:q.entry,onConfirm:en}),(0,t.jsx)(ez,{open:H.open,onOpenChange:e=>L({open:e,group:null}),group:H.group,onConfirm:eo}),(0,t.jsx)(e$,{open:O.open,onOpenChange:e=>z({open:e,group:null}),group:O.group,onConfirm:ei})]})},eq="bulkStockAddRows",eB=({row:e,index:s,onUpdateRow:a,onRemoveRow:r,onProductSelect:l,onInputFocus:n,onAddRowAfter:i,onKeyDown:o,onMoveRow:c,settings:d,canRemove:m,products:u,stockEntryDate:x,isLastRow:h,totalRows:p})=>{let g=!!e.productId&&(()=>{let t=u.find(t=>t.id===e.productId);if(t){let e=new Date(t.createdAt),s=new Date(x),a=new Date(e.getFullYear(),e.getMonth(),e.getDate()),r=new Date(s.getFullYear(),s.getMonth(),s.getDate());return a.getTime()>r.getTime()}return!1})(),f=g?u.find(t=>t.id===e.productId):null;return(0,t.jsxs)(w.Card,{className:(0,O.cn)("mb-4 shadow-sm",g&&"border-destructive border-2"),children:[(0,t.jsx)(w.CardHeader,{className:"pb-3",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(w.CardTitle,{className:"text-sm font-medium",children:["Item #",s+1]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(j.Button,{variant:"outline",size:"icon",onClick:()=>c(e.id,"up"),disabled:0===s,className:"h-8 w-8",children:(0,t.jsx)(eS.ChevronUp,{size:14})}),(0,t.jsx)(j.Button,{variant:"outline",size:"icon",onClick:()=>c(e.id,"down"),disabled:s===p-1,className:"h-8 w-8",children:(0,t.jsx)(eT.ChevronDown,{size:14})}),(0,t.jsx)(j.Button,{variant:"outline",size:"icon",onClick:()=>r(e.id),disabled:!m,className:"h-8 w-8",children:(0,t.jsx)(ew.Trash2,{size:14})})]})]})}),(0,t.jsxs)(w.CardContent,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("label",{className:"text-xs font-medium text-muted-foreground mb-1 block",children:"Product"}),(0,t.jsx)(C.Input,{placeholder:"Type to search products...",value:e.searchTerm,onChange:t=>a(e.id,"searchTerm",t.target.value),onFocus:()=>n(e.id),onKeyDown:t=>o(t,e.id),className:(0,O.cn)("w-full",g&&"border-destructive")}),g&&f&&(0,t.jsxs)("p",{className:"text-xs text-destructive mt-1",children:["Product was created on ",(0,_.format)(new Date(f.createdAt),"PPP")," - after selected date"]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-xs font-medium text-muted-foreground mb-1 block",children:"Quantity"}),(0,t.jsx)(C.Input,{type:"number",min:"0",step:"0.01",value:e.quantity||"",onChange:t=>a(e.id,"quantity",parseFloat(t.target.value)||0),onKeyDown:t=>o(t,e.id),placeholder:"0"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-xs font-medium text-muted-foreground mb-1 block",children:"Price"}),(0,t.jsx)(C.Input,{type:"number",min:"0",step:"0.01",value:e.price||"",onChange:t=>a(e.id,"price",parseFloat(t.target.value)||0),onKeyDown:t=>o(t,e.id),placeholder:"0.00"})]})]}),(0,t.jsx)("div",{className:"bg-muted/50 p-3 rounded-md",children:(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-xs font-medium text-muted-foreground",children:"Amount:"}),(0,t.jsxs)("span",{className:"font-semibold",children:[d.currency," ",Math.round(e.amount).toLocaleString()]})]})}),h&&(0,t.jsx)("div",{className:"flex justify-center pt-2",children:(0,t.jsxs)(j.Button,{variant:"ghost",size:"sm",onClick:()=>i(e.id),className:"gap-2 text-muted-foreground hover:text-foreground",children:[(0,t.jsx)(eN.Plus,{size:14}),"Add row below"]})})]})]})},eH=()=>{let{user:e}=(0,a.useAuth)(),{products:r,updateProduct:o,loadProducts:c}=(0,l.useProducts)(e?.id,1e4),{settings:d}=(0,p.useBusinessSettings)(),{toast:m}=(0,n.useToast)(),u=(0,i.useIsMobile)(),{stockHistory:x,loadStockHistory:h}=(0,ek.useStockHistory)(e?.id),g=e=>{let t=(()=>{if(0===x.length)return null;let e=[...x].sort((e,t)=>e.createdAt.getTime()-t.createdAt.getTime());return e[0]?.createdAt||null})();if(!t)return"";let s=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0),a=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0);return s.getTime()===a.getTime()?`Date cannot be the same as the initial stock entry date (${(0,_.format)(t,"PPP")})`:s.getTime()<a.getTime()?`Date cannot be earlier than initial stock date (${(0,_.format)(t,"PPP")})`:""},f=e=>Math.round(e).toLocaleString(),[y,v]=(0,s.useState)(new Date),[S,T]=(0,s.useState)(""),[k,D]=(0,s.useState)(""),[P,A]=(0,s.useState)(()=>{try{let e=localStorage.getItem(eq);if(e){let t=JSON.parse(e).map(e=>({...e,searchTerm:e.searchTerm||e.productName||""}));return t.length>0?t:[{id:"1",productId:"",productName:"",quantity:0,price:0,amount:0,searchTerm:""}]}}catch(e){console.error("Error loading saved stock rows:",e)}return[{id:"1",productId:"",productName:"",quantity:0,price:0,amount:0,searchTerm:""}]}),[R,F]=(0,s.useState)(!1),[M,$]=(0,s.useState)(null);(0,s.useEffect)(()=>{try{localStorage.setItem(eq,JSON.stringify(P))}catch(e){console.error("Error saving stock rows:",e)}},[P]);let z=(0,s.useCallback)(()=>{try{localStorage.removeItem(eq)}catch(e){console.error("Error clearing stored data:",e)}},[]),q=P.find(e=>e.id===M),{suggestions:B,isOpen:Q,closePanel:U}=N(r,q?.searchTerm||""),W=(0,s.useCallback)(()=>{let e={id:Date.now().toString(),productId:"",productName:"",quantity:0,price:0,amount:0,searchTerm:""};A(t=>[...t,e])},[]),V=(0,s.useCallback)(e=>{let t={id:Date.now().toString(),productId:"",productName:"",quantity:0,price:0,amount:0,searchTerm:""};A(s=>{let a=s.findIndex(t=>t.id===e),r=[...s];return r.splice(a+1,0,t),r})},[]),Y=(0,s.useCallback)((e,t)=>{A(s=>{let a=s.findIndex(t=>t.id===e);if(-1===a)return s;let r="up"===t?a-1:a+1;if(r<0||r>=s.length)return s;let l=[...s];return[l[a],l[r]]=[l[r],l[a]],l})},[]),K=(0,s.useCallback)((e,t)=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),V(t))},[V]),G=(0,s.useCallback)(e=>{P.length>1&&(A(t=>t.filter(t=>t.id!==e)),M===e&&$(null))},[P.length,M]),J=(0,s.useCallback)((e,t,s)=>{A(a=>a.map(a=>{if(a.id===e){let e={...a,[t]:s};return"searchTerm"===t&&"string"==typeof s&&(r.find(e=>e.name.toLowerCase()===s.toLowerCase())||(e.productId="",e.productName="",e.price=0)),("quantity"===t||"price"===t)&&(e.amount=e.quantity*e.price),e}return a}))},[r]),X=(0,s.useCallback)(e=>{M&&(A(t=>{let s=t.findIndex(t=>t.productId===e.id&&t.id!==M);if(-1!==s){let a=t.find(e=>e.id===M),r=a?.quantity||0,l=t.map((e,t)=>{if(t===s){let t=e.quantity+r;return{...e,quantity:t,amount:t*e.price}}return e}).filter(e=>e.id!==M);return m({title:"Product already in list",description:`Merged "${e.name}" quantity.`}),l.length>0?l:[{id:Date.now().toString(),productId:"",productName:"",quantity:0,price:0,amount:0,searchTerm:""}]}return t.map(t=>t.id===M?{...t,productId:e.id,productName:e.name,searchTerm:e.name,price:e.costPrice,amount:t.quantity*e.costPrice}:t)}),$(null))},[M,m]),Z=(0,s.useCallback)(e=>{$(e)},[]),ee=(0,s.useCallback)(()=>{let e=[];return P.forEach((t,s)=>{if(t.productId||e.push(`Row ${s+1}: Please select a product`),t.quantity<=0&&e.push(`Row ${s+1}: Quantity must be greater than 0`),t.price<0&&e.push(`Row ${s+1}: Price cannot be negative`),t.productId){let a=r.find(e=>e.id===t.productId);if(a){let t=new Date(a.createdAt),r=new Date(y),l=new Date(t.getFullYear(),t.getMonth(),t.getDate()),n=new Date(r.getFullYear(),r.getMonth(),r.getDate());l.getTime()>n.getTime()&&e.push(`Row ${s+1}: Product "${a.name}" was created on ${(0,_.format)(t,"PPP")} which is after the selected stock date`)}}}),e},[P,r,y]),et=(0,s.useCallback)(async()=>{let e=ee(),t=g(y);if(t&&e.push(t),e.length>0)return void m({title:"Validation Error",description:e.join(", "),variant:"destructive"});F(!0);try{let e=0,t=0,s=new Map;P.forEach(e=>{if(e.productId)if(s.has(e.productId)){let t=s.get(e.productId);t.quantity+=e.quantity,t.price=e.price,t.amount=t.quantity*t.price}else s.set(e.productId,{...e})});let a=Array.from(s.values()),l=Date.now().toString(),n=`Purchase: ${S||"Unknown Supplier"} | Invoice: ${k||"N/A"} | Session: ${l}`;for(let s=0;s<a.length;s++){let l=a[s],i=r.find(e=>e.id===l.productId);if(i){let a=i.quantity+l.quantity,r=`${n} | Seq: ${s+1}`;await o(l.productId,{quantity:a,costPrice:l.price},void 0,!1,r,y)?e++:t++}}if(e>0){m({title:"Stock Added Successfully",description:`Added stock for ${e} product${e>1?"s":""}`});let t={id:Date.now().toString(),productId:"",productName:"",quantity:0,price:0,amount:0,searchTerm:""};A([t]),T(""),D(""),z(),await Promise.all([c(),h()]),setTimeout(()=>{window.dispatchEvent(new CustomEvent("inventory-updated")),window.dispatchEvent(new CustomEvent("stock-history-updated"))},100)}t>0&&m({title:"Some Updates Failed",description:`${t} product${t>1?"s":""} could not be updated`,variant:"destructive"})}catch(e){console.error("Error in bulk stock addition:",e),m({title:"Error",description:"Failed to add stock. Please try again.",variant:"destructive"})}finally{F(!1)}},[P,r,o,c,h,m,ee,z,y,S,k]),es=P.reduce((e,t)=>e+t.amount,0),ea=P.reduce((e,t)=>e+t.quantity,0);return(0,t.jsxs)("div",{className:"space-y-4 md:space-y-6",children:[(0,t.jsxs)(w.Card,{className:"shadow-sm",children:[(0,t.jsx)(w.CardHeader,{className:"pb-3 md:pb-6",children:(0,t.jsxs)("div",{className:"space-y-3 md:space-y-0 md:flex md:items-center md:justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(w.CardTitle,{className:"text-base md:text-lg",children:"Restock in Bulk"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Add stock for multiple products at once"})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,t.jsxs)(H.Popover,{children:[(0,t.jsx)(H.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)(j.Button,{variant:"outline",className:"gap-2 justify-start text-left font-normal w-full",children:[(0,t.jsx)(I.CalendarIcon,{size:16}),(0,_.format)(y,"MMM d, yyyy")]})}),(0,t.jsxs)(H.PopoverContent,{className:"w-auto p-0 z-[100] bg-white shadow-lg",align:"start",children:[(0,t.jsx)(L.Calendar,{mode:"single",selected:y,onSelect:e=>e&&v(e),disabled:e=>{let t=P.filter(e=>e.productId).map(e=>r.find(t=>t.id===e.productId)).filter(Boolean);return 0===t.length?e<new Date("2000-01-01")||e>new Date:e<(t.reduce((e,t)=>{let s=new Date(t.createdAt);return!e||s<e?s:e},null)||new Date("2000-01-01"))||e>new Date},className:(0,O.cn)("p-3 pointer-events-auto",g(y)&&"border-destructive"),initialFocus:!0}),g(y)&&(0,t.jsx)("div",{className:"p-3 border-t bg-destructive/5",children:(0,t.jsx)("p",{className:"text-sm text-destructive",children:g(y)})})]})]}),(0,t.jsx)(C.Input,{placeholder:"Supplier name",value:S,onChange:e=>T(e.target.value),className:"w-full"}),(0,t.jsx)(C.Input,{placeholder:"Invoice number",value:k,onChange:e=>D(e.target.value),className:"w-full"})]}),(0,t.jsxs)("div",{className:"flex space-x-2",children:[(0,t.jsxs)(j.Button,{onClick:W,variant:"outline",className:"gap-2 flex-1 md:flex-none",children:[(0,t.jsx)(eN.Plus,{size:16})," Add Row"]}),(0,t.jsxs)(j.Button,{onClick:et,disabled:R||0===P.length,className:"gap-2 flex-1 md:flex-none",children:[(0,t.jsx)(eC.Save,{size:16}),R?"Saving...":`Save All (${P.length})`]})]})]})]})}),(0,t.jsxs)(w.CardContent,{className:"p-0 md:p-6",children:[u?(0,t.jsxs)("div",{className:"p-4 space-y-4",children:[P.map((e,s)=>(0,t.jsx)(eB,{row:e,index:s,onUpdateRow:J,onRemoveRow:G,onProductSelect:X,onInputFocus:Z,onAddRowAfter:V,onKeyDown:K,onMoveRow:Y,settings:d,canRemove:P.length>1,products:r,stockEntryDate:y,isLastRow:s===P.length-1,totalRows:P.length},e.id)),(0,t.jsx)(w.Card,{className:"bg-primary/5 border-primary/20",children:(0,t.jsx)(w.CardContent,{className:"p-4",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"font-medium",children:"Total Quantity:"}),(0,t.jsx)("span",{className:"text-lg font-bold text-primary",children:f(ea)})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"font-medium",children:"Total Amount:"}),(0,t.jsxs)("span",{className:"text-lg font-bold text-primary",children:[d.currency," ",f(es)]})]})]})})})]}):(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)(E.Table,{children:[(0,t.jsx)(E.TableHeader,{children:(0,t.jsxs)(E.TableRow,{children:[(0,t.jsx)(E.TableHead,{className:"w-[300px]",children:"Item"}),(0,t.jsx)(E.TableHead,{className:"w-[120px]",children:"Qty"}),(0,t.jsx)(E.TableHead,{className:"w-[120px]",children:"Price"}),(0,t.jsx)(E.TableHead,{className:"w-[120px]",children:"Amount"}),(0,t.jsx)(E.TableHead,{className:"w-[140px]",children:"Actions"})]})}),(0,t.jsxs)(E.TableBody,{children:[P.map((e,s)=>{let a=!!e.productId&&(()=>{let t=r.find(t=>t.id===e.productId);if(t){let e=new Date(t.createdAt),s=new Date(y),a=new Date(e.getFullYear(),e.getMonth(),e.getDate()),r=new Date(s.getFullYear(),s.getMonth(),s.getDate());return a.getTime()>r.getTime()}return!1})(),l=a?r.find(t=>t.id===e.productId):null;return(0,t.jsxs)(E.TableRow,{className:a?"border-destructive border-2 bg-destructive/5":"",children:[(0,t.jsx)(E.TableCell,{children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(C.Input,{placeholder:"Type to search products...",value:e.searchTerm,onChange:t=>J(e.id,"searchTerm",t.target.value),onFocus:()=>Z(e.id),onKeyDown:t=>K(t,e.id),className:(0,O.cn)("w-full",a&&"border-destructive")}),a&&l&&(0,t.jsxs)("p",{className:"text-xs text-destructive mt-1",children:["Product was created on ",(0,_.format)(new Date(l.createdAt),"PPP")," - after selected date"]})]})}),(0,t.jsx)(E.TableCell,{children:(0,t.jsx)(C.Input,{type:"number",min:"0",step:"0.01",value:e.quantity||"",onChange:t=>J(e.id,"quantity",parseFloat(t.target.value)||0),onKeyDown:t=>K(t,e.id),placeholder:"0"})}),(0,t.jsx)(E.TableCell,{children:(0,t.jsx)(C.Input,{type:"number",min:"0",step:"0.01",value:e.price||"",onChange:t=>J(e.id,"price",parseFloat(t.target.value)||0),onKeyDown:t=>K(t,e.id),placeholder:"0.00"})}),(0,t.jsx)(E.TableCell,{children:(0,t.jsxs)("div",{className:"font-medium",children:[d.currency," ",f(e.amount)]})}),(0,t.jsx)(E.TableCell,{children:(0,t.jsxs)("div",{className:"flex gap-1",children:[(0,t.jsx)(j.Button,{variant:"outline",size:"icon",onClick:()=>Y(e.id,"up"),disabled:0===s,className:"h-8 w-8",children:(0,t.jsx)(eS.ChevronUp,{size:14})}),(0,t.jsx)(j.Button,{variant:"outline",size:"icon",onClick:()=>Y(e.id,"down"),disabled:s===P.length-1,className:"h-8 w-8",children:(0,t.jsx)(eT.ChevronDown,{size:14})}),(0,t.jsx)(j.Button,{variant:"outline",size:"icon",onClick:()=>G(e.id),disabled:1===P.length,className:"h-8 w-8",children:(0,t.jsx)(ew.Trash2,{size:14})})]})})]},e.id)}),(0,t.jsx)(E.TableRow,{className:"border-none",children:(0,t.jsx)(E.TableCell,{colSpan:5,className:"py-1 text-center",children:(0,t.jsxs)(j.Button,{variant:"ghost",size:"sm",onClick:()=>V(P[P.length-1].id),className:"gap-2 text-muted-foreground hover:text-foreground text-xs",children:[(0,t.jsx)(eN.Plus,{size:12}),"Add row below"]})})}),(0,t.jsxs)(E.TableRow,{className:"border-t-2",children:[(0,t.jsx)(E.TableCell,{className:"text-right font-medium",children:"Total Quantity:"}),(0,t.jsx)(E.TableCell,{className:"font-bold text-lg",children:f(ea)}),(0,t.jsx)(E.TableCell,{className:"text-right font-medium",children:"Total Amount:"}),(0,t.jsxs)(E.TableCell,{className:"font-bold text-lg",children:[d.currency," ",f(es)]}),(0,t.jsx)(E.TableCell,{})]})]})]})}),0===P.length&&(0,t.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:'No stock entries. Click "Add Row" to start adding stock.'})]})]}),(0,t.jsx)(b,{suggestions:B,isOpen:Q,onClose:U,onSelectProduct:X,searchTerm:q?.searchTerm||""}),(0,t.jsx)(e_,{})]})},eL=(0,eo.default)("ScanBarcode",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M8 7v10",key:"23sfjj"}],["path",{d:"M12 7v10",key:"jspqdw"}],["path",{d:"M17 7v10",key:"578dap"}]]);var eQ=e.i(25652),eU=e.i(635408);let eW=(0,eo.default)("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);var eV=e.i(797548),eY=e.i(878894),eK=e.i(846696),eG=e.i(589271),eJ=e.i(945700);let eX=e=>{let t=new Blob([["Product Name,Barcode,System Stock,Actual Stock,Variation",...e.map(e=>[e.product.name,e.product.barcode||"N/A",e.product.quantity.toString(),e.actualStock.toString(),e.variation.toString()]).map(e=>e.map(e=>`"${e.replace(/"/g,'""')}"`).join(","))].join("\n")],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(t),a=document.createElement("a");a.setAttribute("href",s),a.setAttribute("download",`stock_count_${(0,_.format)(new Date,"yyyy-MM-dd_HHmm")}.csv`),document.body.appendChild(a),a.click(),document.body.removeChild(a)},eZ=(e,t="Gonza Systems",s)=>{let a=new q.default,r=a.internal.pageSize.getWidth();a.setFontSize(20);let l=s?.auditId?`Stock Count Report - ${s.auditId}`:`Stock Count / Audit Report ${s?.auditNumber?`#${s.auditNumber}`:""}`;if(a.text(l,14,22),a.setFontSize(11),a.setTextColor(100),a.text(`Business: ${t}`,14,30),a.text(`Date: ${(0,_.format)(new Date,"PPP p")}`,14,36),s?.auditorName||s?.contactPerson){let e=42;s.auditorName&&(a.text(`Auditor: ${s.auditorName}`,14,e),e+=6),s.contactPerson&&a.text(`Contact Person: ${s.contactPerson}`,14,e)}let n=e.map(e=>[e.product.name,e.product.barcode||"N/A",e.product.quantity.toString(),e.actualStock.toString(),{content:e.variation>0?`+${e.variation}`:e.variation.toString(),styles:{textColor:e.variation<0?[220,38,38]:e.variation>0?[22,163,74]:[100,116,139]}}]);(0,eJ.default)(a,{head:[["Product Name","Barcode","System","Actual","Variation"]],body:n,startY:s?.auditorName||s?.contactPerson?55:45,theme:"striped",headStyles:{fillColor:[59,130,246]},alternateRowStyles:{fillColor:[248,250,252]},margin:{top:45}});let i=a.lastAutoTable.finalY+25;i<a.internal.pageSize.getHeight()-40&&(a.setDrawColor(200),a.line(14,i,80,i),a.line(r-80,i,r-14,i),a.setFontSize(9),a.setTextColor(50),a.text("Auditor Signature",14,i+5),a.text("Stock Manager Signature",r-80,i+5));let o=a.internal.getNumberOfPages();for(let e=1;e<=o;e++)a.setPage(e),a.setFontSize(8),a.setTextColor(150),a.text("Created By Gonza Systems",a.internal.pageSize.getWidth()/2,a.internal.pageSize.getHeight()-10,{align:"center"});a.save(`stock_audit_${(0,_.format)(new Date,"yyyy-MM-dd_HHmm")}.pdf`)};var e0=e.i(27365),e1=e.i(503116),e2=e.i(463059),e4=e.i(952571);let e5="stockCountData",e8=({rows:e,onUpdate:s,onRemove:a,isAuditMode:r,lastScannedId:l})=>(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)(E.Table,{children:[(0,t.jsx)(E.TableHeader,{children:(0,t.jsxs)(E.TableRow,{className:"bg-muted/50 border-b-2",children:[(0,t.jsx)(E.TableHead,{className:"min-w-[200px] font-bold text-gray-700",children:"Item Details"}),(0,t.jsx)(E.TableHead,{className:"text-center w-[120px] font-bold text-gray-700",children:"System"}),(0,t.jsx)(E.TableHead,{className:"text-center w-[150px] font-bold text-gray-700",children:"Actual Count"}),(0,t.jsx)(E.TableHead,{className:"text-center w-[150px] font-bold text-gray-700",children:"Variation"}),!r&&(0,t.jsx)(E.TableHead,{className:"text-right w-[80px]"})]})}),(0,t.jsx)(E.TableBody,{children:0===e.length?(0,t.jsx)(E.TableRow,{children:(0,t.jsx)(E.TableCell,{colSpan:r?4:5,className:"h-48 text-center bg-slate-50",children:(0,t.jsxs)("div",{className:"flex flex-col items-center gap-2 text-muted-foreground",children:[(0,t.jsx)(eV.Filter,{className:"h-8 w-8 opacity-20"}),(0,t.jsx)("p",{children:r?"No products match your search":"No items recorded yet"})]})})}):e.map(({product:e,actualStock:n,variation:i})=>(0,t.jsxs)(E.TableRow,{id:`row-${e.id}`,className:(0,O.cn)("hover:bg-muted/30 transition-colors",0!==i&&"bg-orange-50/20",l===e.id&&"row-highlight"),children:[(0,t.jsxs)(E.TableCell,{className:"py-4",children:[(0,t.jsx)("div",{className:"font-bold text-gray-900 leading-tight",children:e.name}),(0,t.jsx)("div",{className:"text-[10px] text-muted-foreground font-mono mt-1 uppercase tracking-tighter",children:e.barcode||"NO BARCODE"})]}),(0,t.jsx)(E.TableCell,{className:"text-center text-sm font-medium text-slate-500",children:e.quantity}),(0,t.jsx)(E.TableCell,{className:"text-center",children:(0,t.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,t.jsx)(j.Button,{variant:"outline",size:"icon",className:"h-8 w-8 rounded-full",onClick:()=>s(e,-1,!0),children:"-"}),(0,t.jsx)(C.Input,{type:"number",className:"w-20 text-center font-black text-lg border-2",value:n,onChange:t=>s(e,parseFloat(t.target.value)||0,!1)}),(0,t.jsx)(j.Button,{variant:"outline",size:"icon",className:"h-8 w-8 rounded-full bg-slate-100",onClick:()=>s(e,1,!0),children:"+"})]})}),(0,t.jsx)(E.TableCell,{className:"text-center",children:(0,t.jsxs)("div",{className:(0,O.cn)("inline-flex items-center px-2.5 py-1 rounded-full text-xs font-black ring-1",i>0?"text-emerald-700 bg-emerald-50 ring-emerald-200":i<0?"text-rose-700 bg-rose-50 ring-rose-200":"text-slate-500 bg-slate-50 ring-slate-200"),children:[i>0?(0,t.jsx)(eQ.TrendingUp,{className:"h-3 w-3 mr-1"}):i<0?(0,t.jsx)(eU.TrendingDown,{className:"h-3 w-3 mr-1"}):null,i>0?"+":"",i]})}),!r&&(0,t.jsx)(E.TableCell,{className:"text-right px-4",children:(0,t.jsx)(j.Button,{variant:"ghost",size:"icon",onClick:()=>a(e.id),className:"hover:bg-red-50 hover:text-red-600 rounded-full",children:(0,t.jsx)(ew.Trash2,{className:"h-4 w-4"})})})]},e.id))})]})}),e3=()=>{let{user:e}=(0,a.useAuth)(),n=e?.id,{currentBusiness:i}=(0,r.useBusiness)(),{products:o,updateProduct:c,updateProductsBulk:m,loadProducts:u}=(0,l.useProducts)(n,1e4),[h,p]=(0,s.useState)(!1),[g,f]=(0,s.useState)(""),[y,b]=(0,s.useState)("quick"),[v,N]=(0,s.useState)(null),[S,k]=(0,s.useState)(!1),[I,D]=(0,s.useState)(null),[P,A]=(0,s.useState)(""),[R,F]=(0,s.useState)(""),[M,z]=(0,s.useState)(null),[q,B]=(0,s.useState)(null),{stockHistory:H,isLoading:L,loadStockHistory:Q}=(0,ek.useStockHistory)(n),[W,V]=(0,s.useState)(()=>{try{let e=localStorage.getItem(e5);return e?JSON.parse(e):{}}catch(e){return{}}});(0,s.useEffect)(()=>{localStorage.setItem(e5,JSON.stringify(W))},[W]);let Y=(0,s.useCallback)((e,t,s=!0)=>{V(a=>{let r=a[e.id]||0;return{...a,[e.id]:Math.max(0,s?r+t:t)}})},[]),K=(0,s.useCallback)(e=>{Y(e,1,!0),N(e.id),eK.toast.success(`Tally: ${e.name}`,{duration:1e3,position:"bottom-center"}),setTimeout(()=>N(null),2e3)},[Y]);(0,s.useEffect)(()=>{if(v){let e=document.getElementById(`row-${v}`);e&&e.scrollIntoView({behavior:"smooth",block:"center"})}},[v]);let G=(0,s.useRef)(""),J=(0,s.useRef)(Date.now());(0,s.useEffect)(()=>{let e=e=>{let t=e.target,s=Date.now(),a=s-J.current;J.current=s;let r=/^[a-zA-Z0-9\-_]$/.test(e.key),l="INPUT"===t.tagName||"TEXTAREA"===t.tagName||"true"===t.contentEditable;if(!l&&r&&(e.preventDefault(),e.stopPropagation()),"Enter"===e.key){let t=G.current.trim();if(t.length>=2){e.preventDefault(),e.stopPropagation(),console.log(`[StockCount Scanner] Processing: "${t}"`);let s=async e=>{let t=await (0,$.lookupProductByBarcodeAction)(e,i?.id||"");return t?(0,eG.mapDbProductToProduct)(t):null};(async()=>{let e=await s(t);if(e){let s=e.barcode||e.itemNumber||t;console.log(`[StockCount Scanner] ✅ Server Match: ${e.name}`),console.log(`[StockCount Scanner] 🔗 Mapping "${t}" -> System Code "${s}"`),K(e)}else console.warn(`[StockCount Scanner] ❌ No server match for: "${t}"`)})(),G.current="";return}(!l||t.length>=2)&&(G.current="",e.preventDefault(),e.stopPropagation());return}1===e.key.length&&(a<60&&l&&r&&(e.preventDefault(),e.stopPropagation()),a>100?G.current=e.key:G.current+=e.key)};return window.addEventListener("keydown",e,!0),()=>window.removeEventListener("keydown",e,!0)},[n,i?.id]);let X=(0,s.useMemo)(()=>o.filter(e=>W.hasOwnProperty(e.id)).map(e=>{let t=W[e.id];return void 0===t?null:{product:e,actualStock:t,variation:Number((t-e.quantity).toFixed(2))}}).filter(e=>null!==e),[W,o,M]),Z=(0,s.useMemo)(()=>{let e=g.toLowerCase();return o.filter(t=>!g||t.name.toLowerCase().includes(e)||t.barcode&&t.barcode.toLowerCase().includes(e)||t.itemNumber&&t.itemNumber.toLowerCase().includes(e)||t.manufacturerBarcode&&t.manufacturerBarcode.toLowerCase().includes(e)).map(e=>{let t=W[e.id]??0;return{product:e,actualStock:t,variation:Number((t-e.quantity).toFixed(2))}})},[W,o,g]),ee=async e=>{let t=Object.keys(W);if(0===t.length)return;if(h)return void console.warn("⚠️ Commit already in progress, ignoring duplicate call");p(!0),k(!1);let s=M||crypto.randomUUID(),a=et.length+1,r=`AUD-${String(a).padStart(4,"0")}`,l=M?"Stock Count Edit":"Stock Count Update",i=`${r} | ${l}${P?` | Auditor: ${P}`:""}${R?` | Contact: ${R}`:""}`;console.log("🔍 Stock Count Commit Debug:",{shouldUpdateInventory:e,affectedIds:t,sessionId:s,auditId:r,finalReason:i,userId:n,updateCount:t.length});try{if(e){let e=t.map(e=>o.find(t=>t.id===e)?{id:e,updated:{quantity:W[e]}}:null).filter(e=>null!==e);if(e.length>0){if(M){let e=et.find(e=>e.id===M);if(e){let t=e.items.map(e=>e.id),s=Array.from(new Set(e.items.map(e=>e.productId)));for(let e of(await es(t),s))await ea(e)}}if(await m(e,n,i,s))eK.toast.success(`Inventory updated! ${e.length} items corrected.`);else throw Error("Bulk update failed")}}else eK.toast.success("Audit completed and cleared (Inventory not changed).");V({}),A(""),F(""),z(null),localStorage.removeItem(e5),await u(),await Q()}catch(e){console.error("Commit error:",e),eK.toast.error("An error occurred during completion.")}finally{p(!1)}},et=(0,s.useMemo)(()=>{let e=H.filter(e=>e.changeReason?.includes("Stock Count Update")||e.changeReason?.includes("Stock Count Edit")),t={};return e.forEach(e=>{let s=e.referenceId||"unknown",a=e.changeReason?.match(/AUD-\d{4}/),r=a?a[0]:void 0,l=e.changeReason?.includes("Stock Count Edit")||!1;t[s]||(t[s]={id:s,date:e.createdAt,items:[],auditId:r,isEdited:!1}),l&&(t[s].isEdited=!0),t[s].items.find(t=>t.id===e.id)||t[s].items.push(e)}),Object.values(t).sort((e,t)=>e.date.getTime()-t.date.getTime()).map((e,t)=>({...e,auditNumber:t+1})).reverse()},[H]),{deleteMultipleStockHistoryEntries:es,recalculateStockChain:ea}=(0,ek.useStockHistory)(n),er=async e=>{B(null),p(!0);try{let t=e.items.map(e=>e.id),s=Array.from(new Set(e.items.map(e=>e.productId)));if(await es(t)){for(let e of s)await ea(e);eK.toast.success("Audit deleted and stock restored!"),await u()}else eK.toast.error("Failed to delete audit.")}catch(e){console.error("Delete session error:",e),eK.toast.error("An error occurred.")}finally{p(!1)}};return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("style",{dangerouslySetInnerHTML:{__html:`
                @keyframes highlight-fade {
                    0% { background-color: rgba(59, 130, 246, 0.2); }
                    100% { background-color: transparent; }
                }
                .row-highlight {
                    animation: highlight-fade 2s ease-out forwards;
                }
            `}}),(0,t.jsxs)(w.Card,{className:"shadow-sm border-2",children:[(0,t.jsx)(w.CardHeader,{className:"pb-3 px-4 md:px-6 bg-muted/20",children:(0,t.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)(w.CardTitle,{className:"text-xl flex items-center gap-2",children:[(0,t.jsx)(eL,{className:"h-6 w-6 text-sales-primary"}),"Inventory Audit"]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:'Counts are saved locally. Click "Complete Audit" to update the system.'})]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,t.jsxs)("div",{className:"flex gap-1 mr-2 border-r pr-2",children:[(0,t.jsxs)(j.Button,{variant:"outline",size:"sm",onClick:()=>{let e="quick"===y?X:Z;0===e.length?eK.toast.error("No items to export."):eX(e)},disabled:"history"===y||"quick"===y&&0===X.length||"audit"===y&&0===Z.length,className:"h-9 gap-2",children:[(0,t.jsx)(T.Download,{className:"h-4 w-4"}),"CSV"]}),(0,t.jsxs)(j.Button,{variant:"outline",size:"sm",onClick:()=>{let e="quick"===y?X:Z;0===e.length?eK.toast.error("No items to export."):eZ(e,i?.name,{auditorName:P,contactPerson:R})},disabled:"history"===y||"quick"===y&&0===X.length||"audit"===y&&0===Z.length,className:"h-9 gap-2",children:[(0,t.jsx)(e0.FileDown,{className:"h-4 w-4"}),"PDF"]})]}),(0,t.jsxs)(j.Button,{variant:"outline",onClick:()=>{0!==Object.keys(W).length&&window.confirm("Clear all recorded counts? progress will be lost.")&&(V({}),localStorage.removeItem(e5),eK.toast.info("Progress cleared."))},disabled:h||0===Object.keys(W).length,className:"text-red-500 border-red-200 hover:bg-red-50 h-9",children:[(0,t.jsx)(ew.Trash2,{className:"h-4 w-4 mr-2"}),"Reset"]}),(0,t.jsxs)(j.Button,{onClick:()=>k(!0),disabled:h||0===Object.keys(W).length,className:"gap-2 bg-sales-primary hover:bg-sales-primary/90 shadow-md h-9 px-4",children:[(0,t.jsx)(eC.Save,{className:"h-4 w-4"}),h?"Syncing...":"Complete Audit"]})]})]})}),(0,t.jsx)(w.CardContent,{className:"p-0",children:(0,t.jsxs)(d.Tabs,{value:y,onValueChange:b,className:"w-full",children:[(0,t.jsx)("div",{className:"px-4 md:px-6 pt-4 border-b",children:(0,t.jsxs)(d.TabsList,{className:"flex w-full md:w-[450px] mb-4 overflow-x-auto",children:[(0,t.jsxs)(d.TabsTrigger,{value:"quick",className:"flex-1 gap-2 whitespace-nowrap",children:[(0,t.jsx)(eL,{className:"h-4 w-4"}),"Quick Scan"]}),(0,t.jsxs)(d.TabsTrigger,{value:"audit",className:"flex-1 gap-2 whitespace-nowrap",children:[(0,t.jsx)(eW,{className:"h-4 w-4"}),"Full List"]}),(0,t.jsxs)(d.TabsTrigger,{value:"history",className:"flex-1 gap-2 whitespace-nowrap",children:[(0,t.jsx)(eP.History,{className:"h-4 w-4"}),"Audit History"]})]})}),(0,t.jsxs)(d.TabsContent,{value:"quick",className:"m-0",children:[(0,t.jsxs)("div",{className:"p-6 text-center bg-sales-primary/5 border-b",children:[(0,t.jsx)("div",{className:"inline-flex items-center justify-center p-3 rounded-full bg-white shadow-sm mb-4",children:(0,t.jsx)(eL,{className:"h-8 w-8 text-sales-primary animate-pulse"})}),(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Scan to Start"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground max-w-xs mx-auto",children:"Just start scanning barcodes. Scanned items will appear below."})]}),(0,t.jsx)(e8,{rows:X,onUpdate:Y,onRemove:e=>{let t={...W};delete t[e],V(t)},isAuditMode:!1,lastScannedId:v})]}),(0,t.jsxs)(d.TabsContent,{value:"audit",className:"space-y-4",children:[M&&(0,t.jsxs)("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3 flex items-center gap-2 mx-4 md:mx-6 mt-4",children:[(0,t.jsx)(U.Edit,{className:"h-4 w-4 text-amber-600"}),(0,t.jsx)("span",{className:"text-sm font-medium text-amber-900",children:"Editing Mode: Only showing items from this audit session"})]}),(0,t.jsxs)("div",{className:"p-4 border-b flex items-center gap-4 bg-muted/10",children:[(0,t.jsxs)("div",{className:"relative flex-1 max-w-md",children:[(0,t.jsx)(x.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(C.Input,{placeholder:"Search name or barcode...",className:"pl-10 barcode-friendly",value:g,onChange:e=>f(e.target.value)})]}),(0,t.jsxs)("div",{className:"text-sm font-medium text-muted-foreground",children:["Showing ",Z.length," of ",o.length," items"]})]}),(0,t.jsx)(e8,{rows:Z,onUpdate:Y,isAuditMode:!0,lastScannedId:v})]}),(0,t.jsx)(d.TabsContent,{value:"history",className:"m-0 bg-slate-50/50",children:(0,t.jsx)("div",{className:"p-4 md:p-8",children:(0,t.jsx)("div",{className:"max-w-4xl mx-auto space-y-6",children:L?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-20 gap-4",children:[(0,t.jsx)("div",{className:"w-8 h-8 border-4 border-sales-primary border-t-transparent rounded-full animate-spin"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Loading history..."})]}):0===et.length?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-20 text-center space-y-3 bg-white border-2 border-dashed rounded-3xl",children:[(0,t.jsx)("div",{className:"p-4 rounded-full bg-slate-50",children:(0,t.jsx)(eP.History,{className:"h-10 w-10 text-slate-300"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:"No Audits Found"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Once you complete a stock count, it will appear here."})]})]}):(0,t.jsx)("div",{className:"space-y-4",children:et.map(e=>(0,t.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm border overflow-hidden hover:shadow-md transition-all cursor-pointer group",onClick:()=>D(I===e.id?null:e.id),children:[(0,t.jsxs)("div",{className:"p-5 flex items-center justify-between gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("div",{className:"h-12 w-12 rounded-xl bg-sales-primary/10 flex items-center justify-center",children:(0,t.jsx)(e1.Clock,{className:"h-6 w-6 text-sales-primary"})}),(0,t.jsx)("div",{className:"flex items-center justify-between",children:(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"font-bold text-gray-900 flex items-center gap-2",children:[e.auditId&&(0,t.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-mono font-bold bg-blue-100 text-blue-700 border border-blue-200",children:e.auditId}),(0,t.jsxs)("span",{children:["Audit #",e.auditNumber," — ",(0,_.format)(e.date,"PPP")]}),e.isEdited&&(0,t.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold bg-amber-100 text-amber-700 border border-amber-200",children:"Edited"})]}),(0,t.jsxs)("div",{className:"text-xs text-muted-foreground flex items-center gap-2",children:[(0,t.jsxs)("span",{className:"font-medium bg-slate-100 px-2 py-0.5 rounded-full",children:[e.items.length," Items"]}),(0,t.jsx)("span",{children:"•"}),(0,t.jsx)("span",{children:(0,_.format)(e.date,"p")})]})]})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity mr-2",children:[(0,t.jsx)(j.Button,{variant:"outline",size:"icon",className:"h-8 w-8 rounded-lg",onClick:t=>{t.stopPropagation(),eX(e.items.map(e=>({product:{...e.product,id:e.productId,quantity:e.oldQuantity},actualStock:e.newQuantity,variation:e.newQuantity-e.oldQuantity})))},title:"Export CSV",children:(0,t.jsx)(T.Download,{className:"h-4 w-4"})}),(0,t.jsx)(j.Button,{variant:"outline",size:"icon",className:"h-8 w-8 rounded-lg",onClick:t=>{let s,a,r,l;t.stopPropagation(),s=e.items.map(e=>({product:{...e.product,id:e.productId,quantity:e.oldQuantity},actualStock:e.newQuantity,variation:e.newQuantity-e.oldQuantity})),r=(a=e.items[0]?.changeReason||"").match(/Auditor: ([^|]*)/),l=a.match(/Contact: ([^|]*)/),eZ(s,i?.name,{auditNumber:e.auditNumber,auditorName:r?r[1].trim():void 0,contactPerson:l?l[1].trim():void 0,auditId:e.auditId})},title:"Export PDF",children:(0,t.jsx)(e0.FileDown,{className:"h-4 w-4"})}),(0,t.jsx)(j.Button,{variant:"outline",size:"icon",className:"h-8 w-8 rounded-lg text-amber-600 hover:bg-amber-50 hover:text-amber-700 border-amber-100",onClick:t=>{let s,a,r,l;t.stopPropagation(),s={},e.items.forEach(e=>{s[e.productId]=e.newQuantity}),r=(a=e.items[0]?.changeReason||"").match(/Auditor: ([^|]*)/),l=a.match(/Contact: ([^|]*)/),V(s),A(r?r[1].trim():""),F(l?l[1].trim():""),z(e.id),b("audit"),eK.toast.info(`Editing Audit #${e.auditNumber}`)},title:"Edit Audit",children:(0,t.jsx)(U.Edit,{className:"h-4 w-4"})}),(0,t.jsx)(j.Button,{variant:"outline",size:"icon",className:"h-8 w-8 rounded-lg text-red-500 hover:bg-red-50 hover:text-red-600 border-red-100",onClick:t=>{t.stopPropagation(),B(e)},title:"Delete & Restore Stock",children:(0,t.jsx)(ew.Trash2,{className:"h-4 w-4"})})]}),(0,t.jsx)(j.Button,{variant:"ghost",size:"icon",className:(0,O.cn)("rounded-full transition-transform",I===e.id&&"rotate-90"),children:(0,t.jsx)(e2.ChevronRight,{className:"h-5 w-5"})})]})]}),I===e.id&&(0,t.jsx)("div",{className:"border-t bg-slate-50 p-5 pt-0",children:(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)(E.Table,{children:[(0,t.jsx)(E.TableHeader,{children:(0,t.jsxs)(E.TableRow,{className:"border-b bg-transparent hover:bg-transparent px-0",children:[(0,t.jsx)(E.TableHead,{className:"h-10 px-0",children:"Product"}),(0,t.jsx)(E.TableHead,{className:"h-10 text-center",children:"System"}),(0,t.jsx)(E.TableHead,{className:"h-10 text-center",children:"Actual"}),(0,t.jsx)(E.TableHead,{className:"h-10 text-right",children:"Var"})]})}),(0,t.jsx)(E.TableBody,{children:e.items.map(e=>(0,t.jsxs)(E.TableRow,{className:"hover:bg-transparent px-0",children:[(0,t.jsxs)(E.TableCell,{className:"px-0 py-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"font-medium text-sm",children:e.product?.name||"Deleted Product"}),e.changeReason?.includes("Stock Count Edit")&&(0,t.jsx)("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-[10px] font-bold bg-amber-100 text-amber-700 border border-amber-200",children:"EDITED"})]}),e.referenceId&&"unknown"!==e.referenceId&&(0,t.jsxs)("div",{className:"text-[10px] text-muted-foreground font-mono opacity-50",children:["Session: ",e.referenceId.split("-").pop()]})]}),(0,t.jsx)(E.TableCell,{className:"text-center text-sm py-3",children:e.oldQuantity}),(0,t.jsx)(E.TableCell,{className:"text-center text-sm py-3 font-bold",children:e.newQuantity}),(0,t.jsx)(E.TableCell,{className:"text-right py-3",children:(0,t.jsxs)("span",{className:(0,O.cn)("text-xs font-bold px-2 py-0.5 rounded-full",e.newQuantity>e.oldQuantity?"text-emerald-700 bg-emerald-100":e.newQuantity<e.oldQuantity?"text-rose-700 bg-rose-100":"text-slate-600 bg-slate-100"),children:[e.newQuantity-e.oldQuantity>0?"+":"",e.newQuantity-e.oldQuantity]})})]},e.id))})]})})})]},e.id))})})})})]})})]}),(0,t.jsx)("div",{className:"fixed bottom-6 right-6 pointer-events-none active:opacity-50 transition-opacity",children:(0,t.jsxs)("div",{className:"bg-black/80 text-white px-4 py-3 rounded-2xl shadow-2xl flex items-center gap-3 backdrop-blur-md border border-white/20",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),(0,t.jsx)("span",{className:"text-xs font-bold tracking-widest uppercase",children:"Scanner Active"})]})}),(0,t.jsx)(eO.AlertDialog,{open:S,onOpenChange:k,children:(0,t.jsxs)(eO.AlertDialogContent,{className:"w-[95vw] sm:max-w-md rounded-xl",children:[(0,t.jsxs)(eO.AlertDialogHeader,{children:[(0,t.jsx)(eO.AlertDialogTitle,{children:"Complete Stock Audit"}),(0,t.jsxs)(eO.AlertDialogDescription,{className:"flex flex-col gap-2",children:[(0,t.jsxs)("span",{children:["You have recorded counts for ",Object.keys(W).length," items."]}),M?(0,t.jsxs)("span",{className:"p-2 bg-amber-50 text-amber-800 rounded border border-amber-100 text-xs flex items-center gap-2",children:[(0,t.jsx)(e4.Info,{className:"h-4 w-4 shrink-0 text-amber-500"}),"This will replace the previous records for this audit session with your new counts. All changes will be logged."]}):(0,t.jsx)("span",{children:"Fill in the details below to complete this session."})]})]}),(0,t.jsxs)("div",{className:"space-y-4 py-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-xs font-bold text-muted-foreground uppercase",children:"Name"}),(0,t.jsx)(C.Input,{placeholder:"Auditor name...",value:P,onChange:e=>A(e.target.value),className:"h-10"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-xs font-bold text-muted-foreground uppercase",children:"Phone Number"}),(0,t.jsx)(C.Input,{placeholder:"Contact number...",value:R,onChange:e=>F(e.target.value),className:"h-10",type:"tel"})]})]}),(0,t.jsxs)("div",{className:"pt-2 border-t",children:[(0,t.jsx)("label",{className:"text-xs font-bold text-muted-foreground uppercase block mb-3",children:"Action"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-3",children:[(0,t.jsxs)(j.Button,{className:"w-full justify-start h-auto py-4 px-6 flex flex-col items-start gap-1 whitespace-normal text-left",onClick:()=>ee(!0),children:[(0,t.jsxs)("span",{className:"font-bold flex items-center gap-2 w-full text-left",children:[(0,t.jsx)(eC.Save,{className:"h-4 w-4 shrink-0"}),"Update Inventory Stock"]}),(0,t.jsx)("span",{className:"text-xs font-normal opacity-80 w-full text-left",children:"This will change the quantities in your system to match what you counted."})]}),(0,t.jsxs)(j.Button,{variant:"outline",className:"w-full justify-start h-auto py-4 px-6 flex flex-col items-start gap-1 border-2 whitespace-normal text-left",onClick:()=>ee(!1),children:[(0,t.jsxs)("span",{className:"font-bold flex items-center gap-2 w-full text-left",children:[(0,t.jsx)(eW,{className:"h-4 w-4 shrink-0"}),"Finish Without Updating"]}),(0,t.jsx)("span",{className:"text-xs font-normal text-muted-foreground w-full text-left",children:"Just clear the list and finish. Use this if you already updated manually or just wanted a report."})]})]})]})]}),(0,t.jsx)(eO.AlertDialogFooter,{children:(0,t.jsx)(eO.AlertDialogCancel,{className:"w-full",children:"Cancel"})})]})}),(0,t.jsx)(eO.AlertDialog,{open:!!q,onOpenChange:e=>!e&&B(null),children:(0,t.jsxs)(eO.AlertDialogContent,{className:"w-[95vw] sm:max-w-lg",children:[(0,t.jsxs)(eO.AlertDialogHeader,{children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,t.jsx)("div",{className:"h-12 w-12 rounded-full bg-red-100 flex items-center justify-center",children:(0,t.jsx)(eY.AlertTriangle,{className:"h-6 w-6 text-red-600"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)(eO.AlertDialogTitle,{className:"text-lg",children:"Delete Audit Session?"}),q&&(0,t.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:[q.auditId||`Audit #${q.auditNumber}`," • ",(0,_.format)(q.date,"PPP")]})]})]}),(0,t.jsxs)(eO.AlertDialogDescription,{className:"space-y-3 pt-2",children:[(0,t.jsxs)("p",{className:"text-base",children:["This action will ",(0,t.jsx)("strong",{children:"permanently delete"})," this audit session and all its records."]}),(0,t.jsx)("div",{className:"p-3 bg-amber-50 border border-amber-200 rounded-lg",children:(0,t.jsx)("p",{className:"text-sm text-amber-900 font-medium",children:"⚠️ Stock levels will be recalculated as if this audit never happened."})}),q&&(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:[(0,t.jsxs)("strong",{children:[q.items.length," product entries"]})," will be removed from history."]}),(0,t.jsx)("p",{className:"text-sm font-medium text-red-600",children:"This action cannot be undone."})]})]}),(0,t.jsxs)(eO.AlertDialogFooter,{className:"gap-2 sm:gap-2",children:[(0,t.jsx)(eO.AlertDialogCancel,{className:"flex-1",children:"Cancel"}),(0,t.jsxs)(j.Button,{variant:"destructive",className:"flex-1",onClick:()=>q&&er(q),children:[(0,t.jsx)(ew.Trash2,{className:"h-4 w-4 mr-2"}),"Delete Audit"]})]})]})})]})};var e6=e.i(624687),e7=e.i(373375),e9=e.i(598130),te=e.i(390326),tt=e.i(872716),ts=e.i(656080),ta=e.i(286536),tr=e.i(122812);let tl=async(t,s)=>{let a=document.createElement("div");a.style.position="absolute",a.style.left="-9999px",a.style.width="800px",a.style.padding="40px",a.style.backgroundColor="white",a.style.fontFamily="Arial, sans-serif";let r=t.items.filter(e=>e.quantity>0),l=r.reduce((e,t)=>e+t.quantity,0),n=r.filter(e=>e.urgentItem).length;a.innerHTML=`
    <div style="text-align: center; margin-bottom: 40px;">
      <h1 style="color: #2563eb; font-size: 24px; margin: 0;">PURCHASE REQUISITION</h1>
    </div>
    
    <div style="margin-bottom: 30px;">
      <p><strong>Business:</strong> ${s}</p>
      <p><strong>Date:</strong> ${(0,_.format)(t.createdAt,"PPP")}</p>
      <p><strong>Requisition #:</strong> ${t.requisitionNumber}</p>
      <p><strong>Title:</strong> ${t.title}</p>
      <p><strong>Status:</strong> ${t.status.toUpperCase()}</p>
    </div>
    
    ${r.length>0?`
      <table style="width: 100%; border-collapse: collapse; margin-bottom: 30px;">
        <thead>
          <tr style="background-color: #2563eb; color: white;">
            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">#</th>
            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Item Description</th>
            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Quantity</th>
            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Urgent</th>
            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Supplier/Price</th>
          </tr>
        </thead>
        <tbody>
          ${r.map((e,t)=>`
            <tr style="${e.urgentItem?"background-color: #fef3c7;":""}">
              <td style="border: 1px solid #ddd; padding: 8px;">${t+1}</td>
              <td style="border: 1px solid #ddd; padding: 8px;">${e.productName}</td>
              <td style="border: 1px solid #ddd; padding: 8px;">${Math.round(e.quantity).toLocaleString()}</td>
              <td style="border: 1px solid #ddd; padding: 8px;">${e.urgentItem?"Yes":"No"}</td>
              <td style="border: 1px solid #ddd; padding: 8px;"></td>
            </tr>
          `).join("")}
        </tbody>
      </table>
      
      <div style="margin-bottom: 30px; padding: 15px; background-color: #f8fafc; border-radius: 8px;">
        <h3 style="margin: 0 0 10px 0; color: #1e40af;">SUMMARY</h3>
        <p><strong>Total Items:</strong> ${r.length}</p>
        <p><strong>Total Quantity:</strong> ${l.toLocaleString()}</p>
        <p><strong>Urgent Items:</strong> ${n}</p>
      </div>
    `:`
      <p>No items in this requisition.</p>
    `}
    
    ${t.notes?`
      <div style="margin-bottom: 30px;">
        <h3 style="color: #1e40af;">NOTES</h3>
        <p style="padding: 10px; background-color: #f1f5f9; border-radius: 4px;">${t.notes}</p>
      </div>
    `:""}
    
    <div style="margin-top: 60px;">
      <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
        <div>
          <p>Requested by: _____________________</p>
          <p>Date: _____________</p>
        </div>
        <div>
          <p>Approved by: _____________________</p>
          <p>Date: _____________</p>
        </div>
      </div>
    </div>
  `,document.body.appendChild(a);try{let{generateVectorPDF:s}=await e.A(210699);await s(a,{filename:`Requisition_${t.requisitionNumber}.pdf`,orientation:"portrait",format:"a4",margins:{top:10,right:10,bottom:10,left:10}})}finally{document.body.removeChild(a)}},tn=({requisitions:e,isLoading:a,onRefresh:r,onDelete:l,businessName:n="Your Business Name"})=>{let o=(0,i.useIsMobile)(),[c,d]=(0,s.useState)(null),{currentPage:x,setCurrentPage:h,paginatedItems:p,totalPages:g}=(0,tr.usePagination)({items:e,itemsPerPage:10}),f=e=>{switch(e){case"draft":default:return"bg-gray-100 text-gray-800";case"submitted":return"bg-blue-100 text-blue-800";case"approved":return"bg-green-100 text-green-800";case"completed":return"bg-purple-100 text-purple-800"}},y=e=>Math.round(e).toLocaleString(),b=async e=>{try{console.log("Starting PDF generation for requisition:",e.requisitionNumber),await tl(e,n),console.log("PDF generated successfully using alternative method")}catch(e){console.error("PDF generation failed:",e),console.error("Error message:",e.message),console.error("Error stack:",e.stack),alert(`Failed to generate PDF: ${e.message||"Unknown error occurred"}`)}},v=({requisition:e})=>{let s=e.items.reduce((e,t)=>e+t.quantity,0),a=e.items.filter(e=>e.urgentItem).length;return(0,t.jsxs)(w.Card,{className:"mb-4",children:[(0,t.jsx)(w.CardHeader,{className:"pb-3",children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(w.CardTitle,{className:"text-sm font-medium",children:e.title}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[e.requisitionNumber," • ",(0,_.format)(e.createdAt,"MMM d, yyyy")]})]}),(0,t.jsx)(m.Badge,{className:(0,O.cn)("text-xs",f(e.status)),children:e.status})]})}),(0,t.jsxs)(w.CardContent,{className:"pt-0",children:[(0,t.jsxs)("div",{className:"space-y-2 text-xs",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Items:"}),(0,t.jsx)("span",{children:e.items.length})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Total Qty:"}),(0,t.jsx)("span",{children:y(s)})]}),a>0&&(0,t.jsxs)("div",{className:"flex justify-between text-orange-600",children:[(0,t.jsxs)("span",{className:"flex items-center gap-1",children:[(0,t.jsx)(eY.AlertTriangle,{size:12}),"Urgent:"]}),(0,t.jsx)("span",{children:a})]})]}),(0,t.jsxs)("div",{className:"flex gap-2 mt-4",children:[(0,t.jsxs)(j.Button,{variant:"outline",size:"sm",onClick:()=>d(e),className:"flex-1",children:[(0,t.jsx)(ta.Eye,{size:14,className:"mr-1"}),"View"]}),(0,t.jsxs)(j.Button,{variant:"outline",size:"sm",onClick:()=>b(e),className:"flex-1",children:[(0,t.jsx)(T.Download,{size:14,className:"mr-1"}),"PDF"]}),(0,t.jsx)(j.Button,{variant:"outline",size:"sm",onClick:()=>l(e.id),className:"px-2",children:(0,t.jsx)(ew.Trash2,{size:14})})]})]})]})};return a?(0,t.jsx)(w.Card,{children:(0,t.jsx)(w.CardContent,{className:"p-6",children:(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),(0,t.jsx)("p",{className:"mt-2 text-muted-foreground",children:"Loading requisitions..."})]})})}):0===e.length?(0,t.jsx)(w.Card,{children:(0,t.jsx)(w.CardContent,{className:"p-6",children:(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)(u.Package,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-medium mb-2",children:"No requisitions yet"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Create your first requisition to see it appear here."})]})})}):(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)(w.Card,{children:[(0,t.jsx)(w.CardHeader,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(w.CardTitle,{children:["Saved Requisitions (",e.length,")"]}),(0,t.jsx)(j.Button,{variant:"outline",size:"sm",onClick:r,children:"Refresh"})]})}),(0,t.jsxs)(w.CardContent,{children:[o?(0,t.jsx)("div",{className:"space-y-4",children:p.map(e=>(0,t.jsx)(v,{requisition:e},e.id))}):(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)(E.Table,{children:[(0,t.jsx)(E.TableHeader,{children:(0,t.jsxs)(E.TableRow,{children:[(0,t.jsx)(E.TableHead,{children:"Title"}),(0,t.jsx)(E.TableHead,{children:"Number"}),(0,t.jsx)(E.TableHead,{children:"Date"}),(0,t.jsx)(E.TableHead,{children:"Items"}),(0,t.jsx)(E.TableHead,{children:"Total Qty"}),(0,t.jsx)(E.TableHead,{children:"Status"}),(0,t.jsx)(E.TableHead,{children:"Actions"})]})}),(0,t.jsx)(E.TableBody,{children:p.map(e=>{let s=e.items.reduce((e,t)=>e+t.quantity,0),a=e.items.filter(e=>e.urgentItem).length;return(0,t.jsxs)(E.TableRow,{children:[(0,t.jsx)(E.TableCell,{children:(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium",children:e.title}),a>0&&(0,t.jsxs)("div",{className:"flex items-center gap-1 text-orange-600 text-xs mt-1",children:[(0,t.jsx)(eY.AlertTriangle,{size:10}),a," urgent"]})]})}),(0,t.jsx)(E.TableCell,{className:"font-mono text-sm",children:e.requisitionNumber}),(0,t.jsx)(E.TableCell,{children:(0,_.format)(e.createdAt,"MMM d, yyyy")}),(0,t.jsx)(E.TableCell,{children:e.items.length}),(0,t.jsx)(E.TableCell,{children:y(s)}),(0,t.jsx)(E.TableCell,{children:(0,t.jsx)(m.Badge,{className:(0,O.cn)("text-xs",f(e.status)),children:e.status})}),(0,t.jsx)(E.TableCell,{children:(0,t.jsxs)("div",{className:"flex gap-1",children:[(0,t.jsx)(j.Button,{variant:"outline",size:"sm",onClick:()=>d(e),children:(0,t.jsx)(ta.Eye,{size:14})}),(0,t.jsx)(j.Button,{variant:"outline",size:"sm",onClick:()=>b(e),children:(0,t.jsx)(T.Download,{size:14})}),(0,t.jsx)(j.Button,{variant:"outline",size:"sm",onClick:()=>l(e.id),children:(0,t.jsx)(ew.Trash2,{size:14})})]})})]},e.id)})})]})}),g>1&&(0,t.jsx)("div",{className:"mt-4",children:(0,t.jsx)(ex.Pagination,{children:(0,t.jsxs)(ex.PaginationContent,{children:[(0,t.jsx)(ex.PaginationItem,{children:(0,t.jsx)(ex.PaginationPrevious,{onClick:()=>h(Math.max(1,x-1)),className:1===x?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:g},(e,t)=>t+1).map(e=>(0,t.jsx)(ex.PaginationItem,{children:(0,t.jsx)(ex.PaginationLink,{onClick:()=>h(e),isActive:x===e,className:"cursor-pointer",children:e})},e)),(0,t.jsx)(ex.PaginationItem,{children:(0,t.jsx)(ex.PaginationNext,{onClick:()=>h(Math.min(g,x+1)),className:x===g?"pointer-events-none opacity-50":"cursor-pointer"})})]})})})]})]}),c&&(0,t.jsxs)(w.Card,{className:"fixed inset-4 z-50 overflow-auto bg-background border shadow-lg",children:[(0,t.jsx)(w.CardHeader,{children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(w.CardTitle,{children:c.title}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:[c.requisitionNumber," • ",(0,_.format)(c.createdAt,"PPP")]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(m.Badge,{className:(0,O.cn)("text-xs",f(c.status)),children:c.status}),(0,t.jsx)(j.Button,{variant:"outline",size:"sm",onClick:()=>d(null),children:"Close"})]})]})}),(0,t.jsx)(w.CardContent,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[c.notes&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium mb-2",children:"Notes:"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:c.notes})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("h4",{className:"font-medium mb-2",children:["Items (",c.items.length,"):"]}),(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)(E.Table,{children:[(0,t.jsx)(E.TableHeader,{children:(0,t.jsxs)(E.TableRow,{children:[(0,t.jsx)(E.TableHead,{children:"Item"}),(0,t.jsx)(E.TableHead,{children:"Quantity"}),(0,t.jsx)(E.TableHead,{children:"Urgent"})]})}),(0,t.jsx)(E.TableBody,{children:c.items.map((e,s)=>(0,t.jsxs)(E.TableRow,{className:e.urgentItem?"bg-orange-50":"",children:[(0,t.jsx)(E.TableCell,{children:e.productName}),(0,t.jsx)(E.TableCell,{children:y(e.quantity)}),(0,t.jsx)(E.TableCell,{children:e.urgentItem&&(0,t.jsxs)(m.Badge,{variant:"destructive",className:"text-xs",children:[(0,t.jsx)(eY.AlertTriangle,{size:10,className:"mr-1"}),"Urgent"]})})]},s))})]})})]})]})})]})]})},ti=({row:e,index:s,onUpdateRow:a,onRemoveRow:r,onProductSelect:l,onInputFocus:n,onAddRowAfter:i,onKeyDown:o,onMoveRow:c,canRemove:d,isLastRow:u,totalRows:x})=>(0,t.jsxs)(w.Card,{className:(0,O.cn)("mb-4 shadow-sm",e.urgentItem&&"border-destructive"),children:[(0,t.jsx)(w.CardHeader,{className:"pb-3",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(w.CardTitle,{className:"text-sm font-medium",children:["Item #",s+1]}),e.urgentItem&&(0,t.jsxs)(m.Badge,{variant:"destructive",className:"text-xs",children:[(0,t.jsx)(eY.AlertTriangle,{size:10,className:"mr-1"}),"Urgent"]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(j.Button,{variant:"outline",size:"icon",onClick:()=>c(e.id,"up"),disabled:0===s,className:"h-8 w-8",children:(0,t.jsx)(eS.ChevronUp,{size:14})}),(0,t.jsx)(j.Button,{variant:"outline",size:"icon",onClick:()=>c(e.id,"down"),disabled:s===x-1,className:"h-8 w-8",children:(0,t.jsx)(eT.ChevronDown,{size:14})}),(0,t.jsx)(j.Button,{variant:"outline",size:"icon",onClick:()=>r(e.id),disabled:!d,className:"h-8 w-8",children:(0,t.jsx)(ew.Trash2,{size:14})})]})]})}),(0,t.jsxs)(w.CardContent,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("label",{className:"text-xs font-medium text-muted-foreground mb-1 block",children:"Product"}),(0,t.jsx)(C.Input,{placeholder:"Type to search products...",value:e.searchTerm,onChange:t=>a(e.id,"searchTerm",t.target.value),onFocus:()=>n(e.id),onKeyDown:t=>o(t,e.id),className:"w-full"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-xs font-medium text-muted-foreground mb-1 block",children:"Quantity"}),(0,t.jsx)(C.Input,{type:"number",min:"0",step:"1",value:e.quantity||"",onChange:t=>a(e.id,"quantity",parseInt(t.target.value)||0),onKeyDown:t=>o(t,e.id),placeholder:"0"})]}),(0,t.jsx)("div",{className:"flex items-end",children:(0,t.jsxs)("label",{className:"flex items-center gap-2 text-xs font-medium cursor-pointer",children:[(0,t.jsx)("input",{type:"checkbox",checked:e.urgentItem||!1,onChange:t=>a(e.id,"urgentItem",t.target.checked),className:"rounded"}),"Mark as urgent"]})})]}),u&&(0,t.jsx)("div",{className:"flex justify-center pt-2",children:(0,t.jsxs)(j.Button,{variant:"ghost",size:"sm",onClick:()=>i(e.id),className:"gap-2 text-muted-foreground hover:text-foreground",children:[(0,t.jsx)(eN.Plus,{size:14}),"Add row below"]})})]})]}),to=()=>{let{user:e}=(0,a.useAuth)(),{products:o}=(0,l.useProducts)(e?.id,1e4),{settings:c}=(0,p.useBusinessSettings)(),{currentBusiness:d}=(0,r.useBusiness)(),{toast:m}=(0,n.useToast)(),u=(0,i.useIsMobile)(),[x,h]=(0,s.useState)([{id:"1",productId:"",productName:"",quantity:0,searchTerm:"",urgentItem:!1}]),[g,f]=(0,s.useState)(""),[y,v]=(0,s.useState)(""),[S,k]=(0,s.useState)(null),[I,D]=(0,s.useState)(!1),P=x.find(e=>e.id===S),{suggestions:A,isOpen:R,closePanel:F}=N(o,P?.searchTerm||""),M=o.filter(e=>e.quantity<=e.minimumStock),[$,O]=(0,s.useState)(!1),[z,B]=(0,s.useState)(1),H=M.slice((z-1)*15,15*z),L=Math.ceil(M.length/15),{requisitions:Q,isLoading:U,loadRequisitions:W,createRequisition:V,deleteRequisition:Y}=((e,t)=>{let[a,r]=(0,s.useState)([]),[l,i]=(0,s.useState)(!0),{toast:o}=(0,n.useToast)(),c=async()=>{if(!e||!t){r([]),i(!1);return}try{i(!0);let s=await (0,e9.getRequisitionsAction)(e,t);if(s.success&&s.data)r(s.data.map(e=>({...e,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)})));else throw Error(s.error)}catch(e){console.error("Error loading requisitions:",e),o({title:"Error",description:"Failed to load requisitions. Please try again.",variant:"destructive"})}finally{i(!1)}};return(0,s.useEffect)(()=>{c()},[e,t]),{requisitions:a,isLoading:l,loadRequisitions:c,createRequisition:async(s,a,l)=>{if(!e||!t)return null;try{let n,i,c,d,m,u=(i=(n=new Date).getFullYear().toString().slice(-2),c=(n.getMonth()+1).toString().padStart(2,"0"),d=n.getDate().toString().padStart(2,"0"),m=n.getTime().toString().slice(-4),`REQ${i}${c}${d}${m}`),x=await (0,te.createRequisitionAction)({userId:e,locationId:t,requisitionNumber:u,title:s,items:a,notes:l||null,status:"draft"});if(!x.success||!x.data)throw Error(x.error);let h=x.data,p={...h,createdAt:new Date(h.createdAt),updatedAt:new Date(h.updatedAt)};return r(e=>[p,...e]),o({title:"Requisition created",description:`Requisition ${u} has been created successfully.`}),p}catch(e){return console.error("Error creating requisition:",e),o({title:"Error",description:"Failed to create requisition. Please try again.",variant:"destructive"}),null}},updateRequisition:async(t,s)=>{if(!e)return!1;try{let a=await (0,tt.updateRequisitionAction)(t,e,s);if(!a.success||!a.data)throw Error(a.error);let l=a.data,n={...l,createdAt:new Date(l.createdAt),updatedAt:new Date(l.updatedAt)};return r(e=>e.map(e=>e.id===t?n:e)),o({title:"Requisition updated",description:"Requisition has been updated successfully."}),!0}catch(e){return console.error("Error updating requisition:",e),o({title:"Error",description:"Failed to update requisition. Please try again.",variant:"destructive"}),!1}},deleteRequisition:async t=>{if(!e)return!1;try{let s=await (0,ts.deleteRequisitionAction)(t,e);if(!s.success)throw Error(s.error);return r(e=>e.filter(e=>e.id!==t)),o({title:"Requisition deleted",description:"Requisition has been deleted successfully."}),!0}catch(e){return console.error("Error deleting requisition:",e),o({title:"Error",description:"Failed to delete requisition. Please try again.",variant:"destructive"}),!1}}}})(e?.id,d?.id),K=e=>Math.round(e).toLocaleString(),G=x.reduce((e,t)=>{if(!t.productId||!t.quantity)return e;let s=o.find(e=>e.id===t.productId);return s?e+s.costPrice*t.quantity:e},0),J=(0,s.useCallback)(()=>{let e={id:Date.now().toString(),productId:"",productName:"",quantity:0,searchTerm:"",urgentItem:!1};h(t=>[...t,e])},[]),X=(0,s.useCallback)(e=>{let t={id:Date.now().toString(),productId:"",productName:"",quantity:0,searchTerm:"",urgentItem:!1};h(s=>{let a=s.findIndex(t=>t.id===e),r=[...s];return r.splice(a+1,0,t),r})},[]),Z=(0,s.useCallback)((e,t)=>{h(s=>{let a=s.findIndex(t=>t.id===e);if(-1===a)return s;let r="up"===t?a-1:a+1;if(r<0||r>=s.length)return s;let l=[...s];return[l[a],l[r]]=[l[r],l[a]],l})},[]),ee=(0,s.useCallback)((e,t)=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),X(t))},[X]),et=(0,s.useCallback)(e=>{x.length>1&&(h(t=>t.filter(t=>t.id!==e)),S===e&&k(null))},[x.length,S]),es=(0,s.useCallback)((e,t,s)=>{h(a=>a.map(a=>{if(a.id===e){let e={...a,[t]:s};return"searchTerm"===t&&"string"==typeof s&&(o.find(e=>e.name.toLowerCase()===s.toLowerCase())||(e.productId="",e.productName="")),e}return a}))},[o]),ea=(0,s.useCallback)(e=>{S&&(h(t=>t.map(t=>t.id===S?{...t,productId:e.id,productName:e.name,searchTerm:e.name}:t)),k(null))},[S]),er=(0,s.useCallback)(e=>{k(e)},[]),el=(0,s.useCallback)(e=>{if(x.find(t=>t.productId===e.id))return void m({title:"Item already added",description:`${e.name} is already in the requisition list.`,variant:"destructive"});let t={id:Date.now().toString(),productId:e.id,productName:e.name,quantity:Math.max(1,e.minimumStock-e.quantity),searchTerm:e.name,urgentItem:0===e.quantity};h(e=>[...e,t])},[x,m]),en=()=>{let e=new Date,t=e.getFullYear().toString().slice(-2),s=(e.getMonth()+1).toString().padStart(2,"0"),a=e.getDate().toString().padStart(2,"0"),r=e.getTime().toString().slice(-4);return`REQ${t}${s}${a}${r}`},ei=(0,s.useCallback)(()=>{let e=new q.default,t=e.internal.pageSize.width;e.setFontSize(20),e.setFont("helvetica","bold"),e.text("PURCHASE REQUISITION",t/2,20,{align:"center"}),e.setFontSize(12),e.setFont("helvetica","normal"),e.text(`Business: ${c.businessName||"Your Business Name"}`,20,40),e.text(`Date: ${(0,_.format)(new Date,"PPP")}`,20,50),e.text(`Requisition #: ${en()}`,20,60),g&&e.text(`Title: ${g}`,20,70);let s=x.filter(e=>e.productId&&e.quantity>0);if(0===s.length)e.text("No items to requisition.",20,90);else{let t=s.map((e,t)=>{let s=o.find(t=>t.id===e.productId),a=s?s.costPrice*e.quantity:0;return[t+1,e.productName,K(e.quantity),s?`${c.currency} ${K(s.costPrice)}`:"-",`${c.currency} ${K(a)}`,e.urgentItem?"Yes":"No"]});e.autoTable({head:[["#","Item Description","Qty","Unit Cost","Amount","Urgent"]],body:t,startY:g?80:70,theme:"grid",styles:{fontSize:10,cellPadding:3},headStyles:{fillColor:[41,128,185],textColor:255},columnStyles:{0:{cellWidth:15},1:{cellWidth:60},2:{cellWidth:20},3:{cellWidth:30},4:{cellWidth:30},5:{cellWidth:20}}});let a=s.reduce((e,t)=>e+t.quantity,0),r=s.filter(e=>e.urgentItem).length,l=e.lastAutoTable.finalY+20;e.setFont("helvetica","bold"),e.text("SUMMARY:",20,l),e.setFont("helvetica","normal"),e.text(`Total Items: ${s.length}`,20,l+10),e.text(`Total Quantity: ${K(a)}`,20,l+20),e.text(`Total Amount: ${c.currency} ${K(G)}`,20,l+30),e.text(`Urgent Items: ${r}`,20,l+40)}if(y){let a=s.length>0?e.lastAutoTable.finalY+70:110;a>250&&(e.addPage(),a=30),e.setFont("helvetica","bold"),e.text("NOTES:",20,a),e.setFont("helvetica","normal");let r=e.splitTextToSize(y,t-40);e.text(r,20,a+10)}let a=e.internal.pageSize.height-30;e.setFontSize(10),e.text("Requested by: _____________________",20,a),e.text("Date: _____________",120,a),e.text("Approved by: _____________________",20,a+10),e.text("Date: _____________",120,a+10);let r=`Requisition_${en()}.pdf`;return e.save(r),r},[x,g,y,c.businessName,o,c.currency,G]),eo=(0,s.useCallback)(async()=>{if(!e||!d)return;let t=x.filter(e=>e.productId&&e.quantity>0);if(0===t.length)return void m({title:"No items to save",description:"Please add at least one item with a quantity greater than 0.",variant:"destructive"});if(!g.trim())return void m({title:"Title required",description:"Please enter a title for this requisition.",variant:"destructive"});D(!0);try{let e=t.map(e=>({id:e.id,productId:e.productId,productName:e.productName,quantity:e.quantity,urgentItem:e.urgentItem||!1}));await V(g,e,y),h([{id:Date.now().toString(),productId:"",productName:"",quantity:0,searchTerm:"",urgentItem:!1}]),f(""),v("")}catch(e){console.error("Error saving requisition:",e),m({title:"Error",description:"Failed to save requisition. Please try again.",variant:"destructive"})}finally{D(!1)}},[e,d,x,g,y,m,V]),ec=(0,s.useCallback)(()=>{if(0===x.filter(e=>e.productId&&e.quantity>0).length)return void m({title:"No items to download",description:"Please add at least one item with a quantity greater than 0.",variant:"destructive"});let e=ei();m({title:"PDF downloaded",description:`Requisition has been downloaded as ${e}.`})},[x,ei,m]),ed=x.reduce((e,t)=>e+t.quantity,0);return(0,t.jsxs)("div",{className:"space-y-4 md:space-y-6",children:[M.length>0&&(0,t.jsxs)(w.Card,{className:"border-orange-200 bg-orange-50",children:[(0,t.jsx)(w.CardHeader,{className:"pb-3",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(w.CardTitle,{className:"text-orange-800 flex items-center gap-2",children:[(0,t.jsx)(eY.AlertTriangle,{size:20}),"Low Stock Items (",M.length,")"]}),!$&&M.length>15&&(0,t.jsx)(j.Button,{variant:"ghost",size:"sm",onClick:()=>O(!0),className:"text-orange-700 hover:text-orange-800",children:"View All"})]})}),(0,t.jsxs)(w.CardContent,{children:[(0,t.jsx)("p",{className:"text-sm text-orange-700 mb-3",children:"The following items are running low or out of stock. Click to add them to your requisition:"}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[($?H:M.slice(0,5)).map(e=>(0,t.jsxs)(j.Button,{variant:"outline",size:"sm",onClick:()=>el(e),className:"text-xs border-orange-300 hover:bg-orange-100",children:[e.name," (",e.quantity,"/",e.minimumStock,")"]},e.id)),!$&&M.length>5&&(0,t.jsxs)("span",{className:"text-xs text-orange-600 self-center",children:["+",M.length-5," more items"]})]}),$&&(0,t.jsxs)("div",{className:"mt-4 flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(j.Button,{variant:"outline",size:"sm",onClick:()=>B(e=>Math.max(1,e-1)),disabled:1===z,children:[(0,t.jsx)(e7.ChevronLeft,{size:14}),"Previous"]}),(0,t.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Page ",z," of ",L]}),(0,t.jsxs)(j.Button,{variant:"outline",size:"sm",onClick:()=>B(e=>Math.min(L,e+1)),disabled:z===L,children:["Next",(0,t.jsx)(e2.ChevronRight,{size:14})]})]}),(0,t.jsx)(j.Button,{variant:"ghost",size:"sm",onClick:()=>{O(!1),B(1)},className:"text-orange-700 hover:text-orange-800",children:"Show Less"})]})]})]}),(0,t.jsxs)(w.Card,{className:"shadow-sm",children:[(0,t.jsx)(w.CardHeader,{className:"pb-3 md:pb-6",children:(0,t.jsxs)("div",{className:"space-y-3 md:space-y-0 md:flex md:items-start md:justify-between",children:[(0,t.jsxs)("div",{className:"space-y-3 flex-1",children:[(0,t.jsx)(w.CardTitle,{className:"text-base md:text-lg",children:"Purchase Requisition"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium text-muted-foreground mb-1 block",children:"Requisition Title *"}),(0,t.jsx)(C.Input,{placeholder:"Enter requisition title",value:g,onChange:e=>f(e.target.value),className:"w-full"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium text-muted-foreground mb-1 block",children:"Notes"}),(0,t.jsx)(e6.Textarea,{placeholder:"Additional notes or requirements",value:y,onChange:e=>v(e.target.value),className:"w-full min-h-[60px]"})]})]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(j.Button,{onClick:J,variant:"outline",className:"gap-2 flex-1 md:flex-none",children:[(0,t.jsx)(eN.Plus,{size:16})," Add Item"]}),(0,t.jsx)(j.Button,{onClick:eo,disabled:I,variant:"secondary",className:"gap-2 flex-1 md:flex-none",children:"Save"}),(0,t.jsxs)(j.Button,{onClick:ec,className:"gap-2 flex-1 md:flex-none",children:[(0,t.jsx)(T.Download,{size:16})," PDF"]})]})]})}),(0,t.jsxs)(w.CardContent,{className:"p-0 md:p-6",children:[u?(0,t.jsxs)("div",{className:"p-4 space-y-4",children:[x.map((e,s)=>(0,t.jsx)(ti,{row:e,index:s,onUpdateRow:es,onRemoveRow:et,onProductSelect:ea,onInputFocus:er,onAddRowAfter:X,onKeyDown:ee,onMoveRow:Z,canRemove:x.length>1,isLastRow:s===x.length-1,totalRows:x.length},e.id)),(0,t.jsx)(w.Card,{className:"bg-primary/5 border-primary/20",children:(0,t.jsx)(w.CardContent,{className:"p-4",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"font-medium",children:"Total Quantity:"}),(0,t.jsx)("span",{className:"text-lg font-bold text-primary",children:K(ed)})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"font-medium",children:"Total Amount:"}),(0,t.jsxs)("span",{className:"text-lg font-bold text-primary",children:[c.currency," ",K(G)]})]})]})})})]}):(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)(E.Table,{children:[(0,t.jsx)(E.TableHeader,{children:(0,t.jsxs)(E.TableRow,{children:[(0,t.jsx)(E.TableHead,{className:"w-[250px]",children:"Item"}),(0,t.jsx)(E.TableHead,{className:"w-[80px]",children:"Qty"}),(0,t.jsx)(E.TableHead,{className:"w-[100px]",children:"Unit Cost"}),(0,t.jsx)(E.TableHead,{className:"w-[100px]",children:"Amount"}),(0,t.jsx)(E.TableHead,{className:"w-[80px]",children:"Urgent"}),(0,t.jsx)(E.TableHead,{className:"w-[140px]",children:"Actions"})]})}),(0,t.jsxs)(E.TableBody,{children:[x.map((e,s)=>{let a=o.find(t=>t.id===e.productId),r=a&&e.quantity?a.costPrice*e.quantity:0;return(0,t.jsxs)(E.TableRow,{className:e.urgentItem?"bg-destructive/5":"",children:[(0,t.jsx)(E.TableCell,{children:(0,t.jsx)("div",{className:"relative",children:(0,t.jsx)(C.Input,{placeholder:"Type to search products...",value:e.searchTerm,onChange:t=>es(e.id,"searchTerm",t.target.value),onFocus:()=>er(e.id),onKeyDown:t=>ee(t,e.id),className:"w-full"})})}),(0,t.jsx)(E.TableCell,{children:(0,t.jsx)(C.Input,{type:"number",min:"0",step:"1",value:e.quantity||"",onChange:t=>es(e.id,"quantity",parseInt(t.target.value)||0),onKeyDown:t=>ee(t,e.id),placeholder:"0"})}),(0,t.jsx)(E.TableCell,{className:"text-sm",children:a?`${c.currency} ${K(a.costPrice)}`:"-"}),(0,t.jsx)(E.TableCell,{className:"text-sm font-medium",children:r>0?`${c.currency} ${K(r)}`:"-"}),(0,t.jsx)(E.TableCell,{children:(0,t.jsx)("input",{type:"checkbox",checked:e.urgentItem||!1,onChange:t=>es(e.id,"urgentItem",t.target.checked),className:"rounded"})}),(0,t.jsx)(E.TableCell,{children:(0,t.jsxs)("div",{className:"flex gap-1",children:[(0,t.jsx)(j.Button,{variant:"outline",size:"icon",onClick:()=>Z(e.id,"up"),disabled:0===s,className:"h-8 w-8",children:(0,t.jsx)(eS.ChevronUp,{size:14})}),(0,t.jsx)(j.Button,{variant:"outline",size:"icon",onClick:()=>Z(e.id,"down"),disabled:s===x.length-1,className:"h-8 w-8",children:(0,t.jsx)(eT.ChevronDown,{size:14})}),(0,t.jsx)(j.Button,{variant:"outline",size:"icon",onClick:()=>et(e.id),disabled:1===x.length,className:"h-8 w-8",children:(0,t.jsx)(ew.Trash2,{size:14})})]})})]},e.id)}),(0,t.jsx)(E.TableRow,{className:"border-none",children:(0,t.jsx)(E.TableCell,{colSpan:6,className:"py-1 text-center",children:(0,t.jsxs)(j.Button,{variant:"ghost",size:"sm",onClick:()=>X(x[x.length-1].id),className:"gap-2 text-muted-foreground hover:text-foreground text-xs",children:[(0,t.jsx)(eN.Plus,{size:12}),"Add row below"]})})}),(0,t.jsxs)(E.TableRow,{className:"border-t-2",children:[(0,t.jsx)(E.TableCell,{className:"text-right font-medium",children:"Totals:"}),(0,t.jsx)(E.TableCell,{className:"font-bold text-lg",children:K(ed)}),(0,t.jsx)(E.TableCell,{}),(0,t.jsxs)(E.TableCell,{className:"font-bold text-lg",children:[c.currency," ",K(G)]}),(0,t.jsx)(E.TableCell,{colSpan:2})]})]})]})}),0===x.length&&(0,t.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:'No items added. Click "Add Item" to start creating your requisition.'})]})]}),(0,t.jsx)(b,{suggestions:A,isOpen:R,onClose:F,onSelectProduct:ea,searchTerm:P?.searchTerm||""}),(0,t.jsx)(tn,{requisitions:Q,isLoading:U,onRefresh:W,onDelete:Y,businessName:c.businessName})]})};var tc=e.i(338374);let td=(0,eo.default)("ListFilter",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M7 12h10",key:"b7w52i"}],["path",{d:"M10 18h4",key:"1ulq68"}]]),tm=(0,eo.default)("Truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]]),tu=(0,eo.default)("FileUp",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 12v6",key:"3ahymv"}],["path",{d:"m15 15-3-3-3 3",key:"15xj92"}]]),tx=(0,eo.default)("Scale",[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]]),th=({isLoading:e,onRefresh:s,onDownloadTemplate:a,onCSVUpload:r})=>{let l=(0,o.useNavigate)(),n=(0,i.useIsMobile)(),{hasPermission:c}=(0,Y.useProfiles)();return(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsx)("h1",{className:"text-xl md:text-2xl lg:text-3xl font-bold text-sales-dark",children:"Inventory Overview"})}),(0,t.jsx)("p",{className:"text-sm md:text-base text-muted-foreground",children:"Monitor your inventory health and analyze sales performance"})]}),n?(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex gap-2",children:[c("inventory","create")&&(0,t.jsxs)(j.Button,{onClick:()=>l("/inventory/new"),className:"flex-1 gap-2 min-h-[44px]",children:[(0,t.jsx)(eN.Plus,{size:16})," Add Product"]}),(0,t.jsx)(j.Button,{onClick:s,variant:"outline",size:"icon",disabled:e,className:"shrink-0 min-h-[44px] min-w-[44px]",children:(0,t.jsx)(ee.RefreshCw,{className:`h-4 w-4 ${e?"animate-spin":""}`})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsxs)(j.Button,{onClick:()=>l("/products"),variant:"outline",className:"gap-1 text-xs min-h-[40px]",children:[(0,t.jsx)(td,{size:14})," Products"]}),c("inventory","view")&&(0,t.jsxs)(j.Button,{onClick:()=>l("/inventory/carriage-inwards"),variant:"outline",className:"gap-1 text-xs min-h-[40px]",children:[(0,t.jsx)(tm,{size:14})," Carriage"]})]}),c("inventory","create")&&(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsxs)(j.Button,{onClick:a,variant:"outline",className:"gap-1 text-xs min-h-[40px]",children:[(0,t.jsx)(e0.FileDown,{size:14})," Template"]}),(0,t.jsxs)(j.Button,{onClick:r,variant:"outline",className:"gap-1 text-xs min-h-[40px]",children:[(0,t.jsx)(tu,{size:14})," Upload"]})]})]}):(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(j.Button,{onClick:s,variant:"outline",size:"icon",disabled:e,className:"relative",title:"Refresh data",children:[(0,t.jsx)(ee.RefreshCw,{className:`h-4 w-4 ${e?"animate-spin":""}`}),(0,t.jsx)("span",{className:"sr-only",children:"Refresh data"})]}),c("inventory","create")&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(j.Button,{onClick:a,variant:"outline",className:"gap-2",title:"Download CSV template",children:[(0,t.jsx)(e0.FileDown,{size:16})," CSV Template"]}),(0,t.jsxs)(j.Button,{onClick:r,variant:"outline",className:"gap-2",title:"Upload products via CSV",children:[(0,t.jsx)(tu,{size:16})," Upload CSV"]})]}),c("inventory","view")&&(0,t.jsxs)(j.Button,{onClick:()=>l("/inventory/carriage-inwards"),variant:"outline",className:"gap-2",children:[(0,t.jsx)(tm,{size:16})," Carriage Inwards"]}),c("inventory","stock_adjustment")&&(0,t.jsxs)(j.Button,{onClick:()=>l("/inventory/reconcile"),variant:"outline",className:"gap-2",title:"Reconcile stock discrepancies",children:[(0,t.jsx)(tx,{size:16})," Reconcile"]}),(0,t.jsxs)(j.Button,{onClick:()=>l("/products"),variant:"outline",className:"gap-2",children:[(0,t.jsx)(td,{size:16})," All Products"]}),c("inventory","create")&&(0,t.jsxs)(j.Button,{onClick:()=>l("/inventory/new"),className:"gap-2",children:[(0,t.jsx)(eN.Plus,{size:16})," Add Product"]})]})]})})},tp=({filters:e,setFilters:a,products:r,onSearchChange:l,onSearchSubmit:n,onSearchFocus:o})=>{(0,i.useIsMobile)();let[c,d]=(0,s.useState)(e.search||"");return(0,s.useEffect)(()=>{d(e.search||"")},[e.search]),(0,t.jsxs)("div",{className:"relative w-full",children:[(0,t.jsx)(x.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),(0,t.jsx)(C.Input,{placeholder:"Search products...",value:c,onChange:e=>{d(e.target.value),l&&l(e)},onKeyDown:t=>{"Enter"===t.key&&(t.preventDefault(),n?n({target:{value:c}}):a({...e,search:c}))},onBlur:()=>{c!==e.search&&(n?n({target:{value:c}}):a({...e,search:c}))},onFocus:o,className:"pl-9 w-full bg-white transition-all duration-200 focus:shadow-md"})]})};var tg=e.i(755146),tf=e.i(318585);let tj=({products:e,onExport:s,period:a="this-month"})=>{let{settings:r}=(0,p.useBusinessSettings)(),{canViewCostPrice:l,canViewProfit:n,canViewSellingPrice:i}=(0,K.useFinancialVisibility)(),c=(0,o.useNavigate)(),{currentPage:d,setCurrentPage:m,paginatedItems:u,totalPages:x}=(0,tr.usePagination)({items:e,itemsPerPage:10});return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsxs)(tg.DropdownMenu,{children:[(0,t.jsx)(tg.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(j.Button,{variant:"outline",size:"sm",className:"gap-2",children:[(0,t.jsx)(e0.FileDown,{size:16}),"Export",(0,t.jsx)(eT.ChevronDown,{size:16})]})}),(0,t.jsxs)(tg.DropdownMenuContent,{align:"end",children:[(0,t.jsx)(tg.DropdownMenuItem,{onClick:s||(()=>{let t=new Blob([["Rank,Item Description,Quantity Sold,Average Price,Total Amount,Average Cost,Total Cost,Total Profit",...e.map((e,t)=>[(t+1).toString(),e.description,e.totalQuantity.toString(),i?e.averagePrice.toFixed(2):"RESTRICTED",i?e.totalAmount.toFixed(2):"RESTRICTED",l?(e.averageCost||0).toFixed(2):"RESTRICTED",l?e.totalCost.toFixed(2):"RESTRICTED",n?e.totalProfit.toFixed(2):"RESTRICTED"]).map(e=>e.map(e=>`"${e}"`).join(","))].join("\n")],{type:"text/csv"}),s=window.URL.createObjectURL(t),r=document.createElement("a");r.href=s;let o=a.replace("-"," ").replace(/\b\w/g,e=>e.toUpperCase());r.download=`top-selling-items-${o.toLowerCase().replace(/\s+/g,"-")}-${new Date().toISOString().split("T")[0]}.csv`,r.click(),window.URL.revokeObjectURL(s)}),children:"Export as CSV"}),(0,t.jsx)(tg.DropdownMenuItem,{onClick:()=>{let t=new q.default("landscape"),s=a.replace("-"," ").replace(/\b\w/g,e=>e.toUpperCase());t.setFontSize(18),t.setFont(void 0,"bold"),t.text("Top Selling Items Report",14,22),t.setFontSize(12),t.setFont(void 0,"normal"),t.text(`Period: ${s}`,14,32),t.text(`Generated: ${new Date().toLocaleDateString()}`,14,40);let o=e.map((e,t)=>[(t+1).toString(),e.description.length>50?e.description.substring(0,47)+"...":e.description,e.totalQuantity.toString(),i?`${r.currency} ${(0,O.formatNumber)(e.averagePrice)}`:"RESTRICTED",i?`${r.currency} ${(0,O.formatNumber)(e.totalAmount)}`:"RESTRICTED",l?`${r.currency} ${(0,O.formatNumber)(e.averageCost||0)}`:"RESTRICTED",l?`${r.currency} ${(0,O.formatNumber)(e.totalCost)}`:"RESTRICTED",n?`${r.currency} ${(0,O.formatNumber)(e.totalProfit)}`:"RESTRICTED"]);(0,eJ.default)(t,{head:[["Rank","Item Description","Qty Sold","Avg Price","Total Amount","Avg Cost","Total Cost","Profit"]],body:o,startY:50,styles:{fontSize:9},headStyles:{fillColor:[66,139,202]},columnStyles:{0:{halign:"center",cellWidth:15},1:{cellWidth:80},2:{halign:"center",cellWidth:25},3:{halign:"right",cellWidth:30},4:{halign:"right",cellWidth:35},5:{halign:"right",cellWidth:30},6:{halign:"right",cellWidth:30},7:{halign:"right",cellWidth:30}}}),t.save(`top-selling-items-${s.toLowerCase().replace(/\s+/g,"-")}-${new Date().toISOString().split("T")[0]}.pdf`)},children:"Export as PDF"})]})]})}),(0,t.jsx)(X.TooltipProvider,{children:(0,t.jsx)("div",{className:"overflow-x-auto rounded-md border",children:(0,t.jsxs)(E.Table,{children:[(0,t.jsx)(E.TableHeader,{children:(0,t.jsxs)(E.TableRow,{className:"bg-muted/50",children:[(0,t.jsx)(E.TableHead,{className:"w-[60px] min-w-[60px]",children:"Rank"}),(0,t.jsx)(E.TableHead,{className:"min-w-[200px]",children:"Item Description"}),(0,t.jsx)(E.TableHead,{className:"w-[100px] min-w-[100px] text-right",children:"Qty Sold"}),i&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(E.TableHead,{className:"w-[120px] min-w-[120px] text-right",children:"Avg Price"}),(0,t.jsx)(E.TableHead,{className:"w-[120px] min-w-[120px] text-right",children:"Total Amount"})]}),l&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(E.TableHead,{className:"w-[120px] min-w-[120px] text-right",children:"Avg Cost"}),(0,t.jsx)(E.TableHead,{className:"w-[120px] min-w-[120px] text-right",children:"Total Cost"})]}),n&&(0,t.jsx)(E.TableHead,{className:"w-[120px] min-w-[120px] text-right",children:"Profit"})]})}),(0,t.jsx)(E.TableBody,{children:0===e.length?(0,t.jsx)(E.TableRow,{children:(0,t.jsx)(E.TableCell,{colSpan:8,className:"text-center py-8 text-muted-foreground",children:"No sales data for the selected period"})}):u.map((e,s)=>{let a=e.productIds&&e.productIds.length>0?e.productIds[0]:null;return(0,t.jsxs)(E.TableRow,{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>a&&c(`/inventory/${a}`),children:[(0,t.jsx)(E.TableCell,{className:"text-center",children:(0,t.jsx)("span",{className:"text-xs bg-primary/10 text-primary rounded-full w-6 h-6 inline-flex items-center justify-center font-bold",children:(d-1)*10+s+1})}),(0,t.jsx)(E.TableCell,{className:"font-medium",children:(0,t.jsxs)(X.Tooltip,{children:[(0,t.jsx)(X.TooltipTrigger,{asChild:!0,children:(0,t.jsx)("span",{className:"cursor-help",children:e.description})}),(0,t.jsx)(X.TooltipContent,{side:"top",className:"max-w-xs",children:(0,t.jsx)("p",{className:"font-bold break-words whitespace-normal",children:e.description})})]})}),(0,t.jsx)(E.TableCell,{className:"text-right font-medium text-green-600",children:e.totalQuantity%1==0?e.totalQuantity:e.totalQuantity.toFixed(2)}),i&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(E.TableCell,{className:"text-right font-medium tabular-nums",children:(0,O.formatCashCurrency)(e.averagePrice,r.currency)}),(0,t.jsx)(E.TableCell,{className:"text-right font-medium tabular-nums",children:(0,O.formatCashCurrency)(e.totalAmount,r.currency)})]}),l&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(E.TableCell,{className:"text-right font-medium tabular-nums",children:(0,O.formatCashCurrency)(e.averageCost||0,r.currency)}),(0,t.jsx)(E.TableCell,{className:"text-right font-medium tabular-nums",children:(0,O.formatCashCurrency)(e.totalCost,r.currency)})]}),n&&(0,t.jsx)(E.TableCell,{className:"text-right font-medium tabular-nums",children:(0,t.jsx)("span",{className:e.totalProfit>=0?"text-green-600":"text-red-600",children:(0,O.formatCashCurrency)(e.totalProfit,r.currency)})})]},`${e.description}-${s}`)})})]})})}),e.length>0&&(0,t.jsx)("div",{className:"mt-4",children:(0,t.jsx)(tf.default,{currentPage:d,totalPages:x,onPageChange:m})})]})},ty=({topSellingProducts:e,period:s,onPeriodChange:a})=>(0,t.jsxs)(w.Card,{className:"shadow-sm border-t-0 bg-white",children:[(0,t.jsx)(w.CardHeader,{className:"pb-3 md:pb-6",children:(0,t.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[(0,t.jsx)(w.CardTitle,{className:"text-base md:text-lg",children:"Top Selling Products"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Period:"}),(0,t.jsxs)(S.Select,{value:s,onValueChange:e=>a(e),children:[(0,t.jsx)(S.SelectTrigger,{className:"w-[180px]",children:(0,t.jsx)(S.SelectValue,{})}),(0,t.jsxs)(S.SelectContent,{children:[(0,t.jsx)(S.SelectItem,{value:"today",children:"Today"}),(0,t.jsx)(S.SelectItem,{value:"yesterday",children:"Yesterday"}),(0,t.jsx)(S.SelectItem,{value:"this-week",children:"This Week"}),(0,t.jsx)(S.SelectItem,{value:"last-week",children:"Last Week"}),(0,t.jsx)(S.SelectItem,{value:"this-month",children:"This Month"}),(0,t.jsx)(S.SelectItem,{value:"last-month",children:"Last Month"}),(0,t.jsx)(S.SelectItem,{value:"all-time",children:"All Time"})]})]})]})]})}),(0,t.jsx)(w.CardContent,{className:"p-0",children:(0,t.jsx)(tj,{products:e,period:s})})]});var tb=e.i(509694),tv=e.i(475225),tN=e.i(785183),tw=e.i(93230),tC=e.i(872526),tS=e.i(234239),tT=e.i(731195);let tk=({products:e})=>{let s=[{name:"In Stock",value:e.filter(e=>e.quantity>e.minimumStock).reduce((e,t)=>e+t.quantity,0),fill:"#4ade80"},{name:"Low Stock",value:e.filter(e=>e.quantity>0&&e.quantity<=e.minimumStock).reduce((e,t)=>e+t.quantity,0),fill:"#f87171"},{name:"Minimum Level",value:e.reduce((e,t)=>e+t.minimumStock,0),fill:"#94a3b8"}];return(0,t.jsxs)("div",{className:"w-full",children:[(0,t.jsx)("div",{className:"h-[300px] w-full",children:(0,t.jsx)(tT.ResponsiveContainer,{width:"100%",height:"100%",children:(0,t.jsxs)(tb.BarChart,{data:s,margin:{top:20,right:30,left:20,bottom:5},children:[(0,t.jsx)(tC.CartesianGrid,{strokeDasharray:"3 3"}),(0,t.jsx)(tN.XAxis,{dataKey:"name"}),(0,t.jsx)(tw.YAxis,{}),(0,t.jsx)(tS.Tooltip,{formatter:(e,t,s)=>[e,s.payload.name]}),(0,t.jsx)(tv.Bar,{dataKey:"value",fill:"#8884d8",barSize:40,children:s.map((e,s)=>(0,t.jsx)(tv.Bar,{dataKey:"value",fill:e.fill},`bar-${s}`))})]})})}),(0,t.jsxs)("div",{className:"flex justify-center mt-4 space-x-6",children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"w-3 h-3 bg-[#4ade80] rounded-full mr-2"}),(0,t.jsx)("span",{className:"text-sm",children:"In Stock"})]}),(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"w-3 h-3 bg-[#f87171] rounded-full mr-2"}),(0,t.jsx)("span",{className:"text-sm",children:"Low Stock"})]}),(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"w-3 h-3 bg-[#94a3b8] rounded-full mr-2"}),(0,t.jsx)("span",{className:"text-sm",children:"Minimum Level"})]})]})]})},tI=({products:e})=>(0,i.useIsMobile)()&&0===e.length?null:(0,t.jsxs)(w.Card,{className:"shadow-sm overflow-hidden",children:[(0,t.jsx)(w.CardHeader,{className:"pb-3 md:pb-6",children:(0,t.jsx)(w.CardTitle,{className:"text-base md:text-lg",children:"Stock Level Overview"})}),(0,t.jsx)(w.CardContent,{className:"pt-0",children:(0,t.jsx)(tk,{products:e})})]});var tD=e.i(912598);e.s(["default",0,()=>{let e,{user:m}=(0,a.useAuth)(),{currentBusiness:u,isLoading:x}=(0,r.useBusiness)(),{toast:h}=(0,n.useToast)(),p=(0,i.useIsMobile)(),{hasPermission:g}=(0,Y.useProfiles)(),f=(0,o.useNavigate)(),{products:j,isLoading:y,isFetching:v,loadProducts:w,filters:C,setFilters:S,filteredProducts:T,totalCount:k,refetch:I}=(0,l.useProducts)(m?.id),{categories:P}=(0,ev.useCategories)(m?.id),{bulkCreateProducts:A}=(0,ey.useBulkProducts)(),{sales:M}=(0,D.useSalesData)(m?.id),[$,E]=s.default.useState(!1),[O,z]=s.default.useState("this-month"),[_,q]=s.default.useState(C.search||""),{data:B,refetch:H}=useGlobalInventoryStats(u?.id),L=(0,tD.useQueryClient)();s.default.useEffect(()=>{q(C.search||"")},[C.search]);let{topSellingProducts:Q}=(e=(0,s.useMemo)(()=>{let e=new Date;switch(O){case"today":return{from:(0,et.startOfDay)(e),to:(0,es.endOfDay)(e)};case"yesterday":let t=new Date(e);return t.setDate(t.getDate()-1),{from:(0,et.startOfDay)(t),to:(0,es.endOfDay)(t)};case"this-week":return{from:(0,ea.startOfWeek)(e),to:(0,er.endOfWeek)(e)};case"last-week":let s=new Date(e);return s.setDate(s.getDate()-7),{from:(0,ea.startOfWeek)(s),to:(0,er.endOfWeek)(s)};case"this-month":return{from:(0,el.startOfMonth)(e),to:(0,en.endOfMonth)(e)};case"last-month":let a=new Date(e);return a.setMonth(a.getMonth()-1),{from:(0,el.startOfMonth)(a),to:(0,en.endOfMonth)(a)};default:return{from:new Date(0),to:e}}},[O]),{topSellingProducts:(0,s.useMemo)(()=>{try{if(!M||0===M.length)return[];let t=M.filter(t=>{try{if(!t||"Quote"===t.paymentStatus)return!1;let s=new Date(t.date);if(isNaN(s.getTime()))return!1;return s>=e.from&&s<=e.to}catch(e){return console.warn("Error filtering sale:",e),!1}}),s=new Map;return t.forEach(e=>{try{if(!e.items||!Array.isArray(e.items))return;e.items.forEach(e=>{let t=e.description,a=e.price*e.quantity,r=R(e),l=a-r,n=(e.cost||0)*e.quantity,i=r-n,o=F(e);if(s.has(t)){let a=s.get(t);a.totalQuantity+=e.quantity,a.totalAmount+=r,a.totalCost+=n,a.totalProfit+=i,a.totalDiscount+=l,a.prices.push(o),a.costs.push(e.cost||0),e.productId&&!a.productIds.includes(e.productId)&&a.productIds.push(e.productId)}else s.set(t,{totalQuantity:e.quantity,totalAmount:r,totalCost:n,totalProfit:i,totalDiscount:l,prices:[o],costs:[e.cost||0],productIds:e.productId?[e.productId]:[]})})}catch(e){console.warn("Error processing sale items:",e)}}),Array.from(s.entries()).map(([e,t])=>({description:e,totalQuantity:t.totalQuantity,averagePrice:t.prices.reduce((e,t)=>e+t,0)/t.prices.length,totalAmount:t.totalAmount,totalCost:t.totalCost,totalProfit:t.totalProfit,totalDiscount:t.totalDiscount,averageCost:t.costs.reduce((e,t)=>e+t,0)/t.costs.length,productIds:t.productIds})).sort((e,t)=>t.totalQuantity-e.totalQuantity)}catch(e){return console.error("Error calculating top selling products:",e),[]}},[M,e]),dateRange:e}),{suggestions:U,isOpen:W,openPanel:V,closePanel:K}=N(j,_),G=(0,s.useCallback)(async()=>{L.invalidateQueries({queryKey:["inventory_global_stats"]}),L.invalidateQueries({queryKey:["products"]}),await H(),await I(),h({title:"Inventory refreshed",description:"Your inventory data and stats have been updated with fresh server data."})},[I,h,H,L]),J=(0,s.useCallback)(e=>{let t=e.target.value;q(t),t.length>=1?V():K()},[V,K]),X=(0,s.useCallback)(e=>{let t=e.target.value;S({...C,search:t}),t.length>0&&V()},[C,S,V]),ee=e=>{q(e.name),f(`/inventory/${e.id}`),K()},ei=(0,s.useCallback)(()=>{_&&V()},[_,V]),eo=s.default.useCallback(()=>{(0,eb.generateProductCSVTemplate)(),h({title:"Template downloaded",description:"CSV template has been downloaded to your device."})},[h]),ec=s.default.useCallback(async e=>{try{await A(e),E(!1),await w()}catch(e){console.error("CSV upload failed:",e),h({title:"Upload failed",description:"There was an error uploading your products. Please try again.",variant:"destructive"})}},[A,w,h]);return x||!u||y?(0,t.jsx)(tc.default,{}):(0,t.jsxs)("div",{className:"p-2 md:p-6 space-y-4 md:space-y-6 max-w-full",children:[(0,t.jsx)(th,{isLoading:y,onRefresh:G,onDownloadTemplate:eo,onCSVUpload:()=>E(!0)}),(0,t.jsx)(ej.default,{open:$,onOpenChange:E,onUpload:ec,categories:P.map(e=>e.name)}),(0,t.jsx)(c.default,{products:j,totalCountOverride:k,totalCostValueOverride:B?.totalCostValue,lowStockOverride:B?.lowStockCount,outOfStockOverride:B?.outOfStockCount,totalStockValueOverride:B?.totalStockValue}),(0,t.jsxs)(d.Tabs,{defaultValue:"overview",className:"space-y-3 md:space-y-6",children:[(0,t.jsxs)(d.TabsList,{className:`grid w-full ${p?"grid-cols-4 gap-1":"grid-cols-6"} h-auto p-1`,children:[(0,t.jsx)(d.TabsTrigger,{value:"overview",className:"text-xs md:text-sm px-1 md:px-2 py-2 min-h-[44px]",children:"Overview"}),(0,t.jsx)(d.TabsTrigger,{value:"requisition",className:"text-xs md:text-sm px-1 md:px-2 py-2 min-h-[44px]",children:p?"Request":"Requisition"}),g("inventory","stock_adjustment")&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(d.TabsTrigger,{value:"add-stock",className:"text-xs md:text-sm px-1 md:px-2 py-2 min-h-[44px]",children:"Restock"}),(0,t.jsx)(d.TabsTrigger,{value:"stock-count",className:"text-xs md:text-sm px-1 md:px-2 py-2 min-h-[44px]",children:p?"Count":"Stock Count"})]}),!p&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(d.TabsTrigger,{value:"sold-items",className:"text-xs md:text-sm px-1 md:px-2 py-2 min-h-[44px]",children:"Items Sold"}),(0,t.jsx)(d.TabsTrigger,{value:"stock-summary",className:"text-xs md:text-sm px-1 md:px-2 py-2 min-h-[44px]",children:"Stock Summary"})]})]}),p&&(0,t.jsx)("div",{className:"flex gap-1 overflow-x-auto pb-2",children:(0,t.jsxs)(d.TabsList,{className:"grid grid-cols-2 gap-1 w-auto min-w-fit p-1",children:[(0,t.jsx)(d.TabsTrigger,{value:"sold-items",className:"text-xs px-2 py-2 min-h-[44px] whitespace-nowrap",children:"Items Sold"}),(0,t.jsx)(d.TabsTrigger,{value:"stock-summary",className:"text-xs px-2 py-2 min-h-[44px] whitespace-nowrap",children:"Stock Summary"})]})}),(0,t.jsxs)(d.TabsContent,{value:"overview",className:"space-y-4 md:space-y-6",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(tp,{filters:C,setFilters:S,products:j,onSearchChange:J,onSearchSubmit:X,onSearchFocus:ei}),p&&(0,t.jsx)("div",{className:"absolute top-full left-0 right-0 z-50 mt-1",children:(0,t.jsx)(b,{suggestions:U,isOpen:W,onClose:K,onSelectProduct:ee,searchTerm:_,isLoading:v})})]}),(0,t.jsx)(tI,{products:j}),(0,t.jsx)(ty,{topSellingProducts:Q,period:O,onPeriodChange:z})]}),g("inventory","stock_adjustment")&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(d.TabsContent,{value:"add-stock",children:(0,t.jsx)(eH,{})}),(0,t.jsx)(d.TabsContent,{value:"stock-count",children:(0,t.jsx)(e3,{})})]}),(0,t.jsx)(d.TabsContent,{value:"requisition",children:(0,t.jsx)(to,{})}),(0,t.jsx)(d.TabsContent,{value:"sold-items",children:(0,t.jsx)(Z,{})}),(0,t.jsx)(d.TabsContent,{value:"stock-summary",children:(0,t.jsx)(ef,{})})]}),!p&&(0,t.jsx)(b,{suggestions:U,isOpen:W,onClose:K,onSelectProduct:ee,searchTerm:_,isLoading:v})]})}],862587)}]);