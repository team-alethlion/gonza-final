(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,388474,e=>{"use strict";var s=e.i(271645),a=e.i(820783),r=e.i(30030),t=e.i(981140),i=e.i(369340),l=e.i(999682),n=e.i(635804),o=e.i(296626),c=e.i(248425),d=e.i(843476),m="Checkbox",[u,h]=(0,r.createContextScope)(m),[x,p]=u(m);function f(e){let{__scopeCheckbox:a,checked:r,children:t,defaultChecked:l,disabled:n,form:o,name:c,onCheckedChange:u,required:h,value:p="on",internal_do_not_use_render:f}=e,[j,g]=(0,i.useControllableState)({prop:r,defaultProp:l??!1,onChange:u,caller:m}),[v,b]=s.useState(null),[y,N]=s.useState(null),w=s.useRef(!1),k=!v||!!o||!!v.closest("form"),_={checked:j,disabled:n,setChecked:g,control:v,setControl:b,name:c,form:o,value:p,hasConsumerStoppedPropagationRef:w,required:h,defaultChecked:!C(l)&&l,isFormControl:k,bubbleInput:y,setBubbleInput:N};return(0,d.jsx)(x,{scope:a,..._,children:"function"==typeof f?f(_):t})}var j="CheckboxTrigger",g=s.forwardRef(({__scopeCheckbox:e,onKeyDown:r,onClick:i,...l},n)=>{let{control:o,value:m,disabled:u,checked:h,required:x,setControl:f,setChecked:g,hasConsumerStoppedPropagationRef:v,isFormControl:b,bubbleInput:y}=p(j,e),N=(0,a.useComposedRefs)(n,f),w=s.useRef(h);return s.useEffect(()=>{let e=o?.form;if(e){let s=()=>g(w.current);return e.addEventListener("reset",s),()=>e.removeEventListener("reset",s)}},[o,g]),(0,d.jsx)(c.Primitive.button,{type:"button",role:"checkbox","aria-checked":C(h)?"mixed":h,"aria-required":x,"data-state":k(h),"data-disabled":u?"":void 0,disabled:u,value:m,...l,ref:N,onKeyDown:(0,t.composeEventHandlers)(r,e=>{"Enter"===e.key&&e.preventDefault()}),onClick:(0,t.composeEventHandlers)(i,e=>{g(e=>!!C(e)||!e),y&&b&&(v.current=e.isPropagationStopped(),v.current||e.stopPropagation())})})});g.displayName=j;var v=s.forwardRef((e,s)=>{let{__scopeCheckbox:a,name:r,checked:t,defaultChecked:i,required:l,disabled:n,value:o,onCheckedChange:c,form:m,...u}=e;return(0,d.jsx)(f,{__scopeCheckbox:a,checked:t,defaultChecked:i,disabled:n,required:l,onCheckedChange:c,name:r,form:m,value:o,internal_do_not_use_render:({isFormControl:e})=>(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(g,{...u,ref:s,__scopeCheckbox:a}),e&&(0,d.jsx)(w,{__scopeCheckbox:a})]})})});v.displayName=m;var b="CheckboxIndicator",y=s.forwardRef((e,s)=>{let{__scopeCheckbox:a,forceMount:r,...t}=e,i=p(b,a);return(0,d.jsx)(o.Presence,{present:r||C(i.checked)||!0===i.checked,children:(0,d.jsx)(c.Primitive.span,{"data-state":k(i.checked),"data-disabled":i.disabled?"":void 0,...t,ref:s,style:{pointerEvents:"none",...e.style}})})});y.displayName=b;var N="CheckboxBubbleInput",w=s.forwardRef(({__scopeCheckbox:e,...r},t)=>{let{control:i,hasConsumerStoppedPropagationRef:o,checked:m,defaultChecked:u,required:h,disabled:x,name:f,value:j,form:g,bubbleInput:v,setBubbleInput:b}=p(N,e),y=(0,a.useComposedRefs)(t,b),w=(0,l.usePrevious)(m),k=(0,n.useSize)(i);s.useEffect(()=>{if(!v)return;let e=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set,s=!o.current;if(w!==m&&e){let a=new Event("click",{bubbles:s});v.indeterminate=C(m),e.call(v,!C(m)&&m),v.dispatchEvent(a)}},[v,w,m,o]);let _=s.useRef(!C(m)&&m);return(0,d.jsx)(c.Primitive.input,{type:"checkbox","aria-hidden":!0,defaultChecked:u??_.current,required:h,disabled:x,name:f,value:j,form:g,...r,tabIndex:-1,ref:y,style:{...r.style,...k,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});function C(e){return"indeterminate"===e}function k(e){return C(e)?"indeterminate":e?"checked":"unchecked"}w.displayName=N,e.s(["Checkbox",()=>v,"CheckboxIndicator",()=>y,"Indicator",()=>y,"Root",()=>v,"createCheckboxScope",()=>h,"unstable_BubbleInput",()=>w,"unstable_CheckboxBubbleInput",()=>w,"unstable_CheckboxProvider",()=>f,"unstable_CheckboxTrigger",()=>g,"unstable_Provider",()=>f,"unstable_Trigger",()=>g])},257428,e=>{"use strict";var s=e.i(843476),a=e.i(271645),r=e.i(388474),t=e.i(643531),i=e.i(975157);let l=a.forwardRef(({className:e,...a},l)=>(0,s.jsx)(r.Root,{ref:l,className:(0,i.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...a,children:(0,s.jsx)(r.Indicator,{className:(0,i.cn)("flex items-center justify-center text-current"),children:(0,s.jsx)(t.Check,{className:"h-4 w-4"})})}));l.displayName=r.Root.displayName,e.s(["Checkbox",()=>l])},761911,e=>{"use strict";let s=(0,e.i(475254).default)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);e.s(["Users",()=>s],761911)},302747,e=>{"use strict";var s=e.i(843476),a=e.i(975157);function r({className:e,...r}){return(0,s.jsx)("div",{className:(0,a.cn)("animate-pulse rounded-md bg-muted",e),...r})}e.s(["Skeleton",()=>r])},263488,e=>{"use strict";let s=(0,e.i(475254).default)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);e.s(["Mail",()=>s],263488)},343432,e=>{"use strict";let s=(0,e.i(475254).default)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);e.s(["Phone",()=>s],343432)},541071,e=>{"use strict";let s=(0,e.i(475254).default)("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);e.s(["MoreHorizontal",()=>s],541071)},270756,e=>{"use strict";let s=(0,e.i(475254).default)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);e.s(["Lock",()=>s],270756)},581418,e=>{"use strict";let s=(0,e.i(475254).default)("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);e.s(["ShieldCheck",()=>s],581418)},98919,e=>{"use strict";let s=(0,e.i(475254).default)("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);e.s(["Shield",()=>s],98919)},592930,e=>{"use strict";let s=(0,e.i(475254).default)("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);e.s(["Edit2",()=>s],592930)},882293,e=>{"use strict";let s=(0,e.i(475254).default)("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);e.s(["UserCheck",()=>s],882293)},540975,e=>{"use strict";var s=e.i(843476),a=e.i(271645),r=e.i(515288),t=e.i(519455),i=e.i(487486),l=e.i(755146),n=e.i(777624),o=e.i(541071),c=e.i(263488),d=e.i(343432),m=e.i(688511),u=e.i(727612),h=e.i(882293);let x=(0,e.i(475254).default)("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]),p=({profile:e,onEdit:a,onDelete:p,canManage:f=!0})=>{let{toggleProfileStatus:j,currentProfile:g}=(0,n.useProfiles)(),v=async()=>{f&&await j(e.id,!e.is_active)},b=g?.id===e.id;return(0,s.jsxs)(r.Card,{className:`relative ${!e.is_active?"opacity-60":""}`,children:[(0,s.jsxs)(r.CardHeader,{className:"flex flex-row items-start justify-between space-y-0 pb-3",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h3",{className:"font-semibold text-lg",children:e.profile_name}),(0,s.jsx)(i.Badge,{variant:(e=>{switch(e.toLowerCase()){case"owner":return"default";case"manager":return"secondary";default:return"outline"}})(e.role),className:"mt-1",children:e.role}),b&&(0,s.jsx)(i.Badge,{variant:"outline",className:"ml-2 text-[10px] bg-blue-50 text-blue-600 border-blue-100",children:"You"})]}),f&&(0,s.jsxs)(l.DropdownMenu,{children:[(0,s.jsx)(l.DropdownMenuTrigger,{asChild:!0,children:(0,s.jsx)(t.Button,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:(0,s.jsx)(o.MoreHorizontal,{className:"h-4 w-4"})})}),(0,s.jsxs)(l.DropdownMenuContent,{align:"end",children:[(0,s.jsxs)(l.DropdownMenuItem,{onClick:a,children:[(0,s.jsx)(m.Edit,{className:"h-4 w-4 mr-2"}),"Edit Profile"]}),(0,s.jsx)(l.DropdownMenuItem,{onClick:v,children:e.is_active?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x,{className:"h-4 w-4 mr-2"}),"Deactivate"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(h.UserCheck,{className:"h-4 w-4 mr-2"}),"Activate"]})}),(0,s.jsxs)(l.DropdownMenuItem,{onClick:p,className:"text-destructive focus:text-destructive",children:[(0,s.jsx)(u.Trash2,{className:"h-4 w-4 mr-2"}),"Delete Profile"]})]})]})]}),(0,s.jsxs)(r.CardContent,{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)(c.Mail,{className:"h-4 w-4 text-muted-foreground"}),(0,s.jsx)("span",{className:"text-muted-foreground",children:e.email})]}),e.phone_number&&(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)(d.Phone,{className:"h-4 w-4 text-muted-foreground"}),(0,s.jsx)("span",{className:"text-muted-foreground",children:e.phone_number})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between text-xs text-muted-foreground pt-2 border-t",children:[(0,s.jsxs)("span",{children:["Created ",new Date(e.created_at).toLocaleDateString()]}),(0,s.jsx)(i.Badge,{variant:e.is_active?"default":"secondary",className:"text-xs",children:e.is_active?"Active":"Inactive"})]})]})]})},f=({profiles:e,onEditProfile:a,onDeleteProfile:r,canManage:t=!0})=>(0,s.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:e.map(e=>(0,s.jsx)(p,{profile:e,onEdit:()=>a(e),onDelete:()=>r(e),canManage:t},e.id))});var j=e.i(302747);let g=()=>(0,s.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:Array.from({length:6}).map((e,a)=>(0,s.jsxs)(r.Card,{children:[(0,s.jsxs)(r.CardHeader,{className:"flex flex-row items-start justify-between space-y-0 pb-3",children:[(0,s.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,s.jsx)(j.Skeleton,{className:"h-5 w-32"}),(0,s.jsx)(j.Skeleton,{className:"h-4 w-16"})]}),(0,s.jsx)(j.Skeleton,{className:"h-8 w-8"})]}),(0,s.jsxs)(r.CardContent,{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(j.Skeleton,{className:"h-4 w-4"}),(0,s.jsx)(j.Skeleton,{className:"h-4 w-40"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(j.Skeleton,{className:"h-4 w-4"}),(0,s.jsx)(j.Skeleton,{className:"h-4 w-32"})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between pt-2 border-t",children:[(0,s.jsx)(j.Skeleton,{className:"h-3 w-24"}),(0,s.jsx)(j.Skeleton,{className:"h-4 w-12"})]})]})]},a))});var v=e.i(761911);let b=()=>(0,s.jsx)(r.Card,{children:(0,s.jsxs)(r.CardContent,{className:"flex flex-col items-center justify-center py-12",children:[(0,s.jsx)(v.Users,{className:"h-12 w-12 text-muted-foreground mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"No Profiles Yet"}),(0,s.jsx)("p",{className:"text-muted-foreground text-center max-w-md",children:"Create profiles for individuals using your business account. Each profile can track their activities separately."})]})}),y=({profiles:e,isLoading:a,onEditProfile:r,onDeleteProfile:t,canManage:i=!0})=>a?(0,s.jsx)(g,{}):0===e.length?(0,s.jsx)(b,{}):(0,s.jsx)(f,{profiles:e,onEditProfile:r,onDeleteProfile:t,canManage:i});var N=e.i(107233);let w=({profilesCount:e,onNewProfile:a,canManage:r=!0})=>(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h1",{className:"text-3xl font-bold text-foreground flex items-center gap-2",children:[(0,s.jsx)(v.Users,{className:"h-8 w-8"}),"Profiles"]}),(0,s.jsxs)("p",{className:"text-muted-foreground",children:["Manage individual user profiles for your business â€¢ ",e," profile",1!==e?"s":""]})]}),r&&(0,s.jsxs)(t.Button,{onClick:a,className:"gap-2",children:[(0,s.jsx)(N.Plus,{className:"h-4 w-4"}),"New Profile"]})]});var C=e.i(776639),k=e.i(793479),_=e.i(110204),P=e.i(967489),S=e.i(422713),I=e.i(95187);let D=(0,I.createServerReference)("4052909717fb7c5829a34f18b1cedd1784304b0419",I.callServer,void 0,I.findSourceMapURL,"getRolesAction"),E=({open:e,onOpenChange:r})=>{let{currentBusiness:i}=(0,S.useBusiness)(),{createProfile:l,profiles:o}=(0,n.useProfiles)(),[c,d]=(0,a.useState)({profile_name:"",email:"",phone_number:"",role:"staff",role_id:""}),[m,u]=(0,a.useState)([]),[h,x]=(0,a.useState)(!1);a.default.useEffect(()=>{e&&i?.id&&p()},[e,i?.id]);let p=async()=>{try{if(i?.id){let e=await D(i.id);u(e)}}catch(e){console.error(e)}0===o.length&&d(e=>({...e,role:"owner",role_id:null}))},f=async e=>{e.preventDefault(),x(!0);try{await l({profile_name:c.profile_name.trim(),email:c.email.trim(),phone_number:c.phone_number.trim()||void 0,role:c.role,role_id:c.role_id||null,pin:"0000",is_active:!0})&&(d({profile_name:"",email:"",phone_number:"",role:"staff",role_id:null}),r(!1))}finally{x(!1)}},j=(e,s)=>{d(a=>({...a,[e]:s}))};return(0,s.jsx)(C.Dialog,{open:e,onOpenChange:r,children:(0,s.jsxs)(C.DialogContent,{className:"sm:max-w-md",children:[(0,s.jsx)(C.DialogHeader,{children:(0,s.jsx)(C.DialogTitle,{children:"Create New Profile"})}),(0,s.jsxs)("form",{onSubmit:f,className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(_.Label,{htmlFor:"profile_name",children:"Profile Name"}),(0,s.jsx)(k.Input,{id:"profile_name",value:c.profile_name,onChange:e=>j("profile_name",e.target.value),placeholder:"Enter profile name",required:!0})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(_.Label,{htmlFor:"email",children:"Email"}),(0,s.jsx)(k.Input,{id:"email",type:"email",value:c.email,onChange:e=>j("email",e.target.value),placeholder:"Enter email address",required:!0})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(_.Label,{htmlFor:"phone_number",children:"Phone Number (Optional)"}),(0,s.jsx)(k.Input,{id:"phone_number",value:c.phone_number,onChange:e=>j("phone_number",e.target.value),placeholder:"Enter phone number"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(_.Label,{htmlFor:"role",children:"Role"}),(0,s.jsxs)(P.Select,{value:c.role_id||c.role,onValueChange:e=>{let s=m.find(s=>s.id===e);s?d(a=>({...a,role_id:e,role:s.name})):d(s=>({...s,role_id:null,role:e}))},disabled:0===o.length,children:[(0,s.jsx)(P.SelectTrigger,{children:(0,s.jsx)(P.SelectValue,{placeholder:"Select role"})}),(0,s.jsx)(P.SelectContent,{children:m.length>0?m.map(e=>(0,s.jsx)(P.SelectItem,{value:e.id,children:e.name},e.id)):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(P.SelectItem,{value:"owner",children:"Owner"}),(0,s.jsx)(P.SelectItem,{value:"manager",children:"Manager"}),(0,s.jsx)(P.SelectItem,{value:"staff",children:"Staff"})]})})]}),0===o.length&&(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"First profile must be the Owner."})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-2 pt-4",children:[(0,s.jsx)(t.Button,{type:"button",variant:"outline",onClick:()=>r(!1),disabled:h,children:"Cancel"}),(0,s.jsx)(t.Button,{type:"submit",disabled:h,children:h?"Creating...":"Create Profile"})]})]})]})})};var L=e.i(270756),R=e.i(846696);let M=({profile:e,open:r,onOpenChange:i})=>{let{currentBusiness:l}=(0,S.useBusiness)(),{updateProfile:o,resetProfilePin:c}=(0,n.useProfiles)(),[d,m]=(0,a.useState)({profile_name:"",email:"",phone_number:"",role:"staff",role_id:""}),[u,h]=(0,a.useState)([]),[x,p]=(0,a.useState)(!1),[f,j]=(0,a.useState)(!1),[g,v]=(0,a.useState)("");(0,a.useEffect)(()=>{r&&l?.id&&b()},[r,l?.id]);let b=async()=>{try{if(l?.id){let e=await D(l.id);h(e)}}catch(e){console.error(e)}};(0,a.useEffect)(()=>{e&&m({profile_name:e.profile_name,email:e.email,phone_number:e.phone_number||"",role:e.role,role_id:e.role_id})},[e]);let y=async s=>{if(s.preventDefault(),e){p(!0);try{await o(e.id,{profile_name:d.profile_name.trim(),email:d.email.trim(),phone_number:d.phone_number.trim()||void 0,role:d.role,role_id:d.role_id||null})&&i(!1)}finally{p(!1)}}},N=async()=>{if(e&&g){if(4!==g.length||!/^\d+$/.test(g))return void R.toast.error("PIN must be 4 digits");p(!0);try{await c(e.id,g)&&(j(!1),v(""))}finally{p(!1)}}},w=(e,s)=>{m(a=>({...a,[e]:s}))};return e?(0,s.jsx)(C.Dialog,{open:r,onOpenChange:i,children:(0,s.jsxs)(C.DialogContent,{className:"sm:max-w-md",children:[(0,s.jsx)(C.DialogHeader,{children:(0,s.jsx)(C.DialogTitle,{children:"Edit Profile"})}),(0,s.jsxs)("form",{onSubmit:y,className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(_.Label,{htmlFor:"edit_profile_name",children:"Profile Name"}),(0,s.jsx)(k.Input,{id:"edit_profile_name",value:d.profile_name,onChange:e=>w("profile_name",e.target.value),placeholder:"Enter profile name",required:!0})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(_.Label,{htmlFor:"edit_email",children:"Email"}),(0,s.jsx)(k.Input,{id:"edit_email",type:"email",value:d.email,onChange:e=>w("email",e.target.value),placeholder:"Enter email address",required:!0})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(_.Label,{htmlFor:"edit_phone_number",children:"Phone Number (Optional)"}),(0,s.jsx)(k.Input,{id:"edit_phone_number",value:d.phone_number,onChange:e=>w("phone_number",e.target.value),placeholder:"Enter phone number"})]}),"owner"!==e.role.toLowerCase()&&e.business_role?.name!=="Owner"&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(_.Label,{htmlFor:"edit_role",children:"Role"}),(0,s.jsxs)(P.Select,{value:d.role_id||d.role,onValueChange:e=>{let s=u.find(s=>s.id===e);s?m(a=>({...a,role_id:e,role:s.name})):m(s=>({...s,role_id:null,role:e}))},children:[(0,s.jsx)(P.SelectTrigger,{children:(0,s.jsx)(P.SelectValue,{placeholder:"Select role"})}),(0,s.jsx)(P.SelectContent,{children:u.length>0?u.map(e=>(0,s.jsx)(P.SelectItem,{value:e.id,children:e.name},e.id)):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(P.SelectItem,{value:"owner",children:"Owner"}),(0,s.jsx)(P.SelectItem,{value:"manager",children:"Manager"}),(0,s.jsx)(P.SelectItem,{value:"staff",children:"Staff"})]})})]})]}),(0,s.jsx)("div",{className:"border-t pt-4 mt-4",children:f?(0,s.jsxs)("div",{className:"space-y-3 p-3 bg-amber-50 rounded-lg border border-amber-100",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)(_.Label,{htmlFor:"new_pin",children:"New 4-Digit PIN"}),(0,s.jsx)(k.Input,{id:"new_pin",type:"password",inputMode:"numeric",pattern:"[0-9]*",maxLength:4,value:g,onChange:e=>v(e.target.value),placeholder:"Enter new PIN"})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(t.Button,{type:"button",variant:"ghost",className:"flex-1",onClick:()=>{j(!1),v("")},children:"Cancel"}),(0,s.jsx)(t.Button,{type:"button",variant:"default",className:"flex-1 bg-amber-600 hover:bg-amber-700",onClick:N,disabled:x||4!==g.length,children:"Confirm Reset"})]})]}):(0,s.jsxs)(t.Button,{type:"button",variant:"outline",className:"w-full gap-2 text-amber-600 border-amber-200 hover:bg-amber-50",onClick:()=>j(!0),children:[(0,s.jsx)(L.Lock,{size:16})," Reset Profile PIN"]})}),(0,s.jsxs)("div",{className:"flex justify-end gap-2 pt-4",children:[(0,s.jsx)(t.Button,{type:"button",variant:"outline",onClick:()=>i(!1),disabled:x,children:"Cancel"}),(0,s.jsx)(t.Button,{type:"submit",disabled:x,children:x?"Updating...":"Update Profile"})]})]})]})}):null};var T=e.i(868499);let B=({profile:e,open:r,onOpenChange:t})=>{let{deleteProfile:i}=(0,n.useProfiles)(),[l,o]=(0,a.useState)(!1),c=async()=>{if(e){o(!0);try{await i(e.id)&&t(!1)}finally{o(!1)}}};return e?(0,s.jsx)(T.AlertDialog,{open:r,onOpenChange:t,children:(0,s.jsxs)(T.AlertDialogContent,{children:[(0,s.jsxs)(T.AlertDialogHeader,{children:[(0,s.jsx)(T.AlertDialogTitle,{children:"Delete Profile"}),(0,s.jsxs)(T.AlertDialogDescription,{children:['Are you sure you want to delete the profile "',e.profile_name,'"? This action cannot be undone. All activity history associated with this profile will remain but will no longer be linked to a profile.']})]}),(0,s.jsxs)(T.AlertDialogFooter,{children:[(0,s.jsx)(T.AlertDialogCancel,{disabled:l,children:"Cancel"}),(0,s.jsx)(T.AlertDialogAction,{onClick:c,disabled:l,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:l?"Deleting...":"Delete Profile"})]})]})}):null};var F=e.i(677572);let A=(0,I.createServerReference)("60fb2389f1a7f9190d01c7bd2da1f5e38add1594cd",I.callServer,void 0,I.findSourceMapURL,"upsertRoleAction"),O=(0,I.createServerReference)("4051b0115f438ba3dd6196d0c8dbb545e2e4fbd8c4",I.callServer,void 0,I.findSourceMapURL,"deleteRoleAction");var U=e.i(257428),z=e.i(98919),H=e.i(592930),q=e.i(643531),V=e.i(37727);let $=[{id:"sales",name:"Sales",actions:["view","create","edit","delete","refund"]},{id:"inventory",name:"Inventory",actions:["view","create","edit","delete","stock_adjustment","view_cost_price","view_profit","view_selling_price"]},{id:"finance",name:"Finance",actions:["view","create","edit","manage_accounts"]},{id:"customers",name:"Customers",actions:["view","create","edit","delete","manage"]},{id:"messages",name:"Messages",actions:["view","create","edit","delete","send"]},{id:"tasks",name:"Tasks",actions:["view","create","edit","delete","manage"]},{id:"profiles",name:"Profiles",actions:["view","manage"]},{id:"settings",name:"Settings",actions:["view","manage"]},{id:"expenses",name:"Expenses",actions:["view","create","edit","delete"]},{id:"dashboard",name:"Dashboard",actions:["view","view_total_sales","view_gross_profit","view_total_expenses","view_inventory_value","view_sales_types","view_avg_price","view_total_amount"]}],Y=()=>{let{currentBusiness:e}=(0,S.useBusiness)(),{hasPermission:i,loadProfiles:l}=(0,n.useProfiles)(),[o,c]=(0,a.useState)([]),[d,m]=(0,a.useState)(!0),[h,x]=(0,a.useState)(null);(0,a.useEffect)(()=>{p()},[e?.id]);let p=async()=>{if(e?.id){m(!0);try{let s=await D(e.id);c(s)}catch(e){console.error("Error loading roles:",e),R.toast.error("Failed to load roles")}finally{m(!1)}}},f=async()=>{if(e?.id&&h?.name)try{let s={id:h.id,business_location_id:e.id,name:h.name,description:h.description||null,permissions:h.permissions||{}},a=await A(e.id,s);if(!a.success)throw Error(a.error);R.toast.success(h.id?"Role updated":"Role created"),x(null),await p(),await l()}catch(e){console.error("Error saving role:",e),R.toast.error("Failed to save role")}},j=async e=>{if(confirm("Are you sure you want to delete this role? Profiles assigned to this role will lose their special permissions."))try{let s=await O(e);if(!s.success)throw Error(s.error);R.toast.success("Role deleted"),await p(),await l()}catch(e){console.error("Error deleting role:",e),R.toast.error("Failed to delete role")}};return i("profiles","manage")?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-medium",children:"Roles & Permissions"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Manage roles and what each profile can access."})]}),!h&&(0,s.jsxs)(t.Button,{onClick:()=>x({name:"",permissions:{}}),className:"gap-2",children:[(0,s.jsx)(N.Plus,{className:"h-4 w-4"}),"New Role"]})]}),h?(0,s.jsxs)(r.Card,{className:"border-primary/20",children:[(0,s.jsxs)(r.CardHeader,{children:[(0,s.jsx)(r.CardTitle,{children:h.id?"Edit Role":"Create New Role"}),(0,s.jsx)(r.CardDescription,{children:"Define the name and permissions for this role."})]}),(0,s.jsxs)(r.CardContent,{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(_.Label,{htmlFor:"role-name",children:"Role Name"}),(0,s.jsx)(k.Input,{id:"role-name",value:h.name,onChange:e=>x({...h,name:e.target.value}),placeholder:"e.g. Sales Associate"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(_.Label,{htmlFor:"role-desc",children:"Description"}),(0,s.jsx)(k.Input,{id:"role-desc",value:h.description||"",onChange:e=>x({...h,description:e.target.value}),placeholder:"Brief description of the role's purpose"})]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)(_.Label,{children:"Permissions"}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 border rounded-lg p-4 bg-muted/30",children:$.map(e=>(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"font-semibold text-sm flex items-center gap-2 border-b pb-1",children:[(0,s.jsx)(z.Shield,{className:"h-3 w-3 text-primary"}),e.name]}),(0,s.jsx)("div",{className:"grid grid-cols-1 gap-2",children:e.actions.map(a=>(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(U.Checkbox,{id:`${e.id}-${a}`,checked:(h.permissions?.[e.id]||[]).includes(a),onCheckedChange:()=>((e,s)=>{if(!h)return;let a={...h.permissions||{}},r=[...a[e]||[]];r.includes(s)?a[e]=r.filter(e=>e!==s):a[e]=[...r,s],x({...h,permissions:a})})(e.id,a)}),(0,s.jsx)(_.Label,{htmlFor:`${e.id}-${a}`,className:"text-xs capitalize font-normal cursor-pointer",children:a.replace("_"," ")})]},a))})]},e.id))})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-2 pt-2",children:[(0,s.jsxs)(t.Button,{variant:"outline",onClick:()=>x(null),className:"gap-2",children:[(0,s.jsx)(V.X,{className:"h-4 w-4"})," Cancel"]}),(0,s.jsxs)(t.Button,{onClick:f,className:"gap-2",children:[(0,s.jsx)(q.Check,{className:"h-4 w-4"})," ",h.id?"Update Role":"Create Role"]})]})]})]}):(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:d?(0,s.jsx)("p",{children:"Loading roles..."}):0===o.length?(0,s.jsx)("p",{className:"text-muted-foreground col-span-full text-center py-8",children:"No custom roles created yet."}):o.map(e=>(0,s.jsxs)(r.Card,{className:"group hover:border-primary/50 transition-colors",children:[(0,s.jsxs)(r.CardHeader,{className:"pb-2",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsx)(r.CardTitle,{className:"text-lg",children:e.name}),(0,s.jsxs)("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,s.jsx)(t.Button,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>x(e),children:(0,s.jsx)(H.Edit2,{className:"h-4 w-4"})}),(0,s.jsx)(t.Button,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive",onClick:()=>j(e.id),children:(0,s.jsx)(u.Trash2,{className:"h-4 w-4"})})]})]}),(0,s.jsx)(r.CardDescription,{className:"line-clamp-1",children:e.description||"No description"})]}),(0,s.jsx)(r.CardContent,{children:(0,s.jsxs)("div",{className:"flex flex-wrap gap-1 mt-2",children:[Object.keys(e.permissions).slice(0,4).map(e=>(0,s.jsx)("span",{className:"text-[10px] bg-primary/10 text-primary px-2 py-0.5 rounded-full capitalize",children:e},e)),Object.keys(e.permissions).length>4&&(0,s.jsxs)("span",{className:"text-[10px] bg-muted text-muted-foreground px-2 py-0.5 rounded-full",children:["+",Object.keys(e.permissions).length-4," more"]})]})})]},e.id))})]}):(0,s.jsx)(r.Card,{children:(0,s.jsx)(r.CardContent,{className:"p-6 text-center text-muted-foreground",children:"You do not have permission to manage roles."})})};var K=e.i(581418);let X=()=>{let{currentProfile:e,changePin:i}=(0,n.useProfiles)(),[l,o]=(0,a.useState)({oldPin:"",newPin:"",confirmPin:""}),[c,d]=(0,a.useState)(!1);if(!e)return null;let m=async e=>{if(e.preventDefault(),l.newPin!==l.confirmPin)return void R.toast.error("New PINs do not match");if(4!==l.newPin.length||!/^\d+$/.test(l.newPin))return void R.toast.error("PIN must be exactly 4 digits");d(!0);try{await i(l.oldPin,l.newPin)&&o({oldPin:"",newPin:"",confirmPin:""})}finally{d(!1)}};return(0,s.jsxs)("div",{className:"max-w-md mx-auto space-y-6",children:[(0,s.jsxs)(r.Card,{className:"border-primary/20 shadow-sm",children:[(0,s.jsxs)(r.CardHeader,{className:"text-center",children:[(0,s.jsx)("div",{className:"mx-auto w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mb-2",children:(0,s.jsx)(L.Lock,{className:"h-6 w-6 text-primary"})}),(0,s.jsx)(r.CardTitle,{children:"Change Your PIN"}),(0,s.jsxs)(r.CardDescription,{children:["Profiles default to ",(0,s.jsx)("span",{className:"font-mono font-bold text-foreground",children:"0000"}),". We recommend changing it for security."]})]}),(0,s.jsx)(r.CardContent,{children:(0,s.jsxs)("form",{onSubmit:m,className:"space-y-4",autoComplete:"off",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(_.Label,{htmlFor:"oldPin",children:"Current PIN"}),(0,s.jsx)(k.Input,{id:"oldPin",type:"password",inputMode:"numeric",pattern:"[0-9]*",maxLength:4,value:l.oldPin,onChange:e=>o({...l,oldPin:e.target.value}),placeholder:"0000",required:!0,autoComplete:"off"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(_.Label,{htmlFor:"newPin",children:"New 4-Digit PIN"}),(0,s.jsx)(k.Input,{id:"newPin",type:"password",inputMode:"numeric",pattern:"[0-9]*",maxLength:4,value:l.newPin,onChange:e=>o({...l,newPin:e.target.value}),placeholder:"Enter new PIN",required:!0,autoComplete:"new-password"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(_.Label,{htmlFor:"confirmPin",children:"Confirm New PIN"}),(0,s.jsx)(k.Input,{id:"confirmPin",type:"password",inputMode:"numeric",pattern:"[0-9]*",maxLength:4,value:l.confirmPin,onChange:e=>o({...l,confirmPin:e.target.value}),placeholder:"Confirm new PIN",required:!0,autoComplete:"new-password"})]}),(0,s.jsx)(t.Button,{type:"submit",className:"w-full gap-2",disabled:c,children:c?"Updating...":(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(K.ShieldCheck,{className:"h-4 w-4"}),"Update PIN"]})})]})})]}),(0,s.jsxs)(r.Card,{className:"border-muted bg-muted/20",children:[(0,s.jsx)(r.CardHeader,{className:"pb-2",children:(0,s.jsxs)(r.CardTitle,{className:"text-sm font-medium flex items-center gap-2",children:[(0,s.jsx)(q.Check,{className:"h-4 w-4 text-green-600"})," Security Tip"]})}),(0,s.jsx)(r.CardContent,{children:(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Avoid simple patterns like 1234 or your birth year. Your PIN is required whenever you switch to this profile."})})]})]})};e.s(["default",0,()=>{let{currentBusiness:e}=(0,S.useBusiness)(),{profiles:r,isLoading:t,hasPermission:i}=(0,n.useProfiles)(),l=i("profiles","manage"),[o,c]=(0,a.useState)(!1),[d,m]=(0,a.useState)(null),[u,h]=(0,a.useState)(null);return e?(0,s.jsxs)("div",{className:"space-y-6 p-6",children:[(0,s.jsxs)(F.Tabs,{defaultValue:"profiles",className:"w-full",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4 border-b pb-4",children:[(0,s.jsxs)(F.TabsList,{className:"bg-muted/50",children:[(0,s.jsxs)(F.TabsTrigger,{value:"profiles",className:"gap-2",children:[(0,s.jsx)(v.Users,{className:"h-4 w-4"}),"Profiles"]}),i("profiles","manage")&&(0,s.jsxs)(F.TabsTrigger,{value:"roles",className:"gap-2",children:[(0,s.jsx)(z.Shield,{className:"h-4 w-4"}),"Roles"]}),(0,s.jsxs)(F.TabsTrigger,{value:"security",className:"gap-2",children:[(0,s.jsx)(L.Lock,{className:"h-4 w-4"}),"Security"]})]}),(0,s.jsx)("div",{className:"hidden sm:block",children:(0,s.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Current Business: ",(0,s.jsx)("span",{className:"font-semibold text-foreground",children:e.name})]})})]}),(0,s.jsxs)(F.TabsContent,{value:"profiles",className:"space-y-6 mt-0",children:[(0,s.jsx)(w,{profilesCount:r.length,onNewProfile:()=>c(!0),canManage:l}),(0,s.jsx)(y,{profiles:r,isLoading:t,onEditProfile:m,onDeleteProfile:h,canManage:l})]}),(0,s.jsx)(F.TabsContent,{value:"roles",className:"mt-0",children:(0,s.jsx)(Y,{})}),(0,s.jsx)(F.TabsContent,{value:"security",className:"mt-0",children:(0,s.jsx)(X,{})})]}),(0,s.jsx)(E,{open:o,onOpenChange:c}),(0,s.jsx)(M,{profile:d,open:!!d,onOpenChange:e=>!e&&m(null)}),(0,s.jsx)(B,{profile:u,open:!!u,onOpenChange:e=>!e&&h(null)})]}):(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-muted-foreground",children:"No Business Selected"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Please select a business to manage profiles."})]})})}],540975)}]);