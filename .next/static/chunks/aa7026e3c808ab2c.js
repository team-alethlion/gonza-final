(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,833835,e=>{"use strict";var s=e.i(843476),t=e.i(271645),a=e.i(102594),l=e.i(422713),r=e.i(304228),n=e.i(39725),i=e.i(777624),c=e.i(686311),d=e.i(107233),o=e.i(178583),m=e.i(561659),x=e.i(761911),h=e.i(519455);let u=({onNewMessage:e,onNewTemplate:t,onTopUp:a,onBulkMessage:l,smsCredits:r,canCreate:n=!0})=>(0,s.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-2",children:[(0,s.jsx)(c.MessageSquare,{className:"w-8 h-8 text-blue-600"}),"Messages"]}),(0,s.jsx)("p",{className:"text-gray-500 mt-1",children:"Send SMS to your customers"})]}),(0,s.jsx)("div",{className:"flex flex-wrap items-center gap-3",children:n&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(h.Button,{onClick:a,variant:"outline",className:"flex items-center gap-2 border-green-500 text-green-700 hover:bg-green-50",children:[(0,s.jsx)(m.CreditCard,{className:"w-4 h-4"}),"Top Up"]}),(0,s.jsxs)(h.Button,{onClick:t,variant:"outline",className:"flex items-center gap-2",children:[(0,s.jsx)(o.FileText,{className:"w-4 h-4"}),"New Template"]}),(0,s.jsxs)(h.Button,{onClick:l,variant:"outline",className:"flex items-center gap-2 border-purple-500 text-purple-700 hover:bg-purple-50",children:[(0,s.jsx)(x.Users,{className:"w-4 h-4"}),"Bulk SMS"]}),(0,s.jsxs)(h.Button,{onClick:e,className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700",children:[(0,s.jsx)(d.Plus,{className:"w-4 h-4"}),"New Message"]})]})})]});var g=e.i(269638),p=e.i(373884),j=e.i(503116),b=e.i(252754);let N=({stats:e})=>{let t=e.creditsRemaining<=50,a=e.creditsRemaining<=20;return(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[(0,s.jsxs)("div",{className:`p-5 rounded-xl shadow-sm border-2 transition-all hover:shadow-lg ${a?"bg-red-50 border-red-400":t?"bg-amber-50 border-amber-400":"bg-emerald-50 border-emerald-400"}`,children:[(0,s.jsxs)("div",{className:`flex items-center gap-3 mb-2 ${a?"text-red-700":t?"text-amber-700":"text-emerald-700"}`,children:[(0,s.jsx)(b.Wallet,{className:"w-5 h-5"}),(0,s.jsx)("span",{className:"text-sm font-medium",children:"Credit Bal."})]}),(0,s.jsx)("p",{className:`text-3xl font-bold ${a?"text-red-700":t?"text-amber-700":"text-emerald-700"}`,children:e.creditsRemaining.toLocaleString()})]}),(0,s.jsxs)("div",{className:"bg-white p-5 rounded-xl shadow-sm border border-gray-200 hover:shadow-md transition-shadow",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 text-gray-600 mb-2",children:[(0,s.jsx)(c.MessageSquare,{className:"w-5 h-5"}),(0,s.jsx)("span",{className:"text-sm font-medium",children:"Total"})]}),(0,s.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:e.total.toLocaleString()})]}),(0,s.jsxs)("div",{className:"bg-white p-5 rounded-xl shadow-sm border border-gray-200 hover:shadow-md transition-shadow",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 text-green-600 mb-2",children:[(0,s.jsx)(g.CheckCircle,{className:"w-5 h-5"}),(0,s.jsx)("span",{className:"text-sm font-medium",children:"Sent"})]}),(0,s.jsx)("p",{className:"text-3xl font-bold text-green-600",children:e.sent.toLocaleString()})]}),(0,s.jsxs)("div",{className:"bg-white p-5 rounded-xl shadow-sm border border-gray-200 hover:shadow-md transition-shadow",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 text-amber-600 mb-2",children:[(0,s.jsx)(j.Clock,{className:"w-5 h-5"}),(0,s.jsx)("span",{className:"text-sm font-medium",children:"Pending"})]}),(0,s.jsx)("p",{className:"text-3xl font-bold text-amber-600",children:e.pending})]}),(0,s.jsxs)("div",{className:"bg-white p-5 rounded-xl shadow-sm border border-gray-200 hover:shadow-md transition-shadow",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 text-red-600 mb-2",children:[(0,s.jsx)(p.XCircle,{className:"w-5 h-5"}),(0,s.jsx)("span",{className:"text-sm font-medium",children:"Failed"})]}),(0,s.jsx)("p",{className:"text-3xl font-bold text-red-600",children:e.failed})]}),(0,s.jsxs)("div",{className:"bg-white p-5 rounded-xl shadow-sm border border-gray-200 hover:shadow-md transition-shadow",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 text-blue-600 mb-2",children:[(0,s.jsx)(m.CreditCard,{className:"w-5 h-5"}),(0,s.jsx)("span",{className:"text-sm font-medium",children:"Credits Used"})]}),(0,s.jsx)("p",{className:"text-3xl font-bold text-blue-600",children:e.totalCreditsUsed.toLocaleString()})]})]})};var f=e.i(555436),y=e.i(797548),v=e.i(793479),w=e.i(967489);let C=({messages:e,customers:t,searchTerm:a,setSearchTerm:l,statusFilter:r,setStatusFilter:n})=>{let i=e=>e?t.find(s=>s.id===e):null,d=e.filter(e=>{let s=i(e.customerId),t=s?s.full_name||s.fullName||s.name:"",l=e.phoneNumber,n=e.content,c=!a||t.toLowerCase().includes(a.toLowerCase())||l.toLowerCase().includes(a.toLowerCase())||n.toLowerCase().includes(a.toLowerCase()),d="all"===r||e.status===r;return c&&d});return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,s.jsxs)("div",{className:"flex-1 relative",children:[(0,s.jsx)(f.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),(0,s.jsx)(v.Input,{type:"text",placeholder:"Search messages...",value:a,onChange:e=>l(e.target.value),className:"pl-10"})]}),(0,s.jsxs)(w.Select,{value:r,onValueChange:n,children:[(0,s.jsxs)(w.SelectTrigger,{className:"w-full md:w-48",children:[(0,s.jsx)(y.Filter,{className:"w-4 h-4 mr-2"}),(0,s.jsx)(w.SelectValue,{placeholder:"Filter by status"})]}),(0,s.jsxs)(w.SelectContent,{children:[(0,s.jsx)(w.SelectItem,{value:"all",children:"All Messages"}),(0,s.jsx)(w.SelectItem,{value:"pending",children:"Pending"}),(0,s.jsx)(w.SelectItem,{value:"sent",children:"Sent"}),(0,s.jsx)(w.SelectItem,{value:"failed",children:"Failed"})]})]})]}),(0,s.jsx)("div",{className:"space-y-3",children:0===d.length?(0,s.jsxs)("div",{className:"text-center py-12 bg-white rounded-lg border",children:[(0,s.jsx)(c.MessageSquare,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),(0,s.jsx)("p",{className:"text-gray-500",children:"No messages found"})]}):d.map(e=>{let t=i(e.customerId),a=t?t.full_name||t.fullName||t.name:"";return(0,s.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow border hover:shadow-md transition-shadow",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,s.jsx)("div",{children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("p",{className:"font-medium text-gray-900",children:a?`${a} (${e.phoneNumber})`:e.phoneNumber}),(0,s.jsx)("span",{className:`text-xs px-2 py-1 rounded-full ${{pending:"bg-amber-100 text-amber-800",sent:"bg-green-100 text-green-800",delivered:"bg-blue-100 text-blue-800",failed:"bg-red-100 text-red-800"}[e.status]||"bg-gray-100 text-gray-800"}`,children:e.status})]})}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("p",{className:"text-xs text-gray-400",children:new Date(e.createdAt).toLocaleDateString()}),(0,s.jsx)("p",{className:"text-xs text-gray-400",children:new Date(e.createdAt).toLocaleTimeString()})]})]}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:e.content}),(0,s.jsxs)("div",{className:"flex justify-between items-center text-xs text-gray-400",children:[(0,s.jsxs)("span",{children:[e.smsCreditsUsed," credit",e.smsCreditsUsed>1?"s":""," used"]}),e.errorMessage&&(0,s.jsx)("span",{className:"text-red-600",children:e.errorMessage})]})]},e.id)})})]})},S=(0,e.i(475254).default)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);var T=e.i(776639),k=e.i(624687);let D=({open:e,onClose:a,onSend:l,customers:r,templates:n})=>{let[i,c]=(0,t.useState)(""),[d,o]=(0,t.useState)(""),[m,x]=(0,t.useState)("none"),[u,g]=(0,t.useState)("none"),[p,j]=(0,t.useState)(!1),[b,N]=(0,t.useState)(null),[f,y]=(0,t.useState)("");(0,t.useEffect)(()=>{e||(c(""),o(""),x("none"),g("none"),N(null),y(""))},[e]),(0,t.useEffect)(()=>{m&&"none"!==m&&c(C(r.find(e=>e.id===m)))},[m,r]),(0,t.useEffect)(()=>{if(u&&"none"!==u){let e=n.find(e=>e.id===u);e&&o(e.content)}},[u,n]);let C=e=>(e?.phone_number||e?.phoneNumber||e?.phone||e?.contact||"").trim(),D=(0,t.useMemo)(()=>{let e=(f||"").toLowerCase();return r.filter(e=>C(e)).filter(s=>{let t=(s.full_name||s.fullName||s.name||"").toLowerCase(),a=C(s).toLowerCase();return!e||t.includes(e)||a.includes(e)})},[r,f]),U=async()=>{if(!i||!d)return;j(!0);let e=await l({phoneNumber:i,content:d,customerId:m&&"none"!==m?m:void 0,templateId:u&&"none"!==u?u:void 0});j(!1),N({success:e.success,failed:e.failed,errors:e.errors||[]}),0===(e.failed||0)&&setTimeout(()=>a(),3e3)},M=d.length,L=Math.ceil(M/160)||1;return(0,s.jsx)(T.Dialog,{open:e,onOpenChange:a,children:(0,s.jsxs)(T.DialogContent,{className:"sm:max-w-lg max-h-[90vh] overflow-y-auto",children:[(0,s.jsx)(T.DialogHeader,{children:(0,s.jsxs)(T.DialogTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(S,{className:"w-5 h-5"}),"Send New Message"]})}),b?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:`p-4 rounded-lg border ${0===b.failed?"bg-green-50 border-green-200":"bg-amber-50 border-amber-200"}`,children:[(0,s.jsx)("h3",{className:"font-semibold text-lg mb-2",children:0===b.failed?"✅ Message Sent Successfully!":"⚠️ Sending Completed with Errors"}),(0,s.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,s.jsxs)("p",{className:"text-green-700",children:["✓ Successfully sent: ",b.success]}),b.failed>0&&(0,s.jsxs)("p",{className:"text-red-700",children:["✗ Failed: ",b.failed]})]})]}),b.errors.length>0&&(0,s.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,s.jsx)("h4",{className:"font-semibold text-red-900 mb-2",children:"Errors:"}),(0,s.jsx)("ul",{className:"text-sm text-red-800 space-y-1 max-h-[200px] overflow-y-auto",children:b.errors.map((e,t)=>(0,s.jsxs)("li",{children:["• ",e]},t))})]}),(0,s.jsx)(h.Button,{onClick:a,className:"w-full",children:"Close"})]}):(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Select Customer (Optional)"}),(0,s.jsxs)(w.Select,{value:m,onValueChange:x,children:[(0,s.jsx)(w.SelectTrigger,{className:"w-full",children:(0,s.jsx)(w.SelectValue,{placeholder:"Search or select a customer..."})}),(0,s.jsxs)(w.SelectContent,{className:"max-h-[300px] overflow-y-auto",children:[(0,s.jsx)("div",{className:"p-2",children:(0,s.jsx)(v.Input,{type:"text",placeholder:"Type to search...",value:f,onChange:e=>y(e.target.value),className:"mb-2"})}),(0,s.jsx)(w.SelectItem,{value:"none",children:"None - Enter Customer Name or Phone Number"}),D.map(e=>(0,s.jsxs)(w.SelectItem,{value:e.id,children:[e.full_name||e.fullName||e.name||"Unnamed Customer"," - ",C(e)]},e.id))]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Phone Number *"}),(0,s.jsx)(v.Input,{type:"tel",placeholder:"+256700000000",value:i,onChange:e=>c(e.target.value),className:"w-full"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Use Template (Optional)"}),(0,s.jsxs)(w.Select,{value:u,onValueChange:g,children:[(0,s.jsx)(w.SelectTrigger,{className:"w-full",children:(0,s.jsx)(w.SelectValue,{placeholder:"Choose a template..."})}),(0,s.jsxs)(w.SelectContent,{className:"max-h-[300px] overflow-y-auto",children:[(0,s.jsx)(w.SelectItem,{value:"none",children:"None - Type custom message"}),n.map(e=>(0,s.jsx)(w.SelectItem,{value:e.id,children:e.name},e.id))]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Message * (Max 160 Characters)"}),(0,s.jsx)(k.Textarea,{placeholder:"Type your message...",value:d,onChange:e=>o(e.target.value),rows:5,required:!0,className:"w-full resize-none"}),(0,s.jsxs)("div",{className:"flex justify-between mt-1 text-xs text-gray-500",children:[(0,s.jsxs)("span",{children:[M," characters"]}),(0,s.jsxs)("span",{children:[L," SMS credit",L>1?"s":""," will be used"]})]})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[(0,s.jsx)(h.Button,{variant:"outline",onClick:a,disabled:p,children:"Cancel"}),(0,s.jsx)(h.Button,{onClick:U,disabled:!i||!d||p,className:"bg-blue-600 hover:bg-blue-700",children:p?(0,s.jsx)("span",{className:"animate-spin mr-2",children:"⏳"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(S,{className:"w-4 h-4 mr-2"}),"Send Message"]})})]})]})]})})};var U=e.i(356909);let M=[{value:"ThankYou",label:"Thank You (After Sale)"},{value:"Birthday",label:"Birthday Wishes"},{value:"PaymentReminder",label:"Payment Reminder"},{value:"Holiday",label:"Public Holiday"},{value:"Inactive",label:"We Miss You / Inactive Customer"},{value:"Custom",label:"Custom"}],L=({open:e,onClose:a,onSave:l,initialData:r})=>{let[n,i]=(0,t.useState)(""),[c,d]=(0,t.useState)(""),[m,x]=(0,t.useState)(""),[u,g]=(0,t.useState)(""),[p,j]=(0,t.useState)([]),[b,N]=(0,t.useState)(!1);(0,t.useEffect)(()=>{e&&r?(i(r.name),d(r.content),x(r.category||""),g(r.category&&!M.some(e=>e.value===r.category)?r.category:""),j(r.variables||[])):e||(i(""),d(""),x(""),g(""),j([]))},[e,r]);let f=async()=>{if(!n||!c)return;let e="Custom"===m?u:m;N(!0);let s=await l({name:n,content:c,category:e||void 0,variables:p,isDefault:!1});N(!1),s&&a()};return(0,s.jsx)(T.Dialog,{open:e,onOpenChange:e=>{e||a()},children:(0,s.jsxs)(T.DialogContent,{className:"sm:max-w-lg max-h-[80vh] overflow-y-auto",children:[(0,s.jsx)(T.DialogHeader,{children:(0,s.jsxs)(T.DialogTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(o.FileText,{className:"w-5 h-5"}),r?"Edit Template":"Create New Template"]})}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Template Name *"}),(0,s.jsx)(k.Textarea,{placeholder:"e.g., Welcome Message",value:n,onChange:e=>i(e.target.value),rows:1,className:"resize-none"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Category *"}),(0,s.jsxs)(w.Select,{value:m,onValueChange:x,children:[(0,s.jsx)(w.SelectTrigger,{children:(0,s.jsx)(w.SelectValue,{placeholder:"Select category..."})}),(0,s.jsx)(w.SelectContent,{children:M.map(e=>(0,s.jsx)(w.SelectItem,{value:e.value,children:e.label},e.value))})]}),"Custom"===m&&(0,s.jsx)(k.Textarea,{placeholder:"Type custom category...",value:u,onChange:e=>g(e.target.value),rows:1,className:"mt-2 resize-none"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Message Content *"}),(0,s.jsx)(k.Textarea,{placeholder:"Type your template here... Use {variable} for dynamic content",value:c,onChange:e=>{let s;d(e.target.value),(s=e.target.value.match(/\{([^}]+)\}/g))?j([...new Set(s.map(e=>e.slice(1,-1)))]):j([])},rows:6,className:"resize-none"}),(0,s.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Use curly braces for variables: ","{customer_name}",", ","{customer_phone}",", etc."]})]}),p.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Detected Variables"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:p.map(e=>(0,s.jsx)("span",{className:"text-xs px-2 py-1 bg-blue-50 text-blue-600 rounded",children:e},e))})]}),(0,s.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[(0,s.jsx)("p",{className:"text-xs font-medium text-blue-900 mb-2",children:"Available Variables"}),(0,s.jsxs)("div",{className:"text-xs text-blue-800 space-y-1",children:[(0,s.jsxs)("p",{children:["• ",(0,s.jsx)("code",{className:"bg-blue-100 px-1 rounded",children:"{customer_name}"})," - Full customer name"]}),(0,s.jsxs)("p",{children:["• ",(0,s.jsx)("code",{className:"bg-blue-100 px-1 rounded",children:"{first_name}"})," - Customer first name"]}),(0,s.jsxs)("p",{children:["• ",(0,s.jsx)("code",{className:"bg-blue-100 px-1 rounded",children:"{last_name}"})," - Customer last name"]}),(0,s.jsxs)("p",{children:["• ",(0,s.jsx)("code",{className:"bg-blue-100 px-1 rounded",children:"{customer_phone}"})," - Customer phone number"]}),(0,s.jsxs)("p",{children:["• ",(0,s.jsx)("code",{className:"bg-blue-100 px-1 rounded",children:"{customer_email}"})," - Customer email"]})]}),(0,s.jsx)("p",{className:"text-xs text-blue-700 mt-2",children:"These will be automatically replaced when sending to a customer"})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-2 pt-4",children:[(0,s.jsx)(h.Button,{variant:"outline",onClick:a,disabled:b,children:"Cancel"}),(0,s.jsxs)(h.Button,{onClick:f,disabled:!n||!c||!m||"Custom"===m&&!u||b,className:"bg-blue-600 hover:bg-blue-700",children:[(0,s.jsx)(U.Save,{className:"w-4 h-4 mr-2"}),b?"Saving...":"Save Template"]})]})]})]})})};var I=e.i(212426);let P={get url(){return`file://${e.P("src/components/messages/TopUpCreditsDialog.tsx")}`}},_=({open:e,onClose:a,onTopUp:l})=>{let[r,n]=(0,t.useState)(10),[i,c]=(0,t.useState)(""),[d,o]=(0,t.useState)(!1),x=Number(P.env.VITE_SMS_CREDIT_COST||100),u=r*x;(0,t.useEffect)(()=>{console.log("[TopUpCreditsDialog] Dialog open state:",e),e&&(console.log("[TopUpCreditsDialog] Dialog opened — resetting form"),n(10),c(""),o(!1))},[e]),(0,t.useEffect)(()=>{console.log("[TopUpCreditsDialog] Current state → Credits:",r,"| Phone:",i,"| Total Cost: UGX",u.toLocaleString())},[r,i,u]);let g=async()=>{if(console.log("[TopUpCreditsDialog] Top-up requested!"),console.log("   → Credits:",r),console.log("   → Phone Number:",i),console.log("   → Total Cost: UGX",u.toLocaleString()),!i||r<1)return void console.warn("[TopUpCreditsDialog] Invalid input — blocking submit");o(!0),console.log("[TopUpCreditsDialog] Calling onTopUp...");try{let e=await l(r,i);console.log("[TopUpCreditsDialog] onTopUp result:",e?"SUCCESS":"FAILED"),e?(console.log("[TopUpCreditsDialog] Payment successful → closing dialog"),a()):console.error("[TopUpCreditsDialog] Payment failed (returned false)")}catch(e){console.error("[TopUpCreditsDialog] onTopUp threw an error:",e)}finally{o(!1)}};return(0,s.jsx)(T.Dialog,{open:e,onOpenChange:a,children:(0,s.jsxs)(T.DialogContent,{className:"sm:max-w-lg",children:[(0,s.jsx)(T.DialogHeader,{children:(0,s.jsxs)(T.DialogTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(m.CreditCard,{className:"w-5 h-5"}),"Top Up SMS Credits"]})}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Number of Credits *"}),(0,s.jsx)(v.Input,{type:"number",min:"1",value:r,onChange:e=>{let s=Math.max(1,parseInt(e.target.value)||1);console.log("[TopUpCreditsDialog] Credits input changed →",s),n(s)},className:"text-lg font-semibold"}),(0,s.jsx)("div",{className:"mt-3 flex flex-wrap gap-2",children:[10,25,50,100].map(e=>(0,s.jsxs)("button",{type:"button",onClick:()=>{console.log("[TopUpCreditsDialog] Quick amount clicked →",e,"credits"),n(e)},className:`px-3 py-1 text-sm rounded-md border transition-colors ${r===e?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300 hover:border-blue-400"}`,children:[e," credits"]},e))})]}),(0,s.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("span",{className:"text-sm text-gray-600",children:"Credit Cost:"}),(0,s.jsxs)("span",{className:"text-sm font-medium",children:["UGX ",x," per credit"]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("span",{className:"text-sm text-gray-600",children:"Quantity:"}),(0,s.jsxs)("span",{className:"text-sm font-medium",children:[r," credits"]})]}),(0,s.jsx)("div",{className:"border-t border-blue-300 pt-2 mt-2",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-base font-semibold text-gray-900",children:"Total Amount:"}),(0,s.jsxs)("span",{className:"text-xl font-bold text-blue-600",children:["UGX ",u.toLocaleString()]})]})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Mobile Money Phone Number *"}),(0,s.jsx)(v.Input,{type:"tel",placeholder:"+256700000000",value:i,onChange:e=>{console.log("[TopUpCreditsDialog] Phone number changed →",e.target.value),c(e.target.value)}}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"You will receive a payment prompt on this number"})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-2 pt-4",children:[(0,s.jsx)(h.Button,{variant:"outline",onClick:a,disabled:d,children:"Cancel"}),(0,s.jsxs)(h.Button,{onClick:g,disabled:!i||r<1||d,className:"bg-green-600 hover:bg-green-700",children:[(0,s.jsx)(I.DollarSign,{className:"w-4 h-4 mr-2"}),d?"Processing...":`Pay UGX ${u.toLocaleString()}`]})]})]})]})})};var A=e.i(63209),E=e.i(257428),B=e.i(146786),F=e.i(751371),V=e.i(619578),O=e.i(510637);let $=({open:e,onClose:a,onSend:r,customers:n,templates:i=[],searchTerm:c,setSearchTerm:d})=>{let[o,m]=(0,t.useState)(""),[u,g]=(0,t.useState)([]),[p,j]=(0,t.useState)("none"),[b,N]=(0,t.useState)(!1),[f,y]=(0,t.useState)("all"),[C,D]=(0,t.useState)("90days"),[U,M]=(0,t.useState)(null),{currentBusiness:L}=(0,l.useBusiness)(),{sales:I,isLoading:P}=(0,B.useSalesData)(L?.id),_=e=>e.charAt(0).toUpperCase()+e.slice(1),$=(0,t.useMemo)(()=>{let e={};if(!I||0===I.length)return e;let s=new Date,t=s;switch(C){case"30days":t=(0,F.subDays)(s,30);break;case"60days":t=(0,F.subDays)(s,60);break;case"90days":t=(0,F.subDays)(s,90);break;case"6months":t=(0,V.subMonths)(s,6);break;case"1year":t=(0,O.subYears)(s,1)}return n.forEach(s=>{let a=(s.full_name||s.fullName||s.name||"").toLowerCase(),l=I.filter(e=>e.customerId===s.id||e.customerName?.toLowerCase().trim()===a),r=new Set;0===l.length?r.add("inactive"):(new Date(Math.max(...l.map(e=>new Date(e.date).getTime())))<t&&r.add("inactive"),l.forEach(e=>{let s=(e.paymentStatus||"").toUpperCase().trim();"PAID"===s?r.add("paid"):"QUOTE"===s?r.add("quote"):"INSTALLMENT SALE"===s?r.add("installment"):["NOT PAID","UNPAID","OPEN"].includes(s)&&r.add("unpaid")})),e[s.id]=r}),e},[n,I,C]);(0,t.useEffect)(()=>{e||(m(""),g([]),j("none"),y("all"),M(null))},[e]),(0,t.useEffect)(()=>{if(p&&"none"!==p){let e=i.find(e=>e.id===p);e&&m(e.content)}},[p,i]);let H=e=>e.phone_number||e.phoneNumber||e.phone||e.contact||"",q=(0,t.useMemo)(()=>n.filter(e=>{let s=H(e)||"";if(!s)return!1;let t=(e.full_name||e.fullName||e.name||"").toLowerCase(),a=(c||"").toLowerCase(),l=!a||t.includes(a)||s.toLowerCase().includes(a),r=$[e.id]||new Set,n=!0;return"all"!==f&&(n=r.has(f)),l&&n}),[n,c,f,$]),z=e=>{g(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])},X=async()=>{if(!o||0===u.length)return;N(!0);let e=await r({customerIds:u,content:o,templateId:"none"!==p?p:void 0});N(!1),M(e),0===e.failed&&setTimeout(()=>a(),3e3)},R=u.length*Math.ceil((o.length||1)/160);return P?(0,s.jsx)(T.Dialog,{open:e,onOpenChange:a,children:(0,s.jsx)(T.DialogContent,{className:"sm:max-w-3xl max-h-[90vh] overflow-y-auto",children:(0,s.jsx)("div",{className:"p-4 text-center text-gray-500",children:"Loading sales data..."})})}):(0,s.jsx)(T.Dialog,{open:e,onOpenChange:a,children:(0,s.jsxs)(T.DialogContent,{className:"sm:max-w-3xl max-h-[90vh] overflow-y-auto",children:[(0,s.jsx)(T.DialogHeader,{children:(0,s.jsxs)(T.DialogTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(x.Users,{className:"w-5 h-5"}),"Send Bulk SMS"]})}),U?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:`p-4 rounded-lg border ${0===U.failed?"bg-green-50 border-green-200":"bg-amber-50 border-amber-200"}`,children:[(0,s.jsx)("h3",{className:"font-semibold text-lg mb-2",children:0===U.failed?"✅ Messages Sent Successfully!":"⚠️ Sending Complete with Errors"}),(0,s.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,s.jsxs)("p",{className:"text-green-700",children:["✓ Successfully sent: ",U.success]}),U.failed>0&&(0,s.jsxs)("p",{className:"text-red-700",children:["✗ Failed: ",U.failed]})]})]}),U.errors.length>0&&(0,s.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,s.jsx)("h4",{className:"font-semibold text-red-900 mb-2",children:"Errors:"}),(0,s.jsx)("ul",{className:"text-sm text-red-800 space-y-1 max-h-[200px] overflow-y-auto",children:U.errors.map((e,t)=>(0,s.jsxs)("li",{children:["• ",e]},t))})]}),(0,s.jsx)(h.Button,{onClick:a,className:"w-full",children:"Close"})]}):(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Use Template (Optional)"}),(0,s.jsxs)(w.Select,{value:p,onValueChange:j,children:[(0,s.jsx)(w.SelectTrigger,{className:"w-full",children:(0,s.jsx)(w.SelectValue,{placeholder:"Choose a template..."})}),(0,s.jsxs)(w.SelectContent,{className:"max-h-[300px] overflow-y-auto",children:[(0,s.jsx)(w.SelectItem,{value:"none",children:"None - Type custom message"}),i.map(e=>(0,s.jsx)(w.SelectItem,{value:e.id,children:e.name},e.id))]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Message * (Max 160 Characters)"}),(0,s.jsx)(k.Textarea,{placeholder:"Type your message here... Use {customer_name} for personalization",value:o,onChange:e=>m(e.target.value),rows:4,maxLength:160,required:!0,className:"resize-none w-full"}),(0,s.jsxs)("div",{className:"flex justify-between mt-1 text-xs text-gray-500",children:[(0,s.jsxs)("span",{children:[o.length," characters"]}),(0,s.jsxs)("span",{className:"font-medium text-blue-600",children:[R," total SMS credits will be used"]})]})]}),(0,s.jsxs)("div",{className:"flex gap-2 mb-2 flex-wrap items-center",children:[["all","paid","unpaid","quote","installment","inactive"].map(e=>(0,s.jsx)(h.Button,{size:"sm",variant:f===e?"default":"outline",onClick:()=>y(e),children:_(e)},e)),"inactive"===f&&(0,s.jsxs)(w.Select,{value:C,onValueChange:e=>D(e),children:[(0,s.jsx)(w.SelectTrigger,{className:"w-[120px] text-xs",children:(0,s.jsx)(w.SelectValue,{placeholder:"Select period"})}),(0,s.jsxs)(w.SelectContent,{children:[(0,s.jsx)(w.SelectItem,{value:"30days",children:"30 days"}),(0,s.jsx)(w.SelectItem,{value:"60days",children:"60 days"}),(0,s.jsx)(w.SelectItem,{value:"90days",children:"90 days"}),(0,s.jsx)(w.SelectItem,{value:"6months",children:"6 months"}),(0,s.jsx)(w.SelectItem,{value:"1year",children:"1 year"})]})]}),(0,s.jsx)(h.Button,{size:"sm",variant:"outline",onClick:()=>{u.length===q.length?g([]):g(q.map(e=>e.id))},children:u.length===q.length?`Deselect All ${_(f)} Customers`:`Select All ${_(f)} Customers`})]}),(0,s.jsx)(v.Input,{type:"text",placeholder:"Search customers...",value:c,onChange:e=>d(e.target.value),className:"mb-2"}),(0,s.jsx)("div",{className:"border rounded-lg max-h-[300px] overflow-y-auto",children:0===q.length?(0,s.jsxs)("div",{className:"p-4 text-center text-gray-500",children:[(0,s.jsx)(A.AlertCircle,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),(0,s.jsx)("p",{children:"No customers match your search"})]}):q.map(e=>{let t=H(e),a=Array.from($[e.id]||[]);return(0,s.jsxs)("div",{className:"flex items-center gap-3 p-3 hover:bg-gray-50 border-b last:border-b-0 cursor-pointer",onClick:()=>z(e.id),children:[(0,s.jsx)(E.Checkbox,{checked:u.includes(e.id),onCheckedChange:()=>z(e.id)}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"font-medium text-gray-900",children:e.full_name||e.fullName||e.name||"Unnamed Customer"}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:t}),(0,s.jsxs)("span",{className:"text-xs text-gray-400",children:["Status: ",a.map(e=>e.toUpperCase()).join(", ")]})]})]},e.id)})}),(0,s.jsxs)("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[(0,s.jsx)(h.Button,{variant:"outline",onClick:a,disabled:b,children:"Cancel"}),(0,s.jsx)(h.Button,{onClick:X,disabled:0===u.length||!o||b,className:"bg-blue-600 hover:bg-blue-700",children:b?(0,s.jsx)("span",{className:"animate-spin mr-2",children:"⏳"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(S,{className:"w-4 h-4 mr-2"}),"Send to ",u.length," Customer",1!==u.length?"s":""]})})]})]})]})})},H=({purchases:e})=>0===e.length?(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow border p-8 text-center",children:[(0,s.jsx)(m.CreditCard,{className:"w-12 h-12 mx-auto text-gray-400 mb-3"}),(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"No Purchase History"}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Your credit purchase history will appear here."})]}):(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow border overflow-hidden",children:[(0,s.jsx)("div",{className:"px-6 py-4 border-b bg-gray-50",children:(0,s.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[(0,s.jsx)(m.CreditCard,{className:"w-5 h-5"}),"Purchase History"]})}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Credits"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Cost"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Payment Phone"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Payment Method"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:e.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(e.created_at||e.createdAt||"").toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})}),(0,s.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:[(e.credits_amount||e.creditsAmount||0).toLocaleString()," credits"]}),(0,s.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["UGX ",(e.total_cost||e.totalCost||0).toLocaleString()]}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:e.payment_phone_number||e.paymentPhoneNumber||"-"}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(e=>{switch(e.toLowerCase()){case"completed":return(0,s.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[(0,s.jsx)(g.CheckCircle,{className:"w-3 h-3"}),"Completed"]});case"pending":return(0,s.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[(0,s.jsx)(j.Clock,{className:"w-3 h-3"}),"Pending"]});case"failed":return(0,s.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[(0,s.jsx)(p.XCircle,{className:"w-3 h-3"}),"Failed"]});default:return(0,s.jsx)("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:e})}})(e.payment_status||e.paymentStatus||"pending")}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:e.payment_method||e.paymentMethod||"-"})]},e.id))})]})})]}),q=({messages:e})=>{let[a,l]=(0,t.useState)(null);return 0===e.length?(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow border p-8 text-center",children:[(0,s.jsx)(S,{className:"w-12 h-12 mx-auto text-gray-400 mb-3"}),(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"No Usage History"}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Your sent messages will appear here."})]}):(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow border overflow-hidden",children:[(0,s.jsx)("div",{className:"px-6 py-4 border-b bg-gray-50",children:(0,s.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[(0,s.jsx)(c.MessageSquare,{className:"w-5 h-5"}),"Usage History"]})}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date Sent"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Phone Number"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Message"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Credits Used"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:e.map(e=>{let t=e.sms_credits_used||e.smsCreditsUsed||0;return(0,s.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(e.sent_at||e.sentAt||e.created_at||e.createdAt||"").toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:e.phone_number||e.phoneNumber||"-"}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm text-gray-900 max-w-md",children:(0,s.jsx)("div",{children:a===e.id?(0,s.jsxs)("div",{className:"whitespace-pre-wrap",children:[e.content,(0,s.jsx)("button",{onClick:()=>l(null),className:"text-blue-600 hover:text-blue-800 ml-2 text-xs",children:"Show less"})]}):(0,s.jsxs)("div",{children:[((e,s=50)=>e.length<=s?e:e.substring(0,s)+"...")(e.content),e.content.length>50&&(0,s.jsx)("button",{onClick:()=>l(e.id),className:"text-blue-600 hover:text-blue-800 ml-2 text-xs",children:"Show more"})]})})}),(0,s.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:[t," credit",t>1?"s":""]}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(e=>{switch(e.toLowerCase()){case"sent":case"delivered":return(0,s.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[(0,s.jsx)(g.CheckCircle,{className:"w-3 h-3"}),"delivered"===e?"Delivered":"Sent"]});case"pending":return(0,s.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[(0,s.jsx)(j.Clock,{className:"w-3 h-3"}),"Pending"]});case"failed":return(0,s.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[(0,s.jsx)(p.XCircle,{className:"w-3 h-3"}),"Failed"]});default:return(0,s.jsx)("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:e})}})(e.status)})]},e.id)})})]})})]})};var z=e.i(677572),X=e.i(929592),R=e.i(871689),Y=e.i(904792);e.s(["default",0,()=>{let{user:e}=(0,a.useAuth)(),{currentBusiness:c,isLoading:d}=(0,l.useBusiness)(),{currentProfile:o,hasPermission:m,isLoading:x}=(0,i.useProfiles)(),g=(0,Y.useNavigate)(),p=m("messages","view"),j=m("messages","create"),b=m("messages","edit"),f=m("messages","delete"),{messages:y,templates:v,purchases:w,isLoading:S,createMessage:T,createBulkMessages:k,createTemplate:U,updateTemplate:M,deleteTemplate:I,initiateCreditPurchase:P,getMessageStats:E}=(0,r.useMessages)(e?.id),{customers:B}=(0,n.useCustomers)(),[F,V]=(0,t.useState)(!1),[O,G]=(0,t.useState)(!1),[W,Q]=(0,t.useState)(!1),[K,J]=(0,t.useState)(!1),[Z,ee]=(0,t.useState)(void 0),[es,et]=(0,t.useState)("messages"),[ea,el]=(0,t.useState)(""),[er,en]=(0,t.useState)("all"),ei=E(),ec=async e=>{try{return await T(e),{success:1,failed:0,errors:[]}}catch(e){return console.error("Failed to send message:",e),{success:0,failed:1,errors:[e instanceof Error?e.message:"Unknown error"]}}},ed=(0,t.useCallback)(async e=>{try{return await k(e)}catch(e){return console.error("Failed to send bulk messages:",e),alert(e instanceof Error?e.message:"Failed to send messages"),{success:0,failed:0,errors:[e instanceof Error?e.message:"Unknown error"]}}},[k]),eo=(0,t.useCallback)(async e=>(Z?await M(Z.id,e):await U(e),G(!1),ee(void 0),!0),[Z,M,U]),em=(0,t.useCallback)(e=>{ee(e),G(!0)},[]),ex=(0,t.useCallback)(async e=>{confirm("Are you sure you want to delete this template?")&&await I(e)},[I]),eh=(0,t.useCallback)(async(e,s)=>{try{let t=await P(e,s);return window.open(t.redirectUrl,"_blank"),J(!1),!0}catch(e){return console.error("Failed to initiate top-up:",e),alert(e instanceof Error?e.message:"Failed to initiate payment"),!1}},[P]);if(d||!c||S||x)return(0,s.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(!p)return(0,s.jsxs)("div",{className:"max-w-4xl mx-auto p-6",children:[(0,s.jsxs)(X.Alert,{variant:"destructive",children:[(0,s.jsx)(A.AlertCircle,{className:"h-4 w-4"}),(0,s.jsx)(X.AlertTitle,{children:"Access Denied"}),(0,s.jsx)(X.AlertDescription,{children:"You do not have permission to view the messaging module. Please contact your administrator if you believe this is an error."})]}),(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsxs)(h.Button,{onClick:()=>g("/"),variant:"outline",className:"gap-2",children:[(0,s.jsx)(R.ArrowLeft,{className:"h-4 w-4"}),"Back to Dashboard"]})})]});let eu=y.filter(e=>{let s=e.phoneNumber||"",t=e.content||"",a=s.toLowerCase().includes(ea.toLowerCase())||t.toLowerCase().includes(ea.toLowerCase()),l="all"===er||e.status===er;return a&&l});return(0,s.jsxs)("div",{className:"space-y-8",children:[(0,s.jsx)(u,{onNewMessage:()=>V(!0),onNewTemplate:()=>{ee(void 0),G(!0)},onTopUp:()=>J(!0),onBulkMessage:()=>Q(!0),smsCredits:o?.sms_credits||0,canCreate:j}),(0,s.jsx)(N,{stats:ei}),(0,s.jsxs)(z.Tabs,{value:es,onValueChange:et,className:"w-full",children:[(0,s.jsxs)(z.TabsList,{className:"grid w-full max-w-2xl grid-cols-3",children:[(0,s.jsx)(z.TabsTrigger,{value:"messages",children:"Messages"}),(0,s.jsx)(z.TabsTrigger,{value:"templates",children:"Templates"}),(0,s.jsx)(z.TabsTrigger,{value:"history",children:"History"})]}),(0,s.jsx)(z.TabsContent,{value:"messages",className:"space-y-4 mt-6",children:(0,s.jsx)(C,{messages:eu,customers:B,searchTerm:ea,setSearchTerm:el,statusFilter:er,setStatusFilter:en})}),(0,s.jsx)(z.TabsContent,{value:"templates",className:"space-y-4 mt-6",children:(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:v.map(e=>(0,s.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow border hover:shadow-md transition-shadow",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,s.jsx)("h3",{className:"font-semibold text-lg",children:e.name}),(0,s.jsxs)("div",{className:"flex gap-2",children:[b&&(0,s.jsx)("button",{onClick:()=>em(e),className:"text-blue-600 hover:text-blue-800 text-sm",children:"Edit"}),f&&(0,s.jsx)("button",{onClick:()=>ex(e.id),className:"text-red-600 hover:text-red-800 text-sm",children:"Delete"})]})]}),e.category&&(0,s.jsx)("span",{className:"text-xs px-2 py-1 bg-gray-100 rounded-full text-gray-600",children:e.category}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mt-2 line-clamp-3",children:e.content}),e.variables.length>0&&(0,s.jsx)("div",{className:"mt-2 flex flex-wrap gap-1",children:e.variables.map(e=>(0,s.jsx)("span",{className:"text-xs px-2 py-0.5 bg-blue-50 text-blue-600 rounded",children:e},e))})]},e.id))})}),(0,s.jsxs)(z.TabsContent,{value:"history",className:"space-y-6 mt-6",children:[(0,s.jsx)(H,{purchases:w}),(0,s.jsx)(q,{messages:y})]})]}),(0,s.jsx)(L,{open:O,onClose:()=>{G(!1),ee(void 0)},onSave:eo,initialData:Z}),(0,s.jsx)(_,{open:K,onClose:()=>J(!1),onTopUp:eh}),(0,s.jsx)(D,{open:F,onClose:()=>V(!1),onSend:ec,customers:B,templates:v}),(0,s.jsx)($,{open:W,onClose:()=>Q(!1),onSend:ed,customers:B,templates:v,searchTerm:ea,setSearchTerm:el})]})}],833835)}]);