(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,903711,e=>{"use strict";var t=e.i(95187);let r=(0,t.createServerReference)("605a5ac8c70aa01eb0dd29483cb3c24316ae309de0",t.callServer,void 0,t.findSourceMapURL,"getProductReconciliationAction");e.s(["getProductReconciliationAction",()=>r])},686311,e=>{"use strict";let t=(0,e.i(475254).default)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);e.s(["MessageSquare",()=>t],686311)},618566,(e,t,r)=>{t.exports=e.r(976562)},965901,e=>{"use strict";var t=e.i(271645),r=e.i(422713),a=e.i(908406),s=e.i(102594),i=e.i(95187);let n=(0,i.createServerReference)("40696a4456c7690d29b12ef602356cbc9be3c34a97",i.callServer,void 0,i.findSourceMapURL,"getCustomerCategoriesAction"),l=(0,i.createServerReference)("70b04375c8b1e7a5a64b19d8153628c90f1150c267",i.callServer,void 0,i.findSourceMapURL,"createCustomerCategoryAction"),o=(0,i.createServerReference)("605890db4ca201299b68a3100db491232317cf530d",i.callServer,void 0,i.findSourceMapURL,"updateCustomerCategoryAction"),c=(0,i.createServerReference)("4032dd367fa6b4bfc08062e47a1ca2ffb5e5eb04b0",i.callServer,void 0,i.findSourceMapURL,"deleteCustomerCategoryAction");e.s(["useCustomerCategories",0,()=>{let[e,i]=(0,t.useState)([]),[u,d]=(0,t.useState)(!0),{currentBusiness:h}=(0,r.useBusiness)(),{user:p}=(0,s.useAuth)(),m=async()=>{if(!h){i([]),d(!1);return}try{let e=await n(h.id);if(e.success&&e.data)i(e.data);else throw Error(e.error)}catch(e){console.error("Error fetching customer categories:",e),(0,a.toast)({title:"Error",description:"Failed to fetch customer categories",variant:"destructive"})}finally{d(!1)}};return(0,t.useEffect)(()=>{m()},[h]),{categories:e,isLoading:u,createCategory:async e=>{if(!h||!p)return(0,a.toast)({title:"Error",description:"No business selected or user not authenticated",variant:"destructive"}),!1;try{let t=await l(h.id,p.id,e);if(t.success)return(0,a.toast)({title:"Success",description:"Customer category created successfully"}),m(),!0;throw Error(t.error)}catch(e){return console.error("Error creating customer category:",e),(0,a.toast)({title:"Error",description:"Failed to create customer category",variant:"destructive"}),!1}},updateCategory:async(e,t)=>{try{let r=await o(e,t);if(r.success)return(0,a.toast)({title:"Success",description:"Customer category updated successfully"}),m(),!0;throw Error(r.error)}catch(e){return console.error("Error updating customer category:",e),(0,a.toast)({title:"Error",description:"Failed to update customer category",variant:"destructive"}),!1}},deleteCategory:async e=>{try{let t=await c(e);if(t.success)return(0,a.toast)({title:"Success",description:"Customer category deleted successfully"}),m(),!0;throw Error(t.error)}catch(e){return console.error("Error deleting customer category:",e),(0,a.toast)({title:"Error",description:"Failed to delete customer category",variant:"destructive"}),!1}},refetch:m}}],965901)},375050,e=>{"use strict";var t=e.i(843476),r=e.i(271645),a=e.i(793479),s=e.i(110204),i=e.i(624687),n=e.i(519455),l=e.i(87316),o=e.i(227766),c=e.i(337822),u=e.i(967489),d=e.i(401851),h=e.i(487486),p=e.i(37727),m=e.i(975157),f=e.i(653145),y=e.i(776639),v=e.i(965901);e.s(["default",0,({initialData:e,onSubmit:g,onCancel:b})=>{let[S,x]=r.default.useState(!1),{categories:R}=(0,v.useCustomerCategories)(),[j,N]=r.default.useState(()=>{if(e?.birthday)return console.log("Initial birthday from props:",e.birthday),e.birthday}),[w,C]=r.default.useState(e?.categoryId||"none");r.default.useEffect(()=>{e?.birthday&&(console.log("Initial birthday from props:",e.birthday),console.log("Is Date object:",e.birthday instanceof Date),console.log("Date string:",e.birthday.toString()))},[e?.birthday]);let[E,I]=r.default.useState({facebook:e?.socialMedia?.facebook||"",instagram:e?.socialMedia?.instagram||"",twitter:e?.socialMedia?.twitter||"",linkedin:e?.socialMedia?.linkedin||"",other:e?.socialMedia?.other||""}),[T,A]=r.default.useState(e?.tags||[]),[P,k]=r.default.useState(""),[M,Q]=r.default.useState(e?.gender||""),{register:D,handleSubmit:O,formState:{errors:L}}=(0,f.useForm)({defaultValues:{fullName:e?.fullName||"",email:e?.email||"",phoneNumber:e?.phoneNumber||"",location:e?.location||"",gender:e?.gender||"",notes:e?.notes||""}}),F=()=>{""===P.trim()||T.includes(P.trim())||(A([...T,P.trim()]),k(""))},U=(e,t)=>{I({...E,[t]:e.target.value})},_=async e=>{x(!0);try{console.log("Selected date before submission:",j);let t={...e,gender:M,birthday:j,categoryId:"none"===w?null:w,socialMedia:Object.keys(E).length>0?E:null,tags:T.length>0?T:null};console.log("Submitting customer data:",t),await g(t)}finally{x(!1)}},q=new Date().getFullYear(),B=Array.from({length:100},(e,t)=>q-t),V=[{value:0,label:"January"},{value:1,label:"February"},{value:2,label:"March"},{value:3,label:"April"},{value:4,label:"May"},{value:5,label:"June"},{value:6,label:"July"},{value:7,label:"August"},{value:8,label:"September"},{value:9,label:"October"},{value:10,label:"November"},{value:11,label:"December"}],H=e=>{if(console.log("Date selected from calendar:",e),e){let t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),12,0,0));console.log("Corrected date with UTC noon:",t),N(t)}else N(void 0)},z=e=>{try{let t=parseInt(e),r=j?new Date(j):new Date,a=new Date(Date.UTC(t,r.getMonth(),r.getDate(),12,0,0));isNaN(a.getTime())?console.error("Invalid date after setting year:",e):(N(a),console.log("Year selected, new date:",a))}catch(e){console.error("Error setting year:",e)}},K=e=>{try{let t=parseInt(e),r=j?new Date(j):new Date,a=new Date(Date.UTC(r.getFullYear(),t,r.getDate(),12,0,0));isNaN(a.getTime())?console.error("Invalid date after setting month:",e):(N(a),console.log("Month selected, new date:",a))}catch(e){console.error("Error setting month:",e)}},W=R.filter(e=>e.id&&""!==e.id.trim());return(0,t.jsx)("form",{onSubmit:O(_),children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(s.Label,{htmlFor:"fullName",children:"Full Name*"}),(0,t.jsx)(a.Input,{id:"fullName",...D("fullName",{required:"Name is required"}),className:(0,m.cn)(L.fullName&&"border-red-500")}),L.fullName&&(0,t.jsx)("p",{className:"text-red-500 text-xs",children:L.fullName.message})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(s.Label,{htmlFor:"category",children:"Category"}),(0,t.jsxs)(u.Select,{value:w,onValueChange:C,children:[(0,t.jsx)(u.SelectTrigger,{id:"category",children:(0,t.jsx)(u.SelectValue,{placeholder:"Select category"})}),(0,t.jsxs)(u.SelectContent,{children:[(0,t.jsx)(u.SelectItem,{value:"none",children:"No Category"}),W.map(e=>(0,t.jsx)(u.SelectItem,{value:e.id,children:e.name},e.id))]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(s.Label,{htmlFor:"email",children:"Email Address"}),(0,t.jsx)(a.Input,{id:"email",type:"email",...D("email",{pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Invalid email address"}}),className:(0,m.cn)(L.email&&"border-red-500")}),L.email&&(0,t.jsx)("p",{className:"text-red-500 text-xs",children:L.email.message})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(s.Label,{htmlFor:"phoneNumber",children:"Phone Number"}),(0,t.jsx)(a.Input,{id:"phoneNumber",...D("phoneNumber")})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(s.Label,{htmlFor:"location",children:"Location"}),(0,t.jsx)(a.Input,{id:"location",...D("location")})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(s.Label,{htmlFor:"gender",children:"Gender"}),(0,t.jsxs)(u.Select,{value:M,onValueChange:Q,children:[(0,t.jsx)(u.SelectTrigger,{id:"gender",children:(0,t.jsx)(u.SelectValue,{placeholder:"Select gender"})}),(0,t.jsxs)(u.SelectContent,{children:[(0,t.jsx)(u.SelectItem,{value:"male",children:"Male"}),(0,t.jsx)(u.SelectItem,{value:"female",children:"Female"}),(0,t.jsx)(u.SelectItem,{value:"non-binary",children:"Non-binary"}),(0,t.jsx)(u.SelectItem,{value:"prefer-not-to-say",children:"Prefer not to say"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(s.Label,{children:"Birthday"}),(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)(c.Popover,{children:[(0,t.jsx)(c.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)(n.Button,{variant:"outline",className:"w-full justify-between",children:[j?j.getDate():"Day",(0,t.jsx)(l.Calendar,{className:"h-4 w-4 opacity-50"})]})}),(0,t.jsx)(c.PopoverContent,{className:"w-auto p-0",align:"start",children:(0,t.jsx)(o.Calendar,{mode:"single",selected:j,onSelect:H,initialFocus:!0,captionLayout:"buttons",className:"p-3 pointer-events-auto",classNames:{caption_label:"hidden",dropdown:"hidden"}})})]})}),(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)(u.Select,{value:j?String(j.getMonth()):void 0,onValueChange:K,children:[(0,t.jsx)(u.SelectTrigger,{children:(0,t.jsx)(u.SelectValue,{placeholder:"Month"})}),(0,t.jsx)(u.SelectContent,{children:V.map(e=>(0,t.jsx)(u.SelectItem,{value:String(e.value),children:e.label},e.value))})]})}),(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)(u.Select,{value:j?String(j.getFullYear()):void 0,onValueChange:z,children:[(0,t.jsx)(u.SelectTrigger,{children:(0,t.jsx)(u.SelectValue,{placeholder:"Year"})}),(0,t.jsx)(u.SelectContent,{children:B.map(e=>(0,t.jsx)(u.SelectItem,{value:String(e),children:e},e))})]})})]}),j&&(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Selected: ",j?(0,d.format)(j,"PPP"):"No date selected"]})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(s.Label,{children:"Tags"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1 mb-2",children:T.map(e=>(0,t.jsxs)(h.Badge,{variant:"secondary",children:[e,(0,t.jsxs)("button",{type:"button",className:"ml-1 rounded-full hover:bg-gray-200",onClick:()=>{A(T.filter(t=>t!==e))},children:[(0,t.jsx)(p.X,{className:"h-3 w-3"}),(0,t.jsx)("span",{className:"sr-only",children:"Remove tag"})]})]},e))}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(a.Input,{value:P,onChange:e=>k(e.target.value),placeholder:"Add tag",onKeyDown:e=>"Enter"===e.key&&(e.preventDefault(),F())}),(0,t.jsx)(n.Button,{type:"button",onClick:F,variant:"outline",children:"Add"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(s.Label,{children:"Social Media"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)(s.Label,{htmlFor:"facebook",className:"text-xs",children:"Facebook"}),(0,t.jsx)(a.Input,{id:"facebook",value:E.facebook,onChange:e=>U(e,"facebook"),placeholder:"Username or URL"})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)(s.Label,{htmlFor:"instagram",className:"text-xs",children:"Instagram"}),(0,t.jsx)(a.Input,{id:"instagram",value:E.instagram,onChange:e=>U(e,"instagram"),placeholder:"Username without @"})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)(s.Label,{htmlFor:"twitter",className:"text-xs",children:"Twitter/X"}),(0,t.jsx)(a.Input,{id:"twitter",value:E.twitter,onChange:e=>U(e,"twitter"),placeholder:"Username without @"})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)(s.Label,{htmlFor:"linkedin",className:"text-xs",children:"LinkedIn"}),(0,t.jsx)(a.Input,{id:"linkedin",value:E.linkedin,onChange:e=>U(e,"linkedin"),placeholder:"Profile URL or username"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(s.Label,{children:"Birthday"}),(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)(c.Popover,{children:[(0,t.jsx)(c.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)(n.Button,{variant:"outline",className:"w-full justify-between",children:[j?j.getDate():"Day",(0,t.jsx)(l.Calendar,{className:"h-4 w-4 opacity-50"})]})}),(0,t.jsx)(c.PopoverContent,{className:"w-auto p-0",align:"start",children:(0,t.jsx)(o.Calendar,{mode:"single",selected:j,onSelect:H,initialFocus:!0,captionLayout:"buttons",className:"p-3 pointer-events-auto",classNames:{caption_label:"hidden",dropdown:"hidden"}})})]})}),(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)(u.Select,{value:j?String(j.getMonth()):void 0,onValueChange:K,children:[(0,t.jsx)(u.SelectTrigger,{children:(0,t.jsx)(u.SelectValue,{placeholder:"Month"})}),(0,t.jsx)(u.SelectContent,{children:V.map(e=>(0,t.jsx)(u.SelectItem,{value:String(e.value),children:e.label},e.value))})]})}),(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)(u.Select,{value:j?String(j.getFullYear()):void 0,onValueChange:z,children:[(0,t.jsx)(u.SelectTrigger,{children:(0,t.jsx)(u.SelectValue,{placeholder:"Year"})}),(0,t.jsx)(u.SelectContent,{children:B.map(e=>(0,t.jsx)(u.SelectItem,{value:String(e),children:e},e))})]})})]}),j&&(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Selected: ",j?(0,d.format)(j,"PPP"):"No date selected"]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(s.Label,{htmlFor:"notes",children:"Notes"}),(0,t.jsx)(i.Textarea,{id:"notes",...D("notes"),rows:4,placeholder:"Add any notes about this customer..."})]}),(0,t.jsxs)(y.DialogFooter,{children:[(0,t.jsx)(n.Button,{variant:"outline",type:"button",onClick:b,children:"Cancel"}),(0,t.jsx)(n.Button,{type:"submit",disabled:S,children:S?"Saving...":"Save Changes"})]})]})})}])},221345,e=>{"use strict";let t=(0,e.i(475254).default)("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);e.s(["Link",()=>t],221345)},283627,e=>{"use strict";let t=(0,e.i(475254).default)("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);e.s(["Edit3",()=>t],283627)},230994,e=>{"use strict";e.s([],264041),e.i(264041),e.i(37451),e.i(654550),e.i(172720),e.i(489855),e.i(933289),e.i(598130),e.i(390326),e.i(872716),e.i(656080),e.i(960014),e.i(903711),e.i(634076),e.i(752304),e.i(532436),e.i(712654);var t=e.i(349479);let r=async e=>{try{if(!e)return console.error("Location ID is required for receipt number generation"),"000001";let r=await (0,t.getNextReceiptNumberAction)(e);if(r.success&&r.data)return r.data;return console.error("Error generating receipt number:",r.error),"000001"}catch(e){return console.error("Error generating receipt number:",e),"000001"}};e.s(["generateReceiptNumber",0,r],230994)},639054,e=>{"use strict";var t=e.i(843476),r=e.i(776639),a=e.i(375050),s=e.i(759684);e.s(["default",0,({open:e,onClose:i,onAddCustomer:n,initialData:l})=>{let o=async e=>(n(e),!0),c=!!l;return(0,t.jsx)(r.Dialog,{open:e,onOpenChange:i,children:(0,t.jsxs)(r.DialogContent,{className:"max-w-2xl max-h-[90vh]",children:[(0,t.jsxs)(r.DialogHeader,{children:[(0,t.jsx)(r.DialogTitle,{children:c?"Edit Customer":"Add New Customer"}),(0,t.jsx)(r.DialogDescription,{children:"Fill in the customer details below. Only name is required."})]}),(0,t.jsx)(s.ScrollArea,{className:"h-[calc(80vh-8rem)]",children:(0,t.jsx)("div",{className:"px-1",children:(0,t.jsx)(a.default,{onSubmit:o,onCancel:i,initialData:l})})})]})})}])},39725,e=>{"use strict";var t=e.i(271645),r=e.i(908406),a=e.i(422713),s=e.i(457786),i=e.i(266027),n=e.i(912598),l=e.i(95187);let o=(0,l.createServerReference)("40227d1c2ed5cbf6324cf519682235031f0a3138a5",l.callServer,void 0,l.findSourceMapURL,"getCustomersAction"),c=(0,l.createServerReference)("708938753470d59bd6fa4ddf41a8a3581263dd393b",l.callServer,void 0,l.findSourceMapURL,"createCustomerAction"),u=(0,l.createServerReference)("609ad415d8b556837c750a19320a30ea6d4beaf896",l.callServer,void 0,l.findSourceMapURL,"updateCustomerAction"),d=(0,l.createServerReference)("40f9d32b0ea15e5c8f0b3441eec79ddb30815f1c83",l.callServer,void 0,l.findSourceMapURL,"deleteCustomerAction");var h=e.i(102594);e.s(["useCustomers",0,(e=50)=>{let[l,p]=(0,t.useState)([]),[m,f]=(0,t.useState)(1),[y,v]=(0,t.useState)(e),[g,b]=(0,t.useState)(0),{toast:S}=(0,r.useToast)(),{currentBusiness:x}=(0,a.useBusiness)(),{user:R}=(0,h.useAuth)(),{logActivity:j}=(0,s.useActivityLogger)(),N=(0,n.useQueryClient)(),w=(0,t.useCallback)(async()=>{if(!x)return{customers:[],count:0};try{let e=await o(x.id);if(!e.success)throw Error(e.error);return{customers:(e.data?.customers||[]).map(e=>({id:e.id,fullName:e.fullName||e.name,phoneNumber:e.phoneNumber||e.phone,email:e.email,birthday:e.birthday?new Date(e.birthday):null,gender:e.gender,location:e.location||e.address,categoryId:e.categoryId,notes:e.notes,tags:e.tags,socialMedia:e.socialMedia||null,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)})),count:e.data?.count||0}}catch(e){return console.error("Error loading customers:",e),S({title:"Error",description:"Failed to load customers. Please try again.",variant:"destructive"}),{customers:[],count:0}}},[x?.id,S]),C=["customers",x?.id],{data:E,isLoading:I,isFetching:T}=(0,i.useQuery)({queryKey:C,queryFn:w,enabled:!!x?.id,staleTime:3e5,gcTime:18e5,refetchOnWindowFocus:!1,refetchOnReconnect:!1});(0,t.useEffect)(()=>{E&&(p(E.customers),b(E.count))},[E]);let A=async e=>{if(!x)return S({title:"Error",description:"No business selected",variant:"destructive"}),null;try{if(!R)throw Error("User not authenticated");let t={fullName:e.fullName,phoneNumber:e.phoneNumber||null,email:e.email||null,birthday:e.birthday?.toISOString().split("T")[0]||null,gender:e.gender||null,location:e.location||null,categoryId:e.categoryId||null,notes:e.notes||null,tags:e.tags||null,socialMedia:e.socialMedia||null},r=await c(x.id,R.id,t);if(!r.success||!r.data)throw Error(r.error||"Failed to create customer");let a=r.data,s={id:a.id,fullName:a.name||a.fullName,phoneNumber:a.phone||a.phoneNumber,email:a.email,birthday:a.birthday?new Date(a.birthday):null,gender:a.gender,location:a.address||a.location,categoryId:a.categoryId,notes:a.notes,tags:a.tags,socialMedia:a.socialMedia,createdAt:new Date(a.createdAt),updatedAt:new Date(a.updatedAt)};return p(e=>[s,...e]),b(e=>e+1),N.setQueryData(C,e=>e?{customers:[s,...e.customers],count:(e.count||0)+1}:{customers:[s],count:1}),await j({activityType:"CREATE",module:"CUSTOMERS",entityType:"customer",entityId:a.id,entityName:e.fullName,description:`Created customer "${e.fullName}"`,metadata:{phoneNumber:e.phoneNumber,email:e.email,location:e.location}}),S({title:"Success",description:"Customer created successfully"}),a}catch(e){return console.error("Error creating customer:",e),S({title:"Error",description:"Failed to create customer. Please try again.",variant:"destructive"}),null}},P=async(e,t)=>{try{let r={};void 0!==t.fullName&&(r.fullName=t.fullName),void 0!==t.phoneNumber&&(r.phoneNumber=t.phoneNumber),void 0!==t.email&&(r.email=t.email),void 0!==t.birthday&&(r.birthday=t.birthday?.toISOString()),void 0!==t.gender&&(r.gender=t.gender),void 0!==t.location&&(r.location=t.location),void 0!==t.categoryId&&(r.categoryId=t.categoryId),void 0!==t.notes&&(r.notes=t.notes),void 0!==t.tags&&(r.tags=t.tags),void 0!==t.socialMedia&&(r.socialMedia=t.socialMedia);let a=await u(e,r);if(!a.success)throw Error(a.error||"Failed to update customer");p(r=>r.map(r=>r.id===e?{...r,...t}:r)),N.setQueryData(C,r=>r?{...r,customers:r.customers.map(r=>r.id===e?{...r,...t}:r)}:r);let s=l.find(t=>t.id===e);return s&&await j({activityType:"UPDATE",module:"CUSTOMERS",entityType:"customer",entityId:e,entityName:s.fullName,description:`Updated customer "${s.fullName}"`,metadata:{updates:t}}),S({title:"Success",description:"Customer updated successfully"}),!0}catch(e){return console.error("Error updating customer:",e),S({title:"Error",description:"Failed to update customer. Please try again.",variant:"destructive"}),!1}},k=async e=>{try{let t=l.find(t=>t.id===e),r=await d(e);if(!r.success)throw Error(r.error||"Failed to delete customer");return p(t=>t.filter(t=>t.id!==e)),b(e=>Math.max(0,e-1)),N.setQueryData(C,t=>{if(!t)return t;let{customers:r,count:a}=t;return{customers:r.filter(t=>t.id!==e),count:Math.max(0,(a||0)-1)}}),N.invalidateQueries({queryKey:C}),t&&await j({activityType:"DELETE",module:"CUSTOMERS",entityType:"customer",entityId:e,entityName:t.fullName,description:`Deleted customer "${t.fullName}"`,metadata:{phoneNumber:t.phoneNumber,email:t.email}}),S({title:"Success",description:"Customer deleted successfully"}),!0}catch(e){return console.error("Error deleting customer:",e),S({title:"Error",description:"Failed to delete customer. Please try again.",variant:"destructive"}),!1}};return{customers:l,isLoading:I&&!E,createCustomer:A,addCustomer:A,updateCustomer:P,deleteCustomer:k,loadCustomers:w,page:m,setPage:f,pageSize:y,setPageSize:v,totalCount:g}}],39725)},598130,390326,872716,656080,e=>{"use strict";var t=e.i(95187);let r=(0,t.createServerReference)("60048cacdf8f6ab02d12e637338fb3a82838e3ab18",t.callServer,void 0,t.findSourceMapURL,"getRequisitionsAction");e.s(["getRequisitionsAction",()=>r],598130);let a=(0,t.createServerReference)("40e343dbe89cc3fb8304b10c9c62480d17ad426333",t.callServer,void 0,t.findSourceMapURL,"createRequisitionAction");e.s(["createRequisitionAction",()=>a],390326);let s=(0,t.createServerReference)("701e152aafbc4d4daee38965467b93e083a6e967b4",t.callServer,void 0,t.findSourceMapURL,"updateRequisitionAction");e.s(["updateRequisitionAction",()=>s],872716);let i=(0,t.createServerReference)("605622308fa711a2f7465dc0a63c7e00dbe7c0418e",t.callServer,void 0,t.findSourceMapURL,"deleteRequisitionAction");e.s(["deleteRequisitionAction",()=>i],656080)},532436,712654,e=>{"use strict";var t=e.i(95187);let r=(0,t.createServerReference)("4035262824370ccd2af8788671f3cc8435d165a93b",t.callServer,void 0,t.findSourceMapURL,"getActivityByEntityIdsAction");e.s(["getActivityByEntityIdsAction",()=>r],532436);let a=(0,t.createServerReference)("60eb8a3f21a0957ca35a2a3606c2b8e1d21977469d",t.callServer,void 0,t.findSourceMapURL,"updateStockHistoryDatesAction");e.s(["updateStockHistoryDatesAction",()=>a],712654)},929592,e=>{"use strict";var t=e.i(843476),r=e.i(271645),a=e.i(225913),s=e.i(975157);let i=(0,a.cva)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),n=r.forwardRef(({className:e,variant:r,...a},n)=>(0,t.jsx)("div",{ref:n,role:"alert",className:(0,s.cn)(i({variant:r}),e),...a}));n.displayName="Alert";let l=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)("h5",{ref:a,className:(0,s.cn)("mb-1 font-medium leading-none tracking-tight",e),...r}));l.displayName="AlertTitle";let o=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)("div",{ref:a,className:(0,s.cn)("text-sm [&_p]:leading-relaxed",e),...r}));o.displayName="AlertDescription",e.s(["Alert",()=>n,"AlertDescription",()=>o,"AlertTitle",()=>l])},286536,e=>{"use strict";let t=(0,e.i(475254).default)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Eye",()=>t],286536)},772436,e=>{"use strict";var t=e.i(843476),r=e.i(271645);e.i(174080);var a=e.i(991918),s=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,s)=>{let i=(0,a.createSlot)(`Primitive.${s}`),n=r.forwardRef((e,r)=>{let{asChild:a,...n}=e;return"u">typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,t.jsx)(a?i:s,{...n,ref:r})});return n.displayName=`Primitive.${s}`,{...e,[s]:n}},{}),i="horizontal",n=["horizontal","vertical"],l=r.forwardRef((e,r)=>{var a;let{decorative:l,orientation:o=i,...c}=e,u=(a=o,n.includes(a))?o:i;return(0,t.jsx)(s.div,{"data-orientation":u,...l?{role:"none"}:{"aria-orientation":"vertical"===u?u:void 0,role:"separator"},...c,ref:r})});l.displayName="Separator";var o=e.i(975157);let c=r.forwardRef(({className:e,orientation:r="horizontal",decorative:a=!0,...s},i)=>(0,t.jsx)(l,{ref:i,decorative:a,orientation:r,className:(0,o.cn)("shrink-0 bg-border","horizontal"===r?"h-[1px] w-full":"h-full w-[1px]",e),...s}));c.displayName=l.displayName,e.s(["Separator",()=>c],772436)},37451,172720,489855,933289,e=>{"use strict";var t=e.i(95187);let r=(0,t.createServerReference)("6055d418bbb34217108fb09f6c6e07a1977765bffb",t.callServer,void 0,t.findSourceMapURL,"getStockHistoryAction");e.s(["getStockHistoryAction",()=>r],37451);let a=(0,t.createServerReference)("60b4fb287dfbc2b628cca363587f00d76a36f3623b",t.callServer,void 0,t.findSourceMapURL,"recalculateStockChainAction");e.s(["recalculateStockChainAction",()=>a],172720);let s=(0,t.createServerReference)("60428e59105c2448bb202e52e31bf2d4492d8468f7",t.callServer,void 0,t.findSourceMapURL,"deleteStockHistoryEntriesByReferenceAction");e.s(["deleteStockHistoryEntriesByReferenceAction",()=>s],489855);let i=(0,t.createServerReference)("70e0c90d8c965637b3ae61b1f0dd8fc9a41ea083d6",t.callServer,void 0,t.findSourceMapURL,"updateStockHistoryDatesByReferenceAction");e.s(["updateStockHistoryDatesByReferenceAction",()=>i],933289)},908962,224410,e=>{"use strict";var t=e.i(271645),r=e.i(160615),a=e.i(422713),s=e.i(266027),i=e.i(912598);let n=e=>{let t=Object.keys(localStorage),r=["allProductsStats_","stockSummary_","soldItems_","dashboardData_","analyticsData_"],a=0;t.forEach(e=>{r.some(t=>e.startsWith(t))&&(localStorage.removeItem(e),a++)}),a>0&&console.log(`[Cache] Cleared ${a} inventory-related localStorage entries.`),e&&(console.log("[Cache] Invalidating React Query inventory keys..."),e.invalidateQueries({queryKey:["inventory_global_stats"]}),e.invalidateQueries({queryKey:["stockSummary"]}),e.invalidateQueries({queryKey:["products"]}),e.invalidateQueries({queryKey:["sales"]}),e.invalidateQueries({queryKey:["all-products-for-scanner"]}),e.invalidateQueries({queryKey:["all-products"]}))};e.s(["clearInventoryCaches",0,n],224410);var l=e.i(555781);e.s(["useProducts",0,(e,o=50)=>{let[c,u]=(0,t.useState)([]),[d,h]=(0,t.useState)(1),[p,m]=(0,t.useState)(o),[f,y]=(0,t.useState)(0),[v,g]=(0,t.useState)(!1),{settings:b}=(0,r.useBusinessSettings)(),{currentBusiness:S}=(0,a.useBusiness)(),x=(0,i.useQueryClient)(),[R,j]=(0,t.useState)({search:"",category:"all",stockStatus:"all"}),[N,w]=(0,t.useState)(null),C=(0,t.useCallback)(e=>{e.search!==R.search&&(g(!0),N&&clearTimeout(N),w(setTimeout(()=>{g(!1)},600))),j(e)},[R.search,N]),E=(0,t.useCallback)(async()=>{if(!e||!S)return{products:[],count:0};try{return await (0,l.getProductsAction)({userId:e,businessId:S.id,page:d,pageSize:p,search:R.search,category:"all"===R.category?void 0:R.category,stockStatus:R.stockStatus})}catch(e){return console.error("Error loading products from server action:",e),{products:[],count:0}}},[e,S?.id,d,p,R.search,R.category,R.stockStatus]),I=(0,t.useMemo)(()=>["products",e,S?.id],[e,S?.id]),T=(0,t.useMemo)(()=>[...I,d,p,R.search,R.category,R.stockStatus],[I,d,p,R.search,R.category,R.stockStatus]),{data:A,isLoading:P,isFetching:k,refetch:M}=(0,s.useQuery)({queryKey:T,queryFn:E,enabled:!!e&&!!S?.id,staleTime:3e4,gcTime:18e5,refetchOnWindowFocus:!0,refetchOnReconnect:!0});(0,t.useEffect)(()=>{A&&(u(A.products),y(A.count))},[A]);let Q=async t=>{try{if(!e)return null;return console.warn("Image upload redirecting to server action (TODO)"),null}catch(e){return console.error("Error in uploadProductImage:",e),null}};return{products:c,isLoading:P&&!A&&!v,loadProducts:E,page:d,setPage:h,pageSize:p,setPageSize:m,totalCount:f,createProduct:async t=>{try{if(!e||!S)return null;let r=await (0,l.createProductAction)({...t,userId:e,businessId:S.id});if(!r)return null;return u(e=>[r,...e]),y(e=>e+1),x.invalidateQueries({queryKey:I}),n(x),r}catch(e){return console.error("Error creating product:",e),null}},updateProduct:async(t,r,a,s=!1,i,o,c,u)=>{try{if(!e||!S)return!1;let o=r.imageUrl;if(a&&(o=await Q(a)),!await (0,l.updateProductAction)(t,{...r,imageUrl:o,userId:e,businessId:S.id,isFromSale:s,customChangeReason:i,referenceId:c}))return!1;return x.invalidateQueries({queryKey:I}),n(x),!0}catch(e){return console.error("Error updating product:",e),!1}},updateProductsBulk:async(t,r,a,s,i,o)=>{try{if(!e||!S)return!1;let r=await (0,l.updateProductsBulkAction)(t.map(e=>({id:e.id,updated:e.updated})),S.id);return r&&(x.invalidateQueries({queryKey:I}),n(x)),r}catch(e){return console.error("Error in bulk update:",e),!1}},deleteProduct:async t=>{try{if(!e)return!1;if(await (0,l.deleteProductAction)(t))return x.invalidateQueries({queryKey:I}),n(x),!0;return!1}catch(e){return console.error("Error deleting product:",e),!1}},uploadProductImage:Q,refetch:M,isFetching:k,filters:R,setFilters:C}}],908962)},555781,(e,t,r)=>{let a=Error("Could not parse module '[project]/src/app/actions/products.ts'\n\n'import', and 'export' cannot be used outside of module code");throw a.code="MODULE_UNPARSABLE",a},266027,e=>{"use strict";let t;var r=e.i(175555),a=e.i(540143),s=e.i(286491),i=e.i(915823),n=e.i(793803),l=e.i(619273),o=e.i(180166),c=class extends i.Subscribable{constructor(e,t){super(),this.options=t,this.#e=e,this.#t=null,this.#r=(0,n.pendingThenable)(),this.bindMethods(),this.setOptions(t)}#e;#a=void 0;#s=void 0;#i=void 0;#n;#l;#r;#t;#o;#c;#u;#d;#h;#p;#m=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){1===this.listeners.size&&(this.#a.addObserver(this),u(this.#a,this.options)?this.#f():this.updateResult(),this.#y())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return d(this.#a,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return d(this.#a,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#v(),this.#g(),this.#a.removeObserver(this)}setOptions(e){let t=this.options,r=this.#a;if(this.options=this.#e.defaultQueryOptions(e),void 0!==this.options.enabled&&"boolean"!=typeof this.options.enabled&&"function"!=typeof this.options.enabled&&"boolean"!=typeof(0,l.resolveEnabled)(this.options.enabled,this.#a))throw Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#b(),this.#a.setOptions(this.options),t._defaulted&&!(0,l.shallowEqualObjects)(this.options,t)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#a,observer:this});let a=this.hasListeners();a&&h(this.#a,r,this.options,t)&&this.#f(),this.updateResult(),a&&(this.#a!==r||(0,l.resolveEnabled)(this.options.enabled,this.#a)!==(0,l.resolveEnabled)(t.enabled,this.#a)||(0,l.resolveStaleTime)(this.options.staleTime,this.#a)!==(0,l.resolveStaleTime)(t.staleTime,this.#a))&&this.#S();let s=this.#x();a&&(this.#a!==r||(0,l.resolveEnabled)(this.options.enabled,this.#a)!==(0,l.resolveEnabled)(t.enabled,this.#a)||s!==this.#p)&&this.#R(s)}getOptimisticResult(e){var t,r;let a=this.#e.getQueryCache().build(this.#e,e),s=this.createResult(a,e);return t=this,r=s,(0,l.shallowEqualObjects)(t.getCurrentResult(),r)||(this.#i=s,this.#l=this.options,this.#n=this.#a.state),s}getCurrentResult(){return this.#i}trackResult(e,t){return new Proxy(e,{get:(e,r)=>(this.trackProp(r),t?.(r),"promise"===r&&(this.trackProp("data"),this.options.experimental_prefetchInRender||"pending"!==this.#r.status||this.#r.reject(Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(e,r))})}trackProp(e){this.#m.add(e)}getCurrentQuery(){return this.#a}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){let t=this.#e.defaultQueryOptions(e),r=this.#e.getQueryCache().build(this.#e,t);return r.fetch().then(()=>this.createResult(r,t))}fetch(e){return this.#f({...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#i))}#f(e){this.#b();let t=this.#a.fetch(this.options,e);return e?.throwOnError||(t=t.catch(l.noop)),t}#S(){this.#v();let e=(0,l.resolveStaleTime)(this.options.staleTime,this.#a);if(l.isServer||this.#i.isStale||!(0,l.isValidTimeout)(e))return;let t=(0,l.timeUntilStale)(this.#i.dataUpdatedAt,e);this.#d=o.timeoutManager.setTimeout(()=>{this.#i.isStale||this.updateResult()},t+1)}#x(){return("function"==typeof this.options.refetchInterval?this.options.refetchInterval(this.#a):this.options.refetchInterval)??!1}#R(e){this.#g(),this.#p=e,!l.isServer&&!1!==(0,l.resolveEnabled)(this.options.enabled,this.#a)&&(0,l.isValidTimeout)(this.#p)&&0!==this.#p&&(this.#h=o.timeoutManager.setInterval(()=>{(this.options.refetchIntervalInBackground||r.focusManager.isFocused())&&this.#f()},this.#p))}#y(){this.#S(),this.#R(this.#x())}#v(){this.#d&&(o.timeoutManager.clearTimeout(this.#d),this.#d=void 0)}#g(){this.#h&&(o.timeoutManager.clearInterval(this.#h),this.#h=void 0)}createResult(e,t){let r,a=this.#a,i=this.options,o=this.#i,c=this.#n,d=this.#l,m=e!==a?e.state:this.#s,{state:f}=e,y={...f},v=!1;if(t._optimisticResults){let r=this.hasListeners(),n=!r&&u(e,t),l=r&&h(e,a,t,i);(n||l)&&(y={...y,...(0,s.fetchState)(f.data,e.options)}),"isRestoring"===t._optimisticResults&&(y.fetchStatus="idle")}let{error:g,errorUpdatedAt:b,status:S}=y;r=y.data;let x=!1;if(void 0!==t.placeholderData&&void 0===r&&"pending"===S){let e;o?.isPlaceholderData&&t.placeholderData===d?.placeholderData?(e=o.data,x=!0):e="function"==typeof t.placeholderData?t.placeholderData(this.#u?.state.data,this.#u):t.placeholderData,void 0!==e&&(S="success",r=(0,l.replaceData)(o?.data,e,t),v=!0)}if(t.select&&void 0!==r&&!x)if(o&&r===c?.data&&t.select===this.#o)r=this.#c;else try{this.#o=t.select,r=t.select(r),r=(0,l.replaceData)(o?.data,r,t),this.#c=r,this.#t=null}catch(e){this.#t=e}this.#t&&(g=this.#t,r=this.#c,b=Date.now(),S="error");let R="fetching"===y.fetchStatus,j="pending"===S,N="error"===S,w=j&&R,C=void 0!==r,E={status:S,fetchStatus:y.fetchStatus,isPending:j,isSuccess:"success"===S,isError:N,isInitialLoading:w,isLoading:w,data:r,dataUpdatedAt:y.dataUpdatedAt,error:g,errorUpdatedAt:b,failureCount:y.fetchFailureCount,failureReason:y.fetchFailureReason,errorUpdateCount:y.errorUpdateCount,isFetched:y.dataUpdateCount>0||y.errorUpdateCount>0,isFetchedAfterMount:y.dataUpdateCount>m.dataUpdateCount||y.errorUpdateCount>m.errorUpdateCount,isFetching:R,isRefetching:R&&!j,isLoadingError:N&&!C,isPaused:"paused"===y.fetchStatus,isPlaceholderData:v,isRefetchError:N&&C,isStale:p(e,t),refetch:this.refetch,promise:this.#r,isEnabled:!1!==(0,l.resolveEnabled)(t.enabled,e)};if(this.options.experimental_prefetchInRender){let t=void 0!==E.data,r="error"===E.status&&!t,s=e=>{r?e.reject(E.error):t&&e.resolve(E.data)},i=()=>{s(this.#r=E.promise=(0,n.pendingThenable)())},l=this.#r;switch(l.status){case"pending":e.queryHash===a.queryHash&&s(l);break;case"fulfilled":(r||E.data!==l.value)&&i();break;case"rejected":r&&E.error===l.reason||i()}}return E}updateResult(){let e=this.#i,t=this.createResult(this.#a,this.options);if(this.#n=this.#a.state,this.#l=this.options,void 0!==this.#n.data&&(this.#u=this.#a),(0,l.shallowEqualObjects)(t,e))return;this.#i=t;let r=()=>{if(!e)return!0;let{notifyOnChangeProps:t}=this.options,r="function"==typeof t?t():t;if("all"===r||!r&&!this.#m.size)return!0;let a=new Set(r??this.#m);return this.options.throwOnError&&a.add("error"),Object.keys(this.#i).some(t=>this.#i[t]!==e[t]&&a.has(t))};this.#j({listeners:r()})}#b(){let e=this.#e.getQueryCache().build(this.#e,this.options);if(e===this.#a)return;let t=this.#a;this.#a=e,this.#s=e.state,this.hasListeners()&&(t?.removeObserver(this),e.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#y()}#j(e){a.notifyManager.batch(()=>{e.listeners&&this.listeners.forEach(e=>{e(this.#i)}),this.#e.getQueryCache().notify({query:this.#a,type:"observerResultsUpdated"})})}};function u(e,t){return!1!==(0,l.resolveEnabled)(t.enabled,e)&&void 0===e.state.data&&("error"!==e.state.status||!1!==t.retryOnMount)||void 0!==e.state.data&&d(e,t,t.refetchOnMount)}function d(e,t,r){if(!1!==(0,l.resolveEnabled)(t.enabled,e)&&"static"!==(0,l.resolveStaleTime)(t.staleTime,e)){let a="function"==typeof r?r(e):r;return"always"===a||!1!==a&&p(e,t)}return!1}function h(e,t,r,a){return(e!==t||!1===(0,l.resolveEnabled)(a.enabled,e))&&(!r.suspense||"error"!==e.state.status)&&p(e,r)}function p(e,t){return!1!==(0,l.resolveEnabled)(t.enabled,e)&&e.isStaleByTime((0,l.resolveStaleTime)(t.staleTime,e))}e.i(247167);var m=e.i(271645),f=e.i(912598);e.i(843476);var y=m.createContext((t=!1,{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t})),v=m.createContext(!1);v.Provider;var g=(e,t,r)=>t.fetchOptimistic(e).catch(()=>{r.clearReset()});function b(e,t){return function(e,t,r){let s,i=m.useContext(v),n=m.useContext(y),o=(0,f.useQueryClient)(r),c=o.defaultQueryOptions(e);o.getDefaultOptions().queries?._experimental_beforeQuery?.(c);let u=o.getQueryCache().get(c.queryHash);if(c._optimisticResults=i?"isRestoring":"optimistic",c.suspense){let e=e=>"static"===e?e:Math.max(e??1e3,1e3),t=c.staleTime;c.staleTime="function"==typeof t?(...r)=>e(t(...r)):e(t),"number"==typeof c.gcTime&&(c.gcTime=Math.max(c.gcTime,1e3))}s=u?.state.error&&"function"==typeof c.throwOnError?(0,l.shouldThrowError)(c.throwOnError,[u.state.error,u]):c.throwOnError,(c.suspense||c.experimental_prefetchInRender||s)&&!n.isReset()&&(c.retryOnMount=!1),m.useEffect(()=>{n.clearReset()},[n]);let d=!o.getQueryCache().get(c.queryHash),[h]=m.useState(()=>new t(o,c)),p=h.getOptimisticResult(c),b=!i&&!1!==e.subscribed;if(m.useSyncExternalStore(m.useCallback(e=>{let t=b?h.subscribe(a.notifyManager.batchCalls(e)):l.noop;return h.updateResult(),t},[h,b]),()=>h.getCurrentResult(),()=>h.getCurrentResult()),m.useEffect(()=>{h.setOptions(c)},[c,h]),c?.suspense&&p.isPending)throw g(c,h,n);if((({result:e,errorResetBoundary:t,throwOnError:r,query:a,suspense:s})=>e.isError&&!t.isReset()&&!e.isFetching&&a&&(s&&void 0===e.data||(0,l.shouldThrowError)(r,[e.error,a])))({result:p,errorResetBoundary:n,throwOnError:c.throwOnError,query:u,suspense:c.suspense}))throw p.error;if(o.getDefaultOptions().queries?._experimental_afterQuery?.(c,p),c.experimental_prefetchInRender&&!l.isServer&&p.isLoading&&p.isFetching&&!i){let e=d?g(c,h,n):u?.promise;e?.catch(l.noop).finally(()=>{h.updateResult()})}return c.notifyOnChangeProps?p:h.trackResult(p)}(e,c,t)}e.s(["useQuery",()=>b],266027)},709239,e=>{"use strict";var t=e.i(95187);let r=(0,t.createServerReference)("70837cf9b9b85e45a6367e7e3a592457c34a990d2e",t.callServer,void 0,t.findSourceMapURL,"upsertBusinessSettingsAction");e.s(["upsertBusinessSettingsAction",()=>r])},160615,e=>{"use strict";var t=e.i(271645),r=e.i(266027),a=e.i(908406),s=e.i(422713),i=e.i(95187);let n=(0,i.createServerReference)("40290a4fc6b8571a026afeb877566edb807919e482",i.callServer,void 0,i.findSourceMapURL,"getBusinessSettingsAction");var l=e.i(709239);let o=()=>({businessName:"",businessAddress:"",businessPhone:"",businessEmail:"",currency:"UGX",paymentInfo:"",defaultPrintFormat:"standard"});e.s(["convertPaymentMethodsToString",0,e=>e.filter(e=>""!==e.method.trim()||""!==e.accountNumber.trim()||""!==e.accountName.trim()).map(e=>`${e.method}
${e.accountNumber}
${e.accountName}`).join("\n"),"parsePaymentInfo",0,e=>{if(!e||""===e.trim())return[];let t=e.split("\n").filter(e=>""!==e.trim()),r=[];for(let e=0;e<t.length;e+=3)e+2<t.length&&r.push({method:t[e].trim(),accountNumber:t[e+1].trim(),accountName:t[e+2].trim()});return r},"useBusinessSettings",0,()=>{let[e,i]=(0,t.useState)(o()),[c,u]=(0,t.useState)(!1),{toast:d}=(0,a.useToast)(),{currentBusiness:h}=(0,s.useBusiness)(),p=async()=>{if(!h)return o();try{let e=await n(h.id);if(!e)return o();{let t=e.metadata&&"object"==typeof e.metadata&&e.metadata.payment_info||"";return{id:e.id,businessName:e.business_name||"",businessAddress:e.business_address||"",businessPhone:e.business_phone||"",businessEmail:e.business_email||"",businessLogo:e.business_logo||void 0,currency:e.currency||"UGX",signature:e.signature||void 0,paymentInfo:t,defaultPrintFormat:e.metadata&&"object"==typeof e.metadata&&e.metadata.default_print_format||"standard",defaultPrinterName:e.metadata&&"object"==typeof e.metadata&&e.metadata.default_printer_name||"",defaultPrinterType:e.metadata&&"object"==typeof e.metadata&&e.metadata.default_printer_type||"USB",printerPaperSize:e.metadata&&"object"==typeof e.metadata&&e.metadata.printer_paper_size||"58mm"}}}catch(e){return console.error("Error loading business settings:",e),d({title:"Error",description:"Failed to load business settings. Please try again.",variant:"destructive"}),o()}},m=async t=>{if(!h)return console.error("No business selected for updating settings"),d({title:"Error",description:"No business selected",variant:"destructive"}),!1;try{let r={payment_info:t.hasOwnProperty("paymentInfo")?t.paymentInfo:e.paymentInfo||"",default_print_format:t.hasOwnProperty("defaultPrintFormat")?t.defaultPrintFormat:e.defaultPrintFormat||"standard",default_printer_name:t.hasOwnProperty("defaultPrinterName")?t.defaultPrinterName:e.defaultPrinterName||"",default_printer_type:t.hasOwnProperty("defaultPrinterType")?t.defaultPrinterType:e.defaultPrinterType||"USB",printer_paper_size:t.hasOwnProperty("printerPaperSize")?t.printerPaperSize:e.printerPaperSize||"58mm"},a={business_name:t.hasOwnProperty("businessName")?t.businessName:e.businessName,business_address:t.hasOwnProperty("businessAddress")?t.businessAddress:e.businessAddress,business_phone:t.hasOwnProperty("businessPhone")?t.businessPhone:e.businessPhone,business_email:t.hasOwnProperty("businessEmail")?t.businessEmail:e.businessEmail,business_logo:t.hasOwnProperty("businessLogo")?t.businessLogo:e.businessLogo,currency:t.hasOwnProperty("currency")?t.currency:e.currency,signature:t.hasOwnProperty("signature")?t.signature:e.signature,metadata:r},s=await (0,l.upsertBusinessSettingsAction)(h.id,"00000000-0000-0000-0000-000000000000",a);if(!s.success)throw console.error("Supabase error updating business settings:",s.error),Error(s.error);return d({title:"Success",description:"Business settings updated successfully"}),g(),!0}catch(e){return console.error("Error updating business settings:",e),d({title:"Error",description:"Failed to update business settings. Please try again.",variant:"destructive"}),!1}},{data:f,isLoading:y,isFetching:v,refetch:g}=(0,r.useQuery)({queryKey:["businessSettings",h?.id],queryFn:p,enabled:!!h?.id,staleTime:3e5,gcTime:18e5,refetchOnWindowFocus:!1,refetchOnReconnect:!1});return(0,t.useEffect)(()=>{f?i(f):h||i(o())},[f,h]),(0,t.useEffect)(()=>{u(y||v)},[y,v]),{settings:e,isLoading:c,updateSettings:m,loadSettings:p}}],160615)},63209,e=>{"use strict";let t=(0,e.i(475254).default)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);e.s(["AlertCircle",()=>t],63209)},303281,e=>{"use strict";let t=(0,e.i(475254).default)("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]);e.s(["Printer",()=>t],303281)},960014,e=>{"use strict";var t=e.i(95187);let r=(0,t.createServerReference)("7022b270c26116cc720c0fe09926fa8749c32b0ea9",t.callServer,void 0,t.findSourceMapURL,"getStockSummaryReportAction");e.s(["getStockSummaryReportAction",()=>r])},654550,e=>{"use strict";var t=e.i(95187);let r=(0,t.createServerReference)("40193ce83d40b7dbf7c2991866f6d090da71bf2f59",t.callServer,void 0,t.findSourceMapURL,"createStockHistoryAction");e.s(["createStockHistoryAction",()=>r])},634076,e=>{"use strict";var t=e.i(95187);let r=(0,t.createServerReference)("406e0d925bc965618c40bddb0b2011bea951e9b025",t.callServer,void 0,t.findSourceMapURL,"getStockRepairsPreviewAction");e.s(["getStockRepairsPreviewAction",()=>r])},752304,e=>{"use strict";var t=e.i(95187);let r=(0,t.createServerReference)("60a33152b65e6ef5593ff2b5c1d0a77d09216fe7e5",t.callServer,void 0,t.findSourceMapURL,"repairStockChainsAction");e.s(["repairStockChainsAction",()=>r])}]);