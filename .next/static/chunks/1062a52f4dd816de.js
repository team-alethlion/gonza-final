(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,747697,e=>{"use strict";var t=e.i(361277);e.s(["CalendarIcon",()=>t.default])},458425,e=>{"use strict";function t(e){let t=["","thousand","million","billion","trillion","quadrillion"],r=["","ten","twenty","thirty","forty","fifty","sixty","seventy","eighty","ninety"],n=["","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],o=e=>{let t=e.toFixed(2).split("."),r=i(parseInt(t[0]));return t.length>1&&parseInt(t[1])>0?`${r} and ${t[1]}/100`:r},i=e=>{if(0===e)return"zero";if(e<0)return`negative ${i(Math.abs(e))}`;let r="",n=0;for(;e>0;)e%1e3!=0&&(r=`${a(e%1e3)} ${t[n]} ${r}`),e=Math.floor(e/1e3),n++;return r.trim()},a=e=>{if(0===e)return"";let t="";return e>=100&&(t=`${n[Math.floor(e/100)]} hundred `,0==(e%=100))?t.trim():(e<20?t+=n[e]:(t+=`${r[Math.floor(e/10)]}`,e%10>0&&(t+=`-${n[e%10]}`)),t.trim())};return o(e).trim().charAt(0).toUpperCase()+o(e).trim().slice(1)}e.s(["numberToWords",()=>t])},482568,e=>{"use strict";var t,r,n,o;let i,a,s,l,c,u;(r=t||(t={})).Unimplemented="UNIMPLEMENTED",r.Unavailable="UNAVAILABLE";class d extends Error{constructor(e,t,r){super(e),this.message=e,this.code=t,this.data=r}}let m=(i=(o=n="u">typeof globalThis?globalThis:"u">typeof self?self:"u">typeof window?window:e.g).CapacitorCustomPlatform||null,s=(a=o.Capacitor||{}).Plugins=a.Plugins||{},l=()=>{var e,t;return null!==i?i.name:(null==o?void 0:o.androidBridge)?"android":(null==(t=null==(e=null==o?void 0:o.webkit)?void 0:e.messageHandlers)?void 0:t.bridge)?"ios":"web"},c=e=>{var t;return null==(t=a.PluginHeaders)?void 0:t.find(t=>t.name===e)},u=new Map,a.convertFileSrc||(a.convertFileSrc=e=>e),a.getPlatform=l,a.handleError=e=>o.console.error(e),a.isNativePlatform=()=>"web"!==l(),a.isPluginAvailable=e=>{let t=u.get(e);return!!((null==t?void 0:t.platforms.has(l()))||c(e))},a.registerPlugin=(e,r={})=>{let n,o=u.get(e);if(o)return console.warn(`Capacitor plugin "${e}" already registered. Cannot register plugins twice.`),o.proxy;let m=l(),f=c(e),p=async()=>(!n&&m in r?n=n="function"==typeof r[m]?await r[m]():r[m]:null!==i&&!n&&"web"in r&&(n=n="function"==typeof r.web?await r.web():r.web),n),g=r=>{let n,o=(...o)=>{let i=p().then(i=>{let s=((r,n)=>{var o,i;if(f){let t=null==f?void 0:f.methods.find(e=>n===e.name);if(t)if("promise"===t.rtype)return t=>a.nativePromise(e,n.toString(),t);else return(t,r)=>a.nativeCallback(e,n.toString(),t,r);if(r)return null==(o=r[n])?void 0:o.bind(r)}else if(r)return null==(i=r[n])?void 0:i.bind(r);else throw new d(`"${e}" plugin is not implemented on ${m}`,t.Unimplemented)})(i,r);if(s){let e=s(...o);return n=null==e?void 0:e.remove,e}throw new d(`"${e}.${r}()" is not implemented on ${m}`,t.Unimplemented)});return"addListener"===r&&(i.remove=async()=>n()),i};return o.toString=()=>`${r.toString()}() { [capacitor code] }`,Object.defineProperty(o,"name",{value:r,writable:!1,configurable:!1}),o},h=g("addListener"),y=g("removeListener"),S=(e,t)=>{let r=h({eventName:e},t),n=async()=>{y({eventName:e,callbackId:await r},t)},o=new Promise(e=>r.then(()=>e({remove:n})));return o.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await n()},o},b=new Proxy({},{get(e,t){switch(t){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return f?S:h;case"removeListener":return y;default:return g(t)}}});return s[e]=b,u.set(e,{name:e,proxy:b,platforms:new Set([...Object.keys(r),...f?[m]:[]])}),b},a.Exception=d,a.DEBUG=!!a.DEBUG,a.isLoggingEnabled=!!a.isLoggingEnabled,n.Capacitor=a),f=m.registerPlugin;class p{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,t){let r=!1;this.listeners[e]||(this.listeners[e]=[],r=!0),this.listeners[e].push(t);let n=this.windowListeners[e];return n&&!n.registered&&this.addWindowListener(n),r&&this.sendRetainedArgumentsForEvent(e),Promise.resolve({remove:async()=>this.removeListener(e,t)})}async removeAllListeners(){for(let e in this.listeners={},this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t,r){let n=this.listeners[e];if(!n){if(r){let r=this.retainedEventArguments[e];r||(r=[]),r.push(t),this.retainedEventArguments[e]=r}return}n.forEach(e=>e(t))}hasListeners(e){var t;return!!(null==(t=this.listeners[e])?void 0:t.length)}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:e=>{this.notifyListeners(t,e)}}}unimplemented(e="not implemented"){return new m.Exception(e,t.Unimplemented)}unavailable(e="not available"){return new m.Exception(e,t.Unavailable)}async removeListener(e,t){let r=this.listeners[e];if(!r)return;let n=r.indexOf(t);this.listeners[e].splice(n,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){let t=this.retainedEventArguments[e];t&&(delete this.retainedEventArguments[e],t.forEach(t=>{this.notifyListeners(e,t)}))}}let g=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);class h extends p{async getCookies(){let e=document.cookie,t={};return e.split(";").forEach(e=>{if(e.length<=0)return;let[r,n]=e.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");r=r.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent).trim(),n=n.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent).trim(),t[r]=n}),t}async setCookie(e){try{let t=g(e.key),r=g(e.value),n=e.expires?`; expires=${e.expires.replace("expires=","")}`:"",o=(e.path||"/").replace("path=",""),i=null!=e.url&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${r||""}${n}; path=${o}; ${i};`}catch(e){return Promise.reject(e)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(e){return Promise.reject(e)}}async clearCookies(){try{for(let e of document.cookie.split(";")||[])document.cookie=e.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}f("CapacitorCookies",{web:()=>new h});let y=async e=>new Promise((t,r)=>{let n=new FileReader;n.onload=()=>{let e=n.result;t(e.indexOf(",")>=0?e.split(",")[1]:e)},n.onerror=e=>r(e),n.readAsDataURL(e)});class S extends p{async request(e){let t,r,n=((e,t={})=>{let r=Object.assign({method:e.method||"GET",headers:e.headers},t),n=((e={})=>{let t=Object.keys(e);return Object.keys(e).map(e=>e.toLocaleLowerCase()).reduce((r,n,o)=>(r[n]=e[t[o]],r),{})})(e.headers)["content-type"]||"";if("string"==typeof e.data)r.body=e.data;else if(n.includes("application/x-www-form-urlencoded")){let t=new URLSearchParams;for(let[r,n]of Object.entries(e.data||{}))t.set(r,n);r.body=t.toString()}else if(n.includes("multipart/form-data")||e.data instanceof FormData){let t=new FormData;if(e.data instanceof FormData)e.data.forEach((e,r)=>{t.append(r,e)});else for(let r of Object.keys(e.data))t.append(r,e.data[r]);r.body=t;let n=new Headers(r.headers);n.delete("content-type"),r.headers=n}else(n.includes("application/json")||"object"==typeof e.data)&&(r.body=JSON.stringify(e.data));return r})(e,e.webFetchExtra),o=((e,t=!0)=>e?Object.entries(e).reduce((e,r)=>{let n,o,[i,a]=r;return Array.isArray(a)?(o="",a.forEach(e=>{n=t?encodeURIComponent(e):e,o+=`${i}=${n}&`}),o.slice(0,-1)):(n=t?encodeURIComponent(a):a,o=`${i}=${n}`),`${e}&${o}`},"").substr(1):null)(e.params,e.shouldEncodeUrlParams),i=o?`${e.url}?${o}`:e.url,a=await fetch(i,n),s=a.headers.get("content-type")||"",{responseType:l="text"}=a.ok?e:{};switch(s.includes("application/json")&&(l="json"),l){case"arraybuffer":case"blob":r=await a.blob(),t=await y(r);break;case"json":t=await a.json();break;default:t=await a.text()}let c={};return a.headers.forEach((e,t)=>{c[t]=e}),{data:t,headers:c,status:a.status,url:a.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}f("CapacitorHttp",{web:()=>new S}),e.s(["Capacitor",()=>m,"WebPlugin",()=>p,"registerPlugin",()=>f])},804760,e=>{"use strict";var t=e.i(255749);let r=(e,t="Ush")=>{let r=Math.round(e).toLocaleString();return`${t} ${r}`},n=async(e,n)=>{let{filename:o,orientation:i="portrait",format:a="a4",margins:s={top:20,right:20,bottom:20,left:20},returnBlob:l=!1}=n,c=new t.default({orientation:i,unit:"mm",format:a,compress:!0}),u=c.internal.pageSize.getWidth(),d=c.internal.pageSize.getHeight(),m=u-s.left-s.right,f=s.top,p=()=>{c.setLineWidth(.2)},g=(e,t,r,n={})=>{let{fontSize:o=10,fontStyle:i="normal",align:a="left",maxWidth:s}=n;if(c.setFontSize(o),c.setFont("helvetica",i),!s)return c.text(e,t,r,{align:a}),.35*o;{let n=c.splitTextToSize(e,s);return c.text(n,t,r,{align:a}),n.length*(.35*o)}},h=(e,t,r,n,o={})=>{let{fontSize:i=10,fontStyle:a="normal",align:s="left",lineHeight:l=1.2}=o;c.setFontSize(i),c.setFont("helvetica",a);let u=c.splitTextToSize(e,n),d=.35*i*l;return u.forEach((e,n)=>{c.text(e,t,r+n*d,{align:s})}),u.length*d},y=(e,t,r,n)=>{p(),c.line(e,t,r,n)},S=(e,t,r,n,o="S")=>{p(),c.rect(e,t,r,n,o)},b=()=>{S(s.left,s.top,m,d-s.top-s.bottom,"S")},v=e=>f+e>d-s.bottom&&(c.addPage(),f=s.top+10,b(),!0);b();let w=s.left+8,P=m-16;if(f+=8,e.businessLogo)try{let t=new Image;t.crossOrigin="anonymous",await new Promise((r,n)=>{t.onload=()=>{try{let e=document.createElement("canvas"),r=e.getContext("2d");if(r){e.width=t.width,e.height=t.height,r.drawImage(t,0,0);let n=e.toDataURL("image/png"),o=t.width/t.height;c.addImage(n,"PNG",w,f,15*o,15)}}catch(e){console.error("Error adding logo to PDF:",e)}r()},t.onerror=()=>{console.error("Error loading logo image"),r()},t.src=e.businessLogo})}catch(e){console.error("Error processing logo:",e)}let A=.75*P,I=w+P,E=f;if(e.businessName&&(E+=g(e.businessName,I,E,{fontSize:14,fontStyle:"bold",align:"right"}),E+=1.5),e.businessAddress){let t=c.splitTextToSize(e.businessAddress,A);t.forEach((e,t)=>{c.setFontSize(10),c.setFont("helvetica","normal"),c.text(e,I,E+3.15*t,{align:"right"})}),E+=3.15*t.length+.5}e.businessPhone&&(E+=g(`Phone: ${e.businessPhone}`,I,E,{fontSize:9,align:"right"}),E+=.5),e.businessEmail&&(E+=g(`Email: ${e.businessEmail}`,I,E,{fontSize:9,align:"right"}),E+=.5),f=Math.max(f+18,E)+5,v(20),y(w,f,w+P,f),f+=6,f+=g(e.documentTitle.toUpperCase(),u/2,f,{fontSize:16,fontStyle:"bold",align:"center"});let C=f+=4,_=C;_+=g(`${e.documentNumberLabel} ${e.receiptNumber}`,w,_,{fontSize:11,fontStyle:"bold"}),_+=2,_+=g(`Date: ${e.date}`,w,_,{fontSize:10}),_+=2,_+=g(`Time: ${e.time}`,w,_,{fontSize:10});let L=w+.7*P;if(g(`Status: ${e.status}`,L,C,{fontSize:11,fontStyle:"bold",align:"left"}),f=_+4,e.customerName&&""!==e.customerName.trim()){if(v(30),f+=g("Customer Information:",w,f,{fontSize:11,fontStyle:"bold"}),f+=3,f+=g(e.customerName,w,f,{fontSize:10}),f+=2.5,e.customerAddress&&""!==e.customerAddress.trim()){let t=h(e.customerAddress,w,f,.8*P,{fontSize:10,lineHeight:1});f+=t,f+=2.5}e.customerContact&&""!==e.customerContact.trim()&&(f+=g(e.customerContact,w,f,{fontSize:10}),f+=2.5),f+=3}let z=e.items.some(e=>(e.discountPercentage||0)>0||(e.discountAmount||0)>0),$=z?["Description","Qty","Unit Price","Discount","Amount"]:["Description","Qty","Unit Price","Amount"],N=z?[.35*P,.15*P,.18*P,.12*P,.2*P]:[.45*P,.15*P,.2*P,.2*P];c.setFillColor(245,245,245),S(w,f-2,P,10,"F"),S(w,f-2,P,10,"S");let T=w;$.forEach((e,t)=>{g(e,T+3,f+4,{fontSize:10,fontStyle:"bold"}),t<$.length-1&&y(T+N[t],f-2,T+N[t],f+8),T+=N[t]}),f+=10;let F=0;e.items.forEach((t,n)=>{c.setFontSize(9);let o=Math.max(8,3.5*c.splitTextToSize(t.description,N[0]-6).length+4);v(o+5),t.unitPrice,t.quantity,t.discountAmount;let i=t.amount;if(F+=i,n%2==1&&(c.setFillColor(250,250,250),S(w,f,P,o,"F")),S(w,f,P,o,"S"),T=w,h(t.description,T+3,f+4,N[0]-6,{fontSize:9,lineHeight:1.1}),y(T+=N[0],f,T,f+o),g(t.quantity.toString(),T+N[1]-3,f+o/2+1.5,{fontSize:9,align:"right"}),y(T+=N[1],f,T,f+o),g(r(t.unitPrice,e.currency),T+N[2]-3,f+o/2+1.5,{fontSize:9,align:"right"}),y(T+=N[2],f,T,f+o),z){let n="-";(t.discountPercentage||0)>0?n=`${t.discountPercentage}%`:(t.discountAmount||0)>0&&(n=r(t.discountAmount,e.currency)),g(n,T+N[3]-3,f+o/2+1.5,{fontSize:9,align:"right"}),y(T+=N[3],f,T,f+o)}g(r(i,e.currency),T+N[z?4:3]-3,f+o/2+1.5,{fontSize:9,align:"right"}),f+=o,n<e.items.length-1&&y(w,f,w+P,f)}),f+=5,v(70);let x=w+.45*P,k=.55*P,D=.55*k,U=.45*k,O=e.items.reduce((e,t)=>{let r=t.unitPrice*t.quantity;return e+("amount"===t.discountType?t.discountAmount||0:r*(t.discountPercentage||0)/100)},0);if(O>0&&(S(x,f,k,8,"S"),c.setFillColor(248,248,248),S(x,f,k,8,"F"),g("Subtotal (before discount):",x+4,f+5.5,{fontSize:10,fontStyle:"normal"}),y(x+D,f,x+D,f+8),g(r(F+O,e.currency),x+D+U-4,f+5.5,{fontSize:10,fontStyle:"normal",align:"right"}),S(x,f+=8,k,8,"S"),c.setFillColor(255,240,220),S(x,f,k,8,"F"),g("Total Discount:",x+4,f+5.5,{fontSize:10,fontStyle:"normal"}),y(x+D,f,x+D,f+8),g(`-${r(O,e.currency)}`,x+D+U-4,f+5.5,{fontSize:10,fontStyle:"normal",align:"right"}),f+=8),S(x,f,k,8,"S"),c.setFillColor(248,248,248),S(x,f,k,8,"F"),g(O>0?"Subtotal (after discount):":"Subtotal:",x+4,f+5.5,{fontSize:10,fontStyle:"normal"}),y(x+D,f,x+D,f+8),g(r(F,e.currency),x+D+U-4,f+5.5,{fontSize:10,fontStyle:"normal",align:"right"}),f+=8,e.showTaxRow&&e.taxAmount>0&&(S(x,f,k,8,"S"),c.setFillColor(250,250,250),S(x,f,k,8,"F"),g(`Tax (${e.taxRate}%):`,x+4,f+5.5,{fontSize:10,fontStyle:"normal"}),y(x+D,f,x+D,f+8),g(r(e.taxAmount,e.currency),x+D+U-4,f+5.5,{fontSize:10,fontStyle:"normal",align:"right"}),f+=8),S(x,f,k,12,"S"),c.setFillColor(220,220,220),S(x,f,k,12,"F"),g("TOTAL:",x+4,f+7.5,{fontSize:12,fontStyle:"bold"}),y(x+D,f,x+D,f+12),g(r(e.totalAmount,e.currency),x+D+U-4,f+7.5,{fontSize:12,fontStyle:"bold",align:"right"}),f+=12,e.isInstallmentSale&&(void 0!==e.amountPaid&&(S(x,f,k,8,"S"),c.setFillColor(240,248,255),S(x,f,k,8,"F"),g("Amount Paid:",x+4,f+5.5,{fontSize:10,fontStyle:"bold"}),y(x+D,f,x+D,f+8),g(r(e.amountPaid,e.currency),x+D+U-4,f+5.5,{fontSize:10,fontStyle:"bold",align:"right"}),f+=8),void 0!==e.amountDue&&(S(x,f,k,8,"S"),c.setFillColor(255,240,240),S(x,f,k,8,"F"),g("Amount Due:",x+4,f+5.5,{fontSize:10,fontStyle:"bold"}),y(x+D,f,x+D,f+8),g(r(e.amountDue,e.currency),x+D+U-4,f+5.5,{fontSize:10,fontStyle:"bold",align:"right"}),f+=8)),f+=7,e.totalAmountInWords){v(20),g("Amount in words:",w,f+=2,{fontSize:10,fontStyle:"bold"}),f+=4;let t=h(`${e.currency} ${e.totalAmountInWords} only`,w,f,.9*P,{fontSize:10,fontStyle:"italic",lineHeight:1.4});f+=t+4}if(e.hasPaymentInfo&&e.paymentMethods&&e.paymentMethods.length>0){v(40),y(w,f,w+P,f),g("Payment Information:",w,f+=5,{fontSize:11,fontStyle:"bold"}),f+=4;let t=["Payment Method","Account Number","Account Name"],r=[.28*P,.36*P,.36*P];c.setFillColor(240,240,240),S(w,f-2,P,10,"F"),S(w,f-2,P,10,"S");let n=w;t.forEach((e,o)=>{g(e,n+4,f+4,{fontSize:9,fontStyle:"bold"}),o<t.length-1&&y(n+r[o],f-2,n+r[o],f+10-2),n+=r[o]}),f+=10,e.paymentMethods.filter(e=>e.method.trim()||e.accountNumber.trim()||e.accountName.trim()).forEach((e,t)=>{v(15),t%2==1&&(c.setFillColor(248,248,248),S(w,f,P,10,"F")),S(w,f,P,10,"S"),n=w,g(e.method,n+4,f+5,{fontSize:9,fontStyle:"bold"}),y(n+=r[0],f,n,f+10),g(e.accountNumber,n+4,f+5,{fontSize:9}),y(n+=r[1],f,n,f+10),g(e.accountName,n+4,f+5,{fontSize:9}),f+=10}),f+=4}if(e.notes&&e.notes.trim()){v(25),y(w,f,w+P,f),g("Notes:",w,f+=4,{fontSize:11,fontStyle:"bold"}),f+=6;let t=P-8;c.splitTextToSize(e.notes,t).forEach(e=>{v(8),g(e,w+4,f,{fontSize:10}),f+=5}),f+=4}if(e.signature)try{v(35);let t=new Image;t.crossOrigin="anonymous",await new Promise(r=>{t.onload=()=>{try{let e=document.createElement("canvas"),r=e.getContext("2d");if(r){let n,o;e.width=t.width,e.height=t.height,r.drawImage(t,0,0);let i=e.toDataURL("image/png"),a=t.width/t.height;a>2?(n=40,o=40/a):(o=20,n=20*a);let s=w+P-n;y(w,f,w+P,f),f+=4,c.addImage(i,"PNG",s,f,n,o),f+=o+2,g("Authorized Signature",s+n/2,f,{fontSize:8,align:"center"}),f+=4}}catch(e){console.error("Error adding signature to PDF:",e)}r()},t.onerror=()=>{console.error("Error loading signature image"),r()},t.src=e.signature})}catch(e){console.error("Error processing signature:",e)}if(v(25),g("Thank you for your business!",u/2,f+=6,{fontSize:11,fontStyle:"bold",align:"center"}),g("Created by Gonza Systems",u/2,f+=5,{fontSize:9,align:"center"}),l)return c.output("blob");o&&c.save(o)};e.s(["generateReceiptVectorPDF",0,n])},531278,e=>{"use strict";let t=(0,e.i(475254).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],531278)},986387,e=>{"use strict";var t=e.i(102594);e.s(["useCurrentUser",0,()=>{let{user:e}=(0,t.useAuth)();return{userId:e?.id}}])},457786,e=>{"use strict";var t=e.i(95187);let r=(0,t.createServerReference)("401d907b5cd7e0b2f207e9b555ac4fe2e14de08444",t.callServer,void 0,t.findSourceMapURL,"logActivityAction");var n=e.i(986387),o=e.i(422713),i=e.i(777624);e.s(["useActivityLogger",0,()=>{let{userId:e}=(0,n.useCurrentUser)(),{currentBusiness:t}=(0,o.useBusiness)(),a=null;try{let{currentProfile:e}=(0,i.useProfiles)();a=e}catch{a=null}return{logActivity:async n=>{if(!e||!t?.id)return void console.warn("Cannot log activity: missing user or business context");try{let o=await r({userId:e,locationId:t.id,activityType:n.activityType,module:n.module,entityType:n.entityType,entityId:n.entityId||void 0,entityName:n.entityName,description:n.description,metadata:n.metadata||void 0,profileId:a?.id||void 0,profileName:a?.profile_name||void 0});o.success||console.error("Error logging activity:",o.error)}catch(e){console.error("Failed to log activity:",e)}}}}],457786)},589271,e=>{"use strict";e.s(["mapDbProductToProduct",0,e=>({id:e.id,itemNumber:e.item_number,barcode:e.barcode,manufacturerBarcode:e.manufacturer_barcode,name:e.name,description:e.description,category:e.category,quantity:e.quantity,costPrice:Number(e.cost_price),sellingPrice:Number(e.selling_price),supplier:e.supplier,imageUrl:e.image_url,minimumStock:e.minimum_stock,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}),"mapDbSaleToSale",0,e=>{let t=(Array.isArray(e.items)?e.items:[]).map(e=>{let t=void 0!==e.discountPercentage?Number(e.discountPercentage):void 0,r=void 0!==e.discountAmount?Number(e.discountAmount):void 0,n=e.discountType;return!n&&(t&&t>0?n="percentage":r&&r>0&&(n="amount")),{description:e.description||"",quantity:Number(e.quantity)||0,price:Number(e.price)||0,cost:Number(e.cost)||0,productId:e.productId||void 0,discountType:n,discountPercentage:t,discountAmount:r,createdAt:e.createdAt||void 0}});return{id:e.id,receiptNumber:e.receipt_number,customerName:e.customer_name,customerAddress:e.customer_address||"",customerContact:e.customer_contact||"",customerId:e.customer_id||void 0,items:t,paymentStatus:e.payment_status,profit:Number(e.profit),date:new Date(e.date),taxRate:e.tax_rate?Number(e.tax_rate):0,cashTransactionId:e.cash_transaction_id||void 0,amountPaid:e.amount_paid?Number(e.amount_paid):void 0,amountDue:e.amount_due?Number(e.amount_due):void 0,notes:e.notes||"",categoryId:e.category_id||void 0,createdAt:new Date(e.created_at)}},"mapSaleToDbSale",0,(e,t,r,n,o,i,a)=>({user_id:o,location_id:i,receipt_number:n,customer_name:e.customerName,customer_address:e.customerAddress||null,customer_contact:e.customerContact||null,customer_id:e.customerId||null,items:e.items,payment_status:e.paymentStatus,profit:r,date:t.toISOString().split("T")[0],tax_rate:e.taxRate||0,cash_transaction_id:a||null,amount_paid:e.amountPaid||null,amount_due:e.amountDue||null,notes:e.notes||null,category_id:e.categoryId||null})])},146786,850823,617318,e=>{"use strict";var t=e.i(271645),r=e.i(589271),n=e.i(908406),o=e.i(266027),i=e.i(912598),a=e.i(457786),s=e.i(422713),l=e.i(908962),c=e.i(846696),u=e.i(555781);let d=e=>{let{updateProductsBulk:t}=(0,l.useProducts)(e),r=async(e,t)=>{if(!e.length)return[];try{return await (0,u.getProductsByIdsAction)(e,t)}catch(e){throw console.error("Error fetching fresh products:",e),e}};return{deductStockForSale:async(n,o,i,a,s)=>{if(!e)return!1;try{let l=n.filter(e=>e.productId);if(0===l.length)return!0;let u=[...new Set(l.map(e=>e.productId))],d=await r(u,s);if(0===d.length)return!1;let m=new Map;for(let e of l){let t=m.get(e.productId)||0;m.set(e.productId,t+e.quantity)}let f=[];for(let[e,t]of m.entries()){let r=d.find(t=>t.id===e);if(!r)continue;let n=r.quantity-t;f.push({id:e,updated:{...r,quantity:n}}),n<0&&c.toast.warning(`${r.name} inventory is now negative (${n}). Please restock soon.`)}return f.length>0&&await t(f,e,"Sale",o,i,a),!0}catch(e){return console.error("Error deducting stock for sale:",e),!1}},restoreStockForSale:async(n,o,i,a)=>{if(!e)return!1;try{let s=n.filter(e=>e.productId);if(0===s.length)return!0;let l=[...new Set(s.map(e=>e.productId))],c=await r(l,a),u=new Map;for(let e of s){let t=u.get(e.productId)||0;u.set(e.productId,t+e.quantity)}let d=[];for(let[e,t]of u.entries()){let r=c.find(t=>t.id===e);if(!r)continue;let n=r.quantity+t;d.push({id:e,updated:{...r,quantity:n}})}return d.length>0&&await t(d,e,"Deleted Sale",o,void 0,i),!0}catch(e){return console.error("Error restoring stock for sale:",e),!1}},adjustStockForEditedSale:async(n,o,i,a,s,l)=>{if(!e)return!1;try{let u=[...n.filter(e=>e.productId).map(e=>e.productId),...o.filter(e=>e.productId).map(e=>e.productId)],d=[...new Set(u)];if(0===d.length)return!0;let m=await r(d,l),f=new Map;for(let e of n.filter(e=>e.productId)){let t=f.get(e.productId)||0;f.set(e.productId,t+e.quantity)}for(let e of o.filter(e=>e.productId)){let t=f.get(e.productId)||0;f.set(e.productId,t-e.quantity)}let p=[];for(let[e,t]of f.entries()){if(0===t)continue;let r=m.find(t=>t.id===e);if(!r)continue;let n=r.quantity+t;p.push({id:e,updated:{...r,quantity:n}}),n<0&&c.toast.warning(`${r.name} inventory is now negative (${n}). Please restock soon.`)}return p.length>0&&await t(p,e,"Sale Status/Qty Edit",i,a,s),!0}catch(e){return console.error("Error adjusting stock for edited sale:",e),!1}}}};e.s(["useInventoryActions",0,d],850823);var m=e.i(224410),f=e.i(95187);let p=(0,f.createServerReference)("703e9376bfaf2adbf9aba886e70ba6b561f6bf5e0c",f.callServer,void 0,f.findSourceMapURL,"getSalesAction"),g=(0,f.createServerReference)("40d9064371ce5c0811194879498fdc849fbf872b8a",f.callServer,void 0,f.findSourceMapURL,"deleteSaleAction");e.s(["deleteSaleAction",()=>g],617318),e.s(["useSalesData",0,(e,l="desc",c)=>{let u=(0,i.useQueryClient)(),{toast:f}=(0,n.useToast)(),{logActivity:h}=(0,a.useActivityLogger)(),{currentBusiness:y}=(0,s.useBusiness)(),{restoreStockForSale:S}=d(e),b=(0,t.useCallback)(async()=>{try{if(!e||!y)return[];let t=await p(y.id,l,c);return t?t.map(e=>{let t={id:e.id,user_id:e.user_id,location_id:e.location_id,receipt_number:e.receipt_number,customer_name:e.customer_name,customer_address:e.customer_address,customer_contact:e.customer_contact,customer_id:e.customer_id,items:e.items,payment_status:e.payment_status,profit:e.profit?Number(e.profit):0,date:e.date,tax_rate:e.tax_rate||0,created_at:e.created_at,updated_at:e.updated_at,cash_transaction_id:e.cash_transaction_id,amount_paid:e.amount_paid?Number(e.amount_paid):void 0,amount_due:e.amount_due?Number(e.amount_due):void 0,category_id:e.category_id,notes:e.notes};return(0,r.mapDbSaleToSale)(t)}):[]}catch(e){return console.error("Error loading sales:",e),f({title:"Error",description:"Failed to load sales data. Please try again.",variant:"destructive"}),[]}},[e,y?.id,l,c,f]),v=(0,t.useMemo)(()=>["sales",y?.id,e],[y?.id,e]),w=(0,t.useMemo)(()=>[...v,l,c],[v,l,c]),{data:P=[],isLoading:A,isFetching:I,refetch:E}=(0,o.useQuery)({queryKey:w,queryFn:b,enabled:!!e&&!!y?.id,staleTime:3e4,gcTime:18e5,refetchOnWindowFocus:!0,refetchOnReconnect:!0}),C=A||I&&0===P.length,_=(0,t.useMemo)(()=>{let e=P.filter(e=>"Quote"!==e.paymentStatus),t=new Map;return e.forEach(e=>{let r=e.customerName,n=e.items.reduce((e,t)=>e+t.price*t.quantity,0);if(t.has(r)){let o=t.get(r);t.set(r,{total:o.total+n,count:o.count+1,customerId:o.customerId||e.customerId})}else t.set(r,{total:n,count:1,customerId:e.customerId})}),Array.from(t.entries()).map(([e,t])=>({id:t.customerId,name:e,totalPurchases:t.total,orderCount:t.count})).sort((e,t)=>t.totalPurchases-e.totalPurchases)},[P]),L=(0,t.useMemo)(()=>e=>{let t=P.filter(t=>t.customerName.toLowerCase()===e.toLowerCase()&&"Quote"!==t.paymentStatus);return{total:t.reduce((e,t)=>e+t.items.reduce((e,t)=>e+t.price*t.quantity,0),0),count:t.length}},[P]),z=async e=>{try{let t=P.find(t=>t.id===e);if(!t)throw Error("Sale not found");if("Quote"!==t.paymentStatus&&t.items.length>0&&(console.log("Restoring product quantities via useInventoryActions..."),await S(t.items,e,t.receiptNumber,y?.id)||f({title:"Inventory Update Warning",description:"Sale deleted, but inventory restoration might have failed. Please check your stock levels.",variant:"destructive"})),!y?.id)throw Error("Business context missing for deletion");let r=await g(e,y.id);if(!r.success)throw Error(r.error);return u.setQueryData(w,t=>t?t.filter(t=>t.id!==e):[]),u.invalidateQueries({queryKey:v}),$(),await h({activityType:"DELETE",module:"SALES",entityType:"sale",entityId:e,entityName:`Sale #${t.receiptNumber}`,description:`Deleted sale for ${t.customerName} - Total: UGX ${((t.amountPaid||0)+(t.amountDue||0)).toLocaleString()} (Stock restored)`,metadata:{receiptNumber:t.receiptNumber,customerName:t.customerName,customerAddress:t.customerAddress,customerContact:t.customerContact,totalAmount:(t.amountPaid||0)+(t.amountDue||0),amountPaid:t.amountPaid,profit:t.profit,paymentStatus:t.paymentStatus,taxRate:t.taxRate,itemCount:t.items.length,items:t.items.map(e=>({description:e.description,quantity:e.quantity,price:e.price,cost:e.cost,total:e.quantity*e.price,discountPercentage:e.discountPercentage,discountAmount:e.discountAmount})),notes:t.notes,cashTransactionDeleted:!!t.cashTransactionId}}),f({title:"Sale Deleted",description:"The sale record and associated data have been successfully deleted."}),(0,m.clearInventoryCaches)(),!0}catch(e){return console.error("Error deleting sale:",e),f({title:"Error",description:"Failed to delete sale. Please try again.",variant:"destructive"}),!1}},$=(0,t.useCallback)(()=>{if(!y?.id)return;let e=`soldItemsFilters_${y.id}`;localStorage.removeItem(e),localStorage.removeItem("soldItemsFilters")},[y?.id]);return{sales:P,isLoading:C,deleteSale:z,addSale:(0,t.useCallback)(e=>{u.setQueryData(w,t=>t?[e,...t]:[e]),u.invalidateQueries({queryKey:v}),$(),(0,m.clearInventoryCaches)()},[u,w,v,$,m.clearInventoryCaches]),updateSale:(0,t.useCallback)(e=>{u.setQueryData(w,t=>t?t.map(t=>t.id===e.id?e:t):[e]),u.invalidateQueries({queryKey:v}),$(),(0,m.clearInventoryCaches)()},[u,w,v,$,m.clearInventoryCaches]),getTopCustomers:_,getCustomerLifetimePurchases:L,clearSoldItemsCache:$,refetch:E,isFetching:I}}],146786)}]);