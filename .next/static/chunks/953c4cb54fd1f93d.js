(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,759279,e=>{"use strict";let t=(0,e.i(369547).default)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);e.s(["Upload",()=>t],759279)},322138,e=>{"use strict";let t=(0,e.i(369547).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],322138)},675878,e=>{"use strict";let t=(0,e.i(369547).default)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);e.s(["AlertCircle",()=>t],675878)},626427,e=>{"use strict";var t=e.i(391398),r=e.i(191788),n=e.i(648684),a=e.i(353533);let o=(0,n.cva)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),i=r.forwardRef(({className:e,variant:r,...n},i)=>(0,t.jsx)("div",{ref:i,role:"alert",className:(0,a.cn)(o({variant:r}),e),...n}));i.displayName="Alert";let s=r.forwardRef(({className:e,...r},n)=>(0,t.jsx)("h5",{ref:n,className:(0,a.cn)("mb-1 font-medium leading-none tracking-tight",e),...r}));s.displayName="AlertTitle";let l=r.forwardRef(({className:e,...r},n)=>(0,t.jsx)("div",{ref:n,className:(0,a.cn)("text-sm [&_p]:leading-relaxed",e),...r}));l.displayName="AlertDescription",e.s(["Alert",()=>i,"AlertDescription",()=>l,"AlertTitle",()=>s])},443915,e=>{"use strict";var t=e.i(391398),r=e.i(191788),n=e.i(353533);let a=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)("textarea",{className:(0,n.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:a,...r}));a.displayName="Textarea",e.s(["Textarea",()=>a])},151670,e=>{"use strict";var t=e.i(921161);e.s(["Calendar",()=>t.default])},641405,e=>{"use strict";let t=(0,e.i(369547).default)("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]);e.s(["Printer",()=>t],641405)},8745,(e,t,r)=>{let n=Error("Could not parse module '[project]/src/app/actions/products.ts'\n\n'import', and 'export' cannot be used outside of module code");throw n.code="MODULE_UNPARSABLE",n},355879,775778,e=>{"use strict";var t=e.i(191788),r=e.i(563905),n=e.i(46108),a=e.i(893930),o=e.i(285700);let i=e=>{let t=Object.keys(localStorage),r=["allProductsStats_","stockSummary_","soldItems_","dashboardData_","analyticsData_"],n=0;t.forEach(e=>{r.some(t=>e.startsWith(t))&&(localStorage.removeItem(e),n++)}),n>0&&console.log(`[Cache] Cleared ${n} inventory-related localStorage entries.`),e&&(console.log("[Cache] Invalidating React Query inventory keys..."),e.invalidateQueries({queryKey:["inventory_global_stats"]}),e.invalidateQueries({queryKey:["stockSummary"]}),e.invalidateQueries({queryKey:["products"]}),e.invalidateQueries({queryKey:["sales"]}),e.invalidateQueries({queryKey:["all-products-for-scanner"]}),e.invalidateQueries({queryKey:["all-products"]}))};e.s(["clearInventoryCaches",0,i],775778);var s=e.i(8745);e.s(["useProducts",0,(e,l=50)=>{let[c,u]=(0,t.useState)([]),[d,f]=(0,t.useState)(1),[m,p]=(0,t.useState)(l),[g,y]=(0,t.useState)(0),[h,v]=(0,t.useState)(!1),{settings:x}=(0,r.useBusinessSettings)(),{currentBusiness:b}=(0,n.useBusiness)(),w=(0,o.useQueryClient)(),[j,P]=(0,t.useState)({search:"",category:"all",stockStatus:"all"}),[N,k]=(0,t.useState)(null),C=(0,t.useCallback)(e=>{e.search!==j.search&&(v(!0),N&&clearTimeout(N),k(setTimeout(()=>{v(!1)},600))),P(e)},[j.search,N]),E=(0,t.useCallback)(async()=>{if(!e||!b)return{products:[],count:0};try{return await (0,s.getProductsAction)({userId:e,businessId:b.id,page:d,pageSize:m,search:j.search,category:"all"===j.category?void 0:j.category,stockStatus:j.stockStatus})}catch(e){return console.error("Error loading products from server action:",e),{products:[],count:0}}},[e,b?.id,d,m,j.search,j.category,j.stockStatus]),S=(0,t.useMemo)(()=>["products",e,b?.id],[e,b?.id]),_=(0,t.useMemo)(()=>[...S,d,m,j.search,j.category,j.stockStatus],[S,d,m,j.search,j.category,j.stockStatus]),{data:R,isLoading:O,isFetching:F,refetch:T}=(0,a.useQuery)({queryKey:_,queryFn:E,enabled:!!e&&!!b?.id,staleTime:3e4,gcTime:18e5,refetchOnWindowFocus:!0,refetchOnReconnect:!0});(0,t.useEffect)(()=>{R&&(u(R.products),y(R.count))},[R]);let A=async t=>{try{if(!e)return null;return console.warn("Image upload redirecting to server action (TODO)"),null}catch(e){return console.error("Error in uploadProductImage:",e),null}};return{products:c,isLoading:O&&!R&&!h,loadProducts:E,page:d,setPage:f,pageSize:m,setPageSize:p,totalCount:g,createProduct:async t=>{try{if(!e||!b)return null;let r=await (0,s.createProductAction)({...t,userId:e,businessId:b.id});if(!r)return null;return u(e=>[r,...e]),y(e=>e+1),w.invalidateQueries({queryKey:S}),i(w),r}catch(e){return console.error("Error creating product:",e),null}},updateProduct:async(t,r,n,a=!1,o,l,c,u)=>{try{if(!e||!b)return!1;let l=r.imageUrl;if(n&&(l=await A(n)),!await (0,s.updateProductAction)(t,{...r,imageUrl:l,userId:e,businessId:b.id,isFromSale:a,customChangeReason:o,referenceId:c}))return!1;return w.invalidateQueries({queryKey:S}),i(w),!0}catch(e){return console.error("Error updating product:",e),!1}},updateProductsBulk:async(t,r,n,a,o,l)=>{try{if(!e||!b)return!1;let r=await (0,s.updateProductsBulkAction)(t.map(e=>({id:e.id,updated:e.updated})),b.id);return r&&(w.invalidateQueries({queryKey:S}),i(w)),r}catch(e){return console.error("Error in bulk update:",e),!1}},deleteProduct:async t=>{try{if(!e)return!1;if(await (0,s.deleteProductAction)(t))return w.invalidateQueries({queryKey:S}),i(w),!0;return!1}catch(e){return console.error("Error deleting product:",e),!1}},uploadProductImage:A,refetch:T,isFetching:F,filters:j,setFilters:C}}],355879)},398957,e=>{"use strict";let t=(0,e.i(369547).default)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);e.s(["RefreshCw",()=>t],398957)},386408,e=>{"use strict";let t=(0,e.i(369547).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>t],386408)},920955,(e,t,r)=>{var n={229:function(e){var t,r,n,a=e.exports={};function o(){throw Error("setTimeout has not been defined")}function i(){throw Error("clearTimeout has not been defined")}try{t="function"==typeof setTimeout?setTimeout:o}catch(e){t=o}try{r="function"==typeof clearTimeout?clearTimeout:i}catch(e){r=i}function s(e){if(t===setTimeout)return setTimeout(e,0);if((t===o||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}var l=[],c=!1,u=-1;function d(){c&&n&&(c=!1,n.length?l=n.concat(l):u=-1,l.length&&f())}function f(){if(!c){var e=s(d);c=!0;for(var t=l.length;t;){for(n=l,l=[];++u<t;)n&&n[u].run();u=-1,t=l.length}n=null,c=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===i||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function p(){}a.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];l.push(new m(e,t)),1!==l.length||c||s(f)},m.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=p,a.addListener=p,a.once=p,a.off=p,a.removeListener=p,a.removeAllListeners=p,a.emit=p,a.prependListener=p,a.prependOnceListener=p,a.listeners=function(e){return[]},a.binding=function(e){throw Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw Error("process.chdir is not supported")},a.umask=function(){return 0}}},a={};function o(e){var t=a[e];if(void 0!==t)return t.exports;var r=a[e]={exports:{}},i=!0;try{n[e](r,r.exports,o),i=!1}finally{i&&delete a[e]}return r.exports}o.ab="/ROOT/node_modules/next/dist/compiled/process/",t.exports=o(229)},350461,(e,t,r)=>{"use strict";var n,a;t.exports=(null==(n=e.g.process)?void 0:n.env)&&"object"==typeof(null==(a=e.g.process)?void 0:a.env)?e.g.process:e.r(920955)},877325,(e,t,r)=>{"use strict";var n=Symbol.for("react.element"),a=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),l=Symbol.for("react.provider"),c=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),p=Symbol.iterator,g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y=Object.assign,h={};function v(e,t,r){this.props=e,this.context=t,this.refs=h,this.updater=r||g}function x(){}function b(e,t,r){this.props=e,this.context=t,this.refs=h,this.updater=r||g}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},x.prototype=v.prototype;var w=b.prototype=new x;w.constructor=b,y(w,v.prototype),w.isPureReactComponent=!0;var j=Array.isArray,P=Object.prototype.hasOwnProperty,N={current:null},k={key:!0,ref:!0,__self:!0,__source:!0};function C(e,t,r){var a,o={},i=null,s=null;if(null!=t)for(a in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(i=""+t.key),t)P.call(t,a)&&!k.hasOwnProperty(a)&&(o[a]=t[a]);var l=arguments.length-2;if(1===l)o.children=r;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];o.children=c}if(e&&e.defaultProps)for(a in l=e.defaultProps)void 0===o[a]&&(o[a]=l[a]);return{$$typeof:n,type:e,key:i,ref:s,props:o,_owner:N.current}}function E(e){return"object"==typeof e&&null!==e&&e.$$typeof===n}var S=/\/+/g;function _(e,t){var r,n;return"object"==typeof e&&null!==e&&null!=e.key?(r=""+e.key,n={"=":"=0",":":"=2"},"$"+r.replace(/[=:]/g,function(e){return n[e]})):t.toString(36)}function R(e,t,r){if(null==e)return e;var o=[],i=0;return!function e(t,r,o,i,s){var l,c,u,d=typeof t;("undefined"===d||"boolean"===d)&&(t=null);var f=!1;if(null===t)f=!0;else switch(d){case"string":case"number":f=!0;break;case"object":switch(t.$$typeof){case n:case a:f=!0}}if(f)return s=s(f=t),t=""===i?"."+_(f,0):i,j(s)?(o="",null!=t&&(o=t.replace(S,"$&/")+"/"),e(s,r,o,"",function(e){return e})):null!=s&&(E(s)&&(l=s,c=o+(!s.key||f&&f.key===s.key?"":(""+s.key).replace(S,"$&/")+"/")+t,s={$$typeof:n,type:l.type,key:c,ref:l.ref,props:l.props,_owner:l._owner}),r.push(s)),1;if(f=0,i=""===i?".":i+":",j(t))for(var m=0;m<t.length;m++){var g=i+_(d=t[m],m);f+=e(d,r,o,g,s)}else if("function"==typeof(g=null===(u=t)||"object"!=typeof u?null:"function"==typeof(u=p&&u[p]||u["@@iterator"])?u:null))for(t=g.call(t),m=0;!(d=t.next()).done;)g=i+_(d=d.value,m++),f+=e(d,r,o,g,s);else if("object"===d)throw Error("Objects are not valid as a React child (found: "+("[object Object]"===(r=String(t))?"object with keys {"+Object.keys(t).join(", ")+"}":r)+"). If you meant to render a collection of children, use an array instead.");return f}(e,o,"","",function(e){return t.call(r,e,i++)}),o}function O(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){(0===e._status||-1===e._status)&&(e._status=1,e._result=t)},function(t){(0===e._status||-1===e._status)&&(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var F={current:null},T={transition:null};function A(){throw Error("act(...) is not supported in production builds of React.")}r.Children={map:R,forEach:function(e,t,r){R(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return R(e,function(){t++}),t},toArray:function(e){return R(e,function(e){return e})||[]},only:function(e){if(!E(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},r.Component=v,r.Fragment=o,r.Profiler=s,r.PureComponent=b,r.StrictMode=i,r.Suspense=d,r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED={ReactCurrentDispatcher:F,ReactCurrentBatchConfig:T,ReactCurrentOwner:N},r.act=A,r.cloneElement=function(e,t,r){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var a=y({},e.props),o=e.key,i=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(i=t.ref,s=N.current),void 0!==t.key&&(o=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)P.call(t,c)&&!k.hasOwnProperty(c)&&(a[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)a.children=r;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];a.children=l}return{$$typeof:n,type:e.type,key:o,ref:i,props:a,_owner:s}},r.createContext=function(e){return(e={$$typeof:c,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:l,_context:e},e.Consumer=e},r.createElement=C,r.createFactory=function(e){var t=C.bind(null,e);return t.type=e,t},r.createRef=function(){return{current:null}},r.forwardRef=function(e){return{$$typeof:u,render:e}},r.isValidElement=E,r.lazy=function(e){return{$$typeof:m,_payload:{_status:-1,_result:e},_init:O}},r.memo=function(e,t){return{$$typeof:f,type:e,compare:void 0===t?null:t}},r.startTransition=function(e){var t=T.transition;T.transition={};try{e()}finally{T.transition=t}},r.unstable_act=A,r.useCallback=function(e,t){return F.current.useCallback(e,t)},r.useContext=function(e){return F.current.useContext(e)},r.useDebugValue=function(){},r.useDeferredValue=function(e){return F.current.useDeferredValue(e)},r.useEffect=function(e,t){return F.current.useEffect(e,t)},r.useId=function(){return F.current.useId()},r.useImperativeHandle=function(e,t,r){return F.current.useImperativeHandle(e,t,r)},r.useInsertionEffect=function(e,t){return F.current.useInsertionEffect(e,t)},r.useLayoutEffect=function(e,t){return F.current.useLayoutEffect(e,t)},r.useMemo=function(e,t){return F.current.useMemo(e,t)},r.useReducer=function(e,t,r){return F.current.useReducer(e,t,r)},r.useRef=function(e){return F.current.useRef(e)},r.useState=function(e){return F.current.useState(e)},r.useSyncExternalStore=function(e,t,r){return F.current.useSyncExternalStore(e,t,r)},r.useTransition=function(){return F.current.useTransition()},r.version="18.3.1"},191788,(e,t,r)=>{"use strict";t.exports=e.r(877325)},701884,(e,t,r)=>{"use strict";var n=e.r(191788),a=Symbol.for("react.element"),o=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,s=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,r){var n,o={},c=null,u=null;for(n in void 0!==r&&(c=""+r),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)i.call(t,n)&&!l.hasOwnProperty(n)&&(o[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===o[n]&&(o[n]=t[n]);return{$$typeof:a,type:e,key:c,ref:u,props:o,_owner:s.current}}r.Fragment=o,r.jsx=c,r.jsxs=c},391398,(e,t,r)=>{"use strict";t.exports=e.r(701884)},369547,e=>{"use strict";var t=e.i(191788);let r=(...e)=>e.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim();var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let a=(0,t.forwardRef)(({color:e="currentColor",size:a=24,strokeWidth:o=2,absoluteStrokeWidth:i,className:s="",children:l,iconNode:c,...u},d)=>(0,t.createElement)("svg",{ref:d,...n,width:a,height:a,stroke:e,strokeWidth:i?24*Number(o)/Number(a):o,className:r("lucide",s),...u},[...c.map(([e,r])=>(0,t.createElement)(e,r)),...Array.isArray(l)?l:[l]])),o=(e,n)=>{let o=(0,t.forwardRef)(({className:o,...i},s)=>(0,t.createElement)(a,{ref:s,iconNode:n,className:r(`lucide-${e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,o),...i}));return o.displayName=`${e}`,o};e.s(["default",()=>o],369547)},426119,e=>{"use strict";var t=e.i(391398),r=e.i(191788),n=e.i(353533);let a=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)("div",{ref:a,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...r}));a.displayName="Card";let o=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)("div",{ref:a,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",e),...r}));o.displayName="CardHeader";let i=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)("h3",{ref:a,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",e),...r}));i.displayName="CardTitle";let s=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)("p",{ref:a,className:(0,n.cn)("text-sm text-muted-foreground",e),...r}));s.displayName="CardDescription";let l=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)("div",{ref:a,className:(0,n.cn)("p-6 pt-0",e),...r}));l.displayName="CardContent";let c=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)("div",{ref:a,className:(0,n.cn)("flex items-center p-6 pt-0",e),...r}));c.displayName="CardFooter",e.s(["Card",()=>a,"CardContent",()=>l,"CardDescription",()=>s,"CardFooter",()=>c,"CardHeader",()=>o,"CardTitle",()=>i])},180490,e=>{e.v({name:"dotenv",version:"16.6.1",description:"Loads environment variables from .env file",main:"lib/main.js",types:"lib/main.d.ts",exports:{".":{types:"./lib/main.d.ts",require:"./lib/main.js",default:"./lib/main.js"},"./config":"./config.js","./config.js":"./config.js","./lib/env-options":"./lib/env-options.js","./lib/env-options.js":"./lib/env-options.js","./lib/cli-options":"./lib/cli-options.js","./lib/cli-options.js":"./lib/cli-options.js","./package.json":"./package.json"},scripts:{"dts-check":"tsc --project tests/types/tsconfig.json",lint:"standard",pretest:"npm run lint && npm run dts-check",test:"tap run --allow-empty-coverage --disable-coverage --timeout=60000","test:coverage":"tap run --show-full-coverage --timeout=60000 --coverage-report=text --coverage-report=lcov",prerelease:"npm test",release:"standard-version"},repository:{type:"git",url:"git://github.com/motdotla/dotenv.git"},homepage:"https://github.com/motdotla/dotenv#readme",funding:"https://dotenvx.com",keywords:["dotenv","env",".env","environment","variables","config","settings"],readmeFilename:"README.md",license:"BSD-2-Clause",devDependencies:{"@types/node":"^18.11.3",decache:"^4.6.2",sinon:"^14.0.1",standard:"^17.0.0","standard-version":"^9.5.0",tap:"^19.2.0",typescript:"^4.8.4"},engines:{node:">=12"},browser:{fs:!1}})},45124,e=>{"use strict";var t=e.i(391398),r=e.i(191788),n=e.i(353533);let a=r.forwardRef(({className:e,type:r,...a},o)=>(0,t.jsx)("input",{type:r,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","number"===r&&"[appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",e),onWheel:"number"===r?e=>{"number"===r&&e.currentTarget.blur()}:void 0,ref:o,...a}));a.displayName="Input",e.s(["Input",()=>a])},993953,e=>{"use strict";var t=e.i(191788),r=e.i(357006),n=e.i(776833),a=e=>{var a;let i,s,{present:l,children:c}=e,u=function(e){var r,a;let[i,s]=t.useState(),l=t.useRef(null),c=t.useRef(e),u=t.useRef("none"),[d,f]=(r=e?"mounted":"unmounted",a={mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}},t.useReducer((e,t)=>a[e][t]??e,r));return t.useEffect(()=>{let e=o(l.current);u.current="mounted"===d?e:"none"},[d]),(0,n.useLayoutEffect)(()=>{let t=l.current,r=c.current;if(r!==e){let n=u.current,a=o(t);e?f("MOUNT"):"none"===a||t?.display==="none"?f("UNMOUNT"):r&&n!==a?f("ANIMATION_OUT"):f("UNMOUNT"),c.current=e}},[e,f]),(0,n.useLayoutEffect)(()=>{if(i){let e,t=i.ownerDocument.defaultView??window,r=r=>{let n=o(l.current).includes(CSS.escape(r.animationName));if(r.target===i&&n&&(f("ANIMATION_END"),!c.current)){let r=i.style.animationFillMode;i.style.animationFillMode="forwards",e=t.setTimeout(()=>{"forwards"===i.style.animationFillMode&&(i.style.animationFillMode=r)})}},n=e=>{e.target===i&&(u.current=o(l.current))};return i.addEventListener("animationstart",n),i.addEventListener("animationcancel",r),i.addEventListener("animationend",r),()=>{t.clearTimeout(e),i.removeEventListener("animationstart",n),i.removeEventListener("animationcancel",r),i.removeEventListener("animationend",r)}}f("ANIMATION_END")},[i,f]),{isPresent:["mounted","unmountSuspended"].includes(d),ref:t.useCallback(e=>{l.current=e?getComputedStyle(e):null,s(e)},[])}}(l),d="function"==typeof c?c({present:u.isPresent}):t.Children.only(c),f=(0,r.useComposedRefs)(u.ref,(a=d,(s=(i=Object.getOwnPropertyDescriptor(a.props,"ref")?.get)&&"isReactWarning"in i&&i.isReactWarning)?a.ref:(s=(i=Object.getOwnPropertyDescriptor(a,"ref")?.get)&&"isReactWarning"in i&&i.isReactWarning)?a.props.ref:a.props.ref||a.ref));return"function"==typeof c||u.isPresent?t.cloneElement(d,{ref:f}):null};function o(e){return e?.animationName||"none"}a.displayName="Presence",e.s(["Presence",()=>a])},91762,e=>{"use strict";var t=e.i(391398),r=e.i(191788);e.i(730943);var n=e.i(817549),a=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,a)=>{let o=(0,n.createSlot)(`Primitive.${a}`),i=r.forwardRef((e,r)=>{let{asChild:n,...i}=e;return"u">typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,t.jsx)(n?o:a,{...i,ref:r})});return i.displayName=`Primitive.${a}`,{...e,[a]:i}},{}),o=r.forwardRef((e,r)=>(0,t.jsx)(a.label,{...e,ref:r,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));o.displayName="Label";var i=e.i(648684),s=e.i(353533);let l=(0,i.cva)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=r.forwardRef(({className:e,...r},n)=>(0,t.jsx)(o,{ref:n,className:(0,s.cn)(l(),e),...r}));c.displayName=o.displayName,e.s(["Label",()=>c],91762)},909289,e=>{"use strict";let t=(0,e.i(369547).default)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);e.s(["Trash2",()=>t],909289)},130027,e=>{"use strict";var t=e.i(391398),r=e.i(191788),n=e.i(671185),a=e.i(357006),o=e.i(479293),i=e.i(55037),s=e.i(593427),l=e.i(474864),c=e.i(674534),u="Switch",[d,f]=(0,o.createContextScope)(u),[m,p]=d(u),g=r.forwardRef((e,o)=>{let{__scopeSwitch:s,name:l,checked:d,defaultChecked:f,required:p,disabled:g,value:y="on",onCheckedChange:h,form:b,...w}=e,[j,P]=r.useState(null),N=(0,a.useComposedRefs)(o,e=>P(e)),k=r.useRef(!1),C=!j||b||!!j.closest("form"),[E,S]=(0,i.useControllableState)({prop:d,defaultProp:f??!1,onChange:h,caller:u});return(0,t.jsxs)(m,{scope:s,checked:E,disabled:g,children:[(0,t.jsx)(c.Primitive.button,{type:"button",role:"switch","aria-checked":E,"aria-required":p,"data-state":x(E),"data-disabled":g?"":void 0,disabled:g,value:y,...w,ref:N,onClick:(0,n.composeEventHandlers)(e.onClick,e=>{S(e=>!e),C&&(k.current=e.isPropagationStopped(),k.current||e.stopPropagation())})}),C&&(0,t.jsx)(v,{control:j,bubbles:!k.current,name:l,value:y,checked:E,required:p,disabled:g,form:b,style:{transform:"translateX(-100%)"}})]})});g.displayName=u;var y="SwitchThumb",h=r.forwardRef((e,r)=>{let{__scopeSwitch:n,...a}=e,o=p(y,n);return(0,t.jsx)(c.Primitive.span,{"data-state":x(o.checked),"data-disabled":o.disabled?"":void 0,...a,ref:r})});h.displayName=y;var v=r.forwardRef(({__scopeSwitch:e,control:n,checked:o,bubbles:i=!0,...c},u)=>{let d=r.useRef(null),f=(0,a.useComposedRefs)(d,u),m=(0,s.usePrevious)(o),p=(0,l.useSize)(n);return r.useEffect(()=>{let e=d.current;if(!e)return;let t=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(m!==o&&t){let r=new Event("click",{bubbles:i});t.call(e,o),e.dispatchEvent(r)}},[m,o,i]),(0,t.jsx)("input",{type:"checkbox","aria-hidden":!0,defaultChecked:o,...c,tabIndex:-1,ref:f,style:{...c.style,...p,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});function x(e){return e?"checked":"unchecked"}v.displayName="SwitchBubbleInput";var b=e.i(353533);let w=r.forwardRef(({className:e,...r},n)=>(0,t.jsx)(g,{className:(0,b.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",e),...r,ref:n,children:(0,t.jsx)(h,{className:(0,b.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));w.displayName=g.displayName,e.s(["Switch",()=>w],130027)},737650,e=>{"use strict";var t=e.i(191788),r=e.i(150064),n=e.i(46108),a=e.i(8745);e.s(["useCategories",0,e=>{let[o,i]=(0,t.useState)([]),[s,l]=(0,t.useState)(!0),{toast:c}=(0,r.useToast)(),{currentBusiness:u}=(0,n.useBusiness)(),d=(0,t.useCallback)(async()=>{try{if(!u?.id){i([]),l(!1);return}l(!0);let e=await (0,a.getProductCategoriesAction)(u.id);if(!e.success||!e.data)throw Error(e.error||"Failed to fetch categories");let t=e.data.map(e=>({id:e.id,name:e.name,createdAt:e.createdAt?new Date(e.createdAt):e.created_at?new Date(e.created_at):void 0}));i(t)}catch(e){console.error("Error loading categories:",e),c({title:"Error",description:"Failed to load product categories.",variant:"destructive"})}finally{l(!1)}},[u?.id,c]);(0,t.useEffect)(()=>{d()},[d]);let f=async t=>{try{if(!e||!u?.id)return null;let r=o.find(e=>e.name.toLowerCase()===t.toLowerCase());if(r)return c({title:"Category exists",description:"This category already exists."}),r;let n=await (0,a.createProductCategoryAction)(u.id,e,t);if(!n.success||!n.data)throw Error(n.error);let s={id:n.data.id,name:n.data.name,createdAt:new Date(n.data.createdAt)};return i(e=>[...e,s]),c({title:"Success",description:"Category created successfully"}),s}catch(e){return console.error("Error creating category:",e),c({title:"Error",description:"Failed to create category.",variant:"destructive"}),null}},m=async(e,t)=>{try{if(o.find(r=>r.name.toLowerCase()===t.toLowerCase()&&r.id!==e))return c({title:"Category exists",description:"Another category with this name already exists."}),!1;let r=await (0,a.updateProductCategoryAction)(e,t);if(!r.success)throw Error(r.error);return i(r=>r.map(r=>r.id===e?{...r,name:t}:r)),c({title:"Success",description:"Category updated successfully"}),!0}catch(e){return console.error("Error updating category:",e),c({title:"Error",description:"Failed to update category.",variant:"destructive"}),!1}};return{categories:o,isLoading:s,loadCategories:d,createCategory:f,updateCategory:m,deleteCategory:async e=>{try{let t=await (0,a.deleteProductCategoryAction)(e);if(!t.success)return c({title:"Cannot delete category",description:t.error||"Failed to delete category.",variant:"destructive"}),!1;return i(t=>t.filter(t=>t.id!==e)),c({title:"Success",description:"Category deleted successfully"}),!0}catch(e){return console.error("Error deleting category:",e),c({title:"Error",description:"Failed to delete category.",variant:"destructive"}),!1}}}}])},681912,(e,t,r)=>{"use strict";var n=e.r(730943);r.createRoot=n.createRoot,r.hydrateRoot=n.hydrateRoot},602889,e=>{"use strict";let t=(0,e.i(369547).default)("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);e.s(["Zap",()=>t],602889)},741705,(e,t,r)=>{"use strict";r._=function(e){return e&&e.__esModule?e:{default:e}}},952456,(e,t,r)=>{"use strict";function n(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(n=function(e){return e?r:t})(e)}r._=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=n(t);if(r&&r.has(e))return r.get(e);var a={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var s=o?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(a,i,s):a[i]=e[i]}return a.default=e,r&&r.set(e,a),a}},713584,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"HeadManagerContext",{enumerable:!0,get:function(){return n}});let n=e.r(741705)._(e.r(191788)).default.createContext({})},894470,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"warnOnce",{enumerable:!0,get:function(){return n}});let n=e=>{}},889129,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={DecodeError:function(){return h},MiddlewareNotFoundError:function(){return w},MissingStaticPage:function(){return b},NormalizeError:function(){return v},PageNotFoundError:function(){return x},SP:function(){return g},ST:function(){return y},WEB_VITALS:function(){return o},execOnce:function(){return i},getDisplayName:function(){return d},getLocationOrigin:function(){return c},getURL:function(){return u},isAbsoluteUrl:function(){return l},isResSent:function(){return f},loadGetInitialProps:function(){return p},normalizeRepeatedSlashes:function(){return m},stringifyError:function(){return j}};for(var a in n)Object.defineProperty(r,a,{enumerable:!0,get:n[a]});let o=["CLS","FCP","FID","INP","LCP","TTFB"];function i(e){let t,r=!1;return(...n)=>(r||(r=!0,t=e(...n)),t)}let s=/^[a-zA-Z][a-zA-Z\d+\-.]*?:/,l=e=>s.test(e);function c(){let{protocol:e,hostname:t,port:r}=window.location;return`${e}//${t}${r?":"+r:""}`}function u(){let{href:e}=window.location,t=c();return e.substring(t.length)}function d(e){return"string"==typeof e?e:e.displayName||e.name||"Unknown"}function f(e){return e.finished||e.headersSent}function m(e){let t=e.split("?");return t[0].replace(/\\/g,"/").replace(/\/\/+/g,"/")+(t[1]?`?${t.slice(1).join("?")}`:"")}async function p(e,t){let r=t.res||t.ctx&&t.ctx.res;if(!e.getInitialProps)return t.ctx&&t.Component?{pageProps:await p(t.Component,t.ctx)}:{};let n=await e.getInitialProps(t);if(r&&f(r))return n;if(!n)throw Object.defineProperty(Error(`"${d(e)}.getInitialProps()" should resolve to an object. But found "${n}" instead.`),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});return n}let g="u">typeof performance,y=g&&["mark","measure","getEntriesByName"].every(e=>"function"==typeof performance[e]);class h extends Error{}class v extends Error{}class x extends Error{constructor(e){super(),this.code="ENOENT",this.name="PageNotFoundError",this.message=`Cannot find module for page: ${e}`}}class b extends Error{constructor(e,t){super(),this.message=`Failed to load static file for page: ${e} ${t}`}}class w extends Error{constructor(){super(),this.code="ENOENT",this.message="Cannot find the middleware module"}}function j(e){return JSON.stringify({message:e.message,stack:e.stack})}},701085,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={AppRouterContext:function(){return i},GlobalLayoutRouterContext:function(){return l},LayoutRouterContext:function(){return s},MissingSlotContext:function(){return u},TemplateContext:function(){return c}};for(var a in n)Object.defineProperty(r,a,{enumerable:!0,get:n[a]});let o=e.r(741705)._(e.r(191788)),i=o.default.createContext(null),s=o.default.createContext(null),l=o.default.createContext(null),c=o.default.createContext(null),u=o.default.createContext(new Set)},531430,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"ReadonlyURLSearchParams",{enumerable:!0,get:function(){return a}});class n extends Error{constructor(){super("Method unavailable on `ReadonlyURLSearchParams`. Read more: https://nextjs.org/docs/app/api-reference/functions/use-search-params#updating-searchparams")}}class a extends URLSearchParams{append(){throw new n}delete(){throw new n}set(){throw new n}sort(){throw new n}}("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),t.exports=r.default)},470008,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={NavigationPromisesContext:function(){return u},PathParamsContext:function(){return c},PathnameContext:function(){return l},ReadonlyURLSearchParams:function(){return i.ReadonlyURLSearchParams},SearchParamsContext:function(){return s},createDevToolsInstrumentedPromise:function(){return d}};for(var a in n)Object.defineProperty(r,a,{enumerable:!0,get:n[a]});let o=e.r(191788),i=e.r(531430),s=(0,o.createContext)(null),l=(0,o.createContext)(null),c=(0,o.createContext)(null),u=(0,o.createContext)(null);function d(e,t){let r=Promise.resolve(t);return r.status="fulfilled",r.value=t,r.displayName=`${e} (SSR)`,r}},991622,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={HTTPAccessErrorStatus:function(){return o},HTTP_ERROR_FALLBACK_ERROR_CODE:function(){return s},getAccessFallbackErrorTypeByStatus:function(){return u},getAccessFallbackHTTPStatus:function(){return c},isHTTPAccessFallbackError:function(){return l}};for(var a in n)Object.defineProperty(r,a,{enumerable:!0,get:n[a]});let o={NOT_FOUND:404,FORBIDDEN:403,UNAUTHORIZED:401},i=new Set(Object.values(o)),s="NEXT_HTTP_ERROR_FALLBACK";function l(e){if("object"!=typeof e||null===e||!("digest"in e)||"string"!=typeof e.digest)return!1;let[t,r]=e.digest.split(";");return t===s&&i.has(Number(r))}function c(e){return Number(e.digest.split(";")[1])}function u(e){switch(e){case 401:return"unauthorized";case 403:return"forbidden";case 404:return"not-found";default:return}}("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),t.exports=r.default)},40184,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"RedirectStatusCode",{enumerable:!0,get:function(){return a}});var n,a=((n={})[n.SeeOther=303]="SeeOther",n[n.TemporaryRedirect=307]="TemporaryRedirect",n[n.PermanentRedirect=308]="PermanentRedirect",n);("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),t.exports=r.default)},301939,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,a={REDIRECT_ERROR_CODE:function(){return s},RedirectType:function(){return l},isRedirectError:function(){return c}};for(var o in a)Object.defineProperty(r,o,{enumerable:!0,get:a[o]});let i=e.r(40184),s="NEXT_REDIRECT";var l=((n={}).push="push",n.replace="replace",n);function c(e){if("object"!=typeof e||null===e||!("digest"in e)||"string"!=typeof e.digest)return!1;let t=e.digest.split(";"),[r,n]=t,a=t.slice(2,-2).join(";"),o=Number(t.at(-2));return r===s&&("replace"===n||"push"===n)&&"string"==typeof a&&!isNaN(o)&&o in i.RedirectStatusCode}("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),t.exports=r.default)},68934,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"isNextRouterError",{enumerable:!0,get:function(){return o}});let n=e.r(991622),a=e.r(301939);function o(e){return(0,a.isRedirectError)(e)||(0,n.isHTTPAccessFallbackError)(e)}("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),t.exports=r.default)},551321,e=>{"use strict";var t=e.i(391398),r=e.i(191788),n=e.i(365713),a=e.i(426119),o=e.i(939310),i=e.i(45124),s=e.i(91762),l=e.i(443915),c=e.i(690176),u=e.i(563905),d=e.i(679935),f=e.i(909289),m=e.i(759279);let p=(0,e.i(369547).default)("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);var g=e.i(322138),y=e.i(602889),h=e.i(151670),v=e.i(641405),x=e.i(824216),b=e.i(150064),w=e.i(353533),j=e.i(348370),P=e.i(897837),N=e.i(792042),k=e.i(130027);let C=({initialData:e,categories:C,onProductSubmit:E,isLoading:S})=>{let _=(0,n.useNavigate)(),{settings:R}=(0,u.useBusinessSettings)(),{user:O}=(0,x.useAuth)(),{uploadProductImage:F,compressImage:T}=(e=>{let{toast:t}=(0,b.useToast)(),r=async e=>new Promise((t,r)=>{try{let n=new FileReader;n.onerror=()=>{console.error("FileReader error"),r(Error("Failed to read file"))},n.onload=n=>{try{let a=new Image;a.onerror=()=>{console.error("Image load error"),r(Error("Failed to load image"))},a.onload=()=>{try{let n=(t,n,o)=>new Promise(i=>{let s=document.createElement("canvas");s.width=t,s.height=n;let l=s.getContext("2d");l?(l.clearRect(0,0,t,n),l.drawImage(a,0,0,t,n),s.toBlob(t=>{if(!t)return void r(Error("Could not compress image"));let n=new File([t],`${e.name.replace(/\.[^/.]+$/,"")}-optimized.jpg`,{type:"image/jpeg",lastModified:Date.now()});i(n)},"image/jpeg",o)):r(Error("Could not get canvas context"))});(async()=>{let{width:t,height:r}=a;if(t>400||r>400){let e=t/r;t>r?r=(t=400)/e:t=(r=400)*e}for(let a of(t=Math.max(50,Math.floor(t)),r=Math.max(50,Math.floor(r)),[.8,.6,.4,.3,.2,.1,.05,.02,.01])){let o=await n(t,r,a);if(o.size<=10240)return console.log("Image compression successful:"),console.log(`  Original: ${(e.size/1024).toFixed(1)}KB`),console.log(`  Compressed: ${(o.size/1024).toFixed(1)}KB`),console.log(`  Reduction: ${((e.size-o.size)/e.size*100).toFixed(1)}%`),console.log(`  Dimensions: ${t}x${r}px`),console.log(`  Quality: ${(100*a).toFixed(0)}%`),o}for(let a of[.8,.6,.5,.4,.3,.25,.2]){let o=Math.max(50,Math.floor(t*a)),i=Math.max(50,Math.floor(r*a));for(let t of[.1,.05,.02,.01]){let r=await n(o,i,t);if(r.size<=10240)return console.log("Image compression successful with dimension reduction:"),console.log(`  Original: ${(e.size/1024).toFixed(1)}KB`),console.log(`  Compressed: ${(r.size/1024).toFixed(1)}KB`),console.log(`  Reduction: ${((e.size-r.size)/e.size*100).toFixed(1)}%`),console.log(`  Dimensions: ${o}x${i}px`),console.log(`  Quality: ${(100*t).toFixed(0)}%`),r}}let o=await n(50,50,.01);return console.log("Image compression fallback:"),console.log(`  Original: ${(e.size/1024).toFixed(1)}KB`),console.log(`  Compressed: ${(o.size/1024).toFixed(1)}KB`),console.log("  Dimensions: 50x50px"),o})().then(t).catch(r)}catch(e){console.error("Canvas processing error:",e),r(Error("Failed to process image on canvas"))}},a.src=n.target?.result}catch(e){console.error("Image creation error:",e),r(Error("Failed to create image"))}},n.readAsDataURL(e)}catch(e){console.error("File reading setup error:",e),r(Error("Failed to setup file reader"))}}),n=async e=>new Promise((t,r)=>{try{let n=new FileReader;n.onerror=()=>r(Error("Failed to read file")),n.onload=n=>{try{let a=new Image;a.onerror=()=>r(Error("Failed to load image")),a.onload=()=>{try{let n=document.createElement("canvas");n.width=a.width,n.height=a.height;let o=n.getContext("2d");if(!o)return void r(Error("Could not get canvas context"));o.drawImage(a,0,0),n.toBlob(n=>{if(!n)return void r(Error("Could not process image"));let a=new File([n],e.name,{type:e.type,lastModified:Date.now()});t(a)},e.type,.95)}catch(e){console.error("Metadata removal canvas error:",e),r(Error("Failed to process image"))}},a.src=n.target?.result}catch(e){console.error("Metadata removal image error:",e),r(Error("Failed to load image"))}},n.readAsDataURL(e)}catch(e){console.error("Metadata removal setup error:",e),r(Error("Failed to setup file reader"))}});return{uploadProductImage:async a=>{try{if(!e||!a)return console.error("Missing userId or file for image upload"),null;if(!a.type.startsWith("image/"))return t({title:"Error",description:"Only image files are allowed.",variant:"destructive"}),null;if(a.size>0x1400000)return t({title:"Error",description:"Image file is too large. Maximum size is 20MB.",variant:"destructive"}),null;console.log("Starting image processing..."),t({title:"Processing Image",description:"Optimizing image to under 10KB..."});let o=await n(a),i=await r(o),s=i.size/1024;return console.log(`Final compressed size: ${s.toFixed(1)}KB`),console.warn("Image upload placeholder â€“ integration with Prisma server action/storage required"),t({title:"Image Processed",description:`Image optimized to ${s.toFixed(1)}KB. Backend upload is pending migration.`}),new Promise(e=>{let t=new FileReader;t.onloadend=()=>e(t.result),t.readAsDataURL(i)})}catch(e){return console.error("Error uploading product image:",e),t({title:"Upload Error",description:"Failed to process image.",variant:"destructive"}),null}},compressImage:r,removeMetadata:n}})(O?.id),A=e=>e?{name:e.name,barcode:e.barcode||"",manufacturerBarcode:e.manufacturerBarcode||"",description:e.description||"",category:e.category,quantity:e.quantity??0,costPrice:e.costPrice,sellingPrice:e.sellingPrice,supplier:e.supplier||"",minimumStock:e.minimumStock,imageFile:null,imageUrl:e.imageUrl,createdAt:e.createdAt||new Date,printQuantity:1,autoPrintLabel:!1}:{name:"",barcode:"",manufacturerBarcode:"",description:"",category:"",quantity:0,costPrice:void 0,sellingPrice:void 0,supplier:"",minimumStock:void 0,imageFile:null,imageUrl:null,createdAt:new Date,autoPrintLabel:!0,printQuantity:1},[D,I]=(0,r.useState)(()=>A(e)),[L,M]=(0,r.useState)({}),[B,$]=(0,r.useState)(null),[q,U]=(0,r.useState)(!1),[z,K]=(0,r.useState)(!1),[Q,H]=(0,r.useState)(!1),[W,V]=(0,r.useState)(!1),[X,Z]=(0,r.useState)(null),[G,Y]=(0,r.useState)(!1),J=(0,r.useRef)(null);(0,r.useEffect)(()=>{if(e){console.log("ProductForm - Setting form data from initialData:",e),console.log("ProductForm - InitialData createdAt:",e.createdAt);let t=A(e);I(t),console.log("ProductForm - Form data set to:",t),console.log("ProductForm - Form createdAt set to:",t.createdAt),e.imageUrl&&$(e.imageUrl)}},[e]);let ee=e=>{let{name:t,value:r}=e.target,n=r;("quantity"===t||"minimumStock"===t||"costPrice"===t||"sellingPrice"===t)&&("quantity"===t?console.log("Quantity changed to:",n=""===r?"":parseFloat(r)||0):n=""===r?void 0:parseFloat(r)),I({...D,[t]:n}),L[t]&&M({...L,[t]:""})},et=async e=>{if(e.size>0x1400000)return void d.toast.error("Image file is too large. Maximum size is 20MB.");if(!e.type.startsWith("image/"))return void d.toast.error("Only image files are allowed.");H(!0),Z(null);try{let t=await T(e),r=(e.size-t.size)/e.size*100;Z({originalSize:e.size,compressedSize:t.size,reduction:r}),I({...D,imageFile:t}),U(!0);let n=new FileReader;n.onload=()=>{$(n.result)},n.readAsDataURL(t),d.toast.success(`Image optimized to ${(t.size/1024).toFixed(1)}KB!`)}catch(e){console.error("Error compressing image:",e),d.toast.error("Failed to process image. Please try again.")}finally{H(!1)}},er=async e=>{let t;if(e.preventDefault(),console.log("ProductForm - Form data before validation:",D),console.log("ProductForm - Quantity value:",D.quantity,"Type:",typeof D.quantity),console.log("ProductForm - CreatedAt value:",D.createdAt),t={},D.name.trim()||(t.name="Product name is required"),void 0!==D.costPrice&&D.costPrice<0&&(t.costPrice="Cost price cannot be negative"),void 0!==D.sellingPrice&&D.sellingPrice<0&&(t.sellingPrice="Selling price cannot be negative"),void 0!==D.minimumStock&&D.minimumStock<0&&(t.minimumStock="Minimum stock cannot be negative"),M(t),0!==Object.keys(t).length)return void d.toast.error("Please correct the errors in the form");let r=D.imageUrl;try{if(q&&D.imageFile){if(K(!0),d.toast.info("Uploading optimized image..."),!(r=await F(D.imageFile)))return void K(!1);d.toast.success("Image uploaded successfully!")}else q&&!D.imageFile&&(r=null);let e="string"==typeof D.quantity?""===D.quantity?0:Number(D.quantity):D.quantity,t={...D,imageUrl:r,quantity:e};console.log("ProductForm - Final submission data:",t),console.log("ProductForm - Final quantity being submitted:",t.quantity),console.log("ProductForm - Final createdAt being submitted:",t.createdAt),await E(t)}catch(e){console.error("Error handling form submission:",e),d.toast.error("Something went wrong. Please try again.")}finally{K(!1)}},en=S||z;return(0,t.jsxs)(a.Card,{className:"w-full",children:[(0,t.jsxs)(a.CardHeader,{children:[(0,t.jsx)(a.CardTitle,{children:e?"Edit Product":"New Product"}),(0,t.jsx)(a.CardDescription,{children:"Enter the product details below. Only name is required."})]}),(0,t.jsx)(a.CardContent,{children:(0,t.jsxs)("form",{onSubmit:er,className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid gap-3",children:[(0,t.jsx)(s.Label,{htmlFor:"name",children:"Product Name*"}),(0,t.jsx)(i.Input,{id:"name",name:"name",value:D.name,onChange:ee,onKeyDown:e=>{if("Enter"===e.key){e.preventDefault();let t=document.querySelector('[role="combobox"]');t?.focus()}},placeholder:"Enter product name",className:L.name?"border-red-500":"",disabled:en}),L.name&&(0,t.jsx)("p",{className:"text-red-500 text-xs",children:L.name})]}),(0,t.jsxs)("div",{className:"grid gap-3",children:[(0,t.jsx)(s.Label,{htmlFor:"manufacturerBarcode",children:"Manufacturer Barcode (Optional)"}),(0,t.jsx)(i.Input,{id:"manufacturerBarcode",name:"manufacturerBarcode",value:D.manufacturerBarcode,onChange:ee,onKeyDown:e=>{if("Enter"===e.key){e.preventDefault();let t=document.querySelector('[role="combobox"]');t?.focus()}},placeholder:"Enter manufacturer barcode (if any)",disabled:en})]}),(0,t.jsxs)("div",{className:"grid gap-3",children:[(0,t.jsx)(s.Label,{htmlFor:"category",children:"Category (Optional)"}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Need to create a new category? Go to the"," ",(0,t.jsxs)(o.Button,{type:"button",variant:"link",className:"p-0 h-auto text-blue-600 underline",onClick:()=>_(`/categories?returnTo=${encodeURIComponent(window.location.pathname)}`),disabled:en,children:["Categories page ",(0,t.jsx)(p,{className:"h-3 w-3 ml-1 inline"})]})," ","first, then return here to select it."]}),(0,t.jsxs)(c.Select,{value:D.category,onValueChange:e=>{I({...D,category:e}),L.category&&M({...L,category:""}),setTimeout(()=>{document.getElementById("description")?.focus()},100)},disabled:en,children:[(0,t.jsx)(c.SelectTrigger,{className:(0,w.cn)(L.category?"border-red-500":""),onKeyDown:e=>{if(console.log("SelectTrigger keydown:",e.key,"Category:",D.category),"Enter"===e.key)return e.preventDefault(),e.stopPropagation(),console.log("Enter pressed on SelectTrigger, focusing description"),setTimeout(()=>{let e=document.getElementById("description");console.log("Description field found:",!!e),e?.focus()},50),!1;"Escape"===e.key&&setTimeout(()=>{document.getElementById("description")?.focus()},50)},children:(0,t.jsx)(c.SelectValue,{placeholder:"Select category (optional)"})}),(0,t.jsx)(c.SelectContent,{children:C.length>0?C.map(e=>(0,t.jsx)(c.SelectItem,{value:e.name,children:e.name},e.id)):(0,t.jsx)("div",{className:"p-2 text-sm text-muted-foreground",children:"No categories available"})})]}),L.category&&(0,t.jsx)("p",{className:"text-red-500 text-xs",children:L.category})]}),(0,t.jsxs)("div",{className:"grid gap-3",children:[(0,t.jsx)(s.Label,{htmlFor:"description",children:"Description"}),(0,t.jsx)(l.Textarea,{id:"description",name:"description",value:D.description,onChange:ee,onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),document.getElementById("supplier")?.focus())},placeholder:"Enter product description",className:"resize-none h-32",disabled:en})]}),(0,t.jsxs)("div",{className:"grid gap-3",children:[(0,t.jsx)(s.Label,{htmlFor:"supplier",children:"Supplier"}),(0,t.jsx)(i.Input,{id:"supplier",name:"supplier",value:D.supplier,onChange:ee,onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),document.getElementById("quantity")?.focus())},placeholder:"Enter supplier name",disabled:en})]}),(0,t.jsxs)("div",{className:"grid gap-3",children:[(0,t.jsx)(s.Label,{children:"Created Date"}),(0,t.jsxs)(j.Popover,{open:G,onOpenChange:Y,children:[(0,t.jsx)(j.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)(o.Button,{variant:"outline",className:(0,w.cn)("w-full justify-start text-left font-normal",!D.createdAt&&"text-muted-foreground",e&&"cursor-not-allowed opacity-60"),disabled:en||!!e,children:[(0,t.jsx)(h.Calendar,{className:"mr-2 h-4 w-4"}),D.createdAt?(0,N.format)(D.createdAt,"PPP"):"Pick a date"]})}),(0,t.jsx)(j.PopoverContent,{className:"w-auto p-0",align:"start",children:(0,t.jsx)(P.Calendar,{mode:"single",selected:D.createdAt,onSelect:e=>{if(e){let t=new Date(e);t.setHours(12,0,0,0),console.log("ProductForm - Date changed to:",t),I({...D,createdAt:t}),Y(!1)}},disabled:e=>e>new Date,initialFocus:!0})})]}),e&&(0,t.jsx)("div",{className:"bg-amber-50 border border-amber-200 p-3 rounded-lg",children:(0,t.jsxs)("div",{className:"text-amber-800 text-sm",children:[(0,t.jsx)("strong",{children:"Note:"})," To edit the creation date, please edit the initial stock history entry for this product through the inventory stock history."]})})]})]}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid gap-3",children:[(0,t.jsx)(s.Label,{htmlFor:"imageFile",children:"Product Image"}),(0,t.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[B?(0,t.jsxs)("div",{className:"relative w-full",children:[(0,t.jsx)("img",{src:B,alt:"Product preview",className:"w-full h-40 object-contain border rounded-md"}),(0,t.jsx)(o.Button,{type:"button",variant:"destructive",size:"icon",className:"absolute top-2 right-2 rounded-full h-8 w-8",onClick:()=>{I({...D,imageFile:null,imageUrl:null}),$(null),U(!0),Z(null),J.current&&(J.current.value="")},disabled:en||Q,children:(0,t.jsx)(f.Trash2,{className:"h-4 w-4"})}),X&&(0,t.jsxs)("div",{className:"mt-2 p-2 bg-green-50 border border-green-200 rounded-md",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-green-700",children:[(0,t.jsx)(y.Zap,{className:"h-4 w-4"}),(0,t.jsxs)("span",{className:"text-xs font-medium",children:["Optimized to ",(X.compressedSize/1024).toFixed(1),"KB"]})]}),(0,t.jsxs)("div",{className:"text-xs text-green-600 mt-1",children:[(X.originalSize/1024).toFixed(1),"KB â†’ ",(X.compressedSize/1024).toFixed(1),"KB (",X.reduction.toFixed(1),"% reduction)"]})]})]}):(0,t.jsx)("div",{className:(0,w.cn)("border-2 border-dashed rounded-md p-8 w-full flex flex-col items-center justify-center cursor-pointer transition-colors",W?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400",(en||Q)&&"opacity-50 cursor-not-allowed"),onDragOver:e=>{e.preventDefault(),e.stopPropagation(),V(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),V(!1)},onDrop:e=>{e.preventDefault(),e.stopPropagation(),V(!1),e.dataTransfer.files&&e.dataTransfer.files.length>0&&et(e.dataTransfer.files[0])},onClick:en||Q?void 0:()=>{J.current?.click()},children:Q?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(g.Loader2,{className:"h-10 w-10 text-blue-500 mb-2 animate-spin"}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Optimizing image..."}),(0,t.jsx)("p",{className:"text-xs text-gray-400",children:"Compressing to under 15KB"})]}):z?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(g.Loader2,{className:"h-10 w-10 text-blue-500 mb-2 animate-spin"}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Uploading image..."})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.Upload,{className:"h-10 w-10 text-gray-400 mb-2"}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Click to upload or drag and drop"}),(0,t.jsx)("p",{className:"text-xs text-gray-400",children:"PNG, JPG, GIF up to 20MB"}),(0,t.jsx)("p",{className:"text-xs text-blue-500 mt-1",children:"âš¡ Auto Image compression for instant loading"})]})}),(0,t.jsx)("input",{type:"file",id:"imageFile",ref:J,accept:"image/*",onChange:e=>{let t=e.target.files?.[0];t&&et(t)},className:"hidden",disabled:en||Q})]})]}),(0,t.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"grid gap-3",children:[(0,t.jsx)(s.Label,{htmlFor:"quantity",children:"Initial Stock"}),(0,t.jsx)(i.Input,{id:"quantity",name:"quantity",type:"number",step:"0.01",value:D.quantity,onChange:ee,onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),document.getElementById("minimumStock")?.focus())},className:L.quantity?"border-red-500":"",disabled:en,placeholder:"Enter initial stock quantity (can be negative)"}),L.quantity&&(0,t.jsx)("p",{className:"text-red-500 text-xs",children:L.quantity}),e&&(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Current stock: ",e.quantity," units"]})]}),(0,t.jsxs)("div",{className:"grid gap-3",children:[(0,t.jsx)(s.Label,{htmlFor:"minimumStock",children:"Minimum Stock Level"}),(0,t.jsx)(i.Input,{id:"minimumStock",name:"minimumStock",type:"number",min:"0",step:"0.01",value:void 0===D.minimumStock?"":D.minimumStock,onChange:ee,onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),document.getElementById("costPrice")?.focus())},className:L.minimumStock?"border-red-500":"",disabled:en}),L.minimumStock&&(0,t.jsx)("p",{className:"text-red-500 text-xs",children:L.minimumStock})]})]}),(0,t.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"grid gap-3",children:[(0,t.jsx)(s.Label,{htmlFor:"costPrice",children:"Cost Price"}),(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)("span",{className:"inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500",children:R.currency}),(0,t.jsx)(i.Input,{id:"costPrice",name:"costPrice",type:"number",min:"0",step:"0.01",value:void 0===D.costPrice?"":D.costPrice,onChange:ee,onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),document.getElementById("sellingPrice")?.focus())},className:`rounded-l-none ${L.costPrice?"border-red-500":""}`,disabled:en})]}),L.costPrice&&(0,t.jsx)("p",{className:"text-red-500 text-xs",children:L.costPrice})]}),(0,t.jsxs)("div",{className:"grid gap-3",children:[(0,t.jsx)(s.Label,{htmlFor:"sellingPrice",children:"Selling Price"}),(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)("span",{className:"inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500",children:R.currency}),(0,t.jsx)(i.Input,{id:"sellingPrice",name:"sellingPrice",type:"number",min:"0",step:"0.01",value:void 0===D.sellingPrice?"":D.sellingPrice,onChange:ee,onKeyDown:e=>{if("Enter"===e.key){e.preventDefault();let t=document.querySelector('button[type="submit"]');t?.focus()}},className:`rounded-l-none ${L.sellingPrice?"border-red-500":""}`,disabled:en})]}),L.sellingPrice&&(0,t.jsx)("p",{className:"text-red-500 text-xs",children:L.sellingPrice})]})]}),(0,t.jsx)("div",{className:"grid gap-3",children:(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"* Required fields | Initial Stock: The starting quantity for this product"})})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-end space-x-4",children:[(0,t.jsx)(o.Button,{variant:"outline",type:"button",onClick:()=>_("/inventory"),disabled:en||Q,children:"Cancel"}),(0,t.jsx)(o.Button,{type:"submit",disabled:en||Q,className:"min-w-[100px]",children:Q?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(g.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Optimizing..."]}):en?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(g.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),z?"Uploading...":"Saving..."]}):e?"Update Product":"Create Product"})]}),!e&&(0,t.jsxs)("div",{className:"flex flex-col md:flex-row items-center justify-end gap-4 pt-3 border-t",children:[D.autoPrintLabel&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(s.Label,{htmlFor:"printQuantity",className:"text-sm text-muted-foreground whitespace-nowrap",children:"Quantity to print:"}),(0,t.jsx)(i.Input,{id:"printQuantity",type:"number",min:"1",className:"w-20 h-8",value:D.printQuantity,onChange:e=>I(t=>({...t,printQuantity:parseInt(e.target.value)||1})),disabled:en})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(v.Printer,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsx)(s.Label,{htmlFor:"autoPrint",className:"text-sm font-medium cursor-pointer",children:"Auto-print barcode label"}),(0,t.jsx)(k.Switch,{id:"autoPrint",checked:D.autoPrintLabel,onCheckedChange:e=>I(t=>({...t,autoPrintLabel:e})),disabled:en})]})]})]})})]})};var E=e.i(355879),S=e.i(737650),_=e.i(386408),R=e.i(398957),O=e.i(638822),F=e.i(626427),T=e.i(675878);e.s(["default",0,()=>{let{id:e}=(0,n.useParams)(),a=(0,n.useLocation)(),i=(0,n.useNavigate)(),{user:s}=(0,x.useAuth)(),{products:l,isLoading:c,createProduct:f,updateProduct:m,loadProducts:p,refetch:g}=(0,E.useProducts)(s?.id,1e4),{categories:y,isLoading:h}=(0,S.useCategories)(s?.id),[v,b]=(0,r.useState)(void 0),[j,P]=(0,r.useState)(!1),[N,k]=(0,r.useState)(null),[A,D]=(0,r.useState)(!1),[I,L]=(0,r.useState)(!1),{settings:M}=(0,u.useBusinessSettings)(),{hasPermission:B,isLoading:$}=(0,O.useProfiles)(),q=a.state?.duplicateData,U=async()=>{if(e){D(!0),k(null);let{data:t}=await g(),r=(t?.products||[]).find(t=>t.id===e);r?(b(r),L(!0)):(k("Product not found. It may have been deleted or you may not have permission to view it."),d.toast.error("Product not found")),D(!1)}else L(!0)};(0,r.useEffect)(()=>{if(e&&l.length>0&&!I){let t=l.find(t=>t.id===e);t?(b(t),L(!0),k(null)):l.length>0&&(k("Product not found. It may have been deleted or you may not have permission to view it."),d.toast.error("Product not found"))}else e||L(!0)},[e,l.length,I]);let z=async()=>{d.toast.info("Refreshing product data..."),L(!1),await U()},K=async t=>{P(!0);try{if(e&&v){let r={name:t.name,description:t.description||"",category:t.category||"",quantity:t.quantity,costPrice:t.costPrice??0,sellingPrice:t.sellingPrice??0,supplier:t.supplier||"",minimumStock:t.minimumStock??0,imageUrl:t.imageUrl||null,createdAt:t.createdAt,barcode:t.barcode,manufacturerBarcode:t.manufacturerBarcode};await m(e,r)?(d.toast.success("Product updated successfully"),i(`/inventory/${e}`)):d.toast.error("Failed to update product")}else{if(!s?.id)return void d.toast.error("You must be logged in to create products");let e={id:"",name:t.name,description:t.description||"",category:t.category||"",quantity:t.quantity,costPrice:t.costPrice??0,sellingPrice:t.sellingPrice??0,supplier:t.supplier||"",minimumStock:t.minimumStock??0,imageUrl:t.imageUrl||null,createdAt:t.createdAt||new Date,updatedAt:new Date,barcode:t.barcode||"",manufacturerBarcode:t.manufacturerBarcode||""},r=await f(e);if(r){if(d.toast.success("Product created successfully"),t.autoPrintLabel&&r.barcode)try{let e=t.printQuantity||1;d.toast.info(`Sending ${e} barcode label${e>1?"s":""} to printer...`),await fetch("http://localhost:5000/print/label",{method:"POST",headers:{"Content-Type":"application/json"},mode:"cors",body:JSON.stringify({PrinterName:M.defaultPrinterName||"Label Printer",Content:`SIZE 50 mm, 30 mm
GAP 3 mm, 0 mm
CLS
TEXT 15,20,"3",0,1,1,"${r.name}"
BARCODE 15,70,"128",60,1,0,2,2,"${r.barcode}"
TEXT 15,180,"3",0,1,1,"${M.currency} ${(0,w.formatNumber)(r.sellingPrice)}"
PRINT ${e}
`})}),d.toast.success("Barcode label printed")}catch(e){console.error("Failed to auto-print label:",e),d.toast.error("Failed to print label. Is the Printer Bridge running?")}i(`/inventory/${r.id}`)}else d.toast.error("Failed to create product")}}catch(e){console.error("Error submitting product:",e),d.toast.error("An error occurred while saving the product")}finally{P(!1)}},Q=c||h||j||A,H=q?{...q,quantity:0,id:"",itemNumber:"",createdAt:new Date,updatedAt:new Date,barcode:"",manufacturerBarcode:""}:v,W=!e||B("inventory","edit"),V=!!e||B("inventory","create");return $||c||h?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):W&&V?!e||I||N?(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(o.Button,{variant:"outline",size:"sm",onClick:()=>i("/inventory"),className:"flex items-center gap-1",children:[(0,t.jsx)(_.ArrowLeft,{className:"h-4 w-4"})," Back to Inventory"]}),e&&(0,t.jsxs)(o.Button,{variant:"outline",size:"sm",onClick:z,disabled:Q,className:"flex items-center gap-1",children:[(0,t.jsx)(R.RefreshCw,{className:`h-4 w-4 ${A?"animate-spin":""}`}),A?"Refreshing...":"Refresh Data"]})]}),N?(0,t.jsxs)("div",{className:"p-6 bg-red-50 border border-red-200 rounded-md",children:[(0,t.jsx)("h3",{className:"text-lg font-medium text-red-800 mb-2",children:"Error Loading Product"}),(0,t.jsx)("p",{className:"text-red-600",children:N}),(0,t.jsx)(o.Button,{className:"mt-4",onClick:()=>i("/inventory"),children:"Return to Inventory"})]}):(0,t.jsx)(C,{initialData:H,categories:y,onProductSubmit:K,isLoading:Q})]}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"flex items-center justify-between",children:(0,t.jsxs)(o.Button,{variant:"outline",size:"sm",onClick:()=>i("/inventory"),className:"flex items-center gap-1",children:[(0,t.jsx)(_.ArrowLeft,{className:"h-4 w-4"})," Back to Inventory"]})}),(0,t.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Loading product data..."})]})})]}):(0,t.jsxs)("div",{className:"max-w-4xl mx-auto p-6",children:[(0,t.jsxs)(F.Alert,{variant:"destructive",children:[(0,t.jsx)(T.AlertCircle,{className:"h-4 w-4"}),(0,t.jsx)(F.AlertTitle,{children:"Access Denied"}),(0,t.jsxs)(F.AlertDescription,{children:["You do not have permission to ",e?"edit this product":"create a new product",". Please contact your administrator if you believe this is an error."]})]}),(0,t.jsx)("div",{className:"mt-4",children:(0,t.jsx)(o.Button,{onClick:()=>i("/inventory"),variant:"outline",children:"Back to Inventory"})})]})}],551321)},326168,(e,t,r)=>{let n="/NewProduct";(window.__NEXT_P=window.__NEXT_P||[]).push([n,()=>e.r(551321)]),t.hot&&t.hot.dispose(function(){window.__NEXT_P.push([n])})},648761,e=>{e.v(t=>Promise.all(["static/chunks/2edb2b394ba4d2db.js"].map(t=>e.l(t))).then(()=>t(825455)))},828805,e=>{e.v(t=>Promise.all(["static/chunks/820c94ec438563d7.js"].map(t=>e.l(t))).then(()=>t(879466)))}]);