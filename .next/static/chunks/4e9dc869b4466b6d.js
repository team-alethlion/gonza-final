(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,569074,e=>{"use strict";let t=(0,e.i(475254).default)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);e.s(["Upload",()=>t],569074)},727612,e=>{"use strict";let t=(0,e.i(475254).default)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);e.s(["Trash2",()=>t],727612)},871689,e=>{"use strict";let t=(0,e.i(475254).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>t],871689)},57287,e=>{"use strict";var t=e.i(271645),r=e.i(981140),a=e.i(820783),i=e.i(30030),s=e.i(369340),o=e.i(999682),n=e.i(635804),l=e.i(248425),c=e.i(843476),d="Switch",[u,m]=(0,i.createContextScope)(d),[p,g]=u(d),y=t.forwardRef((e,i)=>{let{__scopeSwitch:o,name:n,checked:u,defaultChecked:m,required:g,disabled:y,value:h="on",onCheckedChange:f,form:v,...P}=e,[w,j]=t.useState(null),N=(0,a.useComposedRefs)(i,e=>j(e)),S=t.useRef(!1),k=!w||v||!!w.closest("form"),[F,C]=(0,s.useControllableState)({prop:u,defaultProp:m??!1,onChange:f,caller:d});return(0,c.jsxs)(p,{scope:o,checked:F,disabled:y,children:[(0,c.jsx)(l.Primitive.button,{type:"button",role:"switch","aria-checked":F,"aria-required":g,"data-state":b(F),"data-disabled":y?"":void 0,disabled:y,value:h,...P,ref:N,onClick:(0,r.composeEventHandlers)(e.onClick,e=>{C(e=>!e),k&&(S.current=e.isPropagationStopped(),S.current||e.stopPropagation())})}),k&&(0,c.jsx)(x,{control:w,bubbles:!S.current,name:n,value:h,checked:F,required:g,disabled:y,form:v,style:{transform:"translateX(-100%)"}})]})});y.displayName=d;var h="SwitchThumb",f=t.forwardRef((e,t)=>{let{__scopeSwitch:r,...a}=e,i=g(h,r);return(0,c.jsx)(l.Primitive.span,{"data-state":b(i.checked),"data-disabled":i.disabled?"":void 0,...a,ref:t})});f.displayName=h;var x=t.forwardRef(({__scopeSwitch:e,control:r,checked:i,bubbles:s=!0,...l},d)=>{let u=t.useRef(null),m=(0,a.useComposedRefs)(u,d),p=(0,o.usePrevious)(i),g=(0,n.useSize)(r);return t.useEffect(()=>{let e=u.current;if(!e)return;let t=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(p!==i&&t){let r=new Event("click",{bubbles:s});t.call(e,i),e.dispatchEvent(r)}},[p,i,s]),(0,c.jsx)("input",{type:"checkbox","aria-hidden":!0,defaultChecked:i,...l,tabIndex:-1,ref:m,style:{...l.style,...g,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});function b(e){return e?"checked":"unchecked"}x.displayName="SwitchBubbleInput",e.s(["Root",()=>y,"Switch",()=>y,"SwitchThumb",()=>f,"Thumb",()=>f,"createSwitchScope",()=>m])},699375,e=>{"use strict";var t=e.i(843476),r=e.i(271645),a=e.i(57287),i=e.i(975157);let s=r.forwardRef(({className:e,...r},s)=>(0,t.jsx)(a.Root,{className:(0,i.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",e),...r,ref:s,children:(0,t.jsx)(a.Thumb,{className:(0,i.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));s.displayName=a.Root.displayName,e.s(["Switch",()=>s])},624687,e=>{"use strict";var t=e.i(843476),r=e.i(271645),a=e.i(975157);let i=r.forwardRef(({className:e,...r},i)=>(0,t.jsx)("textarea",{className:(0,a.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:i,...r}));i.displayName="Textarea",e.s(["Textarea",()=>i])},531278,e=>{"use strict";let t=(0,e.i(475254).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],531278)},908962,224410,e=>{"use strict";var t=e.i(271645),r=e.i(160615),a=e.i(422713),i=e.i(266027),s=e.i(912598);let o=e=>{let t=Object.keys(localStorage),r=["allProductsStats_","stockSummary_","soldItems_","dashboardData_","analyticsData_"],a=0;t.forEach(e=>{r.some(t=>e.startsWith(t))&&(localStorage.removeItem(e),a++)}),a>0&&console.log(`[Cache] Cleared ${a} inventory-related localStorage entries.`),e&&(console.log("[Cache] Invalidating React Query inventory keys..."),e.invalidateQueries({queryKey:["inventory_global_stats"]}),e.invalidateQueries({queryKey:["stockSummary"]}),e.invalidateQueries({queryKey:["products"]}),e.invalidateQueries({queryKey:["sales"]}),e.invalidateQueries({queryKey:["all-products-for-scanner"]}),e.invalidateQueries({queryKey:["all-products"]}))};e.s(["clearInventoryCaches",0,o],224410);var n=e.i(555781);e.s(["useProducts",0,(e,l=50)=>{let[c,d]=(0,t.useState)([]),[u,m]=(0,t.useState)(1),[p,g]=(0,t.useState)(l),[y,h]=(0,t.useState)(0),[f,x]=(0,t.useState)(!1),{settings:b}=(0,r.useBusinessSettings)(),{currentBusiness:v}=(0,a.useBusiness)(),P=(0,s.useQueryClient)(),[w,j]=(0,t.useState)({search:"",category:"all",stockStatus:"all"}),[N,S]=(0,t.useState)(null),k=(0,t.useCallback)(e=>{e.search!==w.search&&(x(!0),N&&clearTimeout(N),S(setTimeout(()=>{x(!1)},600))),j(e)},[w.search,N]),F=(0,t.useCallback)(async()=>{if(!e||!v)return{products:[],count:0};try{return await (0,n.getProductsAction)({userId:e,businessId:v.id,page:u,pageSize:p,search:w.search,category:"all"===w.category?void 0:w.category,stockStatus:w.stockStatus})}catch(e){return console.error("Error loading products from server action:",e),{products:[],count:0}}},[e,v?.id,u,p,w.search,w.category,w.stockStatus]),C=(0,t.useMemo)(()=>["products",e,v?.id],[e,v?.id]),E=(0,t.useMemo)(()=>[...C,u,p,w.search,w.category,w.stockStatus],[C,u,p,w.search,w.category,w.stockStatus]),{data:B,isLoading:A,isFetching:I,refetch:D}=(0,i.useQuery)({queryKey:E,queryFn:F,enabled:!!e&&!!v?.id,staleTime:3e4,gcTime:18e5,refetchOnWindowFocus:!0,refetchOnReconnect:!0});(0,t.useEffect)(()=>{B&&(d(B.products),h(B.count))},[B]);let L=async t=>{try{if(!e)return null;return console.warn("Image upload redirecting to server action (TODO)"),null}catch(e){return console.error("Error in uploadProductImage:",e),null}};return{products:c,isLoading:A&&!B&&!f,loadProducts:F,page:u,setPage:m,pageSize:p,setPageSize:g,totalCount:y,createProduct:async t=>{try{if(!e||!v)return null;let r=await (0,n.createProductAction)({...t,userId:e,businessId:v.id});if(!r)return null;return d(e=>[r,...e]),h(e=>e+1),P.invalidateQueries({queryKey:C}),o(P),r}catch(e){return console.error("Error creating product:",e),null}},updateProduct:async(t,r,a,i=!1,s,l,c,d)=>{try{if(!e||!v)return!1;let l=r.imageUrl;if(a&&(l=await L(a)),!await (0,n.updateProductAction)(t,{...r,imageUrl:l,userId:e,businessId:v.id,isFromSale:i,customChangeReason:s,referenceId:c}))return!1;return P.invalidateQueries({queryKey:C}),o(P),!0}catch(e){return console.error("Error updating product:",e),!1}},updateProductsBulk:async(t,r,a,i,s,l)=>{try{if(!e||!v)return!1;let r=await (0,n.updateProductsBulkAction)(t.map(e=>({id:e.id,updated:e.updated})),v.id);return r&&(P.invalidateQueries({queryKey:C}),o(P)),r}catch(e){return console.error("Error in bulk update:",e),!1}},deleteProduct:async t=>{try{if(!e)return!1;if(await (0,n.deleteProductAction)(t))return P.invalidateQueries({queryKey:C}),o(P),!0;return!1}catch(e){return console.error("Error deleting product:",e),!1}},uploadProductImage:L,refetch:D,isFetching:I,filters:w,setFilters:k}}],908962)},555781,(e,t,r)=>{let a=Error("Could not parse module '[project]/src/app/actions/products.ts'\n\n'import', and 'export' cannot be used outside of module code");throw a.code="MODULE_UNPARSABLE",a},160615,e=>{"use strict";var t=e.i(271645),r=e.i(266027),a=e.i(908406),i=e.i(422713),s=e.i(95187);let o=(0,s.createServerReference)("40290a4fc6b8571a026afeb877566edb807919e482",s.callServer,void 0,s.findSourceMapURL,"getBusinessSettingsAction");var n=e.i(709239);let l=()=>({businessName:"",businessAddress:"",businessPhone:"",businessEmail:"",currency:"UGX",paymentInfo:"",defaultPrintFormat:"standard"});e.s(["convertPaymentMethodsToString",0,e=>e.filter(e=>""!==e.method.trim()||""!==e.accountNumber.trim()||""!==e.accountName.trim()).map(e=>`${e.method}
${e.accountNumber}
${e.accountName}`).join("\n"),"parsePaymentInfo",0,e=>{if(!e||""===e.trim())return[];let t=e.split("\n").filter(e=>""!==e.trim()),r=[];for(let e=0;e<t.length;e+=3)e+2<t.length&&r.push({method:t[e].trim(),accountNumber:t[e+1].trim(),accountName:t[e+2].trim()});return r},"useBusinessSettings",0,()=>{let[e,s]=(0,t.useState)(l()),[c,d]=(0,t.useState)(!1),{toast:u}=(0,a.useToast)(),{currentBusiness:m}=(0,i.useBusiness)(),p=async()=>{if(!m)return l();try{let e=await o(m.id);if(!e)return l();{let t=e.metadata&&"object"==typeof e.metadata&&e.metadata.payment_info||"";return{id:e.id,businessName:e.business_name||"",businessAddress:e.business_address||"",businessPhone:e.business_phone||"",businessEmail:e.business_email||"",businessLogo:e.business_logo||void 0,currency:e.currency||"UGX",signature:e.signature||void 0,paymentInfo:t,defaultPrintFormat:e.metadata&&"object"==typeof e.metadata&&e.metadata.default_print_format||"standard",defaultPrinterName:e.metadata&&"object"==typeof e.metadata&&e.metadata.default_printer_name||"",defaultPrinterType:e.metadata&&"object"==typeof e.metadata&&e.metadata.default_printer_type||"USB",printerPaperSize:e.metadata&&"object"==typeof e.metadata&&e.metadata.printer_paper_size||"58mm"}}}catch(e){return console.error("Error loading business settings:",e),u({title:"Error",description:"Failed to load business settings. Please try again.",variant:"destructive"}),l()}},g=async t=>{if(!m)return console.error("No business selected for updating settings"),u({title:"Error",description:"No business selected",variant:"destructive"}),!1;try{let r={payment_info:t.hasOwnProperty("paymentInfo")?t.paymentInfo:e.paymentInfo||"",default_print_format:t.hasOwnProperty("defaultPrintFormat")?t.defaultPrintFormat:e.defaultPrintFormat||"standard",default_printer_name:t.hasOwnProperty("defaultPrinterName")?t.defaultPrinterName:e.defaultPrinterName||"",default_printer_type:t.hasOwnProperty("defaultPrinterType")?t.defaultPrinterType:e.defaultPrinterType||"USB",printer_paper_size:t.hasOwnProperty("printerPaperSize")?t.printerPaperSize:e.printerPaperSize||"58mm"},a={business_name:t.hasOwnProperty("businessName")?t.businessName:e.businessName,business_address:t.hasOwnProperty("businessAddress")?t.businessAddress:e.businessAddress,business_phone:t.hasOwnProperty("businessPhone")?t.businessPhone:e.businessPhone,business_email:t.hasOwnProperty("businessEmail")?t.businessEmail:e.businessEmail,business_logo:t.hasOwnProperty("businessLogo")?t.businessLogo:e.businessLogo,currency:t.hasOwnProperty("currency")?t.currency:e.currency,signature:t.hasOwnProperty("signature")?t.signature:e.signature,metadata:r},i=await (0,n.upsertBusinessSettingsAction)(m.id,"00000000-0000-0000-0000-000000000000",a);if(!i.success)throw console.error("Supabase error updating business settings:",i.error),Error(i.error);return u({title:"Success",description:"Business settings updated successfully"}),x(),!0}catch(e){return console.error("Error updating business settings:",e),u({title:"Error",description:"Failed to update business settings. Please try again.",variant:"destructive"}),!1}},{data:y,isLoading:h,isFetching:f,refetch:x}=(0,r.useQuery)({queryKey:["businessSettings",m?.id],queryFn:p,enabled:!!m?.id,staleTime:3e5,gcTime:18e5,refetchOnWindowFocus:!1,refetchOnReconnect:!1});return(0,t.useEffect)(()=>{y?s(y):m||s(l())},[y,m]),(0,t.useEffect)(()=>{d(h||f)},[h,f]),{settings:e,isLoading:c,updateSettings:g,loadSettings:p}}],160615)},63209,e=>{"use strict";let t=(0,e.i(475254).default)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);e.s(["AlertCircle",()=>t],63209)},303281,e=>{"use strict";let t=(0,e.i(475254).default)("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]);e.s(["Printer",()=>t],303281)},908482,e=>{"use strict";var t=e.i(271645),r=e.i(908406),a=e.i(422713),i=e.i(555781);e.s(["useCategories",0,e=>{let[s,o]=(0,t.useState)([]),[n,l]=(0,t.useState)(!0),{toast:c}=(0,r.useToast)(),{currentBusiness:d}=(0,a.useBusiness)(),u=(0,t.useCallback)(async()=>{try{if(!d?.id){o([]),l(!1);return}l(!0);let e=await (0,i.getProductCategoriesAction)(d.id);if(!e.success||!e.data)throw Error(e.error||"Failed to fetch categories");let t=e.data.map(e=>({id:e.id,name:e.name,createdAt:e.createdAt?new Date(e.createdAt):e.created_at?new Date(e.created_at):void 0}));o(t)}catch(e){console.error("Error loading categories:",e),c({title:"Error",description:"Failed to load product categories.",variant:"destructive"})}finally{l(!1)}},[d?.id,c]);(0,t.useEffect)(()=>{u()},[u]);let m=async t=>{try{if(!e||!d?.id)return null;let r=s.find(e=>e.name.toLowerCase()===t.toLowerCase());if(r)return c({title:"Category exists",description:"This category already exists."}),r;let a=await (0,i.createProductCategoryAction)(d.id,e,t);if(!a.success||!a.data)throw Error(a.error);let n={id:a.data.id,name:a.data.name,createdAt:new Date(a.data.createdAt)};return o(e=>[...e,n]),c({title:"Success",description:"Category created successfully"}),n}catch(e){return console.error("Error creating category:",e),c({title:"Error",description:"Failed to create category.",variant:"destructive"}),null}},p=async(e,t)=>{try{if(s.find(r=>r.name.toLowerCase()===t.toLowerCase()&&r.id!==e))return c({title:"Category exists",description:"Another category with this name already exists."}),!1;let r=await (0,i.updateProductCategoryAction)(e,t);if(!r.success)throw Error(r.error);return o(r=>r.map(r=>r.id===e?{...r,name:t}:r)),c({title:"Success",description:"Category updated successfully"}),!0}catch(e){return console.error("Error updating category:",e),c({title:"Error",description:"Failed to update category.",variant:"destructive"}),!1}};return{categories:s,isLoading:n,loadCategories:u,createCategory:m,updateCategory:p,deleteCategory:async e=>{try{let t=await (0,i.deleteProductCategoryAction)(e);if(!t.success)return c({title:"Cannot delete category",description:t.error||"Failed to delete category.",variant:"destructive"}),!1;return o(t=>t.filter(t=>t.id!==e)),c({title:"Success",description:"Category deleted successfully"}),!0}catch(e){return console.error("Error deleting category:",e),c({title:"Error",description:"Failed to delete category.",variant:"destructive"}),!1}}}}])},39312,e=>{"use strict";let t=(0,e.i(475254).default)("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);e.s(["Zap",()=>t],39312)},778917,e=>{"use strict";let t=(0,e.i(475254).default)("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);e.s(["ExternalLink",()=>t],778917)},456453,e=>{"use strict";var t=e.i(843476),r=e.i(271645),a=e.i(904792),i=e.i(515288),s=e.i(519455),o=e.i(793479),n=e.i(110204),l=e.i(624687),c=e.i(967489),d=e.i(160615),u=e.i(846696),m=e.i(727612),p=e.i(569074),g=e.i(778917),y=e.i(531278),h=e.i(39312),f=e.i(87316),x=e.i(303281),b=e.i(102594),v=e.i(908406),P=e.i(975157),w=e.i(337822),j=e.i(227766),N=e.i(401851),S=e.i(699375);let k=({initialData:e,categories:k,onProductSubmit:F,isLoading:C})=>{let E=(0,a.useNavigate)(),{settings:B}=(0,d.useBusinessSettings)(),{user:A}=(0,b.useAuth)(),{uploadProductImage:I,compressImage:D}=(e=>{let{toast:t}=(0,v.useToast)(),r=async e=>new Promise((t,r)=>{try{let a=new FileReader;a.onerror=()=>{console.error("FileReader error"),r(Error("Failed to read file"))},a.onload=a=>{try{let i=new Image;i.onerror=()=>{console.error("Image load error"),r(Error("Failed to load image"))},i.onload=()=>{try{let a=(t,a,s)=>new Promise(o=>{let n=document.createElement("canvas");n.width=t,n.height=a;let l=n.getContext("2d");l?(l.clearRect(0,0,t,a),l.drawImage(i,0,0,t,a),n.toBlob(t=>{if(!t)return void r(Error("Could not compress image"));let a=new File([t],`${e.name.replace(/\.[^/.]+$/,"")}-optimized.jpg`,{type:"image/jpeg",lastModified:Date.now()});o(a)},"image/jpeg",s)):r(Error("Could not get canvas context"))});(async()=>{let{width:t,height:r}=i;if(t>400||r>400){let e=t/r;t>r?r=(t=400)/e:t=(r=400)*e}for(let i of(t=Math.max(50,Math.floor(t)),r=Math.max(50,Math.floor(r)),[.8,.6,.4,.3,.2,.1,.05,.02,.01])){let s=await a(t,r,i);if(s.size<=10240)return console.log("Image compression successful:"),console.log(`  Original: ${(e.size/1024).toFixed(1)}KB`),console.log(`  Compressed: ${(s.size/1024).toFixed(1)}KB`),console.log(`  Reduction: ${((e.size-s.size)/e.size*100).toFixed(1)}%`),console.log(`  Dimensions: ${t}x${r}px`),console.log(`  Quality: ${(100*i).toFixed(0)}%`),s}for(let i of[.8,.6,.5,.4,.3,.25,.2]){let s=Math.max(50,Math.floor(t*i)),o=Math.max(50,Math.floor(r*i));for(let t of[.1,.05,.02,.01]){let r=await a(s,o,t);if(r.size<=10240)return console.log("Image compression successful with dimension reduction:"),console.log(`  Original: ${(e.size/1024).toFixed(1)}KB`),console.log(`  Compressed: ${(r.size/1024).toFixed(1)}KB`),console.log(`  Reduction: ${((e.size-r.size)/e.size*100).toFixed(1)}%`),console.log(`  Dimensions: ${s}x${o}px`),console.log(`  Quality: ${(100*t).toFixed(0)}%`),r}}let s=await a(50,50,.01);return console.log("Image compression fallback:"),console.log(`  Original: ${(e.size/1024).toFixed(1)}KB`),console.log(`  Compressed: ${(s.size/1024).toFixed(1)}KB`),console.log("  Dimensions: 50x50px"),s})().then(t).catch(r)}catch(e){console.error("Canvas processing error:",e),r(Error("Failed to process image on canvas"))}},i.src=a.target?.result}catch(e){console.error("Image creation error:",e),r(Error("Failed to create image"))}},a.readAsDataURL(e)}catch(e){console.error("File reading setup error:",e),r(Error("Failed to setup file reader"))}}),a=async e=>new Promise((t,r)=>{try{let a=new FileReader;a.onerror=()=>r(Error("Failed to read file")),a.onload=a=>{try{let i=new Image;i.onerror=()=>r(Error("Failed to load image")),i.onload=()=>{try{let a=document.createElement("canvas");a.width=i.width,a.height=i.height;let s=a.getContext("2d");if(!s)return void r(Error("Could not get canvas context"));s.drawImage(i,0,0),a.toBlob(a=>{if(!a)return void r(Error("Could not process image"));let i=new File([a],e.name,{type:e.type,lastModified:Date.now()});t(i)},e.type,.95)}catch(e){console.error("Metadata removal canvas error:",e),r(Error("Failed to process image"))}},i.src=a.target?.result}catch(e){console.error("Metadata removal image error:",e),r(Error("Failed to load image"))}},a.readAsDataURL(e)}catch(e){console.error("Metadata removal setup error:",e),r(Error("Failed to setup file reader"))}});return{uploadProductImage:async i=>{try{if(!e||!i)return console.error("Missing userId or file for image upload"),null;if(!i.type.startsWith("image/"))return t({title:"Error",description:"Only image files are allowed.",variant:"destructive"}),null;if(i.size>0x1400000)return t({title:"Error",description:"Image file is too large. Maximum size is 20MB.",variant:"destructive"}),null;console.log("Starting image processing..."),t({title:"Processing Image",description:"Optimizing image to under 10KB..."});let s=await a(i),o=await r(s),n=o.size/1024;return console.log(`Final compressed size: ${n.toFixed(1)}KB`),console.warn("Image upload placeholder – integration with Prisma server action/storage required"),t({title:"Image Processed",description:`Image optimized to ${n.toFixed(1)}KB. Backend upload is pending migration.`}),new Promise(e=>{let t=new FileReader;t.onloadend=()=>e(t.result),t.readAsDataURL(o)})}catch(e){return console.error("Error uploading product image:",e),t({title:"Upload Error",description:"Failed to process image.",variant:"destructive"}),null}},compressImage:r,removeMetadata:a}})(A?.id),L=e=>e?{name:e.name,barcode:e.barcode||"",manufacturerBarcode:e.manufacturerBarcode||"",description:e.description||"",category:e.category,quantity:e.quantity??0,costPrice:e.costPrice,sellingPrice:e.sellingPrice,supplier:e.supplier||"",minimumStock:e.minimumStock,imageFile:null,imageUrl:e.imageUrl,createdAt:e.createdAt||new Date,printQuantity:1,autoPrintLabel:!1}:{name:"",barcode:"",manufacturerBarcode:"",description:"",category:"",quantity:0,costPrice:void 0,sellingPrice:void 0,supplier:"",minimumStock:void 0,imageFile:null,imageUrl:null,createdAt:new Date,autoPrintLabel:!0,printQuantity:1},[q,z]=(0,r.useState)(()=>L(e)),[T,O]=(0,r.useState)({}),[R,M]=(0,r.useState)(null),[_,K]=(0,r.useState)(!1),[$,U]=(0,r.useState)(!1),[Q,H]=(0,r.useState)(!1),[G,V]=(0,r.useState)(!1),[W,X]=(0,r.useState)(null),[Z,J]=(0,r.useState)(!1),Y=(0,r.useRef)(null);(0,r.useEffect)(()=>{if(e){console.log("ProductForm - Setting form data from initialData:",e),console.log("ProductForm - InitialData createdAt:",e.createdAt);let t=L(e);z(t),console.log("ProductForm - Form data set to:",t),console.log("ProductForm - Form createdAt set to:",t.createdAt),e.imageUrl&&M(e.imageUrl)}},[e]);let ee=e=>{let{name:t,value:r}=e.target,a=r;("quantity"===t||"minimumStock"===t||"costPrice"===t||"sellingPrice"===t)&&("quantity"===t?console.log("Quantity changed to:",a=""===r?"":parseFloat(r)||0):a=""===r?void 0:parseFloat(r)),z({...q,[t]:a}),T[t]&&O({...T,[t]:""})},et=async e=>{if(e.size>0x1400000)return void u.toast.error("Image file is too large. Maximum size is 20MB.");if(!e.type.startsWith("image/"))return void u.toast.error("Only image files are allowed.");H(!0),X(null);try{let t=await D(e),r=(e.size-t.size)/e.size*100;X({originalSize:e.size,compressedSize:t.size,reduction:r}),z({...q,imageFile:t}),K(!0);let a=new FileReader;a.onload=()=>{M(a.result)},a.readAsDataURL(t),u.toast.success(`Image optimized to ${(t.size/1024).toFixed(1)}KB!`)}catch(e){console.error("Error compressing image:",e),u.toast.error("Failed to process image. Please try again.")}finally{H(!1)}},er=async e=>{let t;if(e.preventDefault(),console.log("ProductForm - Form data before validation:",q),console.log("ProductForm - Quantity value:",q.quantity,"Type:",typeof q.quantity),console.log("ProductForm - CreatedAt value:",q.createdAt),t={},q.name.trim()||(t.name="Product name is required"),void 0!==q.costPrice&&q.costPrice<0&&(t.costPrice="Cost price cannot be negative"),void 0!==q.sellingPrice&&q.sellingPrice<0&&(t.sellingPrice="Selling price cannot be negative"),void 0!==q.minimumStock&&q.minimumStock<0&&(t.minimumStock="Minimum stock cannot be negative"),O(t),0!==Object.keys(t).length)return void u.toast.error("Please correct the errors in the form");let r=q.imageUrl;try{if(_&&q.imageFile){if(U(!0),u.toast.info("Uploading optimized image..."),!(r=await I(q.imageFile)))return void U(!1);u.toast.success("Image uploaded successfully!")}else _&&!q.imageFile&&(r=null);let e="string"==typeof q.quantity?""===q.quantity?0:Number(q.quantity):q.quantity,t={...q,imageUrl:r,quantity:e};console.log("ProductForm - Final submission data:",t),console.log("ProductForm - Final quantity being submitted:",t.quantity),console.log("ProductForm - Final createdAt being submitted:",t.createdAt),await F(t)}catch(e){console.error("Error handling form submission:",e),u.toast.error("Something went wrong. Please try again.")}finally{U(!1)}},ea=C||$;return(0,t.jsxs)(i.Card,{className:"w-full",children:[(0,t.jsxs)(i.CardHeader,{children:[(0,t.jsx)(i.CardTitle,{children:e?"Edit Product":"New Product"}),(0,t.jsx)(i.CardDescription,{children:"Enter the product details below. Only name is required."})]}),(0,t.jsx)(i.CardContent,{children:(0,t.jsxs)("form",{onSubmit:er,className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid gap-3",children:[(0,t.jsx)(n.Label,{htmlFor:"name",children:"Product Name*"}),(0,t.jsx)(o.Input,{id:"name",name:"name",value:q.name,onChange:ee,onKeyDown:e=>{if("Enter"===e.key){e.preventDefault();let t=document.querySelector('[role="combobox"]');t?.focus()}},placeholder:"Enter product name",className:T.name?"border-red-500":"",disabled:ea}),T.name&&(0,t.jsx)("p",{className:"text-red-500 text-xs",children:T.name})]}),(0,t.jsxs)("div",{className:"grid gap-3",children:[(0,t.jsx)(n.Label,{htmlFor:"manufacturerBarcode",children:"Manufacturer Barcode (Optional)"}),(0,t.jsx)(o.Input,{id:"manufacturerBarcode",name:"manufacturerBarcode",value:q.manufacturerBarcode,onChange:ee,onKeyDown:e=>{if("Enter"===e.key){e.preventDefault();let t=document.querySelector('[role="combobox"]');t?.focus()}},placeholder:"Enter manufacturer barcode (if any)",disabled:ea})]}),(0,t.jsxs)("div",{className:"grid gap-3",children:[(0,t.jsx)(n.Label,{htmlFor:"category",children:"Category (Optional)"}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Need to create a new category? Go to the"," ",(0,t.jsxs)(s.Button,{type:"button",variant:"link",className:"p-0 h-auto text-blue-600 underline",onClick:()=>E(`/categories?returnTo=${encodeURIComponent(window.location.pathname)}`),disabled:ea,children:["Categories page ",(0,t.jsx)(g.ExternalLink,{className:"h-3 w-3 ml-1 inline"})]})," ","first, then return here to select it."]}),(0,t.jsxs)(c.Select,{value:q.category,onValueChange:e=>{z({...q,category:e}),T.category&&O({...T,category:""}),setTimeout(()=>{document.getElementById("description")?.focus()},100)},disabled:ea,children:[(0,t.jsx)(c.SelectTrigger,{className:(0,P.cn)(T.category?"border-red-500":""),onKeyDown:e=>{if(console.log("SelectTrigger keydown:",e.key,"Category:",q.category),"Enter"===e.key)return e.preventDefault(),e.stopPropagation(),console.log("Enter pressed on SelectTrigger, focusing description"),setTimeout(()=>{let e=document.getElementById("description");console.log("Description field found:",!!e),e?.focus()},50),!1;"Escape"===e.key&&setTimeout(()=>{document.getElementById("description")?.focus()},50)},children:(0,t.jsx)(c.SelectValue,{placeholder:"Select category (optional)"})}),(0,t.jsx)(c.SelectContent,{children:k.length>0?k.map(e=>(0,t.jsx)(c.SelectItem,{value:e.name,children:e.name},e.id)):(0,t.jsx)("div",{className:"p-2 text-sm text-muted-foreground",children:"No categories available"})})]}),T.category&&(0,t.jsx)("p",{className:"text-red-500 text-xs",children:T.category})]}),(0,t.jsxs)("div",{className:"grid gap-3",children:[(0,t.jsx)(n.Label,{htmlFor:"description",children:"Description"}),(0,t.jsx)(l.Textarea,{id:"description",name:"description",value:q.description,onChange:ee,onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),document.getElementById("supplier")?.focus())},placeholder:"Enter product description",className:"resize-none h-32",disabled:ea})]}),(0,t.jsxs)("div",{className:"grid gap-3",children:[(0,t.jsx)(n.Label,{htmlFor:"supplier",children:"Supplier"}),(0,t.jsx)(o.Input,{id:"supplier",name:"supplier",value:q.supplier,onChange:ee,onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),document.getElementById("quantity")?.focus())},placeholder:"Enter supplier name",disabled:ea})]}),(0,t.jsxs)("div",{className:"grid gap-3",children:[(0,t.jsx)(n.Label,{children:"Created Date"}),(0,t.jsxs)(w.Popover,{open:Z,onOpenChange:J,children:[(0,t.jsx)(w.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)(s.Button,{variant:"outline",className:(0,P.cn)("w-full justify-start text-left font-normal",!q.createdAt&&"text-muted-foreground",e&&"cursor-not-allowed opacity-60"),disabled:ea||!!e,children:[(0,t.jsx)(f.Calendar,{className:"mr-2 h-4 w-4"}),q.createdAt?(0,N.format)(q.createdAt,"PPP"):"Pick a date"]})}),(0,t.jsx)(w.PopoverContent,{className:"w-auto p-0",align:"start",children:(0,t.jsx)(j.Calendar,{mode:"single",selected:q.createdAt,onSelect:e=>{if(e){let t=new Date(e);t.setHours(12,0,0,0),console.log("ProductForm - Date changed to:",t),z({...q,createdAt:t}),J(!1)}},disabled:e=>e>new Date,initialFocus:!0})})]}),e&&(0,t.jsx)("div",{className:"bg-amber-50 border border-amber-200 p-3 rounded-lg",children:(0,t.jsxs)("div",{className:"text-amber-800 text-sm",children:[(0,t.jsx)("strong",{children:"Note:"})," To edit the creation date, please edit the initial stock history entry for this product through the inventory stock history."]})})]})]}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid gap-3",children:[(0,t.jsx)(n.Label,{htmlFor:"imageFile",children:"Product Image"}),(0,t.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[R?(0,t.jsxs)("div",{className:"relative w-full",children:[(0,t.jsx)("img",{src:R,alt:"Product preview",className:"w-full h-40 object-contain border rounded-md"}),(0,t.jsx)(s.Button,{type:"button",variant:"destructive",size:"icon",className:"absolute top-2 right-2 rounded-full h-8 w-8",onClick:()=>{z({...q,imageFile:null,imageUrl:null}),M(null),K(!0),X(null),Y.current&&(Y.current.value="")},disabled:ea||Q,children:(0,t.jsx)(m.Trash2,{className:"h-4 w-4"})}),W&&(0,t.jsxs)("div",{className:"mt-2 p-2 bg-green-50 border border-green-200 rounded-md",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-green-700",children:[(0,t.jsx)(h.Zap,{className:"h-4 w-4"}),(0,t.jsxs)("span",{className:"text-xs font-medium",children:["Optimized to ",(W.compressedSize/1024).toFixed(1),"KB"]})]}),(0,t.jsxs)("div",{className:"text-xs text-green-600 mt-1",children:[(W.originalSize/1024).toFixed(1),"KB → ",(W.compressedSize/1024).toFixed(1),"KB (",W.reduction.toFixed(1),"% reduction)"]})]})]}):(0,t.jsx)("div",{className:(0,P.cn)("border-2 border-dashed rounded-md p-8 w-full flex flex-col items-center justify-center cursor-pointer transition-colors",G?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400",(ea||Q)&&"opacity-50 cursor-not-allowed"),onDragOver:e=>{e.preventDefault(),e.stopPropagation(),V(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),V(!1)},onDrop:e=>{e.preventDefault(),e.stopPropagation(),V(!1),e.dataTransfer.files&&e.dataTransfer.files.length>0&&et(e.dataTransfer.files[0])},onClick:ea||Q?void 0:()=>{Y.current?.click()},children:Q?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(y.Loader2,{className:"h-10 w-10 text-blue-500 mb-2 animate-spin"}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Optimizing image..."}),(0,t.jsx)("p",{className:"text-xs text-gray-400",children:"Compressing to under 15KB"})]}):$?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(y.Loader2,{className:"h-10 w-10 text-blue-500 mb-2 animate-spin"}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Uploading image..."})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p.Upload,{className:"h-10 w-10 text-gray-400 mb-2"}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Click to upload or drag and drop"}),(0,t.jsx)("p",{className:"text-xs text-gray-400",children:"PNG, JPG, GIF up to 20MB"}),(0,t.jsx)("p",{className:"text-xs text-blue-500 mt-1",children:"⚡ Auto Image compression for instant loading"})]})}),(0,t.jsx)("input",{type:"file",id:"imageFile",ref:Y,accept:"image/*",onChange:e=>{let t=e.target.files?.[0];t&&et(t)},className:"hidden",disabled:ea||Q})]})]}),(0,t.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"grid gap-3",children:[(0,t.jsx)(n.Label,{htmlFor:"quantity",children:"Initial Stock"}),(0,t.jsx)(o.Input,{id:"quantity",name:"quantity",type:"number",step:"0.01",value:q.quantity,onChange:ee,onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),document.getElementById("minimumStock")?.focus())},className:T.quantity?"border-red-500":"",disabled:ea,placeholder:"Enter initial stock quantity (can be negative)"}),T.quantity&&(0,t.jsx)("p",{className:"text-red-500 text-xs",children:T.quantity}),e&&(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Current stock: ",e.quantity," units"]})]}),(0,t.jsxs)("div",{className:"grid gap-3",children:[(0,t.jsx)(n.Label,{htmlFor:"minimumStock",children:"Minimum Stock Level"}),(0,t.jsx)(o.Input,{id:"minimumStock",name:"minimumStock",type:"number",min:"0",step:"0.01",value:void 0===q.minimumStock?"":q.minimumStock,onChange:ee,onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),document.getElementById("costPrice")?.focus())},className:T.minimumStock?"border-red-500":"",disabled:ea}),T.minimumStock&&(0,t.jsx)("p",{className:"text-red-500 text-xs",children:T.minimumStock})]})]}),(0,t.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"grid gap-3",children:[(0,t.jsx)(n.Label,{htmlFor:"costPrice",children:"Cost Price"}),(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)("span",{className:"inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500",children:B.currency}),(0,t.jsx)(o.Input,{id:"costPrice",name:"costPrice",type:"number",min:"0",step:"0.01",value:void 0===q.costPrice?"":q.costPrice,onChange:ee,onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),document.getElementById("sellingPrice")?.focus())},className:`rounded-l-none ${T.costPrice?"border-red-500":""}`,disabled:ea})]}),T.costPrice&&(0,t.jsx)("p",{className:"text-red-500 text-xs",children:T.costPrice})]}),(0,t.jsxs)("div",{className:"grid gap-3",children:[(0,t.jsx)(n.Label,{htmlFor:"sellingPrice",children:"Selling Price"}),(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)("span",{className:"inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500",children:B.currency}),(0,t.jsx)(o.Input,{id:"sellingPrice",name:"sellingPrice",type:"number",min:"0",step:"0.01",value:void 0===q.sellingPrice?"":q.sellingPrice,onChange:ee,onKeyDown:e=>{if("Enter"===e.key){e.preventDefault();let t=document.querySelector('button[type="submit"]');t?.focus()}},className:`rounded-l-none ${T.sellingPrice?"border-red-500":""}`,disabled:ea})]}),T.sellingPrice&&(0,t.jsx)("p",{className:"text-red-500 text-xs",children:T.sellingPrice})]})]}),(0,t.jsx)("div",{className:"grid gap-3",children:(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"* Required fields | Initial Stock: The starting quantity for this product"})})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-end space-x-4",children:[(0,t.jsx)(s.Button,{variant:"outline",type:"button",onClick:()=>E("/inventory"),disabled:ea||Q,children:"Cancel"}),(0,t.jsx)(s.Button,{type:"submit",disabled:ea||Q,className:"min-w-[100px]",children:Q?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(y.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Optimizing..."]}):ea?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(y.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),$?"Uploading...":"Saving..."]}):e?"Update Product":"Create Product"})]}),!e&&(0,t.jsxs)("div",{className:"flex flex-col md:flex-row items-center justify-end gap-4 pt-3 border-t",children:[q.autoPrintLabel&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(n.Label,{htmlFor:"printQuantity",className:"text-sm text-muted-foreground whitespace-nowrap",children:"Quantity to print:"}),(0,t.jsx)(o.Input,{id:"printQuantity",type:"number",min:"1",className:"w-20 h-8",value:q.printQuantity,onChange:e=>z(t=>({...t,printQuantity:parseInt(e.target.value)||1})),disabled:ea})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(x.Printer,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsx)(n.Label,{htmlFor:"autoPrint",className:"text-sm font-medium cursor-pointer",children:"Auto-print barcode label"}),(0,t.jsx)(S.Switch,{id:"autoPrint",checked:q.autoPrintLabel,onCheckedChange:e=>z(t=>({...t,autoPrintLabel:e})),disabled:ea})]})]})]})})]})};var F=e.i(908962),C=e.i(908482),E=e.i(871689),B=e.i(16715),A=e.i(777624),I=e.i(929592),D=e.i(63209);e.s(["default",0,()=>{let{id:e}=(0,a.useParams)(),i=(0,a.useLocation)(),o=(0,a.useNavigate)(),{user:n}=(0,b.useAuth)(),{products:l,isLoading:c,createProduct:m,updateProduct:p,loadProducts:g,refetch:y}=(0,F.useProducts)(n?.id,1e4),{categories:h,isLoading:f}=(0,C.useCategories)(n?.id),[x,v]=(0,r.useState)(void 0),[w,j]=(0,r.useState)(!1),[N,S]=(0,r.useState)(null),[L,q]=(0,r.useState)(!1),[z,T]=(0,r.useState)(!1),{settings:O}=(0,d.useBusinessSettings)(),{hasPermission:R,isLoading:M}=(0,A.useProfiles)(),_=i.state?.duplicateData,K=async()=>{if(e){q(!0),S(null);let{data:t}=await y(),r=(t?.products||[]).find(t=>t.id===e);r?(v(r),T(!0)):(S("Product not found. It may have been deleted or you may not have permission to view it."),u.toast.error("Product not found")),q(!1)}else T(!0)};(0,r.useEffect)(()=>{if(e&&l.length>0&&!z){let t=l.find(t=>t.id===e);t?(v(t),T(!0),S(null)):l.length>0&&(S("Product not found. It may have been deleted or you may not have permission to view it."),u.toast.error("Product not found"))}else e||T(!0)},[e,l.length,z]);let $=async()=>{u.toast.info("Refreshing product data..."),T(!1),await K()},U=async t=>{j(!0);try{if(e&&x){let r={name:t.name,description:t.description||"",category:t.category||"",quantity:t.quantity,costPrice:t.costPrice??0,sellingPrice:t.sellingPrice??0,supplier:t.supplier||"",minimumStock:t.minimumStock??0,imageUrl:t.imageUrl||null,createdAt:t.createdAt,barcode:t.barcode,manufacturerBarcode:t.manufacturerBarcode};await p(e,r)?(u.toast.success("Product updated successfully"),o(`/inventory/${e}`)):u.toast.error("Failed to update product")}else{if(!n?.id)return void u.toast.error("You must be logged in to create products");let e={id:"",name:t.name,description:t.description||"",category:t.category||"",quantity:t.quantity,costPrice:t.costPrice??0,sellingPrice:t.sellingPrice??0,supplier:t.supplier||"",minimumStock:t.minimumStock??0,imageUrl:t.imageUrl||null,createdAt:t.createdAt||new Date,updatedAt:new Date,barcode:t.barcode||"",manufacturerBarcode:t.manufacturerBarcode||""},r=await m(e);if(r){if(u.toast.success("Product created successfully"),t.autoPrintLabel&&r.barcode)try{let e=t.printQuantity||1;u.toast.info(`Sending ${e} barcode label${e>1?"s":""} to printer...`),await fetch("http://localhost:5000/print/label",{method:"POST",headers:{"Content-Type":"application/json"},mode:"cors",body:JSON.stringify({PrinterName:O.defaultPrinterName||"Label Printer",Content:`SIZE 50 mm, 30 mm
GAP 3 mm, 0 mm
CLS
TEXT 15,20,"3",0,1,1,"${r.name}"
BARCODE 15,70,"128",60,1,0,2,2,"${r.barcode}"
TEXT 15,180,"3",0,1,1,"${O.currency} ${(0,P.formatNumber)(r.sellingPrice)}"
PRINT ${e}
`})}),u.toast.success("Barcode label printed")}catch(e){console.error("Failed to auto-print label:",e),u.toast.error("Failed to print label. Is the Printer Bridge running?")}o(`/inventory/${r.id}`)}else u.toast.error("Failed to create product")}}catch(e){console.error("Error submitting product:",e),u.toast.error("An error occurred while saving the product")}finally{j(!1)}},Q=c||f||w||L,H=_?{..._,quantity:0,id:"",itemNumber:"",createdAt:new Date,updatedAt:new Date,barcode:"",manufacturerBarcode:""}:x,G=!e||R("inventory","edit"),V=!!e||R("inventory","create");return M||c||f?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):G&&V?!e||z||N?(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(s.Button,{variant:"outline",size:"sm",onClick:()=>o("/inventory"),className:"flex items-center gap-1",children:[(0,t.jsx)(E.ArrowLeft,{className:"h-4 w-4"})," Back to Inventory"]}),e&&(0,t.jsxs)(s.Button,{variant:"outline",size:"sm",onClick:$,disabled:Q,className:"flex items-center gap-1",children:[(0,t.jsx)(B.RefreshCw,{className:`h-4 w-4 ${L?"animate-spin":""}`}),L?"Refreshing...":"Refresh Data"]})]}),N?(0,t.jsxs)("div",{className:"p-6 bg-red-50 border border-red-200 rounded-md",children:[(0,t.jsx)("h3",{className:"text-lg font-medium text-red-800 mb-2",children:"Error Loading Product"}),(0,t.jsx)("p",{className:"text-red-600",children:N}),(0,t.jsx)(s.Button,{className:"mt-4",onClick:()=>o("/inventory"),children:"Return to Inventory"})]}):(0,t.jsx)(k,{initialData:H,categories:h,onProductSubmit:U,isLoading:Q})]}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"flex items-center justify-between",children:(0,t.jsxs)(s.Button,{variant:"outline",size:"sm",onClick:()=>o("/inventory"),className:"flex items-center gap-1",children:[(0,t.jsx)(E.ArrowLeft,{className:"h-4 w-4"})," Back to Inventory"]})}),(0,t.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Loading product data..."})]})})]}):(0,t.jsxs)("div",{className:"max-w-4xl mx-auto p-6",children:[(0,t.jsxs)(I.Alert,{variant:"destructive",children:[(0,t.jsx)(D.AlertCircle,{className:"h-4 w-4"}),(0,t.jsx)(I.AlertTitle,{children:"Access Denied"}),(0,t.jsxs)(I.AlertDescription,{children:["You do not have permission to ",e?"edit this product":"create a new product",". Please contact your administrator if you believe this is an error."]})]}),(0,t.jsx)("div",{className:"mt-4",children:(0,t.jsx)(s.Button,{onClick:()=>o("/inventory"),variant:"outline",children:"Back to Inventory"})})]})}],456453)}]);