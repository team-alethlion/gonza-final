(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,561993,e=>{"use strict";var t=e.i(843476),r=e.i(271645),o=e.i(794527),i=e.i(975157);let n=({shouldScaleBackground:e=!0,...r})=>(0,t.jsx)(o.Drawer.Root,{shouldScaleBackground:e,...r});n.displayName="Drawer",o.Drawer.Trigger;let a=o.Drawer.Portal,s=o.Drawer.Close,l=r.forwardRef(({className:e,...r},n)=>(0,t.jsx)(o.Drawer.Overlay,{ref:n,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80",e),...r}));l.displayName=o.Drawer.Overlay.displayName;let d=r.forwardRef(({className:e,children:r,...n},s)=>(0,t.jsxs)(a,{children:[(0,t.jsx)(l,{}),(0,t.jsxs)(o.Drawer.Content,{ref:s,className:(0,i.cn)("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",e),...n,children:[(0,t.jsx)("div",{className:"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"}),r]})]}));d.displayName="DrawerContent";let c=({className:e,...r})=>(0,t.jsx)("div",{className:(0,i.cn)("grid gap-1.5 p-4 text-center sm:text-left",e),...r});c.displayName="DrawerHeader";let u=({className:e,...r})=>(0,t.jsx)("div",{className:(0,i.cn)("mt-auto flex flex-col gap-2 p-4",e),...r});u.displayName="DrawerFooter";let m=r.forwardRef(({className:e,...r},n)=>(0,t.jsx)(o.Drawer.Title,{ref:n,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",e),...r}));m.displayName=o.Drawer.Title.displayName,r.forwardRef(({className:e,...r},n)=>(0,t.jsx)(o.Drawer.Description,{ref:n,className:(0,i.cn)("text-sm text-muted-foreground",e),...r})).displayName=o.Drawer.Description.displayName,e.s(["Drawer",()=>n,"DrawerClose",()=>s,"DrawerContent",()=>d,"DrawerFooter",()=>u,"DrawerHeader",()=>c,"DrawerTitle",()=>m])},531278,e=>{"use strict";let t=(0,e.i(475254).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],531278)},624687,e=>{"use strict";var t=e.i(843476),r=e.i(271645),o=e.i(975157);let i=r.forwardRef(({className:e,...r},i)=>(0,t.jsx)("textarea",{className:(0,o.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:i,...r}));i.displayName="Textarea",e.s(["Textarea",()=>i])},410160,e=>{"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e.s(["default",()=>t])},178583,e=>{"use strict";let t=(0,e.i(475254).default)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);e.s(["FileText",()=>t],178583)},392401,e=>{"use strict";var t=e.i(777624);e.s(["useFinancialVisibility",0,()=>{let{hasPermission:e}=(0,t.useProfiles)(),r=e("inventory","view_cost_price"),o=e("inventory","view_profit"),i=e("inventory","view_selling_price"),n=e("dashboard","view_total_sales"),a=e("dashboard","view_gross_profit"),s=e("dashboard","view_total_expenses"),l=e("dashboard","view_inventory_value"),d=e("dashboard","view_sales_types"),c=e("dashboard","view_avg_price"),u=e("dashboard","view_total_amount"),m=e("finance","manage_accounts"),f=e("finance","view"),p=e("expenses","view"),g=e("expenses","create"),y=e("expenses","edit");return{canViewCostPrice:r,canViewProfit:o,canViewSellingPrice:i,canViewTotalSales:n,canViewTotalGrossProfit:a,canViewTotalExpenses:s,canViewInventoryValue:l,canViewSalesTypes:d,canViewAvgPrice:c,canViewTotalAmount:u,canManageFinanceAccounts:m,canViewFinance:f,canViewExpenses:p,canCreateExpenses:g,canEditExpenses:y,canDeleteExpenses:e("expenses","delete"),formatFinancial:(e,t)=>"cost"===t&&r||"selling"===t&&i||"profit"===t&&o?e?.toLocaleString()||"0":"•••"}}])},784774,e=>{"use strict";var t=e.i(843476),r=e.i(271645),o=e.i(975157);let i=r.forwardRef(({className:e,...r},i)=>(0,t.jsx)("div",{className:"relative w-full overflow-auto",children:(0,t.jsx)("table",{ref:i,className:(0,o.cn)("w-full caption-bottom text-sm",e),...r})}));i.displayName="Table";let n=r.forwardRef(({className:e,...r},i)=>(0,t.jsx)("thead",{ref:i,className:(0,o.cn)("[&_tr]:border-b",e),...r}));n.displayName="TableHeader";let a=r.forwardRef(({className:e,...r},i)=>(0,t.jsx)("tbody",{ref:i,className:(0,o.cn)("[&_tr:last-child]:border-0",e),...r}));a.displayName="TableBody",r.forwardRef(({className:e,...r},i)=>(0,t.jsx)("tfoot",{ref:i,className:(0,o.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...r})).displayName="TableFooter";let s=r.forwardRef(({className:e,...r},i)=>(0,t.jsx)("tr",{ref:i,className:(0,o.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...r}));s.displayName="TableRow";let l=r.forwardRef(({className:e,...r},i)=>(0,t.jsx)("th",{ref:i,className:(0,o.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...r}));l.displayName="TableHead";let d=r.forwardRef(({className:e,...r},i)=>(0,t.jsx)("td",{ref:i,className:(0,o.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...r}));d.displayName="TableCell",r.forwardRef(({className:e,...r},i)=>(0,t.jsx)("caption",{ref:i,className:(0,o.cn)("mt-4 text-sm text-muted-foreground",e),...r})).displayName="TableCaption",e.s(["Table",()=>i,"TableBody",()=>a,"TableCell",()=>d,"TableHead",()=>l,"TableHeader",()=>n,"TableRow",()=>s])},804760,e=>{"use strict";var t=e.i(255749);let r=(e,t="Ush")=>{let r=Math.round(e).toLocaleString();return`${t} ${r}`},o=async(e,o)=>{let{filename:i,orientation:n="portrait",format:a="a4",margins:s={top:20,right:20,bottom:20,left:20},returnBlob:l=!1}=o,d=new t.default({orientation:n,unit:"mm",format:a,compress:!0}),c=d.internal.pageSize.getWidth(),u=d.internal.pageSize.getHeight(),m=c-s.left-s.right,f=s.top,p=()=>{d.setLineWidth(.2)},g=(e,t,r,o={})=>{let{fontSize:i=10,fontStyle:n="normal",align:a="left",maxWidth:s}=o;if(d.setFontSize(i),d.setFont("helvetica",n),!s)return d.text(e,t,r,{align:a}),.35*i;{let o=d.splitTextToSize(e,s);return d.text(o,t,r,{align:a}),o.length*(.35*i)}},y=(e,t,r,o,i={})=>{let{fontSize:n=10,fontStyle:a="normal",align:s="left",lineHeight:l=1.2}=i;d.setFontSize(n),d.setFont("helvetica",a);let c=d.splitTextToSize(e,o),u=.35*n*l;return c.forEach((e,o)=>{d.text(e,t,r+o*u,{align:s})}),c.length*u},h=(e,t,r,o)=>{p(),d.line(e,t,r,o)},b=(e,t,r,o,i="S")=>{p(),d.rect(e,t,r,o,i)},w=()=>{b(s.left,s.top,m,u-s.top-s.bottom,"S")},v=e=>f+e>u-s.bottom&&(d.addPage(),f=s.top+10,w(),!0);w();let S=s.left+8,x=m-16;if(f+=8,e.businessLogo)try{let t=new Image;t.crossOrigin="anonymous",await new Promise((r,o)=>{t.onload=()=>{try{let e=document.createElement("canvas"),r=e.getContext("2d");if(r){e.width=t.width,e.height=t.height,r.drawImage(t,0,0);let o=e.toDataURL("image/png"),i=t.width/t.height;d.addImage(o,"PNG",S,f,15*i,15)}}catch(e){console.error("Error adding logo to PDF:",e)}r()},t.onerror=()=>{console.error("Error loading logo image"),r()},t.src=e.businessLogo})}catch(e){console.error("Error processing logo:",e)}let _=.75*x,N=S+x,P=f;if(e.businessName&&(P+=g(e.businessName,N,P,{fontSize:14,fontStyle:"bold",align:"right"}),P+=1.5),e.businessAddress){let t=d.splitTextToSize(e.businessAddress,_);t.forEach((e,t)=>{d.setFontSize(10),d.setFont("helvetica","normal"),d.text(e,N,P+3.15*t,{align:"right"})}),P+=3.15*t.length+.5}e.businessPhone&&(P+=g(`Phone: ${e.businessPhone}`,N,P,{fontSize:9,align:"right"}),P+=.5),e.businessEmail&&(P+=g(`Email: ${e.businessEmail}`,N,P,{fontSize:9,align:"right"}),P+=.5),f=Math.max(f+18,P)+5,v(20),h(S,f,S+x,f),f+=6,f+=g(e.documentTitle.toUpperCase(),c/2,f,{fontSize:16,fontStyle:"bold",align:"center"});let C=f+=4,A=C;A+=g(`${e.documentNumberLabel} ${e.receiptNumber}`,S,A,{fontSize:11,fontStyle:"bold"}),A+=2,A+=g(`Date: ${e.date}`,S,A,{fontSize:10}),A+=2,A+=g(`Time: ${e.time}`,S,A,{fontSize:10});let I=S+.7*x;if(g(`Status: ${e.status}`,I,C,{fontSize:11,fontStyle:"bold",align:"left"}),f=A+4,e.customerName&&""!==e.customerName.trim()){if(v(30),f+=g("Customer Information:",S,f,{fontSize:11,fontStyle:"bold"}),f+=3,f+=g(e.customerName,S,f,{fontSize:10}),f+=2.5,e.customerAddress&&""!==e.customerAddress.trim()){let t=y(e.customerAddress,S,f,.8*x,{fontSize:10,lineHeight:1});f+=t,f+=2.5}e.customerContact&&""!==e.customerContact.trim()&&(f+=g(e.customerContact,S,f,{fontSize:10}),f+=2.5),f+=3}let E=e.items.some(e=>(e.discountPercentage||0)>0||(e.discountAmount||0)>0),T=E?["Description","Qty","Unit Price","Discount","Amount"]:["Description","Qty","Unit Price","Amount"],D=E?[.35*x,.15*x,.18*x,.12*x,.2*x]:[.45*x,.15*x,.2*x,.2*x];d.setFillColor(245,245,245),b(S,f-2,x,10,"F"),b(S,f-2,x,10,"S");let z=S;T.forEach((e,t)=>{g(e,z+3,f+4,{fontSize:10,fontStyle:"bold"}),t<T.length-1&&h(z+D[t],f-2,z+D[t],f+8),z+=D[t]}),f+=10;let F=0;e.items.forEach((t,o)=>{d.setFontSize(9);let i=Math.max(8,3.5*d.splitTextToSize(t.description,D[0]-6).length+4);v(i+5),t.unitPrice,t.quantity,t.discountAmount;let n=t.amount;if(F+=n,o%2==1&&(d.setFillColor(250,250,250),b(S,f,x,i,"F")),b(S,f,x,i,"S"),z=S,y(t.description,z+3,f+4,D[0]-6,{fontSize:9,lineHeight:1.1}),h(z+=D[0],f,z,f+i),g(t.quantity.toString(),z+D[1]-3,f+i/2+1.5,{fontSize:9,align:"right"}),h(z+=D[1],f,z,f+i),g(r(t.unitPrice,e.currency),z+D[2]-3,f+i/2+1.5,{fontSize:9,align:"right"}),h(z+=D[2],f,z,f+i),E){let o="-";(t.discountPercentage||0)>0?o=`${t.discountPercentage}%`:(t.discountAmount||0)>0&&(o=r(t.discountAmount,e.currency)),g(o,z+D[3]-3,f+i/2+1.5,{fontSize:9,align:"right"}),h(z+=D[3],f,z,f+i)}g(r(n,e.currency),z+D[E?4:3]-3,f+i/2+1.5,{fontSize:9,align:"right"}),f+=i,o<e.items.length-1&&h(S,f,S+x,f)}),f+=5,v(70);let L=S+.45*x,$=.55*x,k=.55*$,j=.45*$,R=e.items.reduce((e,t)=>{let r=t.unitPrice*t.quantity;return e+("amount"===t.discountType?t.discountAmount||0:r*(t.discountPercentage||0)/100)},0);if(R>0&&(b(L,f,$,8,"S"),d.setFillColor(248,248,248),b(L,f,$,8,"F"),g("Subtotal (before discount):",L+4,f+5.5,{fontSize:10,fontStyle:"normal"}),h(L+k,f,L+k,f+8),g(r(F+R,e.currency),L+k+j-4,f+5.5,{fontSize:10,fontStyle:"normal",align:"right"}),b(L,f+=8,$,8,"S"),d.setFillColor(255,240,220),b(L,f,$,8,"F"),g("Total Discount:",L+4,f+5.5,{fontSize:10,fontStyle:"normal"}),h(L+k,f,L+k,f+8),g(`-${r(R,e.currency)}`,L+k+j-4,f+5.5,{fontSize:10,fontStyle:"normal",align:"right"}),f+=8),b(L,f,$,8,"S"),d.setFillColor(248,248,248),b(L,f,$,8,"F"),g(R>0?"Subtotal (after discount):":"Subtotal:",L+4,f+5.5,{fontSize:10,fontStyle:"normal"}),h(L+k,f,L+k,f+8),g(r(F,e.currency),L+k+j-4,f+5.5,{fontSize:10,fontStyle:"normal",align:"right"}),f+=8,e.showTaxRow&&e.taxAmount>0&&(b(L,f,$,8,"S"),d.setFillColor(250,250,250),b(L,f,$,8,"F"),g(`Tax (${e.taxRate}%):`,L+4,f+5.5,{fontSize:10,fontStyle:"normal"}),h(L+k,f,L+k,f+8),g(r(e.taxAmount,e.currency),L+k+j-4,f+5.5,{fontSize:10,fontStyle:"normal",align:"right"}),f+=8),b(L,f,$,12,"S"),d.setFillColor(220,220,220),b(L,f,$,12,"F"),g("TOTAL:",L+4,f+7.5,{fontSize:12,fontStyle:"bold"}),h(L+k,f,L+k,f+12),g(r(e.totalAmount,e.currency),L+k+j-4,f+7.5,{fontSize:12,fontStyle:"bold",align:"right"}),f+=12,e.isInstallmentSale&&(void 0!==e.amountPaid&&(b(L,f,$,8,"S"),d.setFillColor(240,248,255),b(L,f,$,8,"F"),g("Amount Paid:",L+4,f+5.5,{fontSize:10,fontStyle:"bold"}),h(L+k,f,L+k,f+8),g(r(e.amountPaid,e.currency),L+k+j-4,f+5.5,{fontSize:10,fontStyle:"bold",align:"right"}),f+=8),void 0!==e.amountDue&&(b(L,f,$,8,"S"),d.setFillColor(255,240,240),b(L,f,$,8,"F"),g("Amount Due:",L+4,f+5.5,{fontSize:10,fontStyle:"bold"}),h(L+k,f,L+k,f+8),g(r(e.amountDue,e.currency),L+k+j-4,f+5.5,{fontSize:10,fontStyle:"bold",align:"right"}),f+=8)),f+=7,e.totalAmountInWords){v(20),g("Amount in words:",S,f+=2,{fontSize:10,fontStyle:"bold"}),f+=4;let t=y(`${e.currency} ${e.totalAmountInWords} only`,S,f,.9*x,{fontSize:10,fontStyle:"italic",lineHeight:1.4});f+=t+4}if(e.hasPaymentInfo&&e.paymentMethods&&e.paymentMethods.length>0){v(40),h(S,f,S+x,f),g("Payment Information:",S,f+=5,{fontSize:11,fontStyle:"bold"}),f+=4;let t=["Payment Method","Account Number","Account Name"],r=[.28*x,.36*x,.36*x];d.setFillColor(240,240,240),b(S,f-2,x,10,"F"),b(S,f-2,x,10,"S");let o=S;t.forEach((e,i)=>{g(e,o+4,f+4,{fontSize:9,fontStyle:"bold"}),i<t.length-1&&h(o+r[i],f-2,o+r[i],f+10-2),o+=r[i]}),f+=10,e.paymentMethods.filter(e=>e.method.trim()||e.accountNumber.trim()||e.accountName.trim()).forEach((e,t)=>{v(15),t%2==1&&(d.setFillColor(248,248,248),b(S,f,x,10,"F")),b(S,f,x,10,"S"),o=S,g(e.method,o+4,f+5,{fontSize:9,fontStyle:"bold"}),h(o+=r[0],f,o,f+10),g(e.accountNumber,o+4,f+5,{fontSize:9}),h(o+=r[1],f,o,f+10),g(e.accountName,o+4,f+5,{fontSize:9}),f+=10}),f+=4}if(e.notes&&e.notes.trim()){v(25),h(S,f,S+x,f),g("Notes:",S,f+=4,{fontSize:11,fontStyle:"bold"}),f+=6;let t=x-8;d.splitTextToSize(e.notes,t).forEach(e=>{v(8),g(e,S+4,f,{fontSize:10}),f+=5}),f+=4}if(e.signature)try{v(35);let t=new Image;t.crossOrigin="anonymous",await new Promise(r=>{t.onload=()=>{try{let e=document.createElement("canvas"),r=e.getContext("2d");if(r){let o,i;e.width=t.width,e.height=t.height,r.drawImage(t,0,0);let n=e.toDataURL("image/png"),a=t.width/t.height;a>2?(o=40,i=40/a):(i=20,o=20*a);let s=S+x-o;h(S,f,S+x,f),f+=4,d.addImage(n,"PNG",s,f,o,i),f+=i+2,g("Authorized Signature",s+o/2,f,{fontSize:8,align:"center"}),f+=4}}catch(e){console.error("Error adding signature to PDF:",e)}r()},t.onerror=()=>{console.error("Error loading signature image"),r()},t.src=e.signature})}catch(e){console.error("Error processing signature:",e)}if(v(25),g("Thank you for your business!",c/2,f+=6,{fontSize:11,fontStyle:"bold",align:"center"}),g("Created by Gonza Systems",c/2,f+=5,{fontSize:9,align:"center"}),l)return d.output("blob");i&&d.save(i)};e.s(["generateReceiptVectorPDF",0,o])},986387,e=>{"use strict";var t=e.i(102594);e.s(["useCurrentUser",0,()=>{let{user:e}=(0,t.useAuth)();return{userId:e?.id}}])},589271,e=>{"use strict";e.s(["mapDbProductToProduct",0,e=>({id:e.id,itemNumber:e.item_number,barcode:e.barcode,manufacturerBarcode:e.manufacturer_barcode,name:e.name,description:e.description,category:e.category,quantity:e.quantity,costPrice:Number(e.cost_price),sellingPrice:Number(e.selling_price),supplier:e.supplier,imageUrl:e.image_url,minimumStock:e.minimum_stock,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}),"mapDbSaleToSale",0,e=>{let t=(Array.isArray(e.items)?e.items:[]).map(e=>{let t=void 0!==e.discountPercentage?Number(e.discountPercentage):void 0,r=void 0!==e.discountAmount?Number(e.discountAmount):void 0,o=e.discountType;return!o&&(t&&t>0?o="percentage":r&&r>0&&(o="amount")),{description:e.description||"",quantity:Number(e.quantity)||0,price:Number(e.price)||0,cost:Number(e.cost)||0,productId:e.productId||void 0,discountType:o,discountPercentage:t,discountAmount:r,createdAt:e.createdAt||void 0}});return{id:e.id,receiptNumber:e.receipt_number,customerName:e.customer_name,customerAddress:e.customer_address||"",customerContact:e.customer_contact||"",customerId:e.customer_id||void 0,items:t,paymentStatus:e.payment_status,profit:Number(e.profit),date:new Date(e.date),taxRate:e.tax_rate?Number(e.tax_rate):0,cashTransactionId:e.cash_transaction_id||void 0,amountPaid:e.amount_paid?Number(e.amount_paid):void 0,amountDue:e.amount_due?Number(e.amount_due):void 0,notes:e.notes||"",categoryId:e.category_id||void 0,createdAt:new Date(e.created_at)}},"mapSaleToDbSale",0,(e,t,r,o,i,n,a)=>({user_id:i,location_id:n,receipt_number:o,customer_name:e.customerName,customer_address:e.customerAddress||null,customer_contact:e.customerContact||null,customer_id:e.customerId||null,items:e.items,payment_status:e.paymentStatus,profit:r,date:t.toISOString().split("T")[0],tax_rate:e.taxRate||0,cash_transaction_id:a||null,amount_paid:e.amountPaid||null,amount_due:e.amountDue||null,notes:e.notes||null,category_id:e.categoryId||null})])},457786,e=>{"use strict";var t=e.i(95187);let r=(0,t.createServerReference)("401d907b5cd7e0b2f207e9b555ac4fe2e14de08444",t.callServer,void 0,t.findSourceMapURL,"logActivityAction");var o=e.i(986387),i=e.i(422713),n=e.i(777624);e.s(["useActivityLogger",0,()=>{let{userId:e}=(0,o.useCurrentUser)(),{currentBusiness:t}=(0,i.useBusiness)(),a=null;try{let{currentProfile:e}=(0,n.useProfiles)();a=e}catch{a=null}return{logActivity:async o=>{if(!e||!t?.id)return void console.warn("Cannot log activity: missing user or business context");try{let i=await r({userId:e,locationId:t.id,activityType:o.activityType,module:o.module,entityType:o.entityType,entityId:o.entityId||void 0,entityName:o.entityName,description:o.description,metadata:o.metadata||void 0,profileId:a?.id||void 0,profileName:a?.profile_name||void 0});i.success||console.error("Error logging activity:",i.error)}catch(e){console.error("Failed to log activity:",e)}}}}],457786)},146786,850823,617318,e=>{"use strict";var t=e.i(271645),r=e.i(589271),o=e.i(908406),i=e.i(266027),n=e.i(912598),a=e.i(457786),s=e.i(422713),l=e.i(908962),d=e.i(846696),c=e.i(555781);let u=e=>{let{updateProductsBulk:t}=(0,l.useProducts)(e),r=async(e,t)=>{if(!e.length)return[];try{return await (0,c.getProductsByIdsAction)(e,t)}catch(e){throw console.error("Error fetching fresh products:",e),e}};return{deductStockForSale:async(o,i,n,a,s)=>{if(!e)return!1;try{let l=o.filter(e=>e.productId);if(0===l.length)return!0;let c=[...new Set(l.map(e=>e.productId))],u=await r(c,s);if(0===u.length)return!1;let m=new Map;for(let e of l){let t=m.get(e.productId)||0;m.set(e.productId,t+e.quantity)}let f=[];for(let[e,t]of m.entries()){let r=u.find(t=>t.id===e);if(!r)continue;let o=r.quantity-t;f.push({id:e,updated:{...r,quantity:o}}),o<0&&d.toast.warning(`${r.name} inventory is now negative (${o}). Please restock soon.`)}return f.length>0&&await t(f,e,"Sale",i,n,a),!0}catch(e){return console.error("Error deducting stock for sale:",e),!1}},restoreStockForSale:async(o,i,n,a)=>{if(!e)return!1;try{let s=o.filter(e=>e.productId);if(0===s.length)return!0;let l=[...new Set(s.map(e=>e.productId))],d=await r(l,a),c=new Map;for(let e of s){let t=c.get(e.productId)||0;c.set(e.productId,t+e.quantity)}let u=[];for(let[e,t]of c.entries()){let r=d.find(t=>t.id===e);if(!r)continue;let o=r.quantity+t;u.push({id:e,updated:{...r,quantity:o}})}return u.length>0&&await t(u,e,"Deleted Sale",i,void 0,n),!0}catch(e){return console.error("Error restoring stock for sale:",e),!1}},adjustStockForEditedSale:async(o,i,n,a,s,l)=>{if(!e)return!1;try{let c=[...o.filter(e=>e.productId).map(e=>e.productId),...i.filter(e=>e.productId).map(e=>e.productId)],u=[...new Set(c)];if(0===u.length)return!0;let m=await r(u,l),f=new Map;for(let e of o.filter(e=>e.productId)){let t=f.get(e.productId)||0;f.set(e.productId,t+e.quantity)}for(let e of i.filter(e=>e.productId)){let t=f.get(e.productId)||0;f.set(e.productId,t-e.quantity)}let p=[];for(let[e,t]of f.entries()){if(0===t)continue;let r=m.find(t=>t.id===e);if(!r)continue;let o=r.quantity+t;p.push({id:e,updated:{...r,quantity:o}}),o<0&&d.toast.warning(`${r.name} inventory is now negative (${o}). Please restock soon.`)}return p.length>0&&await t(p,e,"Sale Status/Qty Edit",n,a,s),!0}catch(e){return console.error("Error adjusting stock for edited sale:",e),!1}}}};e.s(["useInventoryActions",0,u],850823);var m=e.i(224410),f=e.i(95187);let p=(0,f.createServerReference)("703e9376bfaf2adbf9aba886e70ba6b561f6bf5e0c",f.callServer,void 0,f.findSourceMapURL,"getSalesAction"),g=(0,f.createServerReference)("40d9064371ce5c0811194879498fdc849fbf872b8a",f.callServer,void 0,f.findSourceMapURL,"deleteSaleAction");e.s(["deleteSaleAction",()=>g],617318),e.s(["useSalesData",0,(e,l="desc",d)=>{let c=(0,n.useQueryClient)(),{toast:f}=(0,o.useToast)(),{logActivity:y}=(0,a.useActivityLogger)(),{currentBusiness:h}=(0,s.useBusiness)(),{restoreStockForSale:b}=u(e),w=(0,t.useCallback)(async()=>{try{if(!e||!h)return[];let t=await p(h.id,l,d);return t?t.map(e=>{let t={id:e.id,user_id:e.user_id,location_id:e.location_id,receipt_number:e.receipt_number,customer_name:e.customer_name,customer_address:e.customer_address,customer_contact:e.customer_contact,customer_id:e.customer_id,items:e.items,payment_status:e.payment_status,profit:e.profit?Number(e.profit):0,date:e.date,tax_rate:e.tax_rate||0,created_at:e.created_at,updated_at:e.updated_at,cash_transaction_id:e.cash_transaction_id,amount_paid:e.amount_paid?Number(e.amount_paid):void 0,amount_due:e.amount_due?Number(e.amount_due):void 0,category_id:e.category_id,notes:e.notes};return(0,r.mapDbSaleToSale)(t)}):[]}catch(e){return console.error("Error loading sales:",e),f({title:"Error",description:"Failed to load sales data. Please try again.",variant:"destructive"}),[]}},[e,h?.id,l,d,f]),v=(0,t.useMemo)(()=>["sales",h?.id,e],[h?.id,e]),S=(0,t.useMemo)(()=>[...v,l,d],[v,l,d]),{data:x=[],isLoading:_,isFetching:N,refetch:P}=(0,i.useQuery)({queryKey:S,queryFn:w,enabled:!!e&&!!h?.id,staleTime:3e4,gcTime:18e5,refetchOnWindowFocus:!0,refetchOnReconnect:!0}),C=_||N&&0===x.length,A=(0,t.useMemo)(()=>{let e=x.filter(e=>"Quote"!==e.paymentStatus),t=new Map;return e.forEach(e=>{let r=e.customerName,o=e.items.reduce((e,t)=>e+t.price*t.quantity,0);if(t.has(r)){let i=t.get(r);t.set(r,{total:i.total+o,count:i.count+1,customerId:i.customerId||e.customerId})}else t.set(r,{total:o,count:1,customerId:e.customerId})}),Array.from(t.entries()).map(([e,t])=>({id:t.customerId,name:e,totalPurchases:t.total,orderCount:t.count})).sort((e,t)=>t.totalPurchases-e.totalPurchases)},[x]),I=(0,t.useMemo)(()=>e=>{let t=x.filter(t=>t.customerName.toLowerCase()===e.toLowerCase()&&"Quote"!==t.paymentStatus);return{total:t.reduce((e,t)=>e+t.items.reduce((e,t)=>e+t.price*t.quantity,0),0),count:t.length}},[x]),E=async e=>{try{let t=x.find(t=>t.id===e);if(!t)throw Error("Sale not found");if("Quote"!==t.paymentStatus&&t.items.length>0&&(console.log("Restoring product quantities via useInventoryActions..."),await b(t.items,e,t.receiptNumber,h?.id)||f({title:"Inventory Update Warning",description:"Sale deleted, but inventory restoration might have failed. Please check your stock levels.",variant:"destructive"})),!h?.id)throw Error("Business context missing for deletion");let r=await g(e,h.id);if(!r.success)throw Error(r.error);return c.setQueryData(S,t=>t?t.filter(t=>t.id!==e):[]),c.invalidateQueries({queryKey:v}),T(),await y({activityType:"DELETE",module:"SALES",entityType:"sale",entityId:e,entityName:`Sale #${t.receiptNumber}`,description:`Deleted sale for ${t.customerName} - Total: UGX ${((t.amountPaid||0)+(t.amountDue||0)).toLocaleString()} (Stock restored)`,metadata:{receiptNumber:t.receiptNumber,customerName:t.customerName,customerAddress:t.customerAddress,customerContact:t.customerContact,totalAmount:(t.amountPaid||0)+(t.amountDue||0),amountPaid:t.amountPaid,profit:t.profit,paymentStatus:t.paymentStatus,taxRate:t.taxRate,itemCount:t.items.length,items:t.items.map(e=>({description:e.description,quantity:e.quantity,price:e.price,cost:e.cost,total:e.quantity*e.price,discountPercentage:e.discountPercentage,discountAmount:e.discountAmount})),notes:t.notes,cashTransactionDeleted:!!t.cashTransactionId}}),f({title:"Sale Deleted",description:"The sale record and associated data have been successfully deleted."}),(0,m.clearInventoryCaches)(),!0}catch(e){return console.error("Error deleting sale:",e),f({title:"Error",description:"Failed to delete sale. Please try again.",variant:"destructive"}),!1}},T=(0,t.useCallback)(()=>{if(!h?.id)return;let e=`soldItemsFilters_${h.id}`;localStorage.removeItem(e),localStorage.removeItem("soldItemsFilters")},[h?.id]);return{sales:x,isLoading:C,deleteSale:E,addSale:(0,t.useCallback)(e=>{c.setQueryData(S,t=>t?[e,...t]:[e]),c.invalidateQueries({queryKey:v}),T(),(0,m.clearInventoryCaches)()},[c,S,v,T,m.clearInventoryCaches]),updateSale:(0,t.useCallback)(e=>{c.setQueryData(S,t=>t?t.map(t=>t.id===e.id?e:t):[e]),c.invalidateQueries({queryKey:v}),T(),(0,m.clearInventoryCaches)()},[c,S,v,T,m.clearInventoryCaches]),getTopCustomers:A,getCustomerLifetimePurchases:I,clearSoldItemsCache:T,refetch:P,isFetching:N}}],146786)},747697,e=>{"use strict";var t=e.i(361277);e.s(["CalendarIcon",()=>t.default])},458425,e=>{"use strict";function t(e){let t=["","thousand","million","billion","trillion","quadrillion"],r=["","ten","twenty","thirty","forty","fifty","sixty","seventy","eighty","ninety"],o=["","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],i=e=>{let t=e.toFixed(2).split("."),r=n(parseInt(t[0]));return t.length>1&&parseInt(t[1])>0?`${r} and ${t[1]}/100`:r},n=e=>{if(0===e)return"zero";if(e<0)return`negative ${n(Math.abs(e))}`;let r="",o=0;for(;e>0;)e%1e3!=0&&(r=`${a(e%1e3)} ${t[o]} ${r}`),e=Math.floor(e/1e3),o++;return r.trim()},a=e=>{if(0===e)return"";let t="";return e>=100&&(t=`${o[Math.floor(e/100)]} hundred `,0==(e%=100))?t.trim():(e<20?t+=o[e]:(t+=`${r[Math.floor(e/10)]}`,e%10>0&&(t+=`-${o[e%10]}`)),t.trim())};return i(e).trim().charAt(0).toUpperCase()+i(e).trim().slice(1)}e.s(["numberToWords",()=>t])},482568,e=>{"use strict";var t,r,o,i;let n,a,s,l,d,c;(r=t||(t={})).Unimplemented="UNIMPLEMENTED",r.Unavailable="UNAVAILABLE";class u extends Error{constructor(e,t,r){super(e),this.message=e,this.code=t,this.data=r}}let m=(n=(i=o="u">typeof globalThis?globalThis:"u">typeof self?self:"u">typeof window?window:e.g).CapacitorCustomPlatform||null,s=(a=i.Capacitor||{}).Plugins=a.Plugins||{},l=()=>{var e,t;return null!==n?n.name:(null==i?void 0:i.androidBridge)?"android":(null==(t=null==(e=null==i?void 0:i.webkit)?void 0:e.messageHandlers)?void 0:t.bridge)?"ios":"web"},d=e=>{var t;return null==(t=a.PluginHeaders)?void 0:t.find(t=>t.name===e)},c=new Map,a.convertFileSrc||(a.convertFileSrc=e=>e),a.getPlatform=l,a.handleError=e=>i.console.error(e),a.isNativePlatform=()=>"web"!==l(),a.isPluginAvailable=e=>{let t=c.get(e);return!!((null==t?void 0:t.platforms.has(l()))||d(e))},a.registerPlugin=(e,r={})=>{let o,i=c.get(e);if(i)return console.warn(`Capacitor plugin "${e}" already registered. Cannot register plugins twice.`),i.proxy;let m=l(),f=d(e),p=async()=>(!o&&m in r?o=o="function"==typeof r[m]?await r[m]():r[m]:null!==n&&!o&&"web"in r&&(o=o="function"==typeof r.web?await r.web():r.web),o),g=r=>{let o,i=(...i)=>{let n=p().then(n=>{let s=((r,o)=>{var i,n;if(f){let t=null==f?void 0:f.methods.find(e=>o===e.name);if(t)if("promise"===t.rtype)return t=>a.nativePromise(e,o.toString(),t);else return(t,r)=>a.nativeCallback(e,o.toString(),t,r);if(r)return null==(i=r[o])?void 0:i.bind(r)}else if(r)return null==(n=r[o])?void 0:n.bind(r);else throw new u(`"${e}" plugin is not implemented on ${m}`,t.Unimplemented)})(n,r);if(s){let e=s(...i);return o=null==e?void 0:e.remove,e}throw new u(`"${e}.${r}()" is not implemented on ${m}`,t.Unimplemented)});return"addListener"===r&&(n.remove=async()=>o()),n};return i.toString=()=>`${r.toString()}() { [capacitor code] }`,Object.defineProperty(i,"name",{value:r,writable:!1,configurable:!1}),i},y=g("addListener"),h=g("removeListener"),b=(e,t)=>{let r=y({eventName:e},t),o=async()=>{h({eventName:e,callbackId:await r},t)},i=new Promise(e=>r.then(()=>e({remove:o})));return i.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await o()},i},w=new Proxy({},{get(e,t){switch(t){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return f?b:y;case"removeListener":return h;default:return g(t)}}});return s[e]=w,c.set(e,{name:e,proxy:w,platforms:new Set([...Object.keys(r),...f?[m]:[]])}),w},a.Exception=u,a.DEBUG=!!a.DEBUG,a.isLoggingEnabled=!!a.isLoggingEnabled,o.Capacitor=a),f=m.registerPlugin;class p{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,t){let r=!1;this.listeners[e]||(this.listeners[e]=[],r=!0),this.listeners[e].push(t);let o=this.windowListeners[e];return o&&!o.registered&&this.addWindowListener(o),r&&this.sendRetainedArgumentsForEvent(e),Promise.resolve({remove:async()=>this.removeListener(e,t)})}async removeAllListeners(){for(let e in this.listeners={},this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t,r){let o=this.listeners[e];if(!o){if(r){let r=this.retainedEventArguments[e];r||(r=[]),r.push(t),this.retainedEventArguments[e]=r}return}o.forEach(e=>e(t))}hasListeners(e){var t;return!!(null==(t=this.listeners[e])?void 0:t.length)}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:e=>{this.notifyListeners(t,e)}}}unimplemented(e="not implemented"){return new m.Exception(e,t.Unimplemented)}unavailable(e="not available"){return new m.Exception(e,t.Unavailable)}async removeListener(e,t){let r=this.listeners[e];if(!r)return;let o=r.indexOf(t);this.listeners[e].splice(o,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){let t=this.retainedEventArguments[e];t&&(delete this.retainedEventArguments[e],t.forEach(t=>{this.notifyListeners(e,t)}))}}let g=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);class y extends p{async getCookies(){let e=document.cookie,t={};return e.split(";").forEach(e=>{if(e.length<=0)return;let[r,o]=e.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");r=r.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent).trim(),o=o.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent).trim(),t[r]=o}),t}async setCookie(e){try{let t=g(e.key),r=g(e.value),o=e.expires?`; expires=${e.expires.replace("expires=","")}`:"",i=(e.path||"/").replace("path=",""),n=null!=e.url&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${r||""}${o}; path=${i}; ${n};`}catch(e){return Promise.reject(e)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(e){return Promise.reject(e)}}async clearCookies(){try{for(let e of document.cookie.split(";")||[])document.cookie=e.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}f("CapacitorCookies",{web:()=>new y});let h=async e=>new Promise((t,r)=>{let o=new FileReader;o.onload=()=>{let e=o.result;t(e.indexOf(",")>=0?e.split(",")[1]:e)},o.onerror=e=>r(e),o.readAsDataURL(e)});class b extends p{async request(e){let t,r,o=((e,t={})=>{let r=Object.assign({method:e.method||"GET",headers:e.headers},t),o=((e={})=>{let t=Object.keys(e);return Object.keys(e).map(e=>e.toLocaleLowerCase()).reduce((r,o,i)=>(r[o]=e[t[i]],r),{})})(e.headers)["content-type"]||"";if("string"==typeof e.data)r.body=e.data;else if(o.includes("application/x-www-form-urlencoded")){let t=new URLSearchParams;for(let[r,o]of Object.entries(e.data||{}))t.set(r,o);r.body=t.toString()}else if(o.includes("multipart/form-data")||e.data instanceof FormData){let t=new FormData;if(e.data instanceof FormData)e.data.forEach((e,r)=>{t.append(r,e)});else for(let r of Object.keys(e.data))t.append(r,e.data[r]);r.body=t;let o=new Headers(r.headers);o.delete("content-type"),r.headers=o}else(o.includes("application/json")||"object"==typeof e.data)&&(r.body=JSON.stringify(e.data));return r})(e,e.webFetchExtra),i=((e,t=!0)=>e?Object.entries(e).reduce((e,r)=>{let o,i,[n,a]=r;return Array.isArray(a)?(i="",a.forEach(e=>{o=t?encodeURIComponent(e):e,i+=`${n}=${o}&`}),i.slice(0,-1)):(o=t?encodeURIComponent(a):a,i=`${n}=${o}`),`${e}&${i}`},"").substr(1):null)(e.params,e.shouldEncodeUrlParams),n=i?`${e.url}?${i}`:e.url,a=await fetch(n,o),s=a.headers.get("content-type")||"",{responseType:l="text"}=a.ok?e:{};switch(s.includes("application/json")&&(l="json"),l){case"arraybuffer":case"blob":r=await a.blob(),t=await h(r);break;case"json":t=await a.json();break;default:t=await a.text()}let d={};return a.headers.forEach((e,t)=>{d[t]=e}),{data:t,headers:d,status:a.status,url:a.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}f("CapacitorHttp",{web:()=>new b}),e.s(["Capacitor",()=>m,"WebPlugin",()=>p,"registerPlugin",()=>f])}]);