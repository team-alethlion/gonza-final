(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,908962,224410,e=>{"use strict";var t=e.i(271645),r=e.i(160615),a=e.i(422713),n=e.i(266027),i=e.i(912598);let o=e=>{let t=Object.keys(localStorage),r=["allProductsStats_","stockSummary_","soldItems_","dashboardData_","analyticsData_"],a=0;t.forEach(e=>{r.some(t=>e.startsWith(t))&&(localStorage.removeItem(e),a++)}),a>0&&console.log(`[Cache] Cleared ${a} inventory-related localStorage entries.`),e&&(console.log("[Cache] Invalidating React Query inventory keys..."),e.invalidateQueries({queryKey:["inventory_global_stats"]}),e.invalidateQueries({queryKey:["stockSummary"]}),e.invalidateQueries({queryKey:["products"]}),e.invalidateQueries({queryKey:["sales"]}),e.invalidateQueries({queryKey:["all-products-for-scanner"]}),e.invalidateQueries({queryKey:["all-products"]}))};e.s(["clearInventoryCaches",0,o],224410);var s=e.i(555781);e.s(["useProducts",0,(e,l=50)=>{let[u,c]=(0,t.useState)([]),[d,m]=(0,t.useState)(1),[f,p]=(0,t.useState)(l),[y,g]=(0,t.useState)(0),[h,b]=(0,t.useState)(!1),{settings:w}=(0,r.useBusinessSettings)(),{currentBusiness:S}=(0,a.useBusiness)(),v=(0,i.useQueryClient)(),[P,_]=(0,t.useState)({search:"",category:"all",stockStatus:"all"}),[x,N]=(0,t.useState)(null),E=(0,t.useCallback)(e=>{e.search!==P.search&&(b(!0),x&&clearTimeout(x),N(setTimeout(()=>{b(!1)},600))),_(e)},[P.search,x]),A=(0,t.useCallback)(async()=>{if(!e||!S)return{products:[],count:0};try{return await (0,s.getProductsAction)({userId:e,businessId:S.id,page:d,pageSize:f,search:P.search,category:"all"===P.category?void 0:P.category,stockStatus:P.stockStatus})}catch(e){return console.error("Error loading products from server action:",e),{products:[],count:0}}},[e,S?.id,d,f,P.search,P.category,P.stockStatus]),C=(0,t.useMemo)(()=>["products",e,S?.id],[e,S?.id]),I=(0,t.useMemo)(()=>[...C,d,f,P.search,P.category,P.stockStatus],[C,d,f,P.search,P.category,P.stockStatus]),{data:T,isLoading:k,isFetching:F,refetch:D}=(0,n.useQuery)({queryKey:I,queryFn:A,enabled:!!e&&!!S?.id,staleTime:3e4,gcTime:18e5,refetchOnWindowFocus:!0,refetchOnReconnect:!0});(0,t.useEffect)(()=>{T&&(c(T.products),g(T.count))},[T]);let L=async t=>{try{if(!e)return null;return console.warn("Image upload redirecting to server action (TODO)"),null}catch(e){return console.error("Error in uploadProductImage:",e),null}};return{products:u,isLoading:k&&!T&&!h,loadProducts:A,page:d,setPage:m,pageSize:f,setPageSize:p,totalCount:y,createProduct:async t=>{try{if(!e||!S)return null;let r=await (0,s.createProductAction)({...t,userId:e,businessId:S.id});if(!r)return null;return c(e=>[r,...e]),g(e=>e+1),v.invalidateQueries({queryKey:C}),o(v),r}catch(e){return console.error("Error creating product:",e),null}},updateProduct:async(t,r,a,n=!1,i,l,u,c)=>{try{if(!e||!S)return!1;let l=r.imageUrl;if(a&&(l=await L(a)),!await (0,s.updateProductAction)(t,{...r,imageUrl:l,userId:e,businessId:S.id,isFromSale:n,customChangeReason:i,referenceId:u}))return!1;return v.invalidateQueries({queryKey:C}),o(v),!0}catch(e){return console.error("Error updating product:",e),!1}},updateProductsBulk:async(t,r,a,n,i,l)=>{try{if(!e||!S)return!1;let r=await (0,s.updateProductsBulkAction)(t.map(e=>({id:e.id,updated:e.updated})),S.id);return r&&(v.invalidateQueries({queryKey:C}),o(v)),r}catch(e){return console.error("Error in bulk update:",e),!1}},deleteProduct:async t=>{try{if(!e)return!1;if(await (0,s.deleteProductAction)(t))return v.invalidateQueries({queryKey:C}),o(v),!0;return!1}catch(e){return console.error("Error deleting product:",e),!1}},uploadProductImage:L,refetch:D,isFetching:F,filters:P,setFilters:E}}],908962)},555781,(e,t,r)=>{let a=Error("Could not parse module '[project]/src/app/actions/products.ts'\n\n'import', and 'export' cannot be used outside of module code");throw a.code="MODULE_UNPARSABLE",a},160615,e=>{"use strict";var t=e.i(271645),r=e.i(266027),a=e.i(908406),n=e.i(422713),i=e.i(95187);let o=(0,i.createServerReference)("40290a4fc6b8571a026afeb877566edb807919e482",i.callServer,void 0,i.findSourceMapURL,"getBusinessSettingsAction");var s=e.i(709239);let l=()=>({businessName:"",businessAddress:"",businessPhone:"",businessEmail:"",currency:"UGX",paymentInfo:"",defaultPrintFormat:"standard"});e.s(["convertPaymentMethodsToString",0,e=>e.filter(e=>""!==e.method.trim()||""!==e.accountNumber.trim()||""!==e.accountName.trim()).map(e=>`${e.method}
${e.accountNumber}
${e.accountName}`).join("\n"),"parsePaymentInfo",0,e=>{if(!e||""===e.trim())return[];let t=e.split("\n").filter(e=>""!==e.trim()),r=[];for(let e=0;e<t.length;e+=3)e+2<t.length&&r.push({method:t[e].trim(),accountNumber:t[e+1].trim(),accountName:t[e+2].trim()});return r},"useBusinessSettings",0,()=>{let[e,i]=(0,t.useState)(l()),[u,c]=(0,t.useState)(!1),{toast:d}=(0,a.useToast)(),{currentBusiness:m}=(0,n.useBusiness)(),f=async()=>{if(!m)return l();try{let e=await o(m.id);if(!e)return l();{let t=e.metadata&&"object"==typeof e.metadata&&e.metadata.payment_info||"";return{id:e.id,businessName:e.business_name||"",businessAddress:e.business_address||"",businessPhone:e.business_phone||"",businessEmail:e.business_email||"",businessLogo:e.business_logo||void 0,currency:e.currency||"UGX",signature:e.signature||void 0,paymentInfo:t,defaultPrintFormat:e.metadata&&"object"==typeof e.metadata&&e.metadata.default_print_format||"standard",defaultPrinterName:e.metadata&&"object"==typeof e.metadata&&e.metadata.default_printer_name||"",defaultPrinterType:e.metadata&&"object"==typeof e.metadata&&e.metadata.default_printer_type||"USB",printerPaperSize:e.metadata&&"object"==typeof e.metadata&&e.metadata.printer_paper_size||"58mm"}}}catch(e){return console.error("Error loading business settings:",e),d({title:"Error",description:"Failed to load business settings. Please try again.",variant:"destructive"}),l()}},p=async t=>{if(!m)return console.error("No business selected for updating settings"),d({title:"Error",description:"No business selected",variant:"destructive"}),!1;try{let r={payment_info:t.hasOwnProperty("paymentInfo")?t.paymentInfo:e.paymentInfo||"",default_print_format:t.hasOwnProperty("defaultPrintFormat")?t.defaultPrintFormat:e.defaultPrintFormat||"standard",default_printer_name:t.hasOwnProperty("defaultPrinterName")?t.defaultPrinterName:e.defaultPrinterName||"",default_printer_type:t.hasOwnProperty("defaultPrinterType")?t.defaultPrinterType:e.defaultPrinterType||"USB",printer_paper_size:t.hasOwnProperty("printerPaperSize")?t.printerPaperSize:e.printerPaperSize||"58mm"},a={business_name:t.hasOwnProperty("businessName")?t.businessName:e.businessName,business_address:t.hasOwnProperty("businessAddress")?t.businessAddress:e.businessAddress,business_phone:t.hasOwnProperty("businessPhone")?t.businessPhone:e.businessPhone,business_email:t.hasOwnProperty("businessEmail")?t.businessEmail:e.businessEmail,business_logo:t.hasOwnProperty("businessLogo")?t.businessLogo:e.businessLogo,currency:t.hasOwnProperty("currency")?t.currency:e.currency,signature:t.hasOwnProperty("signature")?t.signature:e.signature,metadata:r},n=await (0,s.upsertBusinessSettingsAction)(m.id,"00000000-0000-0000-0000-000000000000",a);if(!n.success)throw console.error("Supabase error updating business settings:",n.error),Error(n.error);return d({title:"Success",description:"Business settings updated successfully"}),b(),!0}catch(e){return console.error("Error updating business settings:",e),d({title:"Error",description:"Failed to update business settings. Please try again.",variant:"destructive"}),!1}},{data:y,isLoading:g,isFetching:h,refetch:b}=(0,r.useQuery)({queryKey:["businessSettings",m?.id],queryFn:f,enabled:!!m?.id,staleTime:3e5,gcTime:18e5,refetchOnWindowFocus:!1,refetchOnReconnect:!1});return(0,t.useEffect)(()=>{y?i(y):m||i(l())},[y,m]),(0,t.useEffect)(()=>{c(g||h)},[g,h]),{settings:e,isLoading:u,updateSettings:p,loadSettings:f}}],160615)},63209,e=>{"use strict";let t=(0,e.i(475254).default)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);e.s(["AlertCircle",()=>t],63209)},303281,e=>{"use strict";let t=(0,e.i(475254).default)("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]);e.s(["Printer",()=>t],303281)},458425,e=>{"use strict";function t(e){let t=["","thousand","million","billion","trillion","quadrillion"],r=["","ten","twenty","thirty","forty","fifty","sixty","seventy","eighty","ninety"],a=["","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],n=e=>{let t=e.toFixed(2).split("."),r=i(parseInt(t[0]));return t.length>1&&parseInt(t[1])>0?`${r} and ${t[1]}/100`:r},i=e=>{if(0===e)return"zero";if(e<0)return`negative ${i(Math.abs(e))}`;let r="",a=0;for(;e>0;)e%1e3!=0&&(r=`${o(e%1e3)} ${t[a]} ${r}`),e=Math.floor(e/1e3),a++;return r.trim()},o=e=>{if(0===e)return"";let t="";return e>=100&&(t=`${a[Math.floor(e/100)]} hundred `,0==(e%=100))?t.trim():(e<20?t+=a[e]:(t+=`${r[Math.floor(e/10)]}`,e%10>0&&(t+=`-${a[e%10]}`)),t.trim())};return n(e).trim().charAt(0).toUpperCase()+n(e).trim().slice(1)}e.s(["numberToWords",()=>t])},482568,e=>{"use strict";var t,r,a,n;let i,o,s,l,u,c;(r=t||(t={})).Unimplemented="UNIMPLEMENTED",r.Unavailable="UNAVAILABLE";class d extends Error{constructor(e,t,r){super(e),this.message=e,this.code=t,this.data=r}}let m=(i=(n=a="u">typeof globalThis?globalThis:"u">typeof self?self:"u">typeof window?window:e.g).CapacitorCustomPlatform||null,s=(o=n.Capacitor||{}).Plugins=o.Plugins||{},l=()=>{var e,t;return null!==i?i.name:(null==n?void 0:n.androidBridge)?"android":(null==(t=null==(e=null==n?void 0:n.webkit)?void 0:e.messageHandlers)?void 0:t.bridge)?"ios":"web"},u=e=>{var t;return null==(t=o.PluginHeaders)?void 0:t.find(t=>t.name===e)},c=new Map,o.convertFileSrc||(o.convertFileSrc=e=>e),o.getPlatform=l,o.handleError=e=>n.console.error(e),o.isNativePlatform=()=>"web"!==l(),o.isPluginAvailable=e=>{let t=c.get(e);return!!((null==t?void 0:t.platforms.has(l()))||u(e))},o.registerPlugin=(e,r={})=>{let a,n=c.get(e);if(n)return console.warn(`Capacitor plugin "${e}" already registered. Cannot register plugins twice.`),n.proxy;let m=l(),f=u(e),p=async()=>(!a&&m in r?a=a="function"==typeof r[m]?await r[m]():r[m]:null!==i&&!a&&"web"in r&&(a=a="function"==typeof r.web?await r.web():r.web),a),y=r=>{let a,n=(...n)=>{let i=p().then(i=>{let s=((r,a)=>{var n,i;if(f){let t=null==f?void 0:f.methods.find(e=>a===e.name);if(t)if("promise"===t.rtype)return t=>o.nativePromise(e,a.toString(),t);else return(t,r)=>o.nativeCallback(e,a.toString(),t,r);if(r)return null==(n=r[a])?void 0:n.bind(r)}else if(r)return null==(i=r[a])?void 0:i.bind(r);else throw new d(`"${e}" plugin is not implemented on ${m}`,t.Unimplemented)})(i,r);if(s){let e=s(...n);return a=null==e?void 0:e.remove,e}throw new d(`"${e}.${r}()" is not implemented on ${m}`,t.Unimplemented)});return"addListener"===r&&(i.remove=async()=>a()),i};return n.toString=()=>`${r.toString()}() { [capacitor code] }`,Object.defineProperty(n,"name",{value:r,writable:!1,configurable:!1}),n},g=y("addListener"),h=y("removeListener"),b=(e,t)=>{let r=g({eventName:e},t),a=async()=>{h({eventName:e,callbackId:await r},t)},n=new Promise(e=>r.then(()=>e({remove:a})));return n.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await a()},n},w=new Proxy({},{get(e,t){switch(t){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return f?b:g;case"removeListener":return h;default:return y(t)}}});return s[e]=w,c.set(e,{name:e,proxy:w,platforms:new Set([...Object.keys(r),...f?[m]:[]])}),w},o.Exception=d,o.DEBUG=!!o.DEBUG,o.isLoggingEnabled=!!o.isLoggingEnabled,a.Capacitor=o),f=m.registerPlugin;class p{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,t){let r=!1;this.listeners[e]||(this.listeners[e]=[],r=!0),this.listeners[e].push(t);let a=this.windowListeners[e];return a&&!a.registered&&this.addWindowListener(a),r&&this.sendRetainedArgumentsForEvent(e),Promise.resolve({remove:async()=>this.removeListener(e,t)})}async removeAllListeners(){for(let e in this.listeners={},this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t,r){let a=this.listeners[e];if(!a){if(r){let r=this.retainedEventArguments[e];r||(r=[]),r.push(t),this.retainedEventArguments[e]=r}return}a.forEach(e=>e(t))}hasListeners(e){var t;return!!(null==(t=this.listeners[e])?void 0:t.length)}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:e=>{this.notifyListeners(t,e)}}}unimplemented(e="not implemented"){return new m.Exception(e,t.Unimplemented)}unavailable(e="not available"){return new m.Exception(e,t.Unavailable)}async removeListener(e,t){let r=this.listeners[e];if(!r)return;let a=r.indexOf(t);this.listeners[e].splice(a,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){let t=this.retainedEventArguments[e];t&&(delete this.retainedEventArguments[e],t.forEach(t=>{this.notifyListeners(e,t)}))}}let y=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);class g extends p{async getCookies(){let e=document.cookie,t={};return e.split(";").forEach(e=>{if(e.length<=0)return;let[r,a]=e.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");r=r.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent).trim(),a=a.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent).trim(),t[r]=a}),t}async setCookie(e){try{let t=y(e.key),r=y(e.value),a=e.expires?`; expires=${e.expires.replace("expires=","")}`:"",n=(e.path||"/").replace("path=",""),i=null!=e.url&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${r||""}${a}; path=${n}; ${i};`}catch(e){return Promise.reject(e)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(e){return Promise.reject(e)}}async clearCookies(){try{for(let e of document.cookie.split(";")||[])document.cookie=e.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}f("CapacitorCookies",{web:()=>new g});let h=async e=>new Promise((t,r)=>{let a=new FileReader;a.onload=()=>{let e=a.result;t(e.indexOf(",")>=0?e.split(",")[1]:e)},a.onerror=e=>r(e),a.readAsDataURL(e)});class b extends p{async request(e){let t,r,a=((e,t={})=>{let r=Object.assign({method:e.method||"GET",headers:e.headers},t),a=((e={})=>{let t=Object.keys(e);return Object.keys(e).map(e=>e.toLocaleLowerCase()).reduce((r,a,n)=>(r[a]=e[t[n]],r),{})})(e.headers)["content-type"]||"";if("string"==typeof e.data)r.body=e.data;else if(a.includes("application/x-www-form-urlencoded")){let t=new URLSearchParams;for(let[r,a]of Object.entries(e.data||{}))t.set(r,a);r.body=t.toString()}else if(a.includes("multipart/form-data")||e.data instanceof FormData){let t=new FormData;if(e.data instanceof FormData)e.data.forEach((e,r)=>{t.append(r,e)});else for(let r of Object.keys(e.data))t.append(r,e.data[r]);r.body=t;let a=new Headers(r.headers);a.delete("content-type"),r.headers=a}else(a.includes("application/json")||"object"==typeof e.data)&&(r.body=JSON.stringify(e.data));return r})(e,e.webFetchExtra),n=((e,t=!0)=>e?Object.entries(e).reduce((e,r)=>{let a,n,[i,o]=r;return Array.isArray(o)?(n="",o.forEach(e=>{a=t?encodeURIComponent(e):e,n+=`${i}=${a}&`}),n.slice(0,-1)):(a=t?encodeURIComponent(o):o,n=`${i}=${a}`),`${e}&${n}`},"").substr(1):null)(e.params,e.shouldEncodeUrlParams),i=n?`${e.url}?${n}`:e.url,o=await fetch(i,a),s=o.headers.get("content-type")||"",{responseType:l="text"}=o.ok?e:{};switch(s.includes("application/json")&&(l="json"),l){case"arraybuffer":case"blob":r=await o.blob(),t=await h(r);break;case"json":t=await o.json();break;default:t=await o.text()}let u={};return o.headers.forEach((e,t)=>{u[t]=e}),{data:t,headers:u,status:o.status,url:o.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}f("CapacitorHttp",{web:()=>new b}),e.s(["Capacitor",()=>m,"WebPlugin",()=>p,"registerPlugin",()=>f])},986387,e=>{"use strict";var t=e.i(102594);e.s(["useCurrentUser",0,()=>{let{user:e}=(0,t.useAuth)();return{userId:e?.id}}])},589271,e=>{"use strict";e.s(["mapDbProductToProduct",0,e=>({id:e.id,itemNumber:e.item_number,barcode:e.barcode,manufacturerBarcode:e.manufacturer_barcode,name:e.name,description:e.description,category:e.category,quantity:e.quantity,costPrice:Number(e.cost_price),sellingPrice:Number(e.selling_price),supplier:e.supplier,imageUrl:e.image_url,minimumStock:e.minimum_stock,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}),"mapDbSaleToSale",0,e=>{let t=(Array.isArray(e.items)?e.items:[]).map(e=>{let t=void 0!==e.discountPercentage?Number(e.discountPercentage):void 0,r=void 0!==e.discountAmount?Number(e.discountAmount):void 0,a=e.discountType;return!a&&(t&&t>0?a="percentage":r&&r>0&&(a="amount")),{description:e.description||"",quantity:Number(e.quantity)||0,price:Number(e.price)||0,cost:Number(e.cost)||0,productId:e.productId||void 0,discountType:a,discountPercentage:t,discountAmount:r,createdAt:e.createdAt||void 0}});return{id:e.id,receiptNumber:e.receipt_number,customerName:e.customer_name,customerAddress:e.customer_address||"",customerContact:e.customer_contact||"",customerId:e.customer_id||void 0,items:t,paymentStatus:e.payment_status,profit:Number(e.profit),date:new Date(e.date),taxRate:e.tax_rate?Number(e.tax_rate):0,cashTransactionId:e.cash_transaction_id||void 0,amountPaid:e.amount_paid?Number(e.amount_paid):void 0,amountDue:e.amount_due?Number(e.amount_due):void 0,notes:e.notes||"",categoryId:e.category_id||void 0,createdAt:new Date(e.created_at)}},"mapSaleToDbSale",0,(e,t,r,a,n,i,o)=>({user_id:n,location_id:i,receipt_number:a,customer_name:e.customerName,customer_address:e.customerAddress||null,customer_contact:e.customerContact||null,customer_id:e.customerId||null,items:e.items,payment_status:e.paymentStatus,profit:r,date:t.toISOString().split("T")[0],tax_rate:e.taxRate||0,cash_transaction_id:o||null,amount_paid:e.amountPaid||null,amount_due:e.amountDue||null,notes:e.notes||null,category_id:e.categoryId||null})])},457786,e=>{"use strict";var t=e.i(95187);let r=(0,t.createServerReference)("401d907b5cd7e0b2f207e9b555ac4fe2e14de08444",t.callServer,void 0,t.findSourceMapURL,"logActivityAction");var a=e.i(986387),n=e.i(422713),i=e.i(777624);e.s(["useActivityLogger",0,()=>{let{userId:e}=(0,a.useCurrentUser)(),{currentBusiness:t}=(0,n.useBusiness)(),o=null;try{let{currentProfile:e}=(0,i.useProfiles)();o=e}catch{o=null}return{logActivity:async a=>{if(!e||!t?.id)return void console.warn("Cannot log activity: missing user or business context");try{let n=await r({userId:e,locationId:t.id,activityType:a.activityType,module:a.module,entityType:a.entityType,entityId:a.entityId||void 0,entityName:a.entityName,description:a.description,metadata:a.metadata||void 0,profileId:o?.id||void 0,profileName:o?.profile_name||void 0});n.success||console.error("Error logging activity:",n.error)}catch(e){console.error("Failed to log activity:",e)}}}}],457786)},146786,850823,617318,e=>{"use strict";var t=e.i(271645),r=e.i(589271),a=e.i(908406),n=e.i(266027),i=e.i(912598),o=e.i(457786),s=e.i(422713),l=e.i(908962),u=e.i(846696),c=e.i(555781);let d=e=>{let{updateProductsBulk:t}=(0,l.useProducts)(e),r=async(e,t)=>{if(!e.length)return[];try{return await (0,c.getProductsByIdsAction)(e,t)}catch(e){throw console.error("Error fetching fresh products:",e),e}};return{deductStockForSale:async(a,n,i,o,s)=>{if(!e)return!1;try{let l=a.filter(e=>e.productId);if(0===l.length)return!0;let c=[...new Set(l.map(e=>e.productId))],d=await r(c,s);if(0===d.length)return!1;let m=new Map;for(let e of l){let t=m.get(e.productId)||0;m.set(e.productId,t+e.quantity)}let f=[];for(let[e,t]of m.entries()){let r=d.find(t=>t.id===e);if(!r)continue;let a=r.quantity-t;f.push({id:e,updated:{...r,quantity:a}}),a<0&&u.toast.warning(`${r.name} inventory is now negative (${a}). Please restock soon.`)}return f.length>0&&await t(f,e,"Sale",n,i,o),!0}catch(e){return console.error("Error deducting stock for sale:",e),!1}},restoreStockForSale:async(a,n,i,o)=>{if(!e)return!1;try{let s=a.filter(e=>e.productId);if(0===s.length)return!0;let l=[...new Set(s.map(e=>e.productId))],u=await r(l,o),c=new Map;for(let e of s){let t=c.get(e.productId)||0;c.set(e.productId,t+e.quantity)}let d=[];for(let[e,t]of c.entries()){let r=u.find(t=>t.id===e);if(!r)continue;let a=r.quantity+t;d.push({id:e,updated:{...r,quantity:a}})}return d.length>0&&await t(d,e,"Deleted Sale",n,void 0,i),!0}catch(e){return console.error("Error restoring stock for sale:",e),!1}},adjustStockForEditedSale:async(a,n,i,o,s,l)=>{if(!e)return!1;try{let c=[...a.filter(e=>e.productId).map(e=>e.productId),...n.filter(e=>e.productId).map(e=>e.productId)],d=[...new Set(c)];if(0===d.length)return!0;let m=await r(d,l),f=new Map;for(let e of a.filter(e=>e.productId)){let t=f.get(e.productId)||0;f.set(e.productId,t+e.quantity)}for(let e of n.filter(e=>e.productId)){let t=f.get(e.productId)||0;f.set(e.productId,t-e.quantity)}let p=[];for(let[e,t]of f.entries()){if(0===t)continue;let r=m.find(t=>t.id===e);if(!r)continue;let a=r.quantity+t;p.push({id:e,updated:{...r,quantity:a}}),a<0&&u.toast.warning(`${r.name} inventory is now negative (${a}). Please restock soon.`)}return p.length>0&&await t(p,e,"Sale Status/Qty Edit",i,o,s),!0}catch(e){return console.error("Error adjusting stock for edited sale:",e),!1}}}};e.s(["useInventoryActions",0,d],850823);var m=e.i(224410),f=e.i(95187);let p=(0,f.createServerReference)("703e9376bfaf2adbf9aba886e70ba6b561f6bf5e0c",f.callServer,void 0,f.findSourceMapURL,"getSalesAction"),y=(0,f.createServerReference)("40d9064371ce5c0811194879498fdc849fbf872b8a",f.callServer,void 0,f.findSourceMapURL,"deleteSaleAction");e.s(["deleteSaleAction",()=>y],617318),e.s(["useSalesData",0,(e,l="desc",u)=>{let c=(0,i.useQueryClient)(),{toast:f}=(0,a.useToast)(),{logActivity:g}=(0,o.useActivityLogger)(),{currentBusiness:h}=(0,s.useBusiness)(),{restoreStockForSale:b}=d(e),w=(0,t.useCallback)(async()=>{try{if(!e||!h)return[];let t=await p(h.id,l,u);return t?t.map(e=>{let t={id:e.id,user_id:e.user_id,location_id:e.location_id,receipt_number:e.receipt_number,customer_name:e.customer_name,customer_address:e.customer_address,customer_contact:e.customer_contact,customer_id:e.customer_id,items:e.items,payment_status:e.payment_status,profit:e.profit?Number(e.profit):0,date:e.date,tax_rate:e.tax_rate||0,created_at:e.created_at,updated_at:e.updated_at,cash_transaction_id:e.cash_transaction_id,amount_paid:e.amount_paid?Number(e.amount_paid):void 0,amount_due:e.amount_due?Number(e.amount_due):void 0,category_id:e.category_id,notes:e.notes};return(0,r.mapDbSaleToSale)(t)}):[]}catch(e){return console.error("Error loading sales:",e),f({title:"Error",description:"Failed to load sales data. Please try again.",variant:"destructive"}),[]}},[e,h?.id,l,u,f]),S=(0,t.useMemo)(()=>["sales",h?.id,e],[h?.id,e]),v=(0,t.useMemo)(()=>[...S,l,u],[S,l,u]),{data:P=[],isLoading:_,isFetching:x,refetch:N}=(0,n.useQuery)({queryKey:v,queryFn:w,enabled:!!e&&!!h?.id,staleTime:3e4,gcTime:18e5,refetchOnWindowFocus:!0,refetchOnReconnect:!0}),E=_||x&&0===P.length,A=(0,t.useMemo)(()=>{let e=P.filter(e=>"Quote"!==e.paymentStatus),t=new Map;return e.forEach(e=>{let r=e.customerName,a=e.items.reduce((e,t)=>e+t.price*t.quantity,0);if(t.has(r)){let n=t.get(r);t.set(r,{total:n.total+a,count:n.count+1,customerId:n.customerId||e.customerId})}else t.set(r,{total:a,count:1,customerId:e.customerId})}),Array.from(t.entries()).map(([e,t])=>({id:t.customerId,name:e,totalPurchases:t.total,orderCount:t.count})).sort((e,t)=>t.totalPurchases-e.totalPurchases)},[P]),C=(0,t.useMemo)(()=>e=>{let t=P.filter(t=>t.customerName.toLowerCase()===e.toLowerCase()&&"Quote"!==t.paymentStatus);return{total:t.reduce((e,t)=>e+t.items.reduce((e,t)=>e+t.price*t.quantity,0),0),count:t.length}},[P]),I=async e=>{try{let t=P.find(t=>t.id===e);if(!t)throw Error("Sale not found");if("Quote"!==t.paymentStatus&&t.items.length>0&&(console.log("Restoring product quantities via useInventoryActions..."),await b(t.items,e,t.receiptNumber,h?.id)||f({title:"Inventory Update Warning",description:"Sale deleted, but inventory restoration might have failed. Please check your stock levels.",variant:"destructive"})),!h?.id)throw Error("Business context missing for deletion");let r=await y(e,h.id);if(!r.success)throw Error(r.error);return c.setQueryData(v,t=>t?t.filter(t=>t.id!==e):[]),c.invalidateQueries({queryKey:S}),T(),await g({activityType:"DELETE",module:"SALES",entityType:"sale",entityId:e,entityName:`Sale #${t.receiptNumber}`,description:`Deleted sale for ${t.customerName} - Total: UGX ${((t.amountPaid||0)+(t.amountDue||0)).toLocaleString()} (Stock restored)`,metadata:{receiptNumber:t.receiptNumber,customerName:t.customerName,customerAddress:t.customerAddress,customerContact:t.customerContact,totalAmount:(t.amountPaid||0)+(t.amountDue||0),amountPaid:t.amountPaid,profit:t.profit,paymentStatus:t.paymentStatus,taxRate:t.taxRate,itemCount:t.items.length,items:t.items.map(e=>({description:e.description,quantity:e.quantity,price:e.price,cost:e.cost,total:e.quantity*e.price,discountPercentage:e.discountPercentage,discountAmount:e.discountAmount})),notes:t.notes,cashTransactionDeleted:!!t.cashTransactionId}}),f({title:"Sale Deleted",description:"The sale record and associated data have been successfully deleted."}),(0,m.clearInventoryCaches)(),!0}catch(e){return console.error("Error deleting sale:",e),f({title:"Error",description:"Failed to delete sale. Please try again.",variant:"destructive"}),!1}},T=(0,t.useCallback)(()=>{if(!h?.id)return;let e=`soldItemsFilters_${h.id}`;localStorage.removeItem(e),localStorage.removeItem("soldItemsFilters")},[h?.id]);return{sales:P,isLoading:E,deleteSale:I,addSale:(0,t.useCallback)(e=>{c.setQueryData(v,t=>t?[e,...t]:[e]),c.invalidateQueries({queryKey:S}),T(),(0,m.clearInventoryCaches)()},[c,v,S,T,m.clearInventoryCaches]),updateSale:(0,t.useCallback)(e=>{c.setQueryData(v,t=>t?t.map(t=>t.id===e.id?e:t):[e]),c.invalidateQueries({queryKey:S}),T(),(0,m.clearInventoryCaches)()},[c,v,S,T,m.clearInventoryCaches]),getTopCustomers:A,getCustomerLifetimePurchases:C,clearSoldItemsCache:T,refetch:N,isFetching:x}}],146786)},561993,e=>{"use strict";var t=e.i(843476),r=e.i(271645),a=e.i(794527),n=e.i(975157);let i=({shouldScaleBackground:e=!0,...r})=>(0,t.jsx)(a.Drawer.Root,{shouldScaleBackground:e,...r});i.displayName="Drawer",a.Drawer.Trigger;let o=a.Drawer.Portal,s=a.Drawer.Close,l=r.forwardRef(({className:e,...r},i)=>(0,t.jsx)(a.Drawer.Overlay,{ref:i,className:(0,n.cn)("fixed inset-0 z-50 bg-black/80",e),...r}));l.displayName=a.Drawer.Overlay.displayName;let u=r.forwardRef(({className:e,children:r,...i},s)=>(0,t.jsxs)(o,{children:[(0,t.jsx)(l,{}),(0,t.jsxs)(a.Drawer.Content,{ref:s,className:(0,n.cn)("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",e),...i,children:[(0,t.jsx)("div",{className:"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"}),r]})]}));u.displayName="DrawerContent";let c=({className:e,...r})=>(0,t.jsx)("div",{className:(0,n.cn)("grid gap-1.5 p-4 text-center sm:text-left",e),...r});c.displayName="DrawerHeader";let d=({className:e,...r})=>(0,t.jsx)("div",{className:(0,n.cn)("mt-auto flex flex-col gap-2 p-4",e),...r});d.displayName="DrawerFooter";let m=r.forwardRef(({className:e,...r},i)=>(0,t.jsx)(a.Drawer.Title,{ref:i,className:(0,n.cn)("text-lg font-semibold leading-none tracking-tight",e),...r}));m.displayName=a.Drawer.Title.displayName,r.forwardRef(({className:e,...r},i)=>(0,t.jsx)(a.Drawer.Description,{ref:i,className:(0,n.cn)("text-sm text-muted-foreground",e),...r})).displayName=a.Drawer.Description.displayName,e.s(["Drawer",()=>i,"DrawerClose",()=>s,"DrawerContent",()=>u,"DrawerFooter",()=>d,"DrawerHeader",()=>c,"DrawerTitle",()=>m])},531278,e=>{"use strict";let t=(0,e.i(475254).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],531278)},624687,e=>{"use strict";var t=e.i(843476),r=e.i(271645),a=e.i(975157);let n=r.forwardRef(({className:e,...r},n)=>(0,t.jsx)("textarea",{className:(0,a.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:n,...r}));n.displayName="Textarea",e.s(["Textarea",()=>n])},410160,e=>{"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e.s(["default",()=>t])},178583,e=>{"use strict";let t=(0,e.i(475254).default)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);e.s(["FileText",()=>t],178583)},392401,e=>{"use strict";var t=e.i(777624);e.s(["useFinancialVisibility",0,()=>{let{hasPermission:e}=(0,t.useProfiles)(),r=e("inventory","view_cost_price"),a=e("inventory","view_profit"),n=e("inventory","view_selling_price"),i=e("dashboard","view_total_sales"),o=e("dashboard","view_gross_profit"),s=e("dashboard","view_total_expenses"),l=e("dashboard","view_inventory_value"),u=e("dashboard","view_sales_types"),c=e("dashboard","view_avg_price"),d=e("dashboard","view_total_amount"),m=e("finance","manage_accounts"),f=e("finance","view"),p=e("expenses","view"),y=e("expenses","create"),g=e("expenses","edit");return{canViewCostPrice:r,canViewProfit:a,canViewSellingPrice:n,canViewTotalSales:i,canViewTotalGrossProfit:o,canViewTotalExpenses:s,canViewInventoryValue:l,canViewSalesTypes:u,canViewAvgPrice:c,canViewTotalAmount:d,canManageFinanceAccounts:m,canViewFinance:f,canViewExpenses:p,canCreateExpenses:y,canEditExpenses:g,canDeleteExpenses:e("expenses","delete"),formatFinancial:(e,t)=>"cost"===t&&r||"selling"===t&&n||"profit"===t&&a?e?.toLocaleString()||"0":"•••"}}])},784774,e=>{"use strict";var t=e.i(843476),r=e.i(271645),a=e.i(975157);let n=r.forwardRef(({className:e,...r},n)=>(0,t.jsx)("div",{className:"relative w-full overflow-auto",children:(0,t.jsx)("table",{ref:n,className:(0,a.cn)("w-full caption-bottom text-sm",e),...r})}));n.displayName="Table";let i=r.forwardRef(({className:e,...r},n)=>(0,t.jsx)("thead",{ref:n,className:(0,a.cn)("[&_tr]:border-b",e),...r}));i.displayName="TableHeader";let o=r.forwardRef(({className:e,...r},n)=>(0,t.jsx)("tbody",{ref:n,className:(0,a.cn)("[&_tr:last-child]:border-0",e),...r}));o.displayName="TableBody",r.forwardRef(({className:e,...r},n)=>(0,t.jsx)("tfoot",{ref:n,className:(0,a.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...r})).displayName="TableFooter";let s=r.forwardRef(({className:e,...r},n)=>(0,t.jsx)("tr",{ref:n,className:(0,a.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...r}));s.displayName="TableRow";let l=r.forwardRef(({className:e,...r},n)=>(0,t.jsx)("th",{ref:n,className:(0,a.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...r}));l.displayName="TableHead";let u=r.forwardRef(({className:e,...r},n)=>(0,t.jsx)("td",{ref:n,className:(0,a.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...r}));u.displayName="TableCell",r.forwardRef(({className:e,...r},n)=>(0,t.jsx)("caption",{ref:n,className:(0,a.cn)("mt-4 text-sm text-muted-foreground",e),...r})).displayName="TableCaption",e.s(["Table",()=>n,"TableBody",()=>o,"TableCell",()=>u,"TableHead",()=>l,"TableHeader",()=>i,"TableRow",()=>s])},804760,e=>{"use strict";var t=e.i(255749);let r=(e,t="Ush")=>{let r=Math.round(e).toLocaleString();return`${t} ${r}`},a=async(e,a)=>{let{filename:n,orientation:i="portrait",format:o="a4",margins:s={top:20,right:20,bottom:20,left:20},returnBlob:l=!1}=a,u=new t.default({orientation:i,unit:"mm",format:o,compress:!0}),c=u.internal.pageSize.getWidth(),d=u.internal.pageSize.getHeight(),m=c-s.left-s.right,f=s.top,p=()=>{u.setLineWidth(.2)},y=(e,t,r,a={})=>{let{fontSize:n=10,fontStyle:i="normal",align:o="left",maxWidth:s}=a;if(u.setFontSize(n),u.setFont("helvetica",i),!s)return u.text(e,t,r,{align:o}),.35*n;{let a=u.splitTextToSize(e,s);return u.text(a,t,r,{align:o}),a.length*(.35*n)}},g=(e,t,r,a,n={})=>{let{fontSize:i=10,fontStyle:o="normal",align:s="left",lineHeight:l=1.2}=n;u.setFontSize(i),u.setFont("helvetica",o);let c=u.splitTextToSize(e,a),d=.35*i*l;return c.forEach((e,a)=>{u.text(e,t,r+a*d,{align:s})}),c.length*d},h=(e,t,r,a)=>{p(),u.line(e,t,r,a)},b=(e,t,r,a,n="S")=>{p(),u.rect(e,t,r,a,n)},w=()=>{b(s.left,s.top,m,d-s.top-s.bottom,"S")},S=e=>f+e>d-s.bottom&&(u.addPage(),f=s.top+10,w(),!0);w();let v=s.left+8,P=m-16;if(f+=8,e.businessLogo)try{let t=new Image;t.crossOrigin="anonymous",await new Promise((r,a)=>{t.onload=()=>{try{let e=document.createElement("canvas"),r=e.getContext("2d");if(r){e.width=t.width,e.height=t.height,r.drawImage(t,0,0);let a=e.toDataURL("image/png"),n=t.width/t.height;u.addImage(a,"PNG",v,f,15*n,15)}}catch(e){console.error("Error adding logo to PDF:",e)}r()},t.onerror=()=>{console.error("Error loading logo image"),r()},t.src=e.businessLogo})}catch(e){console.error("Error processing logo:",e)}let _=.75*P,x=v+P,N=f;if(e.businessName&&(N+=y(e.businessName,x,N,{fontSize:14,fontStyle:"bold",align:"right"}),N+=1.5),e.businessAddress){let t=u.splitTextToSize(e.businessAddress,_);t.forEach((e,t)=>{u.setFontSize(10),u.setFont("helvetica","normal"),u.text(e,x,N+3.15*t,{align:"right"})}),N+=3.15*t.length+.5}e.businessPhone&&(N+=y(`Phone: ${e.businessPhone}`,x,N,{fontSize:9,align:"right"}),N+=.5),e.businessEmail&&(N+=y(`Email: ${e.businessEmail}`,x,N,{fontSize:9,align:"right"}),N+=.5),f=Math.max(f+18,N)+5,S(20),h(v,f,v+P,f),f+=6,f+=y(e.documentTitle.toUpperCase(),c/2,f,{fontSize:16,fontStyle:"bold",align:"center"});let E=f+=4,A=E;A+=y(`${e.documentNumberLabel} ${e.receiptNumber}`,v,A,{fontSize:11,fontStyle:"bold"}),A+=2,A+=y(`Date: ${e.date}`,v,A,{fontSize:10}),A+=2,A+=y(`Time: ${e.time}`,v,A,{fontSize:10});let C=v+.7*P;if(y(`Status: ${e.status}`,C,E,{fontSize:11,fontStyle:"bold",align:"left"}),f=A+4,e.customerName&&""!==e.customerName.trim()){if(S(30),f+=y("Customer Information:",v,f,{fontSize:11,fontStyle:"bold"}),f+=3,f+=y(e.customerName,v,f,{fontSize:10}),f+=2.5,e.customerAddress&&""!==e.customerAddress.trim()){let t=g(e.customerAddress,v,f,.8*P,{fontSize:10,lineHeight:1});f+=t,f+=2.5}e.customerContact&&""!==e.customerContact.trim()&&(f+=y(e.customerContact,v,f,{fontSize:10}),f+=2.5),f+=3}let I=e.items.some(e=>(e.discountPercentage||0)>0||(e.discountAmount||0)>0),T=I?["Description","Qty","Unit Price","Discount","Amount"]:["Description","Qty","Unit Price","Amount"],k=I?[.35*P,.15*P,.18*P,.12*P,.2*P]:[.45*P,.15*P,.2*P,.2*P];u.setFillColor(245,245,245),b(v,f-2,P,10,"F"),b(v,f-2,P,10,"S");let F=v;T.forEach((e,t)=>{y(e,F+3,f+4,{fontSize:10,fontStyle:"bold"}),t<T.length-1&&h(F+k[t],f-2,F+k[t],f+8),F+=k[t]}),f+=10;let D=0;e.items.forEach((t,a)=>{u.setFontSize(9);let n=Math.max(8,3.5*u.splitTextToSize(t.description,k[0]-6).length+4);S(n+5),t.unitPrice,t.quantity,t.discountAmount;let i=t.amount;if(D+=i,a%2==1&&(u.setFillColor(250,250,250),b(v,f,P,n,"F")),b(v,f,P,n,"S"),F=v,g(t.description,F+3,f+4,k[0]-6,{fontSize:9,lineHeight:1.1}),h(F+=k[0],f,F,f+n),y(t.quantity.toString(),F+k[1]-3,f+n/2+1.5,{fontSize:9,align:"right"}),h(F+=k[1],f,F,f+n),y(r(t.unitPrice,e.currency),F+k[2]-3,f+n/2+1.5,{fontSize:9,align:"right"}),h(F+=k[2],f,F,f+n),I){let a="-";(t.discountPercentage||0)>0?a=`${t.discountPercentage}%`:(t.discountAmount||0)>0&&(a=r(t.discountAmount,e.currency)),y(a,F+k[3]-3,f+n/2+1.5,{fontSize:9,align:"right"}),h(F+=k[3],f,F,f+n)}y(r(i,e.currency),F+k[I?4:3]-3,f+n/2+1.5,{fontSize:9,align:"right"}),f+=n,a<e.items.length-1&&h(v,f,v+P,f)}),f+=5,S(70);let L=v+.45*P,z=.55*P,$=.55*z,j=.45*z,O=e.items.reduce((e,t)=>{let r=t.unitPrice*t.quantity;return e+("amount"===t.discountType?t.discountAmount||0:r*(t.discountPercentage||0)/100)},0);if(O>0&&(b(L,f,z,8,"S"),u.setFillColor(248,248,248),b(L,f,z,8,"F"),y("Subtotal (before discount):",L+4,f+5.5,{fontSize:10,fontStyle:"normal"}),h(L+$,f,L+$,f+8),y(r(D+O,e.currency),L+$+j-4,f+5.5,{fontSize:10,fontStyle:"normal",align:"right"}),b(L,f+=8,z,8,"S"),u.setFillColor(255,240,220),b(L,f,z,8,"F"),y("Total Discount:",L+4,f+5.5,{fontSize:10,fontStyle:"normal"}),h(L+$,f,L+$,f+8),y(`-${r(O,e.currency)}`,L+$+j-4,f+5.5,{fontSize:10,fontStyle:"normal",align:"right"}),f+=8),b(L,f,z,8,"S"),u.setFillColor(248,248,248),b(L,f,z,8,"F"),y(O>0?"Subtotal (after discount):":"Subtotal:",L+4,f+5.5,{fontSize:10,fontStyle:"normal"}),h(L+$,f,L+$,f+8),y(r(D,e.currency),L+$+j-4,f+5.5,{fontSize:10,fontStyle:"normal",align:"right"}),f+=8,e.showTaxRow&&e.taxAmount>0&&(b(L,f,z,8,"S"),u.setFillColor(250,250,250),b(L,f,z,8,"F"),y(`Tax (${e.taxRate}%):`,L+4,f+5.5,{fontSize:10,fontStyle:"normal"}),h(L+$,f,L+$,f+8),y(r(e.taxAmount,e.currency),L+$+j-4,f+5.5,{fontSize:10,fontStyle:"normal",align:"right"}),f+=8),b(L,f,z,12,"S"),u.setFillColor(220,220,220),b(L,f,z,12,"F"),y("TOTAL:",L+4,f+7.5,{fontSize:12,fontStyle:"bold"}),h(L+$,f,L+$,f+12),y(r(e.totalAmount,e.currency),L+$+j-4,f+7.5,{fontSize:12,fontStyle:"bold",align:"right"}),f+=12,e.isInstallmentSale&&(void 0!==e.amountPaid&&(b(L,f,z,8,"S"),u.setFillColor(240,248,255),b(L,f,z,8,"F"),y("Amount Paid:",L+4,f+5.5,{fontSize:10,fontStyle:"bold"}),h(L+$,f,L+$,f+8),y(r(e.amountPaid,e.currency),L+$+j-4,f+5.5,{fontSize:10,fontStyle:"bold",align:"right"}),f+=8),void 0!==e.amountDue&&(b(L,f,z,8,"S"),u.setFillColor(255,240,240),b(L,f,z,8,"F"),y("Amount Due:",L+4,f+5.5,{fontSize:10,fontStyle:"bold"}),h(L+$,f,L+$,f+8),y(r(e.amountDue,e.currency),L+$+j-4,f+5.5,{fontSize:10,fontStyle:"bold",align:"right"}),f+=8)),f+=7,e.totalAmountInWords){S(20),y("Amount in words:",v,f+=2,{fontSize:10,fontStyle:"bold"}),f+=4;let t=g(`${e.currency} ${e.totalAmountInWords} only`,v,f,.9*P,{fontSize:10,fontStyle:"italic",lineHeight:1.4});f+=t+4}if(e.hasPaymentInfo&&e.paymentMethods&&e.paymentMethods.length>0){S(40),h(v,f,v+P,f),y("Payment Information:",v,f+=5,{fontSize:11,fontStyle:"bold"}),f+=4;let t=["Payment Method","Account Number","Account Name"],r=[.28*P,.36*P,.36*P];u.setFillColor(240,240,240),b(v,f-2,P,10,"F"),b(v,f-2,P,10,"S");let a=v;t.forEach((e,n)=>{y(e,a+4,f+4,{fontSize:9,fontStyle:"bold"}),n<t.length-1&&h(a+r[n],f-2,a+r[n],f+10-2),a+=r[n]}),f+=10,e.paymentMethods.filter(e=>e.method.trim()||e.accountNumber.trim()||e.accountName.trim()).forEach((e,t)=>{S(15),t%2==1&&(u.setFillColor(248,248,248),b(v,f,P,10,"F")),b(v,f,P,10,"S"),a=v,y(e.method,a+4,f+5,{fontSize:9,fontStyle:"bold"}),h(a+=r[0],f,a,f+10),y(e.accountNumber,a+4,f+5,{fontSize:9}),h(a+=r[1],f,a,f+10),y(e.accountName,a+4,f+5,{fontSize:9}),f+=10}),f+=4}if(e.notes&&e.notes.trim()){S(25),h(v,f,v+P,f),y("Notes:",v,f+=4,{fontSize:11,fontStyle:"bold"}),f+=6;let t=P-8;u.splitTextToSize(e.notes,t).forEach(e=>{S(8),y(e,v+4,f,{fontSize:10}),f+=5}),f+=4}if(e.signature)try{S(35);let t=new Image;t.crossOrigin="anonymous",await new Promise(r=>{t.onload=()=>{try{let e=document.createElement("canvas"),r=e.getContext("2d");if(r){let a,n;e.width=t.width,e.height=t.height,r.drawImage(t,0,0);let i=e.toDataURL("image/png"),o=t.width/t.height;o>2?(a=40,n=40/o):(n=20,a=20*o);let s=v+P-a;h(v,f,v+P,f),f+=4,u.addImage(i,"PNG",s,f,a,n),f+=n+2,y("Authorized Signature",s+a/2,f,{fontSize:8,align:"center"}),f+=4}}catch(e){console.error("Error adding signature to PDF:",e)}r()},t.onerror=()=>{console.error("Error loading signature image"),r()},t.src=e.signature})}catch(e){console.error("Error processing signature:",e)}if(S(25),y("Thank you for your business!",c/2,f+=6,{fontSize:11,fontStyle:"bold",align:"center"}),y("Created by Gonza Systems",c/2,f+=5,{fontSize:9,align:"center"}),l)return u.output("blob");n&&u.save(n)};e.s(["generateReceiptVectorPDF",0,a])}]);