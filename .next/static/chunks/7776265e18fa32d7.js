(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,576255,e=>{"use strict";let t=(0,e.i(369547).default)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);e.s(["FileText",()=>t],576255)},972733,e=>{"use strict";let t=(0,e.i(369547).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],972733)},920955,(e,t,r)=>{var a={229:function(e){var t,r,a,n=e.exports={};function s(){throw Error("setTimeout has not been defined")}function o(){throw Error("clearTimeout has not been defined")}try{t="function"==typeof setTimeout?setTimeout:s}catch(e){t=s}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(e){r=o}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===s||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}var u=[],c=!1,d=-1;function l(){c&&a&&(c=!1,a.length?u=a.concat(u):d=-1,u.length&&m())}function m(){if(!c){var e=i(l);c=!0;for(var t=u.length;t;){for(a=u,u=[];++d<t;)a&&a[d].run();d=-1,t=u.length}a=null,c=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function p(){}n.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new f(e,t)),1!==u.length||c||i(m)},f.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=p,n.addListener=p,n.once=p,n.off=p,n.removeListener=p,n.removeAllListeners=p,n.emit=p,n.prependListener=p,n.prependOnceListener=p,n.listeners=function(e){return[]},n.binding=function(e){throw Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw Error("process.chdir is not supported")},n.umask=function(){return 0}}},n={};function s(e){var t=n[e];if(void 0!==t)return t.exports;var r=n[e]={exports:{}},o=!0;try{a[e](r,r.exports,s),o=!1}finally{o&&delete n[e]}return r.exports}s.ab="/ROOT/node_modules/next/dist/compiled/process/",t.exports=s(229)},350461,(e,t,r)=>{"use strict";var a,n;t.exports=(null==(a=e.g.process)?void 0:a.env)&&"object"==typeof(null==(n=e.g.process)?void 0:n.env)?e.g.process:e.r(920955)},877325,(e,t,r)=>{"use strict";var a=Symbol.for("react.element"),n=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),u=Symbol.for("react.provider"),c=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),m=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),p=Symbol.iterator,y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},h=Object.assign,g={};function b(e,t,r){this.props=e,this.context=t,this.refs=g,this.updater=r||y}function _(){}function v(e,t,r){this.props=e,this.context=t,this.refs=g,this.updater=r||y}b.prototype.isReactComponent={},b.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},b.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},_.prototype=b.prototype;var w=v.prototype=new _;w.constructor=v,h(w,b.prototype),w.isPureReactComponent=!0;var S=Array.isArray,I=Object.prototype.hasOwnProperty,P={current:null},N={key:!0,ref:!0,__self:!0,__source:!0};function T(e,t,r){var n,s={},o=null,i=null;if(null!=t)for(n in void 0!==t.ref&&(i=t.ref),void 0!==t.key&&(o=""+t.key),t)I.call(t,n)&&!N.hasOwnProperty(n)&&(s[n]=t[n]);var u=arguments.length-2;if(1===u)s.children=r;else if(1<u){for(var c=Array(u),d=0;d<u;d++)c[d]=arguments[d+2];s.children=c}if(e&&e.defaultProps)for(n in u=e.defaultProps)void 0===s[n]&&(s[n]=u[n]);return{$$typeof:a,type:e,key:o,ref:i,props:s,_owner:P.current}}function E(e){return"object"==typeof e&&null!==e&&e.$$typeof===a}var A=/\/+/g;function C(e,t){var r,a;return"object"==typeof e&&null!==e&&null!=e.key?(r=""+e.key,a={"=":"=0",":":"=2"},"$"+r.replace(/[=:]/g,function(e){return a[e]})):t.toString(36)}function x(e,t,r){if(null==e)return e;var s=[],o=0;return!function e(t,r,s,o,i){var u,c,d,l=typeof t;("undefined"===l||"boolean"===l)&&(t=null);var m=!1;if(null===t)m=!0;else switch(l){case"string":case"number":m=!0;break;case"object":switch(t.$$typeof){case a:case n:m=!0}}if(m)return i=i(m=t),t=""===o?"."+C(m,0):o,S(i)?(s="",null!=t&&(s=t.replace(A,"$&/")+"/"),e(i,r,s,"",function(e){return e})):null!=i&&(E(i)&&(u=i,c=s+(!i.key||m&&m.key===i.key?"":(""+i.key).replace(A,"$&/")+"/")+t,i={$$typeof:a,type:u.type,key:c,ref:u.ref,props:u.props,_owner:u._owner}),r.push(i)),1;if(m=0,o=""===o?".":o+":",S(t))for(var f=0;f<t.length;f++){var y=o+C(l=t[f],f);m+=e(l,r,s,y,i)}else if("function"==typeof(y=null===(d=t)||"object"!=typeof d?null:"function"==typeof(d=p&&d[p]||d["@@iterator"])?d:null))for(t=y.call(t),f=0;!(l=t.next()).done;)y=o+C(l=l.value,f++),m+=e(l,r,s,y,i);else if("object"===l)throw Error("Objects are not valid as a React child (found: "+("[object Object]"===(r=String(t))?"object with keys {"+Object.keys(t).join(", ")+"}":r)+"). If you meant to render a collection of children, use an array instead.");return m}(e,s,"","",function(e){return t.call(r,e,o++)}),s}function k(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){(0===e._status||-1===e._status)&&(e._status=1,e._result=t)},function(t){(0===e._status||-1===e._status)&&(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var O={current:null},R={transition:null};function D(){throw Error("act(...) is not supported in production builds of React.")}r.Children={map:x,forEach:function(e,t,r){x(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return x(e,function(){t++}),t},toArray:function(e){return x(e,function(e){return e})||[]},only:function(e){if(!E(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},r.Component=b,r.Fragment=s,r.Profiler=i,r.PureComponent=v,r.StrictMode=o,r.Suspense=l,r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED={ReactCurrentDispatcher:O,ReactCurrentBatchConfig:R,ReactCurrentOwner:P},r.act=D,r.cloneElement=function(e,t,r){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var n=h({},e.props),s=e.key,o=e.ref,i=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,i=P.current),void 0!==t.key&&(s=""+t.key),e.type&&e.type.defaultProps)var u=e.type.defaultProps;for(c in t)I.call(t,c)&&!N.hasOwnProperty(c)&&(n[c]=void 0===t[c]&&void 0!==u?u[c]:t[c])}var c=arguments.length-2;if(1===c)n.children=r;else if(1<c){u=Array(c);for(var d=0;d<c;d++)u[d]=arguments[d+2];n.children=u}return{$$typeof:a,type:e.type,key:s,ref:o,props:n,_owner:i}},r.createContext=function(e){return(e={$$typeof:c,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:u,_context:e},e.Consumer=e},r.createElement=T,r.createFactory=function(e){var t=T.bind(null,e);return t.type=e,t},r.createRef=function(){return{current:null}},r.forwardRef=function(e){return{$$typeof:d,render:e}},r.isValidElement=E,r.lazy=function(e){return{$$typeof:f,_payload:{_status:-1,_result:e},_init:k}},r.memo=function(e,t){return{$$typeof:m,type:e,compare:void 0===t?null:t}},r.startTransition=function(e){var t=R.transition;R.transition={};try{e()}finally{R.transition=t}},r.unstable_act=D,r.useCallback=function(e,t){return O.current.useCallback(e,t)},r.useContext=function(e){return O.current.useContext(e)},r.useDebugValue=function(){},r.useDeferredValue=function(e){return O.current.useDeferredValue(e)},r.useEffect=function(e,t){return O.current.useEffect(e,t)},r.useId=function(){return O.current.useId()},r.useImperativeHandle=function(e,t,r){return O.current.useImperativeHandle(e,t,r)},r.useInsertionEffect=function(e,t){return O.current.useInsertionEffect(e,t)},r.useLayoutEffect=function(e,t){return O.current.useLayoutEffect(e,t)},r.useMemo=function(e,t){return O.current.useMemo(e,t)},r.useReducer=function(e,t,r){return O.current.useReducer(e,t,r)},r.useRef=function(e){return O.current.useRef(e)},r.useState=function(e){return O.current.useState(e)},r.useSyncExternalStore=function(e,t,r){return O.current.useSyncExternalStore(e,t,r)},r.useTransition=function(){return O.current.useTransition()},r.version="18.3.1"},191788,(e,t,r)=>{"use strict";t.exports=e.r(877325)},701884,(e,t,r)=>{"use strict";var a=e.r(191788),n=Symbol.for("react.element"),s=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,i=a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,r){var a,s={},c=null,d=null;for(a in void 0!==r&&(c=""+r),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(d=t.ref),t)o.call(t,a)&&!u.hasOwnProperty(a)&&(s[a]=t[a]);if(e&&e.defaultProps)for(a in t=e.defaultProps)void 0===s[a]&&(s[a]=t[a]);return{$$typeof:n,type:e,key:c,ref:d,props:s,_owner:i.current}}r.Fragment=s,r.jsx=c,r.jsxs=c},391398,(e,t,r)=>{"use strict";t.exports=e.r(701884)},369547,e=>{"use strict";var t=e.i(191788);let r=(...e)=>e.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim();var a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=(0,t.forwardRef)(({color:e="currentColor",size:n=24,strokeWidth:s=2,absoluteStrokeWidth:o,className:i="",children:u,iconNode:c,...d},l)=>(0,t.createElement)("svg",{ref:l,...a,width:n,height:n,stroke:e,strokeWidth:o?24*Number(s)/Number(n):s,className:r("lucide",i),...d},[...c.map(([e,r])=>(0,t.createElement)(e,r)),...Array.isArray(u)?u:[u]])),s=(e,a)=>{let s=(0,t.forwardRef)(({className:s,...o},i)=>(0,t.createElement)(n,{ref:i,iconNode:a,className:r(`lucide-${e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,s),...o}));return s.displayName=`${e}`,s};e.s(["default",()=>s],369547)},426119,e=>{"use strict";var t=e.i(391398),r=e.i(191788),a=e.i(353533);let n=r.forwardRef(({className:e,...r},n)=>(0,t.jsx)("div",{ref:n,className:(0,a.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...r}));n.displayName="Card";let s=r.forwardRef(({className:e,...r},n)=>(0,t.jsx)("div",{ref:n,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",e),...r}));s.displayName="CardHeader";let o=r.forwardRef(({className:e,...r},n)=>(0,t.jsx)("h3",{ref:n,className:(0,a.cn)("text-2xl font-semibold leading-none tracking-tight",e),...r}));o.displayName="CardTitle";let i=r.forwardRef(({className:e,...r},n)=>(0,t.jsx)("p",{ref:n,className:(0,a.cn)("text-sm text-muted-foreground",e),...r}));i.displayName="CardDescription";let u=r.forwardRef(({className:e,...r},n)=>(0,t.jsx)("div",{ref:n,className:(0,a.cn)("p-6 pt-0",e),...r}));u.displayName="CardContent";let c=r.forwardRef(({className:e,...r},n)=>(0,t.jsx)("div",{ref:n,className:(0,a.cn)("flex items-center p-6 pt-0",e),...r}));c.displayName="CardFooter",e.s(["Card",()=>n,"CardContent",()=>u,"CardDescription",()=>i,"CardFooter",()=>c,"CardHeader",()=>s,"CardTitle",()=>o])},563905,901211,e=>{"use strict";var t=e.i(191788),r=e.i(893930),a=e.i(150064),n=e.i(46108),s=e.i(256680);async function o(e){try{let t=await s.db.branchSettings.findUnique({where:{branchId:e}});if(!t)return null;return{id:t.id,business_name:t.businessName,business_address:t.address,business_phone:t.phone,business_email:t.email,business_logo:t.logo,currency:t.currency,signature:t.signatureImage,metadata:t.metadata||{}}}catch(e){return console.error("Error fetching business settings:",e),null}}async function i(e,t,r){try{if(!await s.db.branch.findFirst({where:{id:e,OR:[{adminId:t},{users:{some:{id:t}}}]}}))return{success:!1,error:"Unauthorized to update branch settings"};let a={businessName:r.business_name,address:r.business_address,phone:r.business_phone,email:r.business_email,logo:r.business_logo,currency:r.currency,signatureImage:r.signature,metadata:r.metadata},n=await s.db.branchSettings.upsert({where:{branchId:e},update:a,create:{branchId:e,...a}});return{success:!0,data:{id:n.id,business_name:n.businessName,business_address:n.address,business_phone:n.phone,business_email:n.email,business_logo:n.logo,currency:n.currency,signature:n.signatureImage,metadata:n.metadata}}}catch(e){return console.error("Error upserting business settings:",e),{success:!1,error:e.message||"Failed to update settings"}}}async function u(e){try{let t=await s.db.user.findUnique({where:{id:e},select:{isFrozen:!0,createdAt:!0,subscriptions:{where:{status:"active"},orderBy:{endDate:"desc"},take:1},branches:{select:{id:!0}}}});if(!t)return null;let r=t.subscriptions[0],a=new Date,n=r?Math.ceil((r.endDate.getTime()-a.getTime())/864e5):0;return{is_frozen:t.isFrozen,location_limit:1,billing_amount:r?Number(r.amount):5e4,billing_duration:"Monthly",days_remaining:Math.max(0,n),next_billing_date:r?.endDate.toISOString()||""}}catch(e){return console.error("Error fetching account status:",e),{is_frozen:!1,location_limit:1,billing_amount:5e4,billing_duration:"Monthly",days_remaining:30,next_billing_date:""}}}async function c(e){try{let t=await s.db.branchSettings.findUnique({where:{branchId:e}});if(!t)return null;return{id:t.id,location_id:t.branchId,business_name:t.businessName,business_address:t.address,business_phone:t.phone,business_email:t.email,business_logo:t.logo,completed:!!t.businessName&&!!t.phone,is_frozen:!1}}catch(e){return console.error("Error fetching onboarding status:",e),null}}e.s(["getAccountStatusAction",()=>u,"getBusinessSettingsAction",()=>o,"getOnboardingStatusAction",()=>c,"upsertBusinessSettingsAction",()=>i],901211);let d=()=>({businessName:"",businessAddress:"",businessPhone:"",businessEmail:"",currency:"UGX",paymentInfo:"",defaultPrintFormat:"standard"});e.s(["parsePaymentInfo",0,e=>{if(!e||""===e.trim())return[];let t=e.split("\n").filter(e=>""!==e.trim()),r=[];for(let e=0;e<t.length;e+=3)e+2<t.length&&r.push({method:t[e].trim(),accountNumber:t[e+1].trim(),accountName:t[e+2].trim()});return r},"useBusinessSettings",0,()=>{let[e,s]=(0,t.useState)(d()),[u,c]=(0,t.useState)(!1),{toast:l}=(0,a.useToast)(),{currentBusiness:m}=(0,n.useBusiness)(),f=async()=>{if(!m)return d();try{let e=await o(m.id);if(!e)return d();{let t=e.metadata&&"object"==typeof e.metadata&&e.metadata.payment_info||"";return{id:e.id,businessName:e.business_name||"",businessAddress:e.business_address||"",businessPhone:e.business_phone||"",businessEmail:e.business_email||"",businessLogo:e.business_logo||void 0,currency:e.currency||"UGX",signature:e.signature||void 0,paymentInfo:t,defaultPrintFormat:e.metadata&&"object"==typeof e.metadata&&e.metadata.default_print_format||"standard",defaultPrinterName:e.metadata&&"object"==typeof e.metadata&&e.metadata.default_printer_name||"",defaultPrinterType:e.metadata&&"object"==typeof e.metadata&&e.metadata.default_printer_type||"USB",printerPaperSize:e.metadata&&"object"==typeof e.metadata&&e.metadata.printer_paper_size||"58mm"}}}catch(e){return console.error("Error loading business settings:",e),l({title:"Error",description:"Failed to load business settings. Please try again.",variant:"destructive"}),d()}},p=async t=>{if(!m)return console.error("No business selected for updating settings"),l({title:"Error",description:"No business selected",variant:"destructive"}),!1;try{let r={payment_info:t.hasOwnProperty("paymentInfo")?t.paymentInfo:e.paymentInfo||"",default_print_format:t.hasOwnProperty("defaultPrintFormat")?t.defaultPrintFormat:e.defaultPrintFormat||"standard",default_printer_name:t.hasOwnProperty("defaultPrinterName")?t.defaultPrinterName:e.defaultPrinterName||"",default_printer_type:t.hasOwnProperty("defaultPrinterType")?t.defaultPrinterType:e.defaultPrinterType||"USB",printer_paper_size:t.hasOwnProperty("printerPaperSize")?t.printerPaperSize:e.printerPaperSize||"58mm"},a={business_name:t.hasOwnProperty("businessName")?t.businessName:e.businessName,business_address:t.hasOwnProperty("businessAddress")?t.businessAddress:e.businessAddress,business_phone:t.hasOwnProperty("businessPhone")?t.businessPhone:e.businessPhone,business_email:t.hasOwnProperty("businessEmail")?t.businessEmail:e.businessEmail,business_logo:t.hasOwnProperty("businessLogo")?t.businessLogo:e.businessLogo,currency:t.hasOwnProperty("currency")?t.currency:e.currency,signature:t.hasOwnProperty("signature")?t.signature:e.signature,metadata:r},n=await i(m.id,"00000000-0000-0000-0000-000000000000",a);if(!n.success)throw console.error("Supabase error updating business settings:",n.error),Error(n.error);return l({title:"Success",description:"Business settings updated successfully"}),b(),!0}catch(e){return console.error("Error updating business settings:",e),l({title:"Error",description:"Failed to update business settings. Please try again.",variant:"destructive"}),!1}},{data:y,isLoading:h,isFetching:g,refetch:b}=(0,r.useQuery)({queryKey:["businessSettings",m?.id],queryFn:f,enabled:!!m?.id,staleTime:3e5,gcTime:18e5,refetchOnWindowFocus:!1,refetchOnReconnect:!1});return(0,t.useEffect)(()=>{y?s(y):m||s(d())},[y,m]),(0,t.useEffect)(()=>{c(h||g)},[h,g]),{settings:e,isLoading:u,updateSettings:p,loadSettings:f}}],563905)},30691,e=>{"use strict";var t=e.i(191788);function r(){let[e,r]=t.default.useState(()=>window.innerWidth<768);return t.default.useEffect(()=>{let e=()=>{r(window.innerWidth<768)};e();let t=window.matchMedia("(max-width: 767px)");return t.addEventListener("change",e),()=>t.removeEventListener("change",e)},[]),e}e.s(["useIsMobile",()=>r])},286012,e=>{"use strict";var t=e.i(256680);async function r(e){try{return await t.db.activityHistory.create({data:{userId:e.userId,locationId:e.locationId,activityType:e.activityType,module:e.module,entityType:e.entityType,entityId:e.entityId||null,entityName:e.entityName,description:e.description,metadata:e.metadata||null,profileId:e.profileId||null,profileName:e.profileName||null}}),{success:!0}}catch(e){return console.error("Error logging activity:",e),{success:!1,error:e.message}}}async function a(e,r,n=1,s=20,o){try{let a={locationId:e,userId:r};if(o&&(o.activityType&&"ALL"!==o.activityType&&(a.activityType=o.activityType),o.module&&"ALL"!==o.module&&(a.module=o.module),o.search&&(a.OR=[{entityName:{contains:o.search,mode:"insensitive"}},{description:{contains:o.search,mode:"insensitive"}}]),o.dateFrom||o.dateTo)&&(a.createdAt={},o.dateFrom&&(a.createdAt.gte=new Date(o.dateFrom)),o.dateTo)){let e=new Date(o.dateTo);e.setHours(23,59,59,999),a.createdAt.lte=e}let[i,u]=await Promise.all([t.db.activityHistory.findMany({where:a,skip:(n-1)*s,take:s,orderBy:{createdAt:"desc"}}),t.db.activityHistory.count({where:a})]);return{success:!0,data:{activities:i.map(e=>({...e,created_at:e.createdAt.toISOString(),activity_type:e.activityType,location_id:e.locationId,user_id:e.userId,entity_type:e.entityType,entity_id:e.entityId,entity_name:e.entityName,profile_id:e.profileId,profile_name:e.profileName})),count:u}}}catch(e){return console.error("Error fetching activity history:",e),{success:!1,error:e.message}}}e.s(["getActivityHistoryAction",()=>a,"logActivityAction",()=>r])},923850,e=>{"use strict";var t=e.i(824216);e.s(["useCurrentUser",0,()=>{let{user:e}=(0,t.useAuth)();return{userId:e?.id}}])},810686,e=>{"use strict";e.s(["mapDbProductToProduct",0,e=>({id:e.id,itemNumber:e.item_number,barcode:e.barcode,manufacturerBarcode:e.manufacturer_barcode,name:e.name,description:e.description,category:e.category,quantity:e.quantity,costPrice:Number(e.cost_price),sellingPrice:Number(e.selling_price),supplier:e.supplier,imageUrl:e.image_url,minimumStock:e.minimum_stock,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}),"mapDbSaleToSale",0,e=>{let t=(Array.isArray(e.items)?e.items:[]).map(e=>{let t=void 0!==e.discountPercentage?Number(e.discountPercentage):void 0,r=void 0!==e.discountAmount?Number(e.discountAmount):void 0,a=e.discountType;return!a&&(t&&t>0?a="percentage":r&&r>0&&(a="amount")),{description:e.description||"",quantity:Number(e.quantity)||0,price:Number(e.price)||0,cost:Number(e.cost)||0,productId:e.productId||void 0,discountType:a,discountPercentage:t,discountAmount:r,createdAt:e.createdAt||void 0}});return{id:e.id,receiptNumber:e.receipt_number,customerName:e.customer_name,customerAddress:e.customer_address||"",customerContact:e.customer_contact||"",customerId:e.customer_id||void 0,items:t,paymentStatus:e.payment_status,profit:Number(e.profit),date:new Date(e.date),taxRate:e.tax_rate?Number(e.tax_rate):0,cashTransactionId:e.cash_transaction_id||void 0,amountPaid:e.amount_paid?Number(e.amount_paid):void 0,amountDue:e.amount_due?Number(e.amount_due):void 0,notes:e.notes||"",categoryId:e.category_id||void 0,createdAt:new Date(e.created_at)}},"mapSaleToDbSale",0,(e,t,r,a,n,s,o)=>({user_id:n,location_id:s,receipt_number:a,customer_name:e.customerName,customer_address:e.customerAddress||null,customer_contact:e.customerContact||null,customer_id:e.customerId||null,items:e.items,payment_status:e.paymentStatus,profit:r,date:t.toISOString().split("T")[0],tax_rate:e.taxRate||0,cash_transaction_id:o||null,amount_paid:e.amountPaid||null,amount_due:e.amountDue||null,notes:e.notes||null,category_id:e.categoryId||null})])},546462,e=>{"use strict";var t=e.i(286012),r=e.i(923850),a=e.i(46108),n=e.i(638822);e.s(["useActivityLogger",0,()=>{let{userId:e}=(0,r.useCurrentUser)(),{currentBusiness:s}=(0,a.useBusiness)(),o=null;try{let{currentProfile:e}=(0,n.useProfiles)();o=e}catch{o=null}return{logActivity:async r=>{if(!e||!s?.id)return void console.warn("Cannot log activity: missing user or business context");try{let a=await (0,t.logActivityAction)({userId:e,locationId:s.id,activityType:r.activityType,module:r.module,entityType:r.entityType,entityId:r.entityId||void 0,entityName:r.entityName,description:r.description,metadata:r.metadata||void 0,profileId:o?.id||void 0,profileName:o?.profile_name||void 0});a.success||console.error("Error logging activity:",a.error)}catch(e){console.error("Failed to log activity:",e)}}}}])},554913,e=>{"use strict";var t=e.i(355879),r=e.i(679935),a=e.i(8745);e.s(["useInventoryActions",0,e=>{let{updateProductsBulk:n}=(0,t.useProducts)(e),s=async(e,t)=>{if(!e.length)return[];try{return await (0,a.getProductsByIdsAction)(e,t)}catch(e){throw console.error("Error fetching fresh products:",e),e}};return{deductStockForSale:async(t,a,o,i,u)=>{if(!e)return!1;try{let c=t.filter(e=>e.productId);if(0===c.length)return!0;let d=[...new Set(c.map(e=>e.productId))],l=await s(d,u);if(0===l.length)return!1;let m=new Map;for(let e of c){let t=m.get(e.productId)||0;m.set(e.productId,t+e.quantity)}let f=[];for(let[e,t]of m.entries()){let a=l.find(t=>t.id===e);if(!a)continue;let n=a.quantity-t;f.push({id:e,updated:{...a,quantity:n}}),n<0&&r.toast.warning(`${a.name} inventory is now negative (${n}). Please restock soon.`)}return f.length>0&&await n(f,e,"Sale",a,o,i),!0}catch(e){return console.error("Error deducting stock for sale:",e),!1}},restoreStockForSale:async(t,r,a,o)=>{if(!e)return!1;try{let i=t.filter(e=>e.productId);if(0===i.length)return!0;let u=[...new Set(i.map(e=>e.productId))],c=await s(u,o),d=new Map;for(let e of i){let t=d.get(e.productId)||0;d.set(e.productId,t+e.quantity)}let l=[];for(let[e,t]of d.entries()){let r=c.find(t=>t.id===e);if(!r)continue;let a=r.quantity+t;l.push({id:e,updated:{...r,quantity:a}})}return l.length>0&&await n(l,e,"Deleted Sale",r,void 0,a),!0}catch(e){return console.error("Error restoring stock for sale:",e),!1}},adjustStockForEditedSale:async(t,a,o,i,u,c)=>{if(!e)return!1;try{let d=[...t.filter(e=>e.productId).map(e=>e.productId),...a.filter(e=>e.productId).map(e=>e.productId)],l=[...new Set(d)];if(0===l.length)return!0;let m=await s(l,c),f=new Map;for(let e of t.filter(e=>e.productId)){let t=f.get(e.productId)||0;f.set(e.productId,t+e.quantity)}for(let e of a.filter(e=>e.productId)){let t=f.get(e.productId)||0;f.set(e.productId,t-e.quantity)}let p=[];for(let[e,t]of f.entries()){if(0===t)continue;let a=m.find(t=>t.id===e);if(!a)continue;let n=a.quantity+t;p.push({id:e,updated:{...a,quantity:n}}),n<0&&r.toast.warning(`${a.name} inventory is now negative (${n}). Please restock soon.`)}return p.length>0&&await n(p,e,"Sale Status/Qty Edit",o,i,u),!0}catch(e){return console.error("Error adjusting stock for edited sale:",e),!1}}}}])},873015,e=>{"use strict";var t=e.i(256680),r=e.i(290205);async function a(e,r="desc",n){try{let a={where:{branchId:e},orderBy:{createdAt:r},include:{cashTransaction:!0}};return n&&n>0&&(a.take=n),(await t.db.sale.findMany(a)).map(e=>({id:e.id,user_id:e.userId,location_id:e.branchId,receipt_number:e.saleNumber,customer_name:e.customerName,customer_address:e.customerAddress,customer_contact:e.customerPhone,customer_id:e.customerId,items:e.items,payment_status:e.paymentStatus,profit:0,date:e.date.toISOString(),tax_rate:e.taxRate?Number(e.taxRate):0,created_at:e.createdAt.toISOString(),updated_at:e.updatedAt.toISOString(),cash_transaction_id:e.cashTransactionId,amount_paid:Number(e.amountPaid),amount_due:Number(e.balance),category_id:e.categoryId,notes:e.notes}))}catch(e){return console.error("Error fetching sales:",e),[]}}async function n(e,r){try{let a=await t.db.sale.findUnique({where:{id:e},include:{cashTransaction:!0,installmentPayments:!0}});if(!a||a.branchId!==r)return{success:!1,error:"Sale not found or unauthorized"};return await t.db.$transaction(async t=>{await t.installmentPayment.deleteMany({where:{saleId:e}}),a.cashTransactionId&&await t.cashTransaction.delete({where:{id:a.cashTransactionId}}),await t.sale.delete({where:{id:e}})}),{success:!0,sale:{receiptNumber:a.saleNumber,customerName:a.customerName,customerAddress:a.customerAddress,customerContact:a.customerPhone,paymentStatus:a.paymentStatus,cashTransactionId:a.cashTransactionId,items:a.items,amountPaid:Number(a.amountPaid),amountDue:Number(a.balance),profit:0,taxRate:Number(a.taxRate),notes:a.notes}}}catch(e){return console.error("Error deleting sale:",e),{success:!1,error:e.message||"Failed to delete sale"}}}async function s(e,r,a){try{let n=e.payment_status;"NOT PAID"===n?n="UNPAID":"Installment Sale"===n?n="INSTALLMENT":"Paid"===n?n="PAID":"Quote"===n&&(n="QUOTE");let s={userId:e.user_id,branchId:e.location_id,saleNumber:e.receipt_number,customerName:e.customer_name,customerAddress:e.customer_address,customerPhone:e.customer_contact,customerId:e.customer_id,items:e.items,paymentStatus:n,date:new Date(e.date),taxRate:e.tax_rate,cashTransactionId:e.cash_transaction_id,amountPaid:e.amount_paid,balance:e.amount_due,categoryId:e.category_id,notes:e.notes,subtotal:0,total:0};if(r&&a){let e=await t.db.sale.update({where:{id:a},data:s});return{success:!0,data:e}}{let e=await t.db.sale.create({data:s});return{success:!0,data:e}}}catch(e){return console.error("Error upserting sale:",e),{success:!1,error:e.message||"Failed to preserve sale"}}}async function o(e){try{let r=await t.db.saleCategory.findMany({where:{branchId:e},orderBy:{name:"asc"}});return{success:!0,data:r}}catch(e){return console.error("Error fetching sales categories:",e),{success:!1,error:e.message}}}async function i(e,a,n,s=!1){try{let o=await t.db.saleCategory.create({data:{branchId:e,userId:a,name:n,is_default:s}});return(0,r.revalidatePath)("/sales"),{success:!0,data:o}}catch(e){return console.error("Error creating sales category:",e),{success:!1,error:e.message}}}async function u(e,a){try{let n=await t.db.saleCategory.update({where:{id:e},data:{name:a}});return(0,r.revalidatePath)("/sales"),{success:!0,data:n}}catch(e){return console.error("Error updating sales category:",e),{success:!1,error:e.message}}}async function c(e){try{return await t.db.saleCategory.delete({where:{id:e}}),(0,r.revalidatePath)("/sales"),{success:!0}}catch(e){return console.error("Error deleting sales category:",e),{success:!1,error:e.message}}}async function d(e,r){if(!e||!r)return null;try{return await t.db.customer.findFirst({where:{branchId:e,name:{contains:r,mode:"insensitive"}},select:{id:!0,name:!0}})}catch(e){return console.error("Error looking up customer by name:",e),null}}async function l(e,r){try{return await t.db.sale.update({where:{id:e},data:{customerId:r}}),{success:!0}}catch(e){return console.error("Error updating sale customer:",e),{success:!1,error:e.message}}}async function n(e){try{return await t.db.sale.delete({where:{id:e}}),(0,r.revalidatePath)("/sales"),!0}catch(e){return console.error("Error deleting sale:",e),!1}}e.s(["createSalesCategoryAction",()=>i,"deleteSaleAction",()=>n,"deleteSalesCategoryAction",()=>c,"getCustomerByNameAction",()=>d,"getSalesAction",()=>a,"getSalesCategoriesAction",()=>o,"updateSaleCustomerAction",()=>l,"updateSalesCategoryAction",()=>u,"upsertSaleAction",()=>s])},852577,e=>{"use strict";var t=e.i(191788),r=e.i(810686),a=e.i(150064),n=e.i(893930),s=e.i(285700),o=e.i(546462),i=e.i(46108),u=e.i(554913),c=e.i(775778),d=e.i(873015);e.s(["useSalesData",0,(e,l="desc",m)=>{let f=(0,s.useQueryClient)(),{toast:p}=(0,a.useToast)(),{logActivity:y}=(0,o.useActivityLogger)(),{currentBusiness:h}=(0,i.useBusiness)(),{restoreStockForSale:g}=(0,u.useInventoryActions)(e),b=(0,t.useCallback)(async()=>{try{if(!e||!h)return[];let t=await (0,d.getSalesAction)(h.id,l,m);return t?t.map(e=>{let t={id:e.id,user_id:e.user_id,location_id:e.location_id,receipt_number:e.receipt_number,customer_name:e.customer_name,customer_address:e.customer_address,customer_contact:e.customer_contact,customer_id:e.customer_id,items:e.items,payment_status:e.payment_status,profit:e.profit?Number(e.profit):0,date:e.date,tax_rate:e.tax_rate||0,created_at:e.created_at,updated_at:e.updated_at,cash_transaction_id:e.cash_transaction_id,amount_paid:e.amount_paid?Number(e.amount_paid):void 0,amount_due:e.amount_due?Number(e.amount_due):void 0,category_id:e.category_id,notes:e.notes};return(0,r.mapDbSaleToSale)(t)}):[]}catch(e){return console.error("Error loading sales:",e),p({title:"Error",description:"Failed to load sales data. Please try again.",variant:"destructive"}),[]}},[e,h?.id,l,m,p]),_=(0,t.useMemo)(()=>["sales",h?.id,e],[h?.id,e]),v=(0,t.useMemo)(()=>[..._,l,m],[_,l,m]),{data:w=[],isLoading:S,isFetching:I,refetch:P}=(0,n.useQuery)({queryKey:v,queryFn:b,enabled:!!e&&!!h?.id,staleTime:3e4,gcTime:18e5,refetchOnWindowFocus:!0,refetchOnReconnect:!0}),N=S||I&&0===w.length,T=(0,t.useMemo)(()=>{let e=w.filter(e=>"Quote"!==e.paymentStatus),t=new Map;return e.forEach(e=>{let r=e.customerName,a=e.items.reduce((e,t)=>e+t.price*t.quantity,0);if(t.has(r)){let n=t.get(r);t.set(r,{total:n.total+a,count:n.count+1,customerId:n.customerId||e.customerId})}else t.set(r,{total:a,count:1,customerId:e.customerId})}),Array.from(t.entries()).map(([e,t])=>({id:t.customerId,name:e,totalPurchases:t.total,orderCount:t.count})).sort((e,t)=>t.totalPurchases-e.totalPurchases)},[w]),E=(0,t.useMemo)(()=>e=>{let t=w.filter(t=>t.customerName.toLowerCase()===e.toLowerCase()&&"Quote"!==t.paymentStatus);return{total:t.reduce((e,t)=>e+t.items.reduce((e,t)=>e+t.price*t.quantity,0),0),count:t.length}},[w]),A=async e=>{try{let t=w.find(t=>t.id===e);if(!t)throw Error("Sale not found");if("Quote"!==t.paymentStatus&&t.items.length>0&&(console.log("Restoring product quantities via useInventoryActions..."),await g(t.items,e,t.receiptNumber,h?.id)||p({title:"Inventory Update Warning",description:"Sale deleted, but inventory restoration might have failed. Please check your stock levels.",variant:"destructive"})),!h?.id)throw Error("Business context missing for deletion");let r=await (0,d.deleteSaleAction)(e,h.id);if(!r.success)throw Error(r.error);return f.setQueryData(v,t=>t?t.filter(t=>t.id!==e):[]),f.invalidateQueries({queryKey:_}),C(),await y({activityType:"DELETE",module:"SALES",entityType:"sale",entityId:e,entityName:`Sale #${t.receiptNumber}`,description:`Deleted sale for ${t.customerName} - Total: UGX ${((t.amountPaid||0)+(t.amountDue||0)).toLocaleString()} (Stock restored)`,metadata:{receiptNumber:t.receiptNumber,customerName:t.customerName,customerAddress:t.customerAddress,customerContact:t.customerContact,totalAmount:(t.amountPaid||0)+(t.amountDue||0),amountPaid:t.amountPaid,profit:t.profit,paymentStatus:t.paymentStatus,taxRate:t.taxRate,itemCount:t.items.length,items:t.items.map(e=>({description:e.description,quantity:e.quantity,price:e.price,cost:e.cost,total:e.quantity*e.price,discountPercentage:e.discountPercentage,discountAmount:e.discountAmount})),notes:t.notes,cashTransactionDeleted:!!t.cashTransactionId}}),p({title:"Sale Deleted",description:"The sale record and associated data have been successfully deleted."}),(0,c.clearInventoryCaches)(),!0}catch(e){return console.error("Error deleting sale:",e),p({title:"Error",description:"Failed to delete sale. Please try again.",variant:"destructive"}),!1}},C=(0,t.useCallback)(()=>{if(!h?.id)return;let e=`soldItemsFilters_${h.id}`;localStorage.removeItem(e),localStorage.removeItem("soldItemsFilters")},[h?.id]);return{sales:w,isLoading:N,deleteSale:A,addSale:(0,t.useCallback)(e=>{f.setQueryData(v,t=>t?[e,...t]:[e]),f.invalidateQueries({queryKey:_}),C(),(0,c.clearInventoryCaches)()},[f,v,_,C,c.clearInventoryCaches]),updateSale:(0,t.useCallback)(e=>{f.setQueryData(v,t=>t?t.map(t=>t.id===e.id?e:t):[e]),f.invalidateQueries({queryKey:_}),C(),(0,c.clearInventoryCaches)()},[f,v,_,C,c.clearInventoryCaches]),getTopCustomers:T,getCustomerLifetimePurchases:E,clearSoldItemsCache:C,refetch:P,isFetching:I}}])}]);