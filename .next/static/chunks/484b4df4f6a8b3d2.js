(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,752086,e=>{"use strict";var t=e.i(843476),a=e.i(271645),s=e.i(904792),l=e.i(679788),r=e.i(107233),n=e.i(115057),i=e.i(688511),c=e.i(569074),o=e.i(440160),d=e.i(871689),m=e.i(790092),h=e.i(10813),x=e.i(475254);let u=(0,x.default)("ArrowRightLeft",[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]]);var p=e.i(373264),g=e.i(39312),j=e.i(531278),f=e.i(519455),y=e.i(515288),b=e.i(422713),N=e.i(966265),v=e.i(98363),w=e.i(160615),C=e.i(414877),T=e.i(653145),S=e.i(776639),k=e.i(759684),D=e.i(793479),I=e.i(110204),M=e.i(624687),A=e.i(967489),B=e.i(286536),F=e.i(178583),P=e.i(37727),E=e.i(4042),O=e.i(261246),_=e.i(908406);let L=({open:e,onOpenChange:s,onSubmit:l,accounts:r,defaultAccountId:n,presetTransactionType:i})=>{let{register:c,handleSubmit:o,formState:{errors:d},reset:m,watch:h,setValue:x}=(0,T.useForm)({defaultValues:{accountId:n||"",transactionType:i||"cash_in",category:"",description:"",personInCharge:"",tags:[],date:new Date,paymentMethod:"",receiptImage:""}}),u=h("transactionType"),p=h("receiptImage"),g=(0,C.useIsMobile)(),[j,y]=(0,a.useState)(!1),[b,N]=(0,a.useState)(!1),{toast:v}=(0,_.useToast)();a.default.useEffect(()=>{if(e){let e=new Date,t=e.toISOString().split("T")[0];m({accountId:n||"",amount:void 0,transactionType:i||"cash_in",category:"",description:"",personInCharge:"",tags:[],date:e,paymentMethod:"",receiptImage:""}),i&&x("transactionType",i),x("date",t)}},[e,n,i,m,x]);let w=e=>e&&e.includes("pdf"),L=async e=>{console.log("Raw form data:",e),N(!0);try{let t;t=e.date instanceof Date?e.date:"string"==typeof e.date?new Date(e.date):new Date;let a={accountId:e.accountId,amount:Number(e.amount),transactionType:e.transactionType,toAccountId:e.toAccountId,category:e.category,description:e.description,personInCharge:e.personInCharge,tags:[],date:t,paymentMethod:e.paymentMethod,receiptImage:e.receiptImage};console.log("Processed form data being submitted:",a),await l(a)}finally{N(!1)}};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(S.Dialog,{open:e,onOpenChange:s,children:(0,t.jsxs)(S.DialogContent,{className:`${g?"max-h-[85vh] w-[95vw] max-w-none":"sm:max-w-[500px]"}`,children:[(0,t.jsx)(S.DialogHeader,{className:g?"pb-2":"",children:(0,t.jsx)(S.DialogTitle,{children:"New Transaction"})}),(0,t.jsx)(k.ScrollArea,{className:g?"h-[calc(85vh-120px)] pr-4":"max-h-[70vh]",children:(0,t.jsxs)("form",{onSubmit:o(L),className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(I.Label,{htmlFor:"accountId",children:"Account"}),(0,t.jsxs)(A.Select,{value:h("accountId"),onValueChange:e=>{x("accountId",e),setTimeout(()=>{let e=document.querySelectorAll('[role="combobox"]')[1];e?.focus()},100)},children:[(0,t.jsx)(A.SelectTrigger,{onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),setTimeout(()=>{let e=document.querySelectorAll('[role="combobox"]')[1];e?.focus()},100))},children:(0,t.jsx)(A.SelectValue,{placeholder:"Select account"})}),(0,t.jsx)(A.SelectContent,{children:r.map(e=>(0,t.jsx)(A.SelectItem,{value:e.id,children:e.name},e.id))})]}),d.accountId&&(0,t.jsx)("p",{className:"text-sm text-red-600",children:d.accountId.message})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(I.Label,{htmlFor:"transactionType",children:"Transaction Type"}),(0,t.jsxs)(A.Select,{value:u,onValueChange:e=>{x("transactionType",e),setTimeout(()=>{if("transfer"===e){let e=document.querySelectorAll('[role="combobox"]')[2];e?.focus()}else document.getElementById("amount")?.focus()},100)},children:[(0,t.jsx)(A.SelectTrigger,{onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),setTimeout(()=>{if("transfer"===u){let e=document.querySelectorAll('[role="combobox"]')[2];e?.focus()}else document.getElementById("amount")?.focus()},100))},children:(0,t.jsx)(A.SelectValue,{})}),(0,t.jsxs)(A.SelectContent,{children:[(0,t.jsx)(A.SelectItem,{value:"cash_in",children:"Cash In"}),(0,t.jsx)(A.SelectItem,{value:"cash_out",children:"Cash Out"}),(0,t.jsx)(A.SelectItem,{value:"transfer",children:"Transfer"})]})]})]}),"transfer"===u&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(I.Label,{htmlFor:"toAccountId",children:"To Account"}),(0,t.jsxs)(A.Select,{value:h("toAccountId")||"",onValueChange:e=>{x("toAccountId",e),setTimeout(()=>{document.getElementById("amount")?.focus()},100)},children:[(0,t.jsx)(A.SelectTrigger,{onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),setTimeout(()=>{document.getElementById("amount")?.focus()},100))},children:(0,t.jsx)(A.SelectValue,{placeholder:"Select destination account"})}),(0,t.jsx)(A.SelectContent,{children:r.filter(e=>e.id!==h("accountId")).map(e=>(0,t.jsx)(A.SelectItem,{value:e.id,children:e.name},e.id))})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(I.Label,{htmlFor:"amount",children:"Amount"}),(0,t.jsx)(D.Input,{id:"amount",type:"number",step:"0.01",...c("amount",{required:"Amount is required",min:{value:.01,message:"Amount must be greater than 0"}}),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),document.getElementById("category")?.focus())},placeholder:"0.00"}),d.amount&&(0,t.jsx)("p",{className:"text-sm text-red-600",children:d.amount.message})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(I.Label,{htmlFor:"category",children:"Category (Optional)"}),(0,t.jsx)(D.Input,{id:"category",...c("category"),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),document.getElementById("description")?.focus())},placeholder:"e.g., Sales, Expense, Investment"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(I.Label,{htmlFor:"description",children:"Description"}),(0,t.jsx)(M.Textarea,{id:"description",...c("description",{required:"Description is required"}),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),document.getElementById("personInCharge")?.focus())},placeholder:"Transaction description",rows:3,className:g?"min-h-[80px]":""}),d.description&&(0,t.jsx)("p",{className:"text-sm text-red-600",children:d.description.message})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(I.Label,{htmlFor:"personInCharge",children:"Person in Charge (Optional)"}),(0,t.jsx)(D.Input,{id:"personInCharge",...c("personInCharge"),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),document.getElementById("paymentMethod")?.focus())},placeholder:"e.g., John Doe, Manager"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(I.Label,{htmlFor:"paymentMethod",children:"Payment Method (Optional)"}),(0,t.jsx)(D.Input,{id:"paymentMethod",...c("paymentMethod"),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),document.getElementById("date")?.focus())},placeholder:"e.g., Cash, Credit Card, Bank Transfer"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(I.Label,{htmlFor:"receiptImage",children:"Receipt (Image or PDF) (Optional)"}),(0,t.jsx)(D.Input,{id:"receiptImage",type:"file",accept:"image/*,.pdf",onChange:e=>{let t=e.target.files?.[0];if(t){let e=t.type.startsWith("image/"),a="application/pdf"===t.type;if(!e&&!a)return void v({title:"Error",description:"Please select an image or PDF file",variant:"destructive"});x("receiptImage",URL.createObjectURL(t))}},className:"cursor-pointer"}),p&&(0,t.jsx)("div",{className:"mt-2 relative",children:w(p)?(0,t.jsxs)("div",{className:"flex items-center gap-2 p-3 border rounded",children:[(0,t.jsx)(F.FileText,{className:"h-8 w-8 text-red-600"}),(0,t.jsx)("span",{className:"text-sm",children:"PDF Receipt"}),(0,t.jsx)(f.Button,{type:"button",variant:"destructive",size:"sm",className:"ml-auto h-6 w-6 rounded-full p-0",onClick:()=>{x("receiptImage","")},children:(0,t.jsx)(P.X,{className:"h-3 w-3"})})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("img",{src:p,alt:"Receipt preview",className:"max-w-full h-32 object-contain border rounded cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>y(!0)}),(0,t.jsx)(f.Button,{type:"button",variant:"secondary",size:"sm",className:"absolute top-2 right-2 opacity-80 hover:opacity-100",onClick:()=>y(!0),children:(0,t.jsx)(B.Eye,{className:"h-4 w-4"})})]})})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(I.Label,{htmlFor:"date",children:"Date"}),(0,t.jsx)(D.Input,{id:"date",type:"date",...c("date",{required:"Date is required"}),onKeyDown:e=>{if("Enter"===e.key){e.preventDefault();let t=document.querySelector('button[type="submit"]');t?.focus()}}}),d.date&&(0,t.jsx)("p",{className:"text-sm text-red-600",children:d.date.message})]}),(0,t.jsxs)("div",{className:`flex ${g?"flex-col gap-2":"justify-end space-x-2"} pt-4`,children:[(0,t.jsx)(f.Button,{type:"button",variant:"outline",onClick:()=>s(!1),className:g?"w-full":"",disabled:b,children:"Cancel"}),(0,t.jsx)(f.Button,{type:"submit",className:g?"w-full":"",disabled:b,children:b?(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(O.default,{size:"sm",className:"!space-y-0"}),(0,t.jsx)("span",{children:"Creating Transaction..."})]}):"Create Transaction"})]})]})})]})}),p&&!w(p)&&(0,t.jsx)(E.default,{isOpen:j,onOpenChange:y,imageUrl:p,imageAlt:"Receipt preview"})]})},R=({open:e,onOpenChange:s,onSubmit:l,transaction:r,accounts:n})=>{let{register:i,handleSubmit:c,formState:{errors:o},reset:d,watch:m,setValue:h}=(0,T.useForm)(),x=(0,C.useIsMobile)(),[u,p]=(0,a.useState)(!1),[g,j]=(0,a.useState)(!1),{toast:y}=(0,_.useToast)();a.default.useEffect(()=>{if(e&&r){let e=r.date.toISOString().split("T")[0];d({accountId:r.accountId||"",amount:r.amount,transactionType:"transfer_in"===r.transactionType||"transfer_out"===r.transactionType?"transfer":r.transactionType,category:r.category,description:r.description,personInCharge:r.personInCharge||"",tags:[],date:r.date,paymentMethod:r.paymentMethod||"",receiptImage:r.receiptImage||""}),h("date",e)}},[e,r,d,h]);let b=e=>e&&e.includes("pdf"),N=async e=>{if(r){j(!0);try{let t;if("string"==typeof e.date){let[a,s,l]=e.date.split("-").map(Number);t=new Date(a,s-1,l,12,0,0)}else t=e.date instanceof Date?e.date:new Date;let a={amount:Number(e.amount),category:e.category,description:e.description,personInCharge:e.personInCharge,tags:[],date:t,paymentMethod:e.paymentMethod,receiptImage:e.receiptImage};await l(r.id,a)}finally{j(!1)}}};return r?(r.date.toISOString().split("T")[0],(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(S.Dialog,{open:e,onOpenChange:s,children:(0,t.jsxs)(S.DialogContent,{className:`${x?"max-h-[85vh] w-[95vw] max-w-none":"sm:max-w-[500px]"}`,children:[(0,t.jsx)(S.DialogHeader,{className:x?"pb-2":"",children:(0,t.jsx)(S.DialogTitle,{children:"Edit Transaction"})}),(0,t.jsx)(k.ScrollArea,{className:x?"h-[calc(85vh-120px)] pr-4":"max-h-[70vh]",children:(0,t.jsxs)("form",{onSubmit:c(N),className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(I.Label,{htmlFor:"transactionType",children:"Transaction Type"}),(0,t.jsx)(D.Input,{value:r.transactionType.replace("_"," "),disabled:!0,className:"bg-gray-100"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(I.Label,{htmlFor:"amount",children:"Amount"}),(0,t.jsx)(D.Input,{id:"amount",type:"number",step:"1",...i("amount",{required:"Amount is required",min:{value:1,message:"Amount must be at least 1"}}),placeholder:"0"}),o.amount&&(0,t.jsx)("p",{className:"text-sm text-red-600",children:o.amount.message})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(I.Label,{htmlFor:"category",children:"Category (Optional)"}),(0,t.jsx)(D.Input,{id:"category",...i("category"),placeholder:"e.g., Sales, Expense, Investment"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(I.Label,{htmlFor:"description",children:"Description"}),(0,t.jsx)(M.Textarea,{id:"description",...i("description",{required:"Description is required"}),placeholder:"Transaction description",rows:3,className:x?"min-h-[80px]":""}),o.description&&(0,t.jsx)("p",{className:"text-sm text-red-600",children:o.description.message})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(I.Label,{htmlFor:"personInCharge",children:"Person in Charge (Optional)"}),(0,t.jsx)(D.Input,{id:"personInCharge",...i("personInCharge"),placeholder:"e.g., John Doe, Manager"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(I.Label,{htmlFor:"paymentMethod",children:"Payment Method (Optional)"}),(0,t.jsx)(D.Input,{id:"paymentMethod",...i("paymentMethod"),placeholder:"e.g., Cash, Credit Card, Bank Transfer"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(I.Label,{htmlFor:"receiptImage",children:"Receipt (Image or PDF) (Optional)"}),(0,t.jsx)(D.Input,{id:"receiptImage",type:"file",accept:"image/*,.pdf",onChange:e=>{let t=e.target.files?.[0];if(t){let e=t.type.startsWith("image/"),a="application/pdf"===t.type;if(!e&&!a)return void y({title:"Error",description:"Please select an image or PDF file",variant:"destructive"});h("receiptImage",URL.createObjectURL(t))}},className:"cursor-pointer"}),m("receiptImage")&&(0,t.jsx)("div",{className:"mt-2 relative",children:b(m("receiptImage"))?(0,t.jsxs)("div",{className:"flex items-center gap-2 p-3 border rounded",children:[(0,t.jsx)(F.FileText,{className:"h-8 w-8 text-red-600"}),(0,t.jsx)("span",{className:"text-sm",children:"PDF Receipt"}),(0,t.jsx)(f.Button,{type:"button",variant:"destructive",size:"sm",className:"ml-auto h-6 w-6 rounded-full p-0",onClick:()=>{h("receiptImage","")},children:(0,t.jsx)(P.X,{className:"h-3 w-3"})})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("img",{src:m("receiptImage"),alt:"Receipt preview",className:"max-w-full h-32 object-contain border rounded cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>p(!0)}),(0,t.jsx)(f.Button,{type:"button",variant:"secondary",size:"sm",className:"absolute top-2 right-2 opacity-80 hover:opacity-100",onClick:()=>p(!0),children:(0,t.jsx)(B.Eye,{className:"h-4 w-4"})})]})})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(I.Label,{htmlFor:"edit-date",children:"Date"}),(0,t.jsx)(D.Input,{id:"edit-date",type:"date",...i("date",{required:"Date is required"})}),o.date&&(0,t.jsx)("p",{className:"text-sm text-red-600",children:o.date.message})]}),(0,t.jsxs)("div",{className:`flex ${x?"flex-col gap-2":"justify-end space-x-2"} pt-4`,children:[(0,t.jsx)(f.Button,{type:"button",variant:"outline",onClick:()=>s(!1),className:x?"w-full":"",disabled:g,children:"Cancel"}),(0,t.jsx)(f.Button,{type:"submit",className:x?"w-full":"",disabled:g,children:g?(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(O.default,{size:"sm",className:"!space-y-0"}),(0,t.jsx)("span",{children:"Updating Transaction..."})]}):"Update Transaction"})]})]})})]})}),m("receiptImage")&&!b(m("receiptImage"))&&(0,t.jsx)(E.default,{isOpen:u,onOpenChange:p,imageUrl:m("receiptImage"),imageAlt:"Receipt preview"})]})):null};var z=e.i(561993),U=e.i(487486);let V=({transaction:e,open:s,onOpenChange:l})=>{var r;let n,i=(0,C.useIsMobile)(),[c,o]=(0,a.useState)(!1),{settings:d}=(0,w.useBusinessSettings)();if(!e)return null;let m=(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Date"}),(0,t.jsx)("p",{className:"text-sm",children:e.date.toLocaleDateString()})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Amount"}),(0,t.jsx)("p",{className:`text-lg font-semibold ${"cash_in"===e.transactionType||"transfer_in"===e.transactionType?"text-green-600":"text-red-600"}`,children:(r=e.amount,n=d?.currency||"USD",new Intl.NumberFormat("en-US",{style:"currency",currency:n,minimumFractionDigits:0,maximumFractionDigits:0}).format(r))})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Transaction Type"}),(0,t.jsx)(U.Badge,{className:(e=>{switch(e){case"cash_in":case"transfer_in":return"bg-green-100 text-green-800";case"cash_out":case"transfer_out":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}})(e.transactionType),children:(e=>{switch(e){case"cash_in":return"Cash In";case"cash_out":return"Cash Out";case"transfer_in":return"Transfer In";case"transfer_out":return"Transfer Out";default:return e}})(e.transactionType)})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Description"}),(0,t.jsx)("p",{className:"text-sm",children:e.description})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Category"}),(0,t.jsx)("p",{className:"text-sm",children:e.category||"Not specified"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Payment Method"}),(0,t.jsx)("p",{className:"text-sm",children:e.paymentMethod||"Not specified"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Person in Charge"}),(0,t.jsx)("p",{className:"text-sm",children:e.personInCharge||"Not specified"})]}),e.tags&&e.tags.length>0&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Tags"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:e.tags.map((e,a)=>(0,t.jsx)(U.Badge,{variant:"outline",className:"text-xs",children:e},a))})]}),e.receiptImage&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Receipt"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("img",{src:e.receiptImage,alt:"Receipt",className:"max-w-full h-32 object-contain border rounded cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>o(!0)}),(0,t.jsx)(f.Button,{variant:"secondary",size:"sm",className:"absolute top-2 right-2 opacity-80 hover:opacity-100",onClick:()=>o(!0),children:(0,t.jsx)(B.Eye,{className:"h-4 w-4"})})]})]})]});return i?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(z.Drawer,{open:s,onOpenChange:l,children:(0,t.jsx)(z.DrawerContent,{className:"max-h-[85vh]",children:(0,t.jsxs)("div",{className:"relative px-4 py-6 pb-8",children:[(0,t.jsxs)(z.DrawerClose,{className:"absolute right-4 top-4 rounded-sm opacity-70 hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring",children:[(0,t.jsx)(P.X,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Close"})]}),(0,t.jsx)(z.DrawerHeader,{className:"px-0 pb-4",children:(0,t.jsx)(z.DrawerTitle,{className:"text-lg",children:"Transaction Details"})}),(0,t.jsx)(k.ScrollArea,{className:"h-[calc(85vh-120px)] pr-4",children:m})]})})}),e.receiptImage&&(0,t.jsx)(E.default,{isOpen:c,onOpenChange:o,imageUrl:e.receiptImage,imageAlt:"Receipt image"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(S.Dialog,{open:s,onOpenChange:l,children:(0,t.jsxs)(S.DialogContent,{className:"sm:max-w-[600px] max-h-[90vh]",children:[(0,t.jsx)(S.DialogHeader,{children:(0,t.jsx)(S.DialogTitle,{children:"Transaction Details"})}),(0,t.jsx)(k.ScrollArea,{className:"max-h-[70vh] pr-4",children:m})]})}),e.receiptImage&&(0,t.jsx)(E.default,{isOpen:c,onOpenChange:o,imageUrl:e.receiptImage,imageAlt:"Receipt image"})]})};var H=e.i(941554),$=e.i(401851),W=e.i(727612),q=e.i(784774),K=e.i(868499),J=e.i(255749),X=e.i(975157),G=e.i(555436);let Y=({searchTerm:e,onSearchChange:a,transactionTypeFilter:s,onTransactionTypeFilterChange:l,onExportCSV:r,onExportPDF:n,totalTransactions:i})=>(0,t.jsxs)("div",{className:"space-y-4 mb-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(G.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(D.Input,{placeholder:"Search transactions...",value:e,onChange:e=>a(e.target.value),className:"pl-10"})]}),(0,t.jsxs)(A.Select,{value:s,onValueChange:l,children:[(0,t.jsx)(A.SelectTrigger,{children:(0,t.jsx)(A.SelectValue,{placeholder:"All transaction types"})}),(0,t.jsxs)(A.SelectContent,{children:[(0,t.jsx)(A.SelectItem,{value:"all",children:"All Types"}),(0,t.jsx)(A.SelectItem,{value:"cash_in",children:"Cash In"}),(0,t.jsx)(A.SelectItem,{value:"cash_out",children:"Cash Out"}),(0,t.jsx)(A.SelectItem,{value:"transfer_in",children:"Transfer In"}),(0,t.jsx)(A.SelectItem,{value:"transfer_out",children:"Transfer Out"})]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(f.Button,{variant:"outline",size:"sm",onClick:r,className:"flex-1 sm:flex-none",children:[(0,t.jsx)(o.Download,{className:"h-4 w-4 mr-2"}),"CSV"]}),(0,t.jsxs)(f.Button,{variant:"outline",size:"sm",onClick:n,className:"flex-1 sm:flex-none",children:[(0,t.jsx)(F.FileText,{className:"h-4 w-4 mr-2"}),"PDF"]})]})]}),(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:[i," transaction",1!==i?"s":""," found"]})]});var Z=e.i(777624),Q=e.i(392401);let ee=({transactions:e,accountId:s,showAccountColumn:r=!0,onEditTransaction:n,onViewTransaction:c,onTransactionDeleted:o})=>{let{deleteTransaction:d,transactions:m}=(0,v.useCashTransactions)(s||void 0),{accounts:h}=(0,N.useCashAccounts)(),{settings:x}=(0,w.useBusinessSettings)(),{hasPermission:u}=(0,Z.useProfiles)(),{canManageFinanceAccounts:p}=(0,Q.useFinancialVisibility)(),[g,j]=(0,a.useState)(null),y=(0,C.useIsMobile)(),b=u("finance","edit"),T=u("finance","delete"),[S,k]=(0,l.useSearchParams)(),[D,I]=(0,a.useState)(()=>S.get("search")||""),[M,A]=(0,a.useState)(()=>S.get("type")||"all");(0,a.useEffect)(()=>{let e=S.get("search")||"",t=S.get("type")||"all";I(e),A(t)},[S]);let F=e=>(0,X.formatCashAmount)(e,x.currency||"USD"),P=e=>{if(!e)return"Unknown Account";let t=h.find(t=>t.id===e);return t?.name||"Unknown Account"},E=e.filter(e=>{let t=e.description.toLowerCase().includes(D.toLowerCase())||e.category&&e.category.toLowerCase().includes(D.toLowerCase())||e.personInCharge&&e.personInCharge.toLowerCase().includes(D.toLowerCase())||P(e.accountId).toLowerCase().includes(D.toLowerCase()),a="all"===M||e.transactionType===M;return t&&a}),[O,_]=(0,a.useState)(1),L=Math.ceil(E.length/50),R=(O-1)*50,z=R+50,V=E.slice(R,z);(0,a.useEffect)(()=>{_(1)},[D,M]);let H=e=>{switch(e){case"cash_in":return"bg-green-100 text-green-800 border-green-200";case"cash_out":return"bg-red-100 text-red-800 border-red-200";case"transfer_in":return"bg-blue-100 text-blue-800 border-blue-200";case"transfer_out":return"bg-orange-100 text-orange-800 border-orange-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},G=e=>{switch(e){case"cash_in":return"Cash In";case"cash_out":return"Cash Out";case"transfer_in":return"Transfer In";case"transfer_out":return"Transfer Out";default:return e}},ee=e=>{switch(e){case"cash_in":case"transfer_in":return"text-green-600 font-semibold";case"cash_out":case"transfer_out":return"text-red-600 font-semibold";default:return"font-semibold"}},et=async e=>{j(e);try{await d(e)&&o&&o()}catch(e){console.error("Error deleting transaction:",e)}finally{j(null)}},ea=async()=>{if(0===E.length)return void alert("No transactions to export");try{let e="";if(s){let t=h.find(e=>e.id===s);e=t?.name||""}let t=((e,t)=>{if(0===e.length)return 0;let a=new Date(e.reduce((e,t)=>t.date<e?t.date:e,e[0].date));a.setDate(a.getDate()-1);let s=a.toISOString().split("T")[0],l=m.filter(e=>e.date.toISOString().split("T")[0]<=s);t&&(l=l.filter(e=>e.accountId===t));let r=l.filter(e=>"cash_in"===e.transactionType||"transfer_in"===e.transactionType).reduce((e,t)=>e+t.amount,0),n=l.filter(e=>"cash_out"===e.transactionType||"transfer_out"===e.transactionType).reduce((e,t)=>e+t.amount,0),i=0;if(t){let e=h.find(e=>e.id===t);i=e?.openingBalance||0}return i+r-n})(E,s||void 0),a=(e=>{if(0===e.length)return;let t=e.map(e=>e.date);return{from:new Date(Math.min(...t.map(e=>e.getTime()))),to:new Date(Math.max(...t.map(e=>e.getTime())))}})(E);((e,t,a,s,l=0,r="USD",n,i)=>{let c;if(0===e.length)return alert("No transactions to export");let o=[...e].sort((e,t)=>{let a=t.date.getTime()-e.date.getTime();return 0!==a?a:t.createdAt.getTime()-e.createdAt.getTime()}),d=[...e].sort((e,t)=>{let a=e.date.getTime()-t.date.getTime();return 0!==a?a:e.createdAt.getTime()-t.createdAt.getTime()}),m=d.filter(e=>"cash_in"===e.transactionType).reduce((e,t)=>e+t.amount,0),h=d.filter(e=>"cash_out"===e.transactionType).reduce((e,t)=>e+t.amount,0),x=d.filter(e=>"transfer_in"===e.transactionType).reduce((e,t)=>e+t.amount,0),u=d.filter(e=>"transfer_out"===e.transactionType).reduce((e,t)=>e+t.amount,0),p=l,g=new Map;d.forEach(e=>{"cash_in"===e.transactionType?p+=e.amount:"cash_out"===e.transactionType?p-=e.amount:"transfer_in"===e.transactionType?p+=e.amount:"transfer_out"===e.transactionType&&(p-=e.amount),g.set(e.id,p)});let j=o.map(e=>({...e,balance:g.get(e.id)||0,formattedType:(e=>{switch(e){case"cash_in":return"Cash In";case"cash_out":return"Cash Out";case"transfer_in":return"Transfer In";case"transfer_out":return"Transfer Out";default:return e}})(e.transactionType)})),f=p,y=new J.default({orientation:"portrait",unit:"mm",format:"a4",compress:!0}),b=y.internal.pageSize.getWidth(),N=y.internal.pageSize.getHeight(),v=b-15-15,w=15,C=()=>{y.setFontSize(8),y.setFont("helvetica","normal"),y.setTextColor(150,150,150),y.text("Created By Gonza Systems",b/2,N-10,{align:"center"}),y.setTextColor(0,0,0)},T=[30,55,35,30,30],S=["Date","Description","Transaction Type","Amount","Balance"],k=()=>{y.setFillColor(243,244,246),y.rect(15,w-2,v,10,"F"),y.setLineWidth(.3),y.rect(15,w-2,v,10),y.setFontSize(11),y.setFont("helvetica","bold");let e=15;S.forEach((t,a)=>{let s=T[a],l=y.getTextWidth(t),r=e+(s-l)/2;y.text(t,r,w+6),a<S.length-1&&y.line(e+s,w-2,e+s,w+10-2),e+=s}),w+=10},D=e=>w+e>N-15-15&&(C(),y.addPage(),w=15,k(),y.setFont("helvetica","normal"),y.setFontSize(9),!0),I=w;i&&(y.setFontSize(12),y.setFont("helvetica","bold"),y.text(i.businessName,15,w),w+=6,y.setFontSize(9),y.setFont("helvetica","normal"),y.text(i.businessAddress,15,w),w+=5,y.text(i.businessPhone,15,w),w+=5,y.text(i.businessEmail,15,w)),w=I,y.setFontSize(18),y.setFont("helvetica","bold");let M=`Cash Transactions Report (${r})`,A=y.getTextWidth(M);if(y.text(M,b-15-A,w),w+=8,s){y.setFontSize(14),y.setFont("helvetica","normal");let e=y.getTextWidth(s);y.text(s,b-15-e,w),w+=6}if(n?.from&&n?.to){y.setFontSize(12),y.setFont("helvetica","normal");let e=(0,$.format)(n.from,"dd/MM/yyyy"),t=(0,$.format)(n.to,"dd/MM/yyyy"),a=e===t?e:`${e} - ${t}`,s=y.getTextWidth(a);y.text(a,b-15-s,w),w+=12}else{let t;if(y.setFontSize(12),y.setFont("helvetica","normal"),e.length>0){let a=e.map(e=>e.date),s=new Date(Math.min(...a.map(e=>e.getTime()))),l=new Date(Math.max(...a.map(e=>e.getTime()))),r=(0,$.format)(s,"dd/MM/yyyy"),n=(0,$.format)(l,"dd/MM/yyyy");t=r===n?r:`${r} - ${n}`}else t=(0,$.format)(new Date,"dd/MM/yyyy");let a=y.getTextWidth(t);y.text(t,b-15-a,w),w+=12}w=Math.max(w,I+25),D(20),k(),y.setFont("helvetica","normal"),y.setFontSize(9);let B=new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0});j.forEach((e,t)=>{D(13);let a="cash_out"===e.transactionType||"transfer_out"===e.transactionType?-e.amount:e.amount,s=[(0,$.format)(e.date,"dd/MM/yyyy"),e.description,e.formattedType,B.format(a),B.format(e.balance)];t%2==0&&(y.setFillColor(249,250,251),y.rect(15,w-1,v,8,"F")),y.setLineWidth(.1),y.rect(15,w-1,v,8);let l=15;s.forEach((e,t)=>{let a=T[t],r=e;if(1===t)for(;y.getTextWidth(r)>a-4&&r.length>3;)r=r.substring(0,r.length-4)+"...";else if(3===t||4===t){let e=9;for(y.setFontSize(e);y.getTextWidth(r)>a-4&&e>6;)e-=.5,y.setFontSize(e)}let n=l+2;if(3===t||4===t){let e=y.getTextWidth(r);n=l+a-e-2}y.setTextColor(0,0,0),y.text(r,n,w+5),y.setFontSize(9),t<s.length-1&&y.line(l+a,w-1,l+a,w+8-1),l+=a}),w+=8}),w+=10,D(35),y.setFontSize(16),y.setFont("helvetica","bold"),y.text("Summary",15,w),w+=8;let F=.9*v;y.setFillColor(248,249,250),y.rect(15,w-3,F,30,"F"),y.setLineWidth(.3),y.setDrawColor(200,200,200),y.rect(15,w-3,F,30),y.setFontSize(11),y.setFont("helvetica","normal");let P=[["Opening Balance:",B.format(l)],["Total Cash In:",B.format(m)],["Total Cash Out:",B.format(h)],["Final Balance:",B.format(f)]],E=[["Total Transfer In:",B.format(x)],["Total Transfer Out:",B.format(u)]],O=w+3,_=25,L=15+F/2+10;P.forEach(([e,t])=>{y.setFont("helvetica","bold"),y.text(e,_,O),y.setFont("helvetica","normal");let a=y.getTextWidth(e);y.text(t,_+a+5,O),O+=6}),O=w+3,E.forEach(([e,t])=>{y.setFont("helvetica","bold"),y.text(e,L,O),y.setFont("helvetica","normal");let a=y.getTextWidth(e);y.text(t,L+a+5,O),O+=6}),C();let R=s?s.replace(/[^a-z0-9]/gi,"-").toLowerCase()+"-":"";if(n?.from&&n?.to){let e=(0,$.format)(n.from,"yyyy-MM-dd"),t=(0,$.format)(n.to,"yyyy-MM-dd");c=e===t?`cash-transactions-${R}${e}.pdf`:`cash-transactions-${R}${e}_to_${t}.pdf`}else c=`cash-transactions-${R}${(0,$.format)(new Date,"yyyy-MM-dd")}.pdf`;y.save(c)})(E,0,0,e,t,x.currency||"USD",a,{businessName:x.businessName||"Your Business Name",businessAddress:x.businessAddress||"Your Business Address",businessPhone:x.businessPhone||"(123) 456-7890",businessEmail:x.businessEmail||"support@yourbusiness.com"})}catch(e){console.error("Error exporting PDF:",e),alert("Failed to export PDF. Please try again.")}};return 0===e.length?(0,t.jsx)("div",{className:"text-center py-8 text-gray-500",children:(0,t.jsx)("p",{children:"No transactions found."})}):(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(Y,{searchTerm:D,onSearchChange:e=>{I(e);let t=new URLSearchParams(S);e?t.set("search",e):t.delete("search"),k(t)},transactionTypeFilter:M,onTransactionTypeFilterChange:e=>{A(e);let t=new URLSearchParams(S);e&&"all"!==e?t.set("type",e):t.delete("type"),k(t)},onExportCSV:()=>{0===E.length?alert("No transactions to export"):((e,t,a,s="USD")=>{if(0===e.length)return alert("No transactions to export");let l=new Blob([[["Date","Type","Account","Description","Category","Person in Charge","Amount","Payment Method"],...e.map(e=>[(0,$.format)(e.date,"yyyy-MM-dd"),e.transactionType.replace("_"," "),t(e.accountId),`"${e.description.replace(/"/g,'""')}"`,e.category,e.personInCharge||"",e.amount.toString(),e.paymentMethod||""])].map(e=>e.join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a");if(void 0!==r.download){let e=URL.createObjectURL(l);r.setAttribute("href",e),r.setAttribute("download",`cash-transactions-${s}-${(0,$.format)(new Date,"yyyy-MM-dd")}.csv`),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)}})(E,P,0)},onExportPDF:ea,totalTransactions:E.length}),0===E.length?(0,t.jsx)("div",{className:"text-center py-8 text-gray-500",children:(0,t.jsx)("p",{children:"No transactions found matching your filters."})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center text-sm text-muted-foreground",children:[(0,t.jsxs)("span",{children:["Showing ",R+1,"-",Math.min(z,E.length)," of ",E.length," transactions"]}),L>1&&(0,t.jsxs)("span",{children:["Page ",O," of ",L]})]}),y?(0,t.jsx)("div",{className:"space-y-4",children:V.map(e=>(0,t.jsxs)("div",{className:"bg-white rounded-lg border p-4 space-y-3",children:[(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("div",{className:"font-medium text-sm",children:e.description}),(0,t.jsxs)("div",{className:"text-xs text-gray-500",children:[(0,$.format)(e.date,"MMM d, yyyy"),e.personInCharge&&` • ${e.personInCharge}`]})]}),(0,t.jsx)(U.Badge,{className:`text-xs ${H(e.transactionType)}`,children:G(e.transactionType)})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:`text-lg ${ee(e.transactionType)}`,children:p?F(e.amount):"•••"}),(0,t.jsxs)("div",{className:"flex gap-1",children:[c&&(0,t.jsx)(f.Button,{variant:"ghost",size:"sm",onClick:()=>c(e),className:"h-8 w-8 p-0",children:(0,t.jsx)(B.Eye,{className:"h-4 w-4"})}),n&&b&&(0,t.jsx)(f.Button,{variant:"ghost",size:"sm",onClick:()=>n(e),className:"h-8 w-8 p-0",children:(0,t.jsx)(i.Edit,{className:"h-4 w-4"})}),T&&(0,t.jsxs)(K.AlertDialog,{children:[(0,t.jsx)(K.AlertDialogTrigger,{asChild:!0,children:(0,t.jsx)(f.Button,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-red-600 hover:text-red-700",disabled:g===e.id,children:(0,t.jsx)(W.Trash2,{className:"h-4 w-4"})})}),(0,t.jsxs)(K.AlertDialogContent,{children:[(0,t.jsxs)(K.AlertDialogHeader,{children:[(0,t.jsx)(K.AlertDialogTitle,{children:"Delete Transaction"}),(0,t.jsx)(K.AlertDialogDescription,{children:"Are you sure you want to delete this transaction? This action cannot be undone."})]}),(0,t.jsxs)(K.AlertDialogFooter,{children:[(0,t.jsx)(K.AlertDialogCancel,{children:"Cancel"}),(0,t.jsx)(K.AlertDialogAction,{onClick:()=>et(e.id),className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})]})]}),(0,t.jsxs)("div",{className:"space-y-1 text-sm text-gray-600",children:[r&&(0,t.jsxs)("div",{children:["Account: ",P(e.accountId)]}),e.category&&(0,t.jsx)("div",{className:"bg-blue-50 px-2 py-1 rounded-md border border-blue-200",children:(0,t.jsxs)("span",{className:"text-blue-800 font-medium",children:["Category: ",e.category]})}),e.paymentMethod&&(0,t.jsxs)("div",{children:["Payment: ",e.paymentMethod]}),e.tags&&e.tags.length>0&&(0,t.jsx)("div",{className:"flex flex-wrap gap-1 mt-2",children:e.tags.map((e,a)=>(0,t.jsx)(U.Badge,{variant:"secondary",className:"text-xs",children:e},a))})]})]},e.id))}):(0,t.jsx)("div",{className:"rounded-md border",children:(0,t.jsxs)(q.Table,{children:[(0,t.jsx)(q.TableHeader,{children:(0,t.jsxs)(q.TableRow,{children:[(0,t.jsx)(q.TableHead,{children:"Date"}),(0,t.jsx)(q.TableHead,{children:"Description"}),(0,t.jsx)(q.TableHead,{children:"Type"}),(0,t.jsx)(q.TableHead,{className:"text-right",children:"Amount"}),(0,t.jsx)(q.TableHead,{children:"Category"}),r&&(0,t.jsx)(q.TableHead,{children:"Account"}),(0,t.jsx)(q.TableHead,{children:"Person in Charge"}),(0,t.jsx)(q.TableHead,{children:"Payment Method"}),(0,t.jsx)(q.TableHead,{children:"Tags"}),(0,t.jsx)(q.TableHead,{className:"text-right",children:"Actions"})]})}),(0,t.jsx)(q.TableBody,{children:V.map(e=>(0,t.jsxs)(q.TableRow,{children:[(0,t.jsx)(q.TableCell,{className:"font-medium",children:(0,$.format)(e.date,"MMM d, yyyy")}),(0,t.jsx)(q.TableCell,{children:e.description}),(0,t.jsx)(q.TableCell,{children:(0,t.jsx)(U.Badge,{className:H(e.transactionType),children:G(e.transactionType)})}),(0,t.jsx)(q.TableCell,{className:`text-right ${ee(e.transactionType)}`,children:p?F(e.amount):"•••"}),(0,t.jsx)(q.TableCell,{children:e.category?(0,t.jsx)("div",{className:"bg-blue-50 px-2 py-1 rounded-md border border-blue-200 inline-block",children:(0,t.jsx)("span",{className:"text-blue-800 font-medium",children:e.category})}):"-"}),r&&(0,t.jsx)(q.TableCell,{children:P(e.accountId)}),(0,t.jsx)(q.TableCell,{children:e.personInCharge||"-"}),(0,t.jsx)(q.TableCell,{children:e.paymentMethod||"-"}),(0,t.jsx)(q.TableCell,{children:e.tags&&e.tags.length>0?(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:e.tags.map((e,a)=>(0,t.jsx)(U.Badge,{variant:"secondary",className:"text-xs",children:e},a))}):"-"}),(0,t.jsx)(q.TableCell,{className:"text-right",children:(0,t.jsxs)("div",{className:"flex gap-1 justify-end",children:[c&&(0,t.jsx)(f.Button,{variant:"ghost",size:"sm",onClick:()=>c(e),className:"h-8 w-8 p-0",children:(0,t.jsx)(B.Eye,{className:"h-4 w-4"})}),n&&u("finance","edit")&&(0,t.jsx)(f.Button,{variant:"ghost",size:"sm",onClick:()=>n(e),className:"h-8 w-8 p-0",children:(0,t.jsx)(i.Edit,{className:"h-4 w-4"})}),u("finance","delete")&&(0,t.jsxs)(K.AlertDialog,{children:[(0,t.jsx)(K.AlertDialogTrigger,{asChild:!0,children:(0,t.jsx)(f.Button,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-red-600 hover:text-red-700",disabled:g===e.id,children:(0,t.jsx)(W.Trash2,{className:"h-4 w-4"})})}),(0,t.jsxs)(K.AlertDialogContent,{children:[(0,t.jsxs)(K.AlertDialogHeader,{children:[(0,t.jsx)(K.AlertDialogTitle,{children:"Delete Transaction"}),(0,t.jsx)(K.AlertDialogDescription,{children:"Are you sure you want to delete this transaction? This action cannot be undone."})]}),(0,t.jsxs)(K.AlertDialogFooter,{children:[(0,t.jsx)(K.AlertDialogCancel,{children:"Cancel"}),(0,t.jsx)(K.AlertDialogAction,{onClick:()=>et(e.id),className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})]})})]},e.id))})]})}),L>1&&(0,t.jsxs)("div",{className:"flex justify-center items-center space-x-2 mt-6",children:[(0,t.jsx)(f.Button,{variant:"outline",size:"sm",onClick:()=>_(e=>Math.max(e-1,1)),disabled:1===O,children:"Previous"}),(0,t.jsx)("div",{className:"flex space-x-1",children:Array.from({length:Math.min(5,L)},(e,a)=>{let s;return s=L<=5||O<=3?a+1:O>=L-2?L-4+a:O-2+a,(0,t.jsx)(f.Button,{variant:O===s?"default":"outline",size:"sm",onClick:()=>_(s),className:"w-8 h-8 p-0",children:s},s)})}),(0,t.jsx)(f.Button,{variant:"outline",size:"sm",onClick:()=>_(e=>Math.min(e+1,L)),disabled:O===L,children:"Next"})]})]})]})};var et=e.i(614522),ea=e.i(707935),es=e.i(608199),el=e.i(39978);let er=(0,x.default)("CalendarDays",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);var en=e.i(25652),ei=e.i(635408);let ec=({accountId:e})=>{let[s,r]=(0,l.useSearchParams)(),[n,i]=(0,a.useState)(()=>{let e=s.get("summaryPeriod");return e&&["daily","weekly","monthly","custom"].includes(e)?e:"daily"}),[c,o]=(0,a.useState)(()=>{let e=s.get("summaryDate");return e?new Date(e):new Date}),[d,m]=(0,a.useState)(()=>{let e=s.get("summaryStartDate");return e?new Date(e):new Date}),[h,x]=(0,a.useState)(()=>{let e=s.get("summaryEndDate");return e?new Date(e):new Date});(0,a.useEffect)(()=>{let e=s.get("summaryPeriod"),t=s.get("summaryDate"),a=s.get("summaryStartDate"),l=s.get("summaryEndDate");e&&["daily","weekly","monthly","custom"].includes(e)?i(e):i("daily"),t&&o(new Date(t)),a&&m(new Date(a)),l&&x(new Date(l))},[s]);let[p,g]=(0,a.useState)(!1),[j,b]=(0,a.useState)(!1),[T,S]=(0,a.useState)(null),[k,M]=(0,a.useState)(null),[B,F]=(0,a.useState)({date:new Date,openingBalance:0,cashIn:0,cashOut:0,transfersIn:0,transfersOut:0,closingBalance:0}),{getDailySummary:P,getDateRangeSummary:E,transactions:O,updateTransaction:_,refreshTransactions:L}=(0,v.useCashTransactions)(e),{accounts:z,refreshAccounts:U}=(0,N.useCashAccounts)(),{settings:H}=(0,w.useBusinessSettings)();(0,C.useIsMobile)();let{canManageFinanceAccounts:W}=(0,Q.useFinancialVisibility)(),q=(0,a.useCallback)(e=>(0,X.formatCashAmount)(e,H.currency||"USD"),[H.currency]),K=e=>{o(e);let t=new URLSearchParams(s),a=(0,$.format)(e,"yyyy-MM-dd");a!==(0,$.format)(new Date,"yyyy-MM-dd")?t.set("summaryDate",a):t.delete("summaryDate"),r(t)},J=e=>{m(e);let t=new URLSearchParams(s);t.set("summaryPeriod","custom"),t.set("summaryStartDate",(0,$.format)(e,"yyyy-MM-dd")),r(t)},G=e=>{x(e);let t=new URLSearchParams(s);t.set("summaryPeriod","custom"),t.set("summaryEndDate",(0,$.format)(e,"yyyy-MM-dd")),r(t)},Y=(0,a.useCallback)(e=>{K(new Date(e.target.value))},[]),Z=(0,a.useCallback)(e=>{J(new Date(e.target.value))},[]),ec=(0,a.useCallback)(e=>{G(new Date(e.target.value))},[]),eo=(0,a.useCallback)(()=>{let e=new Date;K(e),J(e),G(e)},[]),ed=(0,a.useMemo)(()=>{switch(n){case"weekly":return{start:(0,et.startOfWeek)(c,{weekStartsOn:1}),end:(0,ea.endOfWeek)(c,{weekStartsOn:1})};case"monthly":return{start:(0,es.startOfMonth)(c),end:(0,el.endOfMonth)(c)};case"custom":return{start:d,end:h};default:return{start:c,end:c}}},[n,c,d,h]),em=(0,a.useCallback)(async()=>{try{let t;if("daily"===n)t=await P(c,e);else{let{start:a,end:s}=ed;t=await E(a,s,e)}F(t)}catch(e){console.error("Error loading summary:",e)}},[n,c,ed,e,P,E]);(0,a.useEffect)(()=>{let e;return e=setTimeout(async()=>{await em()},100),()=>{e&&clearTimeout(e)}},[em,O]);let eh=(0,a.useMemo)(()=>{let{start:t,end:a}=ed,s=t.toISOString().split("T")[0],l=a.toISOString().split("T")[0],r=O.filter(e=>{let t=e.date.toISOString().split("T")[0];return t>=s&&t<=l});return e&&(r=r.filter(t=>t.accountId===e)),r},[O,ed,e]),ex=(0,a.useCallback)(e=>{S(e),g(!0)},[]),eu=(0,a.useCallback)(e=>{M(e),b(!0)},[]),ep=(0,a.useCallback)(async(e,t)=>{try{await _(e,t),b(!1),M(null),await Promise.all([L(),U()]),await em()}catch(e){console.error("Error updating transaction:",e)}},[_,L,U,em]),eg=(0,a.useCallback)(async()=>{try{await Promise.all([L(),U()]),await em(),console.log("Successfully refreshed data after transaction deletion")}catch(e){console.error("Error refreshing data after transaction deletion:",e)}},[L,U,em]),ej=(0,a.useMemo)(()=>{let{start:e,end:t}=ed;switch(n){case"weekly":return`Week of ${(0,$.format)(e,"MMM d")} - ${(0,$.format)(t,"MMM d, yyyy")}`;case"monthly":return(0,$.format)(c,"MMMM yyyy");case"custom":return`${(0,$.format)(e,"MMM d")} - ${(0,$.format)(t,"MMM d, yyyy")}`;default:return(0,$.format)(c,"MMMM d, yyyy")}},[ed,n,c]);return(0,t.jsxs)("div",{className:"space-y-4 md:space-y-6",children:[(0,t.jsxs)(y.Card,{children:[(0,t.jsx)(y.CardHeader,{className:"pb-3 md:pb-6",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)(y.CardTitle,{className:"flex items-center gap-2 text-lg md:text-xl",children:[(0,t.jsx)(er,{className:"h-5 w-5"}),(0,t.jsx)("span",{className:"break-words",children:"Cash Summary"})]}),(0,t.jsx)("div",{className:"text-sm md:text-base font-medium text-muted-foreground",children:ej}),(0,t.jsx)("div",{className:"space-y-3",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)(I.Label,{htmlFor:"period",className:"text-xs font-medium",children:"Period"}),(0,t.jsxs)(A.Select,{value:n,onValueChange:e=>{i(e);let t=new URLSearchParams(s);"daily"!==e?t.set("summaryPeriod",e):t.delete("summaryPeriod"),r(t)},children:[(0,t.jsx)(A.SelectTrigger,{className:"h-9 text-sm",children:(0,t.jsx)(A.SelectValue,{})}),(0,t.jsxs)(A.SelectContent,{children:[(0,t.jsx)(A.SelectItem,{value:"daily",children:"Daily"}),(0,t.jsx)(A.SelectItem,{value:"weekly",children:"Weekly"}),(0,t.jsx)(A.SelectItem,{value:"monthly",children:"Monthly"}),(0,t.jsx)(A.SelectItem,{value:"custom",children:"Custom Range"})]})]})]}),"custom"===n?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)(I.Label,{htmlFor:"startDate",className:"text-xs font-medium",children:"Start Date"}),(0,t.jsx)(D.Input,{id:"startDate",type:"date",value:(0,$.format)(d,"yyyy-MM-dd"),onChange:Z,className:"h-9 text-sm"})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)(I.Label,{htmlFor:"endDate",className:"text-xs font-medium",children:"End Date"}),(0,t.jsx)(D.Input,{id:"endDate",type:"date",value:(0,$.format)(h,"yyyy-MM-dd"),onChange:ec,className:"h-9 text-sm"})]})]}):(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)(I.Label,{htmlFor:"date",className:"text-xs font-medium",children:"Date"}),(0,t.jsx)(D.Input,{id:"date",type:"date",value:(0,$.format)(c,"yyyy-MM-dd"),onChange:Y,className:"h-9 text-sm"})]}),(0,t.jsx)("div",{className:"flex items-end",children:(0,t.jsx)(f.Button,{variant:"outline",size:"sm",onClick:eo,className:"h-9 text-sm",children:"Today"})})]})})]})}),(0,t.jsxs)(y.CardContent,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-3 md:gap-4",children:[(0,t.jsxs)("div",{className:"space-y-3 p-5 md:p-6 bg-muted/50 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs md:text-sm text-muted-foreground",children:[(0,t.jsx)(en.TrendingUp,{className:"h-4 w-4 md:h-5 md:w-5"}),(0,t.jsx)("span",{className:"font-medium",children:"Opening"})]}),(0,t.jsx)("div",{className:"text-lg md:text-xl font-semibold break-all leading-tight",children:W?q(B.openingBalance):"•••"})]}),(0,t.jsxs)("div",{className:"space-y-3 p-5 md:p-6 bg-green-50 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs md:text-sm text-green-600",children:[(0,t.jsx)(en.TrendingUp,{className:"h-4 w-4 md:h-5 md:w-5"}),(0,t.jsx)("span",{className:"font-medium",children:"Cash In"})]}),(0,t.jsx)("div",{className:"text-lg md:text-xl font-semibold text-green-600 break-all leading-tight",children:W?q(B.cashIn):"•••"})]}),(0,t.jsxs)("div",{className:"space-y-3 p-5 md:p-6 bg-red-50 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs md:text-sm text-red-600",children:[(0,t.jsx)(ei.TrendingDown,{className:"h-4 w-4 md:h-5 md:w-5"}),(0,t.jsx)("span",{className:"font-medium",children:"Cash Out"})]}),(0,t.jsx)("div",{className:"text-lg md:text-xl font-semibold text-red-600 break-all leading-tight",children:W?q(B.cashOut):"•••"})]}),(0,t.jsxs)("div",{className:"space-y-3 p-5 md:p-6 bg-blue-50 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs md:text-sm text-blue-600",children:[(0,t.jsx)(u,{className:"h-4 w-4 md:h-5 md:w-5"}),(0,t.jsx)("span",{className:"font-medium",children:"Transfer In"})]}),(0,t.jsx)("div",{className:"text-lg md:text-xl font-semibold text-blue-600 break-all leading-tight",children:W?q(B.transfersIn):"•••"})]}),(0,t.jsxs)("div",{className:"space-y-3 p-5 md:p-6 bg-orange-50 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs md:text-sm text-orange-600",children:[(0,t.jsx)(u,{className:"h-4 w-4 md:h-5 md:w-5"}),(0,t.jsx)("span",{className:"font-medium",children:"Transfer Out"})]}),(0,t.jsx)("div",{className:"text-lg md:text-xl font-semibold text-orange-600 break-all leading-tight",children:W?q(B.transfersOut):"•••"})]}),(0,t.jsxs)("div",{className:"space-y-3 p-5 md:p-6 bg-slate-50 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs md:text-sm text-muted-foreground",children:[(0,t.jsx)(en.TrendingUp,{className:"h-4 w-4 md:h-5 md:w-5"}),(0,t.jsx)("span",{className:"font-medium",children:"Closing"})]}),(0,t.jsx)("div",{className:"text-lg md:text-xl font-semibold break-all leading-tight",children:W?q(B.closingBalance):"•••"})]})]}),(0,t.jsx)("div",{className:"pt-3 md:pt-4 border-t",children:(0,t.jsxs)("div",{className:"text-sm md:text-base text-muted-foreground",children:["Net Change:",(0,t.jsx)("span",{className:`ml-1 font-semibold break-all ${B.closingBalance-B.openingBalance>=0?"text-green-600":"text-red-600"}`,children:W?q(B.closingBalance-B.openingBalance):"•••"})]})})]})]}),(0,t.jsxs)(y.Card,{children:[(0,t.jsx)(y.CardHeader,{className:"pb-3 md:pb-6",children:(0,t.jsxs)(y.CardTitle,{className:"text-lg md:text-xl",children:[(0,t.jsx)("span",{className:"break-words",children:"Transactions"}),(0,t.jsxs)("span",{className:"text-sm font-normal text-muted-foreground ml-2",children:["(",eh.length," transaction",1!==eh.length?"s":"",")"]})]})}),(0,t.jsx)(y.CardContent,{className:"px-3 md:px-6",children:(0,t.jsx)(ee,{transactions:eh,accountId:e,showAccountColumn:!e,onViewTransaction:ex,onEditTransaction:eu,onTransactionDeleted:eg})})]}),(0,t.jsx)(V,{open:p,onOpenChange:g,transaction:T}),(0,t.jsx)(R,{open:j,onOpenChange:b,onSubmit:ep,transaction:k,accounts:z})]})};var eo=e.i(227766),ed=e.i(337822),em=e.i(87316),eh=e.i(975558),ex=e.i(425063),eu=e.i(356909),ep=e.i(952571),eg=e.i(102594),ej=e.i(929592);let ef="bulk_transactions_draft",ey=({className:e})=>(0,t.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,children:[(0,t.jsx)("path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4"}),(0,t.jsx)("path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5"}),(0,t.jsx)("path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z"})]}),eb=({open:e,onOpenChange:s,accountId:l,onSuccess:n})=>{let i=(0,C.useIsMobile)(),{user:c}=(0,eg.useAuth)(),{accounts:o}=(0,N.useCashAccounts)(),{createBulkTransactions:d}=(0,v.useCashTransactions)(l),[m,h]=(0,a.useState)([]),[x,u]=(0,a.useState)(new Date),[p,g]=(0,a.useState)(!1);(0,a.useEffect)(()=>{if(!e)return;let t=localStorage.getItem(ef);if(t)try{let e=JSON.parse(t);h(e.map(e=>({...e,date:new Date(e.date)})))}catch(e){console.error("Failed to parse draft",e),j()}else h([]),j()},[e]),(0,a.useEffect)(()=>{m.length>0?localStorage.setItem(ef,JSON.stringify(m)):localStorage.removeItem(ef)},[m]);let j=()=>{let e={id:Math.random().toString(36).substr(2,9),accountId:l,amount:0,transactionType:"cash_in",description:"",category:"Other",paymentMethod:"Cash",personInCharge:"",tags:[],date:x,receiptImage:""};h(t=>[...t,e])},b=e=>{h(t=>t.filter(t=>t.id!==e)),1===m.length&&j()},w=(e,t)=>{h(a=>a.map(a=>a.id===e?{...a,...t}:a))},T=(e,t)=>{let a=m.findIndex(t=>t.id===e);if(a<0||"up"===t&&0===a||"down"===t&&a===m.length-1)return;let s=[...m],l="up"===t?a-1:a+1;[s[a],s[l]]=[s[l],s[a]],h(s)},k=async()=>{let e=m.filter(e=>e.amount>0&&""!==e.description.trim());if(0===e.length)return void alert("Please enter at least one valid transaction with amount and description");if(e.filter(e=>"transfer"===e.transactionType&&!e.toAccountId).length>0)return void alert("Please select a destination account for all transfers");g(!0);try{await d(e.map(({id:e,...t})=>({...t}))),localStorage.removeItem(ef),n()}catch(e){console.error("Bulk save failed",e),alert("Failed to save transactions. Please check your network connection.")}finally{g(!1)}};return(0,t.jsx)(S.Dialog,{open:e,onOpenChange:e=>!p&&s(e),children:(0,t.jsxs)(S.DialogContent,{className:"max-w-6xl w-[95vw] h-[95vh] sm:h-[90vh] flex flex-col p-0 overflow-hidden shadow-2xl border-none",children:[(0,t.jsx)(S.DialogHeader,{className:"p-6 pb-2 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-slate-900 dark:to-slate-800 border-b",children:(0,t.jsx)("div",{className:"flex justify-between items-start",children:(0,t.jsxs)("div",{children:[(0,t.jsxs)(S.DialogTitle,{className:"text-xl font-bold text-slate-800 dark:text-slate-100 flex items-center gap-2",children:[(0,t.jsx)(ey,{className:"h-5 w-5 text-blue-600"}),"Bulk Transaction Entry"]}),(0,t.jsx)(S.DialogDescription,{className:"text-slate-500 dark:text-slate-400 mt-1",children:"Add multiple records at once. Each row can have its own date and details."})]})})}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto p-4 sm:p-6 space-y-6 bg-slate-50/30 dark:bg-slate-950/30",children:(0,t.jsxs)("div",{className:"bg-white dark:bg-slate-900 rounded-xl p-4 shadow-sm border space-y-4",children:[(0,t.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[(0,t.jsx)("div",{className:"flex items-center gap-2 text-sm text-slate-600 dark:text-slate-400",children:(0,t.jsxs)(ej.Alert,{className:"bg-blue-50/50 dark:bg-blue-900/10 border-blue-100 dark:border-blue-900 py-2",children:[(0,t.jsx)(ep.Info,{className:"h-4 w-4 text-blue-500"}),(0,t.jsxs)(ej.AlertDescription,{className:"text-[11px] sm:text-xs",children:["Use the ",(0,t.jsx)("strong",{children:"Default Date"})," to quickly set dates for newly added rows."]})]})}),(0,t.jsxs)("div",{className:"flex items-center gap-3 w-full md:w-auto",children:[(0,t.jsxs)("div",{className:"flex-1 md:flex-initial",children:[(0,t.jsx)("p",{className:"text-[10px] font-semibold text-muted-foreground uppercase mb-1 ml-1",children:"Default Date"}),(0,t.jsxs)(ed.Popover,{children:[(0,t.jsx)(ed.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)(f.Button,{variant:"outline",className:(0,X.cn)("justify-start text-left font-normal w-full md:w-[200px] h-10 shadow-sm",!x&&"text-muted-foreground"),children:[(0,t.jsx)(em.Calendar,{className:"mr-2 h-4 w-4 text-blue-500"}),x?(0,$.format)(x,"PPP"):(0,t.jsx)("span",{children:"Pick a date"})]})}),(0,t.jsx)(ed.PopoverContent,{className:"w-auto p-0 z-[80]",align:"end",children:(0,t.jsx)(eo.Calendar,{mode:"single",selected:x,onSelect:e=>e&&u(e),initialFocus:!0})})]})]}),(0,t.jsx)("div",{className:"flex items-end h-full",children:(0,t.jsxs)(f.Button,{onClick:j,variant:"secondary",className:"gap-2 h-10 font-semibold border border-slate-200 dark:border-slate-800",children:[(0,t.jsx)(r.Plus,{className:"h-4 w-4"}),"Add Row"]})})]})]}),(0,t.jsx)("div",{className:"min-h-[200px]",children:i?(0,t.jsx)("div",{className:"space-y-4 px-1",children:m.map((e,a)=>(0,t.jsxs)(y.Card,{className:"overflow-hidden border-l-4 border-l-primary/30",children:[(0,t.jsxs)(y.CardHeader,{className:"flex flex-row items-center justify-between p-3 pb-2 bg-muted/20",children:[(0,t.jsxs)(y.CardTitle,{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:["Transaction ",a+1]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(f.Button,{size:"icon",variant:"ghost",className:"h-8 w-8 text-muted-foreground",onClick:()=>T(e.id,"up"),children:(0,t.jsx)(eh.ArrowUp,{className:"h-4 w-4"})}),(0,t.jsx)(f.Button,{size:"icon",variant:"ghost",className:"h-8 w-8 text-destructive/70",onClick:()=>b(e.id),children:(0,t.jsx)(W.Trash2,{className:"h-4 w-4"})})]})]}),(0,t.jsxs)(y.CardContent,{className:"p-3 space-y-3",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsxs)(ed.Popover,{children:[(0,t.jsx)(ed.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)(f.Button,{variant:"outline",size:"sm",className:(0,X.cn)("w-full justify-start text-left font-normal h-9",!e.date&&"text-muted-foreground"),children:[(0,t.jsx)(em.Calendar,{className:"mr-2 h-3 w-3"}),(0,t.jsx)("span",{className:"truncate text-xs",children:e.date?(0,$.format)(e.date,"MMM dd, yyyy"):"Date"})]})}),(0,t.jsx)(ed.PopoverContent,{className:"w-auto p-0 z-[70]",align:"start",children:(0,t.jsx)(eo.Calendar,{mode:"single",selected:e.date,onSelect:t=>t&&w(e.id,{date:t}),initialFocus:!0})})]}),(0,t.jsxs)(A.Select,{value:e.transactionType,onValueChange:t=>w(e.id,{transactionType:t}),children:[(0,t.jsx)(A.SelectTrigger,{className:"h-9 text-xs",children:(0,t.jsx)(A.SelectValue,{})}),(0,t.jsxs)(A.SelectContent,{children:[(0,t.jsx)(A.SelectItem,{value:"cash_in",children:"Cash In"}),(0,t.jsx)(A.SelectItem,{value:"cash_out",children:"Cash Out"}),(0,t.jsx)(A.SelectItem,{value:"transfer",children:"Transfer"})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsx)(D.Input,{type:"number",placeholder:"Amount",value:e.amount||"",onChange:t=>w(e.id,{amount:Number(t.target.value)}),className:"h-9 font-medium"}),(0,t.jsxs)(A.Select,{value:e.category,onValueChange:t=>w(e.id,{category:t}),children:[(0,t.jsx)(A.SelectTrigger,{className:"h-9 text-xs",children:(0,t.jsx)(A.SelectValue,{})}),(0,t.jsxs)(A.SelectContent,{children:[(0,t.jsx)(A.SelectItem,{value:"Sales",children:"Sales"}),(0,t.jsx)(A.SelectItem,{value:"Expenses",children:"Expenses"}),(0,t.jsx)(A.SelectItem,{value:"Payroll",children:"Payroll"}),(0,t.jsx)(A.SelectItem,{value:"Other",children:"Other"})]})]})]}),"transfer"===e.transactionType&&(0,t.jsxs)(A.Select,{value:e.toAccountId,onValueChange:t=>w(e.id,{toAccountId:t}),children:[(0,t.jsx)(A.SelectTrigger,{className:"h-9 text-xs",children:(0,t.jsx)(A.SelectValue,{placeholder:"Target Account"})}),(0,t.jsx)(A.SelectContent,{children:o.filter(e=>e.id!==l).map(e=>(0,t.jsx)(A.SelectItem,{value:e.id,children:e.name},e.id))})]}),(0,t.jsx)(D.Input,{placeholder:"Description",value:e.description,onChange:t=>w(e.id,{description:t.target.value}),className:"h-9"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsx)(D.Input,{placeholder:"Payment Method",value:e.paymentMethod,onChange:t=>w(e.id,{paymentMethod:t.target.value}),className:"h-8 text-[11px]"}),(0,t.jsx)(D.Input,{placeholder:"Person In Charge",value:e.personInCharge,onChange:t=>w(e.id,{personInCharge:t.target.value}),className:"h-8 text-[11px]"})]})]})]},e.id))}):(0,t.jsx)("div",{className:"overflow-x-auto rounded-md border",children:(0,t.jsxs)(q.Table,{children:[(0,t.jsx)(q.TableHeader,{className:"bg-muted/50",children:(0,t.jsxs)(q.TableRow,{children:[(0,t.jsx)(q.TableHead,{className:"w-[140px]",children:"Date"}),(0,t.jsx)(q.TableHead,{className:"w-[130px]",children:"Type"}),(0,t.jsx)(q.TableHead,{className:"w-[130px]",children:"Amount"}),(0,t.jsx)(q.TableHead,{children:"Description"}),(0,t.jsx)(q.TableHead,{className:"w-[140px]",children:"Category"}),(0,t.jsx)(q.TableHead,{className:"w-[150px]",children:"Details"}),(0,t.jsx)(q.TableHead,{className:"w-[120px] text-right",children:"Actions"})]})}),(0,t.jsx)(q.TableBody,{children:m.map(e=>(0,t.jsxs)(q.TableRow,{className:"hover:bg-muted/30 transition-colors",children:[(0,t.jsx)(q.TableCell,{children:(0,t.jsxs)(ed.Popover,{children:[(0,t.jsx)(ed.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)(f.Button,{variant:"outline",size:"sm",className:(0,X.cn)("w-full justify-start text-left font-normal h-9",!e.date&&"text-muted-foreground"),children:[(0,t.jsx)(em.Calendar,{className:"mr-2 h-3 w-3 shrink-0"}),(0,t.jsx)("span",{className:"truncate",children:e.date?(0,$.format)(e.date,"MMM dd, yyyy"):"Date"})]})}),(0,t.jsx)(ed.PopoverContent,{className:"w-auto p-0 z-[70]",align:"start",children:(0,t.jsx)(eo.Calendar,{mode:"single",selected:e.date,onSelect:t=>t&&w(e.id,{date:t}),initialFocus:!0})})]})}),(0,t.jsxs)(q.TableCell,{children:[(0,t.jsxs)(A.Select,{value:e.transactionType,onValueChange:t=>w(e.id,{transactionType:t}),children:[(0,t.jsx)(A.SelectTrigger,{className:"h-9",children:(0,t.jsx)(A.SelectValue,{})}),(0,t.jsxs)(A.SelectContent,{children:[(0,t.jsx)(A.SelectItem,{value:"cash_in",children:"Cash In"}),(0,t.jsx)(A.SelectItem,{value:"cash_out",children:"Cash Out"}),(0,t.jsx)(A.SelectItem,{value:"transfer",children:"Transfer"})]})]}),"transfer"===e.transactionType&&(0,t.jsx)("div",{className:"mt-1.5",children:(0,t.jsxs)(A.Select,{value:e.toAccountId,onValueChange:t=>w(e.id,{toAccountId:t}),children:[(0,t.jsx)(A.SelectTrigger,{className:"text-[10px] h-7 px-2",children:(0,t.jsx)(A.SelectValue,{placeholder:"To Account"})}),(0,t.jsx)(A.SelectContent,{children:o.filter(e=>e.id!==l).map(e=>(0,t.jsx)(A.SelectItem,{value:e.id,children:e.name},e.id))})]})})]}),(0,t.jsx)(q.TableCell,{children:(0,t.jsx)(D.Input,{type:"number",value:e.amount||"",onChange:t=>w(e.id,{amount:Number(t.target.value)}),className:"h-9 font-medium",placeholder:"0.00"})}),(0,t.jsx)(q.TableCell,{children:(0,t.jsx)(D.Input,{value:e.description,onChange:t=>w(e.id,{description:t.target.value}),placeholder:"Description...",className:"h-9"})}),(0,t.jsx)(q.TableCell,{children:(0,t.jsxs)(A.Select,{value:e.category,onValueChange:t=>w(e.id,{category:t}),children:[(0,t.jsx)(A.SelectTrigger,{className:"h-9",children:(0,t.jsx)(A.SelectValue,{})}),(0,t.jsxs)(A.SelectContent,{children:[(0,t.jsx)(A.SelectItem,{value:"Sales",children:"Sales"}),(0,t.jsx)(A.SelectItem,{value:"Expenses",children:"Expenses"}),(0,t.jsx)(A.SelectItem,{value:"Payroll",children:"Payroll"}),(0,t.jsx)(A.SelectItem,{value:"Other",children:"Other"})]})]})}),(0,t.jsxs)(q.TableCell,{className:"space-y-1",children:[(0,t.jsx)(D.Input,{placeholder:"Payment Method",value:e.paymentMethod,onChange:t=>w(e.id,{paymentMethod:t.target.value}),className:"text-[10px] h-7 px-1.5"}),(0,t.jsx)(D.Input,{placeholder:"Person In Charge",value:e.personInCharge,onChange:t=>w(e.id,{personInCharge:t.target.value}),className:"text-[10px] h-7 px-1.5"})]}),(0,t.jsx)(q.TableCell,{className:"text-right",children:(0,t.jsxs)("div",{className:"flex items-center justify-end gap-0.5",children:[(0,t.jsx)(f.Button,{size:"icon",variant:"ghost",className:"h-7 w-7 text-muted-foreground",onClick:()=>T(e.id,"up"),children:(0,t.jsx)(eh.ArrowUp,{className:"h-3.5 w-3.5"})}),(0,t.jsx)(f.Button,{size:"icon",variant:"ghost",className:"h-7 w-7 text-muted-foreground",onClick:()=>T(e.id,"down"),children:(0,t.jsx)(ex.ArrowDown,{className:"h-3.5 w-3.5"})}),(0,t.jsx)(f.Button,{size:"icon",variant:"ghost",className:"h-7 w-7 text-destructive/70 hover:text-destructive hover:bg-destructive/10",onClick:()=>b(e.id),children:(0,t.jsx)(W.Trash2,{className:"h-3.5 w-3.5"})})]})})]},e.id))})]})})})]})}),(0,t.jsxs)("div",{className:"flex justify-between items-center p-6 border-t bg-white dark:bg-slate-900 shrink-0",children:[(0,t.jsxs)("div",{className:"text-sm font-medium text-slate-500",children:["Total Valid: ",(0,t.jsx)("span",{className:"text-indigo-600 dark:text-indigo-400 font-bold",children:m.filter(e=>e.amount>0).length})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsxs)(f.Button,{variant:"ghost",onClick:()=>{p||s(!1)},disabled:p,className:"gap-2 hover:bg-slate-100 dark:hover:bg-slate-800",children:[(0,t.jsx)(P.X,{className:"h-4 w-4"}),"Cancel"]}),(0,t.jsxs)(f.Button,{onClick:k,disabled:p,className:"gap-2 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 shadow-md transition-all active:scale-[0.98]",children:[p?(0,t.jsx)(eu.Save,{className:"h-4 w-4 animate-spin"}):(0,t.jsx)(eu.Save,{className:"h-4 w-4"}),"Save ",m.filter(e=>e.amount>0).length," Transactions"]})]})]})]})})};var eN=e.i(168148),ev=e.i(63209),ew=e.i(269638);let eC=(0,x.default)("MoveRight",[["path",{d:"M18 8L22 12L18 16",key:"1r0oui"}],["path",{d:"M2 12H22",key:"1m8cig"}]]);var eT=e.i(70016),eS=e.i(444233);let ek=({open:e,onOpenChange:s,accountId:l,onUploadComplete:r})=>{let{createBulkTransactions:n}=(0,v.useCashTransactions)(l),{accounts:i}=(0,N.useCashAccounts)(),[d,m]=(0,a.useState)({step:"select",file:null,validRows:[],errors:[],totalRows:0,uploadProgress:0,successCount:0,failureCount:0,currentTransactionIndex:0}),h=(0,a.useRef)(null),[x,u]=(0,a.useState)(!1),[p,g]=(0,a.useState)(!1),j=e=>{let t=new Date,a=e.Date,s=a?.toString();if(s)if(a instanceof Date)t=a;else{let e=s.match(/^(\d{1,2})[/-](\d{1,2})[/-](\d{4})$/);if(e){let[,a,s,l]=e;t=new Date(parseInt(l),parseInt(s)-1,parseInt(a))}else{let e=new Date(s);isNaN(e.getTime())||(t=e)}}isNaN(t.getTime())&&(t=new Date);let r="";if(e.Type?.toLowerCase()==="transfer"&&e["To Account"]){let t=i?.find(t=>t.name.toLowerCase()===e["To Account"]?.toString().toLowerCase()&&t.id!==l);t&&(r=t.id)}return{accountId:l||"",amount:parseFloat(e.Amount?.toString().replace(/[^0-9.-]/g,"")||"0"),transactionType:e.Type?.toLowerCase()||"cash_in",toAccountId:r,category:e.Category||"Other",description:e.Description||"",paymentMethod:e["Payment Method"]||"Cash",personInCharge:e["Person In Charge"]||"",tags:[],date:t,receiptImage:""}},b=async e=>{let t,a=e.name.endsWith(".xlsx")||e.name.endsWith(".xls"),s=e.name.endsWith(".csv");if(!a&&!s)return void alert("Please select a CSV or Excel file");if(a){let a=await e.arrayBuffer(),s=eT.read(a,{cellDates:!0}),r=s.SheetNames[0],n=s.Sheets[r],c=eT.utils.sheet_to_json(n).map(e=>({Date:e.Date||"",Type:e.Type||"",Amount:e.Amount||"",Description:e.Description||"",Category:e.Category||"","Payment Method":e["Payment Method"]||"","Person In Charge":e["Person In Charge"]||"","To Account":e["To Account"]||""})),o=[],d=[];c.forEach((e,t)=>{let a=(0,eS.validateTransactionCSVRow)(e,t+2);e.Type?.toLowerCase()==="transfer"&&e["To Account"]&&(i?.find(t=>t.name.toLowerCase()===e["To Account"]?.toString().toLowerCase()&&t.id!==l)||a.push({row:t+2,field:"To Account",message:`Account "${e["To Account"]}" not found or is the current account.`})),0===a.length?o.push(e):d.push(...a)}),t={validRows:o,errors:d,totalRows:c.length}}else{let a=await e.text();t=(0,eS.parseTransactionCSV)(a);let s=[],r=[];t.validRows.forEach((e,t)=>{e.Type?.toLowerCase()==="transfer"&&e["To Account"]?i?.find(t=>t.name.toLowerCase()===e["To Account"]?.toString().toLowerCase()&&t.id!==l)?r.push(e):s.push({row:t+2,field:"To Account",message:`Account "${e["To Account"]}" not found.`}):r.push(e)}),t.errors.push(...s),t.validRows=r}m({...d,step:"preview",file:e,validRows:t.validRows,errors:t.errors,totalRows:t.totalRows})},w=async()=>{m(e=>({...e,step:"uploading",uploadProgress:0,currentTransactionIndex:0})),g(!0);let e=d.validRows.map(j);try{await n(e),m(t=>({...t,step:"complete",uploadProgress:100,successCount:e.length,failureCount:0,currentTransactionIndex:e.length}))}catch(t){console.error("Bulk upload failed:",t),m(t=>({...t,step:"complete",uploadProgress:100,successCount:0,failureCount:e.length,currentTransactionIndex:e.length}))}finally{g(!1)}};return(0,t.jsx)(S.Dialog,{open:e,onOpenChange:e=>!p&&s(e),children:(0,t.jsxs)(S.DialogContent,{className:"sm:max-w-[550px] p-0 overflow-hidden rounded-3xl border-none shadow-2xl",children:[(0,t.jsxs)(S.DialogHeader,{className:"p-8 pb-4 bg-gradient-to-b from-slate-50/50 to-white dark:from-slate-900 dark:to-slate-950",children:[(0,t.jsxs)(S.DialogTitle,{className:"flex items-center gap-3 text-2xl font-black tracking-tight text-slate-900 dark:text-slate-50",children:[(0,t.jsx)("div",{className:"bg-blue-600 p-2 rounded-xl text-white",children:(0,t.jsx)(c.Upload,{className:"h-6 w-6"})}),"Financial Importer"]}),(0,t.jsx)(S.DialogDescription,{className:"text-slate-500 dark:text-slate-400 font-medium mt-1",children:"Scale your data management by importing bulk CSV logs."})]}),(0,t.jsxs)("div",{className:"px-8 pb-8 pt-0",children:["select"===d.step&&(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:(0,X.cn)("border-4 border-dashed rounded-2xl p-10 text-center cursor-pointer transition-all duration-300",x?"border-blue-500 bg-blue-50/50 scale-[1.01] shadow-lg":"border-slate-200 dark:border-slate-800 hover:border-blue-400 hover:bg-slate-50/50 dark:hover:bg-slate-900/50"),onDrop:e=>{e.preventDefault(),u(!1);let t=e.dataTransfer.files[0];t&&b(t)},onDragOver:e=>{e.preventDefault(),u(!0)},onDragLeave:()=>{u(!1)},onClick:()=>h.current?.click(),children:[(0,t.jsx)("div",{className:"bg-blue-100 dark:bg-blue-900/30 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 animate-bounce-slow",children:(0,t.jsx)(c.Upload,{className:"h-8 w-8 text-blue-600 dark:text-blue-400"})}),(0,t.jsx)("p",{className:"text-xl font-bold text-slate-900 dark:text-slate-100 mb-2",children:"Click or Drag File to Upload"}),(0,t.jsx)("p",{className:"text-sm text-slate-500 dark:text-slate-400 max-w-xs mx-auto mb-6",children:"Select your transaction data file. **CSV** and **Excel (.xlsx, .xls)** files are supported for bulk processing."}),(0,t.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,t.jsx)("div",{className:"h-1 w-8 bg-slate-200 dark:bg-slate-800 rounded-full"}),(0,t.jsx)("span",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest",children:"Multi-Format Support"}),(0,t.jsx)("div",{className:"h-1 w-8 bg-slate-200 dark:bg-slate-800 rounded-full"})]})]}),(0,t.jsxs)("div",{className:"border rounded-xl overflow-hidden bg-white dark:bg-slate-900 shadow-sm",children:[(0,t.jsxs)("div",{className:"bg-slate-50 dark:bg-slate-800/50 px-4 py-2 border-b flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(ep.Info,{className:"h-4 w-4 text-blue-500"}),(0,t.jsx)("span",{className:"text-xs font-bold text-slate-700 dark:text-slate-300",children:"DATA FORMAT GUIDE"})]}),(0,t.jsx)("span",{className:"text-[10px] text-slate-400 font-medium",children:"Headers are required"})]}),(0,t.jsx)("div",{className:"overflow-x-auto p-0",children:(0,t.jsxs)(q.Table,{children:[(0,t.jsx)(q.TableHeader,{children:(0,t.jsxs)(q.TableRow,{className:"bg-slate-100/30 dark:bg-slate-900/30",children:[(0,t.jsx)(q.TableHead,{className:"text-[10px] uppercase h-8 py-0",children:"Date"}),(0,t.jsx)(q.TableHead,{className:"text-[10px] uppercase h-8 py-0",children:"Type"}),(0,t.jsx)(q.TableHead,{className:"text-[10px] uppercase h-8 py-0",children:"Amount"}),(0,t.jsx)(q.TableHead,{className:"text-[10px] uppercase h-8 py-0",children:"Description"}),(0,t.jsx)(q.TableHead,{className:"text-[10px] uppercase h-8 py-0",children:"Category"})]})}),(0,t.jsxs)(q.TableBody,{children:[(0,t.jsxs)(q.TableRow,{className:"h-8 py-0",children:[(0,t.jsx)(q.TableCell,{className:"text-[11px] py-1 text-slate-600 font-mono",children:"22/12/2025"}),(0,t.jsx)(q.TableCell,{className:"text-[11px] py-1 text-green-600 font-semibold italic",children:"cash_in"}),(0,t.jsx)(q.TableCell,{className:"text-[11px] py-1 text-slate-800 font-bold",children:"1500.00"}),(0,t.jsx)(q.TableCell,{className:"text-[11px] py-1 truncate max-w-[80px]",children:"Product Sale #44"}),(0,t.jsx)(q.TableCell,{className:"text-[11px] py-1",children:"Sales"})]}),(0,t.jsxs)(q.TableRow,{className:"h-8 py-0 border-none",children:[(0,t.jsx)(q.TableCell,{className:"text-[11px] py-1 text-slate-600 font-mono",children:"21/12/2025"}),(0,t.jsx)(q.TableCell,{className:"text-[11px] py-1 text-red-600 font-semibold italic",children:"cash_out"}),(0,t.jsx)(q.TableCell,{className:"text-[11px] py-1 text-slate-800 font-bold",children:"450.00"}),(0,t.jsx)(q.TableCell,{className:"text-[11px] py-1 truncate max-w-[80px]",children:"Office Supplies"}),(0,t.jsx)(q.TableCell,{className:"text-[11px] py-1",children:"Expenses"})]})]})]})}),(0,t.jsxs)("div",{className:"p-3 bg-blue-50/30 dark:bg-blue-900/10 text-[10px] text-blue-600 dark:text-blue-400 leading-relaxed border-t italic",children:[(0,t.jsx)("strong",{children:"Note:"})," Allowed types are: ",(0,t.jsx)("code",{className:"bg-blue-100 dark:bg-blue-900/30 px-1 rounded mx-0.5",children:"cash_in"}),", ",(0,t.jsx)("code",{className:"bg-blue-100 dark:bg-blue-900/30 px-1 rounded mx-0.5",children:"cash_out"}),", ",(0,t.jsx)("code",{className:"bg-blue-100 dark:bg-blue-900/30 px-1 rounded mx-0.5",children:"transfer"})]})]}),(0,t.jsx)("input",{ref:h,type:"file",accept:".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel",onChange:e=>{let t=e.target.files?.[0];t&&b(t)},className:"hidden"})]}),"preview"===d.step&&(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"bg-slate-50 dark:bg-slate-900 p-4 rounded-xl border border-slate-200 dark:border-slate-800",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,t.jsx)(F.FileText,{className:"h-5 w-5 text-blue-600"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-sm font-bold text-slate-900 dark:text-slate-100",children:d.file?.name}),(0,t.jsx)("p",{className:"text-[10px] text-slate-500",children:"File attached and analyzed"})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,t.jsx)(y.Card,{className:"shadow-none bg-emerald-50/50 dark:bg-emerald-900/10 border-emerald-100 dark:border-emerald-900/30 overflow-hidden",children:(0,t.jsxs)(y.CardContent,{className:"p-4",children:[(0,t.jsx)("div",{className:"text-2xl font-black text-emerald-600 dark:text-emerald-400",children:d.validRows.length}),(0,t.jsx)("p",{className:"text-[10px] font-bold text-emerald-700 dark:text-emerald-500 uppercase",children:"Valid Rows"})]})}),(0,t.jsx)(y.Card,{className:"shadow-none bg-rose-50/50 dark:bg-rose-900/10 border-rose-100 dark:border-rose-900/30 overflow-hidden",children:(0,t.jsxs)(y.CardContent,{className:"p-4",children:[(0,t.jsx)("div",{className:"text-2xl font-black text-rose-600 dark:text-rose-400",children:d.errors.length}),(0,t.jsx)("p",{className:"text-[10px] font-bold text-rose-700 dark:text-rose-500 uppercase",children:"Invalid"})]})}),(0,t.jsx)(y.Card,{className:"shadow-none bg-blue-50/50 dark:bg-blue-900/10 border-blue-100 dark:border-blue-900/30 overflow-hidden text-center",children:(0,t.jsxs)(y.CardContent,{className:"p-4 flex flex-col items-center justify-center",children:[(0,t.jsxs)("div",{className:"text-sm font-black text-blue-600 dark:text-blue-400 flex items-center gap-1",children:[Math.round(d.validRows.length/d.totalRows*100)||0,"%",(0,t.jsx)(eC,{className:"h-3 w-3"})]}),(0,t.jsx)("p",{className:"text-[10px] font-bold text-blue-700 dark:text-blue-500 uppercase",children:"Integrity"})]})})]})]}),d.errors.length>0&&(0,t.jsxs)(ej.Alert,{variant:"destructive",className:"bg-rose-50/50 dark:bg-rose-900/10 border-rose-200 dark:border-rose-900",children:[(0,t.jsx)(ev.AlertCircle,{className:"h-4 w-4 text-rose-600"}),(0,t.jsxs)(ej.AlertDescription,{className:"text-xs text-rose-700 dark:text-rose-400 leading-relaxed font-medium",children:["Found ",d.errors.length," rows with errors that will be skipped during the process.",(0,t.jsxs)(f.Button,{variant:"link",className:"p-0 h-auto ml-2 text-rose-700 dark:text-rose-400 underline font-bold",onClick:()=>(0,eS.generateErrorLogCSV)(d.errors,"transaction_upload_errors.csv"),children:[(0,t.jsx)(o.Download,{className:"h-3 w-3 mr-1 inline"}),"View Error Details"]})]})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)(f.Button,{variant:"ghost",className:"flex-1 hover:bg-slate-100 dark:hover:bg-slate-800",onClick:()=>m(e=>({...e,step:"select"})),children:"Choose Different File"}),(0,t.jsxs)(f.Button,{className:"flex-1 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 shadow-md font-bold transition-all active:scale-[0.98]",onClick:w,disabled:0===d.validRows.length,children:["Proceed with ",d.validRows.length," Records"]})]})]}),"uploading"===d.step&&(0,t.jsxs)("div",{className:"space-y-8 py-4",children:[(0,t.jsxs)("div",{className:"text-center space-y-2",children:[(0,t.jsxs)("div",{className:"relative w-20 h-20 mx-auto",children:[(0,t.jsx)("div",{className:"absolute inset-0 rounded-full border-4 border-slate-100 dark:border-slate-800"}),(0,t.jsx)("div",{className:"absolute inset-0 rounded-full border-4 border-t-blue-500 animate-spin"}),(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,t.jsx)(c.Upload,{className:"h-8 w-8 text-blue-500/50"})})]}),(0,t.jsx)("h3",{className:"text-lg font-bold text-slate-800 dark:text-slate-200",children:"Processing Data..."}),(0,t.jsx)("p",{className:"text-xs text-slate-500 dark:text-slate-400 italic",children:"This will only take a few moments"})]}),(0,t.jsxs)("div",{className:"space-y-2 px-4 text-center",children:[(0,t.jsx)(eN.Progress,{value:d.uploadProgress,className:"h-2 w-full bg-slate-100 dark:bg-slate-800"}),(0,t.jsxs)("span",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest",children:[Math.round(d.uploadProgress),"% Complete"]})]}),(0,t.jsxs)(ej.Alert,{className:"bg-slate-50 dark:bg-slate-900 border-slate-200 dark:border-slate-800",children:[(0,t.jsx)(ep.Info,{className:"h-4 w-4 text-slate-400"}),(0,t.jsx)(ej.AlertDescription,{className:"text-xs text-slate-500 dark:text-slate-400 font-medium",children:"We are verifying and persisting each transaction. Please keep your browser window active."})]})]}),"complete"===d.step&&(0,t.jsxs)("div",{className:"space-y-6 pt-4 text-center",children:[(0,t.jsx)("div",{className:"bg-emerald-100 dark:bg-emerald-900/30 w-20 h-20 rounded-full flex items-center justify-center mx-auto shadow-inner",children:(0,t.jsx)(ew.CheckCircle,{className:"h-10 w-10 text-emerald-600 dark:text-emerald-400"})}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("h3",{className:"text-xl font-black text-slate-900 dark:text-slate-100",children:"Synchronized Successfully!"}),(0,t.jsxs)("p",{className:"text-sm text-slate-500 dark:text-slate-400 leading-relaxed font-medium",children:["A total of ",(0,t.jsxs)("span",{className:"text-emerald-600 dark:text-emerald-400 font-bold",children:[d.successCount," transactions"]})," have been merged into the financial ledger.",d.failureCount>0&&(0,t.jsxs)("span",{className:"text-rose-500 font-bold",children:[" (",d.failureCount," entries reported issues)"]})]})]}),(0,t.jsx)(f.Button,{onClick:()=>{if(p)return;let e="complete"===d.step&&d.successCount>0;m({step:"select",file:null,validRows:[],errors:[],totalRows:0,uploadProgress:0,successCount:0,failureCount:0,currentTransactionIndex:0}),s(!1),e&&r()},className:"w-full h-12 rounded-xl text-lg font-bold shadow-lg transition-all hover:translate-y-[-2px] active:translate-y-[0px] bg-slate-900 hover:bg-black dark:bg-white dark:text-black dark:hover:bg-slate-200",children:"Return to Dashboard"})]})]})]})})};var eD=e.i(483969);e.s(["default",0,()=>{let{accountId:e}=(0,s.useParams)(),x=(0,s.useNavigate)(),[T]=(0,l.useSearchParams)(),S=(0,C.useIsMobile)(),{currentBusiness:k,isLoading:D}=(0,b.useBusiness)(),{accounts:I,isLoading:M,updateAccount:A,refreshAccounts:B}=(0,N.useCashAccounts)(),{transactions:F,createTransaction:P,updateTransaction:E,refreshTransactions:_,deleteTransaction:z,getDailySummary:U}=(0,v.useCashTransactions)(e),{settings:$}=(0,w.useBusinessSettings)(),{hasPermission:W,isLoading:q}=(0,Z.useProfiles)(),{canManageFinanceAccounts:K}=(0,Q.useFinancialVisibility)(),[J,G]=(0,a.useState)(!1),[Y,et]=(0,a.useState)(!1),[ea,es]=(0,a.useState)(!1),[el,er]=(0,a.useState)(!1),[en,ei]=(0,a.useState)(!1),[eo,ed]=(0,a.useState)(!1),[em,eh]=(0,a.useState)(null),[ex,eu]=(0,a.useState)(null),[ep,eg]=(0,a.useState)(0),[ef,ey]=(0,a.useState)(!0),[eN,ew]=(0,a.useState)(!1),[eC,eT]=(0,a.useState)(0),[eS,eI]=(0,a.useState)("cash_in"),[eM,eA]=(0,a.useState)(!1),eB=I.find(t=>t.id===e);(0,a.useEffect)(()=>{if(e){let t=window.location.pathname+window.location.search;localStorage.setItem("lastVisitedCashAccount",e),localStorage.setItem("lastVisitedCashAccountUrl",t)}},[e,T]),(0,a.useEffect)(()=>{e&&(async()=>{ey(!0);try{let t=await U(new Date,e);eg(t.closingBalance)}finally{ey(!1)}})()},[e,U,F]);let eF=async()=>{ew(!0);try{if(await Promise.all([B(),_()]),e){ey(!0);let t=await U(new Date,e);eg(t.closingBalance),ey(!1)}eT(e=>e+1)}catch(e){console.error("Error refreshing data:",e)}finally{ew(!1)}},eP=async()=>{await Promise.all([_(),B()]),e&&(ey(!0),eg((await U(new Date,e)).closingBalance),ey(!1)),eT(e=>e+1)},eE=async t=>{try{if(await P(t),G(!1),await Promise.all([_(),B()]),e){ey(!0);let t=await U(new Date,e);eg(t.closingBalance),ey(!1)}eT(e=>e+1)}catch(e){console.error("Error creating transaction:",e)}},eO=async(t,a)=>{try{if(await E(t,a),et(!1),eh(null),await Promise.all([_(),B()]),e){ey(!0);let t=await U(new Date,e);eg(t.closingBalance),ey(!1)}eT(e=>e+1)}catch(e){console.error("Error updating transaction:",e)}},e_=async t=>{eA(!0);try{if(e){await A(e,t),ed(!1),ey(!0);let a=await U(new Date,e);eg(a.closingBalance),ey(!1)}}catch(e){console.error("Error updating account:",e)}finally{eA(!1)}},eL=e=>{eI(e),G(!0)};if(D||!k||M||q)return(0,t.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,t.jsx)(O.default,{message:"Loading cash account details..."})});if(!W("finance","view"))return(0,t.jsxs)("div",{className:"max-w-4xl mx-auto p-6",children:[(0,t.jsxs)(ej.Alert,{variant:"destructive",children:[(0,t.jsx)(ev.AlertCircle,{className:"h-4 w-4"}),(0,t.jsx)(ej.AlertTitle,{children:"Access Denied"}),(0,t.jsx)(ej.AlertDescription,{children:"You do not have permission to view cash accounts. Please contact your administrator if you believe this is an error."})]}),(0,t.jsx)("div",{className:"mt-4",children:(0,t.jsx)(f.Button,{onClick:()=>x("/"),variant:"outline",children:"Back to Dashboard"})})]});let eR=W("finance","create"),ez=W("finance","edit");return eB?(0,t.jsxs)("div",{className:"space-y-6 p-4 md:p-0",children:[(0,t.jsx)(L,{open:J,onOpenChange:G,onSubmit:eE,accounts:I,defaultAccountId:e,presetTransactionType:eS}),(0,t.jsx)(R,{open:Y,onOpenChange:et,onSubmit:eO,transaction:em,accounts:I}),(0,t.jsx)(V,{open:en,onOpenChange:ei,transaction:ex}),(0,t.jsx)(H.default,{open:eo,onOpenChange:ed,onSubmit:e_,title:"Edit Cash Account",initialData:{name:eB.name,description:eB.description||"",openingBalance:eB.openingBalance,isDefault:eB.isDefault},isSubmitting:eM}),(0,t.jsx)(ek,{open:el,onOpenChange:er,accountId:e||"",onUploadComplete:()=>{er(!1),eF()}}),(0,t.jsx)(eb,{open:ea,onOpenChange:es,accountId:e||"",onSuccess:()=>{es(!1),eF()}}),(0,t.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[(0,t.jsx)("div",{className:"flex items-center gap-3",children:(0,t.jsxs)(f.Button,{variant:"ghost",size:"sm",type:"button",onClick:()=>{localStorage.removeItem("lastVisitedCashAccount"),localStorage.removeItem("lastVisitedCashAccountUrl"),x("/cash")},className:"gap-2 px-2 md:px-3",children:[(0,t.jsx)(d.ArrowLeft,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Back to Cash"}),(0,t.jsx)("span",{className:"sm:hidden",children:"Back"})]})}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("h1",{className:"text-2xl md:text-3xl font-bold break-words",children:eB.name}),eB.description&&(0,t.jsx)("p",{className:"text-sm md:text-base text-muted-foreground",children:eB.description}),(0,t.jsx)("div",{className:"text-lg md:text-xl font-semibold",children:ef?(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{children:"Current Balance:"}),(0,t.jsx)(j.Loader2,{className:"h-4 w-4 animate-spin text-muted-foreground"})]}):(0,t.jsxs)("span",{children:["Current Balance: ",K?(0,X.formatCashAmount)(ep,$.currency||"USD"):"•••"]})})]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2 sm:gap-3",children:ez&&(0,t.jsxs)(f.Button,{type:"button",variant:"outline",onClick:()=>ed(!0),className:"gap-2 text-sm",size:S?"sm":"default",children:[(0,t.jsx)(i.Edit,{className:"h-4 w-4"}),"Edit Account"]})})]}),(0,t.jsx)(y.Card,{className:"border-none shadow-md overflow-hidden bg-gradient-to-br from-white to-slate-50 dark:from-slate-900 dark:to-slate-950",children:(0,t.jsxs)("div",{className:"p-4 sm:p-6 space-y-4",children:[(0,t.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("h3",{className:"text-lg font-bold tracking-tight",children:"Transaction Center"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Manage your account entries efficiently"})]}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,t.jsx)(f.Button,{type:"button",onClick:eF,disabled:eN,variant:"ghost",size:"icon",className:"h-9 w-9 rounded-full hover:bg-white dark:hover:bg-slate-800 shadow-sm border",title:"Refresh Data",children:(0,t.jsx)(m.RefreshCcw,{className:(0,X.cn)("h-4 w-4",eN&&"animate-spin")})}),(0,t.jsx)(f.Button,{type:"button",variant:"ghost",size:"icon",onClick:eD.generateTransactionCSVTemplate,className:"h-9 w-9 rounded-full hover:bg-white dark:hover:bg-slate-800 shadow-sm border",title:"Download CSV Template",children:(0,t.jsx)(o.Download,{className:"h-4 w-4"})})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:[(0,t.jsxs)(f.Button,{type:"button",onClick:()=>G(!0),disabled:!eR,className:(0,X.cn)("h-auto py-4 flex flex-col items-center justify-center gap-2 text-white shadow-lg border-none active:scale-[0.98] transition-all",eR?"bg-blue-600 hover:bg-blue-700":"bg-slate-400 cursor-not-allowed opacity-60"),children:[(0,t.jsx)("div",{className:"bg-white/20 p-2 rounded-lg",children:(0,t.jsx)(r.Plus,{className:"h-5 w-5"})}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("span",{className:"block font-bold",children:"New Entry"}),(0,t.jsx)("span",{className:"block text-[10px] opacity-80 font-medium",children:"Single Transaction"})]})]}),(0,t.jsxs)(f.Button,{type:"button",onClick:()=>es(!0),variant:"outline",disabled:!eR,className:(0,X.cn)("h-auto py-4 flex flex-col items-center justify-center gap-2 border-slate-200 dark:border-slate-800 shadow-sm active:scale-[0.98] transition-all",eR?"hover:bg-indigo-50/50 dark:hover:bg-indigo-900/10 hover:border-indigo-200":"opacity-60 cursor-not-allowed"),children:[(0,t.jsx)("div",{className:"bg-indigo-100 dark:bg-indigo-900/30 p-2 rounded-lg text-indigo-600 dark:text-indigo-400",children:(0,t.jsx)(p.LayoutGrid,{className:"h-5 w-5"})}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("span",{className:"block font-bold",children:"Bulk Entry"}),(0,t.jsx)("span",{className:"block text-[10px] text-muted-foreground font-medium",children:"Manual Batch"})]})]}),(0,t.jsxs)(f.Button,{type:"button",onClick:()=>er(!0),variant:"outline",disabled:!eR,className:(0,X.cn)("h-auto py-4 flex flex-col items-center justify-center gap-2 border-slate-200 dark:border-slate-800 shadow-sm col-span-1 sm:col-span-2 lg:col-span-1 active:scale-[0.98] transition-all",eR?"hover:bg-emerald-50/50 dark:hover:bg-emerald-900/10 hover:border-emerald-200":"opacity-60 cursor-not-allowed"),children:[(0,t.jsx)("div",{className:"bg-emerald-100 dark:bg-emerald-900/30 p-2 rounded-lg text-emerald-600 dark:text-emerald-400",children:(0,t.jsx)(c.Upload,{className:"h-5 w-5"})}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("span",{className:"block font-bold",children:"Import CSV"}),(0,t.jsx)("span",{className:"block text-[10px] text-muted-foreground font-medium",children:"Process Legacy Logs"})]})]})]})]})}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 px-1",children:[(0,t.jsx)(g.Zap,{className:"h-4 w-4 text-amber-500 fill-amber-500"}),(0,t.jsx)("h4",{className:"text-sm font-bold uppercase tracking-wider text-slate-500",children:"Quick Shortcuts"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[(0,t.jsxs)(f.Button,{type:"button",variant:"outline",onClick:()=>eL("cash_in"),disabled:!eR,className:(0,X.cn)("group justify-between h-12 border-green-100 dark:border-green-900/30 transition-all font-semibold",eR?"hover:bg-green-50 dark:hover:bg-green-900/10 hover:border-green-300":"opacity-60 cursor-not-allowed"),children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"bg-green-100 dark:bg-green-900/30 p-1.5 rounded-md text-green-600",children:(0,t.jsx)(n.ArrowUpRight,{className:"h-4 w-4"})}),(0,t.jsx)("span",{className:"text-green-700 dark:text-green-400",children:"Cash In"})]}),eR&&(0,t.jsx)(r.Plus,{className:"h-3 w-3 text-green-300 opacity-0 group-hover:opacity-100 transition-opacity"})]}),(0,t.jsxs)(f.Button,{type:"button",variant:"outline",onClick:()=>eL("cash_out"),disabled:!eR,className:(0,X.cn)("group justify-between h-12 border-red-100 dark:border-red-900/30 transition-all font-semibold",eR?"hover:bg-red-50 dark:hover:bg-red-900/10 hover:border-red-300":"opacity-60 cursor-not-allowed"),children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"bg-red-100 dark:bg-red-900/30 p-1.5 rounded-md text-red-600",children:(0,t.jsx)(h.ArrowDownRight,{className:"h-4 w-4"})}),(0,t.jsx)("span",{className:"text-red-700 dark:text-red-400",children:"Cash Out"})]}),eR&&(0,t.jsx)(r.Plus,{className:"h-3 w-3 text-red-300 opacity-0 group-hover:opacity-100 transition-opacity"})]}),(0,t.jsxs)(f.Button,{type:"button",variant:"outline",onClick:()=>eL("transfer"),disabled:!eR,className:(0,X.cn)("group justify-between h-12 border-blue-100 dark:border-blue-900/30 transition-all font-semibold",eR?"hover:bg-blue-50 dark:hover:bg-blue-900/10 hover:border-blue-300":"opacity-60 cursor-not-allowed"),children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"bg-blue-100 dark:bg-blue-900/30 p-1.5 rounded-md text-blue-600",children:(0,t.jsx)(u,{className:"h-4 w-4"})}),(0,t.jsx)("span",{className:"text-blue-700 dark:text-blue-400",children:"Transfer"})]}),eR&&(0,t.jsx)(r.Plus,{className:"h-3 w-3 text-blue-300 opacity-0 group-hover:opacity-100 transition-opacity"})]})]})]}),(0,t.jsx)(ec,{accountId:e},eC),(0,t.jsxs)(y.Card,{children:[(0,t.jsx)(y.CardHeader,{className:"pb-3 md:pb-6",children:(0,t.jsx)(y.CardTitle,{className:"text-lg md:text-xl",children:"Recent Transactions"})}),(0,t.jsx)(y.CardContent,{className:"px-3 md:px-6",children:(0,t.jsx)(ee,{transactions:F,accountId:e,showAccountColumn:!1,onEditTransaction:e=>{eh(e),et(!0)},onViewTransaction:e=>{eu(e),ei(!0)},onTransactionDeleted:eP})})]})]}):(0,t.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Account not found"}),(0,t.jsx)(f.Button,{onClick:()=>x("/cash"),children:"Back to Cash Accounts"})]})})}],752086)}]);