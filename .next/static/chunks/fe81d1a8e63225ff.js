(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,482568,e=>{"use strict";var t,r,n,i;let o,a,s,l,c,d;(r=t||(t={})).Unimplemented="UNIMPLEMENTED",r.Unavailable="UNAVAILABLE";class u extends Error{constructor(e,t,r){super(e),this.message=e,this.code=t,this.data=r}}let m=(o=(i=n="u">typeof globalThis?globalThis:"u">typeof self?self:"u">typeof window?window:e.g).CapacitorCustomPlatform||null,s=(a=i.Capacitor||{}).Plugins=a.Plugins||{},l=()=>{var e,t;return null!==o?o.name:(null==i?void 0:i.androidBridge)?"android":(null==(t=null==(e=null==i?void 0:i.webkit)?void 0:e.messageHandlers)?void 0:t.bridge)?"ios":"web"},c=e=>{var t;return null==(t=a.PluginHeaders)?void 0:t.find(t=>t.name===e)},d=new Map,a.convertFileSrc||(a.convertFileSrc=e=>e),a.getPlatform=l,a.handleError=e=>i.console.error(e),a.isNativePlatform=()=>"web"!==l(),a.isPluginAvailable=e=>{let t=d.get(e);return!!((null==t?void 0:t.platforms.has(l()))||c(e))},a.registerPlugin=(e,r={})=>{let n,i=d.get(e);if(i)return console.warn(`Capacitor plugin "${e}" already registered. Cannot register plugins twice.`),i.proxy;let m=l(),f=c(e),g=async()=>(!n&&m in r?n=n="function"==typeof r[m]?await r[m]():r[m]:null!==o&&!n&&"web"in r&&(n=n="function"==typeof r.web?await r.web():r.web),n),p=r=>{let n,i=(...i)=>{let o=g().then(o=>{let s=((r,n)=>{var i,o;if(f){let t=null==f?void 0:f.methods.find(e=>n===e.name);if(t)if("promise"===t.rtype)return t=>a.nativePromise(e,n.toString(),t);else return(t,r)=>a.nativeCallback(e,n.toString(),t,r);if(r)return null==(i=r[n])?void 0:i.bind(r)}else if(r)return null==(o=r[n])?void 0:o.bind(r);else throw new u(`"${e}" plugin is not implemented on ${m}`,t.Unimplemented)})(o,r);if(s){let e=s(...i);return n=null==e?void 0:e.remove,e}throw new u(`"${e}.${r}()" is not implemented on ${m}`,t.Unimplemented)});return"addListener"===r&&(o.remove=async()=>n()),o};return i.toString=()=>`${r.toString()}() { [capacitor code] }`,Object.defineProperty(i,"name",{value:r,writable:!1,configurable:!1}),i},h=p("addListener"),y=p("removeListener"),b=(e,t)=>{let r=h({eventName:e},t),n=async()=>{y({eventName:e,callbackId:await r},t)},i=new Promise(e=>r.then(()=>e({remove:n})));return i.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await n()},i},v=new Proxy({},{get(e,t){switch(t){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return f?b:h;case"removeListener":return y;default:return p(t)}}});return s[e]=v,d.set(e,{name:e,proxy:v,platforms:new Set([...Object.keys(r),...f?[m]:[]])}),v},a.Exception=u,a.DEBUG=!!a.DEBUG,a.isLoggingEnabled=!!a.isLoggingEnabled,n.Capacitor=a),f=m.registerPlugin;class g{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,t){let r=!1;this.listeners[e]||(this.listeners[e]=[],r=!0),this.listeners[e].push(t);let n=this.windowListeners[e];return n&&!n.registered&&this.addWindowListener(n),r&&this.sendRetainedArgumentsForEvent(e),Promise.resolve({remove:async()=>this.removeListener(e,t)})}async removeAllListeners(){for(let e in this.listeners={},this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t,r){let n=this.listeners[e];if(!n){if(r){let r=this.retainedEventArguments[e];r||(r=[]),r.push(t),this.retainedEventArguments[e]=r}return}n.forEach(e=>e(t))}hasListeners(e){var t;return!!(null==(t=this.listeners[e])?void 0:t.length)}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:e=>{this.notifyListeners(t,e)}}}unimplemented(e="not implemented"){return new m.Exception(e,t.Unimplemented)}unavailable(e="not available"){return new m.Exception(e,t.Unavailable)}async removeListener(e,t){let r=this.listeners[e];if(!r)return;let n=r.indexOf(t);this.listeners[e].splice(n,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){let t=this.retainedEventArguments[e];t&&(delete this.retainedEventArguments[e],t.forEach(t=>{this.notifyListeners(e,t)}))}}let p=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);class h extends g{async getCookies(){let e=document.cookie,t={};return e.split(";").forEach(e=>{if(e.length<=0)return;let[r,n]=e.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");r=r.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent).trim(),n=n.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent).trim(),t[r]=n}),t}async setCookie(e){try{let t=p(e.key),r=p(e.value),n=e.expires?`; expires=${e.expires.replace("expires=","")}`:"",i=(e.path||"/").replace("path=",""),o=null!=e.url&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${r||""}${n}; path=${i}; ${o};`}catch(e){return Promise.reject(e)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(e){return Promise.reject(e)}}async clearCookies(){try{for(let e of document.cookie.split(";")||[])document.cookie=e.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}f("CapacitorCookies",{web:()=>new h});let y=async e=>new Promise((t,r)=>{let n=new FileReader;n.onload=()=>{let e=n.result;t(e.indexOf(",")>=0?e.split(",")[1]:e)},n.onerror=e=>r(e),n.readAsDataURL(e)});class b extends g{async request(e){let t,r,n=((e,t={})=>{let r=Object.assign({method:e.method||"GET",headers:e.headers},t),n=((e={})=>{let t=Object.keys(e);return Object.keys(e).map(e=>e.toLocaleLowerCase()).reduce((r,n,i)=>(r[n]=e[t[i]],r),{})})(e.headers)["content-type"]||"";if("string"==typeof e.data)r.body=e.data;else if(n.includes("application/x-www-form-urlencoded")){let t=new URLSearchParams;for(let[r,n]of Object.entries(e.data||{}))t.set(r,n);r.body=t.toString()}else if(n.includes("multipart/form-data")||e.data instanceof FormData){let t=new FormData;if(e.data instanceof FormData)e.data.forEach((e,r)=>{t.append(r,e)});else for(let r of Object.keys(e.data))t.append(r,e.data[r]);r.body=t;let n=new Headers(r.headers);n.delete("content-type"),r.headers=n}else(n.includes("application/json")||"object"==typeof e.data)&&(r.body=JSON.stringify(e.data));return r})(e,e.webFetchExtra),i=((e,t=!0)=>e?Object.entries(e).reduce((e,r)=>{let n,i,[o,a]=r;return Array.isArray(a)?(i="",a.forEach(e=>{n=t?encodeURIComponent(e):e,i+=`${o}=${n}&`}),i.slice(0,-1)):(n=t?encodeURIComponent(a):a,i=`${o}=${n}`),`${e}&${i}`},"").substr(1):null)(e.params,e.shouldEncodeUrlParams),o=i?`${e.url}?${i}`:e.url,a=await fetch(o,n),s=a.headers.get("content-type")||"",{responseType:l="text"}=a.ok?e:{};switch(s.includes("application/json")&&(l="json"),l){case"arraybuffer":case"blob":r=await a.blob(),t=await y(r);break;case"json":t=await a.json();break;default:t=await a.text()}let c={};return a.headers.forEach((e,t)=>{c[t]=e}),{data:t,headers:c,status:a.status,url:a.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}f("CapacitorHttp",{web:()=>new b}),e.s(["Capacitor",()=>m,"WebPlugin",()=>g,"registerPlugin",()=>f])},458425,e=>{"use strict";function t(e){let t=["","thousand","million","billion","trillion","quadrillion"],r=["","ten","twenty","thirty","forty","fifty","sixty","seventy","eighty","ninety"],n=["","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],i=e=>{let t=e.toFixed(2).split("."),r=o(parseInt(t[0]));return t.length>1&&parseInt(t[1])>0?`${r} and ${t[1]}/100`:r},o=e=>{if(0===e)return"zero";if(e<0)return`negative ${o(Math.abs(e))}`;let r="",n=0;for(;e>0;)e%1e3!=0&&(r=`${a(e%1e3)} ${t[n]} ${r}`),e=Math.floor(e/1e3),n++;return r.trim()},a=e=>{if(0===e)return"";let t="";return e>=100&&(t=`${n[Math.floor(e/100)]} hundred `,0==(e%=100))?t.trim():(e<20?t+=n[e]:(t+=`${r[Math.floor(e/10)]}`,e%10>0&&(t+=`-${n[e%10]}`)),t.trim())};return i(e).trim().charAt(0).toUpperCase()+i(e).trim().slice(1)}e.s(["numberToWords",()=>t])},727612,e=>{"use strict";let t=(0,e.i(475254).default)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);e.s(["Trash2",()=>t],727612)},487486,e=>{"use strict";var t=e.i(843476),r=e.i(225913),n=e.i(975157);let i=(0,r.cva)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground",warning:"border-transparent bg-amber-500 text-white hover:bg-amber-600",success:"border-transparent bg-green-600 text-white hover:bg-green-700"}},defaultVariants:{variant:"default"}});function o({className:e,variant:r,...o}){return(0,t.jsx)("div",{className:(0,n.cn)(i({variant:r}),e),...o})}e.s(["Badge",()=>o])},392401,e=>{"use strict";var t=e.i(777624);e.s(["useFinancialVisibility",0,()=>{let{hasPermission:e}=(0,t.useProfiles)(),r=e("inventory","view_cost_price"),n=e("inventory","view_profit"),i=e("inventory","view_selling_price"),o=e("dashboard","view_total_sales"),a=e("dashboard","view_gross_profit"),s=e("dashboard","view_total_expenses"),l=e("dashboard","view_inventory_value"),c=e("dashboard","view_sales_types"),d=e("dashboard","view_avg_price"),u=e("dashboard","view_total_amount"),m=e("finance","manage_accounts"),f=e("finance","view"),g=e("expenses","view"),p=e("expenses","create"),h=e("expenses","edit");return{canViewCostPrice:r,canViewProfit:n,canViewSellingPrice:i,canViewTotalSales:o,canViewTotalGrossProfit:a,canViewTotalExpenses:s,canViewInventoryValue:l,canViewSalesTypes:c,canViewAvgPrice:d,canViewTotalAmount:u,canManageFinanceAccounts:m,canViewFinance:f,canViewExpenses:g,canCreateExpenses:p,canEditExpenses:h,canDeleteExpenses:e("expenses","delete"),formatFinancial:(e,t)=>"cost"===t&&r||"selling"===t&&i||"profit"===t&&n?e?.toLocaleString()||"0":"•••"}}])},747697,e=>{"use strict";var t=e.i(361277);e.s(["CalendarIcon",()=>t.default])},804760,e=>{"use strict";var t=e.i(255749);let r=(e,t="Ush")=>{let r=Math.round(e).toLocaleString();return`${t} ${r}`},n=async(e,n)=>{let{filename:i,orientation:o="portrait",format:a="a4",margins:s={top:20,right:20,bottom:20,left:20},returnBlob:l=!1}=n,c=new t.default({orientation:o,unit:"mm",format:a,compress:!0}),d=c.internal.pageSize.getWidth(),u=c.internal.pageSize.getHeight(),m=d-s.left-s.right,f=s.top,g=()=>{c.setLineWidth(.2)},p=(e,t,r,n={})=>{let{fontSize:i=10,fontStyle:o="normal",align:a="left",maxWidth:s}=n;if(c.setFontSize(i),c.setFont("helvetica",o),!s)return c.text(e,t,r,{align:a}),.35*i;{let n=c.splitTextToSize(e,s);return c.text(n,t,r,{align:a}),n.length*(.35*i)}},h=(e,t,r,n,i={})=>{let{fontSize:o=10,fontStyle:a="normal",align:s="left",lineHeight:l=1.2}=i;c.setFontSize(o),c.setFont("helvetica",a);let d=c.splitTextToSize(e,n),u=.35*o*l;return d.forEach((e,n)=>{c.text(e,t,r+n*u,{align:s})}),d.length*u},y=(e,t,r,n)=>{g(),c.line(e,t,r,n)},b=(e,t,r,n,i="S")=>{g(),c.rect(e,t,r,n,i)},v=()=>{b(s.left,s.top,m,u-s.top-s.bottom,"S")},S=e=>f+e>u-s.bottom&&(c.addPage(),f=s.top+10,v(),!0);v();let w=s.left+8,_=m-16;if(f+=8,e.businessLogo)try{let t=new Image;t.crossOrigin="anonymous",await new Promise((r,n)=>{t.onload=()=>{try{let e=document.createElement("canvas"),r=e.getContext("2d");if(r){e.width=t.width,e.height=t.height,r.drawImage(t,0,0);let n=e.toDataURL("image/png"),i=t.width/t.height;c.addImage(n,"PNG",w,f,15*i,15)}}catch(e){console.error("Error adding logo to PDF:",e)}r()},t.onerror=()=>{console.error("Error loading logo image"),r()},t.src=e.businessLogo})}catch(e){console.error("Error processing logo:",e)}let P=.75*_,A=w+_,I=f;if(e.businessName&&(I+=p(e.businessName,A,I,{fontSize:14,fontStyle:"bold",align:"right"}),I+=1.5),e.businessAddress){let t=c.splitTextToSize(e.businessAddress,P);t.forEach((e,t)=>{c.setFontSize(10),c.setFont("helvetica","normal"),c.text(e,A,I+3.15*t,{align:"right"})}),I+=3.15*t.length+.5}e.businessPhone&&(I+=p(`Phone: ${e.businessPhone}`,A,I,{fontSize:9,align:"right"}),I+=.5),e.businessEmail&&(I+=p(`Email: ${e.businessEmail}`,A,I,{fontSize:9,align:"right"}),I+=.5),f=Math.max(f+18,I)+5,S(20),y(w,f,w+_,f),f+=6,f+=p(e.documentTitle.toUpperCase(),d/2,f,{fontSize:16,fontStyle:"bold",align:"center"});let E=f+=4,x=E;x+=p(`${e.documentNumberLabel} ${e.receiptNumber}`,w,x,{fontSize:11,fontStyle:"bold"}),x+=2,x+=p(`Date: ${e.date}`,w,x,{fontSize:10}),x+=2,x+=p(`Time: ${e.time}`,w,x,{fontSize:10});let C=w+.7*_;if(p(`Status: ${e.status}`,C,E,{fontSize:11,fontStyle:"bold",align:"left"}),f=x+4,e.customerName&&""!==e.customerName.trim()){if(S(30),f+=p("Customer Information:",w,f,{fontSize:11,fontStyle:"bold"}),f+=3,f+=p(e.customerName,w,f,{fontSize:10}),f+=2.5,e.customerAddress&&""!==e.customerAddress.trim()){let t=h(e.customerAddress,w,f,.8*_,{fontSize:10,lineHeight:1});f+=t,f+=2.5}e.customerContact&&""!==e.customerContact.trim()&&(f+=p(e.customerContact,w,f,{fontSize:10}),f+=2.5),f+=3}let L=e.items.some(e=>(e.discountPercentage||0)>0||(e.discountAmount||0)>0),z=L?["Description","Qty","Unit Price","Discount","Amount"]:["Description","Qty","Unit Price","Amount"],T=L?[.35*_,.15*_,.18*_,.12*_,.2*_]:[.45*_,.15*_,.2*_,.2*_];c.setFillColor(245,245,245),b(w,f-2,_,10,"F"),b(w,f-2,_,10,"S");let $=w;z.forEach((e,t)=>{p(e,$+3,f+4,{fontSize:10,fontStyle:"bold"}),t<z.length-1&&y($+T[t],f-2,$+T[t],f+8),$+=T[t]}),f+=10;let F=0;e.items.forEach((t,n)=>{c.setFontSize(9);let i=Math.max(8,3.5*c.splitTextToSize(t.description,T[0]-6).length+4);S(i+5),t.unitPrice,t.quantity,t.discountAmount;let o=t.amount;if(F+=o,n%2==1&&(c.setFillColor(250,250,250),b(w,f,_,i,"F")),b(w,f,_,i,"S"),$=w,h(t.description,$+3,f+4,T[0]-6,{fontSize:9,lineHeight:1.1}),y($+=T[0],f,$,f+i),p(t.quantity.toString(),$+T[1]-3,f+i/2+1.5,{fontSize:9,align:"right"}),y($+=T[1],f,$,f+i),p(r(t.unitPrice,e.currency),$+T[2]-3,f+i/2+1.5,{fontSize:9,align:"right"}),y($+=T[2],f,$,f+i),L){let n="-";(t.discountPercentage||0)>0?n=`${t.discountPercentage}%`:(t.discountAmount||0)>0&&(n=r(t.discountAmount,e.currency)),p(n,$+T[3]-3,f+i/2+1.5,{fontSize:9,align:"right"}),y($+=T[3],f,$,f+i)}p(r(o,e.currency),$+T[L?4:3]-3,f+i/2+1.5,{fontSize:9,align:"right"}),f+=i,n<e.items.length-1&&y(w,f,w+_,f)}),f+=5,S(70);let N=w+.45*_,k=.55*_,D=.55*k,U=.45*k,O=e.items.reduce((e,t)=>{let r=t.unitPrice*t.quantity;return e+("amount"===t.discountType?t.discountAmount||0:r*(t.discountPercentage||0)/100)},0);if(O>0&&(b(N,f,k,8,"S"),c.setFillColor(248,248,248),b(N,f,k,8,"F"),p("Subtotal (before discount):",N+4,f+5.5,{fontSize:10,fontStyle:"normal"}),y(N+D,f,N+D,f+8),p(r(F+O,e.currency),N+D+U-4,f+5.5,{fontSize:10,fontStyle:"normal",align:"right"}),b(N,f+=8,k,8,"S"),c.setFillColor(255,240,220),b(N,f,k,8,"F"),p("Total Discount:",N+4,f+5.5,{fontSize:10,fontStyle:"normal"}),y(N+D,f,N+D,f+8),p(`-${r(O,e.currency)}`,N+D+U-4,f+5.5,{fontSize:10,fontStyle:"normal",align:"right"}),f+=8),b(N,f,k,8,"S"),c.setFillColor(248,248,248),b(N,f,k,8,"F"),p(O>0?"Subtotal (after discount):":"Subtotal:",N+4,f+5.5,{fontSize:10,fontStyle:"normal"}),y(N+D,f,N+D,f+8),p(r(F,e.currency),N+D+U-4,f+5.5,{fontSize:10,fontStyle:"normal",align:"right"}),f+=8,e.showTaxRow&&e.taxAmount>0&&(b(N,f,k,8,"S"),c.setFillColor(250,250,250),b(N,f,k,8,"F"),p(`Tax (${e.taxRate}%):`,N+4,f+5.5,{fontSize:10,fontStyle:"normal"}),y(N+D,f,N+D,f+8),p(r(e.taxAmount,e.currency),N+D+U-4,f+5.5,{fontSize:10,fontStyle:"normal",align:"right"}),f+=8),b(N,f,k,12,"S"),c.setFillColor(220,220,220),b(N,f,k,12,"F"),p("TOTAL:",N+4,f+7.5,{fontSize:12,fontStyle:"bold"}),y(N+D,f,N+D,f+12),p(r(e.totalAmount,e.currency),N+D+U-4,f+7.5,{fontSize:12,fontStyle:"bold",align:"right"}),f+=12,e.isInstallmentSale&&(void 0!==e.amountPaid&&(b(N,f,k,8,"S"),c.setFillColor(240,248,255),b(N,f,k,8,"F"),p("Amount Paid:",N+4,f+5.5,{fontSize:10,fontStyle:"bold"}),y(N+D,f,N+D,f+8),p(r(e.amountPaid,e.currency),N+D+U-4,f+5.5,{fontSize:10,fontStyle:"bold",align:"right"}),f+=8),void 0!==e.amountDue&&(b(N,f,k,8,"S"),c.setFillColor(255,240,240),b(N,f,k,8,"F"),p("Amount Due:",N+4,f+5.5,{fontSize:10,fontStyle:"bold"}),y(N+D,f,N+D,f+8),p(r(e.amountDue,e.currency),N+D+U-4,f+5.5,{fontSize:10,fontStyle:"bold",align:"right"}),f+=8)),f+=7,e.totalAmountInWords){S(20),p("Amount in words:",w,f+=2,{fontSize:10,fontStyle:"bold"}),f+=4;let t=h(`${e.currency} ${e.totalAmountInWords} only`,w,f,.9*_,{fontSize:10,fontStyle:"italic",lineHeight:1.4});f+=t+4}if(e.hasPaymentInfo&&e.paymentMethods&&e.paymentMethods.length>0){S(40),y(w,f,w+_,f),p("Payment Information:",w,f+=5,{fontSize:11,fontStyle:"bold"}),f+=4;let t=["Payment Method","Account Number","Account Name"],r=[.28*_,.36*_,.36*_];c.setFillColor(240,240,240),b(w,f-2,_,10,"F"),b(w,f-2,_,10,"S");let n=w;t.forEach((e,i)=>{p(e,n+4,f+4,{fontSize:9,fontStyle:"bold"}),i<t.length-1&&y(n+r[i],f-2,n+r[i],f+10-2),n+=r[i]}),f+=10,e.paymentMethods.filter(e=>e.method.trim()||e.accountNumber.trim()||e.accountName.trim()).forEach((e,t)=>{S(15),t%2==1&&(c.setFillColor(248,248,248),b(w,f,_,10,"F")),b(w,f,_,10,"S"),n=w,p(e.method,n+4,f+5,{fontSize:9,fontStyle:"bold"}),y(n+=r[0],f,n,f+10),p(e.accountNumber,n+4,f+5,{fontSize:9}),y(n+=r[1],f,n,f+10),p(e.accountName,n+4,f+5,{fontSize:9}),f+=10}),f+=4}if(e.notes&&e.notes.trim()){S(25),y(w,f,w+_,f),p("Notes:",w,f+=4,{fontSize:11,fontStyle:"bold"}),f+=6;let t=_-8;c.splitTextToSize(e.notes,t).forEach(e=>{S(8),p(e,w+4,f,{fontSize:10}),f+=5}),f+=4}if(e.signature)try{S(35);let t=new Image;t.crossOrigin="anonymous",await new Promise(r=>{t.onload=()=>{try{let e=document.createElement("canvas"),r=e.getContext("2d");if(r){let n,i;e.width=t.width,e.height=t.height,r.drawImage(t,0,0);let o=e.toDataURL("image/png"),a=t.width/t.height;a>2?(n=40,i=40/a):(i=20,n=20*a);let s=w+_-n;y(w,f,w+_,f),f+=4,c.addImage(o,"PNG",s,f,n,i),f+=i+2,p("Authorized Signature",s+n/2,f,{fontSize:8,align:"center"}),f+=4}}catch(e){console.error("Error adding signature to PDF:",e)}r()},t.onerror=()=>{console.error("Error loading signature image"),r()},t.src=e.signature})}catch(e){console.error("Error processing signature:",e)}if(S(25),p("Thank you for your business!",d/2,f+=6,{fontSize:11,fontStyle:"bold",align:"center"}),p("Created by Gonza Systems",d/2,f+=5,{fontSize:9,align:"center"}),l)return c.output("blob");i&&c.save(i)};e.s(["generateReceiptVectorPDF",0,n])},531278,e=>{"use strict";let t=(0,e.i(475254).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],531278)},986387,e=>{"use strict";var t=e.i(102594);e.s(["useCurrentUser",0,()=>{let{user:e}=(0,t.useAuth)();return{userId:e?.id}}])},457786,e=>{"use strict";var t=e.i(95187);let r=(0,t.createServerReference)("401d907b5cd7e0b2f207e9b555ac4fe2e14de08444",t.callServer,void 0,t.findSourceMapURL,"logActivityAction");var n=e.i(986387),i=e.i(422713),o=e.i(777624);e.s(["useActivityLogger",0,()=>{let{userId:e}=(0,n.useCurrentUser)(),{currentBusiness:t}=(0,i.useBusiness)(),a=null;try{let{currentProfile:e}=(0,o.useProfiles)();a=e}catch{a=null}return{logActivity:async n=>{if(!e||!t?.id)return void console.warn("Cannot log activity: missing user or business context");try{let i=await r({userId:e,locationId:t.id,activityType:n.activityType,module:n.module,entityType:n.entityType,entityId:n.entityId||void 0,entityName:n.entityName,description:n.description,metadata:n.metadata||void 0,profileId:a?.id||void 0,profileName:a?.profile_name||void 0});i.success||console.error("Error logging activity:",i.error)}catch(e){console.error("Failed to log activity:",e)}}}}],457786)},589271,e=>{"use strict";e.s(["mapDbProductToProduct",0,e=>({id:e.id,itemNumber:e.item_number,barcode:e.barcode,manufacturerBarcode:e.manufacturer_barcode,name:e.name,description:e.description,category:e.category,quantity:e.quantity,costPrice:Number(e.cost_price),sellingPrice:Number(e.selling_price),supplier:e.supplier,imageUrl:e.image_url,minimumStock:e.minimum_stock,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}),"mapDbSaleToSale",0,e=>{let t=(Array.isArray(e.items)?e.items:[]).map(e=>{let t=void 0!==e.discountPercentage?Number(e.discountPercentage):void 0,r=void 0!==e.discountAmount?Number(e.discountAmount):void 0,n=e.discountType;return!n&&(t&&t>0?n="percentage":r&&r>0&&(n="amount")),{description:e.description||"",quantity:Number(e.quantity)||0,price:Number(e.price)||0,cost:Number(e.cost)||0,productId:e.productId||void 0,discountType:n,discountPercentage:t,discountAmount:r,createdAt:e.createdAt||void 0}});return{id:e.id,receiptNumber:e.receipt_number,customerName:e.customer_name,customerAddress:e.customer_address||"",customerContact:e.customer_contact||"",customerId:e.customer_id||void 0,items:t,paymentStatus:e.payment_status,profit:Number(e.profit),date:new Date(e.date),taxRate:e.tax_rate?Number(e.tax_rate):0,cashTransactionId:e.cash_transaction_id||void 0,amountPaid:e.amount_paid?Number(e.amount_paid):void 0,amountDue:e.amount_due?Number(e.amount_due):void 0,notes:e.notes||"",categoryId:e.category_id||void 0,createdAt:new Date(e.created_at)}},"mapSaleToDbSale",0,(e,t,r,n,i,o,a)=>({user_id:i,location_id:o,receipt_number:n,customer_name:e.customerName,customer_address:e.customerAddress||null,customer_contact:e.customerContact||null,customer_id:e.customerId||null,items:e.items,payment_status:e.paymentStatus,profit:r,date:t.toISOString().split("T")[0],tax_rate:e.taxRate||0,cash_transaction_id:a||null,amount_paid:e.amountPaid||null,amount_due:e.amountDue||null,notes:e.notes||null,category_id:e.categoryId||null})])},146786,850823,617318,e=>{"use strict";var t=e.i(271645),r=e.i(589271),n=e.i(908406),i=e.i(266027),o=e.i(912598),a=e.i(457786),s=e.i(422713),l=e.i(908962),c=e.i(846696),d=e.i(555781);let u=e=>{let{updateProductsBulk:t}=(0,l.useProducts)(e),r=async(e,t)=>{if(!e.length)return[];try{return await (0,d.getProductsByIdsAction)(e,t)}catch(e){throw console.error("Error fetching fresh products:",e),e}};return{deductStockForSale:async(n,i,o,a,s)=>{if(!e)return!1;try{let l=n.filter(e=>e.productId);if(0===l.length)return!0;let d=[...new Set(l.map(e=>e.productId))],u=await r(d,s);if(0===u.length)return!1;let m=new Map;for(let e of l){let t=m.get(e.productId)||0;m.set(e.productId,t+e.quantity)}let f=[];for(let[e,t]of m.entries()){let r=u.find(t=>t.id===e);if(!r)continue;let n=r.quantity-t;f.push({id:e,updated:{...r,quantity:n}}),n<0&&c.toast.warning(`${r.name} inventory is now negative (${n}). Please restock soon.`)}return f.length>0&&await t(f,e,"Sale",i,o,a),!0}catch(e){return console.error("Error deducting stock for sale:",e),!1}},restoreStockForSale:async(n,i,o,a)=>{if(!e)return!1;try{let s=n.filter(e=>e.productId);if(0===s.length)return!0;let l=[...new Set(s.map(e=>e.productId))],c=await r(l,a),d=new Map;for(let e of s){let t=d.get(e.productId)||0;d.set(e.productId,t+e.quantity)}let u=[];for(let[e,t]of d.entries()){let r=c.find(t=>t.id===e);if(!r)continue;let n=r.quantity+t;u.push({id:e,updated:{...r,quantity:n}})}return u.length>0&&await t(u,e,"Deleted Sale",i,void 0,o),!0}catch(e){return console.error("Error restoring stock for sale:",e),!1}},adjustStockForEditedSale:async(n,i,o,a,s,l)=>{if(!e)return!1;try{let d=[...n.filter(e=>e.productId).map(e=>e.productId),...i.filter(e=>e.productId).map(e=>e.productId)],u=[...new Set(d)];if(0===u.length)return!0;let m=await r(u,l),f=new Map;for(let e of n.filter(e=>e.productId)){let t=f.get(e.productId)||0;f.set(e.productId,t+e.quantity)}for(let e of i.filter(e=>e.productId)){let t=f.get(e.productId)||0;f.set(e.productId,t-e.quantity)}let g=[];for(let[e,t]of f.entries()){if(0===t)continue;let r=m.find(t=>t.id===e);if(!r)continue;let n=r.quantity+t;g.push({id:e,updated:{...r,quantity:n}}),n<0&&c.toast.warning(`${r.name} inventory is now negative (${n}). Please restock soon.`)}return g.length>0&&await t(g,e,"Sale Status/Qty Edit",o,a,s),!0}catch(e){return console.error("Error adjusting stock for edited sale:",e),!1}}}};e.s(["useInventoryActions",0,u],850823);var m=e.i(224410),f=e.i(95187);let g=(0,f.createServerReference)("703e9376bfaf2adbf9aba886e70ba6b561f6bf5e0c",f.callServer,void 0,f.findSourceMapURL,"getSalesAction"),p=(0,f.createServerReference)("40d9064371ce5c0811194879498fdc849fbf872b8a",f.callServer,void 0,f.findSourceMapURL,"deleteSaleAction");e.s(["deleteSaleAction",()=>p],617318),e.s(["useSalesData",0,(e,l="desc",c)=>{let d=(0,o.useQueryClient)(),{toast:f}=(0,n.useToast)(),{logActivity:h}=(0,a.useActivityLogger)(),{currentBusiness:y}=(0,s.useBusiness)(),{restoreStockForSale:b}=u(e),v=(0,t.useCallback)(async()=>{try{if(!e||!y)return[];let t=await g(y.id,l,c);return t?t.map(e=>{let t={id:e.id,user_id:e.user_id,location_id:e.location_id,receipt_number:e.receipt_number,customer_name:e.customer_name,customer_address:e.customer_address,customer_contact:e.customer_contact,customer_id:e.customer_id,items:e.items,payment_status:e.payment_status,profit:e.profit?Number(e.profit):0,date:e.date,tax_rate:e.tax_rate||0,created_at:e.created_at,updated_at:e.updated_at,cash_transaction_id:e.cash_transaction_id,amount_paid:e.amount_paid?Number(e.amount_paid):void 0,amount_due:e.amount_due?Number(e.amount_due):void 0,category_id:e.category_id,notes:e.notes};return(0,r.mapDbSaleToSale)(t)}):[]}catch(e){return console.error("Error loading sales:",e),f({title:"Error",description:"Failed to load sales data. Please try again.",variant:"destructive"}),[]}},[e,y?.id,l,c,f]),S=(0,t.useMemo)(()=>["sales",y?.id,e],[y?.id,e]),w=(0,t.useMemo)(()=>[...S,l,c],[S,l,c]),{data:_=[],isLoading:P,isFetching:A,refetch:I}=(0,i.useQuery)({queryKey:w,queryFn:v,enabled:!!e&&!!y?.id,staleTime:3e4,gcTime:18e5,refetchOnWindowFocus:!0,refetchOnReconnect:!0}),E=P||A&&0===_.length,x=(0,t.useMemo)(()=>{let e=_.filter(e=>"Quote"!==e.paymentStatus),t=new Map;return e.forEach(e=>{let r=e.customerName,n=e.items.reduce((e,t)=>e+t.price*t.quantity,0);if(t.has(r)){let i=t.get(r);t.set(r,{total:i.total+n,count:i.count+1,customerId:i.customerId||e.customerId})}else t.set(r,{total:n,count:1,customerId:e.customerId})}),Array.from(t.entries()).map(([e,t])=>({id:t.customerId,name:e,totalPurchases:t.total,orderCount:t.count})).sort((e,t)=>t.totalPurchases-e.totalPurchases)},[_]),C=(0,t.useMemo)(()=>e=>{let t=_.filter(t=>t.customerName.toLowerCase()===e.toLowerCase()&&"Quote"!==t.paymentStatus);return{total:t.reduce((e,t)=>e+t.items.reduce((e,t)=>e+t.price*t.quantity,0),0),count:t.length}},[_]),L=async e=>{try{let t=_.find(t=>t.id===e);if(!t)throw Error("Sale not found");if("Quote"!==t.paymentStatus&&t.items.length>0&&(console.log("Restoring product quantities via useInventoryActions..."),await b(t.items,e,t.receiptNumber,y?.id)||f({title:"Inventory Update Warning",description:"Sale deleted, but inventory restoration might have failed. Please check your stock levels.",variant:"destructive"})),!y?.id)throw Error("Business context missing for deletion");let r=await p(e,y.id);if(!r.success)throw Error(r.error);return d.setQueryData(w,t=>t?t.filter(t=>t.id!==e):[]),d.invalidateQueries({queryKey:S}),z(),await h({activityType:"DELETE",module:"SALES",entityType:"sale",entityId:e,entityName:`Sale #${t.receiptNumber}`,description:`Deleted sale for ${t.customerName} - Total: UGX ${((t.amountPaid||0)+(t.amountDue||0)).toLocaleString()} (Stock restored)`,metadata:{receiptNumber:t.receiptNumber,customerName:t.customerName,customerAddress:t.customerAddress,customerContact:t.customerContact,totalAmount:(t.amountPaid||0)+(t.amountDue||0),amountPaid:t.amountPaid,profit:t.profit,paymentStatus:t.paymentStatus,taxRate:t.taxRate,itemCount:t.items.length,items:t.items.map(e=>({description:e.description,quantity:e.quantity,price:e.price,cost:e.cost,total:e.quantity*e.price,discountPercentage:e.discountPercentage,discountAmount:e.discountAmount})),notes:t.notes,cashTransactionDeleted:!!t.cashTransactionId}}),f({title:"Sale Deleted",description:"The sale record and associated data have been successfully deleted."}),(0,m.clearInventoryCaches)(),!0}catch(e){return console.error("Error deleting sale:",e),f({title:"Error",description:"Failed to delete sale. Please try again.",variant:"destructive"}),!1}},z=(0,t.useCallback)(()=>{if(!y?.id)return;let e=`soldItemsFilters_${y.id}`;localStorage.removeItem(e),localStorage.removeItem("soldItemsFilters")},[y?.id]);return{sales:_,isLoading:E,deleteSale:L,addSale:(0,t.useCallback)(e=>{d.setQueryData(w,t=>t?[e,...t]:[e]),d.invalidateQueries({queryKey:S}),z(),(0,m.clearInventoryCaches)()},[d,w,S,z,m.clearInventoryCaches]),updateSale:(0,t.useCallback)(e=>{d.setQueryData(w,t=>t?t.map(t=>t.id===e.id?e:t):[e]),d.invalidateQueries({queryKey:S}),z(),(0,m.clearInventoryCaches)()},[d,w,S,z,m.clearInventoryCaches]),getTopCustomers:x,getCustomerLifetimePurchases:C,clearSoldItemsCache:z,refetch:I,isFetching:A}}],146786)}]);