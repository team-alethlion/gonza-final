(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,388474,e=>{"use strict";var t=e.i(271645),r=e.i(820783),a=e.i(30030),s=e.i(981140),i=e.i(369340),n=e.i(999682),o=e.i(635804),c=e.i(296626),l=e.i(248425),u=e.i(843476),d="Checkbox",[h,p]=(0,a.createContextScope)(d),[f,m]=h(d);function y(e){let{__scopeCheckbox:r,checked:a,children:s,defaultChecked:n,disabled:o,form:c,name:l,onCheckedChange:h,required:p,value:m="on",internal_do_not_use_render:y}=e,[v,g]=(0,i.useControllableState)({prop:a,defaultProp:n??!1,onChange:h,caller:d}),[b,S]=t.useState(null),[x,w]=t.useState(null),R=t.useRef(!1),E=!b||!!c||!!b.closest("form"),j={checked:v,disabled:o,setChecked:g,control:b,setControl:S,name:l,form:c,value:m,hasConsumerStoppedPropagationRef:R,required:p,defaultChecked:!C(n)&&n,isFormControl:E,bubbleInput:x,setBubbleInput:w};return(0,u.jsx)(f,{scope:r,...j,children:"function"==typeof y?y(j):s})}var v="CheckboxTrigger",g=t.forwardRef(({__scopeCheckbox:e,onKeyDown:a,onClick:i,...n},o)=>{let{control:c,value:d,disabled:h,checked:p,required:f,setControl:y,setChecked:g,hasConsumerStoppedPropagationRef:b,isFormControl:S,bubbleInput:x}=m(v,e),w=(0,r.useComposedRefs)(o,y),R=t.useRef(p);return t.useEffect(()=>{let e=c?.form;if(e){let t=()=>g(R.current);return e.addEventListener("reset",t),()=>e.removeEventListener("reset",t)}},[c,g]),(0,u.jsx)(l.Primitive.button,{type:"button",role:"checkbox","aria-checked":C(p)?"mixed":p,"aria-required":f,"data-state":E(p),"data-disabled":h?"":void 0,disabled:h,value:d,...n,ref:w,onKeyDown:(0,s.composeEventHandlers)(a,e=>{"Enter"===e.key&&e.preventDefault()}),onClick:(0,s.composeEventHandlers)(i,e=>{g(e=>!!C(e)||!e),x&&S&&(b.current=e.isPropagationStopped(),b.current||e.stopPropagation())})})});g.displayName=v;var b=t.forwardRef((e,t)=>{let{__scopeCheckbox:r,name:a,checked:s,defaultChecked:i,required:n,disabled:o,value:c,onCheckedChange:l,form:d,...h}=e;return(0,u.jsx)(y,{__scopeCheckbox:r,checked:s,defaultChecked:i,disabled:o,required:n,onCheckedChange:l,name:a,form:d,value:c,internal_do_not_use_render:({isFormControl:e})=>(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(g,{...h,ref:t,__scopeCheckbox:r}),e&&(0,u.jsx)(R,{__scopeCheckbox:r})]})})});b.displayName=d;var S="CheckboxIndicator",x=t.forwardRef((e,t)=>{let{__scopeCheckbox:r,forceMount:a,...s}=e,i=m(S,r);return(0,u.jsx)(c.Presence,{present:a||C(i.checked)||!0===i.checked,children:(0,u.jsx)(l.Primitive.span,{"data-state":E(i.checked),"data-disabled":i.disabled?"":void 0,...s,ref:t,style:{pointerEvents:"none",...e.style}})})});x.displayName=S;var w="CheckboxBubbleInput",R=t.forwardRef(({__scopeCheckbox:e,...a},s)=>{let{control:i,hasConsumerStoppedPropagationRef:c,checked:d,defaultChecked:h,required:p,disabled:f,name:y,value:v,form:g,bubbleInput:b,setBubbleInput:S}=m(w,e),x=(0,r.useComposedRefs)(s,S),R=(0,n.usePrevious)(d),E=(0,o.useSize)(i);t.useEffect(()=>{if(!b)return;let e=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set,t=!c.current;if(R!==d&&e){let r=new Event("click",{bubbles:t});b.indeterminate=C(d),e.call(b,!C(d)&&d),b.dispatchEvent(r)}},[b,R,d,c]);let j=t.useRef(!C(d)&&d);return(0,u.jsx)(l.Primitive.input,{type:"checkbox","aria-hidden":!0,defaultChecked:h??j.current,required:p,disabled:f,name:y,value:v,form:g,...a,tabIndex:-1,ref:x,style:{...a.style,...E,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});function C(e){return"indeterminate"===e}function E(e){return C(e)?"indeterminate":e?"checked":"unchecked"}R.displayName=w,e.s(["Checkbox",()=>b,"CheckboxIndicator",()=>x,"Indicator",()=>x,"Root",()=>b,"createCheckboxScope",()=>p,"unstable_BubbleInput",()=>R,"unstable_CheckboxBubbleInput",()=>R,"unstable_CheckboxProvider",()=>y,"unstable_CheckboxTrigger",()=>g,"unstable_Provider",()=>y,"unstable_Trigger",()=>g])},257428,e=>{"use strict";var t=e.i(843476),r=e.i(271645),a=e.i(388474),s=e.i(643531),i=e.i(975157);let n=r.forwardRef(({className:e,...r},n)=>(0,t.jsx)(a.Root,{ref:n,className:(0,i.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...r,children:(0,t.jsx)(a.Indicator,{className:(0,i.cn)("flex items-center justify-center text-current"),children:(0,t.jsx)(s.Check,{className:"h-4 w-4"})})}));n.displayName=a.Root.displayName,e.s(["Checkbox",()=>n])},908962,224410,e=>{"use strict";var t=e.i(271645),r=e.i(160615),a=e.i(422713),s=e.i(266027),i=e.i(912598);let n=e=>{let t=Object.keys(localStorage),r=["allProductsStats_","stockSummary_","soldItems_","dashboardData_","analyticsData_"],a=0;t.forEach(e=>{r.some(t=>e.startsWith(t))&&(localStorage.removeItem(e),a++)}),a>0&&console.log(`[Cache] Cleared ${a} inventory-related localStorage entries.`),e&&(console.log("[Cache] Invalidating React Query inventory keys..."),e.invalidateQueries({queryKey:["inventory_global_stats"]}),e.invalidateQueries({queryKey:["stockSummary"]}),e.invalidateQueries({queryKey:["products"]}),e.invalidateQueries({queryKey:["sales"]}),e.invalidateQueries({queryKey:["all-products-for-scanner"]}),e.invalidateQueries({queryKey:["all-products"]}))};e.s(["clearInventoryCaches",0,n],224410);var o=e.i(555781);e.s(["useProducts",0,(e,c=50)=>{let[l,u]=(0,t.useState)([]),[d,h]=(0,t.useState)(1),[p,f]=(0,t.useState)(c),[m,y]=(0,t.useState)(0),[v,g]=(0,t.useState)(!1),{settings:b}=(0,r.useBusinessSettings)(),{currentBusiness:S}=(0,a.useBusiness)(),x=(0,i.useQueryClient)(),[w,R]=(0,t.useState)({search:"",category:"all",stockStatus:"all"}),[C,E]=(0,t.useState)(null),j=(0,t.useCallback)(e=>{e.search!==w.search&&(g(!0),C&&clearTimeout(C),E(setTimeout(()=>{g(!1)},600))),R(e)},[w.search,C]),k=(0,t.useCallback)(async()=>{if(!e||!S)return{products:[],count:0};try{return await (0,o.getProductsAction)({userId:e,businessId:S.id,page:d,pageSize:p,search:w.search,category:"all"===w.category?void 0:w.category,stockStatus:w.stockStatus})}catch(e){return console.error("Error loading products from server action:",e),{products:[],count:0}}},[e,S?.id,d,p,w.search,w.category,w.stockStatus]),T=(0,t.useMemo)(()=>["products",e,S?.id],[e,S?.id]),N=(0,t.useMemo)(()=>[...T,d,p,w.search,w.category,w.stockStatus],[T,d,p,w.search,w.category,w.stockStatus]),{data:I,isLoading:A,isFetching:P,refetch:M}=(0,s.useQuery)({queryKey:N,queryFn:k,enabled:!!e&&!!S?.id,staleTime:3e4,gcTime:18e5,refetchOnWindowFocus:!0,refetchOnReconnect:!0});(0,t.useEffect)(()=>{I&&(u(I.products),y(I.count))},[I]);let L=async t=>{try{if(!e)return null;return console.warn("Image upload redirecting to server action (TODO)"),null}catch(e){return console.error("Error in uploadProductImage:",e),null}};return{products:l,isLoading:A&&!I&&!v,loadProducts:k,page:d,setPage:h,pageSize:p,setPageSize:f,totalCount:m,createProduct:async t=>{try{if(!e||!S)return null;let r=await (0,o.createProductAction)({...t,userId:e,businessId:S.id});if(!r)return null;return u(e=>[r,...e]),y(e=>e+1),x.invalidateQueries({queryKey:T}),n(x),r}catch(e){return console.error("Error creating product:",e),null}},updateProduct:async(t,r,a,s=!1,i,c,l,u)=>{try{if(!e||!S)return!1;let c=r.imageUrl;if(a&&(c=await L(a)),!await (0,o.updateProductAction)(t,{...r,imageUrl:c,userId:e,businessId:S.id,isFromSale:s,customChangeReason:i,referenceId:l}))return!1;return x.invalidateQueries({queryKey:T}),n(x),!0}catch(e){return console.error("Error updating product:",e),!1}},updateProductsBulk:async(t,r,a,s,i,c)=>{try{if(!e||!S)return!1;let r=await (0,o.updateProductsBulkAction)(t.map(e=>({id:e.id,updated:e.updated})),S.id);return r&&(x.invalidateQueries({queryKey:T}),n(x)),r}catch(e){return console.error("Error in bulk update:",e),!1}},deleteProduct:async t=>{try{if(!e)return!1;if(await (0,o.deleteProductAction)(t))return x.invalidateQueries({queryKey:T}),n(x),!0;return!1}catch(e){return console.error("Error deleting product:",e),!1}},uploadProductImage:L,refetch:M,isFetching:P,filters:w,setFilters:j}}],908962)},555781,(e,t,r)=>{let a=Error("Could not parse module '[project]/src/app/actions/products.ts'\n\n'import', and 'export' cannot be used outside of module code");throw a.code="MODULE_UNPARSABLE",a},266027,e=>{"use strict";let t;var r=e.i(175555),a=e.i(540143),s=e.i(286491),i=e.i(915823),n=e.i(793803),o=e.i(619273),c=e.i(180166),l=class extends i.Subscribable{constructor(e,t){super(),this.options=t,this.#e=e,this.#t=null,this.#r=(0,n.pendingThenable)(),this.bindMethods(),this.setOptions(t)}#e;#a=void 0;#s=void 0;#i=void 0;#n;#o;#r;#t;#c;#l;#u;#d;#h;#p;#f=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){1===this.listeners.size&&(this.#a.addObserver(this),u(this.#a,this.options)?this.#m():this.updateResult(),this.#y())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return d(this.#a,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return d(this.#a,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#v(),this.#g(),this.#a.removeObserver(this)}setOptions(e){let t=this.options,r=this.#a;if(this.options=this.#e.defaultQueryOptions(e),void 0!==this.options.enabled&&"boolean"!=typeof this.options.enabled&&"function"!=typeof this.options.enabled&&"boolean"!=typeof(0,o.resolveEnabled)(this.options.enabled,this.#a))throw Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#b(),this.#a.setOptions(this.options),t._defaulted&&!(0,o.shallowEqualObjects)(this.options,t)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#a,observer:this});let a=this.hasListeners();a&&h(this.#a,r,this.options,t)&&this.#m(),this.updateResult(),a&&(this.#a!==r||(0,o.resolveEnabled)(this.options.enabled,this.#a)!==(0,o.resolveEnabled)(t.enabled,this.#a)||(0,o.resolveStaleTime)(this.options.staleTime,this.#a)!==(0,o.resolveStaleTime)(t.staleTime,this.#a))&&this.#S();let s=this.#x();a&&(this.#a!==r||(0,o.resolveEnabled)(this.options.enabled,this.#a)!==(0,o.resolveEnabled)(t.enabled,this.#a)||s!==this.#p)&&this.#w(s)}getOptimisticResult(e){var t,r;let a=this.#e.getQueryCache().build(this.#e,e),s=this.createResult(a,e);return t=this,r=s,(0,o.shallowEqualObjects)(t.getCurrentResult(),r)||(this.#i=s,this.#o=this.options,this.#n=this.#a.state),s}getCurrentResult(){return this.#i}trackResult(e,t){return new Proxy(e,{get:(e,r)=>(this.trackProp(r),t?.(r),"promise"===r&&(this.trackProp("data"),this.options.experimental_prefetchInRender||"pending"!==this.#r.status||this.#r.reject(Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(e,r))})}trackProp(e){this.#f.add(e)}getCurrentQuery(){return this.#a}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){let t=this.#e.defaultQueryOptions(e),r=this.#e.getQueryCache().build(this.#e,t);return r.fetch().then(()=>this.createResult(r,t))}fetch(e){return this.#m({...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#i))}#m(e){this.#b();let t=this.#a.fetch(this.options,e);return e?.throwOnError||(t=t.catch(o.noop)),t}#S(){this.#v();let e=(0,o.resolveStaleTime)(this.options.staleTime,this.#a);if(o.isServer||this.#i.isStale||!(0,o.isValidTimeout)(e))return;let t=(0,o.timeUntilStale)(this.#i.dataUpdatedAt,e);this.#d=c.timeoutManager.setTimeout(()=>{this.#i.isStale||this.updateResult()},t+1)}#x(){return("function"==typeof this.options.refetchInterval?this.options.refetchInterval(this.#a):this.options.refetchInterval)??!1}#w(e){this.#g(),this.#p=e,!o.isServer&&!1!==(0,o.resolveEnabled)(this.options.enabled,this.#a)&&(0,o.isValidTimeout)(this.#p)&&0!==this.#p&&(this.#h=c.timeoutManager.setInterval(()=>{(this.options.refetchIntervalInBackground||r.focusManager.isFocused())&&this.#m()},this.#p))}#y(){this.#S(),this.#w(this.#x())}#v(){this.#d&&(c.timeoutManager.clearTimeout(this.#d),this.#d=void 0)}#g(){this.#h&&(c.timeoutManager.clearInterval(this.#h),this.#h=void 0)}createResult(e,t){let r,a=this.#a,i=this.options,c=this.#i,l=this.#n,d=this.#o,f=e!==a?e.state:this.#s,{state:m}=e,y={...m},v=!1;if(t._optimisticResults){let r=this.hasListeners(),n=!r&&u(e,t),o=r&&h(e,a,t,i);(n||o)&&(y={...y,...(0,s.fetchState)(m.data,e.options)}),"isRestoring"===t._optimisticResults&&(y.fetchStatus="idle")}let{error:g,errorUpdatedAt:b,status:S}=y;r=y.data;let x=!1;if(void 0!==t.placeholderData&&void 0===r&&"pending"===S){let e;c?.isPlaceholderData&&t.placeholderData===d?.placeholderData?(e=c.data,x=!0):e="function"==typeof t.placeholderData?t.placeholderData(this.#u?.state.data,this.#u):t.placeholderData,void 0!==e&&(S="success",r=(0,o.replaceData)(c?.data,e,t),v=!0)}if(t.select&&void 0!==r&&!x)if(c&&r===l?.data&&t.select===this.#c)r=this.#l;else try{this.#c=t.select,r=t.select(r),r=(0,o.replaceData)(c?.data,r,t),this.#l=r,this.#t=null}catch(e){this.#t=e}this.#t&&(g=this.#t,r=this.#l,b=Date.now(),S="error");let w="fetching"===y.fetchStatus,R="pending"===S,C="error"===S,E=R&&w,j=void 0!==r,k={status:S,fetchStatus:y.fetchStatus,isPending:R,isSuccess:"success"===S,isError:C,isInitialLoading:E,isLoading:E,data:r,dataUpdatedAt:y.dataUpdatedAt,error:g,errorUpdatedAt:b,failureCount:y.fetchFailureCount,failureReason:y.fetchFailureReason,errorUpdateCount:y.errorUpdateCount,isFetched:y.dataUpdateCount>0||y.errorUpdateCount>0,isFetchedAfterMount:y.dataUpdateCount>f.dataUpdateCount||y.errorUpdateCount>f.errorUpdateCount,isFetching:w,isRefetching:w&&!R,isLoadingError:C&&!j,isPaused:"paused"===y.fetchStatus,isPlaceholderData:v,isRefetchError:C&&j,isStale:p(e,t),refetch:this.refetch,promise:this.#r,isEnabled:!1!==(0,o.resolveEnabled)(t.enabled,e)};if(this.options.experimental_prefetchInRender){let t=void 0!==k.data,r="error"===k.status&&!t,s=e=>{r?e.reject(k.error):t&&e.resolve(k.data)},i=()=>{s(this.#r=k.promise=(0,n.pendingThenable)())},o=this.#r;switch(o.status){case"pending":e.queryHash===a.queryHash&&s(o);break;case"fulfilled":(r||k.data!==o.value)&&i();break;case"rejected":r&&k.error===o.reason||i()}}return k}updateResult(){let e=this.#i,t=this.createResult(this.#a,this.options);if(this.#n=this.#a.state,this.#o=this.options,void 0!==this.#n.data&&(this.#u=this.#a),(0,o.shallowEqualObjects)(t,e))return;this.#i=t;let r=()=>{if(!e)return!0;let{notifyOnChangeProps:t}=this.options,r="function"==typeof t?t():t;if("all"===r||!r&&!this.#f.size)return!0;let a=new Set(r??this.#f);return this.options.throwOnError&&a.add("error"),Object.keys(this.#i).some(t=>this.#i[t]!==e[t]&&a.has(t))};this.#R({listeners:r()})}#b(){let e=this.#e.getQueryCache().build(this.#e,this.options);if(e===this.#a)return;let t=this.#a;this.#a=e,this.#s=e.state,this.hasListeners()&&(t?.removeObserver(this),e.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#y()}#R(e){a.notifyManager.batch(()=>{e.listeners&&this.listeners.forEach(e=>{e(this.#i)}),this.#e.getQueryCache().notify({query:this.#a,type:"observerResultsUpdated"})})}};function u(e,t){return!1!==(0,o.resolveEnabled)(t.enabled,e)&&void 0===e.state.data&&("error"!==e.state.status||!1!==t.retryOnMount)||void 0!==e.state.data&&d(e,t,t.refetchOnMount)}function d(e,t,r){if(!1!==(0,o.resolveEnabled)(t.enabled,e)&&"static"!==(0,o.resolveStaleTime)(t.staleTime,e)){let a="function"==typeof r?r(e):r;return"always"===a||!1!==a&&p(e,t)}return!1}function h(e,t,r,a){return(e!==t||!1===(0,o.resolveEnabled)(a.enabled,e))&&(!r.suspense||"error"!==e.state.status)&&p(e,r)}function p(e,t){return!1!==(0,o.resolveEnabled)(t.enabled,e)&&e.isStaleByTime((0,o.resolveStaleTime)(t.staleTime,e))}e.i(247167);var f=e.i(271645),m=e.i(912598);e.i(843476);var y=f.createContext((t=!1,{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t})),v=f.createContext(!1);v.Provider;var g=(e,t,r)=>t.fetchOptimistic(e).catch(()=>{r.clearReset()});function b(e,t){return function(e,t,r){let s,i=f.useContext(v),n=f.useContext(y),c=(0,m.useQueryClient)(r),l=c.defaultQueryOptions(e);c.getDefaultOptions().queries?._experimental_beforeQuery?.(l);let u=c.getQueryCache().get(l.queryHash);if(l._optimisticResults=i?"isRestoring":"optimistic",l.suspense){let e=e=>"static"===e?e:Math.max(e??1e3,1e3),t=l.staleTime;l.staleTime="function"==typeof t?(...r)=>e(t(...r)):e(t),"number"==typeof l.gcTime&&(l.gcTime=Math.max(l.gcTime,1e3))}s=u?.state.error&&"function"==typeof l.throwOnError?(0,o.shouldThrowError)(l.throwOnError,[u.state.error,u]):l.throwOnError,(l.suspense||l.experimental_prefetchInRender||s)&&!n.isReset()&&(l.retryOnMount=!1),f.useEffect(()=>{n.clearReset()},[n]);let d=!c.getQueryCache().get(l.queryHash),[h]=f.useState(()=>new t(c,l)),p=h.getOptimisticResult(l),b=!i&&!1!==e.subscribed;if(f.useSyncExternalStore(f.useCallback(e=>{let t=b?h.subscribe(a.notifyManager.batchCalls(e)):o.noop;return h.updateResult(),t},[h,b]),()=>h.getCurrentResult(),()=>h.getCurrentResult()),f.useEffect(()=>{h.setOptions(l)},[l,h]),l?.suspense&&p.isPending)throw g(l,h,n);if((({result:e,errorResetBoundary:t,throwOnError:r,query:a,suspense:s})=>e.isError&&!t.isReset()&&!e.isFetching&&a&&(s&&void 0===e.data||(0,o.shouldThrowError)(r,[e.error,a])))({result:p,errorResetBoundary:n,throwOnError:l.throwOnError,query:u,suspense:l.suspense}))throw p.error;if(c.getDefaultOptions().queries?._experimental_afterQuery?.(l,p),l.experimental_prefetchInRender&&!o.isServer&&p.isLoading&&p.isFetching&&!i){let e=d?g(l,h,n):u?.promise;e?.catch(o.noop).finally(()=>{h.updateResult()})}return l.notifyOnChangeProps?p:h.trackResult(p)}(e,l,t)}e.s(["useQuery",()=>b],266027)},709239,e=>{"use strict";var t=e.i(95187);let r=(0,t.createServerReference)("70837cf9b9b85e45a6367e7e3a592457c34a990d2e",t.callServer,void 0,t.findSourceMapURL,"upsertBusinessSettingsAction");e.s(["upsertBusinessSettingsAction",()=>r])},160615,e=>{"use strict";var t=e.i(271645),r=e.i(266027),a=e.i(908406),s=e.i(422713),i=e.i(95187);let n=(0,i.createServerReference)("40290a4fc6b8571a026afeb877566edb807919e482",i.callServer,void 0,i.findSourceMapURL,"getBusinessSettingsAction");var o=e.i(709239);let c=()=>({businessName:"",businessAddress:"",businessPhone:"",businessEmail:"",currency:"UGX",paymentInfo:"",defaultPrintFormat:"standard"});e.s(["convertPaymentMethodsToString",0,e=>e.filter(e=>""!==e.method.trim()||""!==e.accountNumber.trim()||""!==e.accountName.trim()).map(e=>`${e.method}
${e.accountNumber}
${e.accountName}`).join("\n"),"parsePaymentInfo",0,e=>{if(!e||""===e.trim())return[];let t=e.split("\n").filter(e=>""!==e.trim()),r=[];for(let e=0;e<t.length;e+=3)e+2<t.length&&r.push({method:t[e].trim(),accountNumber:t[e+1].trim(),accountName:t[e+2].trim()});return r},"useBusinessSettings",0,()=>{let[e,i]=(0,t.useState)(c()),[l,u]=(0,t.useState)(!1),{toast:d}=(0,a.useToast)(),{currentBusiness:h}=(0,s.useBusiness)(),p=async()=>{if(!h)return c();try{let e=await n(h.id);if(!e)return c();{let t=e.metadata&&"object"==typeof e.metadata&&e.metadata.payment_info||"";return{id:e.id,businessName:e.business_name||"",businessAddress:e.business_address||"",businessPhone:e.business_phone||"",businessEmail:e.business_email||"",businessLogo:e.business_logo||void 0,currency:e.currency||"UGX",signature:e.signature||void 0,paymentInfo:t,defaultPrintFormat:e.metadata&&"object"==typeof e.metadata&&e.metadata.default_print_format||"standard",defaultPrinterName:e.metadata&&"object"==typeof e.metadata&&e.metadata.default_printer_name||"",defaultPrinterType:e.metadata&&"object"==typeof e.metadata&&e.metadata.default_printer_type||"USB",printerPaperSize:e.metadata&&"object"==typeof e.metadata&&e.metadata.printer_paper_size||"58mm"}}}catch(e){return console.error("Error loading business settings:",e),d({title:"Error",description:"Failed to load business settings. Please try again.",variant:"destructive"}),c()}},f=async t=>{if(!h)return console.error("No business selected for updating settings"),d({title:"Error",description:"No business selected",variant:"destructive"}),!1;try{let r={payment_info:t.hasOwnProperty("paymentInfo")?t.paymentInfo:e.paymentInfo||"",default_print_format:t.hasOwnProperty("defaultPrintFormat")?t.defaultPrintFormat:e.defaultPrintFormat||"standard",default_printer_name:t.hasOwnProperty("defaultPrinterName")?t.defaultPrinterName:e.defaultPrinterName||"",default_printer_type:t.hasOwnProperty("defaultPrinterType")?t.defaultPrinterType:e.defaultPrinterType||"USB",printer_paper_size:t.hasOwnProperty("printerPaperSize")?t.printerPaperSize:e.printerPaperSize||"58mm"},a={business_name:t.hasOwnProperty("businessName")?t.businessName:e.businessName,business_address:t.hasOwnProperty("businessAddress")?t.businessAddress:e.businessAddress,business_phone:t.hasOwnProperty("businessPhone")?t.businessPhone:e.businessPhone,business_email:t.hasOwnProperty("businessEmail")?t.businessEmail:e.businessEmail,business_logo:t.hasOwnProperty("businessLogo")?t.businessLogo:e.businessLogo,currency:t.hasOwnProperty("currency")?t.currency:e.currency,signature:t.hasOwnProperty("signature")?t.signature:e.signature,metadata:r},s=await (0,o.upsertBusinessSettingsAction)(h.id,"00000000-0000-0000-0000-000000000000",a);if(!s.success)throw console.error("Supabase error updating business settings:",s.error),Error(s.error);return d({title:"Success",description:"Business settings updated successfully"}),g(),!0}catch(e){return console.error("Error updating business settings:",e),d({title:"Error",description:"Failed to update business settings. Please try again.",variant:"destructive"}),!1}},{data:m,isLoading:y,isFetching:v,refetch:g}=(0,r.useQuery)({queryKey:["businessSettings",h?.id],queryFn:p,enabled:!!h?.id,staleTime:3e5,gcTime:18e5,refetchOnWindowFocus:!1,refetchOnReconnect:!1});return(0,t.useEffect)(()=>{m?i(m):h||i(c())},[m,h]),(0,t.useEffect)(()=>{u(y||v)},[y,v]),{settings:e,isLoading:l,updateSettings:f,loadSettings:p}}],160615)},63209,e=>{"use strict";let t=(0,e.i(475254).default)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);e.s(["AlertCircle",()=>t],63209)},303281,e=>{"use strict";let t=(0,e.i(475254).default)("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]);e.s(["Printer",()=>t],303281)},871689,e=>{"use strict";let t=(0,e.i(475254).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>t],871689)},57287,e=>{"use strict";var t=e.i(271645),r=e.i(981140),a=e.i(820783),s=e.i(30030),i=e.i(369340),n=e.i(999682),o=e.i(635804),c=e.i(248425),l=e.i(843476),u="Switch",[d,h]=(0,s.createContextScope)(u),[p,f]=d(u),m=t.forwardRef((e,s)=>{let{__scopeSwitch:n,name:o,checked:d,defaultChecked:h,required:f,disabled:m,value:y="on",onCheckedChange:v,form:S,...x}=e,[w,R]=t.useState(null),C=(0,a.useComposedRefs)(s,e=>R(e)),E=t.useRef(!1),j=!w||S||!!w.closest("form"),[k,T]=(0,i.useControllableState)({prop:d,defaultProp:h??!1,onChange:v,caller:u});return(0,l.jsxs)(p,{scope:n,checked:k,disabled:m,children:[(0,l.jsx)(c.Primitive.button,{type:"button",role:"switch","aria-checked":k,"aria-required":f,"data-state":b(k),"data-disabled":m?"":void 0,disabled:m,value:y,...x,ref:C,onClick:(0,r.composeEventHandlers)(e.onClick,e=>{T(e=>!e),j&&(E.current=e.isPropagationStopped(),E.current||e.stopPropagation())})}),j&&(0,l.jsx)(g,{control:w,bubbles:!E.current,name:o,value:y,checked:k,required:f,disabled:m,form:S,style:{transform:"translateX(-100%)"}})]})});m.displayName=u;var y="SwitchThumb",v=t.forwardRef((e,t)=>{let{__scopeSwitch:r,...a}=e,s=f(y,r);return(0,l.jsx)(c.Primitive.span,{"data-state":b(s.checked),"data-disabled":s.disabled?"":void 0,...a,ref:t})});v.displayName=y;var g=t.forwardRef(({__scopeSwitch:e,control:r,checked:s,bubbles:i=!0,...c},u)=>{let d=t.useRef(null),h=(0,a.useComposedRefs)(d,u),p=(0,n.usePrevious)(s),f=(0,o.useSize)(r);return t.useEffect(()=>{let e=d.current;if(!e)return;let t=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(p!==s&&t){let r=new Event("click",{bubbles:i});t.call(e,s),e.dispatchEvent(r)}},[p,s,i]),(0,l.jsx)("input",{type:"checkbox","aria-hidden":!0,defaultChecked:s,...c,tabIndex:-1,ref:h,style:{...c.style,...f,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});function b(e){return e?"checked":"unchecked"}g.displayName="SwitchBubbleInput",e.s(["Root",()=>m,"Switch",()=>m,"SwitchThumb",()=>v,"Thumb",()=>v,"createSwitchScope",()=>h])},699375,e=>{"use strict";var t=e.i(843476),r=e.i(271645),a=e.i(57287),s=e.i(975157);let i=r.forwardRef(({className:e,...r},i)=>(0,t.jsx)(a.Root,{className:(0,s.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",e),...r,ref:i,children:(0,t.jsx)(a.Thumb,{className:(0,s.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));i.displayName=a.Root.displayName,e.s(["Switch",()=>i])},929592,e=>{"use strict";var t=e.i(843476),r=e.i(271645),a=e.i(225913),s=e.i(975157);let i=(0,a.cva)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),n=r.forwardRef(({className:e,variant:r,...a},n)=>(0,t.jsx)("div",{ref:n,role:"alert",className:(0,s.cn)(i({variant:r}),e),...a}));n.displayName="Alert";let o=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)("h5",{ref:a,className:(0,s.cn)("mb-1 font-medium leading-none tracking-tight",e),...r}));o.displayName="AlertTitle";let c=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)("div",{ref:a,className:(0,s.cn)("text-sm [&_p]:leading-relaxed",e),...r}));c.displayName="AlertDescription",e.s(["Alert",()=>n,"AlertDescription",()=>c,"AlertTitle",()=>o])},286536,e=>{"use strict";let t=(0,e.i(475254).default)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Eye",()=>t],286536)},77705,e=>{"use strict";let t=(0,e.i(475254).default)("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);e.s(["EyeOff",()=>t],77705)},367240,e=>{"use strict";let t=(0,e.i(475254).default)("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);e.s(["RotateCcw",()=>t],367240)},107308,e=>{"use strict";var t=e.i(271645),r=e.i(981140),a=e.i(30030),s=e.i(369340),i=e.i(934620),n=e.i(820783),o=e.i(248425),c=e.i(296626),l=e.i(610772),u=e.i(843476),d="Collapsible",[h,p]=(0,a.createContextScope)(d),[f,m]=h(d),y=t.forwardRef((e,r)=>{let{__scopeCollapsible:a,open:i,defaultOpen:n,disabled:c,onOpenChange:h,...p}=e,[m,y]=(0,s.useControllableState)({prop:i,defaultProp:n??!1,onChange:h,caller:d});return(0,u.jsx)(f,{scope:a,disabled:c,contentId:(0,l.useId)(),open:m,onOpenToggle:t.useCallback(()=>y(e=>!e),[y]),children:(0,u.jsx)(o.Primitive.div,{"data-state":w(m),"data-disabled":c?"":void 0,...p,ref:r})})});y.displayName=d;var v="CollapsibleTrigger",g=t.forwardRef((e,t)=>{let{__scopeCollapsible:a,...s}=e,i=m(v,a);return(0,u.jsx)(o.Primitive.button,{type:"button","aria-controls":i.contentId,"aria-expanded":i.open||!1,"data-state":w(i.open),"data-disabled":i.disabled?"":void 0,disabled:i.disabled,...s,ref:t,onClick:(0,r.composeEventHandlers)(e.onClick,i.onOpenToggle)})});g.displayName=v;var b="CollapsibleContent",S=t.forwardRef((e,t)=>{let{forceMount:r,...a}=e,s=m(b,e.__scopeCollapsible);return(0,u.jsx)(c.Presence,{present:r||s.open,children:({present:e})=>(0,u.jsx)(x,{...a,ref:t,present:e})})});S.displayName=b;var x=t.forwardRef((e,r)=>{let{__scopeCollapsible:a,present:s,children:c,...l}=e,d=m(b,a),[h,p]=t.useState(s),f=t.useRef(null),y=(0,n.useComposedRefs)(r,f),v=t.useRef(0),g=v.current,S=t.useRef(0),x=S.current,R=d.open||h,C=t.useRef(R),E=t.useRef(void 0);return t.useEffect(()=>{let e=requestAnimationFrame(()=>C.current=!1);return()=>cancelAnimationFrame(e)},[]),(0,i.useLayoutEffect)(()=>{let e=f.current;if(e){E.current=E.current||{transitionDuration:e.style.transitionDuration,animationName:e.style.animationName},e.style.transitionDuration="0s",e.style.animationName="none";let t=e.getBoundingClientRect();v.current=t.height,S.current=t.width,C.current||(e.style.transitionDuration=E.current.transitionDuration,e.style.animationName=E.current.animationName),p(s)}},[d.open,s]),(0,u.jsx)(o.Primitive.div,{"data-state":w(d.open),"data-disabled":d.disabled?"":void 0,id:d.contentId,hidden:!R,...l,ref:y,style:{"--radix-collapsible-content-height":g?`${g}px`:void 0,"--radix-collapsible-content-width":x?`${x}px`:void 0,...e.style},children:R&&c})});function w(e){return e?"open":"closed"}e.s(["Collapsible",()=>y,"CollapsibleContent",()=>S,"CollapsibleTrigger",()=>g],107308)},304228,e=>{"use strict";var t=e.i(271645),r=e.i(422713),a=e.i(777624),s=e.i(266027),i=e.i(912598),n=e.i(908406),o=e.i(95187);let c=(0,o.createServerReference)("600b97f3c90242ca4be1574d304e260e5e07e3c8cf",o.callServer,void 0,o.findSourceMapURL,"getMessagesAction"),l=(0,o.createServerReference)("40fae8e3cd20e274d8835c219996fbcfcdde06446f",o.callServer,void 0,o.findSourceMapURL,"createMessageAction"),u=(0,o.createServerReference)("608c56e751f1517abf78af3f8f4b1eb817c5efcecc",o.callServer,void 0,o.findSourceMapURL,"getMessageTemplatesAction"),d=(0,o.createServerReference)("4012401c60d205ed481a496ad745ca64dfad82e200",o.callServer,void 0,o.findSourceMapURL,"createMessageTemplateAction"),h=(0,o.createServerReference)("60a4c2261958cabb4ed4ad155b1559b15bd9b1c7a3",o.callServer,void 0,o.findSourceMapURL,"updateMessageTemplateAction"),p=(0,o.createServerReference)("406dfcb8705c888c32dc2bb1380b80464b3977c05d",o.callServer,void 0,o.findSourceMapURL,"deleteMessageTemplateAction");e.s(["useMessages",0,e=>{let[o,f]=(0,t.useState)([]),[m,y]=(0,t.useState)([]),[v,g]=(0,t.useState)([]),[b,S]=(0,t.useState)(0),{currentBusiness:x}=(0,r.useBusiness)(),{currentProfile:w}=(0,a.useProfiles)(),R=(0,i.useQueryClient)(),C=async()=>{w?.sms_credits!==void 0&&S(w.sms_credits)},E=async t=>{if(!e||!x?.id)return null;try{let r=await d({userId:e,locationId:x.id,name:t.name,content:t.content,category:t.category,variables:t.variables,isDefault:t.isDefault});if(r.success&&r.data)return P(),r.data;throw Error(r.error)}catch(e){return console.error("Error creating template:",e),(0,n.toast)({title:"Error",description:"Failed to create template",variant:"destructive"}),null}},j=async(e,t)=>{try{let r=await h(e,t);if(r.success)P();else throw Error(r.error)}catch(e){console.error("Error updating template:",e),(0,n.toast)({title:"Error",description:"Failed to update template",variant:"destructive"})}},k=async e=>{try{let t=await p(e);if(t.success)y(t=>t.filter(t=>t.id!==e));else throw Error(t.error)}catch(e){console.error("Error deleting template:",e),(0,n.toast)({title:"Error",description:"Failed to delete template",variant:"destructive"})}},T=(0,t.useCallback)(async()=>{if(!e||!x?.id)return[];try{let t=await c(e,x.id);if(t.success&&t.data)return t.data;return[]}catch(e){return console.error("Error fetching messages:",e),[]}},[e,x?.id]),N=["messages",e,x?.id],{data:I,isLoading:A}=(0,s.useQuery)({queryKey:N,queryFn:T,enabled:!!e&&!!x?.id});(0,t.useEffect)(()=>{I&&f(I)},[I]);let P=async()=>{if(e&&x?.id)try{let t=await u(e,x.id);t.success&&t.data&&y(t.data)}catch(e){console.error("Error fetching templates:",e)}},M=async()=>{g([])},L=async t=>{let r;if(!e||!x?.id||!w)return null;let a=(r=t.phoneNumber.replace(/[\s\-\(\)]/g,"")).startsWith("+")?r:r.startsWith("256")?"+"+r:r.startsWith("0")?"+256"+r.substring(1):(9===r.length&&r.match(/^[7]\d{8}$/),"+256"+r),s=Math.ceil(t.content.length/160);if(w.sms_credits<s)return(0,n.toast)({title:"Error",description:"Insufficient credits",variant:"destructive"}),null;try{let r=await l({userId:e,locationId:x.id,profileId:w.id,customerId:t.customerId,phoneNumber:a,content:t.content,templateId:t.templateId,smsCreditsUsed:s,status:"sent",metadata:t.metadata});if(r.success&&r.data){let e={...r.data,createdAt:r.data.createdAt.toISOString()};return f(t=>[e,...t]),R.invalidateQueries({queryKey:N}),(0,n.toast)({title:"Success",description:"Message sent successfully"}),e}throw Error(r.error)}catch(e){return console.error("Error sending message:",e),(0,n.toast)({title:"Error",description:"Failed to send message",variant:"destructive"}),null}},_=async e=>{let t=0;for(let r of e.customerIds)t++;return{success:t,failed:0,errors:[]}},D=async(e,t)=>((0,n.toast)({title:"Info",description:"Credit purchase migration in progress"}),null);return(0,t.useEffect)(()=>{e&&x?.id&&(P(),M(),C())},[e,x?.id,w?.id]),{messages:o,templates:m,purchases:v,liveCredits:b,isLoading:A&&!I,createMessage:L,createBulkMessages:_,createTemplate:E,updateTemplate:j,deleteTemplate:k,getMessageStats:()=>{let e=o.length,t=o.filter(e=>"sent"===e.status||"delivered"===e.status).length,r=o.filter(e=>"failed"===e.status).length;return{total:e,sent:t,failed:r,pending:o.filter(e=>"pending"===e.status).length,totalCreditsUsed:o.reduce((e,t)=>e+t.smsCreditsUsed,0),creditsRemaining:b}},initiateCreditPurchase:D,refresh:()=>{R.invalidateQueries({queryKey:N}),P(),M(),C()}}}],304228)},966265,e=>{"use strict";var t=e.i(271645),r=e.i(908406),a=e.i(422713),s=e.i(102594),i=e.i(266027),n=e.i(912598),o=e.i(95187);let c=(0,o.createServerReference)("408055c65091de6e86656304d04a002881aed3acc6",o.callServer,void 0,o.findSourceMapURL,"getCashAccountsAction"),l=(0,o.createServerReference)("40fec0c16d5b967e0b7b13b4f39e9f33caa55d98fd",o.callServer,void 0,o.findSourceMapURL,"createCashAccountAction"),u=(0,o.createServerReference)("60cff6e1bde4cdde91ed3aaa29411ed65f1ac6b8ba",o.callServer,void 0,o.findSourceMapURL,"updateCashAccountAction"),d=(0,o.createServerReference)("609fff12b333f8481f6eaa00c9f6ed0ca7485d5f62",o.callServer,void 0,o.findSourceMapURL,"deleteCashAccountAction"),h=(0,o.createServerReference)("701a700c12f80accdeeab232d537f79439d8fe9e50",o.callServer,void 0,o.findSourceMapURL,"deleteCashAccountWithTransactionsAction"),p=(0,o.createServerReference)("60a22285198ef838d83b1b4a602809518cbd22267e",o.callServer,void 0,o.findSourceMapURL,"getCashAccountBalanceAction");e.s(["useCashAccounts",0,()=>{let[e,o]=(0,t.useState)([]),{toast:f}=(0,r.useToast)(),{currentBusiness:m}=(0,a.useBusiness)(),{user:y}=(0,s.useAuth)(),v=(0,n.useQueryClient)(),g=(0,t.useCallback)(async()=>{if(!m?.id)return[];try{let e=await c(m.id);if(!e.success||!e.data)throw Error(e.error||"Failed to fetch accounts");return e.data.map(e=>({...e,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)}))}catch(e){return console.error("Error loading cash accounts:",e),f({title:"Error",description:"Failed to load cash accounts",variant:"destructive"}),[]}},[m?.id,f]),b=["cash_accounts",m?.id],{data:S,isLoading:x}=(0,i.useQuery)({queryKey:b,queryFn:g,enabled:!!m?.id,staleTime:3e4});(0,t.useEffect)(()=>{S&&o(S)},[S]);let w=x&&!S,R=(0,t.useCallback)(()=>{v.invalidateQueries({queryKey:b})},[v,b]),C=(0,t.useCallback)(async e=>{if(!m?.id||!y?.id)return null;try{let t=await l({...e,userId:y.id,locationId:m.id});if(!t.success||!t.data)throw Error(t.error);return v.invalidateQueries({queryKey:b}),f({title:"Success",description:"Cash account created successfully"}),t.data}catch(e){return console.error("Error creating cash account:",e),f({title:"Error",description:"Failed to create cash account",variant:"destructive"}),null}},[m?.id,y?.id,v,b,f]),E=async(e,t)=>{if(!m?.id)return!1;try{let r=await u(e,{...t,locationId:m.id});if(!r.success)throw Error(r.error);return v.invalidateQueries({queryKey:b}),f({title:"Success",description:"Cash account updated successfully"}),!0}catch(e){return console.error("Error updating cash account:",e),f({title:"Error",description:"Failed to update cash account",variant:"destructive"}),!1}},j=async(e,t)=>{if(!m?.id)return{success:!1,hasTransactions:!1};try{let r=await d(e,m.id);return r.success&&(v.invalidateQueries({queryKey:b}),f({title:"Success",description:"Cash account deleted successfully"}),t&&t()),r}catch(e){return console.error("Error deleting cash account:",e),f({title:"Error",description:"Failed to delete cash account",variant:"destructive"}),{success:!1,hasTransactions:!1}}},k=async(e,t=!1,r)=>{if(!m?.id)return!1;try{let a=await h(e,m.id,t);if(!a.success)throw Error(a.error);return v.invalidateQueries({queryKey:b}),f({title:"Success",description:t?"Account and transactions deleted":"Account deleted (records unlinked)"}),r&&r(),!0}catch(e){return console.error("Error deleting cash account:",e),f({title:"Error",description:"Failed to delete cash account",variant:"destructive"}),!1}},T=(0,t.useCallback)(async e=>{if(!m?.id)return 0;try{let t=await p(e,m.id);if(t.success)return t.data;return 0}catch(e){return console.error("Error getting balance:",e),0}},[m?.id]);return(0,t.useMemo)(()=>({accounts:e,isLoading:w,createAccount:C,updateAccount:E,deleteAccount:j,deleteAccountWithTransactions:k,getAccountBalance:T,loadAccounts:g,refreshAccounts:R}),[e,w,C,E,j,k,T,g,R])}],966265)},98363,e=>{"use strict";var t=e.i(271645),r=e.i(102594),a=e.i(422713),s=e.i(908406),i=e.i(266027),n=e.i(912598);let o=e=>({id:e.id,accountId:e.account_id,amount:Number(e.amount),transactionType:e.transaction_type,category:e.category,description:e.description,personInCharge:e.person_in_charge,tags:e.tags,date:new Date(e.date),paymentMethod:e.payment_method,receiptImage:e.receipt_image,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)});var c=e.i(95187);let l=(0,c.createServerReference)("6050d5e4425dec9de12384682af8632685a43503f6",c.callServer,void 0,c.findSourceMapURL,"getCashTransactionsAction"),u=(0,c.createServerReference)("4064724fc471e698ee76d294a980e2a65c0a9c856a",c.callServer,void 0,c.findSourceMapURL,"createCashTransactionAction"),d=(0,c.createServerReference)("60e4c60d7aa378a229209542057eb77c66409f1850",c.callServer,void 0,c.findSourceMapURL,"updateCashTransactionAction"),h=(0,c.createServerReference)("605e333b82184dfc91eaa2d1fe6090163e41e2aa78",c.callServer,void 0,c.findSourceMapURL,"deleteCashTransactionAction"),p=(0,c.createServerReference)("60233cf66a8bd607780138afb600e5b4300ab3ce36",c.callServer,void 0,c.findSourceMapURL,"getAccountOpeningBalanceAction"),f=(0,c.createServerReference)("402f81bafe02611b5b5687b2b85c12e36ea9604ccf",c.callServer,void 0,c.findSourceMapURL,"createBulkCashTransactionsAction");e.s(["useCashTransactions",0,e=>{let{user:c}=(0,r.useAuth)(),{currentBusiness:m}=(0,a.useBusiness)(),{toast:y}=(0,s.useToast)(),v=(0,n.useQueryClient)(),g=(0,t.useCallback)(async()=>{try{if(!c||!m)return[];let t=await l(m.id,e);if(!t.success||!t.data)throw Error(t.error||"Failed to fetch transactions");let r=t.data.map(e=>{let t={id:e.id,user_id:e.user_id,account_id:e.account_id,amount:Number(e.amount),transaction_type:e.transaction_type,category:e.category,description:e.description,person_in_charge:e.person_in_charge,tags:e.tags,date:e.date,payment_method:e.payment_method,receipt_image:e.receipt_image,created_at:e.created_at,updated_at:e.updated_at};return o(t)});return r.sort((e,t)=>{let r=new Date(t.date).getTime()-new Date(e.date).getTime();return 0!==r?r:new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()}),r}catch(e){return console.error("Error loading cash transactions:",e),y({title:"Error",description:"Failed to load cash transactions",variant:"destructive"}),[]}},[c,m?.id,e,y]),b=(0,t.useMemo)(()=>["cash_transactions",m?.id,c?.id,e],[m?.id,c?.id,e]),{data:S=[],isLoading:x}=(0,i.useQuery)({queryKey:b,queryFn:g,enabled:!!c&&!!m?.id,staleTime:3e4}),w=x&&0===S.length,R=async e=>{try{if(!c||!m)throw Error("User not authenticated");let t=await u({...e,userId:c.id,locationId:m.id});if(!t.success)throw Error(t.error);return y({title:"Success",description:"transfer"===e.transactionType?"Transfer completed successfully":"Cash transaction created successfully"}),v.invalidateQueries({queryKey:b}),Array.isArray(t.data)?o(t.data[0]):o(t.data)}catch(e){throw console.error("Error creating cash transaction:",e),y({title:"Error",description:"Failed to create cash transaction",variant:"destructive"}),e}},C=async e=>{try{if(!c||!m)throw Error("User not authenticated");let t=e.map(e=>({...e,userId:c.id,locationId:m.id})),r=await f(t);if(!r.success)throw Error(r.error);return y({title:"Success",description:`Successfully created ${e.length} transactions`}),v.invalidateQueries({queryKey:b}),r.data.map(e=>o(e))}catch(e){throw console.error("Error creating bulk transactions:",e),y({title:"Error",description:"Failed to create bulk transactions",variant:"destructive"}),e}},E=async(e,t)=>{try{let r=await d(e,t);if(!r.success)throw Error(r.error);return y({title:"Success",description:"Transaction updated successfully"}),v.invalidateQueries({queryKey:b}),o(r.data)}catch(e){return console.error("Error updating cash transaction:",e),y({title:"Error",description:"Failed to update transaction",variant:"destructive"}),null}},j=async(e,t)=>{try{if(!m)throw Error("No business selected");let r=await h(e,m.id);if(!r.success)throw Error(r.error);return y({title:"Success",description:"Cash transaction deleted successfully"}),v.invalidateQueries({queryKey:b}),t&&t(),!0}catch(e){return console.error("Error deleting cash transaction:",e),y({title:"Error",description:"Failed to delete cash transaction",variant:"destructive"}),!1}},k=(0,t.useCallback)(async e=>{try{if(!m)return 0;let t=await p(e,m.id);return t.success?t.data:0}catch(e){return 0}},[m?.id]),T=(0,t.useCallback)(async(e,t)=>{let r=e.toISOString().split("T")[0],a=S.filter(e=>e.date.toISOString().split("T")[0]===r);t&&(a=a.filter(e=>e.accountId===t));let s=a.filter(e=>"cash_in"===e.transactionType||"transfer_in"===e.transactionType).reduce((e,t)=>e+t.amount,0),i=a.filter(e=>"cash_out"===e.transactionType||"transfer_out"===e.transactionType).reduce((e,t)=>e+t.amount,0),n=a.filter(e=>"transfer_in"===e.transactionType).reduce((e,t)=>e+t.amount,0),o=a.filter(e=>"transfer_out"===e.transactionType).reduce((e,t)=>e+t.amount,0),c=new Date(e);c.setDate(c.getDate()-1);let l=c.toISOString().split("T")[0],u=S.filter(e=>e.date.toISOString().split("T")[0]<=l);t&&(u=u.filter(e=>e.accountId===t));let d=u.filter(e=>"cash_in"===e.transactionType||"transfer_in"===e.transactionType).reduce((e,t)=>e+t.amount,0),h=u.filter(e=>"cash_out"===e.transactionType||"transfer_out"===e.transactionType).reduce((e,t)=>e+t.amount,0),p=0;t&&(p=await k(t));let f=p+d-h;return{date:e,openingBalance:f,cashIn:s,cashOut:i,transfersIn:n,transfersOut:o,closingBalance:f+s-i}},[S,k]),N=(0,t.useCallback)(async(e,t,r)=>{let a=e.toISOString().split("T")[0],s=t.toISOString().split("T")[0],i=S.filter(e=>{let t=e.date.toISOString().split("T")[0];return t>=a&&t<=s});r&&(i=i.filter(e=>e.accountId===r));let n=i.filter(e=>"cash_in"===e.transactionType||"transfer_in"===e.transactionType).reduce((e,t)=>e+t.amount,0),o=i.filter(e=>"cash_out"===e.transactionType||"transfer_out"===e.transactionType).reduce((e,t)=>e+t.amount,0),c=i.filter(e=>"transfer_in"===e.transactionType).reduce((e,t)=>e+t.amount,0),l=i.filter(e=>"transfer_out"===e.transactionType).reduce((e,t)=>e+t.amount,0),u=new Date(e);u.setDate(u.getDate()-1);let d=u.toISOString().split("T")[0],h=S.filter(e=>e.date.toISOString().split("T")[0]<=d);r&&(h=h.filter(e=>e.accountId===r));let p=h.filter(e=>"cash_in"===e.transactionType||"transfer_in"===e.transactionType).reduce((e,t)=>e+t.amount,0),f=h.filter(e=>"cash_out"===e.transactionType||"transfer_out"===e.transactionType).reduce((e,t)=>e+t.amount,0),m=0;r&&(m=await k(r));let y=m+p-f;return{date:e,openingBalance:y,cashIn:n,cashOut:o,transfersIn:c,transfersOut:l,closingBalance:y+n-o}},[S,k]),I=(0,t.useCallback)(()=>{v.invalidateQueries({queryKey:b})},[v,b]);return(0,t.useMemo)(()=>({transactions:S,isLoading:w,createTransaction:R,createBulkTransactions:C,updateTransaction:E,deleteTransaction:j,getDailySummary:T,getDateRangeSummary:N,refreshTransactions:I}),[S,w,R,C,E,j,T,N,I])}],98363)},830999,e=>{"use strict";var t=e.i(271645),r=e.i(422713),a=e.i(908406),s=e.i(102594),i=e.i(95187);let n=(0,i.createServerReference)("40d192c7133b72d6eb22105e9bdccca4dd09d6c312",i.callServer,void 0,i.findSourceMapURL,"getSalesCategoriesAction"),o=(0,i.createServerReference)("78f34606537592502556e5eff8bf435c75821848df",i.callServer,void 0,i.findSourceMapURL,"createSalesCategoryAction"),c=(0,i.createServerReference)("601c76a41759792ff7ede8d55df9ffa468b0da22c2",i.callServer,void 0,i.findSourceMapURL,"updateSalesCategoryAction"),l=(0,i.createServerReference)("4048df543ea89e6b499e78c5496b2ff9ac8b3367ff",i.callServer,void 0,i.findSourceMapURL,"deleteSalesCategoryAction");e.s(["useSalesCategories",0,()=>{let[e,i]=(0,t.useState)([]),[u,d]=(0,t.useState)(!0),{currentBusiness:h}=(0,r.useBusiness)(),{user:p}=(0,s.useAuth)(),f=async()=>{if(!h){i([]),d(!1);return}try{let e=await n(h.id);if(e.success&&e.data)i(e.data);else throw Error(e.error)}catch(e){console.error("Error fetching sales categories:",e),(0,a.toast)({title:"Error",description:"Failed to fetch sales categories",variant:"destructive"})}finally{d(!1)}};return(0,t.useEffect)(()=>{f()},[h]),{categories:e,isLoading:u,createCategory:async e=>{if(!h||!p)return(0,a.toast)({title:"Error",description:"No business selected or user not authenticated",variant:"destructive"}),!1;try{let t=await o(h.id,p.id,e);if(t.success)return(0,a.toast)({title:"Success",description:"Sales category created successfully"}),f(),!0;throw Error(t.error)}catch(e){return console.error("Error creating sales category:",e),(0,a.toast)({title:"Error",description:"Failed to create sales category",variant:"destructive"}),!1}},updateCategory:async(e,t)=>{try{let r=await c(e,t);if(r.success)return(0,a.toast)({title:"Success",description:"Sales category updated successfully"}),f(),!0;throw Error(r.error)}catch(e){return console.error("Error updating sales category:",e),(0,a.toast)({title:"Error",description:"Failed to update sales category",variant:"destructive"}),!1}},deleteCategory:async e=>{try{let t=await l(e);if(t.success)return(0,a.toast)({title:"Success",description:"Sales category deleted successfully"}),f(),!0;throw Error(t.error)}catch(e){return console.error("Error deleting sales category:",e),(0,a.toast)({title:"Error",description:"Failed to delete sales category",variant:"destructive"}),!1}},createDefaultCategories:async()=>{if(h&&p)try{for(let e of["Retail","Online","Wholesale"])await o(h.id,p.id,e,!0);f()}catch(e){console.error("Error creating default categories:",e)}},refetch:f}}],830999)},503116,e=>{"use strict";let t=(0,e.i(475254).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);e.s(["Clock",()=>t],503116)},44686,e=>{"use strict";var t=e.i(271645),r=e.i(422713),a=e.i(37451),s=e.i(654550),i=e.i(172720),n=e.i(489855),o=e.i(933289),c=e.i(752304),l=e.i(634076);e.s(["useStockHistory",0,(e,u)=>{let[d,h]=(0,t.useState)([]),[p,f]=(0,t.useState)(!0),{currentBusiness:m}=(0,r.useBusiness)(),y=(0,t.useCallback)(async()=>{if(!e||!m){h([]),f(!1);return}try{f(!0);let e=await (0,a.getStockHistoryAction)(m.id,u);if(!e.success||!e.data)throw Error(e.error||"Failed to fetch stock history");let t=e.data.map(e=>({id:e.id,productId:e.productId,oldQuantity:e.oldQuantity,newQuantity:e.newQuantity,changeReason:e.changeReason,createdAt:new Date(e.createdAt),referenceId:e.referenceId,receiptNumber:e.receiptNumber,product:e.product}));h(t)}catch(e){console.error("Error loading stock history:",e)}finally{f(!1)}},[e,m?.id,u]);return(0,t.useEffect)(()=>{y()},[y]),{stockHistory:d,isLoading:p,createStockHistoryEntry:async(t,r,a,i,n,o,c,l)=>{try{if(!e||!m)return!1;let u=l?`[${l}] | ${i}`:i,d=await (0,s.createStockHistoryAction)({userId:e,locationId:m.id,productId:t,previousQuantity:r,newQuantity:a,changeReason:u,referenceId:n,receiptNumber:c,createdAt:o?.toISOString()});if(!d.success)return console.error("Error creating stock history entry:",d.error),!1;return await y(),!0}catch(e){return console.error("Error creating stock history:",e),!1}},deleteMultipleStockHistoryEntriesByReference:async e=>{try{if(!m)return!1;let t=await (0,n.deleteStockHistoryEntriesByReferenceAction)(e,m.id);if(!t.success)throw Error(t.error);return await y(),!0}catch(e){return console.error("Error deleting stock history entries:",e),!1}},recalculateStockChain:async e=>{try{if(!m)return!1;let t=await (0,i.recalculateStockChainAction)(e,m.id);if(!t.success)throw Error(t.error);return await y(),!0}catch(e){return console.error("Error recalculating stock chain:",e),!1}},updateStockHistoryDatesBySaleId:async(e,t)=>{try{if(!m)return!1;let r=await (0,o.updateStockHistoryDatesByReferenceAction)(e,m.id,t.toISOString());if(!r.success)throw Error(r.error);return await y(),!0}catch(e){return console.error("Error updating stock history dates:",e),!1}},repairAllStockChains:async e=>{try{if(!m)return{repaired:0,failed:0};let e=await (0,c.repairStockChainsAction)(m.id);if(e.success&&e.data)return e.data;return{repaired:0,failed:0}}catch(e){return console.error("Error repairing all chains:",e),{repaired:0,failed:0}}},previewStockChainRepairs:async e=>{try{if(!m)return[];let e=await (0,l.getStockRepairsPreviewAction)(m.id);if(e.success&&e.data)return e.data;return[]}catch(e){return console.error("Error previewing repairs:",e),[]}},refreshHistory:y}}])},37451,172720,489855,933289,e=>{"use strict";var t=e.i(95187);let r=(0,t.createServerReference)("6055d418bbb34217108fb09f6c6e07a1977765bffb",t.callServer,void 0,t.findSourceMapURL,"getStockHistoryAction");e.s(["getStockHistoryAction",()=>r],37451);let a=(0,t.createServerReference)("60b4fb287dfbc2b628cca363587f00d76a36f3623b",t.callServer,void 0,t.findSourceMapURL,"recalculateStockChainAction");e.s(["recalculateStockChainAction",()=>a],172720);let s=(0,t.createServerReference)("60428e59105c2448bb202e52e31bf2d4492d8468f7",t.callServer,void 0,t.findSourceMapURL,"deleteStockHistoryEntriesByReferenceAction");e.s(["deleteStockHistoryEntriesByReferenceAction",()=>s],489855);let i=(0,t.createServerReference)("70e0c90d8c965637b3ae61b1f0dd8fc9a41ea083d6",t.callServer,void 0,t.findSourceMapURL,"updateStockHistoryDatesByReferenceAction");e.s(["updateStockHistoryDatesByReferenceAction",()=>i],933289)},960014,e=>{"use strict";var t=e.i(95187);let r=(0,t.createServerReference)("7022b270c26116cc720c0fe09926fa8749c32b0ea9",t.callServer,void 0,t.findSourceMapURL,"getStockSummaryReportAction");e.s(["getStockSummaryReportAction",()=>r])},654550,e=>{"use strict";var t=e.i(95187);let r=(0,t.createServerReference)("40193ce83d40b7dbf7c2991866f6d090da71bf2f59",t.callServer,void 0,t.findSourceMapURL,"createStockHistoryAction");e.s(["createStockHistoryAction",()=>r])},634076,e=>{"use strict";var t=e.i(95187);let r=(0,t.createServerReference)("406e0d925bc965618c40bddb0b2011bea951e9b025",t.callServer,void 0,t.findSourceMapURL,"getStockRepairsPreviewAction");e.s(["getStockRepairsPreviewAction",()=>r])},752304,e=>{"use strict";var t=e.i(95187);let r=(0,t.createServerReference)("60a33152b65e6ef5593ff2b5c1d0a77d09216fe7e5",t.callServer,void 0,t.findSourceMapURL,"repairStockChainsAction");e.s(["repairStockChainsAction",()=>r])},598130,390326,872716,656080,e=>{"use strict";var t=e.i(95187);let r=(0,t.createServerReference)("60048cacdf8f6ab02d12e637338fb3a82838e3ab18",t.callServer,void 0,t.findSourceMapURL,"getRequisitionsAction");e.s(["getRequisitionsAction",()=>r],598130);let a=(0,t.createServerReference)("40e343dbe89cc3fb8304b10c9c62480d17ad426333",t.callServer,void 0,t.findSourceMapURL,"createRequisitionAction");e.s(["createRequisitionAction",()=>a],390326);let s=(0,t.createServerReference)("701e152aafbc4d4daee38965467b93e083a6e967b4",t.callServer,void 0,t.findSourceMapURL,"updateRequisitionAction");e.s(["updateRequisitionAction",()=>s],872716);let i=(0,t.createServerReference)("605622308fa711a2f7465dc0a63c7e00dbe7c0418e",t.callServer,void 0,t.findSourceMapURL,"deleteRequisitionAction");e.s(["deleteRequisitionAction",()=>i],656080)},532436,712654,e=>{"use strict";var t=e.i(95187);let r=(0,t.createServerReference)("4035262824370ccd2af8788671f3cc8435d165a93b",t.callServer,void 0,t.findSourceMapURL,"getActivityByEntityIdsAction");e.s(["getActivityByEntityIdsAction",()=>r],532436);let a=(0,t.createServerReference)("60eb8a3f21a0957ca35a2a3606c2b8e1d21977469d",t.callServer,void 0,t.findSourceMapURL,"updateStockHistoryDatesAction");e.s(["updateStockHistoryDatesAction",()=>a],712654)},186336,e=>{"use strict";let t;var r=e.i(271645),a=e.i(981140),s=e.i(820783),i=e.i(30030),n=e.i(726330),o=e.i(610772),c=e.i(853660),l=e.i(774606),u=e.i(296626),d=e.i(248425),h=e.i(843476),p=Symbol("radix.slottable"),f=e.i(369340),m=e.i(959411),[y,v]=(0,i.createContextScope)("Tooltip",[c.createPopperScope]),g=(0,c.createPopperScope)(),b="TooltipProvider",S="tooltip.open",[x,w]=y(b),R=e=>{let{__scopeTooltip:t,delayDuration:a=700,skipDelayDuration:s=300,disableHoverableContent:i=!1,children:n}=e,o=r.useRef(!0),c=r.useRef(!1),l=r.useRef(0);return r.useEffect(()=>{let e=l.current;return()=>window.clearTimeout(e)},[]),(0,h.jsx)(x,{scope:t,isOpenDelayedRef:o,delayDuration:a,onOpen:r.useCallback(()=>{window.clearTimeout(l.current),o.current=!1},[]),onClose:r.useCallback(()=>{window.clearTimeout(l.current),l.current=window.setTimeout(()=>o.current=!0,s)},[s]),isPointerInTransitRef:c,onPointerInTransitChange:r.useCallback(e=>{c.current=e},[]),disableHoverableContent:i,children:n})};R.displayName=b;var C="Tooltip",[E,j]=y(C),k=e=>{let{__scopeTooltip:t,children:a,open:s,defaultOpen:i,onOpenChange:n,disableHoverableContent:l,delayDuration:u}=e,d=w(C,e.__scopeTooltip),p=g(t),[m,y]=r.useState(null),v=(0,o.useId)(),b=r.useRef(0),x=l??d.disableHoverableContent,R=u??d.delayDuration,j=r.useRef(!1),[k,T]=(0,f.useControllableState)({prop:s,defaultProp:i??!1,onChange:e=>{e?(d.onOpen(),document.dispatchEvent(new CustomEvent(S))):d.onClose(),n?.(e)},caller:C}),N=r.useMemo(()=>k?j.current?"delayed-open":"instant-open":"closed",[k]),I=r.useCallback(()=>{window.clearTimeout(b.current),b.current=0,j.current=!1,T(!0)},[T]),A=r.useCallback(()=>{window.clearTimeout(b.current),b.current=0,T(!1)},[T]),P=r.useCallback(()=>{window.clearTimeout(b.current),b.current=window.setTimeout(()=>{j.current=!0,T(!0),b.current=0},R)},[R,T]);return r.useEffect(()=>()=>{b.current&&(window.clearTimeout(b.current),b.current=0)},[]),(0,h.jsx)(c.Root,{...p,children:(0,h.jsx)(E,{scope:t,contentId:v,open:k,stateAttribute:N,trigger:m,onTriggerChange:y,onTriggerEnter:r.useCallback(()=>{d.isOpenDelayedRef.current?P():I()},[d.isOpenDelayedRef,P,I]),onTriggerLeave:r.useCallback(()=>{x?A():(window.clearTimeout(b.current),b.current=0)},[A,x]),onOpen:I,onClose:A,disableHoverableContent:x,children:a})})};k.displayName=C;var T="TooltipTrigger",N=r.forwardRef((e,t)=>{let{__scopeTooltip:i,...n}=e,o=j(T,i),l=w(T,i),u=g(i),p=r.useRef(null),f=(0,s.useComposedRefs)(t,p,o.onTriggerChange),m=r.useRef(!1),y=r.useRef(!1),v=r.useCallback(()=>m.current=!1,[]);return r.useEffect(()=>()=>document.removeEventListener("pointerup",v),[v]),(0,h.jsx)(c.Anchor,{asChild:!0,...u,children:(0,h.jsx)(d.Primitive.button,{"aria-describedby":o.open?o.contentId:void 0,"data-state":o.stateAttribute,...n,ref:f,onPointerMove:(0,a.composeEventHandlers)(e.onPointerMove,e=>{"touch"!==e.pointerType&&(y.current||l.isPointerInTransitRef.current||(o.onTriggerEnter(),y.current=!0))}),onPointerLeave:(0,a.composeEventHandlers)(e.onPointerLeave,()=>{o.onTriggerLeave(),y.current=!1}),onPointerDown:(0,a.composeEventHandlers)(e.onPointerDown,()=>{o.open&&o.onClose(),m.current=!0,document.addEventListener("pointerup",v,{once:!0})}),onFocus:(0,a.composeEventHandlers)(e.onFocus,()=>{m.current||o.onOpen()}),onBlur:(0,a.composeEventHandlers)(e.onBlur,o.onClose),onClick:(0,a.composeEventHandlers)(e.onClick,o.onClose)})})});N.displayName=T;var I="TooltipPortal",[A,P]=y(I,{forceMount:void 0}),M=e=>{let{__scopeTooltip:t,forceMount:r,children:a,container:s}=e,i=j(I,t);return(0,h.jsx)(A,{scope:t,forceMount:r,children:(0,h.jsx)(u.Presence,{present:r||i.open,children:(0,h.jsx)(l.Portal,{asChild:!0,container:s,children:a})})})};M.displayName=I;var L="TooltipContent",_=r.forwardRef((e,t)=>{let r=P(L,e.__scopeTooltip),{forceMount:a=r.forceMount,side:s="top",...i}=e,n=j(L,e.__scopeTooltip);return(0,h.jsx)(u.Presence,{present:a||n.open,children:n.disableHoverableContent?(0,h.jsx)(U,{side:s,...i,ref:t}):(0,h.jsx)(D,{side:s,...i,ref:t})})}),D=r.forwardRef((e,t)=>{let a=j(L,e.__scopeTooltip),i=w(L,e.__scopeTooltip),n=r.useRef(null),o=(0,s.useComposedRefs)(t,n),[c,l]=r.useState(null),{trigger:u,onClose:d}=a,p=n.current,{onPointerInTransitChange:f}=i,m=r.useCallback(()=>{l(null),f(!1)},[f]),y=r.useCallback((e,t)=>{let r,a=e.currentTarget,s={x:e.clientX,y:e.clientY},i=function(e,t){let r=Math.abs(t.top-e.y),a=Math.abs(t.bottom-e.y),s=Math.abs(t.right-e.x),i=Math.abs(t.left-e.x);switch(Math.min(r,a,s,i)){case i:return"left";case s:return"right";case r:return"top";case a:return"bottom";default:throw Error("unreachable")}}(s,a.getBoundingClientRect());l(((r=[...function(e,t,r=5){let a=[];switch(t){case"top":a.push({x:e.x-r,y:e.y+r},{x:e.x+r,y:e.y+r});break;case"bottom":a.push({x:e.x-r,y:e.y-r},{x:e.x+r,y:e.y-r});break;case"left":a.push({x:e.x+r,y:e.y-r},{x:e.x+r,y:e.y+r});break;case"right":a.push({x:e.x-r,y:e.y-r},{x:e.x-r,y:e.y+r})}return a}(s,i),...function(e){let{top:t,right:r,bottom:a,left:s}=e;return[{x:s,y:t},{x:r,y:t},{x:r,y:a},{x:s,y:a}]}(t.getBoundingClientRect())].slice()).sort((e,t)=>e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:1*!!(e.y>t.y)),function(e){if(e.length<=1)return e.slice();let t=[];for(let r=0;r<e.length;r++){let a=e[r];for(;t.length>=2;){let e=t[t.length-1],r=t[t.length-2];if((e.x-r.x)*(a.y-r.y)>=(e.y-r.y)*(a.x-r.x))t.pop();else break}t.push(a)}t.pop();let r=[];for(let t=e.length-1;t>=0;t--){let a=e[t];for(;r.length>=2;){let e=r[r.length-1],t=r[r.length-2];if((e.x-t.x)*(a.y-t.y)>=(e.y-t.y)*(a.x-t.x))r.pop();else break}r.push(a)}return(r.pop(),1===t.length&&1===r.length&&t[0].x===r[0].x&&t[0].y===r[0].y)?t:t.concat(r)}(r))),f(!0)},[f]);return r.useEffect(()=>()=>m(),[m]),r.useEffect(()=>{if(u&&p){let e=e=>y(e,p),t=e=>y(e,u);return u.addEventListener("pointerleave",e),p.addEventListener("pointerleave",t),()=>{u.removeEventListener("pointerleave",e),p.removeEventListener("pointerleave",t)}}},[u,p,y,m]),r.useEffect(()=>{if(c){let e=e=>{let t=e.target,r={x:e.clientX,y:e.clientY},a=u?.contains(t)||p?.contains(t),s=!function(e,t){let{x:r,y:a}=e,s=!1;for(let e=0,i=t.length-1;e<t.length;i=e++){let n=t[e],o=t[i],c=n.x,l=n.y,u=o.x,d=o.y;l>a!=d>a&&r<(u-c)*(a-l)/(d-l)+c&&(s=!s)}return s}(r,c);a?m():s&&(m(),d())};return document.addEventListener("pointermove",e),()=>document.removeEventListener("pointermove",e)}},[u,p,c,d,m]),(0,h.jsx)(U,{...e,ref:o})}),[O,Q]=y(C,{isInside:!1}),F=((t=({children:e})=>(0,h.jsx)(h.Fragment,{children:e})).displayName="TooltipContent.Slottable",t.__radixId=p,t),U=r.forwardRef((e,t)=>{let{__scopeTooltip:a,children:s,"aria-label":i,onEscapeKeyDown:o,onPointerDownOutside:l,...u}=e,d=j(L,a),p=g(a),{onClose:f}=d;return r.useEffect(()=>(document.addEventListener(S,f),()=>document.removeEventListener(S,f)),[f]),r.useEffect(()=>{if(d.trigger){let e=e=>{let t=e.target;t?.contains(d.trigger)&&f()};return window.addEventListener("scroll",e,{capture:!0}),()=>window.removeEventListener("scroll",e,{capture:!0})}},[d.trigger,f]),(0,h.jsx)(n.DismissableLayer,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:o,onPointerDownOutside:l,onFocusOutside:e=>e.preventDefault(),onDismiss:f,children:(0,h.jsxs)(c.Content,{"data-state":d.stateAttribute,...p,...u,ref:t,style:{...u.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[(0,h.jsx)(F,{children:s}),(0,h.jsx)(O,{scope:a,isInside:!0,children:(0,h.jsx)(m.Root,{id:d.contentId,role:"tooltip",children:i||s})})]})})});_.displayName=L;var B="TooltipArrow",q=r.forwardRef((e,t)=>{let{__scopeTooltip:r,...a}=e,s=g(r);return Q(B,r).isInside?null:(0,h.jsx)(c.Arrow,{...s,...a,ref:t})});q.displayName=B,e.s(["Arrow",()=>q,"Content",()=>_,"Portal",()=>M,"Provider",()=>R,"Root",()=>k,"Tooltip",()=>k,"TooltipArrow",()=>q,"TooltipContent",()=>_,"TooltipPortal",()=>M,"TooltipProvider",()=>R,"TooltipTrigger",()=>N,"Trigger",()=>N,"createTooltipScope",()=>v],186336)},746798,e=>{"use strict";var t=e.i(843476),r=e.i(271645),a=e.i(186336),s=e.i(975157);let i=a.Provider,n=a.Root,o=a.Trigger,c=r.forwardRef(({className:e,sideOffset:r=4,...i},n)=>(0,t.jsx)(a.Content,{ref:n,sideOffset:r,className:(0,s.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...i}));c.displayName=a.Content.displayName,e.s(["Tooltip",()=>n,"TooltipContent",()=>c,"TooltipProvider",()=>i,"TooltipTrigger",()=>o])},669469,e=>{"use strict";var t=e.i(843476);let r=(0,e.i(475254).default)("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);e.s(["default",0,({imageUrl:e,alt:a,size:s="md"})=>{let i="sm"===s?"w-10 h-10":"w-12 h-12";return e?(0,t.jsx)("img",{src:e,alt:a,className:`${i} object-cover rounded-md`}):(0,t.jsx)("div",{className:`${i} bg-gray-100 flex items-center justify-center rounded-md`,children:(0,t.jsx)(r,{size:"sm"===s?16:18,className:"text-gray-400"})})}],669469)},899426,e=>{"use strict";e.s(["matchProductSearch",0,(e,t)=>{if(!t||!t.trim())return!0;let r=t.toLowerCase().trim().split(/\s+/),a=[String(e.name||""),String(e.description||""),String(e.category||""),String(e.supplier||""),String(e.itemNumber||""),String(e.barcode||""),String(e.manufacturerBarcode||"")].map(e=>e.toLowerCase());return r.every(e=>a.some(t=>t.includes(e)))}])},39725,e=>{"use strict";var t=e.i(271645),r=e.i(908406),a=e.i(422713),s=e.i(457786),i=e.i(266027),n=e.i(912598),o=e.i(95187);let c=(0,o.createServerReference)("40227d1c2ed5cbf6324cf519682235031f0a3138a5",o.callServer,void 0,o.findSourceMapURL,"getCustomersAction"),l=(0,o.createServerReference)("708938753470d59bd6fa4ddf41a8a3581263dd393b",o.callServer,void 0,o.findSourceMapURL,"createCustomerAction"),u=(0,o.createServerReference)("609ad415d8b556837c750a19320a30ea6d4beaf896",o.callServer,void 0,o.findSourceMapURL,"updateCustomerAction"),d=(0,o.createServerReference)("40f9d32b0ea15e5c8f0b3441eec79ddb30815f1c83",o.callServer,void 0,o.findSourceMapURL,"deleteCustomerAction");var h=e.i(102594);e.s(["useCustomers",0,(e=50)=>{let[o,p]=(0,t.useState)([]),[f,m]=(0,t.useState)(1),[y,v]=(0,t.useState)(e),[g,b]=(0,t.useState)(0),{toast:S}=(0,r.useToast)(),{currentBusiness:x}=(0,a.useBusiness)(),{user:w}=(0,h.useAuth)(),{logActivity:R}=(0,s.useActivityLogger)(),C=(0,n.useQueryClient)(),E=(0,t.useCallback)(async()=>{if(!x)return{customers:[],count:0};try{let e=await c(x.id);if(!e.success)throw Error(e.error);return{customers:(e.data?.customers||[]).map(e=>({id:e.id,fullName:e.fullName||e.name,phoneNumber:e.phoneNumber||e.phone,email:e.email,birthday:e.birthday?new Date(e.birthday):null,gender:e.gender,location:e.location||e.address,categoryId:e.categoryId,notes:e.notes,tags:e.tags,socialMedia:e.socialMedia||null,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)})),count:e.data?.count||0}}catch(e){return console.error("Error loading customers:",e),S({title:"Error",description:"Failed to load customers. Please try again.",variant:"destructive"}),{customers:[],count:0}}},[x?.id,S]),j=["customers",x?.id],{data:k,isLoading:T,isFetching:N}=(0,i.useQuery)({queryKey:j,queryFn:E,enabled:!!x?.id,staleTime:3e5,gcTime:18e5,refetchOnWindowFocus:!1,refetchOnReconnect:!1});(0,t.useEffect)(()=>{k&&(p(k.customers),b(k.count))},[k]);let I=async e=>{if(!x)return S({title:"Error",description:"No business selected",variant:"destructive"}),null;try{if(!w)throw Error("User not authenticated");let t={fullName:e.fullName,phoneNumber:e.phoneNumber||null,email:e.email||null,birthday:e.birthday?.toISOString().split("T")[0]||null,gender:e.gender||null,location:e.location||null,categoryId:e.categoryId||null,notes:e.notes||null,tags:e.tags||null,socialMedia:e.socialMedia||null},r=await l(x.id,w.id,t);if(!r.success||!r.data)throw Error(r.error||"Failed to create customer");let a=r.data,s={id:a.id,fullName:a.name||a.fullName,phoneNumber:a.phone||a.phoneNumber,email:a.email,birthday:a.birthday?new Date(a.birthday):null,gender:a.gender,location:a.address||a.location,categoryId:a.categoryId,notes:a.notes,tags:a.tags,socialMedia:a.socialMedia,createdAt:new Date(a.createdAt),updatedAt:new Date(a.updatedAt)};return p(e=>[s,...e]),b(e=>e+1),C.setQueryData(j,e=>e?{customers:[s,...e.customers],count:(e.count||0)+1}:{customers:[s],count:1}),await R({activityType:"CREATE",module:"CUSTOMERS",entityType:"customer",entityId:a.id,entityName:e.fullName,description:`Created customer "${e.fullName}"`,metadata:{phoneNumber:e.phoneNumber,email:e.email,location:e.location}}),S({title:"Success",description:"Customer created successfully"}),a}catch(e){return console.error("Error creating customer:",e),S({title:"Error",description:"Failed to create customer. Please try again.",variant:"destructive"}),null}},A=async(e,t)=>{try{let r={};void 0!==t.fullName&&(r.fullName=t.fullName),void 0!==t.phoneNumber&&(r.phoneNumber=t.phoneNumber),void 0!==t.email&&(r.email=t.email),void 0!==t.birthday&&(r.birthday=t.birthday?.toISOString()),void 0!==t.gender&&(r.gender=t.gender),void 0!==t.location&&(r.location=t.location),void 0!==t.categoryId&&(r.categoryId=t.categoryId),void 0!==t.notes&&(r.notes=t.notes),void 0!==t.tags&&(r.tags=t.tags),void 0!==t.socialMedia&&(r.socialMedia=t.socialMedia);let a=await u(e,r);if(!a.success)throw Error(a.error||"Failed to update customer");p(r=>r.map(r=>r.id===e?{...r,...t}:r)),C.setQueryData(j,r=>r?{...r,customers:r.customers.map(r=>r.id===e?{...r,...t}:r)}:r);let s=o.find(t=>t.id===e);return s&&await R({activityType:"UPDATE",module:"CUSTOMERS",entityType:"customer",entityId:e,entityName:s.fullName,description:`Updated customer "${s.fullName}"`,metadata:{updates:t}}),S({title:"Success",description:"Customer updated successfully"}),!0}catch(e){return console.error("Error updating customer:",e),S({title:"Error",description:"Failed to update customer. Please try again.",variant:"destructive"}),!1}},P=async e=>{try{let t=o.find(t=>t.id===e),r=await d(e);if(!r.success)throw Error(r.error||"Failed to delete customer");return p(t=>t.filter(t=>t.id!==e)),b(e=>Math.max(0,e-1)),C.setQueryData(j,t=>{if(!t)return t;let{customers:r,count:a}=t;return{customers:r.filter(t=>t.id!==e),count:Math.max(0,(a||0)-1)}}),C.invalidateQueries({queryKey:j}),t&&await R({activityType:"DELETE",module:"CUSTOMERS",entityType:"customer",entityId:e,entityName:t.fullName,description:`Deleted customer "${t.fullName}"`,metadata:{phoneNumber:t.phoneNumber,email:t.email}}),S({title:"Success",description:"Customer deleted successfully"}),!0}catch(e){return console.error("Error deleting customer:",e),S({title:"Error",description:"Failed to delete customer. Please try again.",variant:"destructive"}),!1}};return{customers:o,isLoading:T&&!k,createCustomer:I,addCustomer:I,updateCustomer:A,deleteCustomer:P,loadCustomers:E,page:f,setPage:m,pageSize:y,setPageSize:v,totalCount:g}}],39725)},903711,e=>{"use strict";var t=e.i(95187);let r=(0,t.createServerReference)("605a5ac8c70aa01eb0dd29483cb3c24316ae309de0",t.callServer,void 0,t.findSourceMapURL,"getProductReconciliationAction");e.s(["getProductReconciliationAction",()=>r])},618566,(e,t,r)=>{t.exports=e.r(976562)},772436,e=>{"use strict";var t=e.i(843476),r=e.i(271645);e.i(174080);var a=e.i(991918),s=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,s)=>{let i=(0,a.createSlot)(`Primitive.${s}`),n=r.forwardRef((e,r)=>{let{asChild:a,...n}=e;return"u">typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,t.jsx)(a?i:s,{...n,ref:r})});return n.displayName=`Primitive.${s}`,{...e,[s]:n}},{}),i="horizontal",n=["horizontal","vertical"],o=r.forwardRef((e,r)=>{var a;let{decorative:o,orientation:c=i,...l}=e,u=(a=c,n.includes(a))?c:i;return(0,t.jsx)(s.div,{"data-orientation":u,...o?{role:"none"}:{"aria-orientation":"vertical"===u?u:void 0,role:"separator"},...l,ref:r})});o.displayName="Separator";var c=e.i(975157);let l=r.forwardRef(({className:e,orientation:r="horizontal",decorative:a=!0,...s},i)=>(0,t.jsx)(o,{ref:i,decorative:a,orientation:r,className:(0,c.cn)("shrink-0 bg-border","horizontal"===r?"h-[1px] w-full":"h-full w-[1px]",e),...s}));l.displayName=o.displayName,e.s(["Separator",()=>l],772436)},686311,e=>{"use strict";let t=(0,e.i(475254).default)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);e.s(["MessageSquare",()=>t],686311)},230994,e=>{"use strict";e.s([],264041),e.i(264041),e.i(37451),e.i(654550),e.i(172720),e.i(489855),e.i(933289),e.i(598130),e.i(390326),e.i(872716),e.i(656080),e.i(960014),e.i(903711),e.i(634076),e.i(752304),e.i(532436),e.i(712654);var t=e.i(349479);let r=async e=>{try{if(!e)return console.error("Location ID is required for receipt number generation"),"000001";let r=await (0,t.getNextReceiptNumberAction)(e);if(r.success&&r.data)return r.data;return console.error("Error generating receipt number:",r.error),"000001"}catch(e){return console.error("Error generating receipt number:",e),"000001"}};e.s(["generateReceiptNumber",0,r],230994)},965901,e=>{"use strict";var t=e.i(271645),r=e.i(422713),a=e.i(908406),s=e.i(102594),i=e.i(95187);let n=(0,i.createServerReference)("40696a4456c7690d29b12ef602356cbc9be3c34a97",i.callServer,void 0,i.findSourceMapURL,"getCustomerCategoriesAction"),o=(0,i.createServerReference)("70b04375c8b1e7a5a64b19d8153628c90f1150c267",i.callServer,void 0,i.findSourceMapURL,"createCustomerCategoryAction"),c=(0,i.createServerReference)("605890db4ca201299b68a3100db491232317cf530d",i.callServer,void 0,i.findSourceMapURL,"updateCustomerCategoryAction"),l=(0,i.createServerReference)("4032dd367fa6b4bfc08062e47a1ca2ffb5e5eb04b0",i.callServer,void 0,i.findSourceMapURL,"deleteCustomerCategoryAction");e.s(["useCustomerCategories",0,()=>{let[e,i]=(0,t.useState)([]),[u,d]=(0,t.useState)(!0),{currentBusiness:h}=(0,r.useBusiness)(),{user:p}=(0,s.useAuth)(),f=async()=>{if(!h){i([]),d(!1);return}try{let e=await n(h.id);if(e.success&&e.data)i(e.data);else throw Error(e.error)}catch(e){console.error("Error fetching customer categories:",e),(0,a.toast)({title:"Error",description:"Failed to fetch customer categories",variant:"destructive"})}finally{d(!1)}};return(0,t.useEffect)(()=>{f()},[h]),{categories:e,isLoading:u,createCategory:async e=>{if(!h||!p)return(0,a.toast)({title:"Error",description:"No business selected or user not authenticated",variant:"destructive"}),!1;try{let t=await o(h.id,p.id,e);if(t.success)return(0,a.toast)({title:"Success",description:"Customer category created successfully"}),f(),!0;throw Error(t.error)}catch(e){return console.error("Error creating customer category:",e),(0,a.toast)({title:"Error",description:"Failed to create customer category",variant:"destructive"}),!1}},updateCategory:async(e,t)=>{try{let r=await c(e,t);if(r.success)return(0,a.toast)({title:"Success",description:"Customer category updated successfully"}),f(),!0;throw Error(r.error)}catch(e){return console.error("Error updating customer category:",e),(0,a.toast)({title:"Error",description:"Failed to update customer category",variant:"destructive"}),!1}},deleteCategory:async e=>{try{let t=await l(e);if(t.success)return(0,a.toast)({title:"Success",description:"Customer category deleted successfully"}),f(),!0;throw Error(t.error)}catch(e){return console.error("Error deleting customer category:",e),(0,a.toast)({title:"Error",description:"Failed to delete customer category",variant:"destructive"}),!1}},refetch:f}}],965901)},283627,e=>{"use strict";let t=(0,e.i(475254).default)("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);e.s(["Edit3",()=>t],283627)},221345,e=>{"use strict";let t=(0,e.i(475254).default)("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);e.s(["Link",()=>t],221345)},375050,e=>{"use strict";var t=e.i(843476),r=e.i(271645),a=e.i(793479),s=e.i(110204),i=e.i(624687),n=e.i(519455),o=e.i(87316),c=e.i(227766),l=e.i(337822),u=e.i(967489),d=e.i(401851),h=e.i(487486),p=e.i(37727),f=e.i(975157),m=e.i(653145),y=e.i(776639),v=e.i(965901);e.s(["default",0,({initialData:e,onSubmit:g,onCancel:b})=>{let[S,x]=r.default.useState(!1),{categories:w}=(0,v.useCustomerCategories)(),[R,C]=r.default.useState(()=>{if(e?.birthday)return console.log("Initial birthday from props:",e.birthday),e.birthday}),[E,j]=r.default.useState(e?.categoryId||"none");r.default.useEffect(()=>{e?.birthday&&(console.log("Initial birthday from props:",e.birthday),console.log("Is Date object:",e.birthday instanceof Date),console.log("Date string:",e.birthday.toString()))},[e?.birthday]);let[k,T]=r.default.useState({facebook:e?.socialMedia?.facebook||"",instagram:e?.socialMedia?.instagram||"",twitter:e?.socialMedia?.twitter||"",linkedin:e?.socialMedia?.linkedin||"",other:e?.socialMedia?.other||""}),[N,I]=r.default.useState(e?.tags||[]),[A,P]=r.default.useState(""),[M,L]=r.default.useState(e?.gender||""),{register:_,handleSubmit:D,formState:{errors:O}}=(0,m.useForm)({defaultValues:{fullName:e?.fullName||"",email:e?.email||"",phoneNumber:e?.phoneNumber||"",location:e?.location||"",gender:e?.gender||"",notes:e?.notes||""}}),Q=()=>{""===A.trim()||N.includes(A.trim())||(I([...N,A.trim()]),P(""))},F=(e,t)=>{T({...k,[t]:e.target.value})},U=async e=>{x(!0);try{console.log("Selected date before submission:",R);let t={...e,gender:M,birthday:R,categoryId:"none"===E?null:E,socialMedia:Object.keys(k).length>0?k:null,tags:N.length>0?N:null};console.log("Submitting customer data:",t),await g(t)}finally{x(!1)}},B=new Date().getFullYear(),q=Array.from({length:100},(e,t)=>B-t),H=[{value:0,label:"January"},{value:1,label:"February"},{value:2,label:"March"},{value:3,label:"April"},{value:4,label:"May"},{value:5,label:"June"},{value:6,label:"July"},{value:7,label:"August"},{value:8,label:"September"},{value:9,label:"October"},{value:10,label:"November"},{value:11,label:"December"}],z=e=>{if(console.log("Date selected from calendar:",e),e){let t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),12,0,0));console.log("Corrected date with UTC noon:",t),C(t)}else C(void 0)},K=e=>{try{let t=parseInt(e),r=R?new Date(R):new Date,a=new Date(Date.UTC(t,r.getMonth(),r.getDate(),12,0,0));isNaN(a.getTime())?console.error("Invalid date after setting year:",e):(C(a),console.log("Year selected, new date:",a))}catch(e){console.error("Error setting year:",e)}},V=e=>{try{let t=parseInt(e),r=R?new Date(R):new Date,a=new Date(Date.UTC(r.getFullYear(),t,r.getDate(),12,0,0));isNaN(a.getTime())?console.error("Invalid date after setting month:",e):(C(a),console.log("Month selected, new date:",a))}catch(e){console.error("Error setting month:",e)}},$=w.filter(e=>e.id&&""!==e.id.trim());return(0,t.jsx)("form",{onSubmit:D(U),children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(s.Label,{htmlFor:"fullName",children:"Full Name*"}),(0,t.jsx)(a.Input,{id:"fullName",..._("fullName",{required:"Name is required"}),className:(0,f.cn)(O.fullName&&"border-red-500")}),O.fullName&&(0,t.jsx)("p",{className:"text-red-500 text-xs",children:O.fullName.message})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(s.Label,{htmlFor:"category",children:"Category"}),(0,t.jsxs)(u.Select,{value:E,onValueChange:j,children:[(0,t.jsx)(u.SelectTrigger,{id:"category",children:(0,t.jsx)(u.SelectValue,{placeholder:"Select category"})}),(0,t.jsxs)(u.SelectContent,{children:[(0,t.jsx)(u.SelectItem,{value:"none",children:"No Category"}),$.map(e=>(0,t.jsx)(u.SelectItem,{value:e.id,children:e.name},e.id))]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(s.Label,{htmlFor:"email",children:"Email Address"}),(0,t.jsx)(a.Input,{id:"email",type:"email",..._("email",{pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Invalid email address"}}),className:(0,f.cn)(O.email&&"border-red-500")}),O.email&&(0,t.jsx)("p",{className:"text-red-500 text-xs",children:O.email.message})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(s.Label,{htmlFor:"phoneNumber",children:"Phone Number"}),(0,t.jsx)(a.Input,{id:"phoneNumber",..._("phoneNumber")})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(s.Label,{htmlFor:"location",children:"Location"}),(0,t.jsx)(a.Input,{id:"location",..._("location")})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(s.Label,{htmlFor:"gender",children:"Gender"}),(0,t.jsxs)(u.Select,{value:M,onValueChange:L,children:[(0,t.jsx)(u.SelectTrigger,{id:"gender",children:(0,t.jsx)(u.SelectValue,{placeholder:"Select gender"})}),(0,t.jsxs)(u.SelectContent,{children:[(0,t.jsx)(u.SelectItem,{value:"male",children:"Male"}),(0,t.jsx)(u.SelectItem,{value:"female",children:"Female"}),(0,t.jsx)(u.SelectItem,{value:"non-binary",children:"Non-binary"}),(0,t.jsx)(u.SelectItem,{value:"prefer-not-to-say",children:"Prefer not to say"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(s.Label,{children:"Birthday"}),(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)(l.Popover,{children:[(0,t.jsx)(l.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)(n.Button,{variant:"outline",className:"w-full justify-between",children:[R?R.getDate():"Day",(0,t.jsx)(o.Calendar,{className:"h-4 w-4 opacity-50"})]})}),(0,t.jsx)(l.PopoverContent,{className:"w-auto p-0",align:"start",children:(0,t.jsx)(c.Calendar,{mode:"single",selected:R,onSelect:z,initialFocus:!0,captionLayout:"buttons",className:"p-3 pointer-events-auto",classNames:{caption_label:"hidden",dropdown:"hidden"}})})]})}),(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)(u.Select,{value:R?String(R.getMonth()):void 0,onValueChange:V,children:[(0,t.jsx)(u.SelectTrigger,{children:(0,t.jsx)(u.SelectValue,{placeholder:"Month"})}),(0,t.jsx)(u.SelectContent,{children:H.map(e=>(0,t.jsx)(u.SelectItem,{value:String(e.value),children:e.label},e.value))})]})}),(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)(u.Select,{value:R?String(R.getFullYear()):void 0,onValueChange:K,children:[(0,t.jsx)(u.SelectTrigger,{children:(0,t.jsx)(u.SelectValue,{placeholder:"Year"})}),(0,t.jsx)(u.SelectContent,{children:q.map(e=>(0,t.jsx)(u.SelectItem,{value:String(e),children:e},e))})]})})]}),R&&(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Selected: ",R?(0,d.format)(R,"PPP"):"No date selected"]})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(s.Label,{children:"Tags"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1 mb-2",children:N.map(e=>(0,t.jsxs)(h.Badge,{variant:"secondary",children:[e,(0,t.jsxs)("button",{type:"button",className:"ml-1 rounded-full hover:bg-gray-200",onClick:()=>{I(N.filter(t=>t!==e))},children:[(0,t.jsx)(p.X,{className:"h-3 w-3"}),(0,t.jsx)("span",{className:"sr-only",children:"Remove tag"})]})]},e))}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(a.Input,{value:A,onChange:e=>P(e.target.value),placeholder:"Add tag",onKeyDown:e=>"Enter"===e.key&&(e.preventDefault(),Q())}),(0,t.jsx)(n.Button,{type:"button",onClick:Q,variant:"outline",children:"Add"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(s.Label,{children:"Social Media"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)(s.Label,{htmlFor:"facebook",className:"text-xs",children:"Facebook"}),(0,t.jsx)(a.Input,{id:"facebook",value:k.facebook,onChange:e=>F(e,"facebook"),placeholder:"Username or URL"})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)(s.Label,{htmlFor:"instagram",className:"text-xs",children:"Instagram"}),(0,t.jsx)(a.Input,{id:"instagram",value:k.instagram,onChange:e=>F(e,"instagram"),placeholder:"Username without @"})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)(s.Label,{htmlFor:"twitter",className:"text-xs",children:"Twitter/X"}),(0,t.jsx)(a.Input,{id:"twitter",value:k.twitter,onChange:e=>F(e,"twitter"),placeholder:"Username without @"})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)(s.Label,{htmlFor:"linkedin",className:"text-xs",children:"LinkedIn"}),(0,t.jsx)(a.Input,{id:"linkedin",value:k.linkedin,onChange:e=>F(e,"linkedin"),placeholder:"Profile URL or username"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(s.Label,{children:"Birthday"}),(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)(l.Popover,{children:[(0,t.jsx)(l.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)(n.Button,{variant:"outline",className:"w-full justify-between",children:[R?R.getDate():"Day",(0,t.jsx)(o.Calendar,{className:"h-4 w-4 opacity-50"})]})}),(0,t.jsx)(l.PopoverContent,{className:"w-auto p-0",align:"start",children:(0,t.jsx)(c.Calendar,{mode:"single",selected:R,onSelect:z,initialFocus:!0,captionLayout:"buttons",className:"p-3 pointer-events-auto",classNames:{caption_label:"hidden",dropdown:"hidden"}})})]})}),(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)(u.Select,{value:R?String(R.getMonth()):void 0,onValueChange:V,children:[(0,t.jsx)(u.SelectTrigger,{children:(0,t.jsx)(u.SelectValue,{placeholder:"Month"})}),(0,t.jsx)(u.SelectContent,{children:H.map(e=>(0,t.jsx)(u.SelectItem,{value:String(e.value),children:e.label},e.value))})]})}),(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)(u.Select,{value:R?String(R.getFullYear()):void 0,onValueChange:K,children:[(0,t.jsx)(u.SelectTrigger,{children:(0,t.jsx)(u.SelectValue,{placeholder:"Year"})}),(0,t.jsx)(u.SelectContent,{children:q.map(e=>(0,t.jsx)(u.SelectItem,{value:String(e),children:e},e))})]})})]}),R&&(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Selected: ",R?(0,d.format)(R,"PPP"):"No date selected"]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(s.Label,{htmlFor:"notes",children:"Notes"}),(0,t.jsx)(i.Textarea,{id:"notes",..._("notes"),rows:4,placeholder:"Add any notes about this customer..."})]}),(0,t.jsxs)(y.DialogFooter,{children:[(0,t.jsx)(n.Button,{variant:"outline",type:"button",onClick:b,children:"Cancel"}),(0,t.jsx)(n.Button,{type:"submit",disabled:S,children:S?"Saving...":"Save Changes"})]})]})})}])},639054,e=>{"use strict";var t=e.i(843476),r=e.i(776639),a=e.i(375050),s=e.i(759684);e.s(["default",0,({open:e,onClose:i,onAddCustomer:n,initialData:o})=>{let c=async e=>(n(e),!0),l=!!o;return(0,t.jsx)(r.Dialog,{open:e,onOpenChange:i,children:(0,t.jsxs)(r.DialogContent,{className:"max-w-2xl max-h-[90vh]",children:[(0,t.jsxs)(r.DialogHeader,{children:[(0,t.jsx)(r.DialogTitle,{children:l?"Edit Customer":"Add New Customer"}),(0,t.jsx)(r.DialogDescription,{children:"Fill in the customer details below. Only name is required."})]}),(0,t.jsx)(s.ScrollArea,{className:"h-[calc(80vh-8rem)]",children:(0,t.jsx)("div",{className:"px-1",children:(0,t.jsx)(a.default,{onSubmit:c,onCancel:i,initialData:o})})})]})})}])},198191,e=>{"use strict";var t=e.i(843476),r=e.i(271645),a=e.i(618566),s=e.i(102594),i=e.i(160615),n=e.i(422713),o=e.i(289844),c=e.i(349609),l=e.i(197704),u=e.i(611747),d=e.i(365722),h=e.i(630680),p=e.i(777624),f=e.i(63209),m=e.i(929592),y=e.i(519455);e.s(["default",0,()=>{let e=(0,a.useRouter)(),v=(0,a.useSearchParams)(),{user:g}=(0,s.useAuth)(),{settings:b}=(0,i.useBusinessSettings)(),{currentBusiness:S,isLoading:x}=(0,n.useBusiness)(),{hasPermission:w,isLoading:R}=(0,p.useProfiles)(),C=v.get("editId"),[E,j]=(0,r.useState)(void 0);(0,r.useEffect)(()=>{},[C]);let[k,T]=(0,r.useState)(0),N=(0,r.useCallback)(()=>{T(e=>e+1)},[]),{showDraftNotification:I,draftData:A,handleLoadDraft:P,handleDismissDraft:M,clearDraft:L}=(0,o.useNewSaleDraft)(E),{isReceiptOpen:_,completedSale:D,newCustomerDialogOpen:O,includePaymentInfo:Q,customers:F,handleSaleComplete:U,handleReceiptClose:B,handleAddCustomer:q,handleOpenNewCustomerDialog:H,setNewCustomerDialogOpen:z}=(0,c.useNewSaleActions)(E,N);if(x||R)return(0,t.jsx)(l.default,{});if(!S)return(0,t.jsx)(u.default,{});let K=!E||w("sales","edit"),V=!!E||w("sales","create");return K&&V?(0,t.jsxs)("div",{className:"max-w-4xl mx-auto",children:[!g&&(0,t.jsx)(d.default,{}),(0,t.jsx)(h.default,{editSale:E,currency:b.currency,showDraftNotification:I,draftData:A,onLoadDraft:P,onDismissDraft:M,onSaleComplete:(e,t,r,a,s,i,n)=>U(e,t,r,a,L||s,i,n),onClearDraft:L,customers:F||[],onAddNewCustomer:H,isReceiptOpen:_,completedSale:D,includePaymentInfo:Q,onReceiptClose:B,newCustomerDialogOpen:O,onCloseNewCustomerDialog:()=>z(!1),onAddCustomer:q},k)]}):(0,t.jsxs)("div",{className:"max-w-4xl mx-auto p-6",children:[(0,t.jsxs)(m.Alert,{variant:"destructive",children:[(0,t.jsx)(f.AlertCircle,{className:"h-4 w-4"}),(0,t.jsx)(m.AlertTitle,{children:"Access Denied"}),(0,t.jsxs)(m.AlertDescription,{children:["You do not have permission to ",E?"edit this sale":"create a new sale",". Please contact your administrator if you believe this is an error."]})]}),(0,t.jsx)("div",{className:"mt-4",children:(0,t.jsx)(y.Button,{onClick:()=>e.push("/sales"),variant:"outline",children:"Back to Sales"})})]})}])},559216,e=>{e.v(t=>Promise.all(["static/chunks/a76007d487b7285f.js"].map(t=>e.l(t))).then(()=>t(65054)))},569521,e=>{e.v(t=>Promise.all(["static/chunks/45728a0ccba874c7.js"].map(t=>e.l(t))).then(()=>t(981474)))},48503,e=>{e.v(t=>Promise.all(["static/chunks/034945ea23f7a8ce.js"].map(t=>e.l(t))).then(()=>t(915833)))},870653,e=>{e.v(t=>Promise.all(["static/chunks/63eee2351f5394d5.js"].map(t=>e.l(t))).then(()=>t(424154)))},195111,e=>{e.v(t=>Promise.all(["static/chunks/f66634c84e3526bd.js"].map(t=>e.l(t))).then(()=>t(38201)))},210699,e=>{e.v(t=>Promise.all(["static/chunks/11539ca7394ee4b6.js","static/chunks/034945ea23f7a8ce.js"].map(t=>e.l(t))).then(()=>t(53945)))},756667,e=>{e.v(e=>Promise.resolve().then(()=>e(804760)))}]);