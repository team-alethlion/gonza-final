(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,160615,e=>{"use strict";var s=e.i(271645),t=e.i(266027),a=e.i(908406),i=e.i(422713),r=e.i(95187);let n=(0,r.createServerReference)("40290a4fc6b8571a026afeb877566edb807919e482",r.callServer,void 0,r.findSourceMapURL,"getBusinessSettingsAction");var l=e.i(709239);let u=()=>({businessName:"",businessAddress:"",businessPhone:"",businessEmail:"",currency:"UGX",paymentInfo:"",defaultPrintFormat:"standard"});e.s(["convertPaymentMethodsToString",0,e=>e.filter(e=>""!==e.method.trim()||""!==e.accountNumber.trim()||""!==e.accountName.trim()).map(e=>`${e.method}
${e.accountNumber}
${e.accountName}`).join("\n"),"parsePaymentInfo",0,e=>{if(!e||""===e.trim())return[];let s=e.split("\n").filter(e=>""!==e.trim()),t=[];for(let e=0;e<s.length;e+=3)e+2<s.length&&t.push({method:s[e].trim(),accountNumber:s[e+1].trim(),accountName:s[e+2].trim()});return t},"useBusinessSettings",0,()=>{let[e,r]=(0,s.useState)(u()),[d,o]=(0,s.useState)(!1),{toast:c}=(0,a.useToast)(),{currentBusiness:m}=(0,i.useBusiness)(),h=async()=>{if(!m)return u();try{let e=await n(m.id);if(!e)return u();{let s=e.metadata&&"object"==typeof e.metadata&&e.metadata.payment_info||"";return{id:e.id,businessName:e.business_name||"",businessAddress:e.business_address||"",businessPhone:e.business_phone||"",businessEmail:e.business_email||"",businessLogo:e.business_logo||void 0,currency:e.currency||"UGX",signature:e.signature||void 0,paymentInfo:s,defaultPrintFormat:e.metadata&&"object"==typeof e.metadata&&e.metadata.default_print_format||"standard",defaultPrinterName:e.metadata&&"object"==typeof e.metadata&&e.metadata.default_printer_name||"",defaultPrinterType:e.metadata&&"object"==typeof e.metadata&&e.metadata.default_printer_type||"USB",printerPaperSize:e.metadata&&"object"==typeof e.metadata&&e.metadata.printer_paper_size||"58mm"}}}catch(e){return console.error("Error loading business settings:",e),c({title:"Error",description:"Failed to load business settings. Please try again.",variant:"destructive"}),u()}},p=async s=>{if(!m)return console.error("No business selected for updating settings"),c({title:"Error",description:"No business selected",variant:"destructive"}),!1;try{let t={payment_info:s.hasOwnProperty("paymentInfo")?s.paymentInfo:e.paymentInfo||"",default_print_format:s.hasOwnProperty("defaultPrintFormat")?s.defaultPrintFormat:e.defaultPrintFormat||"standard",default_printer_name:s.hasOwnProperty("defaultPrinterName")?s.defaultPrinterName:e.defaultPrinterName||"",default_printer_type:s.hasOwnProperty("defaultPrinterType")?s.defaultPrinterType:e.defaultPrinterType||"USB",printer_paper_size:s.hasOwnProperty("printerPaperSize")?s.printerPaperSize:e.printerPaperSize||"58mm"},a={business_name:s.hasOwnProperty("businessName")?s.businessName:e.businessName,business_address:s.hasOwnProperty("businessAddress")?s.businessAddress:e.businessAddress,business_phone:s.hasOwnProperty("businessPhone")?s.businessPhone:e.businessPhone,business_email:s.hasOwnProperty("businessEmail")?s.businessEmail:e.businessEmail,business_logo:s.hasOwnProperty("businessLogo")?s.businessLogo:e.businessLogo,currency:s.hasOwnProperty("currency")?s.currency:e.currency,signature:s.hasOwnProperty("signature")?s.signature:e.signature,metadata:t},i=await (0,l.upsertBusinessSettingsAction)(m.id,"00000000-0000-0000-0000-000000000000",a);if(!i.success)throw console.error("Supabase error updating business settings:",i.error),Error(i.error);return c({title:"Success",description:"Business settings updated successfully"}),g(),!0}catch(e){return console.error("Error updating business settings:",e),c({title:"Error",description:"Failed to update business settings. Please try again.",variant:"destructive"}),!1}},{data:b,isLoading:x,isFetching:f,refetch:g}=(0,t.useQuery)({queryKey:["businessSettings",m?.id],queryFn:h,enabled:!!m?.id,staleTime:3e5,gcTime:18e5,refetchOnWindowFocus:!1,refetchOnReconnect:!1});return(0,s.useEffect)(()=>{b?r(b):m||r(u())},[b,m]),(0,s.useEffect)(()=>{o(x||f)},[x,f]),{settings:e,isLoading:d,updateSettings:p,loadSettings:h}}],160615)},531278,e=>{"use strict";let s=(0,e.i(475254).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>s],531278)},569074,e=>{"use strict";let s=(0,e.i(475254).default)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);e.s(["Upload",()=>s],569074)},263488,e=>{"use strict";let s=(0,e.i(475254).default)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);e.s(["Mail",()=>s],263488)},343432,e=>{"use strict";let s=(0,e.i(475254).default)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);e.s(["Phone",()=>s],343432)},595468,e=>{"use strict";let s=(0,e.i(475254).default)("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);e.s(["CheckCircle2",()=>s],595468)},972520,e=>{"use strict";let s=(0,e.i(475254).default)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);e.s(["ArrowRight",()=>s],972520)},63727,e=>{"use strict";let s=(0,e.i(475254).default)("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);e.s(["Briefcase",()=>s],63727)},346897,e=>{"use strict";let s=(0,e.i(475254).default)("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);e.s(["MapPin",()=>s],346897)},328549,e=>{"use strict";var s=e.i(843476),t=e.i(271645),a=e.i(904792),i=e.i(519455),r=e.i(793479),n=e.i(110204),l=e.i(967489),u=e.i(261246),d=e.i(846696),o=e.i(971984),c=e.i(160615),m=e.i(102594),h=e.i(607486),p=e.i(346897),b=e.i(343432),x=e.i(263488),f=e.i(63727),g=e.i(761911),y=e.i(37727),v=e.i(531278),N=e.i(595468),j=e.i(569074),w=e.i(972520);let P=(0,e.i(475254).default)("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);var S=e.i(292270);let k=[{value:"1-5",label:"1â€“5 employees"},{value:"6-20",label:"6â€“20 employees"},{value:"21-50",label:"21â€“50 employees"},{value:"50+",label:"50+ employees"}];e.s(["default",0,()=>{let e=(0,a.useNavigate)(),{user:A,signOut:L}=(0,m.useAuth)(),{onboarding:_,isLoading:E,isCompleted:B,saveOnboarding:z}=(0,o.useOnboarding)(),{settings:O,isLoading:C,updateSettings:F}=(0,c.useBusinessSettings)(),[M,T]=(0,t.useState)(!1),[I,U]=(0,t.useState)(null),[q,R]=(0,t.useState)(null),[D,G]=(0,t.useState)(!1),$=(0,t.useRef)(null),[K,V]=(0,t.useState)({businessName:"",businessAddress:"",businessPhone:"",businessEmail:A?.email||"",natureOfBusiness:"",businessSize:""}),[H,W]=(0,t.useState)({});(0,t.useEffect)(()=>{!E&&B&&(console.log("Onboarding: Already completed, redirecting to dashboard"),e("/",{replace:!0}))},[E,B,e]),(0,t.useEffect)(()=>{!C&&O&&(V(e=>({...e,businessName:O.businessName||e.businessName,businessAddress:O.businessAddress||e.businessAddress,businessPhone:O.businessPhone||e.businessPhone,businessEmail:O.businessEmail||e.businessEmail})),O.businessLogo&&U(O.businessLogo))},[C,O]);let X=(0,t.useCallback)(e=>{if(!e.type.startsWith("image/"))return void d.toast.error("Please upload an image file");if(e.size>5242880)return void d.toast.error("Image must be smaller than 5MB");R(e);let s=new FileReader;s.onloadend=()=>U(s.result),s.readAsDataURL(e)},[]),Y=(0,t.useCallback)(e=>{e.preventDefault(),G(!1);let s=e.dataTransfer.files?.[0];s&&X(s)},[X]);if(E||C)return(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsx)(u.default,{message:"Loading your profile..."})});let J=(e,s)=>{V(t=>({...t,[e]:s})),H[e]&&W(s=>({...s,[e]:""}))},Q=async()=>(console.warn("Logo upload placeholder â€“ integration with Prisma server action required"),I),Z=async s=>{let t;if(s.preventDefault(),t={},K.businessName.trim()||(t.businessName="Business name is required"),K.businessAddress.trim()||(t.businessAddress="Address is required"),K.businessPhone.trim()||(t.businessPhone="Phone number is required"),K.businessEmail.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(K.businessEmail)||(t.businessEmail="Please enter a valid email"):t.businessEmail="Email is required",W(t),0===Object.keys(t).length){T(!0);try{let s=q?await Q():I;if(!await z({business_logo:s??void 0,business_name:K.businessName.trim(),business_address:K.businessAddress.trim(),business_phone:K.businessPhone.trim(),business_email:K.businessEmail.trim(),nature_of_business:K.natureOfBusiness.trim()||void 0,business_size:K.businessSize||void 0,completed:!0}))return void d.toast.error("Failed to save onboarding data. Please try again.");await F({businessName:K.businessName.trim(),businessAddress:K.businessAddress.trim(),businessPhone:K.businessPhone.trim(),businessEmail:K.businessEmail.trim(),...s?{businessLogo:s}:{}}),d.toast.success("Business profile set up! Welcome aboard ðŸŽ‰"),e("/",{replace:!0})}catch(e){console.error("Onboarding submit error:",e),d.toast.error("Something went wrong. Please try again.")}finally{T(!1)}}};return(0,s.jsxs)("div",{className:"min-h-screen bg-background flex flex-col lg:flex-row",children:[(0,s.jsxs)("div",{className:"w-full lg:w-2/5 xl:w-1/3 flex flex-col px-6 py-8 lg:p-10 relative overflow-hidden lg:min-h-screen",style:{background:"hsl(var(--primary))"},children:[(0,s.jsx)("div",{className:"absolute -top-16 -left-16 w-56 h-56 rounded-full opacity-10 bg-white pointer-events-none"}),(0,s.jsx)("div",{className:"absolute -bottom-10 -right-10 w-48 h-48 rounded-full opacity-10 bg-white pointer-events-none"}),(0,s.jsx)("div",{className:"relative z-10",children:(0,s.jsx)("img",{src:"/lovable-uploads/798d07d7-1db7-498c-92f3-6f6346827d59.png",alt:"Gonzo Systems",className:"h-10 object-contain brightness-0 invert"})}),(0,s.jsxs)("div",{className:"relative z-10 mt-6 lg:mt-auto lg:mb-auto space-y-4",children:[(0,s.jsxs)("div",{className:"inline-flex items-center gap-2 bg-white/10 text-white/90 text-xs font-medium px-3 py-1.5 rounded-full border border-white/20",children:[(0,s.jsx)(P,{className:"h-3.5 w-3.5"}),"One-time setup"]}),(0,s.jsxs)("h2",{className:"text-2xl sm:text-3xl font-bold text-white leading-snug",children:["Let's get your",(0,s.jsx)("br",{className:"hidden sm:block"})," business ready."]}),(0,s.jsx)("p",{className:"text-white/70 text-sm leading-relaxed max-w-xs",children:"Fill in your business details to personalise your workspace. You can always update these later in Settings."}),(0,s.jsx)("ul",{className:"hidden sm:flex flex-col gap-2.5 text-sm text-white/80 pt-2",children:["Appears on receipts & invoices","Pre-fills your Settings page","Helps your team identify the business"].map(e=>(0,s.jsxs)("li",{className:"flex items-center gap-2",children:[(0,s.jsx)(N.CheckCircle2,{className:"h-4 w-4 text-white/50 shrink-0"}),e]},e))})]}),(0,s.jsxs)("p",{className:"relative z-10 hidden lg:block text-white/30 text-xs mt-auto pt-8",children:["Â© ",new Date().getFullYear()," Gonzo Systems"]})]}),(0,s.jsx)("div",{className:"flex-1 flex flex-col overflow-y-auto",children:(0,s.jsx)("div",{className:"flex-1 flex items-start justify-center px-4 sm:px-8 py-8 lg:py-16",children:(0,s.jsxs)("div",{className:"w-full max-w-xl",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start mb-6 font-geist",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-xl sm:text-2xl font-bold text-foreground",children:"Set up your business"}),(0,s.jsx)("p",{className:"text-muted-foreground text-sm mt-1",children:"This information will appear on your receipts and reports."})]}),(0,s.jsxs)(i.Button,{type:"button",variant:"ghost",size:"sm",onClick:()=>L(),className:"text-muted-foreground hover:text-foreground gap-2",children:[(0,s.jsx)(S.LogOut,{className:"h-4 w-4"}),"Logout"]})]}),(0,s.jsxs)("form",{onSubmit:Z,className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-1.5",children:[(0,s.jsxs)(n.Label,{className:"text-sm font-medium",children:["Business Logo"," ",(0,s.jsx)("span",{className:"text-muted-foreground font-normal text-xs",children:"(optional)"})]}),I?(0,s.jsxs)("div",{className:"flex items-center gap-3 p-3 border border-border rounded-lg bg-muted/30",children:[(0,s.jsx)("img",{src:I,alt:"Logo preview",className:"h-12 w-12 object-contain rounded-md border border-border bg-white shrink-0"}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"text-sm font-medium truncate",children:q?.name||"Logo"}),q&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:[(q.size/1024).toFixed(0)," KB"]})]}),(0,s.jsx)(i.Button,{type:"button",variant:"ghost",size:"sm",onClick:()=>{U(null),R(null),$.current&&($.current.value="")},className:"text-destructive hover:text-destructive hover:bg-destructive/10 shrink-0 h-8 w-8 p-0",children:(0,s.jsx)(y.X,{className:"h-4 w-4"})})]}):(0,s.jsxs)("div",{onDrop:Y,onDragOver:e=>{e.preventDefault(),G(!0)},onDragLeave:()=>G(!1),onClick:()=>$.current?.click(),className:`flex items-center gap-3 p-4 border-2 border-dashed rounded-lg cursor-pointer transition-colors ${D?"border-primary bg-primary/5":"border-border hover:border-primary/40 hover:bg-muted/20"}`,children:[(0,s.jsx)("div",{className:"h-9 w-9 rounded-lg bg-muted flex items-center justify-center shrink-0",children:(0,s.jsx)(j.Upload,{className:"h-4 w-4 text-muted-foreground"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium",children:D?"Drop here":"Click or drag to upload"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"PNG, JPG, SVG â€” max 5MB"})]})]}),(0,s.jsx)("input",{ref:$,type:"file",accept:"image/*",className:"hidden",onChange:e=>{let s=e.target.files?.[0];s&&X(s)}})]}),(0,s.jsxs)("div",{className:"space-y-1.5",children:[(0,s.jsxs)(n.Label,{htmlFor:"businessName",className:"text-sm font-medium flex items-center gap-1.5",children:[(0,s.jsx)(h.Building2,{className:"h-3.5 w-3.5 text-muted-foreground"}),"Business Name ",(0,s.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,s.jsx)(r.Input,{id:"businessName",value:K.businessName,onChange:e=>J("businessName",e.target.value),placeholder:"",className:H.businessName?"border-destructive":""}),H.businessName&&(0,s.jsx)("p",{className:"text-xs text-destructive",children:H.businessName})]}),(0,s.jsxs)("div",{className:"space-y-1.5",children:[(0,s.jsxs)(n.Label,{htmlFor:"businessAddress",className:"text-sm font-medium flex items-center gap-1.5",children:[(0,s.jsx)(p.MapPin,{className:"h-3.5 w-3.5 text-muted-foreground"}),"Location / Address ",(0,s.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,s.jsx)(r.Input,{id:"businessAddress",value:K.businessAddress,onChange:e=>J("businessAddress",e.target.value),placeholder:"",className:H.businessAddress?"border-destructive":""}),H.businessAddress&&(0,s.jsx)("p",{className:"text-xs text-destructive",children:H.businessAddress})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-1.5",children:[(0,s.jsxs)(n.Label,{htmlFor:"businessPhone",className:"text-sm font-medium flex items-center gap-1.5",children:[(0,s.jsx)(b.Phone,{className:"h-3.5 w-3.5 text-muted-foreground"}),"Phone ",(0,s.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,s.jsx)(r.Input,{id:"businessPhone",type:"tel",value:K.businessPhone,onChange:e=>J("businessPhone",e.target.value),placeholder:"",className:H.businessPhone?"border-destructive":""}),H.businessPhone&&(0,s.jsx)("p",{className:"text-xs text-destructive",children:H.businessPhone})]}),(0,s.jsxs)("div",{className:"space-y-1.5",children:[(0,s.jsxs)(n.Label,{htmlFor:"businessEmail",className:"text-sm font-medium flex items-center gap-1.5",children:[(0,s.jsx)(x.Mail,{className:"h-3.5 w-3.5 text-muted-foreground"}),"Email ",(0,s.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,s.jsx)(r.Input,{id:"businessEmail",type:"email",value:K.businessEmail,onChange:e=>J("businessEmail",e.target.value),placeholder:"",className:H.businessEmail?"border-destructive":""}),H.businessEmail&&(0,s.jsx)("p",{className:"text-xs text-destructive",children:H.businessEmail})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-1.5",children:[(0,s.jsxs)(n.Label,{htmlFor:"natureOfBusiness",className:"text-sm font-medium flex items-center gap-1.5",children:[(0,s.jsx)(f.Briefcase,{className:"h-3.5 w-3.5 text-muted-foreground"}),"Nature of Business ",(0,s.jsx)("span",{className:"text-muted-foreground font-normal text-xs",children:"(optional)"})]}),(0,s.jsx)(r.Input,{id:"natureOfBusiness",value:K.natureOfBusiness,onChange:e=>J("natureOfBusiness",e.target.value),placeholder:""})]}),(0,s.jsxs)("div",{className:"space-y-1.5",children:[(0,s.jsxs)(n.Label,{htmlFor:"businessSize",className:"text-sm font-medium flex items-center gap-1.5",children:[(0,s.jsx)(g.Users,{className:"h-3.5 w-3.5 text-muted-foreground"}),"Business Size ",(0,s.jsx)("span",{className:"text-muted-foreground font-normal text-xs",children:"(optional)"})]}),(0,s.jsxs)(l.Select,{value:K.businessSize,onValueChange:e=>J("businessSize",e),children:[(0,s.jsx)(l.SelectTrigger,{id:"businessSize",children:(0,s.jsx)(l.SelectValue,{placeholder:"No. of employees"})}),(0,s.jsx)(l.SelectContent,{children:k.map(e=>(0,s.jsx)(l.SelectItem,{value:e.value,children:e.label},e.value))})]})]})]}),(0,s.jsxs)("div",{className:"pt-2 pb-4",children:[(0,s.jsx)(i.Button,{type:"submit",disabled:M,className:"w-full h-11 font-semibold gap-2",children:M?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(v.Loader2,{className:"h-4 w-4 animate-spin"})," Setting up your business..."]}):(0,s.jsxs)(s.Fragment,{children:["Complete Setup ",(0,s.jsx)(w.ArrowRight,{className:"h-4 w-4"})]})}),(0,s.jsxs)("p",{className:"text-center text-xs text-muted-foreground mt-3",children:["You can update all of this later in ",(0,s.jsx)("span",{className:"font-medium",children:"Settings"}),"."]})]})]})]})})})]})}],328549)}]);