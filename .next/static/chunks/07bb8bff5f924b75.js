(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,386408,e=>{"use strict";let t=(0,e.i(369547).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>t],386408)},312761,e=>{"use strict";let t=(0,e.i(369547).default)("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);e.s(["CreditCard",()=>t],312761)},235090,e=>{"use strict";let t=(0,e.i(369547).default)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);e.s(["MessageSquare",()=>t],235090)},295746,e=>{"use strict";let t=(0,e.i(369547).default)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);e.s(["Users",()=>t],295746)},430788,e=>{"use strict";let t=(0,e.i(369547).default)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);e.s(["CheckCircle",()=>t],430788)},300550,e=>{"use strict";let t=(0,e.i(369547).default)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);e.s(["Save",()=>t],300550)},681912,(e,t,r)=>{"use strict";var a=e.r(730943);r.createRoot=a.createRoot,r.hydrateRoot=a.hydrateRoot},741705,(e,t,r)=>{"use strict";r._=function(e){return e&&e.__esModule?e:{default:e}}},952456,(e,t,r)=>{"use strict";function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}r._=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=a(t);if(r&&r.has(e))return r.get(e);var o={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var i=s?Object.getOwnPropertyDescriptor(e,n):null;i&&(i.get||i.set)?Object.defineProperty(o,n,i):o[n]=e[n]}return o.default=e,r&&r.set(e,o),o}},713584,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"HeadManagerContext",{enumerable:!0,get:function(){return a}});let a=e.r(741705)._(e.r(191788)).default.createContext({})},894470,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"warnOnce",{enumerable:!0,get:function(){return a}});let a=e=>{}},889129,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a={DecodeError:function(){return h},MiddlewareNotFoundError:function(){return w},MissingStaticPage:function(){return I},NormalizeError:function(){return v},PageNotFoundError:function(){return b},SP:function(){return p},ST:function(){return g},WEB_VITALS:function(){return s},execOnce:function(){return n},getDisplayName:function(){return l},getLocationOrigin:function(){return u},getURL:function(){return d},isAbsoluteUrl:function(){return c},isResSent:function(){return m},loadGetInitialProps:function(){return f},normalizeRepeatedSlashes:function(){return y},stringifyError:function(){return _}};for(var o in a)Object.defineProperty(r,o,{enumerable:!0,get:a[o]});let s=["CLS","FCP","FID","INP","LCP","TTFB"];function n(e){let t,r=!1;return(...a)=>(r||(r=!0,t=e(...a)),t)}let i=/^[a-zA-Z][a-zA-Z\d+\-.]*?:/,c=e=>i.test(e);function u(){let{protocol:e,hostname:t,port:r}=window.location;return`${e}//${t}${r?":"+r:""}`}function d(){let{href:e}=window.location,t=u();return e.substring(t.length)}function l(e){return"string"==typeof e?e:e.displayName||e.name||"Unknown"}function m(e){return e.finished||e.headersSent}function y(e){let t=e.split("?");return t[0].replace(/\\/g,"/").replace(/\/\/+/g,"/")+(t[1]?`?${t.slice(1).join("?")}`:"")}async function f(e,t){let r=t.res||t.ctx&&t.ctx.res;if(!e.getInitialProps)return t.ctx&&t.Component?{pageProps:await f(t.Component,t.ctx)}:{};let a=await e.getInitialProps(t);if(r&&m(r))return a;if(!a)throw Object.defineProperty(Error(`"${l(e)}.getInitialProps()" should resolve to an object. But found "${a}" instead.`),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});return a}let p="u">typeof performance,g=p&&["mark","measure","getEntriesByName"].every(e=>"function"==typeof performance[e]);class h extends Error{}class v extends Error{}class b extends Error{constructor(e){super(),this.code="ENOENT",this.name="PageNotFoundError",this.message=`Cannot find module for page: ${e}`}}class I extends Error{constructor(e,t){super(),this.message=`Failed to load static file for page: ${e} ${t}`}}class w extends Error{constructor(){super(),this.code="ENOENT",this.message="Cannot find the middleware module"}}function _(e){return JSON.stringify({message:e.message,stack:e.stack})}},701085,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a={AppRouterContext:function(){return n},GlobalLayoutRouterContext:function(){return c},LayoutRouterContext:function(){return i},MissingSlotContext:function(){return d},TemplateContext:function(){return u}};for(var o in a)Object.defineProperty(r,o,{enumerable:!0,get:a[o]});let s=e.r(741705)._(e.r(191788)),n=s.default.createContext(null),i=s.default.createContext(null),c=s.default.createContext(null),u=s.default.createContext(null),d=s.default.createContext(new Set)},531430,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"ReadonlyURLSearchParams",{enumerable:!0,get:function(){return o}});class a extends Error{constructor(){super("Method unavailable on `ReadonlyURLSearchParams`. Read more: https://nextjs.org/docs/app/api-reference/functions/use-search-params#updating-searchparams")}}class o extends URLSearchParams{append(){throw new a}delete(){throw new a}set(){throw new a}sort(){throw new a}}("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),t.exports=r.default)},470008,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a={NavigationPromisesContext:function(){return d},PathParamsContext:function(){return u},PathnameContext:function(){return c},ReadonlyURLSearchParams:function(){return n.ReadonlyURLSearchParams},SearchParamsContext:function(){return i},createDevToolsInstrumentedPromise:function(){return l}};for(var o in a)Object.defineProperty(r,o,{enumerable:!0,get:a[o]});let s=e.r(191788),n=e.r(531430),i=(0,s.createContext)(null),c=(0,s.createContext)(null),u=(0,s.createContext)(null),d=(0,s.createContext)(null);function l(e,t){let r=Promise.resolve(t);return r.status="fulfilled",r.value=t,r.displayName=`${e} (SSR)`,r}},991622,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a={HTTPAccessErrorStatus:function(){return s},HTTP_ERROR_FALLBACK_ERROR_CODE:function(){return i},getAccessFallbackErrorTypeByStatus:function(){return d},getAccessFallbackHTTPStatus:function(){return u},isHTTPAccessFallbackError:function(){return c}};for(var o in a)Object.defineProperty(r,o,{enumerable:!0,get:a[o]});let s={NOT_FOUND:404,FORBIDDEN:403,UNAUTHORIZED:401},n=new Set(Object.values(s)),i="NEXT_HTTP_ERROR_FALLBACK";function c(e){if("object"!=typeof e||null===e||!("digest"in e)||"string"!=typeof e.digest)return!1;let[t,r]=e.digest.split(";");return t===i&&n.has(Number(r))}function u(e){return Number(e.digest.split(";")[1])}function d(e){switch(e){case 401:return"unauthorized";case 403:return"forbidden";case 404:return"not-found";default:return}}("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),t.exports=r.default)},40184,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"RedirectStatusCode",{enumerable:!0,get:function(){return o}});var a,o=((a={})[a.SeeOther=303]="SeeOther",a[a.TemporaryRedirect=307]="TemporaryRedirect",a[a.PermanentRedirect=308]="PermanentRedirect",a);("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),t.exports=r.default)},301939,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a,o={REDIRECT_ERROR_CODE:function(){return i},RedirectType:function(){return c},isRedirectError:function(){return u}};for(var s in o)Object.defineProperty(r,s,{enumerable:!0,get:o[s]});let n=e.r(40184),i="NEXT_REDIRECT";var c=((a={}).push="push",a.replace="replace",a);function u(e){if("object"!=typeof e||null===e||!("digest"in e)||"string"!=typeof e.digest)return!1;let t=e.digest.split(";"),[r,a]=t,o=t.slice(2,-2).join(";"),s=Number(t.at(-2));return r===i&&("replace"===a||"push"===a)&&"string"==typeof o&&!isNaN(s)&&s in n.RedirectStatusCode}("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),t.exports=r.default)},68934,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"isNextRouterError",{enumerable:!0,get:function(){return s}});let a=e.r(991622),o=e.r(301939);function s(e){return(0,o.isRedirectError)(e)||(0,a.isHTTPAccessFallbackError)(e)}("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),t.exports=r.default)},457541,e=>{"use strict";let t=(0,e.i(369547).default)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);e.s(["Filter",()=>t],457541)},469757,e=>{"use strict";let t=(0,e.i(369547).default)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);e.s(["DollarSign",()=>t],469757)},221498,e=>{"use strict";var t=e.i(191788),r=e.i(671185),a=e.i(352162),o=e.i(357006),s=e.i(479293),n=e.i(64592),i=e.i(674534),c=e.i(998657),u=e.i(55037),d=e.i(724537),l=e.i(391398),m="rovingFocusGroup.onEntryFocus",y={bubbles:!1,cancelable:!0},f="RovingFocusGroup",[p,g,h]=(0,a.createCollection)(f),[v,b]=(0,s.createContextScope)(f,[h]),[I,w]=v(f),_=t.forwardRef((e,t)=>(0,l.jsx)(p.Provider,{scope:e.__scopeRovingFocusGroup,children:(0,l.jsx)(p.Slot,{scope:e.__scopeRovingFocusGroup,children:(0,l.jsx)(S,{...e,ref:t})})}));_.displayName=f;var S=t.forwardRef((e,a)=>{let{__scopeRovingFocusGroup:s,orientation:n,loop:p=!1,dir:h,currentTabStopId:v,defaultCurrentTabStopId:b,onCurrentTabStopIdChange:w,onEntryFocus:_,preventScrollOnEntryFocus:S=!1,...E}=e,P=t.useRef(null),C=(0,o.useComposedRefs)(a,P),A=(0,d.useDirection)(h),[T,x]=(0,u.useControllableState)({prop:v,defaultProp:b??null,onChange:w,caller:f}),[R,M]=t.useState(!1),O=(0,c.useCallbackRef)(_),k=g(s),D=t.useRef(!1),[j,F]=t.useState(0);return t.useEffect(()=>{let e=P.current;if(e)return e.addEventListener(m,O),()=>e.removeEventListener(m,O)},[O]),(0,l.jsx)(I,{scope:s,orientation:n,dir:A,loop:p,currentTabStopId:T,onItemFocus:t.useCallback(e=>x(e),[x]),onItemShiftTab:t.useCallback(()=>M(!0),[]),onFocusableItemAdd:t.useCallback(()=>F(e=>e+1),[]),onFocusableItemRemove:t.useCallback(()=>F(e=>e-1),[]),children:(0,l.jsx)(i.Primitive.div,{tabIndex:R||0===j?-1:0,"data-orientation":n,...E,ref:C,style:{outline:"none",...e.style},onMouseDown:(0,r.composeEventHandlers)(e.onMouseDown,()=>{D.current=!0}),onFocus:(0,r.composeEventHandlers)(e.onFocus,e=>{let t=!D.current;if(e.target===e.currentTarget&&t&&!R){let t=new CustomEvent(m,y);if(e.currentTarget.dispatchEvent(t),!t.defaultPrevented){let e=k().filter(e=>e.focusable);N([e.find(e=>e.active),e.find(e=>e.id===T),...e].filter(Boolean).map(e=>e.ref.current),S)}}D.current=!1}),onBlur:(0,r.composeEventHandlers)(e.onBlur,()=>M(!1))})})}),E="RovingFocusGroupItem",P=t.forwardRef((e,a)=>{let{__scopeRovingFocusGroup:o,focusable:s=!0,active:c=!1,tabStopId:u,children:d,...m}=e,y=(0,n.useId)(),f=u||y,h=w(E,o),v=h.currentTabStopId===f,b=g(o),{onFocusableItemAdd:I,onFocusableItemRemove:_,currentTabStopId:S}=h;return t.useEffect(()=>{if(s)return I(),()=>_()},[s,I,_]),(0,l.jsx)(p.ItemSlot,{scope:o,id:f,focusable:s,active:c,children:(0,l.jsx)(i.Primitive.span,{tabIndex:v?0:-1,"data-orientation":h.orientation,...m,ref:a,onMouseDown:(0,r.composeEventHandlers)(e.onMouseDown,e=>{s?h.onItemFocus(f):e.preventDefault()}),onFocus:(0,r.composeEventHandlers)(e.onFocus,()=>h.onItemFocus(f)),onKeyDown:(0,r.composeEventHandlers)(e.onKeyDown,e=>{if("Tab"===e.key&&e.shiftKey)return void h.onItemShiftTab();if(e.target!==e.currentTarget)return;let t=function(e,t,r){var a;let o=(a=e.key,"rtl"!==r?a:"ArrowLeft"===a?"ArrowRight":"ArrowRight"===a?"ArrowLeft":a);if(!("vertical"===t&&["ArrowLeft","ArrowRight"].includes(o))&&!("horizontal"===t&&["ArrowUp","ArrowDown"].includes(o)))return C[o]}(e,h.orientation,h.dir);if(void 0!==t){if(e.metaKey||e.ctrlKey||e.altKey||e.shiftKey)return;e.preventDefault();let o=b().filter(e=>e.focusable).map(e=>e.ref.current);if("last"===t)o.reverse();else if("prev"===t||"next"===t){var r,a;"prev"===t&&o.reverse();let s=o.indexOf(e.currentTarget);o=h.loop?(r=o,a=s+1,r.map((e,t)=>r[(a+t)%r.length])):o.slice(s+1)}setTimeout(()=>N(o))}}),children:"function"==typeof d?d({isCurrentTabStop:v,hasTabStop:null!=S}):d})})});P.displayName=E;var C={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function N(e,t=!1){let r=document.activeElement;for(let a of e)if(a===r||(a.focus({preventScroll:t}),document.activeElement!==r))return}e.s(["Item",()=>P,"Root",()=>_,"createRovingFocusGroupScope",()=>b])},93445,e=>{"use strict";var t=e.i(653162);function r(e,r,a){return(0,t.addMonths)(e,-r,a)}e.s(["subMonths",()=>r])},550292,e=>{"use strict";var t=e.i(391398),r=e.i(191788),a=e.i(671185),o=e.i(479293),s=e.i(221498),n=e.i(993953),i=e.i(674534),c=e.i(724537),u=e.i(55037),d=e.i(64592),l="Tabs",[m,y]=(0,o.createContextScope)(l,[s.createRovingFocusGroupScope]),f=(0,s.createRovingFocusGroupScope)(),[p,g]=m(l),h=r.forwardRef((e,r)=>{let{__scopeTabs:a,value:o,onValueChange:s,defaultValue:n,orientation:m="horizontal",dir:y,activationMode:f="automatic",...g}=e,h=(0,c.useDirection)(y),[v,b]=(0,u.useControllableState)({prop:o,onChange:s,defaultProp:n??"",caller:l});return(0,t.jsx)(p,{scope:a,baseId:(0,d.useId)(),value:v,onValueChange:b,orientation:m,dir:h,activationMode:f,children:(0,t.jsx)(i.Primitive.div,{dir:h,"data-orientation":m,...g,ref:r})})});h.displayName=l;var v="TabsList",b=r.forwardRef((e,r)=>{let{__scopeTabs:a,loop:o=!0,...n}=e,c=g(v,a),u=f(a);return(0,t.jsx)(s.Root,{asChild:!0,...u,orientation:c.orientation,dir:c.dir,loop:o,children:(0,t.jsx)(i.Primitive.div,{role:"tablist","aria-orientation":c.orientation,...n,ref:r})})});b.displayName=v;var I="TabsTrigger",w=r.forwardRef((e,r)=>{let{__scopeTabs:o,value:n,disabled:c=!1,...u}=e,d=g(I,o),l=f(o),m=E(d.baseId,n),y=P(d.baseId,n),p=n===d.value;return(0,t.jsx)(s.Item,{asChild:!0,...l,focusable:!c,active:p,children:(0,t.jsx)(i.Primitive.button,{type:"button",role:"tab","aria-selected":p,"aria-controls":y,"data-state":p?"active":"inactive","data-disabled":c?"":void 0,disabled:c,id:m,...u,ref:r,onMouseDown:(0,a.composeEventHandlers)(e.onMouseDown,e=>{c||0!==e.button||!1!==e.ctrlKey?e.preventDefault():d.onValueChange(n)}),onKeyDown:(0,a.composeEventHandlers)(e.onKeyDown,e=>{[" ","Enter"].includes(e.key)&&d.onValueChange(n)}),onFocus:(0,a.composeEventHandlers)(e.onFocus,()=>{let e="manual"!==d.activationMode;p||c||!e||d.onValueChange(n)})})})});w.displayName=I;var _="TabsContent",S=r.forwardRef((e,a)=>{let{__scopeTabs:o,value:s,forceMount:c,children:u,...d}=e,l=g(_,o),m=E(l.baseId,s),y=P(l.baseId,s),f=s===l.value,p=r.useRef(f);return r.useEffect(()=>{let e=requestAnimationFrame(()=>p.current=!1);return()=>cancelAnimationFrame(e)},[]),(0,t.jsx)(n.Presence,{present:c||f,children:({present:r})=>(0,t.jsx)(i.Primitive.div,{"data-state":f?"active":"inactive","data-orientation":l.orientation,role:"tabpanel","aria-labelledby":m,hidden:!r,id:y,tabIndex:0,...d,ref:a,style:{...e.style,animationDuration:p.current?"0s":void 0},children:r&&u})})});function E(e,t){return`${e}-trigger-${t}`}function P(e,t){return`${e}-content-${t}`}S.displayName=_;var C=e.i(353533);let N=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)(b,{ref:a,className:(0,C.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...r}));N.displayName=b.displayName;let A=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)(w,{ref:a,className:(0,C.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...r}));A.displayName=w.displayName;let T=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)(S,{ref:a,className:(0,C.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...r}));T.displayName=S.displayName,e.s(["Tabs",()=>h,"TabsContent",()=>T,"TabsList",()=>N,"TabsTrigger",()=>A],550292)},533538,e=>{"use strict";let t=(0,e.i(369547).default)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);e.s(["Search",()=>t],533538)},756043,e=>{"use strict";let t=(0,e.i(369547).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);e.s(["Clock",()=>t],756043)},8745,(e,t,r)=>{let a=Error("Could not parse module '[project]/src/app/actions/products.ts'\n\n'import', and 'export' cannot be used outside of module code");throw a.code="MODULE_UNPARSABLE",a},355879,775778,e=>{"use strict";var t=e.i(191788),r=e.i(563905),a=e.i(46108),o=e.i(893930),s=e.i(285700);let n=e=>{let t=Object.keys(localStorage),r=["allProductsStats_","stockSummary_","soldItems_","dashboardData_","analyticsData_"],a=0;t.forEach(e=>{r.some(t=>e.startsWith(t))&&(localStorage.removeItem(e),a++)}),a>0&&console.log(`[Cache] Cleared ${a} inventory-related localStorage entries.`),e&&(console.log("[Cache] Invalidating React Query inventory keys..."),e.invalidateQueries({queryKey:["inventory_global_stats"]}),e.invalidateQueries({queryKey:["stockSummary"]}),e.invalidateQueries({queryKey:["products"]}),e.invalidateQueries({queryKey:["sales"]}),e.invalidateQueries({queryKey:["all-products-for-scanner"]}),e.invalidateQueries({queryKey:["all-products"]}))};e.s(["clearInventoryCaches",0,n],775778);var i=e.i(8745);e.s(["useProducts",0,(e,c=50)=>{let[u,d]=(0,t.useState)([]),[l,m]=(0,t.useState)(1),[y,f]=(0,t.useState)(c),[p,g]=(0,t.useState)(0),[h,v]=(0,t.useState)(!1),{settings:b}=(0,r.useBusinessSettings)(),{currentBusiness:I}=(0,a.useBusiness)(),w=(0,s.useQueryClient)(),[_,S]=(0,t.useState)({search:"",category:"all",stockStatus:"all"}),[E,P]=(0,t.useState)(null),C=(0,t.useCallback)(e=>{e.search!==_.search&&(v(!0),E&&clearTimeout(E),P(setTimeout(()=>{v(!1)},600))),S(e)},[_.search,E]),N=(0,t.useCallback)(async()=>{if(!e||!I)return{products:[],count:0};try{return await (0,i.getProductsAction)({userId:e,businessId:I.id,page:l,pageSize:y,search:_.search,category:"all"===_.category?void 0:_.category,stockStatus:_.stockStatus})}catch(e){return console.error("Error loading products from server action:",e),{products:[],count:0}}},[e,I?.id,l,y,_.search,_.category,_.stockStatus]),A=(0,t.useMemo)(()=>["products",e,I?.id],[e,I?.id]),T=(0,t.useMemo)(()=>[...A,l,y,_.search,_.category,_.stockStatus],[A,l,y,_.search,_.category,_.stockStatus]),{data:x,isLoading:R,isFetching:M,refetch:O}=(0,o.useQuery)({queryKey:T,queryFn:N,enabled:!!e&&!!I?.id,staleTime:3e4,gcTime:18e5,refetchOnWindowFocus:!0,refetchOnReconnect:!0});(0,t.useEffect)(()=>{x&&(d(x.products),g(x.count))},[x]);let k=async t=>{try{if(!e)return null;return console.warn("Image upload redirecting to server action (TODO)"),null}catch(e){return console.error("Error in uploadProductImage:",e),null}};return{products:u,isLoading:R&&!x&&!h,loadProducts:N,page:l,setPage:m,pageSize:y,setPageSize:f,totalCount:p,createProduct:async t=>{try{if(!e||!I)return null;let r=await (0,i.createProductAction)({...t,userId:e,businessId:I.id});if(!r)return null;return d(e=>[r,...e]),g(e=>e+1),w.invalidateQueries({queryKey:A}),n(w),r}catch(e){return console.error("Error creating product:",e),null}},updateProduct:async(t,r,a,o=!1,s,c,u,d)=>{try{if(!e||!I)return!1;let c=r.imageUrl;if(a&&(c=await k(a)),!await (0,i.updateProductAction)(t,{...r,imageUrl:c,userId:e,businessId:I.id,isFromSale:o,customChangeReason:s,referenceId:u}))return!1;return w.invalidateQueries({queryKey:A}),n(w),!0}catch(e){return console.error("Error updating product:",e),!1}},updateProductsBulk:async(t,r,a,o,s,c)=>{try{if(!e||!I)return!1;let r=await (0,i.updateProductsBulkAction)(t.map(e=>({id:e.id,updated:e.updated})),I.id);return r&&(w.invalidateQueries({queryKey:A}),n(w)),r}catch(e){return console.error("Error in bulk update:",e),!1}},deleteProduct:async t=>{try{if(!e)return!1;if(await (0,i.deleteProductAction)(t))return w.invalidateQueries({queryKey:A}),n(w),!0;return!1}catch(e){return console.error("Error deleting product:",e),!1}},uploadProductImage:k,refetch:O,isFetching:M,filters:_,setFilters:C}}],355879)},286012,e=>{"use strict";var t=e.i(256680);async function r(e){try{return await t.db.activityHistory.create({data:{userId:e.userId,locationId:e.locationId,activityType:e.activityType,module:e.module,entityType:e.entityType,entityId:e.entityId||null,entityName:e.entityName,description:e.description,metadata:e.metadata||null,profileId:e.profileId||null,profileName:e.profileName||null}}),{success:!0}}catch(e){return console.error("Error logging activity:",e),{success:!1,error:e.message}}}async function a(e,r,o=1,s=20,n){try{let a={locationId:e,userId:r};if(n&&(n.activityType&&"ALL"!==n.activityType&&(a.activityType=n.activityType),n.module&&"ALL"!==n.module&&(a.module=n.module),n.search&&(a.OR=[{entityName:{contains:n.search,mode:"insensitive"}},{description:{contains:n.search,mode:"insensitive"}}]),n.dateFrom||n.dateTo)&&(a.createdAt={},n.dateFrom&&(a.createdAt.gte=new Date(n.dateFrom)),n.dateTo)){let e=new Date(n.dateTo);e.setHours(23,59,59,999),a.createdAt.lte=e}let[i,c]=await Promise.all([t.db.activityHistory.findMany({where:a,skip:(o-1)*s,take:s,orderBy:{createdAt:"desc"}}),t.db.activityHistory.count({where:a})]);return{success:!0,data:{activities:i.map(e=>({...e,created_at:e.createdAt.toISOString(),activity_type:e.activityType,location_id:e.locationId,user_id:e.userId,entity_type:e.entityType,entity_id:e.entityId,entity_name:e.entityName,profile_id:e.profileId,profile_name:e.profileName})),count:c}}}catch(e){return console.error("Error fetching activity history:",e),{success:!1,error:e.message}}}e.s(["getActivityHistoryAction",()=>a,"logActivityAction",()=>r])},923850,e=>{"use strict";var t=e.i(824216);e.s(["useCurrentUser",0,()=>{let{user:e}=(0,t.useAuth)();return{userId:e?.id}}])},546462,e=>{"use strict";var t=e.i(286012),r=e.i(923850),a=e.i(46108),o=e.i(638822);e.s(["useActivityLogger",0,()=>{let{userId:e}=(0,r.useCurrentUser)(),{currentBusiness:s}=(0,a.useBusiness)(),n=null;try{let{currentProfile:e}=(0,o.useProfiles)();n=e}catch{n=null}return{logActivity:async r=>{if(!e||!s?.id)return void console.warn("Cannot log activity: missing user or business context");try{let a=await (0,t.logActivityAction)({userId:e,locationId:s.id,activityType:r.activityType,module:r.module,entityType:r.entityType,entityId:r.entityId||void 0,entityName:r.entityName,description:r.description,metadata:r.metadata||void 0,profileId:n?.id||void 0,profileName:n?.profile_name||void 0});a.success||console.error("Error logging activity:",a.error)}catch(e){console.error("Failed to log activity:",e)}}}}])},810686,e=>{"use strict";e.s(["mapDbProductToProduct",0,e=>({id:e.id,itemNumber:e.item_number,barcode:e.barcode,manufacturerBarcode:e.manufacturer_barcode,name:e.name,description:e.description,category:e.category,quantity:e.quantity,costPrice:Number(e.cost_price),sellingPrice:Number(e.selling_price),supplier:e.supplier,imageUrl:e.image_url,minimumStock:e.minimum_stock,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}),"mapDbSaleToSale",0,e=>{let t=(Array.isArray(e.items)?e.items:[]).map(e=>{let t=void 0!==e.discountPercentage?Number(e.discountPercentage):void 0,r=void 0!==e.discountAmount?Number(e.discountAmount):void 0,a=e.discountType;return!a&&(t&&t>0?a="percentage":r&&r>0&&(a="amount")),{description:e.description||"",quantity:Number(e.quantity)||0,price:Number(e.price)||0,cost:Number(e.cost)||0,productId:e.productId||void 0,discountType:a,discountPercentage:t,discountAmount:r,createdAt:e.createdAt||void 0}});return{id:e.id,receiptNumber:e.receipt_number,customerName:e.customer_name,customerAddress:e.customer_address||"",customerContact:e.customer_contact||"",customerId:e.customer_id||void 0,items:t,paymentStatus:e.payment_status,profit:Number(e.profit),date:new Date(e.date),taxRate:e.tax_rate?Number(e.tax_rate):0,cashTransactionId:e.cash_transaction_id||void 0,amountPaid:e.amount_paid?Number(e.amount_paid):void 0,amountDue:e.amount_due?Number(e.amount_due):void 0,notes:e.notes||"",categoryId:e.category_id||void 0,createdAt:new Date(e.created_at)}},"mapSaleToDbSale",0,(e,t,r,a,o,s,n)=>({user_id:o,location_id:s,receipt_number:a,customer_name:e.customerName,customer_address:e.customerAddress||null,customer_contact:e.customerContact||null,customer_id:e.customerId||null,items:e.items,payment_status:e.paymentStatus,profit:r,date:t.toISOString().split("T")[0],tax_rate:e.taxRate||0,cash_transaction_id:n||null,amount_paid:e.amountPaid||null,amount_due:e.amountDue||null,notes:e.notes||null,category_id:e.categoryId||null})])},554913,e=>{"use strict";var t=e.i(355879),r=e.i(679935),a=e.i(8745);e.s(["useInventoryActions",0,e=>{let{updateProductsBulk:o}=(0,t.useProducts)(e),s=async(e,t)=>{if(!e.length)return[];try{return await (0,a.getProductsByIdsAction)(e,t)}catch(e){throw console.error("Error fetching fresh products:",e),e}};return{deductStockForSale:async(t,a,n,i,c)=>{if(!e)return!1;try{let u=t.filter(e=>e.productId);if(0===u.length)return!0;let d=[...new Set(u.map(e=>e.productId))],l=await s(d,c);if(0===l.length)return!1;let m=new Map;for(let e of u){let t=m.get(e.productId)||0;m.set(e.productId,t+e.quantity)}let y=[];for(let[e,t]of m.entries()){let a=l.find(t=>t.id===e);if(!a)continue;let o=a.quantity-t;y.push({id:e,updated:{...a,quantity:o}}),o<0&&r.toast.warning(`${a.name} inventory is now negative (${o}). Please restock soon.`)}return y.length>0&&await o(y,e,"Sale",a,n,i),!0}catch(e){return console.error("Error deducting stock for sale:",e),!1}},restoreStockForSale:async(t,r,a,n)=>{if(!e)return!1;try{let i=t.filter(e=>e.productId);if(0===i.length)return!0;let c=[...new Set(i.map(e=>e.productId))],u=await s(c,n),d=new Map;for(let e of i){let t=d.get(e.productId)||0;d.set(e.productId,t+e.quantity)}let l=[];for(let[e,t]of d.entries()){let r=u.find(t=>t.id===e);if(!r)continue;let a=r.quantity+t;l.push({id:e,updated:{...r,quantity:a}})}return l.length>0&&await o(l,e,"Deleted Sale",r,void 0,a),!0}catch(e){return console.error("Error restoring stock for sale:",e),!1}},adjustStockForEditedSale:async(t,a,n,i,c,u)=>{if(!e)return!1;try{let d=[...t.filter(e=>e.productId).map(e=>e.productId),...a.filter(e=>e.productId).map(e=>e.productId)],l=[...new Set(d)];if(0===l.length)return!0;let m=await s(l,u),y=new Map;for(let e of t.filter(e=>e.productId)){let t=y.get(e.productId)||0;y.set(e.productId,t+e.quantity)}for(let e of a.filter(e=>e.productId)){let t=y.get(e.productId)||0;y.set(e.productId,t-e.quantity)}let f=[];for(let[e,t]of y.entries()){if(0===t)continue;let a=m.find(t=>t.id===e);if(!a)continue;let o=a.quantity+t;f.push({id:e,updated:{...a,quantity:o}}),o<0&&r.toast.warning(`${a.name} inventory is now negative (${o}). Please restock soon.`)}return f.length>0&&await o(f,e,"Sale Status/Qty Edit",n,i,c),!0}catch(e){return console.error("Error adjusting stock for edited sale:",e),!1}}}}])},873015,e=>{"use strict";var t=e.i(256680),r=e.i(290205);async function a(e,r="desc",o){try{let a={where:{branchId:e},orderBy:{createdAt:r},include:{cashTransaction:!0}};return o&&o>0&&(a.take=o),(await t.db.sale.findMany(a)).map(e=>({id:e.id,user_id:e.userId,location_id:e.branchId,receipt_number:e.saleNumber,customer_name:e.customerName,customer_address:e.customerAddress,customer_contact:e.customerPhone,customer_id:e.customerId,items:e.items,payment_status:e.paymentStatus,profit:0,date:e.date.toISOString(),tax_rate:e.taxRate?Number(e.taxRate):0,created_at:e.createdAt.toISOString(),updated_at:e.updatedAt.toISOString(),cash_transaction_id:e.cashTransactionId,amount_paid:Number(e.amountPaid),amount_due:Number(e.balance),category_id:e.categoryId,notes:e.notes}))}catch(e){return console.error("Error fetching sales:",e),[]}}async function o(e,r){try{let a=await t.db.sale.findUnique({where:{id:e},include:{cashTransaction:!0,installmentPayments:!0}});if(!a||a.branchId!==r)return{success:!1,error:"Sale not found or unauthorized"};return await t.db.$transaction(async t=>{await t.installmentPayment.deleteMany({where:{saleId:e}}),a.cashTransactionId&&await t.cashTransaction.delete({where:{id:a.cashTransactionId}}),await t.sale.delete({where:{id:e}})}),{success:!0,sale:{receiptNumber:a.saleNumber,customerName:a.customerName,customerAddress:a.customerAddress,customerContact:a.customerPhone,paymentStatus:a.paymentStatus,cashTransactionId:a.cashTransactionId,items:a.items,amountPaid:Number(a.amountPaid),amountDue:Number(a.balance),profit:0,taxRate:Number(a.taxRate),notes:a.notes}}}catch(e){return console.error("Error deleting sale:",e),{success:!1,error:e.message||"Failed to delete sale"}}}async function s(e,r,a){try{let o=e.payment_status;"NOT PAID"===o?o="UNPAID":"Installment Sale"===o?o="INSTALLMENT":"Paid"===o?o="PAID":"Quote"===o&&(o="QUOTE");let s={userId:e.user_id,branchId:e.location_id,saleNumber:e.receipt_number,customerName:e.customer_name,customerAddress:e.customer_address,customerPhone:e.customer_contact,customerId:e.customer_id,items:e.items,paymentStatus:o,date:new Date(e.date),taxRate:e.tax_rate,cashTransactionId:e.cash_transaction_id,amountPaid:e.amount_paid,balance:e.amount_due,categoryId:e.category_id,notes:e.notes,subtotal:0,total:0};if(r&&a){let e=await t.db.sale.update({where:{id:a},data:s});return{success:!0,data:e}}{let e=await t.db.sale.create({data:s});return{success:!0,data:e}}}catch(e){return console.error("Error upserting sale:",e),{success:!1,error:e.message||"Failed to preserve sale"}}}async function n(e){try{let r=await t.db.saleCategory.findMany({where:{branchId:e},orderBy:{name:"asc"}});return{success:!0,data:r}}catch(e){return console.error("Error fetching sales categories:",e),{success:!1,error:e.message}}}async function i(e,a,o,s=!1){try{let n=await t.db.saleCategory.create({data:{branchId:e,userId:a,name:o,is_default:s}});return(0,r.revalidatePath)("/sales"),{success:!0,data:n}}catch(e){return console.error("Error creating sales category:",e),{success:!1,error:e.message}}}async function c(e,a){try{let o=await t.db.saleCategory.update({where:{id:e},data:{name:a}});return(0,r.revalidatePath)("/sales"),{success:!0,data:o}}catch(e){return console.error("Error updating sales category:",e),{success:!1,error:e.message}}}async function u(e){try{return await t.db.saleCategory.delete({where:{id:e}}),(0,r.revalidatePath)("/sales"),{success:!0}}catch(e){return console.error("Error deleting sales category:",e),{success:!1,error:e.message}}}async function d(e,r){if(!e||!r)return null;try{return await t.db.customer.findFirst({where:{branchId:e,name:{contains:r,mode:"insensitive"}},select:{id:!0,name:!0}})}catch(e){return console.error("Error looking up customer by name:",e),null}}async function l(e,r){try{return await t.db.sale.update({where:{id:e},data:{customerId:r}}),{success:!0}}catch(e){return console.error("Error updating sale customer:",e),{success:!1,error:e.message}}}async function o(e){try{return await t.db.sale.delete({where:{id:e}}),(0,r.revalidatePath)("/sales"),!0}catch(e){return console.error("Error deleting sale:",e),!1}}e.s(["createSalesCategoryAction",()=>i,"deleteSaleAction",()=>o,"deleteSalesCategoryAction",()=>u,"getCustomerByNameAction",()=>d,"getSalesAction",()=>a,"getSalesCategoriesAction",()=>n,"updateSaleCustomerAction",()=>l,"updateSalesCategoryAction",()=>c,"upsertSaleAction",()=>s])},852577,e=>{"use strict";var t=e.i(191788),r=e.i(810686),a=e.i(150064),o=e.i(893930),s=e.i(285700),n=e.i(546462),i=e.i(46108),c=e.i(554913),u=e.i(775778),d=e.i(873015);e.s(["useSalesData",0,(e,l="desc",m)=>{let y=(0,s.useQueryClient)(),{toast:f}=(0,a.useToast)(),{logActivity:p}=(0,n.useActivityLogger)(),{currentBusiness:g}=(0,i.useBusiness)(),{restoreStockForSale:h}=(0,c.useInventoryActions)(e),v=(0,t.useCallback)(async()=>{try{if(!e||!g)return[];let t=await (0,d.getSalesAction)(g.id,l,m);return t?t.map(e=>{let t={id:e.id,user_id:e.user_id,location_id:e.location_id,receipt_number:e.receipt_number,customer_name:e.customer_name,customer_address:e.customer_address,customer_contact:e.customer_contact,customer_id:e.customer_id,items:e.items,payment_status:e.payment_status,profit:e.profit?Number(e.profit):0,date:e.date,tax_rate:e.tax_rate||0,created_at:e.created_at,updated_at:e.updated_at,cash_transaction_id:e.cash_transaction_id,amount_paid:e.amount_paid?Number(e.amount_paid):void 0,amount_due:e.amount_due?Number(e.amount_due):void 0,category_id:e.category_id,notes:e.notes};return(0,r.mapDbSaleToSale)(t)}):[]}catch(e){return console.error("Error loading sales:",e),f({title:"Error",description:"Failed to load sales data. Please try again.",variant:"destructive"}),[]}},[e,g?.id,l,m,f]),b=(0,t.useMemo)(()=>["sales",g?.id,e],[g?.id,e]),I=(0,t.useMemo)(()=>[...b,l,m],[b,l,m]),{data:w=[],isLoading:_,isFetching:S,refetch:E}=(0,o.useQuery)({queryKey:I,queryFn:v,enabled:!!e&&!!g?.id,staleTime:3e4,gcTime:18e5,refetchOnWindowFocus:!0,refetchOnReconnect:!0}),P=_||S&&0===w.length,C=(0,t.useMemo)(()=>{let e=w.filter(e=>"Quote"!==e.paymentStatus),t=new Map;return e.forEach(e=>{let r=e.customerName,a=e.items.reduce((e,t)=>e+t.price*t.quantity,0);if(t.has(r)){let o=t.get(r);t.set(r,{total:o.total+a,count:o.count+1,customerId:o.customerId||e.customerId})}else t.set(r,{total:a,count:1,customerId:e.customerId})}),Array.from(t.entries()).map(([e,t])=>({id:t.customerId,name:e,totalPurchases:t.total,orderCount:t.count})).sort((e,t)=>t.totalPurchases-e.totalPurchases)},[w]),N=(0,t.useMemo)(()=>e=>{let t=w.filter(t=>t.customerName.toLowerCase()===e.toLowerCase()&&"Quote"!==t.paymentStatus);return{total:t.reduce((e,t)=>e+t.items.reduce((e,t)=>e+t.price*t.quantity,0),0),count:t.length}},[w]),A=async e=>{try{let t=w.find(t=>t.id===e);if(!t)throw Error("Sale not found");if("Quote"!==t.paymentStatus&&t.items.length>0&&(console.log("Restoring product quantities via useInventoryActions..."),await h(t.items,e,t.receiptNumber,g?.id)||f({title:"Inventory Update Warning",description:"Sale deleted, but inventory restoration might have failed. Please check your stock levels.",variant:"destructive"})),!g?.id)throw Error("Business context missing for deletion");let r=await (0,d.deleteSaleAction)(e,g.id);if(!r.success)throw Error(r.error);return y.setQueryData(I,t=>t?t.filter(t=>t.id!==e):[]),y.invalidateQueries({queryKey:b}),T(),await p({activityType:"DELETE",module:"SALES",entityType:"sale",entityId:e,entityName:`Sale #${t.receiptNumber}`,description:`Deleted sale for ${t.customerName} - Total: UGX ${((t.amountPaid||0)+(t.amountDue||0)).toLocaleString()} (Stock restored)`,metadata:{receiptNumber:t.receiptNumber,customerName:t.customerName,customerAddress:t.customerAddress,customerContact:t.customerContact,totalAmount:(t.amountPaid||0)+(t.amountDue||0),amountPaid:t.amountPaid,profit:t.profit,paymentStatus:t.paymentStatus,taxRate:t.taxRate,itemCount:t.items.length,items:t.items.map(e=>({description:e.description,quantity:e.quantity,price:e.price,cost:e.cost,total:e.quantity*e.price,discountPercentage:e.discountPercentage,discountAmount:e.discountAmount})),notes:t.notes,cashTransactionDeleted:!!t.cashTransactionId}}),f({title:"Sale Deleted",description:"The sale record and associated data have been successfully deleted."}),(0,u.clearInventoryCaches)(),!0}catch(e){return console.error("Error deleting sale:",e),f({title:"Error",description:"Failed to delete sale. Please try again.",variant:"destructive"}),!1}},T=(0,t.useCallback)(()=>{if(!g?.id)return;let e=`soldItemsFilters_${g.id}`;localStorage.removeItem(e),localStorage.removeItem("soldItemsFilters")},[g?.id]);return{sales:w,isLoading:P,deleteSale:A,addSale:(0,t.useCallback)(e=>{y.setQueryData(I,t=>t?[e,...t]:[e]),y.invalidateQueries({queryKey:b}),T(),(0,u.clearInventoryCaches)()},[y,I,b,T,u.clearInventoryCaches]),updateSale:(0,t.useCallback)(e=>{y.setQueryData(I,t=>t?t.map(t=>t.id===e.id?e:t):[e]),y.invalidateQueries({queryKey:b}),T(),(0,u.clearInventoryCaches)()},[y,I,b,T,u.clearInventoryCaches]),getTopCustomers:C,getCustomerLifetimePurchases:N,clearSoldItemsCache:T,refetch:E,isFetching:S}}])},649086,e=>{"use strict";let t=(0,e.i(369547).default)("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]);e.s(["Wallet",()=>t],649086)},391756,e=>{"use strict";let t=(0,e.i(369547).default)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);e.s(["XCircle",()=>t],391756)},533398,e=>{"use strict";var t=e.i(191788),r=e.i(46108),a=e.i(638822),o=e.i(893930),s=e.i(285700),n=e.i(150064),i=e.i(256680),c=e.i(290205);async function u(e,t){try{let r=await i.db.message.findMany({where:{userId:e,locationId:t},orderBy:{createdAt:"desc"}});return{success:!0,data:r.map(e=>({id:e.id,userId:e.userId,locationId:e.locationId,profileId:e.profileId,customerId:e.customerId,phoneNumber:e.phoneNumber,content:e.content,status:e.status,smsCreditsUsed:e.smsCreditsUsed,templateId:e.templateId,errorMessage:e.errorMessage,sentAt:e.sentAt?.toISOString(),deliveredAt:e.deliveredAt?.toISOString(),createdAt:e.createdAt.toISOString(),updatedAt:e.updatedAt.toISOString(),metadata:e.metadata}))}}catch(e){return console.error("Error fetching messages:",e),{success:!1,error:e.message}}}async function d(e){try{let t=await i.db.message.create({data:{userId:e.userId,locationId:e.locationId,profileId:e.profileId,customerId:e.customerId,phoneNumber:e.phoneNumber,content:e.content,status:e.status||"pending",smsCreditsUsed:e.smsCreditsUsed||0,templateId:e.templateId,metadata:e.metadata}});return"sent"===t.status&&e.profileId&&await i.db.user.update({where:{id:e.profileId},data:{credits:{decrement:t.smsCreditsUsed}}}),(0,c.revalidatePath)("/messages"),{success:!0,data:t}}catch(e){return console.error("Error creating message:",e),{success:!1,error:e.message}}}async function l(e,t){try{let r=await i.db.messageTemplate.findMany({where:{userId:e,locationId:t},orderBy:{createdAt:"desc"}});return{success:!0,data:r}}catch(e){return console.error("Error fetching message templates:",e),{success:!1,error:e.message}}}async function m(e){try{let t=await i.db.messageTemplate.create({data:{userId:e.userId,locationId:e.locationId,name:e.name,content:e.content,category:e.category,variables:e.variables,isDefault:e.isDefault||!1}});return(0,c.revalidatePath)("/messages"),{success:!0,data:t}}catch(e){return console.error("Error creating message template:",e),{success:!1,error:e.message}}}async function y(e,t){try{let r=await i.db.messageTemplate.update({where:{id:e},data:{name:t.name,content:t.content,category:t.category,variables:t.variables,isDefault:t.isDefault}});return(0,c.revalidatePath)("/messages"),{success:!0,data:r}}catch(e){return console.error("Error updating message template:",e),{success:!1,error:e.message}}}async function f(e){try{return await i.db.messageTemplate.delete({where:{id:e}}),(0,c.revalidatePath)("/messages"),{success:!0}}catch(e){return console.error("Error deleting message template:",e),{success:!1,error:e.message}}}e.s(["useMessages",0,e=>{let[i,c]=(0,t.useState)([]),[p,g]=(0,t.useState)([]),[h,v]=(0,t.useState)([]),[b,I]=(0,t.useState)(0),{currentBusiness:w}=(0,r.useBusiness)(),{currentProfile:_}=(0,a.useProfiles)(),S=(0,s.useQueryClient)(),E=async()=>{_?.sms_credits!==void 0&&I(_.sms_credits)},P=async t=>{if(!e||!w?.id)return null;try{let r=await m({userId:e,locationId:w.id,name:t.name,content:t.content,category:t.category,variables:t.variables,isDefault:t.isDefault});if(r.success&&r.data)return M(),r.data;throw Error(r.error)}catch(e){return console.error("Error creating template:",e),(0,n.toast)({title:"Error",description:"Failed to create template",variant:"destructive"}),null}},C=async(e,t)=>{try{let r=await y(e,t);if(r.success)M();else throw Error(r.error)}catch(e){console.error("Error updating template:",e),(0,n.toast)({title:"Error",description:"Failed to update template",variant:"destructive"})}},N=async e=>{try{let t=await f(e);if(t.success)g(t=>t.filter(t=>t.id!==e));else throw Error(t.error)}catch(e){console.error("Error deleting template:",e),(0,n.toast)({title:"Error",description:"Failed to delete template",variant:"destructive"})}},A=(0,t.useCallback)(async()=>{if(!e||!w?.id)return[];try{let t=await u(e,w.id);if(t.success&&t.data)return t.data;return[]}catch(e){return console.error("Error fetching messages:",e),[]}},[e,w?.id]),T=["messages",e,w?.id],{data:x,isLoading:R}=(0,o.useQuery)({queryKey:T,queryFn:A,enabled:!!e&&!!w?.id});(0,t.useEffect)(()=>{x&&c(x)},[x]);let M=async()=>{if(e&&w?.id)try{let t=await l(e,w.id);t.success&&t.data&&g(t.data)}catch(e){console.error("Error fetching templates:",e)}},O=async()=>{v([])},k=async t=>{let r;if(!e||!w?.id||!_)return null;let a=(r=t.phoneNumber.replace(/[\s\-\(\)]/g,"")).startsWith("+")?r:r.startsWith("256")?"+"+r:r.startsWith("0")?"+256"+r.substring(1):(9===r.length&&r.match(/^[7]\d{8}$/),"+256"+r),o=Math.ceil(t.content.length/160);if(_.sms_credits<o)return(0,n.toast)({title:"Error",description:"Insufficient credits",variant:"destructive"}),null;try{let r=await d({userId:e,locationId:w.id,profileId:_.id,customerId:t.customerId,phoneNumber:a,content:t.content,templateId:t.templateId,smsCreditsUsed:o,status:"sent",metadata:t.metadata});if(r.success&&r.data){let e={...r.data,createdAt:r.data.createdAt.toISOString()};return c(t=>[e,...t]),S.invalidateQueries({queryKey:T}),(0,n.toast)({title:"Success",description:"Message sent successfully"}),e}throw Error(r.error)}catch(e){return console.error("Error sending message:",e),(0,n.toast)({title:"Error",description:"Failed to send message",variant:"destructive"}),null}},D=async e=>{let t=0;for(let r of e.customerIds)t++;return{success:t,failed:0,errors:[]}},j=async(e,t)=>((0,n.toast)({title:"Info",description:"Credit purchase migration in progress"}),null);return(0,t.useEffect)(()=>{e&&w?.id&&(M(),O(),E())},[e,w?.id,_?.id]),{messages:i,templates:p,purchases:h,liveCredits:b,isLoading:R&&!x,createMessage:k,createBulkMessages:D,createTemplate:P,updateTemplate:C,deleteTemplate:N,getMessageStats:()=>{let e=i.length,t=i.filter(e=>"sent"===e.status||"delivered"===e.status).length,r=i.filter(e=>"failed"===e.status).length;return{total:e,sent:t,failed:r,pending:i.filter(e=>"pending"===e.status).length,totalCreditsUsed:i.reduce((e,t)=>e+t.smsCreditsUsed,0),creditsRemaining:b}},initiateCreditPurchase:j,refresh:()=>{S.invalidateQueries({queryKey:T}),M(),O(),E()}}}],533398)},879975,614913,e=>{"use strict";var t=e.i(191788),r=e.i(150064),a=e.i(46108),o=e.i(546462),s=e.i(893930),n=e.i(285700),i=e.i(256680),c=e.i(290205);async function u(e){try{let t=await i.db.customer.findMany({where:{branchId:e},orderBy:{name:"asc"}}),r=await i.db.customer.count({where:{branchId:e}}),a=t.map(e=>({id:e.id,fullName:e.name,phoneNumber:e.phone,email:e.email,birthday:e.birthday?e.birthday.toISOString():null,gender:e.gender,location:e.address,categoryId:e.categoryId,notes:e.notes,tags:e.tags||[],socialMedia:e.socialMedia||null,createdAt:e.createdAt.toISOString(),updatedAt:e.updatedAt.toISOString()}));return{success:!0,data:{customers:a,count:r}}}catch(e){return console.error("Error fetching customers:",e),{success:!1,error:e.message}}}async function d(e,t,r){try{let a=await i.db.customer.create({data:{branchId:e,adminId:t,name:r.fullName,phone:r.phoneNumber||null,email:r.email||null,birthday:r.birthday?new Date(r.birthday):null,gender:r.gender||null,address:r.location||null,categoryId:r.categoryId||null,notes:r.notes||null,tags:r.tags||[],socialMedia:r.socialMedia||null}});return(0,c.revalidatePath)("/customers"),{success:!0,data:a}}catch(e){return console.error("Error creating customer:",e),{success:!1,error:e.message}}}async function l(e,t){try{let r={};void 0!==t.fullName&&(r.name=t.fullName),void 0!==t.phoneNumber&&(r.phone=t.phoneNumber),void 0!==t.email&&(r.email=t.email),void 0!==t.birthday&&(r.birthday=t.birthday?new Date(t.birthday):null),void 0!==t.gender&&(r.gender=t.gender),void 0!==t.location&&(r.address=t.location),void 0!==t.categoryId&&(r.categoryId=t.categoryId),void 0!==t.notes&&(r.notes=t.notes),void 0!==t.tags&&(r.tags=t.tags),void 0!==t.socialMedia&&(r.socialMedia=t.socialMedia);let a=await i.db.customer.update({where:{id:e},data:r});return(0,c.revalidatePath)("/customers"),{success:!0,data:a}}catch(e){return console.error("Error updating customer:",e),{success:!1,error:e.message}}}async function m(e){try{return await i.db.customer.delete({where:{id:e}}),(0,c.revalidatePath)("/customers"),{success:!0}}catch(e){return console.error("Error deleting customer:",e),{success:!1,error:e.message}}}async function y(e){try{let t=(await i.db.customerCategory.findMany({where:{branchId:e},orderBy:{name:"asc"}})).map(e=>({id:e.id,name:e.name,isDefault:e.isDefault,createdAt:e.createdAt.toISOString(),updatedAt:e.updatedAt.toISOString()}));return{success:!0,data:t}}catch(e){return console.error("Error fetching customer categories:",e),{success:!1,error:e.message}}}async function f(e,t,r){try{let a=await i.db.customerCategory.create({data:{branchId:e,name:r.trim(),isDefault:!1,userId:t}});return(0,c.revalidatePath)("/customers"),{success:!0,data:a}}catch(e){return console.error("Error creating customer category:",e),{success:!1,error:e.message}}}async function p(e,t){try{let r=await i.db.customerCategory.update({where:{id:e},data:{name:t.trim()}});return(0,c.revalidatePath)("/customers"),{success:!0,data:r}}catch(e){return console.error("Error updating customer category:",e),{success:!1,error:e.message}}}async function g(e){try{return await i.db.customerCategory.delete({where:{id:e}}),(0,c.revalidatePath)("/customers"),{success:!0}}catch(e){return console.error("Error deleting customer category:",e),{success:!1,error:e.message}}}e.s(["createCustomerAction",()=>d,"createCustomerCategoryAction",()=>f,"deleteCustomerAction",()=>m,"deleteCustomerCategoryAction",()=>g,"getCustomerCategoriesAction",()=>y,"getCustomersAction",()=>u,"updateCustomerAction",()=>l,"updateCustomerCategoryAction",()=>p],614913);var h=e.i(824216);e.s(["useCustomers",0,(e=50)=>{let[i,c]=(0,t.useState)([]),[y,f]=(0,t.useState)(1),[p,g]=(0,t.useState)(e),[v,b]=(0,t.useState)(0),{toast:I}=(0,r.useToast)(),{currentBusiness:w}=(0,a.useBusiness)(),{user:_}=(0,h.useAuth)(),{logActivity:S}=(0,o.useActivityLogger)(),E=(0,n.useQueryClient)(),P=(0,t.useCallback)(async()=>{if(!w)return{customers:[],count:0};try{let e=await u(w.id);if(!e.success)throw Error(e.error);return{customers:(e.data?.customers||[]).map(e=>({id:e.id,fullName:e.fullName||e.name,phoneNumber:e.phoneNumber||e.phone,email:e.email,birthday:e.birthday?new Date(e.birthday):null,gender:e.gender,location:e.location||e.address,categoryId:e.categoryId,notes:e.notes,tags:e.tags,socialMedia:e.socialMedia||null,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)})),count:e.data?.count||0}}catch(e){return console.error("Error loading customers:",e),I({title:"Error",description:"Failed to load customers. Please try again.",variant:"destructive"}),{customers:[],count:0}}},[w?.id,I]),C=["customers",w?.id],{data:N,isLoading:A,isFetching:T}=(0,s.useQuery)({queryKey:C,queryFn:P,enabled:!!w?.id,staleTime:3e5,gcTime:18e5,refetchOnWindowFocus:!1,refetchOnReconnect:!1});(0,t.useEffect)(()=>{N&&(c(N.customers),b(N.count))},[N]);let x=async e=>{if(!w)return I({title:"Error",description:"No business selected",variant:"destructive"}),null;try{if(!_)throw Error("User not authenticated");let t={fullName:e.fullName,phoneNumber:e.phoneNumber||null,email:e.email||null,birthday:e.birthday?.toISOString().split("T")[0]||null,gender:e.gender||null,location:e.location||null,categoryId:e.categoryId||null,notes:e.notes||null,tags:e.tags||null,socialMedia:e.socialMedia||null},r=await d(w.id,_.id,t);if(!r.success||!r.data)throw Error(r.error||"Failed to create customer");let a=r.data,o={id:a.id,fullName:a.name||a.fullName,phoneNumber:a.phone||a.phoneNumber,email:a.email,birthday:a.birthday?new Date(a.birthday):null,gender:a.gender,location:a.address||a.location,categoryId:a.categoryId,notes:a.notes,tags:a.tags,socialMedia:a.socialMedia,createdAt:new Date(a.createdAt),updatedAt:new Date(a.updatedAt)};return c(e=>[o,...e]),b(e=>e+1),E.setQueryData(C,e=>e?{customers:[o,...e.customers],count:(e.count||0)+1}:{customers:[o],count:1}),await S({activityType:"CREATE",module:"CUSTOMERS",entityType:"customer",entityId:a.id,entityName:e.fullName,description:`Created customer "${e.fullName}"`,metadata:{phoneNumber:e.phoneNumber,email:e.email,location:e.location}}),I({title:"Success",description:"Customer created successfully"}),a}catch(e){return console.error("Error creating customer:",e),I({title:"Error",description:"Failed to create customer. Please try again.",variant:"destructive"}),null}},R=async(e,t)=>{try{let r={};void 0!==t.fullName&&(r.fullName=t.fullName),void 0!==t.phoneNumber&&(r.phoneNumber=t.phoneNumber),void 0!==t.email&&(r.email=t.email),void 0!==t.birthday&&(r.birthday=t.birthday?.toISOString()),void 0!==t.gender&&(r.gender=t.gender),void 0!==t.location&&(r.location=t.location),void 0!==t.categoryId&&(r.categoryId=t.categoryId),void 0!==t.notes&&(r.notes=t.notes),void 0!==t.tags&&(r.tags=t.tags),void 0!==t.socialMedia&&(r.socialMedia=t.socialMedia);let a=await l(e,r);if(!a.success)throw Error(a.error||"Failed to update customer");c(r=>r.map(r=>r.id===e?{...r,...t}:r)),E.setQueryData(C,r=>r?{...r,customers:r.customers.map(r=>r.id===e?{...r,...t}:r)}:r);let o=i.find(t=>t.id===e);return o&&await S({activityType:"UPDATE",module:"CUSTOMERS",entityType:"customer",entityId:e,entityName:o.fullName,description:`Updated customer "${o.fullName}"`,metadata:{updates:t}}),I({title:"Success",description:"Customer updated successfully"}),!0}catch(e){return console.error("Error updating customer:",e),I({title:"Error",description:"Failed to update customer. Please try again.",variant:"destructive"}),!1}},M=async e=>{try{let t=i.find(t=>t.id===e),r=await m(e);if(!r.success)throw Error(r.error||"Failed to delete customer");return c(t=>t.filter(t=>t.id!==e)),b(e=>Math.max(0,e-1)),E.setQueryData(C,t=>{if(!t)return t;let{customers:r,count:a}=t;return{customers:r.filter(t=>t.id!==e),count:Math.max(0,(a||0)-1)}}),E.invalidateQueries({queryKey:C}),t&&await S({activityType:"DELETE",module:"CUSTOMERS",entityType:"customer",entityId:e,entityName:t.fullName,description:`Deleted customer "${t.fullName}"`,metadata:{phoneNumber:t.phoneNumber,email:t.email}}),I({title:"Success",description:"Customer deleted successfully"}),!0}catch(e){return console.error("Error deleting customer:",e),I({title:"Error",description:"Failed to delete customer. Please try again.",variant:"destructive"}),!1}};return{customers:i,isLoading:A&&!N,createCustomer:x,addCustomer:x,updateCustomer:R,deleteCustomer:M,loadCustomers:P,page:y,setPage:f,pageSize:p,setPageSize:g,totalCount:v}}],879975)},648761,e=>{e.v(t=>Promise.all(["static/chunks/2edb2b394ba4d2db.js"].map(t=>e.l(t))).then(()=>t(825455)))},828805,e=>{e.v(t=>Promise.all(["static/chunks/820c94ec438563d7.js"].map(t=>e.l(t))).then(()=>t(879466)))}]);