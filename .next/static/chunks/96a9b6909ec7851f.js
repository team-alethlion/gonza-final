(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,986387,e=>{"use strict";var t=e.i(102594);e.s(["useCurrentUser",0,()=>{let{user:e}=(0,t.useAuth)();return{userId:e?.id}}])},178583,e=>{"use strict";let t=(0,e.i(475254).default)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);e.s(["FileText",()=>t],178583)},160615,e=>{"use strict";var t=e.i(271645),r=e.i(266027),a=e.i(908406),s=e.i(422713),i=e.i(95187);let n=(0,i.createServerReference)("40290a4fc6b8571a026afeb877566edb807919e482",i.callServer,void 0,i.findSourceMapURL,"getBusinessSettingsAction");var o=e.i(709239);let u=()=>({businessName:"",businessAddress:"",businessPhone:"",businessEmail:"",currency:"UGX",paymentInfo:"",defaultPrintFormat:"standard"});e.s(["convertPaymentMethodsToString",0,e=>e.filter(e=>""!==e.method.trim()||""!==e.accountNumber.trim()||""!==e.accountName.trim()).map(e=>`${e.method}
${e.accountNumber}
${e.accountName}`).join("\n"),"parsePaymentInfo",0,e=>{if(!e||""===e.trim())return[];let t=e.split("\n").filter(e=>""!==e.trim()),r=[];for(let e=0;e<t.length;e+=3)e+2<t.length&&r.push({method:t[e].trim(),accountNumber:t[e+1].trim(),accountName:t[e+2].trim()});return r},"useBusinessSettings",0,()=>{let[e,i]=(0,t.useState)(u()),[c,d]=(0,t.useState)(!1),{toast:l}=(0,a.useToast)(),{currentBusiness:m}=(0,s.useBusiness)(),p=async()=>{if(!m)return u();try{let e=await n(m.id);if(!e)return u();{let t=e.metadata&&"object"==typeof e.metadata&&e.metadata.payment_info||"";return{id:e.id,businessName:e.business_name||"",businessAddress:e.business_address||"",businessPhone:e.business_phone||"",businessEmail:e.business_email||"",businessLogo:e.business_logo||void 0,currency:e.currency||"UGX",signature:e.signature||void 0,paymentInfo:t,defaultPrintFormat:e.metadata&&"object"==typeof e.metadata&&e.metadata.default_print_format||"standard",defaultPrinterName:e.metadata&&"object"==typeof e.metadata&&e.metadata.default_printer_name||"",defaultPrinterType:e.metadata&&"object"==typeof e.metadata&&e.metadata.default_printer_type||"USB",printerPaperSize:e.metadata&&"object"==typeof e.metadata&&e.metadata.printer_paper_size||"58mm"}}}catch(e){return console.error("Error loading business settings:",e),l({title:"Error",description:"Failed to load business settings. Please try again.",variant:"destructive"}),u()}},y=async t=>{if(!m)return console.error("No business selected for updating settings"),l({title:"Error",description:"No business selected",variant:"destructive"}),!1;try{let r={payment_info:t.hasOwnProperty("paymentInfo")?t.paymentInfo:e.paymentInfo||"",default_print_format:t.hasOwnProperty("defaultPrintFormat")?t.defaultPrintFormat:e.defaultPrintFormat||"standard",default_printer_name:t.hasOwnProperty("defaultPrinterName")?t.defaultPrinterName:e.defaultPrinterName||"",default_printer_type:t.hasOwnProperty("defaultPrinterType")?t.defaultPrinterType:e.defaultPrinterType||"USB",printer_paper_size:t.hasOwnProperty("printerPaperSize")?t.printerPaperSize:e.printerPaperSize||"58mm"},a={business_name:t.hasOwnProperty("businessName")?t.businessName:e.businessName,business_address:t.hasOwnProperty("businessAddress")?t.businessAddress:e.businessAddress,business_phone:t.hasOwnProperty("businessPhone")?t.businessPhone:e.businessPhone,business_email:t.hasOwnProperty("businessEmail")?t.businessEmail:e.businessEmail,business_logo:t.hasOwnProperty("businessLogo")?t.businessLogo:e.businessLogo,currency:t.hasOwnProperty("currency")?t.currency:e.currency,signature:t.hasOwnProperty("signature")?t.signature:e.signature,metadata:r},s=await (0,o.upsertBusinessSettingsAction)(m.id,"00000000-0000-0000-0000-000000000000",a);if(!s.success)throw console.error("Supabase error updating business settings:",s.error),Error(s.error);return l({title:"Success",description:"Business settings updated successfully"}),b(),!0}catch(e){return console.error("Error updating business settings:",e),l({title:"Error",description:"Failed to update business settings. Please try again.",variant:"destructive"}),!1}},{data:h,isLoading:f,isFetching:g,refetch:b}=(0,r.useQuery)({queryKey:["businessSettings",m?.id],queryFn:p,enabled:!!m?.id,staleTime:3e5,gcTime:18e5,refetchOnWindowFocus:!1,refetchOnReconnect:!1});return(0,t.useEffect)(()=>{h?i(h):m||i(u())},[h,m]),(0,t.useEffect)(()=>{d(f||g)},[f,g]),{settings:e,isLoading:c,updateSettings:y,loadSettings:p}}],160615)},555781,(e,t,r)=>{let a=Error("Could not parse module '[project]/src/app/actions/products.ts'\n\n'import', and 'export' cannot be used outside of module code");throw a.code="MODULE_UNPARSABLE",a},908962,224410,e=>{"use strict";var t=e.i(271645),r=e.i(160615),a=e.i(422713),s=e.i(266027),i=e.i(912598);let n=e=>{let t=Object.keys(localStorage),r=["allProductsStats_","stockSummary_","soldItems_","dashboardData_","analyticsData_"],a=0;t.forEach(e=>{r.some(t=>e.startsWith(t))&&(localStorage.removeItem(e),a++)}),a>0&&console.log(`[Cache] Cleared ${a} inventory-related localStorage entries.`),e&&(console.log("[Cache] Invalidating React Query inventory keys..."),e.invalidateQueries({queryKey:["inventory_global_stats"]}),e.invalidateQueries({queryKey:["stockSummary"]}),e.invalidateQueries({queryKey:["products"]}),e.invalidateQueries({queryKey:["sales"]}),e.invalidateQueries({queryKey:["all-products-for-scanner"]}),e.invalidateQueries({queryKey:["all-products"]}))};e.s(["clearInventoryCaches",0,n],224410);var o=e.i(555781);e.s(["useProducts",0,(e,u=50)=>{let[c,d]=(0,t.useState)([]),[l,m]=(0,t.useState)(1),[p,y]=(0,t.useState)(u),[h,f]=(0,t.useState)(0),[g,b]=(0,t.useState)(!1),{settings:v}=(0,r.useBusinessSettings)(),{currentBusiness:x}=(0,a.useBusiness)(),S=(0,i.useQueryClient)(),[N,_]=(0,t.useState)({search:"",category:"all",stockStatus:"all"}),[w,j]=(0,t.useState)(null),P=(0,t.useCallback)(e=>{e.search!==N.search&&(b(!0),w&&clearTimeout(w),j(setTimeout(()=>{b(!1)},600))),_(e)},[N.search,w]),I=(0,t.useCallback)(async()=>{if(!e||!x)return{products:[],count:0};try{return await (0,o.getProductsAction)({userId:e,businessId:x.id,page:l,pageSize:p,search:N.search,category:"all"===N.category?void 0:N.category,stockStatus:N.stockStatus})}catch(e){return console.error("Error loading products from server action:",e),{products:[],count:0}}},[e,x?.id,l,p,N.search,N.category,N.stockStatus]),k=(0,t.useMemo)(()=>["products",e,x?.id],[e,x?.id]),A=(0,t.useMemo)(()=>[...k,l,p,N.search,N.category,N.stockStatus],[k,l,p,N.search,N.category,N.stockStatus]),{data:C,isLoading:T,isFetching:E,refetch:q}=(0,s.useQuery)({queryKey:A,queryFn:I,enabled:!!e&&!!x?.id,staleTime:3e4,gcTime:18e5,refetchOnWindowFocus:!0,refetchOnReconnect:!0});(0,t.useEffect)(()=>{C&&(d(C.products),f(C.count))},[C]);let Q=async t=>{try{if(!e)return null;return console.warn("Image upload redirecting to server action (TODO)"),null}catch(e){return console.error("Error in uploadProductImage:",e),null}};return{products:c,isLoading:T&&!C&&!g,loadProducts:I,page:l,setPage:m,pageSize:p,setPageSize:y,totalCount:h,createProduct:async t=>{try{if(!e||!x)return null;let r=await (0,o.createProductAction)({...t,userId:e,businessId:x.id});if(!r)return null;return d(e=>[r,...e]),f(e=>e+1),S.invalidateQueries({queryKey:k}),n(S),r}catch(e){return console.error("Error creating product:",e),null}},updateProduct:async(t,r,a,s=!1,i,u,c,d)=>{try{if(!e||!x)return!1;let u=r.imageUrl;if(a&&(u=await Q(a)),!await (0,o.updateProductAction)(t,{...r,imageUrl:u,userId:e,businessId:x.id,isFromSale:s,customChangeReason:i,referenceId:c}))return!1;return S.invalidateQueries({queryKey:k}),n(S),!0}catch(e){return console.error("Error updating product:",e),!1}},updateProductsBulk:async(t,r,a,s,i,u)=>{try{if(!e||!x)return!1;let r=await (0,o.updateProductsBulkAction)(t.map(e=>({id:e.id,updated:e.updated})),x.id);return r&&(S.invalidateQueries({queryKey:k}),n(S)),r}catch(e){return console.error("Error in bulk update:",e),!1}},deleteProduct:async t=>{try{if(!e)return!1;if(await (0,o.deleteProductAction)(t))return S.invalidateQueries({queryKey:k}),n(S),!0;return!1}catch(e){return console.error("Error deleting product:",e),!1}},uploadProductImage:Q,refetch:q,isFetching:E,filters:N,setFilters:P}}],908962)},589271,e=>{"use strict";e.s(["mapDbProductToProduct",0,e=>({id:e.id,itemNumber:e.item_number,barcode:e.barcode,manufacturerBarcode:e.manufacturer_barcode,name:e.name,description:e.description,category:e.category,quantity:e.quantity,costPrice:Number(e.cost_price),sellingPrice:Number(e.selling_price),supplier:e.supplier,imageUrl:e.image_url,minimumStock:e.minimum_stock,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}),"mapDbSaleToSale",0,e=>{let t=(Array.isArray(e.items)?e.items:[]).map(e=>{let t=void 0!==e.discountPercentage?Number(e.discountPercentage):void 0,r=void 0!==e.discountAmount?Number(e.discountAmount):void 0,a=e.discountType;return!a&&(t&&t>0?a="percentage":r&&r>0&&(a="amount")),{description:e.description||"",quantity:Number(e.quantity)||0,price:Number(e.price)||0,cost:Number(e.cost)||0,productId:e.productId||void 0,discountType:a,discountPercentage:t,discountAmount:r,createdAt:e.createdAt||void 0}});return{id:e.id,receiptNumber:e.receipt_number,customerName:e.customer_name,customerAddress:e.customer_address||"",customerContact:e.customer_contact||"",customerId:e.customer_id||void 0,items:t,paymentStatus:e.payment_status,profit:Number(e.profit),date:new Date(e.date),taxRate:e.tax_rate?Number(e.tax_rate):0,cashTransactionId:e.cash_transaction_id||void 0,amountPaid:e.amount_paid?Number(e.amount_paid):void 0,amountDue:e.amount_due?Number(e.amount_due):void 0,notes:e.notes||"",categoryId:e.category_id||void 0,createdAt:new Date(e.created_at)}},"mapSaleToDbSale",0,(e,t,r,a,s,i,n)=>({user_id:s,location_id:i,receipt_number:a,customer_name:e.customerName,customer_address:e.customerAddress||null,customer_contact:e.customerContact||null,customer_id:e.customerId||null,items:e.items,payment_status:e.paymentStatus,profit:r,date:t.toISOString().split("T")[0],tax_rate:e.taxRate||0,cash_transaction_id:n||null,amount_paid:e.amountPaid||null,amount_due:e.amountDue||null,notes:e.notes||null,category_id:e.categoryId||null})])},457786,e=>{"use strict";var t=e.i(95187);let r=(0,t.createServerReference)("401d907b5cd7e0b2f207e9b555ac4fe2e14de08444",t.callServer,void 0,t.findSourceMapURL,"logActivityAction");var a=e.i(986387),s=e.i(422713),i=e.i(777624);e.s(["useActivityLogger",0,()=>{let{userId:e}=(0,a.useCurrentUser)(),{currentBusiness:t}=(0,s.useBusiness)(),n=null;try{let{currentProfile:e}=(0,i.useProfiles)();n=e}catch{n=null}return{logActivity:async a=>{if(!e||!t?.id)return void console.warn("Cannot log activity: missing user or business context");try{let s=await r({userId:e,locationId:t.id,activityType:a.activityType,module:a.module,entityType:a.entityType,entityId:a.entityId||void 0,entityName:a.entityName,description:a.description,metadata:a.metadata||void 0,profileId:n?.id||void 0,profileName:n?.profile_name||void 0});s.success||console.error("Error logging activity:",s.error)}catch(e){console.error("Failed to log activity:",e)}}}}],457786)},146786,850823,617318,e=>{"use strict";var t=e.i(271645),r=e.i(589271),a=e.i(908406),s=e.i(266027),i=e.i(912598),n=e.i(457786),o=e.i(422713),u=e.i(908962),c=e.i(846696),d=e.i(555781);let l=e=>{let{updateProductsBulk:t}=(0,u.useProducts)(e),r=async(e,t)=>{if(!e.length)return[];try{return await (0,d.getProductsByIdsAction)(e,t)}catch(e){throw console.error("Error fetching fresh products:",e),e}};return{deductStockForSale:async(a,s,i,n,o)=>{if(!e)return!1;try{let u=a.filter(e=>e.productId);if(0===u.length)return!0;let d=[...new Set(u.map(e=>e.productId))],l=await r(d,o);if(0===l.length)return!1;let m=new Map;for(let e of u){let t=m.get(e.productId)||0;m.set(e.productId,t+e.quantity)}let p=[];for(let[e,t]of m.entries()){let r=l.find(t=>t.id===e);if(!r)continue;let a=r.quantity-t;p.push({id:e,updated:{...r,quantity:a}}),a<0&&c.toast.warning(`${r.name} inventory is now negative (${a}). Please restock soon.`)}return p.length>0&&await t(p,e,"Sale",s,i,n),!0}catch(e){return console.error("Error deducting stock for sale:",e),!1}},restoreStockForSale:async(a,s,i,n)=>{if(!e)return!1;try{let o=a.filter(e=>e.productId);if(0===o.length)return!0;let u=[...new Set(o.map(e=>e.productId))],c=await r(u,n),d=new Map;for(let e of o){let t=d.get(e.productId)||0;d.set(e.productId,t+e.quantity)}let l=[];for(let[e,t]of d.entries()){let r=c.find(t=>t.id===e);if(!r)continue;let a=r.quantity+t;l.push({id:e,updated:{...r,quantity:a}})}return l.length>0&&await t(l,e,"Deleted Sale",s,void 0,i),!0}catch(e){return console.error("Error restoring stock for sale:",e),!1}},adjustStockForEditedSale:async(a,s,i,n,o,u)=>{if(!e)return!1;try{let d=[...a.filter(e=>e.productId).map(e=>e.productId),...s.filter(e=>e.productId).map(e=>e.productId)],l=[...new Set(d)];if(0===l.length)return!0;let m=await r(l,u),p=new Map;for(let e of a.filter(e=>e.productId)){let t=p.get(e.productId)||0;p.set(e.productId,t+e.quantity)}for(let e of s.filter(e=>e.productId)){let t=p.get(e.productId)||0;p.set(e.productId,t-e.quantity)}let y=[];for(let[e,t]of p.entries()){if(0===t)continue;let r=m.find(t=>t.id===e);if(!r)continue;let a=r.quantity+t;y.push({id:e,updated:{...r,quantity:a}}),a<0&&c.toast.warning(`${r.name} inventory is now negative (${a}). Please restock soon.`)}return y.length>0&&await t(y,e,"Sale Status/Qty Edit",i,n,o),!0}catch(e){return console.error("Error adjusting stock for edited sale:",e),!1}}}};e.s(["useInventoryActions",0,l],850823);var m=e.i(224410),p=e.i(95187);let y=(0,p.createServerReference)("703e9376bfaf2adbf9aba886e70ba6b561f6bf5e0c",p.callServer,void 0,p.findSourceMapURL,"getSalesAction"),h=(0,p.createServerReference)("40d9064371ce5c0811194879498fdc849fbf872b8a",p.callServer,void 0,p.findSourceMapURL,"deleteSaleAction");e.s(["deleteSaleAction",()=>h],617318),e.s(["useSalesData",0,(e,u="desc",c)=>{let d=(0,i.useQueryClient)(),{toast:p}=(0,a.useToast)(),{logActivity:f}=(0,n.useActivityLogger)(),{currentBusiness:g}=(0,o.useBusiness)(),{restoreStockForSale:b}=l(e),v=(0,t.useCallback)(async()=>{try{if(!e||!g)return[];let t=await y(g.id,u,c);return t?t.map(e=>{let t={id:e.id,user_id:e.user_id,location_id:e.location_id,receipt_number:e.receipt_number,customer_name:e.customer_name,customer_address:e.customer_address,customer_contact:e.customer_contact,customer_id:e.customer_id,items:e.items,payment_status:e.payment_status,profit:e.profit?Number(e.profit):0,date:e.date,tax_rate:e.tax_rate||0,created_at:e.created_at,updated_at:e.updated_at,cash_transaction_id:e.cash_transaction_id,amount_paid:e.amount_paid?Number(e.amount_paid):void 0,amount_due:e.amount_due?Number(e.amount_due):void 0,category_id:e.category_id,notes:e.notes};return(0,r.mapDbSaleToSale)(t)}):[]}catch(e){return console.error("Error loading sales:",e),p({title:"Error",description:"Failed to load sales data. Please try again.",variant:"destructive"}),[]}},[e,g?.id,u,c,p]),x=(0,t.useMemo)(()=>["sales",g?.id,e],[g?.id,e]),S=(0,t.useMemo)(()=>[...x,u,c],[x,u,c]),{data:N=[],isLoading:_,isFetching:w,refetch:j}=(0,s.useQuery)({queryKey:S,queryFn:v,enabled:!!e&&!!g?.id,staleTime:3e4,gcTime:18e5,refetchOnWindowFocus:!0,refetchOnReconnect:!0}),P=_||w&&0===N.length,I=(0,t.useMemo)(()=>{let e=N.filter(e=>"Quote"!==e.paymentStatus),t=new Map;return e.forEach(e=>{let r=e.customerName,a=e.items.reduce((e,t)=>e+t.price*t.quantity,0);if(t.has(r)){let s=t.get(r);t.set(r,{total:s.total+a,count:s.count+1,customerId:s.customerId||e.customerId})}else t.set(r,{total:a,count:1,customerId:e.customerId})}),Array.from(t.entries()).map(([e,t])=>({id:t.customerId,name:e,totalPurchases:t.total,orderCount:t.count})).sort((e,t)=>t.totalPurchases-e.totalPurchases)},[N]),k=(0,t.useMemo)(()=>e=>{let t=N.filter(t=>t.customerName.toLowerCase()===e.toLowerCase()&&"Quote"!==t.paymentStatus);return{total:t.reduce((e,t)=>e+t.items.reduce((e,t)=>e+t.price*t.quantity,0),0),count:t.length}},[N]),A=async e=>{try{let t=N.find(t=>t.id===e);if(!t)throw Error("Sale not found");if("Quote"!==t.paymentStatus&&t.items.length>0&&(console.log("Restoring product quantities via useInventoryActions..."),await b(t.items,e,t.receiptNumber,g?.id)||p({title:"Inventory Update Warning",description:"Sale deleted, but inventory restoration might have failed. Please check your stock levels.",variant:"destructive"})),!g?.id)throw Error("Business context missing for deletion");let r=await h(e,g.id);if(!r.success)throw Error(r.error);return d.setQueryData(S,t=>t?t.filter(t=>t.id!==e):[]),d.invalidateQueries({queryKey:x}),C(),await f({activityType:"DELETE",module:"SALES",entityType:"sale",entityId:e,entityName:`Sale #${t.receiptNumber}`,description:`Deleted sale for ${t.customerName} - Total: UGX ${((t.amountPaid||0)+(t.amountDue||0)).toLocaleString()} (Stock restored)`,metadata:{receiptNumber:t.receiptNumber,customerName:t.customerName,customerAddress:t.customerAddress,customerContact:t.customerContact,totalAmount:(t.amountPaid||0)+(t.amountDue||0),amountPaid:t.amountPaid,profit:t.profit,paymentStatus:t.paymentStatus,taxRate:t.taxRate,itemCount:t.items.length,items:t.items.map(e=>({description:e.description,quantity:e.quantity,price:e.price,cost:e.cost,total:e.quantity*e.price,discountPercentage:e.discountPercentage,discountAmount:e.discountAmount})),notes:t.notes,cashTransactionDeleted:!!t.cashTransactionId}}),p({title:"Sale Deleted",description:"The sale record and associated data have been successfully deleted."}),(0,m.clearInventoryCaches)(),!0}catch(e){return console.error("Error deleting sale:",e),p({title:"Error",description:"Failed to delete sale. Please try again.",variant:"destructive"}),!1}},C=(0,t.useCallback)(()=>{if(!g?.id)return;let e=`soldItemsFilters_${g.id}`;localStorage.removeItem(e),localStorage.removeItem("soldItemsFilters")},[g?.id]);return{sales:N,isLoading:P,deleteSale:A,addSale:(0,t.useCallback)(e=>{d.setQueryData(S,t=>t?[e,...t]:[e]),d.invalidateQueries({queryKey:x}),C(),(0,m.clearInventoryCaches)()},[d,S,x,C,m.clearInventoryCaches]),updateSale:(0,t.useCallback)(e=>{d.setQueryData(S,t=>t?t.map(t=>t.id===e.id?e:t):[e]),d.invalidateQueries({queryKey:x}),C(),(0,m.clearInventoryCaches)()},[d,S,x,C,m.clearInventoryCaches]),getTopCustomers:I,getCustomerLifetimePurchases:k,clearSoldItemsCache:C,refetch:j,isFetching:w}}],146786)},865960,e=>{"use strict";let t=(0,e.i(475254).default)("Quote",[["path",{d:"M16 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"rib7q0"}],["path",{d:"M5 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"1ymkrd"}]]);e.s(["Quote",()=>t],865960)},481625,e=>{"use strict";var t=e.i(843476),r=e.i(271645),a=e.i(904792),s=e.i(777624),i=e.i(519455),n=e.i(16715),o=e.i(414877);let u=({onUpdate:e,isUpdating:r})=>{let a=(0,o.useIsMobile)();return(0,t.jsx)("div",{className:`${a?"mb-3":"mb-4"} w-full`,children:(0,t.jsxs)(i.Button,{onClick:e,disabled:r,className:`
          w-full bg-orange-500 hover:bg-orange-600 text-white font-semibold
          ${a?"h-10 text-sm":"h-12 text-base"}
          transition-all duration-200 shadow-md hover:shadow-lg
          ${r?"opacity-75":""}
        `,children:[(0,t.jsx)(n.RefreshCw,{className:`${a?"h-4 w-4":"h-5 w-5"} mr-2 ${r?"animate-spin":""}`}),r?"UPDATING APP...":"NEW FEATURES AVAILABLE, UPDATE APP"]})})};var c=e.i(302747);let d=()=>(0,t.jsxs)("div",{className:"space-y-4 animate-fade-in",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("div",{children:(0,t.jsx)(c.Skeleton,{className:"h-6 md:h-8 w-32 md:w-48 mb-2"})}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(c.Skeleton,{className:"h-8 w-8 md:h-9 md:w-9"}),(0,t.jsx)(c.Skeleton,{className:"h-8 w-16 md:h-9 md:w-24"})]})]}),(0,t.jsx)("div",{className:"grid grid-cols-1 gap-2 md:grid-cols-2 lg:grid-cols-4 max-w-4xl",children:[void 0,void 0,void 0,void 0].map((e,r)=>(0,t.jsx)(c.Skeleton,{className:"h-10 md:h-12"},r))}),(0,t.jsx)("div",{className:"grid gap-4 grid-cols-2 lg:grid-cols-3 xl:grid-cols-6",children:[...Array(6)].map((e,r)=>(0,t.jsx)(c.Skeleton,{className:"h-24 md:h-32"},r))}),(0,t.jsxs)("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[(0,t.jsx)("div",{className:"xl:col-span-2",children:(0,t.jsx)(c.Skeleton,{className:"h-64 md:h-80"})}),(0,t.jsx)("div",{className:"xl:col-span-1",children:(0,t.jsx)(c.Skeleton,{className:"h-64 md:h-80"})})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Skeleton,{className:"h-6 w-32"}),[void 0,void 0,void 0,void 0,void 0].map((e,r)=>(0,t.jsx)(c.Skeleton,{className:"h-12"},r))]})]});var l=e.i(107233);let m=({pageTitle:e,isRefreshing:r,isLoading:s,onRefresh:u})=>{let c=(0,a.useNavigate)(),d=(0,o.useIsMobile)();return(0,t.jsxs)("div",{className:`flex justify-between items-center ${d?"mb-4":"mb-6"}`,children:[(0,t.jsx)("h1",{className:`${d?"text-xl":"text-3xl"} font-bold text-sales-dark truncate`,children:e}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)("div",{className:"flex flex-col items-center",children:[(0,t.jsxs)(i.Button,{onClick:u,variant:"outline",size:d?"sm":"icon",disabled:r||s,className:"relative",title:"Update app for latest features and data",children:[(0,t.jsx)(n.RefreshCw,{className:`h-4 w-4 ${r?"animate-spin":""}`}),(0,t.jsx)("span",{className:"sr-only",children:"Update app"})]}),(0,t.jsx)("span",{className:"text-xs text-gray-500 mt-1 hidden md:block",children:"Update App"})]}),(0,t.jsxs)(i.Button,{onClick:()=>c("/new-sale"),className:"gap-2",size:d?"sm":"default",children:[(0,t.jsx)(l.Plus,{size:16}),!d&&"New Sale"]})]})]})};var p=e.i(350627),y=e.i(178583),h=e.i(865960),f=e.i(561659);let g=({onQuickCreate:e})=>{let r=(0,o.useIsMobile)();return(0,t.jsx)("div",{className:`${r?"mb-4":"mb-6"}`,children:(0,t.jsxs)("div",{className:`grid ${r?"grid-cols-2 gap-2":"grid-cols-2 lg:grid-cols-4 gap-4"} max-w-4xl`,children:[(0,t.jsxs)(i.Button,{onClick:()=>e("Paid"),variant:"outline",className:`gap-2 ${r?"h-10 text-xs":"h-12"} justify-start`,children:[(0,t.jsx)(p.Receipt,{className:"h-4 w-4 text-green-600"}),(0,t.jsx)("span",{children:r?"Receipt":"Create Receipt"})]}),(0,t.jsxs)(i.Button,{onClick:()=>e("NOT PAID"),variant:"outline",className:`gap-2 ${r?"h-10 text-xs":"h-12"} justify-start`,children:[(0,t.jsx)(y.FileText,{className:"h-4 w-4 text-orange-600"}),(0,t.jsx)("span",{children:r?"Invoice":"Create Invoice"})]}),(0,t.jsxs)(i.Button,{onClick:()=>e("Installment Sale"),variant:"outline",className:`gap-2 ${r?"h-10 text-xs":"h-12"} justify-start`,children:[(0,t.jsx)(f.CreditCard,{className:"h-4 w-4 text-purple-600"}),(0,t.jsx)("span",{children:r?"Installment":"Create Installment Sale"})]}),(0,t.jsxs)(i.Button,{onClick:()=>e("Quote"),variant:"outline",className:`gap-2 ${r?"h-10 text-xs":"h-12"} justify-start`,children:[(0,t.jsx)(h.Quote,{className:"h-4 w-4 text-blue-600"}),(0,t.jsx)("span",{children:r?"Quote":"Create Quotation"})]})]})})};var b=e.i(679788),v=e.i(515288),x=e.i(239616);let S=()=>(0,t.jsxs)(v.Card,{className:"mb-6 border-primary/20 shadow-sm",children:[(0,t.jsxs)(v.CardHeader,{className:"pb-3",children:[(0,t.jsx)(v.CardTitle,{className:"text-xl text-sales-primary",children:"Setup Your Business Details First"}),(0,t.jsx)(v.CardDescription,{children:"Set up your business details to personalize your sales records and receipts"})]}),(0,t.jsx)(v.CardContent,{children:(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"Adding your business name, contact information, and preferred currency will ensure your sales records and customer receipts display your correct business information."})}),(0,t.jsx)(v.CardFooter,{className:"flex justify-center",children:(0,t.jsx)(i.Button,{asChild:!0,variant:"secondary",className:"gap-2",children:(0,t.jsxs)(b.Link,{to:"/settings",children:[(0,t.jsx)(x.Settings,{size:16}),"Configure Settings"]})})})]}),N=()=>{let e=(0,a.useNavigate)(),r=(0,o.useIsMobile)();return(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-4 md:p-6 lg:p-8 text-center",children:[(0,t.jsx)(S,{}),(0,t.jsx)("h2",{className:"text-lg md:text-xl lg:text-2xl font-semibold text-sales-primary mb-4",children:"Welcome to Your Sales Tracker"}),(0,t.jsx)("p",{className:"text-gray-600 mb-4 md:mb-6 lg:mb-8 max-w-lg mx-auto text-sm md:text-base",children:"Start by creating your first sale record. Once you have sales data, you'll see analytics and insights here on your dashboard."}),(0,t.jsxs)(i.Button,{onClick:()=>e("/new-sale"),size:r?"default":"lg",className:"gap-2",children:[(0,t.jsx)(l.Plus,{size:18})," Record Your First Sale"]})]})};var _=e.i(102594),w=e.i(422713),j=e.i(160615),P=e.i(146786),I=e.i(728469),k=e.i(908406);let A=(0,r.lazy)(()=>e.A(578972));e.s(["default",0,()=>{let{hasPermission:e,isLoading:i}=(0,s.useProfiles)();(0,a.useNavigate)();let{businessError:n,settings:o,sales:c,pageTitle:l,nonQuoteSalesCount:p,isLoading:y,updateAvailable:h,isUpdating:f,triggerUpdate:b}=(()=>{let{user:e}=(0,_.useAuth)(),{isLoading:t,error:a,currentBusiness:s}=(0,w.useBusiness)(),{settings:i,isLoading:n}=(0,j.useBusinessSettings)(),{sales:o,isLoading:u}=(0,P.useSalesData)(e?.id,"desc"),{updateAvailable:c,isUpdating:d,triggerUpdate:l}=(0,I.useAppUpdate)(),m=(0,r.useMemo)(()=>i.businessName&&"Your Business Name"!==i.businessName?i.businessName:"Dashboard",[i.businessName]),p=(0,r.useMemo)(()=>o.length?o.filter(e=>"Quote"!==e.paymentStatus).length:0,[o]);return{user:e,businessError:a,currentBusiness:s,settings:i,sales:o,pageTitle:m,nonQuoteSalesCount:p,isLoading:(0,r.useMemo)(()=>u||n||t,[u,n,t]),updateAvailable:c,isUpdating:d,triggerUpdate:l}})(),{isRefreshing:v,handleRefresh:x,handleQuickCreate:S}=(()=>{let e=(0,a.useNavigate)(),{toast:t}=(0,k.useToast)(),[s,i]=(0,r.useState)(!1);return{isRefreshing:s,handleRefresh:(0,r.useCallback)(async()=>{i(!0),t({title:"Updating app",description:"Getting the latest updates and refreshing data..."});try{if("caches"in window){let e=await caches.keys();await Promise.all(e.map(e=>caches.delete(e)))}sessionStorage.clear(),setTimeout(()=>{window.location.reload()},800)}catch(e){console.error("Error during app update:",e),i(!1),t({title:"Update failed",description:"There was an error updating the app. Please try again.",variant:"destructive"})}},[t]),handleQuickCreate:(0,r.useCallback)(t=>{e("/new-sale",{state:{defaultPaymentStatus:t}})},[e])}})();if(i||y)return(0,t.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})});let C=!y&&0===p;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m,{pageTitle:l,isRefreshing:v,isLoading:y,onRefresh:x}),h&&(0,t.jsx)(u,{onUpdate:b,isUpdating:f}),(0,t.jsx)(g,{onQuickCreate:S}),C?(0,t.jsx)(N,{}):(0,t.jsx)(r.Suspense,{fallback:(0,t.jsx)(d,{}),children:(0,t.jsx)(A,{sales:c,currency:o.currency})})]})}],481625)},578972,e=>{e.v(t=>Promise.all(["static/chunks/5418599e5b05d240.js","static/chunks/e5c96ec273b4332f.js","static/chunks/3f8d2e80aa368bb3.js","static/chunks/9ebb1d96d9f31f55.js","static/chunks/d69a72ae2128701e.js"].map(t=>e.l(t))).then(()=>t(383968)))}]);