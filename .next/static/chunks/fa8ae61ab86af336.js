(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,443915,e=>{"use strict";var t=e.i(391398),r=e.i(191788),a=e.i(353533);let n=r.forwardRef(({className:e,...r},n)=>(0,t.jsx)("textarea",{className:(0,a.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:n,...r}));n.displayName="Textarea",e.s(["Textarea",()=>n])},675878,e=>{"use strict";let t=(0,e.i(369547).default)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);e.s(["AlertCircle",()=>t],675878)},626427,e=>{"use strict";var t=e.i(391398),r=e.i(191788),a=e.i(648684),n=e.i(353533);let s=(0,a.cva)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),o=r.forwardRef(({className:e,variant:r,...a},o)=>(0,t.jsx)("div",{ref:o,role:"alert",className:(0,n.cn)(s({variant:r}),e),...a}));o.displayName="Alert";let i=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)("h5",{ref:a,className:(0,n.cn)("mb-1 font-medium leading-none tracking-tight",e),...r}));i.displayName="AlertTitle";let c=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)("div",{ref:a,className:(0,n.cn)("text-sm [&_p]:leading-relaxed",e),...r}));c.displayName="AlertDescription",e.s(["Alert",()=>o,"AlertDescription",()=>c,"AlertTitle",()=>i])},262945,e=>{"use strict";var t=e.i(391398),r=e.i(191788),a=e.i(357006),n=e.i(479293),s=e.i(671185),o=e.i(55037),i=e.i(593427),c=e.i(474864),l=e.i(993953),d=e.i(674534),u="Checkbox",[m,p]=(0,n.createContextScope)(u),[f,h]=m(u);function y(e){let{__scopeCheckbox:a,checked:n,children:s,defaultChecked:i,disabled:c,form:l,name:d,onCheckedChange:m,required:p,value:h="on",internal_do_not_use_render:y}=e,[g,v]=(0,o.useControllableState)({prop:n,defaultProp:i??!1,onChange:m,caller:u}),[x,b]=r.useState(null),[w,S]=r.useState(null),C=r.useRef(!1),N=!x||!!l||!!x.closest("form"),A={checked:g,disabled:c,setChecked:v,control:x,setControl:b,name:d,form:l,value:h,hasConsumerStoppedPropagationRef:C,required:p,defaultChecked:!j(i)&&i,isFormControl:N,bubbleInput:w,setBubbleInput:S};return(0,t.jsx)(f,{scope:a,...A,children:"function"==typeof y?y(A):s})}var g="CheckboxTrigger",v=r.forwardRef(({__scopeCheckbox:e,onKeyDown:n,onClick:o,...i},c)=>{let{control:l,value:u,disabled:m,checked:p,required:f,setControl:y,setChecked:v,hasConsumerStoppedPropagationRef:x,isFormControl:b,bubbleInput:w}=h(g,e),S=(0,a.useComposedRefs)(c,y),C=r.useRef(p);return r.useEffect(()=>{let e=l?.form;if(e){let t=()=>v(C.current);return e.addEventListener("reset",t),()=>e.removeEventListener("reset",t)}},[l,v]),(0,t.jsx)(d.Primitive.button,{type:"button",role:"checkbox","aria-checked":j(p)?"mixed":p,"aria-required":f,"data-state":N(p),"data-disabled":m?"":void 0,disabled:m,value:u,...i,ref:S,onKeyDown:(0,s.composeEventHandlers)(n,e=>{"Enter"===e.key&&e.preventDefault()}),onClick:(0,s.composeEventHandlers)(o,e=>{v(e=>!!j(e)||!e),w&&b&&(x.current=e.isPropagationStopped(),x.current||e.stopPropagation())})})});v.displayName=g;var x=r.forwardRef((e,r)=>{let{__scopeCheckbox:a,name:n,checked:s,defaultChecked:o,required:i,disabled:c,value:l,onCheckedChange:d,form:u,...m}=e;return(0,t.jsx)(y,{__scopeCheckbox:a,checked:s,defaultChecked:o,disabled:c,required:i,onCheckedChange:d,name:n,form:u,value:l,internal_do_not_use_render:({isFormControl:e})=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(v,{...m,ref:r,__scopeCheckbox:a}),e&&(0,t.jsx)(C,{__scopeCheckbox:a})]})})});x.displayName=u;var b="CheckboxIndicator",w=r.forwardRef((e,r)=>{let{__scopeCheckbox:a,forceMount:n,...s}=e,o=h(b,a);return(0,t.jsx)(l.Presence,{present:n||j(o.checked)||!0===o.checked,children:(0,t.jsx)(d.Primitive.span,{"data-state":N(o.checked),"data-disabled":o.disabled?"":void 0,...s,ref:r,style:{pointerEvents:"none",...e.style}})})});w.displayName=b;var S="CheckboxBubbleInput",C=r.forwardRef(({__scopeCheckbox:e,...n},s)=>{let{control:o,hasConsumerStoppedPropagationRef:l,checked:u,defaultChecked:m,required:p,disabled:f,name:y,value:g,form:v,bubbleInput:x,setBubbleInput:b}=h(S,e),w=(0,a.useComposedRefs)(s,b),C=(0,i.usePrevious)(u),N=(0,c.useSize)(o);r.useEffect(()=>{if(!x)return;let e=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set,t=!l.current;if(C!==u&&e){let r=new Event("click",{bubbles:t});x.indeterminate=j(u),e.call(x,!j(u)&&u),x.dispatchEvent(r)}},[x,C,u,l]);let A=r.useRef(!j(u)&&u);return(0,t.jsx)(d.Primitive.input,{type:"checkbox","aria-hidden":!0,defaultChecked:m??A.current,required:p,disabled:f,name:y,value:g,form:v,...n,tabIndex:-1,ref:w,style:{...n.style,...N,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});function j(e){return"indeterminate"===e}function N(e){return j(e)?"indeterminate":e?"checked":"unchecked"}C.displayName=S;var A=e.i(770084),I=e.i(353533);let T=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)(x,{ref:a,className:(0,I.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...r,children:(0,t.jsx)(w,{className:(0,I.cn)("flex items-center justify-center text-current"),children:(0,t.jsx)(A.Check,{className:"h-4 w-4"})})}));T.displayName=x.displayName,e.s(["Checkbox",()=>T],262945)},646190,e=>{"use strict";var t=e.i(391398),r=e.i(353533);function a({className:e,...a}){return(0,t.jsx)("div",{className:(0,r.cn)("animate-pulse rounded-md bg-muted",e),...a})}e.s(["Skeleton",()=>a])},834492,e=>{"use strict";var t=e.i(498170),r=e.i(635113);function a(e,a,n){let s=(0,r.toDate)(e,n?.in);return isNaN(a)?(0,t.constructFrom)(n?.in||e,NaN):(a&&s.setDate(s.getDate()+a),s)}e.s(["addDays",()=>a])},601587,e=>{"use strict";var t=e.i(834492);function r(e,r,a){return(0,t.addDays)(e,-r,a)}e.s(["subDays",()=>r])},653162,e=>{"use strict";var t=e.i(498170),r=e.i(635113);function a(e,a,n){let s=(0,r.toDate)(e,n?.in);if(isNaN(a))return(0,t.constructFrom)(n?.in||e,NaN);if(!a)return s;let o=s.getDate(),i=(0,t.constructFrom)(n?.in||e,s.getTime());return(i.setMonth(s.getMonth()+a+1,0),o>=i.getDate())?i:(s.setFullYear(i.getFullYear(),i.getMonth(),o),s)}e.s(["addMonths",()=>a])},419326,e=>{"use strict";var t=e.i(653162);function r(e,r,a){return(0,t.addMonths)(e,12*r,a)}e.s(["addYears",()=>r])},721614,e=>{"use strict";let t=(0,e.i(369547).default)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);e.s(["ChevronRight",()=>t],721614)},635113,402848,498170,e=>{"use strict";let t=Symbol.for("constructDateFrom");function r(e,r){return"function"==typeof e?e(r):e&&"object"==typeof e&&t in e?e[t](r):e instanceof Date?new e.constructor(r):new Date(r)}function a(e,t){return r(t||e,e)}e.s(["constructFromSymbol",0,t,"millisecondsInDay",0,864e5,"millisecondsInHour",0,36e5,"millisecondsInMinute",0,6e4,"millisecondsInSecond",0,1e3,"millisecondsInWeek",0,6048e5,"minutesInDay",0,1440,"minutesInMonth",0,43200],402848),e.s(["constructFrom",()=>r],498170),e.s(["toDate",()=>a],635113)},724537,e=>{"use strict";var t=e.i(191788);e.i(391398);var r=t.createContext(void 0);function a(e){let a=t.useContext(r);return e||a||"ltr"}e.s(["useDirection",()=>a])},998847,e=>{"use strict";function t(e,[t,r]){return Math.min(r,Math.max(t,e))}e.s(["clamp",()=>t])},474864,e=>{"use strict";var t=e.i(191788),r=e.i(776833);function a(e){let[a,n]=t.useState(void 0);return(0,r.useLayoutEffect)(()=>{if(e){n({width:e.offsetWidth,height:e.offsetHeight});let t=new ResizeObserver(t=>{let r,a;if(!Array.isArray(t)||!t.length)return;let s=t[0];if("borderBoxSize"in s){let e=s.borderBoxSize,t=Array.isArray(e)?e[0]:e;r=t.inlineSize,a=t.blockSize}else r=e.offsetWidth,a=e.offsetHeight;n({width:r,height:a})});return t.observe(e,{box:"border-box"}),()=>t.unobserve(e)}n(void 0)},[e]),a}e.s(["useSize",()=>a])},593427,e=>{"use strict";var t=e.i(191788);function r(e){let r=t.useRef({value:e,previous:e});return t.useMemo(()=>(r.current.value!==e&&(r.current.previous=r.current.value,r.current.value=e),r.current.previous),[e])}e.s(["usePrevious",()=>r])},151670,e=>{"use strict";var t=e.i(921161);e.s(["Calendar",()=>t.default])},322138,e=>{"use strict";let t=(0,e.i(369547).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],322138)},726302,e=>{"use strict";var t=e.i(191788),r=e.i(150064),a=e.i(46108),n=e.i(824216),s=e.i(893930),o=e.i(285700),i=e.i(96539);e.s(["useCashAccounts",0,()=>{let[e,c]=(0,t.useState)([]),{toast:l}=(0,r.useToast)(),{currentBusiness:d}=(0,a.useBusiness)(),{user:u}=(0,n.useAuth)(),m=(0,o.useQueryClient)(),p=(0,t.useCallback)(async()=>{if(!d?.id)return[];try{let e=await (0,i.getCashAccountsAction)(d.id);if(!e.success||!e.data)throw Error(e.error||"Failed to fetch accounts");return e.data.map(e=>({...e,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)}))}catch(e){return console.error("Error loading cash accounts:",e),l({title:"Error",description:"Failed to load cash accounts",variant:"destructive"}),[]}},[d?.id,l]),f=["cash_accounts",d?.id],{data:h,isLoading:y}=(0,s.useQuery)({queryKey:f,queryFn:p,enabled:!!d?.id,staleTime:3e4});(0,t.useEffect)(()=>{h&&c(h)},[h]);let g=y&&!h,v=(0,t.useCallback)(()=>{m.invalidateQueries({queryKey:f})},[m,f]),x=(0,t.useCallback)(async e=>{if(!d?.id||!u?.id)return null;try{let t=await (0,i.createCashAccountAction)({...e,userId:u.id,locationId:d.id});if(!t.success||!t.data)throw Error(t.error);return m.invalidateQueries({queryKey:f}),l({title:"Success",description:"Cash account created successfully"}),t.data}catch(e){return console.error("Error creating cash account:",e),l({title:"Error",description:"Failed to create cash account",variant:"destructive"}),null}},[d?.id,u?.id,m,f,l]),b=async(e,t)=>{if(!d?.id)return!1;try{let r=await (0,i.updateCashAccountAction)(e,{...t,locationId:d.id});if(!r.success)throw Error(r.error);return m.invalidateQueries({queryKey:f}),l({title:"Success",description:"Cash account updated successfully"}),!0}catch(e){return console.error("Error updating cash account:",e),l({title:"Error",description:"Failed to update cash account",variant:"destructive"}),!1}},w=async(e,t)=>{if(!d?.id)return{success:!1,hasTransactions:!1};try{let r=await (0,i.deleteCashAccountAction)(e,d.id);return r.success&&(m.invalidateQueries({queryKey:f}),l({title:"Success",description:"Cash account deleted successfully"}),t&&t()),r}catch(e){return console.error("Error deleting cash account:",e),l({title:"Error",description:"Failed to delete cash account",variant:"destructive"}),{success:!1,hasTransactions:!1}}},S=async(e,t=!1,r)=>{if(!d?.id)return!1;try{let a=await (0,i.deleteCashAccountWithTransactionsAction)(e,d.id,t);if(!a.success)throw Error(a.error);return m.invalidateQueries({queryKey:f}),l({title:"Success",description:t?"Account and transactions deleted":"Account deleted (records unlinked)"}),r&&r(),!0}catch(e){return console.error("Error deleting cash account:",e),l({title:"Error",description:"Failed to delete cash account",variant:"destructive"}),!1}},C=(0,t.useCallback)(async e=>{if(!d?.id)return 0;try{let t=await (0,i.getCashAccountBalanceAction)(e,d.id);if(t.success)return t.data;return 0}catch(e){return console.error("Error getting balance:",e),0}},[d?.id]);return(0,t.useMemo)(()=>({accounts:e,isLoading:g,createAccount:x,updateAccount:b,deleteAccount:w,deleteAccountWithTransactions:S,getAccountBalance:C,loadAccounts:p,refreshAccounts:v}),[e,g,x,b,w,S,C,p,v])}])},649973,e=>{"use strict";var t=e.i(191788),r=e.i(824216),a=e.i(46108),n=e.i(150064),s=e.i(893930),o=e.i(285700);let i=e=>({id:e.id,accountId:e.account_id,amount:Number(e.amount),transactionType:e.transaction_type,category:e.category,description:e.description,personInCharge:e.person_in_charge,tags:e.tags,date:new Date(e.date),paymentMethod:e.payment_method,receiptImage:e.receipt_image,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)});var c=e.i(96539);e.s(["useCashTransactions",0,e=>{let{user:l}=(0,r.useAuth)(),{currentBusiness:d}=(0,a.useBusiness)(),{toast:u}=(0,n.useToast)(),m=(0,o.useQueryClient)(),p=(0,t.useCallback)(async()=>{try{if(!l||!d)return[];let t=await (0,c.getCashTransactionsAction)(d.id,e);if(!t.success||!t.data)throw Error(t.error||"Failed to fetch transactions");let r=t.data.map(e=>{let t={id:e.id,user_id:e.user_id,account_id:e.account_id,amount:Number(e.amount),transaction_type:e.transaction_type,category:e.category,description:e.description,person_in_charge:e.person_in_charge,tags:e.tags,date:e.date,payment_method:e.payment_method,receipt_image:e.receipt_image,created_at:e.created_at,updated_at:e.updated_at};return i(t)});return r.sort((e,t)=>{let r=new Date(t.date).getTime()-new Date(e.date).getTime();return 0!==r?r:new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()}),r}catch(e){return console.error("Error loading cash transactions:",e),u({title:"Error",description:"Failed to load cash transactions",variant:"destructive"}),[]}},[l,d?.id,e,u]),f=(0,t.useMemo)(()=>["cash_transactions",d?.id,l?.id,e],[d?.id,l?.id,e]),{data:h=[],isLoading:y}=(0,s.useQuery)({queryKey:f,queryFn:p,enabled:!!l&&!!d?.id,staleTime:3e4}),g=y&&0===h.length,v=async e=>{try{if(!l||!d)throw Error("User not authenticated");let t=await (0,c.createCashTransactionAction)({...e,userId:l.id,locationId:d.id});if(!t.success)throw Error(t.error);return u({title:"Success",description:"transfer"===e.transactionType?"Transfer completed successfully":"Cash transaction created successfully"}),m.invalidateQueries({queryKey:f}),Array.isArray(t.data)?i(t.data[0]):i(t.data)}catch(e){throw console.error("Error creating cash transaction:",e),u({title:"Error",description:"Failed to create cash transaction",variant:"destructive"}),e}},x=async e=>{try{if(!l||!d)throw Error("User not authenticated");let t=e.map(e=>({...e,userId:l.id,locationId:d.id})),r=await (0,c.createBulkCashTransactionsAction)(t);if(!r.success)throw Error(r.error);return u({title:"Success",description:`Successfully created ${e.length} transactions`}),m.invalidateQueries({queryKey:f}),r.data.map(e=>i(e))}catch(e){throw console.error("Error creating bulk transactions:",e),u({title:"Error",description:"Failed to create bulk transactions",variant:"destructive"}),e}},b=async(e,t)=>{try{let r=await (0,c.updateCashTransactionAction)(e,t);if(!r.success)throw Error(r.error);return u({title:"Success",description:"Transaction updated successfully"}),m.invalidateQueries({queryKey:f}),i(r.data)}catch(e){return console.error("Error updating cash transaction:",e),u({title:"Error",description:"Failed to update transaction",variant:"destructive"}),null}},w=async(e,t)=>{try{if(!d)throw Error("No business selected");let r=await (0,c.deleteCashTransactionAction)(e,d.id);if(!r.success)throw Error(r.error);return u({title:"Success",description:"Cash transaction deleted successfully"}),m.invalidateQueries({queryKey:f}),t&&t(),!0}catch(e){return console.error("Error deleting cash transaction:",e),u({title:"Error",description:"Failed to delete cash transaction",variant:"destructive"}),!1}},S=(0,t.useCallback)(async e=>{try{if(!d)return 0;let t=await (0,c.getAccountOpeningBalanceAction)(e,d.id);return t.success?t.data:0}catch(e){return 0}},[d?.id]),C=(0,t.useCallback)(async(e,t)=>{let r=e.toISOString().split("T")[0],a=h.filter(e=>e.date.toISOString().split("T")[0]===r);t&&(a=a.filter(e=>e.accountId===t));let n=a.filter(e=>"cash_in"===e.transactionType||"transfer_in"===e.transactionType).reduce((e,t)=>e+t.amount,0),s=a.filter(e=>"cash_out"===e.transactionType||"transfer_out"===e.transactionType).reduce((e,t)=>e+t.amount,0),o=a.filter(e=>"transfer_in"===e.transactionType).reduce((e,t)=>e+t.amount,0),i=a.filter(e=>"transfer_out"===e.transactionType).reduce((e,t)=>e+t.amount,0),c=new Date(e);c.setDate(c.getDate()-1);let l=c.toISOString().split("T")[0],d=h.filter(e=>e.date.toISOString().split("T")[0]<=l);t&&(d=d.filter(e=>e.accountId===t));let u=d.filter(e=>"cash_in"===e.transactionType||"transfer_in"===e.transactionType).reduce((e,t)=>e+t.amount,0),m=d.filter(e=>"cash_out"===e.transactionType||"transfer_out"===e.transactionType).reduce((e,t)=>e+t.amount,0),p=0;t&&(p=await S(t));let f=p+u-m;return{date:e,openingBalance:f,cashIn:n,cashOut:s,transfersIn:o,transfersOut:i,closingBalance:f+n-s}},[h,S]),j=(0,t.useCallback)(async(e,t,r)=>{let a=e.toISOString().split("T")[0],n=t.toISOString().split("T")[0],s=h.filter(e=>{let t=e.date.toISOString().split("T")[0];return t>=a&&t<=n});r&&(s=s.filter(e=>e.accountId===r));let o=s.filter(e=>"cash_in"===e.transactionType||"transfer_in"===e.transactionType).reduce((e,t)=>e+t.amount,0),i=s.filter(e=>"cash_out"===e.transactionType||"transfer_out"===e.transactionType).reduce((e,t)=>e+t.amount,0),c=s.filter(e=>"transfer_in"===e.transactionType).reduce((e,t)=>e+t.amount,0),l=s.filter(e=>"transfer_out"===e.transactionType).reduce((e,t)=>e+t.amount,0),d=new Date(e);d.setDate(d.getDate()-1);let u=d.toISOString().split("T")[0],m=h.filter(e=>e.date.toISOString().split("T")[0]<=u);r&&(m=m.filter(e=>e.accountId===r));let p=m.filter(e=>"cash_in"===e.transactionType||"transfer_in"===e.transactionType).reduce((e,t)=>e+t.amount,0),f=m.filter(e=>"cash_out"===e.transactionType||"transfer_out"===e.transactionType).reduce((e,t)=>e+t.amount,0),y=0;r&&(y=await S(r));let g=y+p-f;return{date:e,openingBalance:g,cashIn:o,cashOut:i,transfersIn:c,transfersOut:l,closingBalance:g+o-i}},[h,S]),N=(0,t.useCallback)(()=>{m.invalidateQueries({queryKey:f})},[m,f]);return(0,t.useMemo)(()=>({transactions:h,isLoading:g,createTransaction:v,createBulkTransactions:x,updateTransaction:b,deleteTransaction:w,getDailySummary:C,getDateRangeSummary:j,refreshTransactions:N}),[h,g,v,x,b,w,C,j,N])}],649973)},681912,(e,t,r)=>{"use strict";var a=e.r(730943);r.createRoot=a.createRoot,r.hydrateRoot=a.hydrateRoot},741705,(e,t,r)=>{"use strict";r._=function(e){return e&&e.__esModule?e:{default:e}}},952456,(e,t,r)=>{"use strict";function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}r._=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=a(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var i=s?Object.getOwnPropertyDescriptor(e,o):null;i&&(i.get||i.set)?Object.defineProperty(n,o,i):n[o]=e[o]}return n.default=e,r&&r.set(e,n),n}},713584,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"HeadManagerContext",{enumerable:!0,get:function(){return a}});let a=e.r(741705)._(e.r(191788)).default.createContext({})},894470,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"warnOnce",{enumerable:!0,get:function(){return a}});let a=e=>{}},889129,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a={DecodeError:function(){return g},MiddlewareNotFoundError:function(){return w},MissingStaticPage:function(){return b},NormalizeError:function(){return v},PageNotFoundError:function(){return x},SP:function(){return h},ST:function(){return y},WEB_VITALS:function(){return s},execOnce:function(){return o},getDisplayName:function(){return u},getLocationOrigin:function(){return l},getURL:function(){return d},isAbsoluteUrl:function(){return c},isResSent:function(){return m},loadGetInitialProps:function(){return f},normalizeRepeatedSlashes:function(){return p},stringifyError:function(){return S}};for(var n in a)Object.defineProperty(r,n,{enumerable:!0,get:a[n]});let s=["CLS","FCP","FID","INP","LCP","TTFB"];function o(e){let t,r=!1;return(...a)=>(r||(r=!0,t=e(...a)),t)}let i=/^[a-zA-Z][a-zA-Z\d+\-.]*?:/,c=e=>i.test(e);function l(){let{protocol:e,hostname:t,port:r}=window.location;return`${e}//${t}${r?":"+r:""}`}function d(){let{href:e}=window.location,t=l();return e.substring(t.length)}function u(e){return"string"==typeof e?e:e.displayName||e.name||"Unknown"}function m(e){return e.finished||e.headersSent}function p(e){let t=e.split("?");return t[0].replace(/\\/g,"/").replace(/\/\/+/g,"/")+(t[1]?`?${t.slice(1).join("?")}`:"")}async function f(e,t){let r=t.res||t.ctx&&t.ctx.res;if(!e.getInitialProps)return t.ctx&&t.Component?{pageProps:await f(t.Component,t.ctx)}:{};let a=await e.getInitialProps(t);if(r&&m(r))return a;if(!a)throw Object.defineProperty(Error(`"${u(e)}.getInitialProps()" should resolve to an object. But found "${a}" instead.`),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});return a}let h="u">typeof performance,y=h&&["mark","measure","getEntriesByName"].every(e=>"function"==typeof performance[e]);class g extends Error{}class v extends Error{}class x extends Error{constructor(e){super(),this.code="ENOENT",this.name="PageNotFoundError",this.message=`Cannot find module for page: ${e}`}}class b extends Error{constructor(e,t){super(),this.message=`Failed to load static file for page: ${e} ${t}`}}class w extends Error{constructor(){super(),this.code="ENOENT",this.message="Cannot find the middleware module"}}function S(e){return JSON.stringify({message:e.message,stack:e.stack})}},701085,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a={AppRouterContext:function(){return o},GlobalLayoutRouterContext:function(){return c},LayoutRouterContext:function(){return i},MissingSlotContext:function(){return d},TemplateContext:function(){return l}};for(var n in a)Object.defineProperty(r,n,{enumerable:!0,get:a[n]});let s=e.r(741705)._(e.r(191788)),o=s.default.createContext(null),i=s.default.createContext(null),c=s.default.createContext(null),l=s.default.createContext(null),d=s.default.createContext(new Set)},531430,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"ReadonlyURLSearchParams",{enumerable:!0,get:function(){return n}});class a extends Error{constructor(){super("Method unavailable on `ReadonlyURLSearchParams`. Read more: https://nextjs.org/docs/app/api-reference/functions/use-search-params#updating-searchparams")}}class n extends URLSearchParams{append(){throw new a}delete(){throw new a}set(){throw new a}sort(){throw new a}}("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),t.exports=r.default)},470008,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a={NavigationPromisesContext:function(){return d},PathParamsContext:function(){return l},PathnameContext:function(){return c},ReadonlyURLSearchParams:function(){return o.ReadonlyURLSearchParams},SearchParamsContext:function(){return i},createDevToolsInstrumentedPromise:function(){return u}};for(var n in a)Object.defineProperty(r,n,{enumerable:!0,get:a[n]});let s=e.r(191788),o=e.r(531430),i=(0,s.createContext)(null),c=(0,s.createContext)(null),l=(0,s.createContext)(null),d=(0,s.createContext)(null);function u(e,t){let r=Promise.resolve(t);return r.status="fulfilled",r.value=t,r.displayName=`${e} (SSR)`,r}},991622,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a={HTTPAccessErrorStatus:function(){return s},HTTP_ERROR_FALLBACK_ERROR_CODE:function(){return i},getAccessFallbackErrorTypeByStatus:function(){return d},getAccessFallbackHTTPStatus:function(){return l},isHTTPAccessFallbackError:function(){return c}};for(var n in a)Object.defineProperty(r,n,{enumerable:!0,get:a[n]});let s={NOT_FOUND:404,FORBIDDEN:403,UNAUTHORIZED:401},o=new Set(Object.values(s)),i="NEXT_HTTP_ERROR_FALLBACK";function c(e){if("object"!=typeof e||null===e||!("digest"in e)||"string"!=typeof e.digest)return!1;let[t,r]=e.digest.split(";");return t===i&&o.has(Number(r))}function l(e){return Number(e.digest.split(";")[1])}function d(e){switch(e){case 401:return"unauthorized";case 403:return"forbidden";case 404:return"not-found";default:return}}("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),t.exports=r.default)},40184,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"RedirectStatusCode",{enumerable:!0,get:function(){return n}});var a,n=((a={})[a.SeeOther=303]="SeeOther",a[a.TemporaryRedirect=307]="TemporaryRedirect",a[a.PermanentRedirect=308]="PermanentRedirect",a);("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),t.exports=r.default)},301939,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a,n={REDIRECT_ERROR_CODE:function(){return i},RedirectType:function(){return c},isRedirectError:function(){return l}};for(var s in n)Object.defineProperty(r,s,{enumerable:!0,get:n[s]});let o=e.r(40184),i="NEXT_REDIRECT";var c=((a={}).push="push",a.replace="replace",a);function l(e){if("object"!=typeof e||null===e||!("digest"in e)||"string"!=typeof e.digest)return!1;let t=e.digest.split(";"),[r,a]=t,n=t.slice(2,-2).join(";"),s=Number(t.at(-2));return r===i&&("replace"===a||"push"===a)&&"string"==typeof n&&!isNaN(s)&&s in o.RedirectStatusCode}("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),t.exports=r.default)},68934,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"isNextRouterError",{enumerable:!0,get:function(){return s}});let a=e.r(991622),n=e.r(301939);function s(e){return(0,n.isRedirectError)(e)||(0,a.isHTTPAccessFallbackError)(e)}("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),t.exports=r.default)},924432,e=>{"use strict";var t=e.i(256680),r=e.i(290205);async function a(e,r){try{let a={locationId:e};r&&(a.productId=r);let n=await t.db.productHistory.findMany({where:a,include:{product:{select:{name:!0,costPrice:!0,sellingPrice:!0,sku:!0}}},orderBy:[{createdAt:"desc"},{id:"desc"}]});return{success:!0,data:n.map(e=>({id:e.id,productId:e.productId,oldQuantity:e.previousQuantity,newQuantity:e.newQuantity,changeReason:e.changeReason,createdAt:e.createdAt.toISOString(),referenceId:e.referenceId,receiptNumber:e.receiptNumber,product:e.product?{name:e.product.name,costPrice:e.product.costPrice,sellingPrice:e.product.sellingPrice,itemNumber:e.product.sku}:void 0}))}}catch(e){return console.error("Error fetching stock history:",e),{success:!1,error:e.message}}}async function n(e){try{let a=await t.db.$transaction(async t=>{let r=await t.productHistory.create({data:{userId:e.userId,locationId:e.locationId,productId:e.productId,previousQuantity:e.previousQuantity,newQuantity:e.newQuantity,changeReason:e.changeReason,referenceId:e.referenceId||null,receiptNumber:e.receiptNumber||null,createdAt:e.createdAt?new Date(e.createdAt):void 0}});return await t.product.update({where:{id:e.productId},data:{stock:e.newQuantity}}),r});return(0,r.revalidatePath)("/inventory"),{success:!0,data:a}}catch(e){return console.error("Error creating stock history:",e),{success:!1,error:e.message}}}async function s(e,a){try{let n=await t.db.$transaction(async t=>{let r=await t.productHistory.findMany({where:{productId:e,locationId:a},orderBy:[{createdAt:"asc"},{id:"asc"}]});if(0===r.length)return{finalQuantity:0};let n=0,s=[];for(let e of r){let r=e.newQuantity-e.previousQuantity,a=n,o=a+r;(e.previousQuantity!==a||e.newQuantity!==o)&&s.push(t.productHistory.update({where:{id:e.id},data:{previousQuantity:a,newQuantity:o}})),n=o}return s.length>0&&await Promise.all(s),await t.product.update({where:{id:e},data:{stock:n}}),{finalQuantity:n}});return(0,r.revalidatePath)("/inventory"),{success:!0,data:n}}catch(e){return console.error("Error recalculating stock chain:",e),{success:!1,error:e.message}}}async function o(e,a){try{let n=await t.db.$transaction(async t=>{let r=await t.productHistory.findMany({where:{referenceId:e,locationId:a},select:{productId:!0}}),n=[...new Set(r.map(e=>e.productId))];for(let r of(await t.productHistory.deleteMany({where:{referenceId:e,locationId:a}}),n))await c(t,r,a);return{affectedProducts:n.length}});return(0,r.revalidatePath)("/inventory"),{success:!0,data:n}}catch(e){return console.error("Error deleting stock history by reference:",e),{success:!1,error:e.message}}}async function i(e,a,n){try{let s=await t.db.productHistory.updateMany({where:{referenceId:e,locationId:a},data:{createdAt:new Date(n)}});return(0,r.revalidatePath)("/inventory"),{success:!0,data:s}}catch(e){return console.error("Error updating stock history dates:",e),{success:!1,error:e.message}}}async function c(e,t,r){let a=await e.productHistory.findMany({where:{productId:t,locationId:r},orderBy:[{createdAt:"asc"},{id:"asc"}]}),n=0;for(let t of a){let r=t.newQuantity-t.previousQuantity,a=n,s=a+r;(t.previousQuantity!==a||t.newQuantity!==s)&&await e.productHistory.update({where:{id:t.id},data:{previousQuantity:a,newQuantity:s}}),n=s}await e.product.update({where:{id:t},data:{stock:n}})}async function l(e,r){try{let a=await t.db.requisition.findMany({where:{userId:e,locationId:r},orderBy:{createdAt:"desc"}});return{success:!0,data:a.map(e=>({id:e.id,userId:e.userId,locationId:e.branchId,requisitionNumber:e.requisitionNumber,title:e.title||"",items:e.items||[],notes:e.notes,status:e.status,createdAt:e.createdAt.toISOString(),updatedAt:e.updatedAt.toISOString()}))}}catch(e){return console.error("Error fetching requisitions:",e),{success:!1,error:e.message}}}async function d(e){try{let a=await t.db.requisition.create({data:{userId:e.userId,branchId:e.locationId,requisitionNumber:e.requisitionNumber,title:e.title,items:e.items,notes:e.notes,status:e.status||"draft"}});return(0,r.revalidatePath)("/requisitions"),{success:!0,data:{id:a.id,userId:a.userId,locationId:a.branchId,requisitionNumber:a.requisitionNumber,title:a.title||"",items:a.items||[],notes:a.notes,status:a.status,createdAt:a.createdAt.toISOString(),updatedAt:a.updatedAt.toISOString()}}}catch(e){return console.error("Error creating requisition:",e),{success:!1,error:e.message}}}async function u(e,a,n){try{let s=await t.db.requisition.update({where:{id:e,userId:a},data:{title:n.title,items:n.items,notes:n.notes,status:n.status,updatedAt:new Date}});return(0,r.revalidatePath)("/requisitions"),{success:!0,data:{id:s.id,userId:s.userId,locationId:s.branchId,requisitionNumber:s.requisitionNumber,title:s.title||"",items:s.items||[],notes:s.notes,status:s.status,createdAt:s.createdAt.toISOString(),updatedAt:s.updatedAt.toISOString()}}}catch(e){return console.error("Error updating requisition:",e),{success:!1,error:e.message}}}async function m(e,a){try{return await t.db.requisition.delete({where:{id:e,userId:a}}),(0,r.revalidatePath)("/requisitions"),{success:!0}}catch(e){return console.error("Error deleting requisition:",e),{success:!1,error:e.message}}}async function p(e,r,a){try{let n=new Date(r),s=new Date(a),o=await t.db.product.findMany({where:{branchId:e},include:{category:!0}}),i=await Promise.all(o.map(async r=>{let a=await t.db.productHistory.findMany({where:{productId:r.id,locationId:e,createdAt:{gte:n,lte:s}},orderBy:{createdAt:"asc"}}),o=0,i=0,c=0,l=0;a.forEach(e=>{let t=e.newQuantity-e.previousQuantity;"SALE"===e.changeReason?o+=Math.abs(t):"STOCK_IN"===e.changeReason||"RESTOCK"===e.changeReason?i+=t:t>0?c+=t:l+=Math.abs(t)});let d=await t.db.productHistory.findFirst({where:{productId:r.id,locationId:e,createdAt:{lte:s}},orderBy:{createdAt:"desc"}}),u=d?d.newQuantity:0,m=u-(i+c-o-l);return{productId:r.id,productName:r.name,itemNumber:r.sku||r.id,imageUrl:r.imageUrl,costPrice:Number(r.costPrice),sellingPrice:Number(r.sellingPrice),category:r.category?.name,openingStock:m,itemsSold:o,stockIn:i,transferOut:0,returnIn:0,returnOut:0,adjustmentsIn:c,adjustmentsOut:l,closingStock:u,revaluation:u*Number(r.costPrice)}}));return{success:!0,data:i}}catch(e){return console.error("Error generating stock summary report:",e),{success:!1,error:e.message}}}async function f(e,r){try{let a=await t.db.product.findUnique({where:{id:r},include:{category:!0}});if(!a)return{success:!1,error:"Product not found"};let n=await t.db.productHistory.findMany({where:{productId:r,locationId:e},orderBy:[{createdAt:"asc"},{id:"asc"}]}),s=await t.db.sale.findMany({where:{branchId:e},orderBy:{date:"asc"}}),o=n.length>0?n[0].newStock:0,i=n.length>0?n[0].createdAt:null,c=new Map,l=0;s.forEach(e=>{let t=(e.items||[]).filter(e=>e.productId===r).reduce((e,t)=>e+(Number(t.quantity)||0),0);if(t>0)if(i&&e.date<i)l+=t;else{let r=e.date.toISOString().split("T")[0],a=c.get(r)||{itemsSold:0,stockAdded:0,transferOut:0,returnIn:0,returnOut:0,adjustments:0};a.itemsSold+=t,c.set(r,a)}}),n.slice(1).forEach(e=>{let t=e.createdAt.toISOString().split("T")[0],r=e.newStock-e.oldStock,a=(e.changeReason||"").toLowerCase(),n=c.get(t)||{itemsSold:0,stockAdded:0,transferOut:0,returnIn:0,returnOut:0,adjustments:0};"RESTOCK"===e.type||a.includes("purchase")||a.includes("addition")?n.stockAdded+=r:a.includes("transfer out")?n.transferOut+=Math.abs(r):a.includes("customer return")?n.returnIn+=r:a.includes("return to supplier")?n.returnOut+=Math.abs(r):"SALE"!==e.type&&(n.adjustments+=r),c.set(t,n)});let d=Array.from(c.keys()).sort(),u=[],m=o;for(let e of d){let t=c.get(e),r=m,a=r-t.itemsSold+t.stockAdded-t.transferOut+t.returnIn-t.returnOut+t.adjustments;u.push({date:e,startingStock:r,...t,endingStock:a}),m=a}return{success:!0,data:{product:{id:a.id,name:a.name,quantity:a.stock,itemNumber:a.sku},currentStock:a.stock,calculatedStock:m,discrepancy:a.stock-m,openingStock:o,openingDate:i?.toISOString(),excludedSalesQty:l,dailyBreakdown:u}}}catch(e){return console.error("Error in reconciliation action:",e),{success:!1,error:e.message}}}async function h(e){try{let r=await t.db.product.findMany({where:{branchId:e},select:{id:!0,name:!0,stock:!0}}),a=[];for(let n of r){let r=await t.db.productHistory.findMany({where:{productId:n.id,locationId:e},orderBy:[{createdAt:"asc"},{id:"asc"}]});if(0===r.length)continue;let s=0,o=[];for(let e of r){let t=e.newStock-e.oldStock,r=s,a=r+t;(e.oldStock!==r||e.newStock!==a)&&o.push({entryId:e.id,createdAt:e.createdAt.toISOString(),changeReason:e.changeReason,currentPrevQty:e.oldStock,currentNewQty:e.newStock,fixedPrevQty:r,fixedNewQty:a}),s=a}(o.length>0||Math.abs(n.stock-s)>.001)&&a.push({productId:n.id,productName:n.name,totalEntries:r.length,brokenEntries:o,finalFixedQty:s,currentProductQty:n.stock})}return{success:!0,data:a}}catch(e){return{success:!1,error:e.message}}}async function y(e,r){try{let a=r||(await t.db.product.findMany({where:{branchId:e},select:{id:!0}})).map(e=>e.id),n=0,o=0;for(let t of a)try{await s(t,e),n++}catch(e){o++}return{success:!0,data:{repaired:n,failed:o}}}catch(e){return{success:!1,error:e.message}}}async function g(e){try{let r=await t.db.activityHistory.findMany({where:{entityId:{in:e}},select:{entityId:!0,entityName:!0}});return{success:!0,data:r}}catch(e){return{success:!1,error:e.message,data:[]}}}async function v(e,r){try{return await t.db.productHistory.updateMany({where:{id:{in:e}},data:{createdAt:new Date(r)}}),{success:!0}}catch(e){return{success:!1,error:e.message}}}e.s(["createRequisitionAction",()=>d,"createStockHistoryAction",()=>n,"deleteRequisitionAction",()=>m,"deleteStockHistoryEntriesByReferenceAction",()=>o,"getActivityByEntityIdsAction",()=>g,"getProductReconciliationAction",()=>f,"getRequisitionsAction",()=>l,"getStockHistoryAction",()=>a,"getStockRepairsPreviewAction",()=>h,"getStockSummaryReportAction",()=>p,"recalculateStockChainAction",()=>s,"repairStockChainsAction",()=>y,"updateRequisitionAction",()=>u,"updateStockHistoryDatesAction",()=>v,"updateStockHistoryDatesByReferenceAction",()=>i])},368104,e=>{"use strict";var t=e.i(824216),r=e.i(46108),a=e.i(893930),n=e.i(285700),s=e.i(924432);e.s(["useStockSummaryData",0,e=>{let{user:o}=(0,t.useAuth)(),{currentBusiness:i}=(0,r.useBusiness)(),c=(0,n.useQueryClient)(),l=async()=>{if(!o?.id||!i?.id||!e?.from||!e?.to)return[];try{let t=await (0,s.getStockSummaryReportAction)(i.id,e.from.toISOString(),e.to.toISOString());if(t.success&&t.data)return t.data;throw Error(t.error)}catch(e){throw console.error("[StockSummary] Error fetching report:",e.message),e}},{data:d=[],isLoading:u,refetch:m}=(0,a.useQuery)({queryKey:["stockSummary",i?.id,e.from?.toISOString(),e.to?.toISOString()],queryFn:l,enabled:!!o?.id&&!!i?.id&&!!e?.from&&!!e?.to,staleTime:3e5,gcTime:18e5});return{stockSummaryData:d,isLoading:u,loadStockSummaryData:m,clearCache:()=>{c.invalidateQueries({queryKey:["stockSummary"]})},clearAllLocationCaches:()=>{c.invalidateQueries({queryKey:["stockSummary"]})}}}])},985294,e=>{"use strict";let t=(0,e.i(369547).default)("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);e.s(["MoreHorizontal",()=>t],985294)},21860,e=>{"use strict";var t=e.i(849543),r=e.i(327765),a=e.i(324906),n=e.i(492110),s=e.i(319133),o=e.i(738609),i=e.i(429557),c=e.i(438647),l=e.i(601587),d=e.i(443388),u=e.i(93445);e.s(["getDateRangeFromFilter",0,e=>{let m=new Date,p=(0,t.startOfDay)(m);switch(e){case"today":return{from:p,to:(0,r.endOfDay)(m)};case"yesterday":let f=(0,l.subDays)(p,1);return{from:f,to:(0,r.endOfDay)(f)};case"this-week":return{from:(0,a.startOfWeek)(m),to:(0,n.endOfWeek)(m)};case"last-week":let h=(0,a.startOfWeek)((0,d.subWeeks)(m,1));return{from:h,to:(0,n.endOfWeek)(h)};case"this-month":return{from:(0,s.startOfMonth)(m),to:(0,o.endOfMonth)(m)};case"last-month":let y=(0,s.startOfMonth)((0,u.subMonths)(m,1));return{from:y,to:(0,o.endOfMonth)(y)};case"this-year":return{from:(0,i.startOfYear)(m),to:(0,c.endOfYear)(m)};default:return{from:new Date(2e3,0,1),to:(0,r.endOfDay)(m)}}},"isDateInRange",0,(e,t,r)=>!t&&!r||(t?r?e>=t&&e<=r:e>=t:e<=r)])},212283,e=>{"use strict";let t;var r=e.i(391398),a=e.i(191788),n=e.i(479293),s=e.i(357006),o=e.i(135598),i=e.i(671185),c=Symbol("radix.slottable"),l="AlertDialog",[d,u]=(0,n.createContextScope)(l,[o.createDialogScope]),m=(0,o.createDialogScope)(),p=e=>{let{__scopeAlertDialog:t,...a}=e,n=m(t);return(0,r.jsx)(o.Root,{...n,...a,modal:!0})};p.displayName=l;var f=a.forwardRef((e,t)=>{let{__scopeAlertDialog:a,...n}=e,s=m(a);return(0,r.jsx)(o.Trigger,{...s,...n,ref:t})});f.displayName="AlertDialogTrigger";var h=e=>{let{__scopeAlertDialog:t,...a}=e,n=m(t);return(0,r.jsx)(o.Portal,{...n,...a})};h.displayName="AlertDialogPortal";var y=a.forwardRef((e,t)=>{let{__scopeAlertDialog:a,...n}=e,s=m(a);return(0,r.jsx)(o.Overlay,{...s,...n,ref:t})});y.displayName="AlertDialogOverlay";var g="AlertDialogContent",[v,x]=d(g),b=((t=({children:e})=>(0,r.jsx)(r.Fragment,{children:e})).displayName="AlertDialogContent.Slottable",t.__radixId=c,t),w=a.forwardRef((e,t)=>{let{__scopeAlertDialog:n,children:c,...l}=e,d=m(n),u=a.useRef(null),p=(0,s.useComposedRefs)(t,u),f=a.useRef(null);return(0,r.jsx)(o.WarningProvider,{contentName:g,titleName:S,docsSlug:"alert-dialog",children:(0,r.jsx)(v,{scope:n,cancelRef:f,children:(0,r.jsxs)(o.Content,{role:"alertdialog",...d,...l,ref:p,onOpenAutoFocus:(0,i.composeEventHandlers)(l.onOpenAutoFocus,e=>{e.preventDefault(),f.current?.focus({preventScroll:!0})}),onPointerDownOutside:e=>e.preventDefault(),onInteractOutside:e=>e.preventDefault(),children:[(0,r.jsx)(b,{children:c}),(0,r.jsx)(E,{contentRef:u})]})})})});w.displayName=g;var S="AlertDialogTitle",C=a.forwardRef((e,t)=>{let{__scopeAlertDialog:a,...n}=e,s=m(a);return(0,r.jsx)(o.Title,{...s,...n,ref:t})});C.displayName=S;var j="AlertDialogDescription",N=a.forwardRef((e,t)=>{let{__scopeAlertDialog:a,...n}=e,s=m(a);return(0,r.jsx)(o.Description,{...s,...n,ref:t})});N.displayName=j;var A=a.forwardRef((e,t)=>{let{__scopeAlertDialog:a,...n}=e,s=m(a);return(0,r.jsx)(o.Close,{...s,...n,ref:t})});A.displayName="AlertDialogAction";var I="AlertDialogCancel",T=a.forwardRef((e,t)=>{let{__scopeAlertDialog:a,...n}=e,{cancelRef:i}=x(I,a),c=m(a),l=(0,s.useComposedRefs)(t,i);return(0,r.jsx)(o.Close,{...c,...n,ref:l})});T.displayName=I;var E=({contentRef:e})=>{let t=`\`${g}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${g}\` by passing a \`${j}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${g}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return a.useEffect(()=>{document.getElementById(e.current?.getAttribute("aria-describedby"))||console.warn(t)},[t,e]),null},D=e.i(353533),P=e.i(939310);let _=a.forwardRef(({className:e,...t},a)=>(0,r.jsx)(y,{className:(0,D.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:a}));_.displayName=y.displayName;let M=a.forwardRef(({className:e,...t},a)=>(0,r.jsxs)(h,{children:[(0,r.jsx)(_,{}),(0,r.jsx)(w,{ref:a,className:(0,D.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t})]}));M.displayName=w.displayName;let R=({className:e,...t})=>(0,r.jsx)("div",{className:(0,D.cn)("flex flex-col space-y-2 text-center sm:text-left",e),...t});R.displayName="AlertDialogHeader";let k=({className:e,...t})=>(0,r.jsx)("div",{className:(0,D.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});k.displayName="AlertDialogFooter";let O=a.forwardRef(({className:e,...t},a)=>(0,r.jsx)(C,{ref:a,className:(0,D.cn)("text-lg font-semibold",e),...t}));O.displayName=C.displayName;let F=a.forwardRef(({className:e,...t},a)=>(0,r.jsx)(N,{ref:a,className:(0,D.cn)("text-sm text-muted-foreground",e),...t}));F.displayName=N.displayName;let L=a.forwardRef(({className:e,...t},a)=>(0,r.jsx)(A,{ref:a,className:(0,D.cn)((0,P.buttonVariants)(),e),...t}));L.displayName=A.displayName;let B=a.forwardRef(({className:e,...t},a)=>(0,r.jsx)(T,{ref:a,className:(0,D.cn)((0,P.buttonVariants)({variant:"outline"}),"mt-2 sm:mt-0",e),...t}));B.displayName=T.displayName,e.s(["AlertDialog",()=>p,"AlertDialogAction",()=>L,"AlertDialogCancel",()=>B,"AlertDialogContent",()=>M,"AlertDialogDescription",()=>F,"AlertDialogFooter",()=>k,"AlertDialogHeader",()=>R,"AlertDialogTitle",()=>O,"AlertDialogTrigger",()=>f],212283)},438647,443388,e=>{"use strict";var t=e.i(635113);function r(e,r){let a=(0,t.toDate)(e,r?.in),n=a.getFullYear();return a.setFullYear(n+1,0,0),a.setHours(23,59,59,999),a}e.s(["endOfYear",()=>r],438647);var a=e.i(530174);function n(e,t,r){return(0,a.addWeeks)(e,-t,r)}e.s(["subWeeks",()=>n],443388)},221498,e=>{"use strict";var t=e.i(191788),r=e.i(671185),a=e.i(352162),n=e.i(357006),s=e.i(479293),o=e.i(64592),i=e.i(674534),c=e.i(998657),l=e.i(55037),d=e.i(724537),u=e.i(391398),m="rovingFocusGroup.onEntryFocus",p={bubbles:!1,cancelable:!0},f="RovingFocusGroup",[h,y,g]=(0,a.createCollection)(f),[v,x]=(0,s.createContextScope)(f,[g]),[b,w]=v(f),S=t.forwardRef((e,t)=>(0,u.jsx)(h.Provider,{scope:e.__scopeRovingFocusGroup,children:(0,u.jsx)(h.Slot,{scope:e.__scopeRovingFocusGroup,children:(0,u.jsx)(C,{...e,ref:t})})}));S.displayName=f;var C=t.forwardRef((e,a)=>{let{__scopeRovingFocusGroup:s,orientation:o,loop:h=!1,dir:g,currentTabStopId:v,defaultCurrentTabStopId:x,onCurrentTabStopIdChange:w,onEntryFocus:S,preventScrollOnEntryFocus:C=!1,...j}=e,N=t.useRef(null),A=(0,n.useComposedRefs)(a,N),T=(0,d.useDirection)(g),[E,D]=(0,l.useControllableState)({prop:v,defaultProp:x??null,onChange:w,caller:f}),[P,_]=t.useState(!1),M=(0,c.useCallbackRef)(S),R=y(s),k=t.useRef(!1),[O,F]=t.useState(0);return t.useEffect(()=>{let e=N.current;if(e)return e.addEventListener(m,M),()=>e.removeEventListener(m,M)},[M]),(0,u.jsx)(b,{scope:s,orientation:o,dir:T,loop:h,currentTabStopId:E,onItemFocus:t.useCallback(e=>D(e),[D]),onItemShiftTab:t.useCallback(()=>_(!0),[]),onFocusableItemAdd:t.useCallback(()=>F(e=>e+1),[]),onFocusableItemRemove:t.useCallback(()=>F(e=>e-1),[]),children:(0,u.jsx)(i.Primitive.div,{tabIndex:P||0===O?-1:0,"data-orientation":o,...j,ref:A,style:{outline:"none",...e.style},onMouseDown:(0,r.composeEventHandlers)(e.onMouseDown,()=>{k.current=!0}),onFocus:(0,r.composeEventHandlers)(e.onFocus,e=>{let t=!k.current;if(e.target===e.currentTarget&&t&&!P){let t=new CustomEvent(m,p);if(e.currentTarget.dispatchEvent(t),!t.defaultPrevented){let e=R().filter(e=>e.focusable);I([e.find(e=>e.active),e.find(e=>e.id===E),...e].filter(Boolean).map(e=>e.ref.current),C)}}k.current=!1}),onBlur:(0,r.composeEventHandlers)(e.onBlur,()=>_(!1))})})}),j="RovingFocusGroupItem",N=t.forwardRef((e,a)=>{let{__scopeRovingFocusGroup:n,focusable:s=!0,active:c=!1,tabStopId:l,children:d,...m}=e,p=(0,o.useId)(),f=l||p,g=w(j,n),v=g.currentTabStopId===f,x=y(n),{onFocusableItemAdd:b,onFocusableItemRemove:S,currentTabStopId:C}=g;return t.useEffect(()=>{if(s)return b(),()=>S()},[s,b,S]),(0,u.jsx)(h.ItemSlot,{scope:n,id:f,focusable:s,active:c,children:(0,u.jsx)(i.Primitive.span,{tabIndex:v?0:-1,"data-orientation":g.orientation,...m,ref:a,onMouseDown:(0,r.composeEventHandlers)(e.onMouseDown,e=>{s?g.onItemFocus(f):e.preventDefault()}),onFocus:(0,r.composeEventHandlers)(e.onFocus,()=>g.onItemFocus(f)),onKeyDown:(0,r.composeEventHandlers)(e.onKeyDown,e=>{if("Tab"===e.key&&e.shiftKey)return void g.onItemShiftTab();if(e.target!==e.currentTarget)return;let t=function(e,t,r){var a;let n=(a=e.key,"rtl"!==r?a:"ArrowLeft"===a?"ArrowRight":"ArrowRight"===a?"ArrowLeft":a);if(!("vertical"===t&&["ArrowLeft","ArrowRight"].includes(n))&&!("horizontal"===t&&["ArrowUp","ArrowDown"].includes(n)))return A[n]}(e,g.orientation,g.dir);if(void 0!==t){if(e.metaKey||e.ctrlKey||e.altKey||e.shiftKey)return;e.preventDefault();let n=x().filter(e=>e.focusable).map(e=>e.ref.current);if("last"===t)n.reverse();else if("prev"===t||"next"===t){var r,a;"prev"===t&&n.reverse();let s=n.indexOf(e.currentTarget);n=g.loop?(r=n,a=s+1,r.map((e,t)=>r[(a+t)%r.length])):n.slice(s+1)}setTimeout(()=>I(n))}}),children:"function"==typeof d?d({isCurrentTabStop:v,hasTabStop:null!=C}):d})})});N.displayName=j;var A={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function I(e,t=!1){let r=document.activeElement;for(let a of e)if(a===r||(a.focus({preventScroll:t}),document.activeElement!==r))return}e.s(["Item",()=>N,"Root",()=>S,"createRovingFocusGroupScope",()=>x])},550292,e=>{"use strict";var t=e.i(391398),r=e.i(191788),a=e.i(671185),n=e.i(479293),s=e.i(221498),o=e.i(993953),i=e.i(674534),c=e.i(724537),l=e.i(55037),d=e.i(64592),u="Tabs",[m,p]=(0,n.createContextScope)(u,[s.createRovingFocusGroupScope]),f=(0,s.createRovingFocusGroupScope)(),[h,y]=m(u),g=r.forwardRef((e,r)=>{let{__scopeTabs:a,value:n,onValueChange:s,defaultValue:o,orientation:m="horizontal",dir:p,activationMode:f="automatic",...y}=e,g=(0,c.useDirection)(p),[v,x]=(0,l.useControllableState)({prop:n,onChange:s,defaultProp:o??"",caller:u});return(0,t.jsx)(h,{scope:a,baseId:(0,d.useId)(),value:v,onValueChange:x,orientation:m,dir:g,activationMode:f,children:(0,t.jsx)(i.Primitive.div,{dir:g,"data-orientation":m,...y,ref:r})})});g.displayName=u;var v="TabsList",x=r.forwardRef((e,r)=>{let{__scopeTabs:a,loop:n=!0,...o}=e,c=y(v,a),l=f(a);return(0,t.jsx)(s.Root,{asChild:!0,...l,orientation:c.orientation,dir:c.dir,loop:n,children:(0,t.jsx)(i.Primitive.div,{role:"tablist","aria-orientation":c.orientation,...o,ref:r})})});x.displayName=v;var b="TabsTrigger",w=r.forwardRef((e,r)=>{let{__scopeTabs:n,value:o,disabled:c=!1,...l}=e,d=y(b,n),u=f(n),m=j(d.baseId,o),p=N(d.baseId,o),h=o===d.value;return(0,t.jsx)(s.Item,{asChild:!0,...u,focusable:!c,active:h,children:(0,t.jsx)(i.Primitive.button,{type:"button",role:"tab","aria-selected":h,"aria-controls":p,"data-state":h?"active":"inactive","data-disabled":c?"":void 0,disabled:c,id:m,...l,ref:r,onMouseDown:(0,a.composeEventHandlers)(e.onMouseDown,e=>{c||0!==e.button||!1!==e.ctrlKey?e.preventDefault():d.onValueChange(o)}),onKeyDown:(0,a.composeEventHandlers)(e.onKeyDown,e=>{[" ","Enter"].includes(e.key)&&d.onValueChange(o)}),onFocus:(0,a.composeEventHandlers)(e.onFocus,()=>{let e="manual"!==d.activationMode;h||c||!e||d.onValueChange(o)})})})});w.displayName=b;var S="TabsContent",C=r.forwardRef((e,a)=>{let{__scopeTabs:n,value:s,forceMount:c,children:l,...d}=e,u=y(S,n),m=j(u.baseId,s),p=N(u.baseId,s),f=s===u.value,h=r.useRef(f);return r.useEffect(()=>{let e=requestAnimationFrame(()=>h.current=!1);return()=>cancelAnimationFrame(e)},[]),(0,t.jsx)(o.Presence,{present:c||f,children:({present:r})=>(0,t.jsx)(i.Primitive.div,{"data-state":f?"active":"inactive","data-orientation":u.orientation,role:"tabpanel","aria-labelledby":m,hidden:!r,id:p,tabIndex:0,...d,ref:a,style:{...e.style,animationDuration:h.current?"0s":void 0},children:r&&l})})});function j(e,t){return`${e}-trigger-${t}`}function N(e,t){return`${e}-content-${t}`}C.displayName=S;var A=e.i(353533);let I=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)(x,{ref:a,className:(0,A.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...r}));I.displayName=x.displayName;let T=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)(w,{ref:a,className:(0,A.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...r}));T.displayName=w.displayName;let E=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)(C,{ref:a,className:(0,A.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...r}));E.displayName=C.displayName,e.s(["Tabs",()=>g,"TabsContent",()=>E,"TabsList",()=>I,"TabsTrigger",()=>T],550292)},93445,e=>{"use strict";var t=e.i(653162);function r(e,r,a){return(0,t.addMonths)(e,-r,a)}e.s(["subMonths",()=>r])},327765,e=>{"use strict";var t=e.i(635113);function r(e,r){let a=(0,t.toDate)(e,r?.in);return a.setHours(23,59,59,999),a}e.s(["endOfDay",()=>r])},8745,(e,t,r)=>{let a=Error("Could not parse module '[project]/src/app/actions/products.ts'\n\n'import', and 'export' cannot be used outside of module code");throw a.code="MODULE_UNPARSABLE",a},355879,775778,e=>{"use strict";var t=e.i(191788),r=e.i(563905),a=e.i(46108),n=e.i(893930),s=e.i(285700);let o=e=>{let t=Object.keys(localStorage),r=["allProductsStats_","stockSummary_","soldItems_","dashboardData_","analyticsData_"],a=0;t.forEach(e=>{r.some(t=>e.startsWith(t))&&(localStorage.removeItem(e),a++)}),a>0&&console.log(`[Cache] Cleared ${a} inventory-related localStorage entries.`),e&&(console.log("[Cache] Invalidating React Query inventory keys..."),e.invalidateQueries({queryKey:["inventory_global_stats"]}),e.invalidateQueries({queryKey:["stockSummary"]}),e.invalidateQueries({queryKey:["products"]}),e.invalidateQueries({queryKey:["sales"]}),e.invalidateQueries({queryKey:["all-products-for-scanner"]}),e.invalidateQueries({queryKey:["all-products"]}))};e.s(["clearInventoryCaches",0,o],775778);var i=e.i(8745);e.s(["useProducts",0,(e,c=50)=>{let[l,d]=(0,t.useState)([]),[u,m]=(0,t.useState)(1),[p,f]=(0,t.useState)(c),[h,y]=(0,t.useState)(0),[g,v]=(0,t.useState)(!1),{settings:x}=(0,r.useBusinessSettings)(),{currentBusiness:b}=(0,a.useBusiness)(),w=(0,s.useQueryClient)(),[S,C]=(0,t.useState)({search:"",category:"all",stockStatus:"all"}),[j,N]=(0,t.useState)(null),A=(0,t.useCallback)(e=>{e.search!==S.search&&(v(!0),j&&clearTimeout(j),N(setTimeout(()=>{v(!1)},600))),C(e)},[S.search,j]),I=(0,t.useCallback)(async()=>{if(!e||!b)return{products:[],count:0};try{return await (0,i.getProductsAction)({userId:e,businessId:b.id,page:u,pageSize:p,search:S.search,category:"all"===S.category?void 0:S.category,stockStatus:S.stockStatus})}catch(e){return console.error("Error loading products from server action:",e),{products:[],count:0}}},[e,b?.id,u,p,S.search,S.category,S.stockStatus]),T=(0,t.useMemo)(()=>["products",e,b?.id],[e,b?.id]),E=(0,t.useMemo)(()=>[...T,u,p,S.search,S.category,S.stockStatus],[T,u,p,S.search,S.category,S.stockStatus]),{data:D,isLoading:P,isFetching:_,refetch:M}=(0,n.useQuery)({queryKey:E,queryFn:I,enabled:!!e&&!!b?.id,staleTime:3e4,gcTime:18e5,refetchOnWindowFocus:!0,refetchOnReconnect:!0});(0,t.useEffect)(()=>{D&&(d(D.products),y(D.count))},[D]);let R=async t=>{try{if(!e)return null;return console.warn("Image upload redirecting to server action (TODO)"),null}catch(e){return console.error("Error in uploadProductImage:",e),null}};return{products:l,isLoading:P&&!D&&!g,loadProducts:I,page:u,setPage:m,pageSize:p,setPageSize:f,totalCount:h,createProduct:async t=>{try{if(!e||!b)return null;let r=await (0,i.createProductAction)({...t,userId:e,businessId:b.id});if(!r)return null;return d(e=>[r,...e]),y(e=>e+1),w.invalidateQueries({queryKey:T}),o(w),r}catch(e){return console.error("Error creating product:",e),null}},updateProduct:async(t,r,a,n=!1,s,c,l,d)=>{try{if(!e||!b)return!1;let c=r.imageUrl;if(a&&(c=await R(a)),!await (0,i.updateProductAction)(t,{...r,imageUrl:c,userId:e,businessId:b.id,isFromSale:n,customChangeReason:s,referenceId:l}))return!1;return w.invalidateQueries({queryKey:T}),o(w),!0}catch(e){return console.error("Error updating product:",e),!1}},updateProductsBulk:async(t,r,a,n,s,c)=>{try{if(!e||!b)return!1;let r=await (0,i.updateProductsBulkAction)(t.map(e=>({id:e.id,updated:e.updated})),b.id);return r&&(w.invalidateQueries({queryKey:T}),o(w)),r}catch(e){return console.error("Error in bulk update:",e),!1}},deleteProduct:async t=>{try{if(!e)return!1;if(await (0,i.deleteProductAction)(t))return w.invalidateQueries({queryKey:T}),o(w),!0;return!1}catch(e){return console.error("Error deleting product:",e),!1}},uploadProductImage:R,refetch:M,isFetching:_,filters:S,setFilters:A}}],355879)},286012,e=>{"use strict";var t=e.i(256680);async function r(e){try{return await t.db.activityHistory.create({data:{userId:e.userId,locationId:e.locationId,activityType:e.activityType,module:e.module,entityType:e.entityType,entityId:e.entityId||null,entityName:e.entityName,description:e.description,metadata:e.metadata||null,profileId:e.profileId||null,profileName:e.profileName||null}}),{success:!0}}catch(e){return console.error("Error logging activity:",e),{success:!1,error:e.message}}}async function a(e,r,n=1,s=20,o){try{let a={locationId:e,userId:r};if(o&&(o.activityType&&"ALL"!==o.activityType&&(a.activityType=o.activityType),o.module&&"ALL"!==o.module&&(a.module=o.module),o.search&&(a.OR=[{entityName:{contains:o.search,mode:"insensitive"}},{description:{contains:o.search,mode:"insensitive"}}]),o.dateFrom||o.dateTo)&&(a.createdAt={},o.dateFrom&&(a.createdAt.gte=new Date(o.dateFrom)),o.dateTo)){let e=new Date(o.dateTo);e.setHours(23,59,59,999),a.createdAt.lte=e}let[i,c]=await Promise.all([t.db.activityHistory.findMany({where:a,skip:(n-1)*s,take:s,orderBy:{createdAt:"desc"}}),t.db.activityHistory.count({where:a})]);return{success:!0,data:{activities:i.map(e=>({...e,created_at:e.createdAt.toISOString(),activity_type:e.activityType,location_id:e.locationId,user_id:e.userId,entity_type:e.entityType,entity_id:e.entityId,entity_name:e.entityName,profile_id:e.profileId,profile_name:e.profileName})),count:c}}}catch(e){return console.error("Error fetching activity history:",e),{success:!1,error:e.message}}}e.s(["getActivityHistoryAction",()=>a,"logActivityAction",()=>r])},923850,e=>{"use strict";var t=e.i(824216);e.s(["useCurrentUser",0,()=>{let{user:e}=(0,t.useAuth)();return{userId:e?.id}}])},810686,e=>{"use strict";e.s(["mapDbProductToProduct",0,e=>({id:e.id,itemNumber:e.item_number,barcode:e.barcode,manufacturerBarcode:e.manufacturer_barcode,name:e.name,description:e.description,category:e.category,quantity:e.quantity,costPrice:Number(e.cost_price),sellingPrice:Number(e.selling_price),supplier:e.supplier,imageUrl:e.image_url,minimumStock:e.minimum_stock,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}),"mapDbSaleToSale",0,e=>{let t=(Array.isArray(e.items)?e.items:[]).map(e=>{let t=void 0!==e.discountPercentage?Number(e.discountPercentage):void 0,r=void 0!==e.discountAmount?Number(e.discountAmount):void 0,a=e.discountType;return!a&&(t&&t>0?a="percentage":r&&r>0&&(a="amount")),{description:e.description||"",quantity:Number(e.quantity)||0,price:Number(e.price)||0,cost:Number(e.cost)||0,productId:e.productId||void 0,discountType:a,discountPercentage:t,discountAmount:r,createdAt:e.createdAt||void 0}});return{id:e.id,receiptNumber:e.receipt_number,customerName:e.customer_name,customerAddress:e.customer_address||"",customerContact:e.customer_contact||"",customerId:e.customer_id||void 0,items:t,paymentStatus:e.payment_status,profit:Number(e.profit),date:new Date(e.date),taxRate:e.tax_rate?Number(e.tax_rate):0,cashTransactionId:e.cash_transaction_id||void 0,amountPaid:e.amount_paid?Number(e.amount_paid):void 0,amountDue:e.amount_due?Number(e.amount_due):void 0,notes:e.notes||"",categoryId:e.category_id||void 0,createdAt:new Date(e.created_at)}},"mapSaleToDbSale",0,(e,t,r,a,n,s,o)=>({user_id:n,location_id:s,receipt_number:a,customer_name:e.customerName,customer_address:e.customerAddress||null,customer_contact:e.customerContact||null,customer_id:e.customerId||null,items:e.items,payment_status:e.paymentStatus,profit:r,date:t.toISOString().split("T")[0],tax_rate:e.taxRate||0,cash_transaction_id:o||null,amount_paid:e.amountPaid||null,amount_due:e.amountDue||null,notes:e.notes||null,category_id:e.categoryId||null})])},546462,e=>{"use strict";var t=e.i(286012),r=e.i(923850),a=e.i(46108),n=e.i(638822);e.s(["useActivityLogger",0,()=>{let{userId:e}=(0,r.useCurrentUser)(),{currentBusiness:s}=(0,a.useBusiness)(),o=null;try{let{currentProfile:e}=(0,n.useProfiles)();o=e}catch{o=null}return{logActivity:async r=>{if(!e||!s?.id)return void console.warn("Cannot log activity: missing user or business context");try{let a=await (0,t.logActivityAction)({userId:e,locationId:s.id,activityType:r.activityType,module:r.module,entityType:r.entityType,entityId:r.entityId||void 0,entityName:r.entityName,description:r.description,metadata:r.metadata||void 0,profileId:o?.id||void 0,profileName:o?.profile_name||void 0});a.success||console.error("Error logging activity:",a.error)}catch(e){console.error("Failed to log activity:",e)}}}}])},554913,e=>{"use strict";var t=e.i(355879),r=e.i(679935),a=e.i(8745);e.s(["useInventoryActions",0,e=>{let{updateProductsBulk:n}=(0,t.useProducts)(e),s=async(e,t)=>{if(!e.length)return[];try{return await (0,a.getProductsByIdsAction)(e,t)}catch(e){throw console.error("Error fetching fresh products:",e),e}};return{deductStockForSale:async(t,a,o,i,c)=>{if(!e)return!1;try{let l=t.filter(e=>e.productId);if(0===l.length)return!0;let d=[...new Set(l.map(e=>e.productId))],u=await s(d,c);if(0===u.length)return!1;let m=new Map;for(let e of l){let t=m.get(e.productId)||0;m.set(e.productId,t+e.quantity)}let p=[];for(let[e,t]of m.entries()){let a=u.find(t=>t.id===e);if(!a)continue;let n=a.quantity-t;p.push({id:e,updated:{...a,quantity:n}}),n<0&&r.toast.warning(`${a.name} inventory is now negative (${n}). Please restock soon.`)}return p.length>0&&await n(p,e,"Sale",a,o,i),!0}catch(e){return console.error("Error deducting stock for sale:",e),!1}},restoreStockForSale:async(t,r,a,o)=>{if(!e)return!1;try{let i=t.filter(e=>e.productId);if(0===i.length)return!0;let c=[...new Set(i.map(e=>e.productId))],l=await s(c,o),d=new Map;for(let e of i){let t=d.get(e.productId)||0;d.set(e.productId,t+e.quantity)}let u=[];for(let[e,t]of d.entries()){let r=l.find(t=>t.id===e);if(!r)continue;let a=r.quantity+t;u.push({id:e,updated:{...r,quantity:a}})}return u.length>0&&await n(u,e,"Deleted Sale",r,void 0,a),!0}catch(e){return console.error("Error restoring stock for sale:",e),!1}},adjustStockForEditedSale:async(t,a,o,i,c,l)=>{if(!e)return!1;try{let d=[...t.filter(e=>e.productId).map(e=>e.productId),...a.filter(e=>e.productId).map(e=>e.productId)],u=[...new Set(d)];if(0===u.length)return!0;let m=await s(u,l),p=new Map;for(let e of t.filter(e=>e.productId)){let t=p.get(e.productId)||0;p.set(e.productId,t+e.quantity)}for(let e of a.filter(e=>e.productId)){let t=p.get(e.productId)||0;p.set(e.productId,t-e.quantity)}let f=[];for(let[e,t]of p.entries()){if(0===t)continue;let a=m.find(t=>t.id===e);if(!a)continue;let n=a.quantity+t;f.push({id:e,updated:{...a,quantity:n}}),n<0&&r.toast.warning(`${a.name} inventory is now negative (${n}). Please restock soon.`)}return f.length>0&&await n(f,e,"Sale Status/Qty Edit",o,i,c),!0}catch(e){return console.error("Error adjusting stock for edited sale:",e),!1}}}}])},873015,e=>{"use strict";var t=e.i(256680),r=e.i(290205);async function a(e,r="desc",n){try{let a={where:{branchId:e},orderBy:{createdAt:r},include:{cashTransaction:!0}};return n&&n>0&&(a.take=n),(await t.db.sale.findMany(a)).map(e=>({id:e.id,user_id:e.userId,location_id:e.branchId,receipt_number:e.saleNumber,customer_name:e.customerName,customer_address:e.customerAddress,customer_contact:e.customerPhone,customer_id:e.customerId,items:e.items,payment_status:e.paymentStatus,profit:0,date:e.date.toISOString(),tax_rate:e.taxRate?Number(e.taxRate):0,created_at:e.createdAt.toISOString(),updated_at:e.updatedAt.toISOString(),cash_transaction_id:e.cashTransactionId,amount_paid:Number(e.amountPaid),amount_due:Number(e.balance),category_id:e.categoryId,notes:e.notes}))}catch(e){return console.error("Error fetching sales:",e),[]}}async function n(e,r){try{let a=await t.db.sale.findUnique({where:{id:e},include:{cashTransaction:!0,installmentPayments:!0}});if(!a||a.branchId!==r)return{success:!1,error:"Sale not found or unauthorized"};return await t.db.$transaction(async t=>{await t.installmentPayment.deleteMany({where:{saleId:e}}),a.cashTransactionId&&await t.cashTransaction.delete({where:{id:a.cashTransactionId}}),await t.sale.delete({where:{id:e}})}),{success:!0,sale:{receiptNumber:a.saleNumber,customerName:a.customerName,customerAddress:a.customerAddress,customerContact:a.customerPhone,paymentStatus:a.paymentStatus,cashTransactionId:a.cashTransactionId,items:a.items,amountPaid:Number(a.amountPaid),amountDue:Number(a.balance),profit:0,taxRate:Number(a.taxRate),notes:a.notes}}}catch(e){return console.error("Error deleting sale:",e),{success:!1,error:e.message||"Failed to delete sale"}}}async function s(e,r,a){try{let n=e.payment_status;"NOT PAID"===n?n="UNPAID":"Installment Sale"===n?n="INSTALLMENT":"Paid"===n?n="PAID":"Quote"===n&&(n="QUOTE");let s={userId:e.user_id,branchId:e.location_id,saleNumber:e.receipt_number,customerName:e.customer_name,customerAddress:e.customer_address,customerPhone:e.customer_contact,customerId:e.customer_id,items:e.items,paymentStatus:n,date:new Date(e.date),taxRate:e.tax_rate,cashTransactionId:e.cash_transaction_id,amountPaid:e.amount_paid,balance:e.amount_due,categoryId:e.category_id,notes:e.notes,subtotal:0,total:0};if(r&&a){let e=await t.db.sale.update({where:{id:a},data:s});return{success:!0,data:e}}{let e=await t.db.sale.create({data:s});return{success:!0,data:e}}}catch(e){return console.error("Error upserting sale:",e),{success:!1,error:e.message||"Failed to preserve sale"}}}async function o(e){try{let r=await t.db.saleCategory.findMany({where:{branchId:e},orderBy:{name:"asc"}});return{success:!0,data:r}}catch(e){return console.error("Error fetching sales categories:",e),{success:!1,error:e.message}}}async function i(e,a,n,s=!1){try{let o=await t.db.saleCategory.create({data:{branchId:e,userId:a,name:n,is_default:s}});return(0,r.revalidatePath)("/sales"),{success:!0,data:o}}catch(e){return console.error("Error creating sales category:",e),{success:!1,error:e.message}}}async function c(e,a){try{let n=await t.db.saleCategory.update({where:{id:e},data:{name:a}});return(0,r.revalidatePath)("/sales"),{success:!0,data:n}}catch(e){return console.error("Error updating sales category:",e),{success:!1,error:e.message}}}async function l(e){try{return await t.db.saleCategory.delete({where:{id:e}}),(0,r.revalidatePath)("/sales"),{success:!0}}catch(e){return console.error("Error deleting sales category:",e),{success:!1,error:e.message}}}async function d(e,r){if(!e||!r)return null;try{return await t.db.customer.findFirst({where:{branchId:e,name:{contains:r,mode:"insensitive"}},select:{id:!0,name:!0}})}catch(e){return console.error("Error looking up customer by name:",e),null}}async function u(e,r){try{return await t.db.sale.update({where:{id:e},data:{customerId:r}}),{success:!0}}catch(e){return console.error("Error updating sale customer:",e),{success:!1,error:e.message}}}async function n(e){try{return await t.db.sale.delete({where:{id:e}}),(0,r.revalidatePath)("/sales"),!0}catch(e){return console.error("Error deleting sale:",e),!1}}e.s(["createSalesCategoryAction",()=>i,"deleteSaleAction",()=>n,"deleteSalesCategoryAction",()=>l,"getCustomerByNameAction",()=>d,"getSalesAction",()=>a,"getSalesCategoriesAction",()=>o,"updateSaleCustomerAction",()=>u,"updateSalesCategoryAction",()=>c,"upsertSaleAction",()=>s])},852577,e=>{"use strict";var t=e.i(191788),r=e.i(810686),a=e.i(150064),n=e.i(893930),s=e.i(285700),o=e.i(546462),i=e.i(46108),c=e.i(554913),l=e.i(775778),d=e.i(873015);e.s(["useSalesData",0,(e,u="desc",m)=>{let p=(0,s.useQueryClient)(),{toast:f}=(0,a.useToast)(),{logActivity:h}=(0,o.useActivityLogger)(),{currentBusiness:y}=(0,i.useBusiness)(),{restoreStockForSale:g}=(0,c.useInventoryActions)(e),v=(0,t.useCallback)(async()=>{try{if(!e||!y)return[];let t=await (0,d.getSalesAction)(y.id,u,m);return t?t.map(e=>{let t={id:e.id,user_id:e.user_id,location_id:e.location_id,receipt_number:e.receipt_number,customer_name:e.customer_name,customer_address:e.customer_address,customer_contact:e.customer_contact,customer_id:e.customer_id,items:e.items,payment_status:e.payment_status,profit:e.profit?Number(e.profit):0,date:e.date,tax_rate:e.tax_rate||0,created_at:e.created_at,updated_at:e.updated_at,cash_transaction_id:e.cash_transaction_id,amount_paid:e.amount_paid?Number(e.amount_paid):void 0,amount_due:e.amount_due?Number(e.amount_due):void 0,category_id:e.category_id,notes:e.notes};return(0,r.mapDbSaleToSale)(t)}):[]}catch(e){return console.error("Error loading sales:",e),f({title:"Error",description:"Failed to load sales data. Please try again.",variant:"destructive"}),[]}},[e,y?.id,u,m,f]),x=(0,t.useMemo)(()=>["sales",y?.id,e],[y?.id,e]),b=(0,t.useMemo)(()=>[...x,u,m],[x,u,m]),{data:w=[],isLoading:S,isFetching:C,refetch:j}=(0,n.useQuery)({queryKey:b,queryFn:v,enabled:!!e&&!!y?.id,staleTime:3e4,gcTime:18e5,refetchOnWindowFocus:!0,refetchOnReconnect:!0}),N=S||C&&0===w.length,A=(0,t.useMemo)(()=>{let e=w.filter(e=>"Quote"!==e.paymentStatus),t=new Map;return e.forEach(e=>{let r=e.customerName,a=e.items.reduce((e,t)=>e+t.price*t.quantity,0);if(t.has(r)){let n=t.get(r);t.set(r,{total:n.total+a,count:n.count+1,customerId:n.customerId||e.customerId})}else t.set(r,{total:a,count:1,customerId:e.customerId})}),Array.from(t.entries()).map(([e,t])=>({id:t.customerId,name:e,totalPurchases:t.total,orderCount:t.count})).sort((e,t)=>t.totalPurchases-e.totalPurchases)},[w]),I=(0,t.useMemo)(()=>e=>{let t=w.filter(t=>t.customerName.toLowerCase()===e.toLowerCase()&&"Quote"!==t.paymentStatus);return{total:t.reduce((e,t)=>e+t.items.reduce((e,t)=>e+t.price*t.quantity,0),0),count:t.length}},[w]),T=async e=>{try{let t=w.find(t=>t.id===e);if(!t)throw Error("Sale not found");if("Quote"!==t.paymentStatus&&t.items.length>0&&(console.log("Restoring product quantities via useInventoryActions..."),await g(t.items,e,t.receiptNumber,y?.id)||f({title:"Inventory Update Warning",description:"Sale deleted, but inventory restoration might have failed. Please check your stock levels.",variant:"destructive"})),!y?.id)throw Error("Business context missing for deletion");let r=await (0,d.deleteSaleAction)(e,y.id);if(!r.success)throw Error(r.error);return p.setQueryData(b,t=>t?t.filter(t=>t.id!==e):[]),p.invalidateQueries({queryKey:x}),E(),await h({activityType:"DELETE",module:"SALES",entityType:"sale",entityId:e,entityName:`Sale #${t.receiptNumber}`,description:`Deleted sale for ${t.customerName} - Total: UGX ${((t.amountPaid||0)+(t.amountDue||0)).toLocaleString()} (Stock restored)`,metadata:{receiptNumber:t.receiptNumber,customerName:t.customerName,customerAddress:t.customerAddress,customerContact:t.customerContact,totalAmount:(t.amountPaid||0)+(t.amountDue||0),amountPaid:t.amountPaid,profit:t.profit,paymentStatus:t.paymentStatus,taxRate:t.taxRate,itemCount:t.items.length,items:t.items.map(e=>({description:e.description,quantity:e.quantity,price:e.price,cost:e.cost,total:e.quantity*e.price,discountPercentage:e.discountPercentage,discountAmount:e.discountAmount})),notes:t.notes,cashTransactionDeleted:!!t.cashTransactionId}}),f({title:"Sale Deleted",description:"The sale record and associated data have been successfully deleted."}),(0,l.clearInventoryCaches)(),!0}catch(e){return console.error("Error deleting sale:",e),f({title:"Error",description:"Failed to delete sale. Please try again.",variant:"destructive"}),!1}},E=(0,t.useCallback)(()=>{if(!y?.id)return;let e=`soldItemsFilters_${y.id}`;localStorage.removeItem(e),localStorage.removeItem("soldItemsFilters")},[y?.id]);return{sales:w,isLoading:N,deleteSale:T,addSale:(0,t.useCallback)(e=>{p.setQueryData(b,t=>t?[e,...t]:[e]),p.invalidateQueries({queryKey:x}),E(),(0,l.clearInventoryCaches)()},[p,b,x,E,l.clearInventoryCaches]),updateSale:(0,t.useCallback)(e=>{p.setQueryData(b,t=>t?t.map(t=>t.id===e.id?e:t):[e]),p.invalidateQueries({queryKey:x}),E(),(0,l.clearInventoryCaches)()},[p,b,x,E,l.clearInventoryCaches]),getTopCustomers:A,getCustomerLifetimePurchases:I,clearSoldItemsCache:E,refetch:j,isFetching:C}}])},649086,e=>{"use strict";let t=(0,e.i(369547).default)("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]);e.s(["Wallet",()=>t],649086)},831395,e=>{"use strict";let t,r,a;var n=e.i(391398),s=e.i(191788),o=e.i(671185),i=e.i(357006),c=e.i(479293),l=e.i(55037),d=e.i(674534),u=e.i(352162),m=e.i(724537),p=e.i(64899),f=e.i(908525),h=e.i(592893),y=e.i(64592),g=e.i(746359),v=e.i(437767),x=e.i(993953),b=e.i(221498),w=Symbol("radix.slottable");function S(e){return s.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===w}var C=e.i(998657),j=e.i(369131),N=e.i(865823),A=["Enter"," "],I=["ArrowUp","PageDown","End"],T=["ArrowDown","PageUp","Home",...I],E={ltr:[...A,"ArrowRight"],rtl:[...A,"ArrowLeft"]},D={ltr:["ArrowLeft"],rtl:["ArrowRight"]},P="Menu",[_,M,R]=(0,u.createCollection)(P),[k,O]=(0,c.createContextScope)(P,[R,g.createPopperScope,b.createRovingFocusGroupScope]),F=(0,g.createPopperScope)(),L=(0,b.createRovingFocusGroupScope)(),[B,H]=k(P),[$,Q]=k(P),q=e=>{let{__scopeMenu:t,open:r=!1,children:a,dir:o,onOpenChange:i,modal:c=!0}=e,l=F(t),[d,u]=s.useState(null),p=s.useRef(!1),f=(0,C.useCallbackRef)(i),h=(0,m.useDirection)(o);return s.useEffect(()=>{let e=()=>{p.current=!0,document.addEventListener("pointerdown",t,{capture:!0,once:!0}),document.addEventListener("pointermove",t,{capture:!0,once:!0})},t=()=>p.current=!1;return document.addEventListener("keydown",e,{capture:!0}),()=>{document.removeEventListener("keydown",e,{capture:!0}),document.removeEventListener("pointerdown",t,{capture:!0}),document.removeEventListener("pointermove",t,{capture:!0})}},[]),(0,n.jsx)(g.Root,{...l,children:(0,n.jsx)(B,{scope:t,open:r,onOpenChange:f,content:d,onContentChange:u,children:(0,n.jsx)($,{scope:t,onClose:s.useCallback(()=>f(!1),[f]),isUsingKeyboardRef:p,dir:h,modal:c,children:a})})})};q.displayName=P;var U=s.forwardRef((e,t)=>{let{__scopeMenu:r,...a}=e,s=F(r);return(0,n.jsx)(g.Anchor,{...s,...a,ref:t})});U.displayName="MenuAnchor";var K="MenuPortal",[z,G]=k(K,{forceMount:void 0}),W=e=>{let{__scopeMenu:t,forceMount:r,children:a,container:s}=e,o=H(K,t);return(0,n.jsx)(z,{scope:t,forceMount:r,children:(0,n.jsx)(x.Presence,{present:r||o.open,children:(0,n.jsx)(v.Portal,{asChild:!0,container:s,children:a})})})};W.displayName=K;var V="MenuContent",[X,Y]=k(V),Z=s.forwardRef((e,t)=>{let r=G(V,e.__scopeMenu),{forceMount:a=r.forceMount,...s}=e,o=H(V,e.__scopeMenu),i=Q(V,e.__scopeMenu);return(0,n.jsx)(_.Provider,{scope:e.__scopeMenu,children:(0,n.jsx)(x.Presence,{present:a||o.open,children:(0,n.jsx)(_.Slot,{scope:e.__scopeMenu,children:i.modal?(0,n.jsx)(J,{...s,ref:t}):(0,n.jsx)(ee,{...s,ref:t})})})})}),J=s.forwardRef((e,t)=>{let r=H(V,e.__scopeMenu),a=s.useRef(null),c=(0,i.useComposedRefs)(t,a);return s.useEffect(()=>{let e=a.current;if(e)return(0,j.hideOthers)(e)},[]),(0,n.jsx)(er,{...e,ref:c,trapFocus:r.open,disableOutsidePointerEvents:r.open,disableOutsideScroll:!0,onFocusOutside:(0,o.composeEventHandlers)(e.onFocusOutside,e=>e.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>r.onOpenChange(!1)})}),ee=s.forwardRef((e,t)=>{let r=H(V,e.__scopeMenu);return(0,n.jsx)(er,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>r.onOpenChange(!1)})}),et=((a=s.forwardRef((e,t)=>{let{children:r,...a}=e;if(s.isValidElement(r)){var n;let e,o,c=(n=r,(o=(e=Object.getOwnPropertyDescriptor(n.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?n.ref:(o=(e=Object.getOwnPropertyDescriptor(n,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?n.props.ref:n.props.ref||n.ref),l=function(e,t){let r={...t};for(let a in t){let n=e[a],s=t[a];/^on[A-Z]/.test(a)?n&&s?r[a]=(...e)=>{let t=s(...e);return n(...e),t}:n&&(r[a]=n):"style"===a?r[a]={...n,...s}:"className"===a&&(r[a]=[n,s].filter(Boolean).join(" "))}return{...e,...r}}(a,r.props);return r.type!==s.Fragment&&(l.ref=t?(0,i.composeRefs)(t,c):c),s.cloneElement(r,l)}return s.Children.count(r)>1?s.Children.only(null):null})).displayName="MenuContent.ScrollLock.SlotClone",t=a,(r=s.forwardRef((e,r)=>{let{children:a,...o}=e,i=s.Children.toArray(a),c=i.find(S);if(c){let e=c.props.children,a=i.map(t=>t!==c?t:s.Children.count(e)>1?s.Children.only(null):s.isValidElement(e)?e.props.children:null);return(0,n.jsx)(t,{...o,ref:r,children:s.isValidElement(e)?s.cloneElement(e,void 0,a):null})}return(0,n.jsx)(t,{...o,ref:r,children:a})})).displayName="MenuContent.ScrollLock.Slot",r),er=s.forwardRef((e,t)=>{let{__scopeMenu:r,loop:a=!1,trapFocus:c,onOpenAutoFocus:l,onCloseAutoFocus:d,disableOutsidePointerEvents:u,onEntryFocus:m,onEscapeKeyDown:y,onPointerDownOutside:v,onFocusOutside:x,onInteractOutside:w,onDismiss:S,disableOutsideScroll:C,...j}=e,A=H(V,r),E=Q(V,r),D=F(r),P=L(r),_=M(r),[R,k]=s.useState(null),O=s.useRef(null),B=(0,i.useComposedRefs)(t,O,A.onContentChange),$=s.useRef(0),q=s.useRef(""),U=s.useRef(0),K=s.useRef(null),z=s.useRef("right"),G=s.useRef(0),W=C?N.RemoveScroll:s.Fragment;s.useEffect(()=>()=>window.clearTimeout($.current),[]),(0,f.useFocusGuards)();let Y=s.useCallback(e=>{var t,r;return z.current===K.current?.side&&(t=e,!!(r=K.current?.area)&&function(e,t){let{x:r,y:a}=e,n=!1;for(let e=0,s=t.length-1;e<t.length;s=e++){let o=t[e],i=t[s],c=o.x,l=o.y,d=i.x,u=i.y;l>a!=u>a&&r<(d-c)*(a-l)/(u-l)+c&&(n=!n)}return n}({x:t.clientX,y:t.clientY},r))},[]);return(0,n.jsx)(X,{scope:r,searchRef:q,onItemEnter:s.useCallback(e=>{Y(e)&&e.preventDefault()},[Y]),onItemLeave:s.useCallback(e=>{Y(e)||(O.current?.focus(),k(null))},[Y]),onTriggerLeave:s.useCallback(e=>{Y(e)&&e.preventDefault()},[Y]),pointerGraceTimerRef:U,onPointerGraceIntentChange:s.useCallback(e=>{K.current=e},[]),children:(0,n.jsx)(W,{...C?{as:et,allowPinchZoom:!0}:void 0,children:(0,n.jsx)(h.FocusScope,{asChild:!0,trapped:c,onMountAutoFocus:(0,o.composeEventHandlers)(l,e=>{e.preventDefault(),O.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:d,children:(0,n.jsx)(p.DismissableLayer,{asChild:!0,disableOutsidePointerEvents:u,onEscapeKeyDown:y,onPointerDownOutside:v,onFocusOutside:x,onInteractOutside:w,onDismiss:S,children:(0,n.jsx)(b.Root,{asChild:!0,...P,dir:E.dir,orientation:"vertical",loop:a,currentTabStopId:R,onCurrentTabStopIdChange:k,onEntryFocus:(0,o.composeEventHandlers)(m,e=>{E.isUsingKeyboardRef.current||e.preventDefault()}),preventScrollOnEntryFocus:!0,children:(0,n.jsx)(g.Content,{role:"menu","aria-orientation":"vertical","data-state":eT(A.open),"data-radix-menu-content":"",dir:E.dir,...D,...j,ref:B,style:{outline:"none",...j.style},onKeyDown:(0,o.composeEventHandlers)(j.onKeyDown,e=>{let t=e.target.closest("[data-radix-menu-content]")===e.currentTarget,r=e.ctrlKey||e.altKey||e.metaKey,a=1===e.key.length;if(t){var n;let t,s,o,i,c,l;"Tab"===e.key&&e.preventDefault(),!r&&a&&(n=e.key,t=q.current+n,s=_().filter(e=>!e.disabled),o=document.activeElement,i=s.find(e=>e.ref.current===o)?.textValue,c=function(e,t,r){var a;let n=t.length>1&&Array.from(t).every(e=>e===t[0])?t[0]:t,s=r?e.indexOf(r):-1,o=(a=Math.max(s,0),e.map((t,r)=>e[(a+r)%e.length]));1===n.length&&(o=o.filter(e=>e!==r));let i=o.find(e=>e.toLowerCase().startsWith(n.toLowerCase()));return i!==r?i:void 0}(s.map(e=>e.textValue),t,i),l=s.find(e=>e.textValue===c)?.ref.current,function e(t){q.current=t,window.clearTimeout($.current),""!==t&&($.current=window.setTimeout(()=>e(""),1e3))}(t),l&&setTimeout(()=>l.focus()))}let s=O.current;if(e.target!==s||!T.includes(e.key))return;e.preventDefault();let o=_().filter(e=>!e.disabled).map(e=>e.ref.current);I.includes(e.key)&&o.reverse(),function(e){let t=document.activeElement;for(let r of e)if(r===t||(r.focus(),document.activeElement!==t))return}(o)}),onBlur:(0,o.composeEventHandlers)(e.onBlur,e=>{e.currentTarget.contains(e.target)||(window.clearTimeout($.current),q.current="")}),onPointerMove:(0,o.composeEventHandlers)(e.onPointerMove,eP(e=>{let t=e.target,r=G.current!==e.clientX;e.currentTarget.contains(t)&&r&&(z.current=e.clientX>G.current?"right":"left",G.current=e.clientX)}))})})})})})})});Z.displayName=V;var ea=s.forwardRef((e,t)=>{let{__scopeMenu:r,...a}=e;return(0,n.jsx)(d.Primitive.div,{role:"group",...a,ref:t})});ea.displayName="MenuGroup";var en=s.forwardRef((e,t)=>{let{__scopeMenu:r,...a}=e;return(0,n.jsx)(d.Primitive.div,{...a,ref:t})});en.displayName="MenuLabel";var es="MenuItem",eo="menu.itemSelect",ei=s.forwardRef((e,t)=>{let{disabled:r=!1,onSelect:a,...c}=e,l=s.useRef(null),u=Q(es,e.__scopeMenu),m=Y(es,e.__scopeMenu),p=(0,i.useComposedRefs)(t,l),f=s.useRef(!1);return(0,n.jsx)(ec,{...c,ref:p,disabled:r,onClick:(0,o.composeEventHandlers)(e.onClick,()=>{let e=l.current;if(!r&&e){let t=new CustomEvent(eo,{bubbles:!0,cancelable:!0});e.addEventListener(eo,e=>a?.(e),{once:!0}),(0,d.dispatchDiscreteCustomEvent)(e,t),t.defaultPrevented?f.current=!1:u.onClose()}}),onPointerDown:t=>{e.onPointerDown?.(t),f.current=!0},onPointerUp:(0,o.composeEventHandlers)(e.onPointerUp,e=>{f.current||e.currentTarget?.click()}),onKeyDown:(0,o.composeEventHandlers)(e.onKeyDown,e=>{let t=""!==m.searchRef.current;r||t&&" "===e.key||A.includes(e.key)&&(e.currentTarget.click(),e.preventDefault())})})});ei.displayName=es;var ec=s.forwardRef((e,t)=>{let{__scopeMenu:r,disabled:a=!1,textValue:c,...l}=e,u=Y(es,r),m=L(r),p=s.useRef(null),f=(0,i.useComposedRefs)(t,p),[h,y]=s.useState(!1),[g,v]=s.useState("");return s.useEffect(()=>{let e=p.current;e&&v((e.textContent??"").trim())},[l.children]),(0,n.jsx)(_.ItemSlot,{scope:r,disabled:a,textValue:c??g,children:(0,n.jsx)(b.Item,{asChild:!0,...m,focusable:!a,children:(0,n.jsx)(d.Primitive.div,{role:"menuitem","data-highlighted":h?"":void 0,"aria-disabled":a||void 0,"data-disabled":a?"":void 0,...l,ref:f,onPointerMove:(0,o.composeEventHandlers)(e.onPointerMove,eP(e=>{a?u.onItemLeave(e):(u.onItemEnter(e),e.defaultPrevented||e.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:(0,o.composeEventHandlers)(e.onPointerLeave,eP(e=>u.onItemLeave(e))),onFocus:(0,o.composeEventHandlers)(e.onFocus,()=>y(!0)),onBlur:(0,o.composeEventHandlers)(e.onBlur,()=>y(!1))})})})}),el=s.forwardRef((e,t)=>{let{checked:r=!1,onCheckedChange:a,...s}=e;return(0,n.jsx)(eg,{scope:e.__scopeMenu,checked:r,children:(0,n.jsx)(ei,{role:"menuitemcheckbox","aria-checked":eE(r)?"mixed":r,...s,ref:t,"data-state":eD(r),onSelect:(0,o.composeEventHandlers)(s.onSelect,()=>a?.(!!eE(r)||!r),{checkForDefaultPrevented:!1})})})});el.displayName="MenuCheckboxItem";var ed="MenuRadioGroup",[eu,em]=k(ed,{value:void 0,onValueChange:()=>{}}),ep=s.forwardRef((e,t)=>{let{value:r,onValueChange:a,...s}=e,o=(0,C.useCallbackRef)(a);return(0,n.jsx)(eu,{scope:e.__scopeMenu,value:r,onValueChange:o,children:(0,n.jsx)(ea,{...s,ref:t})})});ep.displayName=ed;var ef="MenuRadioItem",eh=s.forwardRef((e,t)=>{let{value:r,...a}=e,s=em(ef,e.__scopeMenu),i=r===s.value;return(0,n.jsx)(eg,{scope:e.__scopeMenu,checked:i,children:(0,n.jsx)(ei,{role:"menuitemradio","aria-checked":i,...a,ref:t,"data-state":eD(i),onSelect:(0,o.composeEventHandlers)(a.onSelect,()=>s.onValueChange?.(r),{checkForDefaultPrevented:!1})})})});eh.displayName=ef;var ey="MenuItemIndicator",[eg,ev]=k(ey,{checked:!1}),ex=s.forwardRef((e,t)=>{let{__scopeMenu:r,forceMount:a,...s}=e,o=ev(ey,r);return(0,n.jsx)(x.Presence,{present:a||eE(o.checked)||!0===o.checked,children:(0,n.jsx)(d.Primitive.span,{...s,ref:t,"data-state":eD(o.checked)})})});ex.displayName=ey;var eb=s.forwardRef((e,t)=>{let{__scopeMenu:r,...a}=e;return(0,n.jsx)(d.Primitive.div,{role:"separator","aria-orientation":"horizontal",...a,ref:t})});eb.displayName="MenuSeparator";var ew=s.forwardRef((e,t)=>{let{__scopeMenu:r,...a}=e,s=F(r);return(0,n.jsx)(g.Arrow,{...s,...a,ref:t})});ew.displayName="MenuArrow";var[eS,eC]=k("MenuSub"),ej="MenuSubTrigger",eN=s.forwardRef((e,t)=>{let r=H(ej,e.__scopeMenu),a=Q(ej,e.__scopeMenu),c=eC(ej,e.__scopeMenu),l=Y(ej,e.__scopeMenu),d=s.useRef(null),{pointerGraceTimerRef:u,onPointerGraceIntentChange:m}=l,p={__scopeMenu:e.__scopeMenu},f=s.useCallback(()=>{d.current&&window.clearTimeout(d.current),d.current=null},[]);return s.useEffect(()=>f,[f]),s.useEffect(()=>{let e=u.current;return()=>{window.clearTimeout(e),m(null)}},[u,m]),(0,n.jsx)(U,{asChild:!0,...p,children:(0,n.jsx)(ec,{id:c.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":c.contentId,"data-state":eT(r.open),...e,ref:(0,i.composeRefs)(t,c.onTriggerChange),onClick:t=>{e.onClick?.(t),e.disabled||t.defaultPrevented||(t.currentTarget.focus(),r.open||r.onOpenChange(!0))},onPointerMove:(0,o.composeEventHandlers)(e.onPointerMove,eP(t=>{l.onItemEnter(t),!t.defaultPrevented&&(e.disabled||r.open||d.current||(l.onPointerGraceIntentChange(null),d.current=window.setTimeout(()=>{r.onOpenChange(!0),f()},100)))})),onPointerLeave:(0,o.composeEventHandlers)(e.onPointerLeave,eP(e=>{f();let t=r.content?.getBoundingClientRect();if(t){let a=r.content?.dataset.side,n="right"===a,s=t[n?"left":"right"],o=t[n?"right":"left"];l.onPointerGraceIntentChange({area:[{x:e.clientX+(n?-5:5),y:e.clientY},{x:s,y:t.top},{x:o,y:t.top},{x:o,y:t.bottom},{x:s,y:t.bottom}],side:a}),window.clearTimeout(u.current),u.current=window.setTimeout(()=>l.onPointerGraceIntentChange(null),300)}else{if(l.onTriggerLeave(e),e.defaultPrevented)return;l.onPointerGraceIntentChange(null)}})),onKeyDown:(0,o.composeEventHandlers)(e.onKeyDown,t=>{let n=""!==l.searchRef.current;e.disabled||n&&" "===t.key||E[a.dir].includes(t.key)&&(r.onOpenChange(!0),r.content?.focus(),t.preventDefault())})})})});eN.displayName=ej;var eA="MenuSubContent",eI=s.forwardRef((e,t)=>{let r=G(V,e.__scopeMenu),{forceMount:a=r.forceMount,...c}=e,l=H(V,e.__scopeMenu),d=Q(V,e.__scopeMenu),u=eC(eA,e.__scopeMenu),m=s.useRef(null),p=(0,i.useComposedRefs)(t,m);return(0,n.jsx)(_.Provider,{scope:e.__scopeMenu,children:(0,n.jsx)(x.Presence,{present:a||l.open,children:(0,n.jsx)(_.Slot,{scope:e.__scopeMenu,children:(0,n.jsx)(er,{id:u.contentId,"aria-labelledby":u.triggerId,...c,ref:p,align:"start",side:"rtl"===d.dir?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:e=>{d.isUsingKeyboardRef.current&&m.current?.focus(),e.preventDefault()},onCloseAutoFocus:e=>e.preventDefault(),onFocusOutside:(0,o.composeEventHandlers)(e.onFocusOutside,e=>{e.target!==u.trigger&&l.onOpenChange(!1)}),onEscapeKeyDown:(0,o.composeEventHandlers)(e.onEscapeKeyDown,e=>{d.onClose(),e.preventDefault()}),onKeyDown:(0,o.composeEventHandlers)(e.onKeyDown,e=>{let t=e.currentTarget.contains(e.target),r=D[d.dir].includes(e.key);t&&r&&(l.onOpenChange(!1),u.trigger?.focus(),e.preventDefault())})})})})})});function eT(e){return e?"open":"closed"}function eE(e){return"indeterminate"===e}function eD(e){return eE(e)?"indeterminate":e?"checked":"unchecked"}function eP(e){return t=>"mouse"===t.pointerType?e(t):void 0}eI.displayName=eA;var e_="DropdownMenu",[eM,eR]=(0,c.createContextScope)(e_,[O]),ek=O(),[eO,eF]=eM(e_),eL=e=>{let{__scopeDropdownMenu:t,children:r,dir:a,open:o,defaultOpen:i,onOpenChange:c,modal:d=!0}=e,u=ek(t),m=s.useRef(null),[p,f]=(0,l.useControllableState)({prop:o,defaultProp:i??!1,onChange:c,caller:e_});return(0,n.jsx)(eO,{scope:t,triggerId:(0,y.useId)(),triggerRef:m,contentId:(0,y.useId)(),open:p,onOpenChange:f,onOpenToggle:s.useCallback(()=>f(e=>!e),[f]),modal:d,children:(0,n.jsx)(q,{...u,open:p,onOpenChange:f,dir:a,modal:d,children:r})})};eL.displayName=e_;var eB="DropdownMenuTrigger",eH=s.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,disabled:a=!1,...s}=e,c=eF(eB,r),l=ek(r);return(0,n.jsx)(U,{asChild:!0,...l,children:(0,n.jsx)(d.Primitive.button,{type:"button",id:c.triggerId,"aria-haspopup":"menu","aria-expanded":c.open,"aria-controls":c.open?c.contentId:void 0,"data-state":c.open?"open":"closed","data-disabled":a?"":void 0,disabled:a,...s,ref:(0,i.composeRefs)(t,c.triggerRef),onPointerDown:(0,o.composeEventHandlers)(e.onPointerDown,e=>{!a&&0===e.button&&!1===e.ctrlKey&&(c.onOpenToggle(),c.open||e.preventDefault())}),onKeyDown:(0,o.composeEventHandlers)(e.onKeyDown,e=>{!a&&(["Enter"," "].includes(e.key)&&c.onOpenToggle(),"ArrowDown"===e.key&&c.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(e.key)&&e.preventDefault())})})})});eH.displayName=eB;var e$=e=>{let{__scopeDropdownMenu:t,...r}=e,a=ek(t);return(0,n.jsx)(W,{...a,...r})};e$.displayName="DropdownMenuPortal";var eQ="DropdownMenuContent",eq=s.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...a}=e,i=eF(eQ,r),c=ek(r),l=s.useRef(!1);return(0,n.jsx)(Z,{id:i.contentId,"aria-labelledby":i.triggerId,...c,...a,ref:t,onCloseAutoFocus:(0,o.composeEventHandlers)(e.onCloseAutoFocus,e=>{l.current||i.triggerRef.current?.focus(),l.current=!1,e.preventDefault()}),onInteractOutside:(0,o.composeEventHandlers)(e.onInteractOutside,e=>{let t=e.detail.originalEvent,r=0===t.button&&!0===t.ctrlKey,a=2===t.button||r;(!i.modal||a)&&(l.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});eq.displayName=eQ,s.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...a}=e,s=ek(r);return(0,n.jsx)(ea,{...s,...a,ref:t})}).displayName="DropdownMenuGroup";var eU=s.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...a}=e,s=ek(r);return(0,n.jsx)(en,{...s,...a,ref:t})});eU.displayName="DropdownMenuLabel";var eK=s.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...a}=e,s=ek(r);return(0,n.jsx)(ei,{...s,...a,ref:t})});eK.displayName="DropdownMenuItem";var ez=s.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...a}=e,s=ek(r);return(0,n.jsx)(el,{...s,...a,ref:t})});ez.displayName="DropdownMenuCheckboxItem",s.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...a}=e,s=ek(r);return(0,n.jsx)(ep,{...s,...a,ref:t})}).displayName="DropdownMenuRadioGroup";var eG=s.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...a}=e,s=ek(r);return(0,n.jsx)(eh,{...s,...a,ref:t})});eG.displayName="DropdownMenuRadioItem";var eW=s.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...a}=e,s=ek(r);return(0,n.jsx)(ex,{...s,...a,ref:t})});eW.displayName="DropdownMenuItemIndicator";var eV=s.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...a}=e,s=ek(r);return(0,n.jsx)(eb,{...s,...a,ref:t})});eV.displayName="DropdownMenuSeparator",s.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...a}=e,s=ek(r);return(0,n.jsx)(ew,{...s,...a,ref:t})}).displayName="DropdownMenuArrow";var eX=s.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...a}=e,s=ek(r);return(0,n.jsx)(eN,{...s,...a,ref:t})});eX.displayName="DropdownMenuSubTrigger";var eY=s.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...a}=e,s=ek(r);return(0,n.jsx)(eI,{...s,...a,ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});eY.displayName="DropdownMenuSubContent";var eZ=e.i(770084),eJ=e.i(721614);let e0=(0,e.i(369547).default)("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);var e1=e.i(353533);s.forwardRef(({className:e,inset:t,children:r,...a},s)=>{let o=e=>{e.stopPropagation()};return(0,n.jsxs)(eX,{ref:s,className:(0,e1.cn)("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",t&&"pl-8",e),onTouchStart:o,onTouchEnd:o,onTouchMove:o,...a,children:[r,(0,n.jsx)(eJ.ChevronRight,{className:"ml-auto h-4 w-4"})]})}).displayName=eX.displayName,s.forwardRef(({className:e,...t},r)=>(0,n.jsx)(eY,{ref:r,className:(0,e1.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t})).displayName=eY.displayName;let e2=s.forwardRef(({className:e,sideOffset:t=4,...r},a)=>{let s=e=>{e.stopPropagation()};return(0,n.jsx)(e$,{children:(0,n.jsx)(eq,{ref:a,sideOffset:t,className:(0,e1.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),onTouchStart:s,onTouchEnd:s,onTouchMove:s,...r})})});e2.displayName=eq.displayName;let e3=s.forwardRef(({className:e,inset:t,...r},a)=>(0,n.jsx)(eK,{ref:a,className:(0,e1.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",e),...r}));e3.displayName=eK.displayName,s.forwardRef(({className:e,children:t,checked:r,...a},s)=>(0,n.jsxs)(ez,{ref:s,className:(0,e1.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:r,...a,children:[(0,n.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,n.jsx)(eW,{children:(0,n.jsx)(eZ.Check,{className:"h-4 w-4"})})}),t]})).displayName=ez.displayName,s.forwardRef(({className:e,children:t,...r},a)=>(0,n.jsxs)(eG,{ref:a,className:(0,e1.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...r,children:[(0,n.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,n.jsx)(eW,{children:(0,n.jsx)(e0,{className:"h-2 w-2 fill-current"})})}),t]})).displayName=eG.displayName;let e5=s.forwardRef(({className:e,inset:t,...r},a)=>(0,n.jsx)(eU,{ref:a,className:(0,e1.cn)("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...r}));e5.displayName=eU.displayName;let e4=s.forwardRef(({className:e,...t},r)=>(0,n.jsx)(eV,{ref:r,className:(0,e1.cn)("-mx-1 my-1 h-px bg-muted",e),...t}));e4.displayName=eV.displayName,e.s(["DropdownMenu",()=>eL,"DropdownMenuContent",()=>e2,"DropdownMenuItem",()=>e3,"DropdownMenuLabel",()=>e5,"DropdownMenuSeparator",()=>e4,"DropdownMenuTrigger",()=>eH],831395)},373633,e=>{"use strict";var t=e.i(191788),r=e.i(824216),a=e.i(46108),n=e.i(150064),s=e.i(256680);async function o(e){try{let t=await s.db.carriageInward.findMany({where:{branchId:e},orderBy:[{date:"desc"},{createdAt:"desc"}]});return{success:!0,data:t.map(e=>({id:e.id,userId:e.userId,locationId:e.branchId,supplierName:e.supplierName,details:e.details,amount:Number(e.amount),date:e.date.toISOString(),cashAccountId:e.cashAccountId,cashTransactionId:e.cashTransactionId,createdAt:e.createdAt.toISOString(),updatedAt:e.updatedAt.toISOString()}))}}catch(e){return{success:!1,error:e.message}}}async function i(e,t,r){try{let a=await s.db.carriageInward.create({data:{userId:e,branchId:t,supplierName:r.supplierName,details:r.details,amount:r.amount,date:r.date,cashAccountId:r.cashAccountId||null}});return{success:!0,data:a}}catch(e){return{success:!1,error:e.message}}}async function c(e,t,r){try{let a={};return void 0!==r.supplierName&&(a.supplierName=r.supplierName),void 0!==r.details&&(a.details=r.details),void 0!==r.amount&&(a.amount=r.amount),void 0!==r.date&&(a.date=r.date),await s.db.carriageInward.update({where:{id:e,branchId:t},data:a}),{success:!0}}catch(e){return{success:!1,error:e.message}}}async function l(e,t){try{return await s.db.carriageInward.delete({where:{id:e,branchId:t}}),{success:!0}}catch(e){return{success:!1,error:e.message}}}e.s(["useCarriageInwards",0,()=>{let[e,s]=(0,t.useState)([]),[d,u]=(0,t.useState)(!1),{user:m}=(0,r.useAuth)(),{currentBusiness:p}=(0,a.useBusiness)(),{toast:f}=(0,n.useToast)(),h=(0,t.useCallback)(async()=>{if(!m||!p){s([]),u(!1);return}u(!0);try{let e=await o(p.id);if(!e.success)throw Error(e.error);s((e.data||[]).map(e=>({...e,date:new Date(e.date),createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)})))}catch(e){console.error("Error loading carriage inwards:",e),f({title:"Error",description:"Failed to load carriage inwards records.",variant:"destructive"})}finally{u(!1)}},[m,p?.id,f]),y=async e=>{if(!m||!p)throw Error("User not authenticated or no business selected");let t=await i(m.id,p.id,e);if(!t.success)throw Error(t.error);return await h(),f({title:"Success",description:"Carriage inwards record created successfully"}),t.data},g=async(e,t)=>{if(!p)throw Error("No business selected");let r=await c(e,p.id,t);if(!r.success)throw Error(r.error);return await h(),f({title:"Success",description:"Carriage inwards record updated successfully"}),!0},v=async e=>{if(!p)throw Error("No business selected");let t=await l(e,p.id);if(!t.success)throw Error(t.error);return await h(),f({title:"Success",description:"Carriage inwards record deleted successfully"}),!0};return(0,t.useEffect)(()=>{h()},[h]),{carriageInwards:e,isLoading:d,createCarriageInward:y,updateCarriageInward:g,deleteCarriageInward:v,refreshCarriageInwards:h}}],373633)},680571,719230,791385,e=>{"use strict";var t=e.i(369547);let r=(0,t.default)("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);e.s(["ArrowUpRight",()=>r],680571);let a=(0,t.default)("ArrowDownRight",[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]]);e.s(["ArrowDownRight",()=>a],719230);var n=e.i(391398),s=e.i(191788),o=e.i(558021),i=e.i(296202),c=e.i(939310),l=e.i(45124),d=e.i(91762),u=e.i(443915),m=e.i(262945),p=e.i(563905);e.s(["default",0,({open:e,onOpenChange:t,onSubmit:r,title:a,initialData:f,isSubmitting:h=!1})=>{let{settings:y}=(0,p.useBusinessSettings)(),{register:g,handleSubmit:v,formState:{errors:x},reset:b,watch:w,setValue:S}=(0,o.useForm)({defaultValues:{name:"",description:"",isDefault:!1,...f}});s.default.useEffect(()=>{e&&f?b({name:f.name||"",description:f.description||"",openingBalance:f.openingBalance||0,isDefault:f.isDefault||!1}):e&&b({name:"",description:"",openingBalance:void 0,isDefault:!1})},[e,f,b]);let C=w("isDefault"),j=y.currency||"UGX";return(0,n.jsx)(i.Dialog,{open:e,onOpenChange:t,children:(0,n.jsxs)(i.DialogContent,{className:"sm:max-w-[425px]",children:[(0,n.jsx)(i.DialogHeader,{children:(0,n.jsx)(i.DialogTitle,{children:a})}),(0,n.jsxs)("form",{onSubmit:v(e=>{r(e)}),className:"space-y-4",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(d.Label,{htmlFor:"name",children:"Account Name"}),(0,n.jsx)(l.Input,{id:"name",...g("name",{required:"Account name is required"}),placeholder:"e.g., Main Cash, Petty Cash",disabled:h}),x.name&&(0,n.jsx)("p",{className:"text-sm text-red-600",children:x.name.message})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(d.Label,{htmlFor:"description",children:"Description (Optional)"}),(0,n.jsx)(u.Textarea,{id:"description",...g("description"),placeholder:"Brief description of this account",rows:3,disabled:h})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)(d.Label,{htmlFor:"openingBalance",children:["Opening Balance (",j,")"]}),(0,n.jsx)(l.Input,{id:"openingBalance",type:"number",step:"0.01",...g("openingBalance",{required:"Opening balance is required",min:{value:0,message:"Opening balance cannot be negative"}}),placeholder:"0.00",disabled:h}),x.openingBalance&&(0,n.jsx)("p",{className:"text-sm text-red-600",children:x.openingBalance.message})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(m.Checkbox,{id:"isDefault",checked:C,onCheckedChange:e=>S("isDefault",e),disabled:h}),(0,n.jsx)(d.Label,{htmlFor:"isDefault",className:"text-sm",children:"Set as default account"})]}),(0,n.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[(0,n.jsx)(c.Button,{type:"button",variant:"outline",onClick:()=>t(!1),disabled:h,children:"Cancel"}),(0,n.jsx)(c.Button,{type:"submit",disabled:h,children:h?f?"Updating...":"Creating...":f?"Update Account":"Create Account"})]})]})]})})}],791385)},590977,e=>{"use strict";var t=e.i(191788),r=e.i(150064),a=e.i(46108),n=e.i(893930),s=e.i(285700),o=e.i(96539),i=e.i(824216);e.s(["useExpenses",0,()=>{let[e,c]=(0,t.useState)([]),{toast:l}=(0,r.useToast)(),{currentBusiness:d}=(0,a.useBusiness)(),{user:u}=(0,i.useAuth)(),m=(0,s.useQueryClient)(),p=(0,t.useCallback)(async()=>{if(!d)return[];try{let e=await (0,o.getExpensesAction)(d.id);if(!e.success||!e.data)throw Error(e.error||"Failed to fetch expenses");return e.data.map(e=>({id:e.id,amount:Number(e.amount),description:e.description,category:e.category,date:new Date(e.date),paymentMethod:e.paymentMethod,personInCharge:e.personInCharge,receiptImage:e.receiptImage,cashAccountId:e.cashAccountId,cashTransactionId:e.cashTransactionId,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)}))}catch(e){return console.error("Error loading expenses:",e),l({title:"Error",description:"Failed to load expenses. Please try again.",variant:"destructive"}),[]}},[d?.id,l]),f=["expenses",d?.id],{data:h,isLoading:y,isFetching:g}=(0,n.useQuery)({queryKey:f,queryFn:p,enabled:!!d?.id,staleTime:3e5,gcTime:18e5,refetchOnWindowFocus:!1,refetchOnReconnect:!1});(0,t.useEffect)(()=>{h&&c(h)},[h]);let v=async(t,r)=>{try{let a=e.find(e=>e.id===t);if(!a)throw Error("Expense not found");let n={amount:void 0!==r.amount?r.amount:a.amount,description:void 0!==r.description?r.description:a.description,category:void 0!==r.category?r.category:a.category,date:void 0!==r.date?r.date:a.date,paymentMethod:void 0!==r.paymentMethod?r.paymentMethod:a.paymentMethod,personInCharge:void 0!==r.personInCharge?r.personInCharge:a.personInCharge,receiptImage:void 0!==r.receiptImage?r.receiptImage:a.receiptImage,cashAccountId:r.linkToCash?r.cashAccountId:!1===r.linkToCash?null:a.cashAccountId},s=await (0,o.updateExpenseAction)(t,n,a);if(!s.success)throw Error(s.error);m.invalidateQueries({queryKey:f}),l({title:"Success",description:"Expense updated successfully"})}catch(e){console.error("Error updating expense:",e),l({title:"Error",description:"Failed to update expense. Please try again.",variant:"destructive"})}};return{expenses:e,isLoading:y&&!h,createExpense:async e=>{if(!d||!u)return void l({title:"Error",description:d?"User not authenticated":"No business selected",variant:"destructive"});try{let t={amount:e.amount,description:e.description,category:e.category,date:e.date,paymentMethod:e.paymentMethod,personInCharge:e.personInCharge,receiptImage:e.receiptImage,cashAccountId:e.cashAccountId,userId:u.id,locationId:d.id},r=await (0,o.createExpenseAction)(t,!!e.linkToCash);if(!r.success||!r.data)throw Error(r.error);let a=r.data,n={id:a.id,amount:Number(a.amount),description:a.description,category:a.category,date:new Date(a.date),paymentMethod:a.paymentMethod,personInCharge:a.personInCharge,receiptImage:a.receiptImage,cashAccountId:a.cashAccountId,cashTransactionId:a.cashTransactionId,createdAt:new Date(a.createdAt),updatedAt:new Date(a.updatedAt)};return c(e=>[n,...e]),m.setQueryData(f,e=>e?[n,...e]:[n]),m.invalidateQueries({queryKey:f}),l({title:"Success",description:"Expense created successfully"}),n}catch(e){console.error("Error creating expense:",e),l({title:"Error",description:"Failed to create expense. Please try again.",variant:"destructive"})}},createBulkExpenses:async e=>{if(!d||!u)return void l({title:"Error",description:d?"User not authenticated":"No business selected",variant:"destructive"});try{let t=[];for(let r of e){let e={amount:r.amount,description:r.description,category:r.category,date:r.date,paymentMethod:r.paymentMethod,personInCharge:r.personInCharge,receiptImage:r.receiptImage,cashAccountId:r.cashAccountId,userId:u.id,locationId:d.id},a=await (0,o.createExpenseAction)(e,!!r.linkToCash);if(a.success&&a.data){let e=a.data;t.push({id:e.id,amount:Number(e.amount),description:e.description,category:e.category,date:new Date(e.date),paymentMethod:e.paymentMethod,personInCharge:e.personInCharge,receiptImage:e.receiptImage,cashAccountId:e.cashAccountId,cashTransactionId:e.cashTransactionId,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)})}}return m.invalidateQueries({queryKey:f}),l({title:"Success",description:`Successfully created ${t.length} expenses`}),t}catch(e){throw console.error("Error creating bulk expenses:",e),l({title:"Error",description:"Failed to create bulk expenses. Please try again.",variant:"destructive"}),e}},updateExpense:v,deleteExpense:async e=>{try{let t=await (0,o.deleteExpenseAction)(e);if(!t.success)throw Error(t.error);return c(t=>t.filter(t=>t.id!==e)),m.setQueryData(f,t=>t?t.filter(t=>t.id!==e):t),m.invalidateQueries({queryKey:f}),l({title:"Success",description:"Expense deleted successfully"}),!0}catch(e){return console.error("Error deleting expense:",e),l({title:"Error",description:"Failed to delete expense. Please try again.",variant:"destructive"}),!1}},refreshExpenses:async()=>{m.invalidateQueries({queryKey:f})}}}])},580872,e=>{"use strict";var t=e.i(391398),r=e.i(690176),a=e.i(939310),n=e.i(151670),s=e.i(348370),o=e.i(897837),i=e.i(792042);e.s(["default",0,({dateFilter:e,dateRange:c,specificDate:l,isCustomRange:d,isSpecificDate:u=!1,onDateFilterChange:m,onDateRangeChange:p,onSpecificDateChange:f})=>(0,t.jsxs)("div",{className:"flex gap-4 items-center flex-wrap mb-4",onClick:e=>{e.stopPropagation()},children:[(0,t.jsx)("div",{className:"w-[240px] relative",children:(0,t.jsxs)(r.Select,{value:e,onValueChange:m,children:[(0,t.jsx)(r.SelectTrigger,{className:"bg-white shadow-sm",children:(0,t.jsx)(r.SelectValue,{placeholder:"Select date range"})}),(0,t.jsxs)(r.SelectContent,{className:"z-[9999] bg-white shadow-lg border border-border/50",children:[(0,t.jsx)(r.SelectItem,{value:"today",children:"Today"}),(0,t.jsx)(r.SelectItem,{value:"yesterday",children:"Yesterday"}),(0,t.jsx)(r.SelectItem,{value:"this-week",children:"This Week"}),(0,t.jsx)(r.SelectItem,{value:"last-week",children:"Last Week"}),(0,t.jsx)(r.SelectItem,{value:"this-month",children:"This Month"}),(0,t.jsx)(r.SelectItem,{value:"last-month",children:"Last Month"}),(0,t.jsx)(r.SelectItem,{value:"this-year",children:"This Year"}),(0,t.jsx)(r.SelectItem,{value:"all",children:"All Time"}),(0,t.jsx)(r.SelectItem,{value:"specific",children:"Specific Date"}),(0,t.jsx)(r.SelectItem,{value:"custom",children:"Custom Range"})]})]})}),u&&f&&(0,t.jsx)("div",{className:"flex items-center",children:(0,t.jsxs)(s.Popover,{children:[(0,t.jsx)(s.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)(a.Button,{variant:"outline",className:"bg-white flex items-center gap-2 h-10 pl-3 text-left font-normal",children:[(0,t.jsx)(n.Calendar,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:l?(0,i.format)(l,"MMM d, yyyy"):"Select Date"})]})}),(0,t.jsx)(s.PopoverContent,{className:"w-auto p-0 z-[9999] bg-white shadow-lg",align:"start",children:(0,t.jsx)(o.Calendar,{initialFocus:!0,mode:"single",defaultMonth:l,selected:l,onSelect:f,className:"p-3 pointer-events-auto",showOutsideDays:!0})})]})}),d&&(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsxs)(s.Popover,{children:[(0,t.jsx)(s.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)(a.Button,{variant:"outline",className:"bg-white flex items-center gap-2 h-10 pl-3 text-left font-normal",children:[(0,t.jsx)(n.Calendar,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:c.from?(0,i.format)(c.from,"MMM d, yyyy"):"Start Date"})]})}),(0,t.jsx)(s.PopoverContent,{className:"w-auto p-0 z-[9999] bg-white shadow-lg",align:"start",children:(0,t.jsx)(o.Calendar,{initialFocus:!0,mode:"single",defaultMonth:c?.from,selected:c?.from,onSelect:e=>p({...c,from:e}),className:"p-3 pointer-events-auto",showOutsideDays:!0})})]}),(0,t.jsx)("span",{className:"text-muted-foreground",children:"to"}),(0,t.jsxs)(s.Popover,{children:[(0,t.jsx)(s.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)(a.Button,{variant:"outline",className:"bg-white flex items-center gap-2 h-10 pl-3 text-left font-normal",children:[(0,t.jsx)(n.Calendar,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:c.to?(0,i.format)(c.to,"MMM d, yyyy"):"End Date"})]})}),(0,t.jsx)(s.PopoverContent,{className:"w-auto p-0 z-[9999] bg-white shadow-lg",align:"start",children:(0,t.jsx)(o.Calendar,{initialFocus:!0,mode:"single",defaultMonth:c?.to,selected:c?.to,onSelect:e=>p({...c,to:e}),className:"p-3 pointer-events-auto",showOutsideDays:!0})})]})]})]})])},585390,e=>{"use strict";var t=e.i(391398),r=e.i(191788),a=e.i(46108),n=e.i(726302),s=e.i(550292),o=e.i(972733),i=e.i(939310),c=e.i(30691);let l=({onCreateAccount:e,canCreate:r=!0})=>((0,c.useIsMobile)(),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"Cash Accounts"}),r&&(0,t.jsxs)(i.Button,{onClick:e,className:"gap-2",size:"default",children:[(0,t.jsx)(o.Plus,{className:"h-4 w-4"}),"New Cash Account"]})]}));var d=e.i(365713),u=e.i(426119),m=e.i(599875),p=e.i(985294),f=e.i(680571),h=e.i(719230),y=e.i(649086),g=e.i(322138),v=e.i(831395),x=e.i(649973),b=e.i(563905),w=e.i(212283);let S=({open:e,onOpenChange:r,account:a,transactionCount:n=0,details:s,onConfirm:o})=>{if(!a)return null;let i=n>0;return(0,t.jsx)(w.AlertDialog,{open:e,onOpenChange:r,children:(0,t.jsxs)(w.AlertDialogContent,{children:[(0,t.jsxs)(w.AlertDialogHeader,{children:[(0,t.jsx)(w.AlertDialogTitle,{children:"Delete Cash Account"}),(0,t.jsxs)(w.AlertDialogDescription,{className:"space-y-2",children:[(0,t.jsxs)("span",{className:"block",children:['Are you sure you want to delete the cash account "',a.name,'"?']}),i&&(0,t.jsxs)("span",{className:"block text-amber-600 font-medium",children:["This account has ",s||`${n} linked records`,"."]})]})]}),(0,t.jsxs)(w.AlertDialogFooter,{className:i?"flex-col gap-2 sm:flex-col":"",children:[(0,t.jsx)(w.AlertDialogCancel,{children:"Cancel"}),i?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(w.AlertDialogAction,{onClick:()=>o(!1),className:"bg-blue-600 hover:bg-blue-700",children:"Delete Account Only (Unlink Records)"}),(0,t.jsx)(w.AlertDialogAction,{onClick:()=>o(!0),className:"bg-red-600 hover:bg-red-700",children:"Delete Account & All Records"})]}):(0,t.jsx)(w.AlertDialogAction,{onClick:()=>o(!1),className:"bg-red-600 hover:bg-red-700",children:"Delete Account"})]})]})})};var C=e.i(353533),j=e.i(638822),N=e.i(89635);let A=({account:e,onAccountDeleted:a})=>{let s=(0,d.useNavigate)(),o=(0,c.useIsMobile)(),{deleteAccount:l,deleteAccountWithTransactions:w}=(0,n.useCashAccounts)(),{getDailySummary:A}=(0,x.useCashTransactions)(e.id),{settings:I}=(0,b.useBusinessSettings)(),{hasPermission:T}=(0,j.useProfiles)(),{canManageFinanceAccounts:E}=(0,N.useFinancialVisibility)(),D=T("finance","delete"),[P,_]=(0,r.useState)(!0),[M,R]=(0,r.useState)(!1),[k,O]=(0,r.useState)(0),[F,L]=(0,r.useState)(""),[B,H]=(0,r.useState)({date:new Date,openingBalance:0,cashIn:0,cashOut:0,transfersIn:0,transfersOut:0,closingBalance:0}),$=(0,r.useMemo)(()=>e=>(0,C.formatCashAmount)(e,I.currency||"USD"),[I.currency]),Q=(0,r.useCallback)(async()=>{_(!0);try{let t=await A(new Date,e.id);H(t)}catch(e){console.error("Error loading today's summary:",e)}finally{_(!1)}},[A,e.id]);(0,r.useEffect)(()=>{Q()},[Q]);let q=(0,r.useCallback)(async()=>{console.log("Delete button clicked for account:",e.id);try{let t=await l(e.id,a);console.log("Delete result:",t),t&&"object"==typeof t&&"hasTransactions"in t&&(t.hasTransactions?(console.log("Account has transactions, showing dialog"),O(t.transactionCount||0),L(t.details||""),R(!0)):t.success?console.log("Account deleted successfully without dialog"):console.log("Account deletion failed"))}catch(e){console.error("Unexpected error during deletion:",e)}},[l,e.id,a]),U=(0,r.useCallback)(async t=>{console.log("Confirm delete called with deleteTransactions:",t);try{let r=await w(e.id,t,a);console.log("Delete with transactions result:",r),r?(R(!1),console.log("Deletion successful, dialog closed")):console.log("Deletion failed")}catch(e){console.error("Error in handleConfirmDelete:",e)}},[w,e.id,a]),K=(0,r.useCallback)(()=>{s(`/cash/${e.id}`)},[s,e.id]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(u.Card,{className:`hover:shadow-lg transition-all duration-200 cursor-pointer ${o?"shadow-sm border-gray-200":"hover:shadow-md"}`,children:[(0,t.jsxs)(u.CardHeader,{className:`flex flex-row items-center justify-between space-y-0 ${o?"pb-3":"pb-2"}`,children:[(0,t.jsxs)(u.CardTitle,{className:`${o?"text-base":"text-sm"} font-semibold flex items-center gap-2 text-gray-900`,children:[(0,t.jsx)(y.Wallet,{className:`${o?"h-5 w-5":"h-4 w-4"} text-primary`}),(0,t.jsx)("span",{className:"truncate",children:e.name}),e.isDefault&&(0,t.jsx)(m.Badge,{variant:"secondary",className:`${o?"text-xs px-2 py-0.5":"text-xs"} bg-primary/10 text-primary border-primary/20`,children:"Default"})]}),(0,t.jsxs)(v.DropdownMenu,{children:[(0,t.jsx)(v.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(i.Button,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-gray-100",children:(0,t.jsx)(p.MoreHorizontal,{className:"h-4 w-4 text-gray-500"})})}),(0,t.jsxs)(v.DropdownMenuContent,{align:"end",className:"bg-white border border-gray-200 shadow-lg",children:[(0,t.jsx)(v.DropdownMenuItem,{onClick:K,className:"hover:bg-gray-50",children:"View Details"}),D&&(0,t.jsx)(v.DropdownMenuItem,{onClick:q,className:"text-red-600 hover:bg-red-50",children:"Delete Account"})]})]})]}),(0,t.jsx)(u.CardContent,{onClick:K,className:o?"px-4 pb-4":"",children:(0,t.jsxs)("div",{className:`space-y-${o?"4":"3"}`,children:[(0,t.jsxs)("div",{className:o?"space-y-1":"",children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-gray-900 flex items-center",children:P?(0,t.jsx)(g.Loader2,{className:"h-6 w-6 animate-spin text-muted-foreground"}):E?$(B.closingBalance):""}),(0,t.jsx)("p",{className:`${o?"text-sm":"text-xs"} text-gray-500 font-medium`,children:"Current Balance"})]}),e.description&&(0,t.jsx)("p",{className:`${o?"text-sm leading-relaxed":"text-sm"} text-gray-600 line-clamp-2`,children:e.description}),(0,t.jsxs)("div",{className:`grid grid-cols-1 ${o?"gap-3":"gap-2"} text-sm`,children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-2 bg-green-50 rounded-md",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-green-700",children:[(0,t.jsx)(f.ArrowUpRight,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"font-medium",children:"Opening"})]}),(0,t.jsx)("span",{className:"font-semibold text-green-800 flex items-center",children:P?(0,t.jsx)(g.Loader2,{className:"h-4 w-4 animate-spin text-green-600"}):E?$(B.openingBalance):""})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between p-2 bg-blue-50 rounded-md",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-blue-700",children:[(0,t.jsx)(h.ArrowDownRight,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"font-medium",children:"Today's Close"})]}),(0,t.jsx)("span",{className:"font-semibold text-blue-800 flex items-center",children:P?(0,t.jsx)(g.Loader2,{className:"h-4 w-4 animate-spin text-blue-600"}):E?$(B.closingBalance):""})]})]}),(0,t.jsx)("div",{className:"pt-2",children:(0,t.jsx)(i.Button,{variant:"outline",size:o?"default":"sm",className:`w-full font-medium hover:bg-primary hover:text-white transition-colors ${o?"h-10":""}`,onClick:e=>{e.stopPropagation(),K()},children:"Manage Account"})})]})})]}),(0,t.jsx)(S,{open:M,onOpenChange:R,account:e,transactionCount:k,details:F,onConfirm:U})]})},I=({accounts:e,isLoading:r,onCreateAccount:a,onAccountDeleted:n,canCreate:s=!0})=>((0,c.useIsMobile)(),r)?(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:[1,2,3].map(e=>(0,t.jsx)("div",{className:"h-64 bg-gray-100 animate-pulse rounded-lg"},e))}):0===e.length?(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No cash accounts"}),(0,t.jsx)("p",{className:"text-gray-500 mb-4",children:"Get started by creating your first cash account."}),s&&(0,t.jsxs)(i.Button,{onClick:a,className:"gap-2",children:[(0,t.jsx)(o.Plus,{className:"h-4 w-4"}),"Create Cash Account"]})]}):(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:e.map(e=>(0,t.jsx)(A,{account:e,onAccountDeleted:n},e.id))});var T=e.i(791385),E=e.i(824216),D=e.i(852577),P=e.i(590977),_=e.i(368104),M=e.i(373633),R=e.i(21860),k=e.i(974174),O=e.i(580872),F=e.i(518466),L=e.i(646190),B=e.i(45124),H=e.i(91762);let $=({taxPercentage:e,onTaxChange:r,netProfitLoss:a,formatCurrency:n})=>(0,t.jsxs)("div",{className:"flex items-center gap-4 p-4 bg-gray-50 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(H.Label,{htmlFor:"tax-percentage",className:"text-sm font-medium",children:"Tax %:"}),(0,t.jsx)(B.Input,{id:"tax-percentage",type:"number",min:"0",max:"100",step:"0.1",value:e,onChange:e=>{r(Math.max(0,Math.min(100,parseFloat(e.target.value)||0)))},className:"w-20 h-8 text-center"})]}),(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Tax Amount: "}),(0,t.jsx)("span",{className:"font-medium",children:n(a>0?a*e/100:0)})]})]});var Q=e.i(687072),q=e.i(576255);let U=(0,e.i(369547).default)("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);var K=e.i(792042),z=e.i(411168);let G=async e=>{let{data:t,dateRange:r,currency:a,businessName:n,dateFilter:s}=e,o=new z.default({orientation:"portrait",unit:"mm",format:"a4"}),i=o.internal.pageSize.getWidth(),c=o.internal.pageSize.getHeight(),l=20,d=()=>{o.setFontSize(8),o.setFont("helvetica","normal"),o.setTextColor(150,150,150),o.text("Created By Gonza Systems",i/2,c-10,{align:"center"}),o.setTextColor(0,0,0)},u=e=>`${a} ${e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`;if(n){o.setFontSize(18),o.setFont("helvetica","bold");let e=o.getTextWidth(n);o.text(n,(i-e)/2,l),l+=10}o.setFontSize(16),o.setFont("helvetica","bold");let m="Profit & Loss Account",p=o.getTextWidth(m);o.text(m,(i-p)/2,l),l+=8,o.setFontSize(11),o.setFont("helvetica","normal");let f=((e,t)=>{if(t.from&&t.to){let r=t.from.getMonth()===t.to.getMonth()&&t.from.getFullYear()===t.to.getFullYear();if(t.from.toDateString()===t.to.toDateString())return(0,K.format)(t.from,"MMM dd, yyyy");if(r&&"this-month"===e)return(0,K.format)(t.from,"MMMM yyyy");if("this-year"===e)return(0,K.format)(t.from,"yyyy");else if("last-month"===e)return(0,K.format)(t.from,"MMMM yyyy");else if("this-week"===e||"last-week"===e)return`Week of ${(0,K.format)(t.from,"MMM dd")} - ${(0,K.format)(t.to,"MMM dd, yyyy")}`;else return`Custom Period: ${(0,K.format)(t.from,"MM/dd/yyyy")} - ${(0,K.format)(t.to,"MM/dd/yyyy")}`}return t.from?(0,K.format)(t.from,"MMM dd, yyyy"):"All Periods"})(s,r),h=o.getTextWidth(f);o.text(f,(i-h)/2,l),l+=15;let y=e=>{l>c-40&&(d(),o.addPage(),l=20),o.setFontSize(12),o.setFont("helvetica","bold"),o.text(e,20,l),l+=6},g=(e,t,r={})=>{let{isBold:a=!1,isSubtraction:n=!1,isTotal:s=!1,indent:m=!1,showNegativeSign:p=!1}=r;if(l>c-25&&(d(),o.addPage(),l=20),o.setFontSize(10),o.setFont("helvetica",a?"bold":"normal"),o.text(e,m?30:20,l),null!==t){let e;e=p&&t<0?`-${u(Math.abs(t))}`:n?`(${u(Math.abs(t))})`:u(Math.abs(t));let r=o.getTextWidth(e);o.text(e,i-20-r,l)}s&&(o.setLineWidth(.3),o.line(20,l+2,i-20,l+2),l+=2),l+=5},v=(e=3)=>{l+=e};y("SALES/REVENUE"),g("Sales/Revenue",t.sales,{indent:!0}),g("Sales Returns",t.salesReturns,{isSubtraction:!0,indent:!0}),g("NET SALES",t.netSales,{isBold:!0,isTotal:!0}),v(5),y("COST OF GOODS SOLD (COGS)"),g("Total Cost Sales",t.totalCostSales,{indent:!0}),g("Carriage Inwards",t.carriageInwards,{indent:!0}),g("TOTAL COST OF GOODS SOLD (COGS)",t.totalCOGS,{isBold:!0,isTotal:!0}),v(5),g("GROSS PROFIT",t.grossProfit,{isBold:!0,isTotal:!0,showNegativeSign:!0}),v(3),y("EXPENSES"),Object.entries(t.expensesByCategory).forEach(([e,t])=>{g(e.charAt(0).toUpperCase()+e.slice(1).toLowerCase(),t,{indent:!0})}),g("TOTAL EXPENSES",t.totalExpenses,{isBold:!0,isTotal:!0}),v(5),g("NET PROFIT / LOSS",t.netProfitLoss,{isBold:!0,isTotal:!0,showNegativeSign:!0}),g(`Tax (${t.taxPercentage}%)`,t.taxAmount,{indent:!0}),g("FINAL PROFIT AFTER TAX",t.finalProfitAfterTax,{isBold:!0,isTotal:!0,showNegativeSign:!0}),d();let x=`profit_loss_${r.from?(0,K.format)(r.from,"yyyy-MM-dd"):"current"}_to_${r.to?(0,K.format)(r.to,"yyyy-MM-dd"):"current"}.pdf`;o.save(x)};var W=e.i(150064);let V=({data:e,dateRange:a,currency:n,businessName:s,businessLogo:o,dateFilter:c})=>{let[l,d]=(0,r.useState)(!1),{toast:u}=(0,W.useToast)(),m=async()=>{try{d(!0),(e=>{let{data:t,dateRange:r,currency:a,businessName:n,dateFilter:s}=e,o=(e,t=!1)=>t&&e<0?`-${Math.abs(e).toFixed(0)}`:e.toFixed(0),i=[];i.push("PROFIT & LOSS ACCOUNT"),i.push(""),n&&i.push(`Business,${n}`),i.push(`Period,${((e,t)=>{if(t.from&&t.to){let r=t.from.getMonth()===t.to.getMonth()&&t.from.getFullYear()===t.to.getFullYear();if(t.from.toDateString()===t.to.toDateString())return(0,K.format)(t.from,"MMM dd, yyyy");if(r&&"this-month"===e)return(0,K.format)(t.from,"MMMM yyyy");if("this-year"===e)return(0,K.format)(t.from,"yyyy");else if("last-month"===e)return(0,K.format)(t.from,"MMMM yyyy");else if("this-week"===e||"last-week"===e)return`Week of ${(0,K.format)(t.from,"MMM dd")} - ${(0,K.format)(t.to,"MMM dd, yyyy")}`;else return`Custom Period: ${(0,K.format)(t.from,"MM/dd/yyyy")} - ${(0,K.format)(t.to,"MM/dd/yyyy")}`}return t.from?(0,K.format)(t.from,"MMM dd, yyyy"):"All Periods"})(s,r)}`),i.push(`Generated,${(0,K.format)(new Date,"MMM dd yyyy HH:mm")}`),i.push(`Currency,${a}`),i.push(""),i.push("DETAILS,AMOUNT"),i.push(""),i.push("SALES/REVENUE,"),i.push(`Sales/Revenue,${o(t.sales)}`),i.push(`Sales Returns,(${o(t.salesReturns)})`),i.push(`NET SALES,${o(t.netSales)}`),i.push(""),i.push("COST OF GOODS SOLD (COGS),"),i.push(`Total Cost Sales,${o(t.totalCostSales)}`),i.push(`Carriage Inwards,${o(t.carriageInwards)}`),i.push(`TOTAL COST OF GOODS SOLD (COGS),${o(t.totalCOGS)}`),i.push(""),i.push(`GROSS PROFIT,${o(t.grossProfit,!0)}`),i.push(""),i.push("EXPENSES,"),Object.entries(t.expensesByCategory).forEach(([e,t])=>{let r=e.charAt(0).toUpperCase()+e.slice(1).toLowerCase();i.push(`${r},${o(t)}`)}),i.push(`TOTAL EXPENSES,${o(t.totalExpenses)}`),i.push(""),i.push(`NET PROFIT / LOSS,${o(t.netProfitLoss,!0)}`),i.push(`Tax (${t.taxPercentage}%),${o(t.taxAmount)}`),i.push(`FINAL PROFIT AFTER TAX,${o(t.finalProfitAfterTax,!0)}`);let c=new Blob([i.join("\n")],{type:"text/csv;charset=utf-8;"}),l=document.createElement("a");if(void 0!==l.download){let e=URL.createObjectURL(c);l.setAttribute("href",e);let t=`profit_loss_${r.from?(0,K.format)(r.from,"yyyy-MM-dd"):"current"}_to_${r.to?(0,K.format)(r.to,"yyyy-MM-dd"):"current"}.csv`;l.setAttribute("download",t),l.style.visibility="hidden",document.body.appendChild(l),l.click(),document.body.removeChild(l)}})({data:e,dateRange:a,currency:n,businessName:s,dateFilter:c}),u({title:"Export Successful",description:"Profit & Loss Account exported to CSV successfully."})}catch(e){console.error("Error exporting CSV:",e),u({title:"Export Failed",description:"Failed to export Profit & Loss Account to CSV.",variant:"destructive"})}finally{d(!1)}},p=async()=>{try{d(!0),await G({data:e,dateRange:a,currency:n,businessName:s,businessLogo:o,dateFilter:c}),u({title:"Export Successful",description:"Profit & Loss Account exported to PDF successfully."})}catch(e){console.error("Error exporting PDF:",e),u({title:"Export Failed",description:"Failed to export Profit & Loss Account to PDF.",variant:"destructive"})}finally{d(!1)}};return(0,t.jsxs)(v.DropdownMenu,{children:[(0,t.jsx)(v.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(i.Button,{variant:"outline",size:"sm",disabled:l,children:[(0,t.jsx)(Q.Download,{className:"h-4 w-4 mr-2"}),"Export"]})}),(0,t.jsxs)(v.DropdownMenuContent,{children:[(0,t.jsxs)(v.DropdownMenuItem,{onClick:m,disabled:l,children:[(0,t.jsx)(U,{className:"h-4 w-4 mr-2"}),"Export as CSV"]}),(0,t.jsxs)(v.DropdownMenuItem,{onClick:p,disabled:l,children:[(0,t.jsx)(q.FileText,{className:"h-4 w-4 mr-2"}),"Export as PDF"]})]})]})},X=({data:e,isLoading:r,formatCurrency:a,onTaxChange:n,dateRange:s,businessName:o,businessLogo:i,currency:c,dateFilter:l})=>{if(r)return(0,t.jsxs)(u.Card,{children:[(0,t.jsx)(u.CardHeader,{children:(0,t.jsx)(u.CardTitle,{children:"Profit & Loss Account"})}),(0,t.jsx)(u.CardContent,{children:(0,t.jsx)("div",{className:"space-y-3",children:[...Array(15)].map((e,r)=>(0,t.jsx)(L.Skeleton,{className:"h-8 w-full"},r))})})]});let d=[{detail:"SALES/REVENUE",amount:e.sales,isBold:!0},{detail:"SALES RETURNS",amount:e.salesReturns,isSubtraction:!0},{detail:"NET SALES",amount:e.netSales,isBold:!0,isTotal:!0},{detail:"",amount:null,isSpacer:!0},{detail:"COST OF GOODS SOLD (COGS)",amount:null,isHeader:!0},{detail:"TOTAL COST SALES",amount:e.totalCostSales},{detail:"CARRIAGE INWARDS",amount:e.carriageInwards},{detail:"TOTAL COST OF GOODS SOLD (COGS)",amount:e.totalCOGS,isBold:!0,isTotal:!0},{detail:"",amount:null,isSpacer:!0},{detail:"GROSS PROFIT",amount:e.grossProfit,isBold:!0,isTotal:!0},{detail:"",amount:null,isSpacer:!0},{detail:"EXPENSES",amount:null,isHeader:!0}];Object.entries(e.expensesByCategory).forEach(([e,t])=>{d.push({detail:e.toUpperCase(),amount:t})}),d.push({detail:"TOTAL EXPENSES",amount:e.totalExpenses,isBold:!0,isTotal:!0},{detail:"",amount:null,isSpacer:!0},{detail:"NET PROFIT / LOSS",amount:e.netProfitLoss,isBold:!0,isTotal:!0},{detail:"TAX",amount:e.taxAmount},{detail:"FINAL PROFIT AFTER TAX",amount:e.finalProfitAfterTax,isBold:!0,isTotal:!0});let m=e=>e.amount<0?"text-red-600":e.detail?.includes("PROFIT")&&e.amount>0?"text-green-600":e.detail?.includes("EXPENSE")||e.detail?.includes("TAX")?"text-red-600":"text-gray-900";return(0,t.jsxs)(u.Card,{children:[(0,t.jsx)(u.CardHeader,{children:(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)(u.CardTitle,{children:"Profit & Loss Account"}),(0,t.jsx)(V,{data:e,dateRange:s,currency:c,businessName:o,businessLogo:i,dateFilter:l})]})}),(0,t.jsxs)(u.CardContent,{className:"space-y-4",children:[(0,t.jsx)($,{taxPercentage:e.taxPercentage,onTaxChange:n,netProfitLoss:e.netProfitLoss,formatCurrency:a}),(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)(F.Table,{children:[(0,t.jsx)(F.TableHeader,{children:(0,t.jsxs)(F.TableRow,{children:[(0,t.jsx)(F.TableHead,{className:"font-bold text-left",children:"DETAILS"}),(0,t.jsx)(F.TableHead,{className:"font-bold text-right",children:"AMOUNT"})]})}),(0,t.jsx)(F.TableBody,{children:d.map((e,r)=>e.isSpacer?(0,t.jsx)(F.TableRow,{children:(0,t.jsx)(F.TableCell,{colSpan:2,className:"h-4 border-0"})},r):e.isHeader?(0,t.jsx)(F.TableRow,{children:(0,t.jsx)(F.TableCell,{colSpan:2,className:"font-bold text-gray-800 bg-gray-50 border-0",children:e.detail})},r):(0,t.jsxs)(F.TableRow,{className:e.isTotal?"border-t-2 border-gray-300":"",children:[(0,t.jsx)(F.TableCell,{className:`${e.isBold?"font-bold":""} ${m(e)}`,children:e.detail}),(0,t.jsx)(F.TableCell,{className:`text-right ${e.isBold?"font-bold":""} ${m(e)}`,children:null!==e.amount?(0,t.jsxs)("span",{children:[e.isSubtraction&&"(",a(Math.abs(e.amount)),e.isSubtraction&&")"]}):null})]},r))})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-6",children:[(0,t.jsx)(u.Card,{className:"border-blue-200 bg-blue-50",children:(0,t.jsxs)(u.CardContent,{className:"p-4 text-center",children:[(0,t.jsx)("p",{className:"text-sm text-blue-600 font-medium",children:"Gross Profit"}),(0,t.jsx)("p",{className:"text-lg font-bold text-blue-800",children:a(e.grossProfit)})]})}),(0,t.jsx)(u.Card,{className:`border-${e.netProfitLoss>=0?"green":"red"}-200 bg-${e.netProfitLoss>=0?"green":"red"}-50`,children:(0,t.jsxs)(u.CardContent,{className:"p-4 text-center",children:[(0,t.jsxs)("p",{className:`text-sm text-${e.netProfitLoss>=0?"green":"red"}-600 font-medium`,children:["Net ",e.netProfitLoss>=0?"Profit":"Loss"]}),(0,t.jsx)("p",{className:`text-lg font-bold text-${e.netProfitLoss>=0?"green":"red"}-800`,children:a(Math.abs(e.netProfitLoss))})]})}),(0,t.jsx)(u.Card,{className:`border-${e.finalProfitAfterTax>=0?"green":"red"}-200 bg-${e.finalProfitAfterTax>=0?"green":"red"}-50`,children:(0,t.jsxs)(u.CardContent,{className:"p-4 text-center",children:[(0,t.jsxs)("p",{className:`text-sm text-${e.finalProfitAfterTax>=0?"green":"red"}-600 font-medium`,children:["Final ",e.finalProfitAfterTax>=0?"Profit":"Loss"," After Tax"]}),(0,t.jsx)("p",{className:`text-lg font-bold text-${e.finalProfitAfterTax>=0?"green":"red"}-800`,children:a(Math.abs(e.finalProfitAfterTax))})]})})]})]})]})},Y=()=>{let{currentBusiness:e}=(0,a.useBusiness)(),{settings:n}=(0,b.useBusinessSettings)(),[s,o]=(0,r.useState)("this-month"),[i,c]=(0,r.useState)({from:void 0,to:void 0}),[l,d]=(0,r.useState)(void 0),[u,m]=(0,r.useState)(0),p="custom"===s,f="specific"===s;(0,r.useEffect)(()=>{"custom"===s?d(void 0):"specific"===s?c({from:void 0,to:void 0}):(c({from:void 0,to:void 0}),d(void 0))},[s]);let h=n?.currency||"USD",{profitLossData:y,isLoading:g}=((e,t,n,s=0)=>{let{user:o}=(0,E.useAuth)(),{currentBusiness:i}=(0,a.useBusiness)(),[c,l]=(0,r.useState)(!1),{sales:d,isLoading:u}=(0,D.useSalesData)(o?.id),{expenses:m,isLoading:p}=(0,P.useExpenses)(),{stockSummaryData:f,isLoading:h}=(0,_.useStockSummaryData)(t),{carriageInwards:y,isLoading:g}=(0,M.useCarriageInwards)();return{profitLossData:(0,r.useMemo)(()=>{let r,a;if("specific"===e&&n)(r=new Date(n)).setHours(0,0,0,0),(a=new Date(n)).setHours(23,59,59,999);else if("custom"===e&&t.from&&t.to)r=t.from,a=t.to;else{let t=(0,R.getDateRangeFromFilter)(e);r=t.from,a=t.to}let o=d.filter(t=>{let s=new Date(t.date);return"specific"===e&&n?(0,k.isSameDay)(s,n)&&"Quote"!==t.paymentStatus:s>=r&&s<=a&&"Quote"!==t.paymentStatus}),i=m.filter(t=>{let s=new Date(t.date);return"specific"===e&&n?(0,k.isSameDay)(s,n):s>=r&&s<=a}),c=y.filter(t=>{let s=new Date(t.date);return"specific"===e&&n?(0,k.isSameDay)(s,n):s>=r&&s<=a}),l=o.reduce((e,t)=>e+t.items.reduce((e,t)=>e+t.price*t.quantity,0),0),u=f.reduce((e,t)=>e+t.returnIn*t.sellingPrice,0),p=l-u,h=f.reduce((e,t)=>e+t.openingStock*t.costPrice,0),g=f.reduce((e,t)=>e+t.stockIn*t.costPrice,0),v=c.reduce((e,t)=>e+t.amount,0),x=f.reduce((e,t)=>e+t.closingStock*t.costPrice,0),b=o.reduce((e,t)=>e+t.items.reduce((e,t)=>e+(t.cost||0)*t.quantity,0),0),w=b+v,S=p-w,C={};i.forEach(e=>{let t=e.category||"Uncategorized";C[t]=(C[t]||0)+e.amount});let j=Object.values(C).reduce((e,t)=>e+t,0),N=S-j,A=N>0?N*s/100:0;return{sales:l,salesReturns:u,netSales:p,openingStock:h,purchases:g,carriageInwards:v,closingStock:x,totalCostSales:b,totalCOGS:w,grossProfit:S,expensesByCategory:C,totalExpenses:j,netProfitLoss:N,taxPercentage:s,taxAmount:A,finalProfitAfterTax:N-A}},[d,m,f,y,e,t,n,s]),isLoading:(0,r.useMemo)(()=>u||p||h||g,[u,p,h,g])}})(s,i,l,u),v=(0,r.useMemo)(()=>"custom"===s&&i.from&&i.to?i:"specific"===s&&l?{from:l,to:l}:"custom"!==s&&"specific"!==s?(0,R.getDateRangeFromFilter)(s):{from:void 0,to:void 0},[s,i,l]);return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Profit & Loss Account"}),(0,t.jsx)(O.default,{dateFilter:s,dateRange:i,specificDate:l,isCustomRange:p,isSpecificDate:f,onDateFilterChange:o,onDateRangeChange:c,onSpecificDateChange:d})]}),(0,t.jsx)(X,{data:y,isLoading:g,formatCurrency:e=>new Intl.NumberFormat("en-US",{style:"currency",currency:h,minimumFractionDigits:2}).format(e),onTaxChange:m,dateRange:v,businessName:e?.name,businessLogo:n?.businessLogo,currency:h,dateFilter:s})]})},Z=({accounts:e,isLoading:a,isDialogOpen:n,onDialogOpenChange:o,onCreateAccount:i,onAccountDeleted:c,canCreate:d=!0})=>{let[u,m]=r.default.useState(!1),p=()=>o(!0),f=async e=>{m(!0);try{await i(e)}finally{m(!1)}};return(0,t.jsxs)(s.Tabs,{defaultValue:"cash-accounts",className:"w-full",children:[(0,t.jsxs)(s.TabsList,{className:"grid w-full grid-cols-2",children:[(0,t.jsx)(s.TabsTrigger,{value:"cash-accounts",children:"Cash Accounts"}),(0,t.jsx)(s.TabsTrigger,{value:"profit-loss",children:"Profit & Loss"})]}),(0,t.jsxs)(s.TabsContent,{value:"cash-accounts",className:"space-y-6",children:[(0,t.jsx)(l,{onCreateAccount:p,canCreate:d}),(0,t.jsx)(I,{accounts:e,isLoading:a,onCreateAccount:p,onAccountDeleted:c,canCreate:d}),(0,t.jsx)(T.default,{open:n,onOpenChange:o,onSubmit:f,title:"Create New Cash Account",isSubmitting:u})]}),(0,t.jsx)(s.TabsContent,{value:"profit-loss",children:(0,t.jsx)(Y,{})})]})};var J=e.i(626427),ee=e.i(675878);e.s(["default",0,()=>{let{currentBusiness:e,isLoading:s}=(0,a.useBusiness)(),o=(0,d.useNavigate)(),{accounts:c,isLoading:l,createAccount:u,refreshAccounts:m}=(0,n.useCashAccounts)(),{hasPermission:p,isLoading:f}=(0,j.useProfiles)(),[h,y]=(0,r.useState)(!1);(e=>{let t=(0,d.useNavigate)(),[a,n]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{if(!a&&e.length>0){let r=localStorage.getItem("lastVisitedCashAccount"),a=localStorage.getItem("lastVisitedCashAccountUrl");if(r&&a){if(e.some(e=>e.id===r))return void t(a.replace(window.location.origin,""));localStorage.removeItem("lastVisitedCashAccount"),localStorage.removeItem("lastVisitedCashAccountUrl")}n(!0)}},[e,a,t])})(c);let g=async e=>{try{await u(e),y(!1)}catch(e){console.error("Error creating account:",e)}},v=async()=>{await m()};if(s||l||f)return(0,t.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})});if(!p("finance","view"))return(0,t.jsxs)("div",{className:"max-w-4xl mx-auto p-6",children:[(0,t.jsxs)(J.Alert,{variant:"destructive",children:[(0,t.jsx)(ee.AlertCircle,{className:"h-4 w-4"}),(0,t.jsx)(J.AlertTitle,{children:"Access Denied"}),(0,t.jsx)(J.AlertDescription,{children:"You do not have permission to view finance/cash accounts. Please contact your administrator if you believe this is an error."})]}),(0,t.jsx)("div",{className:"mt-4",children:(0,t.jsx)(i.Button,{onClick:()=>o("/"),variant:"outline",children:"Back to Dashboard"})})]});let x=p("finance","create");return(0,t.jsxs)("div",{className:"space-y-6 p-4 md:p-0",children:[(0,t.jsx)("h1",{className:"text-2xl md:text-3xl font-bold",children:"Finance"}),(0,t.jsx)(Z,{accounts:c,isLoading:s||!e||l,isDialogOpen:h,onDialogOpenChange:y,onCreateAccount:g,onAccountDeleted:v,canCreate:x})]})}],585390)},732140,(e,t,r)=>{let a="/Cash";(window.__NEXT_P=window.__NEXT_P||[]).push([a,()=>e.r(585390)]),t.hot&&t.hot.dispose(function(){window.__NEXT_P.push([a])})},648761,e=>{e.v(t=>Promise.all(["static/chunks/2edb2b394ba4d2db.js"].map(t=>e.l(t))).then(()=>t(825455)))},828805,e=>{e.v(t=>Promise.all(["static/chunks/820c94ec438563d7.js"].map(t=>e.l(t))).then(()=>t(879466)))},154496,e=>{e.v(t=>Promise.all(["static/chunks/e27b932a0aa32323.js"].map(t=>e.l(t))).then(()=>t(57977)))},45814,e=>{e.v(t=>Promise.all(["static/chunks/44e51831a27a79ab.js"].map(t=>e.l(t))).then(()=>t(425448)))},492756,e=>{e.v(t=>Promise.all(["static/chunks/97d212cb1a6b9949.js"].map(t=>e.l(t))).then(()=>t(545302)))}]);