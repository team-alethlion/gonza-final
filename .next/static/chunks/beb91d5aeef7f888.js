(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,652128,e=>{"use strict";var t=e.i(843476),s=e.i(271645),a=e.i(677572),l=e.i(618566),r=e.i(519455),n=e.i(178583);let i=()=>{let e=(0,l.useRouter)();return(0,t.jsx)("div",{className:"text-center py-12 bg-white rounded-lg shadow-md p-8",children:(0,t.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,t.jsx)("div",{className:"bg-slate-100 rounded-full p-4 w-16 h-16 flex items-center justify-center",children:(0,t.jsx)(n.FileText,{className:"h-8 w-8 text-slate-400"})}),(0,t.jsx)("h3",{className:"text-xl font-semibold",children:"No sales records found"}),(0,t.jsx)("p",{className:"text-gray-500 mb-4",children:"Create your first sale to start tracking your business performance"}),(0,t.jsx)(r.Button,{onClick:()=>e.push("/new-sale"),className:"mt-2",children:"Create Your First Sale"})]})})},c=()=>(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-border/50",children:[(0,t.jsx)("div",{className:"p-4 sm:p-6 border-b border-border/50",children:(0,t.jsx)("div",{className:"flex flex-col gap-4",children:(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"h-8 bg-gray-200 rounded w-48 animate-pulse"}),(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-32 mt-2 animate-pulse"})]}),(0,t.jsx)("div",{className:"h-10 bg-gray-200 rounded w-32 animate-pulse"})]})})}),(0,t.jsx)("div",{className:"p-4 sm:p-6",children:(0,t.jsx)("div",{className:"space-y-4",children:[void 0,void 0,void 0].map((e,s)=>(0,t.jsx)("div",{className:"h-16 bg-gray-100 rounded animate-pulse"},s))})})]}),o=()=>{let e=(0,l.useRouter)();return(0,t.jsx)("div",{className:"p-6 text-center",children:(0,t.jsxs)("div",{className:"bg-amber-50 border border-amber-200 p-4 rounded-md",children:[(0,t.jsx)("p",{className:"text-amber-800 mb-4",children:"No business location found. Please create a business location to manage sales."}),(0,t.jsx)("button",{onClick:()=>e.push("/business-management"),className:"bg-amber-600 text-white px-4 py-2 rounded hover:bg-amber-700",children:"Manage Business Locations"})]})})};var d=e.i(784774),m=e.i(27365),u=e.i(107233),x=e.i(401851),h=e.i(255749),g=e.i(908406),p=e.i(160615),j=e.i(631422),f=e.i(777624);let b=({filteredSales:e,allSales:s,currency:a,dateFilter:i="all",dateRange:c,specificDate:o})=>{let d=(0,l.useRouter)(),{toast:b}=(0,g.useToast)(),{settings:y}=(0,p.useBusinessSettings)(),{hasPermission:N}=(0,f.useProfiles)(),v=async()=>{try{let t,l=e.length>0?e:s,r=l.map(e=>{let t=e.items.reduce((e,t)=>e+t.price*t.quantity,0),s=e.items.reduce((e,t)=>e+(t.discountAmount||0),0),a=(t-s)*(1+(e.taxRate||0)/100);return{receipt_number:e.receiptNumber,customer_name:e.customerName,total_amount:a,payment_status:e.paymentStatus.toLowerCase(),created_at:e.date.toISOString(),sale_date:e.date.toISOString().split("T")[0],items:e.items.map(e=>({product_name:e.description,quantity:e.quantity,price:e.price,total:e.price*e.quantity,discount_amount:e.discountAmount||0,discount_percentage:e.discountPercentage||0,discount_type:e.discountType||void 0}))}});if(o)t={from:o,to:o};else if(c?.from&&c?.to)t=c;else if(i&&"all"!==i)t=(0,j.getDateRangeFromFilter)(i);else if(l.length>0){let e=l.map(e=>e.date),s=new Date(Math.min(...e.map(e=>e.getTime()))),a=new Date(Math.max(...e.map(e=>e.getTime())));t={from:s,to:a}}else{let e=new Date;t={from:e,to:e}}((e,t,s="USD",a,l)=>{let r,n=new h.default({orientation:"landscape",unit:"mm",format:"a4",compress:!0}),i=n.internal.pageSize.getWidth(),c=n.internal.pageSize.getHeight(),o=i-15-15,d=15,m=()=>{n.setFontSize(8),n.setFont("helvetica","normal"),n.setTextColor(150,150,150),n.text("Created By Gonza Systems",i/2,c-10,{align:"center"}),n.setTextColor(0,0,0)},u=[18,20,28,45,16,20,22,18,20,18,28],g=["Receipt #","Date","Customer","Items","Qty","Unit Price","Subtotal","Discount","Net","Tax","Total"],p=()=>{n.setFillColor(243,244,246),n.rect(15,d-2,o,12,"F"),n.setLineWidth(.3),n.rect(15,d-2,o,12),n.setFontSize(9),n.setFont("helvetica","bold");let e=15;g.forEach((t,s)=>{let a=u[s],l=n.getTextWidth(t),r=e+(a-l)/2;n.text(t,r,d+7),s<g.length-1&&n.line(e+a,d-2,e+a,d+12-2),e+=a}),d+=12},j=e=>d+e>c-15-15&&(m(),n.addPage(),d=15,p(),n.setFont("helvetica","normal"),n.setFontSize(8),!0),f=d;l&&(n.setFontSize(12),n.setFont("helvetica","bold"),n.text(l.businessName,15,d),d+=6,n.setFontSize(9),n.setFont("helvetica","normal"),n.text(l.businessAddress,15,d),d+=5,n.text(l.businessPhone,15,d),d+=5,n.text(l.businessEmail,15,d)),d=f,n.setFontSize(20),n.setFont("helvetica","bold");let b=`Comprehensive Sales Report (${s})`,y=n.getTextWidth(b);if(n.text(b,i-15-y,d),d+=12,a?.from&&a?.to){n.setFontSize(14),n.setFont("helvetica","normal");let e=(0,x.format)(a.from,"dd/MM/yyyy"),t=(0,x.format)(a.to,"dd/MM/yyyy"),s=e===t?e:`${e} - ${t}`,l=n.getTextWidth(s);n.text(s,i-15-l,d),d+=15}else{n.setFontSize(14),n.setFont("helvetica","normal");let e=(0,x.format)(new Date,"dd/MM/yyyy"),t=n.getTextWidth(e);n.text(e,i-15-t,d),d+=15}if(d=Math.max(d,f+25),0===e.length){n.setFontSize(16),n.setFont("helvetica","normal");let e="No sales data available for the selected period.",t=n.getTextWidth(e);n.text(e,(i-t)/2,d+30)}else{j(22),p(),n.setFont("helvetica","normal"),n.setFontSize(8);let t=new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0,useGrouping:!0}),s=0;e.forEach(e=>{let a=e.items.reduce((e,t)=>e+t.total,0)-e.items.reduce((e,t)=>e+(t.discount_amount||0),0),l=e.total_amount-a,r=a>0?l/a:0;e.items.forEach((a,l)=>{j(13);let i=a.discount_amount||0,c=a.total-i,m=c*r,h=[0===l?e.receipt_number:"",0===l?(0,x.format)(new Date(e.sale_date),"dd/MM/yyyy"):"",0===l?e.customer_name||"Walk-in":"",a.product_name,a.quantity.toString(),t.format(a.price),t.format(a.total),i>0?t.format(i):"-",t.format(c),t.format(m),t.format(c+m)];s%2==0&&(n.setFillColor(249,250,251),n.rect(15,d-1,o,8,"F")),n.setLineWidth(.1),n.rect(15,d-1,o,8);let g=15;h.forEach((e,t)=>{let s=u[t],a=e;if(2===t)for(;n.getTextWidth(a)>s-4&&a.length>3;)a=a.substring(0,a.length-4)+"...";else if(3===t)for(;n.getTextWidth(a)>s-4&&a.length>5;)a=a.substring(0,a.length-4)+"...";else if(t>=4)for(;n.getTextWidth(a)>s-4&&a.length>3;)a=a.includes(",")?a.replace(/,/g,""):a.substring(0,a.length-1);let l=g+2;if(t>=4){let e=n.getTextWidth(a);l=g+s-e-2}n.text(a,l,d+5),t<h.length-1&&n.line(g+s,d-1,g+s,d+8-1),g+=s}),d+=8}),s++}),d+=15,j(60),n.setFontSize(18),n.setFont("helvetica","bold"),n.text("Comprehensive Sales Summary",15,d),d+=10;let a=e.length,l=e.reduce((e,t)=>e+t.total_amount,0),r=e.reduce((e,t)=>e+t.items.reduce((e,t)=>e+t.total,0),0),i=e.reduce((e,t)=>e+t.items.reduce((e,t)=>e+(t.discount_amount||0),0),0),c=r-i,m=e.reduce((e,t)=>e+t.items.reduce((e,t)=>e+t.quantity,0),0),h=e.filter(e=>"paid"===e.payment_status.toLowerCase()).length,g=e.filter(e=>"not paid"===e.payment_status.toLowerCase()).length,f=e.filter(e=>"quote"===e.payment_status.toLowerCase()).length,b=e.filter(e=>"installment sale"===e.payment_status.toLowerCase()).length,y=a>0?m/a:0,N=a>0?i/a:0,v=r>0?i/r*100:0;n.setFillColor(248,249,250),n.rect(15,d-3,o,60,"F"),n.setLineWidth(.3),n.setDrawColor(200,200,200),n.rect(15,d-3,o,60),n.setFontSize(10),n.setFont("helvetica","normal");let S=[["Total Sales:",a.toString()],["Total Items Sold:",m.toString()],["Average Items/Sale:",y.toFixed(1)],["Paid Sales:",h.toString()],["Pending Sales:",g.toString()],["Avg Discount/Sale:",t.format(N)]],C=[["Total Amount:",t.format(l)],["Subtotal (before discount):",t.format(r)],["Total Discounts:",t.format(i)],["Net Amount (after discount):",t.format(c)],["Total Tax:",t.format(l-c)],["Discount Rate:",`${v.toFixed(1)}%`]],w=d+6,T=30,D=15+o/2+15;S.forEach(([e,t])=>{n.setFont("helvetica","bold"),n.text(e,T,w),n.setFont("helvetica","normal");let s=n.getTextWidth(e);n.text(t,T+s+5,w),w+=7}),w=d+6,C.forEach(([e,t])=>{n.setFont("helvetica","bold"),n.text(e,D,w),n.setFont("helvetica","normal");let s=n.getTextWidth(e);n.text(t,D+s+5,w),w+=7}),(f>0||b>0)&&(d+=70,j(25),n.setFontSize(14),n.setFont("helvetica","bold"),n.text("Payment Status Breakdown",15,d),d+=8,n.setFontSize(10),n.setFont("helvetica","normal"),[[`Quotes: ${f}`,`Installment Sales: ${b}`]].forEach(([e,t])=>{n.text(e,T,d),n.text(t,D,d),d+=6}))}if(m(),a?.from&&a?.to){let e=(0,x.format)(a.from,"yyyy-MM-dd"),t=(0,x.format)(a.to,"yyyy-MM-dd");r=e===t?`sales_report_${e}.pdf`:`sales_report_${e}_to_${t}.pdf`}else r=`sales_report_${(0,x.format)(new Date,"yyyy-MM-dd")}.pdf`;n.save(r)})(r,0,a,t,{businessName:y.businessName,businessAddress:y.businessAddress,businessPhone:y.businessPhone,businessEmail:y.businessEmail}),b({title:"Report Generated",description:"PDF sales report has been created successfully."})}catch(e){console.error("Error generating PDF report:",e),b({title:"Error",description:"Failed to generate PDF report. Please try again.",variant:"destructive"})}};return(0,t.jsxs)("div",{className:"flex flex-col gap-3 w-full",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,t.jsxs)(r.Button,{onClick:()=>{(e=>{let t=new Blob([["Receipt #,Date,Customer,Items,Items Count,Total Amount,Amount Paid,Amount Due,Status",...e.map(e=>{let t=e.items.reduce((e,t)=>e+t.price*t.quantity,0),s=e.items.map(e=>e.description).join("; ");return[e.receiptNumber,(0,x.format)(new Date(e.date),"yyyy-MM-dd HH:mm"),e.customerName,s,e.items.length.toString(),t.toFixed(2),(e.amountPaid||0).toFixed(2),(e.amountDue||0).toFixed(2),e.paymentStatus]}).map(e=>e.map(e=>`"${e.toString().replace(/"/g,'""')}"`).join(","))].join("\n")],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a");if(void 0!==s.download){let e=URL.createObjectURL(t);s.setAttribute("href",e),s.setAttribute("download",`sales_export_${(0,x.format)(new Date,"yyyy-MM-dd_HHmm")}.csv`),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s)}})(e.length>0?e:s)},variant:"outline",size:"lg",className:"gap-2 h-12 text-sm border-border/50 font-medium",children:[(0,t.jsx)(m.FileDown,{className:"h-4 w-4 shrink-0"}),"CSV"]}),(0,t.jsxs)(r.Button,{onClick:v,variant:"outline",size:"lg",className:"gap-2 h-12 text-sm border-border/50 font-medium",children:[(0,t.jsx)(n.FileText,{className:"h-4 w-4 shrink-0"}),"PDF"]})]}),N("sales","create")&&(0,t.jsxs)(r.Button,{onClick:()=>d.push("/new-sale"),size:"lg",className:"w-full gap-2 h-12 text-sm font-medium",children:[(0,t.jsx)(u.Plus,{className:"h-4 w-4 shrink-0"}),"New Sale"]})]})};var y=e.i(793479),N=e.i(967489),v=e.i(87316),S=e.i(337822),C=e.i(227766),w=e.i(555436),T=e.i(797548),D=e.i(751975),k=e.i(975252),P=e.i(830999);let F=({searchQuery:e,setSearchQuery:s,paymentFilter:a,setPaymentFilter:l,cashTransactionFilter:n,setCashTransactionFilter:i,categoryFilter:c,setCategoryFilter:o,dateFilter:d,setDateFilter:m,dateRange:u,setDateRange:h,specificDate:g,setSpecificDate:p,isCustomRange:j,isSpecificDate:f,sortOrder:b="desc",setSortOrder:F})=>{let{categories:I}=(0,P.useSalesCategories)();return(0,t.jsxs)("div",{className:"mb-6 space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-4",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(w.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(y.Input,{placeholder:"Search by customer, item, or receipt number...",className:"pl-10 bg-white border-border/50 focus:border-primary h-10",value:e,onChange:e=>{s(e.target.value)}})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-3",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 z-10 pointer-events-none",children:(0,t.jsx)(T.Filter,{className:"h-4 w-4 text-muted-foreground"})}),(0,t.jsxs)(N.Select,{value:a,onValueChange:l,children:[(0,t.jsx)(N.SelectTrigger,{className:"bg-white border-border/50 pl-10 h-10",children:(0,t.jsx)(N.SelectValue,{placeholder:"Payment Status"})}),(0,t.jsxs)(N.SelectContent,{className:"bg-white shadow-lg border border-border/50",children:[(0,t.jsx)(N.SelectItem,{value:"all",children:"All Payment Statuses"}),(0,t.jsx)(N.SelectItem,{value:"Paid",children:"Paid"}),(0,t.jsx)(N.SelectItem,{value:"NOT PAID",children:"NOT PAID"}),(0,t.jsx)(N.SelectItem,{value:"Quote",children:"Quote"}),(0,t.jsx)(N.SelectItem,{value:"Installment Sale",children:"Installment Sale"})]})]})]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 z-10 pointer-events-none",children:(0,t.jsx)(T.Filter,{className:"h-4 w-4 text-muted-foreground"})}),(0,t.jsxs)(N.Select,{value:n,onValueChange:i,children:[(0,t.jsx)(N.SelectTrigger,{className:"bg-white border-border/50 pl-10 h-10",children:(0,t.jsx)(N.SelectValue,{placeholder:"Cash Transaction"})}),(0,t.jsxs)(N.SelectContent,{className:"bg-white shadow-lg border border-border/50",children:[(0,t.jsx)(N.SelectItem,{value:"all",children:"All Sales"}),(0,t.jsx)(N.SelectItem,{value:"linked",children:"Linked to Cash"}),(0,t.jsx)(N.SelectItem,{value:"unlinked",children:"Not Linked to Cash"})]})]})]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 z-10 pointer-events-none",children:(0,t.jsx)(D.Tag,{className:"h-4 w-4 text-muted-foreground"})}),(0,t.jsxs)(N.Select,{value:c,onValueChange:o,children:[(0,t.jsx)(N.SelectTrigger,{className:"bg-white border-border/50 pl-10 h-10",children:(0,t.jsx)(N.SelectValue,{placeholder:"Category"})}),(0,t.jsxs)(N.SelectContent,{className:"bg-white shadow-lg border border-border/50",children:[(0,t.jsx)(N.SelectItem,{value:"all",children:"All Categories"}),(0,t.jsx)(N.SelectItem,{value:"none",children:"No Source"}),I.map(e=>(0,t.jsx)(N.SelectItem,{value:e.id,children:e.name},e.id))]})]})]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 z-10 pointer-events-none",children:(0,t.jsx)(v.Calendar,{className:"h-4 w-4 text-muted-foreground"})}),(0,t.jsxs)(N.Select,{value:d,onValueChange:e=>{m(e)},children:[(0,t.jsx)(N.SelectTrigger,{className:"bg-white border-border/50 pl-10 h-10",children:(0,t.jsx)(N.SelectValue,{placeholder:"Date Range"})}),(0,t.jsxs)(N.SelectContent,{className:"bg-white shadow-lg border border-border/50",children:[(0,t.jsx)(N.SelectItem,{value:"today",children:"Today"}),(0,t.jsx)(N.SelectItem,{value:"yesterday",children:"Yesterday"}),(0,t.jsx)(N.SelectItem,{value:"this-week",children:"This Week"}),(0,t.jsx)(N.SelectItem,{value:"last-week",children:"Last Week"}),(0,t.jsx)(N.SelectItem,{value:"this-month",children:"This Month"}),(0,t.jsx)(N.SelectItem,{value:"last-month",children:"Last Month"}),(0,t.jsx)(N.SelectItem,{value:"this-year",children:"This Year"}),(0,t.jsx)(N.SelectItem,{value:"specific",children:"Specific Date"}),(0,t.jsx)(N.SelectItem,{value:"custom",children:"Custom Range"}),(0,t.jsx)(N.SelectItem,{value:"all",children:"All Time"})]})]})]})]})]}),f&&(0,t.jsx)("div",{className:"pt-2 pb-1 border-t border-border/20",children:(0,t.jsx)("div",{className:"flex items-center space-x-2",children:(0,t.jsxs)(S.Popover,{children:[(0,t.jsx)(S.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)(r.Button,{variant:"outline",className:"bg-white flex items-center gap-2 h-10 pl-3 text-left font-normal",children:[(0,t.jsx)(v.Calendar,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:g?(0,x.format)(g,"MMM d, yyyy"):"Select Date"})]})}),(0,t.jsx)(S.PopoverContent,{className:"w-auto p-0 z-[100] bg-white shadow-lg",align:"start",children:(0,t.jsx)(C.Calendar,{initialFocus:!0,mode:"single",defaultMonth:g,selected:g,onSelect:p,className:"p-3 pointer-events-auto",showOutsideDays:!0})})]})})}),j&&(0,t.jsx)("div",{className:"pt-2 pb-1 border-t border-border/20",children:(0,t.jsx)(k.default,{dateRange:u,onDateRangeChange:h})})]})};var I=e.i(487486),A=e.i(303281),M=e.i(688511),R=e.i(727612),B=e.i(475254);let O=(0,B.default)("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);var z=e.i(686311),$=e.i(746798),H=e.i(975157),E=e.i(966265),L=e.i(98363),_=e.i(414877),W=e.i(798532),q=e.i(416610),V=e.i(392401);let Q=({sale:e,currency:s,onViewReceipt:a,onEditSale:l,onDeleteSale:i,onSendPaymentReminder:c,onSendThankYouNotice:o,onSendPaymentReminderSMS:m,onSendThankYouSMS:u})=>{let{accounts:h}=(0,E.useCashAccounts)(),{transactions:g}=(0,L.useCashTransactions)(),p=(0,_.useIsMobile)(),{payments:j}=(0,q.useInstallmentPayments)(e.id),{hasPermission:b}=(0,f.useProfiles)(),{formatFinancial:y,canViewCostPrice:N,canViewProfit:v}=(0,V.useFinancialVisibility)(),S=e.items.reduce((e,t)=>e+t.quantity,0),C=e.items.reduce((e,t)=>e+t.price,0),w=S>0?C/e.items.length:0,T=e.items.reduce((e,t)=>{let s=t.price*t.quantity,a="amount"===t.discountType?t.discountAmount||0:s*(t.discountPercentage||0)/100;return e+(s-a)},0),D=e.items.reduce((e,t)=>{let s=t.price*t.quantity;return e+("amount"===t.discountType?t.discountAmount||0:s*(t.discountPercentage||0)/100)},0),k=T+(e.taxRate||0)/100*T,P=e.items.reduce((e,t)=>e+t.cost*t.quantity,0),F="No items";e.items&&Array.isArray(e.items)&&e.items.length>0&&(F=e.items[0].description,e.items.length>1&&(F+=` (+${e.items.length-1} more)`));let B=(()=>{if(!e.cashTransactionId)return console.log("No cash transaction ID for sale:",e.id),null;console.log("Looking for transaction with ID:",e.cashTransactionId),console.log("Available transactions count:",g.length);let t=g.find(t=>t.id===e.cashTransactionId);if(!t)return console.log("No linked transaction found for sale:",e.id,"transaction ID:",e.cashTransactionId),console.log("All transaction IDs:",g.map(e=>e.id)),null;if(console.log("Found linked transaction:",t),!t.accountId)return console.log("Linked transaction has no accountId:",t),null;let s=h.find(e=>e.id===t.accountId);return s?(console.log("Successfully resolved cash account:",s.name),s.name):(console.log("No linked account found for accountId:",t.accountId),console.log("Available accounts:",h.map(e=>({id:e.id,name:e.name}))),null)})(),Q="Installment Sale"===e.paymentStatus?j.reduce((e,t)=>e+t.amount,0):e.amountPaid||0,U="Installment Sale"===e.paymentStatus?Math.max(0,k-Q):e.amountDue||0,Y="NOT PAID"===e.paymentStatus,G="Installment Sale"===e.paymentStatus&&U>0,K={phoneNumber:e.customerContact||null},X=(0,W.canSendSMS)(K),J=p&&X;return(0,t.jsxs)(d.TableRow,{className:"cursor-pointer hover:bg-gray-50",onClick:()=>a(e),children:[(0,t.jsx)(d.TableCell,{className:"font-medium",children:(0,x.format)(new Date(e.date),"dd/MM/yyyy")}),(0,t.jsx)(d.TableCell,{children:e.receiptNumber}),(0,t.jsx)(d.TableCell,{children:(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("div",{children:e.customerName}),B&&(0,t.jsx)(I.Badge,{variant:"outline",className:"text-xs bg-green-50 text-green-700 border-green-200",children:B}),"Installment Sale"===e.paymentStatus&&U>0&&(0,t.jsxs)(I.Badge,{variant:"outline",className:"text-xs bg-red-50 text-red-700 border-red-200",children:["Due: ",s," ",(0,H.formatNumber)(U)]})]})}),(0,t.jsx)(d.TableCell,{children:(0,t.jsxs)($.Tooltip,{children:[(0,t.jsx)($.TooltipTrigger,{asChild:!0,children:(0,t.jsx)("span",{className:"line-clamp-1 cursor-help",children:F})}),(0,t.jsx)($.TooltipContent,{side:"top",className:"max-w-xs",children:(0,t.jsx)("div",{className:"space-y-1",children:(0,t.jsx)("p",{className:"font-bold break-words whitespace-normal",children:F})})})]})}),(0,t.jsx)(d.TableCell,{className:"text-right",children:S}),(0,t.jsxs)(d.TableCell,{className:"text-right",children:[s," ",(0,H.formatNumber)(w)]}),(0,t.jsx)(d.TableCell,{className:"text-right",children:D>0?(0,t.jsxs)("span",{className:"text-orange-600",children:["-",s," ",(0,H.formatNumber)(D)]}):(0,t.jsx)("span",{className:"text-gray-400",children:"-"})}),(0,t.jsx)(d.TableCell,{className:"text-right",children:N?`${s} ${y(P,"cost")}`:"•••"}),(0,t.jsx)(d.TableCell,{className:"text-right",children:(0,t.jsx)("span",{className:"text-green-600 font-medium",children:v?`${s} ${(0,H.formatNumber)(k-P)}`:"•••"})}),(0,t.jsxs)(d.TableCell,{className:"text-right",children:[s," ",(0,H.formatNumber)(k),"Installment Sale"===e.paymentStatus&&Q>0&&(0,t.jsxs)("div",{className:"text-xs text-green-600",children:["Paid: ",s," ",(0,H.formatNumber)(Q)]})]}),(0,t.jsx)(d.TableCell,{children:(0,t.jsx)("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${(()=>{switch(e.paymentStatus){case"Paid":return"bg-green-100 text-green-800";case"Quote":return"bg-purple-100 text-purple-800";case"Installment Sale":return"bg-blue-100 text-blue-800";default:return"bg-yellow-100 text-yellow-800"}})()}`,children:"Installment Sale"===e.paymentStatus?"Installment":e.paymentStatus})}),(0,t.jsx)(d.TableCell,{onClick:e=>e.stopPropagation(),children:(0,t.jsxs)("div",{className:"flex justify-end gap-1",children:[(0,t.jsxs)(r.Button,{variant:"ghost",size:"sm",onClick:t=>{t.stopPropagation(),a(e)},children:[(0,t.jsx)(A.Printer,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"View Receipt"})]}),Y&&c&&(0,t.jsxs)(r.Button,{variant:"ghost",size:"sm",onClick:t=>{t.stopPropagation(),c(e)},className:"text-orange-600 hover:text-orange-700 hover:bg-orange-50",title:"Send Payment Reminder",children:[(0,t.jsx)(n.FileText,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Send Payment Reminder"})]}),G&&c&&(0,t.jsxs)(r.Button,{variant:"ghost",size:"sm",onClick:t=>{t.stopPropagation(),c(e)},className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50",title:"Send Due Payment Reminder",children:[(0,t.jsx)(n.FileText,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Send Due Payment Reminder"})]}),Y&&J&&m&&(0,t.jsxs)(r.Button,{variant:"ghost",size:"sm",onClick:t=>{t.stopPropagation(),m(e)},className:"text-orange-600 hover:text-orange-700 hover:bg-orange-50",title:"Send Payment Reminder SMS",children:[(0,t.jsx)(z.MessageSquare,{className:"h-3 w-3"}),(0,t.jsx)("span",{className:"sr-only",children:"Send Payment Reminder SMS"})]}),o&&(0,t.jsxs)(r.Button,{variant:"ghost",size:"sm",onClick:t=>{t.stopPropagation(),o(e)},className:"text-purple-600 hover:text-purple-700 hover:bg-purple-50",title:"Send Thank You Notice",children:[(0,t.jsx)(O,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Send Thank You Notice"})]}),J&&u&&(0,t.jsxs)(r.Button,{variant:"ghost",size:"sm",onClick:t=>{t.stopPropagation(),u(e)},className:"text-purple-600 hover:text-purple-700 hover:bg-purple-50",title:"Send Thank You SMS",children:[(0,t.jsx)(z.MessageSquare,{className:"h-3 w-3"}),(0,t.jsx)("span",{className:"sr-only",children:"Send Thank You SMS"})]}),b("sales","edit")&&(0,t.jsxs)(r.Button,{variant:"ghost",size:"sm",onClick:t=>{t.stopPropagation(),l(e)},children:[(0,t.jsx)(M.Edit,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Edit Sale"})]}),b("sales","delete")&&(0,t.jsxs)(r.Button,{variant:"ghost",size:"sm",onClick:t=>{t.stopPropagation(),i(e)},children:[(0,t.jsx)(R.Trash2,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Delete Sale"})]})]})})]})};var U=e.i(318585),Y=e.i(868499);let G=({isOpen:e,onOpenChange:s,onConfirm:a,isDeleting:l=!1})=>(0,t.jsx)(Y.AlertDialog,{open:e,onOpenChange:s,children:(0,t.jsxs)(Y.AlertDialogContent,{children:[(0,t.jsxs)(Y.AlertDialogHeader,{children:[(0,t.jsx)(Y.AlertDialogTitle,{children:"Are you sure?"}),(0,t.jsx)(Y.AlertDialogDescription,{children:"This action cannot be undone. This will permanently delete this sale record."})]}),(0,t.jsxs)(Y.AlertDialogFooter,{children:[(0,t.jsx)(Y.AlertDialogCancel,{disabled:l,children:"Cancel"}),(0,t.jsx)(Y.AlertDialogAction,{onClick:a,disabled:l,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90 disabled:opacity-50",children:l?"Deleting...":"Delete"})]})]})});var K=e.i(697068),X=e.i(938229),J=e.i(110204),Z=e.i(776639);let ee=()=>{let{categories:e,createCategory:a,updateCategory:l,deleteCategory:n,createDefaultCategories:i}=(0,P.useSalesCategories)(),[c,o]=(0,s.useState)(!1),[d,m]=(0,s.useState)(""),[x,h]=(0,s.useState)(null),[g,p]=(0,s.useState)(""),[j,f]=(0,s.useState)(!1),[b,N]=(0,s.useState)(null),v=async()=>{!d.trim()||await a(d.trim())&&m("")},S=async()=>{x&&g.trim()&&await l(x.id,g.trim())&&(h(null),p(""))},C=async()=>{!b||await n(b.id)&&(f(!1),N(null))},w=async()=>{await i()};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(Z.Dialog,{open:c,onOpenChange:o,children:[(0,t.jsx)(Z.DialogTrigger,{asChild:!0}),(0,t.jsxs)(Z.DialogContent,{className:"max-w-2xl",children:[(0,t.jsx)(Z.DialogHeader,{children:(0,t.jsx)(Z.DialogTitle,{children:"Manage Sales Categories"})}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(J.Label,{htmlFor:"new-category",children:"Add New Category"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(y.Input,{id:"new-category",placeholder:"Category name",value:d,onChange:e=>m(e.target.value),onKeyPress:e=>"Enter"===e.key&&v()}),(0,t.jsxs)(r.Button,{onClick:v,disabled:!d.trim(),children:[(0,t.jsx)(u.Plus,{className:"h-4 w-4 mr-2"}),"Add"]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)(J.Label,{children:"Existing Categories"}),0===e.length&&(0,t.jsx)(r.Button,{variant:"outline",size:"sm",onClick:w,children:"Create Default Categories"})]}),e.length>0?(0,t.jsx)("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:e.map(e=>(0,t.jsx)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:x?.id===e.id?(0,t.jsxs)("div",{className:"flex gap-2 flex-1",children:[(0,t.jsx)(y.Input,{value:g,onChange:e=>p(e.target.value),onKeyPress:e=>"Enter"===e.key&&S(),className:"flex-1"}),(0,t.jsx)(r.Button,{size:"sm",onClick:S,children:"Save"}),(0,t.jsx)(r.Button,{size:"sm",variant:"outline",onClick:()=>h(null),children:"Cancel"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"font-medium",children:e.name}),e.is_default&&(0,t.jsx)("span",{className:"text-xs bg-muted px-2 py-1 rounded",children:"Default"})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(r.Button,{size:"sm",variant:"outline",onClick:()=>{h(e),p(e.name)},children:(0,t.jsx)(M.Edit,{className:"h-4 w-4"})}),(0,t.jsx)(r.Button,{size:"sm",variant:"outline",onClick:()=>{N(e),f(!0)},children:(0,t.jsx)(R.Trash2,{className:"h-4 w-4"})})]})]})},e.id))}):(0,t.jsx)("p",{className:"text-muted-foreground text-sm",children:"No categories found. Create your first category above."})]})]})]})]}),(0,t.jsx)(Y.AlertDialog,{open:j,onOpenChange:f,children:(0,t.jsxs)(Y.AlertDialogContent,{children:[(0,t.jsxs)(Y.AlertDialogHeader,{children:[(0,t.jsx)(Y.AlertDialogTitle,{children:"Delete Category"}),(0,t.jsxs)(Y.AlertDialogDescription,{children:['Are you sure you want to delete "',b?.name,'"? This action cannot be undone.']})]}),(0,t.jsxs)(Y.AlertDialogFooter,{children:[(0,t.jsx)(Y.AlertDialogCancel,{children:"Cancel"}),(0,t.jsx)(Y.AlertDialogAction,{onClick:C,children:"Delete"})]})]})})]})};var et=e.i(515288),es=e.i(25652),ea=e.i(212426),el=e.i(252754);let er=({sales:e,currency:a})=>{let{formatFinancial:l,canViewCostPrice:r,canViewProfit:n,canViewTotalAmount:i,canViewSellingPrice:c}=(0,V.useFinancialVisibility)(),o=(0,s.useMemo)(()=>e.reduce((e,t)=>{let s=t.items.reduce((e,t)=>{let s=t.price*t.quantity,a="amount"===t.discountType?t.discountAmount||0:s*(t.discountPercentage||0)/100;return e+(s-a)},0),a=s+(t.taxRate||0)/100*s,l=t.items.reduce((e,t)=>e+t.cost*t.quantity,0);return{totalSales:e.totalSales+a,totalCost:e.totalCost+l,totalProfit:e.totalProfit+(a-l)}},{totalSales:0,totalCost:0,totalProfit:0}),[e]);return(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[(0,t.jsx)(et.Card,{className:"bg-blue-50 border-blue-100",children:(0,t.jsxs)(et.CardContent,{className:"p-6 flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-medium text-blue-600 mb-1",children:"Total Sales"}),(0,t.jsx)("h3",{className:"text-2xl font-bold text-blue-900",children:i||c?`${a} ${(0,H.formatNumber)(o.totalSales)}`:"•••"}),(0,t.jsxs)("p",{className:"text-xs text-blue-500 mt-1",children:["Based on ",e.length," records"]})]}),(0,t.jsx)("div",{className:"h-12 w-12 bg-blue-100 rounded-full flex items-center justify-center",children:(0,t.jsx)(es.TrendingUp,{className:"h-6 w-6 text-blue-600"})})]})}),(0,t.jsx)(et.Card,{className:"bg-orange-50 border-orange-100",children:(0,t.jsxs)(et.CardContent,{className:"p-6 flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-medium text-orange-600 mb-1",children:"Total Cost"}),(0,t.jsx)("h3",{className:"text-2xl font-bold text-orange-900",children:r?`${a} ${(0,H.formatNumber)(o.totalCost)}`:"•••"}),(0,t.jsx)("p",{className:"text-xs text-orange-500 mt-1",children:"Cost of goods sold"})]}),(0,t.jsx)("div",{className:"h-12 w-12 bg-orange-100 rounded-full flex items-center justify-center",children:(0,t.jsx)(el.Wallet,{className:"h-6 w-6 text-orange-600"})})]})}),(0,t.jsx)(et.Card,{className:"bg-green-50 border-green-100",children:(0,t.jsxs)(et.CardContent,{className:"p-6 flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-medium text-green-600 mb-1",children:"Total Profit"}),(0,t.jsx)("h3",{className:"text-2xl font-bold text-green-900",children:n?`${a} ${(0,H.formatNumber)(o.totalProfit)}`:"•••"}),(0,t.jsx)("p",{className:"text-xs text-green-500 mt-1",children:"Net earnings"})]}),(0,t.jsx)("div",{className:"h-12 w-12 bg-green-100 rounded-full flex items-center justify-center",children:(0,t.jsx)(ea.DollarSign,{className:"h-6 w-6 text-green-600"})})]})})]})};var en=e.i(550516),ei=e.i(122812),ec=e.i(350627),eo=e.i(865960);let ed={businessName:"Your Business Name",businessAddress:"Your Business Address",businessPhone:"(123) 456-7890",businessEmail:"support@yourbusiness.com",businessLogo:"",currency:"UGX"},em=s.default.memo(({sale:e,settings:s,onViewReceipt:a,onEditSale:l,onDeleteSale:i,onSendPaymentReminder:c,onSendThankYouNotice:o,cashAccountName:d})=>{let{payments:m}=(0,q.useInstallmentPayments)(e.id),{hasPermission:u}=(0,f.useProfiles)(),{canViewCostPrice:x,canViewProfit:h,canViewSellingPrice:g,canViewTotalAmount:p}=(0,V.useFinancialVisibility)(),j=e.items.reduce((e,t)=>{let s=t.price*t.quantity,a="amount"===t.discountType?t.discountAmount||0:s*(t.discountPercentage||0)/100;return e+(s-a)},0),b=e.items.reduce((e,t)=>{let s=t.price*t.quantity;return e+("amount"===t.discountType?t.discountAmount||0:s*(t.discountPercentage||0)/100)},0),y=e.taxRate||0,N=j+y/100*j,v=e.items.reduce((e,t)=>e+t.cost*t.quantity,0),S="Installment Sale"===e.paymentStatus?m.reduce((e,t)=>e+t.amount,0):e.amountPaid||0,C="Installment Sale"===e.paymentStatus?Math.max(0,N-S):e.amountDue||0,w="No items";e.items&&Array.isArray(e.items)&&e.items.length>0&&(w=e.items[0].description,e.items.length>1&&(w+=` (+${e.items.length-1} more)`));let T="NOT PAID"===e.paymentStatus,D="Installment Sale"===e.paymentStatus&&C>0,k=(()=>{switch(e.paymentStatus){case"Paid":default:return ec.Receipt;case"NOT PAID":return n.FileText;case"Quote":return eo.Quote}})(),P=(()=>{switch(e.paymentStatus){case"Paid":default:return"Receipt";case"NOT PAID":return"Invoice";case"Quote":return"Quotation"}})();return(0,t.jsx)(et.Card,{className:`mb-3 bg-white border shadow-sm ${d?"border-l-4 border-l-green-500 border-green-200":"border-gray-200"}`,children:(0,t.jsxs)(et.CardContent,{className:"p-4",children:[d&&(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2 p-2 bg-green-50 rounded-md border border-green-200",children:[(0,t.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full flex-shrink-0"}),(0,t.jsxs)("span",{className:"text-xs font-medium text-green-700 truncate",children:["Linked to: ",d]})]}),(0,t.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,t.jsxs)("div",{className:"flex-1 min-w-0 pr-2",children:[(0,t.jsx)("p",{className:"font-semibold text-gray-900 text-sm truncate",children:e.customerName}),(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-0.5",children:new Date(e.date).toLocaleDateString("en-GB")}),"Installment Sale"===e.paymentStatus&&C>0&&(0,t.jsxs)(I.Badge,{variant:"outline",className:"text-xs bg-red-50 text-red-700 border-red-200 mt-1",children:["Due: ",g||p?`${s.currency} ${(0,H.formatNumber)(C)}`:"•••"]})]}),(0,t.jsx)("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium whitespace-nowrap ${(()=>{switch(e.paymentStatus){case"Paid":return"bg-green-100 text-green-700";case"Quote":return"bg-purple-100 text-purple-700";case"Installment Sale":return"bg-blue-100 text-blue-700";default:return"bg-yellow-100 text-yellow-700"}})()}`,children:"Installment Sale"===e.paymentStatus?"Installment":"NOT PAID"===e.paymentStatus?"Credit":e.paymentStatus})]}),(0,t.jsxs)($.Tooltip,{children:[(0,t.jsx)($.TooltipTrigger,{asChild:!0,children:(0,t.jsx)("p",{className:"text-xs text-gray-600 mb-3 line-clamp-1 cursor-help",children:w})}),(0,t.jsx)($.TooltipContent,{side:"top",className:"max-w-xs",children:(0,t.jsx)("div",{className:"space-y-1",children:(0,t.jsx)("p",{className:"font-bold break-words whitespace-normal",children:w})})})]}),(0,t.jsxs)("div",{className:"space-y-3 mb-3",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{className:"text-left",children:[(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"Cost"}),(0,t.jsx)("p",{className:"font-semibold text-gray-900",children:x?`${s.currency} ${(0,H.formatNumber)(v)}`:"•••"})]}),b>0?(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"Discount"}),(0,t.jsx)("p",{className:"font-semibold text-orange-600",children:g?`-${s.currency} ${(0,H.formatNumber)(b)}`:"•••"})]}):(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"Discount"}),(0,t.jsx)("p",{className:"font-semibold text-gray-400",children:"-"})]})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{className:"text-left",children:[(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"Total Amount"}),(0,t.jsx)("p",{className:"font-semibold text-gray-900",children:p||g?`${s.currency} ${(0,H.formatNumber)(N)}`:"•••"}),y>0&&(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"Tax incl."}),"Installment Sale"===e.paymentStatus&&S>0&&(0,t.jsxs)("p",{className:"text-xs text-green-600 mt-1",children:["Paid: ",p||g?`${s.currency} ${(0,H.formatNumber)(S)}`:"•••"]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"Profit"}),(0,t.jsx)("p",{className:"font-semibold text-green-600",children:h?`${s.currency} ${(0,H.formatNumber)(N-v)}`:"•••"})]})]})]}),(0,t.jsxs)("div",{className:"pt-3 border-t border-gray-100 space-y-2",children:[(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,t.jsxs)(r.Button,{variant:"outline",size:"sm",onClick:()=>a(e),className:"flex items-center gap-1.5 text-xs h-8 border-gray-200 flex-1 min-w-0",children:[(0,t.jsx)(k,{className:"h-3 w-3 flex-shrink-0"}),(0,t.jsx)("span",{className:"truncate",children:P})]}),T&&(0,t.jsxs)(r.Button,{variant:"outline",size:"sm",onClick:()=>c(e),className:"flex items-center gap-1.5 text-xs h-8 border-orange-200 text-orange-600 hover:bg-orange-50 flex-1 min-w-0",children:[(0,t.jsx)(n.FileText,{className:"h-3 w-3 flex-shrink-0"}),(0,t.jsx)("span",{className:"truncate",children:"Reminder"})]}),D&&(0,t.jsxs)(r.Button,{variant:"outline",size:"sm",onClick:()=>c(e),className:"flex items-center gap-1.5 text-xs h-8 border-blue-200 text-blue-600 hover:bg-blue-50 flex-1 min-w-0",children:[(0,t.jsx)(n.FileText,{className:"h-3 w-3 flex-shrink-0"}),(0,t.jsx)("span",{className:"truncate",children:"Due Reminder"})]}),(0,t.jsxs)(r.Button,{variant:"outline",size:"sm",onClick:()=>o(e),className:"flex items-center gap-1.5 text-xs h-8 border-purple-200 text-purple-600 hover:bg-purple-50 flex-1 min-w-0",children:[(0,t.jsx)(O,{className:"h-3 w-3 flex-shrink-0"}),(0,t.jsx)("span",{className:"truncate",children:"Thanks"})]})]}),(0,t.jsxs)("div",{className:"flex justify-center gap-2",children:[u("sales","edit")&&(0,t.jsxs)(r.Button,{variant:"ghost",size:"sm",onClick:()=>l(e),className:"h-8 px-3 hover:bg-blue-50 hover:text-blue-600 flex items-center gap-1",children:[(0,t.jsx)(M.Edit,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"text-xs",children:"Edit"})]}),u("sales","delete")&&(0,t.jsxs)(r.Button,{variant:"ghost",size:"sm",onClick:()=>i(e),className:"h-8 px-3 hover:bg-red-50 hover:text-red-600 flex items-center gap-1",children:[(0,t.jsx)(R.Trash2,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"text-xs",children:"Delete"})]})]})]})]})})});em.displayName="MobileCard";let eu=({sales:e,onViewReceipt:a,onEditSale:l,onDeleteSale:r,currency:c="USD",onDateFilterChange:o,onDateRangeChange:m,isLoading:u=!1,mobileOptimized:x=!1})=>{let[h,f]=(0,s.useState)({...ed,currency:c}),[y,N]=(0,s.useState)(null),[v,S]=(0,s.useState)(!1),[C,w]=(0,s.useState)(!1),[T,D]=(0,s.useState)(null),[k,P]=(0,s.useState)(!1),[I,A]=(0,s.useState)(null),[M,R]=(0,s.useState)(!1),{accounts:B}=(0,E.useCashAccounts)(),{transactions:O}=(0,L.useCashTransactions)(),{settings:z}=(0,p.useBusinessSettings)(),{toast:H}=(0,g.useToast)(),q=(0,_.useIsMobile)(),{searchQuery:V,setSearchQuery:Y,paymentFilter:J,setPaymentFilter:Z,cashTransactionFilter:et,setCashTransactionFilter:es,categoryFilter:ea,setCategoryFilter:el,dateFilter:eu,setDateFilter:ex,dateRange:eh,setDateRange:eg,specificDate:ep,setSpecificDate:ej,isCustomRange:ef,isSpecificDate:eb,filteredSales:ey}=(e=>{let t=(()=>{try{let e=localStorage.getItem("salesFilters");if(e){let t=JSON.parse(e);return{searchQuery:t.searchQuery||"",dateFilter:t.dateFilter||"this-month",paymentFilter:t.paymentFilter||"all",cashTransactionFilter:t.cashTransactionFilter||"all",categoryFilter:t.categoryFilter||"all",dateRange:t.dateRange?{from:t.dateRange.from?new Date(t.dateRange.from):void 0,to:t.dateRange.to?new Date(t.dateRange.to):void 0}:{from:void 0,to:void 0},specificDate:t.specificDate?new Date(t.specificDate):void 0}}}catch(e){console.error("Error loading persisted sales filters:",e)}return{searchQuery:"",dateFilter:"this-month",paymentFilter:"all",cashTransactionFilter:"all",categoryFilter:"all",dateRange:{from:void 0,to:void 0},specificDate:void 0}})(),[a,l]=(0,s.useState)(t.searchQuery),[r,n]=(0,s.useState)(t.paymentFilter),[i,c]=(0,s.useState)(t.cashTransactionFilter),[o,d]=(0,s.useState)(t.categoryFilter),[m,u]=(0,s.useState)(t.dateFilter),[x,h]=(0,s.useState)(t.dateRange),[g,p]=(0,s.useState)(t.specificDate);(0,s.useEffect)(()=>{let e={searchQuery:a,dateFilter:m,paymentFilter:r,cashTransactionFilter:i,categoryFilter:o,dateRange:{from:x.from?.toISOString(),to:x.to?.toISOString()},specificDate:g?.toISOString()};localStorage.setItem("salesFilters",JSON.stringify(e))},[a,m,r,i,o,x,g]);let f="custom"===m,b="specific"===m,y=(0,s.useMemo)(()=>{let t=[...e];if(a.trim()){let e=a.toLowerCase();t=t.filter(t=>t.customerName.toLowerCase().includes(e)||t.receiptNumber.toLowerCase().includes(e)||t.items.some(t=>t.description.toLowerCase().includes(e)))}if("all"!==r&&(t=t.filter(e=>e.paymentStatus===r)),"all"!==i&&("linked"===i?t=t.filter(e=>e.cashTransactionId):"unlinked"===i&&(t=t.filter(e=>!e.cashTransactionId))),"all"!==o&&(t="none"===o?t.filter(e=>!e.categoryId):t.filter(e=>e.categoryId===o)),"all"!==m)if(b&&g)t=t.filter(e=>{let t=new Date(e.date);return(0,en.isSameDay)(t,g)});else if(f&&x.from&&x.to){let e=x.from,s=x.to;t=t.filter(t=>{let a=new Date(t.date);return a>=e&&a<=s})}else{let e=(0,j.getDateRangeFromFilter)(m),s=e.from,a=e.to;t=t.filter(e=>{let t=new Date(e.date);return t>=s&&t<=a})}return t},[e,a,r,i,o,m,x,g,f,b]);return{searchQuery:a,setSearchQuery:l,paymentFilter:r,setPaymentFilter:n,cashTransactionFilter:i,setCashTransactionFilter:c,categoryFilter:o,setCategoryFilter:d,dateFilter:m,setDateFilter:u,dateRange:x,setDateRange:h,specificDate:g,setSpecificDate:p,isCustomRange:f,isSpecificDate:b,filteredSales:y}})(e),eN=(0,s.useMemo)(()=>ey,[ey]),{currentPage:ev,setCurrentPage:eS,paginatedItems:eC,totalPages:ew}=(0,ei.usePagination)({items:eN,itemsPerPage:x?5:10});(0,s.useEffect)(()=>{o&&o(eu)},[eu,o]),(0,s.useEffect)(()=>{m&&ef&&m(eh)},[eh,ef,m]),(0,s.useEffect)(()=>{f(e=>({...e,currency:c}));let e=localStorage.getItem("businessSettings");if(e){let t=JSON.parse(e);f({...t,currency:c||t.currency})}},[c]);let eT=(0,s.useCallback)(e=>{if(!e.cashTransactionId)return null;let t=O.find(t=>t.id===e.cashTransactionId);if(!t||!t.accountId)return null;let s=B.find(e=>e.id===t.accountId);return s?s.name:null},[O,B]);(0,s.useCallback)(e=>{switch(e){case"Paid":default:return"Receipt";case"NOT PAID":return"Invoice";case"Quote":return"Quotation"}},[]),(0,s.useCallback)(e=>{switch(e){case"Paid":default:return ec.Receipt;case"NOT PAID":return n.FileText;case"Quote":return eo.Quote}},[]);let eD=(0,s.useCallback)(e=>{N(e),S(!0)},[]),ek=(0,s.useCallback)(async()=>{if(y&&!C){w(!0);try{await r(y),S(!1),N(null)}finally{w(!1)}}},[y,r,C]),eP=(0,s.useCallback)(e=>{C||e||(S(!1),N(null))},[C]),eF=(0,s.useCallback)(e=>{D(e),P(!0)},[]),eI=(0,s.useCallback)(()=>{P(!1),D(null)},[]),eA=(0,s.useCallback)(async e=>{try{e.customerId,e.customerName,e.customerContact,e.customerAddress,e.items.reduce((e,t)=>e+t.price*t.quantity,0),e.taxRate,A(e),R(!0)}catch(e){console.error("Error generating payment reminder:",e),H({title:"Error",description:"Failed to generate payment reminder. Please try again.",variant:"destructive"})}},[z,h,H]);return((0,s.useCallback)(e=>{if(!(0,W.canSendSMS)({phoneNumber:e.customerContact}))return void H({title:"Phone number required",description:"Customer phone number is not available for WhatsApp.",variant:"destructive"});let t=(0,W.getThankYouMessage)(e,z||h);(0,W.openWhatsApp)({phoneNumber:e.customerContact,message:t}),H({title:"WhatsApp Opened",description:`Opening WhatsApp chat for ${e.customerName}`})},[z,h,H]),u)?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-[40vh] space-y-4",children:[(0,t.jsx)("img",{src:"/lovable-uploads/7f7549a3-e9df-4762-b8b9-8e041e34f55d.png",alt:"Loading",className:"w-12 h-12 animate-spin"}),(0,t.jsx)("p",{className:"text-muted-foreground text-sm",children:"Loading sales..."})]}):(0,t.jsx)($.TooltipProvider,{children:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-border/50",children:[(0,t.jsx)("div",{className:"p-4 sm:p-6 border-b border-border/50",children:(0,t.jsx)("div",{className:"flex flex-col gap-4",children:(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl sm:text-2xl font-bold text-foreground",children:"Sales Records"}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:[eN.length," ",1===eN.length?"record":"records"," found"]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(ee,{}),(0,t.jsx)("div",{className:"w-full sm:w-auto",children:(0,t.jsx)(b,{filteredSales:eN,allSales:e,currency:h.currency})})]})]})})}),(0,t.jsxs)("div",{className:"p-4 sm:p-6",children:[(0,t.jsx)(er,{sales:eN,currency:h.currency}),(0,t.jsx)(F,{searchQuery:V,setSearchQuery:Y,paymentFilter:J,setPaymentFilter:Z,cashTransactionFilter:et,setCashTransactionFilter:es,categoryFilter:ea,setCategoryFilter:el,dateFilter:eu,setDateFilter:ex,dateRange:eh,setDateRange:eg,specificDate:ep,setSpecificDate:ej,isCustomRange:ef,isSpecificDate:eb}),eN.length>0?(0,t.jsxs)(t.Fragment,{children:[q?(0,t.jsx)("div",{className:"space-y-3",children:eC.map(e=>(0,t.jsx)(em,{sale:e,settings:h,onViewReceipt:a,onEditSale:l,onDeleteSale:eD,onSendPaymentReminder:eA,onSendThankYouNotice:eF,cashAccountName:eT(e)},e.id))}):(0,t.jsx)("div",{className:"overflow-x-auto border rounded-lg",children:(0,t.jsxs)(d.Table,{children:[(0,t.jsx)(d.TableHeader,{children:(0,t.jsxs)(d.TableRow,{children:[(0,t.jsx)(d.TableHead,{children:"Date"}),(0,t.jsx)(d.TableHead,{children:"Receipt #"}),(0,t.jsx)(d.TableHead,{children:"Customer"}),(0,t.jsx)(d.TableHead,{children:"Item"}),(0,t.jsx)(d.TableHead,{className:"text-right",children:"Total Qty"}),(0,t.jsx)(d.TableHead,{className:"text-right",children:"Avg Price"}),(0,t.jsx)(d.TableHead,{className:"text-right",children:"Discount"}),(0,t.jsx)(d.TableHead,{className:"text-right",children:"Cost"}),(0,t.jsx)(d.TableHead,{className:"text-right",children:"Profit"}),(0,t.jsx)(d.TableHead,{className:"text-right",children:"Total (incl. Tax)"}),(0,t.jsx)(d.TableHead,{children:"Status"}),(0,t.jsx)(d.TableHead,{className:"text-right",children:"Actions"})]})}),(0,t.jsx)(d.TableBody,{children:eC.map(e=>(0,t.jsx)(Q,{sale:e,currency:h.currency,onViewReceipt:a,onEditSale:l,onDeleteSale:eD,onSendPaymentReminder:eA,onSendThankYouNotice:eF},e.id))})]})}),(0,t.jsx)("div",{className:"mt-6",children:(0,t.jsx)(U.default,{currentPage:ev,totalPages:ew,onPageChange:eS})})]}):(0,t.jsx)(i,{})]})]}),(0,t.jsx)(G,{isOpen:v,onOpenChange:eP,onConfirm:ek,isDeleting:C}),T&&(0,t.jsx)(K.default,{customer:{id:T.customerId||"",fullName:T.customerName,phoneNumber:T.customerContact||"",email:"",location:T.customerAddress||"",categoryId:null,createdAt:new Date,updatedAt:new Date,birthday:null,socialMedia:null,gender:null,tags:null,notes:null},open:k,onClose:eI,defaultTemplate:"thank_you",sale:T}),(0,t.jsx)(X.default,{isOpen:M,onOpenChange:R,sale:I})]})})},ex=({sales:e,onViewReceipt:a,onEditSale:l,onDeleteSale:r,currency:n,isLoading:i})=>(0,t.jsx)("div",{className:"space-y-6",children:(0,t.jsx)(s.Suspense,{fallback:(0,t.jsx)(c,{}),children:(0,t.jsx)(eu,{sales:e,onViewReceipt:a,onEditSale:l,onDeleteSale:r,currency:n,isLoading:i,mobileOptimized:!1})})});var eh=e.i(11381);let eg=({selectedSale:e,isOpen:s,onOpenChange:a,currency:l})=>e?(0,t.jsx)(eh.default,{sale:e,isOpen:s,onOpenChange:a,currency:l}):null;var ep=e.i(201928);let ej=(0,B.default)("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]);(0,B.default)("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);var ef=e.i(592930),eb=e.i(643531),ey=e.i(37727),eN=e.i(239616),ev=e.i(747697),eS=e.i(846696),eC=e.i(585890),ew=e.i(145963),eT=e.i(614522),eD=e.i(707935),ek=e.i(608199),eP=e.i(39978),eF=e.i(668113),eI=e.i(885697),eA=e.i(751371),eM=e.i(585341),eR=e.i(619578);let eB=({sales:e,formatCurrency:a})=>{let{canViewProfit:l}=(0,V.useFinancialVisibility)(),{categories:n,createCategory:i,updateCategory:c,deleteCategory:o}=(0,P.useSalesCategories)(),m=(0,_.useIsMobile)(),[h,g]=(0,s.useState)(null),[p,j]=(0,s.useState)(""),[f,b]=(0,s.useState)(""),[v,w]=(0,s.useState)(!1),[T,D]=(0,s.useState)(null),[k,F]=(0,s.useState)(!1),[I,A]=(0,s.useState)(!1),[M,B]=(0,s.useState)("all-time"),[O,z]=(0,s.useState)(),[$,E]=(0,s.useState)(),[L,W]=(0,s.useState)(),q=(0,s.useMemo)(()=>{let t=e,s=(e=>{let t=new Date;switch(e){case"today":return{start:(0,eC.startOfDay)(t),end:(0,ew.endOfDay)(t)};case"yesterday":let s=(0,eA.subDays)(t,1);return{start:(0,eC.startOfDay)(s),end:(0,ew.endOfDay)(s)};case"this-week":return{start:(0,eT.startOfWeek)(t),end:(0,eD.endOfWeek)(t)};case"last-week":return{start:(0,eT.startOfWeek)((0,eM.subWeeks)(t,1)),end:(0,eD.endOfWeek)((0,eM.subWeeks)(t,1))};case"this-month":return{start:(0,ek.startOfMonth)(t),end:(0,eP.endOfMonth)(t)};case"last-month":return{start:(0,ek.startOfMonth)((0,eR.subMonths)(t,1)),end:(0,eP.endOfMonth)((0,eR.subMonths)(t,1))};case"this-year":return{start:(0,eF.startOfYear)(t),end:(0,eI.endOfYear)(t)};case"specific-date":if(L)return{start:(0,eC.startOfDay)(L),end:(0,ew.endOfDay)(L)};return null;case"custom-range":if(O&&$)return{start:(0,eC.startOfDay)(O),end:(0,ew.endOfDay)($)};if(O)return{start:(0,eC.startOfDay)(O),end:(0,ew.endOfDay)(t)};if($)return{start:(0,eC.startOfDay)(new Date(0)),end:(0,ew.endOfDay)($)};return null;default:return null}})(M);s&&(t=e.filter(e=>{let t=new Date(e.date);return t>=s.start&&t<=s.end}));let a=n.map(e=>{let s=t.filter(t=>t.categoryId===e.id),a=s.reduce((e,t)=>e+t.items.reduce((e,t)=>e+t.quantity*t.price,0),0),l=s.reduce((e,t)=>e+(t.profit||0),0),r=s.length;return{name:e.name,revenue:a,profit:l,transactions:r,averageValue:r>0?a/r:0}}),l=t.filter(e=>!e.categoryId);if(l.length>0){let e=l.reduce((e,t)=>e+t.items.reduce((e,t)=>e+t.quantity*t.price,0),0),t=l.reduce((e,t)=>e+(t.profit||0),0),s=l.length;a.push({name:"Uncategorized",revenue:e,profit:t,transactions:s,averageValue:s>0?e/s:0})}return a.sort((e,t)=>t.revenue-e.revenue)},[e,n,M,O,$,L]);(0,s.useMemo)(()=>q.filter(e=>e.revenue>0).map((e,t)=>({...e,fill:`hsl(var(--chart-${t%5+1}))`})),[q]);let Q=async()=>{if(h&&p.trim())try{await c(h,p.trim()),g(null),j(""),eS.toast.success("Category updated successfully")}catch(e){eS.toast.error("Failed to update category")}},U=()=>{g(null),j("")},G=async()=>{if(T){A(!0);try{await o(T.id),eS.toast.success("Category deleted successfully"),w(!1),D(null)}catch(e){eS.toast.error("Failed to delete category")}finally{A(!1)}}},K=async()=>{if(f.trim()){F(!0);try{await i(f.trim()),b(""),eS.toast.success("Category created successfully")}catch(e){eS.toast.error("Failed to create category")}finally{F(!1)}}};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(et.Card,{className:"shadow-sm",children:[(0,t.jsxs)(et.CardHeader,{children:[(0,t.jsxs)(et.CardTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(eN.Settings,{className:"w-5 h-5 text-primary"}),"Manage Sales Sources"]}),(0,t.jsx)(et.CardDescription,{children:"Create, edit, or delete sales sources"})]}),(0,t.jsx)(et.CardContent,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex gap-2 p-3 bg-muted/30 rounded-lg",children:[(0,t.jsx)(y.Input,{placeholder:"Enter New Sales Source",value:f,onChange:e=>b(e.target.value),onKeyDown:e=>"Enter"===e.key&&K(),className:"flex-1"}),(0,t.jsx)(r.Button,{onClick:K,disabled:!f.trim()||k,size:"sm",className:"shrink-0",children:k?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"w-4 h-4 mr-1 border-2 border-current border-t-transparent rounded-full animate-spin"}),"Adding..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.Plus,{className:"w-4 h-4 mr-1"}),"Add"]})})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[n.map(e=>(0,t.jsx)("div",{className:"flex items-center gap-2 p-3 border rounded-lg bg-background hover:bg-muted/20 transition-colors",children:h===e.id?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(y.Input,{value:p,onChange:e=>j(e.target.value),onKeyDown:e=>{"Enter"===e.key&&Q(),"Escape"===e.key&&U()},className:"flex-1",autoFocus:!0}),(0,t.jsx)(r.Button,{size:"sm",variant:"outline",onClick:Q,children:(0,t.jsx)(eb.Check,{className:"w-4 h-4"})}),(0,t.jsx)(r.Button,{size:"sm",variant:"outline",onClick:U,children:(0,t.jsx)(ey.X,{className:"w-4 h-4"})})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"flex-1 font-medium",children:e.name}),(0,t.jsx)(r.Button,{size:"sm",variant:"outline",onClick:()=>{g(e.id),j(e.name)},children:(0,t.jsx)(ef.Edit2,{className:"w-4 h-4"})}),(0,t.jsx)(r.Button,{size:"sm",variant:"outline",onClick:()=>{D(e),w(!0)},className:"text-destructive hover:bg-destructive hover:text-destructive-foreground",children:(0,t.jsx)(R.Trash2,{className:"w-4 h-4"})})]})},e.id)),0===n.length&&(0,t.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No sources found. Create your first source above."})]})]})})]}),(0,t.jsxs)(et.Card,{className:"shadow-sm",children:[(0,t.jsxs)(et.CardHeader,{children:[(0,t.jsxs)(et.CardTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(ev.CalendarIcon,{className:"w-5 h-5 text-primary"}),"Date Filter"]}),(0,t.jsx)(et.CardDescription,{children:"Filter source performance by time period"})]}),(0,t.jsxs)(et.CardContent,{children:[(0,t.jsx)("div",{className:"flex flex-col sm:flex-row gap-4 items-end",children:(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Time Period"}),(0,t.jsxs)(N.Select,{value:M,onValueChange:B,children:[(0,t.jsx)(N.SelectTrigger,{className:"w-full",children:(0,t.jsx)(N.SelectValue,{placeholder:"Select time period"})}),(0,t.jsxs)(N.SelectContent,{className:"bg-background border shadow-lg z-50",children:[(0,t.jsx)(N.SelectItem,{value:"today",children:"Today"}),(0,t.jsx)(N.SelectItem,{value:"yesterday",children:"Yesterday"}),(0,t.jsx)(N.SelectItem,{value:"this-week",children:"This Week"}),(0,t.jsx)(N.SelectItem,{value:"last-week",children:"Last Week"}),(0,t.jsx)(N.SelectItem,{value:"this-month",children:"This Month"}),(0,t.jsx)(N.SelectItem,{value:"last-month",children:"Last Month"}),(0,t.jsx)(N.SelectItem,{value:"this-year",children:"This Year"}),(0,t.jsx)(N.SelectItem,{value:"all-time",children:"All Time"}),(0,t.jsx)(N.SelectItem,{value:"specific-date",children:"Specific Date"}),(0,t.jsx)(N.SelectItem,{value:"custom-range",children:"Custom Range"})]})]})]})}),"custom-range"===M&&(0,t.jsxs)("div",{className:"mt-4 grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"From Date"}),(0,t.jsxs)(S.Popover,{children:[(0,t.jsx)(S.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)(r.Button,{variant:"outline",className:(0,H.cn)("w-full justify-start text-left font-normal",!O&&"text-muted-foreground"),children:[(0,t.jsx)(ev.CalendarIcon,{className:"mr-2 h-4 w-4"}),O?(0,x.format)(O,"PPP"):(0,t.jsx)("span",{children:"Pick start date"})]})}),(0,t.jsx)(S.PopoverContent,{className:"w-auto p-0",align:"start",children:(0,t.jsx)(C.Calendar,{mode:"single",selected:O,onSelect:z,initialFocus:!0,className:(0,H.cn)("p-3 pointer-events-auto")})})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"To Date"}),(0,t.jsxs)(S.Popover,{children:[(0,t.jsx)(S.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)(r.Button,{variant:"outline",className:(0,H.cn)("w-full justify-start text-left font-normal",!$&&"text-muted-foreground"),children:[(0,t.jsx)(ev.CalendarIcon,{className:"mr-2 h-4 w-4"}),$?(0,x.format)($,"PPP"):(0,t.jsx)("span",{children:"Pick end date"})]})}),(0,t.jsx)(S.PopoverContent,{className:"w-auto p-0",align:"start",children:(0,t.jsx)(C.Calendar,{mode:"single",selected:$,onSelect:E,initialFocus:!0,className:(0,H.cn)("p-3 pointer-events-auto")})})]})]})]}),"specific-date"===M&&(0,t.jsxs)("div",{className:"mt-4",children:[(0,t.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Select Date"}),(0,t.jsxs)(S.Popover,{children:[(0,t.jsx)(S.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)(r.Button,{variant:"outline",className:(0,H.cn)("w-full sm:w-64 justify-start text-left font-normal",!L&&"text-muted-foreground"),children:[(0,t.jsx)(ev.CalendarIcon,{className:"mr-2 h-4 w-4"}),L?(0,x.format)(L,"PPP"):(0,t.jsx)("span",{children:"Pick a date"})]})}),(0,t.jsx)(S.PopoverContent,{className:"w-auto p-0",align:"start",children:(0,t.jsx)(C.Calendar,{mode:"single",selected:L,onSelect:W,initialFocus:!0,className:(0,H.cn)("p-3 pointer-events-auto")})})]})]}),"all-time"!==M&&(0,t.jsx)("div",{className:"mt-4 p-3 bg-muted/30 rounded-lg",children:(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Showing results for: ",(0,t.jsx)("span",{className:"font-medium",children:"today"===M?"Today":"yesterday"===M?"Yesterday":"this-week"===M?"This Week":"last-week"===M?"Last Week":"this-month"===M?"This Month":"last-month"===M?"Last Month":"this-year"===M?"This Year":"specific-date"===M&&L?(0,x.format)(L,"PPP"):"custom-range"===M&&O&&$?`${(0,x.format)(O,"PPP")} to ${(0,x.format)($,"PPP")}`:"custom-range"===M&&O?`From ${(0,x.format)(O,"PPP")}`:"custom-range"===M&&$?`Until ${(0,x.format)($,"PPP")}`:"Custom Period"})]})})]})]}),(0,t.jsxs)(et.Card,{className:"shadow-sm",children:[(0,t.jsxs)(et.CardHeader,{children:[(0,t.jsxs)(et.CardTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(ej,{className:"w-5 h-5 text-primary"}),"Source Rankings"]}),(0,t.jsx)(et.CardDescription,{children:"Best performing sources ranked by revenue"})]}),(0,t.jsx)(et.CardContent,{children:q.length>0?m?(0,t.jsx)("div",{className:"space-y-3",children:q.map((e,s)=>(0,t.jsx)(et.Card,{className:"border border-border bg-card",children:(0,t.jsxs)(et.CardContent,{className:"p-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-primary text-primary-foreground text-sm font-bold",children:s+1}),(0,t.jsx)("h3",{className:"font-semibold text-lg",children:e.name})]}),(0,t.jsx)(ej,{className:"w-5 h-5 text-primary"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-3",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center p-3 bg-muted/30 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(ea.DollarSign,{className:"w-4 h-4 text-green-600"}),(0,t.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Total Revenue"})]}),(0,t.jsx)("span",{className:"font-semibold",children:a(e.revenue)})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center p-3 bg-muted/30 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(es.TrendingUp,{className:"w-4 h-4 text-blue-600"}),(0,t.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Total Profit"})]}),(0,t.jsx)("span",{className:"font-semibold",children:l?a(e.profit):"•••"})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center p-3 bg-muted/30 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(ep.ShoppingCart,{className:"w-4 h-4 text-purple-600"}),(0,t.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Number of Sales"})]}),(0,t.jsx)("span",{className:"font-semibold",children:e.transactions})]})]})]})},e.name))}):(0,t.jsxs)(d.Table,{children:[(0,t.jsx)(d.TableHeader,{children:(0,t.jsxs)(d.TableRow,{children:[(0,t.jsx)(d.TableHead,{className:"w-12",children:"#"}),(0,t.jsx)(d.TableHead,{children:"Source Name"}),(0,t.jsx)(d.TableHead,{className:"text-right",children:"Total Revenue"}),(0,t.jsx)(d.TableHead,{className:"text-right",children:"Total Profit"}),(0,t.jsx)(d.TableHead,{className:"text-right",children:"Number of Sales"})]})}),(0,t.jsx)(d.TableBody,{children:q.map((e,s)=>(0,t.jsxs)(d.TableRow,{children:[(0,t.jsx)(d.TableCell,{className:"font-medium",children:(0,t.jsx)("div",{className:"flex items-center justify-center w-6 h-6 rounded-full bg-muted text-xs font-bold",children:s+1})}),(0,t.jsx)(d.TableCell,{className:"font-medium",children:e.name}),(0,t.jsx)(d.TableCell,{className:"text-right font-mono",children:a(e.revenue)}),(0,t.jsx)(d.TableCell,{className:"text-right font-mono",children:l?a(e.profit):"•••"}),(0,t.jsx)(d.TableCell,{className:"text-right",children:e.transactions})]},e.name))})]}):(0,t.jsx)("div",{className:"flex items-center justify-center h-64 text-muted-foreground",children:"No performance data available"})})]}),(0,t.jsx)(Y.AlertDialog,{open:v,onOpenChange:w,children:(0,t.jsxs)(Y.AlertDialogContent,{children:[(0,t.jsxs)(Y.AlertDialogHeader,{children:[(0,t.jsx)(Y.AlertDialogTitle,{children:"Delete Source"}),(0,t.jsxs)(Y.AlertDialogDescription,{children:['Are you sure you want to delete the source "',T?.name,'"? This action cannot be undone. All sales in this source will be moved to "Uncategorized".']})]}),(0,t.jsxs)(Y.AlertDialogFooter,{children:[(0,t.jsx)(Y.AlertDialogCancel,{onClick:()=>D(null),children:"Cancel"}),(0,t.jsx)(Y.AlertDialogAction,{onClick:G,disabled:I,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:I?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"w-4 h-4 mr-2 border-2 border-current border-t-transparent rounded-full animate-spin"}),"Deleting..."]}):"Delete Source"})]})]})})]})};var eO=e.i(284614),ez=e.i(503116);let e$=({sales:e,isLoading:s,currency:a="UGX"})=>s?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 space-y-4",children:[(0,t.jsx)("div",{className:"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin"}),(0,t.jsx)("p",{className:"text-muted-foreground text-sm",children:"Loading deleted sales history..."})]}):0===e.length?(0,t.jsxs)("div",{className:"text-center py-12 border rounded-lg bg-muted/20",children:[(0,t.jsx)(R.Trash2,{className:"mx-auto h-12 w-12 text-muted-foreground opacity-20 mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-medium",children:"Deleted Sales history is empty"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Deleted sales logs will appear here."})]}):(0,t.jsx)("div",{className:"border rounded-lg overflow-hidden bg-white",children:(0,t.jsxs)(d.Table,{children:[(0,t.jsx)(d.TableHeader,{className:"bg-muted/50",children:(0,t.jsxs)(d.TableRow,{children:[(0,t.jsx)(d.TableHead,{children:"Receipt #"}),(0,t.jsx)(d.TableHead,{children:"Customer"}),(0,t.jsx)(d.TableHead,{children:"Items"}),(0,t.jsx)(d.TableHead,{className:"text-right",children:"Total Qty"}),(0,t.jsx)(d.TableHead,{className:"text-right",children:"Total Amount"}),(0,t.jsx)(d.TableHead,{children:"Deleted At"}),(0,t.jsx)(d.TableHead,{children:"Deleted By"})]})}),(0,t.jsx)(d.TableBody,{children:e.map(e=>(0,t.jsxs)(d.TableRow,{className:"hover:bg-muted/30",children:[(0,t.jsx)(d.TableCell,{className:"font-mono font-medium",children:e.receiptNumber}),(0,t.jsx)(d.TableCell,{children:e.customerName}),(0,t.jsx)(d.TableCell,{children:(0,t.jsx)("div",{className:"max-w-[250px]",children:(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:e.items.map((e,s)=>{let a=e.quantity??e.qty??0;return(0,t.jsxs)(I.Badge,{variant:"outline",className:"text-[10px] py-0 h-4 bg-muted/30",children:[a,"x ",e.description]},s)})})})}),(0,t.jsx)(d.TableCell,{className:"text-right font-medium",children:e.totalQuantity}),(0,t.jsxs)(d.TableCell,{className:"text-right font-semibold",children:[a," ",e.amount.toLocaleString()]}),(0,t.jsx)(d.TableCell,{children:(0,t.jsxs)("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[(0,t.jsx)(ez.Clock,{className:"h-3 w-3"}),(0,x.format)(new Date(e.deletedAt),"MMM d, h:mm a")]})}),(0,t.jsx)(d.TableCell,{children:(0,t.jsxs)("div",{className:"flex items-center gap-1.5 text-xs",children:[(0,t.jsx)(eO.User,{className:"h-3 w-3 text-muted-foreground"}),e.deletedBy]})})]},e.id))})]})});var eH=e.i(146786),eE=e.i(422713),eL=e.i(986387),e_=e.i(399935),eW=e.i(16715);let eq=()=>{let[e,n]=(0,s.useState)("overview"),{currentBusiness:d,isLoading:m}=(0,eE.useBusiness)(),{settings:u}=(0,p.useBusinessSettings)(),{userId:x}=(0,eL.useCurrentUser)(),{sales:h,isLoading:g,deleteSale:j,refetch:f,isFetching:b}=(0,eH.useSalesData)(x,"desc"),{deletedSales:y,isLoading:N,refetch:v}=(()=>{let[e,t]=(0,s.useState)([]),[a,l]=(0,s.useState)(!1),{currentBusiness:r}=(0,eE.useBusiness)(),{userId:n}=(0,eL.useCurrentUser)(),i=(0,s.useCallback)(async()=>{if(r?.id&&n){l(!0);try{let e=await (0,e_.getActivityHistoryAction)(r.id,"SALES","DELETE");if(!e.success)throw Error(e.error);let s=(e.data||[]).map(e=>{let t=e.metadata||{},s=Array.isArray(t.items)?t.items:[],a=Number(t.totalAmount||0);0===a&&s.length>0&&(a=s.reduce((e,t)=>{let s=Number(t.total)||Number(t.price||0)*Number(t.quantity||0);return e+s},0));let l=s.reduce((e,t)=>e+Number(t.quantity??t.qty??0),0);return{id:e.id,receiptNumber:t.receiptNumber||"N/A",customerName:t.customerName||"Unknown",amount:a,totalQuantity:l,deletedAt:e.createdAt,deletedBy:e.profileName||"Admin",items:s,fullMetadata:t}});t(s)}catch(e){console.error("Error fetching deleted sales:",e)}finally{l(!1)}}},[r?.id,n]);return(0,s.useEffect)(()=>{i()},[i]),{deletedSales:e,isLoading:a,refetch:i}})(),{selectedSale:S,isReceiptDialogOpen:C,handleEditSale:w,handleViewReceipt:T,handleDeleteSale:D,handleCloseReceiptDialog:k}=(()=>{let e=(0,l.useRouter)(),[t,a]=(0,s.useState)(null),[r,n]=(0,s.useState)(!1),[i,c]=(0,s.useState)(!1),o=(0,s.useCallback)(t=>{e.push(`/new-sale?editId=${t.id}`)},[e]),d=(0,s.useCallback)(e=>{a(e),n(!0)},[]);return{selectedSale:t,isReceiptDialogOpen:r,isDeletingSale:i,handleEditSale:o,handleViewReceipt:d,handleDeleteSale:(0,s.useCallback)(e=>async t=>{c(!0);try{await e(t.id)}finally{c(!1)}},[]),handleCloseReceiptDialog:(0,s.useCallback)(e=>{n(e),e||a(null)},[])}})();if(m||!x)return(0,t.jsx)("div",{className:"p-6 space-y-6",children:(0,t.jsx)(c,{})});if(!d)return(0,t.jsx)(o,{});let P=async()=>{"deleted-sales"===e?await v():await f()};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold tracking-tight",children:"Sales Management"}),(0,t.jsxs)(r.Button,{variant:"outline",size:"sm",onClick:P,className:"flex items-center gap-2",disabled:b||N,children:[(0,t.jsx)(eW.RefreshCw,{className:`h-4 w-4 ${b||N?"animate-spin":""}`}),b||N?"Refreshing...":"Refresh"]})]}),(0,t.jsxs)(a.Tabs,{value:e,onValueChange:n,children:[(0,t.jsxs)(a.TabsList,{className:"grid w-full grid-cols-3",children:[(0,t.jsx)(a.TabsTrigger,{value:"overview",children:"Sales Overview"}),(0,t.jsx)(a.TabsTrigger,{value:"analysis",children:"Sales Source"}),(0,t.jsxs)(a.TabsTrigger,{value:"deleted-sales",className:"flex items-center gap-2 text-destructive data-[state=active]:text-destructive",children:[(0,t.jsx)(R.Trash2,{className:"h-4 w-4"}),"Deleted Sales"]})]}),(0,t.jsx)(a.TabsContent,{value:"overview",className:"mt-0",children:g&&!h.length?(0,t.jsx)(c,{}):0===h.length?(0,t.jsx)(i,{}):(0,t.jsx)(ex,{sales:h,onViewReceipt:T,onEditSale:w,onDeleteSale:D(j),currency:u.currency,isLoading:g})}),(0,t.jsx)(a.TabsContent,{value:"analysis",className:"mt-6",children:(0,t.jsx)(eB,{sales:h,formatCurrency:e=>new Intl.NumberFormat("en-US",{style:"currency",currency:u.currency||"UGX",minimumFractionDigits:0,maximumFractionDigits:2}).format(e)})}),(0,t.jsx)(a.TabsContent,{value:"deleted-sales",className:"mt-6",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsxs)("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[(0,t.jsx)(R.Trash2,{className:"h-5 w-5 text-muted-foreground"}),"Deleted Sales History"]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"View and manage recently deleted sales records."})]}),(0,t.jsx)(e$,{sales:y,isLoading:N,currency:u.currency})]})})]})]}),(0,t.jsx)(eg,{selectedSale:S,isOpen:C,onOpenChange:k,currency:u.currency})]})};e.s(["default",0,()=>(0,t.jsx)(eq,{})],652128)}]);