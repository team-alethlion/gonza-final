module.exports=[788326,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(875083),e=a.i(50944),f=a.i(699570),g=a.i(104720);let h=()=>{let a=(0,e.useRouter)();return(0,b.jsx)("div",{className:"text-center py-12 bg-white rounded-lg shadow-md p-8",children:(0,b.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,b.jsx)("div",{className:"bg-slate-100 rounded-full p-4 w-16 h-16 flex items-center justify-center",children:(0,b.jsx)(g.FileText,{className:"h-8 w-8 text-slate-400"})}),(0,b.jsx)("h3",{className:"text-xl font-semibold",children:"No sales records found"}),(0,b.jsx)("p",{className:"text-gray-500 mb-4",children:"Create your first sale to start tracking your business performance"}),(0,b.jsx)(f.Button,{onClick:()=>a.push("/new-sale"),className:"mt-2",children:"Create Your First Sale"})]})})},i=()=>(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-border/50",children:[(0,b.jsx)("div",{className:"p-4 sm:p-6 border-b border-border/50",children:(0,b.jsx)("div",{className:"flex flex-col gap-4",children:(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"h-8 bg-gray-200 rounded w-48 animate-pulse"}),(0,b.jsx)("div",{className:"h-4 bg-gray-200 rounded w-32 mt-2 animate-pulse"})]}),(0,b.jsx)("div",{className:"h-10 bg-gray-200 rounded w-32 animate-pulse"})]})})}),(0,b.jsx)("div",{className:"p-4 sm:p-6",children:(0,b.jsx)("div",{className:"space-y-4",children:[void 0,void 0,void 0].map((a,c)=>(0,b.jsx)("div",{className:"h-16 bg-gray-100 rounded animate-pulse"},c))})})]}),j=()=>{let a=(0,e.useRouter)();return(0,b.jsx)("div",{className:"p-6 text-center",children:(0,b.jsxs)("div",{className:"bg-amber-50 border border-amber-200 p-4 rounded-md",children:[(0,b.jsx)("p",{className:"text-amber-800 mb-4",children:"No business location found. Please create a business location to manage sales."}),(0,b.jsx)("button",{onClick:()=>a.push("/business-management"),className:"bg-amber-600 text-white px-4 py-2 rounded hover:bg-amber-700",children:"Manage Business Locations"})]})})};var k=a.i(206015),l=a.i(626251),m=a.i(915618),n=a.i(256711),o=a.i(932596),p=a.i(478793),q=a.i(866102),r=a.i(750054),s=a.i(890914);let t=({filteredSales:a,allSales:c,currency:d,dateFilter:h="all",dateRange:i,specificDate:j})=>{let k=(0,e.useRouter)(),{toast:t}=(0,p.useToast)(),{settings:u}=(0,q.useBusinessSettings)(),{hasPermission:v}=(0,s.useProfiles)(),w=async()=>{try{let b,e=a.length>0?a:c,f=e.map(a=>{let b=a.items.reduce((a,b)=>a+b.price*b.quantity,0),c=a.items.reduce((a,b)=>a+(b.discountAmount||0),0),d=(b-c)*(1+(a.taxRate||0)/100);return{receipt_number:a.receiptNumber,customer_name:a.customerName,total_amount:d,payment_status:a.paymentStatus.toLowerCase(),created_at:a.date.toISOString(),sale_date:a.date.toISOString().split("T")[0],items:a.items.map(a=>({product_name:a.description,quantity:a.quantity,price:a.price,total:a.price*a.quantity,discount_amount:a.discountAmount||0,discount_percentage:a.discountPercentage||0,discount_type:a.discountType||void 0}))}});if(j)b={from:j,to:j};else if(i?.from&&i?.to)b=i;else if(h&&"all"!==h)b=(0,r.getDateRangeFromFilter)(h);else if(e.length>0){let a=e.map(a=>a.date),c=new Date(Math.min(...a.map(a=>a.getTime()))),d=new Date(Math.max(...a.map(a=>a.getTime())));b={from:c,to:d}}else{let a=new Date;b={from:a,to:a}}((a,b,c="USD",d,e)=>{let f,g=new o.default({orientation:"landscape",unit:"mm",format:"a4",compress:!0}),h=g.internal.pageSize.getWidth(),i=g.internal.pageSize.getHeight(),j=h-15-15,k=15,l=()=>{g.setFontSize(8),g.setFont("helvetica","normal"),g.setTextColor(150,150,150),g.text("Created By Gonza Systems",h/2,i-10,{align:"center"}),g.setTextColor(0,0,0)},m=[18,20,28,45,16,20,22,18,20,18,28],p=["Receipt #","Date","Customer","Items","Qty","Unit Price","Subtotal","Discount","Net","Tax","Total"],q=()=>{g.setFillColor(243,244,246),g.rect(15,k-2,j,12,"F"),g.setLineWidth(.3),g.rect(15,k-2,j,12),g.setFontSize(9),g.setFont("helvetica","bold");let a=15;p.forEach((b,c)=>{let d=m[c],e=g.getTextWidth(b),f=a+(d-e)/2;g.text(b,f,k+7),c<p.length-1&&g.line(a+d,k-2,a+d,k+12-2),a+=d}),k+=12},r=a=>k+a>i-15-15&&(l(),g.addPage(),k=15,q(),g.setFont("helvetica","normal"),g.setFontSize(8),!0),s=k;e&&(g.setFontSize(12),g.setFont("helvetica","bold"),g.text(e.businessName,15,k),k+=6,g.setFontSize(9),g.setFont("helvetica","normal"),g.text(e.businessAddress,15,k),k+=5,g.text(e.businessPhone,15,k),k+=5,g.text(e.businessEmail,15,k)),k=s,g.setFontSize(20),g.setFont("helvetica","bold");let t=`Comprehensive Sales Report (${c})`,u=g.getTextWidth(t);if(g.text(t,h-15-u,k),k+=12,d?.from&&d?.to){g.setFontSize(14),g.setFont("helvetica","normal");let a=(0,n.format)(d.from,"dd/MM/yyyy"),b=(0,n.format)(d.to,"dd/MM/yyyy"),c=a===b?a:`${a} - ${b}`,e=g.getTextWidth(c);g.text(c,h-15-e,k),k+=15}else{g.setFontSize(14),g.setFont("helvetica","normal");let a=(0,n.format)(new Date,"dd/MM/yyyy"),b=g.getTextWidth(a);g.text(a,h-15-b,k),k+=15}if(k=Math.max(k,s+25),0===a.length){g.setFontSize(16),g.setFont("helvetica","normal");let a="No sales data available for the selected period.",b=g.getTextWidth(a);g.text(a,(h-b)/2,k+30)}else{r(22),q(),g.setFont("helvetica","normal"),g.setFontSize(8);let b=new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0,useGrouping:!0}),c=0;a.forEach(a=>{let d=a.items.reduce((a,b)=>a+b.total,0)-a.items.reduce((a,b)=>a+(b.discount_amount||0),0),e=a.total_amount-d,f=d>0?e/d:0;a.items.forEach((d,e)=>{r(13);let h=d.discount_amount||0,i=d.total-h,l=i*f,o=[0===e?a.receipt_number:"",0===e?(0,n.format)(new Date(a.sale_date),"dd/MM/yyyy"):"",0===e?a.customer_name||"Walk-in":"",d.product_name,d.quantity.toString(),b.format(d.price),b.format(d.total),h>0?b.format(h):"-",b.format(i),b.format(l),b.format(i+l)];c%2==0&&(g.setFillColor(249,250,251),g.rect(15,k-1,j,8,"F")),g.setLineWidth(.1),g.rect(15,k-1,j,8);let p=15;o.forEach((a,b)=>{let c=m[b],d=a;if(2===b)for(;g.getTextWidth(d)>c-4&&d.length>3;)d=d.substring(0,d.length-4)+"...";else if(3===b)for(;g.getTextWidth(d)>c-4&&d.length>5;)d=d.substring(0,d.length-4)+"...";else if(b>=4)for(;g.getTextWidth(d)>c-4&&d.length>3;)d=d.includes(",")?d.replace(/,/g,""):d.substring(0,d.length-1);let e=p+2;if(b>=4){let a=g.getTextWidth(d);e=p+c-a-2}g.text(d,e,k+5),b<o.length-1&&g.line(p+c,k-1,p+c,k+8-1),p+=c}),k+=8}),c++}),k+=15,r(60),g.setFontSize(18),g.setFont("helvetica","bold"),g.text("Comprehensive Sales Summary",15,k),k+=10;let d=a.length,e=a.reduce((a,b)=>a+b.total_amount,0),f=a.reduce((a,b)=>a+b.items.reduce((a,b)=>a+b.total,0),0),h=a.reduce((a,b)=>a+b.items.reduce((a,b)=>a+(b.discount_amount||0),0),0),i=f-h,l=a.reduce((a,b)=>a+b.items.reduce((a,b)=>a+b.quantity,0),0),o=a.filter(a=>"paid"===a.payment_status.toLowerCase()).length,p=a.filter(a=>"not paid"===a.payment_status.toLowerCase()).length,s=a.filter(a=>"quote"===a.payment_status.toLowerCase()).length,t=a.filter(a=>"installment sale"===a.payment_status.toLowerCase()).length,u=d>0?l/d:0,v=d>0?h/d:0,w=f>0?h/f*100:0;g.setFillColor(248,249,250),g.rect(15,k-3,j,60,"F"),g.setLineWidth(.3),g.setDrawColor(200,200,200),g.rect(15,k-3,j,60),g.setFontSize(10),g.setFont("helvetica","normal");let x=[["Total Sales:",d.toString()],["Total Items Sold:",l.toString()],["Average Items/Sale:",u.toFixed(1)],["Paid Sales:",o.toString()],["Pending Sales:",p.toString()],["Avg Discount/Sale:",b.format(v)]],y=[["Total Amount:",b.format(e)],["Subtotal (before discount):",b.format(f)],["Total Discounts:",b.format(h)],["Net Amount (after discount):",b.format(i)],["Total Tax:",b.format(e-i)],["Discount Rate:",`${w.toFixed(1)}%`]],z=k+6,A=30,B=15+j/2+15;x.forEach(([a,b])=>{g.setFont("helvetica","bold"),g.text(a,A,z),g.setFont("helvetica","normal");let c=g.getTextWidth(a);g.text(b,A+c+5,z),z+=7}),z=k+6,y.forEach(([a,b])=>{g.setFont("helvetica","bold"),g.text(a,B,z),g.setFont("helvetica","normal");let c=g.getTextWidth(a);g.text(b,B+c+5,z),z+=7}),(s>0||t>0)&&(k+=70,r(25),g.setFontSize(14),g.setFont("helvetica","bold"),g.text("Payment Status Breakdown",15,k),k+=8,g.setFontSize(10),g.setFont("helvetica","normal"),[[`Quotes: ${s}`,`Installment Sales: ${t}`]].forEach(([a,b])=>{g.text(a,A,k),g.text(b,B,k),k+=6}))}if(l(),d?.from&&d?.to){let a=(0,n.format)(d.from,"yyyy-MM-dd"),b=(0,n.format)(d.to,"yyyy-MM-dd");f=a===b?`sales_report_${a}.pdf`:`sales_report_${a}_to_${b}.pdf`}else f=`sales_report_${(0,n.format)(new Date,"yyyy-MM-dd")}.pdf`;g.save(f)})(f,0,d,b,{businessName:u.businessName,businessAddress:u.businessAddress,businessPhone:u.businessPhone,businessEmail:u.businessEmail}),t({title:"Report Generated",description:"PDF sales report has been created successfully."})}catch(a){console.error("Error generating PDF report:",a),t({title:"Error",description:"Failed to generate PDF report. Please try again.",variant:"destructive"})}};return(0,b.jsxs)("div",{className:"flex flex-col gap-3 w-full",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,b.jsxs)(f.Button,{onClick:()=>{(a=>{let b=new Blob([["Receipt #,Date,Customer,Items,Items Count,Total Amount,Amount Paid,Amount Due,Status",...a.map(a=>{let b=a.items.reduce((a,b)=>a+b.price*b.quantity,0),c=a.items.map(a=>a.description).join("; ");return[a.receiptNumber,(0,n.format)(new Date(a.date),"yyyy-MM-dd HH:mm"),a.customerName,c,a.items.length.toString(),b.toFixed(2),(a.amountPaid||0).toFixed(2),(a.amountDue||0).toFixed(2),a.paymentStatus]}).map(a=>a.map(a=>`"${a.toString().replace(/"/g,'""')}"`).join(","))].join("\n")],{type:"text/csv;charset=utf-8;"}),c=document.createElement("a");if(void 0!==c.download){let a=URL.createObjectURL(b);c.setAttribute("href",a),c.setAttribute("download",`sales_export_${(0,n.format)(new Date,"yyyy-MM-dd_HHmm")}.csv`),c.style.visibility="hidden",document.body.appendChild(c),c.click(),document.body.removeChild(c)}})(a.length>0?a:c)},variant:"outline",size:"lg",className:"gap-2 h-12 text-sm border-border/50 font-medium",children:[(0,b.jsx)(l.FileDown,{className:"h-4 w-4 shrink-0"}),"CSV"]}),(0,b.jsxs)(f.Button,{onClick:w,variant:"outline",size:"lg",className:"gap-2 h-12 text-sm border-border/50 font-medium",children:[(0,b.jsx)(g.FileText,{className:"h-4 w-4 shrink-0"}),"PDF"]})]}),v("sales","create")&&(0,b.jsxs)(f.Button,{onClick:()=>k.push("/new-sale"),size:"lg",className:"w-full gap-2 h-12 text-sm font-medium",children:[(0,b.jsx)(m.Plus,{className:"h-4 w-4 shrink-0"}),"New Sale"]})]})};var u=a.i(866718),v=a.i(580701),w=a.i(941675),x=a.i(599209),y=a.i(320146),z=a.i(587532),A=a.i(581464),B=a.i(533350),C=a.i(624648),D=a.i(161990);let E=({searchQuery:a,setSearchQuery:c,paymentFilter:d,setPaymentFilter:e,cashTransactionFilter:g,setCashTransactionFilter:h,categoryFilter:i,setCategoryFilter:j,dateFilter:k,setDateFilter:l,dateRange:m,setDateRange:o,specificDate:p,setSpecificDate:q,isCustomRange:r,isSpecificDate:s,sortOrder:t="desc",setSortOrder:E})=>{let{categories:F}=(0,D.useSalesCategories)();return(0,b.jsxs)("div",{className:"mb-6 space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-4",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(z.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(u.Input,{placeholder:"Search by customer, item, or receipt number...",className:"pl-10 bg-white border-border/50 focus:border-primary h-10",value:a,onChange:a=>{c(a.target.value)}})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-3",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 z-10 pointer-events-none",children:(0,b.jsx)(A.Filter,{className:"h-4 w-4 text-muted-foreground"})}),(0,b.jsxs)(v.Select,{value:d,onValueChange:e,children:[(0,b.jsx)(v.SelectTrigger,{className:"bg-white border-border/50 pl-10 h-10",children:(0,b.jsx)(v.SelectValue,{placeholder:"Payment Status"})}),(0,b.jsxs)(v.SelectContent,{className:"bg-white shadow-lg border border-border/50",children:[(0,b.jsx)(v.SelectItem,{value:"all",children:"All Payment Statuses"}),(0,b.jsx)(v.SelectItem,{value:"Paid",children:"Paid"}),(0,b.jsx)(v.SelectItem,{value:"NOT PAID",children:"NOT PAID"}),(0,b.jsx)(v.SelectItem,{value:"Quote",children:"Quote"}),(0,b.jsx)(v.SelectItem,{value:"Installment Sale",children:"Installment Sale"})]})]})]}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 z-10 pointer-events-none",children:(0,b.jsx)(A.Filter,{className:"h-4 w-4 text-muted-foreground"})}),(0,b.jsxs)(v.Select,{value:g,onValueChange:h,children:[(0,b.jsx)(v.SelectTrigger,{className:"bg-white border-border/50 pl-10 h-10",children:(0,b.jsx)(v.SelectValue,{placeholder:"Cash Transaction"})}),(0,b.jsxs)(v.SelectContent,{className:"bg-white shadow-lg border border-border/50",children:[(0,b.jsx)(v.SelectItem,{value:"all",children:"All Sales"}),(0,b.jsx)(v.SelectItem,{value:"linked",children:"Linked to Cash"}),(0,b.jsx)(v.SelectItem,{value:"unlinked",children:"Not Linked to Cash"})]})]})]}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 z-10 pointer-events-none",children:(0,b.jsx)(B.Tag,{className:"h-4 w-4 text-muted-foreground"})}),(0,b.jsxs)(v.Select,{value:i,onValueChange:j,children:[(0,b.jsx)(v.SelectTrigger,{className:"bg-white border-border/50 pl-10 h-10",children:(0,b.jsx)(v.SelectValue,{placeholder:"Category"})}),(0,b.jsxs)(v.SelectContent,{className:"bg-white shadow-lg border border-border/50",children:[(0,b.jsx)(v.SelectItem,{value:"all",children:"All Categories"}),(0,b.jsx)(v.SelectItem,{value:"none",children:"No Source"}),F.map(a=>(0,b.jsx)(v.SelectItem,{value:a.id,children:a.name},a.id))]})]})]}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 z-10 pointer-events-none",children:(0,b.jsx)(w.Calendar,{className:"h-4 w-4 text-muted-foreground"})}),(0,b.jsxs)(v.Select,{value:k,onValueChange:a=>{l(a)},children:[(0,b.jsx)(v.SelectTrigger,{className:"bg-white border-border/50 pl-10 h-10",children:(0,b.jsx)(v.SelectValue,{placeholder:"Date Range"})}),(0,b.jsxs)(v.SelectContent,{className:"bg-white shadow-lg border border-border/50",children:[(0,b.jsx)(v.SelectItem,{value:"today",children:"Today"}),(0,b.jsx)(v.SelectItem,{value:"yesterday",children:"Yesterday"}),(0,b.jsx)(v.SelectItem,{value:"this-week",children:"This Week"}),(0,b.jsx)(v.SelectItem,{value:"last-week",children:"Last Week"}),(0,b.jsx)(v.SelectItem,{value:"this-month",children:"This Month"}),(0,b.jsx)(v.SelectItem,{value:"last-month",children:"Last Month"}),(0,b.jsx)(v.SelectItem,{value:"this-year",children:"This Year"}),(0,b.jsx)(v.SelectItem,{value:"specific",children:"Specific Date"}),(0,b.jsx)(v.SelectItem,{value:"custom",children:"Custom Range"}),(0,b.jsx)(v.SelectItem,{value:"all",children:"All Time"})]})]})]})]})]}),s&&(0,b.jsx)("div",{className:"pt-2 pb-1 border-t border-border/20",children:(0,b.jsx)("div",{className:"flex items-center space-x-2",children:(0,b.jsxs)(x.Popover,{children:[(0,b.jsx)(x.PopoverTrigger,{asChild:!0,children:(0,b.jsxs)(f.Button,{variant:"outline",className:"bg-white flex items-center gap-2 h-10 pl-3 text-left font-normal",children:[(0,b.jsx)(w.Calendar,{className:"h-4 w-4"}),(0,b.jsx)("span",{children:p?(0,n.format)(p,"MMM d, yyyy"):"Select Date"})]})}),(0,b.jsx)(x.PopoverContent,{className:"w-auto p-0 z-[100] bg-white shadow-lg",align:"start",children:(0,b.jsx)(y.Calendar,{initialFocus:!0,mode:"single",defaultMonth:p,selected:p,onSelect:q,className:"p-3 pointer-events-auto",showOutsideDays:!0})})]})})}),r&&(0,b.jsx)("div",{className:"pt-2 pb-1 border-t border-border/20",children:(0,b.jsx)(C.default,{dateRange:m,onDateRangeChange:o})})]})};var F=a.i(786304),G=a.i(771931),H=a.i(824569),I=a.i(781560),J=a.i(170106);let K=(0,J.default)("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);var L=a.i(563588),M=a.i(785259),N=a.i(368114),O=a.i(291914),P=a.i(129743),Q=a.i(770094),R=a.i(123129),S=a.i(209079),T=a.i(400291);let U=({sale:a,currency:c,onViewReceipt:d,onEditSale:e,onDeleteSale:h,onSendPaymentReminder:i,onSendThankYouNotice:j,onSendPaymentReminderSMS:l,onSendThankYouSMS:m})=>{let{accounts:o}=(0,O.useCashAccounts)(),{transactions:p}=(0,P.useCashTransactions)(),q=(0,Q.useIsMobile)(),{payments:r}=(0,S.useInstallmentPayments)(a.id),{hasPermission:t}=(0,s.useProfiles)(),{formatFinancial:u,canViewCostPrice:v,canViewProfit:w}=(0,T.useFinancialVisibility)(),x=a.items.reduce((a,b)=>a+b.quantity,0),y=a.items.reduce((a,b)=>a+b.price,0),z=x>0?y/a.items.length:0,A=a.items.reduce((a,b)=>{let c=b.price*b.quantity,d="amount"===b.discountType?b.discountAmount||0:c*(b.discountPercentage||0)/100;return a+(c-d)},0),B=a.items.reduce((a,b)=>{let c=b.price*b.quantity;return a+("amount"===b.discountType?b.discountAmount||0:c*(b.discountPercentage||0)/100)},0),C=A+(a.taxRate||0)/100*A,D=a.items.reduce((a,b)=>a+b.cost*b.quantity,0),E="No items";a.items&&Array.isArray(a.items)&&a.items.length>0&&(E=a.items[0].description,a.items.length>1&&(E+=` (+${a.items.length-1} more)`));let J=(()=>{if(!a.cashTransactionId)return console.log("No cash transaction ID for sale:",a.id),null;console.log("Looking for transaction with ID:",a.cashTransactionId),console.log("Available transactions count:",p.length);let b=p.find(b=>b.id===a.cashTransactionId);if(!b)return console.log("No linked transaction found for sale:",a.id,"transaction ID:",a.cashTransactionId),console.log("All transaction IDs:",p.map(a=>a.id)),null;if(console.log("Found linked transaction:",b),!b.accountId)return console.log("Linked transaction has no accountId:",b),null;let c=o.find(a=>a.id===b.accountId);return c?(console.log("Successfully resolved cash account:",c.name),c.name):(console.log("No linked account found for accountId:",b.accountId),console.log("Available accounts:",o.map(a=>({id:a.id,name:a.name}))),null)})(),U="Installment Sale"===a.paymentStatus?r.reduce((a,b)=>a+b.amount,0):a.amountPaid||0,V="Installment Sale"===a.paymentStatus?Math.max(0,C-U):a.amountDue||0,W="NOT PAID"===a.paymentStatus,X="Installment Sale"===a.paymentStatus&&V>0,Y={phoneNumber:a.customerContact||null},Z=(0,R.canSendSMS)(Y),$=q&&Z;return(0,b.jsxs)(k.TableRow,{className:"cursor-pointer hover:bg-gray-50",onClick:()=>d(a),children:[(0,b.jsx)(k.TableCell,{className:"font-medium",children:(0,n.format)(new Date(a.date),"dd/MM/yyyy")}),(0,b.jsx)(k.TableCell,{children:a.receiptNumber}),(0,b.jsx)(k.TableCell,{children:(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("div",{children:a.customerName}),J&&(0,b.jsx)(F.Badge,{variant:"outline",className:"text-xs bg-green-50 text-green-700 border-green-200",children:J}),"Installment Sale"===a.paymentStatus&&V>0&&(0,b.jsxs)(F.Badge,{variant:"outline",className:"text-xs bg-red-50 text-red-700 border-red-200",children:["Due: ",c," ",(0,N.formatNumber)(V)]})]})}),(0,b.jsx)(k.TableCell,{children:(0,b.jsxs)(M.Tooltip,{children:[(0,b.jsx)(M.TooltipTrigger,{asChild:!0,children:(0,b.jsx)("span",{className:"line-clamp-1 cursor-help",children:E})}),(0,b.jsx)(M.TooltipContent,{side:"top",className:"max-w-xs",children:(0,b.jsx)("div",{className:"space-y-1",children:(0,b.jsx)("p",{className:"font-bold break-words whitespace-normal",children:E})})})]})}),(0,b.jsx)(k.TableCell,{className:"text-right",children:x}),(0,b.jsxs)(k.TableCell,{className:"text-right",children:[c," ",(0,N.formatNumber)(z)]}),(0,b.jsx)(k.TableCell,{className:"text-right",children:B>0?(0,b.jsxs)("span",{className:"text-orange-600",children:["-",c," ",(0,N.formatNumber)(B)]}):(0,b.jsx)("span",{className:"text-gray-400",children:"-"})}),(0,b.jsx)(k.TableCell,{className:"text-right",children:v?`${c} ${u(D,"cost")}`:"•••"}),(0,b.jsx)(k.TableCell,{className:"text-right",children:(0,b.jsx)("span",{className:"text-green-600 font-medium",children:w?`${c} ${(0,N.formatNumber)(C-D)}`:"•••"})}),(0,b.jsxs)(k.TableCell,{className:"text-right",children:[c," ",(0,N.formatNumber)(C),"Installment Sale"===a.paymentStatus&&U>0&&(0,b.jsxs)("div",{className:"text-xs text-green-600",children:["Paid: ",c," ",(0,N.formatNumber)(U)]})]}),(0,b.jsx)(k.TableCell,{children:(0,b.jsx)("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${(()=>{switch(a.paymentStatus){case"Paid":return"bg-green-100 text-green-800";case"Quote":return"bg-purple-100 text-purple-800";case"Installment Sale":return"bg-blue-100 text-blue-800";default:return"bg-yellow-100 text-yellow-800"}})()}`,children:"Installment Sale"===a.paymentStatus?"Installment":a.paymentStatus})}),(0,b.jsx)(k.TableCell,{onClick:a=>a.stopPropagation(),children:(0,b.jsxs)("div",{className:"flex justify-end gap-1",children:[(0,b.jsxs)(f.Button,{variant:"ghost",size:"sm",onClick:b=>{b.stopPropagation(),d(a)},children:[(0,b.jsx)(G.Printer,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"sr-only",children:"View Receipt"})]}),W&&i&&(0,b.jsxs)(f.Button,{variant:"ghost",size:"sm",onClick:b=>{b.stopPropagation(),i(a)},className:"text-orange-600 hover:text-orange-700 hover:bg-orange-50",title:"Send Payment Reminder",children:[(0,b.jsx)(g.FileText,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"sr-only",children:"Send Payment Reminder"})]}),X&&i&&(0,b.jsxs)(f.Button,{variant:"ghost",size:"sm",onClick:b=>{b.stopPropagation(),i(a)},className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50",title:"Send Due Payment Reminder",children:[(0,b.jsx)(g.FileText,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"sr-only",children:"Send Due Payment Reminder"})]}),W&&$&&l&&(0,b.jsxs)(f.Button,{variant:"ghost",size:"sm",onClick:b=>{b.stopPropagation(),l(a)},className:"text-orange-600 hover:text-orange-700 hover:bg-orange-50",title:"Send Payment Reminder SMS",children:[(0,b.jsx)(L.MessageSquare,{className:"h-3 w-3"}),(0,b.jsx)("span",{className:"sr-only",children:"Send Payment Reminder SMS"})]}),j&&(0,b.jsxs)(f.Button,{variant:"ghost",size:"sm",onClick:b=>{b.stopPropagation(),j(a)},className:"text-purple-600 hover:text-purple-700 hover:bg-purple-50",title:"Send Thank You Notice",children:[(0,b.jsx)(K,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"sr-only",children:"Send Thank You Notice"})]}),$&&m&&(0,b.jsxs)(f.Button,{variant:"ghost",size:"sm",onClick:b=>{b.stopPropagation(),m(a)},className:"text-purple-600 hover:text-purple-700 hover:bg-purple-50",title:"Send Thank You SMS",children:[(0,b.jsx)(L.MessageSquare,{className:"h-3 w-3"}),(0,b.jsx)("span",{className:"sr-only",children:"Send Thank You SMS"})]}),t("sales","edit")&&(0,b.jsxs)(f.Button,{variant:"ghost",size:"sm",onClick:b=>{b.stopPropagation(),e(a)},children:[(0,b.jsx)(H.Edit,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"sr-only",children:"Edit Sale"})]}),t("sales","delete")&&(0,b.jsxs)(f.Button,{variant:"ghost",size:"sm",onClick:b=>{b.stopPropagation(),h(a)},children:[(0,b.jsx)(I.Trash2,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"sr-only",children:"Delete Sale"})]})]})})]})};var V=a.i(463242),W=a.i(486192);let X=({isOpen:a,onOpenChange:c,onConfirm:d,isDeleting:e=!1})=>(0,b.jsx)(W.AlertDialog,{open:a,onOpenChange:c,children:(0,b.jsxs)(W.AlertDialogContent,{children:[(0,b.jsxs)(W.AlertDialogHeader,{children:[(0,b.jsx)(W.AlertDialogTitle,{children:"Are you sure?"}),(0,b.jsx)(W.AlertDialogDescription,{children:"This action cannot be undone. This will permanently delete this sale record."})]}),(0,b.jsxs)(W.AlertDialogFooter,{children:[(0,b.jsx)(W.AlertDialogCancel,{disabled:e,children:"Cancel"}),(0,b.jsx)(W.AlertDialogAction,{onClick:d,disabled:e,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90 disabled:opacity-50",children:e?"Deleting...":"Delete"})]})]})});var Y=a.i(248840),Z=a.i(139130),$=a.i(870430),_=a.i(814574);let aa=()=>{let{categories:a,createCategory:d,updateCategory:e,deleteCategory:g,createDefaultCategories:h}=(0,D.useSalesCategories)(),[i,j]=(0,c.useState)(!1),[k,l]=(0,c.useState)(""),[n,o]=(0,c.useState)(null),[p,q]=(0,c.useState)(""),[r,s]=(0,c.useState)(!1),[t,v]=(0,c.useState)(null),w=async()=>{!k.trim()||await d(k.trim())&&l("")},x=async()=>{n&&p.trim()&&await e(n.id,p.trim())&&(o(null),q(""))},y=async()=>{!t||await g(t.id)&&(s(!1),v(null))},z=async()=>{await h()};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(_.Dialog,{open:i,onOpenChange:j,children:[(0,b.jsx)(_.DialogTrigger,{asChild:!0}),(0,b.jsxs)(_.DialogContent,{className:"max-w-2xl",children:[(0,b.jsx)(_.DialogHeader,{children:(0,b.jsx)(_.DialogTitle,{children:"Manage Sales Categories"})}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)($.Label,{htmlFor:"new-category",children:"Add New Category"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(u.Input,{id:"new-category",placeholder:"Category name",value:k,onChange:a=>l(a.target.value),onKeyPress:a=>"Enter"===a.key&&w()}),(0,b.jsxs)(f.Button,{onClick:w,disabled:!k.trim(),children:[(0,b.jsx)(m.Plus,{className:"h-4 w-4 mr-2"}),"Add"]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)($.Label,{children:"Existing Categories"}),0===a.length&&(0,b.jsx)(f.Button,{variant:"outline",size:"sm",onClick:z,children:"Create Default Categories"})]}),a.length>0?(0,b.jsx)("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:a.map(a=>(0,b.jsx)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:n?.id===a.id?(0,b.jsxs)("div",{className:"flex gap-2 flex-1",children:[(0,b.jsx)(u.Input,{value:p,onChange:a=>q(a.target.value),onKeyPress:a=>"Enter"===a.key&&x(),className:"flex-1"}),(0,b.jsx)(f.Button,{size:"sm",onClick:x,children:"Save"}),(0,b.jsx)(f.Button,{size:"sm",variant:"outline",onClick:()=>o(null),children:"Cancel"})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"font-medium",children:a.name}),a.is_default&&(0,b.jsx)("span",{className:"text-xs bg-muted px-2 py-1 rounded",children:"Default"})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(f.Button,{size:"sm",variant:"outline",onClick:()=>{o(a),q(a.name)},children:(0,b.jsx)(H.Edit,{className:"h-4 w-4"})}),(0,b.jsx)(f.Button,{size:"sm",variant:"outline",onClick:()=>{v(a),s(!0)},children:(0,b.jsx)(I.Trash2,{className:"h-4 w-4"})})]})]})},a.id))}):(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"No categories found. Create your first category above."})]})]})]})]}),(0,b.jsx)(W.AlertDialog,{open:r,onOpenChange:s,children:(0,b.jsxs)(W.AlertDialogContent,{children:[(0,b.jsxs)(W.AlertDialogHeader,{children:[(0,b.jsx)(W.AlertDialogTitle,{children:"Delete Category"}),(0,b.jsxs)(W.AlertDialogDescription,{children:['Are you sure you want to delete "',t?.name,'"? This action cannot be undone.']})]}),(0,b.jsxs)(W.AlertDialogFooter,{children:[(0,b.jsx)(W.AlertDialogCancel,{children:"Cancel"}),(0,b.jsx)(W.AlertDialogAction,{onClick:y,children:"Delete"})]})]})})]})};var ab=a.i(591119),ac=a.i(724669),ad=a.i(790166),ae=a.i(856738);let af=({sales:a,currency:d})=>{let{formatFinancial:e,canViewCostPrice:f,canViewProfit:g,canViewTotalAmount:h,canViewSellingPrice:i}=(0,T.useFinancialVisibility)(),j=(0,c.useMemo)(()=>a.reduce((a,b)=>{let c=b.items.reduce((a,b)=>{let c=b.price*b.quantity,d="amount"===b.discountType?b.discountAmount||0:c*(b.discountPercentage||0)/100;return a+(c-d)},0),d=c+(b.taxRate||0)/100*c,e=b.items.reduce((a,b)=>a+b.cost*b.quantity,0);return{totalSales:a.totalSales+d,totalCost:a.totalCost+e,totalProfit:a.totalProfit+(d-e)}},{totalSales:0,totalCost:0,totalProfit:0}),[a]);return(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[(0,b.jsx)(ab.Card,{className:"bg-blue-50 border-blue-100",children:(0,b.jsxs)(ab.CardContent,{className:"p-6 flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium text-blue-600 mb-1",children:"Total Sales"}),(0,b.jsx)("h3",{className:"text-2xl font-bold text-blue-900",children:h||i?`${d} ${(0,N.formatNumber)(j.totalSales)}`:"•••"}),(0,b.jsxs)("p",{className:"text-xs text-blue-500 mt-1",children:["Based on ",a.length," records"]})]}),(0,b.jsx)("div",{className:"h-12 w-12 bg-blue-100 rounded-full flex items-center justify-center",children:(0,b.jsx)(ac.TrendingUp,{className:"h-6 w-6 text-blue-600"})})]})}),(0,b.jsx)(ab.Card,{className:"bg-orange-50 border-orange-100",children:(0,b.jsxs)(ab.CardContent,{className:"p-6 flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium text-orange-600 mb-1",children:"Total Cost"}),(0,b.jsx)("h3",{className:"text-2xl font-bold text-orange-900",children:f?`${d} ${(0,N.formatNumber)(j.totalCost)}`:"•••"}),(0,b.jsx)("p",{className:"text-xs text-orange-500 mt-1",children:"Cost of goods sold"})]}),(0,b.jsx)("div",{className:"h-12 w-12 bg-orange-100 rounded-full flex items-center justify-center",children:(0,b.jsx)(ae.Wallet,{className:"h-6 w-6 text-orange-600"})})]})}),(0,b.jsx)(ab.Card,{className:"bg-green-50 border-green-100",children:(0,b.jsxs)(ab.CardContent,{className:"p-6 flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium text-green-600 mb-1",children:"Total Profit"}),(0,b.jsx)("h3",{className:"text-2xl font-bold text-green-900",children:g?`${d} ${(0,N.formatNumber)(j.totalProfit)}`:"•••"}),(0,b.jsx)("p",{className:"text-xs text-green-500 mt-1",children:"Net earnings"})]}),(0,b.jsx)("div",{className:"h-12 w-12 bg-green-100 rounded-full flex items-center justify-center",children:(0,b.jsx)(ad.DollarSign,{className:"h-6 w-6 text-green-600"})})]})})]})};var ag=a.i(985579),ah=a.i(528671),ai=a.i(501199),aj=a.i(355442);let ak={businessName:"Your Business Name",businessAddress:"Your Business Address",businessPhone:"(123) 456-7890",businessEmail:"support@yourbusiness.com",businessLogo:"",currency:"UGX"},al=c.default.memo(({sale:a,settings:c,onViewReceipt:d,onEditSale:e,onDeleteSale:h,onSendPaymentReminder:i,onSendThankYouNotice:j,cashAccountName:k})=>{let{payments:l}=(0,S.useInstallmentPayments)(a.id),{hasPermission:m}=(0,s.useProfiles)(),{canViewCostPrice:n,canViewProfit:o,canViewSellingPrice:p,canViewTotalAmount:q}=(0,T.useFinancialVisibility)(),r=a.items.reduce((a,b)=>{let c=b.price*b.quantity,d="amount"===b.discountType?b.discountAmount||0:c*(b.discountPercentage||0)/100;return a+(c-d)},0),t=a.items.reduce((a,b)=>{let c=b.price*b.quantity;return a+("amount"===b.discountType?b.discountAmount||0:c*(b.discountPercentage||0)/100)},0),u=a.taxRate||0,v=r+u/100*r,w=a.items.reduce((a,b)=>a+b.cost*b.quantity,0),x="Installment Sale"===a.paymentStatus?l.reduce((a,b)=>a+b.amount,0):a.amountPaid||0,y="Installment Sale"===a.paymentStatus?Math.max(0,v-x):a.amountDue||0,z="No items";a.items&&Array.isArray(a.items)&&a.items.length>0&&(z=a.items[0].description,a.items.length>1&&(z+=` (+${a.items.length-1} more)`));let A="NOT PAID"===a.paymentStatus,B="Installment Sale"===a.paymentStatus&&y>0,C=(()=>{switch(a.paymentStatus){case"Paid":default:return ai.Receipt;case"NOT PAID":return g.FileText;case"Quote":return aj.Quote}})(),D=(()=>{switch(a.paymentStatus){case"Paid":default:return"Receipt";case"NOT PAID":return"Invoice";case"Quote":return"Quotation"}})();return(0,b.jsx)(ab.Card,{className:`mb-3 bg-white border shadow-sm ${k?"border-l-4 border-l-green-500 border-green-200":"border-gray-200"}`,children:(0,b.jsxs)(ab.CardContent,{className:"p-4",children:[k&&(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2 p-2 bg-green-50 rounded-md border border-green-200",children:[(0,b.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full flex-shrink-0"}),(0,b.jsxs)("span",{className:"text-xs font-medium text-green-700 truncate",children:["Linked to: ",k]})]}),(0,b.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,b.jsxs)("div",{className:"flex-1 min-w-0 pr-2",children:[(0,b.jsx)("p",{className:"font-semibold text-gray-900 text-sm truncate",children:a.customerName}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-0.5",children:new Date(a.date).toLocaleDateString("en-GB")}),"Installment Sale"===a.paymentStatus&&y>0&&(0,b.jsxs)(F.Badge,{variant:"outline",className:"text-xs bg-red-50 text-red-700 border-red-200 mt-1",children:["Due: ",p||q?`${c.currency} ${(0,N.formatNumber)(y)}`:"•••"]})]}),(0,b.jsx)("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium whitespace-nowrap ${(()=>{switch(a.paymentStatus){case"Paid":return"bg-green-100 text-green-700";case"Quote":return"bg-purple-100 text-purple-700";case"Installment Sale":return"bg-blue-100 text-blue-700";default:return"bg-yellow-100 text-yellow-700"}})()}`,children:"Installment Sale"===a.paymentStatus?"Installment":"NOT PAID"===a.paymentStatus?"Credit":a.paymentStatus})]}),(0,b.jsxs)(M.Tooltip,{children:[(0,b.jsx)(M.TooltipTrigger,{asChild:!0,children:(0,b.jsx)("p",{className:"text-xs text-gray-600 mb-3 line-clamp-1 cursor-help",children:z})}),(0,b.jsx)(M.TooltipContent,{side:"top",className:"max-w-xs",children:(0,b.jsx)("div",{className:"space-y-1",children:(0,b.jsx)("p",{className:"font-bold break-words whitespace-normal",children:z})})})]}),(0,b.jsxs)("div",{className:"space-y-3 mb-3",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsxs)("div",{className:"text-left",children:[(0,b.jsx)("p",{className:"text-xs text-gray-500",children:"Cost"}),(0,b.jsx)("p",{className:"font-semibold text-gray-900",children:n?`${c.currency} ${(0,N.formatNumber)(w)}`:"•••"})]}),t>0?(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("p",{className:"text-xs text-gray-500",children:"Discount"}),(0,b.jsx)("p",{className:"font-semibold text-orange-600",children:p?`-${c.currency} ${(0,N.formatNumber)(t)}`:"•••"})]}):(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("p",{className:"text-xs text-gray-500",children:"Discount"}),(0,b.jsx)("p",{className:"font-semibold text-gray-400",children:"-"})]})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsxs)("div",{className:"text-left",children:[(0,b.jsx)("p",{className:"text-xs text-gray-500",children:"Total Amount"}),(0,b.jsx)("p",{className:"font-semibold text-gray-900",children:q||p?`${c.currency} ${(0,N.formatNumber)(v)}`:"•••"}),u>0&&(0,b.jsx)("p",{className:"text-xs text-gray-500",children:"Tax incl."}),"Installment Sale"===a.paymentStatus&&x>0&&(0,b.jsxs)("p",{className:"text-xs text-green-600 mt-1",children:["Paid: ",q||p?`${c.currency} ${(0,N.formatNumber)(x)}`:"•••"]})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("p",{className:"text-xs text-gray-500",children:"Profit"}),(0,b.jsx)("p",{className:"font-semibold text-green-600",children:o?`${c.currency} ${(0,N.formatNumber)(v-w)}`:"•••"})]})]})]}),(0,b.jsxs)("div",{className:"pt-3 border-t border-gray-100 space-y-2",children:[(0,b.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",onClick:()=>d(a),className:"flex items-center gap-1.5 text-xs h-8 border-gray-200 flex-1 min-w-0",children:[(0,b.jsx)(C,{className:"h-3 w-3 flex-shrink-0"}),(0,b.jsx)("span",{className:"truncate",children:D})]}),A&&(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",onClick:()=>i(a),className:"flex items-center gap-1.5 text-xs h-8 border-orange-200 text-orange-600 hover:bg-orange-50 flex-1 min-w-0",children:[(0,b.jsx)(g.FileText,{className:"h-3 w-3 flex-shrink-0"}),(0,b.jsx)("span",{className:"truncate",children:"Reminder"})]}),B&&(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",onClick:()=>i(a),className:"flex items-center gap-1.5 text-xs h-8 border-blue-200 text-blue-600 hover:bg-blue-50 flex-1 min-w-0",children:[(0,b.jsx)(g.FileText,{className:"h-3 w-3 flex-shrink-0"}),(0,b.jsx)("span",{className:"truncate",children:"Due Reminder"})]}),(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",onClick:()=>j(a),className:"flex items-center gap-1.5 text-xs h-8 border-purple-200 text-purple-600 hover:bg-purple-50 flex-1 min-w-0",children:[(0,b.jsx)(K,{className:"h-3 w-3 flex-shrink-0"}),(0,b.jsx)("span",{className:"truncate",children:"Thanks"})]})]}),(0,b.jsxs)("div",{className:"flex justify-center gap-2",children:[m("sales","edit")&&(0,b.jsxs)(f.Button,{variant:"ghost",size:"sm",onClick:()=>e(a),className:"h-8 px-3 hover:bg-blue-50 hover:text-blue-600 flex items-center gap-1",children:[(0,b.jsx)(H.Edit,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"text-xs",children:"Edit"})]}),m("sales","delete")&&(0,b.jsxs)(f.Button,{variant:"ghost",size:"sm",onClick:()=>h(a),className:"h-8 px-3 hover:bg-red-50 hover:text-red-600 flex items-center gap-1",children:[(0,b.jsx)(I.Trash2,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"text-xs",children:"Delete"})]})]})]})]})})});al.displayName="MobileCard";let am=({sales:a,onViewReceipt:d,onEditSale:e,onDeleteSale:f,currency:i="USD",onDateFilterChange:j,onDateRangeChange:l,isLoading:m=!1,mobileOptimized:n=!1})=>{let[o,s]=(0,c.useState)({...ak,currency:i}),[u,v]=(0,c.useState)(null),[w,x]=(0,c.useState)(!1),[y,z]=(0,c.useState)(!1),[A,B]=(0,c.useState)(null),[C,D]=(0,c.useState)(!1),[F,G]=(0,c.useState)(null),[H,I]=(0,c.useState)(!1),{accounts:J}=(0,O.useCashAccounts)(),{transactions:K}=(0,P.useCashTransactions)(),{settings:L}=(0,q.useBusinessSettings)(),{toast:N}=(0,p.useToast)(),S=(0,Q.useIsMobile)(),{searchQuery:T,setSearchQuery:W,paymentFilter:$,setPaymentFilter:_,cashTransactionFilter:ab,setCashTransactionFilter:ac,categoryFilter:ad,setCategoryFilter:ae,dateFilter:am,setDateFilter:an,dateRange:ao,setDateRange:ap,specificDate:aq,setSpecificDate:ar,isCustomRange:as,isSpecificDate:at,filteredSales:au}=(a=>{let b=(()=>{try{let a=localStorage.getItem("salesFilters");if(a){let b=JSON.parse(a);return{searchQuery:b.searchQuery||"",dateFilter:b.dateFilter||"this-month",paymentFilter:b.paymentFilter||"all",cashTransactionFilter:b.cashTransactionFilter||"all",categoryFilter:b.categoryFilter||"all",dateRange:b.dateRange?{from:b.dateRange.from?new Date(b.dateRange.from):void 0,to:b.dateRange.to?new Date(b.dateRange.to):void 0}:{from:void 0,to:void 0},specificDate:b.specificDate?new Date(b.specificDate):void 0}}}catch(a){console.error("Error loading persisted sales filters:",a)}return{searchQuery:"",dateFilter:"this-month",paymentFilter:"all",cashTransactionFilter:"all",categoryFilter:"all",dateRange:{from:void 0,to:void 0},specificDate:void 0}})(),[d,e]=(0,c.useState)(b.searchQuery),[f,g]=(0,c.useState)(b.paymentFilter),[h,i]=(0,c.useState)(b.cashTransactionFilter),[j,k]=(0,c.useState)(b.categoryFilter),[l,m]=(0,c.useState)(b.dateFilter),[n,o]=(0,c.useState)(b.dateRange),[p,q]=(0,c.useState)(b.specificDate);(0,c.useEffect)(()=>{let a={searchQuery:d,dateFilter:l,paymentFilter:f,cashTransactionFilter:h,categoryFilter:j,dateRange:{from:n.from?.toISOString(),to:n.to?.toISOString()},specificDate:p?.toISOString()};localStorage.setItem("salesFilters",JSON.stringify(a))},[d,l,f,h,j,n,p]);let s="custom"===l,t="specific"===l,u=(0,c.useMemo)(()=>{let b=[...a];if(d.trim()){let a=d.toLowerCase();b=b.filter(b=>b.customerName.toLowerCase().includes(a)||b.receiptNumber.toLowerCase().includes(a)||b.items.some(b=>b.description.toLowerCase().includes(a)))}if("all"!==f&&(b=b.filter(a=>a.paymentStatus===f)),"all"!==h&&("linked"===h?b=b.filter(a=>a.cashTransactionId):"unlinked"===h&&(b=b.filter(a=>!a.cashTransactionId))),"all"!==j&&(b="none"===j?b.filter(a=>!a.categoryId):b.filter(a=>a.categoryId===j)),"all"!==l)if(t&&p)b=b.filter(a=>{let b=new Date(a.date);return(0,ag.isSameDay)(b,p)});else if(s&&n.from&&n.to){let a=n.from,c=n.to;b=b.filter(b=>{let d=new Date(b.date);return d>=a&&d<=c})}else{let a=(0,r.getDateRangeFromFilter)(l),c=a.from,d=a.to;b=b.filter(a=>{let b=new Date(a.date);return b>=c&&b<=d})}return b},[a,d,f,h,j,l,n,p,s,t]);return{searchQuery:d,setSearchQuery:e,paymentFilter:f,setPaymentFilter:g,cashTransactionFilter:h,setCashTransactionFilter:i,categoryFilter:j,setCategoryFilter:k,dateFilter:l,setDateFilter:m,dateRange:n,setDateRange:o,specificDate:p,setSpecificDate:q,isCustomRange:s,isSpecificDate:t,filteredSales:u}})(a),av=(0,c.useMemo)(()=>au,[au]),{currentPage:aw,setCurrentPage:ax,paginatedItems:ay,totalPages:az}=(0,ah.usePagination)({items:av,itemsPerPage:n?5:10});(0,c.useEffect)(()=>{j&&j(am)},[am,j]),(0,c.useEffect)(()=>{l&&as&&l(ao)},[ao,as,l]),(0,c.useEffect)(()=>{s(a=>({...a,currency:i}));let a=localStorage.getItem("businessSettings");if(a){let b=JSON.parse(a);s({...b,currency:i||b.currency})}},[i]);let aA=(0,c.useCallback)(a=>{if(!a.cashTransactionId)return null;let b=K.find(b=>b.id===a.cashTransactionId);if(!b||!b.accountId)return null;let c=J.find(a=>a.id===b.accountId);return c?c.name:null},[K,J]);(0,c.useCallback)(a=>{switch(a){case"Paid":default:return"Receipt";case"NOT PAID":return"Invoice";case"Quote":return"Quotation"}},[]),(0,c.useCallback)(a=>{switch(a){case"Paid":default:return ai.Receipt;case"NOT PAID":return g.FileText;case"Quote":return aj.Quote}},[]);let aB=(0,c.useCallback)(a=>{v(a),x(!0)},[]),aC=(0,c.useCallback)(async()=>{if(u&&!y){z(!0);try{await f(u),x(!1),v(null)}finally{z(!1)}}},[u,f,y]),aD=(0,c.useCallback)(a=>{y||a||(x(!1),v(null))},[y]),aE=(0,c.useCallback)(a=>{B(a),D(!0)},[]),aF=(0,c.useCallback)(()=>{D(!1),B(null)},[]),aG=(0,c.useCallback)(async a=>{try{a.customerId,a.customerName,a.customerContact,a.customerAddress,a.items.reduce((a,b)=>a+b.price*b.quantity,0),a.taxRate,G(a),I(!0)}catch(a){console.error("Error generating payment reminder:",a),N({title:"Error",description:"Failed to generate payment reminder. Please try again.",variant:"destructive"})}},[L,o,N]);return((0,c.useCallback)(a=>{if(!(0,R.canSendSMS)({phoneNumber:a.customerContact}))return void N({title:"Phone number required",description:"Customer phone number is not available for WhatsApp.",variant:"destructive"});let b=(0,R.getThankYouMessage)(a,L||o);(0,R.openWhatsApp)({phoneNumber:a.customerContact,message:b}),N({title:"WhatsApp Opened",description:`Opening WhatsApp chat for ${a.customerName}`})},[L,o,N]),m)?(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-[40vh] space-y-4",children:[(0,b.jsx)("img",{src:"/lovable-uploads/7f7549a3-e9df-4762-b8b9-8e041e34f55d.png",alt:"Loading",className:"w-12 h-12 animate-spin"}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"Loading sales..."})]}):(0,b.jsx)(M.TooltipProvider,{children:(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-border/50",children:[(0,b.jsx)("div",{className:"p-4 sm:p-6 border-b border-border/50",children:(0,b.jsx)("div",{className:"flex flex-col gap-4",children:(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-xl sm:text-2xl font-bold text-foreground",children:"Sales Records"}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:[av.length," ",1===av.length?"record":"records"," found"]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(aa,{}),(0,b.jsx)("div",{className:"w-full sm:w-auto",children:(0,b.jsx)(t,{filteredSales:av,allSales:a,currency:o.currency})})]})]})})}),(0,b.jsxs)("div",{className:"p-4 sm:p-6",children:[(0,b.jsx)(af,{sales:av,currency:o.currency}),(0,b.jsx)(E,{searchQuery:T,setSearchQuery:W,paymentFilter:$,setPaymentFilter:_,cashTransactionFilter:ab,setCashTransactionFilter:ac,categoryFilter:ad,setCategoryFilter:ae,dateFilter:am,setDateFilter:an,dateRange:ao,setDateRange:ap,specificDate:aq,setSpecificDate:ar,isCustomRange:as,isSpecificDate:at}),av.length>0?(0,b.jsxs)(b.Fragment,{children:[S?(0,b.jsx)("div",{className:"space-y-3",children:ay.map(a=>(0,b.jsx)(al,{sale:a,settings:o,onViewReceipt:d,onEditSale:e,onDeleteSale:aB,onSendPaymentReminder:aG,onSendThankYouNotice:aE,cashAccountName:aA(a)},a.id))}):(0,b.jsx)("div",{className:"overflow-x-auto border rounded-lg",children:(0,b.jsxs)(k.Table,{children:[(0,b.jsx)(k.TableHeader,{children:(0,b.jsxs)(k.TableRow,{children:[(0,b.jsx)(k.TableHead,{children:"Date"}),(0,b.jsx)(k.TableHead,{children:"Receipt #"}),(0,b.jsx)(k.TableHead,{children:"Customer"}),(0,b.jsx)(k.TableHead,{children:"Item"}),(0,b.jsx)(k.TableHead,{className:"text-right",children:"Total Qty"}),(0,b.jsx)(k.TableHead,{className:"text-right",children:"Avg Price"}),(0,b.jsx)(k.TableHead,{className:"text-right",children:"Discount"}),(0,b.jsx)(k.TableHead,{className:"text-right",children:"Cost"}),(0,b.jsx)(k.TableHead,{className:"text-right",children:"Profit"}),(0,b.jsx)(k.TableHead,{className:"text-right",children:"Total (incl. Tax)"}),(0,b.jsx)(k.TableHead,{children:"Status"}),(0,b.jsx)(k.TableHead,{className:"text-right",children:"Actions"})]})}),(0,b.jsx)(k.TableBody,{children:ay.map(a=>(0,b.jsx)(U,{sale:a,currency:o.currency,onViewReceipt:d,onEditSale:e,onDeleteSale:aB,onSendPaymentReminder:aG,onSendThankYouNotice:aE},a.id))})]})}),(0,b.jsx)("div",{className:"mt-6",children:(0,b.jsx)(V.default,{currentPage:aw,totalPages:az,onPageChange:ax})})]}):(0,b.jsx)(h,{})]})]}),(0,b.jsx)(X,{isOpen:w,onOpenChange:aD,onConfirm:aC,isDeleting:y}),A&&(0,b.jsx)(Y.default,{customer:{id:A.customerId||"",fullName:A.customerName,phoneNumber:A.customerContact||"",email:"",location:A.customerAddress||"",categoryId:null,createdAt:new Date,updatedAt:new Date,birthday:null,socialMedia:null,gender:null,tags:null,notes:null},open:C,onClose:aF,defaultTemplate:"thank_you",sale:A}),(0,b.jsx)(Z.default,{isOpen:H,onOpenChange:I,sale:F})]})})},an=({sales:a,onViewReceipt:d,onEditSale:e,onDeleteSale:f,currency:g,isLoading:h})=>(0,b.jsx)("div",{className:"space-y-6",children:(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)(i,{}),children:(0,b.jsx)(am,{sales:a,onViewReceipt:d,onEditSale:e,onDeleteSale:f,currency:g,isLoading:h,mobileOptimized:!1})})});var ao=a.i(626109);let ap=({selectedSale:a,isOpen:c,onOpenChange:d,currency:e})=>a?(0,b.jsx)(ao.default,{sale:a,isOpen:c,onOpenChange:d,currency:e}):null;var aq=a.i(538784);let ar=(0,J.default)("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]);(0,J.default)("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);var as=a.i(510448),at=a.i(533441),au=a.i(633508),av=a.i(321161),aw=a.i(730769),ax=a.i(823292),ay=a.i(367638),az=a.i(661042),aA=a.i(609635),aB=a.i(65052),aC=a.i(355258),aD=a.i(322658),aE=a.i(275218),aF=a.i(717869),aG=a.i(148817),aH=a.i(933875),aI=a.i(668465);let aJ=({sales:a,formatCurrency:d})=>{let{canViewProfit:e}=(0,T.useFinancialVisibility)(),{categories:g,createCategory:h,updateCategory:i,deleteCategory:j}=(0,D.useSalesCategories)(),l=(0,Q.useIsMobile)(),[o,p]=(0,c.useState)(null),[q,r]=(0,c.useState)(""),[s,t]=(0,c.useState)(""),[w,z]=(0,c.useState)(!1),[A,B]=(0,c.useState)(null),[C,E]=(0,c.useState)(!1),[F,G]=(0,c.useState)(!1),[H,J]=(0,c.useState)("all-time"),[K,L]=(0,c.useState)(),[M,O]=(0,c.useState)(),[P,R]=(0,c.useState)(),S=(0,c.useMemo)(()=>{let b=a,c=(a=>{let b=new Date;switch(a){case"today":return{start:(0,ay.startOfDay)(b),end:(0,az.endOfDay)(b)};case"yesterday":let c=(0,aG.subDays)(b,1);return{start:(0,ay.startOfDay)(c),end:(0,az.endOfDay)(c)};case"this-week":return{start:(0,aA.startOfWeek)(b),end:(0,aB.endOfWeek)(b)};case"last-week":return{start:(0,aA.startOfWeek)((0,aH.subWeeks)(b,1)),end:(0,aB.endOfWeek)((0,aH.subWeeks)(b,1))};case"this-month":return{start:(0,aC.startOfMonth)(b),end:(0,aD.endOfMonth)(b)};case"last-month":return{start:(0,aC.startOfMonth)((0,aI.subMonths)(b,1)),end:(0,aD.endOfMonth)((0,aI.subMonths)(b,1))};case"this-year":return{start:(0,aE.startOfYear)(b),end:(0,aF.endOfYear)(b)};case"specific-date":if(P)return{start:(0,ay.startOfDay)(P),end:(0,az.endOfDay)(P)};return null;case"custom-range":if(K&&M)return{start:(0,ay.startOfDay)(K),end:(0,az.endOfDay)(M)};if(K)return{start:(0,ay.startOfDay)(K),end:(0,az.endOfDay)(b)};if(M)return{start:(0,ay.startOfDay)(new Date(0)),end:(0,az.endOfDay)(M)};return null;default:return null}})(H);c&&(b=a.filter(a=>{let b=new Date(a.date);return b>=c.start&&b<=c.end}));let d=g.map(a=>{let c=b.filter(b=>b.categoryId===a.id),d=c.reduce((a,b)=>a+b.items.reduce((a,b)=>a+b.quantity*b.price,0),0),e=c.reduce((a,b)=>a+(b.profit||0),0),f=c.length;return{name:a.name,revenue:d,profit:e,transactions:f,averageValue:f>0?d/f:0}}),e=b.filter(a=>!a.categoryId);if(e.length>0){let a=e.reduce((a,b)=>a+b.items.reduce((a,b)=>a+b.quantity*b.price,0),0),b=e.reduce((a,b)=>a+(b.profit||0),0),c=e.length;d.push({name:"Uncategorized",revenue:a,profit:b,transactions:c,averageValue:c>0?a/c:0})}return d.sort((a,b)=>b.revenue-a.revenue)},[a,g,H,K,M,P]);(0,c.useMemo)(()=>S.filter(a=>a.revenue>0).map((a,b)=>({...a,fill:`hsl(var(--chart-${b%5+1}))`})),[S]);let U=async()=>{if(o&&q.trim())try{await i(o,q.trim()),p(null),r(""),ax.toast.success("Category updated successfully")}catch(a){ax.toast.error("Failed to update category")}},V=()=>{p(null),r("")},X=async()=>{if(A){G(!0);try{await j(A.id),ax.toast.success("Category deleted successfully"),z(!1),B(null)}catch(a){ax.toast.error("Failed to delete category")}finally{G(!1)}}},Y=async()=>{if(s.trim()){E(!0);try{await h(s.trim()),t(""),ax.toast.success("Category created successfully")}catch(a){ax.toast.error("Failed to create category")}finally{E(!1)}}};return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)(ab.Card,{className:"shadow-sm",children:[(0,b.jsxs)(ab.CardHeader,{children:[(0,b.jsxs)(ab.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(av.Settings,{className:"w-5 h-5 text-primary"}),"Manage Sales Sources"]}),(0,b.jsx)(ab.CardDescription,{children:"Create, edit, or delete sales sources"})]}),(0,b.jsx)(ab.CardContent,{children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex gap-2 p-3 bg-muted/30 rounded-lg",children:[(0,b.jsx)(u.Input,{placeholder:"Enter New Sales Source",value:s,onChange:a=>t(a.target.value),onKeyDown:a=>"Enter"===a.key&&Y(),className:"flex-1"}),(0,b.jsx)(f.Button,{onClick:Y,disabled:!s.trim()||C,size:"sm",className:"shrink-0",children:C?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"w-4 h-4 mr-1 border-2 border-current border-t-transparent rounded-full animate-spin"}),"Adding..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(m.Plus,{className:"w-4 h-4 mr-1"}),"Add"]})})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[g.map(a=>(0,b.jsx)("div",{className:"flex items-center gap-2 p-3 border rounded-lg bg-background hover:bg-muted/20 transition-colors",children:o===a.id?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(u.Input,{value:q,onChange:a=>r(a.target.value),onKeyDown:a=>{"Enter"===a.key&&U(),"Escape"===a.key&&V()},className:"flex-1",autoFocus:!0}),(0,b.jsx)(f.Button,{size:"sm",variant:"outline",onClick:U,children:(0,b.jsx)(at.Check,{className:"w-4 h-4"})}),(0,b.jsx)(f.Button,{size:"sm",variant:"outline",onClick:V,children:(0,b.jsx)(au.X,{className:"w-4 h-4"})})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("span",{className:"flex-1 font-medium",children:a.name}),(0,b.jsx)(f.Button,{size:"sm",variant:"outline",onClick:()=>{p(a.id),r(a.name)},children:(0,b.jsx)(as.Edit2,{className:"w-4 h-4"})}),(0,b.jsx)(f.Button,{size:"sm",variant:"outline",onClick:()=>{B(a),z(!0)},className:"text-destructive hover:bg-destructive hover:text-destructive-foreground",children:(0,b.jsx)(I.Trash2,{className:"w-4 h-4"})})]})},a.id)),0===g.length&&(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No sources found. Create your first source above."})]})]})})]}),(0,b.jsxs)(ab.Card,{className:"shadow-sm",children:[(0,b.jsxs)(ab.CardHeader,{children:[(0,b.jsxs)(ab.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(aw.CalendarIcon,{className:"w-5 h-5 text-primary"}),"Date Filter"]}),(0,b.jsx)(ab.CardDescription,{children:"Filter source performance by time period"})]}),(0,b.jsxs)(ab.CardContent,{children:[(0,b.jsx)("div",{className:"flex flex-col sm:flex-row gap-4 items-end",children:(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Time Period"}),(0,b.jsxs)(v.Select,{value:H,onValueChange:J,children:[(0,b.jsx)(v.SelectTrigger,{className:"w-full",children:(0,b.jsx)(v.SelectValue,{placeholder:"Select time period"})}),(0,b.jsxs)(v.SelectContent,{className:"bg-background border shadow-lg z-50",children:[(0,b.jsx)(v.SelectItem,{value:"today",children:"Today"}),(0,b.jsx)(v.SelectItem,{value:"yesterday",children:"Yesterday"}),(0,b.jsx)(v.SelectItem,{value:"this-week",children:"This Week"}),(0,b.jsx)(v.SelectItem,{value:"last-week",children:"Last Week"}),(0,b.jsx)(v.SelectItem,{value:"this-month",children:"This Month"}),(0,b.jsx)(v.SelectItem,{value:"last-month",children:"Last Month"}),(0,b.jsx)(v.SelectItem,{value:"this-year",children:"This Year"}),(0,b.jsx)(v.SelectItem,{value:"all-time",children:"All Time"}),(0,b.jsx)(v.SelectItem,{value:"specific-date",children:"Specific Date"}),(0,b.jsx)(v.SelectItem,{value:"custom-range",children:"Custom Range"})]})]})]})}),"custom-range"===H&&(0,b.jsxs)("div",{className:"mt-4 grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"From Date"}),(0,b.jsxs)(x.Popover,{children:[(0,b.jsx)(x.PopoverTrigger,{asChild:!0,children:(0,b.jsxs)(f.Button,{variant:"outline",className:(0,N.cn)("w-full justify-start text-left font-normal",!K&&"text-muted-foreground"),children:[(0,b.jsx)(aw.CalendarIcon,{className:"mr-2 h-4 w-4"}),K?(0,n.format)(K,"PPP"):(0,b.jsx)("span",{children:"Pick start date"})]})}),(0,b.jsx)(x.PopoverContent,{className:"w-auto p-0",align:"start",children:(0,b.jsx)(y.Calendar,{mode:"single",selected:K,onSelect:L,initialFocus:!0,className:(0,N.cn)("p-3 pointer-events-auto")})})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"To Date"}),(0,b.jsxs)(x.Popover,{children:[(0,b.jsx)(x.PopoverTrigger,{asChild:!0,children:(0,b.jsxs)(f.Button,{variant:"outline",className:(0,N.cn)("w-full justify-start text-left font-normal",!M&&"text-muted-foreground"),children:[(0,b.jsx)(aw.CalendarIcon,{className:"mr-2 h-4 w-4"}),M?(0,n.format)(M,"PPP"):(0,b.jsx)("span",{children:"Pick end date"})]})}),(0,b.jsx)(x.PopoverContent,{className:"w-auto p-0",align:"start",children:(0,b.jsx)(y.Calendar,{mode:"single",selected:M,onSelect:O,initialFocus:!0,className:(0,N.cn)("p-3 pointer-events-auto")})})]})]})]}),"specific-date"===H&&(0,b.jsxs)("div",{className:"mt-4",children:[(0,b.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Select Date"}),(0,b.jsxs)(x.Popover,{children:[(0,b.jsx)(x.PopoverTrigger,{asChild:!0,children:(0,b.jsxs)(f.Button,{variant:"outline",className:(0,N.cn)("w-full sm:w-64 justify-start text-left font-normal",!P&&"text-muted-foreground"),children:[(0,b.jsx)(aw.CalendarIcon,{className:"mr-2 h-4 w-4"}),P?(0,n.format)(P,"PPP"):(0,b.jsx)("span",{children:"Pick a date"})]})}),(0,b.jsx)(x.PopoverContent,{className:"w-auto p-0",align:"start",children:(0,b.jsx)(y.Calendar,{mode:"single",selected:P,onSelect:R,initialFocus:!0,className:(0,N.cn)("p-3 pointer-events-auto")})})]})]}),"all-time"!==H&&(0,b.jsx)("div",{className:"mt-4 p-3 bg-muted/30 rounded-lg",children:(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Showing results for: ",(0,b.jsx)("span",{className:"font-medium",children:"today"===H?"Today":"yesterday"===H?"Yesterday":"this-week"===H?"This Week":"last-week"===H?"Last Week":"this-month"===H?"This Month":"last-month"===H?"Last Month":"this-year"===H?"This Year":"specific-date"===H&&P?(0,n.format)(P,"PPP"):"custom-range"===H&&K&&M?`${(0,n.format)(K,"PPP")} to ${(0,n.format)(M,"PPP")}`:"custom-range"===H&&K?`From ${(0,n.format)(K,"PPP")}`:"custom-range"===H&&M?`Until ${(0,n.format)(M,"PPP")}`:"Custom Period"})]})})]})]}),(0,b.jsxs)(ab.Card,{className:"shadow-sm",children:[(0,b.jsxs)(ab.CardHeader,{children:[(0,b.jsxs)(ab.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(ar,{className:"w-5 h-5 text-primary"}),"Source Rankings"]}),(0,b.jsx)(ab.CardDescription,{children:"Best performing sources ranked by revenue"})]}),(0,b.jsx)(ab.CardContent,{children:S.length>0?l?(0,b.jsx)("div",{className:"space-y-3",children:S.map((a,c)=>(0,b.jsx)(ab.Card,{className:"border border-border bg-card",children:(0,b.jsxs)(ab.CardContent,{className:"p-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-primary text-primary-foreground text-sm font-bold",children:c+1}),(0,b.jsx)("h3",{className:"font-semibold text-lg",children:a.name})]}),(0,b.jsx)(ar,{className:"w-5 h-5 text-primary"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-3",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center p-3 bg-muted/30 rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(ad.DollarSign,{className:"w-4 h-4 text-green-600"}),(0,b.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Total Revenue"})]}),(0,b.jsx)("span",{className:"font-semibold",children:d(a.revenue)})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center p-3 bg-muted/30 rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(ac.TrendingUp,{className:"w-4 h-4 text-blue-600"}),(0,b.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Total Profit"})]}),(0,b.jsx)("span",{className:"font-semibold",children:e?d(a.profit):"•••"})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center p-3 bg-muted/30 rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(aq.ShoppingCart,{className:"w-4 h-4 text-purple-600"}),(0,b.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Number of Sales"})]}),(0,b.jsx)("span",{className:"font-semibold",children:a.transactions})]})]})]})},a.name))}):(0,b.jsxs)(k.Table,{children:[(0,b.jsx)(k.TableHeader,{children:(0,b.jsxs)(k.TableRow,{children:[(0,b.jsx)(k.TableHead,{className:"w-12",children:"#"}),(0,b.jsx)(k.TableHead,{children:"Source Name"}),(0,b.jsx)(k.TableHead,{className:"text-right",children:"Total Revenue"}),(0,b.jsx)(k.TableHead,{className:"text-right",children:"Total Profit"}),(0,b.jsx)(k.TableHead,{className:"text-right",children:"Number of Sales"})]})}),(0,b.jsx)(k.TableBody,{children:S.map((a,c)=>(0,b.jsxs)(k.TableRow,{children:[(0,b.jsx)(k.TableCell,{className:"font-medium",children:(0,b.jsx)("div",{className:"flex items-center justify-center w-6 h-6 rounded-full bg-muted text-xs font-bold",children:c+1})}),(0,b.jsx)(k.TableCell,{className:"font-medium",children:a.name}),(0,b.jsx)(k.TableCell,{className:"text-right font-mono",children:d(a.revenue)}),(0,b.jsx)(k.TableCell,{className:"text-right font-mono",children:e?d(a.profit):"•••"}),(0,b.jsx)(k.TableCell,{className:"text-right",children:a.transactions})]},a.name))})]}):(0,b.jsx)("div",{className:"flex items-center justify-center h-64 text-muted-foreground",children:"No performance data available"})})]}),(0,b.jsx)(W.AlertDialog,{open:w,onOpenChange:z,children:(0,b.jsxs)(W.AlertDialogContent,{children:[(0,b.jsxs)(W.AlertDialogHeader,{children:[(0,b.jsx)(W.AlertDialogTitle,{children:"Delete Source"}),(0,b.jsxs)(W.AlertDialogDescription,{children:['Are you sure you want to delete the source "',A?.name,'"? This action cannot be undone. All sales in this source will be moved to "Uncategorized".']})]}),(0,b.jsxs)(W.AlertDialogFooter,{children:[(0,b.jsx)(W.AlertDialogCancel,{onClick:()=>B(null),children:"Cancel"}),(0,b.jsx)(W.AlertDialogAction,{onClick:X,disabled:F,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:F?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"w-4 h-4 mr-2 border-2 border-current border-t-transparent rounded-full animate-spin"}),"Deleting..."]}):"Delete Source"})]})]})})]})};var aK=a.i(546842),aL=a.i(641710);let aM=({sales:a,isLoading:c,currency:d="UGX"})=>c?(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 space-y-4",children:[(0,b.jsx)("div",{className:"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin"}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"Loading deleted sales history..."})]}):0===a.length?(0,b.jsxs)("div",{className:"text-center py-12 border rounded-lg bg-muted/20",children:[(0,b.jsx)(I.Trash2,{className:"mx-auto h-12 w-12 text-muted-foreground opacity-20 mb-4"}),(0,b.jsx)("h3",{className:"text-lg font-medium",children:"Deleted Sales history is empty"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Deleted sales logs will appear here."})]}):(0,b.jsx)("div",{className:"border rounded-lg overflow-hidden bg-white",children:(0,b.jsxs)(k.Table,{children:[(0,b.jsx)(k.TableHeader,{className:"bg-muted/50",children:(0,b.jsxs)(k.TableRow,{children:[(0,b.jsx)(k.TableHead,{children:"Receipt #"}),(0,b.jsx)(k.TableHead,{children:"Customer"}),(0,b.jsx)(k.TableHead,{children:"Items"}),(0,b.jsx)(k.TableHead,{className:"text-right",children:"Total Qty"}),(0,b.jsx)(k.TableHead,{className:"text-right",children:"Total Amount"}),(0,b.jsx)(k.TableHead,{children:"Deleted At"}),(0,b.jsx)(k.TableHead,{children:"Deleted By"})]})}),(0,b.jsx)(k.TableBody,{children:a.map(a=>(0,b.jsxs)(k.TableRow,{className:"hover:bg-muted/30",children:[(0,b.jsx)(k.TableCell,{className:"font-mono font-medium",children:a.receiptNumber}),(0,b.jsx)(k.TableCell,{children:a.customerName}),(0,b.jsx)(k.TableCell,{children:(0,b.jsx)("div",{className:"max-w-[250px]",children:(0,b.jsx)("div",{className:"flex flex-wrap gap-1",children:a.items.map((a,c)=>{let d=a.quantity??a.qty??0;return(0,b.jsxs)(F.Badge,{variant:"outline",className:"text-[10px] py-0 h-4 bg-muted/30",children:[d,"x ",a.description]},c)})})})}),(0,b.jsx)(k.TableCell,{className:"text-right font-medium",children:a.totalQuantity}),(0,b.jsxs)(k.TableCell,{className:"text-right font-semibold",children:[d," ",a.amount.toLocaleString()]}),(0,b.jsx)(k.TableCell,{children:(0,b.jsxs)("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[(0,b.jsx)(aL.Clock,{className:"h-3 w-3"}),(0,n.format)(new Date(a.deletedAt),"MMM d, h:mm a")]})}),(0,b.jsx)(k.TableCell,{children:(0,b.jsxs)("div",{className:"flex items-center gap-1.5 text-xs",children:[(0,b.jsx)(aK.User,{className:"h-3 w-3 text-muted-foreground"}),a.deletedBy]})})]},a.id))})]})});var aN=a.i(737139),aO=a.i(169819),aP=a.i(349774),aQ=a.i(862010),aR=a.i(669520);let aS=()=>{let[a,g]=(0,c.useState)("overview"),{currentBusiness:k,isLoading:l}=(0,aO.useBusiness)(),{settings:m}=(0,q.useBusinessSettings)(),{userId:n}=(0,aP.useCurrentUser)(),{sales:o,isLoading:p,deleteSale:r,refetch:s,isFetching:t}=(0,aN.useSalesData)(n,"desc"),{deletedSales:u,isLoading:v,refetch:w}=(()=>{let[a,b]=(0,c.useState)([]),[d,e]=(0,c.useState)(!1),{currentBusiness:f}=(0,aO.useBusiness)(),{userId:g}=(0,aP.useCurrentUser)(),h=(0,c.useCallback)(async()=>{if(f?.id&&g){e(!0);try{let a=await (0,aQ.getActivityHistoryAction)(f.id,"SALES","DELETE");if(!a.success)throw Error(a.error);let c=(a.data||[]).map(a=>{let b=a.metadata||{},c=Array.isArray(b.items)?b.items:[],d=Number(b.totalAmount||0);0===d&&c.length>0&&(d=c.reduce((a,b)=>{let c=Number(b.total)||Number(b.price||0)*Number(b.quantity||0);return a+c},0));let e=c.reduce((a,b)=>a+Number(b.quantity??b.qty??0),0);return{id:a.id,receiptNumber:b.receiptNumber||"N/A",customerName:b.customerName||"Unknown",amount:d,totalQuantity:e,deletedAt:a.createdAt,deletedBy:a.profileName||"Admin",items:c,fullMetadata:b}});b(c)}catch(a){console.error("Error fetching deleted sales:",a)}finally{e(!1)}}},[f?.id,g]);return(0,c.useEffect)(()=>{h()},[h]),{deletedSales:a,isLoading:d,refetch:h}})(),{selectedSale:x,isReceiptDialogOpen:y,handleEditSale:z,handleViewReceipt:A,handleDeleteSale:B,handleCloseReceiptDialog:C}=(()=>{let a=(0,e.useRouter)(),[b,d]=(0,c.useState)(null),[f,g]=(0,c.useState)(!1),[h,i]=(0,c.useState)(!1),j=(0,c.useCallback)(b=>{a.push(`/new-sale?editId=${b.id}`)},[a]),k=(0,c.useCallback)(a=>{d(a),g(!0)},[]);return{selectedSale:b,isReceiptDialogOpen:f,isDeletingSale:h,handleEditSale:j,handleViewReceipt:k,handleDeleteSale:(0,c.useCallback)(a=>async b=>{i(!0);try{await a(b.id)}finally{i(!1)}},[]),handleCloseReceiptDialog:(0,c.useCallback)(a=>{g(a),a||d(null)},[])}})();if(l||!n)return(0,b.jsx)("div",{className:"p-6 space-y-6",children:(0,b.jsx)(i,{})});if(!k)return(0,b.jsx)(j,{});let D=async()=>{"deleted-sales"===a?await w():await s()};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"p-6",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,b.jsx)("h2",{className:"text-2xl font-bold tracking-tight",children:"Sales Management"}),(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",onClick:D,className:"flex items-center gap-2",disabled:t||v,children:[(0,b.jsx)(aR.RefreshCw,{className:`h-4 w-4 ${t||v?"animate-spin":""}`}),t||v?"Refreshing...":"Refresh"]})]}),(0,b.jsxs)(d.Tabs,{value:a,onValueChange:g,children:[(0,b.jsxs)(d.TabsList,{className:"grid w-full grid-cols-3",children:[(0,b.jsx)(d.TabsTrigger,{value:"overview",children:"Sales Overview"}),(0,b.jsx)(d.TabsTrigger,{value:"analysis",children:"Sales Source"}),(0,b.jsxs)(d.TabsTrigger,{value:"deleted-sales",className:"flex items-center gap-2 text-destructive data-[state=active]:text-destructive",children:[(0,b.jsx)(I.Trash2,{className:"h-4 w-4"}),"Deleted Sales"]})]}),(0,b.jsx)(d.TabsContent,{value:"overview",className:"mt-0",children:p&&!o.length?(0,b.jsx)(i,{}):0===o.length?(0,b.jsx)(h,{}):(0,b.jsx)(an,{sales:o,onViewReceipt:A,onEditSale:z,onDeleteSale:B(r),currency:m.currency,isLoading:p})}),(0,b.jsx)(d.TabsContent,{value:"analysis",className:"mt-6",children:(0,b.jsx)(aJ,{sales:o,formatCurrency:a=>new Intl.NumberFormat("en-US",{style:"currency",currency:m.currency||"UGX",minimumFractionDigits:0,maximumFractionDigits:2}).format(a)})}),(0,b.jsx)(d.TabsContent,{value:"deleted-sales",className:"mt-6",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,b.jsxs)("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[(0,b.jsx)(I.Trash2,{className:"h-5 w-5 text-muted-foreground"}),"Deleted Sales History"]}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"View and manage recently deleted sales records."})]}),(0,b.jsx)(aM,{sales:u,isLoading:v,currency:m.currency})]})})]})]}),(0,b.jsx)(ap,{selectedSale:x,isOpen:y,onOpenChange:C,currency:m.currency})]})};a.s(["default",0,()=>(0,b.jsx)(aS,{})],788326)}];

//# sourceMappingURL=src_pages_Sales_tsx_5747f1b5._.js.map