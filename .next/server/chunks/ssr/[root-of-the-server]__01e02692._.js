module.exports=[455756,a=>{"use strict";let b=(0,a.i(564375).default)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);a.s(["Upload",()=>b],455756)},311988,a=>{"use strict";let b=(0,a.i(564375).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);a.s(["Loader2",()=>b],311988)},643228,a=>{"use strict";let b=(0,a.i(564375).default)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);a.s(["ChevronRight",()=>b],643228)},873492,407850,490988,a=>{"use strict";let b=Symbol.for("constructDateFrom");function c(a,c){return"function"==typeof a?a(c):a&&"object"==typeof a&&b in a?a[b](c):a instanceof Date?new a.constructor(c):new Date(c)}function d(a,b){return c(b||a,a)}a.s(["constructFromSymbol",0,b,"millisecondsInDay",0,864e5,"millisecondsInWeek",0,6048e5,"minutesInDay",0,1440,"minutesInMonth",0,43200],407850),a.s(["constructFrom",()=>c],490988),a.s(["toDate",()=>d],873492)},145556,a=>a.a(async(b,c)=>{try{let b=await a.y("@radix-ui/react-select-0a3bcd2240a9e876");a.n(b),c()}catch(a){c(a)}},!0),597435,a=>{"use strict";let b=(0,a.i(564375).default)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);a.s(["Check",()=>b],597435)},93538,a=>{"use strict";let b=(0,a.i(564375).default)("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);a.s(["ChevronDown",()=>b],93538)},493572,a=>{"use strict";let b=(0,a.i(564375).default)("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);a.s(["ChevronUp",()=>b],493572)},688272,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(145556),g=a.i(597435),h=a.i(93538),i=a.i(493572),j=a.i(799856),k=b([f,j]);[f,j]=k.then?(await k)():k;let l=f.Root;f.Group;let m=f.Value,n=e.forwardRef(({className:a,children:b,...c},e)=>(0,d.jsxs)(f.Trigger,{ref:e,className:(0,j.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...c,children:[b,(0,d.jsx)(f.Icon,{asChild:!0,children:(0,d.jsx)(h.ChevronDown,{className:"h-4 w-4 opacity-50"})})]}));n.displayName=f.Trigger.displayName;let o=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(f.ScrollUpButton,{ref:c,className:(0,j.cn)("flex cursor-default items-center justify-center py-1",a),...b,children:(0,d.jsx)(i.ChevronUp,{className:"h-4 w-4"})}));o.displayName=f.ScrollUpButton.displayName;let p=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(f.ScrollDownButton,{ref:c,className:(0,j.cn)("flex cursor-default items-center justify-center py-1",a),...b,children:(0,d.jsx)(h.ChevronDown,{className:"h-4 w-4"})}));p.displayName=f.ScrollDownButton.displayName;let q=e.forwardRef(({className:a,children:b,position:c="popper",...e},g)=>(0,d.jsx)(f.Portal,{children:(0,d.jsxs)(f.Content,{ref:g,className:(0,j.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===c&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:c,...e,children:[(0,d.jsx)(o,{}),(0,d.jsx)(f.Viewport,{className:(0,j.cn)("p-1","popper"===c&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:b}),(0,d.jsx)(p,{})]})}));q.displayName=f.Content.displayName,e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(f.Label,{ref:c,className:(0,j.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...b})).displayName=f.Label.displayName;let r=e.forwardRef(({className:a,children:b,...c},e)=>(0,d.jsxs)(f.Item,{ref:e,className:(0,j.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...c,children:[(0,d.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,d.jsx)(f.ItemIndicator,{children:(0,d.jsx)(g.Check,{className:"h-4 w-4"})})}),(0,d.jsx)(f.ItemText,{children:b})]}));r.displayName=f.Item.displayName,e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(f.Separator,{ref:c,className:(0,j.cn)("-mx-1 my-1 h-px bg-muted",a),...b})).displayName=f.Separator.displayName,a.s(["Select",()=>l,"SelectContent",()=>q,"SelectItem",()=>r,"SelectTrigger",()=>n,"SelectValue",()=>m]),c()}catch(a){c(a)}},!1),746671,a=>{"use strict";let b=(0,a.i(564375).default)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);a.s(["default",()=>b])},867783,a=>a.a(async(b,c)=>{try{let b=await a.y("@radix-ui/react-popover-95c63f0781dd32f6");a.n(b),c()}catch(a){c(a)}},!0),158799,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(867783),g=a.i(799856),h=b([f,g]);[f,g]=h.then?(await h)():h;let i=f.Root,j=f.Trigger,k=e.forwardRef(({className:a,align:b="center",sideOffset:c=4,...e},h)=>(0,d.jsx)(f.Portal,{children:(0,d.jsx)(f.Content,{ref:h,align:b,sideOffset:c,className:(0,g.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...e})}));k.displayName=f.Content.displayName,a.s(["Popover",()=>i,"PopoverContent",()=>k,"PopoverTrigger",()=>j]),c()}catch(a){c(a)}},!1),566571,a=>{"use strict";let b=(0,a.i(564375).default)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);a.s(["ChevronLeft",()=>b],566571)},103229,(a,b,c)=>{b.exports=a.x("react-day-picker-98f3865ff2c2ea82",()=>require("react-day-picker-98f3865ff2c2ea82"))},393551,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(566571),f=a.i(643228),g=a.i(103229),h=a.i(799856),i=a.i(396465),j=b([h,i]);function k({className:a,classNames:b,showOutsideDays:c=!0,...j}){return(0,d.jsx)(g.DayPicker,{showOutsideDays:c,className:(0,h.cn)("p-3 pointer-events-auto",a),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",caption_dropdowns:"flex justify-center gap-1",nav:"space-x-1 flex items-center",nav_button:(0,h.cn)((0,i.buttonVariants)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,h.cn)((0,i.buttonVariants)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",dropdown:"bg-background rounded-md border p-1 shadow-md",dropdown_month:"w-[var(--rdp-caption-dropdown-month-width)]",dropdown_year:"w-[var(--rdp-caption-dropdown-year-width)]",dropdown_icon:"w-4 h-4",button_reset:"appearance-none bg-transparent border-none p-0 m-0",vhidden:"sr-only",...b},components:{IconLeft:({...a})=>(0,d.jsx)(e.ChevronLeft,{className:"h-4 w-4"}),IconRight:({...a})=>(0,d.jsx)(f.ChevronRight,{className:"h-4 w-4"})},...j})}[h,i]=j.then?(await j)():j,k.displayName="Calendar",a.s(["Calendar",()=>k]),c()}catch(a){c(a)}},!1),914619,a=>{"use strict";var b=a.i(746671);a.s(["Calendar",()=>b.default])},330281,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(799856),g=b([f]);[f]=g.then?(await g)():g;let h=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("textarea",{className:(0,f.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:c,...b}));h.displayName="Textarea",a.s(["Textarea",()=>h]),c()}catch(a){c(a)}},!1),436028,a=>{"use strict";let b=(0,a.i(564375).default)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);a.s(["AlertCircle",()=>b],436028)},289118,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(197499),g=a.i(799856),h=b([f,g]);[f,g]=h.then?(await h)():h;let i=(0,f.cva)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),j=e.forwardRef(({className:a,variant:b,...c},e)=>(0,d.jsx)("div",{ref:e,role:"alert",className:(0,g.cn)(i({variant:b}),a),...c}));j.displayName="Alert";let k=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("h5",{ref:c,className:(0,g.cn)("mb-1 font-medium leading-none tracking-tight",a),...b}));k.displayName="AlertTitle";let l=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{ref:c,className:(0,g.cn)("text-sm [&_p]:leading-relaxed",a),...b}));l.displayName="AlertDescription",a.s(["Alert",()=>j,"AlertDescription",()=>l,"AlertTitle",()=>k]),c()}catch(a){c(a)}},!1),126741,a=>{"use strict";let b=(0,a.i(564375).default)("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]);a.s(["Printer",()=>b],126741)},556704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},832319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},463021,(a,b,c)=>{b.exports=a.x("@prisma/client-2c3a283f134fdcb6",()=>require("@prisma/client-2c3a283f134fdcb6"))},723862,a=>a.a(async(b,c)=>{try{let b=await a.y("pg-587764f78a6c7a9c");a.n(b),c()}catch(a){c(a)}},!0),500885,a=>a.a(async(b,c)=>{try{let b=await a.y("@tanstack/react-query-a07b84a9a4b6bf2a");a.n(b),c()}catch(a){c(a)}},!0),823313,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={NEXT_REQUEST_META:function(){return f},addRequestMeta:function(){return i},getRequestMeta:function(){return g},removeRequestMeta:function(){return j},setRequestMeta:function(){return h}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=Symbol.for("NextInternalRequestMeta");function g(a,b){let c=a[f]||{};return"string"==typeof b?c[b]:c}function h(a,b){return a[f]=b,b}function i(a,b,c){let d=g(a);return d[b]=c,h(a,d)}function j(a,b){let c=g(a);return delete c[b],h(a,c)}},709766,a=>a.a(async(b,c)=>{try{var d=a.i(150848),e=b([d]);async function f(a){try{let b=await d.db.branchSettings.findUnique({where:{branchId:a}});if(!b)return null;return{id:b.id,business_name:b.businessName,business_address:b.address,business_phone:b.phone,business_email:b.email,business_logo:b.logo,currency:b.currency,signature:b.signatureImage,metadata:b.metadata||{}}}catch(a){return console.error("Error fetching business settings:",a),null}}async function g(a,b,c){try{if(!await d.db.branch.findFirst({where:{id:a,OR:[{adminId:b},{users:{some:{id:b}}}]}}))return{success:!1,error:"Unauthorized to update branch settings"};let e={businessName:c.business_name,address:c.business_address,phone:c.business_phone,email:c.business_email,logo:c.business_logo,currency:c.currency,signatureImage:c.signature,metadata:c.metadata},f=await d.db.branchSettings.upsert({where:{branchId:a},update:e,create:{branchId:a,...e}});return{success:!0,data:{id:f.id,business_name:f.businessName,business_address:f.address,business_phone:f.phone,business_email:f.email,business_logo:f.logo,currency:f.currency,signature:f.signatureImage,metadata:f.metadata}}}catch(a){return console.error("Error upserting business settings:",a),{success:!1,error:a.message||"Failed to update settings"}}}async function h(a){try{let b=await d.db.user.findUnique({where:{id:a},select:{isFrozen:!0,createdAt:!0,subscriptions:{where:{status:"active"},orderBy:{endDate:"desc"},take:1},branches:{select:{id:!0}}}});if(!b)return null;let c=b.subscriptions[0],e=new Date,f=c?Math.ceil((c.endDate.getTime()-e.getTime())/864e5):0;return{is_frozen:b.isFrozen,location_limit:1,billing_amount:c?Number(c.amount):5e4,billing_duration:"Monthly",days_remaining:Math.max(0,f),next_billing_date:c?.endDate.toISOString()||""}}catch(a){return console.error("Error fetching account status:",a),{is_frozen:!1,location_limit:1,billing_amount:5e4,billing_duration:"Monthly",days_remaining:30,next_billing_date:""}}}async function i(a){try{let b=await d.db.branchSettings.findUnique({where:{branchId:a}});if(!b)return null;return{id:b.id,location_id:b.branchId,business_name:b.businessName,business_address:b.address,business_phone:b.phone,business_email:b.email,business_logo:b.logo,completed:!!b.businessName&&!!b.phone,is_frozen:!1}}catch(a){return console.error("Error fetching onboarding status:",a),null}}[d]=e.then?(await e)():e,a.s(["getAccountStatusAction",()=>h,"getBusinessSettingsAction",()=>f,"getOnboardingStatusAction",()=>i,"upsertBusinessSettingsAction",()=>g]),c()}catch(a){c(a)}},!1),224993,a=>a.a(async(b,c)=>{try{var d=a.i(127669),e=a.i(500885),f=a.i(108191),g=a.i(964889),h=a.i(709766),i=b([e,g,h]);[e,g,h]=i.then?(await i)():i;let j=()=>({businessName:"",businessAddress:"",businessPhone:"",businessEmail:"",currency:"UGX",paymentInfo:"",defaultPrintFormat:"standard"});a.s(["parsePaymentInfo",0,a=>{if(!a||""===a.trim())return[];let b=a.split("\n").filter(a=>""!==a.trim()),c=[];for(let a=0;a<b.length;a+=3)a+2<b.length&&c.push({method:b[a].trim(),accountNumber:b[a+1].trim(),accountName:b[a+2].trim()});return c},"useBusinessSettings",0,()=>{let[a,b]=(0,d.useState)(j()),[c,i]=(0,d.useState)(!1),{toast:k}=(0,f.useToast)(),{currentBusiness:l}=(0,g.useBusiness)(),m=async()=>{if(!l)return j();try{let a=await (0,h.getBusinessSettingsAction)(l.id);if(!a)return j();{let b=a.metadata&&"object"==typeof a.metadata&&a.metadata.payment_info||"";return{id:a.id,businessName:a.business_name||"",businessAddress:a.business_address||"",businessPhone:a.business_phone||"",businessEmail:a.business_email||"",businessLogo:a.business_logo||void 0,currency:a.currency||"UGX",signature:a.signature||void 0,paymentInfo:b,defaultPrintFormat:a.metadata&&"object"==typeof a.metadata&&a.metadata.default_print_format||"standard",defaultPrinterName:a.metadata&&"object"==typeof a.metadata&&a.metadata.default_printer_name||"",defaultPrinterType:a.metadata&&"object"==typeof a.metadata&&a.metadata.default_printer_type||"USB",printerPaperSize:a.metadata&&"object"==typeof a.metadata&&a.metadata.printer_paper_size||"58mm"}}}catch(a){return console.error("Error loading business settings:",a),k({title:"Error",description:"Failed to load business settings. Please try again.",variant:"destructive"}),j()}},n=async b=>{if(!l)return console.error("No business selected for updating settings"),k({title:"Error",description:"No business selected",variant:"destructive"}),!1;try{let c={payment_info:b.hasOwnProperty("paymentInfo")?b.paymentInfo:a.paymentInfo||"",default_print_format:b.hasOwnProperty("defaultPrintFormat")?b.defaultPrintFormat:a.defaultPrintFormat||"standard",default_printer_name:b.hasOwnProperty("defaultPrinterName")?b.defaultPrinterName:a.defaultPrinterName||"",default_printer_type:b.hasOwnProperty("defaultPrinterType")?b.defaultPrinterType:a.defaultPrinterType||"USB",printer_paper_size:b.hasOwnProperty("printerPaperSize")?b.printerPaperSize:a.printerPaperSize||"58mm"},d={business_name:b.hasOwnProperty("businessName")?b.businessName:a.businessName,business_address:b.hasOwnProperty("businessAddress")?b.businessAddress:a.businessAddress,business_phone:b.hasOwnProperty("businessPhone")?b.businessPhone:a.businessPhone,business_email:b.hasOwnProperty("businessEmail")?b.businessEmail:a.businessEmail,business_logo:b.hasOwnProperty("businessLogo")?b.businessLogo:a.businessLogo,currency:b.hasOwnProperty("currency")?b.currency:a.currency,signature:b.hasOwnProperty("signature")?b.signature:a.signature,metadata:c},e=await (0,h.upsertBusinessSettingsAction)(l.id,"00000000-0000-0000-0000-000000000000",d);if(!e.success)throw console.error("Supabase error updating business settings:",e.error),Error(e.error);return k({title:"Success",description:"Business settings updated successfully"}),r(),!0}catch(a){return console.error("Error updating business settings:",a),k({title:"Error",description:"Failed to update business settings. Please try again.",variant:"destructive"}),!1}},{data:o,isLoading:p,isFetching:q,refetch:r}=(0,e.useQuery)({queryKey:["businessSettings",l?.id],queryFn:m,enabled:!!l?.id,staleTime:3e5,gcTime:18e5,refetchOnWindowFocus:!1,refetchOnReconnect:!1});return(0,d.useEffect)(()=>{o?b(o):l||b(j())},[o,l]),(0,d.useEffect)(()=>{i(p||q)},[p,q]),{settings:a,isLoading:c,updateSettings:n,loadSettings:m}}]),c()}catch(a){c(a)}},!1),852741,(a,b,c)=>{let d=Error("Could not parse module '[project]/src/app/actions/products.ts'\n\n'import', and 'export' cannot be used outside of module code");throw d.code="MODULE_UNPARSABLE",d},121677,a=>{"use strict";a.s(["clearInventoryCaches",0,a=>{}])},482331,a=>a.a(async(b,c)=>{try{var d=a.i(127669),e=a.i(224993),f=a.i(964889),g=a.i(500885),h=a.i(121677),i=a.i(852741),j=b([e,f,g]);[e,f,g]=j.then?(await j)():j,a.s(["useProducts",0,(a,b=50)=>{let[c,j]=(0,d.useState)([]),[k,l]=(0,d.useState)(1),[m,n]=(0,d.useState)(b),[o,p]=(0,d.useState)(0),[q,r]=(0,d.useState)(!1),{settings:s}=(0,e.useBusinessSettings)(),{currentBusiness:t}=(0,f.useBusiness)(),u=(0,g.useQueryClient)(),[v,w]=(0,d.useState)({search:"",category:"all",stockStatus:"all"}),[x,y]=(0,d.useState)(null),z=(0,d.useCallback)(a=>{if(a.search!==v.search){r(!0),x&&clearTimeout(x);let a=setTimeout(()=>{r(!1)},600);y(a)}w(a)},[v.search,x]),A=(0,d.useCallback)(async()=>{if(!a||!t)return{products:[],count:0};try{return await (0,i.getProductsAction)({userId:a,businessId:t.id,page:k,pageSize:m,search:v.search,category:"all"===v.category?void 0:v.category,stockStatus:v.stockStatus})}catch(a){return console.error("Error loading products from server action:",a),{products:[],count:0}}},[a,t?.id,k,m,v.search,v.category,v.stockStatus]),B=(0,d.useMemo)(()=>["products",a,t?.id],[a,t?.id]),C=(0,d.useMemo)(()=>[...B,k,m,v.search,v.category,v.stockStatus],[B,k,m,v.search,v.category,v.stockStatus]),{data:D,isLoading:E,isFetching:F,refetch:G}=(0,g.useQuery)({queryKey:C,queryFn:A,enabled:!!a&&!!t?.id,staleTime:3e4,gcTime:18e5,refetchOnWindowFocus:!0,refetchOnReconnect:!0});(0,d.useEffect)(()=>{D&&(j(D.products),p(D.count))},[D]);let H=E&&!D&&!q,I=async b=>{try{if(!a)return null;return console.warn("Image upload redirecting to server action (TODO)"),null}catch(a){return console.error("Error in uploadProductImage:",a),null}},J=async b=>{try{if(!a||!t)return null;let c=await (0,i.createProductAction)({...b,userId:a,businessId:t.id});if(!c)return null;return j(a=>[c,...a]),p(a=>a+1),u.invalidateQueries({queryKey:B}),(0,h.clearInventoryCaches)(u),c}catch(a){return console.error("Error creating product:",a),null}},K=async(b,c,d,e=!1,f,g,j,k)=>{try{if(!a||!t)return!1;let g=c.imageUrl;if(d&&(g=await I(d)),!await (0,i.updateProductAction)(b,{...c,imageUrl:g,userId:a,businessId:t.id,isFromSale:e,customChangeReason:f,referenceId:j}))return!1;return u.invalidateQueries({queryKey:B}),(0,h.clearInventoryCaches)(u),!0}catch(a){return console.error("Error updating product:",a),!1}},L=async b=>{try{if(!a)return!1;if(await (0,i.deleteProductAction)(b))return u.invalidateQueries({queryKey:B}),(0,h.clearInventoryCaches)(u),!0;return!1}catch(a){return console.error("Error deleting product:",a),!1}},M=async(b,c,d,e,f,g)=>{try{if(!a||!t)return!1;let c=await (0,i.updateProductsBulkAction)(b.map(a=>({id:a.id,updated:a.updated})),t.id);return c&&(u.invalidateQueries({queryKey:B}),(0,h.clearInventoryCaches)(u)),c}catch(a){return console.error("Error in bulk update:",a),!1}};return{products:c,isLoading:H,loadProducts:A,page:k,setPage:l,pageSize:m,setPageSize:n,totalCount:o,createProduct:J,updateProduct:K,updateProductsBulk:M,deleteProduct:L,uploadProductImage:I,refetch:G,isFetching:F,filters:v,setFilters:z}}]),c()}catch(a){c(a)}},!1),506766,a=>{"use strict";let b=(0,a.i(564375).default)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);a.s(["RefreshCw",()=>b],506766)},985522,a=>a.a(async(b,c)=>{try{var d=a.i(127669),e=a.i(108191),f=a.i(964889),g=a.i(852741),h=b([f]);[f]=h.then?(await h)():h,a.s(["useCategories",0,a=>{let[b,c]=(0,d.useState)([]),[h,i]=(0,d.useState)(!0),{toast:j}=(0,e.useToast)(),{currentBusiness:k}=(0,f.useBusiness)(),l=(0,d.useCallback)(async()=>{try{if(!k?.id){c([]),i(!1);return}i(!0);let a=await (0,g.getProductCategoriesAction)(k.id);if(!a.success||!a.data)throw Error(a.error||"Failed to fetch categories");let b=a.data.map(a=>({id:a.id,name:a.name,createdAt:a.createdAt?new Date(a.createdAt):a.created_at?new Date(a.created_at):void 0}));c(b)}catch(a){console.error("Error loading categories:",a),j({title:"Error",description:"Failed to load product categories.",variant:"destructive"})}finally{i(!1)}},[k?.id,j]);(0,d.useEffect)(()=>{l()},[l]);let m=async d=>{try{if(!a||!k?.id)return null;let e=b.find(a=>a.name.toLowerCase()===d.toLowerCase());if(e)return j({title:"Category exists",description:"This category already exists."}),e;let f=await (0,g.createProductCategoryAction)(k.id,a,d);if(!f.success||!f.data)throw Error(f.error);let h={id:f.data.id,name:f.data.name,createdAt:new Date(f.data.createdAt)};return c(a=>[...a,h]),j({title:"Success",description:"Category created successfully"}),h}catch(a){return console.error("Error creating category:",a),j({title:"Error",description:"Failed to create category.",variant:"destructive"}),null}},n=async(a,d)=>{try{if(b.find(b=>b.name.toLowerCase()===d.toLowerCase()&&b.id!==a))return j({title:"Category exists",description:"Another category with this name already exists."}),!1;let e=await (0,g.updateProductCategoryAction)(a,d);if(!e.success)throw Error(e.error);return c(b=>b.map(b=>b.id===a?{...b,name:d}:b)),j({title:"Success",description:"Category updated successfully"}),!0}catch(a){return console.error("Error updating category:",a),j({title:"Error",description:"Failed to update category.",variant:"destructive"}),!1}},o=async a=>{try{let b=await (0,g.deleteProductCategoryAction)(a);if(!b.success)return j({title:"Cannot delete category",description:b.error||"Failed to delete category.",variant:"destructive"}),!1;return c(b=>b.filter(b=>b.id!==a)),j({title:"Success",description:"Category deleted successfully"}),!0}catch(a){return console.error("Error deleting category:",a),j({title:"Error",description:"Failed to delete category.",variant:"destructive"}),!1}};return{categories:b,isLoading:h,loadCategories:l,createCategory:m,updateCategory:n,deleteCategory:o}}]),c()}catch(a){c(a)}},!1),175794,a=>{"use strict";let b=(0,a.i(564375).default)("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);a.s(["Zap",()=>b],175794)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__01e02692._.js.map