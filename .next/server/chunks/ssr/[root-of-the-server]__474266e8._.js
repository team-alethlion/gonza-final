module.exports=[149354,a=>a.a(async(b,c)=>{try{var d=a.i(127669),e=a.i(964889),f=b([e]);[e]=f.then?(await f)():f,a.s(["useSaleDraft",0,()=>{let[a,b]=(0,d.useState)(!1),{currentBusiness:c}=(0,e.useBusiness)(),f=(0,d.useMemo)(()=>c?.id?`sale_draft_${c.id}`:"sale_draft",[c?.id]),g=(0,d.useCallback)(()=>{let a=!!localStorage.getItem(f);return b(a),a},[f]);(0,d.useEffect)(()=>{c?.id&&g()},[g,c?.id]);let h=(0,d.useCallback)((a,d)=>{if(!c?.id)return;let e={formData:a,selectedDate:d.toISOString(),savedAt:new Date().toISOString()};localStorage.setItem(f,JSON.stringify(e)),b(!0)},[f,c?.id]),i=(0,d.useCallback)(()=>{let a=localStorage.getItem(f);if(a)try{let b=JSON.parse(a);return{formData:b.formData,selectedDate:new Date(b.selectedDate),savedAt:new Date(b.savedAt)}}catch(a){console.error("Error parsing draft:",a),localStorage.removeItem(f),b(!1)}return null},[f]),j=(0,d.useCallback)(()=>{localStorage.removeItem(f),b(!1)},[f]);return{hasDraft:a,saveDraft:h,loadDraft:i,clearDraft:j,checkForDraft:g}}]),c()}catch(a){c(a)}},!1),938664,a=>a.a(async(b,c)=>{try{var d=a.i(127669),e=a.i(149354),f=b([e]);[e]=f.then?(await f)():f,a.s(["useNewSaleDraft",0,a=>{let[b,c]=(0,d.useState)(!1),[f,g]=(0,d.useState)(null),{hasDraft:h,loadDraft:i,clearDraft:j,checkForDraft:k}=(0,e.useSaleDraft)();return(0,d.useEffect)(()=>{if(!a&&k()){let a=i();a&&g(a)}},[a,k,i]),{showDraftNotification:!1,draftData:f,handleLoadDraft:()=>{g(null)},handleDismissDraft:()=>{j(),c(!1),g(null)},clearDraft:j}}]),c()}catch(a){c(a)}},!1),799338,a=>a.a(async(b,c)=>{try{var d=a.i(127669),e=a.i(482331),f=a.i(733290),g=a.i(964889),h=b([e,f,g]);[e,f,g]=h.then?(await h)():h,a.s(["useSaleProductSelection",0,a=>{let{products:b}=(0,e.useProducts)(a),{currentBusiness:c}=(0,g.useBusiness)(),{deductStockForSale:h,adjustStockForEditedSale:i}=(0,f.useInventoryActions)(a),[j,k]=(0,d.useState)({}),l=async(a,b,d,e,f)=>"Quote"===b||h(a,e,d,f,c?.id),m=async(a,b,d,e,f,g,h)=>{let j="Quote"!==h,k="Quote"!==d;return!j&&!k||i(j?a:[],k?b:[],f,e,g,c?.id)};return{products:b,selectedProducts:j,selectProduct:(a,b)=>{k(c=>({...c,[a]:b}))},getProductForItem:a=>{let c=j[a];return c&&b.find(a=>a.id===c)||null},updateInventoryForSale:l,updateInventoryForEditedSale:m}}]),c()}catch(a){c(a)}},!1),497172,a=>a.a(async(b,c)=>{try{var d=a.i(127669),e=a.i(25670),f=a.i(531811),g=a.i(108191),h=a.i(101056),i=a.i(385375),j=a.i(799338),k=a.i(169320),l=a.i(895363),m=a.i(964889),n=a.i(491327),o=a.i(487416),p=a.i(224993),q=a.i(392240),r=b([f,h,i,j,k,l,m,n,p,q]);[f,h,i,j,k,l,m,n,p,q]=r.then?(await r)():r,a.s(["useNewSaleActions",0,(a,b)=>{let c=(0,e.useRouter)(),{user:r}=(0,f.useAuth)(),{toast:s}=(0,g.useToast)(),{customers:t,createCustomer:u}=(0,h.useCustomers)(),{addSale:v,updateSale:w}=(0,i.useSalesData)(r?.id),{updateInventoryForSale:x,updateInventoryForEditedSale:y}=(0,j.useSaleProductSelection)(r?.id),{logActivity:z}=(0,l.useActivityLogger)(),{currentBusiness:A}=(0,m.useBusiness)(),{settings:B}=(0,p.useBusinessSettings)(),[C,D]=(0,d.useState)(!1),[E,F]=(0,d.useState)(null),[G,H]=(0,d.useState)(!1),[I,J]=(0,d.useState)(!0),K=(0,d.useCallback)(async(d,e=!1,f=!0,g,h,i,j=!1)=>{if(!a&&h&&h(),r?.id&&d.customerName.trim()){let a=d.customerId;if(!a){let b=await (0,q.getCustomerByNameAction)(A?.id||"",d.customerName.trim());if(b)a=b.id;else try{let b=await u({fullName:d.customerName,phoneNumber:d.customerContact||null,location:d.customerAddress||null,email:null,birthday:null,gender:null,categoryId:g||null,notes:null,tags:null,socialMedia:null});b&&(a=b.id,k.toast.success(`Added ${d.customerName} to your customers list`))}catch(a){console.error("Error adding customer:",a)}}if(a&&d.id)try{await (0,q.updateSaleCustomerAction)(d.id,a)}catch(a){console.error("Error associating sale with customer:",a)}}if(!(a?await y(a.items,d.items,d.paymentStatus,void 0,d.id,d.receiptNumber,a.paymentStatus):await x(d.items,d.paymentStatus,i,d.id,d.receiptNumber)))throw console.error("Inventory update failed. Initiating rollback..."),a?s({title:"Inventory Update Failed",description:"The sale was saved, but inventory could not be updated. Please check stock levels manually.",variant:"destructive"}):await (0,q.deleteSaleAction)(d.id)?s({title:"Sale Cancelled",description:"Inventory update failed, so the sale was cancelled to ensure data consistency.",variant:"destructive"}):(console.error("CRITICAL: Failed to rollback sale after inventory failure"),s({title:"Critical Error",description:"Inventory failed to update, and we could not cancel the sale. Please contact support.",variant:"destructive"})),Error("Inventory update failed");let l=d.items.reduce((a,b)=>{let c=b.price*b.quantity,d="amount"===b.discountType?b.discountAmount||0:c*(b.discountPercentage||0)/100;return a+(c-d)},0),m=d.taxRate?l*d.taxRate/100:0,p=l+m;if(await z({activityType:a?"UPDATE":"CREATE",module:"SALES",entityType:"sale",entityId:d.id,entityName:`Sale #${d.receiptNumber}`,description:`${a?"Updated":"Created"} sale for ${d.customerName} - Total: UGX ${p.toLocaleString()}`,metadata:{receiptNumber:d.receiptNumber,customerName:d.customerName,customerAddress:d.customerAddress,customerContact:d.customerContact,totalAmount:p,amountPaid:d.amountPaid,profit:d.profit,paymentStatus:d.paymentStatus,taxRate:d.taxRate,itemCount:d.items.length,items:d.items.map(a=>({description:a.description,quantity:a.quantity,price:a.price,cost:a.cost,total:a.quantity*a.price,discountPercentage:a.discountPercentage,discountAmount:a.discountAmount})),notes:d.notes}}),s({title:a?"Sale Updated":"Sale Created",description:`${a?"Updated":"Created"} sale for ${d.customerName}. ${"NOT PAID"===d.paymentStatus?"Inventory has been updated for this credit sale.":""}`}),Object.keys(localStorage).forEach(a=>{a.startsWith("soldItems_")&&localStorage.removeItem(a)}),F(d),a?w(d):v(d),J(f),e){if(D(!0),j)try{let a=await (0,n.generateThermalReceipt)(d,B);await (0,o.print)(a,B.defaultPrinterName)}catch(a){console.error("Auto-print failed:",a),k.toast.error("Automated thermal printing failed")}}else!a&&b?b():c.push("/sales")},[r?.id,u,a,s,c,z,v,w,b]),L=(0,d.useCallback)(()=>{D(!1),!a&&b?b():c.push("/sales")},[c,a,b]),M=(0,d.useCallback)(async a=>{if(!r?.id)return!1;try{if(await u(a))return H(!1),!0;return!1}catch(a){return console.error("Error adding customer:",a),!1}},[r?.id,u]),N=(0,d.useCallback)(()=>{H(!0)},[]);return{isReceiptOpen:C,completedSale:E,newCustomerDialogOpen:G,includePaymentInfo:I,customers:t,handleSaleComplete:K,handleReceiptClose:L,handleAddCustomer:M,handleOpenNewCustomerDialog:N,setNewCustomerDialogOpen:H}}]),c()}catch(a){c(a)}},!1),877377,a=>{"use strict";var b=a.i(508171);a.s(["default",0,()=>(0,b.jsx)("div",{className:"max-w-4xl mx-auto p-6",children:(0,b.jsxs)("div",{className:"animate-pulse",children:[(0,b.jsx)("div",{className:"h-8 bg-gray-200 rounded w-48 mb-4"}),(0,b.jsx)("div",{className:"h-64 bg-gray-200 rounded"})]})})])},640427,a=>{"use strict";var b=a.i(508171),c=a.i(25670);a.s(["default",0,()=>{let a=(0,c.useRouter)();return(0,b.jsx)("div",{className:"max-w-4xl mx-auto p-6",children:(0,b.jsxs)("div",{className:"bg-amber-50 border border-amber-200 p-4 rounded-md",children:[(0,b.jsx)("p",{className:"text-amber-800 mb-4",children:"No business location found. Please create a business location to manage sales."}),(0,b.jsx)("button",{onClick:()=>a.push("/business-management"),className:"bg-amber-600 text-white px-4 py-2 rounded hover:bg-amber-700",children:"Manage Business Locations"})]})})}])},480716,a=>{"use strict";var b=a.i(508171);a.s(["default",0,()=>(0,b.jsx)("div",{className:"bg-amber-50 border border-amber-200 p-4 rounded-md mb-6",children:(0,b.jsx)("p",{className:"text-amber-800",children:"You need to be signed in to create or edit sales. All sales are saved to your Supabase database."})})])},808546,a=>a.a(async(b,c)=>{try{var d=a.i(942348),e=b([d]);[d]=e.then?(await e)():e;let f=async a=>{try{if(!a)return console.error("Location ID is required for receipt number generation"),"000001";let b=await (0,d.getNextReceiptNumberAction)(a);if(b.success&&b.data)return b.data;return console.error("Error generating receipt number:",b.error),"000001"}catch(a){return console.error("Error generating receipt number:",a),"000001"}};a.s(["generateReceiptNumber",0,f]),c()}catch(a){c(a)}},!1),74179,a=>{"use strict";var b=a.i(127669);let c={description:"",quantity:1,price:0,cost:0};a.s(["useFormState",0,({initialData:a,defaultPaymentStatus:d})=>{let[e,f]=(0,b.useState)({customerName:a?.customerName||"",customerAddress:a?.customerAddress||"",customerContact:a?.customerContact||"",customerId:a?.customerId||"",items:a?.items||[{...c}],paymentStatus:d,taxRate:a?.taxRate||0,amountPaid:a&&"Installment Sale"===a.paymentStatus?0:a?.amountPaid||0,amountDue:a?.amountDue||0,notes:a?.notes||"",categoryId:a?.categoryId||""}),[g,h]=(0,b.useState)({}),[i,j]=(0,b.useState)(a?.taxRate?a.taxRate.toString():""),[k,l]=(0,b.useState)(!0),[m,n]=(0,b.useState)(!1),[o,p]=(0,b.useState)(!0),[q,r]=(0,b.useState)(""),[s,t]=(0,b.useState)(new Date),[u,v]=(0,b.useState)(!1),[w,x]=(0,b.useState)(""),[y,z]=(0,b.useState)(null),[A,B]=(0,b.useState)(d),[C,D]=(0,b.useState)(!1),E=(0,b.useCallback)(a=>{f({customerName:"",customerAddress:"",customerContact:"",customerId:"",items:[{...c}],paymentStatus:d,taxRate:0,amountPaid:0,amountDue:0,notes:"",categoryId:""}),j(""),r(""),t(new Date),v(!1),h({}),D(!0),a&&a()},[d]);return(0,b.useEffect)(()=>{a&&(f(b=>({...b,customerName:a.customerName||b.customerName,customerAddress:a.customerAddress||b.customerAddress,customerContact:a.customerContact||b.customerContact,customerId:a.customerId||b.customerId,items:a.items&&a.items.length>0?a.items:b.items,paymentStatus:a.paymentStatus||b.paymentStatus,taxRate:void 0!==a.taxRate?a.taxRate:b.taxRate,amountPaid:void 0!==a.amountPaid?a.amountPaid:b.amountPaid,amountDue:void 0!==a.amountDue?a.amountDue:b.amountDue,notes:a.notes||b.notes,categoryId:a.categoryId||b.categoryId})),a.categoryId&&D(!1),void 0!==a.taxRate&&j(a.taxRate.toString()))},[a]),{formData:e,errors:g,taxRateInput:i,printAfterSave:k,thermalPrintAfterSave:m,includePaymentInfo:o,selectedCustomerCategoryId:q,paymentDate:s,linkToCash:u,selectedCashAccountId:w,cashTransactionId:y,originalPaymentStatus:A,formRecentlyCleared:C,setFormData:f,setErrors:h,setTaxRateInput:j,setPrintAfterSave:l,setThermalPrintAfterSave:n,setIncludePaymentInfo:p,setSelectedCustomerCategoryId:r,setPaymentDate:t,setLinkToCash:v,setSelectedCashAccountId:x,setCashTransactionId:z,setOriginalPaymentStatus:B,setFormRecentlyCleared:D,clearFormState:E}}])},517103,a=>{"use strict";var b=a.i(127669);a.s(["useFormHandlers",0,({formData:a,setFormData:c,errors:d,setErrors:e,setTaxRateInput:f,setLinkToCash:g})=>{let h=(0,b.useCallback)(a=>{let{name:b,value:g}=a.target;if("taxRate"===b){f(g);let a=g.replace(/,/g,""),b=""===a?0:parseFloat(a);c(a=>({...a,taxRate:isNaN(b)?0:b}))}else c(a=>({...a,[b]:g}));d[b]&&e(a=>({...a,[b]:void 0}))},[d,c,e,f]),i=(0,b.useCallback)(a=>{c(b=>({...b,paymentStatus:a})),"Paid"!==a&&"Installment Sale"!==a&&g(!1),"Installment Sale"!==a&&c(b=>({...b,paymentStatus:a,amountPaid:0,amountDue:0}))},[c,g]);return{handleChange:h,handleSelectChange:i,handleAmountPaidChange:(0,b.useCallback)((a,b)=>{let d=Math.max(0,b-a);c(b=>({...b,amountPaid:a,amountDue:d}))},[c]),handlePaymentDateChange:(0,b.useCallback)(a=>{},[])}}])},446718,a=>{"use strict";var b=a.i(127669);let c={description:"",quantity:1,price:0,cost:0};a.s(["useItemManagement",0,({formData:a,setFormData:d})=>{let e=(0,b.useCallback)(()=>{d(a=>({...a,items:[...a.items,{...c}]}))},[d]),f=(0,b.useCallback)(a=>{d(b=>{let c=b.items.findIndex(b=>b.productId===a.id);if(-1!==c){let a=[...b.items];return a[c]={...a[c],quantity:a[c].quantity+1},{...b,items:a}}let d={productId:a.id,description:a.name,quantity:1,price:a.sellingPrice,cost:a.costPrice};return 1!==b.items.length||b.items[0].description||b.items[0].productId?{...b,items:[...b.items,d]}:{...b,items:[d]}})},[d]);return{handleAddItem:e,handleAddItemWithProduct:f,handleUpdateItem:(0,b.useCallback)((a,b)=>{d(d=>{if(b.productId){let e=d.items.findIndex((c,d)=>d!==a&&c.productId===b.productId);if(-1!==e){let f=[...d.items],g=f[e];return f[e]={...g,quantity:g.quantity+b.quantity},f.length>1?f.splice(a,1):f[a]={...c},{...d,items:f}}}let e=[...d.items];return e[a]=b,{...d,items:e}})},[d]),handleRemoveItem:(0,b.useCallback)(a=>{d(b=>{if(1===b.items.length)return b;let c=b.items.filter((b,c)=>c!==a);return{...b,items:c}})},[d])}}])},807586,a=>{"use strict";var b=a.i(127669);a.s(["useCustomerSelection",0,({setFormData:a,setSelectedCustomerCategoryId:c})=>({handleSelectCustomer:(0,b.useCallback)(b=>{a(a=>({...a,customerName:b.fullName,customerAddress:b.location||"",customerContact:b.phoneNumber||"",customerId:b.id})),c(b.categoryId||"")},[a,c]),handleCategoryChange:(0,b.useCallback)(a=>{c(a)},[c])})])},915295,a=>{"use strict";var b=a.i(127669);a.s(["useFormValidation",0,({formData:a,linkToCash:c,selectedCashAccountId:d,initialData:e,formRecentlyCleared:f,setErrors:g})=>({validateForm:(0,b.useCallback)((b,f)=>{let h={};return a.customerName.trim()||(h.customerName="Customer name is required"),a.taxRate<0&&(h.taxRate="Tax rate cannot be negative"),a.items.filter(a=>""!==a.description.trim()||a.quantity>0||a.price>0).some(a=>!a.description.trim()||a.quantity<=0||a.price<0||a.cost<0)&&(h.items="All items must have a description, positive quantity, and non-negative price/cost"),c&&("Paid"===a.paymentStatus||"Installment Sale"===a.paymentStatus)&&!d&&(h.cashAccount="Select a cash account when linking payments"),"Installment Sale"===a.paymentStatus&&!e&&((!a.amountPaid||a.amountPaid<=0)&&(h.amountPaid="Enter an initial payment greater than 0"),a.amountPaid&&a.amountPaid>b&&(h.amountPaid="Amount paid cannot exceed total")),"Installment Sale"===a.paymentStatus&&e&&a.amountPaid&&a.amountPaid>b&&(h.amountPaid="Amount paid cannot exceed total"),g(h),0===Object.keys(h).length},[a,c,d,e,f,g])})])},612276,a=>{"use strict";var b=a.i(127669);a.s(["useFormCalculations",0,({taxRate:a})=>({calculateTotalAmount:(0,b.useCallback)(a=>a.reduce((a,b)=>{let c=b.price*b.quantity,d="amount"===b.discountType?b.discountAmount||0:c*(b.discountPercentage||0)/100;return a+(c-d)},0),[]),calculateTaxAmount:(0,b.useCallback)(b=>a/100*b,[a])})])},824468,a=>{"use strict";var b=a.i(127669);a.s(["useLocalPaymentChanges",0,()=>{let[a,c]=(0,b.useState)([]),d=a.length>0;return{pendingChanges:a,addPaymentChange:a=>{c(b=>[...b.filter(b=>b.id!==a.id),a])},removePaymentChange:a=>{c(b=>b.filter(b=>b.id!==a))},clearChanges:()=>{c([])},getModifiedPayments:b=>b.filter(b=>!a.find(a=>a.id===b.id&&"delete"===a.type)).map(b=>{let c=a.find(a=>a.id===b.id&&"update"===a.type);return c&&c.updatedData?{...b,amount:c.updatedData.amount??b.amount,notes:c.updatedData.notes??b.notes,paymentDate:c.updatedData.paymentDate??b.paymentDate}:b}),hasChanges:d}}])},921875,a=>a.a(async(b,c)=>{try{var d=a.i(127669),e=a.i(749260),f=a.i(824468),g=b([e]);[e]=g.then?(await g)():g,a.s(["usePaymentOperations",0,({initialDataId:a})=>{let{payments:b,createPayment:c,updatePayment:g,deletePayment:h}=(0,e.useInstallmentPayments)(a),{pendingChanges:i,addPaymentChange:j,clearChanges:k,getModifiedPayments:l,hasChanges:m}=(0,f.useLocalPaymentChanges)(),n=(0,d.useCallback)(async()=>{for(let a of i)"update"===a.type?await g(a.id,a.updatedData):"delete"===a.type&&await h(a.id);k()},[i,g,h,k]);return{payments:b,pendingChanges:i,hasChanges:m,createInstallmentPayment:c,updateInstallmentPayment:g,deleteInstallmentPayment:h,addPaymentChange:j,clearChanges:k,getModifiedPayments:l,processPendingPaymentChanges:n}}]),c()}catch(a){c(a)}},!1),813286,a=>a.a(async(b,c)=>{try{var d=a.i(127669),e=a.i(74179),f=a.i(517103),g=a.i(446718),h=a.i(807586),i=a.i(915295),j=a.i(612276),k=a.i(921875),l=b([k]);[k]=l.then?(await l)():l,a.s(["useSaleFormLogic",0,({initialData:a,defaultPaymentStatus:b,cashAccounts:c})=>{let{formData:l,errors:m,taxRateInput:n,printAfterSave:o,thermalPrintAfterSave:p,includePaymentInfo:q,selectedCustomerCategoryId:r,paymentDate:s,linkToCash:t,selectedCashAccountId:u,cashTransactionId:v,originalPaymentStatus:w,formRecentlyCleared:x,setFormData:y,setErrors:z,setTaxRateInput:A,setPrintAfterSave:B,setThermalPrintAfterSave:C,setIncludePaymentInfo:D,setSelectedCustomerCategoryId:E,setPaymentDate:F,setLinkToCash:G,setSelectedCashAccountId:H,setCashTransactionId:I,setOriginalPaymentStatus:J,setFormRecentlyCleared:K,clearFormState:L}=(0,e.useFormState)({initialData:a,defaultPaymentStatus:b}),{handleChange:M,handleSelectChange:N,handleAmountPaidChange:O,handlePaymentDateChange:P}=(0,f.useFormHandlers)({formData:l,setFormData:y,errors:m,setErrors:z,setTaxRateInput:A,setLinkToCash:G}),{handleAddItem:Q,handleAddItemWithProduct:R,handleUpdateItem:S,handleRemoveItem:T}=(0,g.useItemManagement)({formData:l,setFormData:y}),{handleSelectCustomer:U,handleCategoryChange:V}=(0,h.useCustomerSelection)({setFormData:y,setSelectedCustomerCategoryId:E}),{validateForm:W}=(0,i.useFormValidation)({formData:l,linkToCash:t,selectedCashAccountId:u,initialData:a,formRecentlyCleared:x,setErrors:z}),{calculateTotalAmount:X,calculateTaxAmount:Y}=(0,j.useFormCalculations)({taxRate:l.taxRate}),{payments:Z,pendingChanges:$,hasChanges:_,createInstallmentPayment:aa,updateInstallmentPayment:ab,deleteInstallmentPayment:ac,addPaymentChange:ad,clearChanges:ae,getModifiedPayments:af,processPendingPaymentChanges:ag}=(0,k.usePaymentOperations)({initialDataId:a?.id}),ah=(0,d.useCallback)(a=>{F(a)},[F]),ai=(0,d.useCallback)((a,b)=>{L(a),ae(),b&&b()},[L,ae]),aj=(0,d.useCallback)(a=>{x&&K(!1),M(a)},[x,K,M]),ak=(0,d.useCallback)(a=>{x&&K(!1),N(a)},[x,K,N]),al=(0,d.useCallback)(a=>{x&&K(!1);let b=a&&(a.nativeEvent||a.preventDefault||a.stopPropagation||a.type&&a.target);a&&!b?R(a):Q()},[x,K,Q,R]),am=(0,d.useCallback)((a,b)=>{x&&K(!1),S(a,b)},[x,K,S]),an=(0,d.useCallback)(a=>{x&&K(!1),T(a)},[x,K,T]),ao=(0,d.useCallback)(a=>{x&&K(!1),U(a)},[x,K,U]),ap=(0,d.useCallback)(a=>{x&&K(!1),V(a)},[x,K,V]),aq=(0,d.useCallback)(a=>{x&&K(!1),y(b=>({...b,categoryId:a}))},[x,K,y]);return{formData:l,errors:m,taxRateInput:n,printAfterSave:o,thermalPrintAfterSave:p,includePaymentInfo:q,selectedCustomerCategoryId:r,paymentDate:s,linkToCash:t,selectedCashAccountId:u,cashTransactionId:v,originalPaymentStatus:w,formRecentlyCleared:x,payments:Z,pendingChanges:$,hasChanges:_,setFormData:y,setTaxRateInput:A,setPrintAfterSave:B,setThermalPrintAfterSave:C,setIncludePaymentInfo:D,setLinkToCash:G,setSelectedCashAccountId:H,setCashTransactionId:I,setOriginalPaymentStatus:J,handleChange:aj,handleSelectChange:ak,handleAddItem:al,handleUpdateItem:am,handleRemoveItem:an,handleSelectCustomer:ao,handleCategoryChange:ap,handleSalesCategoryChange:aq,handleAmountPaidChange:O,handlePaymentDateChange:ah,clearForm:ai,calculateTotalAmount:X,calculateTaxAmount:Y,validateForm:W,processPendingPaymentChanges:ag,createInstallmentPayment:aa,updateInstallmentPayment:ab,deleteInstallmentPayment:ac,addPaymentChange:ad,clearChanges:ae,getModifiedPayments:af}}]),c()}catch(a){c(a)}},!1),830095,a=>a.a(async(b,c)=>{try{var d=a.i(127669),e=a.i(169320),f=a.i(413890),g=a.i(120343),h=b([e,f,g]);[e,f,g]=h.then?(await h)():h,a.s(["useCashTransactionOperations",0,()=>{let{createTransaction:a,updateTransaction:b,deleteTransaction:c}=(0,f.useCashTransactions)(),h=(0,d.useCallback)(async(b,c,d,f,g,h)=>{if(!d||!f||"Paid"!==h)return null;try{let d=`Sale to ${b.customerName||b.customer_name||"Customer"} - Receipt #${b.receiptNumber||b.receipt_number||"N/A"}`,e=await a({accountId:f,amount:c,transactionType:"cash_in",category:"Cash sale",description:d,date:g,personInCharge:"",tags:[],paymentMethod:"",receiptImage:""});return e?.id||null}catch(a){return console.error("Error creating cash transaction:",a),e.toast.error("Failed to create cash transaction"),null}},[a]),i=(0,d.useCallback)(async(d,f,g,h,i,j,k,l)=>{try{let e=`Sale to ${d.customerName||d.customer_name||"Customer"} - Receipt #${d.receiptNumber||d.receipt_number||"N/A"}`,m=k&&""!==k.trim();if(!g&&j&&"Paid"===i&&m){let b=await a({accountId:k,amount:f,transactionType:"cash_in",category:"Cash sale",description:e,date:l,personInCharge:"",tags:[],paymentMethod:"",receiptImage:""});return b?.id||null}if(!g)return null;if("Paid"===h&&"Installment Sale"===i)return await c(g),null;if(j&&"Paid"===i&&m)return await b(g,{amount:f,category:"Cash sale",description:e,date:l}),g;return await c(g),null}catch(a){return console.error("Error updating cash transaction:",a),e.toast.error("Failed to update cash transaction"),g}},[a,b,c]),j=(0,d.useCallback)(async(a,b,c,d,e,f,g)=>b<=0?null:d&&e?await g({saleId:a,amount:b,accountId:e,locationId:f,date:new Date}):await g({saleId:a,amount:b}),[]),k=(0,d.useCallback)(async a=>{try{let b=await (0,g.findCashTransactionAction)(a);if(b.success&&b.data)return b.data.accountId}catch(a){console.error("Error finding cash transaction:",a)}return null},[]);return{createCashTransactionForSale:h,updateCashTransactionForSale:i,createInstallmentPaymentWithCash:j,findCashTransactionForSale:k}}]),c()}catch(a){c(a)}},!1),361842,a=>{"use strict";let b=(0,a.i(564375).default)("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);a.s(["RotateCcw",()=>b],361842)},565213,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(792071),f=a.i(585459),g=a.i(393551),h=a.i(396465),i=a.i(158799),j=a.i(397625),k=a.i(799856),l=b([g,h,i,j,k]);[g,h,i,j,k]=l.then?(await l)():l,a.s(["default",0,({selectedDate:a,onDateChange:b})=>(0,d.jsxs)("div",{className:"grid gap-3",children:[(0,d.jsx)(j.Label,{htmlFor:"date",children:"Date"}),(0,d.jsxs)(i.Popover,{children:[(0,d.jsx)(i.PopoverTrigger,{asChild:!0,children:(0,d.jsxs)(h.Button,{variant:"outline",className:(0,k.cn)("w-full justify-start text-left font-normal",!a&&"text-muted-foreground"),children:[(0,d.jsx)(f.CalendarIcon,{className:"mr-2 h-4 w-4"}),a?(0,e.format)(a,"PPP"):(0,d.jsx)("span",{children:"Pick a date"})]})}),(0,d.jsx)(i.PopoverContent,{className:"w-auto p-0",align:"start",children:(0,d.jsx)(g.Calendar,{mode:"single",selected:a,onSelect:a=>{if(a){let c=new Date(a.getFullYear(),a.getMonth(),a.getDate(),12,0,0);b(c)}},initialFocus:!0,className:(0,k.cn)("p-3 pointer-events-auto")})})]})]})]),c()}catch(a){c(a)}},!1),977759,a=>a.a(async(b,c)=>{try{var d=a.i(127669),e=a.i(964889),f=a.i(108191),g=a.i(531811),h=a.i(202529),i=b([e,g,h]);[e,g,h]=i.then?(await i)():i,a.s(["useCustomerCategories",0,()=>{let[a,b]=(0,d.useState)([]),[c,i]=(0,d.useState)(!0),{currentBusiness:j}=(0,e.useBusiness)(),{user:k}=(0,g.useAuth)(),l=async()=>{if(!j){b([]),i(!1);return}try{let a=await (0,h.getCustomerCategoriesAction)(j.id);if(a.success&&a.data)b(a.data);else throw Error(a.error)}catch(a){console.error("Error fetching customer categories:",a),(0,f.toast)({title:"Error",description:"Failed to fetch customer categories",variant:"destructive"})}finally{i(!1)}};(0,d.useEffect)(()=>{l()},[j]);let m=async a=>{if(!j||!k)return(0,f.toast)({title:"Error",description:"No business selected or user not authenticated",variant:"destructive"}),!1;try{let b=await (0,h.createCustomerCategoryAction)(j.id,k.id,a);if(b.success)return(0,f.toast)({title:"Success",description:"Customer category created successfully"}),l(),!0;throw Error(b.error)}catch(a){return console.error("Error creating customer category:",a),(0,f.toast)({title:"Error",description:"Failed to create customer category",variant:"destructive"}),!1}},n=async(a,b)=>{try{let c=await (0,h.updateCustomerCategoryAction)(a,b);if(c.success)return(0,f.toast)({title:"Success",description:"Customer category updated successfully"}),l(),!0;throw Error(c.error)}catch(a){return console.error("Error updating customer category:",a),(0,f.toast)({title:"Error",description:"Failed to update customer category",variant:"destructive"}),!1}},o=async a=>{try{let b=await (0,h.deleteCustomerCategoryAction)(a);if(b.success)return(0,f.toast)({title:"Success",description:"Customer category deleted successfully"}),l(),!0;throw Error(b.error)}catch(a){return console.error("Error deleting customer category:",a),(0,f.toast)({title:"Error",description:"Failed to delete customer category",variant:"destructive"}),!1}};return{categories:a,isLoading:c,createCategory:m,updateCategory:n,deleteCategory:o,refetch:l}}]),c()}catch(a){c(a)}},!1),491118,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(112779),g=a.i(397625),h=a.i(799856),i=a.i(396465),j=a.i(597435),k=a.i(688272),l=a.i(977759),m=b([f,g,h,i,k,l]);[f,g,h,i,k,l]=m.then?(await m)():m,a.s(["default",0,({customerName:a,customerAddress:b,customerContact:c,notes:m="",onCustomerInfoChange:n,errors:o,customers:p=[],onAddNewCustomer:q,onSelectCustomer:r,selectedCategoryId:s,onCategoryChange:t})=>{let[u,v]=(0,e.useState)(!1),[w,x]=(0,e.useState)(""),[y,z]=(0,e.useState)(""),{categories:A}=(0,l.useCustomerCategories)(),B=p?.filter(a=>a.fullName.toLowerCase().includes(w.toLowerCase()))||[];(0,e.useEffect)(()=>{if(x(a),a.trim()){let b=p.find(b=>b.fullName===a);if(b&&b.categoryId){let a=A.find(a=>a.id===b.categoryId);z(a?.name||"")}else z("")}else z("")},[a,p,A]),(0,e.useEffect)(()=>{if(s){let a=A.find(a=>a.id===s);z(a?.name||"")}else z("")},[s,A]);let C=a.trim()&&p.some(b=>b.fullName===a);return(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsx)("h3",{className:"text-lg font-semibold",children:"Customer Information"}),(0,d.jsxs)("div",{className:"grid gap-3",children:[(0,d.jsx)(g.Label,{htmlFor:"customerName",children:"Customer Name"}),(0,d.jsxs)("div",{className:"flex flex-col space-y-2 relative",children:[(0,d.jsx)(f.Input,{id:"customerName",name:"customerName",value:a,onChange:a=>{let b=a.target.value;x(b),n(a),b.trim()?v(!0):(v(!1),z(""),t&&t(""))},onFocus:()=>w.trim()&&v(!0),onBlur:()=>{setTimeout(()=>{v(!1)},200)},onKeyDown:a=>{"Enter"===a.key&&(a.preventDefault(),document.getElementById("customerAddress")?.focus())},className:(0,h.cn)(o.customerName?"border-red-500":"","w-full"),placeholder:"Start typing customer name...",autoComplete:"off"}),u&&(0,d.jsx)("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white dark:bg-gray-800 border rounded-md shadow-lg z-50 max-h-60 overflow-y-auto",children:B.length>0?B.map(b=>{let c=(a=>{if(!a)return null;let b=A.find(b=>b.id===a);return b?.name||null})(b.categoryId||null);return(0,d.jsx)("div",{className:"px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer border-b last:border-0 border-gray-100 dark:border-gray-700 transition-colors",onMouseDown:a=>{a.preventDefault();if(v(!1),r&&r(b),b.categoryId){let a=A.find(a=>a.id===b.categoryId);z(a?.name||""),t&&t(b.categoryId)}else z(""),t&&t("")},children:(0,d.jsx)("div",{className:"flex items-start justify-between gap-2",children:(0,d.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2 mb-0.5",children:[a===b.fullName&&(0,d.jsx)(j.Check,{className:"h-4 w-4 text-green-500 shrink-0"}),(0,d.jsx)("span",{className:"font-medium text-sm truncate uppercase tracking-tight",children:b.fullName}),c&&(0,d.jsx)("span",{className:"text-[10px] font-bold bg-primary/10 text-primary px-1.5 py-0.5 rounded leading-none uppercase",children:c})]}),(0,d.jsxs)("div",{className:"flex flex-wrap gap-x-3 gap-y-1 text-xs text-muted-foreground mt-1",children:[b.location&&(0,d.jsxs)("span",{className:"flex items-center gap-1",children:[(0,d.jsx)("span",{className:"opacity-70 italic text-[11px]",children:"at"})," ",b.location]}),b.phoneNumber&&(0,d.jsx)("span",{className:"flex items-center gap-1",children:(0,d.jsx)("span",{className:"opacity-70 tabular-nums",children:b.phoneNumber})})]})]})})},b.id)}):(0,d.jsxs)("div",{className:"px-4 py-6 text-center text-muted-foreground",children:[(0,d.jsx)("p",{className:"text-sm",children:"No customers found"}),(0,d.jsx)("p",{className:"text-xs opacity-70 mt-1",children:"Try a different search or add a new customer"})]})}),o.customerName&&(0,d.jsx)("p",{className:"text-red-500 text-xs",children:o.customerName})]})]}),(0,d.jsxs)("div",{className:"grid gap-3",children:[(0,d.jsx)(g.Label,{htmlFor:"customerAddress",children:"Customer Address"}),(0,d.jsx)(f.Input,{id:"customerAddress",name:"customerAddress",value:b,onChange:n,onKeyDown:a=>{"Enter"===a.key&&(a.preventDefault(),document.getElementById("customerContact")?.focus())}})]}),(0,d.jsxs)("div",{className:"grid gap-3",children:[(0,d.jsx)(g.Label,{htmlFor:"customerContact",children:"Customer Contact"}),(0,d.jsx)(f.Input,{id:"customerContact",name:"customerContact",value:c,onChange:n,onKeyDown:a=>{if("Enter"===a.key){a.preventDefault();let b=document.getElementById("customerCategory"),c=document.querySelector('[role="combobox"]');b?b.focus():c?c.focus():document.getElementById("description-0")?.focus()}}})]}),(0,d.jsxs)("div",{className:"grid gap-3",children:[(0,d.jsx)(g.Label,{htmlFor:"customerCategory",children:"Customer Category"}),C?(0,d.jsx)(f.Input,{id:"customerCategory",value:y,readOnly:!0,className:"bg-gray-50 dark:bg-gray-800",placeholder:"Category from existing customer",onKeyDown:a=>{"Enter"===a.key&&(a.preventDefault(),document.getElementById("description-0")?.focus())}}):(0,d.jsxs)(k.Select,{value:s||"none",onValueChange:a=>{if("none"===a)z(""),t&&t("");else{let b=A.find(b=>b.id===a);b&&(z(b.name),t&&t(a))}},onOpenChange:a=>{a||setTimeout(()=>{document.getElementById("description-0")?.focus()},100)},children:[(0,d.jsx)(k.SelectTrigger,{onKeyDown:a=>{"Enter"===a.key&&setTimeout(()=>{document.getElementById("description-0")?.focus()},100)},children:(0,d.jsx)(k.SelectValue,{placeholder:"Select a category"})}),(0,d.jsxs)(k.SelectContent,{children:[(0,d.jsx)(k.SelectItem,{value:"none",children:"No Category"}),A.filter(a=>a.id&&""!==a.id.trim()).map(a=>(0,d.jsx)(k.SelectItem,{value:a.id,children:a.name},a.id))]})]})]}),q&&(0,d.jsx)(i.Button,{type:"button",variant:"outline",onClick:q,className:"w-full mt-2",children:"Add New Customer"})]})}]),c()}catch(a){c(a)}},!1),595141,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(25670),f=a.i(811705),g=a.i(396465),h=a.i(2026),i=a.i(361842),j=a.i(565213),k=a.i(491118),l=b([f,g,j,k]);[f,g,j,k]=l.then?(await l)():l,a.s(["default",0,({isEditing:a,selectedDate:b,onDateChange:c,customerName:l,customerAddress:m,customerContact:n,notes:o,onCustomerInfoChange:p,errors:q,customers:r,onAddNewCustomer:s,onSelectCustomer:t,selectedCategoryId:u,onCategoryChange:v,onClearForm:w})=>{let x=(0,e.useRouter)();return(0,d.jsxs)(f.Card,{className:"mb-6",children:[(0,d.jsx)(f.CardHeader,{children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[(0,d.jsx)(g.Button,{variant:"ghost",size:"icon",onClick:()=>{x.push("/sales")},type:"button",className:"h-8 w-8",children:(0,d.jsx)(h.ArrowLeft,{className:"h-4 w-4"})}),(0,d.jsxs)("div",{children:[(0,d.jsx)(f.CardTitle,{children:a?"Edit Sale":"New Sale"}),(0,d.jsx)(f.CardDescription,{children:"Enter the sale details below"})]})]}),!a&&w&&(0,d.jsxs)(g.Button,{variant:"outline",size:"sm",onClick:w,type:"button",className:"flex items-center gap-2",children:[(0,d.jsx)(i.RotateCcw,{className:"h-4 w-4"}),"Clear Form"]})]})}),(0,d.jsxs)(f.CardContent,{className:"space-y-6",children:[(0,d.jsx)(j.default,{selectedDate:b,onDateChange:c}),(0,d.jsx)(k.default,{customerName:l,customerAddress:m,customerContact:n,notes:o,onCustomerInfoChange:p,errors:q,customers:r,onAddNewCustomer:s,onSelectCustomer:t,selectedCategoryId:u,onCategoryChange:v})]})]})}]),c()}catch(a){c(a)}},!1),201184,a=>{"use strict";let b=(0,a.i(564375).default)("Eraser",[["path",{d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21",key:"182aya"}],["path",{d:"M22 21H7",key:"t4ddhn"}],["path",{d:"m5 11 9 9",key:"1mo9qw"}]]);a.s(["Eraser",()=>b],201184)},273995,a=>a.a(async(b,c)=>{try{let b=await a.y("@radix-ui/react-collapsible-22c26e3d0aa601ce");a.n(b),c()}catch(a){c(a)}},!0),232114,a=>a.a(async(b,c)=>{try{var d=a.i(273995),e=b([d]);[d]=e.then?(await e)():e;let f=d.Root,g=d.CollapsibleTrigger,h=d.CollapsibleContent;a.s(["Collapsible",()=>f,"CollapsibleContent",()=>h,"CollapsibleTrigger",()=>g]),c()}catch(a){c(a)}},!1),274746,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(396465),g=a.i(112779),h=a.i(397625),i=a.i(330281),j=a.i(946032),k=a.i(132660),l=a.i(620578),m=a.i(201184),n=a.i(799856),o=a.i(224993),p=a.i(852741),q=a.i(531811),r=a.i(964889),s=a.i(169320),t=a.i(558277),u=a.i(584210),v=a.i(767810),w=a.i(232114),x=a.i(158799),y=a.i(899054),z=a.i(500885),A=a.i(219269),B=a.i(625250),C=b([f,g,h,i,n,o,q,r,s,v,w,x,y,z,B]);[f,g,h,i,n,o,q,r,s,v,w,x,y,z,B]=C.then?(await C)():C,a.s(["default",0,({item:a,index:b,onUpdate:c,onRemove:C,saleDate:D})=>{let E,F,{settings:G}=(0,o.useBusinessSettings)(),H=G.currency||"USD",{user:I}=(0,q.useAuth)(),{currentBusiness:J}=(0,r.useBusiness)(),{canViewCostPrice:K,canViewSellingPrice:L,formatFinancial:M}=(0,B.useFinancialVisibility)(),[N,O]=(0,e.useState)(a.description||""),P=(0,t.useIsMobile)(),[Q,R]=(0,e.useState)(!1),[S,T]=(0,e.useState)(!1),[U,V]=(0,e.useState)((0,n.formatNumberInput)(a.quantity?.toString()||"0")),[W,X]=(0,e.useState)((0,n.formatNumberInput)(a.price?.toString()||"0")),[Y,Z]=(0,e.useState)((0,n.formatNumberInput)(a.cost?.toString()||"0")),[$,_]=(0,e.useState)((0,n.formatNumberInput)(a.discountAmount?.toString()||"0")),[aa,ab]=(0,e.useState)((0,n.formatNumberInput)(a.discountPercentage?.toString()||"0")),[ac,ad]=(0,e.useState)(a.description||"");(0,e.useEffect)(()=>{let a=setTimeout(()=>{ad(N)},300);return()=>clearTimeout(a)},[N]);let{data:ae=[]}=(0,z.useQuery)({queryKey:["all-products",I?.id,J?.id],queryFn:async()=>I?.id&&J?.id?await (0,p.getAllProductsAction)(I.id,J.id):[],enabled:!!I?.id&&!!J?.id,staleTime:3e5}),af=(0,e.useMemo)(()=>ac.trim()?ae.filter(a=>(0,A.matchProductSearch)(a,ac)).slice(0,20):[],[ae,ac]);(0,e.useEffect)(()=>{O(a.description||"");let b=parseFloat(U.replace(/,/g,""))||0;Math.abs(b-a.quantity)>.001&&V(0===a.quantity&&""===U?"":a.quantity.toString());let c=parseFloat(W.replace(/,/g,""))||0;Math.abs(c-a.price)>.001&&X(0===a.price&&""===W?"":a.price.toString());let d=parseFloat(Y.replace(/,/g,""))||0;Math.abs(d-a.cost)>.001&&Z(0===a.cost&&""===Y?"":a.cost.toString());let e=parseFloat($.replace(/,/g,""))||0;Math.abs(e-(a.discountAmount||0))>.001&&_(a.discountAmount?.toString()||"0");let f=parseFloat(aa.replace(/,/g,""))||0;Math.abs(f-(a.discountPercentage||0))>.001&&ab(a.discountPercentage?.toString()||"0")},[a.description,a.quantity,a.price,a.cost,a.discountAmount,a.discountPercentage]);let ag=a.price*a.quantity,ah="amount"===a.discountType?a.discountAmount||0:ag*(a.discountPercentage||0)/100,ai=d=>{let{name:e,value:f}=d.target;if("description"===e){O(f),T(""!==f.trim());return}let g=(0,n.formatNumberInput)(f),h=(0,n.parseNumberInput)(f);if("quantity"===e){V(g),c(b,{...a,quantity:h});return}if("price"===e){X(g),c(b,{...a,price:h});return}if("cost"===e){Z(g),c(b,{...a,cost:h});return}if("discountAmount"===e){_(g),c(b,{...a,discountAmount:h});return}if("discountPercentage"===e){ab(g),c(b,{...a,discountPercentage:h});return}let i={...a,[e]:h};c(b,i)},aj=d=>{let e=(0,n.parseNumberInput)(d.target.value),f=a.quantity||1,g=e/f;Z((0,n.formatNumberInput)(g.toString()));let h={...a,cost:g};c(b,h)},ak=a.productId?af.find(b=>b.id===a.productId):null,al=ak&&D&&(E=new Date(ak.createdAt),F=new Date(D).setHours(0,0,0,0),new Date(E.getFullYear(),E.getMonth(),E.getDate()).getTime()>F);return(0,d.jsxs)("div",{className:"space-y-4 p-4 border rounded-lg bg-gray-50",children:[(0,d.jsxs)("div",{className:"flex justify-between items-start",children:[(0,d.jsxs)("h3",{className:"text-sm font-medium",children:["Item ",b+1]}),(0,d.jsxs)("div",{className:"flex space-x-2",children:[(0,d.jsxs)(f.Button,{variant:"outline",size:"sm",onClick:()=>{O(""),T(!1),a.quantity;let d={...a,description:"",price:0,cost:0,productId:null,discountAmount:0,discountPercentage:0};X("0"),Z("0"),_("0"),ab("0"),c(b,d),s.toast.success("Item cleared")},className:"text-gray-600 hover:text-gray-800",children:[(0,d.jsx)(m.Eraser,{className:"h-4 w-4 mr-1"}),(0,d.jsx)("span",{className:"hidden sm:inline",children:"Clear"})]}),(0,d.jsxs)(f.Button,{variant:"ghost",size:"sm",onClick:()=>C(b),className:"text-destructive hover:text-destructive",children:[(0,d.jsx)(j.Trash2,{className:"h-4 w-4"}),(0,d.jsx)("span",{className:"sr-only",children:"Remove Item"})]})]})]}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(h.Label,{htmlFor:`description-${b}`,className:"text-sm font-medium",children:"Product / Service"}),(0,d.jsxs)("div",{className:"flex space-x-2",children:[(0,d.jsxs)("div",{className:"flex-grow relative",children:[(0,d.jsx)(i.Textarea,{id:`description-${b}`,name:"description",value:N,onChange:ai,placeholder:"Enter product name",onFocus:()=>""!==N.trim()&&T(!0),onBlur:()=>{N!==a.description&&c(b,{...a,description:N})},onKeyDown:a=>{"Enter"!==a.key||a.shiftKey||(a.preventDefault(),document.getElementById(`quantity-${b}`)?.focus())},className:P?"min-h-16 text-base":""}),S&&""!==N.trim()&&af.length>0&&(0,d.jsx)("div",{className:"absolute z-10 mt-1 w-full bg-white border rounded-md shadow-lg max-h-60 overflow-auto",children:af.map(e=>(0,d.jsxs)("div",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer flex justify-between items-center",onClick:()=>{let d;return O(e.name),T(!1),X((0,n.formatNumberInput)(e.sellingPrice.toString())),Z((0,n.formatNumberInput)(e.costPrice.toString())),d={...a,description:e.name,price:e.sellingPrice,cost:e.costPrice,productId:e.id},void c(b,d)},children:[(0,d.jsxs)("div",{className:"flex items-center",children:[(0,d.jsx)(u.default,{imageUrl:e.imageUrl,alt:e.name,size:"sm"}),(0,d.jsxs)("div",{className:"ml-3",children:[(0,d.jsxs)("div",{className:"font-medium flex items-center gap-2",children:[e.name,e.category&&(0,d.jsx)(y.Badge,{variant:"secondary",className:"text-[10px] px-1.5 py-0 h-4 bg-gray-100 text-gray-500 font-normal",children:e.category})]}),(0,d.jsx)("div",{className:"text-xs text-gray-500",children:L?`${H} ${e.sellingPrice.toFixed(2)}`:"Price Hidden"})]})]}),(0,d.jsxs)("div",{className:"text-xs",children:[parseFloat(e.quantity.toFixed(5)).toString()," in stock"]})]},e.id))})]}),al&&(0,d.jsxs)("div",{className:"mt-2 p-3 bg-red-50 border border-red-200 rounded-md",children:[(0,d.jsx)("p",{className:"text-sm text-red-700 font-medium",children:"ðŸš« Error: This product was created after the sale date. The sale cannot be created or updated."}),(0,d.jsx)("p",{className:"text-xs text-red-600 mt-1",children:"Please adjust the sale date or select a different product to continue."})]})]})]}),P?(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(h.Label,{htmlFor:`quantity-${b}`,className:"text-sm font-medium",children:"Quantity"}),(0,d.jsx)(g.Input,{id:`quantity-${b}`,name:"quantity",type:"text",inputMode:"decimal",value:U,onChange:ai,onKeyDown:a=>{"Enter"===a.key&&(a.preventDefault(),document.getElementById(`price-${b}`)?.focus())},className:"h-12 text-lg"})]}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(h.Label,{htmlFor:`price-${b}`,className:"text-sm font-medium",children:"Price per unit"}),(0,d.jsx)(g.Input,{id:`price-${b}`,name:"price",type:"text",inputMode:"decimal",value:W,onChange:ai,onKeyDown:a=>{if("Enter"===a.key){a.preventDefault();let c=document.getElementById(`price-${b}`);c?.focus()}},className:"h-12 text-lg"})]})]}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsx)(h.Label,{className:"text-sm font-medium",children:"Discount"}),(0,d.jsxs)("select",{value:a.discountType||"percentage",onChange:d=>{let e=d.target.value,f={...a,discountType:e};"percentage"===e?(f.discountAmount=0,_("0")):(f.discountPercentage=0,ab("0")),c(b,f)},className:"flex-shrink-0 w-12 h-8 text-xs border border-input bg-background px-1 rounded-md",children:[(0,d.jsx)("option",{value:"percentage",children:"%"}),(0,d.jsx)("option",{value:"amount",children:H})]})]}),(0,d.jsx)(g.Input,{name:"amount"===a.discountType?"discountAmount":"discountPercentage",type:"text",inputMode:"decimal",value:"amount"===a.discountType?$:aa,onChange:ai,placeholder:"0",onKeyDown:a=>{"Enter"===a.key&&(a.preventDefault(),document.getElementById("taxRate")?.focus())},className:"h-12 text-lg"})]}),K&&(0,d.jsx)("div",{className:"space-y-2",children:(0,d.jsxs)(w.Collapsible,{open:Q,onOpenChange:R,children:[(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsx)(h.Label,{className:"text-sm font-medium text-gray-500",children:"Cost Info"}),(0,d.jsx)(w.CollapsibleTrigger,{asChild:!0,children:(0,d.jsx)(f.Button,{variant:"ghost",size:"sm",className:"p-1 h-8 w-8",children:Q?(0,d.jsx)(l.EyeOff,{className:"h-4 w-4 text-gray-500"}):(0,d.jsx)(k.Eye,{className:"h-4 w-4 text-gray-500"})})})]}),(0,d.jsxs)(w.CollapsibleContent,{className:"space-y-4 pt-2",children:[(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(h.Label,{htmlFor:`cost-${b}`,className:"text-xs text-gray-500",children:"Cost per unit"}),(0,d.jsx)(g.Input,{id:`cost-${b}`,name:"cost",type:"text",inputMode:"decimal",value:Y,onChange:ai,className:"h-12 text-lg"})]}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(h.Label,{htmlFor:`total-cost-${b}`,className:"text-xs text-gray-500",children:"Total Cost"}),(0,d.jsx)(g.Input,{id:`total-cost-${b}`,name:"totalCost",type:"text",inputMode:"decimal",value:(0,n.formatNumber)(a.cost*a.quantity),onChange:aj,className:"h-12 text-lg font-semibold bg-gray-50"})]}),(0,d.jsx)("p",{className:"text-xs text-muted-foreground",children:"(Internal use only)"})]})]})})]})]}):(0,d.jsxs)("div",{className:"grid grid-cols-4 gap-4",children:[(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(h.Label,{htmlFor:`quantity-${b}`,children:"Quantity"}),(0,d.jsx)(g.Input,{id:`quantity-${b}`,name:"quantity",type:"text",inputMode:"decimal",value:U,onChange:ai,onKeyDown:a=>{"Enter"===a.key&&(a.preventDefault(),document.getElementById(`price-${b}`)?.focus())}})]}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(h.Label,{htmlFor:`price-${b}`,children:"Price per unit"}),(0,d.jsx)(g.Input,{id:`price-${b}`,name:"price",type:"text",inputMode:"decimal",value:W,onChange:ai,onKeyDown:b=>{if("Enter"===b.key){b.preventDefault();let c=document.querySelector(`input[name="${"amount"===a.discountType?"discountAmount":"discountPercentage"}"]`);c?.focus()}}})]}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(h.Label,{children:"Discount"}),(0,d.jsxs)("div",{className:"flex gap-1",children:[(0,d.jsxs)("select",{value:a.discountType||"percentage",onChange:d=>{let e=d.target.value,f={...a,discountType:e};"percentage"===e?(f.discountAmount=0,_("0")):(f.discountPercentage=0,ab("0")),c(b,f)},className:"flex-shrink-0 w-12 text-xs border border-input bg-background px-1 py-2 rounded-md",children:[(0,d.jsx)("option",{value:"percentage",children:"%"}),(0,d.jsx)("option",{value:"amount",children:H})]}),(0,d.jsx)(g.Input,{name:"amount"===a.discountType?"discountAmount":"discountPercentage",type:"text",inputMode:"decimal",value:"amount"===a.discountType?$:aa,onChange:ai,placeholder:"0",onKeyDown:a=>{"Enter"===a.key&&(a.preventDefault(),document.getElementById("taxRate")?.focus())},className:"flex-1"})]})]}),K&&(0,d.jsx)("div",{className:"space-y-2",children:(0,d.jsxs)(x.Popover,{children:[(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsx)(h.Label,{className:"text-gray-500",children:"Cost Info"}),(0,d.jsx)(v.TooltipProvider,{children:(0,d.jsxs)(v.Tooltip,{children:[(0,d.jsx)(v.TooltipTrigger,{asChild:!0,children:(0,d.jsx)(x.PopoverTrigger,{asChild:!0,children:(0,d.jsx)(f.Button,{variant:"ghost",size:"sm",className:"p-0 h-6 w-6",children:(0,d.jsx)(k.Eye,{className:"h-4 w-4 text-gray-500"})})})}),(0,d.jsx)(v.TooltipContent,{children:(0,d.jsx)("p",{children:"Click to view/edit cost"})})]})})]}),(0,d.jsx)(x.PopoverContent,{className:"w-64 p-4 bg-white shadow-xl border",children:(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(h.Label,{htmlFor:`cost-popover-${b}`,className:"text-xs",children:"Cost per unit"}),(0,d.jsx)(g.Input,{id:`cost-popover-${b}`,name:"cost",type:"text",inputMode:"decimal",value:Y,onChange:ai})]}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsxs)(h.Label,{htmlFor:`total-cost-popover-${b}`,className:"text-xs",children:["Total Cost (for ",a.quantity," units)"]}),(0,d.jsx)(g.Input,{id:`total-cost-popover-${b}`,name:"totalCost",type:"text",value:(0,n.formatNumber)(a.cost*a.quantity),onChange:aj,className:"font-bold bg-gray-50"})]}),(0,d.jsx)("div",{className:"pt-2 border-t",children:(0,d.jsx)("p",{className:"text-[10px] text-muted-foreground",children:"Costs entered here only apply to this specific sale and do not change the product's base price in inventory."})})]})})]})})]}),(0,d.jsx)("div",{className:"pt-2 border-t mt-2",children:(0,d.jsxs)("div",{className:"flex justify-end items-center space-y-1 flex-col",children:[((a.discountPercentage||0)>0||(a.discountAmount||0)>0)&&(0,d.jsxs)("div",{className:"flex justify-end items-center w-full",children:[(0,d.jsx)("span",{className:"text-xs text-muted-foreground mr-2",children:"Subtotal:"}),(0,d.jsxs)("span",{className:"text-xs text-muted-foreground line-through",children:[H," ",(0,n.formatNumber)(ag)]})]}),((a.discountPercentage||0)>0||(a.discountAmount||0)>0)&&(0,d.jsxs)("div",{className:"flex justify-end items-center w-full",children:[(0,d.jsxs)("span",{className:"text-xs text-green-600 mr-2",children:["Discount ","amount"===a.discountType?"":`(${a.discountPercentage}%)`,":"]}),(0,d.jsxs)("span",{className:"text-xs text-green-600",children:["-",H," ",(0,n.formatNumber)(ah)]})]}),(0,d.jsxs)("div",{className:"flex justify-end items-center w-full",children:[(0,d.jsx)("span",{className:"text-sm font-medium mr-2",children:"Total:"}),(0,d.jsxs)("span",{className:"text-sm font-bold",children:[H," ",(0,n.formatNumber)(ag-ah)]})]})]})})]})}]),c()}catch(a){c(a)}},!1),431772,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(493901),f=a.i(396465),g=a.i(274746),h=b([f,g]);[f,g]=h.then?(await h)():h,a.s(["default",0,({items:a,onAddItem:b,onUpdateItem:c,onRemoveItem:h,saleDate:i})=>(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsx)("h3",{className:"text-lg font-semibold",children:"Items/Services"}),(0,d.jsxs)("div",{className:"space-y-4",children:[a.map((a,b)=>(0,d.jsx)("div",{id:`sale-item-${b}`,children:(0,d.jsx)(g.default,{item:a,index:b,onUpdate:c,onRemove:h,saleDate:i})},b)),(0,d.jsxs)(f.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>b(),className:"gap-1 w-full mt-2",children:[(0,d.jsx)(e.Plus,{className:"h-4 w-4"}),"Add Item"]})]})]})]),c()}catch(a){c(a)}},!1),861460,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(112779),f=a.i(397625),g=b([e,f]);[e,f]=g.then?(await g)():g,a.s(["default",0,({taxRateInput:a,onTaxRateChange:b,errors:c})=>(0,d.jsxs)("div",{className:"grid gap-3",children:[(0,d.jsx)(f.Label,{htmlFor:"taxRate",children:"Tax Rate (%)"}),(0,d.jsx)(e.Input,{id:"taxRate",name:"taxRate",type:"text",inputMode:"decimal",value:a,onChange:b,onKeyDown:a=>{if("Enter"===a.key){a.preventDefault();let b=document.querySelector('[data-payment-status-select="true"]');if(b)b.focus();else{let a=document.querySelector('button[type="submit"]');a?.focus()}}},className:c.taxRate?"border-red-500":""}),c.taxRate&&(0,d.jsx)("p",{className:"text-red-500 text-xs",children:c.taxRate})]})]),c()}catch(a){c(a)}},!1),635781,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(799856),f=b([e]);[e]=f.then?(await f)():f,a.s(["default",0,({totalAmount:a,taxAmount:b,grandTotal:c,taxRate:f,currency:g})=>(0,d.jsx)("div",{className:"bg-slate-50 p-4 rounded-md border",children:(0,d.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center bg-gray-100 px-2 py-1 rounded-sm",children:[(0,d.jsx)("h3",{className:"font-medium",children:"Subtotal"}),(0,d.jsxs)("span",{className:"font-medium",children:[g," ",(0,e.formatNumber)(a)]})]}),f>0&&(0,d.jsxs)("div",{className:"flex justify-between items-center bg-gray-100 px-2 py-1 rounded-sm",children:[(0,d.jsxs)("h3",{className:"font-medium",children:["Tax (",f,"%)"]}),(0,d.jsxs)("span",{className:"font-medium",children:[g," ",(0,e.formatNumber)(b)]})]}),(0,d.jsx)("div",{className:"h-px bg-gray-300 my-1"}),(0,d.jsxs)("div",{className:"flex justify-between items-center bg-gray-100 px-2 py-1 rounded-sm",children:[(0,d.jsx)("h3",{className:"font-semibold",children:"Grand Total"}),(0,d.jsxs)("span",{className:"text-xl font-bold",children:[g," ",(0,e.formatNumber)(c)]})]})]})})]),c()}catch(a){c(a)}},!1),55180,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(811705),g=a.i(431772),h=a.i(861460),i=a.i(635781),j=b([f,g,h,i]);[f,g,h,i]=j.then?(await j)():j,a.s(["default",0,({items:a,onAddItem:b,onUpdateItem:c,onRemoveItem:j,taxRateInput:k,onTaxRateChange:l,errors:m,totalAmount:n,taxAmount:o,grandTotal:p,taxRate:q,currency:r,saleDate:s})=>{let t=e.default.useRef(a);return e.default.useEffect(()=>{let b=t.current,c=-1;a.length>b.length?c=a.length-1:a.length===b.length&&(c=a.findIndex((a,c)=>{let d=b[c];return d&&a.quantity!==d.quantity})),t.current=a,-1!==c&&setTimeout(()=>{let a=document.getElementById(`sale-item-${c}`);a&&a.scrollIntoView({behavior:"smooth",block:"center"})},150)},[a]),(0,d.jsx)(f.Card,{className:"mb-6",children:(0,d.jsxs)(f.CardContent,{className:"pt-6 space-y-6",children:[(0,d.jsx)(g.default,{items:a,onAddItem:b,onUpdateItem:c,onRemoveItem:j,saleDate:s}),(0,d.jsx)(h.default,{taxRateInput:k,onTaxRateChange:l,errors:m}),(0,d.jsx)(i.default,{totalAmount:n,taxAmount:o,grandTotal:p,taxRate:q,currency:r})]})})}]),c()}catch(a){c(a)}},!1),366474,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(397625),f=a.i(688272),g=b([e,f]);[e,f]=g.then?(await g)():g,a.s(["default",0,({paymentStatus:a,onPaymentStatusChange:b})=>(0,d.jsxs)("div",{className:"grid gap-3",children:[(0,d.jsx)(e.Label,{htmlFor:"paymentStatus",children:"Payment Status"}),(0,d.jsxs)(f.Select,{value:a,onValueChange:b,children:[(0,d.jsx)(f.SelectTrigger,{className:"w-full","data-payment-status-select":"true",onKeyDown:a=>{if("Enter"===a.key){a.preventDefault();let b=document.querySelector('[data-cash-account-switch="true"]');if(b)b.focus();else{let a=document.querySelector('button[type="submit"]');a?.focus()}}},children:(0,d.jsx)(f.SelectValue,{placeholder:"Select payment status"})}),(0,d.jsxs)(f.SelectContent,{children:[(0,d.jsx)(f.SelectItem,{value:"Paid",children:"Paid"}),(0,d.jsx)(f.SelectItem,{value:"NOT PAID",children:"NOT PAID"}),(0,d.jsx)(f.SelectItem,{value:"Quote",children:"Quote"}),(0,d.jsx)(f.SelectItem,{value:"Installment Sale",children:"Installment Sale"})]})]})]})]),c()}catch(a){c(a)}},!1),898173,a=>{"use strict";let b=(0,a.i(564375).default)("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);a.s(["Edit3",()=>b],898173)},712361,a=>{"use strict";let b=(0,a.i(564375).default)("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);a.s(["Link",()=>b],712361)},841710,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(811705),g=a.i(540629),h=a.i(899054),i=a.i(396465),j=a.i(112779),k=a.i(688272),l=a.i(393551),m=a.i(158799),n=a.i(799856),o=a.i(792071),p=a.i(946032),q=a.i(818703),r=a.i(597435),s=a.i(734637),t=a.i(898173),u=a.i(712361),v=a.i(585459),w=b([f,g,h,i,j,k,l,m,n]);[f,g,h,i,j,k,l,m,n]=w.then?(await w)():w,a.s(["default",0,({payments:a,currency:b,isLoading:c,pendingChanges:w=[],isLocalMode:x=!1,onStageChange:y,cashAccounts:z=[],onLinkToCash:A,onUpdatePayment:B})=>{let[C,D]=(0,e.useState)(null),[E,F]=(0,e.useState)(null),[G,H]=(0,e.useState)(""),[I,J]=(0,e.useState)(""),[K,L]=(0,e.useState)(void 0),[M,N]=(0,e.useState)(null),[O,P]=(0,e.useState)(""),Q=(a,b)=>{D(a.id),F(b||null),H(X(a).toString()),J(Y(a)||""),L(a.paymentDate)},R=async a=>{if(!B)return;let b=W(a.id);"deleted"!==b&&Q(a,"date")},S=async(a,b)=>{if(b&&B){console.log("ðŸ”µ Date selected:",{paymentId:a.id,oldDate:a.paymentDate,newDate:b,formattedNew:(0,o.format)(b,"yyyy-MM-dd")});try{await B(a.id,{paymentDate:b}),console.log("âœ… Date update successful"),y&&y({id:a.id,type:"update",originalPayment:a,updatedData:{paymentDate:b}}),D(null),F(null),L(void 0)}catch(b){console.error("âŒ Error updating payment date:",b),L(a.paymentDate)}}},T=async a=>{if(!y&&!B)return;let b=""===G?0:parseFloat(G)||0;y?y({id:a.id,type:"update",originalPayment:a,updatedData:{amount:b,notes:I.trim()||void 0}}):B&&await B(a.id,{amount:"amount"===E?b:void 0,notes:"notes"===E&&I.trim()||void 0}),D(null),F(null)},U=()=>{D(null),F(null),H(""),J(""),L(void 0)},V=a=>{if(!y)return;let b=0===a.amount;window.confirm(b?"Are you sure you want to remove this zero-amount payment entry?":"Are you sure you want to mark this payment for deletion?")&&(console.log("ðŸŸ¡ STAGING deletion locally - NO DATABASE CALL"),y({id:a.id,type:"delete",originalPayment:a}),console.log("âœ… Deletion staged successfully"))},W=a=>{let b=w.find(b=>b.id===a);return b?.type==="delete"?"deleted":b?.type==="update"?"modified":"original"},X=a=>{let b=w.find(b=>b.id===a.id&&"update"===b.type);return b?.updatedData?.amount||a.amount},Y=a=>{let b=w.find(b=>b.id===a.id&&"update"===b.type);return b?.updatedData?.notes||a.notes},Z=a=>{if(!x||!y)return!1;let b=W(a.id);return"deleted"!==b},$=a=>{N(a),P("")},_=()=>{N(null),P("")},aa=async a=>{if(A&&O)try{await A(a.id,O),N(null),P("")}catch(a){console.error("Error linking payment to cash account:",a)}};if(c)return(0,d.jsxs)(f.Card,{className:"border-blue-200 bg-blue-50",children:[(0,d.jsx)(f.CardHeader,{className:"pb-3",children:(0,d.jsx)(f.CardTitle,{className:"text-sm text-blue-800",children:"Payment History"})}),(0,d.jsx)(f.CardContent,{children:(0,d.jsx)("div",{className:"text-sm text-muted-foreground",children:"Loading payment history..."})})]});if(0===a.length)return(0,d.jsxs)(f.Card,{className:"border-blue-200 bg-blue-50",children:[(0,d.jsx)(f.CardHeader,{className:"pb-3",children:(0,d.jsx)(f.CardTitle,{className:"text-sm text-blue-800",children:"Payment History"})}),(0,d.jsx)(f.CardContent,{children:(0,d.jsx)("div",{className:"text-sm text-muted-foreground",children:"No payments recorded yet"})})]});let ab=a.reduce((a,b)=>{let c=W(b.id);return"deleted"===c?a:a+X(b)},0),ac=x&&y;return console.log("InstallmentPaymentHistory - isLocalMode:",x,"onStageChange:",!!y,"showInlineEdit:",ac),(0,d.jsxs)(f.Card,{className:"border-blue-200 bg-blue-50",children:[(0,d.jsx)(f.CardHeader,{className:"pb-3",children:(0,d.jsxs)(f.CardTitle,{className:"text-sm text-blue-800 flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2",children:["Payment History",x&&(0,d.jsx)(q.Clock,{className:"h-3 w-3 text-amber-600"}),w.length>0&&(0,d.jsxs)(h.Badge,{variant:"outline",className:"text-xs bg-amber-100 text-amber-800 border-amber-300",children:[w.length," staged"]})]}),(0,d.jsxs)(h.Badge,{variant:"secondary",className:"bg-blue-100 text-blue-800 text-xs",children:["Total: ",b," ",(0,n.formatNumber)(ab)]})]})}),(0,d.jsxs)(f.CardContent,{className:"p-3 sm:p-6",children:[ac&&(0,d.jsx)("div",{className:"hidden sm:block mb-4 text-xs text-muted-foreground bg-blue-50 p-2 rounded border border-blue-200",children:"ðŸ’¡ Double-click on amount or notes to edit. Click delete button to remove payments (including zero amounts)."}),(0,d.jsx)("div",{className:"block sm:hidden space-y-3",children:a.map(a=>{let c=W(a.id),e=X(a),f=Y(a),g=C===a.id,q=Z(a);return(0,d.jsxs)("div",{className:`bg-white rounded-lg p-3 border shadow-sm ${"deleted"===c?"border-red-200 bg-red-50 opacity-60":"modified"===c?"border-amber-200 bg-amber-50":"border-gray-200"}`,children:[(0,d.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[g&&"date"===E?(0,d.jsxs)(m.Popover,{children:[(0,d.jsx)(m.PopoverTrigger,{asChild:!0,children:(0,d.jsxs)(i.Button,{variant:"outline",size:"sm",className:(0,n.cn)("h-7 text-xs justify-start text-left font-normal",!K&&"text-muted-foreground"),children:[(0,d.jsx)(v.CalendarIcon,{className:"mr-2 h-3 w-3"}),K?(0,o.format)(K,"MMM dd, yyyy"):(0,d.jsx)("span",{children:"Pick a date"})]})}),(0,d.jsx)(m.PopoverContent,{className:"w-auto p-0",align:"start",children:(0,d.jsx)(l.Calendar,{mode:"single",selected:K,onSelect:b=>S(a,b),initialFocus:!0,className:(0,n.cn)("p-3 pointer-events-auto")})})]}):(0,d.jsx)("div",{className:`text-xs text-muted-foreground ${B?"cursor-pointer hover:text-blue-600":""}`,onClick:()=>B&&R(a),title:B?"Click to edit date":"",children:(0,o.format)(a.paymentDate,"MMM dd, yyyy")}),"deleted"===c&&(0,d.jsx)(h.Badge,{variant:"outline",className:"text-xs bg-red-100 text-red-800 border-red-300",children:"To Delete"}),"modified"===c&&(0,d.jsx)(h.Badge,{variant:"outline",className:"text-xs bg-amber-100 text-amber-800 border-amber-300",children:"Modified"})]}),g&&"amount"===E?(0,d.jsx)("div",{className:"flex flex-col gap-2 min-w-0 flex-1 ml-2",children:(0,d.jsx)(j.Input,{type:"number",value:G,onChange:a=>H(a.target.value),className:"h-7 text-xs",step:"0.01",min:"0",placeholder:"0"})}):(0,d.jsxs)("div",{className:`text-sm font-semibold ${"deleted"===c?"line-through":""}`,children:[b," ",(0,n.formatNumber)(e)]})]}),g?(0,d.jsxs)("div",{className:"space-y-2",children:["notes"===E&&(0,d.jsx)(j.Input,{value:I,onChange:a=>J(a.target.value),placeholder:"Payment notes",className:"h-7 text-xs"}),(0,d.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,d.jsx)(i.Button,{size:"sm",variant:"outline",className:"h-6 px-2 text-xs",onClick:U,children:(0,d.jsx)(s.X,{className:"h-3 w-3"})}),(0,d.jsx)(i.Button,{size:"sm",className:"h-6 px-2 text-xs",onClick:()=>T(a),children:(0,d.jsx)(r.Check,{className:"h-3 w-3"})})]})]}):(0,d.jsxs)(d.Fragment,{children:[f&&(0,d.jsx)("div",{className:`text-xs text-muted-foreground mb-3 ${"deleted"===c?"line-through":""} ${B?"cursor-pointer hover:text-blue-600":""}`,onClick:()=>B&&Q(a,"notes"),title:B?"Click to edit notes":"",children:f}),(0,d.jsxs)("div",{className:"mb-3",children:[(0,d.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Cash Account:"}),M===a.id?(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsxs)(k.Select,{value:O,onValueChange:P,children:[(0,d.jsx)(k.SelectTrigger,{className:"h-7 text-xs flex-1",children:(0,d.jsx)(k.SelectValue,{placeholder:"Select account"})}),(0,d.jsx)(k.SelectContent,{children:z.map(a=>(0,d.jsx)(k.SelectItem,{value:a.id,children:(0,d.jsxs)("div",{className:"flex items-center",children:[(0,d.jsx)("span",{children:a.name}),a.isDefault&&(0,d.jsx)("span",{className:"ml-1 text-xs bg-blue-100 text-blue-800 px-1 py-0.5 rounded",children:"Default"})]})},a.id))})]}),(0,d.jsx)(i.Button,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-gray-500 hover:text-gray-700",onClick:_,children:(0,d.jsx)(s.X,{className:"h-3 w-3"})}),(0,d.jsx)(i.Button,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-green-500 hover:text-green-700",onClick:()=>aa(a),disabled:!O,children:(0,d.jsx)(r.Check,{className:"h-3 w-3"})})]}):(0,d.jsx)("div",{className:"flex items-center gap-2",children:a.cashTransactionId?(0,d.jsx)(h.Badge,{variant:"outline",className:"text-xs bg-green-100 text-green-800 border-green-300",children:"Linked"}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("span",{className:"text-xs text-muted-foreground",children:"Not linked"}),A&&z.length>0&&(0,d.jsx)(i.Button,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-blue-500 hover:text-blue-700",onClick:()=>$(a.id),title:"Link to cash account",children:(0,d.jsx)(u.Link,{className:"h-3 w-3"})})]})})]}),ac&&q&&(0,d.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,d.jsxs)(i.Button,{size:"sm",variant:"outline",className:"h-7 px-2 text-xs text-blue-600 hover:text-blue-700 border-blue-200 hover:border-blue-300",onClick:()=>Q(a),children:[(0,d.jsx)(t.Edit3,{className:"h-3 w-3 mr-1"}),"Edit"]}),(0,d.jsxs)(i.Button,{size:"sm",variant:"outline",className:"h-7 px-2 text-xs text-red-600 hover:text-red-700 border-red-200 hover:border-red-300",onClick:()=>V(a),children:[(0,d.jsx)(p.Trash2,{className:"h-3 w-3 mr-1"}),"Delete"]})]})]})]},a.id)})}),(0,d.jsx)("div",{className:"hidden sm:block overflow-x-auto",children:(0,d.jsxs)(g.Table,{children:[(0,d.jsx)(g.TableHeader,{children:(0,d.jsxs)(g.TableRow,{children:[(0,d.jsx)(g.TableHead,{className:"text-xs",children:"Date"}),(0,d.jsx)(g.TableHead,{className:"text-xs text-right",children:"Amount"}),(0,d.jsx)(g.TableHead,{className:"text-xs",children:"Notes"}),(0,d.jsx)(g.TableHead,{className:"text-xs",children:"Cash Account"}),ac&&(0,d.jsx)(g.TableHead,{className:"text-xs w-16",children:"Actions"})]})}),(0,d.jsx)(g.TableBody,{children:a.map(a=>{let c=W(a.id),e=X(a),f=Y(a),q=C===a.id,t=Z(a);return(0,d.jsxs)(g.TableRow,{className:"deleted"===c?"bg-red-50 opacity-60":"modified"===c?"bg-amber-50":"",children:[(0,d.jsx)(g.TableCell,{className:"text-xs",children:(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[C===a.id&&"date"===E?(0,d.jsxs)("div",{className:"flex items-center gap-1",children:[(0,d.jsxs)(m.Popover,{children:[(0,d.jsx)(m.PopoverTrigger,{asChild:!0,children:(0,d.jsxs)(i.Button,{variant:"outline",size:"sm",className:(0,n.cn)("h-7 text-xs justify-start text-left font-normal w-32",!K&&"text-muted-foreground"),children:[(0,d.jsx)(v.CalendarIcon,{className:"mr-2 h-3 w-3"}),K?(0,o.format)(K,"MMM dd, yyyy"):(0,d.jsx)("span",{children:"Pick a date"})]})}),(0,d.jsx)(m.PopoverContent,{className:"w-auto p-0",align:"start",children:(0,d.jsx)(l.Calendar,{mode:"single",selected:K,onSelect:b=>S(a,b),initialFocus:!0,className:(0,n.cn)("p-3 pointer-events-auto")})})]}),(0,d.jsx)(i.Button,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 text-gray-500 hover:text-gray-700",onClick:U,children:(0,d.jsx)(s.X,{className:"h-3 w-3"})}),(0,d.jsx)(i.Button,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 text-green-500 hover:text-green-700",onClick:()=>T(a),children:(0,d.jsx)(r.Check,{className:"h-3 w-3"})})]}):(0,d.jsx)("span",{className:`cursor-pointer hover:bg-gray-100 px-2 py-1 rounded ${"deleted"===c?"line-through":""} ${B?"hover:bg-blue-50":""}`,onClick:()=>B&&R(a),title:B?"Click to edit date":"",children:(0,o.format)(a.paymentDate,"MMM dd, yyyy")}),"deleted"===c&&(0,d.jsx)(h.Badge,{variant:"outline",className:"text-xs bg-red-100 text-red-800 border-red-300",children:"To Delete"}),"modified"===c&&(0,d.jsx)(h.Badge,{variant:"outline",className:"text-xs bg-amber-100 text-amber-800 border-amber-300",children:"Modified"})]})}),(0,d.jsx)(g.TableCell,{className:"text-xs text-right",children:q&&"amount"===E?(0,d.jsxs)("div",{className:"flex items-center gap-1 justify-end",children:[(0,d.jsx)(j.Input,{type:"number",value:G,onChange:a=>H(a.target.value),className:"h-7 text-xs w-24",step:"0.01",min:"0",autoFocus:!0,placeholder:"0"}),(0,d.jsx)(i.Button,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 text-gray-500 hover:text-gray-700",onClick:U,children:(0,d.jsx)(s.X,{className:"h-3 w-3"})}),(0,d.jsx)(i.Button,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 text-green-500 hover:text-green-700",onClick:()=>T(a),children:(0,d.jsx)(r.Check,{className:"h-3 w-3"})})]}):(0,d.jsxs)("span",{className:`font-medium cursor-pointer hover:bg-gray-100 px-2 py-1 rounded ${"deleted"===c?"line-through":""} ${ac&&t?"hover:bg-blue-50":""}`,onDoubleClick:()=>(a=>{if(!x||!y)return;let b=W(a.id);"deleted"!==b&&Q(a,"amount")})(a),title:ac&&t?"Double-click to edit":"",children:[b," ",(0,n.formatNumber)(e)]})}),(0,d.jsx)(g.TableCell,{className:"text-xs",children:q&&"notes"===E?(0,d.jsxs)("div",{className:"flex items-center gap-1",children:[(0,d.jsx)(j.Input,{value:I,onChange:a=>J(a.target.value),placeholder:"Payment notes",className:"h-7 text-xs",autoFocus:!0}),(0,d.jsx)(i.Button,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 text-gray-500 hover:text-gray-700",onClick:U,children:(0,d.jsx)(s.X,{className:"h-3 w-3"})}),(0,d.jsx)(i.Button,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 text-green-500 hover:text-green-700",onClick:()=>T(a),children:(0,d.jsx)(r.Check,{className:"h-3 w-3"})})]}):(0,d.jsx)("span",{className:`text-muted-foreground cursor-pointer hover:bg-gray-100 px-2 py-1 rounded ${"deleted"===c?"line-through":""} ${ac&&t?"hover:bg-blue-50":""}`,onDoubleClick:()=>(a=>{if(!x||!y)return;let b=W(a.id);"deleted"!==b&&Q(a,"notes")})(a),title:ac&&t?"Double-click to edit":"",children:f||"-"})}),(0,d.jsx)(g.TableCell,{className:"text-xs",children:M===a.id?(0,d.jsxs)("div",{className:"flex items-center gap-1",children:[(0,d.jsxs)(k.Select,{value:O,onValueChange:P,children:[(0,d.jsx)(k.SelectTrigger,{className:"h-7 text-xs w-32",children:(0,d.jsx)(k.SelectValue,{placeholder:"Select account"})}),(0,d.jsx)(k.SelectContent,{children:z.map(a=>(0,d.jsx)(k.SelectItem,{value:a.id,children:(0,d.jsxs)("div",{className:"flex items-center",children:[(0,d.jsx)("span",{children:a.name}),a.isDefault&&(0,d.jsx)("span",{className:"ml-1 text-xs bg-blue-100 text-blue-800 px-1 py-0.5 rounded",children:"Default"})]})},a.id))})]}),(0,d.jsx)(i.Button,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 text-gray-500 hover:text-gray-700",onClick:_,children:(0,d.jsx)(s.X,{className:"h-3 w-3"})}),(0,d.jsx)(i.Button,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 text-green-500 hover:text-green-700",onClick:()=>aa(a),disabled:!O,children:(0,d.jsx)(r.Check,{className:"h-3 w-3"})})]}):(0,d.jsx)("div",{className:"flex items-center gap-1",children:a.cashTransactionId?(0,d.jsx)(h.Badge,{variant:"outline",className:"text-xs bg-green-100 text-green-800 border-green-300",children:"Linked"}):A&&z.length>0&&(0,d.jsx)(i.Button,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 text-blue-500 hover:text-blue-700",onClick:()=>$(a.id),title:"Link to cash account",children:(0,d.jsx)(u.Link,{className:"h-3 w-3"})})})}),ac&&(0,d.jsx)(g.TableCell,{className:"text-xs",children:!q&&t&&(0,d.jsx)(i.Button,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 text-red-500 hover:text-red-700",onClick:()=>V(a),title:"Delete payment",children:(0,d.jsx)(p.Trash2,{className:"h-3 w-3"})})})]},a.id)})})]})})]})]})}]),c()}catch(a){c(a)}},!1),186973,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(792071),g=a.i(585459),h=a.i(397625),i=a.i(112779),j=a.i(811705),k=a.i(396465),l=a.i(393551),m=a.i(158799),n=a.i(799856),o=a.i(841710),p=b([h,i,j,k,l,m,n,o]);[h,i,j,k,l,m,n,o]=p.then?(await p)():p,a.s(["default",0,({amountPaid:a,amountDue:b,grandTotal:c,currency:p,onAmountPaidChange:q,onPaymentDateChange:r,paymentDate:s,maxAmount:t,saleId:u,onPaymentStatusChange:v,isEditing:w=!1,payments:x=[],pendingChanges:y=[],onStagePaymentChange:z,cashAccounts:A=[],onLinkToCash:B,onUpdatePayment:C})=>{let[D,E]=(0,e.useState)(s||new Date),[F,G]=(0,e.useState)((0,n.formatNumberInput)(a?.toString()||"0"));e.default.useEffect(()=>{let b=(0,n.parseNumberInput)(F);Math.abs(b-a)>.001&&G((0,n.formatNumberInput)(a.toString()))},[a]);let H=x.filter(a=>!y.find(b=>b.id===a.id&&"delete"===b.type)).map(a=>{let b=y.find(b=>b.id===a.id&&"update"===b.type);return b&&b.updatedData?{...a,amount:b.updatedData.amount??a.amount,notes:b.updatedData.notes??a.notes}:a}).reduce((a,b)=>a+b.amount,0),I=Math.max(0,c-H),J=H>=c,K=J?0:a||0;return console.log("InstallmentPaymentInput - isEditing:",w,"has onStagePaymentChange:",!!z),(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)(j.Card,{className:"border-blue-200 bg-blue-50",children:[(0,d.jsx)(j.CardHeader,{className:"pb-3",children:(0,d.jsx)(j.CardTitle,{className:"text-sm text-blue-800",children:"Installment Payment Details"})}),(0,d.jsxs)(j.CardContent,{className:"space-y-4",children:[(0,d.jsxs)("div",{className:"grid gap-3",children:[(0,d.jsx)(h.Label,{htmlFor:"amountPaid",className:"text-sm font-medium",children:"Amount Paid (Current Payment)"}),(0,d.jsx)(i.Input,{id:"amountPaid",type:"text",inputMode:"decimal",value:F,onChange:a=>{let b=a.target.value,c=(0,n.formatNumberInput)(b);G(c);let d=(0,n.parseNumberInput)(b),e=Math.min(d,I);q(e)},placeholder:"Enter amount paid",disabled:J,className:"text-base"})]}),(0,d.jsxs)("div",{className:"grid gap-3",children:[(0,d.jsx)(h.Label,{className:"text-sm font-medium",children:"Payment Date"}),(0,d.jsxs)(m.Popover,{children:[(0,d.jsx)(m.PopoverTrigger,{asChild:!0,children:(0,d.jsxs)(k.Button,{variant:"outline",className:(0,n.cn)("w-full justify-start text-left font-normal",!D&&"text-muted-foreground"),disabled:J,children:[(0,d.jsx)(g.CalendarIcon,{className:"mr-2 h-4 w-4"}),D?(0,f.format)(D,"PPP"):(0,d.jsx)("span",{children:"Pick a date"})]})}),(0,d.jsx)(m.PopoverContent,{className:"w-auto p-0",align:"start",children:(0,d.jsx)(l.Calendar,{mode:"single",selected:D,onSelect:a=>{a&&(E(a),r?.(a))},initialFocus:!0,className:(0,n.cn)("p-3 pointer-events-auto")})})]})]}),(0,d.jsxs)("div",{className:"space-y-3 sm:space-y-0 sm:grid sm:grid-cols-2 sm:gap-4",children:[(0,d.jsxs)("div",{className:"flex justify-between sm:block",children:[(0,d.jsx)("span",{className:"text-sm text-muted-foreground",children:"Total Amount:"}),(0,d.jsxs)("span",{className:"text-sm font-semibold sm:block",children:[p," ",(0,n.formatNumber)(c)]})]}),(0,d.jsxs)("div",{className:"flex justify-between sm:block",children:[(0,d.jsx)("span",{className:"text-sm text-muted-foreground",children:"Total Paid (History):"}),(0,d.jsxs)("span",{className:"text-sm font-semibold text-green-600 sm:block",children:[p," ",(0,n.formatNumber)(H)]})]})]}),(0,d.jsxs)("div",{className:"space-y-3 sm:space-y-0 sm:grid sm:grid-cols-2 sm:gap-4",children:[(0,d.jsxs)("div",{className:"flex justify-between sm:block",children:[(0,d.jsx)("span",{className:"text-sm text-muted-foreground",children:"Current Payment:"}),(0,d.jsxs)("span",{className:"text-sm font-semibold text-blue-600 sm:block",children:[p," ",(0,n.formatNumber)(K)]})]}),(0,d.jsxs)("div",{className:"flex justify-between sm:block",children:[(0,d.jsx)("span",{className:"text-sm text-muted-foreground",children:"Amount Due:"}),(0,d.jsxs)("span",{className:"text-sm font-semibold text-red-600 sm:block",children:[p," ",(0,n.formatNumber)(Math.max(0,I-K))]})]})]}),H+K>=c&&K>0&&(0,d.jsx)("div",{className:"text-sm text-green-600 font-medium bg-green-50 p-3 rounded border border-green-200",children:"âœ“ Full payment received - you can manually change status to Paid if needed"}),J&&(0,d.jsx)("div",{className:"text-sm text-green-600 font-medium bg-green-50 p-3 rounded border border-green-200",children:"âœ“ Sale fully paid - you can manually change status to Paid if needed"}),w&&y.length>0&&(0,d.jsxs)("div",{className:"text-sm text-amber-600 font-medium bg-amber-50 p-3 rounded border border-amber-200",children:["â„¹ï¸ ",y.length,' payment change(s) staged. Changes will be saved when you click "Update Sale".']}),w&&0===y.length&&x.length>0&&(0,d.jsx)("div",{className:"text-sm text-blue-600 font-medium bg-blue-50 p-3 rounded border border-blue-200",children:'â„¹ï¸ You can edit payment history. Changes will be saved when you click "Update Sale".'})]})]}),u&&(0,d.jsx)(o.default,{payments:x,currency:p,isLoading:!1,pendingChanges:y,isLocalMode:w,onStageChange:z,cashAccounts:A,onLinkToCash:B,onUpdatePayment:C})]})}]),c()}catch(a){c(a)}},!1),524407,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(397625),f=a.i(366736),g=a.i(688272),h=a.i(811705),i=b([e,f,g,h]);[e,f,g,h]=i.then?(await i)():i,a.s(["default",0,({linkToCash:a,onLinkToCashChange:b,selectedCashAccountId:c,onCashAccountChange:i,cashAccounts:j,paymentStatus:k})=>"Paid"!==k&&"Installment Sale"!==k?null:(0,d.jsxs)(h.Card,{className:"border-green-200 bg-green-50",children:[(0,d.jsx)(h.CardHeader,{className:"pb-3",children:(0,d.jsx)(h.CardTitle,{className:"text-sm text-green-800",children:"Installment Sale"===k?"Link Partial Payment to Cash Account":"Link to Cash Account"})}),(0,d.jsxs)(h.CardContent,{className:"space-y-4",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"space-y-0.5",children:[(0,d.jsx)(e.Label,{htmlFor:"link-to-cash",children:"Link to Cash Account"}),(0,d.jsx)("div",{className:"text-sm text-muted-foreground",children:"Installment Sale"===k?"Record the partial payment in a cash account":"Record this payment in a cash account"})]}),(0,d.jsx)(f.Switch,{id:"link-to-cash",checked:a,onCheckedChange:b,"data-cash-account-switch":"true",onKeyDown:b=>{if("Enter"===b.key)if(b.preventDefault(),a){let a=document.querySelector('[data-cash-account-select="true"]');a?.focus()}else{let a=document.querySelector('button[type="submit"]');a?.focus()}}})]}),a&&(0,d.jsxs)("div",{className:"grid gap-3",children:[(0,d.jsx)(e.Label,{htmlFor:"cash-account",children:"Select Cash Account"}),(0,d.jsxs)(g.Select,{value:c,onValueChange:i,children:[(0,d.jsx)(g.SelectTrigger,{className:"w-full","data-cash-account-select":"true",onKeyDown:a=>{if("Enter"===a.key){a.preventDefault();let b=document.querySelector('button[type="submit"]');b?.focus()}},children:(0,d.jsx)(g.SelectValue,{placeholder:"Select a cash account"})}),(0,d.jsx)(g.SelectContent,{children:j.map(a=>(0,d.jsx)(g.SelectItem,{value:a.id,children:(0,d.jsxs)("div",{className:"flex items-center",children:[(0,d.jsx)("span",{children:a.name}),a.isDefault&&(0,d.jsx)("span",{className:"ml-2 text-xs bg-blue-100 text-blue-800 px-1.5 py-0.5 rounded",children:"Default"})]})},a.id))})]}),c&&(0,d.jsx)("div",{className:"text-sm text-muted-foreground",children:"Installment Sale"===k?"The partial payment amount will be recorded in this account":"The full payment amount will be recorded in this account"})]})]})]})]),c()}catch(a){c(a)}},!1),950219,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(397625),f=a.i(688272),g=a.i(864369),h=b([e,f,g]);[e,f,g]=h.then?(await h)():h,a.s(["default",0,({value:a,onChange:b,label:c="Sales Source",placeholder:h="Select category (optional)"})=>{let{categories:i,isLoading:j}=(0,g.useSalesCategories)();return j?(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(e.Label,{children:c}),(0,d.jsx)(f.Select,{disabled:!0,children:(0,d.jsx)(f.SelectTrigger,{children:(0,d.jsx)(f.SelectValue,{placeholder:"Loading..."})})})]}):(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(e.Label,{children:c}),(0,d.jsxs)(f.Select,{value:a||"none",onValueChange:a=>{b("none"===a?"":a)},children:[(0,d.jsx)(f.SelectTrigger,{children:(0,d.jsx)(f.SelectValue,{placeholder:h})}),(0,d.jsxs)(f.SelectContent,{children:[(0,d.jsx)(f.SelectItem,{value:"none",children:"No source"}),i.map(a=>(0,d.jsx)(f.SelectItem,{value:a.id,children:a.name},a.id))]})]})]})}]),c()}catch(a){c(a)}},!1),973918,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(811705),f=a.i(112779),g=a.i(397625),h=a.i(366474),i=a.i(186973),j=a.i(841710),k=a.i(524407),l=a.i(950219),m=b([e,f,g,h,i,j,k,l]);[e,f,g,h,i,j,k,l]=m.then?(await m)():m,a.s(["default",0,({paymentStatus:a,onPaymentStatusChange:b,isInstallmentSale:c,amountPaid:m,amountDue:n,grandTotal:o,currency:p,onAmountPaidChange:q,onPaymentDateChange:r,paymentDate:s,saleId:t,onPaymentStatusChangeFromInstallment:u,isEditing:v,payments:w,pendingChanges:x,onStagePaymentChange:y,linkToCash:z,onLinkToCashChange:A,selectedCashAccountId:B,onCashAccountChange:C,cashAccounts:D,hasPaidWithHistory:E,onLinkPaymentToCash:F,onUpdatePayment:G,notes:H="",onNotesChange:I,categoryId:J="",onCategoryChange:K})=>(0,d.jsxs)(e.Card,{className:"mb-6",children:[(0,d.jsx)(e.CardHeader,{children:(0,d.jsx)(e.CardTitle,{children:"Payment Information"})}),(0,d.jsxs)(e.CardContent,{className:"space-y-6",children:[(0,d.jsx)(h.default,{paymentStatus:a,onPaymentStatusChange:b}),c&&(0,d.jsx)(i.default,{amountPaid:m,amountDue:n,grandTotal:o,currency:p,onAmountPaidChange:q,onPaymentDateChange:r,paymentDate:s,maxAmount:o,saleId:t,onPaymentStatusChange:u,isEditing:v,payments:w,pendingChanges:x,onStagePaymentChange:v?y:void 0,cashAccounts:D,onLinkToCash:F,onUpdatePayment:G}),E&&(0,d.jsxs)(e.Card,{className:"border-green-200 bg-green-50",children:[(0,d.jsx)(e.CardHeader,{className:"pb-3",children:(0,d.jsx)(e.CardTitle,{className:"text-sm text-green-800",children:"Payment History (Sale Completed)"})}),(0,d.jsx)(e.CardContent,{children:(0,d.jsx)(j.default,{payments:w,currency:p,isLoading:!1,pendingChanges:x,isLocalMode:v,onStageChange:v?y:void 0,cashAccounts:D,onLinkToCash:F,onUpdatePayment:G})})]}),(0,d.jsx)(k.default,{linkToCash:z,onLinkToCashChange:A,selectedCashAccountId:B,onCashAccountChange:C,cashAccounts:D,paymentStatus:a}),K&&(0,d.jsx)(l.default,{value:J,onChange:K}),(0,d.jsxs)("div",{className:"grid gap-3",children:[(0,d.jsx)(g.Label,{htmlFor:"saleNotes",children:"Notes"}),(0,d.jsx)(f.Input,{id:"saleNotes",name:"notes",value:H,onChange:I,placeholder:"Order notes (will appear on receipt)"})]})]})]})]),c()}catch(a){c(a)}},!1),795626,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(964889),g=a.i(224993),h=a.i(531811),i=a.i(396465),j=a.i(459502),k=a.i(397625),l=a.i(811705),m=a.i(330281),n=a.i(311988),o=a.i(886586),p=a.i(126741),q=a.i(704500),r=a.i(487416),s=a.i(688272),t=b([f,g,h,i,j,k,l,m,q,s]);[f,g,h,i,j,k,l,m,q,s]=t.then?(await t)():t,a.s(["default",0,({loading:a,isEditing:b,onCancel:c,onClearForm:t,printAfterSave:u,onPrintAfterSaveChange:v,thermalPrintAfterSave:w=!1,onThermalPrintAfterSaveChange:x,paymentStatus:y,includePaymentInfo:z,onIncludePaymentInfoChange:A,hasPendingPaymentChanges:B=!1,sendSMS:C=!1,onSendSMSChange:D,smsMessage:E="",onSMSMessageChange:F,customerName:G="",customerHasPhone:H=!1,disabled:I=!1})=>{let{user:J}=(0,h.useAuth)(),K=J?.id,{currentBusiness:L}=(0,f.useBusiness)(),{settings:M}=(0,g.useBusinessSettings)(),[N,O]=(0,e.useState)(!1),{templates:P=[],isLoading:Q}=(0,q.useMessages)(K),[R,S]=(0,e.useState)("");(0,e.useEffect)(()=>{(async()=>{let a=await (0,r.checkBridgeStatus)();O(a)})()},[]);let T="Thank you for your purchase from {business_name} We truly appreciate your support and trust in our Business. If you need any assistance or have any questions about your order, please feel free to reach out, on {business_number} We look forward to servingÂ youÂ again!",U=(a,b)=>{let c=a;return b&&(c=c.replace(/\{customer_name\}/gi,b).replace(/\{first_name\}/gi,b.split(" ")[0]||"").replace(/\{last_name\}/gi,b.split(" ").slice(1).join(" ")||"")),c=c.replace(/\{business_name\}/gi,L?.name||"[Business Name]").replace(/\{business_number\}/gi,M.businessPhone||"[Business Number]")},V=(0,e.useMemo)(()=>P.filter(a=>a.category&&"ThankYou"===String(a.category).trim()),[P]);(0,e.useEffect)(()=>{if(!C||!F)return;let a=T;if("default"===R)a=T;else if(R&&V.length>0){let b=V.find(a=>a.id===R);b&&(a=b.content)}else R||S("default");let b=U(a,G);F(b)},[C,G,V,R,F]);let W=E.length,X=Math.ceil(W/160)||1;return(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsx)(l.Card,{className:"border-gray-200",children:(0,d.jsxs)(l.CardContent,{className:"pt-6 space-y-4",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,d.jsx)(j.Checkbox,{id:"printAfterSave",checked:u,onCheckedChange:v}),(0,d.jsxs)(k.Label,{className:"text-sm",children:["Show receipt after ",b?"updating":"creating"," sale"]})]}),N&&x&&(0,d.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,d.jsx)(j.Checkbox,{id:"thermalPrintAfterSave",checked:w,onCheckedChange:x}),(0,d.jsxs)(k.Label,{className:"text-sm flex items-center gap-1.5 text-green-700 font-medium",children:[(0,d.jsx)(p.Printer,{className:"w-3.5 h-3.5"}),"Auto-print (Thermal Bridge)"]})]}),("Paid"===y||"Installment Sale"===y)&&(0,d.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,d.jsx)(j.Checkbox,{id:"includePaymentInfo",checked:z,onCheckedChange:A}),(0,d.jsx)(k.Label,{className:"text-sm",children:"Include payment information in receipt"})]})]})}),D&&F&&(0,d.jsx)(l.Card,{className:`border-blue-200 ${C?"bg-blue-50/50":"bg-gray-50"}`,children:(0,d.jsxs)(l.CardContent,{className:"pt-6 space-y-4",children:[(0,d.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,d.jsx)(j.Checkbox,{id:"sendSMS",checked:C,onCheckedChange:D,disabled:!H}),(0,d.jsxs)("div",{className:"flex-1",children:[(0,d.jsxs)(k.Label,{className:"text-base font-medium flex items-center gap-2",children:[(0,d.jsx)(o.MessageSquare,{className:"w-5 h-5 text-blue-600"}),"Send Thank You SMS"]}),!H&&(0,d.jsx)("p",{className:"text-xs text-amber-600 mt-1",children:"Customer phone number required to send SMS"})]})]}),C&&H&&(0,d.jsxs)("div",{className:"space-y-4 pl-8 border-l-4 border-blue-300 bg-blue-50/30 -m-4 p-4 rounded-r-lg",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)(k.Label,{className:"text-sm font-medium",children:"Template"}),Q?(0,d.jsxs)("div",{className:"text-sm text-gray-500 flex items-center gap-2 mt-1",children:[(0,d.jsx)(n.Loader2,{className:"w-4 h-4 animate-spin"}),"Loading templates..."]}):(0,d.jsxs)(s.Select,{value:R||"default",onValueChange:a=>{S(a);let b=T;if("default"===a)b=T;else{let c=V.find(b=>b.id===a);c&&(b=c.content)}let c=U(b,G);F?.(c)},children:[(0,d.jsx)(s.SelectTrigger,{className:"mt-1",children:(0,d.jsx)(s.SelectValue,{placeholder:"Choose a thank you template..."})}),(0,d.jsxs)(s.SelectContent,{children:[(0,d.jsx)(s.SelectItem,{value:"default",children:"Default Template"}),V.map(a=>(0,d.jsx)(s.SelectItem,{value:a.id,children:a.name},a.id))]})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)(k.Label,{className:"text-sm font-medium",children:"Message"}),(0,d.jsx)(m.Textarea,{value:E,onChange:a=>F?.(a.target.value),placeholder:"Your message will appear here...",rows:4,className:"mt-1 resize-none text-sm font-medium"}),(0,d.jsxs)("div",{className:"flex justify-between items-center mt-2 text-xs text-gray-600",children:[(0,d.jsxs)("span",{children:[W," characters"]}),(0,d.jsxs)("span",{className:"font-semibold text-blue-600",children:[X," SMS credit",X>1?"s":""," will be used"]})]})]})]})]})}),B&&(0,d.jsx)("div",{className:"text-sm text-amber-600 bg-amber-50 p-3 rounded border border-amber-200",children:"Pending payment changes will be applied when updating."}),(0,d.jsxs)("div",{className:"flex gap-4 pt-4",children:[(0,d.jsx)(i.Button,{type:"button",variant:"outline",onClick:c,disabled:a,className:"flex-1",children:"Cancel"}),!b&&t&&(0,d.jsx)(i.Button,{type:"button",variant:"outline",onClick:t,disabled:a,className:"flex-1",children:"Clear Form"}),(0,d.jsx)(i.Button,{type:"submit",disabled:a||I,className:"flex-1 bg-blue-600 hover:bg-blue-700",children:a?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),b?"Updating...":"Creating..."]}):b?"Update Sale":"Create Sale"})]})]})}]),c()}catch(a){c(a)}},!1),61885,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(25670),g=a.i(169320),h=a.i(483123),i=a.i(531811),j=a.i(808546),k=a.i(852741),l=a.i(224993),m=a.i(799338),n=a.i(466890),o=a.i(964889),p=a.i(149354),q=a.i(813286),r=a.i(830095),s=a.i(749260),t=a.i(142499),u=a.i(704500),v=a.i(500885),w=a.i(392240),x=a.i(595141),y=a.i(55180),z=a.i(973918),A=a.i(795626),B=b([g,i,j,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A]);[g,i,j,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A]=B.then?(await B)():B,a.s(["default",0,({initialData:a,onSaleComplete:b,currency:c="USD",customers:B=[],onAddNewCustomer:C,draftData:D,onClearDraft:E})=>{let F=(0,f.useRouter)();(0,f.useSearchParams)();let[G,H]=(0,e.useState)(!1),[I,J]=(0,e.useState)(a?.date||new Date),K=a?.paymentStatus||"Paid",{settings:L}=(0,l.useBusinessSettings)(),{user:M}=(0,i.useAuth)(),{updateInventoryForSale:N,updateInventoryForEditedSale:O}=(0,m.useSaleProductSelection)(M?.id),{accounts:P}=(0,n.useCashAccounts)(),{currentBusiness:Q}=(0,o.useBusiness)();(0,e.useEffect)(()=>{a&&(console.log("SalesForm initialData:",a),console.log("SalesForm initialData.categoryId:",a.categoryId),console.log("SalesForm initialData.notes:",a.notes))},[a]);let{saveDraft:R}=(0,p.useSaleDraft)(),{updateStockHistoryDatesBySaleId:S}=(0,t.useStockHistory)(M?.id),T=(0,e.useRef)(),U=(0,e.useRef)(!1),[V,W]=(0,e.useState)(!1),{createMessage:X,templates:Y=[]}=(0,u.useMessages)(M?.id),[Z,$]=(0,e.useState)(null),[_,aa]=(0,e.useState)(!0),[ab,ac]=(0,e.useState)("Thank you for your purchase from {business_name} We truly appreciate your support and trust in our Business. If you need any assistance or have any questions about your order, please feel free to reach out, on {business_number} We look forward to servingÂ youÂ again!"),{formData:ad,errors:ae,taxRateInput:af,printAfterSave:ag,thermalPrintAfterSave:ah,includePaymentInfo:ai,selectedCustomerCategoryId:aj,paymentDate:ak,linkToCash:al,selectedCashAccountId:am,cashTransactionId:an,originalPaymentStatus:ao,formRecentlyCleared:ap,payments:aq,pendingChanges:ar,hasChanges:as,setFormData:at,setTaxRateInput:au,setPrintAfterSave:av,setThermalPrintAfterSave:aw,setIncludePaymentInfo:ax,setLinkToCash:ay,setSelectedCashAccountId:az,setCashTransactionId:aA,setOriginalPaymentStatus:aB,handleChange:aC,handleSelectChange:aD,handleAddItem:aE,handleUpdateItem:aF,handleRemoveItem:aG,handleSelectCustomer:aH,handleCategoryChange:aI,handleSalesCategoryChange:aJ,handleAmountPaidChange:aK,handlePaymentDateChange:aL,calculateTotalAmount:aM,calculateTaxAmount:aN,validateForm:aO,processPendingPaymentChanges:aP,createInstallmentPayment:aQ,updateInstallmentPayment:aR,deleteInstallmentPayment:aS,addPaymentChange:aT,clearChanges:aU,getModifiedPayments:aV,clearForm:aW}=(0,q.useSaleFormLogic)({initialData:a,defaultPaymentStatus:K,cashAccounts:P}),{createCashTransactionForSale:aX,updateCashTransactionForSale:aY,createInstallmentPaymentWithCash:aZ,findCashTransactionForSale:a$}=(0,r.useCashTransactionOperations)(),{payments:a_,linkPaymentToCashAccount:a0,unlinkPaymentFromCashAccount:a1,updatePayment:a2}=(0,s.useInstallmentPayments)(a?.id),a3=async(a,b)=>{await a2(a,b)},[a4,a5]=(0,e.useState)(!1),a6=()=>{U.current=!0,aW&&aW(()=>J(new Date),E)};(0,e.useEffect)(()=>{U.current=!1});let a7=e.default.useCallback(()=>{!U.current&&!a&&!G&&!a4&&!ap&&(ad.customerName.trim()||ad.customerAddress.trim()||ad.customerContact.trim()||ad.items.some(a=>a.description.trim()||1!==a.quantity||0!==a.price))&&R(ad,I)},[ad,I,a,G,R,a4,ap]);(0,e.useEffect)(()=>(T.current&&clearTimeout(T.current),T.current=setTimeout(a7,2e3),()=>{T.current&&clearTimeout(T.current),a7()}),[a7]),(0,e.useEffect)(()=>{let a=()=>a7(),b=()=>document.hidden&&a7();return window.addEventListener("beforeunload",a),document.addEventListener("visibilitychange",b),()=>{window.removeEventListener("beforeunload",a),document.removeEventListener("visibilitychange",b)}},[a7]),(0,e.useEffect)(()=>{D&&!a&&(at(D.formData),J(D.selectedDate),au(D.formData.taxRate?.toString()||""))},[D,a,at,au]),(0,e.useEffect)(()=>{(async()=>{if(a?.cashTransactionId){ay(!0),aA(a.cashTransactionId);let b=await a$(a.cashTransactionId);b&&az(b)}if(P.length>0&&!am&&!a?.cashTransactionId){let a=P.find(a=>a.isDefault)||P[0];az(a.id)}})()},[a,P,a$,az]);let a8=async c=>{c.preventDefault();let d=aM(ad.items),e=aN(d),f=d+e;if(!aO(f,I))return void(ae.customerName?g.toast.error(ae.customerName):ae.taxRate?g.toast.error(ae.taxRate):g.toast.error("Please fill in all required fields correctly"));if(0===ad.items.length||ad.items.every(a=>!a.description.trim()))return void g.toast.error("Please add at least one valid item");H(!0);try{let c=a?.receiptNumber||await (0,j.generateReceiptNumber)(Q?.id||""),d=ad.items.reduce((a,b)=>{let c=b.price*b.quantity,d="amount"===b.discountType?b.discountAmount||0:c*(b.discountPercentage||0)/100,e=b.cost*b.quantity;return a+(c-d-e)},0),e=an;a&&(e=await aY({id:a.id,customerName:ad.customerName,receiptNumber:a.receiptNumber,items:ad.items},f,an,ao,ad.paymentStatus,al,am,I),aA(e));let i=(0,h.mapSaleToDbSale)(ad,I,d,c,M?.id||"",Q?.id||"",e),{success:l,data:m,error:n}=await (0,w.upsertSaleAction)(i,!!a,a?.id);if(!l||!m)throw Error(n||"Failed to save sale");let o={id:m.id,receiptNumber:m.receiptNumber,customerName:m.customerName,customerAddress:m.customerAddress||"",customerContact:m.customerContact||"",customerId:m.customerId||void 0,items:m.items,paymentStatus:m.paymentStatus,profit:m.profit,date:new Date(m.date),taxRate:m.taxRate?Number(m.taxRate):0,cashTransactionId:m.cashTransactionId||void 0,amountPaid:m.amountPaid?Number(m.amountPaid):void 0,amountDue:m.amountDue?Number(m.amountDue):void 0,notes:m.notes||"",categoryId:m.categoryId||void 0,createdAt:new Date(m.createdAt)};if(a)as&&await aP(),"Installment Sale"===ad.paymentStatus&&ad.amountPaid&&(await aQ({saleId:o.id,amount:ad.amountPaid,notes:o.items.map(a=>a.description).join(", "),paymentDate:ak,accountId:al?am:void 0,locationId:Q?.id}),at(a=>({...a,amountPaid:0}))),a.date.getTime()!==I.getTime()&&await S(o.id,I);else{let a=await aX(o,f,al,am,I,ad.paymentStatus);a&&(await (0,k.updateSaleCashTransactionAction)(o.id,a),o.cashTransactionId=a),"Installment Sale"===ad.paymentStatus&&ad.amountPaid&&await aZ(o.id,ad.amountPaid,o.items.map(a=>a.description).join(", "),al,am,Q?.id||"",aQ)}if(D&&E&&E(),b&&await b(o,ag,ai,aj,void 0,I,ah),g.toast.success(a?"Sale updated successfully!":"Sale recorded successfully!"),_&&ad.customerContact&&!a){let a=ad.items.map(a=>`â€¢ ${a.description} (Qty: ${a.quantity})`).join("\r\n"),b=ab.replace(/\{customer_name\}/gi,ad.customerName||"Valued Customer").replace(/\{receipt_number\}/gi,o.receiptNumber).replace(/\{items_list\}/gi,a).replace(/\{currency\}/gi,L.currency||"UGX").replace(/\{amount\}/gi,f.toLocaleString()).replace(/\{business_contact\}/gi,L.businessPhone||"our office").replace(/\{business_name\}/gi,Q?.name||"Our Business");try{await X({phoneNumber:ad.customerContact,content:b,customerId:B.find(a=>a.phoneNumber===ad.customerContact)?.id,metadata:{sale_id:o.id,receipt_number:o.receiptNumber,type:"thank_you"}}),g.toast.success("Thank you SMS sent successfully!")}catch(a){g.toast.error("Sale saved, but failed to send SMS: "+a.message)}}a5(!0),W(!0),a5(!0),W(!0),b||F.push("/sales")}catch(a){console.error("Error submitting sale:",a),W(!1),g.toast.error(a.message||"An error occurred. Please try again.")}finally{H(!1)}},a9=(0,e.useMemo)(()=>aM(ad.items),[ad.items]),ba=(0,e.useMemo)(()=>aN(a9),[a9,ad.taxRate]),bb=(0,e.useMemo)(()=>a9+ba,[a9,ba]),{data:bc=[]}=(0,v.useQuery)({queryKey:["all-products-for-scanner",M?.id,Q?.id],queryFn:async()=>M?.id&&Q?.id?(await (0,k.getProductsForBarcodeScannerAction)(Q.id)||[]).map(h.mapDbProductToProduct):[],enabled:!!M?.id&&!!Q?.id,staleTime:3e5}),bd=(0,e.useRef)(""),be=(0,e.useRef)(Date.now());return(0,e.useEffect)(()=>{let a=a=>{let b=a.target,c=Date.now(),d=c-be.current;if(be.current=c,"Shift"===a.key||"Control"===a.key||"Alt"===a.key||"Meta"===a.key)return;let e=/^[a-zA-Z0-9\-_]$/.test(a.key),f="INPUT"===b.tagName||"TEXTAREA"===b.tagName||"true"===b.contentEditable;if(!f&&e&&(a.preventDefault(),a.stopPropagation()),"Enter"===a.key){let b=bd.current.trim();if(b.length>=2){a.preventDefault(),a.stopPropagation(),console.log(`[Scanner] Processing: "${b}"`);let c=async a=>{let b=await (0,k.lookupProductByBarcodeAction)(a,Q?.id||"");return b?(0,h.mapDbProductToProduct)(b):null};(async()=>{let a=await c(b);if(a){let c=a.barcode||a.itemNumber||b;console.log(`[Scanner] âœ… Server Match: ${a.name}`),console.log(`[Scanner] ðŸ”— Mapping "${b}" -> System Code "${c}"`),aE(a),g.toast.success(`Scanned: ${a.name} (${c})`)}else console.warn(`[Scanner] âŒ No server match for: "${b}"`)})(),bd.current="";return}bd.current="",a.preventDefault(),a.stopPropagation();return}1===a.key.length&&(d<60&&f&&e&&(a.preventDefault(),a.stopPropagation()),d>100?bd.current=a.key:bd.current+=a.key)};return window.addEventListener("keydown",a,!0),()=>window.removeEventListener("keydown",a,!0)},[M?.id,Q?.id]),(0,d.jsxs)("form",{onSubmit:a8,className:"space-y-6",children:[(0,d.jsx)(x.default,{isEditing:!!a,selectedDate:I,onDateChange:J,customerName:ad.customerName,customerAddress:ad.customerAddress,customerContact:ad.customerContact,notes:ad.notes,onCustomerInfoChange:aC,errors:ae,customers:B,onAddNewCustomer:C,onSelectCustomer:aH,selectedCategoryId:aj,onCategoryChange:aI,onClearForm:a?void 0:a6}),(0,d.jsx)(y.default,{items:ad.items,onAddItem:aE,onUpdateItem:aF,onRemoveItem:aG,taxRateInput:af,onTaxRateChange:aC,errors:ae,totalAmount:a9,taxAmount:ba,grandTotal:bb,taxRate:ad.taxRate||0,currency:L.currency,saleDate:I.toISOString()}),(0,d.jsx)(z.default,{paymentStatus:ad.paymentStatus,onPaymentStatusChange:aD,isInstallmentSale:"Installment Sale"===ad.paymentStatus,amountPaid:ad.amountPaid||0,amountDue:ad.amountDue||0,grandTotal:bb,currency:L.currency,onAmountPaidChange:a=>aK(a,bb),onPaymentDateChange:aL,paymentDate:ak,saleId:a?.id,isEditing:!!a,payments:aV(aq),pendingChanges:ar,onStagePaymentChange:a?aT:void 0,linkToCash:al,onLinkToCashChange:ay,selectedCashAccountId:am,onCashAccountChange:az,cashAccounts:P,hasPaidWithHistory:"Paid"===ad.paymentStatus&&aq.length>0,onLinkPaymentToCash:(a,b)=>a0(a,b,Q?.id||""),onUpdatePayment:a3,onPaymentStatusChangeFromInstallment:async a=>aD(a),notes:ad.notes,onNotesChange:aC,categoryId:ad.categoryId||"",onCategoryChange:aJ}),(0,d.jsx)(A.default,{loading:G,isEditing:!!a,onCancel:()=>F.push("/sales"),onClearForm:a?void 0:a6,printAfterSave:ag,onPrintAfterSaveChange:av,thermalPrintAfterSave:ah,onThermalPrintAfterSaveChange:aw,paymentStatus:ad.paymentStatus,includePaymentInfo:ai,onIncludePaymentInfoChange:ax,hasPendingPaymentChanges:as,sendSMS:_,onSendSMSChange:aa,smsMessage:ab,onSMSMessageChange:ac,customerHasPhone:!!ad.customerContact,customerName:ad.customerName,disabled:V})]})}]),c()}catch(a){c(a)}},!1),489158,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(112779),g=a.i(397625),h=a.i(330281),i=a.i(396465),j=a.i(914619),k=a.i(393551),l=a.i(158799),m=a.i(688272),n=a.i(792071),o=a.i(899054),p=a.i(734637),q=a.i(799856),r=a.i(86352),s=a.i(109254),t=a.i(977759),u=b([f,g,h,i,k,l,m,o,q,r,s,t]);[f,g,h,i,k,l,m,o,q,r,s,t]=u.then?(await u)():u,a.s(["default",0,({initialData:a,onSubmit:b,onCancel:c})=>{let[u,v]=e.default.useState(!1),{categories:w}=(0,t.useCustomerCategories)(),[x,y]=e.default.useState(()=>{if(a?.birthday)return console.log("Initial birthday from props:",a.birthday),a.birthday}),[z,A]=e.default.useState(a?.categoryId||"none");e.default.useEffect(()=>{a?.birthday&&(console.log("Initial birthday from props:",a.birthday),console.log("Is Date object:",a.birthday instanceof Date),console.log("Date string:",a.birthday.toString()))},[a?.birthday]);let[B,C]=e.default.useState({facebook:a?.socialMedia?.facebook||"",instagram:a?.socialMedia?.instagram||"",twitter:a?.socialMedia?.twitter||"",linkedin:a?.socialMedia?.linkedin||"",other:a?.socialMedia?.other||""}),[D,E]=e.default.useState(a?.tags||[]),[F,G]=e.default.useState(""),[H,I]=e.default.useState(a?.gender||""),{register:J,handleSubmit:K,formState:{errors:L}}=(0,r.useForm)({defaultValues:{fullName:a?.fullName||"",email:a?.email||"",phoneNumber:a?.phoneNumber||"",location:a?.location||"",gender:a?.gender||"",notes:a?.notes||""}}),M=()=>{""===F.trim()||D.includes(F.trim())||(E([...D,F.trim()]),G(""))},N=(a,b)=>{C({...B,[b]:a.target.value})},O=async a=>{v(!0);try{console.log("Selected date before submission:",x);let c={...a,gender:H,birthday:x,categoryId:"none"===z?null:z,socialMedia:Object.keys(B).length>0?B:null,tags:D.length>0?D:null};console.log("Submitting customer data:",c),await b(c)}finally{v(!1)}},P=new Date().getFullYear(),Q=Array.from({length:100},(a,b)=>P-b),R=[{value:0,label:"January"},{value:1,label:"February"},{value:2,label:"March"},{value:3,label:"April"},{value:4,label:"May"},{value:5,label:"June"},{value:6,label:"July"},{value:7,label:"August"},{value:8,label:"September"},{value:9,label:"October"},{value:10,label:"November"},{value:11,label:"December"}],S=a=>{if(console.log("Date selected from calendar:",a),a){let b=a.getFullYear(),c=a.getMonth(),d=a.getDate(),e=new Date(Date.UTC(b,c,d,12,0,0));console.log("Corrected date with UTC noon:",e),y(e)}else y(void 0)},T=a=>{try{let b=parseInt(a),c=x?new Date(x):new Date,d=new Date(Date.UTC(b,c.getMonth(),c.getDate(),12,0,0));isNaN(d.getTime())?console.error("Invalid date after setting year:",a):(y(d),console.log("Year selected, new date:",d))}catch(a){console.error("Error setting year:",a)}},U=a=>{try{let b=parseInt(a),c=x?new Date(x):new Date,d=new Date(Date.UTC(c.getFullYear(),b,c.getDate(),12,0,0));isNaN(d.getTime())?console.error("Invalid date after setting month:",a):(y(d),console.log("Month selected, new date:",d))}catch(a){console.error("Error setting month:",a)}},V=w.filter(a=>a.id&&""!==a.id.trim());return(0,d.jsx)("form",{onSubmit:K(O),children:(0,d.jsxs)("div",{className:"space-y-6",children:[(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(g.Label,{htmlFor:"fullName",children:"Full Name*"}),(0,d.jsx)(f.Input,{id:"fullName",...J("fullName",{required:"Name is required"}),className:(0,q.cn)(L.fullName&&"border-red-500")}),L.fullName&&(0,d.jsx)("p",{className:"text-red-500 text-xs",children:L.fullName.message})]}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(g.Label,{htmlFor:"category",children:"Category"}),(0,d.jsxs)(m.Select,{value:z,onValueChange:A,children:[(0,d.jsx)(m.SelectTrigger,{id:"category",children:(0,d.jsx)(m.SelectValue,{placeholder:"Select category"})}),(0,d.jsxs)(m.SelectContent,{children:[(0,d.jsx)(m.SelectItem,{value:"none",children:"No Category"}),V.map(a=>(0,d.jsx)(m.SelectItem,{value:a.id,children:a.name},a.id))]})]})]}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(g.Label,{htmlFor:"email",children:"Email Address"}),(0,d.jsx)(f.Input,{id:"email",type:"email",...J("email",{pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Invalid email address"}}),className:(0,q.cn)(L.email&&"border-red-500")}),L.email&&(0,d.jsx)("p",{className:"text-red-500 text-xs",children:L.email.message})]}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(g.Label,{htmlFor:"phoneNumber",children:"Phone Number"}),(0,d.jsx)(f.Input,{id:"phoneNumber",...J("phoneNumber")})]}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(g.Label,{htmlFor:"location",children:"Location"}),(0,d.jsx)(f.Input,{id:"location",...J("location")})]}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(g.Label,{htmlFor:"gender",children:"Gender"}),(0,d.jsxs)(m.Select,{value:H,onValueChange:I,children:[(0,d.jsx)(m.SelectTrigger,{id:"gender",children:(0,d.jsx)(m.SelectValue,{placeholder:"Select gender"})}),(0,d.jsxs)(m.SelectContent,{children:[(0,d.jsx)(m.SelectItem,{value:"male",children:"Male"}),(0,d.jsx)(m.SelectItem,{value:"female",children:"Female"}),(0,d.jsx)(m.SelectItem,{value:"non-binary",children:"Non-binary"}),(0,d.jsx)(m.SelectItem,{value:"prefer-not-to-say",children:"Prefer not to say"})]})]})]}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(g.Label,{children:"Birthday"}),(0,d.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,d.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,d.jsx)("div",{className:"flex-1",children:(0,d.jsxs)(l.Popover,{children:[(0,d.jsx)(l.PopoverTrigger,{asChild:!0,children:(0,d.jsxs)(i.Button,{variant:"outline",className:"w-full justify-between",children:[x?x.getDate():"Day",(0,d.jsx)(j.Calendar,{className:"h-4 w-4 opacity-50"})]})}),(0,d.jsx)(l.PopoverContent,{className:"w-auto p-0",align:"start",children:(0,d.jsx)(k.Calendar,{mode:"single",selected:x,onSelect:S,initialFocus:!0,captionLayout:"buttons",className:"p-3 pointer-events-auto",classNames:{caption_label:"hidden",dropdown:"hidden"}})})]})}),(0,d.jsx)("div",{className:"flex-1",children:(0,d.jsxs)(m.Select,{value:x?String(x.getMonth()):void 0,onValueChange:U,children:[(0,d.jsx)(m.SelectTrigger,{children:(0,d.jsx)(m.SelectValue,{placeholder:"Month"})}),(0,d.jsx)(m.SelectContent,{children:R.map(a=>(0,d.jsx)(m.SelectItem,{value:String(a.value),children:a.label},a.value))})]})}),(0,d.jsx)("div",{className:"flex-1",children:(0,d.jsxs)(m.Select,{value:x?String(x.getFullYear()):void 0,onValueChange:T,children:[(0,d.jsx)(m.SelectTrigger,{children:(0,d.jsx)(m.SelectValue,{placeholder:"Year"})}),(0,d.jsx)(m.SelectContent,{children:Q.map(a=>(0,d.jsx)(m.SelectItem,{value:String(a),children:a},a))})]})})]}),x&&(0,d.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Selected: ",x?(0,n.format)(x,"PPP"):"No date selected"]})]})]})]}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(g.Label,{children:"Tags"}),(0,d.jsx)("div",{className:"flex flex-wrap gap-1 mb-2",children:D.map(a=>(0,d.jsxs)(o.Badge,{variant:"secondary",children:[a,(0,d.jsxs)("button",{type:"button",className:"ml-1 rounded-full hover:bg-gray-200",onClick:()=>{E(D.filter(b=>b!==a))},children:[(0,d.jsx)(p.X,{className:"h-3 w-3"}),(0,d.jsx)("span",{className:"sr-only",children:"Remove tag"})]})]},a))}),(0,d.jsxs)("div",{className:"flex gap-2",children:[(0,d.jsx)(f.Input,{value:F,onChange:a=>G(a.target.value),placeholder:"Add tag",onKeyDown:a=>"Enter"===a.key&&(a.preventDefault(),M())}),(0,d.jsx)(i.Button,{type:"button",onClick:M,variant:"outline",children:"Add"})]})]}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(g.Label,{children:"Social Media"}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,d.jsxs)("div",{className:"space-y-1",children:[(0,d.jsx)(g.Label,{htmlFor:"facebook",className:"text-xs",children:"Facebook"}),(0,d.jsx)(f.Input,{id:"facebook",value:B.facebook,onChange:a=>N(a,"facebook"),placeholder:"Username or URL"})]}),(0,d.jsxs)("div",{className:"space-y-1",children:[(0,d.jsx)(g.Label,{htmlFor:"instagram",className:"text-xs",children:"Instagram"}),(0,d.jsx)(f.Input,{id:"instagram",value:B.instagram,onChange:a=>N(a,"instagram"),placeholder:"Username without @"})]}),(0,d.jsxs)("div",{className:"space-y-1",children:[(0,d.jsx)(g.Label,{htmlFor:"twitter",className:"text-xs",children:"Twitter/X"}),(0,d.jsx)(f.Input,{id:"twitter",value:B.twitter,onChange:a=>N(a,"twitter"),placeholder:"Username without @"})]}),(0,d.jsxs)("div",{className:"space-y-1",children:[(0,d.jsx)(g.Label,{htmlFor:"linkedin",className:"text-xs",children:"LinkedIn"}),(0,d.jsx)(f.Input,{id:"linkedin",value:B.linkedin,onChange:a=>N(a,"linkedin"),placeholder:"Profile URL or username"})]})]})]}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(g.Label,{children:"Birthday"}),(0,d.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,d.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,d.jsx)("div",{className:"flex-1",children:(0,d.jsxs)(l.Popover,{children:[(0,d.jsx)(l.PopoverTrigger,{asChild:!0,children:(0,d.jsxs)(i.Button,{variant:"outline",className:"w-full justify-between",children:[x?x.getDate():"Day",(0,d.jsx)(j.Calendar,{className:"h-4 w-4 opacity-50"})]})}),(0,d.jsx)(l.PopoverContent,{className:"w-auto p-0",align:"start",children:(0,d.jsx)(k.Calendar,{mode:"single",selected:x,onSelect:S,initialFocus:!0,captionLayout:"buttons",className:"p-3 pointer-events-auto",classNames:{caption_label:"hidden",dropdown:"hidden"}})})]})}),(0,d.jsx)("div",{className:"flex-1",children:(0,d.jsxs)(m.Select,{value:x?String(x.getMonth()):void 0,onValueChange:U,children:[(0,d.jsx)(m.SelectTrigger,{children:(0,d.jsx)(m.SelectValue,{placeholder:"Month"})}),(0,d.jsx)(m.SelectContent,{children:R.map(a=>(0,d.jsx)(m.SelectItem,{value:String(a.value),children:a.label},a.value))})]})}),(0,d.jsx)("div",{className:"flex-1",children:(0,d.jsxs)(m.Select,{value:x?String(x.getFullYear()):void 0,onValueChange:T,children:[(0,d.jsx)(m.SelectTrigger,{children:(0,d.jsx)(m.SelectValue,{placeholder:"Year"})}),(0,d.jsx)(m.SelectContent,{children:Q.map(a=>(0,d.jsx)(m.SelectItem,{value:String(a),children:a},a))})]})})]}),x&&(0,d.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Selected: ",x?(0,n.format)(x,"PPP"):"No date selected"]})]})]}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(g.Label,{htmlFor:"notes",children:"Notes"}),(0,d.jsx)(h.Textarea,{id:"notes",...J("notes"),rows:4,placeholder:"Add any notes about this customer..."})]}),(0,d.jsxs)(s.DialogFooter,{children:[(0,d.jsx)(i.Button,{variant:"outline",type:"button",onClick:c,children:"Cancel"}),(0,d.jsx)(i.Button,{type:"submit",disabled:u,children:u?"Saving...":"Save Changes"})]})]})})}]),c()}catch(a){c(a)}},!1),221707,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(109254),f=a.i(489158),g=a.i(567326),h=b([e,f,g]);[e,f,g]=h.then?(await h)():h,a.s(["default",0,({open:a,onClose:b,onAddCustomer:c,initialData:h})=>{let i=async a=>(c(a),!0),j=!!h;return(0,d.jsx)(e.Dialog,{open:a,onOpenChange:b,children:(0,d.jsxs)(e.DialogContent,{className:"max-w-2xl max-h-[90vh]",children:[(0,d.jsxs)(e.DialogHeader,{children:[(0,d.jsx)(e.DialogTitle,{children:j?"Edit Customer":"Add New Customer"}),(0,d.jsx)(e.DialogDescription,{children:"Fill in the customer details below. Only name is required."})]}),(0,d.jsx)(g.ScrollArea,{className:"h-[calc(80vh-8rem)]",children:(0,d.jsx)("div",{className:"px-1",children:(0,d.jsx)(f.default,{onSubmit:i,onCancel:b,initialData:h})})})]})})}]),c()}catch(a){c(a)}},!1),179276,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(289118),f=a.i(396465),g=a.i(199987),h=a.i(734637),i=b([e,f]);[e,f]=i.then?(await i)():i,a.s(["default",0,({onLoadDraft:a,onDismiss:b,savedAt:c})=>(0,d.jsxs)(e.Alert,{className:"mb-4 border-blue-200 bg-blue-50",children:[(0,d.jsx)(g.FileText,{className:"h-4 w-4 text-blue-600"}),(0,d.jsxs)(e.AlertDescription,{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"flex-1",children:[(0,d.jsx)("span",{className:"text-blue-800 font-medium",children:"Draft found!"}),(0,d.jsxs)("span",{className:"text-blue-700 ml-2",children:["Saved on ",c.toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),(0,d.jsxs)("div",{className:"flex gap-2 ml-4",children:[(0,d.jsx)(f.Button,{size:"sm",onClick:a,className:"bg-blue-600 hover:bg-blue-700 text-white",children:"Load Draft"}),(0,d.jsx)(f.Button,{size:"sm",variant:"ghost",onClick:b,className:"text-blue-600 hover:text-blue-700 hover:bg-blue-100",children:(0,d.jsx)(h.X,{className:"h-4 w-4"})})]})]})]})]),c()}catch(a){c(a)}},!1),940054,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(61885),f=a.i(800735),g=a.i(221707),h=a.i(179276),i=b([e,f,g,h]);[e,f,g,h]=i.then?(await i)():i,a.s(["default",0,({editSale:a,currency:b,showDraftNotification:c,draftData:i,onLoadDraft:j,onDismissDraft:k,onSaleComplete:l,onClearDraft:m,customers:n,onAddNewCustomer:o,isReceiptOpen:p,completedSale:q,includePaymentInfo:r,onReceiptClose:s,newCustomerDialogOpen:t,onCloseNewCustomerDialog:u,onAddCustomer:v})=>(0,d.jsxs)(d.Fragment,{children:[c&&i&&(0,d.jsx)(h.default,{onLoadDraft:j,onDismiss:k,savedAt:i.savedAt}),(0,d.jsx)(e.default,{initialData:a,onSaleComplete:l,currency:b,customers:n,onAddNewCustomer:o,draftData:i,onClearDraft:m}),(0,d.jsx)(f.default,{isOpen:p,sale:q,currency:b,onOpenChange:s,includePaymentInfo:r}),(0,d.jsx)(g.default,{open:t,onClose:u,onAddCustomer:v})]})]),c()}catch(a){c(a)}},!1),51614,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(747899),g=a.i(531811),h=a.i(224993),i=a.i(964889),j=a.i(938664),k=a.i(497172),l=a.i(877377),m=a.i(640427),n=a.i(480716),o=a.i(940054),p=a.i(805297),q=a.i(436028),r=a.i(289118),s=a.i(396465),t=b([g,h,i,j,k,o,p,r,s]);[g,h,i,j,k,o,p,r,s]=t.then?(await t)():t,a.s(["default",0,()=>{let a=(0,f.useNavigate)(),b=(0,f.useLocation)(),{user:c}=(0,g.useAuth)(),{settings:t}=(0,h.useBusinessSettings)(),{currentBusiness:u,isLoading:v}=(0,i.useBusiness)(),{hasPermission:w,isLoading:x}=(0,p.useProfiles)(),y=b.state?.editSale,[z,A]=e.default.useState(0),B=e.default.useCallback(()=>{A(a=>a+1)},[]),{showDraftNotification:C,draftData:D,handleLoadDraft:E,handleDismissDraft:F,clearDraft:G}=(0,j.useNewSaleDraft)(y),{isReceiptOpen:H,completedSale:I,newCustomerDialogOpen:J,includePaymentInfo:K,customers:L,handleSaleComplete:M,handleReceiptClose:N,handleAddCustomer:O,handleOpenNewCustomerDialog:P,setNewCustomerDialogOpen:Q}=(0,k.useNewSaleActions)(y,B);if(v||x)return(0,d.jsx)(l.default,{});if(!u)return(0,d.jsx)(m.default,{});let R=!y||w("sales","edit"),S=!!y||w("sales","create");return R&&S?(0,d.jsxs)("div",{className:"max-w-4xl mx-auto",children:[!c&&(0,d.jsx)(n.default,{}),(0,d.jsx)(o.default,{editSale:y,currency:t.currency,showDraftNotification:C,draftData:D,onLoadDraft:E,onDismissDraft:F,onSaleComplete:(a,b,c,d,e,f,g)=>M(a,b,c,d,G||e,f,g),onClearDraft:G,customers:L||[],onAddNewCustomer:P,isReceiptOpen:H,completedSale:I,includePaymentInfo:K,onReceiptClose:N,newCustomerDialogOpen:J,onCloseNewCustomerDialog:()=>Q(!1),onAddCustomer:O},z)]}):(0,d.jsxs)("div",{className:"max-w-4xl mx-auto p-6",children:[(0,d.jsxs)(r.Alert,{variant:"destructive",children:[(0,d.jsx)(q.AlertCircle,{className:"h-4 w-4"}),(0,d.jsx)(r.AlertTitle,{children:"Access Denied"}),(0,d.jsxs)(r.AlertDescription,{children:["You do not have permission to ",y?"edit this sale":"create a new sale",". Please contact your administrator if you believe this is an error."]})]}),(0,d.jsx)("div",{className:"mt-4",children:(0,d.jsx)(s.Button,{onClick:()=>a("/sales"),variant:"outline",children:"Back to Sales"})})]})}]),c()}catch(a){c(a)}},!1),782112,a=>a.a(async(b,c)=>{try{var d=a.i(579168),e=a.i(627068),f=a.i(332759),g=a.i(539141),h=a.i(706555),i=a.i(51614),j=a.i(509193),k=b([i]);[i]=k.then?(await k)():k;let l=(0,f.hoist)(i,"default"),m=(0,f.hoist)(i,"getStaticProps"),n=(0,f.hoist)(i,"getStaticPaths"),o=(0,f.hoist)(i,"getServerSideProps"),p=(0,f.hoist)(i,"config"),q=(0,f.hoist)(i,"reportWebVitals"),r=(0,f.hoist)(i,"unstable_getStaticProps"),s=(0,f.hoist)(i,"unstable_getStaticPaths"),t=(0,f.hoist)(i,"unstable_getStaticParams"),u=(0,f.hoist)(i,"unstable_getServerProps"),v=(0,f.hoist)(i,"unstable_getServerSideProps"),w=new d.PagesRouteModule({definition:{kind:e.RouteKind.PAGES,page:"/NewSale",pathname:"/NewSale",bundlePath:"",filename:""},distDir:".next",relativeProjectDir:"",components:{App:h.default,Document:g.default},userland:i}),x=(0,j.getHandler)({srcPage:"/NewSale",config:p,userland:i,routeModule:w,getStaticPaths:n,getStaticProps:m,getServerSideProps:o});a.s(["config",0,p,"default",0,l,"getServerSideProps",0,o,"getStaticPaths",0,n,"getStaticProps",0,m,"handler",0,x,"reportWebVitals",0,q,"routeModule",0,w,"unstable_getServerProps",0,u,"unstable_getServerSideProps",0,v,"unstable_getStaticParams",0,t,"unstable_getStaticPaths",0,s,"unstable_getStaticProps",0,r]),c()}catch(a){c(a)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__474266e8._.js.map