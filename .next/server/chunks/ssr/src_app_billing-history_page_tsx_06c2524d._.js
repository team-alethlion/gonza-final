module.exports=[831846,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(284415),e=a.i(433217),f=a.i(405050);let g=(0,f.createServerReference)("40ba16ec3b325b2283f3e465df8c454e2cd68b45a2",f.callServer,void 0,f.findSourceMapURL,"getSubscriptionPaymentsAction"),h=(0,f.createServerReference)("7cf9757e320c46f955c6d99f3b8c16f72db910a81d",f.callServer,void 0,f.findSourceMapURL,"initiateSubscriptionPaymentAction");var i=a.i(911156),j=a.i(941675),k=a.i(641710),l=a.i(167453),m=a.i(292e3),n=a.i(284505),o=a.i(501199),p=a.i(104720),q=a.i(256711),r=a.i(368114),s=a.i(391956),t=a.i(169819),u=a.i(699981),v=a.i(371844);function w(){let{user:a}=(0,s.useAuth)(),{currentBusiness:f}=(0,t.useBusiness)(),[w,y]=c.default.useState(!1),[z,A]=c.default.useState(null),{daysRemaining:B,billingAmount:C,billingDuration:D,nextBillingDate:E,isFrozen:F,isLoading:G,refetch:H}=(0,d.useOnboarding)(),{data:I,isLoading:J}=(0,e.useQuery)({queryKey:["subscription-payments",a?.id],queryFn:async()=>a?.id?await g(a.id):[],enabled:!!a}),K=c.default.useMemo(()=>I?I.map((a,b)=>({...a,invoice_number:b+1,business_name:f?.name||"Gonzo System User"})).sort((a,b)=>new Date(b.created_at).getTime()-new Date(a.created_at).getTime()):[],[I,f]),L=async(a,b="invoice")=>{await (0,u.generateSubscriptionInvoice)(a,b)},M=async()=>{if(a&&C){y(!0);try{crypto.randomUUID();let b=f?.id||a.location_id||"00000000-0000-0000-0000-000000000000",c=a.user_metadata?.phone||a.phone||"0700000000",d=await h(a.id,b,C,D||"monthly",c);if(!d.success)throw Error(d.error);d.redirect_url&&A(d.redirect_url)}catch(b){console.error("Subscription Renewal Error:",b);let a=b.message||b.error||"Failed to connect to Pesapal.";alert(`Payment Error: ${a}. Please try again later.`)}finally{y(!1)}}},N=async()=>{if(!E||!C)return;let b={id:`PRO-FORMA-${(0,q.format)(new Date,"yyyyMMdd")}`,created_at:new Date().toISOString(),due_date:E,amount:C,billing_cycle:D||"Monthly",payment_status:"pending",user_id:a?.id,isProForma:!0,business_name:f?.name||"Gonzo System User",invoice_number:(K?.length||0)+1};await (0,u.generateSubscriptionInvoice)(b,"invoice")};return G||J?(0,b.jsx)("div",{className:"flex flex-col items-center justify-center min-h-[60vh]",children:(0,b.jsx)(v.default,{message:"Loading billing data..."})}):(0,b.jsxs)("div",{className:"p-6 lg:p-10 max-w-7xl mx-auto space-y-10 animate-in fade-in slide-in-from-bottom-4 duration-700",children:[z&&(0,b.jsxs)("div",{className:"fixed inset-0 z-[100] bg-background/80 backdrop-blur-sm flex flex-col items-center justify-center p-4",children:[(0,b.jsxs)("div",{className:"w-full max-w-4xl h-[85vh] bg-white rounded-2xl shadow-2xl border border-border/40 overflow-hidden relative flex flex-col scale-in-center",children:[(0,b.jsxs)("div",{className:"p-4 border-b border-border/40 flex items-center justify-between bg-white",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-8 h-8 rounded-lg bg-blue-50 flex items-center justify-center",children:(0,b.jsx)(i.CreditCard,{className:"w-4 h-4 text-blue-600"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-sm font-bold uppercase tracking-wider",children:"Secure Payment"}),(0,b.jsx)("p",{className:"text-[10px] text-muted-foreground font-mono italic",children:"Powered by Pesapal"})]})]}),(0,b.jsx)("button",{onClick:()=>{A(null),H()},className:"px-4 py-2 text-[10px] font-bold uppercase tracking-widest text-muted-foreground hover:text-red-600 hover:bg-red-50 rounded-lg transition-all",children:"Close & Sync"})]}),(0,b.jsx)("iframe",{src:z,className:"w-full flex-1 border-none",title:"Pesapal Payment"})]}),(0,b.jsx)("p",{className:"mt-4 text-[10px] text-muted-foreground uppercase tracking-[0.2em] font-medium opacity-60",children:"Do not close this window until the payment is complete"})]}),(0,b.jsxs)("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold tracking-tight text-foreground",children:"Billing & Subscription"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-1 text-sm",children:"Manage your plan, track payments, and download invoices."})]}),(0,b.jsxs)("div",{className:"flex items-center flex-wrap gap-3",children:[(0,b.jsxs)("button",{onClick:M,disabled:w,className:"px-6 py-2.5 bg-blue-600 text-white rounded-xl text-[11px] font-bold uppercase tracking-widest hover:bg-blue-700 transition-all flex items-center gap-2 shadow-lg shadow-blue-200 disabled:opacity-50",children:[w?(0,b.jsx)("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):(0,b.jsx)(i.CreditCard,{className:"w-4 h-4"}),"Renew / Pay Now"]}),(0,b.jsxs)("button",{onClick:N,className:"px-4 py-2.5 bg-slate-100 text-slate-700 border border-slate-200 rounded-xl text-[11px] font-bold uppercase tracking-widest hover:bg-slate-200 transition-all flex items-center gap-2",children:[(0,b.jsx)(p.FileText,{className:"w-4 h-4"}),"Upcoming Invoice"]}),(0,b.jsxs)("div",{className:(0,r.cn)("px-4 py-2.5 rounded-xl border text-[11px] font-bold uppercase tracking-widest flex items-center gap-2 w-fit",F||B<=0?"text-red-600 bg-red-50 border-red-100":B<=7?"text-amber-600 bg-amber-50 border-amber-100":"text-emerald-600 bg-emerald-50 border-emerald-100"),children:[F||B<=0?(0,b.jsx)(m.AlertCircle,{className:"w-3.5 h-3.5"}):(0,b.jsx)(l.CheckCircle2,{className:"w-3.5 h-3.5"}),F?"Account Paused":B<=0?"Expired":B<=7?"Expiring Soon":"Active"]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,b.jsxs)("div",{className:"bg-white border border-border/40 rounded-2xl p-6 shadow-sm hover:shadow-md transition-shadow group",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,b.jsx)("div",{className:"w-10 h-10 rounded-xl bg-primary/5 flex items-center justify-center group-hover:scale-110 transition-transform",children:(0,b.jsx)(o.Receipt,{className:"w-5 h-5 text-primary"})}),(0,b.jsx)("span",{className:"text-[10px] font-bold uppercase tracking-widest text-muted-foreground",children:"Current Plan"})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsxs)("h3",{className:"text-2xl font-bold",children:["UGX ",C?.toLocaleString()]}),(0,b.jsx)("p",{className:"text-sm font-medium text-muted-foreground uppercase tracking-wider",children:D})]})]}),(0,b.jsxs)("div",{className:"bg-white border border-border/40 rounded-2xl p-6 shadow-sm hover:shadow-md transition-shadow group",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,b.jsx)("div",{className:"w-10 h-10 rounded-xl bg-orange-50 flex items-center justify-center group-hover:scale-110 transition-transform",children:(0,b.jsx)(k.Clock,{className:"w-5 h-5 text-orange-600"})}),(0,b.jsx)("span",{className:"text-[10px] font-bold uppercase tracking-widest text-muted-foreground",children:"Days Remaining"})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsxs)("h3",{className:(0,r.cn)("text-2xl font-bold",B<=7?"text-orange-600":"text-foreground"),children:[B<=0?"0":B," Days"]}),(0,b.jsx)("p",{className:"text-sm font-medium text-muted-foreground uppercase tracking-wider",children:"Left on Subscription"})]})]}),(0,b.jsxs)("div",{className:"bg-white border border-border/40 rounded-2xl p-6 shadow-sm hover:shadow-md transition-shadow group",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,b.jsx)("div",{className:"w-10 h-10 rounded-xl bg-blue-50 flex items-center justify-center group-hover:scale-110 transition-transform",children:(0,b.jsx)(j.Calendar,{className:"w-5 h-5 text-blue-600"})}),(0,b.jsx)("span",{className:"text-[10px] font-bold uppercase tracking-widest text-muted-foreground",children:"Next Billing"})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("h3",{className:"text-2xl font-bold",children:E?(0,q.format)(new Date(E),"MMM dd, yyyy"):"No Date Set"}),(0,b.jsx)("p",{className:"text-sm font-medium text-muted-foreground uppercase tracking-wider",children:"Scheduled Renewal"})]})]})]}),(0,b.jsxs)("div",{className:"bg-white border border-border/40 rounded-2xl overflow-hidden shadow-sm",children:[(0,b.jsxs)("div",{className:"p-6 border-b border-border/40 bg-muted/5 flex items-center justify-between",children:[(0,b.jsxs)("h3",{className:"text-sm font-bold uppercase tracking-widest flex items-center gap-2",children:[(0,b.jsx)(x,{className:"w-4 h-4 text-muted-foreground"}),"Payment History"]}),(0,b.jsx)("div",{className:"text-[10px] font-bold text-emerald-600 bg-emerald-50 px-2 py-0.5 rounded-full border border-emerald-100 tracking-tighter uppercase",children:"Finalized Payments"})]}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full text-left border-collapse",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"bg-muted/10 h-12",children:[(0,b.jsx)("th",{className:"px-6 text-[10px] font-bold text-muted-foreground uppercase tracking-widest",children:"Date"}),(0,b.jsx)("th",{className:"px-6 text-[10px] font-bold text-muted-foreground uppercase tracking-widest",children:"Description"}),(0,b.jsx)("th",{className:"px-6 text-right text-[10px] font-bold text-muted-foreground uppercase tracking-widest",children:"Amount"}),(0,b.jsx)("th",{className:"px-6 text-center text-[10px] font-bold text-muted-foreground uppercase tracking-widest",children:"Status"}),(0,b.jsx)("th",{className:"px-6 text-right text-[10px] font-bold text-muted-foreground uppercase tracking-widest",children:"Action"})]})}),(0,b.jsx)("tbody",{className:"divide-y divide-border/20",children:K&&K.length>0?K.map(a=>(0,b.jsxs)("tr",{className:"h-16 hover:bg-muted/5 transition-colors group",children:[(0,b.jsx)("td",{className:"px-6 py-4",children:(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"text-[13px] font-bold",children:(0,q.format)(new Date(a.created_at),"MMM dd, yyyy")}),(0,b.jsx)("span",{className:"text-[10px] text-muted-foreground font-mono",children:a.id.split("-")[0].toUpperCase()})]})}),(0,b.jsx)("td",{className:"px-6 py-4",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(i.CreditCard,{className:"w-3.5 h-3.5 text-muted-foreground"}),(0,b.jsxs)("span",{className:"text-[13px] font-medium text-foreground",children:[a.billing_cycle," Subscription Renewal"]})]})}),(0,b.jsx)("td",{className:"px-6 py-4 text-right",children:(0,b.jsxs)("span",{className:"text-[13px] font-bold",children:["UGX ",a.amount.toLocaleString()]})}),(0,b.jsx)("td",{className:"px-6 py-4",children:(0,b.jsx)("div",{className:"flex justify-center",children:(0,b.jsx)("span",{className:(0,r.cn)("px-2.5 py-1 rounded-md text-[9px] font-bold uppercase tracking-tight border","completed"===a.payment_status||"success"===a.payment_status?"bg-emerald-50 text-emerald-600 border-emerald-100":"pending"===a.payment_status?"bg-amber-50 text-amber-600 border-amber-100":"bg-red-50 text-red-600 border-red-100"),children:a.payment_status})})}),(0,b.jsx)("td",{className:"px-6 py-4 text-right",children:(0,b.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,b.jsxs)("button",{onClick:()=>L(a,"invoice"),className:"p-2 hover:bg-primary/5 rounded-lg text-primary transition-colors inline-flex items-center gap-2 text-[11px] font-bold uppercase tracking-widest",title:"Download Invoice",children:[(0,b.jsx)(p.FileText,{className:"w-3.5 h-3.5"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"Invoice"})]}),(0,b.jsxs)("button",{onClick:()=>L(a,"receipt"),className:"p-2 hover:bg-emerald-50 rounded-lg text-emerald-600 transition-colors inline-flex items-center gap-2 text-[11px] font-bold uppercase tracking-widest",title:"Download Receipt",children:[(0,b.jsx)(n.Download,{className:"w-3.5 h-3.5"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"Receipt"})]})]})})]},a.id)):(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:5,className:"py-20 text-center",children:(0,b.jsxs)("div",{className:"flex flex-col items-center gap-3",children:[(0,b.jsx)("div",{className:"w-12 h-12 rounded-full bg-muted/20 flex items-center justify-center",children:(0,b.jsx)(o.Receipt,{className:"w-6 h-6 text-muted-foreground/30"})}),(0,b.jsx)("p",{className:"text-xs font-bold text-muted-foreground uppercase tracking-widest",children:"No transaction history found"})]})})})})]})})]}),(0,b.jsxs)("div",{className:"bg-blue-600 rounded-2xl p-8 lg:p-10 text-white relative overflow-hidden group",children:[(0,b.jsx)("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full -mr-32 -mt-32 blur-3xl group-hover:scale-110 transition-transform duration-700"}),(0,b.jsxs)("div",{className:"relative z-10 flex flex-col md:flex-row items-center justify-between gap-8",children:[(0,b.jsxs)("div",{className:"max-w-md text-center md:text-left",children:[(0,b.jsx)("h3",{className:"text-xl font-bold mb-2",children:"Need a custom plan or help?"}),(0,b.jsx)("p",{className:"text-blue-100 text-sm",children:"Our team is here to help you scale your business with the right tools and support."})]}),(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row items-center gap-4",children:[(0,b.jsx)("a",{href:"mailto:support@gonzasystems.com",className:"px-6 py-3 bg-white text-blue-600 rounded-xl text-[11px] font-bold uppercase tracking-widest hover:bg-blue-50 transition-colors shadow-lg",children:"Contact Support"}),(0,b.jsx)("a",{href:"tel:+256758519696",className:"px-6 py-3 bg-blue-500 text-white border border-blue-400 rounded-xl text-[11px] font-bold uppercase tracking-widest hover:bg-blue-400 transition-colors",children:"Call +256 758519696"})]})]})]})]})}function x({className:a}){return(0,b.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:a,children:[(0,b.jsx)("path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}),(0,b.jsx)("path",{d:"M3 3v5h5"}),(0,b.jsx)("path",{d:"M12 7v5l4 2"})]})}a.s(["default",()=>w],831846)}];

//# sourceMappingURL=src_app_billing-history_page_tsx_06c2524d._.js.map