{"version":3,"sources":["../../../../src/utils/generateStatementPDF.ts"],"sourcesContent":["\r\n\r\n\r\nexport interface StatementPDFOptions {\r\n  filename: string;\r\n  orientation?: 'portrait' | 'landscape';\r\n  format?: 'a4' | 'letter';\r\n  margins?: {\r\n    top: number;\r\n    right: number;\r\n    bottom: number;\r\n    left: number;\r\n  };\r\n  currency?: string;\r\n  customerName?: string;\r\n  businessName?: string;\r\n  businessAddress?: string;\r\n  businessPhone?: string;\r\n  businessEmail?: string;\r\n}\r\n\r\nexport interface StatementRow {\r\n  date: string;\r\n  details: string;\r\n  amount: number;\r\n  paid: number;\r\n  balance: number;\r\n}\r\n\r\n// Helper to format date as 'Nov 24th, 2025'\r\nfunction formatFriendlyDate(dateStr: string) {\r\n  const date = new Date(dateStr);\r\n  const months = [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"];\r\n  const day = date.getDate();\r\n  const daySuffix = (d: number) => {\r\n    if (d >= 11 && d <= 13) return 'th';\r\n    switch (d % 10) {\r\n      case 1: return 'st';\r\n      case 2: return 'nd';\r\n      case 3: return 'rd';\r\n      default: return 'th';\r\n    }\r\n  };\r\n  return `${months[date.getMonth()]} ${day}${daySuffix(day)}, ${date.getFullYear()}`;\r\n}\r\n\r\nexport const generateStatementPDF = async (\r\n  rows: StatementRow[],\r\n  options: StatementPDFOptions\r\n): Promise<void> => {\r\n\r\n  const {\r\n    filename,\r\n    orientation = 'portrait',\r\n    format = 'a4',\r\n    margins = { top: 15, right: 15, bottom: 15, left: 15 },\r\n    currency = '',\r\n    customerName = ''\r\n  } = options;\r\n\r\n  // Dynamically import jsPDF to avoid ReferenceError\r\n  const { jsPDF } = await import('jspdf');\r\n  const pdf = new jsPDF({ orientation, unit: 'mm', format, compress: true });\r\n  const pageWidth = pdf.internal.pageSize.getWidth();\r\n  const pageHeight = pdf.internal.pageSize.getHeight();\r\n  const contentWidth = pageWidth - margins.left - margins.right;\r\n  let y = margins.top;\r\n\r\n  // Header\r\n\r\n  pdf.setFontSize(14);\r\n  pdf.setTextColor(40, 53, 149);\r\n  pdf.text('Customer Statement', margins.left, y);\r\n  pdf.setFontSize(10);\r\n  pdf.setTextColor(60, 60, 60);\r\n  pdf.text(`Customer: ${customerName}`, margins.left, y + 6);\r\n  pdf.text(`Date: ${new Date().toLocaleDateString()}`, pageWidth - margins.right - 40, y + 6);\r\n  y += 14;\r\n\r\n  // Table header\r\n  pdf.setFontSize(11);\r\n  pdf.setTextColor(40, 53, 149);\r\n  const headers = ['Date', 'Details (Receipt/Invoice)', `Amount ${currency}`, `Balance ${currency}`];\r\n  const colWidths = [30, 85, 30, 30];\r\n  let x = margins.left;\r\n  headers.forEach((header, i) => {\r\n    pdf.text(header, x + 2, y);\r\n    x += colWidths[i];\r\n  });\r\n  y += 6;\r\n  pdf.setDrawColor(200, 200, 200);\r\n  pdf.line(margins.left, y, pageWidth - margins.right, y);\r\n  y += 2;\r\n\r\n  // Table rows\r\n  pdf.setFontSize(10);\r\n  pdf.setTextColor(30, 30, 30);\r\n  let totalAmountRowValue = 0, totalBalance = 0;\r\n  rows.forEach((row, idx) => {\r\n    x = margins.left;\r\n    pdf.setFillColor(idx % 2 === 0 ? 255 : 245, idx % 2 === 0 ? 255 : 248, idx % 2 === 0 ? 255 : 255);\r\n    pdf.rect(x, y - 4, contentWidth, 10, 'F');\r\n    pdf.text(formatFriendlyDate(row.date), x + 2, y + 2);\r\n    x += colWidths[0];\r\n    pdf.text(row.details, x + 2, y + 2, { maxWidth: colWidths[1] - 4 });\r\n    x += colWidths[1];\r\n\r\n    const isPayment = row.amount < 0;\r\n    if (isPayment) {\r\n      pdf.setTextColor(0, 128, 0); // Green for payments\r\n      pdf.text(`- ${Math.abs(row.amount).toLocaleString()}`, x + colWidths[2] - 2, y + 2, { align: 'right' });\r\n    } else {\r\n      pdf.setTextColor(30, 30, 30);\r\n      pdf.text(`${row.amount.toLocaleString()}`, x + colWidths[2] - 2, y + 2, { align: 'right' });\r\n    }\r\n\r\n    x += colWidths[2];\r\n    pdf.setTextColor(30, 30, 30);\r\n    pdf.setFont('helvetica', 'bold');\r\n    pdf.text(`${row.balance.toLocaleString()}`, x + colWidths[3] - 2, y + 2, { align: 'right' });\r\n    pdf.setFont('helvetica', 'normal');\r\n\r\n    totalAmountRowValue += row.amount;\r\n    totalBalance = row.balance; // Last row's balance is the final balance\r\n    y += 10;\r\n\r\n    // Reset text color for next row\r\n    pdf.setTextColor(30, 30, 30);\r\n\r\n    // Page break if needed\r\n    if (y > pageHeight - margins.bottom - 20) {\r\n      pdf.addPage();\r\n      y = margins.top;\r\n\r\n      // Re-draw header on new page? (Simple version, just continue)\r\n    }\r\n  });\r\n\r\n  // Table footer (totals)\r\n  pdf.setFontSize(11);\r\n  pdf.setTextColor(40, 53, 149);\r\n  x = margins.left;\r\n  pdf.setFillColor(230, 240, 255);\r\n  pdf.rect(x, y - 4, contentWidth, 7, 'F');\r\n  pdf.text(`FINAL BALANCE ${currency}`, x + colWidths[0] + colWidths[1] - 2, y, { align: 'right' });\r\n  x += colWidths[0] + colWidths[1];\r\n\r\n  // Empty space for \"Amount\" column in footer or show net?\r\n  x += colWidths[2];\r\n\r\n  pdf.setFont('helvetica', 'bold');\r\n  pdf.text(`${totalBalance.toLocaleString()}`, x + colWidths[3] - 2, y, { align: 'right' });\r\n  pdf.setFont('helvetica', 'normal');\r\n  y += 10;\r\n\r\n  // Footer\r\n  pdf.setFontSize(10);\r\n  pdf.setTextColor(120, 120, 120);\r\n  pdf.text('Thank you for your business!', margins.left, pageHeight - margins.bottom - 8);\r\n  pdf.setFontSize(8);\r\n  pdf.setTextColor(150, 150, 150);\r\n  pdf.text('Generated by Gonza System', pageWidth / 2, pageHeight - 8, { align: 'center' });\r\n\r\n  pdf.save(filename);\r\n};\r\n"],"names":[],"mappings":"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"}