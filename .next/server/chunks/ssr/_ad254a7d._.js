module.exports=[349774,a=>{"use strict";var b=a.i(391956);a.s(["useCurrentUser",0,()=>{let{user:a}=(0,b.useAuth)();return{userId:a?.id}}])},104720,a=>{"use strict";let b=(0,a.i(170106).default)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);a.s(["FileText",()=>b],104720)},429246,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(368114);let e=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("textarea",{className:(0,d.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:e,...c}));e.displayName="Textarea",a.s(["Textarea",()=>e])},866102,a=>{"use strict";var b=a.i(572131),c=a.i(433217),d=a.i(478793),e=a.i(169819),f=a.i(405050);let g=(0,f.createServerReference)("40290a4fc6b8571a026afeb877566edb807919e482",f.callServer,void 0,f.findSourceMapURL,"getBusinessSettingsAction");var h=a.i(682242);let i=()=>({businessName:"",businessAddress:"",businessPhone:"",businessEmail:"",currency:"UGX",paymentInfo:"",defaultPrintFormat:"standard"});a.s(["convertPaymentMethodsToString",0,a=>a.filter(a=>""!==a.method.trim()||""!==a.accountNumber.trim()||""!==a.accountName.trim()).map(a=>`${a.method}
${a.accountNumber}
${a.accountName}`).join("\n"),"parsePaymentInfo",0,a=>{if(!a||""===a.trim())return[];let b=a.split("\n").filter(a=>""!==a.trim()),c=[];for(let a=0;a<b.length;a+=3)a+2<b.length&&c.push({method:b[a].trim(),accountNumber:b[a+1].trim(),accountName:b[a+2].trim()});return c},"useBusinessSettings",0,()=>{let[a,f]=(0,b.useState)(i()),[j,k]=(0,b.useState)(!1),{toast:l}=(0,d.useToast)(),{currentBusiness:m}=(0,e.useBusiness)(),n=async()=>{if(!m)return i();try{let a=await g(m.id);if(!a)return i();{let b=a.metadata&&"object"==typeof a.metadata&&a.metadata.payment_info||"";return{id:a.id,businessName:a.business_name||"",businessAddress:a.business_address||"",businessPhone:a.business_phone||"",businessEmail:a.business_email||"",businessLogo:a.business_logo||void 0,currency:a.currency||"UGX",signature:a.signature||void 0,paymentInfo:b,defaultPrintFormat:a.metadata&&"object"==typeof a.metadata&&a.metadata.default_print_format||"standard",defaultPrinterName:a.metadata&&"object"==typeof a.metadata&&a.metadata.default_printer_name||"",defaultPrinterType:a.metadata&&"object"==typeof a.metadata&&a.metadata.default_printer_type||"USB",printerPaperSize:a.metadata&&"object"==typeof a.metadata&&a.metadata.printer_paper_size||"58mm"}}}catch(a){return console.error("Error loading business settings:",a),l({title:"Error",description:"Failed to load business settings. Please try again.",variant:"destructive"}),i()}},o=async b=>{if(!m)return console.error("No business selected for updating settings"),l({title:"Error",description:"No business selected",variant:"destructive"}),!1;try{let c={payment_info:b.hasOwnProperty("paymentInfo")?b.paymentInfo:a.paymentInfo||"",default_print_format:b.hasOwnProperty("defaultPrintFormat")?b.defaultPrintFormat:a.defaultPrintFormat||"standard",default_printer_name:b.hasOwnProperty("defaultPrinterName")?b.defaultPrinterName:a.defaultPrinterName||"",default_printer_type:b.hasOwnProperty("defaultPrinterType")?b.defaultPrinterType:a.defaultPrinterType||"USB",printer_paper_size:b.hasOwnProperty("printerPaperSize")?b.printerPaperSize:a.printerPaperSize||"58mm"},d={business_name:b.hasOwnProperty("businessName")?b.businessName:a.businessName,business_address:b.hasOwnProperty("businessAddress")?b.businessAddress:a.businessAddress,business_phone:b.hasOwnProperty("businessPhone")?b.businessPhone:a.businessPhone,business_email:b.hasOwnProperty("businessEmail")?b.businessEmail:a.businessEmail,business_logo:b.hasOwnProperty("businessLogo")?b.businessLogo:a.businessLogo,currency:b.hasOwnProperty("currency")?b.currency:a.currency,signature:b.hasOwnProperty("signature")?b.signature:a.signature,metadata:c},e=await (0,h.upsertBusinessSettingsAction)(m.id,"00000000-0000-0000-0000-000000000000",d);if(!e.success)throw console.error("Supabase error updating business settings:",e.error),Error(e.error);return l({title:"Success",description:"Business settings updated successfully"}),s(),!0}catch(a){return console.error("Error updating business settings:",a),l({title:"Error",description:"Failed to update business settings. Please try again.",variant:"destructive"}),!1}},{data:p,isLoading:q,isFetching:r,refetch:s}=(0,c.useQuery)({queryKey:["businessSettings",m?.id],queryFn:n,enabled:!!m?.id,staleTime:3e5,gcTime:18e5,refetchOnWindowFocus:!1,refetchOnReconnect:!1});return(0,b.useEffect)(()=>{p?f(p):m||f(i())},[p,m]),(0,b.useEffect)(()=>{k(q||r)},[q,r]),{settings:a,isLoading:j,updateSettings:o,loadSettings:n}}],866102)},774016,959296,42724,a=>{"use strict";let b=Symbol.for("constructDateFrom");function c(a,c){return"function"==typeof a?a(c):a&&"object"==typeof a&&b in a?a[b](c):a instanceof Date?new a.constructor(c):new Date(c)}function d(a,b){return c(b||a,a)}a.s(["constructFromSymbol",0,b,"millisecondsInDay",0,864e5,"millisecondsInHour",0,36e5,"millisecondsInMinute",0,6e4,"millisecondsInSecond",0,1e3,"millisecondsInWeek",0,6048e5,"minutesInDay",0,1440,"minutesInMonth",0,43200],959296),a.s(["constructFrom",()=>c],42724),a.s(["toDate",()=>d],774016)},148817,277421,a=>{"use strict";var b=a.i(42724),c=a.i(774016);function d(a,d,e){let f=(0,c.toDate)(a,e?.in);return isNaN(d)?(0,b.constructFrom)(e?.in||a,NaN):(d&&f.setDate(f.getDate()+d),f)}function e(a,b,c){return d(a,-b,c)}a.s(["addDays",()=>d],277421),a.s(["subDays",()=>e],148817)},986451,a=>{"use strict";var b=a.i(42724),c=a.i(774016);function d(a,d,e){let f=(0,c.toDate)(a,e?.in);if(isNaN(d))return(0,b.constructFrom)(e?.in||a,NaN);if(!d)return f;let g=f.getDate(),h=(0,b.constructFrom)(e?.in||a,f.getTime());return(h.setMonth(f.getMonth()+d+1,0),g>=h.getDate())?h:(f.setFullYear(h.getFullYear(),h.getMonth(),g),f)}a.s(["addMonths",()=>d])},133885,a=>{"use strict";var b=a.i(986451);function c(a,c,d){return(0,b.addMonths)(a,12*c,d)}a.s(["addYears",()=>c])},400210,a=>{"use strict";let b=(0,a.i(170106).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);a.s(["ArrowLeft",()=>b],400210)},292e3,a=>{"use strict";let b=(0,a.i(170106).default)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);a.s(["AlertCircle",()=>b],292e3)},3048,(a,b,c)=>{let d=Error("Could not parse module '[project]/src/app/actions/products.ts'\n\n'import', and 'export' cannot be used outside of module code");throw d.code="MODULE_UNPARSABLE",d},347778,282141,a=>{"use strict";var b=a.i(572131),c=a.i(866102),d=a.i(169819),e=a.i(433217),f=a.i(937927);let g=a=>{};a.s(["clearInventoryCaches",0,g],282141);var h=a.i(3048);a.s(["useProducts",0,(a,i=50)=>{let[j,k]=(0,b.useState)([]),[l,m]=(0,b.useState)(1),[n,o]=(0,b.useState)(i),[p,q]=(0,b.useState)(0),[r,s]=(0,b.useState)(!1),{settings:t}=(0,c.useBusinessSettings)(),{currentBusiness:u}=(0,d.useBusiness)(),v=(0,f.useQueryClient)(),[w,x]=(0,b.useState)({search:"",category:"all",stockStatus:"all"}),[y,z]=(0,b.useState)(null),A=(0,b.useCallback)(a=>{a.search!==w.search&&(s(!0),y&&clearTimeout(y),z(setTimeout(()=>{s(!1)},600))),x(a)},[w.search,y]),B=(0,b.useCallback)(async()=>{if(!a||!u)return{products:[],count:0};try{return await (0,h.getProductsAction)({userId:a,businessId:u.id,page:l,pageSize:n,search:w.search,category:"all"===w.category?void 0:w.category,stockStatus:w.stockStatus})}catch(a){return console.error("Error loading products from server action:",a),{products:[],count:0}}},[a,u?.id,l,n,w.search,w.category,w.stockStatus]),C=(0,b.useMemo)(()=>["products",a,u?.id],[a,u?.id]),D=(0,b.useMemo)(()=>[...C,l,n,w.search,w.category,w.stockStatus],[C,l,n,w.search,w.category,w.stockStatus]),{data:E,isLoading:F,isFetching:G,refetch:H}=(0,e.useQuery)({queryKey:D,queryFn:B,enabled:!!a&&!!u?.id,staleTime:3e4,gcTime:18e5,refetchOnWindowFocus:!0,refetchOnReconnect:!0});(0,b.useEffect)(()=>{E&&(k(E.products),q(E.count))},[E]);let I=async b=>{try{if(!a)return null;return console.warn("Image upload redirecting to server action (TODO)"),null}catch(a){return console.error("Error in uploadProductImage:",a),null}};return{products:j,isLoading:F&&!E&&!r,loadProducts:B,page:l,setPage:m,pageSize:n,setPageSize:o,totalCount:p,createProduct:async b=>{try{if(!a||!u)return null;let c=await (0,h.createProductAction)({...b,userId:a,businessId:u.id});if(!c)return null;return k(a=>[c,...a]),q(a=>a+1),v.invalidateQueries({queryKey:C}),g(v),c}catch(a){return console.error("Error creating product:",a),null}},updateProduct:async(b,c,d,e=!1,f,i,j,k)=>{try{if(!a||!u)return!1;let i=c.imageUrl;if(d&&(i=await I(d)),!await (0,h.updateProductAction)(b,{...c,imageUrl:i,userId:a,businessId:u.id,isFromSale:e,customChangeReason:f,referenceId:j}))return!1;return v.invalidateQueries({queryKey:C}),g(v),!0}catch(a){return console.error("Error updating product:",a),!1}},updateProductsBulk:async(b,c,d,e,f,i)=>{try{if(!a||!u)return!1;let c=await (0,h.updateProductsBulkAction)(b.map(a=>({id:a.id,updated:a.updated})),u.id);return c&&(v.invalidateQueries({queryKey:C}),g(v)),c}catch(a){return console.error("Error in bulk update:",a),!1}},deleteProduct:async b=>{try{if(!a)return!1;if(await (0,h.deleteProductAction)(b))return v.invalidateQueries({queryKey:C}),g(v),!0;return!1}catch(a){return console.error("Error deleting product:",a),!1}},uploadProductImage:I,refetch:H,isFetching:G,filters:w,setFilters:A}}],347778)},100260,a=>{"use strict";var b=a.i(572131),c=a.i(478793),d=a.i(169819),e=a.i(258956),f=a.i(433217),g=a.i(937927),h=a.i(405050);let i=(0,h.createServerReference)("40227d1c2ed5cbf6324cf519682235031f0a3138a5",h.callServer,void 0,h.findSourceMapURL,"getCustomersAction"),j=(0,h.createServerReference)("708938753470d59bd6fa4ddf41a8a3581263dd393b",h.callServer,void 0,h.findSourceMapURL,"createCustomerAction"),k=(0,h.createServerReference)("609ad415d8b556837c750a19320a30ea6d4beaf896",h.callServer,void 0,h.findSourceMapURL,"updateCustomerAction"),l=(0,h.createServerReference)("40f9d32b0ea15e5c8f0b3441eec79ddb30815f1c83",h.callServer,void 0,h.findSourceMapURL,"deleteCustomerAction");var m=a.i(391956);a.s(["useCustomers",0,(a=50)=>{let[h,n]=(0,b.useState)([]),[o,p]=(0,b.useState)(1),[q,r]=(0,b.useState)(a),[s,t]=(0,b.useState)(0),{toast:u}=(0,c.useToast)(),{currentBusiness:v}=(0,d.useBusiness)(),{user:w}=(0,m.useAuth)(),{logActivity:x}=(0,e.useActivityLogger)(),y=(0,g.useQueryClient)(),z=(0,b.useCallback)(async()=>{if(!v)return{customers:[],count:0};try{let a=await i(v.id);if(!a.success)throw Error(a.error);return{customers:(a.data?.customers||[]).map(a=>({id:a.id,fullName:a.fullName||a.name,phoneNumber:a.phoneNumber||a.phone,email:a.email,birthday:a.birthday?new Date(a.birthday):null,gender:a.gender,location:a.location||a.address,categoryId:a.categoryId,notes:a.notes,tags:a.tags,socialMedia:a.socialMedia||null,createdAt:new Date(a.createdAt),updatedAt:new Date(a.updatedAt)})),count:a.data?.count||0}}catch(a){return console.error("Error loading customers:",a),u({title:"Error",description:"Failed to load customers. Please try again.",variant:"destructive"}),{customers:[],count:0}}},[v?.id,u]),A=["customers",v?.id],{data:B,isLoading:C,isFetching:D}=(0,f.useQuery)({queryKey:A,queryFn:z,enabled:!!v?.id,staleTime:3e5,gcTime:18e5,refetchOnWindowFocus:!1,refetchOnReconnect:!1});(0,b.useEffect)(()=>{B&&(n(B.customers),t(B.count))},[B]);let E=async a=>{if(!v)return u({title:"Error",description:"No business selected",variant:"destructive"}),null;try{if(!w)throw Error("User not authenticated");let b={fullName:a.fullName,phoneNumber:a.phoneNumber||null,email:a.email||null,birthday:a.birthday?.toISOString().split("T")[0]||null,gender:a.gender||null,location:a.location||null,categoryId:a.categoryId||null,notes:a.notes||null,tags:a.tags||null,socialMedia:a.socialMedia||null},c=await j(v.id,w.id,b);if(!c.success||!c.data)throw Error(c.error||"Failed to create customer");let d=c.data,e={id:d.id,fullName:d.name||d.fullName,phoneNumber:d.phone||d.phoneNumber,email:d.email,birthday:d.birthday?new Date(d.birthday):null,gender:d.gender,location:d.address||d.location,categoryId:d.categoryId,notes:d.notes,tags:d.tags,socialMedia:d.socialMedia,createdAt:new Date(d.createdAt),updatedAt:new Date(d.updatedAt)};return n(a=>[e,...a]),t(a=>a+1),y.setQueryData(A,a=>a?{customers:[e,...a.customers],count:(a.count||0)+1}:{customers:[e],count:1}),await x({activityType:"CREATE",module:"CUSTOMERS",entityType:"customer",entityId:d.id,entityName:a.fullName,description:`Created customer "${a.fullName}"`,metadata:{phoneNumber:a.phoneNumber,email:a.email,location:a.location}}),u({title:"Success",description:"Customer created successfully"}),d}catch(a){return console.error("Error creating customer:",a),u({title:"Error",description:"Failed to create customer. Please try again.",variant:"destructive"}),null}},F=async(a,b)=>{try{let c={};void 0!==b.fullName&&(c.fullName=b.fullName),void 0!==b.phoneNumber&&(c.phoneNumber=b.phoneNumber),void 0!==b.email&&(c.email=b.email),void 0!==b.birthday&&(c.birthday=b.birthday?.toISOString()),void 0!==b.gender&&(c.gender=b.gender),void 0!==b.location&&(c.location=b.location),void 0!==b.categoryId&&(c.categoryId=b.categoryId),void 0!==b.notes&&(c.notes=b.notes),void 0!==b.tags&&(c.tags=b.tags),void 0!==b.socialMedia&&(c.socialMedia=b.socialMedia);let d=await k(a,c);if(!d.success)throw Error(d.error||"Failed to update customer");n(c=>c.map(c=>c.id===a?{...c,...b}:c)),y.setQueryData(A,c=>c?{...c,customers:c.customers.map(c=>c.id===a?{...c,...b}:c)}:c);let e=h.find(b=>b.id===a);return e&&await x({activityType:"UPDATE",module:"CUSTOMERS",entityType:"customer",entityId:a,entityName:e.fullName,description:`Updated customer "${e.fullName}"`,metadata:{updates:b}}),u({title:"Success",description:"Customer updated successfully"}),!0}catch(a){return console.error("Error updating customer:",a),u({title:"Error",description:"Failed to update customer. Please try again.",variant:"destructive"}),!1}},G=async a=>{try{let b=h.find(b=>b.id===a),c=await l(a);if(!c.success)throw Error(c.error||"Failed to delete customer");return n(b=>b.filter(b=>b.id!==a)),t(a=>Math.max(0,a-1)),y.setQueryData(A,b=>{if(!b)return b;let{customers:c,count:d}=b;return{customers:c.filter(b=>b.id!==a),count:Math.max(0,(d||0)-1)}}),y.invalidateQueries({queryKey:A}),b&&await x({activityType:"DELETE",module:"CUSTOMERS",entityType:"customer",entityId:a,entityName:b.fullName,description:`Deleted customer "${b.fullName}"`,metadata:{phoneNumber:b.phoneNumber,email:b.email}}),u({title:"Success",description:"Customer deleted successfully"}),!0}catch(a){return console.error("Error deleting customer:",a),u({title:"Error",description:"Failed to delete customer. Please try again.",variant:"destructive"}),!1}};return{customers:h,isLoading:C&&!B,createCustomer:E,addCustomer:E,updateCustomer:F,deleteCustomer:G,loadCustomers:z,page:o,setPage:p,pageSize:q,setPageSize:r,totalCount:s}}],100260)}];

//# sourceMappingURL=_ad254a7d._.js.map