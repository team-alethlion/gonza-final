module.exports=[643496,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(886586),f=a.i(493901),g=a.i(199987),h=a.i(691098),i=a.i(223028),j=a.i(396465),k=b([j]);[j]=k.then?(await k)():k,a.s(["default",0,({onNewMessage:a,onNewTemplate:b,onTopUp:c,onBulkMessage:k,smsCredits:l,canCreate:m=!0})=>(0,d.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-2",children:[(0,d.jsx)(e.MessageSquare,{className:"w-8 h-8 text-blue-600"}),"Messages"]}),(0,d.jsx)("p",{className:"text-gray-500 mt-1",children:"Send SMS to your customers"})]}),(0,d.jsx)("div",{className:"flex flex-wrap items-center gap-3",children:m&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(j.Button,{onClick:c,variant:"outline",className:"flex items-center gap-2 border-green-500 text-green-700 hover:bg-green-50",children:[(0,d.jsx)(h.CreditCard,{className:"w-4 h-4"}),"Top Up"]}),(0,d.jsxs)(j.Button,{onClick:b,variant:"outline",className:"flex items-center gap-2",children:[(0,d.jsx)(g.FileText,{className:"w-4 h-4"}),"New Template"]}),(0,d.jsxs)(j.Button,{onClick:k,variant:"outline",className:"flex items-center gap-2 border-purple-500 text-purple-700 hover:bg-purple-50",children:[(0,d.jsx)(i.Users,{className:"w-4 h-4"}),"Bulk SMS"]}),(0,d.jsxs)(j.Button,{onClick:a,className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700",children:[(0,d.jsx)(f.Plus,{className:"w-4 h-4"}),"New Message"]})]})})]})]),c()}catch(a){c(a)}},!1),121761,a=>{"use strict";var b=a.i(508171),c=a.i(886586),d=a.i(73679),e=a.i(248586),f=a.i(818703),g=a.i(691098),h=a.i(778856);a.s(["default",0,({stats:a})=>{let i=a.creditsRemaining<=50,j=a.creditsRemaining<=20;return(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[(0,b.jsxs)("div",{className:`p-5 rounded-xl shadow-sm border-2 transition-all hover:shadow-lg ${j?"bg-red-50 border-red-400":i?"bg-amber-50 border-amber-400":"bg-emerald-50 border-emerald-400"}`,children:[(0,b.jsxs)("div",{className:`flex items-center gap-3 mb-2 ${j?"text-red-700":i?"text-amber-700":"text-emerald-700"}`,children:[(0,b.jsx)(h.Wallet,{className:"w-5 h-5"}),(0,b.jsx)("span",{className:"text-sm font-medium",children:"Credit Bal."})]}),(0,b.jsx)("p",{className:`text-3xl font-bold ${j?"text-red-700":i?"text-amber-700":"text-emerald-700"}`,children:a.creditsRemaining.toLocaleString()})]}),(0,b.jsxs)("div",{className:"bg-white p-5 rounded-xl shadow-sm border border-gray-200 hover:shadow-md transition-shadow",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 text-gray-600 mb-2",children:[(0,b.jsx)(c.MessageSquare,{className:"w-5 h-5"}),(0,b.jsx)("span",{className:"text-sm font-medium",children:"Total"})]}),(0,b.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:a.total.toLocaleString()})]}),(0,b.jsxs)("div",{className:"bg-white p-5 rounded-xl shadow-sm border border-gray-200 hover:shadow-md transition-shadow",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 text-green-600 mb-2",children:[(0,b.jsx)(d.CheckCircle,{className:"w-5 h-5"}),(0,b.jsx)("span",{className:"text-sm font-medium",children:"Sent"})]}),(0,b.jsx)("p",{className:"text-3xl font-bold text-green-600",children:a.sent.toLocaleString()})]}),(0,b.jsxs)("div",{className:"bg-white p-5 rounded-xl shadow-sm border border-gray-200 hover:shadow-md transition-shadow",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 text-amber-600 mb-2",children:[(0,b.jsx)(f.Clock,{className:"w-5 h-5"}),(0,b.jsx)("span",{className:"text-sm font-medium",children:"Pending"})]}),(0,b.jsx)("p",{className:"text-3xl font-bold text-amber-600",children:a.pending})]}),(0,b.jsxs)("div",{className:"bg-white p-5 rounded-xl shadow-sm border border-gray-200 hover:shadow-md transition-shadow",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 text-red-600 mb-2",children:[(0,b.jsx)(e.XCircle,{className:"w-5 h-5"}),(0,b.jsx)("span",{className:"text-sm font-medium",children:"Failed"})]}),(0,b.jsx)("p",{className:"text-3xl font-bold text-red-600",children:a.failed})]}),(0,b.jsxs)("div",{className:"bg-white p-5 rounded-xl shadow-sm border border-gray-200 hover:shadow-md transition-shadow",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 text-blue-600 mb-2",children:[(0,b.jsx)(g.CreditCard,{className:"w-5 h-5"}),(0,b.jsx)("span",{className:"text-sm font-medium",children:"Credits Used"})]}),(0,b.jsx)("p",{className:"text-3xl font-bold text-blue-600",children:a.totalCreditsUsed.toLocaleString()})]})]})}])},661548,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(957143),f=a.i(120327),g=a.i(886586),h=a.i(112779),i=a.i(688272),j=b([h,i]);[h,i]=j.then?(await j)():j,a.s(["default",0,({messages:a,customers:b,searchTerm:c,setSearchTerm:j,statusFilter:k,setStatusFilter:l})=>{let m=a=>a?b.find(b=>b.id===a):null,n=a.filter(a=>{let b=m(a.customerId),d=b?b.full_name||b.fullName||b.name:"",e=a.phoneNumber,f=a.content,g=!c||d.toLowerCase().includes(c.toLowerCase())||e.toLowerCase().includes(c.toLowerCase())||f.toLowerCase().includes(c.toLowerCase()),h="all"===k||a.status===k;return g&&h});return(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,d.jsxs)("div",{className:"flex-1 relative",children:[(0,d.jsx)(e.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),(0,d.jsx)(h.Input,{type:"text",placeholder:"Search messages...",value:c,onChange:a=>j(a.target.value),className:"pl-10"})]}),(0,d.jsxs)(i.Select,{value:k,onValueChange:l,children:[(0,d.jsxs)(i.SelectTrigger,{className:"w-full md:w-48",children:[(0,d.jsx)(f.Filter,{className:"w-4 h-4 mr-2"}),(0,d.jsx)(i.SelectValue,{placeholder:"Filter by status"})]}),(0,d.jsxs)(i.SelectContent,{children:[(0,d.jsx)(i.SelectItem,{value:"all",children:"All Messages"}),(0,d.jsx)(i.SelectItem,{value:"pending",children:"Pending"}),(0,d.jsx)(i.SelectItem,{value:"sent",children:"Sent"}),(0,d.jsx)(i.SelectItem,{value:"failed",children:"Failed"})]})]})]}),(0,d.jsx)("div",{className:"space-y-3",children:0===n.length?(0,d.jsxs)("div",{className:"text-center py-12 bg-white rounded-lg border",children:[(0,d.jsx)(g.MessageSquare,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),(0,d.jsx)("p",{className:"text-gray-500",children:"No messages found"})]}):n.map(a=>{let b=m(a.customerId),c=b?b.full_name||b.fullName||b.name:"";return(0,d.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow border hover:shadow-md transition-shadow",children:[(0,d.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,d.jsx)("div",{children:(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("p",{className:"font-medium text-gray-900",children:c?`${c} (${a.phoneNumber})`:a.phoneNumber}),(0,d.jsx)("span",{className:`text-xs px-2 py-1 rounded-full ${{pending:"bg-amber-100 text-amber-800",sent:"bg-green-100 text-green-800",delivered:"bg-blue-100 text-blue-800",failed:"bg-red-100 text-red-800"}[a.status]||"bg-gray-100 text-gray-800"}`,children:a.status})]})}),(0,d.jsxs)("div",{className:"text-right",children:[(0,d.jsx)("p",{className:"text-xs text-gray-400",children:new Date(a.createdAt).toLocaleDateString()}),(0,d.jsx)("p",{className:"text-xs text-gray-400",children:new Date(a.createdAt).toLocaleTimeString()})]})]}),(0,d.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:a.content}),(0,d.jsxs)("div",{className:"flex justify-between items-center text-xs text-gray-400",children:[(0,d.jsxs)("span",{children:[a.smsCreditsUsed," credit",a.smsCreditsUsed>1?"s":""," used"]}),a.errorMessage&&(0,d.jsx)("span",{className:"text-red-600",children:a.errorMessage})]})]},a.id)})})]})}]),c()}catch(a){c(a)}},!1),115922,a=>{"use strict";let b=(0,a.i(564375).default)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);a.s(["Send",()=>b],115922)},915561,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(115922),g=a.i(109254),h=a.i(396465),i=a.i(112779),j=a.i(330281),k=a.i(688272),l=b([g,h,i,j,k]);[g,h,i,j,k]=l.then?(await l)():l,a.s(["default",0,({open:a,onClose:b,onSend:c,customers:l,templates:m})=>{let[n,o]=(0,e.useState)(""),[p,q]=(0,e.useState)(""),[r,s]=(0,e.useState)("none"),[t,u]=(0,e.useState)("none"),[v,w]=(0,e.useState)(!1),[x,y]=(0,e.useState)(null),[z,A]=(0,e.useState)("");(0,e.useEffect)(()=>{a||(o(""),q(""),s("none"),u("none"),y(null),A(""))},[a]),(0,e.useEffect)(()=>{if(r&&"none"!==r){let a=l.find(a=>a.id===r),b=B(a);o(b)}},[r,l]),(0,e.useEffect)(()=>{if(t&&"none"!==t){let a=m.find(a=>a.id===t);a&&q(a.content)}},[t,m]);let B=a=>(a?.phone_number||a?.phoneNumber||a?.phone||a?.contact||"").trim(),C=(0,e.useMemo)(()=>{let a=(z||"").toLowerCase();return l.filter(a=>B(a)).filter(b=>{let c=(b.full_name||b.fullName||b.name||"").toLowerCase(),d=B(b).toLowerCase();return!a||c.includes(a)||d.includes(a)})},[l,z]),D=async()=>{if(!n||!p)return;w(!0);let a=await c({phoneNumber:n,content:p,customerId:r&&"none"!==r?r:void 0,templateId:t&&"none"!==t?t:void 0});w(!1),y({success:a.success,failed:a.failed,errors:a.errors||[]}),0===(a.failed||0)&&setTimeout(()=>b(),3e3)},E=p.length,F=Math.ceil(E/160)||1;return(0,d.jsx)(g.Dialog,{open:a,onOpenChange:b,children:(0,d.jsxs)(g.DialogContent,{className:"sm:max-w-lg max-h-[90vh] overflow-y-auto",children:[(0,d.jsx)(g.DialogHeader,{children:(0,d.jsxs)(g.DialogTitle,{className:"flex items-center gap-2",children:[(0,d.jsx)(f.Send,{className:"w-5 h-5"}),"Send New Message"]})}),x?(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{className:`p-4 rounded-lg border ${0===x.failed?"bg-green-50 border-green-200":"bg-amber-50 border-amber-200"}`,children:[(0,d.jsx)("h3",{className:"font-semibold text-lg mb-2",children:0===x.failed?"✅ Message Sent Successfully!":"⚠️ Sending Completed with Errors"}),(0,d.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,d.jsxs)("p",{className:"text-green-700",children:["✓ Successfully sent: ",x.success]}),x.failed>0&&(0,d.jsxs)("p",{className:"text-red-700",children:["✗ Failed: ",x.failed]})]})]}),x.errors.length>0&&(0,d.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,d.jsx)("h4",{className:"font-semibold text-red-900 mb-2",children:"Errors:"}),(0,d.jsx)("ul",{className:"text-sm text-red-800 space-y-1 max-h-[200px] overflow-y-auto",children:x.errors.map((a,b)=>(0,d.jsxs)("li",{children:["• ",a]},b))})]}),(0,d.jsx)(h.Button,{onClick:b,className:"w-full",children:"Close"})]}):(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Select Customer (Optional)"}),(0,d.jsxs)(k.Select,{value:r,onValueChange:s,children:[(0,d.jsx)(k.SelectTrigger,{className:"w-full",children:(0,d.jsx)(k.SelectValue,{placeholder:"Search or select a customer..."})}),(0,d.jsxs)(k.SelectContent,{className:"max-h-[300px] overflow-y-auto",children:[(0,d.jsx)("div",{className:"p-2",children:(0,d.jsx)(i.Input,{type:"text",placeholder:"Type to search...",value:z,onChange:a=>A(a.target.value),className:"mb-2"})}),(0,d.jsx)(k.SelectItem,{value:"none",children:"None - Enter Customer Name or Phone Number"}),C.map(a=>(0,d.jsxs)(k.SelectItem,{value:a.id,children:[a.full_name||a.fullName||a.name||"Unnamed Customer"," - ",B(a)]},a.id))]})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Phone Number *"}),(0,d.jsx)(i.Input,{type:"tel",placeholder:"+256700000000",value:n,onChange:a=>o(a.target.value),className:"w-full"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Use Template (Optional)"}),(0,d.jsxs)(k.Select,{value:t,onValueChange:u,children:[(0,d.jsx)(k.SelectTrigger,{className:"w-full",children:(0,d.jsx)(k.SelectValue,{placeholder:"Choose a template..."})}),(0,d.jsxs)(k.SelectContent,{className:"max-h-[300px] overflow-y-auto",children:[(0,d.jsx)(k.SelectItem,{value:"none",children:"None - Type custom message"}),m.map(a=>(0,d.jsx)(k.SelectItem,{value:a.id,children:a.name},a.id))]})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Message * (Max 160 Characters)"}),(0,d.jsx)(j.Textarea,{placeholder:"Type your message...",value:p,onChange:a=>q(a.target.value),rows:5,required:!0,className:"w-full resize-none"}),(0,d.jsxs)("div",{className:"flex justify-between mt-1 text-xs text-gray-500",children:[(0,d.jsxs)("span",{children:[E," characters"]}),(0,d.jsxs)("span",{children:[F," SMS credit",F>1?"s":""," will be used"]})]})]}),(0,d.jsxs)("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[(0,d.jsx)(h.Button,{variant:"outline",onClick:b,disabled:v,children:"Cancel"}),(0,d.jsx)(h.Button,{onClick:D,disabled:!n||!p||v,className:"bg-blue-600 hover:bg-blue-700",children:v?(0,d.jsx)("span",{className:"animate-spin mr-2",children:"⏳"}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(f.Send,{className:"w-4 h-4 mr-2"}),"Send Message"]})})]})]})]})})}]),c()}catch(a){c(a)}},!1),959767,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(199987),g=a.i(86246),h=a.i(109254),i=a.i(396465),j=a.i(330281),k=a.i(688272),l=b([h,i,j,k]);[h,i,j,k]=l.then?(await l)():l;let m=[{value:"ThankYou",label:"Thank You (After Sale)"},{value:"Birthday",label:"Birthday Wishes"},{value:"PaymentReminder",label:"Payment Reminder"},{value:"Holiday",label:"Public Holiday"},{value:"Inactive",label:"We Miss You / Inactive Customer"},{value:"Custom",label:"Custom"}];a.s(["default",0,({open:a,onClose:b,onSave:c,initialData:l})=>{let[n,o]=(0,e.useState)(""),[p,q]=(0,e.useState)(""),[r,s]=(0,e.useState)(""),[t,u]=(0,e.useState)(""),[v,w]=(0,e.useState)([]),[x,y]=(0,e.useState)(!1);(0,e.useEffect)(()=>{a&&l?(o(l.name),q(l.content),s(l.category||""),u(l.category&&!m.some(a=>a.value===l.category)?l.category:""),w(l.variables||[])):a||(o(""),q(""),s(""),u(""),w([]))},[a,l]);let z=async()=>{if(!n||!p)return;let a="Custom"===r?t:r;y(!0);let d=await c({name:n,content:p,category:a||void 0,variables:v,isDefault:!1});y(!1),d&&b()};return(0,d.jsx)(h.Dialog,{open:a,onOpenChange:a=>{a||b()},children:(0,d.jsxs)(h.DialogContent,{className:"sm:max-w-lg max-h-[80vh] overflow-y-auto",children:[(0,d.jsx)(h.DialogHeader,{children:(0,d.jsxs)(h.DialogTitle,{className:"flex items-center gap-2",children:[(0,d.jsx)(f.FileText,{className:"w-5 h-5"}),l?"Edit Template":"Create New Template"]})}),(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Template Name *"}),(0,d.jsx)(j.Textarea,{placeholder:"e.g., Welcome Message",value:n,onChange:a=>o(a.target.value),rows:1,className:"resize-none"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Category *"}),(0,d.jsxs)(k.Select,{value:r,onValueChange:s,children:[(0,d.jsx)(k.SelectTrigger,{children:(0,d.jsx)(k.SelectValue,{placeholder:"Select category..."})}),(0,d.jsx)(k.SelectContent,{children:m.map(a=>(0,d.jsx)(k.SelectItem,{value:a.value,children:a.label},a.value))})]}),"Custom"===r&&(0,d.jsx)(j.Textarea,{placeholder:"Type custom category...",value:t,onChange:a=>u(a.target.value),rows:1,className:"mt-2 resize-none"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Message Content *"}),(0,d.jsx)(j.Textarea,{placeholder:"Type your template here... Use {variable} for dynamic content",value:p,onChange:a=>{q(a.target.value);let b=a.target.value.match(/\{([^}]+)\}/g);if(b){let a=b.map(a=>a.slice(1,-1));w([...new Set(a)])}else w([])},rows:6,className:"resize-none"}),(0,d.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Use curly braces for variables: ","{customer_name}",", ","{customer_phone}",", etc."]})]}),v.length>0&&(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Detected Variables"}),(0,d.jsx)("div",{className:"flex flex-wrap gap-2",children:v.map(a=>(0,d.jsx)("span",{className:"text-xs px-2 py-1 bg-blue-50 text-blue-600 rounded",children:a},a))})]}),(0,d.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[(0,d.jsx)("p",{className:"text-xs font-medium text-blue-900 mb-2",children:"Available Variables"}),(0,d.jsxs)("div",{className:"text-xs text-blue-800 space-y-1",children:[(0,d.jsxs)("p",{children:["• ",(0,d.jsx)("code",{className:"bg-blue-100 px-1 rounded",children:"{customer_name}"})," - Full customer name"]}),(0,d.jsxs)("p",{children:["• ",(0,d.jsx)("code",{className:"bg-blue-100 px-1 rounded",children:"{first_name}"})," - Customer first name"]}),(0,d.jsxs)("p",{children:["• ",(0,d.jsx)("code",{className:"bg-blue-100 px-1 rounded",children:"{last_name}"})," - Customer last name"]}),(0,d.jsxs)("p",{children:["• ",(0,d.jsx)("code",{className:"bg-blue-100 px-1 rounded",children:"{customer_phone}"})," - Customer phone number"]}),(0,d.jsxs)("p",{children:["• ",(0,d.jsx)("code",{className:"bg-blue-100 px-1 rounded",children:"{customer_email}"})," - Customer email"]})]}),(0,d.jsx)("p",{className:"text-xs text-blue-700 mt-2",children:"These will be automatically replaced when sending to a customer"})]}),(0,d.jsxs)("div",{className:"flex justify-end gap-2 pt-4",children:[(0,d.jsx)(i.Button,{variant:"outline",onClick:b,disabled:x,children:"Cancel"}),(0,d.jsxs)(i.Button,{onClick:z,disabled:!n||!p||!r||"Custom"===r&&!t||x,className:"bg-blue-600 hover:bg-blue-700",children:[(0,d.jsx)(g.Save,{className:"w-4 h-4 mr-2"}),x?"Saving...":"Save Template"]})]})]})]})})}]),c()}catch(a){c(a)}},!1),365415,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(691098),g=a.i(352519),h=a.i(109254),i=a.i(396465),j=a.i(112779),k=b([h,i,j]);[h,i,j]=k.then?(await k)():k;let l={get url(){return`file://${a.P("src/components/messages/TopUpCreditsDialog.tsx")}`}};a.s(["default",0,({open:a,onClose:b,onTopUp:c})=>{let[k,m]=(0,e.useState)(10),[n,o]=(0,e.useState)(""),[p,q]=(0,e.useState)(!1),r=Number(l.env.VITE_SMS_CREDIT_COST||100),s=k*r;(0,e.useEffect)(()=>{console.log("[TopUpCreditsDialog] Dialog open state:",a),a&&(console.log("[TopUpCreditsDialog] Dialog opened — resetting form"),m(10),o(""),q(!1))},[a]),(0,e.useEffect)(()=>{console.log("[TopUpCreditsDialog] Current state → Credits:",k,"| Phone:",n,"| Total Cost: UGX",s.toLocaleString())},[k,n,s]);let t=async()=>{if(console.log("[TopUpCreditsDialog] Top-up requested!"),console.log("   → Credits:",k),console.log("   → Phone Number:",n),console.log("   → Total Cost: UGX",s.toLocaleString()),!n||k<1)return void console.warn("[TopUpCreditsDialog] Invalid input — blocking submit");q(!0),console.log("[TopUpCreditsDialog] Calling onTopUp...");try{let a=await c(k,n);console.log("[TopUpCreditsDialog] onTopUp result:",a?"SUCCESS":"FAILED"),a?(console.log("[TopUpCreditsDialog] Payment successful → closing dialog"),b()):console.error("[TopUpCreditsDialog] Payment failed (returned false)")}catch(a){console.error("[TopUpCreditsDialog] onTopUp threw an error:",a)}finally{q(!1)}};return(0,d.jsx)(h.Dialog,{open:a,onOpenChange:b,children:(0,d.jsxs)(h.DialogContent,{className:"sm:max-w-lg",children:[(0,d.jsx)(h.DialogHeader,{children:(0,d.jsxs)(h.DialogTitle,{className:"flex items-center gap-2",children:[(0,d.jsx)(f.CreditCard,{className:"w-5 h-5"}),"Top Up SMS Credits"]})}),(0,d.jsxs)("div",{className:"space-y-6",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Number of Credits *"}),(0,d.jsx)(j.Input,{type:"number",min:"1",value:k,onChange:a=>{let b=Math.max(1,parseInt(a.target.value)||1);console.log("[TopUpCreditsDialog] Credits input changed →",b),m(b)},className:"text-lg font-semibold"}),(0,d.jsx)("div",{className:"mt-3 flex flex-wrap gap-2",children:[10,25,50,100].map(a=>(0,d.jsxs)("button",{type:"button",onClick:()=>{console.log("[TopUpCreditsDialog] Quick amount clicked →",a,"credits"),m(a)},className:`px-3 py-1 text-sm rounded-md border transition-colors ${k===a?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300 hover:border-blue-400"}`,children:[a," credits"]},a))})]}),(0,d.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,d.jsx)("span",{className:"text-sm text-gray-600",children:"Credit Cost:"}),(0,d.jsxs)("span",{className:"text-sm font-medium",children:["UGX ",r," per credit"]})]}),(0,d.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,d.jsx)("span",{className:"text-sm text-gray-600",children:"Quantity:"}),(0,d.jsxs)("span",{className:"text-sm font-medium",children:[k," credits"]})]}),(0,d.jsx)("div",{className:"border-t border-blue-300 pt-2 mt-2",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsx)("span",{className:"text-base font-semibold text-gray-900",children:"Total Amount:"}),(0,d.jsxs)("span",{className:"text-xl font-bold text-blue-600",children:["UGX ",s.toLocaleString()]})]})})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Mobile Money Phone Number *"}),(0,d.jsx)(j.Input,{type:"tel",placeholder:"+256700000000",value:n,onChange:a=>{console.log("[TopUpCreditsDialog] Phone number changed →",a.target.value),o(a.target.value)}}),(0,d.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"You will receive a payment prompt on this number"})]}),(0,d.jsxs)("div",{className:"flex justify-end gap-2 pt-4",children:[(0,d.jsx)(i.Button,{variant:"outline",onClick:b,disabled:p,children:"Cancel"}),(0,d.jsxs)(i.Button,{onClick:t,disabled:!n||k<1||p,className:"bg-green-600 hover:bg-green-700",children:[(0,d.jsx)(g.DollarSign,{className:"w-4 h-4 mr-2"}),p?"Processing...":`Pay UGX ${s.toLocaleString()}`]})]})]})]})})}]),c()}catch(a){c(a)}},!1),108039,a=>{"use strict";var b=a.i(445475);function c(a,c,d){var e;return e=-c,(0,b.addMonths)(a,12*e,d)}a.s(["subYears",()=>c],108039)},802304,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(115922),g=a.i(223028),h=a.i(436028),i=a.i(109254),j=a.i(396465),k=a.i(330281),l=a.i(688272),m=a.i(459502),n=a.i(112779),o=a.i(385375),p=a.i(964889),q=a.i(284177),r=a.i(460716),s=a.i(108039),t=b([i,j,k,l,m,n,o,p]);[i,j,k,l,m,n,o,p]=t.then?(await t)():t,a.s(["default",0,({open:a,onClose:b,onSend:c,customers:t,templates:u=[],searchTerm:v,setSearchTerm:w})=>{let[x,y]=(0,e.useState)(""),[z,A]=(0,e.useState)([]),[B,C]=(0,e.useState)("none"),[D,E]=(0,e.useState)(!1),[F,G]=(0,e.useState)("all"),[H,I]=(0,e.useState)("90days"),[J,K]=(0,e.useState)(null),{currentBusiness:L}=(0,p.useBusiness)(),{sales:M,isLoading:N}=(0,o.useSalesData)(L?.id),O=a=>a.charAt(0).toUpperCase()+a.slice(1),P=(0,e.useMemo)(()=>{let a={};if(!M||0===M.length)return a;let b=new Date,c=b;switch(H){case"30days":c=(0,q.subDays)(b,30);break;case"60days":c=(0,q.subDays)(b,60);break;case"90days":c=(0,q.subDays)(b,90);break;case"6months":c=(0,r.subMonths)(b,6);break;case"1year":c=(0,s.subYears)(b,1)}return t.forEach(b=>{let d=(b.full_name||b.fullName||b.name||"").toLowerCase(),e=M.filter(a=>a.customerId===b.id||a.customerName?.toLowerCase().trim()===d),f=new Set;0===e.length?f.add("inactive"):(new Date(Math.max(...e.map(a=>new Date(a.date).getTime())))<c&&f.add("inactive"),e.forEach(a=>{let b=(a.paymentStatus||"").toUpperCase().trim();"PAID"===b?f.add("paid"):"QUOTE"===b?f.add("quote"):"INSTALLMENT SALE"===b?f.add("installment"):["NOT PAID","UNPAID","OPEN"].includes(b)&&f.add("unpaid")})),a[b.id]=f}),a},[t,M,H]);(0,e.useEffect)(()=>{a||(y(""),A([]),C("none"),G("all"),K(null))},[a]),(0,e.useEffect)(()=>{if(B&&"none"!==B){let a=u.find(a=>a.id===B);a&&y(a.content)}},[B,u]);let Q=a=>a.phone_number||a.phoneNumber||a.phone||a.contact||"",R=(0,e.useMemo)(()=>t.filter(a=>{let b=Q(a)||"";if(!b)return!1;let c=(a.full_name||a.fullName||a.name||"").toLowerCase(),d=(v||"").toLowerCase(),e=!d||c.includes(d)||b.toLowerCase().includes(d),f=P[a.id]||new Set,g=!0;return"all"!==F&&(g=f.has(F)),e&&g}),[t,v,F,P]),S=a=>{A(b=>b.includes(a)?b.filter(b=>b!==a):[...b,a])},T=async()=>{if(!x||0===z.length)return;E(!0);let a=await c({customerIds:z,content:x,templateId:"none"!==B?B:void 0});E(!1),K(a),0===a.failed&&setTimeout(()=>b(),3e3)},U=z.length*Math.ceil((x.length||1)/160);return N?(0,d.jsx)(i.Dialog,{open:a,onOpenChange:b,children:(0,d.jsx)(i.DialogContent,{className:"sm:max-w-3xl max-h-[90vh] overflow-y-auto",children:(0,d.jsx)("div",{className:"p-4 text-center text-gray-500",children:"Loading sales data..."})})}):(0,d.jsx)(i.Dialog,{open:a,onOpenChange:b,children:(0,d.jsxs)(i.DialogContent,{className:"sm:max-w-3xl max-h-[90vh] overflow-y-auto",children:[(0,d.jsx)(i.DialogHeader,{children:(0,d.jsxs)(i.DialogTitle,{className:"flex items-center gap-2",children:[(0,d.jsx)(g.Users,{className:"w-5 h-5"}),"Send Bulk SMS"]})}),J?(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{className:`p-4 rounded-lg border ${0===J.failed?"bg-green-50 border-green-200":"bg-amber-50 border-amber-200"}`,children:[(0,d.jsx)("h3",{className:"font-semibold text-lg mb-2",children:0===J.failed?"✅ Messages Sent Successfully!":"⚠️ Sending Complete with Errors"}),(0,d.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,d.jsxs)("p",{className:"text-green-700",children:["✓ Successfully sent: ",J.success]}),J.failed>0&&(0,d.jsxs)("p",{className:"text-red-700",children:["✗ Failed: ",J.failed]})]})]}),J.errors.length>0&&(0,d.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,d.jsx)("h4",{className:"font-semibold text-red-900 mb-2",children:"Errors:"}),(0,d.jsx)("ul",{className:"text-sm text-red-800 space-y-1 max-h-[200px] overflow-y-auto",children:J.errors.map((a,b)=>(0,d.jsxs)("li",{children:["• ",a]},b))})]}),(0,d.jsx)(j.Button,{onClick:b,className:"w-full",children:"Close"})]}):(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Use Template (Optional)"}),(0,d.jsxs)(l.Select,{value:B,onValueChange:C,children:[(0,d.jsx)(l.SelectTrigger,{className:"w-full",children:(0,d.jsx)(l.SelectValue,{placeholder:"Choose a template..."})}),(0,d.jsxs)(l.SelectContent,{className:"max-h-[300px] overflow-y-auto",children:[(0,d.jsx)(l.SelectItem,{value:"none",children:"None - Type custom message"}),u.map(a=>(0,d.jsx)(l.SelectItem,{value:a.id,children:a.name},a.id))]})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Message * (Max 160 Characters)"}),(0,d.jsx)(k.Textarea,{placeholder:"Type your message here... Use {customer_name} for personalization",value:x,onChange:a=>y(a.target.value),rows:4,maxLength:160,required:!0,className:"resize-none w-full"}),(0,d.jsxs)("div",{className:"flex justify-between mt-1 text-xs text-gray-500",children:[(0,d.jsxs)("span",{children:[x.length," characters"]}),(0,d.jsxs)("span",{className:"font-medium text-blue-600",children:[U," total SMS credits will be used"]})]})]}),(0,d.jsxs)("div",{className:"flex gap-2 mb-2 flex-wrap items-center",children:[["all","paid","unpaid","quote","installment","inactive"].map(a=>(0,d.jsx)(j.Button,{size:"sm",variant:F===a?"default":"outline",onClick:()=>G(a),children:O(a)},a)),"inactive"===F&&(0,d.jsxs)(l.Select,{value:H,onValueChange:a=>I(a),children:[(0,d.jsx)(l.SelectTrigger,{className:"w-[120px] text-xs",children:(0,d.jsx)(l.SelectValue,{placeholder:"Select period"})}),(0,d.jsxs)(l.SelectContent,{children:[(0,d.jsx)(l.SelectItem,{value:"30days",children:"30 days"}),(0,d.jsx)(l.SelectItem,{value:"60days",children:"60 days"}),(0,d.jsx)(l.SelectItem,{value:"90days",children:"90 days"}),(0,d.jsx)(l.SelectItem,{value:"6months",children:"6 months"}),(0,d.jsx)(l.SelectItem,{value:"1year",children:"1 year"})]})]}),(0,d.jsx)(j.Button,{size:"sm",variant:"outline",onClick:()=>{z.length===R.length?A([]):A(R.map(a=>a.id))},children:z.length===R.length?`Deselect All ${O(F)} Customers`:`Select All ${O(F)} Customers`})]}),(0,d.jsx)(n.Input,{type:"text",placeholder:"Search customers...",value:v,onChange:a=>w(a.target.value),className:"mb-2"}),(0,d.jsx)("div",{className:"border rounded-lg max-h-[300px] overflow-y-auto",children:0===R.length?(0,d.jsxs)("div",{className:"p-4 text-center text-gray-500",children:[(0,d.jsx)(h.AlertCircle,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),(0,d.jsx)("p",{children:"No customers match your search"})]}):R.map(a=>{let b=Q(a),c=Array.from(P[a.id]||[]);return(0,d.jsxs)("div",{className:"flex items-center gap-3 p-3 hover:bg-gray-50 border-b last:border-b-0 cursor-pointer",onClick:()=>S(a.id),children:[(0,d.jsx)(m.Checkbox,{checked:z.includes(a.id),onCheckedChange:()=>S(a.id)}),(0,d.jsxs)("div",{className:"flex-1",children:[(0,d.jsx)("p",{className:"font-medium text-gray-900",children:a.full_name||a.fullName||a.name||"Unnamed Customer"}),(0,d.jsx)("p",{className:"text-xs text-gray-500",children:b}),(0,d.jsxs)("span",{className:"text-xs text-gray-400",children:["Status: ",c.map(a=>a.toUpperCase()).join(", ")]})]})]},a.id)})}),(0,d.jsxs)("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[(0,d.jsx)(j.Button,{variant:"outline",onClick:b,disabled:D,children:"Cancel"}),(0,d.jsx)(j.Button,{onClick:T,disabled:0===z.length||!x||D,className:"bg-blue-600 hover:bg-blue-700",children:D?(0,d.jsx)("span",{className:"animate-spin mr-2",children:"⏳"}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(f.Send,{className:"w-4 h-4 mr-2"}),"Send to ",z.length," Customer",1!==z.length?"s":""]})})]})]})]})})}]),c()}catch(a){c(a)}},!1),23963,a=>{"use strict";var b=a.i(508171),c=a.i(691098),d=a.i(73679),e=a.i(248586),f=a.i(818703);a.s(["default",0,({purchases:a})=>0===a.length?(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow border p-8 text-center",children:[(0,b.jsx)(c.CreditCard,{className:"w-12 h-12 mx-auto text-gray-400 mb-3"}),(0,b.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"No Purchase History"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Your credit purchase history will appear here."})]}):(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow border overflow-hidden",children:[(0,b.jsx)("div",{className:"px-6 py-4 border-b bg-gray-50",children:(0,b.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[(0,b.jsx)(c.CreditCard,{className:"w-5 h-5"}),"Purchase History"]})}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,b.jsx)("thead",{className:"bg-gray-50",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Credits"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Cost"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Payment Phone"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Payment Method"})]})}),(0,b.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:a.map(a=>(0,b.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(a.created_at||a.createdAt||"").toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})}),(0,b.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:[(a.credits_amount||a.creditsAmount||0).toLocaleString()," credits"]}),(0,b.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["UGX ",(a.total_cost||a.totalCost||0).toLocaleString()]}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:a.payment_phone_number||a.paymentPhoneNumber||"-"}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(a=>{switch(a.toLowerCase()){case"completed":return(0,b.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[(0,b.jsx)(d.CheckCircle,{className:"w-3 h-3"}),"Completed"]});case"pending":return(0,b.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[(0,b.jsx)(f.Clock,{className:"w-3 h-3"}),"Pending"]});case"failed":return(0,b.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[(0,b.jsx)(e.XCircle,{className:"w-3 h-3"}),"Failed"]});default:return(0,b.jsx)("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:a})}})(a.payment_status||a.paymentStatus||"pending")}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:a.payment_method||a.paymentMethod||"-"})]},a.id))})]})})]})])},115444,a=>{"use strict";var b=a.i(508171),c=a.i(127669),d=a.i(886586),e=a.i(73679),f=a.i(248586),g=a.i(818703),h=a.i(115922);a.s(["default",0,({messages:a})=>{let[i,j]=(0,c.useState)(null);return 0===a.length?(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow border p-8 text-center",children:[(0,b.jsx)(h.Send,{className:"w-12 h-12 mx-auto text-gray-400 mb-3"}),(0,b.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"No Usage History"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Your sent messages will appear here."})]}):(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow border overflow-hidden",children:[(0,b.jsx)("div",{className:"px-6 py-4 border-b bg-gray-50",children:(0,b.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[(0,b.jsx)(d.MessageSquare,{className:"w-5 h-5"}),"Usage History"]})}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,b.jsx)("thead",{className:"bg-gray-50",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date Sent"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Phone Number"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Message"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Credits Used"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"})]})}),(0,b.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:a.map(a=>{let c=a.sms_credits_used||a.smsCreditsUsed||0;return(0,b.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(a.sent_at||a.sentAt||a.created_at||a.createdAt||"").toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:a.phone_number||a.phoneNumber||"-"}),(0,b.jsx)("td",{className:"px-6 py-4 text-sm text-gray-900 max-w-md",children:(0,b.jsx)("div",{children:i===a.id?(0,b.jsxs)("div",{className:"whitespace-pre-wrap",children:[a.content,(0,b.jsx)("button",{onClick:()=>j(null),className:"text-blue-600 hover:text-blue-800 ml-2 text-xs",children:"Show less"})]}):(0,b.jsxs)("div",{children:[((a,b=50)=>a.length<=b?a:a.substring(0,b)+"...")(a.content),a.content.length>50&&(0,b.jsx)("button",{onClick:()=>j(a.id),className:"text-blue-600 hover:text-blue-800 ml-2 text-xs",children:"Show more"})]})})}),(0,b.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:[c," credit",c>1?"s":""]}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(a=>{switch(a.toLowerCase()){case"sent":case"delivered":return(0,b.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[(0,b.jsx)(e.CheckCircle,{className:"w-3 h-3"}),"delivered"===a?"Delivered":"Sent"]});case"pending":return(0,b.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[(0,b.jsx)(g.Clock,{className:"w-3 h-3"}),"Pending"]});case"failed":return(0,b.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[(0,b.jsx)(f.XCircle,{className:"w-3 h-3"}),"Failed"]});default:return(0,b.jsx)("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:a})}})(a.status)})]},a.id)})})]})})]})}])},253011,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(531811),g=a.i(964889),h=a.i(704500),i=a.i(101056),j=a.i(805297),k=a.i(643496),l=a.i(121761),m=a.i(661548),n=a.i(915561),o=a.i(959767),p=a.i(365415),q=a.i(802304),r=a.i(23963),s=a.i(115444),t=a.i(148608),u=a.i(289118),v=a.i(436028),w=a.i(2026),x=a.i(747899),y=a.i(396465),z=b([f,g,h,i,j,k,m,n,o,p,q,t,u,y]);[f,g,h,i,j,k,m,n,o,p,q,t,u,y]=z.then?(await z)():z,a.s(["default",0,()=>{let{user:a}=(0,f.useAuth)(),{currentBusiness:b,isLoading:c}=(0,g.useBusiness)(),{currentProfile:z,hasPermission:A,isLoading:B}=(0,j.useProfiles)(),C=(0,x.useNavigate)(),D=A("messages","view"),E=A("messages","create"),F=A("messages","edit"),G=A("messages","delete"),{messages:H,templates:I,purchases:J,isLoading:K,createMessage:L,createBulkMessages:M,createTemplate:N,updateTemplate:O,deleteTemplate:P,initiateCreditPurchase:Q,getMessageStats:R}=(0,h.useMessages)(a?.id),{customers:S}=(0,i.useCustomers)(),[T,U]=(0,e.useState)(!1),[V,W]=(0,e.useState)(!1),[X,Y]=(0,e.useState)(!1),[Z,$]=(0,e.useState)(!1),[_,aa]=(0,e.useState)(void 0),[ab,ac]=(0,e.useState)("messages"),[ad,ae]=(0,e.useState)(""),[af,ag]=(0,e.useState)("all"),ah=R(),ai=async a=>{try{return await L(a),{success:1,failed:0,errors:[]}}catch(a){return console.error("Failed to send message:",a),{success:0,failed:1,errors:[a instanceof Error?a.message:"Unknown error"]}}},aj=(0,e.useCallback)(async a=>{try{return await M(a)}catch(a){return console.error("Failed to send bulk messages:",a),alert(a instanceof Error?a.message:"Failed to send messages"),{success:0,failed:0,errors:[a instanceof Error?a.message:"Unknown error"]}}},[M]),ak=(0,e.useCallback)(async a=>(_?await O(_.id,a):await N(a),W(!1),aa(void 0),!0),[_,O,N]),al=(0,e.useCallback)(a=>{aa(a),W(!0)},[]),am=(0,e.useCallback)(async a=>{confirm("Are you sure you want to delete this template?")&&await P(a)},[P]),an=(0,e.useCallback)(async(a,b)=>{try{let c=await Q(a,b);return window.open(c.redirectUrl,"_blank"),$(!1),!0}catch(a){return console.error("Failed to initiate top-up:",a),alert(a instanceof Error?a.message:"Failed to initiate payment"),!1}},[Q]);if(c||!b||K||B)return(0,d.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,d.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(!D)return(0,d.jsxs)("div",{className:"max-w-4xl mx-auto p-6",children:[(0,d.jsxs)(u.Alert,{variant:"destructive",children:[(0,d.jsx)(v.AlertCircle,{className:"h-4 w-4"}),(0,d.jsx)(u.AlertTitle,{children:"Access Denied"}),(0,d.jsx)(u.AlertDescription,{children:"You do not have permission to view the messaging module. Please contact your administrator if you believe this is an error."})]}),(0,d.jsx)("div",{className:"mt-4",children:(0,d.jsxs)(y.Button,{onClick:()=>C("/"),variant:"outline",className:"gap-2",children:[(0,d.jsx)(w.ArrowLeft,{className:"h-4 w-4"}),"Back to Dashboard"]})})]});let ao=H.filter(a=>{let b=a.phoneNumber||"",c=a.content||"",d=b.toLowerCase().includes(ad.toLowerCase())||c.toLowerCase().includes(ad.toLowerCase()),e="all"===af||a.status===af;return d&&e});return(0,d.jsxs)("div",{className:"space-y-8",children:[(0,d.jsx)(k.default,{onNewMessage:()=>U(!0),onNewTemplate:()=>{aa(void 0),W(!0)},onTopUp:()=>$(!0),onBulkMessage:()=>Y(!0),smsCredits:z?.sms_credits||0,canCreate:E}),(0,d.jsx)(l.default,{stats:ah}),(0,d.jsxs)(t.Tabs,{value:ab,onValueChange:ac,className:"w-full",children:[(0,d.jsxs)(t.TabsList,{className:"grid w-full max-w-2xl grid-cols-3",children:[(0,d.jsx)(t.TabsTrigger,{value:"messages",children:"Messages"}),(0,d.jsx)(t.TabsTrigger,{value:"templates",children:"Templates"}),(0,d.jsx)(t.TabsTrigger,{value:"history",children:"History"})]}),(0,d.jsx)(t.TabsContent,{value:"messages",className:"space-y-4 mt-6",children:(0,d.jsx)(m.default,{messages:ao,customers:S,searchTerm:ad,setSearchTerm:ae,statusFilter:af,setStatusFilter:ag})}),(0,d.jsx)(t.TabsContent,{value:"templates",className:"space-y-4 mt-6",children:(0,d.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:I.map(a=>(0,d.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow border hover:shadow-md transition-shadow",children:[(0,d.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,d.jsx)("h3",{className:"font-semibold text-lg",children:a.name}),(0,d.jsxs)("div",{className:"flex gap-2",children:[F&&(0,d.jsx)("button",{onClick:()=>al(a),className:"text-blue-600 hover:text-blue-800 text-sm",children:"Edit"}),G&&(0,d.jsx)("button",{onClick:()=>am(a.id),className:"text-red-600 hover:text-red-800 text-sm",children:"Delete"})]})]}),a.category&&(0,d.jsx)("span",{className:"text-xs px-2 py-1 bg-gray-100 rounded-full text-gray-600",children:a.category}),(0,d.jsx)("p",{className:"text-sm text-gray-600 mt-2 line-clamp-3",children:a.content}),a.variables.length>0&&(0,d.jsx)("div",{className:"mt-2 flex flex-wrap gap-1",children:a.variables.map(a=>(0,d.jsx)("span",{className:"text-xs px-2 py-0.5 bg-blue-50 text-blue-600 rounded",children:a},a))})]},a.id))})}),(0,d.jsxs)(t.TabsContent,{value:"history",className:"space-y-6 mt-6",children:[(0,d.jsx)(r.default,{purchases:J}),(0,d.jsx)(s.default,{messages:H})]})]}),(0,d.jsx)(o.default,{open:V,onClose:()=>{W(!1),aa(void 0)},onSave:ak,initialData:_}),(0,d.jsx)(p.default,{open:Z,onClose:()=>$(!1),onTopUp:an}),(0,d.jsx)(n.default,{open:T,onClose:()=>U(!1),onSend:ai,customers:S,templates:I}),(0,d.jsx)(q.default,{open:X,onClose:()=>Y(!1),onSend:aj,customers:S,templates:I,searchTerm:ad,setSearchTerm:ae})]})}]),c()}catch(a){c(a)}},!1),131626,a=>a.a(async(b,c)=>{try{var d=a.i(579168),e=a.i(627068),f=a.i(332759),g=a.i(539141),h=a.i(706555),i=a.i(253011),j=a.i(509193),k=b([i]);[i]=k.then?(await k)():k;let l=(0,f.hoist)(i,"default"),m=(0,f.hoist)(i,"getStaticProps"),n=(0,f.hoist)(i,"getStaticPaths"),o=(0,f.hoist)(i,"getServerSideProps"),p=(0,f.hoist)(i,"config"),q=(0,f.hoist)(i,"reportWebVitals"),r=(0,f.hoist)(i,"unstable_getStaticProps"),s=(0,f.hoist)(i,"unstable_getStaticPaths"),t=(0,f.hoist)(i,"unstable_getStaticParams"),u=(0,f.hoist)(i,"unstable_getServerProps"),v=(0,f.hoist)(i,"unstable_getServerSideProps"),w=new d.PagesRouteModule({definition:{kind:e.RouteKind.PAGES,page:"/Messages",pathname:"/Messages",bundlePath:"",filename:""},distDir:".next",relativeProjectDir:"",components:{App:h.default,Document:g.default},userland:i}),x=(0,j.getHandler)({srcPage:"/Messages",config:p,userland:i,routeModule:w,getStaticPaths:n,getStaticProps:m,getServerSideProps:o});a.s(["config",0,p,"default",0,l,"getServerSideProps",0,o,"getStaticPaths",0,n,"getStaticProps",0,m,"handler",0,x,"reportWebVitals",0,q,"routeModule",0,w,"unstable_getServerProps",0,u,"unstable_getServerSideProps",0,v,"unstable_getStaticParams",0,t,"unstable_getStaticPaths",0,s,"unstable_getStaticProps",0,r]),c()}catch(a){c(a)}},!1)];

//# sourceMappingURL=_c724a887._.js.map