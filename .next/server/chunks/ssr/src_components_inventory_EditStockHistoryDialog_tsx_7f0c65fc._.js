module.exports=[229805,782104,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(814574),e=a.i(699570),f=a.i(866718),g=a.i(870430),h=a.i(256711),i=a.i(478793),j=a.i(890914);a.s(["default",0,({open:a,onOpenChange:k,entry:l,onConfirm:m,isInitialStock:n=!1,stockHistory:o=[],productCreatedAt:p})=>{let[q,r]=(0,c.useState)(0),[s,t]=(0,c.useState)(""),[u,v]=(0,c.useState)(!1),[w,x]=(0,c.useState)(""),{toast:y}=(0,i.useToast)(),{hasPermission:z}=(0,j.useProfiles)();(0,c.useEffect)(()=>{l&&(r(l.newQuantity-l.oldQuantity),t(l.changeReason),x(""))},[l]);let A=(a,b)=>b<0&&a>0?"Cannot change from negative to positive value.":b>0&&a<0?"Cannot change from positive to negative value.":"",B=a=>{if(""===a){r(""),x("");return}let b=parseInt(a)||0,c=A(b,""===q?0:q);c?x(c):(r(b),x(""))},C=async(a=!1)=>{if(!l)return;let b=""===q?0:q,c=A(b,l.newQuantity-l.oldQuantity);if(c)return void y({title:"Invalid quantity change",description:c,variant:"destructive"});let d=l.oldQuantity+b;if(!s.trim())return void y({title:"Invalid reason",description:"Please provide a reason for this stock change",variant:"destructive"});v(!0);try{await m(l.id,d,s.trim())?(y({title:"Stock history updated",description:"The stock history entry has been updated successfully."}),k(!1)):y({title:"Update failed",description:"Failed to update stock history entry. Please try again.",variant:"destructive"})}catch(a){console.error("Error updating stock history:",a),y({title:"Error",description:"An error occurred while updating the stock history.",variant:"destructive"})}finally{v(!1)}},D=()=>{k(!1)};if(!l)return null;if(n)return(0,b.jsx)(d.Dialog,{open:a,onOpenChange:k,children:(0,b.jsxs)(d.DialogContent,{className:"sm:max-w-md",children:[(0,b.jsxs)(d.DialogHeader,{children:[(0,b.jsx)(d.DialogTitle,{children:"Edit Initial Stock Entry"}),(0,b.jsx)(d.DialogDescription,{children:"This is the initial stock entry. You can modify quantity, reason, and date, but the date must be earlier than all other stock transactions."})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"quantity",children:"Quantity Change"}),(0,b.jsx)(f.Input,{id:"quantity",type:"number",value:q,onChange:a=>B(a.target.value),className:w?"border-destructive border-2 bg-destructive/5 focus:border-destructive focus:ring-destructive":""}),w&&(0,b.jsx)("p",{className:"text-sm text-destructive",children:w})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"reason",children:"Change Reason"}),(0,b.jsx)(f.Input,{id:"reason",value:s,onChange:a=>t(a.target.value),placeholder:"Enter reason for stock change"})]})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-2 mt-6",children:[(0,b.jsx)(e.Button,{variant:"outline",onClick:D,disabled:u,children:"Cancel"}),(0,b.jsx)(e.Button,{onClick:()=>C(),disabled:u||!z("inventory","stock_adjustment"),children:u?"Updating...":"Update Entry"})]})]})});if(["Sale","Delete sale","Deleted Sale","Sale qty edit"].some(a=>l.changeReason.toLowerCase().includes(a.toLowerCase())))return(0,b.jsx)(d.Dialog,{open:a,onOpenChange:k,children:(0,b.jsxs)(d.DialogContent,{className:"sm:max-w-md",children:[(0,b.jsxs)(d.DialogHeader,{children:[(0,b.jsx)(d.DialogTitle,{children:"Cannot Edit Sale-Related Entry"}),(0,b.jsx)(d.DialogDescription,{children:"This stock history entry was created by a sales operation and can only be modified through the Edit Sale form."})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"bg-muted p-3 rounded-lg space-y-2",children:[(0,b.jsx)("div",{className:"font-medium",children:"Entry Details:"}),(0,b.jsxs)("div",{className:"text-sm space-y-1",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Date:"})," ",(0,h.format)(l.createdAt,"PPP p")]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Change:"})," ",l.oldQuantity," → ",l.newQuantity]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Reason:"})," ",l.changeReason.replace("Deleted sale","Deleted Sale")]})]})]}),(0,b.jsx)("div",{className:"bg-blue-50 border border-blue-200 p-3 rounded-lg",children:(0,b.jsxs)("div",{className:"text-blue-800 text-sm",children:[(0,b.jsx)("strong",{children:"Note:"})," To modify this entry, please use the Edit Sale form in the Sales section."]})})]}),(0,b.jsx)("div",{className:"flex justify-end gap-2 mt-6",children:(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>k(!1),children:"Close"})})]})});let E=l.newQuantity-l.oldQuantity,F=""===q?0:q,G=l.oldQuantity+F;return(0,b.jsx)(d.Dialog,{open:a,onOpenChange:k,children:(0,b.jsxs)(d.DialogContent,{className:"sm:max-w-md",children:[(0,b.jsxs)(d.DialogHeader,{children:[(0,b.jsx)(d.DialogTitle,{children:"Edit Stock History Entry"}),(0,b.jsx)(d.DialogDescription,{children:"Modify the details of this stock history entry. The product's current stock will be recalculated after saving."})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(g.Label,{className:"text-muted-foreground",children:"Original"}),(0,b.jsxs)("div",{className:"font-medium",children:[l.oldQuantity," → ",l.newQuantity]}),(0,b.jsxs)("div",{className:`text-xs ${E>=0?"text-green-600":"text-red-600"}`,children:[E>=0?"+":"",E]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(g.Label,{className:"text-muted-foreground",children:"New"}),(0,b.jsxs)("div",{className:"font-medium",children:[l.oldQuantity," → ",G]}),(0,b.jsxs)("div",{className:`text-xs ${F>=0?"text-green-600":"text-red-600"}`,children:[F>=0?"+":"",F]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"quantity",children:"Quantity Change"}),(0,b.jsx)(f.Input,{id:"quantity",type:"number",value:q,onChange:a=>B(a.target.value),className:w?"border-destructive border-2 bg-destructive/5 focus:border-destructive focus:ring-destructive":""}),l&&(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["⚠️ ",(""===q?0:q)<0?"Current change is negative - you cannot change to positive values":"Current change is positive - you cannot change to negative values"]}),w&&(0,b.jsx)("p",{className:"text-sm text-destructive",children:w})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"reason",children:"Change Reason"}),(0,b.jsx)(f.Input,{id:"reason",value:s,onChange:a=>t(a.target.value),placeholder:"Enter reason for stock change"})]})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-2 mt-6",children:[(0,b.jsx)(e.Button,{variant:"outline",onClick:D,disabled:u,children:"Cancel"}),(0,b.jsx)(e.Button,{onClick:()=>C(),disabled:u||!z("inventory","stock_adjustment"),children:u?"Updating...":"Update Entry"})]})]})})}],229805);var k=a.i(486192),l=a.i(73570);a.s(["default",0,({open:a,onOpenChange:d,entry:e,onConfirm:f})=>{let[g,j]=(0,c.useState)(!1),{toast:m}=(0,i.useToast)(),n=async()=>{if(e){j(!0);try{await f(e.id)?(m({title:"Stock history deleted",description:"The stock history entry has been deleted and stock recalculated."}),d(!1)):m({title:"Delete failed",description:"Failed to delete stock history entry. Please try again.",variant:"destructive"})}catch(a){console.error("Error deleting stock history:",a),m({title:"Error",description:"An error occurred while deleting the stock history.",variant:"destructive"})}finally{j(!1)}}};if(!e)return null;if(["Sale","Delete sale","Deleted Sale","Sale qty edit"].some(a=>e.changeReason.toLowerCase().includes(a.toLowerCase())))return(0,b.jsx)(k.AlertDialog,{open:a,onOpenChange:d,children:(0,b.jsxs)(k.AlertDialogContent,{children:[(0,b.jsxs)(k.AlertDialogHeader,{children:[(0,b.jsxs)(k.AlertDialogTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(l.AlertTriangle,{className:"h-5 w-5 text-blue-600"}),"Cannot Delete Sale-Related Entry"]}),(0,b.jsxs)(k.AlertDialogDescription,{className:"space-y-3",children:[(0,b.jsx)("p",{children:"This stock history entry was created by a sales operation and cannot be deleted directly."}),(0,b.jsxs)("div",{className:"bg-muted p-3 rounded-lg space-y-2",children:[(0,b.jsx)("div",{className:"font-medium",children:"Entry Details:"}),(0,b.jsxs)("div",{className:"text-sm space-y-1",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Date:"})," ",(0,h.format)(e.createdAt,"PPP p")]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Change:"})," ",e.oldQuantity," → ",e.newQuantity]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Reason:"})," ",e.changeReason.replace("Deleted sale","Deleted Sale")]})]})]}),(0,b.jsx)("div",{className:"bg-blue-50 border border-blue-200 p-3 rounded-lg",children:(0,b.jsxs)("div",{className:"text-blue-800 text-sm",children:[(0,b.jsx)("strong",{children:"Note:"})," To remove this entry, please edit or delete the corresponding sale in the Sales section."]})})]})]}),(0,b.jsx)(k.AlertDialogFooter,{children:(0,b.jsx)(k.AlertDialogCancel,{children:"Close"})})]})});let o=e.newQuantity-e.oldQuantity;return(0,b.jsx)(k.AlertDialog,{open:a,onOpenChange:d,children:(0,b.jsxs)(k.AlertDialogContent,{children:[(0,b.jsxs)(k.AlertDialogHeader,{children:[(0,b.jsxs)(k.AlertDialogTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(l.AlertTriangle,{className:"h-5 w-5 text-destructive"}),"Delete Stock History Entry"]}),(0,b.jsxs)(k.AlertDialogDescription,{className:"space-y-3",children:[(0,b.jsx)("p",{children:"Are you sure you want to delete this stock history entry? This action cannot be undone."}),(0,b.jsxs)("div",{className:"bg-muted p-3 rounded-lg space-y-2",children:[(0,b.jsx)("div",{className:"font-medium",children:"Entry Details:"}),(0,b.jsxs)("div",{className:"text-sm space-y-1",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Date:"})," ",(0,h.format)(e.createdAt,"PPP p")]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Change:"})," ",e.oldQuantity," → ",e.newQuantity]}),(0,b.jsxs)("div",{className:`${o>=0?"text-green-600":"text-red-600"}`,children:[(0,b.jsx)("strong",{children:"Impact:"})," ",o>=0?"+":"",o," units"]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Reason:"})," ",e.changeReason.replace("Deleted sale","Deleted Sale")]})]})]}),(0,b.jsx)("div",{className:"bg-amber-50 border border-amber-200 p-3 rounded-lg",children:(0,b.jsxs)("div",{className:"text-amber-800 text-sm",children:[(0,b.jsx)("strong",{children:"Warning:"})," After deletion, the product's current stock will be automatically recalculated based on the remaining stock history entries."]})})]})]}),(0,b.jsxs)(k.AlertDialogFooter,{children:[(0,b.jsx)(k.AlertDialogCancel,{disabled:g,children:"Cancel"}),(0,b.jsx)(k.AlertDialogAction,{onClick:n,disabled:g,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:g?"Deleting...":"Delete Entry"})]})]})})}],782104)}];

//# sourceMappingURL=src_components_inventory_EditStockHistoryDialog_tsx_7f0c65fc._.js.map