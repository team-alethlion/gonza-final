{"version":3,"sources":["../../../../src/utils/numberToWords.ts","../../../../src/utils/generateThermalReceipt.ts","../../../../src/utils/thermalPrinterPlug.ts","../../../../src/hooks/useInstallmentPayments.ts","../../../../node_modules/lucide-react/src/icons/share-2.ts","../../../../src/utils/deviceDetection.ts","../../../../src/utils/generatePDF.ts","../../../../src/utils/directPrint.ts","../../../../src/components/ThermalReceipt.tsx","../../../../src/components/PrintableReceipt.tsx","../../../../src/components/sales/ReceiptDialog.tsx"],"sourcesContent":["\r\n/**\r\n * Converts a number to words representation\r\n * @param num The number to convert to words\r\n * @returns The number expressed in words\r\n */\r\nexport function numberToWords(num: number): string {\r\n  const specialNames = ['', 'thousand', 'million', 'billion', 'trillion', 'quadrillion'];\r\n  const tensNames = ['', 'ten', 'twenty', 'thirty', 'forty', 'fifty', 'sixty', 'seventy', 'eighty', 'ninety'];\r\n  const onesNames = ['', 'one', 'two', 'three', 'four', 'five', 'six', 'seven', 'eight', 'nine', 'ten', \r\n    'eleven', 'twelve', 'thirteen', 'fourteen', 'fifteen', 'sixteen', 'seventeen', 'eighteen', 'nineteen'];\r\n\r\n  // Handles decimals by splitting the number into whole and decimal parts\r\n  const handleDecimals = (n: number): string => {\r\n    const numStr = n.toFixed(2);\r\n    const parts = numStr.split('.');\r\n    const wholeStr = convertNumberToWords(parseInt(parts[0]));\r\n    \r\n    // If there are meaningful decimals (not just .00)\r\n    if (parts.length > 1 && parseInt(parts[1]) > 0) {\r\n      // Format the decimal part as cents\r\n      return `${wholeStr} and ${parts[1]}/100`;\r\n    }\r\n    return wholeStr;\r\n  };\r\n\r\n  // Core conversion function for whole numbers\r\n  const convertNumberToWords = (n: number): string => {\r\n    // Handle zero\r\n    if (n === 0) return 'zero';\r\n    \r\n    // Handle negative numbers\r\n    if (n < 0) return `negative ${convertNumberToWords(Math.abs(n))}`;\r\n    \r\n    let result = '';\r\n    let numIndex = 0;\r\n    \r\n    // Process the number in chunks of three digits\r\n    while (n > 0) {\r\n      if (n % 1000 !== 0) {\r\n        result = `${convertLessThanOneThousand(n % 1000)} ${specialNames[numIndex]} ${result}`;\r\n      }\r\n      n = Math.floor(n / 1000);\r\n      numIndex++;\r\n    }\r\n    \r\n    return result.trim();\r\n  };\r\n\r\n  // Converts a number less than 1000 to words\r\n  const convertLessThanOneThousand = (n: number): string => {\r\n    if (n === 0) return '';\r\n    \r\n    let result = '';\r\n    \r\n    // Handle hundreds\r\n    if (n >= 100) {\r\n      result = `${onesNames[Math.floor(n / 100)]} hundred `;\r\n      n %= 100;\r\n      if (n === 0) return result.trim();\r\n    }\r\n    \r\n    // Handle tens and ones places\r\n    if (n < 20) {\r\n      // For numbers less than 20, use the direct name\r\n      result += onesNames[n];\r\n    } else {\r\n      // For numbers 20 and above, combine tens and ones names\r\n      result += `${tensNames[Math.floor(n / 10)]}`;\r\n      if (n % 10 > 0) {\r\n        result += `-${onesNames[n % 10]}`;\r\n      }\r\n    }\r\n    \r\n    return result.trim();\r\n  };\r\n\r\n  // Start the conversion process\r\n  return handleDecimals(num).trim().charAt(0).toUpperCase() + handleDecimals(num).trim().slice(1);\r\n}\r\n","import EscPosEncoder from 'esc-pos-encoder';\r\nimport { format } from \"date-fns\";\r\nimport { formatNumber } from \"@/lib/utils\";\r\nimport { numberToWords } from \"@/utils/numberToWords\";\r\nimport { parsePaymentInfo } from \"@/hooks/useBusinessSettings\";\r\n\r\n\r\n\r\n\r\nexport async function generateThermalReceipt(sale: any, settings: any, currency?: string): Promise<Uint8Array> {\r\n    const displayCurrency = currency || settings.currency || '';\r\n    const encoder = new EscPosEncoder();\r\n\r\n    encoder.initialize();\r\n\r\n    const is80mm = settings.printerPaperSize === '80mm';\r\n\r\n    if (is80mm) {\r\n        encoder.raw([0x1d, 0x57, 0x40, 0x02]); // GS W: Set width to 576 dots (80mm)\r\n        encoder.align('left'); // User requested \"far left\" for everything\r\n    } else {\r\n        encoder.raw([0x1d, 0x4c, 0, 0]); // GS L: Reset left margin to 0\r\n        encoder.raw([0x1d, 0x57, 0x80, 0x01]); // GS W: Set printable area width (384 dots = 58mm)\r\n        encoder.align('left');\r\n    }\r\n\r\n\r\n    // ===== Business Header =====\r\n    encoder.align('left');\r\n\r\n    encoder.line(is80mm ? '='.repeat(42) : '='.repeat(32));\r\n\r\n    if (settings.businessName) {\r\n        encoder.size('double').bold(true).line(settings.businessName.toUpperCase()).bold(false).size('normal');\r\n    }\r\n    encoder.line(is80mm ? '='.repeat(42) : '='.repeat(32));\r\n\r\n    if (settings.businessAddress) encoder.line(settings.businessAddress);\r\n    if (settings.businessPhone) encoder.line(`Tel: ${settings.businessPhone}`);\r\n    if (settings.businessEmail) encoder.line(settings.businessEmail);\r\n    encoder.line(is80mm ? '-'.repeat(42) : '-'.repeat(32)); // Wider line for 80mm\r\n\r\n    // ===== Document Title =====\r\n    const titleMap: Record<string, string> = {\r\n        \"Quote\": \"QUOTATION\",\r\n        \"Paid\": \"SALES RECEIPT\",\r\n        \"Installment Sale\": \"INSTALLMENT SALE\",\r\n        \"NOT PAID\": \"INVOICE\",\r\n    };\r\n    const docTitle = titleMap[sale.paymentStatus] || \"INVOICE\";\r\n    encoder.bold(true).line(docTitle).bold(false);\r\n\r\n    encoder.line(is80mm ? '-'.repeat(42) : '-'.repeat(32));\r\n\r\n    // ===== Receipt Info (Apply 10mm margin) =====\r\n    encoder.raw([0x1d, 0x4c, 0, 0]);\r\n    encoder.align('left');\r\n\r\n\r\n    encoder.table(\r\n        [\r\n            { width: 12, align: 'left' },\r\n            { width: 16, align: 'right' }\r\n        ],\r\n        [\r\n            ['Receipt #:', sale.receiptNumber || ''],\r\n            ['Date:', format(new Date(sale.date || Date.now()), \"MMM dd, yyyy\")],\r\n            ['Status:', sale.paymentStatus || '']\r\n        ]\r\n    );\r\n    encoder.line(is80mm ? '-'.repeat(42) : '-'.repeat(32));\r\n\r\n    // ===== Customer Info =====\r\n    if (sale.customerName) {\r\n        encoder.line(`Customer: ${sale.customerName}`);\r\n        if (sale.customerAddress) encoder.line(`Address: ${sale.customerAddress}`);\r\n        if (sale.customerContact) encoder.line(`Contact: ${sale.customerContact}`);\r\n        encoder.line(is80mm ? '-'.repeat(42) : '-'.repeat(32));\r\n    }\r\n\r\n    // ===== Items Table Definition =====\r\n    // 58mm (32 chars): Item(14) + Spacer(3) + Qty(5) + Tot(10) = 32\r\n    // 80mm (42 chars): Item(22) + Spacer(4) + Qty(6) + Tot(10) = 42\r\n    // 58mm (32 chars): Item(12) + Spacer(1) + Qty(5) + Tot(14) = 32\r\n    // 80mm (42 chars): Item(21) + Spacer(1) + Qty(6) + Tot(14) = 42\r\n    const tableColumns = is80mm\r\n        ? [\r\n            { width: 21, align: 'left' },\r\n            { width: 1, align: 'center' },\r\n            { width: 6, align: 'right' },\r\n            { width: 14, align: 'right' }\r\n        ]\r\n        : [\r\n            { width: 12, align: 'left' },\r\n            { width: 1, align: 'center' },\r\n            { width: 5, align: 'right' },\r\n            { width: 14, align: 'right' }\r\n        ];\r\n\r\n    encoder.table(\r\n        tableColumns,\r\n        [\r\n            ['Item', '', 'Qty', `Total`]\r\n        ]\r\n    );\r\n    encoder.line(is80mm ? '-'.repeat(42) : '-'.repeat(32));\r\n\r\n    let subtotalBeforeDiscount = 0;\r\n    let totalDiscountAmount = 0;\r\n\r\n    Array.isArray(sale.items) && sale.items.forEach((item: any) => {\r\n        const quantity = item.quantity || 0;\r\n        const price = item.price || 0;\r\n        const subtotal = quantity * price;\r\n        const discount = item.discountAmount ?? ((subtotal * (item.discountPercentage || 0)) / 100);\r\n        const total = subtotal - discount;\r\n\r\n        subtotalBeforeDiscount += subtotal;\r\n        totalDiscountAmount += discount;\r\n\r\n        encoder.table(\r\n            tableColumns,\r\n            [\r\n                [item.description || '', '', String(quantity), formatNumber(total)]\r\n            ]\r\n        );\r\n\r\n        if (discount > 0) {\r\n            const discText = item.discountType === \"amount\" ? \"\" : `(${item.discountPercentage || 0}%)`;\r\n            encoder.italic(true).table(\r\n                [\r\n                    { width: 22, align: 'left' },\r\n                    { width: 10, align: 'right' }\r\n                ],\r\n                [\r\n                    [`  Discount ${discText}`, `-${formatNumber(discount)}`]\r\n                ]\r\n            ).italic(false);\r\n        }\r\n\r\n        encoder.line(is80mm ? '-'.repeat(42) : '-'.repeat(32));\r\n    });\r\n\r\n    // ===== Totals (Vertical Layout as requested) =====\r\n    const subtotalAfterDiscount = subtotalBeforeDiscount - totalDiscountAmount;\r\n    const taxRate = sale.taxRate || 0;\r\n    const taxAmount = subtotalAfterDiscount * (taxRate / 100);\r\n    const totalAmount = subtotalAfterDiscount + taxAmount;\r\n\r\n    // For installment sales, sum up all payments from history if available\r\n    const totalPaidFromHistory = Array.isArray(sale.payments)\r\n        ? sale.payments.reduce((sum: number, p: any) => sum + (Number(p.amount) || 0), 0)\r\n        : 0;\r\n\r\n    const amountPaid = (sale.paymentStatus === 'Installment Sale' && totalPaidFromHistory > 0)\r\n        ? totalPaidFromHistory\r\n        : (Number(sale.amountPaid) || 0);\r\n\r\n    const amountDue = sale.paymentStatus === 'Installment Sale'\r\n        ? Math.max(0, totalAmount - totalPaidFromHistory)\r\n        : Math.max(0, totalAmount - amountPaid);\r\n\r\n    encoder.newline();\r\n\r\n    const totalsColumns = [\r\n        { width: 14, align: 'left' },\r\n        { width: is80mm ? 28 : 18, align: 'right' }\r\n    ];\r\n\r\n    encoder.table(totalsColumns, [\r\n        [\"Subtotal:\", `${displayCurrency} ${formatNumber(subtotalBeforeDiscount)}`]\r\n    ]);\r\n\r\n    if (totalDiscountAmount > 0) {\r\n        encoder.table(totalsColumns, [\r\n            [\"Total Discount:\", `-${displayCurrency} ${formatNumber(totalDiscountAmount)}`]\r\n        ]);\r\n    }\r\n\r\n    if (taxRate > 0) {\r\n        encoder.table(totalsColumns, [\r\n            [`Tax (${taxRate}%):`, `${displayCurrency} ${formatNumber(taxAmount)}`]\r\n        ]);\r\n    }\r\n\r\n    encoder.bold(true).table(totalsColumns, [\r\n        [\"TOTAL:\", `${displayCurrency} ${formatNumber(totalAmount)}`]\r\n    ]).bold(false);\r\n\r\n    if (sale.paymentStatus === \"Installment Sale\") {\r\n        encoder.table(totalsColumns, [\r\n            [\"Amount Paid:\", `${displayCurrency} ${formatNumber(amountPaid)}`],\r\n            [\"Amount Due:\", `${displayCurrency} ${formatNumber(amountDue)}`]\r\n        ]);\r\n    }\r\n\r\n    encoder.line(is80mm ? '-'.repeat(42) : '-'.repeat(32));\r\n    encoder.text(`Amount in words:\\n${numberToWords(totalAmount)} only\\n`);\r\n    encoder.line(is80mm ? '-'.repeat(42) : '-'.repeat(32));\r\n\r\n    // Reset margin for the rest of the receipt (Payment Info, Signature, Footer)\r\n    encoder.raw([0x1d, 0x4c, 0, 0]);\r\n    encoder.align('left');\r\n\r\n\r\n\r\n    // ===== Payment Info =====\r\n    const paymentMethods = settings.paymentInfo ? parsePaymentInfo(settings.paymentInfo) : [];\r\n    if (Array.isArray(paymentMethods) && paymentMethods.length > 0) {\r\n        paymentMethods.forEach((p: any) => {\r\n            if (p.method || p.accountNumber || p.accountName) {\r\n                encoder.bold(true).line(p.method || '').bold(false);\r\n                if (p.accountNumber) encoder.line(`Acc: ${p.accountNumber}`);\r\n                if (p.accountName) encoder.line(`Name: ${p.accountName}`);\r\n                encoder.line(is80mm ? '-'.repeat(42) : '-'.repeat(32));\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n    // ===== Footer =====\r\n    encoder.line(\"Thank you for your business!\");\r\n    encoder.size('small').line(\"Created by Gonza Systems\").size('normal');\r\n    encoder.line(is80mm ? '='.repeat(42) : '='.repeat(32));\r\n\r\n    // Cut paper\r\n    encoder.newline().newline().newline().cut();\r\n\r\n    return encoder.encode();\r\n}\r\n\r\n","import { Capacitor } from '@capacitor/core';\r\n\r\nexport async function checkBridgeStatus() {\r\n  const addresses = ['http://localhost:5000', 'http://127.0.0.1:5000'];\r\n\r\n  for (const addr of addresses) {\r\n    try {\r\n      const response = await fetch(`${addr}/printers`, {\r\n        signal: AbortSignal.timeout(2000),\r\n        mode: 'cors'\r\n      });\r\n      if (response.ok) {\r\n        return true;\r\n      }\r\n    } catch (error) {\r\n      // Continue to next address\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\nexport async function print(data: string | Uint8Array, printerNameOverride?: string) {\r\n  const platform = Capacitor.getPlatform();\r\n\r\n  if (platform === 'web') {\r\n    // Prefer Printer Bridge if on web\r\n    try {\r\n      const isBinary = data instanceof Uint8Array;\r\n      const endpoint = 'http://localhost:5000/print/receipt';\r\n\r\n      // Use provided printer name, or try to get it from localStorage (fallback to Receipt Printer)\r\n      let printerName = printerNameOverride;\r\n      if (!printerName) {\r\n        try {\r\n          const settings = JSON.parse(localStorage.getItem('business-settings') || '{}');\r\n          printerName = settings.defaultPrinterName;\r\n        } catch (e) {\r\n          // Ignore parse errors\r\n        }\r\n      }\r\n\r\n      if (!printerName) printerName = 'Receipt Printer';\r\n\r\n      const body = {\r\n        PrinterName: printerName,\r\n        Content: isBinary ? String.fromCharCode(...(data as Uint8Array)) : data\r\n      };\r\n\r\n      const response = await fetch(endpoint, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        mode: 'cors',\r\n        body: JSON.stringify(body)\r\n      });\r\n\r\n      if (response.ok) {\r\n        return { success: true, message: 'Print command sent to bridge.' };\r\n      }\r\n    } catch (err) {\r\n      console.warn('Printer Bridge not available, falling back to Web Serial', err);\r\n    }\r\n\r\n    // Fallback to Web Serial for standard text data\r\n    if (typeof data === 'string') {\r\n      const { printWeb } = await import('./thermalPrinterWeb');\r\n      return await printWeb(data);\r\n    } else {\r\n      return { success: false, message: 'Printer Bridge required for binary ESC/POS printing.' };\r\n    }\r\n  } else {\r\n    // Native platforms use Bluetooth\r\n    const { printBluetooth } = await import('./thermalPrinterNative');\r\n    // Native print might only support strings for now, convert if needed\r\n    const stringData = typeof data === 'string' ? data : new TextDecoder().decode(data);\r\n    return await printBluetooth(stringData);\r\n  }\r\n}\r\n","import { useState, useEffect, useCallback } from 'react';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { useAuth } from '@/components/auth/AuthProvider';\r\nimport {\r\n  getInstallmentPaymentsAction,\r\n  createInstallmentPaymentAction,\r\n  updateInstallmentPaymentAction,\r\n  deleteInstallmentPaymentAction,\r\n  linkInstallmentToCashAction,\r\n  unlinkInstallmentFromCashAction\r\n} from '@/app/actions/finance';\r\n\r\nexport interface InstallmentPayment {\r\n  id: string;\r\n  saleId: string;\r\n  userId: string;\r\n  amount: number;\r\n  paymentDate: Date;\r\n  notes?: string;\r\n  cashTransactionId?: string;\r\n  createdAt: Date;\r\n  updatedAt: Date;\r\n}\r\n\r\nexport const useInstallmentPayments = (saleId?: string) => {\r\n  const [payments, setPayments] = useState<InstallmentPayment[]>([]);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const { toast } = useToast();\r\n  const { user } = useAuth();\r\n\r\n  const fetchPayments = useCallback(async (targetSaleId: string) => {\r\n    try {\r\n      setIsLoading(true);\r\n      const result = await getInstallmentPaymentsAction(targetSaleId);\r\n\r\n      if (!result.success || !result.data) throw new Error(result.error);\r\n\r\n      const formattedPayments: InstallmentPayment[] = result.data.map((payment: any) => ({\r\n        ...payment,\r\n        paymentDate: new Date(payment.paymentDate),\r\n        createdAt: new Date(payment.createdAt),\r\n        updatedAt: new Date(payment.updatedAt)\r\n      }));\r\n\r\n      setPayments(formattedPayments);\r\n    } catch (error) {\r\n      console.error('Error fetching installment payments:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to load payment history\",\r\n        variant: \"destructive\"\r\n      });\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, [toast]);\r\n\r\n  const createPayment = async (payment: {\r\n    saleId: string;\r\n    amount: number;\r\n    notes?: string;\r\n    accountId?: string;\r\n    locationId?: string;\r\n    paymentDate?: Date;\r\n  }) => {\r\n    if (!user) return null;\r\n\r\n    try {\r\n      const result = await createInstallmentPaymentAction({\r\n        ...payment,\r\n        userId: user.id,\r\n        paymentDate: payment.paymentDate?.toISOString()\r\n      });\r\n\r\n      if (!result.success || !result.data) throw new Error(result.error);\r\n\r\n      const newPayment: InstallmentPayment = {\r\n        ...result.data,\r\n        paymentDate: new Date(result.data.paymentDate),\r\n        createdAt: new Date(result.data.createdAt),\r\n        updatedAt: new Date(result.data.updatedAt)\r\n      };\r\n\r\n      setPayments(prev => [newPayment, ...prev]);\r\n      return newPayment;\r\n    } catch (error) {\r\n      console.error('Error creating payment:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to record payment\",\r\n        variant: \"destructive\"\r\n      });\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const updatePayment = async (paymentId: string, updates: {\r\n    amount?: number;\r\n    notes?: string;\r\n    paymentDate?: Date;\r\n  }) => {\r\n    try {\r\n      const result = await updateInstallmentPaymentAction(paymentId, {\r\n        ...updates,\r\n        paymentDate: updates.paymentDate?.toISOString()\r\n      });\r\n\r\n      if (!result.success || !result.data) throw new Error(result.error);\r\n\r\n      const updatedPayment: InstallmentPayment = {\r\n        ...result.data,\r\n        paymentDate: new Date(result.data.paymentDate),\r\n        createdAt: new Date(result.data.createdAt),\r\n        updatedAt: new Date(result.data.updatedAt)\r\n      };\r\n\r\n      setPayments(prev => prev.map(p => p.id === paymentId ? updatedPayment : p));\r\n      toast({\r\n        title: \"Success\",\r\n        description: \"Payment updated successfully\",\r\n      });\r\n      return updatedPayment;\r\n    } catch (error: any) {\r\n      console.error('Error updating payment:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: error.message || \"Failed to update payment\",\r\n        variant: \"destructive\"\r\n      });\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const deletePayment = async (paymentId: string) => {\r\n    try {\r\n      const result = await deleteInstallmentPaymentAction(paymentId);\r\n      if (!result.success) throw new Error(result.error);\r\n\r\n      setPayments(prev => prev.filter(p => p.id !== paymentId));\r\n      toast({\r\n        title: \"Success\",\r\n        description: \"Payment deleted successfully\",\r\n      });\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error deleting payment:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to delete payment\",\r\n        variant: \"destructive\"\r\n      });\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const linkPaymentToCashAccount = async (paymentId: string, accountId: string, locationId: string) => {\r\n    if (!user) return;\r\n    try {\r\n      const result = await linkInstallmentToCashAction(paymentId, accountId, locationId, user.id);\r\n      if (!result.success || !result.data) throw new Error(result.error);\r\n\r\n      setPayments(prev => prev.map(p =>\r\n        p.id === paymentId\r\n          ? { ...p, cashTransactionId: result.data.id }\r\n          : p\r\n      ));\r\n\r\n      toast({\r\n        title: \"Success\",\r\n        description: \"Payment linked to cash account successfully\",\r\n      });\r\n    } catch (error: any) {\r\n      console.error('Error linking payment:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: error.message || \"Failed to link payment\",\r\n        variant: \"destructive\"\r\n      });\r\n    }\r\n  };\r\n\r\n  const unlinkPaymentFromCashAccount = async (paymentId: string) => {\r\n    try {\r\n      const result = await unlinkInstallmentFromCashAction(paymentId);\r\n      if (!result.success) throw new Error(result.error);\r\n\r\n      setPayments(prev => prev.map(p =>\r\n        p.id === paymentId\r\n          ? { ...p, cashTransactionId: undefined }\r\n          : p\r\n      ));\r\n\r\n      toast({\r\n        title: \"Success\",\r\n        description: \"Payment unlinked from cash account successfully\",\r\n      });\r\n    } catch (error: any) {\r\n      console.error('Error unlinking payment:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: error.message || \"Failed to unlink payment\",\r\n        variant: \"destructive\"\r\n      });\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (saleId) {\r\n      fetchPayments(saleId);\r\n    }\r\n  }, [saleId, fetchPayments]);\r\n\r\n  return {\r\n    payments,\r\n    isLoading,\r\n    fetchPayments,\r\n    createPayment,\r\n    updatePayment,\r\n    deletePayment,\r\n    linkPaymentToCashAccount,\r\n    unlinkPaymentFromCashAccount\r\n  };\r\n};\r\n","import createLucideIcon from '../createLucideIcon';\n\n/**\n * @component @name Share2\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8Y2lyY2xlIGN4PSIxOCIgY3k9IjUiIHI9IjMiIC8+CiAgPGNpcmNsZSBjeD0iNiIgY3k9IjEyIiByPSIzIiAvPgogIDxjaXJjbGUgY3g9IjE4IiBjeT0iMTkiIHI9IjMiIC8+CiAgPGxpbmUgeDE9IjguNTkiIHgyPSIxNS40MiIgeTE9IjEzLjUxIiB5Mj0iMTcuNDkiIC8+CiAgPGxpbmUgeDE9IjE1LjQxIiB4Mj0iOC41OSIgeTE9IjYuNTEiIHkyPSIxMC40OSIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/share-2\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Share2 = createLucideIcon('Share2', [\n  ['circle', { cx: '18', cy: '5', r: '3', key: 'gq8acd' }],\n  ['circle', { cx: '6', cy: '12', r: '3', key: 'w7nqdw' }],\n  ['circle', { cx: '18', cy: '19', r: '3', key: '1xt0gg' }],\n  ['line', { x1: '8.59', x2: '15.42', y1: '13.51', y2: '17.49', key: '47mynk' }],\n  ['line', { x1: '15.41', x2: '8.59', y1: '6.51', y2: '10.49', key: '1n3mei' }],\n]);\n\nexport default Share2;\n","// Function to detect iOS devices\r\nexport const isIOS = (): boolean => {\r\n  const ua = navigator.userAgent || \"\";\r\n  // If it's Android, it's NOT iOS\r\n  if (/android/i.test(ua)) return false;\r\n\r\n  return /iPad|iPhone|iPod/.test(ua) ||\r\n    (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);\r\n};\r\n\r\n// Function to detect Android devices\r\nexport const isAndroid = (): boolean => {\r\n  const ua = navigator.userAgent || \"\";\r\n  return /android/i.test(ua);\r\n};\r\n","import { generateReceiptVectorPDF } from './generateReceiptVectorPDF';\r\nimport { isIOS } from './deviceDetection';\r\nimport { ReceiptData } from '@/types/receipt';\r\n\r\ninterface PDFOptions {\r\n  autoPrint?: boolean;\r\n  isReceipt?: boolean;\r\n}\r\n\r\n// Legacy function for non-receipt PDFs (keeping image-based approach for now)\r\nconst generateImagePDF = async (element: HTMLElement, filename: string, options: PDFOptions = {}) => {\r\n  const { generateVectorPDF } = await import('./generateVectorPDF');\r\n  await generateVectorPDF(element, {\r\n    filename,\r\n    orientation: 'landscape',\r\n    format: 'a4',\r\n    margins: { top: 10, right: 10, bottom: 10, left: 10 }\r\n  });\r\n};\r\n\r\nexport const generatePDF = async (\r\n  element: HTMLElement, \r\n  filename: string, \r\n  options: PDFOptions = {}\r\n): Promise<void> => {\r\n  const { autoPrint = false, isReceipt = false } = options;\r\n\r\n  try {\r\n    if (isIOS()) {\r\n      // For iOS, use the original approach\r\n      await generateImagePDF(element, filename, options);\r\n    } else {\r\n      // For receipts, we'll need to extract data from the element\r\n      // For now, fall back to image-based approach for non-receipt PDFs\r\n      if (!isReceipt) {\r\n        await generateImagePDF(element, filename, options);\r\n      } else {\r\n        // This will be handled by the PrintableReceipt component\r\n        // which will call generateReceiptVectorPDF directly with structured data\r\n        await generateImagePDF(element, filename, options);\r\n      }\r\n\r\n      if (autoPrint) {\r\n        setTimeout(() => {\r\n          window.print();\r\n        }, 500);\r\n      }\r\n    }\r\n  } catch (error) {\r\n    console.error('Error generating PDF:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n// Export the new vector PDF function for direct use\r\nexport { generateReceiptVectorPDF };\r\n","\r\n/**\r\n * Triggers the device's native print functionality\r\n * Works on iOS, Android, and desktop browsers\r\n */\r\nexport const directPrint = (element: HTMLElement, documentName?: string, isThermal?: boolean): void => {\r\n  // Create a new window for printing\r\n  const printWindow = window.open('', '_blank');\r\n\r\n  if (!printWindow) {\r\n    // Fallback: use current window print if popup is blocked\r\n    window.print();\r\n    return;\r\n  }\r\n\r\n  // Get all stylesheets from the current document\r\n  const stylesheets = Array.from(document.styleSheets);\r\n  let stylesHtml = '';\r\n\r\n  // Include all CSS rules\r\n  stylesheets.forEach(stylesheet => {\r\n    try {\r\n      if (stylesheet.href) {\r\n        // External stylesheet\r\n        stylesHtml += `<link rel=\"stylesheet\" href=\"${stylesheet.href}\">`;\r\n      } else if (stylesheet.cssRules) {\r\n        // Inline stylesheet\r\n        stylesHtml += '<style>';\r\n        Array.from(stylesheet.cssRules).forEach(rule => {\r\n          stylesHtml += rule.cssText;\r\n        });\r\n        stylesHtml += '</style>';\r\n      }\r\n    } catch (e) {\r\n      // Some stylesheets might not be accessible due to CORS\r\n      console.warn('Could not access stylesheet:', e);\r\n    }\r\n  });\r\n\r\n  // Use the provided document name or default to \"Print\"\r\n  const title = documentName || 'Print';\r\n\r\n  // Thermal-specific CSS for single-sheet printing\r\n  const thermalCSS = isThermal ? `\r\n    @page { \r\n      size: 80mm auto; \r\n      margin: 0; \r\n    }\r\n    .thermal-receipt { \r\n      font-size: 14px !important; \r\n      font-weight: 800 !important;\r\n      padding: 8px !important;\r\n      page-break-after: avoid !important;\r\n    }\r\n    .thermal-receipt .font-extrabold { \r\n      font-weight: 900 !important; \r\n    }\r\n    .thermal-receipt .font-bold { \r\n      font-weight: 800 !important; \r\n    }\r\n  ` : '';\r\n\r\n  // Create the print document\r\n  printWindow.document.write(`\r\n    <!DOCTYPE html>\r\n    <html>\r\n      <head>\r\n        <title>${title}</title>\r\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n        ${stylesHtml}\r\n        <style>\r\n          @media print {\r\n            body { margin: 0; }\r\n            .print\\\\:hidden { display: none !important; }\r\n            ${thermalCSS}\r\n          }\r\n          body {\r\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\r\n            margin: ${isThermal ? '0' : '20px'};\r\n          }\r\n        </style>\r\n      </head>\r\n      <body>\r\n        ${element.outerHTML}\r\n      </body>\r\n    </html>\r\n  `);\r\n\r\n  printWindow.document.close();\r\n\r\n  // Track if we've already handled the cleanup\r\n  let cleanupHandled = false;\r\n\r\n  // Cleanup function to avoid duplicate redirects\r\n  const handleCleanup = () => {\r\n    if (cleanupHandled) return;\r\n    cleanupHandled = true;\r\n\r\n    try {\r\n      if (!printWindow.closed) {\r\n        printWindow.close();\r\n      }\r\n    } catch (error) {\r\n      console.warn('Could not close print window:', error);\r\n    }\r\n\r\n    // No redirect needed - user stays on current page after printing\r\n  };\r\n\r\n  // Wait for content to load, then trigger print\r\n  printWindow.onload = () => {\r\n    printWindow.focus();\r\n    printWindow.print();\r\n\r\n    // Listen for when the print dialog is closed\r\n    printWindow.onafterprint = () => {\r\n      handleCleanup();\r\n    };\r\n\r\n    // Listen for beforeunload to detect cancel scenarios\r\n    printWindow.onbeforeunload = () => {\r\n      if (!cleanupHandled) {\r\n        setTimeout(handleCleanup, 100);\r\n      }\r\n    };\r\n\r\n    // Reduced timeout for better UX - close after 1.5 seconds\r\n    setTimeout(() => {\r\n      handleCleanup();\r\n    }, 1500);\r\n  };\r\n\r\n  // Error handling for window load failure\r\n  printWindow.onerror = () => {\r\n    console.warn('Print window failed to load');\r\n    handleCleanup();\r\n  };\r\n};\r\n","\r\nimport React, { useRef, useEffect, useState } from 'react';\r\nimport { Sale, BusinessSettings } from '@/types';\r\nimport { format } from 'date-fns';\r\nimport { formatNumber } from '@/lib/utils';\r\nimport { parsePaymentInfo, useBusinessSettings } from '@/hooks/useBusinessSettings';\r\nimport { numberToWords } from '@/utils/numberToWords';\r\nimport { useInstallmentPayments } from '@/hooks/useInstallmentPayments';\r\n\r\ninterface ThermalReceiptProps {\r\n  sale: Sale;\r\n  currency?: string;\r\n  includePaymentInfo?: boolean;\r\n}\r\n\r\nconst ThermalReceipt: React.FC<ThermalReceiptProps> = ({\r\n  sale,\r\n  currency,\r\n  includePaymentInfo = true\r\n}) => {\r\n  const { settings, isLoading: settingsLoading } = useBusinessSettings();\r\n  const { payments } = useInstallmentPayments(sale.id);\r\n\r\n  if (settingsLoading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center p-12 bg-gray-50 rounded-lg\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto mb-4\"></div>\r\n          <p className=\"text-sm text-gray-500 font-mono\">Preparing receipt...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const getDocumentTitle = () => {\r\n    switch (sale.paymentStatus) {\r\n      case 'Quote': return 'QUOTATION';\r\n      case 'Paid': return 'SALES RECEIPT';\r\n      case 'Installment Sale': return 'INSTALLMENT SALE';\r\n      case 'NOT PAID':\r\n      default: return 'INVOICE';\r\n    }\r\n  };\r\n\r\n  const getDocumentNumberLabel = () => {\r\n    switch (sale.paymentStatus) {\r\n      case 'Quote': return 'Quote #:';\r\n      case 'Paid': return 'Receipt #:';\r\n      case 'Installment Sale': return 'Installment #:';\r\n      default: return 'Invoice #:';\r\n    }\r\n  };\r\n\r\n  const subtotalBeforeDiscount = sale.items.reduce((total, item) => total + (item.price * item.quantity), 0);\r\n  const totalDiscountAmount = sale.items.reduce((total, item) => {\r\n    const itemSubtotal = item.price * item.quantity;\r\n    const discountAmount = item.discountType === 'amount'\r\n      ? (item.discountAmount || 0)\r\n      : (itemSubtotal * (item.discountPercentage || 0)) / 100;\r\n    return total + discountAmount;\r\n  }, 0);\r\n\r\n  const subtotalAfterDiscount = subtotalBeforeDiscount - totalDiscountAmount;\r\n  const taxRate = sale.taxRate || 0;\r\n  const taxAmount = subtotalAfterDiscount * (taxRate / 100);\r\n  const totalAmount = subtotalAfterDiscount + taxAmount;\r\n  const totalPaidFromHistory = (payments || []).reduce((sum, p) => sum + (p.amount || 0), 0);\r\n\r\n  const displayAmountPaid = sale.paymentStatus === 'Installment Sale' || (sale.paymentStatus === 'Paid' && totalPaidFromHistory > 0)\r\n    ? totalPaidFromHistory\r\n    : (sale.amountPaid || totalAmount);\r\n\r\n  const displayAmountDue = sale.paymentStatus === 'Installment Sale'\r\n    ? Math.max(0, totalAmount - totalPaidFromHistory)\r\n    : (sale.amountDue || 0);\r\n\r\n  const paymentMethods = settings.paymentInfo ? parsePaymentInfo(settings.paymentInfo) : [];\r\n  const hasPaymentInfo = includePaymentInfo &&\r\n    paymentMethods.length > 0 &&\r\n    paymentMethods.some(pm => pm.method.trim() !== '' || pm.accountNumber.trim() !== '' || pm.accountName.trim() !== '');\r\n\r\n  const displayCurrency = currency || settings.currency;\r\n  const receiptDate = new Date(sale.date);\r\n  const currentDateTime = new Date();\r\n\r\n  return (\r\n    <div className=\"flex justify-center bg-gray-100 p-4 sm:p-8 overflow-hidden\">\r\n      {/* Simulation of Thermal Paper */}\r\n      <div\r\n        className=\"relative bg-white shadow-2xl font-mono text-[11px] leading-tight text-black flex flex-col mx-auto\"\r\n        style={{\r\n          width: '58mm',\r\n          minHeight: '140mm',\r\n          padding: '6mm 4mm',\r\n          boxShadow: '0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1)',\r\n          borderTop: '1px dashed #e5e7eb',\r\n          borderBottom: '1px dashed #e5e7eb',\r\n        }}\r\n      >\r\n        {/* Serrated Edge Pattern (Top) */}\r\n        <div className=\"absolute top-0 left-0 w-full h-1 overflow-hidden flex\" style={{ opacity: 0.2 }}>\r\n          {Array.from({ length: 20 }).map((_, i) => (\r\n            <div key={i} className=\"w-4 h-4 bg-gray-300 transform rotate-45 -translate-y-2 translate-x-1\" />\r\n          ))}\r\n        </div>\r\n\r\n        {/* Header Section */}\r\n        <div className=\"flex flex-col items-center mb-4 text-center\">\r\n          {settings.businessLogo && (\r\n            <div className=\"mb-2 w-full flex justify-center\">\r\n              <img\r\n                src={settings.businessLogo}\r\n                alt=\"Logo\"\r\n                className=\"h-12 w-auto object-contain max-w-[40mm]\"\r\n              />\r\n            </div>\r\n          )}\r\n          <div className=\"text-[14px] font-black uppercase tracking-tight mb-0.5\">{settings.businessName}</div>\r\n          <div className=\"text-[9px] font-bold opacity-80\">{settings.businessAddress}</div>\r\n          <div className=\"text-[9px] font-bold opacity-80\">TEL: {settings.businessPhone}</div>\r\n          {settings.businessEmail && (\r\n            <div className=\"text-[9px] font-bold opacity-80 lowercase\">{settings.businessEmail}</div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Separator */}\r\n        <div className=\"border-b border-black border-dashed w-full my-2\"></div>\r\n\r\n        {/* Document Title & Basic Info */}\r\n        <div className=\"text-center mb-3\">\r\n          <div className=\"text-[12px] font-black underline mb-1\">{getDocumentTitle()}</div>\r\n          <div className=\"flex justify-between text-[9px] font-bold\">\r\n            <span>{getDocumentNumberLabel()}</span>\r\n            <span>{sale.receiptNumber}</span>\r\n          </div>\r\n          <div className=\"flex justify-between text-[9px]\">\r\n            <span>DATE:</span>\r\n            <span>{format(receiptDate, 'dd/MM/yyyy')}</span>\r\n          </div>\r\n          <div className=\"flex justify-between text-[9px]\">\r\n            <span>TIME:</span>\r\n            <span>{format(currentDateTime, 'HH:mm')}</span>\r\n          </div>\r\n          <div className=\"flex justify-between text-[9px] font-black\">\r\n            <span>STATUS:</span>\r\n            <span>{sale.paymentStatus.toUpperCase()}</span>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Customer Section */}\r\n        {sale.customerName && (\r\n          <div className=\"mb-3 bg-gray-50 p-1.5 border border-gray-100 italic\">\r\n            <div className=\"font-black text-[9px] not-italic uppercase mb-0.5\">Customer:</div>\r\n            <div className=\"font-bold\">{sale.customerName}</div>\r\n            {sale.customerAddress && <div className=\"text-[9px] opacity-70\">{sale.customerAddress}</div>}\r\n            {sale.customerContact && <div className=\"text-[9px] opacity-70\">{sale.customerContact}</div>}\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"border-b border-black border-dashed w-full my-2\"></div>\r\n\r\n        {/* Items Table */}\r\n        <div className=\"mb-4\">\r\n          <div className=\"flex justify-between font-black text-[9px] pb-1 border-b border-black mb-1.5 uppercase\">\r\n            <span className=\"w-[60%]\">Description</span>\r\n            <span className=\"w-[15%] text-right\">Qty</span>\r\n            <span className=\"w-[25%] text-right\">Amt</span>\r\n          </div>\r\n\r\n          {sale.items.map((item, index) => {\r\n            const itemSubtotal = item.quantity * item.price;\r\n            const discountAmount = item.discountType === 'amount'\r\n              ? (item.discountAmount || 0)\r\n              : (itemSubtotal * (item.discountPercentage || 0)) / 100;\r\n            const finalAmount = itemSubtotal - discountAmount;\r\n\r\n            return (\r\n              <div key={index} className=\"mb-2 last:mb-0\">\r\n                <div className=\"font-bold text-[10px] break-words uppercase\">{item.description}</div>\r\n                <div className=\"flex justify-between text-[9px] items-center\">\r\n                  <span className=\"text-gray-600 font-bold truncate\">\r\n                    {formatNumber(item.price)}\r\n                  </span>\r\n                  <div className=\"flex-1 border-b border-dotted border-gray-300 mx-2\"></div>\r\n                  <span className=\"font-bold\">\r\n                    {formatNumber(item.quantity).padStart(2, '0')}x {formatNumber(finalAmount)}\r\n                  </span>\r\n                </div>\r\n                {discountAmount > 0 && (\r\n                  <div className=\"flex justify-between text-[8px] italic text-gray-500 font-bold\">\r\n                    <span>- DISCOUNT {item.discountType === 'percentage' ? `(${item.discountPercentage}%)` : ''}</span>\r\n                    <span>-{formatNumber(discountAmount)}</span>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n\r\n        <div className=\"border-b border-black border-dashed w-full my-2\"></div>\r\n\r\n        {/* Totals Section */}\r\n        <div className=\"mb-4 space-y-0.5\">\r\n          <div className=\"flex justify-between font-bold\">\r\n            <span>SUBTOTAL:</span>\r\n            <span>{displayCurrency} {formatNumber(subtotalBeforeDiscount)}</span>\r\n          </div>\r\n          {totalDiscountAmount > 0 && (\r\n            <div className=\"flex justify-between font-bold italic opacity-70\">\r\n              <span>DISCOUNT:</span>\r\n              <span>-{displayCurrency} {formatNumber(totalDiscountAmount)}</span>\r\n            </div>\r\n          )}\r\n          {taxRate > 0 && (\r\n            <div className=\"flex justify-between font-bold\">\r\n              <span>TAX ({taxRate}%):</span>\r\n              <span>{displayCurrency} {formatNumber(taxAmount)}</span>\r\n            </div>\r\n          )}\r\n          <div className=\"flex justify-between font-black text-[13px] border-t border-black pt-1.5 mt-1\">\r\n            <span>TOTAL:</span>\r\n            <span>{displayCurrency} {formatNumber(totalAmount)}</span>\r\n          </div>\r\n\r\n          {sale.paymentStatus === 'Installment Sale' && (\r\n            <div className=\"mt-2 pt-1 border-t border-gray-200 border-dotted\">\r\n              <div className=\"flex justify-between font-bold\">\r\n                <span>PAID:</span>\r\n                <span>{displayCurrency} {formatNumber(displayAmountPaid)}</span>\r\n              </div>\r\n              <div className=\"flex justify-between font-black text-red-600\">\r\n                <span>DUE:</span>\r\n                <span>{displayCurrency} {formatNumber(displayAmountDue)}</span>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Amount in Words */}\r\n        <div className=\"mb-4 text-[9px] italic opacity-80 border-t border-b border-gray-100 py-1\">\r\n          <span className=\"font-black not-italic uppercase\">Words:</span> {displayCurrency} {numberToWords(totalAmount)} only.\r\n        </div>\r\n\r\n        {/* Payment Info */}\r\n        {hasPaymentInfo && (\r\n          <div className=\"mb-4 text-[9px]\">\r\n            <div className=\"font-black underline mb-1 uppercase\">Payment Channels:</div>\r\n            {paymentMethods\r\n              .filter(p => p.method.trim() !== '' || p.accountNumber.trim() !== '' || p.accountName.trim() !== '')\r\n              .map((p, i) => (\r\n                <div key={i} className=\"mb-1 last:mb-0 font-bold\">\r\n                  <div className=\"flex justify-between\">\r\n                    <span className=\"uppercase\">{p.method}:</span>\r\n                    <span>{p.accountNumber}</span>\r\n                  </div>\r\n                  <div className=\"text-[8px] opacity-70 italic text-right\">{p.accountName}</div>\r\n                </div>\r\n              ))\r\n            }\r\n          </div>\r\n        )}\r\n\r\n        {/* Notes */}\r\n        {sale.notes && (\r\n          <div className=\"mb-4 text-[9px] border border-gray-100 p-1 bg-gray-50\">\r\n            <div className=\"font-black uppercase mb-0.5\">Notes:</div>\r\n            <div className=\"font-bold opacity-70 whitespace-pre-wrap italic\">{sale.notes}</div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Signature Section */}\r\n        <div className=\"mt-auto pt-6 flex flex-col items-center\">\r\n          {settings.signature ? (\r\n            <div className=\"flex flex-col items-center\">\r\n              <img\r\n                src={settings.signature}\r\n                alt=\"Signature\"\r\n                className=\"h-10 w-auto object-contain mb-1 mix-blend-multiply opacity-90\"\r\n              />\r\n              <div className=\"w-[80%] border-t border-black border-dashed\"></div>\r\n              <div className=\"text-[8px] font-black uppercase mt-1\">Authorized Signature</div>\r\n            </div>\r\n          ) : (\r\n            <div className=\"w-full flex flex-col items-center\">\r\n              <div className=\"w-[80%] border-t border-black border-dashed pt-1\"></div>\r\n              <div className=\"text-[8px] font-black uppercase mt-1\">Authorized Signature</div>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Footer */}\r\n        <div className=\"text-center mt-6\">\r\n          <div className=\"text-[10px] font-black mb-1 italic\">THANK YOU!</div>\r\n          <div className=\"text-[8px] font-bold opacity-60\">\r\n            GONZA SYSTEMS SUPPORT\r\n            <br />\r\n            PRINTED AT {format(new Date(), 'HH:mm dd/MM/yy')}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Serrated Edge Pattern (Bottom) */}\r\n        <div className=\"absolute bottom-0 left-0 w-full h-1 overflow-hidden flex\" style={{ opacity: 0.2 }}>\r\n          {Array.from({ length: 20 }).map((_, i) => (\r\n            <div key={i} className=\"w-4 h-4 bg-gray-300 transform rotate-45 translate-y-2 translate-x-1\" />\r\n          ))}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ThermalReceipt;\r\n","import React, { useRef, useEffect, useState } from 'react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Share2 } from \"lucide-react\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Sale, BusinessSettings } from '@/types';\r\nimport { generatePDF } from '@/utils/generatePDF';\r\nimport { directPrint } from '@/utils/directPrint';\r\nimport { format } from 'date-fns';\r\nimport { Printer, Download, Loader2, Smartphone } from 'lucide-react';\r\nimport { formatNumber } from '@/lib/utils';\r\nimport { Separator } from '@/components/ui/separator';\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\r\nimport { parsePaymentInfo, useBusinessSettings } from '@/hooks/useBusinessSettings';\r\nimport { numberToWords } from '@/utils/numberToWords';\r\nimport { useIsMobile } from '@/hooks/use-mobile';\r\nimport { isIOS, isAndroid } from '@/utils/deviceDetection';\r\nimport ThermalReceipt from './ThermalReceipt';\r\nimport { toast } from 'sonner';\r\nimport { useInstallmentPayments } from '@/hooks/useInstallmentPayments';\r\nimport { print, checkBridgeStatus } from \"@/utils/thermalPrinterPlug\";\r\nimport { generateThermalText } from \"@/utils/generateThermalText\";\r\nimport { generateThermalReceipt } from \"@/utils/generateThermalReceipt\";\r\n\r\ninterface PrintableReceiptProps {\r\n  sale: Sale;\r\n  currency?: string;\r\n  isMobile?: boolean;\r\n  includePaymentInfo?: boolean;\r\n}\r\n\r\ntype ReceiptType = 'standard' | 'thermal';\r\n\r\nconst PrintableReceipt: React.FC<PrintableReceiptProps> = ({\r\n  sale,\r\n  currency,\r\n  isMobile,\r\n  includePaymentInfo = true\r\n}) => {\r\n  const receiptRef = useRef<HTMLDivElement>(null);\r\n  const thermalReceiptRef = useRef<HTMLDivElement>(null);\r\n  const { settings, isLoading: settingsLoading } = useBusinessSettings();\r\n  const { payments } = useInstallmentPayments(sale.id);\r\n  const [receiptType, setReceiptType] = useState<ReceiptType>('standard');\r\n  const [isPrinting, setIsPrinting] = useState(false);\r\n  const [isDownloading, setIsDownloading] = useState(false);\r\n  const [isSharing, setIsSharing] = useState(false);\r\n  const [isBridgeOnline, setIsBridgeOnline] = useState(false);\r\n  const isMobileDevice = useIsMobile();\r\n\r\n  // Update receipt type when settings are loaded\r\n  useEffect(() => {\r\n    if (settings.defaultPrintFormat) {\r\n      setReceiptType(settings.defaultPrintFormat);\r\n    }\r\n\r\n    // Check bridge status on mount\r\n    const checkBridge = async () => {\r\n      const isOnline = await checkBridgeStatus();\r\n      setIsBridgeOnline(isOnline);\r\n    };\r\n    checkBridge();\r\n  }, [settings.defaultPrintFormat]);\r\n\r\n  // Determine document title based on payment status\r\n  const getDocumentTitle = () => {\r\n    switch (sale.paymentStatus) {\r\n      case 'Quote':\r\n        return 'QUOTATION';\r\n      case 'Paid':\r\n        return 'SALES RECEIPT';\r\n      case 'Installment Sale':\r\n        return 'INVOICE';\r\n      case 'NOT PAID':\r\n      default:\r\n        return 'INVOICE';\r\n    }\r\n  };\r\n\r\n  const getDocumentNumberLabel = () => {\r\n    switch (sale.paymentStatus) {\r\n      case 'Quote':\r\n        return 'Quote #:';\r\n      case 'Paid':\r\n        return 'Receipt #:';\r\n      case 'Installment Sale':\r\n        return 'Installment #:';\r\n      case 'NOT PAID':\r\n      default:\r\n        return 'Invoice #:';\r\n    }\r\n  };\r\n\r\n  const documentTitle = getDocumentTitle();\r\n  const documentNumberLabel = getDocumentNumberLabel();\r\n\r\n  // Calculate subtotal with discounts\r\n  const subtotal = sale.items.reduce((total, item) => {\r\n    const itemSubtotal = item.price * item.quantity;\r\n    const discountAmount = item.discountType === 'amount'\r\n      ? (item.discountAmount || 0)\r\n      : (itemSubtotal * (item.discountPercentage || 0)) / 100;\r\n    return total + (itemSubtotal - discountAmount);\r\n  }, 0);\r\n\r\n  // Calculate tax amount based on taxRate (default to 0 if not present)\r\n  const taxRate = sale.taxRate || 0;\r\n  const taxAmount = subtotal * (taxRate / 100);\r\n\r\n  // Total amount including tax\r\n  const totalAmount = subtotal + taxAmount;\r\n\r\n  // For installment sales, use payment history total; for others use the provided amounts\r\n  const totalPaidFromHistory = payments.reduce((sum, payment) => sum + payment.amount, 0);\r\n  const displayAmountPaid = sale.paymentStatus === 'Installment Sale' || (sale.paymentStatus === 'Paid' && totalPaidFromHistory > 0)\r\n    ? totalPaidFromHistory\r\n    : (sale.amountPaid || totalAmount);\r\n  const displayAmountDue = sale.paymentStatus === 'Installment Sale'\r\n    ? Math.max(0, totalAmount - totalPaidFromHistory)\r\n    : (sale.amountDue || 0);\r\n\r\n  // Get the total amount in words\r\n  const totalAmountInWords = numberToWords(totalAmount);\r\n\r\n  // Check if we should show the tax row\r\n  const showTaxRow = taxRate > 0;\r\n\r\n  // Check if this is an installment sale\r\n  const isInstallmentSale = sale.paymentStatus === 'Installment Sale';\r\n\r\n  // Parse payment info into structured format\r\n  const paymentMethods = settings.paymentInfo ? parsePaymentInfo(settings.paymentInfo) : [];\r\n  // Only show payment methods table if there are valid payment methods AND includePaymentInfo is true\r\n  const hasPaymentInfo = includePaymentInfo &&\r\n    paymentMethods.length > 0 &&\r\n    paymentMethods.some(pm => pm.method.trim() !== '' || pm.accountNumber.trim() !== '' || pm.accountName.trim() !== '');\r\n\r\n  // Use the currency prop if provided, otherwise use the one from settings\r\n  const displayCurrency = currency || settings.currency;\r\n\r\n  // Check if device is iOS or Android\r\n  const isIOSDevice = isIOS();\r\n  const isAndroidDevice = isAndroid();\r\n\r\n  // Get the receipt date and current time for display\r\n  const receiptDate = new Date(sale.date);\r\n  const currentDateTime = new Date();\r\n\r\n  // Helper function to create structured receipt data\r\n  const createReceiptData = () => {\r\n    const receiptDate = new Date(sale.date);\r\n    const currentDateTime = new Date();\r\n    const paymentMethods = settings.paymentInfo ? parsePaymentInfo(settings.paymentInfo) : [];\r\n    const hasPaymentInfo = includePaymentInfo &&\r\n      paymentMethods.length > 0 &&\r\n      paymentMethods.some(pm => pm.method.trim() !== '' || pm.accountNumber.trim() !== '' || pm.accountName.trim() !== '');\r\n\r\n    return {\r\n      documentTitle: getDocumentTitle(),\r\n      documentNumberLabel: getDocumentNumberLabel(),\r\n      receiptNumber: sale.receiptNumber,\r\n      date: format(receiptDate, 'MMM dd, yyyy'),\r\n      time: format(currentDateTime, 'hh:mm a'),\r\n      status: sale.paymentStatus,\r\n      businessName: settings.businessName,\r\n      businessAddress: settings.businessAddress,\r\n      businessPhone: settings.businessPhone,\r\n      businessEmail: settings.businessEmail,\r\n      businessLogo: settings.businessLogo,\r\n      signature: settings.signature,\r\n      customerName: sale.customerName,\r\n      customerAddress: sale.customerAddress,\r\n      customerContact: sale.customerContact,\r\n      items: sale.items.map(item => {\r\n        const itemSubtotal = item.quantity * item.price;\r\n        const discountAmount = item.discountType === 'amount'\r\n          ? (item.discountAmount || 0)\r\n          : (itemSubtotal * (item.discountPercentage || 0)) / 100;\r\n        return {\r\n          description: item.description,\r\n          quantity: item.quantity,\r\n          unitPrice: item.price,\r\n          discountPercentage: item.discountPercentage || 0,\r\n          discountAmount,\r\n          discountType: item.discountType || 'percentage',\r\n          amount: itemSubtotal - discountAmount\r\n        };\r\n      }),\r\n      subtotal,\r\n      taxRate,\r\n      taxAmount,\r\n      totalAmount,\r\n      amountPaid: displayAmountPaid,\r\n      amountDue: displayAmountDue,\r\n      isInstallmentSale,\r\n      totalAmountInWords,\r\n      paymentMethods: hasPaymentInfo ? paymentMethods.filter(pm =>\r\n        pm.method.trim() !== '' || pm.accountNumber.trim() !== '' || pm.accountName.trim() !== ''\r\n      ) : undefined,\r\n      currency: displayCurrency,\r\n      showTaxRow,\r\n      hasPaymentInfo,\r\n      notes: sale.notes\r\n    };\r\n  };\r\n\r\n  // Optimized download handler with vector PDF for standard receipts\r\n  const handleDownloadPDF = async () => {\r\n    if (!receiptRef.current) return;\r\n\r\n    setIsDownloading(true);\r\n\r\n    try {\r\n      toast.success('Preparing download...');\r\n\r\n      const filePrefix = sale.paymentStatus === 'Quote'\r\n        ? 'Quote'\r\n        : (sale.paymentStatus === 'Paid' ? 'Receipt' : 'Invoice');\r\n\r\n      const fileName = receiptType === 'thermal'\r\n        ? `${filePrefix}_Thermal-${sale.receiptNumber}.pdf`\r\n        : `${filePrefix}-${sale.receiptNumber}.pdf`;\r\n\r\n      if (receiptType === 'standard') {\r\n        // Use new vector PDF generation for standard receipts\r\n        const { generateReceiptVectorPDF } = await import('@/utils/generateReceiptVectorPDF');\r\n        const receiptData = createReceiptData();\r\n        await generateReceiptVectorPDF(receiptData, {\r\n          filename: fileName,\r\n          orientation: 'portrait',\r\n          format: 'a4',\r\n          margins: { top: 20, right: 20, bottom: 20, left: 20 }\r\n        });\r\n      } else {\r\n        // Use existing method for thermal receipts\r\n        await generatePDF(receiptRef.current, fileName, { isReceipt: true });\r\n      }\r\n\r\n      toast.success('Receipt downloaded successfully!');\r\n    } catch (error) {\r\n      console.error('Error downloading receipt:', error);\r\n      toast.error('Failed to download receipt. Please try again.');\r\n    } finally {\r\n      setIsDownloading(false);\r\n    }\r\n  };\r\n\r\n  // Share handle share\r\n  const handleShare = async () => {\r\n    setIsSharing(true);\r\n    try {\r\n      const { generateReceiptVectorPDF } = await import('@/utils/generateReceiptVectorPDF');\r\n      const receiptData = createReceiptData();\r\n      const pdfBlob = await generateReceiptVectorPDF(receiptData, { returnBlob: true });\r\n      if (!pdfBlob) return;\r\n\r\n      //  Use dynamic prefix same as download\r\n      const filePrefix =\r\n        sale.paymentStatus === 'Quote'\r\n          ? 'Quotation'\r\n          : sale.paymentStatus === 'Paid'\r\n            ? 'Receipt'\r\n            : 'Invoice';\r\n\r\n      const fileName = `${filePrefix}-${sale.receiptNumber}.pdf`;\r\n\r\n      const file = new File([pdfBlob], fileName, { type: 'application/pdf' });\r\n\r\n      if (navigator.canShare && navigator.canShare({ files: [file] })) {\r\n        await navigator.share({\r\n          files: [file],\r\n          title: `${filePrefix} - ${sale.receiptNumber}`,\r\n          text: `${filePrefix} #${sale.receiptNumber}`,\r\n        });\r\n        toast.success(`${filePrefix} shared successfully!`);\r\n      } else {\r\n        toast.error('Sharing not supported on this device.');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error sharing document:', error);\r\n      toast.error('Failed to share document.');\r\n    } finally {\r\n      setIsSharing(false);\r\n    }\r\n  };\r\n\r\n  // Optimized print handler with PDF generation for desktop\r\n  const handlePrint = async () => {\r\n    const printElement =\r\n      receiptType === 'thermal' ? thermalReceiptRef.current : receiptRef.current;\r\n    if (!printElement) return;\r\n\r\n    setIsPrinting(true);\r\n\r\n    try {\r\n      if (receiptType === 'thermal') {\r\n        const saleWithPayments = { ...sale, payments: payments || [] };\r\n        const receiptData = await generateThermalReceipt(saleWithPayments, settings, displayCurrency);\r\n\r\n        // Always use public API (prefers bridge now)\r\n        const result = await print(receiptData, settings.defaultPrinterName);\r\n        const { success, message } = result || { success: false, message: 'Unknown print error' };\r\n\r\n        success ? toast.success(message) : toast.error(message);\r\n        return;\r\n      }\r\n\r\n      toast.success('Preparing receipt for printing...');\r\n\r\n      if (isMobileDevice) {\r\n        const baseDocumentName =\r\n          sale.paymentStatus === 'Quote'\r\n            ? 'Quotation'\r\n            : sale.paymentStatus === 'Paid'\r\n              ? 'Receipt'\r\n              : 'Invoice';\r\n\r\n        directPrint(printElement, baseDocumentName);\r\n        toast.success('Print dialog opened!');\r\n      } else {\r\n        const { generateReceiptVectorPDF } = await import(\r\n          '@/utils/generateReceiptVectorPDF'\r\n        );\r\n        const receiptData = createReceiptData();\r\n        const pdfBlob = await generateReceiptVectorPDF(receiptData, {\r\n          returnBlob: true,\r\n        });\r\n\r\n        if (pdfBlob) {\r\n          const blobUrl = URL.createObjectURL(pdfBlob);\r\n          const printWindow = window.open(blobUrl, '_blank');\r\n\r\n          if (printWindow) {\r\n            printWindow.addEventListener('load', () => {\r\n              setTimeout(() => {\r\n                printWindow.focus();\r\n                printWindow.print();\r\n                printWindow.addEventListener('afterprint', () => printWindow.close());\r\n              }, 500);\r\n            });\r\n          }\r\n\r\n          setTimeout(() => URL.revokeObjectURL(blobUrl), 30000);\r\n        }\r\n\r\n        toast.success('Print dialog opened!');\r\n      }\r\n    } catch (error: any) {\r\n      console.error('Error printing receipt:', error);\r\n      toast.error(error?.message || 'Failed to print receipt. Please try again.');\r\n    } finally {\r\n      setIsPrinting(false);\r\n    }\r\n  };\r\n\r\n  const handleDirectThermalPrint = async () => {\r\n    setIsPrinting(true);\r\n    try {\r\n      const saleWithPayments = { ...sale, payments };\r\n      const receiptData = await generateThermalReceipt(saleWithPayments, settings, displayCurrency);\r\n      const result = await print(receiptData, settings.defaultPrinterName);\r\n      const { success, message } = result || { success: false, message: 'Unknown print error' };\r\n\r\n      if (success) {\r\n        toast.success(message || 'Sent to thermal printer');\r\n      } else {\r\n        toast.error(message || 'Thermal printing failed');\r\n      }\r\n    } catch (error: any) {\r\n      console.error('Error in direct thermal print:', error);\r\n      toast.error(error?.message || 'Failed to print thermal receipt');\r\n    } finally {\r\n      setIsPrinting(false);\r\n    }\r\n  };\r\n\r\n\r\n  // Show loading state while business settings are loading\r\n  if (settingsLoading) {\r\n    return (\r\n      <div className={`bg-white ${isMobile ? 'p-2' : 'p-6'} rounded-lg shadow-md`}>\r\n        <div className=\"mb-4 flex justify-between items-center flex-wrap\">\r\n          <h2 className={`${isMobile ? 'text-xl' : 'text-2xl'} font-bold text-sales-primary`}>{documentTitle}</h2>\r\n        </div>\r\n        <div className=\"flex items-center justify-center py-12\">\r\n          <div className=\"text-center\">\r\n            <Loader2 className=\"h-8 w-8 animate-spin mx-auto mb-4 text-muted-foreground\" />\r\n            <p className=\"text-muted-foreground\">Loading business settings...</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className={`bg-white ${isMobile ? 'p-2' : 'p-6'} rounded-lg shadow-md`}>\r\n      <div className=\"mb-4 flex justify-between items-center flex-wrap\">\r\n        <h2 className={`${isMobile ? 'text-xl' : 'text-2xl'} font-bold text-sales-primary`}>{documentTitle}</h2>\r\n\r\n        <div className=\"print:hidden flex space-x-2 mt-2 sm:mt-0\">\r\n          {/* Smart Print button - handles both Standard (System Print) and Thermal (Direct/Bridge) */}\r\n          {!isMobile && (\r\n            <Button\r\n              variant=\"default\"\r\n              size=\"default\"\r\n              onClick={handlePrint}\r\n              disabled={isPrinting || isDownloading || isSharing}\r\n              className=\"flex items-center\"\r\n              title=\"Print\"\r\n            >\r\n              {isPrinting ? (\r\n                <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n              ) : (\r\n                <Printer className=\"h-4 w-4\" />\r\n              )}\r\n            </Button>\r\n          )}\r\n\r\n          {/* Other actions moved to a dropdown or kept separate? User said 'just one print button'. \r\n              I'll keep Download and Share but grouped to keep 'Print' as the ONE print action. */}\r\n          <div className=\"flex gap-2\">\r\n            <Button\r\n              variant=\"outline\"\r\n              size={isMobile ? \"sm\" : \"default\"}\r\n              onClick={handleDownloadPDF}\r\n              disabled={isPrinting || isDownloading || isSharing}\r\n              className=\"flex items-center\"\r\n              title=\"Download PDF\"\r\n            >\r\n              {isDownloading ? (\r\n                <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n              ) : (\r\n                <Download className=\"h-4 w-4\" />\r\n              )}\r\n            </Button>\r\n            <Button\r\n              variant=\"outline\"\r\n              size={isMobile ? \"sm\" : \"default\"}\r\n              onClick={handleShare}\r\n              disabled={isPrinting || isDownloading || isSharing}\r\n              className=\"flex items-center\"\r\n              title=\"Share\"\r\n            >\r\n              {isSharing ? (\r\n                <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n              ) : (\r\n                <Share2 className=\"h-4 w-4\" />\r\n              )}\r\n            </Button>\r\n\r\n            {/* Mobile Bluetooth Print App Integration - Visible only on mobile for the app */}\r\n            {isMobile && (\r\n              <Button\r\n                variant=\"outline\"\r\n                size={isMobile ? \"sm\" : \"default\"}\r\n                onClick={async () => {\r\n                  const ua = navigator.userAgent || \"\";\r\n                  const isAndroidActual = /android/i.test(ua);\r\n                  const isIOSActual = !isAndroidActual && (/iPad|iPhone|iPod/.test(ua) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1));\r\n\r\n                  // Diagnostics\r\n                  console.warn('--- MOBILE PRINT START ---');\r\n                  console.warn('User Agent:', ua);\r\n                  console.warn('isAndroid (Direct Check):', isAndroidActual);\r\n                  console.warn('isIOS (Direct Check):', isIOSActual);\r\n\r\n                  const platformParam = isAndroidActual ? 'platform=android' : (isIOSActual ? 'platform=ios' : 'default');\r\n                  const anonKey = process.env.NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY;\r\n                  const functionUrl = `${process.env.NEXT_PUBLIC_SUPABASE_URL}/functions/v1/print-receipt?id=${sale.id}&${platformParam}&apikey=${anonKey}`;\r\n\r\n                  setIsPrinting(true);\r\n                  try {\r\n                    console.log('Fetching from:', functionUrl);\r\n                    const response = await fetch(functionUrl);\r\n\r\n                    if (!response.ok) {\r\n                      const errorBody = await response.text();\r\n                      console.error('Print Function Error:', response.status, errorBody);\r\n                      throw new Error(`Server ${response.status}: ${errorBody || 'Bad Request'}`);\r\n                    }\r\n\r\n                    const data = await response.json();\r\n                    console.log('Data fetched successfully');\r\n\r\n                    if (isAndroidActual) {\r\n                      console.log('Redirecting to Android App using RAW URL...');\r\n                      window.location.href = `my.bluetoothprint.scheme://${functionUrl}`;\r\n                    } else if (isIOSActual) {\r\n                      console.log('Redirecting to iOS App (Direct Push)...');\r\n                      const encodedJSON = encodeURIComponent(JSON.stringify(data));\r\n                      window.location.href = `thermer://print?data=${encodedJSON}`;\r\n                    } else {\r\n                      toast.error('Mobile printing is optimized for iOS and Android');\r\n                    }\r\n                  } catch (error: any) {\r\n                    console.error('Unified Print Error:', error);\r\n                    toast.error(error.message || 'Failed to prepare receipt');\r\n                  } finally {\r\n                    setIsPrinting(false);\r\n                    console.warn('--- MOBILE PRINT END ---');\r\n                  }\r\n                }}\r\n                className=\"flex items-center text-blue-600 border-blue-200 hover:bg-blue-50\"\r\n                title=\"Print\"\r\n              >\r\n                {isPrinting ? (\r\n                  <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                ) : (\r\n                  <Printer className=\"h-4 w-4\" />\r\n                )}\r\n              </Button>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n      </div>\r\n\r\n      <div className=\"mb-4 print:hidden\">\r\n        <div className=\"flex items-center space-x-3\">\r\n          <label htmlFor=\"receipt-type\" className=\"text-sm font-medium\">\r\n            Receipt Format:\r\n          </label>\r\n          <Select value={receiptType} onValueChange={(value: ReceiptType) => setReceiptType(value)}>\r\n            <SelectTrigger className=\"w-48\">\r\n              <SelectValue placeholder=\"Select receipt type\" />\r\n            </SelectTrigger>\r\n            <SelectContent>\r\n              <SelectItem value=\"standard\">Standard Receipt</SelectItem>\r\n              <SelectItem value=\"thermal\">Thermal Receipt</SelectItem>\r\n            </SelectContent>\r\n          </Select>\r\n        </div>\r\n      </div>\r\n\r\n      <div ref={receiptRef}>\r\n        {receiptType === 'thermal' ? (\r\n          <div ref={thermalReceiptRef}>\r\n            <ThermalReceipt\r\n              sale={sale}\r\n              currency={displayCurrency}\r\n              includePaymentInfo={includePaymentInfo}\r\n            />\r\n          </div>\r\n        ) : (\r\n          <div className={`border-[1.5px] border-black ${isMobile ? 'p-3' : 'p-6'} rounded-md`}>\r\n            <div className=\"flex flex-col items-center mb-4 gap-2 text-center w-full\">\r\n              <div className=\"w-full\">\r\n                <div className=\"text-lg sm:text-2xl font-bold text-gray-900 mb-1\">{settings.businessName?.toUpperCase()}</div>\r\n                <div className={`${isMobile ? 'text-xs' : 'text-sm'} text-gray-600 font-medium`}>{settings.businessAddress}</div>\r\n                <div className=\"text-xs sm:text-sm text-gray-600\">Phone: {settings.businessPhone} | Email: {settings.businessEmail}</div>\r\n              </div>\r\n            </div>\r\n\r\n            <Separator className=\"my-3 sm:my-4 border-black border-t-[1.5px]\" />\r\n\r\n            <div className=\"text-center mb-4\">\r\n              <h1 className={`font-bold ${isMobile ? 'text-xl' : 'text-2xl'} uppercase tracking-wider text-gray-900`}>\r\n                {sale.paymentStatus === 'Quote' ? 'QUOTATION' : (sale.paymentStatus === 'Paid' ? 'SALES RECEIPT' : 'INVOICE')}\r\n              </h1>\r\n            </div>\r\n\r\n            <div className=\"flex justify-between mb-4 sm:mb-6 text-sm flex-wrap gap-2\">\r\n              <div>\r\n                <div className=\"font-semibold\">{documentNumberLabel} {sale.receiptNumber}</div>\r\n                <div>Date: {format(receiptDate, 'MMM dd, yyyy')}</div>\r\n              </div>\r\n              <div className=\"text-right\">\r\n                <div className=\"font-semibold\">{sale.paymentStatus}</div>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"mb-4 sm:mb-6\">\r\n              <h3 className=\"font-semibold mb-2 text-sm\">Customer Information:</h3>\r\n              <div className=\"text-sm\">\r\n                <div>{sale.customerName}</div>\r\n                <div>{sale.customerAddress}</div>\r\n                <div>{sale.customerContact}</div>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"overflow-x-auto\">\r\n              {/* Desktop Table View */}\r\n              <div className=\"hidden sm:block\">\r\n                <table className=\"w-full mb-4 sm:mb-6 text-sm\">\r\n                  <thead>\r\n                    <tr className=\"border-b border-black border-b-[1.5px]\">\r\n                      <th className=\"py-2 text-left bg-gray-200 px-2\">Description</th>\r\n                      <th className=\"py-2 text-right bg-gray-200 px-2\">Qty</th>\r\n                      <th className=\"py-2 text-right bg-gray-200 px-2\">Unit Price</th>\r\n                      <th className=\"py-2 text-right bg-gray-200 px-2\">Discount</th>\r\n                      <th className=\"py-2 text-right bg-gray-200 px-2\">Amount</th>\r\n                    </tr>\r\n                  </thead>\r\n                  <tbody>\r\n                    {sale.items.map((item, index) => {\r\n                      const itemSubtotal = item.quantity * item.price;\r\n                      const discountAmount = item.discountType === 'amount'\r\n                        ? (item.discountAmount || 0)\r\n                        : (itemSubtotal * (item.discountPercentage || 0)) / 100;\r\n                      const finalAmount = itemSubtotal - discountAmount;\r\n\r\n                      return (\r\n                        <tr key={index} className=\"border-b border-black\">\r\n                          <td className=\"py-2 sm:py-3 break-all whitespace-normal\">{item.description}</td>\r\n                          <td className=\"py-2 sm:py-3 text-right\">{formatNumber(item.quantity)}</td>\r\n                          <td className=\"py-2 sm:py-3 text-right\">{displayCurrency} {formatNumber(item.price)}</td>\r\n                          <td className=\"py-2 sm:py-3 text-right\">\r\n                            {item.discountType === 'amount'\r\n                              ? (item.discountAmount && item.discountAmount > 0 ? `${displayCurrency} ${formatNumber(item.discountAmount)}` : '-')\r\n                              : ((item.discountPercentage || 0) > 0 ? `${item.discountPercentage}%` : '-')\r\n                            }\r\n                          </td>\r\n                          <td className=\"py-2 sm:py-3 text-right\">{displayCurrency} {formatNumber(finalAmount)}</td>\r\n                        </tr>\r\n                      );\r\n                    })}\r\n                  </tbody>\r\n                  <tfoot>\r\n                    {(() => {\r\n                      const totalDiscount = sale.items.reduce((total, item) => {\r\n                        const itemSubtotal = item.quantity * item.price;\r\n                        const discountAmount = item.discountType === 'amount'\r\n                          ? (item.discountAmount || 0)\r\n                          : (itemSubtotal * (item.discountPercentage || 0)) / 100;\r\n                        return total + discountAmount;\r\n                      }, 0);\r\n\r\n                      return (\r\n                        <>\r\n                          <tr className=\"border-t border-black border-t-[1.5px]\">\r\n                            <td colSpan={4} className=\"py-2 text-right font-medium bg-gray-200 px-2\">Subtotal (before discount):</td>\r\n                            <td className=\"py-2 text-right bg-gray-200 px-2\">{displayCurrency} {formatNumber(subtotal + totalDiscount)}</td>\r\n                          </tr>\r\n                          {totalDiscount > 0 && (\r\n                            <tr>\r\n                              <td colSpan={4} className=\"py-2 text-right font-medium bg-orange-100 px-2\">Total Discount:</td>\r\n                              <td className=\"py-2 text-right bg-orange-100 px-2\">-{displayCurrency} {formatNumber(totalDiscount)}</td>\r\n                            </tr>\r\n                          )}\r\n                          <tr>\r\n                            <td colSpan={4} className=\"py-2 text-right font-medium bg-gray-200 px-2\">Subtotal:</td>\r\n                            <td className=\"py-2 text-right bg-gray-200 px-2\">{displayCurrency} {formatNumber(subtotal)}</td>\r\n                          </tr>\r\n                        </>\r\n                      );\r\n                    })()}\r\n                    {showTaxRow && (\r\n                      <tr>\r\n                        <td colSpan={4} className=\"py-2 text-right font-medium bg-gray-200 px-2\">Tax ({taxRate}%):</td>\r\n                        <td className=\"py-2 text-right bg-gray-200 px-2\">{displayCurrency} {formatNumber(taxAmount)}</td>\r\n                      </tr>\r\n                    )}\r\n                    <tr className=\"border-t border-black border-t-[1.5px] font-bold\">\r\n                      <td colSpan={4} className=\"py-2 sm:py-3 text-right bg-gray-300 px-2\">Total:</td>\r\n                      <td className=\"py-2 sm:py-3 text-right bg-gray-300 px-2\">{displayCurrency} {formatNumber(totalAmount)}</td>\r\n                    </tr>\r\n                    {isInstallmentSale && (\r\n                      <>\r\n                        <tr>\r\n                          <td colSpan={4} className=\"py-2 text-right font-medium bg-blue-100 px-2\">Amount Paid:</td>\r\n                          <td className=\"py-2 text-right bg-blue-100 px-2\">{displayCurrency} {formatNumber(displayAmountPaid)}</td>\r\n                        </tr>\r\n                        <tr>\r\n                          <td colSpan={4} className=\"py-2 text-right font-medium bg-red-100 px-2\">Amount Due:</td>\r\n                          <td className=\"py-2 text-right bg-red-100 px-2\">{displayCurrency} {formatNumber(displayAmountDue)}</td>\r\n                        </tr>\r\n                      </>\r\n                    )}\r\n                    <tr>\r\n                      <td colSpan={5} className=\"py-2 sm:py-3 text-left border-t border-black px-2 italic\">\r\n                        <span className=\"font-medium\">Amount in words:</span> {displayCurrency} {totalAmountInWords} only\r\n                      </td>\r\n                    </tr>\r\n                  </tfoot>\r\n                </table>\r\n              </div>\r\n\r\n              {/* Mobile Stacked View */}\r\n              <div className=\"block sm:hidden\">\r\n                <div className=\"border-b-2 border-black mb-2 pb-1 font-bold\">Items</div>\r\n                {sale.items.map((item, index) => {\r\n                  const itemSubtotal = item.quantity * item.price;\r\n                  const discountAmount = item.discountType === 'amount'\r\n                    ? (item.discountAmount || 0)\r\n                    : (itemSubtotal * (item.discountPercentage || 0)) / 100;\r\n                  const finalAmount = itemSubtotal - discountAmount;\r\n\r\n                  return (\r\n                    <div key={index} className=\"mb-3 border-b border-gray-200 pb-2 last:border-0\">\r\n                      <div className=\"font-bold text-sm mb-1 break-all whitespace-normal\">{item.description}</div>\r\n                      <div className=\"flex justify-between text-sm\">\r\n                        <div className=\"text-gray-600\">\r\n                          {formatNumber(item.quantity)} x {displayCurrency} {formatNumber(item.price)}\r\n                        </div>\r\n                        <div className=\"font-bold\">\r\n                          {displayCurrency} {formatNumber(finalAmount)}\r\n                        </div>\r\n                      </div>\r\n                      {discountAmount > 0 && (\r\n                        <div className=\"flex justify-between text-xs text-orange-600 italic mt-0.5\">\r\n                          <span>Discount {item.discountType === 'percentage' ? `(${item.discountPercentage}%)` : ''}</span>\r\n                          <span>-{displayCurrency} {formatNumber(discountAmount)}</span>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  );\r\n                })}\r\n\r\n                {/* Mobile Totals */}\r\n                <div className=\"mt-4 border-t-2 border-black pt-2 space-y-1\">\r\n                  {(() => {\r\n                    const totalDiscount = sale.items.reduce((total, item) => {\r\n                      const itemSubtotal = item.quantity * item.price;\r\n                      const discountAmount = item.discountType === 'amount'\r\n                        ? (item.discountAmount || 0)\r\n                        : (itemSubtotal * (item.discountPercentage || 0)) / 100;\r\n                      return total + discountAmount;\r\n                    }, 0);\r\n\r\n                    return (\r\n                      <>\r\n                        <div className=\"flex justify-between text-sm\">\r\n                          <span className=\"font-medium\">Subtotal (before disc):</span>\r\n                          <span>{displayCurrency} {formatNumber(subtotal + totalDiscount)}</span>\r\n                        </div>\r\n                        {totalDiscount > 0 && (\r\n                          <div className=\"flex justify-between text-sm text-orange-600\">\r\n                            <span className=\"font-medium\">Total Discount:</span>\r\n                            <span>-{displayCurrency} {formatNumber(totalDiscount)}</span>\r\n                          </div>\r\n                        )}\r\n                        <div className=\"flex justify-between text-sm\">\r\n                          <span className=\"font-medium\">Subtotal:</span>\r\n                          <span>{displayCurrency} {formatNumber(subtotal)}</span>\r\n                        </div>\r\n                      </>\r\n                    );\r\n                  })()}\r\n\r\n                  {showTaxRow && (\r\n                    <div className=\"flex justify-between text-sm\">\r\n                      <span className=\"font-medium\">Tax ({taxRate}%):</span>\r\n                      <span>{displayCurrency} {formatNumber(taxAmount)}</span>\r\n                    </div>\r\n                  )}\r\n\r\n                  <div className=\"flex justify-between text-base font-bold border-t border-black pt-1 mt-1\">\r\n                    <span>Total:</span>\r\n                    <span>{displayCurrency} {formatNumber(totalAmount)}</span>\r\n                  </div>\r\n\r\n                  {isInstallmentSale && (\r\n                    <>\r\n                      <div className=\"flex justify-between text-sm text-blue-600 pt-1\">\r\n                        <span className=\"font-medium\">Amount Paid:</span>\r\n                        <span>{displayCurrency} {formatNumber(displayAmountPaid)}</span>\r\n                      </div>\r\n                      <div className=\"flex justify-between text-sm text-red-600\">\r\n                        <span className=\"font-medium\">Amount Due:</span>\r\n                        <span>{displayCurrency} {formatNumber(displayAmountDue)}</span>\r\n                      </div>\r\n                    </>\r\n                  )}\r\n\r\n                  <div className=\"pt-2 text-xs italic border-t border-gray-200 mt-2\">\r\n                    <span className=\"font-medium\">Words:</span> {displayCurrency} {totalAmountInWords} only\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {hasPaymentInfo && (\r\n              <div className=\"mt-4 pt-3 border-t border-black\">\r\n                <h3 className=\"font-semibold text-sm mb-2\">Payment Information:</h3>\r\n                <div className=\"overflow-x-auto\">\r\n                  <table className=\"w-full text-sm\">\r\n                    <thead>\r\n                      <tr className=\"bg-gray-200\">\r\n                        <th className=\"font-medium py-1 px-2 text-left\">Payment Method</th>\r\n                        <th className=\"font-medium py-1 px-2 text-left\">Account Number</th>\r\n                        <th className=\"font-medium py-1 px-2 text-left\">Account Name</th>\r\n                      </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                      {paymentMethods\r\n                        .filter(payment => payment.method.trim() !== '' || payment.accountNumber.trim() !== '' || payment.accountName.trim() !== '')\r\n                        .map((payment, index) => (\r\n                          <tr key={index}>\r\n                            <td className=\"py-1 px-2 font-medium\">{payment.method}</td>\r\n                            <td className=\"py-1 px-2\">{payment.accountNumber}</td>\r\n                            <td className=\"py-1 px-2\">{payment.accountName}</td>\r\n                          </tr>\r\n                        ))\r\n                      }\r\n                    </tbody>\r\n                  </table>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {sale.notes && (\r\n              <div className=\"mt-4 pt-3 border-t border-black\">\r\n                <h3 className=\"font-semibold text-sm mb-2\">Notes:</h3>\r\n                <div className=\"text-sm whitespace-pre-wrap\">{sale.notes}</div>\r\n              </div>\r\n            )}\r\n\r\n\r\n            <div className=\"text-center text-xs sm:text-sm mt-4 sm:mt-8\">\r\n              <p className=\"font-medium\">Thank you for your business!</p>\r\n              <p className=\"text-gray-600 text-xs mt-3\">Created by Gonza Systems</p>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div >\r\n  );\r\n};\r\n\r\nexport default PrintableReceipt;\r\n","\r\nimport React from 'react';\r\nimport { Sale } from '@/types';\r\nimport { Dialog, DialogContent } from '@/components/ui/dialog';\r\nimport { \r\n  Drawer, \r\n  DrawerContent,\r\n  DrawerClose,\r\n  DrawerTrigger\r\n} from '@/components/ui/drawer';\r\nimport PrintableReceipt from '@/components/PrintableReceipt';\r\nimport { useIsMobile } from '@/hooks/use-mobile';\r\nimport { X } from 'lucide-react';\r\nimport { ScrollArea } from '@/components/ui/scroll-area';\r\n\r\ninterface ReceiptDialogProps {\r\n  isOpen: boolean;\r\n  sale: Sale | null;\r\n  currency: string;\r\n  onOpenChange: (open: boolean) => void;\r\n  includePaymentInfo?: boolean;\r\n}\r\n\r\nconst ReceiptDialog: React.FC<ReceiptDialogProps> = ({ \r\n  isOpen, \r\n  sale, \r\n  currency,\r\n  onOpenChange,\r\n  includePaymentInfo = true\r\n}) => {\r\n  const isMobile = useIsMobile();\r\n\r\n  if (isMobile) {\r\n    return (\r\n      <Drawer open={isOpen} onOpenChange={onOpenChange}>\r\n        <DrawerContent className=\"max-h-[85vh]\">\r\n          <div className=\"relative px-4 py-6 pb-8\">\r\n            <DrawerClose className=\"absolute right-4 top-4 rounded-sm opacity-70 hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring\">\r\n              <X className=\"h-4 w-4\" />\r\n              <span className=\"sr-only\">Close</span>\r\n            </DrawerClose>\r\n            <ScrollArea className=\"h-[75vh] pr-4 pb-4\">\r\n              {sale && <PrintableReceipt sale={sale} currency={currency} isMobile={true} includePaymentInfo={includePaymentInfo} />}\r\n            </ScrollArea>\r\n          </div>\r\n        </DrawerContent>\r\n      </Drawer>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Dialog open={isOpen} onOpenChange={onOpenChange}>\r\n      <DialogContent className=\"max-w-3xl max-h-[90vh]\">\r\n        <ScrollArea className=\"h-[80vh] pr-4\">\r\n          {sale && <PrintableReceipt sale={sale} currency={currency} includePaymentInfo={includePaymentInfo} />}\r\n        </ScrollArea>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default ReceiptDialog;\r\n"],"names":[],"mappings":"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","ignoreList":[4]}