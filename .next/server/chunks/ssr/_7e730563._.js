module.exports=[533695,a=>{"use strict";let b=(0,a.i(564375).default)("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);a.s(["Copy",()=>b],533695)},147358,a=>{"use strict";let b=(0,a.i(564375).default)("FileImage",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]]);a.s(["FileImage",()=>b],147358)},268356,a=>{"use strict";let b=(0,a.i(564375).default)("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);a.s(["Minus",()=>b],268356)},460577,a=>{"use strict";var b=a.i(127669),c=a.i(283554),d=a.i(687989),e=a.i(550548);let f=async a=>{let{productName:f,barcodeValue:g,price:h,currency:i="KES",showPrice:j=!0}=a,k=document.createElement("div");k.style.position="absolute",k.style.left="-9999px",k.style.top="-9999px",k.style.width="340px",k.style.padding="20px",k.style.backgroundColor="white",k.style.fontFamily="Arial, sans-serif",document.body.appendChild(k);try{let a=document.createElement("div");a.style.display="flex",a.style.flexDirection="column",a.style.alignItems="center",a.style.gap="10px";let l=document.createElement("div");l.textContent=f,l.style.fontSize="18px",l.style.fontWeight="bold",l.style.textAlign="center",l.style.maxWidth="100%",l.style.wordWrap="break-word",a.appendChild(l);let m=document.createElement("div");if(m.id="barcode-svg-container",a.appendChild(m),j&&void 0!==h){let b=document.createElement("div");b.textContent=`${i} ${h.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`,b.style.fontSize="18px",b.style.fontWeight="bold",b.style.textAlign="center",a.appendChild(b)}k.appendChild(a);let n=(0,e.createRoot)(m);await new Promise(a=>{let c=d.default;n.render(b.default.createElement(c,{value:g,width:2,height:80,fontSize:16})),setTimeout(()=>a(),100)}),(await (0,c.default)(k,{backgroundColor:"#ffffff",scale:2})).toBlob(a=>{if(a){let b=URL.createObjectURL(a),c=document.createElement("a"),d=f.replace(/[^a-z0-9]/gi,"_").toLowerCase();c.download=`barcode_${d}_${Date.now()}.jpg`,c.href=b,c.click(),URL.revokeObjectURL(b)}},"image/jpeg",.95),n.unmount()}catch(a){throw console.error("Error exporting barcode to JPEG:",a),a}finally{document.body.removeChild(k)}};a.s(["exportBarcodeToJPEG",0,f])},722708,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(893759),f=b([e]);[e]=f.then?(await f)():f,a.s(["default",0,({open:a,onOpenChange:b,product:c,onConfirm:f})=>(0,d.jsx)(e.AlertDialog,{open:a,onOpenChange:b,children:(0,d.jsxs)(e.AlertDialogContent,{children:[(0,d.jsxs)(e.AlertDialogHeader,{children:[(0,d.jsx)(e.AlertDialogTitle,{children:"Are you sure?"}),(0,d.jsxs)(e.AlertDialogDescription,{children:['This will delete the product "',c?.name,'" and all its associated data. This action cannot be undone.']})]}),(0,d.jsxs)(e.AlertDialogFooter,{children:[(0,d.jsx)(e.AlertDialogCancel,{children:"Cancel"}),(0,d.jsx)(e.AlertDialogAction,{onClick:()=>{f(),b(!1)},className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})})]),c()}catch(a){c(a)}},!1),958982,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(687989),g=a.i(964889),h=a.i(811705),i=a.i(396465),j=a.i(747899),k=a.i(224993),l=a.i(799856),m=a.i(899054),n=a.i(445916),o=a.i(499239),p=a.i(436028),q=a.i(2026),r=a.i(946032),s=a.i(533695),t=a.i(506766),u=a.i(126741),v=a.i(532572),w=a.i(147358),x=a.i(493901),y=a.i(268356),z=a.i(460577),A=a.i(966643),B=a.i(625250),C=a.i(792071),D=a.i(722708),E=a.i(482331),F=a.i(142499),G=a.i(531811),H=a.i(169320),I=a.i(112779),J=a.i(805297),K=a.i(109254),L=a.i(366736),M=a.i(397625),N=b([g,h,i,k,l,m,B,D,E,F,G,H,I,J,K,L,M]);[g,h,i,k,l,m,B,D,E,F,G,H,I,J,K,L,M]=N.then?(await N)():N,a.s(["default",0,({product:a,stockHistory:b,isLoadingHistory:c,onStockUpdate:N})=>{let O=(0,j.useNavigate)(),{user:P}=(0,G.useAuth)(),{currentBusiness:Q}=(0,g.useBusiness)(),{settings:R}=(0,k.useBusinessSettings)(),{updateProduct:S,deleteProduct:T}=(0,E.useProducts)(P?.id),{createStockHistoryEntry:U,stockHistory:V}=(0,F.useStockHistory)(P?.id,a.id),{hasPermission:W}=(0,J.useProfiles)(),[X,Y]=(0,e.useState)(!1),[Z,$]=(0,e.useState)(!1),[_,aa]=(0,e.useState)("Stock In"),[ab,ac]=(0,e.useState)(0),[ad,ae]=(0,e.useState)(""),[af,ag]=(0,e.useState)(new Date().toISOString().split("T")[0]),[ah,ai]=(0,e.useState)(new Date().toTimeString().split(" ")[0]),[aj,ak]=(0,e.useState)(!1),[al,am]=(0,e.useState)(!1),[an,ao]=(0,e.useState)(!0),[ap,aq]=(0,e.useState)(1),[ar,as]=(0,e.useState)(!1),{formatFinancial:at,canViewCostPrice:au,canViewProfit:av,canViewSellingPrice:aw}=(0,B.useFinancialVisibility)(),ax=async()=>!!await T(a.id)&&(H.toast.success("Product deleted successfully"),O("/inventory"),!0),ay=(a,c)=>{if(!a)return"";let d=(()=>{let a=b.length>0?b:V;if(0===a.length)return null;let c=[...a].sort((a,b)=>a.createdAt.getTime()-b.createdAt.getTime());return c[0]?.createdAt||null})();if(!d)return"";let[e,f,g]=a.split("-").map(Number),[h,i,j=0]=c.split(":").map(Number);return new Date(e,f-1,g,h,i,j)<d?`Date and time cannot be before the initial stock date and time (${(0,C.format)(d,"PPP p")})`:""},az=async()=>{if(!ab||ab<=0)return void H.toast.error("Please enter a valid quantity greater than zero");let b=ay(af,ah);if(b)return void H.toast.error(b);ak(!0);try{let b=a.quantity,c=b,d=ad.trim()?`${_}: ${ad}`:_;"Stock In"===_?c=b+ab:"Stock Out"===_&&(c=Math.max(0,b-ab),0===c&&b<ab&&H.toast.warning(`Attempted to remove ${ab} items but only ${b} were available. Stock is now 0.`));let[e,f,g]=af.split("-").map(Number),[h,i,j=0]=ah.split(":").map(Number),k=new Date(e,f-1,g,h,i,j);await U(a.id,b,c,d,void 0,k,void 0,a.name)?await S(a.id,{quantity:c},void 0,!1,"skip-history")?(H.toast.success("Stock updated successfully"),N&&N(),ac(0),ae(""),ag(new Date().toISOString().split("T")[0]),ai(new Date().toTimeString().split(" ")[0])):H.toast.error("History logged, but failed to update product quantity."):H.toast.error("Failed to update stock history")}catch(a){console.error("Error applying stock adjustment:",a),H.toast.error("Failed to apply stock adjustment. Please try again.")}finally{ak(!1)}};return(0,d.jsxs)("div",{className:"space-y-6",children:[(0,d.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-3 md:p-4 shadow-sm",children:(0,d.jsxs)("div",{className:"flex flex-col space-y-3 lg:flex-row lg:justify-between lg:items-center lg:space-y-0 lg:gap-4",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsxs)(i.Button,{variant:"outline",size:"sm",onClick:()=>O("/products"),className:"flex items-center gap-2 hover:bg-gray-50 text-sm",children:[(0,d.jsx)(q.ArrowLeft,{className:"h-4 w-4"}),"Back to Products"]}),(0,d.jsxs)(i.Button,{variant:"outline",size:"sm",onClick:N,className:"flex items-center gap-1 text-sm",children:[(0,d.jsx)(t.RefreshCw,{className:"h-4 w-4"}),"Refresh Data"]})]}),(0,d.jsxs)("div",{className:"flex flex-col space-y-2 lg:flex-row lg:items-center lg:space-y-0 lg:gap-2",children:[W("inventory","create")&&(0,d.jsxs)(i.Button,{variant:"outline",size:"sm",onClick:()=>{H.toast.success("Duplicating product..."),O("/inventory/new",{state:{duplicateData:{name:`${a.name} (Copy)`,description:a.description,category:a.category,supplier:a.supplier,costPrice:a.costPrice,sellingPrice:a.sellingPrice,imageUrl:a.imageUrl,createdAt:a.createdAt,minimumStock:a.minimumStock}}})},className:"flex items-center justify-center gap-2 w-full lg:w-auto hover:bg-blue-50 hover:border-blue-300 text-sm",children:[(0,d.jsx)(s.Copy,{className:"h-4 w-4"}),"Duplicate"]}),W("inventory","edit")&&(0,d.jsxs)(i.Button,{onClick:()=>O(`/inventory/edit/${a.id}`),className:"flex items-center justify-center gap-2 w-full lg:w-auto bg-secondary hover:bg-secondary/90 text-sm",size:"sm",children:[(0,d.jsx)(n.Edit,{className:"h-4 w-4"}),"Edit Product"]}),(0,d.jsxs)(K.Dialog,{open:al,onOpenChange:am,children:[(0,d.jsx)(K.DialogTrigger,{asChild:!0,children:(0,d.jsxs)(i.Button,{variant:"outline",size:"sm",className:"flex items-center justify-center gap-2 w-full lg:w-auto hover:bg-green-50 hover:border-green-300 text-sm",children:[(0,d.jsx)(u.Printer,{className:"h-4 w-4"}),"Barcode Label"]})}),(0,d.jsxs)(K.DialogContent,{className:"sm:max-w-md",children:[(0,d.jsx)(K.DialogHeader,{children:(0,d.jsx)(K.DialogTitle,{children:"Barcode Label Preview"})}),(0,d.jsx)("div",{className:"flex flex-col items-center justify-center py-6 bg-gray-50 rounded-lg border border-dashed",children:a.barcode?(0,d.jsxs)("div",{className:"bg-white p-6 shadow-sm rounded-md flex flex-col items-center",children:[(0,d.jsx)("span",{className:"text-lg font-bold mb-2 truncate max-w-[280px]",children:a.name}),(0,d.jsx)(f.default,{value:a.barcode,width:2,height:80,fontSize:16}),an&&(0,d.jsxs)("span",{className:"text-lg font-bold mt-2",children:[R.currency," ",(0,l.formatNumber)(a.sellingPrice)]})]}):(0,d.jsxs)("div",{className:"text-center p-6 text-muted-foreground",children:[(0,d.jsx)(p.AlertCircle,{className:"h-10 w-10 mx-auto mb-2 opacity-50"}),(0,d.jsx)("p",{children:"No barcode available for this selection."})]})}),(0,d.jsxs)("div",{className:"space-y-4 pt-4 border-t",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"space-y-0.5",children:[(0,d.jsx)(M.Label,{className:"text-sm font-medium",children:"Show Price"}),(0,d.jsx)("p",{className:"text-xs text-muted-foreground",children:"Include price on the printed label"})]}),(0,d.jsx)(L.Switch,{checked:an,onCheckedChange:ao})]}),(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"space-y-0.5",children:[(0,d.jsx)(M.Label,{className:"text-sm font-medium",children:"Quantity to Print"}),(0,d.jsx)("p",{className:"text-xs text-muted-foreground",children:"Number of labels to print"})]}),(0,d.jsx)(I.Input,{type:"number",min:"1",className:"w-20",value:ap,onChange:a=>aq(parseInt(a.target.value)||1)})]}),(0,d.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,d.jsxs)(i.Button,{className:"w-full gap-2",disabled:!a.barcode,onClick:()=>{let b=an?`TEXT 15,180,"3",0,1,1,"${R.currency} ${(0,l.formatNumber)(a.sellingPrice)}"
`:"";fetch("http://localhost:5000/print/label",{method:"POST",headers:{"Content-Type":"application/json"},mode:"cors",body:JSON.stringify({PrinterName:R.defaultPrinterName||"Label Printer",Content:`SIZE 50 mm, 30 mm
GAP 3 mm, 0 mm
CLS
TEXT 15,20,"3",0,1,1,"${a.name}"
BARCODE 15,70,"128",60,1,0,2,2,"${a.barcode}"
${b}PRINT ${ap}
`})}).then(()=>{H.toast.success(`${ap} label${ap>1?"s":""} sent to printer`)}).catch(a=>{console.error("Failed to print label:",a),H.toast.error("Printing failed. Make sure Printer Bridge is running.")})},children:[(0,d.jsx)(u.Printer,{className:"h-4 w-4"}),"Print ",ap," Label",ap>1?"s":""]}),(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,d.jsx)("span",{className:"w-full border-t"})}),(0,d.jsx)("div",{className:"relative flex justify-center text-xs uppercase",children:(0,d.jsx)("span",{className:"bg-background px-2 text-muted-foreground",children:"Or Download"})})]}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,d.jsxs)(i.Button,{variant:"outline",className:"gap-2",disabled:!a.barcode||ar,onClick:async()=>{as(!0);try{await (0,z.exportBarcodeToJPEG)({productName:a.name,barcodeValue:a.barcode,price:a.sellingPrice,currency:R.currency,showPrice:an}),H.toast.success("Barcode exported as JPEG")}catch(a){console.error("Export failed:",a),H.toast.error("Failed to export barcode")}finally{as(!1)}},children:[(0,d.jsx)(w.FileImage,{className:"h-4 w-4"}),"JPEG"]}),(0,d.jsxs)(i.Button,{variant:"outline",className:"gap-2",disabled:!a.barcode||ar,onClick:async()=>{as(!0);try{await (0,A.exportSingleBarcodeToPDF)({productName:a.name,barcodeValue:a.barcode,price:a.sellingPrice,currency:R.currency,showPrice:an}),H.toast.success("Barcode exported as PDF")}catch(a){console.error("Export failed:",a),H.toast.error("Failed to export barcode")}finally{as(!1)}},children:[(0,d.jsx)(v.Download,{className:"h-4 w-4"}),"PDF"]})]}),(0,d.jsx)(i.Button,{variant:"outline",className:"w-full",onClick:()=>am(!1),children:"Close"})]})]})]})]}),W("inventory","delete")&&(0,d.jsxs)(i.Button,{variant:"outline",size:"sm",onClick:()=>Y(!0),className:"flex items-center justify-center gap-2 w-full lg:w-auto text-red-600 hover:text-red-700 border-red-200 hover:border-red-300 hover:bg-red-50 text-sm",children:[(0,d.jsx)(r.Trash2,{className:"h-4 w-4"}),"Delete"]})]})]})}),(0,d.jsxs)("div",{className:"grid md:grid-cols-3 gap-6",children:[(0,d.jsxs)(h.Card,{className:"md:col-span-2",children:[(0,d.jsx)(h.CardHeader,{children:(0,d.jsxs)(h.CardTitle,{className:"flex justify-between items-center",children:[(0,d.jsx)("span",{children:"Product Details"}),0===a.quantity?(0,d.jsx)(m.Badge,{variant:"destructive",className:"text-sm",children:"Out of stock"}):a.quantity<=a.minimumStock?(0,d.jsx)(m.Badge,{variant:"warning",className:"bg-amber-500 text-sm",children:"Low stock"}):(0,d.jsx)(m.Badge,{variant:"success",className:"bg-green-600 text-sm",children:"In stock"})]})}),(0,d.jsxs)(h.CardContent,{className:"space-y-6",children:[(0,d.jsxs)("div",{className:"flex flex-col md:flex-row gap-6",children:[a.imageUrl&&(0,d.jsx)("div",{className:"md:w-1/3",children:(0,d.jsx)("img",{src:a.imageUrl,alt:a.name,className:"w-full h-auto object-contain border rounded-md"})}),(0,d.jsxs)("div",{className:a.imageUrl?"md:w-2/3":"w-full",children:[(0,d.jsx)("h2",{className:"text-2xl font-bold mb-2",children:a.name}),(0,d.jsxs)("div",{className:"mb-4 flex flex-wrap gap-2",children:[(0,d.jsx)(m.Badge,{variant:"outline",children:a.category}),(0,d.jsxs)(m.Badge,{variant:"secondary",children:["#",a.itemNumber]})]}),a.description&&(0,d.jsx)("p",{className:"text-gray-700 mb-4",children:a.description}),(0,d.jsxs)("dl",{className:"grid grid-cols-2 gap-x-4 gap-y-2",children:[(0,d.jsx)("dt",{className:"text-gray-500",children:"Item Number:"}),(0,d.jsxs)("dd",{className:"font-semibold",children:["#",a.itemNumber]}),a.manufacturerBarcode&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("dt",{className:"text-gray-500",children:"Manufacturer Barcode:"}),(0,d.jsx)("dd",{className:"font-semibold",children:a.manufacturerBarcode})]}),(0,d.jsx)("dt",{className:"text-gray-500",children:"Quantity in Stock:"}),(0,d.jsx)("dd",{className:"font-semibold",children:a.quantity%1==0?a.quantity:a.quantity.toFixed(2)}),(0,d.jsx)("dt",{className:"text-gray-500",children:"Minimum Stock Level:"}),(0,d.jsx)("dd",{children:a.minimumStock}),(0,d.jsx)("dt",{className:"text-gray-500",children:"Cost Price:"}),(0,d.jsx)("dd",{children:au?`${R.currency} ${at(a.costPrice,"cost")}`:"•••"}),(0,d.jsx)("dt",{className:"text-gray-500",children:"Selling Price:"}),(0,d.jsx)("dd",{children:aw?`${R.currency} ${at(a.sellingPrice,"selling")}`:"•••"}),(0,d.jsx)("dt",{className:"text-gray-500",children:"Total Cost:"}),(0,d.jsx)("dd",{className:"font-semibold",children:au?`${R.currency} ${(0,l.formatNumber)(a.quantity*a.costPrice)}`:"•••"}),(0,d.jsx)("dt",{className:"text-gray-500",children:"Profit Margin:"}),(0,d.jsx)("dd",{children:av?`${((a.sellingPrice-a.costPrice)/a.sellingPrice*100).toFixed(2)}%`:"•••"}),a.supplier&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("dt",{className:"text-gray-500",children:"Supplier:"}),(0,d.jsx)("dd",{children:a.supplier})]}),(0,d.jsx)("dt",{className:"text-gray-500",children:"Created:"}),(0,d.jsx)("dd",{children:(0,C.format)(a.createdAt,"MMM d, yyyy")}),(0,d.jsx)("dt",{className:"text-gray-500",children:"Last Updated:"}),(0,d.jsx)("dd",{children:(0,C.format)(a.updatedAt,"MMM d, yyyy")})]})]})]}),(0,d.jsx)("div",{className:"flex flex-wrap gap-4",children:a.quantity<=a.minimumStock&&(0,d.jsxs)("div",{className:"bg-amber-50 border border-amber-200 rounded-md p-4 w-full flex items-center gap-3",children:[(0,d.jsx)(p.AlertCircle,{className:"text-amber-600 h-6 w-6 flex-shrink-0"}),(0,d.jsxs)("div",{children:[(0,d.jsx)("h4",{className:"font-medium text-amber-800",children:"Low Stock Alert"}),(0,d.jsxs)("p",{className:"text-sm text-amber-700",children:["Current stock (",a.quantity,") is below or equal to the minimum threshold (",a.minimumStock,")."]})]})]})})]})]}),(0,d.jsx)("div",{className:"space-y-6",children:(0,d.jsxs)(h.Card,{children:[(0,d.jsx)(h.CardHeader,{className:"pb-2",children:(0,d.jsx)(h.CardTitle,{className:"text-lg",children:"Stock Management"})}),(0,d.jsx)(h.CardContent,{children:W("inventory","stock_adjustment")?(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Adjustment Type"}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-2",children:[(0,d.jsxs)(i.Button,{type:"button",variant:"Stock In"===_?"default":"outline",onClick:()=>aa("Stock In"),className:`w-full ${"Stock In"===_?"bg-orange-600 hover:bg-orange-700":""}`,children:[(0,d.jsx)(x.Plus,{className:"mr-2 h-4 w-4"}),"Stock In"]}),(0,d.jsxs)(i.Button,{type:"button",variant:"Stock Out"===_?"default":"outline",onClick:()=>aa("Stock Out"),className:`w-full ${"Stock Out"===_?"bg-orange-600 hover:bg-orange-700":""}`,children:[(0,d.jsx)(y.Minus,{className:"mr-2 h-4 w-4"}),"Stock Out"]})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Quantity"}),(0,d.jsx)(I.Input,{type:"number",min:"0.01",step:"0.01",value:ab||"",onChange:a=>ac(parseFloat(a.target.value)||0),placeholder:"Enter quantity"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Reason (Optional)"}),(0,d.jsx)(I.Input,{type:"text",value:ad,onChange:a=>ae(a.target.value),placeholder:"e.g., Weekly restock, Damaged goods",maxLength:100})]}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Date"}),(0,d.jsx)(I.Input,{type:"date",value:af,onChange:a=>ag(a.target.value),min:a.createdAt?new Date(a.createdAt).toISOString().split("T")[0]:void 0,max:new Date().toISOString().split("T")[0],className:ay(af,ah)?"border-destructive border-2 bg-destructive/5":""})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Time"}),(0,d.jsx)(I.Input,{type:"time",step:"1",value:ah,onChange:a=>ai(a.target.value),className:ay(af,ah)?"border-destructive border-2 bg-destructive/5":""})]})]}),ay(af,ah)&&(0,d.jsx)("p",{className:"text-sm text-destructive mt-1",children:ay(af,ah)}),(0,d.jsxs)(i.Button,{onClick:az,disabled:aj||ab<=0||!!ay(af,ah),className:"w-full bg-orange-600 hover:bg-orange-700",children:[(0,d.jsx)(o.Package,{className:"mr-2 h-4 w-4"}),aj?"Applying...":`Apply ${_}`]})]}):(0,d.jsxs)("div",{className:"py-4 text-center space-y-2",children:[(0,d.jsx)(p.AlertCircle,{className:"h-8 w-8 text-muted-foreground mx-auto opacity-50"}),(0,d.jsx)("p",{className:"text-sm text-muted-foreground",children:"You do not have permission to perform stock adjustments."})]})})]})})]}),(0,d.jsx)(D.default,{open:X,onOpenChange:Y,product:a,onConfirm:ax})]})}]),c()}catch(a){c(a)}},!1),4760,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(811705),g=a.i(396465),h=a.i(899054),i=a.i(445916),j=a.i(818703),k=a.i(946032),l=a.i(470167),m=a.i(805297),n=a.i(792071),o=a.i(386925),p=a.i(239366),q=b([f,g,h,m,o,p]);[f,g,h,m,o,p]=q.then?(await q)():q,a.s(["default",0,({stockHistory:a,isLoadingHistory:b,onEditStockHistory:c,onDeleteStockHistory:q,products:r})=>{let s,{hasPermission:t}=(0,m.useProfiles)(),[u,v]=(0,e.useState)({open:!1,entry:null}),[w,x]=(0,e.useState)({open:!1,entry:null}),[y,z]=(0,e.useState)(null),[A,B]=(0,e.useState)(null),C=b=>{if(0===a.length)return!1;let c=[...a].sort((a,b)=>a.createdAt.getTime()-b.createdAt.getTime());return c[0]?.id===b.id},D=(0,e.useMemo)(()=>{let b={},c=[];return a.forEach(a=>{if(["Sale","Delete sale","Deleted Sale","Sale qty edit"].some(b=>a.changeReason.toLowerCase().includes(b.toLowerCase()))){let c=a.receiptNumber||a.referenceId||a.id;b[c]||(b[c]=[]),b[c].push(a)}else c.push(a)}),[...Object.values(b).map(a=>{let b=[...a].sort((a,b)=>new Date(b.createdAt).getTime()-new Date(a.createdAt).getTime());return{type:"sale",main:b[0],all:b,sortDate:b[0].createdAt}}),...c.map(a=>({type:"single",entry:a,sortDate:a.createdAt}))].sort((a,b)=>{let c=new Date(a.sortDate).getTime();return new Date(b.sortDate).getTime()-c})},[a]),E=b?(0,d.jsxs)("div",{className:"animate-pulse text-center py-8",children:[(0,d.jsx)("div",{className:"w-16 h-16 bg-gray-200 rounded-full mx-auto mb-4"}),(0,d.jsx)("p",{className:"text-gray-500",children:"Loading stock history..."})]}):0===a.length?(0,d.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,d.jsx)(l.History,{size:48,className:"mx-auto mb-4 opacity-50"}),(0,d.jsx)("p",{children:"No stock history available for this product"}),(0,d.jsx)("p",{className:"text-sm mt-2",children:"Stock changes will appear here once you make adjustments"})]}):(0,d.jsx)("div",{className:"space-y-3",children:D.map(a=>{if("sale"===a.type){let{main:b,all:c}=a,e=b.receiptNumber||b.referenceId||b.id,f=y===e,i=c[0],k=c[c.length-1],l=c.length>1;return(0,d.jsxs)("div",{className:`border rounded-lg p-4 transition-colors ${b.newQuantity>b.oldQuantity?"bg-green-50 border-green-200 hover:bg-green-100":b.newQuantity<b.oldQuantity?"bg-red-50 border-red-200 hover:bg-red-100":"border-gray-200 hover:bg-gray-50"}`,children:[(0,d.jsxs)("div",{className:"flex justify-between items-start",children:[(0,d.jsxs)("div",{className:"flex-1",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,d.jsxs)(h.Badge,{variant:"outline",className:"text-xs",children:["Sale - ",b.receiptNumber||b.referenceId||b.id]}),l&&(0,d.jsx)(h.Badge,{variant:"secondary",className:"text-[10px] h-5",children:"Edited"})]}),(0,d.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[l?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(h.Badge,{variant:"outline",className:"text-xs bg-muted/50 font-normal",children:["Original: ",k.oldQuantity," → ",k.newQuantity," (",k.newQuantity-k.oldQuantity>0?"+":"",k.newQuantity-k.oldQuantity,")"]}),(0,d.jsx)("span",{className:"text-muted-foreground",children:"→"}),(0,d.jsxs)(h.Badge,{variant:"secondary",className:"text-xs font-normal",children:["Current: ",i.oldQuantity," → ",i.newQuantity," (",i.newQuantity-i.oldQuantity>0?"+":"",i.newQuantity-i.oldQuantity,")"]})]}):(0,d.jsxs)(h.Badge,{variant:"outline",className:"text-xs bg-muted/50 font-normal",children:["Qty: ",b.oldQuantity," → ",b.newQuantity," (",b.newQuantity-b.oldQuantity>0?"+":"",b.newQuantity-b.oldQuantity,")"]}),!l&&(0,d.jsxs)("div",{className:"text-sm text-gray-500 flex items-center gap-1 ml-2",children:[(0,d.jsx)(j.Clock,{className:"inline-block w-3 h-3"}),(0,n.format)(b.createdAt,"MMM d, yyyy h:mm a")]}),l&&(0,d.jsxs)("div",{className:"text-sm text-gray-500 flex items-center gap-1 ml-2",children:[(0,d.jsx)(j.Clock,{className:"inline-block w-3 h-3"}),(0,n.format)(i.createdAt,"MMM d, yyyy h:mm a")]})]})]}),(0,d.jsx)("div",{className:"flex items-center gap-3",children:(0,d.jsx)(g.Button,{variant:"ghost",size:"sm",className:"h-8 px-2 text-xs",onClick:()=>z(f?null:e),children:f?"Hide Details":"View Details"})})]}),f&&(0,d.jsxs)("div",{className:"mt-4 border-t pt-3",children:[(0,d.jsx)("div",{className:"font-semibold mb-2 text-sm text-muted-foreground",children:"Sale Actions"}),(0,d.jsx)("div",{className:"overflow-x-auto",children:(0,d.jsxs)("table",{className:"min-w-full text-xs border",children:[(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{className:"bg-muted/50",children:[(0,d.jsx)("th",{className:"px-2 py-1 text-left",children:"Action"}),(0,d.jsx)("th",{className:"px-2 py-1 text-left",children:"Date"}),(0,d.jsx)("th",{className:"px-2 py-1 text-left",children:"Qty Change"})]})}),(0,d.jsx)("tbody",{children:c.map(a=>(0,d.jsxs)("tr",{className:"border-b last:border-b-0",children:[(0,d.jsx)("td",{className:"px-2 py-1 font-medium",children:a.changeReason.replace("Deleted sale","Deleted Sale")}),(0,d.jsx)("td",{className:"px-2 py-1 text-muted-foreground",children:(0,n.format)(a.createdAt,"MMM d, yyyy h:mm a")}),(0,d.jsxs)("td",{className:"px-2 py-1",children:[a.oldQuantity," → ",a.newQuantity," (",a.newQuantity-a.oldQuantity>0?"+":"",a.newQuantity-a.oldQuantity,")"]})]},a.id))})]})})]})]},b.id)}{let{entry:b}=a,c=A===b.id;return(0,d.jsxs)("div",{className:`border rounded-lg p-4 transition-colors ${b.newQuantity>b.oldQuantity?"bg-green-50 border-green-200 hover:bg-green-100":b.newQuantity<b.oldQuantity?"bg-red-50 border-red-200 hover:bg-red-100":"border-gray-200 hover:bg-gray-50"}`,children:[(0,d.jsxs)("div",{className:"flex justify-between items-start",children:[(0,d.jsxs)("div",{className:"flex-1",children:[(0,d.jsx)("div",{className:"flex items-center gap-2 mb-2",children:(0,d.jsxs)(h.Badge,{variant:"outline",className:"text-xs",children:[b.changeReason.replace("Deleted sale","Deleted Sale"),b.receiptNumber&&` - #${b.receiptNumber}`]})}),(0,d.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,d.jsxs)(h.Badge,{variant:"outline",className:"text-xs bg-muted/50 font-normal",children:["Qty: ",b.oldQuantity," → ",b.newQuantity," (",b.newQuantity-b.oldQuantity>0?"+":"",b.newQuantity-b.oldQuantity,")"]}),(0,d.jsxs)("div",{className:"text-sm text-gray-500 flex items-center gap-1 ml-2",children:[(0,d.jsx)(j.Clock,{className:"inline-block w-3 h-3"}),(0,n.format)(b.createdAt,"MMM d, yyyy h:mm a")]})]})]}),(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[(0,d.jsx)(g.Button,{variant:"ghost",size:"sm",className:"h-8 px-2 text-xs",onClick:()=>B(c?null:b.id),children:c?"Hide Details":"View Details"}),C(b)?(0,d.jsxs)(d.Fragment,{children:[t("inventory","edit")&&(0,d.jsx)(g.Button,{variant:"outline",size:"sm",onClick:()=>v({open:!0,entry:b}),className:"h-8 px-2",children:(0,d.jsx)(i.Edit,{className:"h-3 w-3"})}),(0,d.jsx)("div",{className:"text-xs text-muted-foreground px-2 py-1 bg-blue-100 text-blue-800 rounded",children:"Initial Stock"})]}):(0,d.jsxs)(d.Fragment,{children:[t("inventory","edit")&&(0,d.jsx)(g.Button,{variant:"outline",size:"sm",onClick:()=>v({open:!0,entry:b}),className:"h-8 px-2",children:(0,d.jsx)(i.Edit,{className:"h-3 w-3"})}),t("inventory","delete")&&(0,d.jsx)(g.Button,{variant:"outline",size:"sm",onClick:()=>x({open:!0,entry:b}),className:"h-8 px-2 text-destructive hover:text-destructive",children:(0,d.jsx)(k.Trash2,{className:"h-3 w-3"})})]})]})]}),c&&(0,d.jsxs)("div",{className:"mt-4 border-t pt-3",children:[(0,d.jsx)("div",{className:"font-semibold mb-2 text-sm text-muted-foreground",children:"Details"}),(0,d.jsx)("div",{className:"overflow-x-auto",children:(0,d.jsxs)("table",{className:"min-w-full text-xs border",children:[(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{className:"bg-muted/50",children:[(0,d.jsx)("th",{className:"px-2 py-1 text-left",children:"Reason"}),(0,d.jsx)("th",{className:"px-2 py-1 text-left",children:"Date"}),(0,d.jsx)("th",{className:"px-2 py-1 text-left",children:"Qty Change"})]})}),(0,d.jsx)("tbody",{children:(0,d.jsxs)("tr",{className:"border-b last:border-b-0",children:[(0,d.jsx)("td",{className:"px-2 py-1 font-medium",children:b.changeReason.replace("Deleted sale","Deleted Sale")}),(0,d.jsx)("td",{className:"px-2 py-1 text-muted-foreground",children:(0,n.format)(b.createdAt,"MMM d, yyyy h:mm a")}),(0,d.jsxs)("td",{className:"px-2 py-1",children:[b.oldQuantity," → ",b.newQuantity," (",b.newQuantity-b.oldQuantity>0?"+":"",b.newQuantity-b.oldQuantity,")"]})]})})]})})]})]},b.id)}})});return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(f.Card,{children:[(0,d.jsx)(f.CardHeader,{children:(0,d.jsx)("div",{className:"flex items-center justify-between",children:(0,d.jsxs)(f.CardTitle,{className:"flex items-center gap-2",children:[(0,d.jsx)(l.History,{className:"h-5 w-5"}),"Stock History",a.length>0&&(0,d.jsxs)(h.Badge,{variant:"secondary",className:"ml-2",children:[a.length," entries"]})]})})}),(0,d.jsx)(f.CardContent,{children:E})]}),(0,d.jsx)(o.default,{open:u.open,onOpenChange:a=>v({open:a,entry:null}),entry:u.entry,onConfirm:c,isInitialStock:!!u.entry&&C(u.entry),stockHistory:a,productCreatedAt:u.entry&&(s=r.find(a=>a.id===u.entry?.productId))?new Date(s.createdAt):void 0}),(0,d.jsx)(p.default,{open:w.open,onOpenChange:a=>x({open:a,entry:null}),entry:w.entry,onConfirm:q})]})}]),c()}catch(a){c(a)}},!1),792444,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(747899),g=a.i(531811),h=a.i(482331),i=a.i(142499),j=a.i(834122),k=a.i(169320),l=a.i(958982),m=a.i(4760),n=b([g,h,i,j,k,l,m]);[g,h,i,j,k,l,m]=n.then?(await n)():n,a.s(["default",0,()=>{let{id:a}=(0,f.useParams)(),b=(0,f.useNavigate)(),{user:c}=(0,g.useAuth)(),{products:n,isLoading:o,loadProducts:p,refetch:q}=(0,h.useProducts)(c?.id,1e4),[r,s]=(0,e.useState)(null),{stockHistory:t,isLoading:u,loadStockHistory:v,updateStockHistoryEntry:w,deleteStockHistoryEntry:x,recalculateProductStock:y}=(0,i.useStockHistory)(c?.id,a),{clearAllLocationCaches:z}=(0,j.useStockSummaryData)({from:void 0,to:void 0}),[A,B]=(0,e.useState)(!1),[C,D]=(0,e.useState)(0),E=async()=>{if(a){B(!0);let{data:c}=await q(),d=(c?.products||[]).find(b=>b.id===a);d?s(d):(k.toast.error("Product not found"),b("/inventory")),B(!1)}},F=async()=>{await E(),a&&v&&await v(),D(a=>a+1)},G=async(a,b,c,d)=>{let e=await w(a,b,c,d);return e&&(z(),await Promise.all([v(),E()])),e},H=async a=>{let b=await x(a);return b&&(z(),await Promise.all([y(r.id),v(),E()])),b};return((0,e.useEffect)(()=>{if(!o&&n.length>0&&a){let c=n.find(b=>b.id===a);c?s(c):(k.toast.error("Product not found"),b("/inventory"))}},[a,n,o,b]),(0,e.useEffect)(()=>{let a=()=>{console.log("Stock updated, refreshing product data"),F()};return window.addEventListener("stock-updated",a),()=>{window.removeEventListener("stock-updated",a)}},[F]),o||A||!r)?(0,d.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-[60vh] space-y-4",children:[(0,d.jsx)("img",{src:"/lovable-uploads/7f7549a3-e9df-4762-b8b9-8e041e34f55d.png",alt:"Loading",className:"w-16 h-16 animate-spin"}),(0,d.jsx)("p",{className:"text-muted-foreground",children:"Loading product data..."})]}):(0,d.jsxs)("div",{className:"space-y-6",children:[(0,d.jsx)(l.default,{product:r,stockHistory:t,isLoadingHistory:u,onStockUpdate:F},`details-${C}`),(0,d.jsx)(m.default,{stockHistory:t,isLoadingHistory:u,onEditStockHistory:G,onDeleteStockHistory:H,products:n},`history-${C}`)]})}]),c()}catch(a){c(a)}},!1),379291,a=>a.a(async(b,c)=>{try{var d=a.i(579168),e=a.i(627068),f=a.i(332759),g=a.i(539141),h=a.i(706555),i=a.i(792444),j=a.i(509193),k=b([i]);[i]=k.then?(await k)():k;let l=(0,f.hoist)(i,"default"),m=(0,f.hoist)(i,"getStaticProps"),n=(0,f.hoist)(i,"getStaticPaths"),o=(0,f.hoist)(i,"getServerSideProps"),p=(0,f.hoist)(i,"config"),q=(0,f.hoist)(i,"reportWebVitals"),r=(0,f.hoist)(i,"unstable_getStaticProps"),s=(0,f.hoist)(i,"unstable_getStaticPaths"),t=(0,f.hoist)(i,"unstable_getStaticParams"),u=(0,f.hoist)(i,"unstable_getServerProps"),v=(0,f.hoist)(i,"unstable_getServerSideProps"),w=new d.PagesRouteModule({definition:{kind:e.RouteKind.PAGES,page:"/ProductDetail",pathname:"/ProductDetail",bundlePath:"",filename:""},distDir:".next",relativeProjectDir:"",components:{App:h.default,Document:g.default},userland:i}),x=(0,j.getHandler)({srcPage:"/ProductDetail",config:p,userland:i,routeModule:w,getStaticPaths:n,getStaticProps:m,getServerSideProps:o});a.s(["config",0,p,"default",0,l,"getServerSideProps",0,o,"getStaticPaths",0,n,"getStaticProps",0,m,"handler",0,x,"reportWebVitals",0,q,"routeModule",0,w,"unstable_getServerProps",0,u,"unstable_getServerSideProps",0,v,"unstable_getStaticParams",0,t,"unstable_getStaticPaths",0,s,"unstable_getStaticProps",0,r]),c()}catch(a){c(a)}},!1)];

//# sourceMappingURL=_7e730563._.js.map