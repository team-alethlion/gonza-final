module.exports=[773320,a=>{"use strict";let b=(0,a.i(170106).default)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);a.s(["Upload",()=>b],773320)},292e3,a=>{"use strict";let b=(0,a.i(170106).default)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);a.s(["AlertCircle",()=>b],292e3)},429246,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(368114);let e=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("textarea",{className:(0,d.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:e,...c}));e.displayName="Textarea",a.s(["Textarea",()=>e])},596221,a=>{"use strict";let b=(0,a.i(170106).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);a.s(["Loader2",()=>b],596221)},3048,(a,b,c)=>{let d=Error("Could not parse module '[project]/src/app/actions/products.ts'\n\n'import', and 'export' cannot be used outside of module code");throw d.code="MODULE_UNPARSABLE",d},347778,282141,a=>{"use strict";var b=a.i(572131),c=a.i(866102),d=a.i(169819),e=a.i(433217),f=a.i(937927);let g=a=>{};a.s(["clearInventoryCaches",0,g],282141);var h=a.i(3048);a.s(["useProducts",0,(a,i=50)=>{let[j,k]=(0,b.useState)([]),[l,m]=(0,b.useState)(1),[n,o]=(0,b.useState)(i),[p,q]=(0,b.useState)(0),[r,s]=(0,b.useState)(!1),{settings:t}=(0,c.useBusinessSettings)(),{currentBusiness:u}=(0,d.useBusiness)(),v=(0,f.useQueryClient)(),[w,x]=(0,b.useState)({search:"",category:"all",stockStatus:"all"}),[y,z]=(0,b.useState)(null),A=(0,b.useCallback)(a=>{a.search!==w.search&&(s(!0),y&&clearTimeout(y),z(setTimeout(()=>{s(!1)},600))),x(a)},[w.search,y]),B=(0,b.useCallback)(async()=>{if(!a||!u)return{products:[],count:0};try{return await (0,h.getProductsAction)({userId:a,businessId:u.id,page:l,pageSize:n,search:w.search,category:"all"===w.category?void 0:w.category,stockStatus:w.stockStatus})}catch(a){return console.error("Error loading products from server action:",a),{products:[],count:0}}},[a,u?.id,l,n,w.search,w.category,w.stockStatus]),C=(0,b.useMemo)(()=>["products",a,u?.id],[a,u?.id]),D=(0,b.useMemo)(()=>[...C,l,n,w.search,w.category,w.stockStatus],[C,l,n,w.search,w.category,w.stockStatus]),{data:E,isLoading:F,isFetching:G,refetch:H}=(0,e.useQuery)({queryKey:D,queryFn:B,enabled:!!a&&!!u?.id,staleTime:3e4,gcTime:18e5,refetchOnWindowFocus:!0,refetchOnReconnect:!0});(0,b.useEffect)(()=>{E&&(k(E.products),q(E.count))},[E]);let I=async b=>{try{if(!a)return null;return console.warn("Image upload redirecting to server action (TODO)"),null}catch(a){return console.error("Error in uploadProductImage:",a),null}};return{products:j,isLoading:F&&!E&&!r,loadProducts:B,page:l,setPage:m,pageSize:n,setPageSize:o,totalCount:p,createProduct:async b=>{try{if(!a||!u)return null;let c=await (0,h.createProductAction)({...b,userId:a,businessId:u.id});if(!c)return null;return k(a=>[c,...a]),q(a=>a+1),v.invalidateQueries({queryKey:C}),g(v),c}catch(a){return console.error("Error creating product:",a),null}},updateProduct:async(b,c,d,e=!1,f,i,j,k)=>{try{if(!a||!u)return!1;let i=c.imageUrl;if(d&&(i=await I(d)),!await (0,h.updateProductAction)(b,{...c,imageUrl:i,userId:a,businessId:u.id,isFromSale:e,customChangeReason:f,referenceId:j}))return!1;return v.invalidateQueries({queryKey:C}),g(v),!0}catch(a){return console.error("Error updating product:",a),!1}},updateProductsBulk:async(b,c,d,e,f,i)=>{try{if(!a||!u)return!1;let c=await (0,h.updateProductsBulkAction)(b.map(a=>({id:a.id,updated:a.updated})),u.id);return c&&(v.invalidateQueries({queryKey:C}),g(v)),c}catch(a){return console.error("Error in bulk update:",a),!1}},deleteProduct:async b=>{try{if(!a)return!1;if(await (0,h.deleteProductAction)(b))return v.invalidateQueries({queryKey:C}),g(v),!0;return!1}catch(a){return console.error("Error deleting product:",a),!1}},uploadProductImage:I,refetch:H,isFetching:G,filters:w,setFilters:A}}],347778)},771931,a=>{"use strict";let b=(0,a.i(170106).default)("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]);a.s(["Printer",()=>b],771931)},400210,a=>{"use strict";let b=(0,a.i(170106).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);a.s(["ArrowLeft",()=>b],400210)},781560,a=>{"use strict";let b=(0,a.i(170106).default)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);a.s(["Trash2",()=>b],781560)},866102,a=>{"use strict";var b=a.i(572131),c=a.i(433217),d=a.i(478793),e=a.i(169819),f=a.i(405050);let g=(0,f.createServerReference)("40290a4fc6b8571a026afeb877566edb807919e482",f.callServer,void 0,f.findSourceMapURL,"getBusinessSettingsAction");var h=a.i(682242);let i=()=>({businessName:"",businessAddress:"",businessPhone:"",businessEmail:"",currency:"UGX",paymentInfo:"",defaultPrintFormat:"standard"});a.s(["convertPaymentMethodsToString",0,a=>a.filter(a=>""!==a.method.trim()||""!==a.accountNumber.trim()||""!==a.accountName.trim()).map(a=>`${a.method}
${a.accountNumber}
${a.accountName}`).join("\n"),"parsePaymentInfo",0,a=>{if(!a||""===a.trim())return[];let b=a.split("\n").filter(a=>""!==a.trim()),c=[];for(let a=0;a<b.length;a+=3)a+2<b.length&&c.push({method:b[a].trim(),accountNumber:b[a+1].trim(),accountName:b[a+2].trim()});return c},"useBusinessSettings",0,()=>{let[a,f]=(0,b.useState)(i()),[j,k]=(0,b.useState)(!1),{toast:l}=(0,d.useToast)(),{currentBusiness:m}=(0,e.useBusiness)(),n=async()=>{if(!m)return i();try{let a=await g(m.id);if(!a)return i();{let b=a.metadata&&"object"==typeof a.metadata&&a.metadata.payment_info||"";return{id:a.id,businessName:a.business_name||"",businessAddress:a.business_address||"",businessPhone:a.business_phone||"",businessEmail:a.business_email||"",businessLogo:a.business_logo||void 0,currency:a.currency||"UGX",signature:a.signature||void 0,paymentInfo:b,defaultPrintFormat:a.metadata&&"object"==typeof a.metadata&&a.metadata.default_print_format||"standard",defaultPrinterName:a.metadata&&"object"==typeof a.metadata&&a.metadata.default_printer_name||"",defaultPrinterType:a.metadata&&"object"==typeof a.metadata&&a.metadata.default_printer_type||"USB",printerPaperSize:a.metadata&&"object"==typeof a.metadata&&a.metadata.printer_paper_size||"58mm"}}}catch(a){return console.error("Error loading business settings:",a),l({title:"Error",description:"Failed to load business settings. Please try again.",variant:"destructive"}),i()}},o=async b=>{if(!m)return console.error("No business selected for updating settings"),l({title:"Error",description:"No business selected",variant:"destructive"}),!1;try{let c={payment_info:b.hasOwnProperty("paymentInfo")?b.paymentInfo:a.paymentInfo||"",default_print_format:b.hasOwnProperty("defaultPrintFormat")?b.defaultPrintFormat:a.defaultPrintFormat||"standard",default_printer_name:b.hasOwnProperty("defaultPrinterName")?b.defaultPrinterName:a.defaultPrinterName||"",default_printer_type:b.hasOwnProperty("defaultPrinterType")?b.defaultPrinterType:a.defaultPrinterType||"USB",printer_paper_size:b.hasOwnProperty("printerPaperSize")?b.printerPaperSize:a.printerPaperSize||"58mm"},d={business_name:b.hasOwnProperty("businessName")?b.businessName:a.businessName,business_address:b.hasOwnProperty("businessAddress")?b.businessAddress:a.businessAddress,business_phone:b.hasOwnProperty("businessPhone")?b.businessPhone:a.businessPhone,business_email:b.hasOwnProperty("businessEmail")?b.businessEmail:a.businessEmail,business_logo:b.hasOwnProperty("businessLogo")?b.businessLogo:a.businessLogo,currency:b.hasOwnProperty("currency")?b.currency:a.currency,signature:b.hasOwnProperty("signature")?b.signature:a.signature,metadata:c},e=await (0,h.upsertBusinessSettingsAction)(m.id,"00000000-0000-0000-0000-000000000000",d);if(!e.success)throw console.error("Supabase error updating business settings:",e.error),Error(e.error);return l({title:"Success",description:"Business settings updated successfully"}),s(),!0}catch(a){return console.error("Error updating business settings:",a),l({title:"Error",description:"Failed to update business settings. Please try again.",variant:"destructive"}),!1}},{data:p,isLoading:q,isFetching:r,refetch:s}=(0,c.useQuery)({queryKey:["businessSettings",m?.id],queryFn:n,enabled:!!m?.id,staleTime:3e5,gcTime:18e5,refetchOnWindowFocus:!1,refetchOnReconnect:!1});return(0,b.useEffect)(()=>{p?f(p):m||f(i())},[p,m]),(0,b.useEffect)(()=>{k(q||r)},[q,r]),{settings:a,isLoading:j,updateSettings:o,loadSettings:n}}],866102)},774016,959296,42724,a=>{"use strict";let b=Symbol.for("constructDateFrom");function c(a,c){return"function"==typeof a?a(c):a&&"object"==typeof a&&b in a?a[b](c):a instanceof Date?new a.constructor(c):new Date(c)}function d(a,b){return c(b||a,a)}a.s(["constructFromSymbol",0,b,"millisecondsInDay",0,864e5,"millisecondsInHour",0,36e5,"millisecondsInMinute",0,6e4,"millisecondsInSecond",0,1e3,"millisecondsInWeek",0,6048e5,"minutesInDay",0,1440,"minutesInMonth",0,43200],959296),a.s(["constructFrom",()=>c],42724),a.s(["toDate",()=>d],774016)},119025,a=>{"use strict";var b=a.i(572131),c=a.i(507554),d=a.i(470121),e=a.i(750104),f=a.i(225152),g=a.i(77994),h=a.i(3688),i=a.i(30553),j=a.i(187924),k="Switch",[l,m]=(0,e.createContextScope)(k),[n,o]=l(k),p=b.forwardRef((a,e)=>{let{__scopeSwitch:g,name:h,checked:l,defaultChecked:m,required:o,disabled:p,value:q="on",onCheckedChange:r,form:u,...v}=a,[w,x]=b.useState(null),y=(0,d.useComposedRefs)(e,a=>x(a)),z=b.useRef(!1),A=!w||u||!!w.closest("form"),[B,C]=(0,f.useControllableState)({prop:l,defaultProp:m??!1,onChange:r,caller:k});return(0,j.jsxs)(n,{scope:g,checked:B,disabled:p,children:[(0,j.jsx)(i.Primitive.button,{type:"button",role:"switch","aria-checked":B,"aria-required":o,"data-state":t(B),"data-disabled":p?"":void 0,disabled:p,value:q,...v,ref:y,onClick:(0,c.composeEventHandlers)(a.onClick,a=>{C(a=>!a),A&&(z.current=a.isPropagationStopped(),z.current||a.stopPropagation())})}),A&&(0,j.jsx)(s,{control:w,bubbles:!z.current,name:h,value:q,checked:B,required:o,disabled:p,form:u,style:{transform:"translateX(-100%)"}})]})});p.displayName=k;var q="SwitchThumb",r=b.forwardRef((a,b)=>{let{__scopeSwitch:c,...d}=a,e=o(q,c);return(0,j.jsx)(i.Primitive.span,{"data-state":t(e.checked),"data-disabled":e.disabled?"":void 0,...d,ref:b})});r.displayName=q;var s=b.forwardRef(({__scopeSwitch:a,control:c,checked:e,bubbles:f=!0,...i},k)=>{let l=b.useRef(null),m=(0,d.useComposedRefs)(l,k),n=(0,g.usePrevious)(e),o=(0,h.useSize)(c);return b.useEffect(()=>{let a=l.current;if(!a)return;let b=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(n!==e&&b){let c=new Event("click",{bubbles:f});b.call(a,e),a.dispatchEvent(c)}},[n,e,f]),(0,j.jsx)("input",{type:"checkbox","aria-hidden":!0,defaultChecked:e,...i,tabIndex:-1,ref:m,style:{...i.style,...o,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});function t(a){return a?"checked":"unchecked"}s.displayName="SwitchBubbleInput",a.s(["Root",()=>p,"Switch",()=>p,"SwitchThumb",()=>r,"Thumb",()=>r,"createSwitchScope",()=>m])},563658,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(119025),e=a.i(368114);let f=c.forwardRef(({className:a,...c},f)=>(0,b.jsx)(d.Root,{className:(0,e.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",a),...c,ref:f,children:(0,b.jsx)(d.Thumb,{className:(0,e.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));f.displayName=d.Root.displayName,a.s(["Switch",()=>f])},973308,a=>{"use strict";var b=a.i(572131),c=a.i(478793),d=a.i(169819),e=a.i(3048);a.s(["useCategories",0,a=>{let[f,g]=(0,b.useState)([]),[h,i]=(0,b.useState)(!0),{toast:j}=(0,c.useToast)(),{currentBusiness:k}=(0,d.useBusiness)(),l=(0,b.useCallback)(async()=>{try{if(!k?.id){g([]),i(!1);return}i(!0);let a=await (0,e.getProductCategoriesAction)(k.id);if(!a.success||!a.data)throw Error(a.error||"Failed to fetch categories");let b=a.data.map(a=>({id:a.id,name:a.name,createdAt:a.createdAt?new Date(a.createdAt):a.created_at?new Date(a.created_at):void 0}));g(b)}catch(a){console.error("Error loading categories:",a),j({title:"Error",description:"Failed to load product categories.",variant:"destructive"})}finally{i(!1)}},[k?.id,j]);(0,b.useEffect)(()=>{l()},[l]);let m=async b=>{try{if(!a||!k?.id)return null;let c=f.find(a=>a.name.toLowerCase()===b.toLowerCase());if(c)return j({title:"Category exists",description:"This category already exists."}),c;let d=await (0,e.createProductCategoryAction)(k.id,a,b);if(!d.success||!d.data)throw Error(d.error);let h={id:d.data.id,name:d.data.name,createdAt:new Date(d.data.createdAt)};return g(a=>[...a,h]),j({title:"Success",description:"Category created successfully"}),h}catch(a){return console.error("Error creating category:",a),j({title:"Error",description:"Failed to create category.",variant:"destructive"}),null}},n=async(a,b)=>{try{if(f.find(c=>c.name.toLowerCase()===b.toLowerCase()&&c.id!==a))return j({title:"Category exists",description:"Another category with this name already exists."}),!1;let c=await (0,e.updateProductCategoryAction)(a,b);if(!c.success)throw Error(c.error);return g(c=>c.map(c=>c.id===a?{...c,name:b}:c)),j({title:"Success",description:"Category updated successfully"}),!0}catch(a){return console.error("Error updating category:",a),j({title:"Error",description:"Failed to update category.",variant:"destructive"}),!1}};return{categories:f,isLoading:h,loadCategories:l,createCategory:m,updateCategory:n,deleteCategory:async a=>{try{let b=await (0,e.deleteProductCategoryAction)(a);if(!b.success)return j({title:"Cannot delete category",description:b.error||"Failed to delete category.",variant:"destructive"}),!1;return g(b=>b.filter(b=>b.id!==a)),j({title:"Success",description:"Category deleted successfully"}),!0}catch(a){return console.error("Error deleting category:",a),j({title:"Error",description:"Failed to delete category.",variant:"destructive"}),!1}}}}])},501027,a=>{"use strict";let b=(0,a.i(170106).default)("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);a.s(["Zap",()=>b],501027)},452495,a=>{"use strict";let b=(0,a.i(170106).default)("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);a.s(["ExternalLink",()=>b],452495)}];

//# sourceMappingURL=_66662446._.js.map