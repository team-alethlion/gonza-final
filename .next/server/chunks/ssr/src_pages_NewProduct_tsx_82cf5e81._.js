module.exports=[498250,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(665967),e=a.i(591119),f=a.i(699570),g=a.i(866718),h=a.i(870430),i=a.i(429246),j=a.i(580701),k=a.i(866102),l=a.i(823292),m=a.i(781560),n=a.i(773320),o=a.i(452495),p=a.i(596221),q=a.i(501027),r=a.i(941675),s=a.i(771931),t=a.i(391956),u=a.i(478793),v=a.i(368114),w=a.i(599209),x=a.i(320146),y=a.i(256711),z=a.i(563658);let A=({initialData:a,categories:A,onProductSubmit:B,isLoading:C})=>{let D=(0,d.useNavigate)(),{settings:E}=(0,k.useBusinessSettings)(),{user:F}=(0,t.useAuth)(),{uploadProductImage:G,compressImage:H}=(a=>{let{toast:b}=(0,u.useToast)(),c=async a=>new Promise((b,c)=>{try{let d=new FileReader;d.onerror=()=>{console.error("FileReader error"),c(Error("Failed to read file"))},d.onload=d=>{try{let e=new Image;e.onerror=()=>{console.error("Image load error"),c(Error("Failed to load image"))},e.onload=()=>{try{let d=(b,d,f)=>new Promise(g=>{let h=document.createElement("canvas");h.width=b,h.height=d;let i=h.getContext("2d");i?(i.clearRect(0,0,b,d),i.drawImage(e,0,0,b,d),h.toBlob(b=>{if(!b)return void c(Error("Could not compress image"));let d=new File([b],`${a.name.replace(/\.[^/.]+$/,"")}-optimized.jpg`,{type:"image/jpeg",lastModified:Date.now()});g(d)},"image/jpeg",f)):c(Error("Could not get canvas context"))});(async()=>{let{width:b,height:c}=e;if(b>400||c>400){let a=b/c;b>c?c=(b=400)/a:b=(c=400)*a}for(let e of(b=Math.max(50,Math.floor(b)),c=Math.max(50,Math.floor(c)),[.8,.6,.4,.3,.2,.1,.05,.02,.01])){let f=await d(b,c,e);if(f.size<=10240)return console.log("Image compression successful:"),console.log(`  Original: ${(a.size/1024).toFixed(1)}KB`),console.log(`  Compressed: ${(f.size/1024).toFixed(1)}KB`),console.log(`  Reduction: ${((a.size-f.size)/a.size*100).toFixed(1)}%`),console.log(`  Dimensions: ${b}x${c}px`),console.log(`  Quality: ${(100*e).toFixed(0)}%`),f}for(let e of[.8,.6,.5,.4,.3,.25,.2]){let f=Math.max(50,Math.floor(b*e)),g=Math.max(50,Math.floor(c*e));for(let b of[.1,.05,.02,.01]){let c=await d(f,g,b);if(c.size<=10240)return console.log("Image compression successful with dimension reduction:"),console.log(`  Original: ${(a.size/1024).toFixed(1)}KB`),console.log(`  Compressed: ${(c.size/1024).toFixed(1)}KB`),console.log(`  Reduction: ${((a.size-c.size)/a.size*100).toFixed(1)}%`),console.log(`  Dimensions: ${f}x${g}px`),console.log(`  Quality: ${(100*b).toFixed(0)}%`),c}}let f=await d(50,50,.01);return console.log("Image compression fallback:"),console.log(`  Original: ${(a.size/1024).toFixed(1)}KB`),console.log(`  Compressed: ${(f.size/1024).toFixed(1)}KB`),console.log("  Dimensions: 50x50px"),f})().then(b).catch(c)}catch(a){console.error("Canvas processing error:",a),c(Error("Failed to process image on canvas"))}},e.src=d.target?.result}catch(a){console.error("Image creation error:",a),c(Error("Failed to create image"))}},d.readAsDataURL(a)}catch(a){console.error("File reading setup error:",a),c(Error("Failed to setup file reader"))}}),d=async a=>new Promise((b,c)=>{try{let d=new FileReader;d.onerror=()=>c(Error("Failed to read file")),d.onload=d=>{try{let e=new Image;e.onerror=()=>c(Error("Failed to load image")),e.onload=()=>{try{let d=document.createElement("canvas");d.width=e.width,d.height=e.height;let f=d.getContext("2d");if(!f)return void c(Error("Could not get canvas context"));f.drawImage(e,0,0),d.toBlob(d=>{if(!d)return void c(Error("Could not process image"));let e=new File([d],a.name,{type:a.type,lastModified:Date.now()});b(e)},a.type,.95)}catch(a){console.error("Metadata removal canvas error:",a),c(Error("Failed to process image"))}},e.src=d.target?.result}catch(a){console.error("Metadata removal image error:",a),c(Error("Failed to load image"))}},d.readAsDataURL(a)}catch(a){console.error("Metadata removal setup error:",a),c(Error("Failed to setup file reader"))}});return{uploadProductImage:async e=>{try{if(!a||!e)return console.error("Missing userId or file for image upload"),null;if(!e.type.startsWith("image/"))return b({title:"Error",description:"Only image files are allowed.",variant:"destructive"}),null;if(e.size>0x1400000)return b({title:"Error",description:"Image file is too large. Maximum size is 20MB.",variant:"destructive"}),null;console.log("Starting image processing..."),b({title:"Processing Image",description:"Optimizing image to under 10KB..."});let f=await d(e),g=await c(f),h=g.size/1024;return console.log(`Final compressed size: ${h.toFixed(1)}KB`),console.warn("Image upload placeholder – integration with Prisma server action/storage required"),b({title:"Image Processed",description:`Image optimized to ${h.toFixed(1)}KB. Backend upload is pending migration.`}),new Promise(a=>{let b=new FileReader;b.onloadend=()=>a(b.result),b.readAsDataURL(g)})}catch(a){return console.error("Error uploading product image:",a),b({title:"Upload Error",description:"Failed to process image.",variant:"destructive"}),null}},compressImage:c,removeMetadata:d}})(F?.id),I=a=>a?{name:a.name,barcode:a.barcode||"",manufacturerBarcode:a.manufacturerBarcode||"",description:a.description||"",category:a.category,quantity:a.quantity??0,costPrice:a.costPrice,sellingPrice:a.sellingPrice,supplier:a.supplier||"",minimumStock:a.minimumStock,imageFile:null,imageUrl:a.imageUrl,createdAt:a.createdAt||new Date,printQuantity:1,autoPrintLabel:!1}:{name:"",barcode:"",manufacturerBarcode:"",description:"",category:"",quantity:0,costPrice:void 0,sellingPrice:void 0,supplier:"",minimumStock:void 0,imageFile:null,imageUrl:null,createdAt:new Date,autoPrintLabel:!0,printQuantity:1},[J,K]=(0,c.useState)(()=>I(a)),[L,M]=(0,c.useState)({}),[N,O]=(0,c.useState)(null),[P,Q]=(0,c.useState)(!1),[R,S]=(0,c.useState)(!1),[T,U]=(0,c.useState)(!1),[V,W]=(0,c.useState)(!1),[X,Y]=(0,c.useState)(null),[Z,$]=(0,c.useState)(!1),_=(0,c.useRef)(null);(0,c.useEffect)(()=>{if(a){console.log("ProductForm - Setting form data from initialData:",a),console.log("ProductForm - InitialData createdAt:",a.createdAt);let b=I(a);K(b),console.log("ProductForm - Form data set to:",b),console.log("ProductForm - Form createdAt set to:",b.createdAt),a.imageUrl&&O(a.imageUrl)}},[a]);let aa=a=>{let{name:b,value:c}=a.target,d=c;("quantity"===b||"minimumStock"===b||"costPrice"===b||"sellingPrice"===b)&&("quantity"===b?console.log("Quantity changed to:",d=""===c?"":parseFloat(c)||0):d=""===c?void 0:parseFloat(c)),K({...J,[b]:d}),L[b]&&M({...L,[b]:""})},ab=async a=>{if(a.size>0x1400000)return void l.toast.error("Image file is too large. Maximum size is 20MB.");if(!a.type.startsWith("image/"))return void l.toast.error("Only image files are allowed.");U(!0),Y(null);try{let b=await H(a),c=(a.size-b.size)/a.size*100;Y({originalSize:a.size,compressedSize:b.size,reduction:c}),K({...J,imageFile:b}),Q(!0);let d=new FileReader;d.onload=()=>{O(d.result)},d.readAsDataURL(b),l.toast.success(`Image optimized to ${(b.size/1024).toFixed(1)}KB!`)}catch(a){console.error("Error compressing image:",a),l.toast.error("Failed to process image. Please try again.")}finally{U(!1)}},ac=async a=>{let b;if(a.preventDefault(),console.log("ProductForm - Form data before validation:",J),console.log("ProductForm - Quantity value:",J.quantity,"Type:",typeof J.quantity),console.log("ProductForm - CreatedAt value:",J.createdAt),b={},J.name.trim()||(b.name="Product name is required"),void 0!==J.costPrice&&J.costPrice<0&&(b.costPrice="Cost price cannot be negative"),void 0!==J.sellingPrice&&J.sellingPrice<0&&(b.sellingPrice="Selling price cannot be negative"),void 0!==J.minimumStock&&J.minimumStock<0&&(b.minimumStock="Minimum stock cannot be negative"),M(b),0!==Object.keys(b).length)return void l.toast.error("Please correct the errors in the form");let c=J.imageUrl;try{if(P&&J.imageFile){if(S(!0),l.toast.info("Uploading optimized image..."),!(c=await G(J.imageFile)))return void S(!1);l.toast.success("Image uploaded successfully!")}else P&&!J.imageFile&&(c=null);let a="string"==typeof J.quantity?""===J.quantity?0:Number(J.quantity):J.quantity,b={...J,imageUrl:c,quantity:a};console.log("ProductForm - Final submission data:",b),console.log("ProductForm - Final quantity being submitted:",b.quantity),console.log("ProductForm - Final createdAt being submitted:",b.createdAt),await B(b)}catch(a){console.error("Error handling form submission:",a),l.toast.error("Something went wrong. Please try again.")}finally{S(!1)}},ad=C||R;return(0,b.jsxs)(e.Card,{className:"w-full",children:[(0,b.jsxs)(e.CardHeader,{children:[(0,b.jsx)(e.CardTitle,{children:a?"Edit Product":"New Product"}),(0,b.jsx)(e.CardDescription,{children:"Enter the product details below. Only name is required."})]}),(0,b.jsx)(e.CardContent,{children:(0,b.jsxs)("form",{onSubmit:ac,className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid gap-3",children:[(0,b.jsx)(h.Label,{htmlFor:"name",children:"Product Name*"}),(0,b.jsx)(g.Input,{id:"name",name:"name",value:J.name,onChange:aa,onKeyDown:a=>{if("Enter"===a.key){a.preventDefault();let b=document.querySelector('[role="combobox"]');b?.focus()}},placeholder:"Enter product name",className:L.name?"border-red-500":"",disabled:ad}),L.name&&(0,b.jsx)("p",{className:"text-red-500 text-xs",children:L.name})]}),(0,b.jsxs)("div",{className:"grid gap-3",children:[(0,b.jsx)(h.Label,{htmlFor:"manufacturerBarcode",children:"Manufacturer Barcode (Optional)"}),(0,b.jsx)(g.Input,{id:"manufacturerBarcode",name:"manufacturerBarcode",value:J.manufacturerBarcode,onChange:aa,onKeyDown:a=>{if("Enter"===a.key){a.preventDefault();let b=document.querySelector('[role="combobox"]');b?.focus()}},placeholder:"Enter manufacturer barcode (if any)",disabled:ad})]}),(0,b.jsxs)("div",{className:"grid gap-3",children:[(0,b.jsx)(h.Label,{htmlFor:"category",children:"Category (Optional)"}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Need to create a new category? Go to the"," ",(0,b.jsxs)(f.Button,{type:"button",variant:"link",className:"p-0 h-auto text-blue-600 underline",onClick:()=>D(`/categories?returnTo=${encodeURIComponent(window.location.pathname)}`),disabled:ad,children:["Categories page ",(0,b.jsx)(o.ExternalLink,{className:"h-3 w-3 ml-1 inline"})]})," ","first, then return here to select it."]}),(0,b.jsxs)(j.Select,{value:J.category,onValueChange:a=>{K({...J,category:a}),L.category&&M({...L,category:""}),setTimeout(()=>{document.getElementById("description")?.focus()},100)},disabled:ad,children:[(0,b.jsx)(j.SelectTrigger,{className:(0,v.cn)(L.category?"border-red-500":""),onKeyDown:a=>{if(console.log("SelectTrigger keydown:",a.key,"Category:",J.category),"Enter"===a.key)return a.preventDefault(),a.stopPropagation(),console.log("Enter pressed on SelectTrigger, focusing description"),setTimeout(()=>{let a=document.getElementById("description");console.log("Description field found:",!!a),a?.focus()},50),!1;"Escape"===a.key&&setTimeout(()=>{document.getElementById("description")?.focus()},50)},children:(0,b.jsx)(j.SelectValue,{placeholder:"Select category (optional)"})}),(0,b.jsx)(j.SelectContent,{children:A.length>0?A.map(a=>(0,b.jsx)(j.SelectItem,{value:a.name,children:a.name},a.id)):(0,b.jsx)("div",{className:"p-2 text-sm text-muted-foreground",children:"No categories available"})})]}),L.category&&(0,b.jsx)("p",{className:"text-red-500 text-xs",children:L.category})]}),(0,b.jsxs)("div",{className:"grid gap-3",children:[(0,b.jsx)(h.Label,{htmlFor:"description",children:"Description"}),(0,b.jsx)(i.Textarea,{id:"description",name:"description",value:J.description,onChange:aa,onKeyDown:a=>{"Enter"!==a.key||a.shiftKey||(a.preventDefault(),document.getElementById("supplier")?.focus())},placeholder:"Enter product description",className:"resize-none h-32",disabled:ad})]}),(0,b.jsxs)("div",{className:"grid gap-3",children:[(0,b.jsx)(h.Label,{htmlFor:"supplier",children:"Supplier"}),(0,b.jsx)(g.Input,{id:"supplier",name:"supplier",value:J.supplier,onChange:aa,onKeyDown:a=>{"Enter"===a.key&&(a.preventDefault(),document.getElementById("quantity")?.focus())},placeholder:"Enter supplier name",disabled:ad})]}),(0,b.jsxs)("div",{className:"grid gap-3",children:[(0,b.jsx)(h.Label,{children:"Created Date"}),(0,b.jsxs)(w.Popover,{open:Z,onOpenChange:$,children:[(0,b.jsx)(w.PopoverTrigger,{asChild:!0,children:(0,b.jsxs)(f.Button,{variant:"outline",className:(0,v.cn)("w-full justify-start text-left font-normal",!J.createdAt&&"text-muted-foreground",a&&"cursor-not-allowed opacity-60"),disabled:ad||!!a,children:[(0,b.jsx)(r.Calendar,{className:"mr-2 h-4 w-4"}),J.createdAt?(0,y.format)(J.createdAt,"PPP"):"Pick a date"]})}),(0,b.jsx)(w.PopoverContent,{className:"w-auto p-0",align:"start",children:(0,b.jsx)(x.Calendar,{mode:"single",selected:J.createdAt,onSelect:a=>{if(a){let b=new Date(a);b.setHours(12,0,0,0),console.log("ProductForm - Date changed to:",b),K({...J,createdAt:b}),$(!1)}},disabled:a=>a>new Date,initialFocus:!0})})]}),a&&(0,b.jsx)("div",{className:"bg-amber-50 border border-amber-200 p-3 rounded-lg",children:(0,b.jsxs)("div",{className:"text-amber-800 text-sm",children:[(0,b.jsx)("strong",{children:"Note:"})," To edit the creation date, please edit the initial stock history entry for this product through the inventory stock history."]})})]})]}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid gap-3",children:[(0,b.jsx)(h.Label,{htmlFor:"imageFile",children:"Product Image"}),(0,b.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[N?(0,b.jsxs)("div",{className:"relative w-full",children:[(0,b.jsx)("img",{src:N,alt:"Product preview",className:"w-full h-40 object-contain border rounded-md"}),(0,b.jsx)(f.Button,{type:"button",variant:"destructive",size:"icon",className:"absolute top-2 right-2 rounded-full h-8 w-8",onClick:()=>{K({...J,imageFile:null,imageUrl:null}),O(null),Q(!0),Y(null),_.current&&(_.current.value="")},disabled:ad||T,children:(0,b.jsx)(m.Trash2,{className:"h-4 w-4"})}),X&&(0,b.jsxs)("div",{className:"mt-2 p-2 bg-green-50 border border-green-200 rounded-md",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-green-700",children:[(0,b.jsx)(q.Zap,{className:"h-4 w-4"}),(0,b.jsxs)("span",{className:"text-xs font-medium",children:["Optimized to ",(X.compressedSize/1024).toFixed(1),"KB"]})]}),(0,b.jsxs)("div",{className:"text-xs text-green-600 mt-1",children:[(X.originalSize/1024).toFixed(1),"KB → ",(X.compressedSize/1024).toFixed(1),"KB (",X.reduction.toFixed(1),"% reduction)"]})]})]}):(0,b.jsx)("div",{className:(0,v.cn)("border-2 border-dashed rounded-md p-8 w-full flex flex-col items-center justify-center cursor-pointer transition-colors",V?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400",(ad||T)&&"opacity-50 cursor-not-allowed"),onDragOver:a=>{a.preventDefault(),a.stopPropagation(),W(!0)},onDragLeave:a=>{a.preventDefault(),a.stopPropagation(),W(!1)},onDrop:a=>{a.preventDefault(),a.stopPropagation(),W(!1),a.dataTransfer.files&&a.dataTransfer.files.length>0&&ab(a.dataTransfer.files[0])},onClick:ad||T?void 0:()=>{_.current?.click()},children:T?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(p.Loader2,{className:"h-10 w-10 text-blue-500 mb-2 animate-spin"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Optimizing image..."}),(0,b.jsx)("p",{className:"text-xs text-gray-400",children:"Compressing to under 15KB"})]}):R?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(p.Loader2,{className:"h-10 w-10 text-blue-500 mb-2 animate-spin"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Uploading image..."})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(n.Upload,{className:"h-10 w-10 text-gray-400 mb-2"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Click to upload or drag and drop"}),(0,b.jsx)("p",{className:"text-xs text-gray-400",children:"PNG, JPG, GIF up to 20MB"}),(0,b.jsx)("p",{className:"text-xs text-blue-500 mt-1",children:"⚡ Auto Image compression for instant loading"})]})}),(0,b.jsx)("input",{type:"file",id:"imageFile",ref:_,accept:"image/*",onChange:a=>{let b=a.target.files?.[0];b&&ab(b)},className:"hidden",disabled:ad||T})]})]}),(0,b.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"grid gap-3",children:[(0,b.jsx)(h.Label,{htmlFor:"quantity",children:"Initial Stock"}),(0,b.jsx)(g.Input,{id:"quantity",name:"quantity",type:"number",step:"0.01",value:J.quantity,onChange:aa,onKeyDown:a=>{"Enter"===a.key&&(a.preventDefault(),document.getElementById("minimumStock")?.focus())},className:L.quantity?"border-red-500":"",disabled:ad,placeholder:"Enter initial stock quantity (can be negative)"}),L.quantity&&(0,b.jsx)("p",{className:"text-red-500 text-xs",children:L.quantity}),a&&(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Current stock: ",a.quantity," units"]})]}),(0,b.jsxs)("div",{className:"grid gap-3",children:[(0,b.jsx)(h.Label,{htmlFor:"minimumStock",children:"Minimum Stock Level"}),(0,b.jsx)(g.Input,{id:"minimumStock",name:"minimumStock",type:"number",min:"0",step:"0.01",value:void 0===J.minimumStock?"":J.minimumStock,onChange:aa,onKeyDown:a=>{"Enter"===a.key&&(a.preventDefault(),document.getElementById("costPrice")?.focus())},className:L.minimumStock?"border-red-500":"",disabled:ad}),L.minimumStock&&(0,b.jsx)("p",{className:"text-red-500 text-xs",children:L.minimumStock})]})]}),(0,b.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"grid gap-3",children:[(0,b.jsx)(h.Label,{htmlFor:"costPrice",children:"Cost Price"}),(0,b.jsxs)("div",{className:"flex",children:[(0,b.jsx)("span",{className:"inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500",children:E.currency}),(0,b.jsx)(g.Input,{id:"costPrice",name:"costPrice",type:"number",min:"0",step:"0.01",value:void 0===J.costPrice?"":J.costPrice,onChange:aa,onKeyDown:a=>{"Enter"===a.key&&(a.preventDefault(),document.getElementById("sellingPrice")?.focus())},className:`rounded-l-none ${L.costPrice?"border-red-500":""}`,disabled:ad})]}),L.costPrice&&(0,b.jsx)("p",{className:"text-red-500 text-xs",children:L.costPrice})]}),(0,b.jsxs)("div",{className:"grid gap-3",children:[(0,b.jsx)(h.Label,{htmlFor:"sellingPrice",children:"Selling Price"}),(0,b.jsxs)("div",{className:"flex",children:[(0,b.jsx)("span",{className:"inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500",children:E.currency}),(0,b.jsx)(g.Input,{id:"sellingPrice",name:"sellingPrice",type:"number",min:"0",step:"0.01",value:void 0===J.sellingPrice?"":J.sellingPrice,onChange:aa,onKeyDown:a=>{if("Enter"===a.key){a.preventDefault();let b=document.querySelector('button[type="submit"]');b?.focus()}},className:`rounded-l-none ${L.sellingPrice?"border-red-500":""}`,disabled:ad})]}),L.sellingPrice&&(0,b.jsx)("p",{className:"text-red-500 text-xs",children:L.sellingPrice})]})]}),(0,b.jsx)("div",{className:"grid gap-3",children:(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"* Required fields | Initial Stock: The starting quantity for this product"})})]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-end space-x-4",children:[(0,b.jsx)(f.Button,{variant:"outline",type:"button",onClick:()=>D("/inventory"),disabled:ad||T,children:"Cancel"}),(0,b.jsx)(f.Button,{type:"submit",disabled:ad||T,className:"min-w-[100px]",children:T?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(p.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Optimizing..."]}):ad?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(p.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),R?"Uploading...":"Saving..."]}):a?"Update Product":"Create Product"})]}),!a&&(0,b.jsxs)("div",{className:"flex flex-col md:flex-row items-center justify-end gap-4 pt-3 border-t",children:[J.autoPrintLabel&&(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(h.Label,{htmlFor:"printQuantity",className:"text-sm text-muted-foreground whitespace-nowrap",children:"Quantity to print:"}),(0,b.jsx)(g.Input,{id:"printQuantity",type:"number",min:"1",className:"w-20 h-8",value:J.printQuantity,onChange:a=>K(b=>({...b,printQuantity:parseInt(a.target.value)||1})),disabled:ad})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(s.Printer,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsx)(h.Label,{htmlFor:"autoPrint",className:"text-sm font-medium cursor-pointer",children:"Auto-print barcode label"}),(0,b.jsx)(z.Switch,{id:"autoPrint",checked:J.autoPrintLabel,onCheckedChange:a=>K(b=>({...b,autoPrintLabel:a})),disabled:ad})]})]})]})})]})};var B=a.i(347778),C=a.i(973308),D=a.i(400210),E=a.i(669520),F=a.i(890914),G=a.i(124348),H=a.i(292e3);a.s(["default",0,()=>{let{id:a}=(0,d.useParams)(),e=(0,d.useLocation)(),g=(0,d.useNavigate)(),{user:h}=(0,t.useAuth)(),{products:i,isLoading:j,createProduct:m,updateProduct:n,loadProducts:o,refetch:p}=(0,B.useProducts)(h?.id,1e4),{categories:q,isLoading:r}=(0,C.useCategories)(h?.id),[s,u]=(0,c.useState)(void 0),[w,x]=(0,c.useState)(!1),[y,z]=(0,c.useState)(null),[I,J]=(0,c.useState)(!1),[K,L]=(0,c.useState)(!1),{settings:M}=(0,k.useBusinessSettings)(),{hasPermission:N,isLoading:O}=(0,F.useProfiles)(),P=e.state?.duplicateData,Q=async()=>{if(a){J(!0),z(null);let{data:b}=await p(),c=(b?.products||[]).find(b=>b.id===a);c?(u(c),L(!0)):(z("Product not found. It may have been deleted or you may not have permission to view it."),l.toast.error("Product not found")),J(!1)}else L(!0)};(0,c.useEffect)(()=>{if(a&&i.length>0&&!K){let b=i.find(b=>b.id===a);b?(u(b),L(!0),z(null)):i.length>0&&(z("Product not found. It may have been deleted or you may not have permission to view it."),l.toast.error("Product not found"))}else a||L(!0)},[a,i.length,K]);let R=async()=>{l.toast.info("Refreshing product data..."),L(!1),await Q()},S=async b=>{x(!0);try{if(a&&s){let c={name:b.name,description:b.description||"",category:b.category||"",quantity:b.quantity,costPrice:b.costPrice??0,sellingPrice:b.sellingPrice??0,supplier:b.supplier||"",minimumStock:b.minimumStock??0,imageUrl:b.imageUrl||null,createdAt:b.createdAt,barcode:b.barcode,manufacturerBarcode:b.manufacturerBarcode};await n(a,c)?(l.toast.success("Product updated successfully"),g(`/inventory/${a}`)):l.toast.error("Failed to update product")}else{if(!h?.id)return void l.toast.error("You must be logged in to create products");let a={id:"",name:b.name,description:b.description||"",category:b.category||"",quantity:b.quantity,costPrice:b.costPrice??0,sellingPrice:b.sellingPrice??0,supplier:b.supplier||"",minimumStock:b.minimumStock??0,imageUrl:b.imageUrl||null,createdAt:b.createdAt||new Date,updatedAt:new Date,barcode:b.barcode||"",manufacturerBarcode:b.manufacturerBarcode||""},c=await m(a);if(c){if(l.toast.success("Product created successfully"),b.autoPrintLabel&&c.barcode)try{let a=b.printQuantity||1;l.toast.info(`Sending ${a} barcode label${a>1?"s":""} to printer...`),await fetch("http://localhost:5000/print/label",{method:"POST",headers:{"Content-Type":"application/json"},mode:"cors",body:JSON.stringify({PrinterName:M.defaultPrinterName||"Label Printer",Content:`SIZE 50 mm, 30 mm
GAP 3 mm, 0 mm
CLS
TEXT 15,20,"3",0,1,1,"${c.name}"
BARCODE 15,70,"128",60,1,0,2,2,"${c.barcode}"
TEXT 15,180,"3",0,1,1,"${M.currency} ${(0,v.formatNumber)(c.sellingPrice)}"
PRINT ${a}
`})}),l.toast.success("Barcode label printed")}catch(a){console.error("Failed to auto-print label:",a),l.toast.error("Failed to print label. Is the Printer Bridge running?")}g(`/inventory/${c.id}`)}else l.toast.error("Failed to create product")}}catch(a){console.error("Error submitting product:",a),l.toast.error("An error occurred while saving the product")}finally{x(!1)}},T=j||r||w||I,U=P?{...P,quantity:0,id:"",itemNumber:"",createdAt:new Date,updatedAt:new Date,barcode:"",manufacturerBarcode:""}:s,V=!a||N("inventory","edit"),W=!!a||N("inventory","create");return O||j||r?(0,b.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,b.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):V&&W?!a||K||y?(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",onClick:()=>g("/inventory"),className:"flex items-center gap-1",children:[(0,b.jsx)(D.ArrowLeft,{className:"h-4 w-4"})," Back to Inventory"]}),a&&(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",onClick:R,disabled:T,className:"flex items-center gap-1",children:[(0,b.jsx)(E.RefreshCw,{className:`h-4 w-4 ${I?"animate-spin":""}`}),I?"Refreshing...":"Refresh Data"]})]}),y?(0,b.jsxs)("div",{className:"p-6 bg-red-50 border border-red-200 rounded-md",children:[(0,b.jsx)("h3",{className:"text-lg font-medium text-red-800 mb-2",children:"Error Loading Product"}),(0,b.jsx)("p",{className:"text-red-600",children:y}),(0,b.jsx)(f.Button,{className:"mt-4",onClick:()=>g("/inventory"),children:"Return to Inventory"})]}):(0,b.jsx)(A,{initialData:U,categories:q,onProductSubmit:S,isLoading:T})]}):(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",onClick:()=>g("/inventory"),className:"flex items-center gap-1",children:[(0,b.jsx)(D.ArrowLeft,{className:"h-4 w-4"})," Back to Inventory"]})}),(0,b.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Loading product data..."})]})})]}):(0,b.jsxs)("div",{className:"max-w-4xl mx-auto p-6",children:[(0,b.jsxs)(G.Alert,{variant:"destructive",children:[(0,b.jsx)(H.AlertCircle,{className:"h-4 w-4"}),(0,b.jsx)(G.AlertTitle,{children:"Access Denied"}),(0,b.jsxs)(G.AlertDescription,{children:["You do not have permission to ",a?"edit this product":"create a new product",". Please contact your administrator if you believe this is an error."]})]}),(0,b.jsx)("div",{className:"mt-4",children:(0,b.jsx)(f.Button,{onClick:()=>g("/inventory"),variant:"outline",children:"Back to Inventory"})})]})}],498250)}];

//# sourceMappingURL=src_pages_NewProduct_tsx_82cf5e81._.js.map