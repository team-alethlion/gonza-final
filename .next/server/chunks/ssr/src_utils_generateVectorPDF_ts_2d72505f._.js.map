{"version":3,"sources":["../../../../src/utils/generateVectorPDF.ts"],"sourcesContent":["\r\nimport jsPDF from 'jspdf';\r\nimport html2canvas from 'html2canvas';\r\n\r\ninterface VectorPDFOptions {\r\n  filename: string;\r\n  orientation?: 'portrait' | 'landscape';\r\n  format?: 'a4' | 'letter';\r\n  margins?: {\r\n    top: number;\r\n    right: number;\r\n    bottom: number;\r\n    left: number;\r\n  };\r\n}\r\n\r\nexport const generateVectorPDF = async (\r\n  element: HTMLElement,\r\n  options: VectorPDFOptions\r\n): Promise<void> => {\r\n  const {\r\n    filename,\r\n    orientation = 'portrait',\r\n    format = 'a4',\r\n    margins = { top: 10, right: 10, bottom: 10, left: 10 }\r\n  } = options;\r\n\r\n  // Create new PDF document\r\n  const pdf = new jsPDF({\r\n    orientation,\r\n    unit: 'mm',\r\n    format,\r\n    compress: true\r\n  });\r\n\r\n  const pageWidth = pdf.internal.pageSize.getWidth();\r\n  const pageHeight = pdf.internal.pageSize.getHeight();\r\n  const contentWidth = pageWidth - margins.left - margins.right;\r\n\r\n  try {\r\n    // Convert the element to canvas for measurement and image extraction\r\n    const canvas = await html2canvas(element, {\r\n      scale: 2,\r\n      useCORS: true,\r\n      backgroundColor: '#ffffff',\r\n      logging: false,\r\n      allowTaint: true\r\n    });\r\n\r\n    const imgData = canvas.toDataURL('image/jpeg', 0.95);\r\n    const imgWidth = contentWidth;\r\n    const imgHeight = (canvas.height * imgWidth) / canvas.width;\r\n\r\n    // Check if content fits on one page\r\n    if (imgHeight <= pageHeight - margins.top - margins.bottom) {\r\n      // Single page - add image\r\n      pdf.addImage(imgData, 'JPEG', margins.left, margins.top, imgWidth, imgHeight);\r\n    } else {\r\n      // Multiple pages needed\r\n      let yPosition = 0;\r\n      const pageContentHeight = pageHeight - margins.top - margins.bottom;\r\n\r\n      while (yPosition < imgHeight) {\r\n        // Add image section for current page\r\n        pdf.addImage(\r\n          imgData,\r\n          'JPEG',\r\n          margins.left,\r\n          margins.top - yPosition,\r\n          imgWidth,\r\n          imgHeight\r\n        );\r\n\r\n        yPosition += pageContentHeight;\r\n\r\n        // Add new page if more content exists\r\n        if (yPosition < imgHeight) {\r\n          pdf.addPage();\r\n        }\r\n      }\r\n    }\r\n\r\n    // Save the PDF\r\n    pdf.save(filename);\r\n  } catch (error) {\r\n    console.error('Error generating PDF:', error);\r\n    throw new Error('Failed to generate PDF');\r\n  }\r\n};\r\n\r\n// Enhanced version specifically for receipts with better text handling\r\nexport const generateReceiptVectorPDF = async (\r\n  element: HTMLElement,\r\n  options: VectorPDFOptions\r\n): Promise<void> => {\r\n  const {\r\n    filename,\r\n    orientation = 'portrait',\r\n    format = 'a4',\r\n    margins = { top: 10, right: 10, bottom: 10, left: 10 }\r\n  } = options;\r\n\r\n  const pdf = new jsPDF({\r\n    orientation,\r\n    unit: 'mm',\r\n    format,\r\n    compress: true\r\n  });\r\n\r\n  const pageWidth = pdf.internal.pageSize.getWidth();\r\n  const contentWidth = pageWidth - margins.left - margins.right;\r\n\r\n  try {\r\n    // For receipts, we'll use a higher quality approach\r\n    const canvas = await html2canvas(element, {\r\n      scale: 3, // Higher scale for better quality\r\n      useCORS: true,\r\n      backgroundColor: '#ffffff',\r\n      logging: false,\r\n      allowTaint: true,\r\n      height: element.scrollHeight,\r\n      width: element.scrollWidth\r\n    });\r\n\r\n    const imgData = canvas.toDataURL('image/png', 1.0); // Use PNG for better quality\r\n    const imgWidth = contentWidth;\r\n    const imgHeight = (canvas.height * imgWidth) / canvas.width;\r\n\r\n    const pageHeight = pdf.internal.pageSize.getHeight();\r\n    const pageContentHeight = pageHeight - margins.top - margins.bottom;\r\n\r\n    let yPosition = 0;\r\n\r\n    while (yPosition < imgHeight) {\r\n      const sourceY = (yPosition / imgHeight) * canvas.height;\r\n      const sourceHeight = Math.min(\r\n        (pageContentHeight / imgHeight) * canvas.height,\r\n        canvas.height - sourceY\r\n      );\r\n\r\n      // Create a temporary canvas for this page section\r\n      const pageCanvas = document.createElement('canvas');\r\n      pageCanvas.width = canvas.width;\r\n      pageCanvas.height = sourceHeight;\r\n      \r\n      const pageCtx = pageCanvas.getContext('2d');\r\n      if (pageCtx) {\r\n        pageCtx.drawImage(\r\n          canvas,\r\n          0, sourceY,\r\n          canvas.width, sourceHeight,\r\n          0, 0,\r\n          canvas.width, sourceHeight\r\n        );\r\n\r\n        const pageImgData = pageCanvas.toDataURL('image/png', 1.0);\r\n        const pageImgHeight = (sourceHeight * imgWidth) / canvas.width;\r\n\r\n        pdf.addImage(\r\n          pageImgData,\r\n          'PNG',\r\n          margins.left,\r\n          margins.top,\r\n          imgWidth,\r\n          pageImgHeight\r\n        );\r\n      }\r\n\r\n      yPosition += pageContentHeight;\r\n\r\n      if (yPosition < imgHeight) {\r\n        pdf.addPage();\r\n      }\r\n    }\r\n\r\n    pdf.save(filename);\r\n  } catch (error) {\r\n    console.error('Error generating receipt PDF:', error);\r\n    throw new Error('Failed to generate receipt PDF');\r\n  }\r\n};\r\n"],"names":[],"mappings":"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"}