module.exports=[814747,(a,b,c)=>{b.exports=a.x("path",()=>require("path"))},556704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},832319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},120635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},909270,(a,b,c)=>{"use strict";b.exports=a.r(342602).vendored.contexts.AppRouterContext},736313,(a,b,c)=>{"use strict";b.exports=a.r(342602).vendored.contexts.HooksClientContext},818341,(a,b,c)=>{"use strict";b.exports=a.r(342602).vendored.contexts.ServerInsertedHtml},462882,a=>{"use strict";var b=a.i(572131),c=a.i(470121),d=a.i(750104),e=a.i(507554),f=a.i(225152),g=a.i(77994),h=a.i(3688),i=a.i(777192),j=a.i(30553),k=a.i(187924),l="Checkbox",[m,n]=(0,d.createContextScope)(l),[o,p]=m(l);function q(a){let{__scopeCheckbox:c,checked:d,children:e,defaultChecked:g,disabled:h,form:i,name:j,onCheckedChange:m,required:n,value:p="on",internal_do_not_use_render:q}=a,[r,s]=(0,f.useControllableState)({prop:d,defaultProp:g??!1,onChange:m,caller:l}),[t,u]=b.useState(null),[v,w]=b.useState(null),x=b.useRef(!1),z=!t||!!i||!!t.closest("form"),A={checked:r,disabled:h,setChecked:s,control:t,setControl:u,name:j,form:i,value:p,hasConsumerStoppedPropagationRef:x,required:n,defaultChecked:!y(g)&&g,isFormControl:z,bubbleInput:v,setBubbleInput:w};return(0,k.jsx)(o,{scope:c,...A,children:"function"==typeof q?q(A):e})}var r="CheckboxTrigger",s=b.forwardRef(({__scopeCheckbox:a,onKeyDown:d,onClick:f,...g},h)=>{let{control:i,value:l,disabled:m,checked:n,required:o,setControl:q,setChecked:s,hasConsumerStoppedPropagationRef:t,isFormControl:u,bubbleInput:v}=p(r,a),w=(0,c.useComposedRefs)(h,q),x=b.useRef(n);return b.useEffect(()=>{let a=i?.form;if(a){let b=()=>s(x.current);return a.addEventListener("reset",b),()=>a.removeEventListener("reset",b)}},[i,s]),(0,k.jsx)(j.Primitive.button,{type:"button",role:"checkbox","aria-checked":y(n)?"mixed":n,"aria-required":o,"data-state":z(n),"data-disabled":m?"":void 0,disabled:m,value:l,...g,ref:w,onKeyDown:(0,e.composeEventHandlers)(d,a=>{"Enter"===a.key&&a.preventDefault()}),onClick:(0,e.composeEventHandlers)(f,a=>{s(a=>!!y(a)||!a),v&&u&&(t.current=a.isPropagationStopped(),t.current||a.stopPropagation())})})});s.displayName=r;var t=b.forwardRef((a,b)=>{let{__scopeCheckbox:c,name:d,checked:e,defaultChecked:f,required:g,disabled:h,value:i,onCheckedChange:j,form:l,...m}=a;return(0,k.jsx)(q,{__scopeCheckbox:c,checked:e,defaultChecked:f,disabled:h,required:g,onCheckedChange:j,name:d,form:l,value:i,internal_do_not_use_render:({isFormControl:a})=>(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(s,{...m,ref:b,__scopeCheckbox:c}),a&&(0,k.jsx)(x,{__scopeCheckbox:c})]})})});t.displayName=l;var u="CheckboxIndicator",v=b.forwardRef((a,b)=>{let{__scopeCheckbox:c,forceMount:d,...e}=a,f=p(u,c);return(0,k.jsx)(i.Presence,{present:d||y(f.checked)||!0===f.checked,children:(0,k.jsx)(j.Primitive.span,{"data-state":z(f.checked),"data-disabled":f.disabled?"":void 0,...e,ref:b,style:{pointerEvents:"none",...a.style}})})});v.displayName=u;var w="CheckboxBubbleInput",x=b.forwardRef(({__scopeCheckbox:a,...d},e)=>{let{control:f,hasConsumerStoppedPropagationRef:i,checked:l,defaultChecked:m,required:n,disabled:o,name:q,value:r,form:s,bubbleInput:t,setBubbleInput:u}=p(w,a),v=(0,c.useComposedRefs)(e,u),x=(0,g.usePrevious)(l),z=(0,h.useSize)(f);b.useEffect(()=>{if(!t)return;let a=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set,b=!i.current;if(x!==l&&a){let c=new Event("click",{bubbles:b});t.indeterminate=y(l),a.call(t,!y(l)&&l),t.dispatchEvent(c)}},[t,x,l,i]);let A=b.useRef(!y(l)&&l);return(0,k.jsx)(j.Primitive.input,{type:"checkbox","aria-hidden":!0,defaultChecked:m??A.current,required:n,disabled:o,name:q,value:r,form:s,...d,tabIndex:-1,ref:v,style:{...d.style,...z,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});function y(a){return"indeterminate"===a}function z(a){return y(a)?"indeterminate":a?"checked":"unchecked"}x.displayName=w,a.s(["Checkbox",()=>t,"CheckboxIndicator",()=>v,"Indicator",()=>v,"Root",()=>t,"createCheckboxScope",()=>n,"unstable_BubbleInput",()=>x,"unstable_CheckboxBubbleInput",()=>x,"unstable_CheckboxProvider",()=>q,"unstable_CheckboxTrigger",()=>s,"unstable_Provider",()=>q,"unstable_Trigger",()=>s])},315055,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(462882),e=a.i(533441),f=a.i(368114);let g=c.forwardRef(({className:a,...c},g)=>(0,b.jsx)(d.Root,{ref:g,className:(0,f.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",a),...c,children:(0,b.jsx)(d.Indicator,{className:(0,f.cn)("flex items-center justify-center text-current"),children:(0,b.jsx)(e.Check,{className:"h-4 w-4"})})}));g.displayName=d.Root.displayName,a.s(["Checkbox",()=>g])},771931,a=>{"use strict";let b=(0,a.i(170106).default)("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]);a.s(["Printer",()=>b],771931)},400210,a=>{"use strict";let b=(0,a.i(170106).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);a.s(["ArrowLeft",()=>b],400210)},119025,a=>{"use strict";var b=a.i(572131),c=a.i(507554),d=a.i(470121),e=a.i(750104),f=a.i(225152),g=a.i(77994),h=a.i(3688),i=a.i(30553),j=a.i(187924),k="Switch",[l,m]=(0,e.createContextScope)(k),[n,o]=l(k),p=b.forwardRef((a,e)=>{let{__scopeSwitch:g,name:h,checked:l,defaultChecked:m,required:o,disabled:p,value:q="on",onCheckedChange:r,form:u,...v}=a,[w,x]=b.useState(null),y=(0,d.useComposedRefs)(e,a=>x(a)),z=b.useRef(!1),A=!w||u||!!w.closest("form"),[B,C]=(0,f.useControllableState)({prop:l,defaultProp:m??!1,onChange:r,caller:k});return(0,j.jsxs)(n,{scope:g,checked:B,disabled:p,children:[(0,j.jsx)(i.Primitive.button,{type:"button",role:"switch","aria-checked":B,"aria-required":o,"data-state":t(B),"data-disabled":p?"":void 0,disabled:p,value:q,...v,ref:y,onClick:(0,c.composeEventHandlers)(a.onClick,a=>{C(a=>!a),A&&(z.current=a.isPropagationStopped(),z.current||a.stopPropagation())})}),A&&(0,j.jsx)(s,{control:w,bubbles:!z.current,name:h,value:q,checked:B,required:o,disabled:p,form:u,style:{transform:"translateX(-100%)"}})]})});p.displayName=k;var q="SwitchThumb",r=b.forwardRef((a,b)=>{let{__scopeSwitch:c,...d}=a,e=o(q,c);return(0,j.jsx)(i.Primitive.span,{"data-state":t(e.checked),"data-disabled":e.disabled?"":void 0,...d,ref:b})});r.displayName=q;var s=b.forwardRef(({__scopeSwitch:a,control:c,checked:e,bubbles:f=!0,...i},k)=>{let l=b.useRef(null),m=(0,d.useComposedRefs)(l,k),n=(0,g.usePrevious)(e),o=(0,h.useSize)(c);return b.useEffect(()=>{let a=l.current;if(!a)return;let b=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(n!==e&&b){let c=new Event("click",{bubbles:f});b.call(a,e),a.dispatchEvent(c)}},[n,e,f]),(0,j.jsx)("input",{type:"checkbox","aria-hidden":!0,defaultChecked:e,...i,tabIndex:-1,ref:m,style:{...i.style,...o,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});function t(a){return a?"checked":"unchecked"}s.displayName="SwitchBubbleInput",a.s(["Root",()=>p,"Switch",()=>p,"SwitchThumb",()=>r,"Thumb",()=>r,"createSwitchScope",()=>m])},563658,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(119025),e=a.i(368114);let f=c.forwardRef(({className:a,...c},f)=>(0,b.jsx)(d.Root,{className:(0,e.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",a),...c,ref:f,children:(0,b.jsx)(d.Thumb,{className:(0,e.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));f.displayName=d.Root.displayName,a.s(["Switch",()=>f])},787654,a=>{"use strict";let b=(0,a.i(170106).default)("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);a.s(["RotateCcw",()=>b],787654)},896378,a=>{"use strict";a.s(["matchProductSearch",0,(a,b)=>{if(!b||!b.trim())return!0;let c=b.toLowerCase().trim().split(/\s+/),d=[String(a.name||""),String(a.description||""),String(a.category||""),String(a.supplier||""),String(a.itemNumber||""),String(a.barcode||""),String(a.manufacturerBarcode||"")].map(a=>a.toLowerCase());return c.every(a=>d.some(b=>b.includes(a)))}])},243920,a=>{"use strict";var b=a.i(187924);let c=(0,a.i(170106).default)("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);a.s(["default",0,({imageUrl:a,alt:d,size:e="md"})=>{let f="sm"===e?"w-10 h-10":"w-12 h-12";return a?(0,b.jsx)("img",{src:a,alt:d,className:`${f} object-cover rounded-md`}):(0,b.jsx)("div",{className:`${f} bg-gray-100 flex items-center justify-center rounded-md`,children:(0,b.jsx)(c,{size:"sm"===e?16:18,className:"text-gray-400"})})}],243920)},641710,a=>{"use strict";let b=(0,a.i(170106).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);a.s(["Clock",()=>b],641710)},842544,a=>{"use strict";var b=a.i(572131),c=a.i(169819),d=a.i(320562),e=a.i(770288),f=a.i(905231),g=a.i(508048),h=a.i(874884),i=a.i(913334),j=a.i(124565);a.s(["useStockHistory",0,(a,k)=>{let[l,m]=(0,b.useState)([]),[n,o]=(0,b.useState)(!0),{currentBusiness:p}=(0,c.useBusiness)(),q=(0,b.useCallback)(async()=>{if(!a||!p){m([]),o(!1);return}try{o(!0);let a=await (0,d.getStockHistoryAction)(p.id,k);if(!a.success||!a.data)throw Error(a.error||"Failed to fetch stock history");let b=a.data.map(a=>({id:a.id,productId:a.productId,oldQuantity:a.oldQuantity,newQuantity:a.newQuantity,changeReason:a.changeReason,createdAt:new Date(a.createdAt),referenceId:a.referenceId,receiptNumber:a.receiptNumber,product:a.product}));m(b)}catch(a){console.error("Error loading stock history:",a)}finally{o(!1)}},[a,p?.id,k]);return(0,b.useEffect)(()=>{q()},[q]),{stockHistory:l,isLoading:n,createStockHistoryEntry:async(b,c,d,f,g,h,i,j)=>{try{if(!a||!p)return!1;let k=j?`[${j}] | ${f}`:f,l=await (0,e.createStockHistoryAction)({userId:a,locationId:p.id,productId:b,previousQuantity:c,newQuantity:d,changeReason:k,referenceId:g,receiptNumber:i,createdAt:h?.toISOString()});if(!l.success)return console.error("Error creating stock history entry:",l.error),!1;return await q(),!0}catch(a){return console.error("Error creating stock history:",a),!1}},deleteMultipleStockHistoryEntriesByReference:async a=>{try{if(!p)return!1;let b=await (0,g.deleteStockHistoryEntriesByReferenceAction)(a,p.id);if(!b.success)throw Error(b.error);return await q(),!0}catch(a){return console.error("Error deleting stock history entries:",a),!1}},recalculateStockChain:async a=>{try{if(!p)return!1;let b=await (0,f.recalculateStockChainAction)(a,p.id);if(!b.success)throw Error(b.error);return await q(),!0}catch(a){return console.error("Error recalculating stock chain:",a),!1}},updateStockHistoryDatesBySaleId:async(a,b)=>{try{if(!p)return!1;let c=await (0,h.updateStockHistoryDatesByReferenceAction)(a,p.id,b.toISOString());if(!c.success)throw Error(c.error);return await q(),!0}catch(a){return console.error("Error updating stock history dates:",a),!1}},repairAllStockChains:async a=>{try{if(!p)return{repaired:0,failed:0};let a=await (0,i.repairStockChainsAction)(p.id);if(a.success&&a.data)return a.data;return{repaired:0,failed:0}}catch(a){return console.error("Error repairing all chains:",a),{repaired:0,failed:0}}},previewStockChainRepairs:async a=>{try{if(!p)return[];let a=await (0,j.getStockRepairsPreviewAction)(p.id);if(a.success&&a.data)return a.data;return[]}catch(a){return console.error("Error previewing repairs:",a),[]}},refreshHistory:q}}])},161990,a=>{"use strict";var b=a.i(572131),c=a.i(169819),d=a.i(478793),e=a.i(391956),f=a.i(405050);let g=(0,f.createServerReference)("40d192c7133b72d6eb22105e9bdccca4dd09d6c312",f.callServer,void 0,f.findSourceMapURL,"getSalesCategoriesAction"),h=(0,f.createServerReference)("78f34606537592502556e5eff8bf435c75821848df",f.callServer,void 0,f.findSourceMapURL,"createSalesCategoryAction"),i=(0,f.createServerReference)("601c76a41759792ff7ede8d55df9ffa468b0da22c2",f.callServer,void 0,f.findSourceMapURL,"updateSalesCategoryAction"),j=(0,f.createServerReference)("4048df543ea89e6b499e78c5496b2ff9ac8b3367ff",f.callServer,void 0,f.findSourceMapURL,"deleteSalesCategoryAction");a.s(["useSalesCategories",0,()=>{let[a,f]=(0,b.useState)([]),[k,l]=(0,b.useState)(!0),{currentBusiness:m}=(0,c.useBusiness)(),{user:n}=(0,e.useAuth)(),o=async()=>{if(!m){f([]),l(!1);return}try{let a=await g(m.id);if(a.success&&a.data)f(a.data);else throw Error(a.error)}catch(a){console.error("Error fetching sales categories:",a),(0,d.toast)({title:"Error",description:"Failed to fetch sales categories",variant:"destructive"})}finally{l(!1)}};return(0,b.useEffect)(()=>{o()},[m]),{categories:a,isLoading:k,createCategory:async a=>{if(!m||!n)return(0,d.toast)({title:"Error",description:"No business selected or user not authenticated",variant:"destructive"}),!1;try{let b=await h(m.id,n.id,a);if(b.success)return(0,d.toast)({title:"Success",description:"Sales category created successfully"}),o(),!0;throw Error(b.error)}catch(a){return console.error("Error creating sales category:",a),(0,d.toast)({title:"Error",description:"Failed to create sales category",variant:"destructive"}),!1}},updateCategory:async(a,b)=>{try{let c=await i(a,b);if(c.success)return(0,d.toast)({title:"Success",description:"Sales category updated successfully"}),o(),!0;throw Error(c.error)}catch(a){return console.error("Error updating sales category:",a),(0,d.toast)({title:"Error",description:"Failed to update sales category",variant:"destructive"}),!1}},deleteCategory:async a=>{try{let b=await j(a);if(b.success)return(0,d.toast)({title:"Success",description:"Sales category deleted successfully"}),o(),!0;throw Error(b.error)}catch(a){return console.error("Error deleting sales category:",a),(0,d.toast)({title:"Error",description:"Failed to delete sales category",variant:"destructive"}),!1}},createDefaultCategories:async()=>{if(m&&n)try{for(let a of["Retail","Online","Wholesale"])await h(m.id,n.id,a,!0);o()}catch(a){console.error("Error creating default categories:",a)}},refetch:o}}],161990)},225126,a=>{"use strict";var b=a.i(572131),c=a.i(169819),d=a.i(890914),e=a.i(433217),f=a.i(937927),g=a.i(478793),h=a.i(405050);let i=(0,h.createServerReference)("600b97f3c90242ca4be1574d304e260e5e07e3c8cf",h.callServer,void 0,h.findSourceMapURL,"getMessagesAction"),j=(0,h.createServerReference)("40fae8e3cd20e274d8835c219996fbcfcdde06446f",h.callServer,void 0,h.findSourceMapURL,"createMessageAction"),k=(0,h.createServerReference)("608c56e751f1517abf78af3f8f4b1eb817c5efcecc",h.callServer,void 0,h.findSourceMapURL,"getMessageTemplatesAction"),l=(0,h.createServerReference)("4012401c60d205ed481a496ad745ca64dfad82e200",h.callServer,void 0,h.findSourceMapURL,"createMessageTemplateAction"),m=(0,h.createServerReference)("60a4c2261958cabb4ed4ad155b1559b15bd9b1c7a3",h.callServer,void 0,h.findSourceMapURL,"updateMessageTemplateAction"),n=(0,h.createServerReference)("406dfcb8705c888c32dc2bb1380b80464b3977c05d",h.callServer,void 0,h.findSourceMapURL,"deleteMessageTemplateAction");a.s(["useMessages",0,a=>{let[h,o]=(0,b.useState)([]),[p,q]=(0,b.useState)([]),[r,s]=(0,b.useState)([]),[t,u]=(0,b.useState)(0),{currentBusiness:v}=(0,c.useBusiness)(),{currentProfile:w}=(0,d.useProfiles)(),x=(0,f.useQueryClient)(),y=async()=>{w?.sms_credits!==void 0&&u(w.sms_credits)},z=async b=>{if(!a||!v?.id)return null;try{let c=await l({userId:a,locationId:v.id,name:b.name,content:b.content,category:b.category,variables:b.variables,isDefault:b.isDefault});if(c.success&&c.data)return G(),c.data;throw Error(c.error)}catch(a){return console.error("Error creating template:",a),(0,g.toast)({title:"Error",description:"Failed to create template",variant:"destructive"}),null}},A=async(a,b)=>{try{let c=await m(a,b);if(c.success)G();else throw Error(c.error)}catch(a){console.error("Error updating template:",a),(0,g.toast)({title:"Error",description:"Failed to update template",variant:"destructive"})}},B=async a=>{try{let b=await n(a);if(b.success)q(b=>b.filter(b=>b.id!==a));else throw Error(b.error)}catch(a){console.error("Error deleting template:",a),(0,g.toast)({title:"Error",description:"Failed to delete template",variant:"destructive"})}},C=(0,b.useCallback)(async()=>{if(!a||!v?.id)return[];try{let b=await i(a,v.id);if(b.success&&b.data)return b.data;return[]}catch(a){return console.error("Error fetching messages:",a),[]}},[a,v?.id]),D=["messages",a,v?.id],{data:E,isLoading:F}=(0,e.useQuery)({queryKey:D,queryFn:C,enabled:!!a&&!!v?.id});(0,b.useEffect)(()=>{E&&o(E)},[E]);let G=async()=>{if(a&&v?.id)try{let b=await k(a,v.id);b.success&&b.data&&q(b.data)}catch(a){console.error("Error fetching templates:",a)}},H=async()=>{s([])},I=async b=>{let c;if(!a||!v?.id||!w)return null;let d=(c=b.phoneNumber.replace(/[\s\-\(\)]/g,"")).startsWith("+")?c:c.startsWith("256")?"+"+c:c.startsWith("0")?"+256"+c.substring(1):(9===c.length&&c.match(/^[7]\d{8}$/),"+256"+c),e=Math.ceil(b.content.length/160);if(w.sms_credits<e)return(0,g.toast)({title:"Error",description:"Insufficient credits",variant:"destructive"}),null;try{let c=await j({userId:a,locationId:v.id,profileId:w.id,customerId:b.customerId,phoneNumber:d,content:b.content,templateId:b.templateId,smsCreditsUsed:e,status:"sent",metadata:b.metadata});if(c.success&&c.data){let a={...c.data,createdAt:c.data.createdAt.toISOString()};return o(b=>[a,...b]),x.invalidateQueries({queryKey:D}),(0,g.toast)({title:"Success",description:"Message sent successfully"}),a}throw Error(c.error)}catch(a){return console.error("Error sending message:",a),(0,g.toast)({title:"Error",description:"Failed to send message",variant:"destructive"}),null}},J=async a=>{let b=0;for(let c of a.customerIds)b++;return{success:b,failed:0,errors:[]}},K=async(a,b)=>((0,g.toast)({title:"Info",description:"Credit purchase migration in progress"}),null);return(0,b.useEffect)(()=>{a&&v?.id&&(G(),H(),y())},[a,v?.id,w?.id]),{messages:h,templates:p,purchases:r,liveCredits:t,isLoading:F&&!E,createMessage:I,createBulkMessages:J,createTemplate:z,updateTemplate:A,deleteTemplate:B,getMessageStats:()=>{let a=h.length,b=h.filter(a=>"sent"===a.status||"delivered"===a.status).length,c=h.filter(a=>"failed"===a.status).length;return{total:a,sent:b,failed:c,pending:h.filter(a=>"pending"===a.status).length,totalCreditsUsed:h.reduce((a,b)=>a+b.smsCreditsUsed,0),creditsRemaining:t}},initiateCreditPurchase:K,refresh:()=>{x.invalidateQueries({queryKey:D}),G(),H(),y()}}}],225126)},100260,a=>{"use strict";var b=a.i(572131),c=a.i(478793),d=a.i(169819),e=a.i(258956),f=a.i(433217),g=a.i(937927),h=a.i(405050);let i=(0,h.createServerReference)("40227d1c2ed5cbf6324cf519682235031f0a3138a5",h.callServer,void 0,h.findSourceMapURL,"getCustomersAction"),j=(0,h.createServerReference)("708938753470d59bd6fa4ddf41a8a3581263dd393b",h.callServer,void 0,h.findSourceMapURL,"createCustomerAction"),k=(0,h.createServerReference)("609ad415d8b556837c750a19320a30ea6d4beaf896",h.callServer,void 0,h.findSourceMapURL,"updateCustomerAction"),l=(0,h.createServerReference)("40f9d32b0ea15e5c8f0b3441eec79ddb30815f1c83",h.callServer,void 0,h.findSourceMapURL,"deleteCustomerAction");var m=a.i(391956);a.s(["useCustomers",0,(a=50)=>{let[h,n]=(0,b.useState)([]),[o,p]=(0,b.useState)(1),[q,r]=(0,b.useState)(a),[s,t]=(0,b.useState)(0),{toast:u}=(0,c.useToast)(),{currentBusiness:v}=(0,d.useBusiness)(),{user:w}=(0,m.useAuth)(),{logActivity:x}=(0,e.useActivityLogger)(),y=(0,g.useQueryClient)(),z=(0,b.useCallback)(async()=>{if(!v)return{customers:[],count:0};try{let a=await i(v.id);if(!a.success)throw Error(a.error);return{customers:(a.data?.customers||[]).map(a=>({id:a.id,fullName:a.fullName||a.name,phoneNumber:a.phoneNumber||a.phone,email:a.email,birthday:a.birthday?new Date(a.birthday):null,gender:a.gender,location:a.location||a.address,categoryId:a.categoryId,notes:a.notes,tags:a.tags,socialMedia:a.socialMedia||null,createdAt:new Date(a.createdAt),updatedAt:new Date(a.updatedAt)})),count:a.data?.count||0}}catch(a){return console.error("Error loading customers:",a),u({title:"Error",description:"Failed to load customers. Please try again.",variant:"destructive"}),{customers:[],count:0}}},[v?.id,u]),A=["customers",v?.id],{data:B,isLoading:C,isFetching:D}=(0,f.useQuery)({queryKey:A,queryFn:z,enabled:!!v?.id,staleTime:3e5,gcTime:18e5,refetchOnWindowFocus:!1,refetchOnReconnect:!1});(0,b.useEffect)(()=>{B&&(n(B.customers),t(B.count))},[B]);let E=async a=>{if(!v)return u({title:"Error",description:"No business selected",variant:"destructive"}),null;try{if(!w)throw Error("User not authenticated");let b={fullName:a.fullName,phoneNumber:a.phoneNumber||null,email:a.email||null,birthday:a.birthday?.toISOString().split("T")[0]||null,gender:a.gender||null,location:a.location||null,categoryId:a.categoryId||null,notes:a.notes||null,tags:a.tags||null,socialMedia:a.socialMedia||null},c=await j(v.id,w.id,b);if(!c.success||!c.data)throw Error(c.error||"Failed to create customer");let d=c.data,e={id:d.id,fullName:d.name||d.fullName,phoneNumber:d.phone||d.phoneNumber,email:d.email,birthday:d.birthday?new Date(d.birthday):null,gender:d.gender,location:d.address||d.location,categoryId:d.categoryId,notes:d.notes,tags:d.tags,socialMedia:d.socialMedia,createdAt:new Date(d.createdAt),updatedAt:new Date(d.updatedAt)};return n(a=>[e,...a]),t(a=>a+1),y.setQueryData(A,a=>a?{customers:[e,...a.customers],count:(a.count||0)+1}:{customers:[e],count:1}),await x({activityType:"CREATE",module:"CUSTOMERS",entityType:"customer",entityId:d.id,entityName:a.fullName,description:`Created customer "${a.fullName}"`,metadata:{phoneNumber:a.phoneNumber,email:a.email,location:a.location}}),u({title:"Success",description:"Customer created successfully"}),d}catch(a){return console.error("Error creating customer:",a),u({title:"Error",description:"Failed to create customer. Please try again.",variant:"destructive"}),null}},F=async(a,b)=>{try{let c={};void 0!==b.fullName&&(c.fullName=b.fullName),void 0!==b.phoneNumber&&(c.phoneNumber=b.phoneNumber),void 0!==b.email&&(c.email=b.email),void 0!==b.birthday&&(c.birthday=b.birthday?.toISOString()),void 0!==b.gender&&(c.gender=b.gender),void 0!==b.location&&(c.location=b.location),void 0!==b.categoryId&&(c.categoryId=b.categoryId),void 0!==b.notes&&(c.notes=b.notes),void 0!==b.tags&&(c.tags=b.tags),void 0!==b.socialMedia&&(c.socialMedia=b.socialMedia);let d=await k(a,c);if(!d.success)throw Error(d.error||"Failed to update customer");n(c=>c.map(c=>c.id===a?{...c,...b}:c)),y.setQueryData(A,c=>c?{...c,customers:c.customers.map(c=>c.id===a?{...c,...b}:c)}:c);let e=h.find(b=>b.id===a);return e&&await x({activityType:"UPDATE",module:"CUSTOMERS",entityType:"customer",entityId:a,entityName:e.fullName,description:`Updated customer "${e.fullName}"`,metadata:{updates:b}}),u({title:"Success",description:"Customer updated successfully"}),!0}catch(a){return console.error("Error updating customer:",a),u({title:"Error",description:"Failed to update customer. Please try again.",variant:"destructive"}),!1}},G=async a=>{try{let b=h.find(b=>b.id===a),c=await l(a);if(!c.success)throw Error(c.error||"Failed to delete customer");return n(b=>b.filter(b=>b.id!==a)),t(a=>Math.max(0,a-1)),y.setQueryData(A,b=>{if(!b)return b;let{customers:c,count:d}=b;return{customers:c.filter(b=>b.id!==a),count:Math.max(0,(d||0)-1)}}),y.invalidateQueries({queryKey:A}),b&&await x({activityType:"DELETE",module:"CUSTOMERS",entityType:"customer",entityId:a,entityName:b.fullName,description:`Deleted customer "${b.fullName}"`,metadata:{phoneNumber:b.phoneNumber,email:b.email}}),u({title:"Success",description:"Customer deleted successfully"}),!0}catch(a){return console.error("Error deleting customer:",a),u({title:"Error",description:"Failed to delete customer. Please try again.",variant:"destructive"}),!1}};return{customers:h,isLoading:C&&!B,createCustomer:E,addCustomer:E,updateCustomer:F,deleteCustomer:G,loadCustomers:z,page:o,setPage:p,pageSize:q,setPageSize:r,totalCount:s}}],100260)},156171,a=>{"use strict";var b=a.i(405050);let c=(0,b.createServerReference)("605a5ac8c70aa01eb0dd29483cb3c24316ae309de0",b.callServer,void 0,b.findSourceMapURL,"getProductReconciliationAction");a.s(["getProductReconciliationAction",()=>c])},559589,a=>{"use strict";var b=a.i(405050);let c=(0,b.createServerReference)("7022b270c26116cc720c0fe09926fa8749c32b0ea9",b.callServer,void 0,b.findSourceMapURL,"getStockSummaryReportAction");a.s(["getStockSummaryReportAction",()=>c])},770288,a=>{"use strict";var b=a.i(405050);let c=(0,b.createServerReference)("40193ce83d40b7dbf7c2991866f6d090da71bf2f59",b.callServer,void 0,b.findSourceMapURL,"createStockHistoryAction");a.s(["createStockHistoryAction",()=>c])},124565,a=>{"use strict";var b=a.i(405050);let c=(0,b.createServerReference)("406e0d925bc965618c40bddb0b2011bea951e9b025",b.callServer,void 0,b.findSourceMapURL,"getStockRepairsPreviewAction");a.s(["getStockRepairsPreviewAction",()=>c])},913334,a=>{"use strict";var b=a.i(405050);let c=(0,b.createServerReference)("60a33152b65e6ef5593ff2b5c1d0a77d09216fe7e5",b.callServer,void 0,b.findSourceMapURL,"repairStockChainsAction");a.s(["repairStockChainsAction",()=>c])},320562,905231,508048,874884,a=>{"use strict";var b=a.i(405050);let c=(0,b.createServerReference)("6055d418bbb34217108fb09f6c6e07a1977765bffb",b.callServer,void 0,b.findSourceMapURL,"getStockHistoryAction");a.s(["getStockHistoryAction",()=>c],320562);let d=(0,b.createServerReference)("60b4fb287dfbc2b628cca363587f00d76a36f3623b",b.callServer,void 0,b.findSourceMapURL,"recalculateStockChainAction");a.s(["recalculateStockChainAction",()=>d],905231);let e=(0,b.createServerReference)("60428e59105c2448bb202e52e31bf2d4492d8468f7",b.callServer,void 0,b.findSourceMapURL,"deleteStockHistoryEntriesByReferenceAction");a.s(["deleteStockHistoryEntriesByReferenceAction",()=>e],508048);let f=(0,b.createServerReference)("70e0c90d8c965637b3ae61b1f0dd8fc9a41ea083d6",b.callServer,void 0,b.findSourceMapURL,"updateStockHistoryDatesByReferenceAction");a.s(["updateStockHistoryDatesByReferenceAction",()=>f],874884)},219773,186344,468638,905457,a=>{"use strict";var b=a.i(405050);let c=(0,b.createServerReference)("60048cacdf8f6ab02d12e637338fb3a82838e3ab18",b.callServer,void 0,b.findSourceMapURL,"getRequisitionsAction");a.s(["getRequisitionsAction",()=>c],219773);let d=(0,b.createServerReference)("40e343dbe89cc3fb8304b10c9c62480d17ad426333",b.callServer,void 0,b.findSourceMapURL,"createRequisitionAction");a.s(["createRequisitionAction",()=>d],186344);let e=(0,b.createServerReference)("701e152aafbc4d4daee38965467b93e083a6e967b4",b.callServer,void 0,b.findSourceMapURL,"updateRequisitionAction");a.s(["updateRequisitionAction",()=>e],468638);let f=(0,b.createServerReference)("605622308fa711a2f7465dc0a63c7e00dbe7c0418e",b.callServer,void 0,b.findSourceMapURL,"deleteRequisitionAction");a.s(["deleteRequisitionAction",()=>f],905457)},952765,315181,a=>{"use strict";var b=a.i(405050);let c=(0,b.createServerReference)("4035262824370ccd2af8788671f3cc8435d165a93b",b.callServer,void 0,b.findSourceMapURL,"getActivityByEntityIdsAction");a.s(["getActivityByEntityIdsAction",()=>c],952765);let d=(0,b.createServerReference)("60eb8a3f21a0957ca35a2a3606c2b8e1d21977469d",b.callServer,void 0,b.findSourceMapURL,"updateStockHistoryDatesAction");a.s(["updateStockHistoryDatesAction",()=>d],315181)},12293,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(665967),e=a.i(391956),f=a.i(866102),g=a.i(169819),h=a.i(784784),i=a.i(597480),j=a.i(812019),k=a.i(580716),l=a.i(9719),m=a.i(262285),n=a.i(890914),o=a.i(292e3),p=a.i(124348),q=a.i(699570);a.s(["default",0,()=>{let a=(0,d.useNavigate)(),r=(0,d.useLocation)(),{user:s}=(0,e.useAuth)(),{settings:t}=(0,f.useBusinessSettings)(),{currentBusiness:u,isLoading:v}=(0,g.useBusiness)(),{hasPermission:w,isLoading:x}=(0,n.useProfiles)(),y=r.state?.editSale,[z,A]=c.default.useState(0),B=c.default.useCallback(()=>{A(a=>a+1)},[]),{showDraftNotification:C,draftData:D,handleLoadDraft:E,handleDismissDraft:F,clearDraft:G}=(0,h.useNewSaleDraft)(y),{isReceiptOpen:H,completedSale:I,newCustomerDialogOpen:J,includePaymentInfo:K,customers:L,handleSaleComplete:M,handleReceiptClose:N,handleAddCustomer:O,handleOpenNewCustomerDialog:P,setNewCustomerDialogOpen:Q}=(0,i.useNewSaleActions)(y,B);if(v||x)return(0,b.jsx)(j.default,{});if(!u)return(0,b.jsx)(k.default,{});let R=!y||w("sales","edit"),S=!!y||w("sales","create");return R&&S?(0,b.jsxs)("div",{className:"max-w-4xl mx-auto",children:[!s&&(0,b.jsx)(l.default,{}),(0,b.jsx)(m.default,{editSale:y,currency:t.currency,showDraftNotification:C,draftData:D,onLoadDraft:E,onDismissDraft:F,onSaleComplete:(a,b,c,d,e,f,g)=>M(a,b,c,d,G||e,f,g),onClearDraft:G,customers:L||[],onAddNewCustomer:P,isReceiptOpen:H,completedSale:I,includePaymentInfo:K,onReceiptClose:N,newCustomerDialogOpen:J,onCloseNewCustomerDialog:()=>Q(!1),onAddCustomer:O},z)]}):(0,b.jsxs)("div",{className:"max-w-4xl mx-auto p-6",children:[(0,b.jsxs)(p.Alert,{variant:"destructive",children:[(0,b.jsx)(o.AlertCircle,{className:"h-4 w-4"}),(0,b.jsx)(p.AlertTitle,{children:"Access Denied"}),(0,b.jsxs)(p.AlertDescription,{children:["You do not have permission to ",y?"edit this sale":"create a new sale",". Please contact your administrator if you believe this is an error."]})]}),(0,b.jsx)("div",{className:"mt-4",children:(0,b.jsx)(q.Button,{onClick:()=>a("/sales"),variant:"outline",children:"Back to Sales"})})]})}])},170562,a=>{a.v(b=>Promise.all(["server/chunks/ssr/_4f22e417._.js"].map(b=>a.l(b))).then(()=>b(921612)))},924016,a=>{a.v(b=>Promise.all(["server/chunks/ssr/src_utils_thermalPrinterWeb_ts_5d4ff4d2._.js"].map(b=>a.l(b))).then(()=>b(138122)))},151788,a=>{a.v(b=>Promise.all(["server/chunks/ssr/[root-of-the-server]__092cd4f3._.js","server/chunks/ssr/node_modules_205f137c._.js"].map(b=>a.l(b))).then(()=>b(771254)))},887913,a=>{a.v(b=>Promise.all(["server/chunks/ssr/[root-of-the-server]__61983097._.js","server/chunks/ssr/node_modules_205f137c._.js"].map(b=>a.l(b))).then(()=>b(918646)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__81a329f5._.js.map