module.exports=[525213,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(169819),e=a.i(349774),f=a.i(433217),g=a.i(937927),h=a.i(862010),i=a.i(786304),j=a.i(591119),k=a.i(538784),l=a.i(883497),m=a.i(501199),n=a.i(911156),o=a.i(660246),p=a.i(287534),q=a.i(915618),r=a.i(824569),s=a.i(781560),t=a.i(641710),u=a.i(934754),v=a.i(244513),w=a.i(852587),x=a.i(23464),y=a.i(57270),z=a.i(774016);function A(a,b){let c=(0,z.toDate)(a)-(0,z.toDate)(b);return c<0?-1:c>0?1:c}var B=a.i(959296),C=a.i(238124),D=a.i(661042),E=a.i(322658);function F(a,b){return function(a,b,c){var d;let e,f=(0,w.getDefaultOptions)(),g=c?.locale??f.locale??v.defaultLocale,h=A(a,b);if(isNaN(h))throw RangeError("Invalid time value");let i=Object.assign({},c,{addSuffix:c?.addSuffix,comparison:h}),[j,k]=(0,y.normalizeDates)(c?.in,...h>0?[b,a]:[a,b]),l=(d=void 0,a=>{let b=(d?Math[d]:Math.trunc)(a);return 0===b?0:b})(((0,z.toDate)(k)-(0,z.toDate)(j))/1e3),m=Math.round((l-((0,x.getTimezoneOffsetInMilliseconds)(k)-(0,x.getTimezoneOffsetInMilliseconds)(j))/1e3)/60);if(m<2)if(c?.includeSeconds)if(l<5)return g.formatDistance("lessThanXSeconds",5,i);else if(l<10)return g.formatDistance("lessThanXSeconds",10,i);else if(l<20)return g.formatDistance("lessThanXSeconds",20,i);else if(l<40)return g.formatDistance("halfAMinute",0,i);else if(l<60)return g.formatDistance("lessThanXMinutes",1,i);else return g.formatDistance("xMinutes",1,i);else if(0===m)return g.formatDistance("lessThanXMinutes",1,i);else return g.formatDistance("xMinutes",m,i);if(m<45)return g.formatDistance("xMinutes",m,i);if(m<90)return g.formatDistance("aboutXHours",1,i);if(m<B.minutesInDay){let a=Math.round(m/60);return g.formatDistance("aboutXHours",a,i)}if(m<2520)return g.formatDistance("xDays",1,i);else if(m<B.minutesInMonth){let a=Math.round(m/B.minutesInDay);return g.formatDistance("xDays",a,i)}else if(m<2*B.minutesInMonth)return e=Math.round(m/B.minutesInMonth),g.formatDistance("aboutXMonths",e,i);if((e=function(a,b,c){let d,[e,f,g]=(0,y.normalizeDates)(void 0,a,a,b),h=A(f,g),i=Math.abs((0,C.differenceInCalendarMonths)(f,g));if(i<1)return 0;1===f.getMonth()&&f.getDate()>27&&f.setDate(30),f.setMonth(f.getMonth()-h*i);let j=A(f,g)===-h;d=(0,z.toDate)(e,void 0),+(0,D.endOfDay)(d,void 0)==+(0,E.endOfMonth)(d,void 0)&&1===i&&1===A(e,g)&&(j=!1);let k=h*(i-j);return 0===k?0:k}(k,j))<12){let a=Math.round(m/B.minutesInMonth);return g.formatDistance("xMonths",a,i)}{let a=e%12,b=Math.trunc(e/12);return a<3?g.formatDistance("aboutXYears",b,i):a<9?g.formatDistance("overXYears",b,i):g.formatDistance("almostXYears",b+1,i)}}(a,(0,u.constructNow)(a),b)}var G=a.i(400291),H=a.i(866102),I=a.i(368114);let J=a=>{switch(a){case"CREATE":return"default";case"UPDATE":default:return"secondary";case"DELETE":return"destructive"}},K=({activities:a,isGrouped:c,activity:d})=>{let e=a||(d?[d]:[]);if(0===e.length)return null;let f=e[0];return(0,b.jsx)(j.Card,{className:"p-3 md:p-4 transition-colors hover:bg-muted/50",children:(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-start gap-3 sm:gap-4",children:[(0,b.jsxs)("div",{className:"flex items-start gap-3 flex-1",children:[(0,b.jsx)("div",{className:`p-2 rounded-lg border flex-shrink-0 ${(a=>{switch(a){case"SALES":return"text-green-600 bg-green-50 border-green-200";case"INVENTORY":return"text-blue-600 bg-blue-50 border-blue-200";case"EXPENSES":return"text-red-600 bg-red-50 border-red-200";case"FINANCE":return"text-purple-600 bg-purple-50 border-purple-200";case"CUSTOMERS":return"text-orange-600 bg-orange-50 border-orange-200";case"TASKS":return"text-indigo-600 bg-indigo-50 border-indigo-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}})(f.module)}`,children:(a=>{switch(a){case"SALES":return(0,b.jsx)(k.ShoppingCart,{className:"h-4 w-4"});case"INVENTORY":default:return(0,b.jsx)(l.Package,{className:"h-4 w-4"});case"EXPENSES":return(0,b.jsx)(m.Receipt,{className:"h-4 w-4"});case"FINANCE":return(0,b.jsx)(n.CreditCard,{className:"h-4 w-4"});case"CUSTOMERS":return(0,b.jsx)(o.Users,{className:"h-4 w-4"});case"TASKS":return(0,b.jsx)(p.CheckSquare,{className:"h-4 w-4"})}})(f.module)}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between gap-2 mb-2",children:[(0,b.jsx)("span",{className:"font-medium text-foreground leading-tight break-words",children:f.entity_name}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground whitespace-nowrap flex-shrink-0 sm:hidden",children:F(new Date(f.created_at),{addSuffix:!0})})]}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-1 mb-2",children:[(0,b.jsxs)(i.Badge,{variant:J(f.activity_type),className:"gap-1 text-xs",children:[(a=>{switch(a){case"CREATE":return(0,b.jsx)(q.Plus,{className:"h-3 w-3"});case"UPDATE":default:return(0,b.jsx)(r.Edit,{className:"h-3 w-3"});case"DELETE":return(0,b.jsx)(s.Trash2,{className:"h-3 w-3"})}})(f.activity_type),(0,b.jsx)("span",{className:"hidden xs:inline",children:f.activity_type}),(0,b.jsx)("span",{className:"xs:hidden",children:f.activity_type.charAt(0)})]}),(0,b.jsx)(i.Badge,{variant:"outline",className:"text-xs",children:f.module}),f.profile_name&&(0,b.jsx)(i.Badge,{variant:"secondary",className:"text-xs truncate max-w-24",children:f.profile_name}),c&&(0,b.jsxs)(i.Badge,{variant:"outline",className:"text-xs bg-muted/50",children:[(0,b.jsx)(t.Clock,{className:"h-3 w-3 mr-1"}),e.length," actions"]})]}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-2 leading-relaxed",children:f.description}),f.metadata&&Object.keys(f.metadata).length>0&&(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:(0,b.jsxs)("details",{className:"cursor-pointer group",children:[(0,b.jsxs)("summary",{className:"hover:text-foreground py-1 select-none flex items-center gap-1",children:[(0,b.jsx)("span",{className:"group-open:rotate-90 transition-transform inline-block",children:"â–¸"})," View details"]}),(0,b.jsx)("div",{className:"mt-2 pl-2 border-l-2 border-muted",children:"SALES"===f.module&&f.metadata.items?(0,b.jsx)(L,{metadata:f.metadata}):(0,b.jsx)("pre",{className:"mt-1 p-2 bg-muted rounded text-xs overflow-auto max-h-40",children:JSON.stringify(f.metadata,null,2)})})]})}),c&&e.length>1&&(0,b.jsx)("div",{className:"mt-3 pt-3 border-t",children:(0,b.jsxs)("details",{className:"cursor-pointer group",children:[(0,b.jsxs)("summary",{className:"text-xs font-medium hover:text-foreground select-none flex items-center gap-1",children:[(0,b.jsx)("span",{className:"group-open:rotate-90 transition-transform inline-block",children:"â–¸"})," Activity Timeline (",e.length," actions)"]}),(0,b.jsx)("div",{className:"mt-3 space-y-3 pl-1",children:e.map((a,c)=>(0,b.jsxs)("div",{className:"relative pl-4 border-l border-border last:border-0 pb-1",children:[(0,b.jsx)("div",{className:`absolute -left-[5px] top-1.5 h-2.5 w-2.5 rounded-full border ${0===c?"bg-primary border-primary":"bg-background border-muted-foreground"}`}),(0,b.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,b.jsx)(i.Badge,{variant:J(a.activity_type),className:"text-[10px] h-5 px-1.5",children:a.activity_type}),(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:F(new Date(a.created_at),{addSuffix:!0})}),a.profile_name&&(0,b.jsxs)("span",{className:"text-xs text-muted-foreground",children:["by ",a.profile_name]})]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:a.description})]})]},a.id))})]})})]})]}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground whitespace-nowrap hidden sm:block flex-shrink-0",children:F(new Date(f.created_at),{addSuffix:!0})})]})})},L=({metadata:a})=>{let{canViewSellingPrice:c,canViewProfit:d,canViewTotalAmount:e}=(0,G.useFinancialVisibility)(),{settings:f}=(0,H.useBusinessSettings)(),g=f?.currency||"UGX";return(0,b.jsxs)("div",{className:"space-y-3 p-2 md:p-3 bg-muted rounded",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-4 pb-2 border-b border-border",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-xs font-medium text-muted-foreground",children:"Receipt #"}),(0,b.jsx)("p",{className:"text-sm font-mono break-all",children:a.receiptNumber})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-xs font-medium text-muted-foreground",children:"Total Amount"}),(0,b.jsx)("p",{className:"text-sm font-semibold",children:e||c?`${g} ${(0,I.formatNumber)(a.totalAmount||0)}`:"â€¢â€¢â€¢"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-xs font-medium text-muted-foreground",children:"Payment Status"}),(0,b.jsx)("p",{className:"text-sm",children:a.paymentStatus})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-xs font-medium text-muted-foreground",children:"Profit"}),(0,b.jsx)("p",{className:"text-sm",children:d?`${g} ${(0,I.formatNumber)(a.profit||0)}`:"â€¢â€¢â€¢"})]})]}),a.restoredToInventory&&(0,b.jsxs)("div",{className:"pb-2 border-b border-border",children:[(0,b.jsx)("span",{className:"text-xs font-medium text-orange-600",children:"âš ï¸ Inventory Restored"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Product quantities were restored to inventory"})]}),a.hadCashTransaction&&(0,b.jsxs)("div",{className:"pb-2 border-b border-border",children:[(0,b.jsx)("span",{className:"text-xs font-medium text-red-600",children:"ðŸ’° Cash Transaction Removed"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Associated cash transaction was also deleted"})]}),(a.customerAddress||a.customerContact)&&(0,b.jsxs)("div",{className:"pb-2 border-b border-border",children:[(0,b.jsx)("span",{className:"text-xs font-medium text-muted-foreground",children:"Customer Details"}),a.customerAddress&&(0,b.jsxs)("p",{className:"text-xs",children:["Address: ",a.customerAddress]}),a.customerContact&&(0,b.jsxs)("p",{className:"text-xs",children:["Contact: ",a.customerContact]})]}),a.items&&a.items.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsxs)("span",{className:"text-xs font-medium text-muted-foreground",children:["Items (",a.items.length,")"]}),(0,b.jsx)("div",{className:"mt-1 space-y-2 max-h-40 overflow-y-auto",children:a.items.map((a,d)=>(0,b.jsx)("div",{className:"p-2 bg-background rounded border",children:(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("p",{className:"text-xs font-medium break-words",children:a.description}),(0,b.jsxs)("div",{className:"flex flex-col xs:flex-row xs:justify-between gap-1",children:[(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Qty: ",a.quantity," Ã— ",c?`${g} ${(0,I.formatNumber)(a.price||0)}`:"â€¢â€¢â€¢"]}),(0,b.jsxs)("p",{className:"text-xs font-medium",children:["= ",c?`${g} ${(0,I.formatNumber)(a.total||0)}`:"â€¢â€¢â€¢"]})]}),a.discountPercentage>0&&(0,b.jsxs)("p",{className:"text-xs text-orange-600",children:["Discount: ",a.discountPercentage,"% (",c?`${g} ${(0,I.formatNumber)(a.discountAmount||0)}`:"â€¢â€¢â€¢",")"]})]})},d))})]}),void 0!==a.amountPaid&&(0,b.jsx)("div",{className:"pt-2 border-t border-border",children:(0,b.jsxs)("div",{className:"grid grid-cols-1 xs:grid-cols-2 gap-2 text-xs",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Amount Paid:"}),(0,b.jsx)("span",{className:"ml-1 font-medium",children:e||c?`${g} ${(0,I.formatNumber)(a.amountPaid||0)}`:"â€¢â€¢â€¢"})]}),a.taxRate>0&&(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Tax Rate:"}),(0,b.jsxs)("span",{className:"ml-1",children:[a.taxRate,"%"]})]})]})}),a.notes&&(0,b.jsxs)("div",{className:"pt-2 border-t border-border",children:[(0,b.jsx)("span",{className:"text-xs font-medium text-muted-foreground",children:"Notes"}),(0,b.jsx)("p",{className:"text-xs",children:a.notes})]})]})},M=({activities:a})=>{let d=(0,c.useMemo)(()=>{let b=new Map,c=[];a.forEach(a=>{"SALES"===a.module&&a.entity_id?(b.has(a.entity_id)||b.set(a.entity_id,[]),b.get(a.entity_id).push(a)):c.push(a)});let d=[];return b.forEach((a,b)=>{let c=a.sort((a,b)=>new Date(b.created_at).getTime()-new Date(a.created_at).getTime());d.push({key:`sale-${b}`,activities:c,latestActivity:c[0],isGrouped:c.length>1})}),c.forEach(a=>{d.push({key:a.id,activities:[a],latestActivity:a,isGrouped:!1})}),d.sort((a,b)=>new Date(b.latestActivity.created_at).getTime()-new Date(a.latestActivity.created_at).getTime())},[a]);return 0===d.length?(0,b.jsx)("div",{className:"text-center py-8",children:(0,b.jsx)("p",{className:"text-muted-foreground",children:"No activities found for the selected filters."})}):(0,b.jsx)("div",{className:"space-y-3 md:space-y-4",children:d.map(a=>(0,b.jsx)(K,{activities:a.activities,isGrouped:a.isGrouped},a.key))})};var N=a.i(866718),O=a.i(699570),P=a.i(580701),Q=a.i(320146),R=a.i(599209),S=a.i(256711),T=a.i(941675),U=a.i(581464),V=a.i(587532),W=a.i(633508),X=a.i(371844);a.s(["default",0,()=>{let{currentBusiness:a}=(0,d.useBusiness)(),[i,k]=(0,c.useState)({activityType:"ALL",module:"ALL",search:"",dateRange:{from:void 0,to:void 0}}),{activities:l,isLoading:m,totalPages:n,currentPage:o,setCurrentPage:p}=((a,b)=>{let{userId:d}=(0,e.useCurrentUser)(),[i,j]=(0,c.useState)([]),[k,l]=(0,c.useState)(0),[m,n]=(0,c.useState)(1),[o,p]=(0,c.useState)(1),q=(0,g.useQueryClient)(),r=(0,c.useCallback)(async()=>{if(!d||!a)return{activities:[],count:0};try{let c=b?{activityType:b.activityType,module:b.module,search:b.search,dateFrom:b.dateRange.from?.toISOString(),dateTo:b.dateRange.to?.toISOString()}:{},e=await (0,h.getActivityHistoryAction)(a,d,m,20,c);if(!e.success||!e.data)throw Error(e.error||"Failed to fetch activities");return{activities:e.data.activities,count:e.data.count}}catch(a){return console.error("Error fetching activity history:",a),{activities:[],count:0}}},[d,a,m,b]),s=["activity_history",d,a,m,b],{data:t,isLoading:u}=(0,f.useQuery)({queryKey:s,queryFn:r,enabled:!!d&&!!a,staleTime:3e5,gcTime:18e5,refetchOnWindowFocus:!1,refetchOnReconnect:!1});(0,c.useEffect)(()=>{t&&(j(t.activities),l(t.count),p(Math.ceil(t.count/20)))},[t]);let v=u&&!t;return(0,c.useEffect)(()=>{n(1)},[b]),(0,c.useEffect)(()=>{if(!d||!a)return},[d,a,m,b]),{activities:i,isLoading:v,totalCount:k,currentPage:m,totalPages:o,setCurrentPage:n,refetch:()=>{q.invalidateQueries({queryKey:s})}}})(a?.id,i),q="ALL"!==i.activityType||"ALL"!==i.module||""!==i.search||void 0!==i.dateRange.from;return(0,b.jsxs)("div",{className:"container mx-auto p-4 md:p-6 space-y-6 max-w-6xl",children:[(0,b.jsx)("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Recent Activity"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-1",children:"Track all actions and changes across your business"})]})}),(0,b.jsxs)(j.Card,{children:[(0,b.jsx)(j.CardHeader,{className:"pb-3",children:(0,b.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 justify-between",children:[(0,b.jsxs)(j.CardTitle,{className:"text-lg font-medium flex items-center gap-2",children:[(0,b.jsx)(U.Filter,{className:"h-5 w-5"}),"Filters"]}),q&&(0,b.jsxs)(O.Button,{variant:"ghost",size:"sm",onClick:()=>{k({activityType:"ALL",module:"ALL",search:"",dateRange:{from:void 0,to:void 0}})},className:"h-8 px-2 text-muted-foreground hover:text-foreground",children:[(0,b.jsx)(W.X,{className:"h-4 w-4 mr-1"}),"Clear Filters"]})]})}),(0,b.jsx)(j.CardContent,{children:(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(V.Search,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(N.Input,{placeholder:"Search activities...",className:"pl-9",value:i.search,onChange:a=>k(b=>({...b,search:a.target.value}))})]}),(0,b.jsxs)(P.Select,{value:i.module,onValueChange:a=>k(b=>({...b,module:a})),children:[(0,b.jsx)(P.SelectTrigger,{children:(0,b.jsx)(P.SelectValue,{placeholder:"All Modules"})}),(0,b.jsxs)(P.SelectContent,{children:[(0,b.jsx)(P.SelectItem,{value:"ALL",children:"All Modules"}),(0,b.jsx)(P.SelectItem,{value:"SALES",children:"Sales"}),(0,b.jsx)(P.SelectItem,{value:"INVENTORY",children:"Inventory"}),(0,b.jsx)(P.SelectItem,{value:"EXPENSES",children:"Expenses"}),(0,b.jsx)(P.SelectItem,{value:"CUSTOMERS",children:"Customers"}),(0,b.jsx)(P.SelectItem,{value:"FINANCE",children:"Finance"}),(0,b.jsx)(P.SelectItem,{value:"TASKS",children:"Tasks"})]})]}),(0,b.jsxs)(P.Select,{value:i.activityType,onValueChange:a=>k(b=>({...b,activityType:a})),children:[(0,b.jsx)(P.SelectTrigger,{children:(0,b.jsx)(P.SelectValue,{placeholder:"All Actions"})}),(0,b.jsxs)(P.SelectContent,{children:[(0,b.jsx)(P.SelectItem,{value:"ALL",children:"All Actions"}),(0,b.jsx)(P.SelectItem,{value:"CREATE",children:"Created"}),(0,b.jsx)(P.SelectItem,{value:"UPDATE",children:"Updated"}),(0,b.jsx)(P.SelectItem,{value:"DELETE",children:"Deleted"})]})]}),(0,b.jsxs)(R.Popover,{children:[(0,b.jsx)(R.PopoverTrigger,{asChild:!0,children:(0,b.jsxs)(O.Button,{variant:"outline",className:(0,I.cn)("justify-start text-left font-normal",!i.dateRange.from&&"text-muted-foreground"),children:[(0,b.jsx)(T.Calendar,{className:"mr-2 h-4 w-4"}),i.dateRange.from?i.dateRange.to?(0,b.jsxs)(b.Fragment,{children:[(0,S.format)(i.dateRange.from,"LLL dd, y")," -"," ",(0,S.format)(i.dateRange.to,"LLL dd, y")]}):(0,S.format)(i.dateRange.from,"LLL dd, y"):(0,b.jsx)("span",{children:"Pick a date range"})]})}),(0,b.jsx)(R.PopoverContent,{className:"w-auto p-0",align:"start",children:(0,b.jsx)(Q.Calendar,{initialFocus:!0,mode:"range",defaultMonth:i.dateRange.from,selected:i.dateRange,onSelect:a=>k(b=>({...b,dateRange:{from:a?.from,to:a?.to}})),numberOfMonths:2})})]})]})})]}),m?(0,b.jsx)("div",{className:"flex justify-center py-12",children:(0,b.jsx)(X.default,{message:"Loading activity history..."})}):(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)(M,{activities:l}),n>1&&(0,b.jsxs)("div",{className:"flex justify-center gap-2 mt-6",children:[(0,b.jsx)(O.Button,{variant:"outline",size:"sm",onClick:()=>p(a=>Math.max(1,a-1)),disabled:1===o,children:"Previous"}),(0,b.jsxs)("div",{className:"flex items-center px-4 text-sm text-muted-foreground",children:["Page ",o," of ",n]}),(0,b.jsx)(O.Button,{variant:"outline",size:"sm",onClick:()=>p(a=>Math.min(n,a+1)),disabled:o===n,children:"Next"})]})]})]})}],525213)}];

//# sourceMappingURL=src_pages_History_tsx_df38817d._.js.map