module.exports=[773681,a=>{"use strict";let b=(0,a.i(564375).default)("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);a.s(["ExternalLink",()=>b],773681)},730086,a=>{"use strict";var b=a.i(108191);a.s(["useProductImage",0,a=>{let{toast:c}=(0,b.useToast)(),d=async a=>new Promise((b,c)=>{try{let d=new FileReader;d.onerror=()=>{console.error("FileReader error"),c(Error("Failed to read file"))},d.onload=d=>{try{let e=new Image;e.onerror=()=>{console.error("Image load error"),c(Error("Failed to load image"))},e.onload=()=>{try{let d=(b,d,f)=>new Promise(g=>{let h=document.createElement("canvas");h.width=b,h.height=d;let i=h.getContext("2d");i?(i.clearRect(0,0,b,d),i.drawImage(e,0,0,b,d),h.toBlob(b=>{if(!b)return void c(Error("Could not compress image"));let d=new File([b],`${a.name.replace(/\.[^/.]+$/,"")}-optimized.jpg`,{type:"image/jpeg",lastModified:Date.now()});g(d)},"image/jpeg",f)):c(Error("Could not get canvas context"))});(async()=>{let{width:b,height:c}=e;if(b>400||c>400){let a=b/c;b>c?c=(b=400)/a:b=(c=400)*a}for(let e of(b=Math.max(50,Math.floor(b)),c=Math.max(50,Math.floor(c)),[.8,.6,.4,.3,.2,.1,.05,.02,.01])){let f=await d(b,c,e);if(f.size<=10240)return console.log("Image compression successful:"),console.log(`  Original: ${(a.size/1024).toFixed(1)}KB`),console.log(`  Compressed: ${(f.size/1024).toFixed(1)}KB`),console.log(`  Reduction: ${((a.size-f.size)/a.size*100).toFixed(1)}%`),console.log(`  Dimensions: ${b}x${c}px`),console.log(`  Quality: ${(100*e).toFixed(0)}%`),f}for(let e of[.8,.6,.5,.4,.3,.25,.2]){let f=Math.max(50,Math.floor(b*e)),g=Math.max(50,Math.floor(c*e));for(let b of[.1,.05,.02,.01]){let c=await d(f,g,b);if(c.size<=10240)return console.log("Image compression successful with dimension reduction:"),console.log(`  Original: ${(a.size/1024).toFixed(1)}KB`),console.log(`  Compressed: ${(c.size/1024).toFixed(1)}KB`),console.log(`  Reduction: ${((a.size-c.size)/a.size*100).toFixed(1)}%`),console.log(`  Dimensions: ${f}x${g}px`),console.log(`  Quality: ${(100*b).toFixed(0)}%`),c}}let f=await d(50,50,.01);return console.log("Image compression fallback:"),console.log(`  Original: ${(a.size/1024).toFixed(1)}KB`),console.log(`  Compressed: ${(f.size/1024).toFixed(1)}KB`),console.log("  Dimensions: 50x50px"),f})().then(b).catch(c)}catch(a){console.error("Canvas processing error:",a),c(Error("Failed to process image on canvas"))}},e.src=d.target?.result}catch(a){console.error("Image creation error:",a),c(Error("Failed to create image"))}},d.readAsDataURL(a)}catch(a){console.error("File reading setup error:",a),c(Error("Failed to setup file reader"))}}),e=async a=>new Promise((b,c)=>{try{let d=new FileReader;d.onerror=()=>c(Error("Failed to read file")),d.onload=d=>{try{let e=new Image;e.onerror=()=>c(Error("Failed to load image")),e.onload=()=>{try{let d=document.createElement("canvas");d.width=e.width,d.height=e.height;let f=d.getContext("2d");if(!f)return void c(Error("Could not get canvas context"));f.drawImage(e,0,0),d.toBlob(d=>{if(!d)return void c(Error("Could not process image"));let e=new File([d],a.name,{type:a.type,lastModified:Date.now()});b(e)},a.type,.95)}catch(a){console.error("Metadata removal canvas error:",a),c(Error("Failed to process image"))}},e.src=d.target?.result}catch(a){console.error("Metadata removal image error:",a),c(Error("Failed to load image"))}},d.readAsDataURL(a)}catch(a){console.error("Metadata removal setup error:",a),c(Error("Failed to setup file reader"))}});return{uploadProductImage:async b=>{try{if(!a||!b)return console.error("Missing userId or file for image upload"),null;if(!b.type.startsWith("image/"))return c({title:"Error",description:"Only image files are allowed.",variant:"destructive"}),null;if(b.size>0x1400000)return c({title:"Error",description:"Image file is too large. Maximum size is 20MB.",variant:"destructive"}),null;console.log("Starting image processing..."),c({title:"Processing Image",description:"Optimizing image to under 10KB..."});let f=await e(b),g=await d(f),h=g.size/1024;return console.log(`Final compressed size: ${h.toFixed(1)}KB`),console.warn("Image upload placeholder – integration with Prisma server action/storage required"),c({title:"Image Processed",description:`Image optimized to ${h.toFixed(1)}KB. Backend upload is pending migration.`}),new Promise(a=>{let b=new FileReader;b.onloadend=()=>a(b.result),b.readAsDataURL(g)})}catch(a){return console.error("Error uploading product image:",a),c({title:"Upload Error",description:"Failed to process image.",variant:"destructive"}),null}},compressImage:d,removeMetadata:e}}])},862838,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(747899),g=a.i(811705),h=a.i(396465),i=a.i(112779),j=a.i(397625),k=a.i(330281),l=a.i(688272),m=a.i(224993),n=a.i(169320),o=a.i(946032),p=a.i(455756),q=a.i(773681),r=a.i(311988),s=a.i(175794),t=a.i(914619),u=a.i(126741),v=a.i(531811),w=a.i(730086),x=a.i(799856),y=a.i(158799),z=a.i(393551),A=a.i(792071),B=a.i(366736),C=b([g,h,i,j,k,l,m,n,v,x,y,z,B]);[g,h,i,j,k,l,m,n,v,x,y,z,B]=C.then?(await C)():C,a.s(["default",0,({initialData:a,categories:b,onProductSubmit:c,isLoading:C})=>{let D=(0,f.useNavigate)(),{settings:E}=(0,m.useBusinessSettings)(),{user:F}=(0,v.useAuth)(),{uploadProductImage:G,compressImage:H}=(0,w.useProductImage)(F?.id),I=a=>a?{name:a.name,barcode:a.barcode||"",manufacturerBarcode:a.manufacturerBarcode||"",description:a.description||"",category:a.category,quantity:a.quantity??0,costPrice:a.costPrice,sellingPrice:a.sellingPrice,supplier:a.supplier||"",minimumStock:a.minimumStock,imageFile:null,imageUrl:a.imageUrl,createdAt:a.createdAt||new Date,printQuantity:1,autoPrintLabel:!1}:{name:"",barcode:"",manufacturerBarcode:"",description:"",category:"",quantity:0,costPrice:void 0,sellingPrice:void 0,supplier:"",minimumStock:void 0,imageFile:null,imageUrl:null,createdAt:new Date,autoPrintLabel:!0,printQuantity:1},[J,K]=(0,e.useState)(()=>I(a)),[L,M]=(0,e.useState)({}),[N,O]=(0,e.useState)(null),[P,Q]=(0,e.useState)(!1),[R,S]=(0,e.useState)(!1),[T,U]=(0,e.useState)(!1),[V,W]=(0,e.useState)(!1),[X,Y]=(0,e.useState)(null),[Z,$]=(0,e.useState)(!1),_=(0,e.useRef)(null);(0,e.useEffect)(()=>{if(a){console.log("ProductForm - Setting form data from initialData:",a),console.log("ProductForm - InitialData createdAt:",a.createdAt);let b=I(a);K(b),console.log("ProductForm - Form data set to:",b),console.log("ProductForm - Form createdAt set to:",b.createdAt),a.imageUrl&&O(a.imageUrl)}},[a]);let aa=a=>{let{name:b,value:c}=a.target,d=c;("quantity"===b||"minimumStock"===b||"costPrice"===b||"sellingPrice"===b)&&("quantity"===b?(d=""===c?"":parseFloat(c)||0,console.log("Quantity changed to:",d)):d=""===c?void 0:parseFloat(c)),K({...J,[b]:d}),L[b]&&M({...L,[b]:""})},ab=async a=>{if(a.size>0x1400000)return void n.toast.error("Image file is too large. Maximum size is 20MB.");if(!a.type.startsWith("image/"))return void n.toast.error("Only image files are allowed.");U(!0),Y(null);try{let b=await H(a),c=(a.size-b.size)/a.size*100;Y({originalSize:a.size,compressedSize:b.size,reduction:c}),K({...J,imageFile:b}),Q(!0);let d=new FileReader;d.onload=()=>{O(d.result)},d.readAsDataURL(b),n.toast.success(`Image optimized to ${(b.size/1024).toFixed(1)}KB!`)}catch(a){console.error("Error compressing image:",a),n.toast.error("Failed to process image. Please try again.")}finally{U(!1)}},ac=async a=>{let b;if(a.preventDefault(),console.log("ProductForm - Form data before validation:",J),console.log("ProductForm - Quantity value:",J.quantity,"Type:",typeof J.quantity),console.log("ProductForm - CreatedAt value:",J.createdAt),b={},J.name.trim()||(b.name="Product name is required"),void 0!==J.costPrice&&J.costPrice<0&&(b.costPrice="Cost price cannot be negative"),void 0!==J.sellingPrice&&J.sellingPrice<0&&(b.sellingPrice="Selling price cannot be negative"),void 0!==J.minimumStock&&J.minimumStock<0&&(b.minimumStock="Minimum stock cannot be negative"),M(b),0!==Object.keys(b).length)return void n.toast.error("Please correct the errors in the form");let d=J.imageUrl;try{if(P&&J.imageFile){if(S(!0),n.toast.info("Uploading optimized image..."),!(d=await G(J.imageFile)))return void S(!1);n.toast.success("Image uploaded successfully!")}else P&&!J.imageFile&&(d=null);let a="string"==typeof J.quantity?""===J.quantity?0:Number(J.quantity):J.quantity,b={...J,imageUrl:d,quantity:a};console.log("ProductForm - Final submission data:",b),console.log("ProductForm - Final quantity being submitted:",b.quantity),console.log("ProductForm - Final createdAt being submitted:",b.createdAt),await c(b)}catch(a){console.error("Error handling form submission:",a),n.toast.error("Something went wrong. Please try again.")}finally{S(!1)}},ad=C||R;return(0,d.jsxs)(g.Card,{className:"w-full",children:[(0,d.jsxs)(g.CardHeader,{children:[(0,d.jsx)(g.CardTitle,{children:a?"Edit Product":"New Product"}),(0,d.jsx)(g.CardDescription,{children:"Enter the product details below. Only name is required."})]}),(0,d.jsx)(g.CardContent,{children:(0,d.jsxs)("form",{onSubmit:ac,className:"space-y-6",children:[(0,d.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,d.jsxs)("div",{className:"space-y-6",children:[(0,d.jsxs)("div",{className:"grid gap-3",children:[(0,d.jsx)(j.Label,{htmlFor:"name",children:"Product Name*"}),(0,d.jsx)(i.Input,{id:"name",name:"name",value:J.name,onChange:aa,onKeyDown:a=>{if("Enter"===a.key){a.preventDefault();let b=document.querySelector('[role="combobox"]');b?.focus()}},placeholder:"Enter product name",className:L.name?"border-red-500":"",disabled:ad}),L.name&&(0,d.jsx)("p",{className:"text-red-500 text-xs",children:L.name})]}),(0,d.jsxs)("div",{className:"grid gap-3",children:[(0,d.jsx)(j.Label,{htmlFor:"manufacturerBarcode",children:"Manufacturer Barcode (Optional)"}),(0,d.jsx)(i.Input,{id:"manufacturerBarcode",name:"manufacturerBarcode",value:J.manufacturerBarcode,onChange:aa,onKeyDown:a=>{if("Enter"===a.key){a.preventDefault();let b=document.querySelector('[role="combobox"]');b?.focus()}},placeholder:"Enter manufacturer barcode (if any)",disabled:ad})]}),(0,d.jsxs)("div",{className:"grid gap-3",children:[(0,d.jsx)(j.Label,{htmlFor:"category",children:"Category (Optional)"}),(0,d.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Need to create a new category? Go to the"," ",(0,d.jsxs)(h.Button,{type:"button",variant:"link",className:"p-0 h-auto text-blue-600 underline",onClick:()=>D(`/categories?returnTo=${encodeURIComponent(window.location.pathname)}`),disabled:ad,children:["Categories page ",(0,d.jsx)(q.ExternalLink,{className:"h-3 w-3 ml-1 inline"})]})," ","first, then return here to select it."]}),(0,d.jsxs)(l.Select,{value:J.category,onValueChange:a=>{K({...J,category:a}),L.category&&M({...L,category:""}),setTimeout(()=>{document.getElementById("description")?.focus()},100)},disabled:ad,children:[(0,d.jsx)(l.SelectTrigger,{className:(0,x.cn)(L.category?"border-red-500":""),onKeyDown:a=>{if(console.log("SelectTrigger keydown:",a.key,"Category:",J.category),"Enter"===a.key)return a.preventDefault(),a.stopPropagation(),console.log("Enter pressed on SelectTrigger, focusing description"),setTimeout(()=>{let a=document.getElementById("description");console.log("Description field found:",!!a),a?.focus()},50),!1;"Escape"===a.key&&setTimeout(()=>{document.getElementById("description")?.focus()},50)},children:(0,d.jsx)(l.SelectValue,{placeholder:"Select category (optional)"})}),(0,d.jsx)(l.SelectContent,{children:b.length>0?b.map(a=>(0,d.jsx)(l.SelectItem,{value:a.name,children:a.name},a.id)):(0,d.jsx)("div",{className:"p-2 text-sm text-muted-foreground",children:"No categories available"})})]}),L.category&&(0,d.jsx)("p",{className:"text-red-500 text-xs",children:L.category})]}),(0,d.jsxs)("div",{className:"grid gap-3",children:[(0,d.jsx)(j.Label,{htmlFor:"description",children:"Description"}),(0,d.jsx)(k.Textarea,{id:"description",name:"description",value:J.description,onChange:aa,onKeyDown:a=>{"Enter"!==a.key||a.shiftKey||(a.preventDefault(),document.getElementById("supplier")?.focus())},placeholder:"Enter product description",className:"resize-none h-32",disabled:ad})]}),(0,d.jsxs)("div",{className:"grid gap-3",children:[(0,d.jsx)(j.Label,{htmlFor:"supplier",children:"Supplier"}),(0,d.jsx)(i.Input,{id:"supplier",name:"supplier",value:J.supplier,onChange:aa,onKeyDown:a=>{"Enter"===a.key&&(a.preventDefault(),document.getElementById("quantity")?.focus())},placeholder:"Enter supplier name",disabled:ad})]}),(0,d.jsxs)("div",{className:"grid gap-3",children:[(0,d.jsx)(j.Label,{children:"Created Date"}),(0,d.jsxs)(y.Popover,{open:Z,onOpenChange:$,children:[(0,d.jsx)(y.PopoverTrigger,{asChild:!0,children:(0,d.jsxs)(h.Button,{variant:"outline",className:(0,x.cn)("w-full justify-start text-left font-normal",!J.createdAt&&"text-muted-foreground",a&&"cursor-not-allowed opacity-60"),disabled:ad||!!a,children:[(0,d.jsx)(t.Calendar,{className:"mr-2 h-4 w-4"}),J.createdAt?(0,A.format)(J.createdAt,"PPP"):"Pick a date"]})}),(0,d.jsx)(y.PopoverContent,{className:"w-auto p-0",align:"start",children:(0,d.jsx)(z.Calendar,{mode:"single",selected:J.createdAt,onSelect:a=>{if(a){let b=new Date(a);b.setHours(12,0,0,0),console.log("ProductForm - Date changed to:",b),K({...J,createdAt:b}),$(!1)}},disabled:a=>a>new Date,initialFocus:!0})})]}),a&&(0,d.jsx)("div",{className:"bg-amber-50 border border-amber-200 p-3 rounded-lg",children:(0,d.jsxs)("div",{className:"text-amber-800 text-sm",children:[(0,d.jsx)("strong",{children:"Note:"})," To edit the creation date, please edit the initial stock history entry for this product through the inventory stock history."]})})]})]}),(0,d.jsxs)("div",{className:"space-y-6",children:[(0,d.jsxs)("div",{className:"grid gap-3",children:[(0,d.jsx)(j.Label,{htmlFor:"imageFile",children:"Product Image"}),(0,d.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[N?(0,d.jsxs)("div",{className:"relative w-full",children:[(0,d.jsx)("img",{src:N,alt:"Product preview",className:"w-full h-40 object-contain border rounded-md"}),(0,d.jsx)(h.Button,{type:"button",variant:"destructive",size:"icon",className:"absolute top-2 right-2 rounded-full h-8 w-8",onClick:()=>{K({...J,imageFile:null,imageUrl:null}),O(null),Q(!0),Y(null),_.current&&(_.current.value="")},disabled:ad||T,children:(0,d.jsx)(o.Trash2,{className:"h-4 w-4"})}),X&&(0,d.jsxs)("div",{className:"mt-2 p-2 bg-green-50 border border-green-200 rounded-md",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2 text-green-700",children:[(0,d.jsx)(s.Zap,{className:"h-4 w-4"}),(0,d.jsxs)("span",{className:"text-xs font-medium",children:["Optimized to ",(X.compressedSize/1024).toFixed(1),"KB"]})]}),(0,d.jsxs)("div",{className:"text-xs text-green-600 mt-1",children:[(X.originalSize/1024).toFixed(1),"KB → ",(X.compressedSize/1024).toFixed(1),"KB (",X.reduction.toFixed(1),"% reduction)"]})]})]}):(0,d.jsx)("div",{className:(0,x.cn)("border-2 border-dashed rounded-md p-8 w-full flex flex-col items-center justify-center cursor-pointer transition-colors",V?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400",(ad||T)&&"opacity-50 cursor-not-allowed"),onDragOver:a=>{a.preventDefault(),a.stopPropagation(),W(!0)},onDragLeave:a=>{a.preventDefault(),a.stopPropagation(),W(!1)},onDrop:a=>{if(a.preventDefault(),a.stopPropagation(),W(!1),a.dataTransfer.files&&a.dataTransfer.files.length>0){let b=a.dataTransfer.files[0];ab(b)}},onClick:ad||T?void 0:()=>{_.current?.click()},children:T?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(r.Loader2,{className:"h-10 w-10 text-blue-500 mb-2 animate-spin"}),(0,d.jsx)("p",{className:"text-sm text-gray-500",children:"Optimizing image..."}),(0,d.jsx)("p",{className:"text-xs text-gray-400",children:"Compressing to under 15KB"})]}):R?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(r.Loader2,{className:"h-10 w-10 text-blue-500 mb-2 animate-spin"}),(0,d.jsx)("p",{className:"text-sm text-gray-500",children:"Uploading image..."})]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(p.Upload,{className:"h-10 w-10 text-gray-400 mb-2"}),(0,d.jsx)("p",{className:"text-sm text-gray-500",children:"Click to upload or drag and drop"}),(0,d.jsx)("p",{className:"text-xs text-gray-400",children:"PNG, JPG, GIF up to 20MB"}),(0,d.jsx)("p",{className:"text-xs text-blue-500 mt-1",children:"⚡ Auto Image compression for instant loading"})]})}),(0,d.jsx)("input",{type:"file",id:"imageFile",ref:_,accept:"image/*",onChange:a=>{let b=a.target.files?.[0];b&&ab(b)},className:"hidden",disabled:ad||T})]})]}),(0,d.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{className:"grid gap-3",children:[(0,d.jsx)(j.Label,{htmlFor:"quantity",children:"Initial Stock"}),(0,d.jsx)(i.Input,{id:"quantity",name:"quantity",type:"number",step:"0.01",value:J.quantity,onChange:aa,onKeyDown:a=>{"Enter"===a.key&&(a.preventDefault(),document.getElementById("minimumStock")?.focus())},className:L.quantity?"border-red-500":"",disabled:ad,placeholder:"Enter initial stock quantity (can be negative)"}),L.quantity&&(0,d.jsx)("p",{className:"text-red-500 text-xs",children:L.quantity}),a&&(0,d.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Current stock: ",a.quantity," units"]})]}),(0,d.jsxs)("div",{className:"grid gap-3",children:[(0,d.jsx)(j.Label,{htmlFor:"minimumStock",children:"Minimum Stock Level"}),(0,d.jsx)(i.Input,{id:"minimumStock",name:"minimumStock",type:"number",min:"0",step:"0.01",value:void 0===J.minimumStock?"":J.minimumStock,onChange:aa,onKeyDown:a=>{"Enter"===a.key&&(a.preventDefault(),document.getElementById("costPrice")?.focus())},className:L.minimumStock?"border-red-500":"",disabled:ad}),L.minimumStock&&(0,d.jsx)("p",{className:"text-red-500 text-xs",children:L.minimumStock})]})]}),(0,d.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{className:"grid gap-3",children:[(0,d.jsx)(j.Label,{htmlFor:"costPrice",children:"Cost Price"}),(0,d.jsxs)("div",{className:"flex",children:[(0,d.jsx)("span",{className:"inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500",children:E.currency}),(0,d.jsx)(i.Input,{id:"costPrice",name:"costPrice",type:"number",min:"0",step:"0.01",value:void 0===J.costPrice?"":J.costPrice,onChange:aa,onKeyDown:a=>{"Enter"===a.key&&(a.preventDefault(),document.getElementById("sellingPrice")?.focus())},className:`rounded-l-none ${L.costPrice?"border-red-500":""}`,disabled:ad})]}),L.costPrice&&(0,d.jsx)("p",{className:"text-red-500 text-xs",children:L.costPrice})]}),(0,d.jsxs)("div",{className:"grid gap-3",children:[(0,d.jsx)(j.Label,{htmlFor:"sellingPrice",children:"Selling Price"}),(0,d.jsxs)("div",{className:"flex",children:[(0,d.jsx)("span",{className:"inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500",children:E.currency}),(0,d.jsx)(i.Input,{id:"sellingPrice",name:"sellingPrice",type:"number",min:"0",step:"0.01",value:void 0===J.sellingPrice?"":J.sellingPrice,onChange:aa,onKeyDown:a=>{if("Enter"===a.key){a.preventDefault();let b=document.querySelector('button[type="submit"]');b?.focus()}},className:`rounded-l-none ${L.sellingPrice?"border-red-500":""}`,disabled:ad})]}),L.sellingPrice&&(0,d.jsx)("p",{className:"text-red-500 text-xs",children:L.sellingPrice})]})]}),(0,d.jsx)("div",{className:"grid gap-3",children:(0,d.jsx)("p",{className:"text-sm text-gray-500",children:"* Required fields | Initial Stock: The starting quantity for this product"})})]})]}),(0,d.jsxs)("div",{className:"flex items-center justify-end space-x-4",children:[(0,d.jsx)(h.Button,{variant:"outline",type:"button",onClick:()=>D("/inventory"),disabled:ad||T,children:"Cancel"}),(0,d.jsx)(h.Button,{type:"submit",disabled:ad||T,className:"min-w-[100px]",children:T?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(r.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Optimizing..."]}):ad?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(r.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),R?"Uploading...":"Saving..."]}):a?"Update Product":"Create Product"})]}),!a&&(0,d.jsxs)("div",{className:"flex flex-col md:flex-row items-center justify-end gap-4 pt-3 border-t",children:[J.autoPrintLabel&&(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)(j.Label,{htmlFor:"printQuantity",className:"text-sm text-muted-foreground whitespace-nowrap",children:"Quantity to print:"}),(0,d.jsx)(i.Input,{id:"printQuantity",type:"number",min:"1",className:"w-20 h-8",value:J.printQuantity,onChange:a=>K(b=>({...b,printQuantity:parseInt(a.target.value)||1})),disabled:ad})]}),(0,d.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,d.jsx)(u.Printer,{className:"h-4 w-4 text-muted-foreground"}),(0,d.jsx)(j.Label,{htmlFor:"autoPrint",className:"text-sm font-medium cursor-pointer",children:"Auto-print barcode label"}),(0,d.jsx)(B.Switch,{id:"autoPrint",checked:J.autoPrintLabel,onCheckedChange:a=>K(b=>({...b,autoPrintLabel:a})),disabled:ad})]})]})]})})]})}]),c()}catch(a){c(a)}},!1),383476,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(747899),g=a.i(862838),h=a.i(531811),i=a.i(482331),j=a.i(985522),k=a.i(169320),l=a.i(396465),m=a.i(2026),n=a.i(506766),o=a.i(224993),p=a.i(799856),q=a.i(805297),r=a.i(289118),s=a.i(436028),t=b([g,h,i,j,k,l,o,p,q,r]);[g,h,i,j,k,l,o,p,q,r]=t.then?(await t)():t,a.s(["default",0,()=>{let{id:a}=(0,f.useParams)(),b=(0,f.useLocation)(),c=(0,f.useNavigate)(),{user:t}=(0,h.useAuth)(),{products:u,isLoading:v,createProduct:w,updateProduct:x,loadProducts:y,refetch:z}=(0,i.useProducts)(t?.id,1e4),{categories:A,isLoading:B}=(0,j.useCategories)(t?.id),[C,D]=(0,e.useState)(void 0),[E,F]=(0,e.useState)(!1),[G,H]=(0,e.useState)(null),[I,J]=(0,e.useState)(!1),[K,L]=(0,e.useState)(!1),{settings:M}=(0,o.useBusinessSettings)(),{hasPermission:N,isLoading:O}=(0,q.useProfiles)(),P=b.state?.duplicateData,Q=async()=>{if(a){J(!0),H(null);let{data:b}=await z(),c=(b?.products||[]).find(b=>b.id===a);c?(D(c),L(!0)):(H("Product not found. It may have been deleted or you may not have permission to view it."),k.toast.error("Product not found")),J(!1)}else L(!0)};(0,e.useEffect)(()=>{if(a&&u.length>0&&!K){let b=u.find(b=>b.id===a);b?(D(b),L(!0),H(null)):u.length>0&&(H("Product not found. It may have been deleted or you may not have permission to view it."),k.toast.error("Product not found"))}else a||L(!0)},[a,u.length,K]);let R=async()=>{k.toast.info("Refreshing product data..."),L(!1),await Q()},S=async b=>{F(!0);try{if(a&&C){let d={name:b.name,description:b.description||"",category:b.category||"",quantity:b.quantity,costPrice:b.costPrice??0,sellingPrice:b.sellingPrice??0,supplier:b.supplier||"",minimumStock:b.minimumStock??0,imageUrl:b.imageUrl||null,createdAt:b.createdAt,barcode:b.barcode,manufacturerBarcode:b.manufacturerBarcode};await x(a,d)?(k.toast.success("Product updated successfully"),c(`/inventory/${a}`)):k.toast.error("Failed to update product")}else{if(!t?.id)return void k.toast.error("You must be logged in to create products");let a={id:"",name:b.name,description:b.description||"",category:b.category||"",quantity:b.quantity,costPrice:b.costPrice??0,sellingPrice:b.sellingPrice??0,supplier:b.supplier||"",minimumStock:b.minimumStock??0,imageUrl:b.imageUrl||null,createdAt:b.createdAt||new Date,updatedAt:new Date,barcode:b.barcode||"",manufacturerBarcode:b.manufacturerBarcode||""},d=await w(a);if(d){if(k.toast.success("Product created successfully"),b.autoPrintLabel&&d.barcode)try{let a=b.printQuantity||1;k.toast.info(`Sending ${a} barcode label${a>1?"s":""} to printer...`),await fetch("http://localhost:5000/print/label",{method:"POST",headers:{"Content-Type":"application/json"},mode:"cors",body:JSON.stringify({PrinterName:M.defaultPrinterName||"Label Printer",Content:`SIZE 50 mm, 30 mm
GAP 3 mm, 0 mm
CLS
TEXT 15,20,"3",0,1,1,"${d.name}"
BARCODE 15,70,"128",60,1,0,2,2,"${d.barcode}"
TEXT 15,180,"3",0,1,1,"${M.currency} ${(0,p.formatNumber)(d.sellingPrice)}"
PRINT ${a}
`})}),k.toast.success("Barcode label printed")}catch(a){console.error("Failed to auto-print label:",a),k.toast.error("Failed to print label. Is the Printer Bridge running?")}c(`/inventory/${d.id}`)}else k.toast.error("Failed to create product")}}catch(a){console.error("Error submitting product:",a),k.toast.error("An error occurred while saving the product")}finally{F(!1)}},T=v||B||E||I,U=P?{...P,quantity:0,id:"",itemNumber:"",createdAt:new Date,updatedAt:new Date,barcode:"",manufacturerBarcode:""}:C,V=!a||N("inventory","edit"),W=!!a||N("inventory","create");return O||v||B?(0,d.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,d.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):V&&W?!a||K||G?(0,d.jsxs)("div",{className:"space-y-6",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)(l.Button,{variant:"outline",size:"sm",onClick:()=>c("/inventory"),className:"flex items-center gap-1",children:[(0,d.jsx)(m.ArrowLeft,{className:"h-4 w-4"})," Back to Inventory"]}),a&&(0,d.jsxs)(l.Button,{variant:"outline",size:"sm",onClick:R,disabled:T,className:"flex items-center gap-1",children:[(0,d.jsx)(n.RefreshCw,{className:`h-4 w-4 ${I?"animate-spin":""}`}),I?"Refreshing...":"Refresh Data"]})]}),G?(0,d.jsxs)("div",{className:"p-6 bg-red-50 border border-red-200 rounded-md",children:[(0,d.jsx)("h3",{className:"text-lg font-medium text-red-800 mb-2",children:"Error Loading Product"}),(0,d.jsx)("p",{className:"text-red-600",children:G}),(0,d.jsx)(l.Button,{className:"mt-4",onClick:()=>c("/inventory"),children:"Return to Inventory"})]}):(0,d.jsx)(g.default,{initialData:U,categories:A,onProductSubmit:S,isLoading:T})]}):(0,d.jsxs)("div",{className:"space-y-6",children:[(0,d.jsx)("div",{className:"flex items-center justify-between",children:(0,d.jsxs)(l.Button,{variant:"outline",size:"sm",onClick:()=>c("/inventory"),className:"flex items-center gap-1",children:[(0,d.jsx)(m.ArrowLeft,{className:"h-4 w-4"})," Back to Inventory"]})}),(0,d.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto mb-4"}),(0,d.jsx)("p",{className:"text-gray-600",children:"Loading product data..."})]})})]}):(0,d.jsxs)("div",{className:"max-w-4xl mx-auto p-6",children:[(0,d.jsxs)(r.Alert,{variant:"destructive",children:[(0,d.jsx)(s.AlertCircle,{className:"h-4 w-4"}),(0,d.jsx)(r.AlertTitle,{children:"Access Denied"}),(0,d.jsxs)(r.AlertDescription,{children:["You do not have permission to ",a?"edit this product":"create a new product",". Please contact your administrator if you believe this is an error."]})]}),(0,d.jsx)("div",{className:"mt-4",children:(0,d.jsx)(l.Button,{onClick:()=>c("/inventory"),variant:"outline",children:"Back to Inventory"})})]})}]),c()}catch(a){c(a)}},!1),218324,a=>a.a(async(b,c)=>{try{var d=a.i(579168),e=a.i(627068),f=a.i(332759),g=a.i(539141),h=a.i(706555),i=a.i(383476),j=a.i(509193),k=b([i]);[i]=k.then?(await k)():k;let l=(0,f.hoist)(i,"default"),m=(0,f.hoist)(i,"getStaticProps"),n=(0,f.hoist)(i,"getStaticPaths"),o=(0,f.hoist)(i,"getServerSideProps"),p=(0,f.hoist)(i,"config"),q=(0,f.hoist)(i,"reportWebVitals"),r=(0,f.hoist)(i,"unstable_getStaticProps"),s=(0,f.hoist)(i,"unstable_getStaticPaths"),t=(0,f.hoist)(i,"unstable_getStaticParams"),u=(0,f.hoist)(i,"unstable_getServerProps"),v=(0,f.hoist)(i,"unstable_getServerSideProps"),w=new d.PagesRouteModule({definition:{kind:e.RouteKind.PAGES,page:"/NewProduct",pathname:"/NewProduct",bundlePath:"",filename:""},distDir:".next",relativeProjectDir:"",components:{App:h.default,Document:g.default},userland:i}),x=(0,j.getHandler)({srcPage:"/NewProduct",config:p,userland:i,routeModule:w,getStaticPaths:n,getStaticProps:m,getServerSideProps:o});a.s(["config",0,p,"default",0,l,"getServerSideProps",0,o,"getStaticPaths",0,n,"getStaticProps",0,m,"handler",0,x,"reportWebVitals",0,q,"routeModule",0,w,"unstable_getServerProps",0,u,"unstable_getServerSideProps",0,v,"unstable_getStaticParams",0,t,"unstable_getStaticPaths",0,s,"unstable_getStaticProps",0,r]),c()}catch(a){c(a)}},!1)];

//# sourceMappingURL=_b8c2bb95._.js.map