module.exports=[120343,a=>a.a(async(b,c)=>{try{var d=a.i(150848),e=a.i(348287),f=b([d]);async function g(a,b){try{let c=await d.db.$transaction(async c=>{let d=await c.expense.create({data:{userId:a.userId,branchId:a.locationId,amount:a.amount,description:a.description,category:a.category||null,date:a.date,paymentMethod:a.paymentMethod||null,personInCharge:a.personInCharge||null,receiptImage:a.receiptImage||null,cashAccountId:b&&a.cashAccountId?a.cashAccountId:null}});if(b&&a.cashAccountId){let b=await c.cashTransaction.create({data:{userId:a.userId,branchId:a.locationId,accountId:a.cashAccountId,amount:a.amount,transactionType:"cash_out",category:a.category||"Expense",description:`Expense: ${a.description}`,personInCharge:a.personInCharge||null,date:a.date,paymentMethod:a.paymentMethod||null,receiptImage:a.receiptImage||null}});await c.expense.update({where:{id:d.id},data:{cashTransactionId:b.id}})}return d});return(0,e.revalidatePath)("/finance"),{success:!0,data:c}}catch(a){return console.error("Error creating expense:",a),{success:!1,error:a.message}}}async function h(a){try{let b=await d.db.expense.findMany({where:{branchId:a},orderBy:{date:"desc"}});return{success:!0,data:b.map(a=>({...a,created_at:a.createdAt.toISOString(),updated_at:a.updatedAt.toISOString(),payment_method:a.paymentMethod,person_in_charge:a.personInCharge,receipt_image:a.receiptImage,cash_account_id:a.cashAccountId,cash_transaction_id:a.cashTransactionId}))}}catch(a){return console.error("Error fetching expenses:",a),{success:!1,error:a.message}}}async function i(a,b,c){try{let f=await d.db.$transaction(async d=>{let e=await d.expense.update({where:{id:a},data:{amount:b.amount,description:b.description,category:b.category,date:b.date,paymentMethod:b.paymentMethod,personInCharge:b.personInCharge,receiptImage:b.receiptImage,cashAccountId:b.cashAccountId||null}}),f=!!b.cashAccountId,g=!!c.cashTransactionId;if(f&&!g){let e=await d.cashTransaction.create({data:{userId:c.userId,branchId:c.branchId||c.locationId,accountId:b.cashAccountId,amount:b.amount||c.amount,transactionType:"cash_out",category:b.category||c.category||"Expense",description:`Expense: ${b.description||c.description}`,personInCharge:b.personInCharge||c.personInCharge||null,date:b.date||c.date,paymentMethod:b.paymentMethod||c.paymentMethod||null,receiptImage:b.receiptImage||c.receiptImage||null}});await d.expense.update({where:{id:a},data:{cashTransactionId:e.id}})}else f&&g?await d.cashTransaction.update({where:{id:c.cashTransactionId},data:{accountId:b.cashAccountId,amount:b.amount||c.amount,category:b.category||c.category||"Expense",description:`Expense: ${b.description||c.description}`,personInCharge:b.personInCharge||c.personInCharge||null,date:b.date||c.date,paymentMethod:b.paymentMethod||c.paymentMethod||null,receiptImage:b.receiptImage||c.receiptImage||null}}):!f&&g&&(await d.cashTransaction.delete({where:{id:c.cashTransactionId}}),await d.expense.update({where:{id:a},data:{cashTransactionId:null}}));return e});return(0,e.revalidatePath)("/finance"),{success:!0,data:f}}catch(a){return console.error("Error updating expense:",a),{success:!1,error:a.message}}}async function j(a){try{return await d.db.$transaction(async b=>{let c=await b.expense.findUnique({where:{id:a},select:{cashTransactionId:!0}});c?.cashTransactionId&&await b.cashTransaction.delete({where:{id:c.cashTransactionId}}),await b.expense.delete({where:{id:a}})}),(0,e.revalidatePath)("/finance"),{success:!0}}catch(a){return console.error("Error deleting expense:",a),{success:!1,error:a.message}}}async function k(a){try{let b=await d.db.installmentPayment.findMany({where:{saleId:a},orderBy:{paymentDate:"desc"}});return{success:!0,data:b.map(a=>({id:a.id,saleId:a.saleId,userId:a.userId,amount:Number(a.amount),paymentDate:a.paymentDate.toISOString(),notes:a.notes,cashTransactionId:a.cashTransactionId,createdAt:a.createdAt.toISOString(),updatedAt:a.updatedAt.toISOString()}))}}catch(a){return console.error("Error fetching installment payments:",a),{success:!1,error:a.message}}}async function l(a){try{let b=await d.db.$transaction(async b=>{let c=a.cashTransactionId;if(a.accountId&&a.locationId&&!c){let d=await b.sale.findUnique({where:{id:a.saleId},select:{customerName:!0,receiptNumber:!0}}),e=d?`Installment payment for ${d.customerName} - Receipt #${d.receiptNumber}`:"Installment payment for sale";c=(await b.cashTransaction.create({data:{userId:a.userId,branchId:a.locationId,accountId:a.accountId,amount:a.amount,transactionType:"cash_in",category:"Installment payment",description:e,date:a.paymentDate?new Date(a.paymentDate):new Date}})).id}return await b.installmentPayment.create({data:{saleId:a.saleId,userId:a.userId,amount:a.amount,notes:a.notes,cashTransactionId:c,paymentDate:a.paymentDate?new Date(a.paymentDate):new Date}})});return(0,e.revalidatePath)("/finance"),{success:!0,data:b}}catch(a){return console.error("Error creating installment payment:",a),{success:!1,error:a.message}}}async function m(a,b){try{let c=await d.db.$transaction(async c=>{let d=await c.installmentPayment.findUnique({where:{id:a},select:{cashTransactionId:!0}});if(!d)throw Error("Payment not found");let e=await c.installmentPayment.update({where:{id:a},data:{amount:b.amount,notes:b.notes,paymentDate:b.paymentDate?new Date(b.paymentDate):void 0}});return d.cashTransactionId&&await c.cashTransaction.update({where:{id:d.cashTransactionId},data:{amount:b.amount,date:b.paymentDate?new Date(b.paymentDate):void 0}}),e});return(0,e.revalidatePath)("/finance"),{success:!0,data:c}}catch(a){return console.error("Error updating installment payment:",a),{success:!1,error:a.message}}}async function n(a){try{return await d.db.$transaction(async b=>{let c=await b.installmentPayment.findUnique({where:{id:a},select:{cashTransactionId:!0}});c?.cashTransactionId&&await b.cashTransaction.delete({where:{id:c.cashTransactionId}}),await b.installmentPayment.delete({where:{id:a}})}),(0,e.revalidatePath)("/finance"),{success:!0}}catch(a){return console.error("Error deleting installment payment:",a),{success:!1,error:a.message}}}async function o(a,b,c,f){try{let g=await d.db.$transaction(async d=>{let e=await d.installmentPayment.findUnique({where:{id:a},include:{sale:!0}});if(!e)throw Error("Payment not found");if(e.cashTransactionId)throw Error("Payment already linked");let g=e.sale?`Installment payment for ${e.sale.customerName} - Receipt #${e.sale.receiptNumber}`:`Installment payment #${a.substring(0,8)}`,h=await d.cashTransaction.create({data:{userId:f,branchId:c,accountId:b,amount:e.amount,transactionType:"cash_in",category:"Installment payment",description:g,date:e.paymentDate}});return await d.installmentPayment.update({where:{id:a},data:{cashTransactionId:h.id}}),h});return(0,e.revalidatePath)("/finance"),{success:!0,data:g}}catch(a){return console.error("Error linking installment to cash:",a),{success:!1,error:a.message}}}async function p(a){try{return await d.db.$transaction(async b=>{let c=await b.installmentPayment.findUnique({where:{id:a},select:{cashTransactionId:!0}});if(!c?.cashTransactionId)throw Error("Payment not linked");await b.cashTransaction.delete({where:{id:c.cashTransactionId}}),await b.installmentPayment.update({where:{id:a},data:{cashTransactionId:null}})}),(0,e.revalidatePath)("/finance"),{success:!0}}catch(a){return console.error("Error unlinking installment from cash:",a),{success:!1,error:a.message}}}async function q(a){try{let b=await d.db.expenseCategory.findMany({where:{branchId:a},orderBy:[{isDefault:"desc"},{name:"asc"}]});return{success:!0,data:b.map(a=>({id:a.id,name:a.name,isDefault:a.isDefault,createdAt:a.createdAt.toISOString()}))}}catch(a){return console.error("Error fetching expense categories:",a),{success:!1,error:a.message}}}async function r(a){try{let b=await d.db.expenseCategory.create({data:{userId:a.userId,branchId:a.locationId,name:a.name,isDefault:a.isDefault||!1}});return(0,e.revalidatePath)("/finance"),{success:!0,data:b}}catch(a){return console.error("Error creating expense category:",a),{success:!1,error:a.message}}}async function s(a){try{return await d.db.expenseCategory.delete({where:{id:a}}),(0,e.revalidatePath)("/finance"),{success:!0}}catch(a){return console.error("Error deleting expense category:",a),{success:!1,error:a.message}}}async function t(a,b,c){try{let f=c.map(c=>({userId:a,branchId:b,name:c,isDefault:!0}));return await d.db.expenseCategory.createMany({data:f,skipDuplicates:!0}),(0,e.revalidatePath)("/finance"),{success:!0}}catch(a){return console.error("Error creating default categories:",a),{success:!1,error:a.message}}}async function u(a){try{let b=await d.db.cashAccount.findMany({where:{branchId:a},orderBy:[{isDefault:"desc"},{name:"asc"}]});return{success:!0,data:b.map(a=>({id:a.id,name:a.name,description:a.description,openingBalance:Number(a.initialBalance),isDefault:a.isDefault,createdAt:a.createdAt.toISOString(),updatedAt:a.updatedAt.toISOString()}))}}catch(a){return console.error("Error fetching cash accounts:",a),{success:!1,error:a.message}}}async function v(a){try{let b=await d.db.cashAccount.create({data:{userId:a.userId,branchId:a.locationId,name:a.name,description:a.description||null,initialBalance:a.openingBalance||0,isDefault:a.isDefault||!1}});return(0,e.revalidatePath)("/finance"),{success:!0,data:b}}catch(a){return console.error("Error creating cash account:",a),{success:!1,error:a.message}}}async function w(a,b){try{let c=await d.db.cashAccount.update({where:{id:a},data:{name:b.name,description:b.description,initialBalance:b.openingBalance,isDefault:b.isDefault}});return(0,e.revalidatePath)("/finance"),{success:!0,data:c}}catch(a){return console.error("Error updating cash account:",a),{success:!1,error:a.message}}}async function x(a,b){try{let c=await d.db.$transaction(async c=>{let d=await c.cashTransaction.count({where:{accountId:a,branchId:b}}),e=await c.expense.count({where:{cashAccountId:a,branchId:b}});return d>0||e>0?{success:!1,hasTransactions:!0,details:`Account has ${d} transactions and ${e} expenses.`}:(await c.cashAccount.delete({where:{id:a,locationId:b}}),{success:!0,hasTransactions:!1})});return(0,e.revalidatePath)("/finance"),c}catch(a){return console.error("Error deleting cash account:",a),{success:!1,error:a.message}}}async function y(a,b,c){try{return await d.db.$transaction(async d=>{c?await d.cashTransaction.deleteMany({where:{accountId:a,branchId:b}}):await d.cashTransaction.updateMany({where:{accountId:a,branchId:b},data:{accountId:null}}),await d.expense.updateMany({where:{cashAccountId:a,branchId:b},data:{cashAccountId:null,cashTransactionId:null}}),await d.cashAccount.delete({where:{id:a,branchId:b}})}),(0,e.revalidatePath)("/finance"),{success:!0}}catch(a){return console.error("Error deleting cash account with transactions:",a),{success:!1,error:a.message}}}async function z(a,b){try{let c=await d.db.cashAccount.findUnique({where:{id:a},select:{initialBalance:!0}});if(!c)return{success:!1,error:"Account not found"};let e=await d.db.cashTransaction.findMany({where:{accountId:a,branchId:b},select:{amount:!0,transactionType:!0}}),f=Number(c.initialBalance);for(let a of e){let b=Number(a.amount);"cash_in"===a.transactionType||"transfer_in"===a.transactionType?f+=b:("cash_out"===a.transactionType||"transfer_out"===a.transactionType)&&(f-=b)}return{success:!0,data:f}}catch(a){return console.error("Error calculating account balance:",a),{success:!1,error:a.message}}}async function A(a,b){try{let c={branchId:a};b&&(c.accountId=b);let e=await d.db.cashTransaction.findMany({where:c,orderBy:[{date:"desc"},{createdAt:"desc"}]});return{success:!0,data:e.map(a=>({...a,created_at:a.createdAt.toISOString(),updated_at:a.updatedAt.toISOString(),user_id:a.userId,account_id:a.accountId,location_id:a.locationId,transaction_type:a.transactionType,person_in_charge:a.personInCharge,payment_method:a.paymentMethod,receipt_image:a.receiptImage}))}}catch(a){return console.error("Error fetching cash transactions:",a),{success:!1,error:a.message}}}async function B(a){try{let b=await d.db.$transaction(async b=>{if("transfer"!==a.transactionType||!a.toAccountId)return await b.cashTransaction.create({data:{userId:a.userId,branchId:a.locationId,accountId:a.accountId,amount:a.amount,transactionType:a.transactionType,category:a.category,description:a.description,personInCharge:a.personInCharge,tags:a.tags,date:a.date?new Date(a.date):new Date,paymentMethod:a.paymentMethod,receiptImage:a.receiptImage}});{let c=await b.cashTransaction.create({data:{userId:a.userId,locationId:a.locationId,accountId:a.accountId,amount:a.amount,transactionType:"transfer_out",description:a.description,date:a.date?new Date(a.date):new Date,category:a.category||"Transfer"}}),d=await b.cashTransaction.create({data:{userId:a.userId,locationId:a.locationId,accountId:a.toAccountId,amount:a.amount,transactionType:"transfer_in",description:a.description,date:a.date?new Date(a.date):new Date,category:a.category||"Transfer"}});return[c,d]}});return(0,e.revalidatePath)("/finance"),{success:!0,data:b}}catch(a){return console.error("Error creating cash transaction:",a),{success:!1,error:a.message}}}async function C(a,b){try{let c=await d.db.cashTransaction.update({where:{id:a},data:{accountId:b.accountId,amount:b.amount,transactionType:b.transactionType,category:b.category,description:b.description,personInCharge:b.personInCharge,tags:b.tags,date:b.date?new Date(b.date):void 0,paymentMethod:b.paymentMethod,receiptImage:b.receiptImage}});return(0,e.revalidatePath)("/finance"),{success:!0,data:c}}catch(a){return console.error("Error updating cash transaction:",a),{success:!1,error:a.message}}}async function D(a){try{let b=await d.db.cashTransaction.findUnique({where:{id:a},select:{accountId:!0}});return{success:!0,data:b}}catch(a){return console.error("Error finding cash transaction:",a),{success:!1,error:a.message}}}async function E(a,b){try{return await d.db.$transaction(async c=>{await c.installmentPayment.updateMany({where:{cashTransactionId:a},data:{cashTransactionId:null}}),await c.cashTransaction.delete({where:{id:a,branchId:b}})}),(0,e.revalidatePath)("/finance"),{success:!0}}catch(a){return console.error("Error deleting cash transaction:",a),{success:!1,error:a.message}}}async function F(a,b){try{let c=await d.db.cashAccount.findFirst({where:{id:a,branchId:b},select:{initialBalance:!0}});return{success:!0,data:Number(c?.initialBalance||0)}}catch(a){return console.error("Error fetching opening balance:",a),{success:!1,error:a.message}}}async function G(a){try{let b=await d.db.$transaction(async b=>{let c=[];for(let d of a)"transfer"===d.transactionType&&d.toAccountId?(c.push(await b.cashTransaction.create({data:{userId:d.userId,branchId:d.locationId,accountId:d.accountId,amount:d.amount,transactionType:"transfer_out",description:d.description,date:d.date?new Date(d.date):new Date,category:d.category||"Transfer"}})),c.push(await b.cashTransaction.create({data:{userId:d.userId,branchId:d.locationId,accountId:d.toAccountId,amount:d.amount,transactionType:"transfer_in",description:d.description,date:d.date?new Date(d.date):new Date,category:d.category||"Transfer"}}))):c.push(await b.cashTransaction.create({data:{userId:d.userId,branchId:d.locationId,accountId:d.accountId,amount:d.amount,transactionType:d.transactionType,category:d.category,description:d.description,personInCharge:d.personInCharge,tags:d.tags,date:d.date?new Date(d.date):new Date,paymentMethod:d.paymentMethod,receiptImage:d.receiptImage}}));return c});return(0,e.revalidatePath)("/finance"),{success:!0,data:b}}catch(a){return console.error("Error creating bulk transactions:",a),{success:!1,error:a.message}}}[d]=f.then?(await f)():f,a.s(["createBulkCashTransactionsAction",()=>G,"createCashAccountAction",()=>v,"createCashTransactionAction",()=>B,"createDefaultExpenseCategoriesAction",()=>t,"createExpenseAction",()=>g,"createExpenseCategoryAction",()=>r,"createInstallmentPaymentAction",()=>l,"deleteCashAccountAction",()=>x,"deleteCashAccountWithTransactionsAction",()=>y,"deleteCashTransactionAction",()=>E,"deleteExpenseAction",()=>j,"deleteExpenseCategoryAction",()=>s,"deleteInstallmentPaymentAction",()=>n,"findCashTransactionAction",()=>D,"getAccountOpeningBalanceAction",()=>F,"getCashAccountBalanceAction",()=>z,"getCashAccountsAction",()=>u,"getCashTransactionsAction",()=>A,"getExpenseCategoriesAction",()=>q,"getExpensesAction",()=>h,"getInstallmentPaymentsAction",()=>k,"linkInstallmentToCashAction",()=>o,"unlinkInstallmentFromCashAction",()=>p,"updateCashAccountAction",()=>w,"updateCashTransactionAction",()=>C,"updateExpenseAction",()=>i,"updateInstallmentPaymentAction",()=>m]),c()}catch(a){c(a)}},!1)];

//# sourceMappingURL=src_app_actions_finance_ts_c3b975f8._.js.map