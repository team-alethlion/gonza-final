module.exports=[349774,a=>{"use strict";var b=a.i(391956);a.s(["useCurrentUser",0,()=>{let{user:a}=(0,b.useAuth)();return{userId:a?.id}}])},104720,a=>{"use strict";let b=(0,a.i(170106).default)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);a.s(["FileText",()=>b],104720)},866102,a=>{"use strict";var b=a.i(572131),c=a.i(433217),d=a.i(478793),e=a.i(169819),f=a.i(405050);let g=(0,f.createServerReference)("40290a4fc6b8571a026afeb877566edb807919e482",f.callServer,void 0,f.findSourceMapURL,"getBusinessSettingsAction");var h=a.i(682242);let i=()=>({businessName:"",businessAddress:"",businessPhone:"",businessEmail:"",currency:"UGX",paymentInfo:"",defaultPrintFormat:"standard"});a.s(["convertPaymentMethodsToString",0,a=>a.filter(a=>""!==a.method.trim()||""!==a.accountNumber.trim()||""!==a.accountName.trim()).map(a=>`${a.method}
${a.accountNumber}
${a.accountName}`).join("\n"),"parsePaymentInfo",0,a=>{if(!a||""===a.trim())return[];let b=a.split("\n").filter(a=>""!==a.trim()),c=[];for(let a=0;a<b.length;a+=3)a+2<b.length&&c.push({method:b[a].trim(),accountNumber:b[a+1].trim(),accountName:b[a+2].trim()});return c},"useBusinessSettings",0,()=>{let[a,f]=(0,b.useState)(i()),[j,k]=(0,b.useState)(!1),{toast:l}=(0,d.useToast)(),{currentBusiness:m}=(0,e.useBusiness)(),n=async()=>{if(!m)return i();try{let a=await g(m.id);if(!a)return i();{let b=a.metadata&&"object"==typeof a.metadata&&a.metadata.payment_info||"";return{id:a.id,businessName:a.business_name||"",businessAddress:a.business_address||"",businessPhone:a.business_phone||"",businessEmail:a.business_email||"",businessLogo:a.business_logo||void 0,currency:a.currency||"UGX",signature:a.signature||void 0,paymentInfo:b,defaultPrintFormat:a.metadata&&"object"==typeof a.metadata&&a.metadata.default_print_format||"standard",defaultPrinterName:a.metadata&&"object"==typeof a.metadata&&a.metadata.default_printer_name||"",defaultPrinterType:a.metadata&&"object"==typeof a.metadata&&a.metadata.default_printer_type||"USB",printerPaperSize:a.metadata&&"object"==typeof a.metadata&&a.metadata.printer_paper_size||"58mm"}}}catch(a){return console.error("Error loading business settings:",a),l({title:"Error",description:"Failed to load business settings. Please try again.",variant:"destructive"}),i()}},o=async b=>{if(!m)return console.error("No business selected for updating settings"),l({title:"Error",description:"No business selected",variant:"destructive"}),!1;try{let c={payment_info:b.hasOwnProperty("paymentInfo")?b.paymentInfo:a.paymentInfo||"",default_print_format:b.hasOwnProperty("defaultPrintFormat")?b.defaultPrintFormat:a.defaultPrintFormat||"standard",default_printer_name:b.hasOwnProperty("defaultPrinterName")?b.defaultPrinterName:a.defaultPrinterName||"",default_printer_type:b.hasOwnProperty("defaultPrinterType")?b.defaultPrinterType:a.defaultPrinterType||"USB",printer_paper_size:b.hasOwnProperty("printerPaperSize")?b.printerPaperSize:a.printerPaperSize||"58mm"},d={business_name:b.hasOwnProperty("businessName")?b.businessName:a.businessName,business_address:b.hasOwnProperty("businessAddress")?b.businessAddress:a.businessAddress,business_phone:b.hasOwnProperty("businessPhone")?b.businessPhone:a.businessPhone,business_email:b.hasOwnProperty("businessEmail")?b.businessEmail:a.businessEmail,business_logo:b.hasOwnProperty("businessLogo")?b.businessLogo:a.businessLogo,currency:b.hasOwnProperty("currency")?b.currency:a.currency,signature:b.hasOwnProperty("signature")?b.signature:a.signature,metadata:c},e=await (0,h.upsertBusinessSettingsAction)(m.id,"00000000-0000-0000-0000-000000000000",d);if(!e.success)throw console.error("Supabase error updating business settings:",e.error),Error(e.error);return l({title:"Success",description:"Business settings updated successfully"}),s(),!0}catch(a){return console.error("Error updating business settings:",a),l({title:"Error",description:"Failed to update business settings. Please try again.",variant:"destructive"}),!1}},{data:p,isLoading:q,isFetching:r,refetch:s}=(0,c.useQuery)({queryKey:["businessSettings",m?.id],queryFn:n,enabled:!!m?.id,staleTime:3e5,gcTime:18e5,refetchOnWindowFocus:!1,refetchOnReconnect:!1});return(0,b.useEffect)(()=>{p?f(p):m||f(i())},[p,m]),(0,b.useEffect)(()=>{k(q||r)},[q,r]),{settings:a,isLoading:j,updateSettings:o,loadSettings:n}}],866102)},3048,(a,b,c)=>{let d=Error("Could not parse module '[project]/src/app/actions/products.ts'\n\n'import', and 'export' cannot be used outside of module code");throw d.code="MODULE_UNPARSABLE",d},347778,282141,a=>{"use strict";var b=a.i(572131),c=a.i(866102),d=a.i(169819),e=a.i(433217),f=a.i(937927);let g=a=>{};a.s(["clearInventoryCaches",0,g],282141);var h=a.i(3048);a.s(["useProducts",0,(a,i=50)=>{let[j,k]=(0,b.useState)([]),[l,m]=(0,b.useState)(1),[n,o]=(0,b.useState)(i),[p,q]=(0,b.useState)(0),[r,s]=(0,b.useState)(!1),{settings:t}=(0,c.useBusinessSettings)(),{currentBusiness:u}=(0,d.useBusiness)(),v=(0,f.useQueryClient)(),[w,x]=(0,b.useState)({search:"",category:"all",stockStatus:"all"}),[y,z]=(0,b.useState)(null),A=(0,b.useCallback)(a=>{a.search!==w.search&&(s(!0),y&&clearTimeout(y),z(setTimeout(()=>{s(!1)},600))),x(a)},[w.search,y]),B=(0,b.useCallback)(async()=>{if(!a||!u)return{products:[],count:0};try{return await (0,h.getProductsAction)({userId:a,businessId:u.id,page:l,pageSize:n,search:w.search,category:"all"===w.category?void 0:w.category,stockStatus:w.stockStatus})}catch(a){return console.error("Error loading products from server action:",a),{products:[],count:0}}},[a,u?.id,l,n,w.search,w.category,w.stockStatus]),C=(0,b.useMemo)(()=>["products",a,u?.id],[a,u?.id]),D=(0,b.useMemo)(()=>[...C,l,n,w.search,w.category,w.stockStatus],[C,l,n,w.search,w.category,w.stockStatus]),{data:E,isLoading:F,isFetching:G,refetch:H}=(0,e.useQuery)({queryKey:D,queryFn:B,enabled:!!a&&!!u?.id,staleTime:3e4,gcTime:18e5,refetchOnWindowFocus:!0,refetchOnReconnect:!0});(0,b.useEffect)(()=>{E&&(k(E.products),q(E.count))},[E]);let I=async b=>{try{if(!a)return null;return console.warn("Image upload redirecting to server action (TODO)"),null}catch(a){return console.error("Error in uploadProductImage:",a),null}};return{products:j,isLoading:F&&!E&&!r,loadProducts:B,page:l,setPage:m,pageSize:n,setPageSize:o,totalCount:p,createProduct:async b=>{try{if(!a||!u)return null;let c=await (0,h.createProductAction)({...b,userId:a,businessId:u.id});if(!c)return null;return k(a=>[c,...a]),q(a=>a+1),v.invalidateQueries({queryKey:C}),g(v),c}catch(a){return console.error("Error creating product:",a),null}},updateProduct:async(b,c,d,e=!1,f,i,j,k)=>{try{if(!a||!u)return!1;let i=c.imageUrl;if(d&&(i=await I(d)),!await (0,h.updateProductAction)(b,{...c,imageUrl:i,userId:a,businessId:u.id,isFromSale:e,customChangeReason:f,referenceId:j}))return!1;return v.invalidateQueries({queryKey:C}),g(v),!0}catch(a){return console.error("Error updating product:",a),!1}},updateProductsBulk:async(b,c,d,e,f,i)=>{try{if(!a||!u)return!1;let c=await (0,h.updateProductsBulkAction)(b.map(a=>({id:a.id,updated:a.updated})),u.id);return c&&(v.invalidateQueries({queryKey:C}),g(v)),c}catch(a){return console.error("Error in bulk update:",a),!1}},deleteProduct:async b=>{try{if(!a)return!1;if(await (0,h.deleteProductAction)(b))return v.invalidateQueries({queryKey:C}),g(v),!0;return!1}catch(a){return console.error("Error deleting product:",a),!1}},uploadProductImage:I,refetch:H,isFetching:G,filters:w,setFilters:A}}],347778)},355442,a=>{"use strict";let b=(0,a.i(170106).default)("Quote",[["path",{d:"M16 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"rib7q0"}],["path",{d:"M5 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"1ymkrd"}]]);a.s(["Quote",()=>b],355442)},579659,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(665967),e=a.i(890914),f=a.i(699570),g=a.i(669520),h=a.i(770094);let i=({onUpdate:a,isUpdating:c})=>{let d=(0,h.useIsMobile)();return(0,b.jsx)("div",{className:`${d?"mb-3":"mb-4"} w-full`,children:(0,b.jsxs)(f.Button,{onClick:a,disabled:c,className:`
          w-full bg-orange-500 hover:bg-orange-600 text-white font-semibold
          ${d?"h-10 text-sm":"h-12 text-base"}
          transition-all duration-200 shadow-md hover:shadow-lg
          ${c?"opacity-75":""}
        `,children:[(0,b.jsx)(g.RefreshCw,{className:`${d?"h-4 w-4":"h-5 w-5"} mr-2 ${c?"animate-spin":""}`}),c?"UPDATING APP...":"NEW FEATURES AVAILABLE, UPDATE APP"]})})};var j=a.i(333140);let k=()=>(0,b.jsxs)("div",{className:"space-y-4 animate-fade-in",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("div",{children:(0,b.jsx)(j.Skeleton,{className:"h-6 md:h-8 w-32 md:w-48 mb-2"})}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(j.Skeleton,{className:"h-8 w-8 md:h-9 md:w-9"}),(0,b.jsx)(j.Skeleton,{className:"h-8 w-16 md:h-9 md:w-24"})]})]}),(0,b.jsx)("div",{className:"grid grid-cols-1 gap-2 md:grid-cols-2 lg:grid-cols-4 max-w-4xl",children:[void 0,void 0,void 0,void 0].map((a,c)=>(0,b.jsx)(j.Skeleton,{className:"h-10 md:h-12"},c))}),(0,b.jsx)("div",{className:"grid gap-4 grid-cols-2 lg:grid-cols-3 xl:grid-cols-6",children:[...Array(6)].map((a,c)=>(0,b.jsx)(j.Skeleton,{className:"h-24 md:h-32"},c))}),(0,b.jsxs)("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[(0,b.jsx)("div",{className:"xl:col-span-2",children:(0,b.jsx)(j.Skeleton,{className:"h-64 md:h-80"})}),(0,b.jsx)("div",{className:"xl:col-span-1",children:(0,b.jsx)(j.Skeleton,{className:"h-64 md:h-80"})})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Skeleton,{className:"h-6 w-32"}),[void 0,void 0,void 0,void 0,void 0].map((a,c)=>(0,b.jsx)(j.Skeleton,{className:"h-12"},c))]})]});var l=a.i(915618);let m=({pageTitle:a,isRefreshing:c,isLoading:e,onRefresh:i})=>{let j=(0,d.useNavigate)(),k=(0,h.useIsMobile)();return(0,b.jsxs)("div",{className:`flex justify-between items-center ${k?"mb-4":"mb-6"}`,children:[(0,b.jsx)("h1",{className:`${k?"text-xl":"text-3xl"} font-bold text-sales-dark truncate`,children:a}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)("div",{className:"flex flex-col items-center",children:[(0,b.jsxs)(f.Button,{onClick:i,variant:"outline",size:k?"sm":"icon",disabled:c||e,className:"relative",title:"Update app for latest features and data",children:[(0,b.jsx)(g.RefreshCw,{className:`h-4 w-4 ${c?"animate-spin":""}`}),(0,b.jsx)("span",{className:"sr-only",children:"Update app"})]}),(0,b.jsx)("span",{className:"text-xs text-gray-500 mt-1 hidden md:block",children:"Update App"})]}),(0,b.jsxs)(f.Button,{onClick:()=>j("/new-sale"),className:"gap-2",size:k?"sm":"default",children:[(0,b.jsx)(l.Plus,{size:16}),!k&&"New Sale"]})]})]})};var n=a.i(501199),o=a.i(104720),p=a.i(355442),q=a.i(911156);let r=({onQuickCreate:a})=>{let c=(0,h.useIsMobile)();return(0,b.jsx)("div",{className:`${c?"mb-4":"mb-6"}`,children:(0,b.jsxs)("div",{className:`grid ${c?"grid-cols-2 gap-2":"grid-cols-2 lg:grid-cols-4 gap-4"} max-w-4xl`,children:[(0,b.jsxs)(f.Button,{onClick:()=>a("Paid"),variant:"outline",className:`gap-2 ${c?"h-10 text-xs":"h-12"} justify-start`,children:[(0,b.jsx)(n.Receipt,{className:"h-4 w-4 text-green-600"}),(0,b.jsx)("span",{children:c?"Receipt":"Create Receipt"})]}),(0,b.jsxs)(f.Button,{onClick:()=>a("NOT PAID"),variant:"outline",className:`gap-2 ${c?"h-10 text-xs":"h-12"} justify-start`,children:[(0,b.jsx)(o.FileText,{className:"h-4 w-4 text-orange-600"}),(0,b.jsx)("span",{children:c?"Invoice":"Create Invoice"})]}),(0,b.jsxs)(f.Button,{onClick:()=>a("Installment Sale"),variant:"outline",className:`gap-2 ${c?"h-10 text-xs":"h-12"} justify-start`,children:[(0,b.jsx)(q.CreditCard,{className:"h-4 w-4 text-purple-600"}),(0,b.jsx)("span",{children:c?"Installment":"Create Installment Sale"})]}),(0,b.jsxs)(f.Button,{onClick:()=>a("Quote"),variant:"outline",className:`gap-2 ${c?"h-10 text-xs":"h-12"} justify-start`,children:[(0,b.jsx)(p.Quote,{className:"h-4 w-4 text-blue-600"}),(0,b.jsx)("span",{children:c?"Quote":"Create Quotation"})]})]})})};var s=a.i(357999),t=a.i(591119),u=a.i(321161);let v=()=>(0,b.jsxs)(t.Card,{className:"mb-6 border-primary/20 shadow-sm",children:[(0,b.jsxs)(t.CardHeader,{className:"pb-3",children:[(0,b.jsx)(t.CardTitle,{className:"text-xl text-sales-primary",children:"Setup Your Business Details First"}),(0,b.jsx)(t.CardDescription,{children:"Set up your business details to personalize your sales records and receipts"})]}),(0,b.jsx)(t.CardContent,{children:(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Adding your business name, contact information, and preferred currency will ensure your sales records and customer receipts display your correct business information."})}),(0,b.jsx)(t.CardFooter,{className:"flex justify-center",children:(0,b.jsx)(f.Button,{asChild:!0,variant:"secondary",className:"gap-2",children:(0,b.jsxs)(s.Link,{to:"/settings",children:[(0,b.jsx)(u.Settings,{size:16}),"Configure Settings"]})})})]}),w=()=>{let a=(0,d.useNavigate)(),c=(0,h.useIsMobile)();return(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-4 md:p-6 lg:p-8 text-center",children:[(0,b.jsx)(v,{}),(0,b.jsx)("h2",{className:"text-lg md:text-xl lg:text-2xl font-semibold text-sales-primary mb-4",children:"Welcome to Your Sales Tracker"}),(0,b.jsx)("p",{className:"text-gray-600 mb-4 md:mb-6 lg:mb-8 max-w-lg mx-auto text-sm md:text-base",children:"Start by creating your first sale record. Once you have sales data, you'll see analytics and insights here on your dashboard."}),(0,b.jsxs)(f.Button,{onClick:()=>a("/new-sale"),size:c?"default":"lg",className:"gap-2",children:[(0,b.jsx)(l.Plus,{size:18})," Record Your First Sale"]})]})};var x=a.i(391956),y=a.i(169819),z=a.i(866102),A=a.i(737139),B=a.i(565258),C=a.i(478793);let D=(0,c.lazy)(()=>a.A(24357));a.s(["default",0,()=>{let{hasPermission:a,isLoading:f}=(0,e.useProfiles)();(0,d.useNavigate)();let{businessError:g,settings:h,sales:j,pageTitle:l,nonQuoteSalesCount:n,isLoading:o,updateAvailable:p,isUpdating:q,triggerUpdate:s}=(()=>{let{user:a}=(0,x.useAuth)(),{isLoading:b,error:d,currentBusiness:e}=(0,y.useBusiness)(),{settings:f,isLoading:g}=(0,z.useBusinessSettings)(),{sales:h,isLoading:i}=(0,A.useSalesData)(a?.id,"desc"),{updateAvailable:j,isUpdating:k,triggerUpdate:l}=(0,B.useAppUpdate)(),m=(0,c.useMemo)(()=>f.businessName&&"Your Business Name"!==f.businessName?f.businessName:"Dashboard",[f.businessName]),n=(0,c.useMemo)(()=>h.length?h.filter(a=>"Quote"!==a.paymentStatus).length:0,[h]);return{user:a,businessError:d,currentBusiness:e,settings:f,sales:h,pageTitle:m,nonQuoteSalesCount:n,isLoading:(0,c.useMemo)(()=>i||g||b,[i,g,b]),updateAvailable:j,isUpdating:k,triggerUpdate:l}})(),{isRefreshing:t,handleRefresh:u,handleQuickCreate:v}=(()=>{let a=(0,d.useNavigate)(),{toast:b}=(0,C.useToast)(),[e,f]=(0,c.useState)(!1);return{isRefreshing:e,handleRefresh:(0,c.useCallback)(async()=>{f(!0),b({title:"Updating app",description:"Getting the latest updates and refreshing data..."});try{if("caches"in window){let a=await caches.keys();await Promise.all(a.map(a=>caches.delete(a)))}sessionStorage.clear(),setTimeout(()=>{window.location.reload()},800)}catch(a){console.error("Error during app update:",a),f(!1),b({title:"Update failed",description:"There was an error updating the app. Please try again.",variant:"destructive"})}},[b]),handleQuickCreate:(0,c.useCallback)(b=>{a("/new-sale",{state:{defaultPaymentStatus:b}})},[a])}})();if(f||o)return(0,b.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,b.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})});let E=!o&&0===n;return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(m,{pageTitle:l,isRefreshing:t,isLoading:o,onRefresh:u}),p&&(0,b.jsx)(i,{onUpdate:s,isUpdating:q}),(0,b.jsx)(r,{onQuickCreate:v}),E?(0,b.jsx)(w,{}):(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)(k,{}),children:(0,b.jsx)(D,{sales:j,currency:h.currency})})]})}],579659)},24357,a=>{a.v(b=>Promise.all(["server/chunks/ssr/node_modules_60112447._.js","server/chunks/ssr/node_modules_recharts_es6_chart_BarChart_1333a6d1.js","server/chunks/ssr/node_modules_date-fns_fb6a3a23._.js","server/chunks/ssr/node_modules_ff679ca3._.js","server/chunks/ssr/src_components_AnalyticsDashboard_tsx_9f902157._.js","server/chunks/ssr/_b67012bb._.js","server/chunks/ssr/_7b6b3a22._.js"].map(b=>a.l(b))).then(()=>b(830544)))}];

//# sourceMappingURL=_4feb7d8f._.js.map