module.exports=[100260,a=>{"use strict";var b=a.i(572131),c=a.i(478793),d=a.i(169819),e=a.i(258956),f=a.i(433217),g=a.i(937927),h=a.i(405050);let i=(0,h.createServerReference)("40227d1c2ed5cbf6324cf519682235031f0a3138a5",h.callServer,void 0,h.findSourceMapURL,"getCustomersAction"),j=(0,h.createServerReference)("708938753470d59bd6fa4ddf41a8a3581263dd393b",h.callServer,void 0,h.findSourceMapURL,"createCustomerAction"),k=(0,h.createServerReference)("609ad415d8b556837c750a19320a30ea6d4beaf896",h.callServer,void 0,h.findSourceMapURL,"updateCustomerAction"),l=(0,h.createServerReference)("40f9d32b0ea15e5c8f0b3441eec79ddb30815f1c83",h.callServer,void 0,h.findSourceMapURL,"deleteCustomerAction");var m=a.i(391956);a.s(["useCustomers",0,(a=50)=>{let[h,n]=(0,b.useState)([]),[o,p]=(0,b.useState)(1),[q,r]=(0,b.useState)(a),[s,t]=(0,b.useState)(0),{toast:u}=(0,c.useToast)(),{currentBusiness:v}=(0,d.useBusiness)(),{user:w}=(0,m.useAuth)(),{logActivity:x}=(0,e.useActivityLogger)(),y=(0,g.useQueryClient)(),z=(0,b.useCallback)(async()=>{if(!v)return{customers:[],count:0};try{let a=await i(v.id);if(!a.success)throw Error(a.error);return{customers:(a.data?.customers||[]).map(a=>({id:a.id,fullName:a.fullName||a.name,phoneNumber:a.phoneNumber||a.phone,email:a.email,birthday:a.birthday?new Date(a.birthday):null,gender:a.gender,location:a.location||a.address,categoryId:a.categoryId,notes:a.notes,tags:a.tags,socialMedia:a.socialMedia||null,createdAt:new Date(a.createdAt),updatedAt:new Date(a.updatedAt)})),count:a.data?.count||0}}catch(a){return console.error("Error loading customers:",a),u({title:"Error",description:"Failed to load customers. Please try again.",variant:"destructive"}),{customers:[],count:0}}},[v?.id,u]),A=["customers",v?.id],{data:B,isLoading:C,isFetching:D}=(0,f.useQuery)({queryKey:A,queryFn:z,enabled:!!v?.id,staleTime:3e5,gcTime:18e5,refetchOnWindowFocus:!1,refetchOnReconnect:!1});(0,b.useEffect)(()=>{B&&(n(B.customers),t(B.count))},[B]);let E=async a=>{if(!v)return u({title:"Error",description:"No business selected",variant:"destructive"}),null;try{if(!w)throw Error("User not authenticated");let b={fullName:a.fullName,phoneNumber:a.phoneNumber||null,email:a.email||null,birthday:a.birthday?.toISOString().split("T")[0]||null,gender:a.gender||null,location:a.location||null,categoryId:a.categoryId||null,notes:a.notes||null,tags:a.tags||null,socialMedia:a.socialMedia||null},c=await j(v.id,w.id,b);if(!c.success||!c.data)throw Error(c.error||"Failed to create customer");let d=c.data,e={id:d.id,fullName:d.name||d.fullName,phoneNumber:d.phone||d.phoneNumber,email:d.email,birthday:d.birthday?new Date(d.birthday):null,gender:d.gender,location:d.address||d.location,categoryId:d.categoryId,notes:d.notes,tags:d.tags,socialMedia:d.socialMedia,createdAt:new Date(d.createdAt),updatedAt:new Date(d.updatedAt)};return n(a=>[e,...a]),t(a=>a+1),y.setQueryData(A,a=>a?{customers:[e,...a.customers],count:(a.count||0)+1}:{customers:[e],count:1}),await x({activityType:"CREATE",module:"CUSTOMERS",entityType:"customer",entityId:d.id,entityName:a.fullName,description:`Created customer "${a.fullName}"`,metadata:{phoneNumber:a.phoneNumber,email:a.email,location:a.location}}),u({title:"Success",description:"Customer created successfully"}),d}catch(a){return console.error("Error creating customer:",a),u({title:"Error",description:"Failed to create customer. Please try again.",variant:"destructive"}),null}},F=async(a,b)=>{try{let c={};void 0!==b.fullName&&(c.fullName=b.fullName),void 0!==b.phoneNumber&&(c.phoneNumber=b.phoneNumber),void 0!==b.email&&(c.email=b.email),void 0!==b.birthday&&(c.birthday=b.birthday?.toISOString()),void 0!==b.gender&&(c.gender=b.gender),void 0!==b.location&&(c.location=b.location),void 0!==b.categoryId&&(c.categoryId=b.categoryId),void 0!==b.notes&&(c.notes=b.notes),void 0!==b.tags&&(c.tags=b.tags),void 0!==b.socialMedia&&(c.socialMedia=b.socialMedia);let d=await k(a,c);if(!d.success)throw Error(d.error||"Failed to update customer");n(c=>c.map(c=>c.id===a?{...c,...b}:c)),y.setQueryData(A,c=>c?{...c,customers:c.customers.map(c=>c.id===a?{...c,...b}:c)}:c);let e=h.find(b=>b.id===a);return e&&await x({activityType:"UPDATE",module:"CUSTOMERS",entityType:"customer",entityId:a,entityName:e.fullName,description:`Updated customer "${e.fullName}"`,metadata:{updates:b}}),u({title:"Success",description:"Customer updated successfully"}),!0}catch(a){return console.error("Error updating customer:",a),u({title:"Error",description:"Failed to update customer. Please try again.",variant:"destructive"}),!1}},G=async a=>{try{let b=h.find(b=>b.id===a),c=await l(a);if(!c.success)throw Error(c.error||"Failed to delete customer");return n(b=>b.filter(b=>b.id!==a)),t(a=>Math.max(0,a-1)),y.setQueryData(A,b=>{if(!b)return b;let{customers:c,count:d}=b;return{customers:c.filter(b=>b.id!==a),count:Math.max(0,(d||0)-1)}}),y.invalidateQueries({queryKey:A}),b&&await x({activityType:"DELETE",module:"CUSTOMERS",entityType:"customer",entityId:a,entityName:b.fullName,description:`Deleted customer "${b.fullName}"`,metadata:{phoneNumber:b.phoneNumber,email:b.email}}),u({title:"Success",description:"Customer deleted successfully"}),!0}catch(a){return console.error("Error deleting customer:",a),u({title:"Error",description:"Failed to delete customer. Please try again.",variant:"destructive"}),!1}};return{customers:h,isLoading:C&&!B,createCustomer:E,addCustomer:E,updateCustomer:F,deleteCustomer:G,loadCustomers:z,page:o,setPage:p,pageSize:q,setPageSize:r,totalCount:s}}],100260)},400210,a=>{"use strict";let b=(0,a.i(170106).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);a.s(["ArrowLeft",()=>b],400210)},429246,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(368114);let e=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("textarea",{className:(0,d.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:e,...c}));e.displayName="Textarea",a.s(["Textarea",()=>e])},292e3,a=>{"use strict";let b=(0,a.i(170106).default)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);a.s(["AlertCircle",()=>b],292e3)},124348,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(400187),e=a.i(368114);let f=(0,d.cva)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),g=c.forwardRef(({className:a,variant:c,...d},g)=>(0,b.jsx)("div",{ref:g,role:"alert",className:(0,e.cn)(f({variant:c}),a),...d}));g.displayName="Alert";let h=c.forwardRef(({className:a,...c},d)=>(0,b.jsx)("h5",{ref:d,className:(0,e.cn)("mb-1 font-medium leading-none tracking-tight",a),...c}));h.displayName="AlertTitle";let i=c.forwardRef(({className:a,...c},d)=>(0,b.jsx)("div",{ref:d,className:(0,e.cn)("text-sm [&_p]:leading-relaxed",a),...c}));i.displayName="AlertDescription",a.s(["Alert",()=>g,"AlertDescription",()=>i,"AlertTitle",()=>h])},3048,(a,b,c)=>{let d=Error("Could not parse module '[project]/src/app/actions/products.ts'\n\n'import', and 'export' cannot be used outside of module code");throw d.code="MODULE_UNPARSABLE",d},347778,282141,a=>{"use strict";var b=a.i(572131),c=a.i(866102),d=a.i(169819),e=a.i(433217),f=a.i(937927);let g=a=>{};a.s(["clearInventoryCaches",0,g],282141);var h=a.i(3048);a.s(["useProducts",0,(a,i=50)=>{let[j,k]=(0,b.useState)([]),[l,m]=(0,b.useState)(1),[n,o]=(0,b.useState)(i),[p,q]=(0,b.useState)(0),[r,s]=(0,b.useState)(!1),{settings:t}=(0,c.useBusinessSettings)(),{currentBusiness:u}=(0,d.useBusiness)(),v=(0,f.useQueryClient)(),[w,x]=(0,b.useState)({search:"",category:"all",stockStatus:"all"}),[y,z]=(0,b.useState)(null),A=(0,b.useCallback)(a=>{a.search!==w.search&&(s(!0),y&&clearTimeout(y),z(setTimeout(()=>{s(!1)},600))),x(a)},[w.search,y]),B=(0,b.useCallback)(async()=>{if(!a||!u)return{products:[],count:0};try{return await (0,h.getProductsAction)({userId:a,businessId:u.id,page:l,pageSize:n,search:w.search,category:"all"===w.category?void 0:w.category,stockStatus:w.stockStatus})}catch(a){return console.error("Error loading products from server action:",a),{products:[],count:0}}},[a,u?.id,l,n,w.search,w.category,w.stockStatus]),C=(0,b.useMemo)(()=>["products",a,u?.id],[a,u?.id]),D=(0,b.useMemo)(()=>[...C,l,n,w.search,w.category,w.stockStatus],[C,l,n,w.search,w.category,w.stockStatus]),{data:E,isLoading:F,isFetching:G,refetch:H}=(0,e.useQuery)({queryKey:D,queryFn:B,enabled:!!a&&!!u?.id,staleTime:3e4,gcTime:18e5,refetchOnWindowFocus:!0,refetchOnReconnect:!0});(0,b.useEffect)(()=>{E&&(k(E.products),q(E.count))},[E]);let I=async b=>{try{if(!a)return null;return console.warn("Image upload redirecting to server action (TODO)"),null}catch(a){return console.error("Error in uploadProductImage:",a),null}};return{products:j,isLoading:F&&!E&&!r,loadProducts:B,page:l,setPage:m,pageSize:n,setPageSize:o,totalCount:p,createProduct:async b=>{try{if(!a||!u)return null;let c=await (0,h.createProductAction)({...b,userId:a,businessId:u.id});if(!c)return null;return k(a=>[c,...a]),q(a=>a+1),v.invalidateQueries({queryKey:C}),g(v),c}catch(a){return console.error("Error creating product:",a),null}},updateProduct:async(b,c,d,e=!1,f,i,j,k)=>{try{if(!a||!u)return!1;let i=c.imageUrl;if(d&&(i=await I(d)),!await (0,h.updateProductAction)(b,{...c,imageUrl:i,userId:a,businessId:u.id,isFromSale:e,customChangeReason:f,referenceId:j}))return!1;return v.invalidateQueries({queryKey:C}),g(v),!0}catch(a){return console.error("Error updating product:",a),!1}},updateProductsBulk:async(b,c,d,e,f,i)=>{try{if(!a||!u)return!1;let c=await (0,h.updateProductsBulkAction)(b.map(a=>({id:a.id,updated:a.updated})),u.id);return c&&(v.invalidateQueries({queryKey:C}),g(v)),c}catch(a){return console.error("Error in bulk update:",a),!1}},deleteProduct:async b=>{try{if(!a)return!1;if(await (0,h.deleteProductAction)(b))return v.invalidateQueries({queryKey:C}),g(v),!0;return!1}catch(a){return console.error("Error deleting product:",a),!1}},uploadProductImage:I,refetch:H,isFetching:G,filters:w,setFilters:A}}],347778)},349774,a=>{"use strict";var b=a.i(391956);a.s(["useCurrentUser",0,()=>{let{user:a}=(0,b.useAuth)();return{userId:a?.id}}])},563588,a=>{"use strict";let b=(0,a.i(170106).default)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);a.s(["MessageSquare",()=>b],563588)},156171,a=>{"use strict";var b=a.i(405050);let c=(0,b.createServerReference)("605a5ac8c70aa01eb0dd29483cb3c24316ae309de0",b.callServer,void 0,b.findSourceMapURL,"getProductReconciliationAction");a.s(["getProductReconciliationAction",()=>c])},219773,186344,468638,905457,a=>{"use strict";var b=a.i(405050);let c=(0,b.createServerReference)("60048cacdf8f6ab02d12e637338fb3a82838e3ab18",b.callServer,void 0,b.findSourceMapURL,"getRequisitionsAction");a.s(["getRequisitionsAction",()=>c],219773);let d=(0,b.createServerReference)("40e343dbe89cc3fb8304b10c9c62480d17ad426333",b.callServer,void 0,b.findSourceMapURL,"createRequisitionAction");a.s(["createRequisitionAction",()=>d],186344);let e=(0,b.createServerReference)("701e152aafbc4d4daee38965467b93e083a6e967b4",b.callServer,void 0,b.findSourceMapURL,"updateRequisitionAction");a.s(["updateRequisitionAction",()=>e],468638);let f=(0,b.createServerReference)("605622308fa711a2f7465dc0a63c7e00dbe7c0418e",b.callServer,void 0,b.findSourceMapURL,"deleteRequisitionAction");a.s(["deleteRequisitionAction",()=>f],905457)},952765,315181,a=>{"use strict";var b=a.i(405050);let c=(0,b.createServerReference)("4035262824370ccd2af8788671f3cc8435d165a93b",b.callServer,void 0,b.findSourceMapURL,"getActivityByEntityIdsAction");a.s(["getActivityByEntityIdsAction",()=>c],952765);let d=(0,b.createServerReference)("60eb8a3f21a0957ca35a2a3606c2b8e1d21977469d",b.callServer,void 0,b.findSourceMapURL,"updateStockHistoryDatesAction");a.s(["updateStockHistoryDatesAction",()=>d],315181)},177156,a=>{"use strict";let b=(0,a.i(170106).default)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);a.s(["Eye",()=>b],177156)},505084,a=>{"use strict";var b=a.i(187924),c=a.i(572131);a.i(935112);var d=a.i(811011),e=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((a,e)=>{let f=(0,d.createSlot)(`Primitive.${e}`),g=c.forwardRef((a,c)=>{let{asChild:d,...g}=a;return(0,b.jsx)(d?f:e,{...g,ref:c})});return g.displayName=`Primitive.${e}`,{...a,[e]:g}},{}),f="horizontal",g=["horizontal","vertical"],h=c.forwardRef((a,c)=>{var d;let{decorative:h,orientation:i=f,...j}=a,k=(d=i,g.includes(d))?i:f;return(0,b.jsx)(e.div,{"data-orientation":k,...h?{role:"none"}:{"aria-orientation":"vertical"===k?k:void 0,role:"separator"},...j,ref:c})});h.displayName="Separator";var i=a.i(368114);let j=c.forwardRef(({className:a,orientation:c="horizontal",decorative:d=!0,...e},f)=>(0,b.jsx)(h,{ref:f,decorative:d,orientation:c,className:(0,i.cn)("shrink-0 bg-border","horizontal"===c?"h-[1px] w-full":"h-full w-[1px]",a),...e}));j.displayName=h.displayName,a.s(["Separator",()=>j],505084)},559589,a=>{"use strict";var b=a.i(405050);let c=(0,b.createServerReference)("7022b270c26116cc720c0fe09926fa8749c32b0ea9",b.callServer,void 0,b.findSourceMapURL,"getStockSummaryReportAction");a.s(["getStockSummaryReportAction",()=>c])},770288,a=>{"use strict";var b=a.i(405050);let c=(0,b.createServerReference)("40193ce83d40b7dbf7c2991866f6d090da71bf2f59",b.callServer,void 0,b.findSourceMapURL,"createStockHistoryAction");a.s(["createStockHistoryAction",()=>c])},124565,a=>{"use strict";var b=a.i(405050);let c=(0,b.createServerReference)("406e0d925bc965618c40bddb0b2011bea951e9b025",b.callServer,void 0,b.findSourceMapURL,"getStockRepairsPreviewAction");a.s(["getStockRepairsPreviewAction",()=>c])},913334,a=>{"use strict";var b=a.i(405050);let c=(0,b.createServerReference)("60a33152b65e6ef5593ff2b5c1d0a77d09216fe7e5",b.callServer,void 0,b.findSourceMapURL,"repairStockChainsAction");a.s(["repairStockChainsAction",()=>c])},320562,905231,508048,874884,a=>{"use strict";var b=a.i(405050);let c=(0,b.createServerReference)("6055d418bbb34217108fb09f6c6e07a1977765bffb",b.callServer,void 0,b.findSourceMapURL,"getStockHistoryAction");a.s(["getStockHistoryAction",()=>c],320562);let d=(0,b.createServerReference)("60b4fb287dfbc2b628cca363587f00d76a36f3623b",b.callServer,void 0,b.findSourceMapURL,"recalculateStockChainAction");a.s(["recalculateStockChainAction",()=>d],905231);let e=(0,b.createServerReference)("60428e59105c2448bb202e52e31bf2d4492d8468f7",b.callServer,void 0,b.findSourceMapURL,"deleteStockHistoryEntriesByReferenceAction");a.s(["deleteStockHistoryEntriesByReferenceAction",()=>e],508048);let f=(0,b.createServerReference)("70e0c90d8c965637b3ae61b1f0dd8fc9a41ea083d6",b.callServer,void 0,b.findSourceMapURL,"updateStockHistoryDatesByReferenceAction");a.s(["updateStockHistoryDatesByReferenceAction",()=>f],874884)}];

//# sourceMappingURL=_e4e309c0._.js.map