module.exports=[463021,(a,b,c)=>{b.exports=a.x("@prisma/client-2c3a283f134fdcb6",()=>require("@prisma/client-2c3a283f134fdcb6"))},723862,a=>a.a(async(b,c)=>{try{let b=await a.y("pg-587764f78a6c7a9c");a.n(b),c()}catch(a){c(a)}},!0),180490,a=>{a.v({name:"dotenv",version:"16.6.1",description:"Loads environment variables from .env file",main:"lib/main.js",types:"lib/main.d.ts",exports:{".":{types:"./lib/main.d.ts",require:"./lib/main.js",default:"./lib/main.js"},"./config":"./config.js","./config.js":"./config.js","./lib/env-options":"./lib/env-options.js","./lib/env-options.js":"./lib/env-options.js","./lib/cli-options":"./lib/cli-options.js","./lib/cli-options.js":"./lib/cli-options.js","./package.json":"./package.json"},scripts:{"dts-check":"tsc --project tests/types/tsconfig.json",lint:"standard",pretest:"npm run lint && npm run dts-check",test:"tap run --allow-empty-coverage --disable-coverage --timeout=60000","test:coverage":"tap run --show-full-coverage --timeout=60000 --coverage-report=text --coverage-report=lcov",prerelease:"npm test",release:"standard-version"},repository:{type:"git",url:"git://github.com/motdotla/dotenv.git"},homepage:"https://github.com/motdotla/dotenv#readme",funding:"https://dotenvx.com",keywords:["dotenv","env",".env","environment","variables","config","settings"],readmeFilename:"README.md",license:"BSD-2-Clause",devDependencies:{"@types/node":"^18.11.3",decache:"^4.6.2",sinon:"^14.0.1",standard:"^17.0.0","standard-version":"^9.5.0",tap:"^19.2.0",typescript:"^4.8.4"},engines:{node:">=12"},browser:{fs:!1}})},522734,(a,b,c)=>{b.exports=a.x("fs",()=>require("fs"))},632502,a=>a.a(async(b,c)=>{try{var d=a.i(137936),e=a.i(319343),f=a.i(713095),g=b([e]);async function h(a){try{let b=await e.db.branchSettings.findUnique({where:{branchId:a}});if(!b)return null;return{id:b.id,business_name:b.businessName,business_address:b.address,business_phone:b.phone,business_email:b.email,business_logo:b.logo,currency:b.currency,signature:b.signatureImage,metadata:b.metadata||{}}}catch(a){return console.error("Error fetching business settings:",a),null}}async function i(a,b,c){try{if(!await e.db.branch.findFirst({where:{id:a,OR:[{adminId:b},{users:{some:{id:b}}}]}}))return{success:!1,error:"Unauthorized to update branch settings"};let d={businessName:c.business_name,address:c.business_address,phone:c.business_phone,email:c.business_email,logo:c.business_logo,currency:c.currency,signatureImage:c.signature,metadata:c.metadata},f=await e.db.branchSettings.upsert({where:{branchId:a},update:d,create:{branchId:a,...d}});return{success:!0,data:{id:f.id,business_name:f.businessName,business_address:f.address,business_phone:f.phone,business_email:f.email,business_logo:f.logo,currency:f.currency,signature:f.signatureImage,metadata:f.metadata}}}catch(a){return console.error("Error upserting business settings:",a),{success:!1,error:a.message||"Failed to update settings"}}}async function j(a){try{let b=await e.db.user.findUnique({where:{id:a},select:{isFrozen:!0,createdAt:!0,subscriptions:{where:{status:"active"},orderBy:{endDate:"desc"},take:1},branches:{select:{id:!0}}}});if(!b)return null;let c=b.subscriptions[0],d=new Date,f=c?Math.ceil((c.endDate.getTime()-d.getTime())/864e5):0;return{is_frozen:b.isFrozen,location_limit:1,billing_amount:c?Number(c.amount):5e4,billing_duration:"Monthly",days_remaining:Math.max(0,f),next_billing_date:c?.endDate.toISOString()||""}}catch(a){return console.error("Error fetching account status:",a),{is_frozen:!1,location_limit:1,billing_amount:5e4,billing_duration:"Monthly",days_remaining:30,next_billing_date:""}}}async function k(a){try{let b=await e.db.branchSettings.findUnique({where:{branchId:a}});if(!b)return null;return{id:b.id,location_id:b.branchId,business_name:b.businessName,business_address:b.address,business_phone:b.phone,business_email:b.email,business_logo:b.logo,completed:!!b.businessName&&!!b.phone,is_frozen:!1}}catch(a){return console.error("Error fetching onboarding status:",a),null}}[e]=g.then?(await g)():g,(0,f.ensureServerEntryExports)([h,i,j,k]),(0,d.registerServerReference)(h,"40290a4fc6b8571a026afeb877566edb807919e482",null),(0,d.registerServerReference)(i,"70837cf9b9b85e45a6367e7e3a592457c34a990d2e",null),(0,d.registerServerReference)(j,"4011d3f24165a1ff4c6519d47357cf1974ec9d298f",null),(0,d.registerServerReference)(k,"40ee1dba433f3b3dc0f2791052194d1420c0946197",null),a.s(["getAccountStatusAction",()=>j,"getBusinessSettingsAction",()=>h,"getOnboardingStatusAction",()=>k,"upsertBusinessSettingsAction",()=>i]),c()}catch(a){c(a)}},!1),350350,a=>a.a(async(b,c)=>{try{var d=a.i(137936),e=a.i(319343),f=a.i(713095),g=b([e]);async function h(a,b,c){try{let d={branchId:a};return(b||c)&&(d.date={},b&&(d.date.gte=new Date(b)),c&&(d.date.lte=new Date(c))),(await e.db.expense.findMany({where:d,select:{date:!0,amount:!0}})).map(a=>({date:a.date.toISOString(),amount:Number(a.amount)}))}catch(a){return console.error("[getExpensesForChartAction]",a),[]}}async function i(a,b){try{let[a,c,d,f,g,h,i,j,k,l]=await Promise.all([e.db.product.findMany({where:{branchId:b}}),e.db.category.findMany({where:{branchId:b}}),e.db.productHistory.findMany({where:{locationId:b}}),e.db.sale.findMany({where:{branchId:b}}),e.db.customer.findMany({where:{branchId:b}}),e.db.expense.findMany({where:{branchId:b}}),e.db.expenseCategory.findMany({where:{branchId:b}}),e.db.task.findMany({where:{branchId:b}}),e.db.taskCategory.findMany({where:{branchId:b}}),e.db.carriageInward.findMany({where:{branchId:b}})]);return{success:!0,data:{products:a,product_categories:c,stock_history:d,sales:f,customers:g,expenses:h,expense_categories:i,tasks:j,task_categories:k,carriage_inwards:l}}}catch(a){return{success:!1,error:a.message}}}async function j(a,b,c,d,e){try{return console.log("[createSubscriptionPaymentAction] Payment record:",{purchaseId:a,userId:b,branchId:c,amount:d,billingCycle:e}),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function k(a){try{return{success:!0,data:null}}catch(a){return{success:!1,data:null,error:a.message}}}[e]=g.then?(await g)():g,(0,f.ensureServerEntryExports)([h,i,j,k]),(0,d.registerServerReference)(h,"7032a29d28bd01f4196de49c5bc81b9c93747c2fef",null),(0,d.registerServerReference)(i,"60cb37a955a3f0fc9842da415e4b6b6c26c486a212",null),(0,d.registerServerReference)(j,"7ce6d1f4c25f28b5f00de53ec131c2485aa7b24548",null),(0,d.registerServerReference)(k,"4055506d1007b312be8f26c56b16ce540fd7c02bf7",null),a.s(["getBusinessBackupDataAction",()=>i,"getExpensesForChartAction",()=>h]),c()}catch(a){c(a)}},!1),399602,696818,18956,a=>{"use strict";let b=Symbol.for("constructDateFrom");function c(a,c){return"function"==typeof a?a(c):a&&"object"==typeof a&&b in a?a[b](c):a instanceof Date?new a.constructor(c):new Date(c)}function d(a,b){return c(b||a,a)}a.s(["constructFromSymbol",0,b,"millisecondsInDay",0,864e5,"millisecondsInHour",0,36e5,"millisecondsInMinute",0,6e4,"millisecondsInSecond",0,1e3,"millisecondsInWeek",0,6048e5],696818),a.s(["constructFrom",()=>c],18956),a.s(["toDate",()=>d],399602)},310236,a=>{"use strict";var b=a.i(18956),c=a.i(399602);function d(a,d,e){let f=(0,c.toDate)(a,e?.in);return isNaN(d)?(0,b.constructFrom)(e?.in||a,NaN):(d&&f.setDate(f.getDate()+d),f)}a.s(["addDays",()=>d])},265233,a=>{"use strict";var b=a.i(310236);function c(a,c,d){return(0,b.addDays)(a,7*c,d)}a.s(["addWeeks",()=>c])},747820,a=>{"use strict";var b=a.i(18956),c=a.i(399602);function d(a,d,e){let f=(0,c.toDate)(a,e?.in);if(isNaN(d))return(0,b.constructFrom)(e?.in||a,NaN);if(!d)return f;let g=f.getDate(),h=(0,b.constructFrom)(e?.in||a,f.getTime());return(h.setMonth(f.getMonth()+d+1,0),g>=h.getDate())?h:(f.setFullYear(h.getFullYear(),h.getMonth(),g),f)}a.s(["addMonths",()=>d])},864435,a=>a.a(async(b,c)=>{try{var d=a.i(137936),e=a.i(319343),f=a.i(118558),g=a.i(713095),h=b([e]);async function i(a,b){try{let c=await e.db.message.findMany({where:{userId:a,locationId:b},orderBy:{createdAt:"desc"}});return{success:!0,data:c.map(a=>({id:a.id,userId:a.userId,locationId:a.locationId,profileId:a.profileId,customerId:a.customerId,phoneNumber:a.phoneNumber,content:a.content,status:a.status,smsCreditsUsed:a.smsCreditsUsed,templateId:a.templateId,errorMessage:a.errorMessage,sentAt:a.sentAt?.toISOString(),deliveredAt:a.deliveredAt?.toISOString(),createdAt:a.createdAt.toISOString(),updatedAt:a.updatedAt.toISOString(),metadata:a.metadata}))}}catch(a){return console.error("Error fetching messages:",a),{success:!1,error:a.message}}}async function j(a){try{let b=await e.db.message.create({data:{userId:a.userId,locationId:a.locationId,profileId:a.profileId,customerId:a.customerId,phoneNumber:a.phoneNumber,content:a.content,status:a.status||"pending",smsCreditsUsed:a.smsCreditsUsed||0,templateId:a.templateId,metadata:a.metadata}});return"sent"===b.status&&a.profileId&&await e.db.user.update({where:{id:a.profileId},data:{credits:{decrement:b.smsCreditsUsed}}}),(0,f.revalidatePath)("/messages"),{success:!0,data:b}}catch(a){return console.error("Error creating message:",a),{success:!1,error:a.message}}}async function k(a,b){try{let c=await e.db.messageTemplate.findMany({where:{userId:a,locationId:b},orderBy:{createdAt:"desc"}});return{success:!0,data:c}}catch(a){return console.error("Error fetching message templates:",a),{success:!1,error:a.message}}}async function l(a){try{let b=await e.db.messageTemplate.create({data:{userId:a.userId,locationId:a.locationId,name:a.name,content:a.content,category:a.category,variables:a.variables,isDefault:a.isDefault||!1}});return(0,f.revalidatePath)("/messages"),{success:!0,data:b}}catch(a){return console.error("Error creating message template:",a),{success:!1,error:a.message}}}async function m(a,b){try{let c=await e.db.messageTemplate.update({where:{id:a},data:{name:b.name,content:b.content,category:b.category,variables:b.variables,isDefault:b.isDefault}});return(0,f.revalidatePath)("/messages"),{success:!0,data:c}}catch(a){return console.error("Error updating message template:",a),{success:!1,error:a.message}}}async function n(a){try{return await e.db.messageTemplate.delete({where:{id:a}}),(0,f.revalidatePath)("/messages"),{success:!0}}catch(a){return console.error("Error deleting message template:",a),{success:!1,error:a.message}}}[e]=h.then?(await h)():h,(0,g.ensureServerEntryExports)([i,j,k,l,m,n]),(0,d.registerServerReference)(i,"600b97f3c90242ca4be1574d304e260e5e07e3c8cf",null),(0,d.registerServerReference)(j,"40fae8e3cd20e274d8835c219996fbcfcdde06446f",null),(0,d.registerServerReference)(k,"608c56e751f1517abf78af3f8f4b1eb817c5efcecc",null),(0,d.registerServerReference)(l,"4012401c60d205ed481a496ad745ca64dfad82e200",null),(0,d.registerServerReference)(m,"60a4c2261958cabb4ed4ad155b1559b15bd9b1c7a3",null),(0,d.registerServerReference)(n,"406dfcb8705c888c32dc2bb1380b80464b3977c05d",null),a.s(["createMessageAction",()=>j,"createMessageTemplateAction",()=>l,"deleteMessageTemplateAction",()=>n,"getMessageTemplatesAction",()=>k,"getMessagesAction",()=>i,"updateMessageTemplateAction",()=>m]),c()}catch(a){c(a)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__78fba25e._.js.map