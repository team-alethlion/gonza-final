module.exports=[100321,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(391956),e=a.i(169819),f=a.i(347778),g=a.i(478793),h=a.i(770094),i=a.i(665967),j=a.i(895121),k=a.i(875083),l=a.i(786304),m=a.i(883497),n=a.i(587532),o=a.i(633508),p=a.i(866102),q=a.i(243920),r=a.i(757061),s=a.i(699570),t=a.i(269876);let u=({suggestions:a,isOpen:c,onClose:d,onSelectProduct:e,searchTerm:f,isLoading:g=!1})=>{let{settings:i}=(0,p.useBusinessSettings)(),j=(0,h.useIsMobile)(),k=(a,c)=>{if(!c)return a;let d=c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),e=RegExp(`(${d})`,"gi");return a.split(e).map((a,c)=>e.test(a)?(0,b.jsx)("span",{className:"bg-yellow-200 font-medium",children:a},c):(0,b.jsx)("span",{children:a},c))},u=a=>{e(a),d()};return j?c&&(0!==a.length||g)?(0,b.jsxs)("div",{className:"bg-white border border-gray-200 rounded-md shadow-lg max-h-80 overflow-y-auto",children:[(0,b.jsxs)("div",{className:"p-2 border-b bg-gray-50",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(n.Search,{className:"h-4 w-4 text-gray-600"}),(0,b.jsx)("span",{className:"text-sm font-medium",children:"Suggestions"})]}),(0,b.jsx)(s.Button,{variant:"ghost",size:"icon",onClick:d,className:"h-6 w-6",children:(0,b.jsx)(o.X,{className:"h-3 w-3"})})]}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:g?"Searching for products...":a.length>0?`Found ${a.length} product${a.length>1?"s":""}`:"No products found"})]}),g&&(0,b.jsxs)("div",{className:"p-8 text-center bg-white",children:[(0,b.jsx)("div",{className:"h-6 w-6 border-2 border-primary border-t-transparent animate-spin rounded-full mx-auto mb-2"}),(0,b.jsx)("span",{className:"text-xs text-gray-500",children:"Searching..."})]}),!g&&a.length>0&&(0,b.jsx)("div",{className:"max-h-64 overflow-y-auto bg-primary",children:a.map(a=>(0,b.jsx)("div",{className:"p-3 hover:bg-primary-foreground/20 cursor-pointer border-b border-primary-foreground/20 last:border-b-0 bg-white mx-1 my-1 rounded",onClick:()=>u(a),children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(q.default,{imageUrl:a.imageUrl,alt:a.name,size:"sm"}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsx)(m.Package,{className:"h-4 w-4 text-gray-400 flex-shrink-0"}),(0,b.jsx)("div",{className:"font-medium text-sm truncate",children:k(a.name,f)})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)(l.Badge,{variant:"outline",className:"text-xs",children:a.category}),(0,b.jsxs)("span",{className:"text-xs text-gray-500",children:["Item #: ",k(a.itemNumber,f)]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-1",children:[(0,b.jsxs)("span",{children:["Qty: ",a.quantity%1==0?a.quantity:a.quantity.toFixed(2)]}),(0,b.jsxs)("span",{className:"font-medium",children:[i.currency," ",a.sellingPrice.toFixed(2)]})]}),a.description&&(0,b.jsx)("div",{className:"text-xs text-gray-500 truncate",children:k(a.description,f)}),a.supplier&&(0,b.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["Supplier: ",k(a.supplier,f)]})]})]})},a.id))}),!g&&0===a.length&&(0,b.jsxs)("div",{className:"p-8 text-center bg-white",children:[(0,b.jsx)(n.Search,{className:"h-8 w-8 text-gray-300 mx-auto mb-2"}),(0,b.jsxs)("p",{className:"text-xs text-gray-500",children:['No products found matching "',f,'"']})]}),a.length>=50&&(0,b.jsx)("div",{className:"p-3 border-t bg-primary text-center",children:(0,b.jsx)("span",{className:"text-xs text-primary-foreground",children:"Showing top 50 results. Keep typing to refine..."})})]}):null:(0,b.jsx)(r.Sheet,{open:c,onOpenChange:d,modal:!1,children:(0,b.jsxs)(r.SheetContent,{className:"w-full sm:w-[400px] sm:max-w-[400px] p-0 z-[100] pointer-events-auto flex flex-col bg-primary",side:"right",onOpenAutoFocus:a=>a.preventDefault(),onCloseAutoFocus:a=>a.preventDefault(),children:[(0,b.jsxs)(r.SheetHeader,{className:"p-4 border-b border-primary-foreground/20 bg-primary flex-shrink-0",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(n.Search,{className:"h-4 w-4 text-primary-foreground"}),(0,b.jsx)(r.SheetTitle,{className:"text-base text-primary-foreground",children:"Product Suggestions"})]}),(0,b.jsx)(s.Button,{variant:"ghost",size:"icon",onClick:d,className:"h-8 w-8 text-primary-foreground hover:bg-primary-foreground/20",children:(0,b.jsx)(o.X,{className:"h-4 w-4"})})]}),(0,b.jsx)(r.SheetDescription,{className:"text-left text-primary-foreground/80",children:g?"Searching for products...":a.length>0?`Found ${a.length} product${a.length>1?"s":""} matching "${f}"`:`No products found matching "${f}"`})]}),g?(0,b.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center p-8 text-primary-foreground bg-primary",children:[(0,b.jsx)("div",{className:"h-8 w-8 border-2 border-primary-foreground border-t-transparent animate-spin rounded-full mb-4"}),(0,b.jsx)("p",{className:"text-sm",children:"Searching products..."})]}):a.length>0?(0,b.jsx)(t.ScrollArea,{className:"flex-1 h-0 bg-primary",children:(0,b.jsx)("div",{className:"p-2",children:a.map(a=>(0,b.jsx)("div",{className:"p-3 hover:bg-primary-foreground/20 cursor-pointer border-b border-primary-foreground/20 last:border-b-0 rounded-md mx-1 my-1 hover:shadow-sm transition-all bg-white",onClick:()=>u(a),children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(q.default,{imageUrl:a.imageUrl,alt:a.name,size:"sm"}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsx)(m.Package,{className:"h-4 w-4 text-gray-400 flex-shrink-0"}),(0,b.jsx)("div",{className:"font-medium text-sm truncate",children:k(a.name,f)})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)(l.Badge,{variant:"outline",className:"text-xs",children:a.category}),(0,b.jsxs)("span",{className:"text-xs text-gray-500",children:["Item #: ",k(a.itemNumber,f)]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-1",children:[(0,b.jsxs)("span",{children:["Qty: ",a.quantity%1==0?a.quantity:a.quantity.toFixed(2)]}),(0,b.jsxs)("span",{className:"font-medium",children:[i.currency," ",a.sellingPrice.toFixed(2)]})]}),a.description&&(0,b.jsx)("div",{className:"text-xs text-gray-500 truncate",children:k(a.description,f)}),a.supplier&&(0,b.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["Supplier: ",k(a.supplier,f)]})]})]})},a.id))})}):(0,b.jsxs)("div",{className:"p-8 text-center text-primary-foreground flex-1 flex flex-col items-center justify-center bg-primary",children:[(0,b.jsx)(n.Search,{className:"h-12 w-12 mx-auto mb-4 text-primary-foreground/50"}),(0,b.jsx)("p",{className:"text-sm",children:"No products found"}),(0,b.jsx)("p",{className:"text-xs mt-1",children:"Try adjusting your search term"})]}),a.length>=50&&(0,b.jsx)("div",{className:"p-3 border-t bg-primary text-center flex-shrink-0",children:(0,b.jsx)("span",{className:"text-xs text-primary-foreground",children:"Showing top 50 results. Keep typing to refine..."})})]})})};var v=a.i(896378);let w=(a,b)=>{let[d,e]=(0,c.useState)(!1),f=(0,c.useMemo)(()=>{if(!b||b.length<1)return[];let c=a.filter(a=>(0,v.matchProductSearch)(a,b)),d=b.toLowerCase();return c.sort((a,b)=>{let c=String(a.name||"").toLowerCase(),e=String(b.name||"").toLowerCase(),f=String(a.itemNumber||"").toLowerCase(),g=String(b.itemNumber||"").toLowerCase();return f===d?-1:g===d?1:c===d?-1:e===d?1:f.startsWith(d)&&!g.startsWith(d)?-1:g.startsWith(d)&&!f.startsWith(d)?1:c.startsWith(d)&&!e.startsWith(d)?-1:e.startsWith(d)&&!c.startsWith(d)?1:c.localeCompare(e)}).slice(0,100)},[a,b]);return(0,c.useEffect)(()=>{b.length>=1&&f.length>0?e(!0):0===b.length&&e(!1)},[b,f.length]),{suggestions:f,isOpen:d,openPanel:()=>{e(!0)},closePanel:()=>{e(!1)}}};var x=a.i(591119),y=a.i(866718),z=a.i(580701),A=a.i(284505),B=a.i(104720),C=a.i(730769),D=a.i(737139),E=a.i(750054),F=a.i(985579);let G=a=>{let b=a.price*a.quantity,c=0;if("amount"===a.discountType)c=Number(a.discountAmount)||0;else if("percentage"===a.discountType)c=b*(Number(a.discountPercentage)||0)/100;else if(!a.discountType){let d=Number(a.discountPercentage)||0,e=Number(a.discountAmount)||0;d>0?c=b*d/100:e>0&&(c=e)}return b-c},H=a=>G(a)/a.quantity;var I=a.i(433217),J=a.i(3048),K=a.i(206015),L=a.i(368114),M=a.i(624648),N=a.i(256711),O=a.i(932596),P=a.i(333140),Q=a.i(599209),R=a.i(320146),S=a.i(814574),T=a.i(824569),U=a.i(771931),V=a.i(626109),W=a.i(890914),X=a.i(400291);let Y=({isOpen:a,onOpenChange:d,itemDescription:e,sales:f,currency:g,dateFilter:h,dateRange:j,specificDate:k})=>{let m=(0,i.useNavigate)(),{hasPermission:n}=(0,W.useProfiles)(),{canViewSellingPrice:o}=(0,X.useFinancialVisibility)(),[p,q]=(0,c.useState)(null),[r,t]=(0,c.useState)(!1),u=(()=>{let a,b;if("specific-date"===h&&k)(a=new Date(k)).setHours(0,0,0,0),(b=new Date(k)).setHours(23,59,59,999);else if("custom"===h&&j.from&&j.to)a=j.from,b=j.to;else{let c=(0,E.getDateRangeFromFilter)(h);a=c.from,b=c.to}return f.filter(c=>{let d=new Date(c.date),f=!1;f="specific-date"===h&&k?(0,F.isSameDay)(d,k):d>=a&&d<=b;let g=c.items.some(a=>a.description===e),i="Quote"!==c.paymentStatus;return f&&g&&i})})();return(0,b.jsxs)(S.Dialog,{open:a,onOpenChange:d,children:[(0,b.jsxs)(S.DialogContent,{className:"max-w-5xl max-h-[80vh] overflow-y-auto",children:[(0,b.jsxs)(S.DialogHeader,{children:[(0,b.jsxs)(S.DialogTitle,{children:['Sales for "',e,'"']}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:[u.length," sale",1!==u.length?"s":""," found in the selected period"]})]}),0===u.length?(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No sales found for this item in the selected period."}):(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)(K.Table,{children:[(0,b.jsx)(K.TableHeader,{children:(0,b.jsxs)(K.TableRow,{children:[(0,b.jsx)(K.TableHead,{children:"Date"}),(0,b.jsx)(K.TableHead,{children:"Receipt #"}),(0,b.jsx)(K.TableHead,{children:"Customer"}),(0,b.jsx)(K.TableHead,{className:"text-right",children:"Quantity"}),(0,b.jsx)(K.TableHead,{className:"text-right",children:"Unit Price"}),(0,b.jsx)(K.TableHead,{className:"text-right",children:"Total"}),(0,b.jsx)(K.TableHead,{children:"Status"}),(0,b.jsx)(K.TableHead,{className:"text-center",children:"Actions"})]})}),(0,b.jsx)(K.TableBody,{children:u.map(a=>{let c=a.items.find(a=>a.description===e);return c?(0,b.jsxs)(K.TableRow,{children:[(0,b.jsx)(K.TableCell,{children:(0,N.format)(a.date,"MMM d, yyyy")}),(0,b.jsxs)(K.TableCell,{className:"font-medium",children:["#",a.receiptNumber]}),(0,b.jsx)(K.TableCell,{children:a.customerName}),(0,b.jsx)(K.TableCell,{className:"text-right",children:c.quantity}),(0,b.jsx)(K.TableCell,{className:"text-right",children:o?(0,L.formatCashCurrency)(c.price,g):"•••"}),(0,b.jsx)(K.TableCell,{className:"text-right",children:o?(0,L.formatCashCurrency)(c.price*c.quantity,g):"•••"}),(0,b.jsx)(K.TableCell,{children:(0,b.jsx)(l.Badge,{variant:"Paid"===a.paymentStatus?"default":"NOT PAID"===a.paymentStatus?"destructive":"secondary",children:a.paymentStatus})}),(0,b.jsx)(K.TableCell,{className:"text-center",children:(0,b.jsxs)("div",{className:"flex justify-center gap-1",children:[(0,b.jsxs)(s.Button,{variant:"ghost",size:"sm",onClick:()=>{q(a),t(!0)},className:"h-8 w-8 p-0",title:"View Receipt",children:[(0,b.jsx)(U.Printer,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"sr-only",children:"View Receipt"})]}),n("sales","edit")&&(0,b.jsxs)(s.Button,{variant:"ghost",size:"sm",onClick:()=>{m("/new-sale",{state:{editSale:a}}),d(!1)},className:"h-8 w-8 p-0",title:"Edit Sale",children:[(0,b.jsx)(T.Edit,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"sr-only",children:"Edit Sale"})]})]})})]},a.id):null})})]})})]}),(0,b.jsx)(V.default,{isOpen:r,sale:p,currency:g,onOpenChange:()=>{t(!1),q(null)}})]})};var Z=a.i(315055),$=a.i(785259);let _=()=>{let{user:a}=(0,d.useAuth)(),{currentBusiness:f}=(0,e.useBusiness)(),h=(()=>{let[a,b]=(0,c.useState)({pageSize:20,enableVirtualScrolling:!1,reducedAnimations:!1,compactView:!1});return(0,c.useEffect)(()=>{let a=()=>{let a=window.innerWidth<768;b({pageSize:a?15:20,enableVirtualScrolling:a,reducedAnimations:"connection"in navigator&&navigator.connection?.effectiveType==="slow-2g"||navigator.connection?.effectiveType==="2g",compactView:a})};return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]),a})(),{sales:i}=(0,D.useSalesData)(a?.id,"desc"),{settings:j,isLoading:k}=(0,p.useBusinessSettings)(),{canViewCostPrice:l,canViewProfit:m,canViewSellingPrice:o}=(0,X.useFinancialVisibility)(),{toast:q}=(0,g.useToast)(),r=(0,c.useMemo)(()=>f?.id?`soldItemsFilters_${f.id}`:"soldItemsFilters",[f?.id]),t=(0,c.useCallback)(()=>{try{let a=localStorage.getItem(r);if(a){let b=JSON.parse(a);return{dateFilter:b.dateFilter||"this-month",dateRange:b.dateRange?{from:b.dateRange.from?new Date(b.dateRange.from):void 0,to:b.dateRange.to?new Date(b.dateRange.to):void 0}:{from:void 0,to:void 0},specificDate:b.specificDate?new Date(b.specificDate):void 0,showOnlyNotInInventory:b.showOnlyNotInInventory||!1,showOnlyCostData:b.showOnlyCostData||!1}}}catch(a){console.error("Error loading persisted sold items filters:",a)}return{dateFilter:"this-month",dateRange:{from:void 0,to:void 0},specificDate:void 0,showOnlyNotInInventory:!1,showOnlyCostData:!1}},[r]),u=(0,c.useMemo)(()=>t(),[t]),[v,w]=(0,c.useState)(u.dateFilter),[S,T]=(0,c.useState)(u.dateRange),[U,V]=(0,c.useState)(u.specificDate),[W,_]=(0,c.useState)(null),[aa,ab]=(0,c.useState)(!1),[ac,ad]=(0,c.useState)(""),[ae,af]=(0,c.useState)(u.showOnlyNotInInventory),[ag,ah]=(0,c.useState)(u.showOnlyCostData),{soldItems:ai,isLoading:aj}=((a,b,f,g)=>{let{user:h}=(0,d.useAuth)(),{currentBusiness:i}=(0,e.useBusiness)(),{sales:j,isLoading:k,clearSoldItemsCache:l}=(0,D.useSalesData)(h?.id,"desc"),{data:m,isLoading:n}=(0,I.useQuery)({queryKey:["inventory_check_map",i?.id],queryFn:async()=>{if(!i?.id||!h?.id)return new Map;let a=await (0,J.getProductsAction)({userId:h.id,businessId:i.id,pageSize:1e3}),b=new Map;return a&&a.products&&a.products.forEach(a=>{a.id&&b.set(a.id,!0),a.name&&b.set(a.name.trim().toLowerCase(),!0)}),b},enabled:!!i?.id&&!!h?.id,staleTime:3e5,gcTime:18e5});return{soldItems:(0,c.useMemo)(()=>{let c,d;if(!j||0===j.length)return[];if("specific-date"===a&&f)(c=new Date(f)).setHours(0,0,0,0),(d=new Date(f)).setHours(23,59,59,999);else if("custom"===a&&b.from&&b.to)c=b.from,d=b.to;else{let b=(0,E.getDateRangeFromFilter)(a);c=b.from,d=b.to}let e=j.filter(b=>{let e=new Date(b.date);return"specific-date"===a&&f?(0,F.isSameDay)(e,f)&&"Quote"!==b.paymentStatus:e>=c&&e<=d&&"Quote"!==b.paymentStatus}),h=new Map;e.forEach(a=>{a.items.forEach(a=>{let b=a.description,c=a.price*a.quantity,d=G(a),e=c-d,f=(a.cost||0)*a.quantity,g=d-f,i=H(a);if(h.has(b)){let c=h.get(b);c.totalQuantity+=a.quantity,c.totalAmount+=d,c.totalCost+=f,c.totalProfit+=g,c.totalDiscount+=e,c.prices.push(i),c.costs.push(a.cost||0),a.productId&&!c.productIds.includes(a.productId)&&c.productIds.push(a.productId)}else h.set(b,{totalQuantity:a.quantity,totalAmount:d,totalCost:f,totalProfit:g,totalDiscount:e,prices:[i],costs:[a.cost||0],productIds:a.productId?[a.productId]:[]})})});let i=Array.from(h.entries()).map(([a,b])=>({description:a,totalQuantity:b.totalQuantity,averagePrice:b.prices.reduce((a,b)=>a+b,0)/b.prices.length,totalAmount:b.totalAmount,totalCost:b.totalCost,totalProfit:b.totalProfit,totalDiscount:b.totalDiscount,averageCost:b.costs.reduce((a,b)=>a+b,0)/b.costs.length,productIds:b.productIds})).sort((a,b)=>b.totalAmount-a.totalAmount);return g&&m?i.filter(a=>{if(a.productIds.some(a=>m.has(a)))return!1;let b=a.description.trim().toLowerCase();return!m.has(b)}):i},[j,a,b,f,m,g]),isLoading:k||n,loadSoldItemsData:()=>{l()}}})(v,S,U,ae);(0,c.useEffect)(()=>{let a={dateFilter:v,dateRange:{from:S.from?.toISOString(),to:S.to?.toISOString()},specificDate:U?.toISOString(),showOnlyNotInInventory:ae,showOnlyCostData:ag};localStorage.setItem(r,JSON.stringify(a))},[v,S,U,ae,ag,r]);let ak=(0,c.useMemo)(()=>{if(!ac.trim())return ai;let a=ac.toLowerCase();return ai.filter(b=>b.description.toLowerCase().includes(a))},[ai,ac]);return aj?(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)(P.Skeleton,{className:"h-8 w-32"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(P.Skeleton,{className:"h-8 w-20"}),(0,b.jsx)(P.Skeleton,{className:"h-8 w-20"})]})]}),(0,b.jsx)(P.Skeleton,{className:"h-48"})]}):(0,b.jsx)($.TooltipProvider,{children:(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,b.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 items-start md:items-center",children:[(0,b.jsxs)(z.Select,{value:v,onValueChange:w,children:[(0,b.jsx)(z.SelectTrigger,{className:"w-full md:w-48",children:(0,b.jsx)(z.SelectValue,{placeholder:"Select period"})}),(0,b.jsxs)(z.SelectContent,{children:[(0,b.jsx)(z.SelectItem,{value:"today",children:"Today"}),(0,b.jsx)(z.SelectItem,{value:"yesterday",children:"Yesterday"}),(0,b.jsx)(z.SelectItem,{value:"this-week",children:"This Week"}),(0,b.jsx)(z.SelectItem,{value:"last-week",children:"Last Week"}),(0,b.jsx)(z.SelectItem,{value:"this-month",children:"This Month"}),(0,b.jsx)(z.SelectItem,{value:"last-month",children:"Last Month"}),(0,b.jsx)(z.SelectItem,{value:"this-year",children:"This Year"}),(0,b.jsx)(z.SelectItem,{value:"specific-date",children:"Specific Date"}),(0,b.jsx)(z.SelectItem,{value:"custom",children:"Custom Range"})]})]}),"specific-date"===v&&(0,b.jsx)("div",{className:"w-full md:w-auto",children:(0,b.jsxs)(Q.Popover,{children:[(0,b.jsx)(Q.PopoverTrigger,{asChild:!0,children:(0,b.jsxs)(s.Button,{variant:"outline",className:(0,L.cn)("w-full md:w-[240px] justify-start text-left font-normal bg-white",!U&&"text-muted-foreground"),children:[(0,b.jsx)(C.CalendarIcon,{className:"mr-2 h-4 w-4"}),U?(0,N.format)(U,"PPP"):(0,b.jsx)("span",{children:"Pick a specific date"})]})}),(0,b.jsx)(Q.PopoverContent,{className:"w-auto p-0 z-[100] bg-white shadow-lg",align:"start",children:(0,b.jsx)(R.Calendar,{mode:"single",selected:U,onSelect:V,initialFocus:!0,className:"p-3 pointer-events-auto"})})]})}),"custom"===v&&(0,b.jsx)(M.default,{dateRange:S,onDateRangeChange:T})]}),(0,b.jsxs)("div",{className:"flex flex-col md:flex-row gap-2",children:[(0,b.jsxs)(s.Button,{variant:"outline",onClick:()=>{"specific-date"===v&&U||"custom"===v&&S.from&&S.to||(0,E.getDateRangeFromFilter)(v),((a,b,c="USD",d=!1)=>{let e=new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}),f=a.map(a=>d?[a.description,a.totalQuantity.toString(),e.format(a.averageCost||0),e.format(a.totalCost)]:[a.description,a.totalQuantity.toString(),e.format(a.averagePrice),e.format(a.totalAmount),e.format(a.totalDiscount),e.format(a.totalCost),e.format(a.totalProfit)]),g=a.reduce((a,b)=>a+b.totalQuantity,0),h=a.reduce((a,b)=>a+b.totalAmount,0),i=a.reduce((a,b)=>a+b.totalDiscount,0),j=a.reduce((a,b)=>a+b.totalCost,0),k=a.reduce((a,b)=>a+b.totalProfit,0);f.push([""]),f.push(["SUMMARY","","","","","",""]),f.push(["Total Items",a.length.toString(),"","","","",""]),f.push(["Total Quantity",g.toString(),"","","","",""]),d?f.push(["Total Cost","","",e.format(j)]):(f.push(["Total Revenue","","",e.format(h),"","",""]),f.push(["Total Discount","","","",e.format(i),"",""]),f.push(["Total Cost","","","","",e.format(j),""]),f.push(["Total Profit","","","","","",e.format(k)]));let l=new Blob([[d?["Item","Quantity","Average Cost","Total Cost"]:["Item","Quantity","Average Price","Total Amount","Discount","Cost Amount","Profit"],...f].map(a=>a.map(a=>`"${a}"`).join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),m=document.createElement("a"),n=URL.createObjectURL(l);m.setAttribute("href",n),m.setAttribute("download",`${d?"cost_data_":""}sold_items_${b.replace(/\s+/g,"_")}_${new Date().toISOString().split("T")[0]}.csv`),m.style.visibility="hidden",document.body.appendChild(m),m.click(),document.body.removeChild(m)})(ak,"Current Period",j.currency,ag),q({title:"Export successful",description:"Sold items exported to CSV file."})},className:"gap-2 w-full md:w-auto",children:[(0,b.jsx)(B.FileText,{className:"h-4 w-4"}),"Export CSV"]}),(0,b.jsxs)(s.Button,{variant:"outline",onClick:()=>{let a;k?q({title:"Please wait",description:"Business settings are still loading. Please try again in a moment.",variant:"destructive"}):(a="specific-date"===v&&U?{from:U,to:U}:"custom"===v&&S.from&&S.to?S:(0,E.getDateRangeFromFilter)(v),((a,b,c="USD",d=!1,e,f)=>{let g,h=new O.default({orientation:"portrait",unit:"mm",format:"a4",compress:!0}),i=h.internal.pageSize.getWidth(),j=h.internal.pageSize.getHeight(),k=i-15-15,l=15,m=d?[60,30,40,40]:[38,18,22,22,20,20,20],n=d?["Item","Quantity","Avg Cost","Total Cost"]:["Item","Quantity","Avg Price","Total","Discount","Cost","Profit"],o=()=>{h.setFontSize(8),h.setFont("helvetica","normal"),h.setTextColor(150,150,150),h.text("Created By Gonza Systems",i/2,j-10,{align:"center"}),h.setTextColor(0,0,0)},p=()=>{h.setFillColor(243,244,246),h.rect(15,l-2,k,10,"F"),h.setLineWidth(.3),h.rect(15,l-2,k,10),h.setFontSize(10),h.setFont("helvetica","bold");let a=15;n.forEach((b,c)=>{let d=m[c],e=h.getTextWidth(b),f=a+(d-e)/2;h.text(b,f,l+6),c<n.length-1&&h.line(a+d,l-2,a+d,l+10-2),a+=d}),l+=10},q=a=>l+a>j-15-15&&(o(),h.addPage(),l=15,p(),h.setFont("helvetica","normal"),h.setFontSize(9),!0),r=l;f&&(h.setFontSize(12),h.setFont("helvetica","bold"),h.text(f.businessName,15,l),l+=6,h.setFontSize(9),h.setFont("helvetica","normal"),h.text(f.businessAddress,15,l),l+=5,h.text(f.businessPhone,15,l),l+=5,h.text(f.businessEmail,15,l)),l=r,h.setFontSize(18),h.setFont("helvetica","bold");let s=d?`Items Cost Report (${c})`:`Items Sold Report (${c})`,t=h.getTextWidth(s);if(h.text(s,i-15-t,l),l+=10,e?.from&&e?.to){h.setFontSize(12),h.setFont("helvetica","normal");let a=(0,N.format)(e.from,"dd/MM/yyyy"),b=(0,N.format)(e.to,"dd/MM/yyyy"),c=a===b?a:`${a} - ${b}`,d=h.getTextWidth(c);h.text(c,i-15-d,l),l+=12}else{h.setFontSize(12),h.setFont("helvetica","normal");let a=(0,N.format)(new Date,"dd/MM/yyyy"),b=h.getTextWidth(a);h.text(a,i-15-b,l),l+=12}if(l=Math.max(l,r+25),0===a.length){h.setFontSize(14),h.setFont("helvetica","normal");let a="No items sold in the selected period.",b=h.getTextWidth(a);h.text(a,(i-b)/2,l+30)}else{q(20),p(),h.setFont("helvetica","normal"),h.setFontSize(8);let b=new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0});a.forEach((a,c)=>{q(13);let e=d?[a.description,a.totalQuantity.toString(),b.format(a.totalCost/a.totalQuantity),b.format(a.totalCost)]:[a.description,a.totalQuantity.toString(),b.format(a.averagePrice),b.format(a.totalAmount),b.format(a.totalDiscount||0),b.format(a.totalCost||0),b.format(a.totalProfit||0)];c%2==0&&(h.setFillColor(249,250,251),h.rect(15,l-1,k,8,"F")),h.setLineWidth(.1),h.rect(15,l-1,k,8);let f=15;e.forEach((a,b)=>{let c=m[b],d=a;if(0===b)for(;h.getTextWidth(d)>c-4&&d.length>3;)d=d.substring(0,d.length-4)+"...";let g=f+2;if(b>=1){let a=h.getTextWidth(d);g=f+(c-a)/2}h.text(d,g,l+5),b<e.length-1&&h.line(f+c,l-1,f+c,l+8-1),f+=c}),l+=8}),l+=10,q(45),h.setFontSize(16),h.setFont("helvetica","bold"),h.text("Summary",15,l),l+=8;let c=a.length,e=a.reduce((a,b)=>a+b.totalQuantity,0),f=a.reduce((a,b)=>a+b.totalAmount,0),g=a.reduce((a,b)=>a+(b.totalDiscount||0),0),i=a.reduce((a,b)=>a+(b.totalCost||0),0),j=a.reduce((a,b)=>a+(b.totalProfit||0),0),n=d?32:56;h.setFillColor(248,249,250),h.rect(15,l-3,k,n,"F"),h.setLineWidth(.3),h.setDrawColor(200,200,200),h.rect(15,l-3,k,n),h.setFontSize(11),h.setFont("helvetica","normal");let o=d?[["Total Items:",c.toString()],["Total Quantity:",e.toString()],["Total Cost:",b.format(i)]]:[["Total Items:",c.toString()],["Total Quantity:",e.toString()],["Total Revenue:",b.format(f)],["Total Discount:",b.format(g)],["Total Cost:",b.format(i)],["Total Profit:",b.format(j)]],r=l+6,s=30;o.forEach(([a,b])=>{h.setFont("helvetica","bold"),h.text(a,s,r),h.setFont("helvetica","normal");let c=s+h.getTextWidth(a)+5,d=15+k-15,e=h.getTextWidth(b);h.text(b,c+e>d?d-e:c,r),r+=8})}o();let u=d?"cost_data_":"";if(e?.from&&e?.to){let a=(0,N.format)(e.from,"yyyy-MM-dd"),b=(0,N.format)(e.to,"yyyy-MM-dd");g=a===b?`${u}sold_items_${a}.pdf`:`${u}sold_items_${a}_to_${b}.pdf`}else g=`${u}sold_items_${(0,N.format)(new Date,"yyyy-MM-dd")}.pdf`;h.save(g)})(ak,0,j.currency,ag,a,{businessName:j.businessName,businessAddress:j.businessAddress,businessPhone:j.businessPhone,businessEmail:j.businessEmail}),q({title:"Export successful",description:"Sold items exported to PDF file."}))},className:"gap-2 w-full md:w-auto",children:[(0,b.jsx)(A.Download,{className:"h-4 w-4"}),"Export PDF"]})]})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(n.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(y.Input,{placeholder:"Search items...",value:ac,onChange:a=>ad(a.target.value),className:"pl-10"})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(Z.Checkbox,{id:"not-in-inventory",checked:ae,onCheckedChange:a=>{af(!0===a)}}),(0,b.jsx)("label",{htmlFor:"not-in-inventory",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Show only items not in inventory"})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(Z.Checkbox,{id:"cost-data-only",checked:ag,onCheckedChange:a=>{ah(!0===a)},disabled:!l}),(0,b.jsx)("label",{htmlFor:"cost-data-only",className:(0,L.cn)("text-sm font-medium leading-none",!l&&"opacity-50 cursor-not-allowed"),children:"Show only cost data (Item, Quantity, Average Cost, Total Cost)"})]})]})]}),(0,b.jsxs)(x.Card,{children:[(0,b.jsxs)(x.CardHeader,{children:[(0,b.jsxs)(x.CardTitle,{className:"text-lg",children:["Items Sold - ",(()=>{if("specific-date"===v&&U)return(0,N.format)(U,"dd/MM/yyyy");{if("custom"===v&&S.from&&S.to)return`${(0,N.format)(S.from,"dd/MM/yyyy")} to ${(0,N.format)(S.to,"dd/MM/yyyy")}`;let a=(0,E.getDateRangeFromFilter)(v);return a.from.toDateString()===a.to.toDateString()?(0,N.format)(a.from,"dd/MM/yyyy"):`${(0,N.format)(a.from,"dd/MM/yyyy")} to ${(0,N.format)(a.to,"dd/MM/yyyy")}`}})()]}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Click on an item to view all sales containing that item",ac&&` • Showing ${ak.length} of ${ai.length} items`,ae&&` • Filtered to show only items not in current inventory`,ag&&` • Showing only cost data`]})]}),(0,b.jsx)(x.CardContent,{className:"p-0",children:0===ak.length?(0,b.jsx)("div",{className:"p-8 text-center text-muted-foreground",children:ac?"No items found matching your search.":ae?"No sold items found that are not in current inventory.":"No items sold in the selected period."}):(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)(K.Table,{children:[(0,b.jsx)(K.TableHeader,{children:(0,b.jsxs)(K.TableRow,{children:[(0,b.jsx)(K.TableHead,{children:"Item"}),(0,b.jsx)(K.TableHead,{className:"text-right",children:"Qty"}),ag?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(K.TableHead,{className:"text-right",children:"Avg Cost"}),(0,b.jsx)(K.TableHead,{className:"text-right",children:"Total Cost"})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(K.TableHead,{className:"text-right",children:"Avg Price"}),(0,b.jsx)(K.TableHead,{className:"text-right font-bold",children:"Total"}),(0,b.jsx)(K.TableHead,{className:"text-right hidden sm:table-cell",children:"Discount"}),l&&(0,b.jsx)(K.TableHead,{className:"text-right",children:"Cost"}),m&&(0,b.jsx)(K.TableHead,{className:"text-right",children:"Profit"})]})]})}),(0,b.jsx)(K.TableBody,{children:ak.slice(0,2*h.pageSize).map((a,c)=>(0,b.jsxs)(K.TableRow,{className:"cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>{_(a.description),ab(!0)},children:[(0,b.jsx)(K.TableCell,{className:"font-medium max-w-[200px] truncate",children:(0,b.jsxs)($.Tooltip,{children:[(0,b.jsx)($.TooltipTrigger,{asChild:!0,children:(0,b.jsx)("span",{className:"cursor-help",children:a.description})}),(0,b.jsx)($.TooltipContent,{side:"top",className:"max-w-xs",children:(0,b.jsx)("div",{className:"space-y-1",children:(0,b.jsx)("p",{className:"font-bold break-words whitespace-normal",children:a.description})})})]})}),(0,b.jsx)(K.TableCell,{className:"text-right",children:a.totalQuantity}),ag?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(K.TableCell,{className:"text-right",children:l?(0,L.formatCashCurrency)(a.averageCost||0,j.currency):"•••"}),(0,b.jsx)(K.TableCell,{className:"text-right",children:l?(0,L.formatCashCurrency)(a.totalCost,j.currency):"•••"})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(K.TableCell,{className:"text-right",children:o?(0,L.formatCashCurrency)(a.averagePrice,j.currency):"•••"}),(0,b.jsx)(K.TableCell,{className:"text-right font-medium",children:o?(0,L.formatCashCurrency)(a.totalAmount,j.currency):"•••"}),(0,b.jsx)(K.TableCell,{className:"text-right hidden sm:table-cell",children:o?(0,L.formatCashCurrency)(a.totalDiscount,j.currency):"•••"}),l&&(0,b.jsx)(K.TableCell,{className:"text-right text-sales-dark",children:(0,L.formatCashCurrency)(a.totalCost,j.currency)}),m&&(0,b.jsx)(K.TableCell,{className:"text-right font-semibold text-green-600",children:(0,L.formatCashCurrency)(a.totalProfit,j.currency)})]})]},c))})]})})})]}),ak.length>0&&(0,b.jsx)(x.Card,{children:(0,b.jsx)(x.CardContent,{className:"pt-6",children:ag?(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 text-center",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Items"}),(0,b.jsx)("p",{className:"text-lg md:text-2xl font-bold",children:ak.length})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Quantity"}),(0,b.jsx)("p",{className:"text-lg md:text-2xl font-bold",children:ak.reduce((a,b)=>a+b.totalQuantity,0)})]}),(0,b.jsxs)("div",{className:"flex flex-col items-center",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Total Cost"}),(0,b.jsx)("p",{className:"text-lg md:text-2xl font-bold",children:l?(0,L.formatCashCurrency)(ak.reduce((a,b)=>a+b.totalCost,0),j.currency):"•••"})]})]}):(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-center",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Items"}),(0,b.jsx)("p",{className:"text-base sm:text-lg md:text-xl font-bold truncate",children:ak.length})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Quantity"}),(0,b.jsx)("p",{className:"text-base sm:text-lg md:text-xl font-bold truncate",children:ak.reduce((a,b)=>a+b.totalQuantity,0)})]}),(0,b.jsxs)("div",{className:"flex flex-col items-center",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Revenue"}),(0,b.jsx)("p",{className:"text-base sm:text-lg md:text-xl font-bold truncate",children:o?(0,L.formatCashCurrency)(ak.reduce((a,b)=>a+b.totalAmount,0),j.currency):"•••"})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-center",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Discount"}),(0,b.jsx)("p",{className:"text-base sm:text-lg md:text-xl font-bold truncate",children:o?(0,L.formatCashCurrency)(ak.reduce((a,b)=>a+b.totalDiscount,0),j.currency):"•••"})]}),l&&(0,b.jsxs)("div",{className:"flex flex-col items-center",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Cost"}),(0,b.jsx)("p",{className:"text-base sm:text-lg md:text-xl font-bold truncate",children:(0,L.formatCashCurrency)(ak.reduce((a,b)=>a+b.totalCost,0),j.currency)})]}),m&&(0,b.jsxs)("div",{className:"flex flex-col items-center",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Profit"}),(0,b.jsx)("p",{className:"text-base sm:text-lg md:text-xl font-bold truncate",children:(0,L.formatCashCurrency)(ak.reduce((a,b)=>a+b.totalProfit,0),j.currency)})]})]})]})})}),(0,b.jsx)(Y,{isOpen:aa,onOpenChange:ab,itemDescription:W||"",sales:i,currency:j.currency,dateFilter:v,dateRange:S,specificDate:U})]})})};var aa=a.i(669520),ab=a.i(367638),ac=a.i(661042),ad=a.i(609635),ae=a.i(65052),af=a.i(355258),ag=a.i(322658);let ah=({period:a,setPeriod:c,dateRange:d,setDateRange:e,specificDay:f,setSpecificDay:g,onExportCSV:h,onExportPDF:i})=>(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Stock Summary"}),(0,b.jsxs)("div",{className:"flex flex-col md:flex-row gap-2",children:[(0,b.jsxs)(s.Button,{onClick:h,variant:"outline",size:"sm",children:[(0,b.jsx)(A.Download,{className:"h-4 w-4 mr-2"}),"CSV"]}),(0,b.jsxs)(s.Button,{onClick:i,variant:"outline",size:"sm",children:[(0,b.jsx)(B.FileText,{className:"h-4 w-4 mr-2"}),"PDF"]})]})]}),(0,b.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,b.jsx)("div",{className:"w-full md:w-[200px]",children:(0,b.jsxs)(z.Select,{value:a,onValueChange:a=>c(a),children:[(0,b.jsx)(z.SelectTrigger,{className:"bg-white",children:(0,b.jsx)(z.SelectValue,{placeholder:"Select period"})}),(0,b.jsxs)(z.SelectContent,{className:"bg-white",children:[(0,b.jsx)(z.SelectItem,{value:"today",children:"Today"}),(0,b.jsx)(z.SelectItem,{value:"yesterday",children:"Yesterday"}),(0,b.jsx)(z.SelectItem,{value:"this-week",children:"This Week"}),(0,b.jsx)(z.SelectItem,{value:"last-week",children:"Last Week"}),(0,b.jsx)(z.SelectItem,{value:"this-month",children:"This Month"}),(0,b.jsx)(z.SelectItem,{value:"last-month",children:"Last Month"}),(0,b.jsx)(z.SelectItem,{value:"this-year",children:"This Year"}),(0,b.jsx)(z.SelectItem,{value:"all-time",children:"All Time"}),(0,b.jsx)(z.SelectItem,{value:"specific-day",children:"Specific Day"}),(0,b.jsx)(z.SelectItem,{value:"custom",children:"Custom Range"})]})]})}),"specific-day"===a&&(0,b.jsx)("div",{className:"w-full md:w-auto",children:(0,b.jsxs)(Q.Popover,{children:[(0,b.jsx)(Q.PopoverTrigger,{asChild:!0,children:(0,b.jsxs)(s.Button,{variant:"outline",className:(0,L.cn)("w-full md:w-[240px] justify-start text-left font-normal bg-white",!f&&"text-muted-foreground"),children:[(0,b.jsx)(C.CalendarIcon,{className:"mr-2 h-4 w-4"}),f?(0,N.format)(f,"PPP"):(0,b.jsx)("span",{children:"Pick a specific day"})]})}),(0,b.jsx)(Q.PopoverContent,{className:"w-auto p-0 z-[100] bg-white shadow-lg",align:"start",children:(0,b.jsx)(R.Calendar,{mode:"single",selected:f,onSelect:g,initialFocus:!0,className:"p-3 pointer-events-auto"})})]})}),"custom"===a&&(0,b.jsx)(M.default,{dateRange:d,onDateRangeChange:e})]}),(0,b.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Showing data for: ",(0,b.jsx)("span",{className:"font-medium",children:(()=>{switch(a){case"today":return"Today";case"yesterday":return"Yesterday";case"this-week":return"This Week";case"last-week":return"Last Week";case"this-month":default:return"This Month";case"last-month":return"Last Month";case"this-year":return"This Year";case"all-time":return"All Time";case"specific-day":return"Specific Day";case"custom":return"Custom Range"}})()}),"specific-day"===a&&f&&(0,b.jsxs)("span",{className:"ml-2",children:["(",(0,N.format)(f,"MMM d, yyyy"),")"]}),"custom"===a&&d?.from&&d?.to&&(0,b.jsxs)("span",{className:"ml-2",children:["(",(0,N.format)(d.from,"MMM d, yyyy")," - ",(0,N.format)(d.to,"MMM d, yyyy"),")"]})]})]});var ai=a.i(170106);let aj=(0,ai.default)("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);var ak=a.i(795490),al=a.i(585668),am=a.i(371844),an=a.i(882524);let ao=({data:a,isLoading:d,onProductClick:f,onFilteredDataChange:g,currentProducts:h=[]})=>{let{currentBusiness:i}=(0,e.useBusiness)(),{canViewCostPrice:j}=(0,X.useFinancialVisibility)(),k=()=>`stockSummaryTableFilters_${i?.id||"default"}`,m=(()=>{try{let a=localStorage.getItem(k());if(a)return JSON.parse(a)}catch(a){console.warn("Error loading persisted table filters:",a)}return{searchTerm:"",categoryFilter:"all",stockStatusFilter:"all",sortField:"productName",sortOrder:"asc"}})(),[o,p]=(0,c.useState)(m.searchTerm),[r,t]=(0,c.useState)(m.categoryFilter),[u,v]=(0,c.useState)(m.stockStatusFilter),[w,x]=(0,c.useState)(m.sortField),[A,B]=(0,c.useState)(m.sortOrder),[C,D]=(0,c.useState)(1);(0,c.useEffect)(()=>{localStorage.setItem(k(),JSON.stringify({searchTerm:o,categoryFilter:r,stockStatusFilter:u,sortField:w,sortOrder:A}))},[o,r,u,w,A,i?.id]);let E=(0,c.useMemo)(()=>Array.from(new Set(a.map(a=>a.category).filter(Boolean))).sort(),[a]),F=(0,c.useMemo)(()=>{let b=a.filter(a=>{if(o){let b=o.toLowerCase();if(!(a.productName.toLowerCase().includes(b)||a.itemNumber.toLowerCase().includes(b)||a.category&&a.category.toLowerCase().includes(b)))return!1}return("all"===r||a.category===r)&&("all"===u||("in-stock"!==u||!(a.closingStock<=0))&&("out-of-stock"!==u||!(a.closingStock>0))&&("low-stock"!==u||!(a.closingStock>10)&&!(a.closingStock<=0)))&&!0});return b.sort((a,b)=>{let c=0;switch(w){case"productName":c=a.productName.localeCompare(b.productName);break;case"category":c=(a.category||"").localeCompare(b.category||"");break;case"openingStock":c=a.openingStock-b.openingStock;break;case"itemsSold":c=a.itemsSold-b.itemsSold;break;case"stockIn":c=a.stockIn-b.stockIn;break;case"transferOut":c=a.transferOut-b.transferOut;break;case"returnIn":c=a.returnIn-b.returnIn;break;case"returnOut":c=a.returnOut-b.returnOut;break;case"closingStock":c=a.closingStock-b.closingStock}return"asc"===A?c:-c}),b},[a,o,r,u,w,A]),G=Math.ceil(F.length/15),H=(C-1)*15,I=F.slice(H,H+15);(0,c.useEffect)(()=>{D(1)},[o,r,u]),(0,c.useEffect)(()=>{g&&g(F)},[F,g]);let J=a=>{w===a?B("asc"===A?"desc":"asc"):(x(a),B("asc"))},L=a=>w!==a?(0,b.jsx)(aj,{className:"h-4 w-4"}):"asc"===A?(0,b.jsx)(ak.ArrowUp,{className:"h-4 w-4"}):(0,b.jsx)(al.ArrowDown,{className:"h-4 w-4"}),M=c.default.useMemo(()=>F.reduce((a,b)=>({openingStock:a.openingStock+b.openingStock,itemsSold:a.itemsSold+b.itemsSold,stockIn:a.stockIn+b.stockIn,transferOut:a.transferOut+b.transferOut,returnIn:a.returnIn+b.returnIn,returnOut:a.returnOut+b.returnOut,returnOut:a.returnOut+b.returnOut,adjustmentsIn:a.adjustmentsIn+(b.adjustmentsIn||0),adjustmentsOut:a.adjustmentsOut+(b.adjustmentsOut||0),closingStock:a.closingStock+b.closingStock}),{openingStock:0,itemsSold:0,stockIn:0,transferOut:0,returnIn:0,returnOut:0,adjustmentsIn:0,adjustmentsOut:0,closingStock:0}),[F]),N=a=>{D(a)};return d?(0,b.jsx)("div",{className:"flex justify-center py-8",children:(0,b.jsx)(am.default,{})}):(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center relative flex-grow",children:[(0,b.jsx)(n.Search,{className:"h-4 w-4 absolute left-3 text-gray-400"}),(0,b.jsx)(y.Input,{placeholder:"Search products...",className:"pl-9",value:o,onChange:a=>p(a.target.value)})]}),(0,b.jsx)("div",{className:"min-w-[180px]",children:(0,b.jsxs)(z.Select,{value:r,onValueChange:t,children:[(0,b.jsx)(z.SelectTrigger,{children:(0,b.jsx)(z.SelectValue,{placeholder:"All Categories"})}),(0,b.jsxs)(z.SelectContent,{children:[(0,b.jsx)(z.SelectItem,{value:"all",children:"All Categories"}),E.map(a=>(0,b.jsx)(z.SelectItem,{value:a,children:a},a))]})]})}),(0,b.jsx)("div",{className:"min-w-[150px]",children:(0,b.jsxs)(z.Select,{value:u,onValueChange:v,children:[(0,b.jsx)(z.SelectTrigger,{children:(0,b.jsx)(z.SelectValue,{placeholder:"Stock Status"})}),(0,b.jsxs)(z.SelectContent,{children:[(0,b.jsx)(z.SelectItem,{value:"all",children:"All Stock"}),(0,b.jsx)(z.SelectItem,{value:"in-stock",children:"In Stock"}),(0,b.jsx)(z.SelectItem,{value:"low-stock",children:"Low Stock (≤10)"}),(0,b.jsx)(z.SelectItem,{value:"out-of-stock",children:"Out of Stock"})]})]})}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsxs)(l.Badge,{variant:"secondary",className:"text-xs",children:[F.length," ",1===F.length?"product":"products"," found"]}),G>1&&(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Page ",C," of ",G]})]})]}),(0,b.jsxs)($.TooltipProvider,{children:[(0,b.jsxs)("div",{className:"overflow-x-auto",children:[(0,b.jsxs)(K.Table,{children:[(0,b.jsx)(K.TableHeader,{children:(0,b.jsxs)(K.TableRow,{children:[(0,b.jsx)(K.TableHead,{className:"w-[80px]",children:"Image"}),(0,b.jsx)(K.TableHead,{children:"Item #"}),(0,b.jsx)(K.TableHead,{children:(0,b.jsxs)(s.Button,{variant:"ghost",onClick:()=>J("productName"),className:"h-auto p-0 font-medium text-left justify-start hover:bg-transparent",children:["Product Name ",L("productName")]})}),(0,b.jsx)(K.TableHead,{children:(0,b.jsxs)(s.Button,{variant:"ghost",onClick:()=>J("category"),className:"h-auto p-0 font-medium text-left justify-start hover:bg-transparent",children:["Category ",L("category")]})}),(0,b.jsx)(K.TableHead,{className:"text-right",children:(0,b.jsxs)(s.Button,{variant:"ghost",onClick:()=>J("openingStock"),className:"h-auto p-0 font-medium text-right justify-end hover:bg-transparent",children:["Opening Stock ",L("openingStock")]})}),(0,b.jsx)(K.TableHead,{className:"text-right",children:(0,b.jsxs)(s.Button,{variant:"ghost",onClick:()=>J("stockIn"),className:"h-auto p-0 font-medium text-right justify-end hover:bg-transparent",children:["Stock In ",L("stockIn")]})}),(0,b.jsx)(K.TableHead,{className:"text-right",children:(0,b.jsx)(s.Button,{variant:"ghost",onClick:()=>J("transferOut"),className:"h-auto p-0 font-medium text-right justify-end hover:bg-transparent",children:"Stock Out"})}),(0,b.jsx)(K.TableHead,{className:"text-right",children:(0,b.jsxs)(s.Button,{variant:"ghost",onClick:()=>J("closingStock"),className:"h-auto p-0 font-medium text-right justify-end hover:bg-transparent",children:["Closing Stock ",L("closingStock")]})})]})}),(0,b.jsxs)(K.TableBody,{children:[I.map(a=>{let c;return(0,b.jsxs)(K.TableRow,{className:`cursor-pointer hover:bg-muted/50 transition-colors ${(c=h.find(b=>b.id===a.productId))&&c.quantity!==a.closingStock?"bg-red-50 hover:bg-red-100 border-l-4 border-l-red-500":""}`,onClick:()=>f(a.productId),children:[(0,b.jsx)(K.TableCell,{children:(0,b.jsx)(q.default,{imageUrl:a.imageUrl,alt:a.productName,size:"sm"})}),(0,b.jsxs)(K.TableCell,{className:"font-medium truncate max-w-[120px]",children:["#",a.itemNumber]}),(0,b.jsx)(K.TableCell,{className:"truncate max-w-[200px]",children:(0,b.jsxs)($.Tooltip,{children:[(0,b.jsx)($.TooltipTrigger,{asChild:!0,children:(0,b.jsx)("span",{className:"cursor-help",children:a.productName})}),(0,b.jsx)($.TooltipContent,{side:"top",className:"max-w-xs",children:(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("p",{className:"font-bold break-words whitespace-normal",children:a.productName}),a.category&&(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Category: ",a.category]})]})})]})}),(0,b.jsx)(K.TableCell,{children:a.category||"-"}),(0,b.jsx)(K.TableCell,{className:"text-right",children:a.openingStock}),(0,b.jsx)(K.TableCell,{className:"text-right text-green-600 font-medium",children:a.stockIn+a.returnIn+(a.adjustmentsIn||0)}),(0,b.jsx)(K.TableCell,{className:"text-right text-red-600 font-medium",children:a.itemsSold+a.transferOut+a.returnOut+(a.adjustmentsOut||0)}),(0,b.jsx)(K.TableCell,{className:"text-right font-bold",children:a.closingStock})]},a.productId)}),F.length>0&&(0,b.jsxs)(K.TableRow,{className:"font-semibold bg-muted/50 border-t-2",children:[(0,b.jsx)(K.TableCell,{colSpan:4,children:"Total"}),(0,b.jsx)(K.TableCell,{className:"text-right",children:M.openingStock}),(0,b.jsx)(K.TableCell,{className:"text-right text-green-700",children:M.stockIn+M.returnIn+M.adjustmentsIn}),(0,b.jsx)(K.TableCell,{className:"text-right text-red-700",children:M.itemsSold+M.transferOut+M.returnOut+M.adjustmentsOut}),(0,b.jsx)(K.TableCell,{className:"text-right",children:M.closingStock})]})]})]}),0===F.length&&!d&&(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No products found matching your filters."})]}),G>1&&(0,b.jsx)("div",{className:"flex justify-center mt-6",children:(0,b.jsx)(an.Pagination,{children:(0,b.jsxs)(an.PaginationContent,{children:[(0,b.jsx)(an.PaginationItem,{children:(0,b.jsx)(an.PaginationPrevious,{onClick:()=>N(Math.max(1,C-1)),className:1===C?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:Math.min(5,G)},(a,c)=>{let d;return d=G<=5||C<=3?c+1:C>=G-2?G-4+c:C-2+c,(0,b.jsx)(an.PaginationItem,{children:(0,b.jsx)(an.PaginationLink,{onClick:()=>N(d),isActive:C===d,className:"cursor-pointer",children:d})},d)}),(0,b.jsx)(an.PaginationItem,{children:(0,b.jsx)(an.PaginationNext,{onClick:()=>N(Math.min(G,C+1)),className:C===G?"pointer-events-none opacity-50":"cursor-pointer"})})]})})})]})]})},ap=({data:a})=>{let{canViewCostPrice:d}=(0,X.useFinancialVisibility)(),{settings:e}=(0,p.useBusinessSettings)(),f=e?.currency||"UGX",g=a=>`${f} ${(0,L.formatNumber)(a)}`,h=c.default.useMemo(()=>{let b=a.reduce((a,b)=>({openingStock:a.openingStock+b.openingStock*b.costPrice,stockIn:a.stockIn+(b.stockIn+b.returnIn+(b.adjustmentsIn||0))*b.costPrice,stockOut:a.stockOut+(b.itemsSold+b.transferOut+b.returnOut+(b.adjustmentsOut||0))*b.costPrice}),{openingStock:0,stockIn:0,stockOut:0}),c=b.openingStock+b.stockIn-b.stockOut;return{...b,closingStock:c}},[a]);return 0===a.length?null:(0,b.jsxs)(x.Card,{children:[(0,b.jsx)(x.CardHeader,{children:(0,b.jsx)(x.CardTitle,{children:"Stock Summary Overview"})}),(0,b.jsx)(x.CardContent,{children:(0,b.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground font-medium uppercase",children:"Opening Stock Value"}),(0,b.jsx)("p",{className:"text-xl font-bold text-blue-600",children:d?g(h.openingStock):"•••"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground font-medium uppercase",children:"Total Stock In Value"}),(0,b.jsx)("p",{className:"text-xl font-bold text-green-600",children:d?g(h.stockIn):"•••"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground font-medium uppercase",children:"Total Stock Out Value"}),(0,b.jsx)("p",{className:"text-xl font-bold text-red-600",children:d?g(h.stockOut):"•••"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground font-medium uppercase",children:"Closing Stock Value"}),(0,b.jsx)("p",{className:"text-xl font-bold text-purple-600",children:d?g(h.closingStock):"•••"})]})]})})]})};var aq=a.i(342928);let ar=()=>{let a=(0,i.useNavigate)(),{user:e}=(0,d.useAuth)(),{products:g}=(0,f.useProducts)(e?.id,1e4),h=(()=>{try{let a=localStorage.getItem("stockSummaryFilters");if(a){let b=JSON.parse(a);return{period:b.period||"this-month",dateRange:b.dateRange?{from:b.dateRange.from?new Date(b.dateRange.from):(0,af.startOfMonth)(new Date),to:b.dateRange.to?new Date(b.dateRange.to):(0,ag.endOfMonth)(new Date)}:{from:(0,af.startOfMonth)(new Date),to:(0,ag.endOfMonth)(new Date)},specificDay:b.specificDay?new Date(b.specificDay):void 0}}}catch(a){console.error("Error loading persisted stock summary filters:",a)}return{period:"all-time",dateRange:{from:new Date(2020,0,1),to:(0,ac.endOfDay)(new Date)},specificDay:void 0}})(),[j,k]=(0,c.useState)("all-time"),[l,m]=(0,c.useState)(h.dateRange),[n,o]=(0,c.useState)(h.specificDay),[p,q]=(0,c.useState)([]),{stockSummaryData:r,isLoading:t,loadStockSummaryData:u,clearCache:v}=(0,aq.useStockSummaryData)(l),w=async()=>{v(),await u()};return(0,c.useEffect)(()=>{let a=()=>{console.log("Stock updated, refreshing stock summary data"),v(),u()};return window.addEventListener("stock-updated",a),()=>{window.removeEventListener("stock-updated",a)}},[v,u]),(0,c.useEffect)(()=>{let a={period:j,dateRange:{from:l.from?.toISOString(),to:l.to?.toISOString()},specificDay:n?.toISOString()};localStorage.setItem("stockSummaryFilters",JSON.stringify(a))},[j,l,n]),(0,c.useEffect)(()=>{let a,b=new Date;switch(j){case"today":a={from:(0,ab.startOfDay)(b),to:(0,ac.endOfDay)(b)};break;case"yesterday":let c=new Date(b);c.setDate(c.getDate()-1),a={from:(0,ab.startOfDay)(c),to:(0,ac.endOfDay)(c)};break;case"this-week":a={from:(0,ad.startOfWeek)(b),to:(0,ae.endOfWeek)(b)};break;case"last-week":let d=new Date(b);d.setDate(d.getDate()-7),a={from:(0,ad.startOfWeek)(d),to:(0,ae.endOfWeek)(d)};break;case"this-month":a={from:(0,af.startOfMonth)(b),to:(0,ag.endOfMonth)(b)};break;case"last-month":let e=new Date(b);e.setMonth(e.getMonth()-1),a={from:(0,af.startOfMonth)(e),to:(0,ag.endOfMonth)(e)};break;case"this-year":a={from:new Date(b.getFullYear(),0,1),to:new Date(b.getFullYear(),11,31)};break;case"all-time":a={from:new Date(2020,0,1),to:(0,ac.endOfDay)(b)};break;case"specific-day":if(!n)return;a={from:(0,ab.startOfDay)(n),to:(0,ac.endOfDay)(n)};break;default:return}m(a)},[j,n]),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)(x.Card,{children:(0,b.jsxs)(x.CardContent,{className:"pt-6",children:[(0,b.jsx)("div",{className:"flex items-center justify-end mb-4",children:(0,b.jsxs)(s.Button,{onClick:w,variant:"outline",size:"sm",disabled:t,className:"gap-2",children:[(0,b.jsx)(aa.RefreshCw,{className:`h-4 w-4 ${t?"animate-spin":""}`}),"Refresh Data"]})}),(0,b.jsx)(ah,{period:j,setPeriod:k,dateRange:l,setDateRange:m,specificDay:n,setSpecificDay:o,onExportCSV:()=>{let a=new Blob([["Item Number,Product Name,Category,Opening Stock,Items Sold,Stock In,Transfer Out,Return In,Return Out,Closing Stock",...p.map(a=>[a.itemNumber,a.productName,a.category||"",a.openingStock.toString(),a.itemsSold.toString(),a.stockIn.toString(),a.transferOut.toString(),a.returnIn.toString(),a.returnOut.toString(),a.closingStock.toString()]).map(a=>a.map(a=>`"${a}"`).join(","))].join("\n")],{type:"text/csv"}),b=window.URL.createObjectURL(a),c=document.createElement("a");c.href=b,c.download=`stock-summary-filtered-${(0,N.format)(l?.from||new Date,"yyyy-MM-dd")}.csv`,c.click(),window.URL.revokeObjectURL(b)},onExportPDF:()=>{((a,b,c)=>{let d,e=new O.default({orientation:"landscape",unit:"mm",format:"a4",compress:!0}),f=e.internal.pageSize.getWidth(),g=e.internal.pageSize.getHeight(),h=f-15-15,i=15,j=()=>{e.setFontSize(8),e.setFont("helvetica","normal"),e.setTextColor(150,150,150),e.text("Created By Gonza Systems",f/2,g-10,{align:"center"}),e.setTextColor(0,0,0)},k=[20,50,30,25,25,25,25,25,25],l=["Item #","Product Name","Opening Stock","Items Sold","Stock In","Transfer Out","Return In","Return Out","Closing Stock"],m=()=>{e.setFillColor(243,244,246),e.rect(15,i-2,h,8,"F"),e.setLineWidth(.2),e.rect(15,i-2,h,8),e.setFontSize(9),e.setFont("helvetica","bold");let a=15;l.forEach((b,c)=>{let d=k[c],f=e.getTextWidth(b),g=a+(d-f)/2;e.text(b,g,i+5),c<l.length-1&&e.line(a+d,i-2,a+d,i+8-2),a+=d}),i+=8},n=a=>i+a>g-15-15&&(j(),e.addPage(),i=15,m(),e.setFont("helvetica","normal"),e.setFontSize(8),!0);e.setFontSize(18),e.setFont("helvetica","bold");let o="Stock Summary Report",p=e.getTextWidth(o);if(e.text(o,(f-p)/2,i),i+=8,c?.from&&c?.to){e.setFontSize(12),e.setFont("helvetica","normal");let a=(0,N.format)(c.from,"dd/MM/yyyy"),b=(0,N.format)(c.to,"dd/MM/yyyy"),d=a===b?a:`${a} - ${b}`,g=e.getTextWidth(d);e.text(d,(f-g)/2,i),i+=12}else{e.setFontSize(12),e.setFont("helvetica","normal");let a=(0,N.format)(new Date,"dd/MM/yyyy"),b=e.getTextWidth(a);e.text(a,(f-b)/2,i),i+=12}if(0===a.length){e.setFontSize(14),e.setFont("helvetica","normal");let a="No stock data available for the selected period.",b=e.getTextWidth(a);e.text(a,(f-b)/2,i+30)}else{n(18),m(),e.setFont("helvetica","normal"),e.setFontSize(8),a.forEach((a,b)=>{n(12);let c=[a.itemNumber,a.productName,a.openingStock.toString(),a.itemsSold.toString(),a.stockIn.toString(),a.transferOut.toString(),a.returnIn.toString(),a.returnOut.toString(),a.closingStock.toString()];b%2==0&&(e.setFillColor(249,250,251),e.rect(15,i-1,h,7,"F")),e.setLineWidth(.1),e.rect(15,i-1,h,7);let d=15;c.forEach((a,b)=>{let f=k[b],g=a;if(1===b)for(;e.getTextWidth(g)>f-2&&g.length>3;)g=g.substring(0,g.length-4)+"...";let h=d+1;if(b>=2){let a=e.getTextWidth(g);h=d+f-a-1}else if(0===b){let a=e.getTextWidth(g);h=d+(f-a)/2}e.text(g,h,i+4),b<c.length-1&&e.line(d+f,i-1,d+f,i+7-1),d+=f}),i+=7}),i+=15,n(35),e.setFontSize(16),e.setFont("helvetica","bold"),e.text("Summary",15,i),i+=8;let b=a.length,c=a.reduce((a,b)=>a+b.openingStock,0),d=a.reduce((a,b)=>a+b.itemsSold,0),f=a.reduce((a,b)=>a+b.stockIn,0),g=a.reduce((a,b)=>a+b.closingStock,0),j=.8*h;e.setFillColor(248,249,250),e.rect(15,i-3,j,30,"F"),e.setLineWidth(.3),e.setDrawColor(200,200,200),e.rect(15,i-3,j,30),e.setFontSize(11),e.setFont("helvetica","normal");let l=[["Total Products:",b.toString()],["Total Opening Stock:",c.toString()],["Total Items Sold:",d.toString()]],o=[["Total Stock In:",f.toString()],["Total Closing Stock:",g.toString()]],p=i+6,q=30,r=15+j/2+15;l.forEach(([a,b])=>{e.setFont("helvetica","bold"),e.text(a,q,p),e.setFont("helvetica","normal");let c=e.getTextWidth(a);e.text(b,q+c+5,p),p+=6}),p=i+6,o.forEach(([a,b])=>{e.setFont("helvetica","bold"),e.text(a,r,p),e.setFont("helvetica","normal");let c=e.getTextWidth(a);e.text(b,r+c+5,p),p+=6})}if(j(),c?.from&&c?.to){let a=(0,N.format)(c.from,"yyyy-MM-dd"),b=(0,N.format)(c.to,"yyyy-MM-dd");d=a===b?`stock-summary-${a}.pdf`:`stock-summary-${a}_to_${b}.pdf`}else d=`stock-summary-${(0,N.format)(new Date,"yyyy-MM-dd")}.pdf`;e.save(d)})(p,0,l)}})]})}),(0,b.jsx)(x.Card,{children:(0,b.jsx)(x.CardContent,{className:"pt-6",children:(0,b.jsx)(ao,{data:r,isLoading:t,onProductClick:b=>{a(`/inventory/${b}`)},onFilteredDataChange:a=>{q(a)},currentProducts:g})})}),(0,b.jsx)(ap,{data:p})]})};var as=a.i(520606),at=a.i(972270),au=a.i(150897),av=a.i(973308),aw=a.i(915618),ax=a.i(781560),ay=a.i(114548),az=a.i(767552),aA=a.i(405784),aB=a.i(842544),aC=a.i(952765),aD=a.i(315181),aE=a.i(591965),aF=a.i(941675);let aG=({selectedFilter:a,onFilterChange:c})=>(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(aF.Calendar,{size:16}),(0,b.jsxs)(z.Select,{value:a,onValueChange:c,children:[(0,b.jsx)(z.SelectTrigger,{className:"w-[180px]",children:(0,b.jsx)(z.SelectValue,{placeholder:"Select date range"})}),(0,b.jsxs)(z.SelectContent,{children:[(0,b.jsx)(z.SelectItem,{value:"today",children:"Today"}),(0,b.jsx)(z.SelectItem,{value:"yesterday",children:"Yesterday"}),(0,b.jsx)(z.SelectItem,{value:"this-week",children:"This Week"}),(0,b.jsx)(z.SelectItem,{value:"last-week",children:"Last Week"}),(0,b.jsx)(z.SelectItem,{value:"this-month",children:"This Month"}),(0,b.jsx)(z.SelectItem,{value:"last-month",children:"Last Month"}),(0,b.jsx)(z.SelectItem,{value:"this-year",children:"This Year"}),(0,b.jsx)(z.SelectItem,{value:"all",children:"All Time"})]})]})]});var aH=a.i(229805),aI=a.i(870430);let aJ=({open:a,onOpenChange:e,group:h,onConfirm:i})=>{let{user:j}=(0,d.useAuth)(),{products:k}=(0,f.useProducts)(j?.id),[l,m]=(0,c.useState)(""),[n,o]=(0,c.useState)(!1),[p,q]=(0,c.useState)(""),{toast:r}=(0,g.useToast)();(0,c.useEffect)(()=>{h&&(m((0,N.format)(new Date(h.date),"yyyy-MM-dd")),q(""))},[h]);let t=async()=>{if(h&&l&&(()=>{if(!h||!l)return!1;let a=new Date(l);for(let b of(a.setHours(23,59,59,999),h.entries)){let c=k.find(a=>a.id===b.productId);if(c&&c.createdAt){let b=new Date(c.createdAt);if(a<b)return q(`New date cannot be earlier than product creation date (${(0,N.format)(b,"PP")}) for ${c.name}.`),!1}}return!0})()){o(!0);try{await i(new Date(l))&&(r({title:"Dates updated",description:"All entries in this invoice have been updated to the new date."}),e(!1))}catch(a){console.error("Error updating group date:",a),r({title:"Update failed",description:"An error occurred while updating the dates.",variant:"destructive"})}finally{o(!1)}}};return h?(0,b.jsx)(S.Dialog,{open:a,onOpenChange:e,children:(0,b.jsxs)(S.DialogContent,{className:"sm:max-w-md",children:[(0,b.jsxs)(S.DialogHeader,{children:[(0,b.jsx)(S.DialogTitle,{children:"Edit Invoice Date"}),(0,b.jsxs)(S.DialogDescription,{children:["This will update the date for all ",h.entries.length," items in this invoice. Time settings for each item will be preserved."]})]}),(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(aI.Label,{htmlFor:"date",children:"New Date"}),(0,b.jsx)(y.Input,{id:"date",type:"date",value:l,onChange:a=>{m(a.target.value),q("")},className:p?"border-destructive":""}),p&&(0,b.jsx)("p",{className:"text-sm text-destructive",children:p})]}),(0,b.jsxs)("div",{className:"bg-muted p-3 rounded-lg text-sm space-y-1",children:[h.supplier&&(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Supplier:"})," ",h.supplier]}),h.invoice&&(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Invoice:"})," ",h.invoice]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Current Date:"})," ",(0,N.format)(new Date(h.date),"PP")]})]})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-2 mt-4",children:[(0,b.jsx)(s.Button,{variant:"outline",onClick:()=>e(!1),disabled:n,children:"Cancel"}),(0,b.jsx)(s.Button,{onClick:t,disabled:n,children:n?"Updating...":"Update Dates"})]})]})}):null};var aK=a.i(782104),aL=a.i(486192);let aM=({open:a,onOpenChange:c,group:d,onConfirm:e})=>{let f=async()=>{if(!d)return;let a=d.entries.map(a=>a.id);await e(a)&&c(!1)};return d?(0,b.jsx)(aL.AlertDialog,{open:a,onOpenChange:c,children:(0,b.jsxs)(aL.AlertDialogContent,{children:[(0,b.jsxs)(aL.AlertDialogHeader,{children:[(0,b.jsx)(aL.AlertDialogTitle,{children:"Delete Entire Invoice"}),(0,b.jsxs)(aL.AlertDialogDescription,{className:"space-y-2",children:[(0,b.jsx)("p",{children:"Are you sure you want to delete all stock entries for this invoice?"}),(0,b.jsxs)("div",{className:"bg-muted p-3 rounded-lg",children:[(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"Supplier:"})," ",d.supplier]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"Invoice:"})," ",d.invoice]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"Items:"})," ",d.entries.length," products will be affected"]})]}),(0,b.jsx)("p",{className:"text-destructive text-sm",children:"This will permanently remove all stock history entries for this purchase and recalculate stock levels. This action cannot be undone."})]})]}),(0,b.jsxs)(aL.AlertDialogFooter,{children:[(0,b.jsx)(aL.AlertDialogCancel,{children:"Cancel"}),(0,b.jsx)(aL.AlertDialogAction,{onClick:f,className:"bg-destructive hover:bg-destructive/90",children:"Delete Invoice"})]})]})}):null},aN=()=>{var a;let e,{user:g}=(0,d.useAuth)(),h=(0,i.useNavigate)(),{stockHistory:j,isLoading:k,updateStockHistoryEntry:l,deleteStockHistoryEntry:m,deleteMultipleStockHistoryEntries:o,recalculateProductStock:q,loadStockHistory:r}=(0,aB.useStockHistory)(g?.id),{products:t,loadProducts:u}=(0,f.useProducts)(g?.id,1e4),{settings:v}=(0,p.useBusinessSettings)(),{clearAllLocationCaches:w}=(0,aq.useStockSummaryData)({from:void 0,to:void 0}),{formatFinancial:z,canViewCostPrice:A}=(0,X.useFinancialVisibility)(),[B,C]=(0,c.useState)("this-month"),[D,F]=(0,c.useState)(""),[G,H]=(0,c.useState)(""),[I,J]=(0,c.useState)({open:!1,entry:null}),[L,M]=(0,c.useState)({open:!1,group:null}),[O,P]=(0,c.useState)({open:!1,entry:null}),[Q,R]=(0,c.useState)({open:!1,group:null}),[S,U]=(0,c.useState)({}),[V,W]=(0,c.useState)(!1);(0,c.useEffect)(()=>{let a=setTimeout(()=>{H(D)},300);return()=>clearTimeout(a)},[D]);let Y={USD:"$",EUR:"€",GBP:"£",NGN:"₦",GHS:"₵",KES:"KSh",ZAR:"R",EGP:"E£"}[a=v.currency]||a;(0,c.useEffect)(()=>{let a=()=>{r()};return window.addEventListener("stock-history-updated",a),()=>{window.removeEventListener("stock-history-updated",a)}},[r]),(0,c.useEffect)(()=>{(async()=>{if(!j.length||0===t.length||V)return;let a=Array.from(new Set(j.map(a=>a.productId).filter(a=>!!a&&!t.some(b=>b.id===a||b.itemNumber===a)&&!S[a])));if(0!==a.length){W(!0);try{let b=await (0,aC.getActivityByEntityIdsAction)(a),c={...S};b.success&&b.data&&b.data.forEach(a=>{a.entityId&&a.entityName&&!c[a.entityId]&&(c[a.entityId]=a.entityName)}),Object.keys(c).length>Object.keys(S).length&&U(c)}catch(a){console.error("Error scavenging names:",a)}finally{W(!1)}}})()},[j,t,V,S]);let Z=a=>parseFloat(a.toFixed(5)).toLocaleString(),_="all"===B?null:(0,E.getDateRangeFromFilter)(B),{filteredBulkGroups:aa,filteredRegularGroups:ab}=(0,c.useMemo)(()=>{try{if(k||!j.length)return{filteredBulkGroups:[],filteredRegularGroups:[]};let a=j.filter(a=>{try{let b=new Date(a.createdAt),c=!0;return _&&(c=b>=_.from&&b<=_.to),c&&a.newQuantity>a.oldQuantity}catch{return!1}}),b=a.filter(a=>{let b=a.changeReason?.toLowerCase()||"";return b.includes("purchase:")||b.includes("invoice:")||b.includes("supplier:")||b.includes("session:")}),c=a.filter(a=>{let b=a.changeReason?.toLowerCase()||"";return!b.includes("purchase:")&&!b.includes("invoice:")&&!b.includes("supplier:")&&!b.includes("session:")}),d=b.reduce((a,b)=>{try{let c=b.changeReason?.match(/Session: (\d+)/),d=c?c[1]:b.createdAt.toString();if(!a[d]){let c=b.changeReason?.match(/Purchase: ([^|]+)/),e=b.changeReason?.match(/Invoice: ([^|]+)/);a[d]={date:b.createdAt,sessionId:d,supplier:c?c[1].trim():"Unknown Supplier",invoice:e?e[1].trim():"N/A",entries:[]}}return a[d].entries.push(b),a}catch{return a}},{});Object.values(d).forEach(a=>{try{a.entries.sort((a,b)=>{let c=a.changeReason?.match(/Seq: (\d+)/),d=b.changeReason?.match(/Seq: (\d+)/);return c&&d?parseInt(c[1])-parseInt(d[1]):new Date(a.createdAt).getTime()-new Date(b.createdAt).getTime()})}catch{}});let e=c.reduce((a,b)=>{try{let c=(0,N.format)(new Date(b.createdAt),"yyyy-MM-dd");return a[c]||(a[c]={date:b.createdAt,entries:[]}),a[c].entries.push(b),a}catch{return a}},{});Object.values(e).forEach(a=>{try{a.entries.sort((a,b)=>new Date(b.createdAt).getTime()-new Date(a.createdAt).getTime())}catch{}});let f=Object.values(d).sort((a,b)=>new Date(b.date).getTime()-new Date(a.date).getTime()),g=Object.values(e).sort((a,b)=>new Date(b.date).getTime()-new Date(a.date).getTime()),h=f.filter(a=>{if(!G.trim())return!0;try{let b=G.toLowerCase().trim(),c=a.supplier?.toLowerCase()?.includes(b)||!1,d=a.invoice?.toLowerCase()?.includes(b)||!1,e=a.entries.some(a=>{if(!a?.productId)return!1;try{return ac(a).name.toLowerCase().includes(b)}catch{return!1}});return c||d||e}catch{return!1}}),i=g.filter(a=>{if(!G.trim())return!0;try{let b=G.toLowerCase().trim();return a.entries.some(a=>{try{if(!a?.productId)return a.changeReason?.toLowerCase()?.includes(b)||!1;let c=ac(a).name.toLowerCase().includes(b),d=a.changeReason?.toLowerCase()?.includes(b)||!1;return c||d}catch{return!1}})}catch{return!1}});return{filteredBulkGroups:h,filteredRegularGroups:i}}catch(a){return console.error("Error in filtering logic:",a),{filteredBulkGroups:[],filteredRegularGroups:[]}}},[j,t,_,G,k]),ac=(0,c.useCallback)(a=>{try{if(!a)return{name:"Unknown",costPrice:0,sellingPrice:0};let{productId:b,changeReason:c,product:d}=a;if(d)return{name:d.name,costPrice:d.costPrice,sellingPrice:d.sellingPrice};let e=t.find(a=>a.id===b||a.itemNumber===b);if(e)return{name:e.name,costPrice:e.costPrice,sellingPrice:e.sellingPrice};if(c){let a=c.match(/^\[(.*?)\]\s*\|/);if(a)return{name:a[1],costPrice:0,sellingPrice:0}}if(S[b])return{name:S[b],costPrice:0,sellingPrice:0};let f=b||"";return{name:`Deleted Product (${f.length>8?f.slice(-8):f})`,costPrice:0,sellingPrice:0}}catch(a){return console.error("Error in getProductDetails:",a),{name:"Deleted Product",costPrice:0,sellingPrice:0}}},[t,S]),ad=a=>a.reduce((a,b)=>{let c=ac(b),d=b.newQuantity-b.oldQuantity,e=d*c.costPrice;return{totalQty:a.totalQty+d,totalAmount:a.totalAmount+e}},{totalQty:0,totalAmount:0}),ae=a=>{h(`/inventory/${a}`)},af=async(a,b,c,d)=>{let e=j.find(b=>b.id===a);if(!e)return!1;let f=await l(a,b,c,d);return f&&(w(),await Promise.all([q(e.productId),r()])),f},ag=async a=>{let b=j.find(b=>b.id===a);if(!b)return!1;let c=await m(a);return c&&(w(),await Promise.all([q(b.productId),r()])),c},ah=async a=>{if(!L.group)return!1;let b=L.group.entries.map(a=>a.id),c=Array.from(new Set(L.group.entries.map(a=>a.productId)));try{let d=await (0,aD.updateStockHistoryDatesAction)(b,a.toISOString());if(!d.success)throw Error(d.error);return await Promise.all(c.map(a=>q(a))),w(),await Promise.all([r(),u()]),!0}catch(a){return console.error("Error updating invoice date:",a),!1}},ai=async a=>{let b=await o(a);return b&&(w(),await Promise.all([r(),u()]),window.dispatchEvent(new CustomEvent("stock-updated"))),b};return(0,b.jsxs)(x.Card,{className:"mt-6 shadow-sm",children:[(0,b.jsxs)(x.CardHeader,{className:"pb-3 md:pb-6",children:[(0,b.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(aE.History,{size:20}),(0,b.jsxs)("div",{children:[(0,b.jsx)(x.CardTitle,{className:"text-base md:text-lg",children:"Stock Input History"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"View all stock additions and increases"})]})]}),(0,b.jsx)(aG,{selectedFilter:B,onFilterChange:C})]}),(0,b.jsx)("div",{className:"mt-4",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(n.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),(0,b.jsx)(y.Input,{placeholder:"Search by supplier, invoice, or item name...",value:D,onChange:a=>F(a.target.value),className:"pl-10"})]})})]}),(0,b.jsx)(x.CardContent,{className:"p-0",children:k?(0,b.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Loading history..."})}):0===aa.length&&0===ab.length?(0,b.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,b.jsx)(aE.History,{size:48,className:"mx-auto mb-4 opacity-50"}),(0,b.jsx)("p",{children:D.trim()?"No matching stock history found.":"No stock input history found for the selected date range."})]}):(0,b.jsx)($.TooltipProvider,{children:(0,b.jsxs)("div",{className:"space-y-6 p-4",children:[aa.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-primary",children:"Stock Purchases"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Stock purchased from suppliers"})]}),(0,b.jsx)("div",{className:"space-y-6",children:aa.map((a,c)=>{let d=ad(a.entries);return(0,b.jsxs)("div",{className:"border rounded-lg overflow-hidden",children:[(0,b.jsx)("div",{className:"bg-primary/5 px-4 py-3 border-b",children:(0,b.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("h4",{className:"font-semibold text-base",children:(0,N.format)(new Date(a.date),"PPP")}),(0,b.jsxs)("span",{className:"text-xs bg-primary/20 text-primary px-2 py-1 rounded-full",children:[a.entries.length," item",a.entries.length>1?"s":""]})]}),(0,b.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center gap-1 md:gap-4 text-sm text-muted-foreground",children:[(0,b.jsxs)("span",{children:[(0,b.jsx)("strong",{children:"Supplier:"})," ",a.supplier]}),(0,b.jsxs)("span",{children:[(0,b.jsx)("strong",{children:"Invoice:"})," ",a.invoice]})]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(s.Button,{variant:"outline",size:"sm",onClick:()=>{M({open:!0,group:a})},className:"h-8 px-3 text-xs",children:[(0,b.jsx)(T.Edit,{className:"h-3 w-3 mr-1"}),"Edit Date"]}),(0,b.jsxs)(s.Button,{variant:"ghost",size:"sm",onClick:()=>{R({open:!0,group:a})},className:"h-8 px-3 text-xs text-destructive hover:text-destructive",children:[(0,b.jsx)(ax.Trash2,{className:"h-3 w-3 mr-1"}),"Delete Invoice"]})]})]})}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)(K.Table,{children:[(0,b.jsx)(K.TableHeader,{children:(0,b.jsxs)(K.TableRow,{children:[(0,b.jsx)(K.TableHead,{className:"w-[200px]",children:"Item"}),(0,b.jsx)(K.TableHead,{className:"w-[100px]",children:"Qty Added"}),(0,b.jsx)(K.TableHead,{className:"w-[100px]",children:"Price"}),(0,b.jsx)(K.TableHead,{className:"w-[100px]",children:"Amount"}),(0,b.jsx)(K.TableHead,{className:"w-[100px]",children:"Time"}),(0,b.jsx)(K.TableHead,{className:"w-[60px]",children:"Actions"})]})}),(0,b.jsxs)(K.TableBody,{children:[a.entries.map(a=>{let c=ac(a),d=a.newQuantity-a.oldQuantity,e=c.costPrice,f=t.some(b=>b.id===a.productId||b.itemNumber===a.productId);return(0,b.jsxs)(K.TableRow,{children:[(0,b.jsx)(K.TableCell,{className:"font-medium",children:f?(0,b.jsxs)($.Tooltip,{children:[(0,b.jsx)($.TooltipTrigger,{asChild:!0,children:(0,b.jsx)("button",{onClick:()=>ae(a.productId),className:"text-left hover:text-primary hover:underline cursor-pointer transition-colors max-w-[200px] truncate",children:c.name})}),(0,b.jsx)($.TooltipContent,{side:"top",className:"max-w-xs",children:(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("p",{className:"font-bold break-words whitespace-normal",children:c.name}),a.changeReason&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:a.changeReason})]})})]}):(0,b.jsx)("span",{className:"max-w-[200px] truncate block",children:c.name})}),(0,b.jsxs)(K.TableCell,{className:"text-green-700 bg-green-50 font-medium px-3 py-2 rounded-lg border border-green-200",children:[a.oldQuantity," → ",a.newQuantity," (+",Z(d),")"]}),(0,b.jsx)(K.TableCell,{children:A?`${Y}${z(e,"cost")}`:"•••"}),(0,b.jsx)(K.TableCell,{className:"font-medium",children:A?`${Y}${Z(d*e)}`:"•••"}),(0,b.jsx)(K.TableCell,{className:"text-sm text-muted-foreground",children:(0,N.format)(new Date(a.createdAt),"p")}),(0,b.jsx)(K.TableCell,{children:(0,b.jsxs)("div",{className:"flex gap-1",children:[(0,b.jsx)(s.Button,{variant:"ghost",size:"sm",onClick:()=>J({open:!0,entry:a}),className:"h-8 w-8 p-0",children:(0,b.jsx)(T.Edit,{className:"h-4 w-4"})}),(0,b.jsx)(s.Button,{variant:"ghost",size:"sm",onClick:()=>P({open:!0,entry:a}),className:"h-8 w-8 p-0 text-destructive hover:text-destructive",children:(0,b.jsx)(ax.Trash2,{className:"h-4 w-4"})})]})})]},a.id)}),(0,b.jsxs)(K.TableRow,{className:"bg-primary/5 font-semibold border-t-2",children:[(0,b.jsx)(K.TableCell,{className:"font-bold",children:"Total"}),(0,b.jsxs)(K.TableCell,{className:"text-green-700 bg-green-50 font-bold px-3 py-2 rounded-lg border border-green-200",children:["Total: +",Z(d.totalQty)]}),(0,b.jsx)(K.TableCell,{children:"-"}),(0,b.jsx)(K.TableCell,{className:"font-bold",children:A?`${Y}${Z(d.totalAmount)}`:"•••"}),(0,b.jsx)(K.TableCell,{children:"-"}),(0,b.jsx)(K.TableCell,{children:"-"})]})]})]})})]},`purchase-${c}`)})})]}),ab.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-muted-foreground",children:"Regular Stock Additions"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Individual stock additions and manual adjustments"})]}),(0,b.jsx)("div",{className:"space-y-4",children:ab.map((a,c)=>{let d=ad(a.entries);return(0,b.jsxs)("div",{className:"border rounded-lg overflow-hidden",children:[(0,b.jsx)("div",{className:"bg-muted/50 px-4 py-2 border-b",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h4",{className:"font-medium text-sm",children:(0,N.format)(new Date(a.date),"PPP")}),(0,b.jsx)("div",{className:"flex items-center gap-2",children:(0,b.jsxs)("span",{className:"text-xs text-muted-foreground",children:[a.entries.length," item",a.entries.length>1?"s":""]})})]})}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)(K.Table,{children:[(0,b.jsx)(K.TableHeader,{children:(0,b.jsxs)(K.TableRow,{children:[(0,b.jsx)(K.TableHead,{className:"w-[200px]",children:"Item"}),(0,b.jsx)(K.TableHead,{className:"w-[100px]",children:"Qty Added"}),(0,b.jsx)(K.TableHead,{className:"w-[100px]",children:"Price"}),(0,b.jsx)(K.TableHead,{className:"w-[100px]",children:"Amount"}),(0,b.jsx)(K.TableHead,{className:"w-[100px]",children:"Time"}),(0,b.jsx)(K.TableHead,{className:"w-[120px]",children:"Type"})]})}),(0,b.jsxs)(K.TableBody,{children:[a.entries.map(a=>{let c=ac(a),d=a.newQuantity-a.oldQuantity,e=c.costPrice,f=t.some(b=>b.id===a.productId||b.itemNumber===a.productId);return(0,b.jsxs)(K.TableRow,{children:[(0,b.jsx)(K.TableCell,{className:"font-medium",children:f?(0,b.jsxs)($.Tooltip,{children:[(0,b.jsx)($.TooltipTrigger,{asChild:!0,children:(0,b.jsx)("button",{onClick:()=>ae(a.productId),className:"text-left hover:text-primary hover:underline cursor-pointer transition-colors max-w-[200px] truncate",children:c.name})}),(0,b.jsx)($.TooltipContent,{side:"top",className:"max-w-xs",children:(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("p",{className:"font-bold break-words whitespace-normal",children:c.name}),a.changeReason&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:a.changeReason})]})})]}):(0,b.jsx)("span",{className:"max-w-[200px] truncate block",children:c.name})}),(0,b.jsxs)(K.TableCell,{className:"text-green-700 bg-green-50 font-medium px-3 py-2 rounded-lg border border-green-200",children:[a.oldQuantity," → ",a.newQuantity," (+",Z(d),")"]}),(0,b.jsx)(K.TableCell,{children:A?`${Y}${z(e,"cost")}`:"•••"}),(0,b.jsx)(K.TableCell,{className:"font-medium",children:A?`${Y}${Z(d*e)}`:"•••"}),(0,b.jsx)(K.TableCell,{className:"text-sm text-muted-foreground",children:(0,N.format)(new Date(a.createdAt),"p")}),(0,b.jsx)(K.TableCell,{children:(0,b.jsx)("span",{className:"text-xs bg-muted text-muted-foreground px-2 py-1 rounded-full",children:a.changeReason})})]},a.id)}),(0,b.jsxs)(K.TableRow,{className:"bg-muted/30 font-semibold border-t-2",children:[(0,b.jsx)(K.TableCell,{className:"font-bold",children:"Total"}),(0,b.jsxs)(K.TableCell,{className:"text-green-700 bg-green-50 font-bold px-3 py-2 rounded-lg border border-green-200",children:["Total: +",Z(d.totalQty)]}),(0,b.jsx)(K.TableCell,{children:"-"}),(0,b.jsx)(K.TableCell,{className:"font-bold",children:A?`${Y}${Z(d.totalAmount)}`:"•••"}),(0,b.jsx)(K.TableCell,{children:"-"}),(0,b.jsx)(K.TableCell,{children:"-"})]})]})]})})]},`regular-${c}`)})})]})]})})}),(0,b.jsx)(aH.default,{open:I.open,onOpenChange:a=>J({open:a,entry:null}),entry:I.entry,onConfirm:af,productCreatedAt:I.entry&&(e=t.find(a=>a.id===I.entry?.productId))?new Date(e.createdAt):void 0}),(0,b.jsx)(aK.default,{open:O.open,onOpenChange:a=>P({open:a,entry:null}),entry:O.entry,onConfirm:ag}),(0,b.jsx)(aM,{open:Q.open,onOpenChange:a=>R({open:a,group:null}),group:Q.group,onConfirm:ai}),(0,b.jsx)(aJ,{open:L.open,onOpenChange:a=>M({open:a,group:null}),group:L.group,onConfirm:ah})]})},aO="bulkStockAddRows",aP=({row:a,index:c,onUpdateRow:d,onRemoveRow:e,onProductSelect:f,onInputFocus:g,onAddRowAfter:h,onKeyDown:i,onMoveRow:j,settings:k,canRemove:l,products:m,stockEntryDate:n,isLastRow:o,totalRows:p})=>{let q=!!a.productId&&(()=>{let b=m.find(b=>b.id===a.productId);if(b){let a=new Date(b.createdAt),c=new Date(n),d=new Date(a.getFullYear(),a.getMonth(),a.getDate()),e=new Date(c.getFullYear(),c.getMonth(),c.getDate());return d.getTime()>e.getTime()}return!1})(),r=q?m.find(b=>b.id===a.productId):null;return(0,b.jsxs)(x.Card,{className:(0,L.cn)("mb-4 shadow-sm",q&&"border-destructive border-2"),children:[(0,b.jsx)(x.CardHeader,{className:"pb-3",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)(x.CardTitle,{className:"text-sm font-medium",children:["Item #",c+1]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(s.Button,{variant:"outline",size:"icon",onClick:()=>j(a.id,"up"),disabled:0===c,className:"h-8 w-8",children:(0,b.jsx)(az.ChevronUp,{size:14})}),(0,b.jsx)(s.Button,{variant:"outline",size:"icon",onClick:()=>j(a.id,"down"),disabled:c===p-1,className:"h-8 w-8",children:(0,b.jsx)(aA.ChevronDown,{size:14})}),(0,b.jsx)(s.Button,{variant:"outline",size:"icon",onClick:()=>e(a.id),disabled:!l,className:"h-8 w-8",children:(0,b.jsx)(ax.Trash2,{size:14})})]})]})}),(0,b.jsxs)(x.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("label",{className:"text-xs font-medium text-muted-foreground mb-1 block",children:"Product"}),(0,b.jsx)(y.Input,{placeholder:"Type to search products...",value:a.searchTerm,onChange:b=>d(a.id,"searchTerm",b.target.value),onFocus:()=>g(a.id),onKeyDown:b=>i(b,a.id),className:(0,L.cn)("w-full",q&&"border-destructive")}),q&&r&&(0,b.jsxs)("p",{className:"text-xs text-destructive mt-1",children:["Product was created on ",(0,N.format)(new Date(r.createdAt),"PPP")," - after selected date"]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-xs font-medium text-muted-foreground mb-1 block",children:"Quantity"}),(0,b.jsx)(y.Input,{type:"number",min:"0",step:"0.01",value:a.quantity||"",onChange:b=>d(a.id,"quantity",parseFloat(b.target.value)||0),onKeyDown:b=>i(b,a.id),placeholder:"0"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-xs font-medium text-muted-foreground mb-1 block",children:"Price"}),(0,b.jsx)(y.Input,{type:"number",min:"0",step:"0.01",value:a.price||"",onChange:b=>d(a.id,"price",parseFloat(b.target.value)||0),onKeyDown:b=>i(b,a.id),placeholder:"0.00"})]})]}),(0,b.jsx)("div",{className:"bg-muted/50 p-3 rounded-md",children:(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("span",{className:"text-xs font-medium text-muted-foreground",children:"Amount:"}),(0,b.jsxs)("span",{className:"font-semibold",children:[k.currency," ",Math.round(a.amount).toLocaleString()]})]})}),o&&(0,b.jsx)("div",{className:"flex justify-center pt-2",children:(0,b.jsxs)(s.Button,{variant:"ghost",size:"sm",onClick:()=>h(a.id),className:"gap-2 text-muted-foreground hover:text-foreground",children:[(0,b.jsx)(aw.Plus,{size:14}),"Add row below"]})})]})]})},aQ=()=>{let{user:a}=(0,d.useAuth)(),{products:e,updateProduct:i,loadProducts:j}=(0,f.useProducts)(a?.id,1e4),{settings:k}=(0,p.useBusinessSettings)(),{toast:l}=(0,g.useToast)(),m=(0,h.useIsMobile)(),{stockHistory:n,loadStockHistory:o}=(0,aB.useStockHistory)(a?.id),q=a=>{let b=(()=>{if(0===n.length)return null;let a=[...n].sort((a,b)=>a.createdAt.getTime()-b.createdAt.getTime());return a[0]?.createdAt||null})();if(!b)return"";let c=new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0),d=new Date(b.getFullYear(),b.getMonth(),b.getDate(),0,0,0);return c.getTime()===d.getTime()?`Date cannot be the same as the initial stock entry date (${(0,N.format)(b,"PPP")})`:c.getTime()<d.getTime()?`Date cannot be earlier than initial stock date (${(0,N.format)(b,"PPP")})`:""},r=a=>Math.round(a).toLocaleString(),[t,v]=(0,c.useState)(new Date),[z,A]=(0,c.useState)(""),[B,D]=(0,c.useState)(""),[E,F]=(0,c.useState)(()=>{try{let a=localStorage.getItem(aO);if(a){let b=JSON.parse(a).map(a=>({...a,searchTerm:a.searchTerm||a.productName||""}));return b.length>0?b:[{id:"1",productId:"",productName:"",quantity:0,price:0,amount:0,searchTerm:""}]}}catch(a){console.error("Error loading saved stock rows:",a)}return[{id:"1",productId:"",productName:"",quantity:0,price:0,amount:0,searchTerm:""}]}),[G,H]=(0,c.useState)(!1),[I,J]=(0,c.useState)(null);(0,c.useEffect)(()=>{try{localStorage.setItem(aO,JSON.stringify(E))}catch(a){console.error("Error saving stock rows:",a)}},[E]);let M=(0,c.useCallback)(()=>{try{localStorage.removeItem(aO)}catch(a){console.error("Error clearing stored data:",a)}},[]),O=E.find(a=>a.id===I),{suggestions:P,isOpen:S,closePanel:T}=w(e,O?.searchTerm||""),U=(0,c.useCallback)(()=>{let a={id:Date.now().toString(),productId:"",productName:"",quantity:0,price:0,amount:0,searchTerm:""};F(b=>[...b,a])},[]),V=(0,c.useCallback)(a=>{let b={id:Date.now().toString(),productId:"",productName:"",quantity:0,price:0,amount:0,searchTerm:""};F(c=>{let d=c.findIndex(b=>b.id===a),e=[...c];return e.splice(d+1,0,b),e})},[]),W=(0,c.useCallback)((a,b)=>{F(c=>{let d=c.findIndex(b=>b.id===a);if(-1===d)return c;let e="up"===b?d-1:d+1;if(e<0||e>=c.length)return c;let f=[...c];return[f[d],f[e]]=[f[e],f[d]],f})},[]),X=(0,c.useCallback)((a,b)=>{"Enter"!==a.key||a.shiftKey||(a.preventDefault(),V(b))},[V]),Y=(0,c.useCallback)(a=>{E.length>1&&(F(b=>b.filter(b=>b.id!==a)),I===a&&J(null))},[E.length,I]),Z=(0,c.useCallback)((a,b,c)=>{F(d=>d.map(d=>{if(d.id===a){let a={...d,[b]:c};return"searchTerm"===b&&"string"==typeof c&&(e.find(a=>a.name.toLowerCase()===c.toLowerCase())||(a.productId="",a.productName="",a.price=0)),("quantity"===b||"price"===b)&&(a.amount=a.quantity*a.price),a}return d}))},[e]),$=(0,c.useCallback)(a=>{I&&(F(b=>{let c=b.findIndex(b=>b.productId===a.id&&b.id!==I);if(-1!==c){let d=b.find(a=>a.id===I),e=d?.quantity||0,f=b.map((a,b)=>{if(b===c){let b=a.quantity+e;return{...a,quantity:b,amount:b*a.price}}return a}).filter(a=>a.id!==I);return l({title:"Product already in list",description:`Merged "${a.name}" quantity.`}),f.length>0?f:[{id:Date.now().toString(),productId:"",productName:"",quantity:0,price:0,amount:0,searchTerm:""}]}return b.map(b=>b.id===I?{...b,productId:a.id,productName:a.name,searchTerm:a.name,price:a.costPrice,amount:b.quantity*a.costPrice}:b)}),J(null))},[I,l]),_=(0,c.useCallback)(a=>{J(a)},[]),aa=(0,c.useCallback)(()=>{let a=[];return E.forEach((b,c)=>{if(b.productId||a.push(`Row ${c+1}: Please select a product`),b.quantity<=0&&a.push(`Row ${c+1}: Quantity must be greater than 0`),b.price<0&&a.push(`Row ${c+1}: Price cannot be negative`),b.productId){let d=e.find(a=>a.id===b.productId);if(d){let b=new Date(d.createdAt),e=new Date(t),f=new Date(b.getFullYear(),b.getMonth(),b.getDate()),g=new Date(e.getFullYear(),e.getMonth(),e.getDate());f.getTime()>g.getTime()&&a.push(`Row ${c+1}: Product "${d.name}" was created on ${(0,N.format)(b,"PPP")} which is after the selected stock date`)}}}),a},[E,e,t]),ab=(0,c.useCallback)(async()=>{let a=aa(),b=q(t);if(b&&a.push(b),a.length>0)return void l({title:"Validation Error",description:a.join(", "),variant:"destructive"});H(!0);try{let a=0,b=0,c=new Map;E.forEach(a=>{if(a.productId)if(c.has(a.productId)){let b=c.get(a.productId);b.quantity+=a.quantity,b.price=a.price,b.amount=b.quantity*b.price}else c.set(a.productId,{...a})});let d=Array.from(c.values()),f=Date.now().toString(),g=`Purchase: ${z||"Unknown Supplier"} | Invoice: ${B||"N/A"} | Session: ${f}`;for(let c=0;c<d.length;c++){let f=d[c],h=e.find(a=>a.id===f.productId);if(h){let d=h.quantity+f.quantity,e=`${g} | Seq: ${c+1}`;await i(f.productId,{quantity:d,costPrice:f.price},void 0,!1,e,t)?a++:b++}}if(a>0){l({title:"Stock Added Successfully",description:`Added stock for ${a} product${a>1?"s":""}`});let b={id:Date.now().toString(),productId:"",productName:"",quantity:0,price:0,amount:0,searchTerm:""};F([b]),A(""),D(""),M(),await Promise.all([j(),o()]),setTimeout(()=>{window.dispatchEvent(new CustomEvent("inventory-updated")),window.dispatchEvent(new CustomEvent("stock-history-updated"))},100)}b>0&&l({title:"Some Updates Failed",description:`${b} product${b>1?"s":""} could not be updated`,variant:"destructive"})}catch(a){console.error("Error in bulk stock addition:",a),l({title:"Error",description:"Failed to add stock. Please try again.",variant:"destructive"})}finally{H(!1)}},[E,e,i,j,o,l,aa,M,t,z,B]),ac=E.reduce((a,b)=>a+b.amount,0),ad=E.reduce((a,b)=>a+b.quantity,0);return(0,b.jsxs)("div",{className:"space-y-4 md:space-y-6",children:[(0,b.jsxs)(x.Card,{className:"shadow-sm",children:[(0,b.jsx)(x.CardHeader,{className:"pb-3 md:pb-6",children:(0,b.jsxs)("div",{className:"space-y-3 md:space-y-0 md:flex md:items-center md:justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(x.CardTitle,{className:"text-base md:text-lg",children:"Restock in Bulk"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Add stock for multiple products at once"})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,b.jsxs)(Q.Popover,{children:[(0,b.jsx)(Q.PopoverTrigger,{asChild:!0,children:(0,b.jsxs)(s.Button,{variant:"outline",className:"gap-2 justify-start text-left font-normal w-full",children:[(0,b.jsx)(C.CalendarIcon,{size:16}),(0,N.format)(t,"MMM d, yyyy")]})}),(0,b.jsxs)(Q.PopoverContent,{className:"w-auto p-0 z-[100] bg-white shadow-lg",align:"start",children:[(0,b.jsx)(R.Calendar,{mode:"single",selected:t,onSelect:a=>a&&v(a),disabled:a=>{let b=E.filter(a=>a.productId).map(a=>e.find(b=>b.id===a.productId)).filter(Boolean);return 0===b.length?a<new Date("2000-01-01")||a>new Date:a<(b.reduce((a,b)=>{let c=new Date(b.createdAt);return!a||c<a?c:a},null)||new Date("2000-01-01"))||a>new Date},className:(0,L.cn)("p-3 pointer-events-auto",q(t)&&"border-destructive"),initialFocus:!0}),q(t)&&(0,b.jsx)("div",{className:"p-3 border-t bg-destructive/5",children:(0,b.jsx)("p",{className:"text-sm text-destructive",children:q(t)})})]})]}),(0,b.jsx)(y.Input,{placeholder:"Supplier name",value:z,onChange:a=>A(a.target.value),className:"w-full"}),(0,b.jsx)(y.Input,{placeholder:"Invoice number",value:B,onChange:a=>D(a.target.value),className:"w-full"})]}),(0,b.jsxs)("div",{className:"flex space-x-2",children:[(0,b.jsxs)(s.Button,{onClick:U,variant:"outline",className:"gap-2 flex-1 md:flex-none",children:[(0,b.jsx)(aw.Plus,{size:16})," Add Row"]}),(0,b.jsxs)(s.Button,{onClick:ab,disabled:G||0===E.length,className:"gap-2 flex-1 md:flex-none",children:[(0,b.jsx)(ay.Save,{size:16}),G?"Saving...":`Save All (${E.length})`]})]})]})]})}),(0,b.jsxs)(x.CardContent,{className:"p-0 md:p-6",children:[m?(0,b.jsxs)("div",{className:"p-4 space-y-4",children:[E.map((a,c)=>(0,b.jsx)(aP,{row:a,index:c,onUpdateRow:Z,onRemoveRow:Y,onProductSelect:$,onInputFocus:_,onAddRowAfter:V,onKeyDown:X,onMoveRow:W,settings:k,canRemove:E.length>1,products:e,stockEntryDate:t,isLastRow:c===E.length-1,totalRows:E.length},a.id)),(0,b.jsx)(x.Card,{className:"bg-primary/5 border-primary/20",children:(0,b.jsx)(x.CardContent,{className:"p-4",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("span",{className:"font-medium",children:"Total Quantity:"}),(0,b.jsx)("span",{className:"text-lg font-bold text-primary",children:r(ad)})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("span",{className:"font-medium",children:"Total Amount:"}),(0,b.jsxs)("span",{className:"text-lg font-bold text-primary",children:[k.currency," ",r(ac)]})]})]})})})]}):(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)(K.Table,{children:[(0,b.jsx)(K.TableHeader,{children:(0,b.jsxs)(K.TableRow,{children:[(0,b.jsx)(K.TableHead,{className:"w-[300px]",children:"Item"}),(0,b.jsx)(K.TableHead,{className:"w-[120px]",children:"Qty"}),(0,b.jsx)(K.TableHead,{className:"w-[120px]",children:"Price"}),(0,b.jsx)(K.TableHead,{className:"w-[120px]",children:"Amount"}),(0,b.jsx)(K.TableHead,{className:"w-[140px]",children:"Actions"})]})}),(0,b.jsxs)(K.TableBody,{children:[E.map((a,c)=>{let d=!!a.productId&&(()=>{let b=e.find(b=>b.id===a.productId);if(b){let a=new Date(b.createdAt),c=new Date(t),d=new Date(a.getFullYear(),a.getMonth(),a.getDate()),e=new Date(c.getFullYear(),c.getMonth(),c.getDate());return d.getTime()>e.getTime()}return!1})(),f=d?e.find(b=>b.id===a.productId):null;return(0,b.jsxs)(K.TableRow,{className:d?"border-destructive border-2 bg-destructive/5":"",children:[(0,b.jsx)(K.TableCell,{children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(y.Input,{placeholder:"Type to search products...",value:a.searchTerm,onChange:b=>Z(a.id,"searchTerm",b.target.value),onFocus:()=>_(a.id),onKeyDown:b=>X(b,a.id),className:(0,L.cn)("w-full",d&&"border-destructive")}),d&&f&&(0,b.jsxs)("p",{className:"text-xs text-destructive mt-1",children:["Product was created on ",(0,N.format)(new Date(f.createdAt),"PPP")," - after selected date"]})]})}),(0,b.jsx)(K.TableCell,{children:(0,b.jsx)(y.Input,{type:"number",min:"0",step:"0.01",value:a.quantity||"",onChange:b=>Z(a.id,"quantity",parseFloat(b.target.value)||0),onKeyDown:b=>X(b,a.id),placeholder:"0"})}),(0,b.jsx)(K.TableCell,{children:(0,b.jsx)(y.Input,{type:"number",min:"0",step:"0.01",value:a.price||"",onChange:b=>Z(a.id,"price",parseFloat(b.target.value)||0),onKeyDown:b=>X(b,a.id),placeholder:"0.00"})}),(0,b.jsx)(K.TableCell,{children:(0,b.jsxs)("div",{className:"font-medium",children:[k.currency," ",r(a.amount)]})}),(0,b.jsx)(K.TableCell,{children:(0,b.jsxs)("div",{className:"flex gap-1",children:[(0,b.jsx)(s.Button,{variant:"outline",size:"icon",onClick:()=>W(a.id,"up"),disabled:0===c,className:"h-8 w-8",children:(0,b.jsx)(az.ChevronUp,{size:14})}),(0,b.jsx)(s.Button,{variant:"outline",size:"icon",onClick:()=>W(a.id,"down"),disabled:c===E.length-1,className:"h-8 w-8",children:(0,b.jsx)(aA.ChevronDown,{size:14})}),(0,b.jsx)(s.Button,{variant:"outline",size:"icon",onClick:()=>Y(a.id),disabled:1===E.length,className:"h-8 w-8",children:(0,b.jsx)(ax.Trash2,{size:14})})]})})]},a.id)}),(0,b.jsx)(K.TableRow,{className:"border-none",children:(0,b.jsx)(K.TableCell,{colSpan:5,className:"py-1 text-center",children:(0,b.jsxs)(s.Button,{variant:"ghost",size:"sm",onClick:()=>V(E[E.length-1].id),className:"gap-2 text-muted-foreground hover:text-foreground text-xs",children:[(0,b.jsx)(aw.Plus,{size:12}),"Add row below"]})})}),(0,b.jsxs)(K.TableRow,{className:"border-t-2",children:[(0,b.jsx)(K.TableCell,{className:"text-right font-medium",children:"Total Quantity:"}),(0,b.jsx)(K.TableCell,{className:"font-bold text-lg",children:r(ad)}),(0,b.jsx)(K.TableCell,{className:"text-right font-medium",children:"Total Amount:"}),(0,b.jsxs)(K.TableCell,{className:"font-bold text-lg",children:[k.currency," ",r(ac)]}),(0,b.jsx)(K.TableCell,{})]})]})]})}),0===E.length&&(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:'No stock entries. Click "Add Row" to start adding stock.'})]})]}),(0,b.jsx)(u,{suggestions:P,isOpen:S,onClose:T,onSelectProduct:$,searchTerm:O?.searchTerm||""}),(0,b.jsx)(aN,{})]})},aR=(0,ai.default)("ScanBarcode",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M8 7v10",key:"23sfjj"}],["path",{d:"M12 7v10",key:"jspqdw"}],["path",{d:"M17 7v10",key:"578dap"}]]);var aS=a.i(724669),aT=a.i(653277);let aU=(0,ai.default)("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);var aV=a.i(581464),aW=a.i(73570),aX=a.i(823292),aY=a.i(635785),aZ=a.i(277894);let a$=a=>{let b=new Blob([["Product Name,Barcode,System Stock,Actual Stock,Variation",...a.map(a=>[a.product.name,a.product.barcode||"N/A",a.product.quantity.toString(),a.actualStock.toString(),a.variation.toString()]).map(a=>a.map(a=>`"${a.replace(/"/g,'""')}"`).join(","))].join("\n")],{type:"text/csv;charset=utf-8;"}),c=URL.createObjectURL(b),d=document.createElement("a");d.setAttribute("href",c),d.setAttribute("download",`stock_count_${(0,N.format)(new Date,"yyyy-MM-dd_HHmm")}.csv`),document.body.appendChild(d),d.click(),document.body.removeChild(d)},a_=(a,b="Gonza Systems",c)=>{let d=new O.default,e=d.internal.pageSize.getWidth();d.setFontSize(20);let f=c?.auditId?`Stock Count Report - ${c.auditId}`:`Stock Count / Audit Report ${c?.auditNumber?`#${c.auditNumber}`:""}`;if(d.text(f,14,22),d.setFontSize(11),d.setTextColor(100),d.text(`Business: ${b}`,14,30),d.text(`Date: ${(0,N.format)(new Date,"PPP p")}`,14,36),c?.auditorName||c?.contactPerson){let a=42;c.auditorName&&(d.text(`Auditor: ${c.auditorName}`,14,a),a+=6),c.contactPerson&&d.text(`Contact Person: ${c.contactPerson}`,14,a)}let g=a.map(a=>[a.product.name,a.product.barcode||"N/A",a.product.quantity.toString(),a.actualStock.toString(),{content:a.variation>0?`+${a.variation}`:a.variation.toString(),styles:{textColor:a.variation<0?[220,38,38]:a.variation>0?[22,163,74]:[100,116,139]}}]);(0,aZ.default)(d,{head:[["Product Name","Barcode","System","Actual","Variation"]],body:g,startY:c?.auditorName||c?.contactPerson?55:45,theme:"striped",headStyles:{fillColor:[59,130,246]},alternateRowStyles:{fillColor:[248,250,252]},margin:{top:45}});let h=d.lastAutoTable.finalY+25;h<d.internal.pageSize.getHeight()-40&&(d.setDrawColor(200),d.line(14,h,80,h),d.line(e-80,h,e-14,h),d.setFontSize(9),d.setTextColor(50),d.text("Auditor Signature",14,h+5),d.text("Stock Manager Signature",e-80,h+5));let i=d.internal.getNumberOfPages();for(let a=1;a<=i;a++)d.setPage(a),d.setFontSize(8),d.setTextColor(150),d.text("Created By Gonza Systems",d.internal.pageSize.getWidth()/2,d.internal.pageSize.getHeight()-10,{align:"center"});d.save(`stock_audit_${(0,N.format)(new Date,"yyyy-MM-dd_HHmm")}.pdf`)};var a0=a.i(626251),a1=a.i(641710),a2=a.i(50522),a3=a.i(797063);let a4="stockCountData",a5=({rows:a,onUpdate:c,onRemove:d,isAuditMode:e,lastScannedId:f})=>(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)(K.Table,{children:[(0,b.jsx)(K.TableHeader,{children:(0,b.jsxs)(K.TableRow,{className:"bg-muted/50 border-b-2",children:[(0,b.jsx)(K.TableHead,{className:"min-w-[200px] font-bold text-gray-700",children:"Item Details"}),(0,b.jsx)(K.TableHead,{className:"text-center w-[120px] font-bold text-gray-700",children:"System"}),(0,b.jsx)(K.TableHead,{className:"text-center w-[150px] font-bold text-gray-700",children:"Actual Count"}),(0,b.jsx)(K.TableHead,{className:"text-center w-[150px] font-bold text-gray-700",children:"Variation"}),!e&&(0,b.jsx)(K.TableHead,{className:"text-right w-[80px]"})]})}),(0,b.jsx)(K.TableBody,{children:0===a.length?(0,b.jsx)(K.TableRow,{children:(0,b.jsx)(K.TableCell,{colSpan:e?4:5,className:"h-48 text-center bg-slate-50",children:(0,b.jsxs)("div",{className:"flex flex-col items-center gap-2 text-muted-foreground",children:[(0,b.jsx)(aV.Filter,{className:"h-8 w-8 opacity-20"}),(0,b.jsx)("p",{children:e?"No products match your search":"No items recorded yet"})]})})}):a.map(({product:a,actualStock:g,variation:h})=>(0,b.jsxs)(K.TableRow,{id:`row-${a.id}`,className:(0,L.cn)("hover:bg-muted/30 transition-colors",0!==h&&"bg-orange-50/20",f===a.id&&"row-highlight"),children:[(0,b.jsxs)(K.TableCell,{className:"py-4",children:[(0,b.jsx)("div",{className:"font-bold text-gray-900 leading-tight",children:a.name}),(0,b.jsx)("div",{className:"text-[10px] text-muted-foreground font-mono mt-1 uppercase tracking-tighter",children:a.barcode||"NO BARCODE"})]}),(0,b.jsx)(K.TableCell,{className:"text-center text-sm font-medium text-slate-500",children:a.quantity}),(0,b.jsx)(K.TableCell,{className:"text-center",children:(0,b.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,b.jsx)(s.Button,{variant:"outline",size:"icon",className:"h-8 w-8 rounded-full",onClick:()=>c(a,-1,!0),children:"-"}),(0,b.jsx)(y.Input,{type:"number",className:"w-20 text-center font-black text-lg border-2",value:g,onChange:b=>c(a,parseFloat(b.target.value)||0,!1)}),(0,b.jsx)(s.Button,{variant:"outline",size:"icon",className:"h-8 w-8 rounded-full bg-slate-100",onClick:()=>c(a,1,!0),children:"+"})]})}),(0,b.jsx)(K.TableCell,{className:"text-center",children:(0,b.jsxs)("div",{className:(0,L.cn)("inline-flex items-center px-2.5 py-1 rounded-full text-xs font-black ring-1",h>0?"text-emerald-700 bg-emerald-50 ring-emerald-200":h<0?"text-rose-700 bg-rose-50 ring-rose-200":"text-slate-500 bg-slate-50 ring-slate-200"),children:[h>0?(0,b.jsx)(aS.TrendingUp,{className:"h-3 w-3 mr-1"}):h<0?(0,b.jsx)(aT.TrendingDown,{className:"h-3 w-3 mr-1"}):null,h>0?"+":"",h]})}),!e&&(0,b.jsx)(K.TableCell,{className:"text-right px-4",children:(0,b.jsx)(s.Button,{variant:"ghost",size:"icon",onClick:()=>d(a.id),className:"hover:bg-red-50 hover:text-red-600 rounded-full",children:(0,b.jsx)(ax.Trash2,{className:"h-4 w-4"})})})]},a.id))})]})}),a6=()=>{let{user:a}=(0,d.useAuth)(),g=a?.id,{currentBusiness:h}=(0,e.useBusiness)(),{products:i,updateProduct:j,updateProductsBulk:l,loadProducts:m}=(0,f.useProducts)(g,1e4),[o,p]=(0,c.useState)(!1),[q,r]=(0,c.useState)(""),[t,u]=(0,c.useState)("quick"),[v,w]=(0,c.useState)(null),[z,B]=(0,c.useState)(!1),[C,D]=(0,c.useState)(null),[E,F]=(0,c.useState)(""),[G,H]=(0,c.useState)(""),[I,M]=(0,c.useState)(null),[O,P]=(0,c.useState)(null),{stockHistory:Q,isLoading:R,loadStockHistory:S}=(0,aB.useStockHistory)(g),[U,V]=(0,c.useState)(()=>{try{let a=localStorage.getItem(a4);return a?JSON.parse(a):{}}catch(a){return{}}});(0,c.useEffect)(()=>{localStorage.setItem(a4,JSON.stringify(U))},[U]);let W=(0,c.useCallback)((a,b,c=!0)=>{V(d=>{let e=d[a.id]||0;return{...d,[a.id]:Math.max(0,c?e+b:b)}})},[]),X=(0,c.useCallback)(a=>{W(a,1,!0),w(a.id),aX.toast.success(`Tally: ${a.name}`,{duration:1e3,position:"bottom-center"}),setTimeout(()=>w(null),2e3)},[W]);(0,c.useEffect)(()=>{if(v){let a=document.getElementById(`row-${v}`);a&&a.scrollIntoView({behavior:"smooth",block:"center"})}},[v]);let Y=(0,c.useRef)(""),Z=(0,c.useRef)(Date.now());(0,c.useEffect)(()=>{let a=a=>{let b=a.target,c=Date.now(),d=c-Z.current;Z.current=c;let e=/^[a-zA-Z0-9\-_]$/.test(a.key),f="INPUT"===b.tagName||"TEXTAREA"===b.tagName||"true"===b.contentEditable;if(!f&&e&&(a.preventDefault(),a.stopPropagation()),"Enter"===a.key){let b=Y.current.trim();if(b.length>=2){a.preventDefault(),a.stopPropagation(),console.log(`[StockCount Scanner] Processing: "${b}"`);let c=async a=>{let b=await (0,J.lookupProductByBarcodeAction)(a,h?.id||"");return b?(0,aY.mapDbProductToProduct)(b):null};(async()=>{let a=await c(b);if(a){let c=a.barcode||a.itemNumber||b;console.log(`[StockCount Scanner] ✅ Server Match: ${a.name}`),console.log(`[StockCount Scanner] 🔗 Mapping "${b}" -> System Code "${c}"`),X(a)}else console.warn(`[StockCount Scanner] ❌ No server match for: "${b}"`)})(),Y.current="";return}(!f||b.length>=2)&&(Y.current="",a.preventDefault(),a.stopPropagation());return}1===a.key.length&&(d<60&&f&&e&&(a.preventDefault(),a.stopPropagation()),d>100?Y.current=a.key:Y.current+=a.key)};return window.addEventListener("keydown",a,!0),()=>window.removeEventListener("keydown",a,!0)},[g,h?.id]);let $=(0,c.useMemo)(()=>i.filter(a=>U.hasOwnProperty(a.id)).map(a=>{let b=U[a.id];return void 0===b?null:{product:a,actualStock:b,variation:Number((b-a.quantity).toFixed(2))}}).filter(a=>null!==a),[U,i,I]),_=(0,c.useMemo)(()=>{let a=q.toLowerCase();return i.filter(b=>!q||b.name.toLowerCase().includes(a)||b.barcode&&b.barcode.toLowerCase().includes(a)||b.itemNumber&&b.itemNumber.toLowerCase().includes(a)||b.manufacturerBarcode&&b.manufacturerBarcode.toLowerCase().includes(a)).map(a=>{let b=U[a.id]??0;return{product:a,actualStock:b,variation:Number((b-a.quantity).toFixed(2))}})},[U,i,q]),aa=async a=>{let b=Object.keys(U);if(0===b.length)return;if(o)return void console.warn("⚠️ Commit already in progress, ignoring duplicate call");p(!0),B(!1);let c=I||crypto.randomUUID(),d=ab.length+1,e=`AUD-${String(d).padStart(4,"0")}`,f=I?"Stock Count Edit":"Stock Count Update",h=`${e} | ${f}${E?` | Auditor: ${E}`:""}${G?` | Contact: ${G}`:""}`;console.log("🔍 Stock Count Commit Debug:",{shouldUpdateInventory:a,affectedIds:b,sessionId:c,auditId:e,finalReason:h,userId:g,updateCount:b.length});try{if(a){let a=b.map(a=>i.find(b=>b.id===a)?{id:a,updated:{quantity:U[a]}}:null).filter(a=>null!==a);if(a.length>0){if(I){let a=ab.find(a=>a.id===I);if(a){let b=a.items.map(a=>a.id),c=Array.from(new Set(a.items.map(a=>a.productId)));for(let a of(await ac(b),c))await ad(a)}}if(await l(a,g,h,c))aX.toast.success(`Inventory updated! ${a.length} items corrected.`);else throw Error("Bulk update failed")}}else aX.toast.success("Audit completed and cleared (Inventory not changed).");V({}),F(""),H(""),M(null),localStorage.removeItem(a4),await m(),await S()}catch(a){console.error("Commit error:",a),aX.toast.error("An error occurred during completion.")}finally{p(!1)}},ab=(0,c.useMemo)(()=>{let a=Q.filter(a=>a.changeReason?.includes("Stock Count Update")||a.changeReason?.includes("Stock Count Edit")),b={};return a.forEach(a=>{let c=a.referenceId||"unknown",d=a.changeReason?.match(/AUD-\d{4}/),e=d?d[0]:void 0,f=a.changeReason?.includes("Stock Count Edit")||!1;b[c]||(b[c]={id:c,date:a.createdAt,items:[],auditId:e,isEdited:!1}),f&&(b[c].isEdited=!0),b[c].items.find(b=>b.id===a.id)||b[c].items.push(a)}),Object.values(b).sort((a,b)=>a.date.getTime()-b.date.getTime()).map((a,b)=>({...a,auditNumber:b+1})).reverse()},[Q]),{deleteMultipleStockHistoryEntries:ac,recalculateStockChain:ad}=(0,aB.useStockHistory)(g),ae=async a=>{P(null),p(!0);try{let b=a.items.map(a=>a.id),c=Array.from(new Set(a.items.map(a=>a.productId)));if(await ac(b)){for(let a of c)await ad(a);aX.toast.success("Audit deleted and stock restored!"),await m()}else aX.toast.error("Failed to delete audit.")}catch(a){console.error("Delete session error:",a),aX.toast.error("An error occurred.")}finally{p(!1)}};return(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("style",{dangerouslySetInnerHTML:{__html:`
                @keyframes highlight-fade {
                    0% { background-color: rgba(59, 130, 246, 0.2); }
                    100% { background-color: transparent; }
                }
                .row-highlight {
                    animation: highlight-fade 2s ease-out forwards;
                }
            `}}),(0,b.jsxs)(x.Card,{className:"shadow-sm border-2",children:[(0,b.jsx)(x.CardHeader,{className:"pb-3 px-4 md:px-6 bg-muted/20",children:(0,b.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)(x.CardTitle,{className:"text-xl flex items-center gap-2",children:[(0,b.jsx)(aR,{className:"h-6 w-6 text-sales-primary"}),"Inventory Audit"]}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:'Counts are saved locally. Click "Complete Audit" to update the system.'})]}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,b.jsxs)("div",{className:"flex gap-1 mr-2 border-r pr-2",children:[(0,b.jsxs)(s.Button,{variant:"outline",size:"sm",onClick:()=>{let a="quick"===t?$:_;0===a.length?aX.toast.error("No items to export."):a$(a)},disabled:"history"===t||"quick"===t&&0===$.length||"audit"===t&&0===_.length,className:"h-9 gap-2",children:[(0,b.jsx)(A.Download,{className:"h-4 w-4"}),"CSV"]}),(0,b.jsxs)(s.Button,{variant:"outline",size:"sm",onClick:()=>{let a="quick"===t?$:_;0===a.length?aX.toast.error("No items to export."):a_(a,h?.name,{auditorName:E,contactPerson:G})},disabled:"history"===t||"quick"===t&&0===$.length||"audit"===t&&0===_.length,className:"h-9 gap-2",children:[(0,b.jsx)(a0.FileDown,{className:"h-4 w-4"}),"PDF"]})]}),(0,b.jsxs)(s.Button,{variant:"outline",onClick:()=>{0!==Object.keys(U).length&&window.confirm("Clear all recorded counts? progress will be lost.")&&(V({}),localStorage.removeItem(a4),aX.toast.info("Progress cleared."))},disabled:o||0===Object.keys(U).length,className:"text-red-500 border-red-200 hover:bg-red-50 h-9",children:[(0,b.jsx)(ax.Trash2,{className:"h-4 w-4 mr-2"}),"Reset"]}),(0,b.jsxs)(s.Button,{onClick:()=>B(!0),disabled:o||0===Object.keys(U).length,className:"gap-2 bg-sales-primary hover:bg-sales-primary/90 shadow-md h-9 px-4",children:[(0,b.jsx)(ay.Save,{className:"h-4 w-4"}),o?"Syncing...":"Complete Audit"]})]})]})}),(0,b.jsx)(x.CardContent,{className:"p-0",children:(0,b.jsxs)(k.Tabs,{value:t,onValueChange:u,className:"w-full",children:[(0,b.jsx)("div",{className:"px-4 md:px-6 pt-4 border-b",children:(0,b.jsxs)(k.TabsList,{className:"flex w-full md:w-[450px] mb-4 overflow-x-auto",children:[(0,b.jsxs)(k.TabsTrigger,{value:"quick",className:"flex-1 gap-2 whitespace-nowrap",children:[(0,b.jsx)(aR,{className:"h-4 w-4"}),"Quick Scan"]}),(0,b.jsxs)(k.TabsTrigger,{value:"audit",className:"flex-1 gap-2 whitespace-nowrap",children:[(0,b.jsx)(aU,{className:"h-4 w-4"}),"Full List"]}),(0,b.jsxs)(k.TabsTrigger,{value:"history",className:"flex-1 gap-2 whitespace-nowrap",children:[(0,b.jsx)(aE.History,{className:"h-4 w-4"}),"Audit History"]})]})}),(0,b.jsxs)(k.TabsContent,{value:"quick",className:"m-0",children:[(0,b.jsxs)("div",{className:"p-6 text-center bg-sales-primary/5 border-b",children:[(0,b.jsx)("div",{className:"inline-flex items-center justify-center p-3 rounded-full bg-white shadow-sm mb-4",children:(0,b.jsx)(aR,{className:"h-8 w-8 text-sales-primary animate-pulse"})}),(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Scan to Start"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground max-w-xs mx-auto",children:"Just start scanning barcodes. Scanned items will appear below."})]}),(0,b.jsx)(a5,{rows:$,onUpdate:W,onRemove:a=>{let b={...U};delete b[a],V(b)},isAuditMode:!1,lastScannedId:v})]}),(0,b.jsxs)(k.TabsContent,{value:"audit",className:"space-y-4",children:[I&&(0,b.jsxs)("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3 flex items-center gap-2 mx-4 md:mx-6 mt-4",children:[(0,b.jsx)(T.Edit,{className:"h-4 w-4 text-amber-600"}),(0,b.jsx)("span",{className:"text-sm font-medium text-amber-900",children:"Editing Mode: Only showing items from this audit session"})]}),(0,b.jsxs)("div",{className:"p-4 border-b flex items-center gap-4 bg-muted/10",children:[(0,b.jsxs)("div",{className:"relative flex-1 max-w-md",children:[(0,b.jsx)(n.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(y.Input,{placeholder:"Search name or barcode...",className:"pl-10 barcode-friendly",value:q,onChange:a=>r(a.target.value)})]}),(0,b.jsxs)("div",{className:"text-sm font-medium text-muted-foreground",children:["Showing ",_.length," of ",i.length," items"]})]}),(0,b.jsx)(a5,{rows:_,onUpdate:W,isAuditMode:!0,lastScannedId:v})]}),(0,b.jsx)(k.TabsContent,{value:"history",className:"m-0 bg-slate-50/50",children:(0,b.jsx)("div",{className:"p-4 md:p-8",children:(0,b.jsx)("div",{className:"max-w-4xl mx-auto space-y-6",children:R?(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-20 gap-4",children:[(0,b.jsx)("div",{className:"w-8 h-8 border-4 border-sales-primary border-t-transparent rounded-full animate-spin"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Loading history..."})]}):0===ab.length?(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-20 text-center space-y-3 bg-white border-2 border-dashed rounded-3xl",children:[(0,b.jsx)("div",{className:"p-4 rounded-full bg-slate-50",children:(0,b.jsx)(aE.History,{className:"h-10 w-10 text-slate-300"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:"No Audits Found"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Once you complete a stock count, it will appear here."})]})]}):(0,b.jsx)("div",{className:"space-y-4",children:ab.map(a=>(0,b.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm border overflow-hidden hover:shadow-md transition-all cursor-pointer group",onClick:()=>D(C===a.id?null:a.id),children:[(0,b.jsxs)("div",{className:"p-5 flex items-center justify-between gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("div",{className:"h-12 w-12 rounded-xl bg-sales-primary/10 flex items-center justify-center",children:(0,b.jsx)(a1.Clock,{className:"h-6 w-6 text-sales-primary"})}),(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"font-bold text-gray-900 flex items-center gap-2",children:[a.auditId&&(0,b.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-mono font-bold bg-blue-100 text-blue-700 border border-blue-200",children:a.auditId}),(0,b.jsxs)("span",{children:["Audit #",a.auditNumber," — ",(0,N.format)(a.date,"PPP")]}),a.isEdited&&(0,b.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold bg-amber-100 text-amber-700 border border-amber-200",children:"Edited"})]}),(0,b.jsxs)("div",{className:"text-xs text-muted-foreground flex items-center gap-2",children:[(0,b.jsxs)("span",{className:"font-medium bg-slate-100 px-2 py-0.5 rounded-full",children:[a.items.length," Items"]}),(0,b.jsx)("span",{children:"•"}),(0,b.jsx)("span",{children:(0,N.format)(a.date,"p")})]})]})})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity mr-2",children:[(0,b.jsx)(s.Button,{variant:"outline",size:"icon",className:"h-8 w-8 rounded-lg",onClick:b=>{b.stopPropagation(),a$(a.items.map(a=>({product:{...a.product,id:a.productId,quantity:a.oldQuantity},actualStock:a.newQuantity,variation:a.newQuantity-a.oldQuantity})))},title:"Export CSV",children:(0,b.jsx)(A.Download,{className:"h-4 w-4"})}),(0,b.jsx)(s.Button,{variant:"outline",size:"icon",className:"h-8 w-8 rounded-lg",onClick:b=>{let c,d,e,f;b.stopPropagation(),c=a.items.map(a=>({product:{...a.product,id:a.productId,quantity:a.oldQuantity},actualStock:a.newQuantity,variation:a.newQuantity-a.oldQuantity})),e=(d=a.items[0]?.changeReason||"").match(/Auditor: ([^|]*)/),f=d.match(/Contact: ([^|]*)/),a_(c,h?.name,{auditNumber:a.auditNumber,auditorName:e?e[1].trim():void 0,contactPerson:f?f[1].trim():void 0,auditId:a.auditId})},title:"Export PDF",children:(0,b.jsx)(a0.FileDown,{className:"h-4 w-4"})}),(0,b.jsx)(s.Button,{variant:"outline",size:"icon",className:"h-8 w-8 rounded-lg text-amber-600 hover:bg-amber-50 hover:text-amber-700 border-amber-100",onClick:b=>{let c,d,e,f;b.stopPropagation(),c={},a.items.forEach(a=>{c[a.productId]=a.newQuantity}),e=(d=a.items[0]?.changeReason||"").match(/Auditor: ([^|]*)/),f=d.match(/Contact: ([^|]*)/),V(c),F(e?e[1].trim():""),H(f?f[1].trim():""),M(a.id),u("audit"),aX.toast.info(`Editing Audit #${a.auditNumber}`)},title:"Edit Audit",children:(0,b.jsx)(T.Edit,{className:"h-4 w-4"})}),(0,b.jsx)(s.Button,{variant:"outline",size:"icon",className:"h-8 w-8 rounded-lg text-red-500 hover:bg-red-50 hover:text-red-600 border-red-100",onClick:b=>{b.stopPropagation(),P(a)},title:"Delete & Restore Stock",children:(0,b.jsx)(ax.Trash2,{className:"h-4 w-4"})})]}),(0,b.jsx)(s.Button,{variant:"ghost",size:"icon",className:(0,L.cn)("rounded-full transition-transform",C===a.id&&"rotate-90"),children:(0,b.jsx)(a2.ChevronRight,{className:"h-5 w-5"})})]})]}),C===a.id&&(0,b.jsx)("div",{className:"border-t bg-slate-50 p-5 pt-0",children:(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)(K.Table,{children:[(0,b.jsx)(K.TableHeader,{children:(0,b.jsxs)(K.TableRow,{className:"border-b bg-transparent hover:bg-transparent px-0",children:[(0,b.jsx)(K.TableHead,{className:"h-10 px-0",children:"Product"}),(0,b.jsx)(K.TableHead,{className:"h-10 text-center",children:"System"}),(0,b.jsx)(K.TableHead,{className:"h-10 text-center",children:"Actual"}),(0,b.jsx)(K.TableHead,{className:"h-10 text-right",children:"Var"})]})}),(0,b.jsx)(K.TableBody,{children:a.items.map(a=>(0,b.jsxs)(K.TableRow,{className:"hover:bg-transparent px-0",children:[(0,b.jsxs)(K.TableCell,{className:"px-0 py-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"font-medium text-sm",children:a.product?.name||"Deleted Product"}),a.changeReason?.includes("Stock Count Edit")&&(0,b.jsx)("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-[10px] font-bold bg-amber-100 text-amber-700 border border-amber-200",children:"EDITED"})]}),a.referenceId&&"unknown"!==a.referenceId&&(0,b.jsxs)("div",{className:"text-[10px] text-muted-foreground font-mono opacity-50",children:["Session: ",a.referenceId.split("-").pop()]})]}),(0,b.jsx)(K.TableCell,{className:"text-center text-sm py-3",children:a.oldQuantity}),(0,b.jsx)(K.TableCell,{className:"text-center text-sm py-3 font-bold",children:a.newQuantity}),(0,b.jsx)(K.TableCell,{className:"text-right py-3",children:(0,b.jsxs)("span",{className:(0,L.cn)("text-xs font-bold px-2 py-0.5 rounded-full",a.newQuantity>a.oldQuantity?"text-emerald-700 bg-emerald-100":a.newQuantity<a.oldQuantity?"text-rose-700 bg-rose-100":"text-slate-600 bg-slate-100"),children:[a.newQuantity-a.oldQuantity>0?"+":"",a.newQuantity-a.oldQuantity]})})]},a.id))})]})})})]},a.id))})})})})]})})]}),(0,b.jsx)("div",{className:"fixed bottom-6 right-6 pointer-events-none active:opacity-50 transition-opacity",children:(0,b.jsxs)("div",{className:"bg-black/80 text-white px-4 py-3 rounded-2xl shadow-2xl flex items-center gap-3 backdrop-blur-md border border-white/20",children:[(0,b.jsx)("div",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),(0,b.jsx)("span",{className:"text-xs font-bold tracking-widest uppercase",children:"Scanner Active"})]})}),(0,b.jsx)(aL.AlertDialog,{open:z,onOpenChange:B,children:(0,b.jsxs)(aL.AlertDialogContent,{className:"w-[95vw] sm:max-w-md rounded-xl",children:[(0,b.jsxs)(aL.AlertDialogHeader,{children:[(0,b.jsx)(aL.AlertDialogTitle,{children:"Complete Stock Audit"}),(0,b.jsxs)(aL.AlertDialogDescription,{className:"flex flex-col gap-2",children:[(0,b.jsxs)("span",{children:["You have recorded counts for ",Object.keys(U).length," items."]}),I?(0,b.jsxs)("span",{className:"p-2 bg-amber-50 text-amber-800 rounded border border-amber-100 text-xs flex items-center gap-2",children:[(0,b.jsx)(a3.Info,{className:"h-4 w-4 shrink-0 text-amber-500"}),"This will replace the previous records for this audit session with your new counts. All changes will be logged."]}):(0,b.jsx)("span",{children:"Fill in the details below to complete this session."})]})]}),(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-xs font-bold text-muted-foreground uppercase",children:"Name"}),(0,b.jsx)(y.Input,{placeholder:"Auditor name...",value:E,onChange:a=>F(a.target.value),className:"h-10"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-xs font-bold text-muted-foreground uppercase",children:"Phone Number"}),(0,b.jsx)(y.Input,{placeholder:"Contact number...",value:G,onChange:a=>H(a.target.value),className:"h-10",type:"tel"})]})]}),(0,b.jsxs)("div",{className:"pt-2 border-t",children:[(0,b.jsx)("label",{className:"text-xs font-bold text-muted-foreground uppercase block mb-3",children:"Action"}),(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-3",children:[(0,b.jsxs)(s.Button,{className:"w-full justify-start h-auto py-4 px-6 flex flex-col items-start gap-1 whitespace-normal text-left",onClick:()=>aa(!0),children:[(0,b.jsxs)("span",{className:"font-bold flex items-center gap-2 w-full text-left",children:[(0,b.jsx)(ay.Save,{className:"h-4 w-4 shrink-0"}),"Update Inventory Stock"]}),(0,b.jsx)("span",{className:"text-xs font-normal opacity-80 w-full text-left",children:"This will change the quantities in your system to match what you counted."})]}),(0,b.jsxs)(s.Button,{variant:"outline",className:"w-full justify-start h-auto py-4 px-6 flex flex-col items-start gap-1 border-2 whitespace-normal text-left",onClick:()=>aa(!1),children:[(0,b.jsxs)("span",{className:"font-bold flex items-center gap-2 w-full text-left",children:[(0,b.jsx)(aU,{className:"h-4 w-4 shrink-0"}),"Finish Without Updating"]}),(0,b.jsx)("span",{className:"text-xs font-normal text-muted-foreground w-full text-left",children:"Just clear the list and finish. Use this if you already updated manually or just wanted a report."})]})]})]})]}),(0,b.jsx)(aL.AlertDialogFooter,{children:(0,b.jsx)(aL.AlertDialogCancel,{className:"w-full",children:"Cancel"})})]})}),(0,b.jsx)(aL.AlertDialog,{open:!!O,onOpenChange:a=>!a&&P(null),children:(0,b.jsxs)(aL.AlertDialogContent,{className:"w-[95vw] sm:max-w-lg",children:[(0,b.jsxs)(aL.AlertDialogHeader,{children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,b.jsx)("div",{className:"h-12 w-12 rounded-full bg-red-100 flex items-center justify-center",children:(0,b.jsx)(aW.AlertTriangle,{className:"h-6 w-6 text-red-600"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)(aL.AlertDialogTitle,{className:"text-lg",children:"Delete Audit Session?"}),O&&(0,b.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:[O.auditId||`Audit #${O.auditNumber}`," • ",(0,N.format)(O.date,"PPP")]})]})]}),(0,b.jsxs)(aL.AlertDialogDescription,{className:"space-y-3 pt-2",children:[(0,b.jsxs)("p",{className:"text-base",children:["This action will ",(0,b.jsx)("strong",{children:"permanently delete"})," this audit session and all its records."]}),(0,b.jsx)("div",{className:"p-3 bg-amber-50 border border-amber-200 rounded-lg",children:(0,b.jsx)("p",{className:"text-sm text-amber-900 font-medium",children:"⚠️ Stock levels will be recalculated as if this audit never happened."})}),O&&(0,b.jsxs)("div",{className:"text-sm text-muted-foreground",children:[(0,b.jsxs)("strong",{children:[O.items.length," product entries"]})," will be removed from history."]}),(0,b.jsx)("p",{className:"text-sm font-medium text-red-600",children:"This action cannot be undone."})]})]}),(0,b.jsxs)(aL.AlertDialogFooter,{className:"gap-2 sm:gap-2",children:[(0,b.jsx)(aL.AlertDialogCancel,{className:"flex-1",children:"Cancel"}),(0,b.jsxs)(s.Button,{variant:"destructive",className:"flex-1",onClick:()=>O&&ae(O),children:[(0,b.jsx)(ax.Trash2,{className:"h-4 w-4 mr-2"}),"Delete Audit"]})]})]})})]})};var a7=a.i(429246),a8=a.i(613749),a9=a.i(219773),ba=a.i(186344),bb=a.i(468638),bc=a.i(905457),bd=a.i(177156),be=a.i(528671);let bf=async(b,c)=>{let d=document.createElement("div");d.style.position="absolute",d.style.left="-9999px",d.style.width="800px",d.style.padding="40px",d.style.backgroundColor="white",d.style.fontFamily="Arial, sans-serif";let e=b.items.filter(a=>a.quantity>0),f=e.reduce((a,b)=>a+b.quantity,0),g=e.filter(a=>a.urgentItem).length;d.innerHTML=`
    <div style="text-align: center; margin-bottom: 40px;">
      <h1 style="color: #2563eb; font-size: 24px; margin: 0;">PURCHASE REQUISITION</h1>
    </div>
    
    <div style="margin-bottom: 30px;">
      <p><strong>Business:</strong> ${c}</p>
      <p><strong>Date:</strong> ${(0,N.format)(b.createdAt,"PPP")}</p>
      <p><strong>Requisition #:</strong> ${b.requisitionNumber}</p>
      <p><strong>Title:</strong> ${b.title}</p>
      <p><strong>Status:</strong> ${b.status.toUpperCase()}</p>
    </div>
    
    ${e.length>0?`
      <table style="width: 100%; border-collapse: collapse; margin-bottom: 30px;">
        <thead>
          <tr style="background-color: #2563eb; color: white;">
            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">#</th>
            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Item Description</th>
            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Quantity</th>
            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Urgent</th>
            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Supplier/Price</th>
          </tr>
        </thead>
        <tbody>
          ${e.map((a,b)=>`
            <tr style="${a.urgentItem?"background-color: #fef3c7;":""}">
              <td style="border: 1px solid #ddd; padding: 8px;">${b+1}</td>
              <td style="border: 1px solid #ddd; padding: 8px;">${a.productName}</td>
              <td style="border: 1px solid #ddd; padding: 8px;">${Math.round(a.quantity).toLocaleString()}</td>
              <td style="border: 1px solid #ddd; padding: 8px;">${a.urgentItem?"Yes":"No"}</td>
              <td style="border: 1px solid #ddd; padding: 8px;"></td>
            </tr>
          `).join("")}
        </tbody>
      </table>
      
      <div style="margin-bottom: 30px; padding: 15px; background-color: #f8fafc; border-radius: 8px;">
        <h3 style="margin: 0 0 10px 0; color: #1e40af;">SUMMARY</h3>
        <p><strong>Total Items:</strong> ${e.length}</p>
        <p><strong>Total Quantity:</strong> ${f.toLocaleString()}</p>
        <p><strong>Urgent Items:</strong> ${g}</p>
      </div>
    `:`
      <p>No items in this requisition.</p>
    `}
    
    ${b.notes?`
      <div style="margin-bottom: 30px;">
        <h3 style="color: #1e40af;">NOTES</h3>
        <p style="padding: 10px; background-color: #f1f5f9; border-radius: 4px;">${b.notes}</p>
      </div>
    `:""}
    
    <div style="margin-top: 60px;">
      <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
        <div>
          <p>Requested by: _____________________</p>
          <p>Date: _____________</p>
        </div>
        <div>
          <p>Approved by: _____________________</p>
          <p>Date: _____________</p>
        </div>
      </div>
    </div>
  `,document.body.appendChild(d);try{let{generateVectorPDF:c}=await a.A(151788);await c(d,{filename:`Requisition_${b.requisitionNumber}.pdf`,orientation:"portrait",format:"a4",margins:{top:10,right:10,bottom:10,left:10}})}finally{document.body.removeChild(d)}},bg=({requisitions:a,isLoading:d,onRefresh:e,onDelete:f,businessName:g="Your Business Name"})=>{let i=(0,h.useIsMobile)(),[j,k]=(0,c.useState)(null),{currentPage:n,setCurrentPage:o,paginatedItems:p,totalPages:q}=(0,be.usePagination)({items:a,itemsPerPage:10}),r=a=>{switch(a){case"draft":default:return"bg-gray-100 text-gray-800";case"submitted":return"bg-blue-100 text-blue-800";case"approved":return"bg-green-100 text-green-800";case"completed":return"bg-purple-100 text-purple-800"}},t=a=>Math.round(a).toLocaleString(),u=async a=>{try{console.log("Starting PDF generation for requisition:",a.requisitionNumber),await bf(a,g),console.log("PDF generated successfully using alternative method")}catch(a){console.error("PDF generation failed:",a),console.error("Error message:",a.message),console.error("Error stack:",a.stack),alert(`Failed to generate PDF: ${a.message||"Unknown error occurred"}`)}},v=({requisition:a})=>{let c=a.items.reduce((a,b)=>a+b.quantity,0),d=a.items.filter(a=>a.urgentItem).length;return(0,b.jsxs)(x.Card,{className:"mb-4",children:[(0,b.jsx)(x.CardHeader,{className:"pb-3",children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(x.CardTitle,{className:"text-sm font-medium",children:a.title}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[a.requisitionNumber," • ",(0,N.format)(a.createdAt,"MMM d, yyyy")]})]}),(0,b.jsx)(l.Badge,{className:(0,L.cn)("text-xs",r(a.status)),children:a.status})]})}),(0,b.jsxs)(x.CardContent,{className:"pt-0",children:[(0,b.jsxs)("div",{className:"space-y-2 text-xs",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Items:"}),(0,b.jsx)("span",{children:a.items.length})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Total Qty:"}),(0,b.jsx)("span",{children:t(c)})]}),d>0&&(0,b.jsxs)("div",{className:"flex justify-between text-orange-600",children:[(0,b.jsxs)("span",{className:"flex items-center gap-1",children:[(0,b.jsx)(aW.AlertTriangle,{size:12}),"Urgent:"]}),(0,b.jsx)("span",{children:d})]})]}),(0,b.jsxs)("div",{className:"flex gap-2 mt-4",children:[(0,b.jsxs)(s.Button,{variant:"outline",size:"sm",onClick:()=>k(a),className:"flex-1",children:[(0,b.jsx)(bd.Eye,{size:14,className:"mr-1"}),"View"]}),(0,b.jsxs)(s.Button,{variant:"outline",size:"sm",onClick:()=>u(a),className:"flex-1",children:[(0,b.jsx)(A.Download,{size:14,className:"mr-1"}),"PDF"]}),(0,b.jsx)(s.Button,{variant:"outline",size:"sm",onClick:()=>f(a.id),className:"px-2",children:(0,b.jsx)(ax.Trash2,{size:14})})]})]})]})};return d?(0,b.jsx)(x.Card,{children:(0,b.jsx)(x.CardContent,{className:"p-6",children:(0,b.jsxs)("div",{className:"text-center py-8",children:[(0,b.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),(0,b.jsx)("p",{className:"mt-2 text-muted-foreground",children:"Loading requisitions..."})]})})}):0===a.length?(0,b.jsx)(x.Card,{children:(0,b.jsx)(x.CardContent,{className:"p-6",children:(0,b.jsxs)("div",{className:"text-center py-8",children:[(0,b.jsx)(m.Package,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,b.jsx)("h3",{className:"text-lg font-medium mb-2",children:"No requisitions yet"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Create your first requisition to see it appear here."})]})})}):(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)(x.Card,{children:[(0,b.jsx)(x.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)(x.CardTitle,{children:["Saved Requisitions (",a.length,")"]}),(0,b.jsx)(s.Button,{variant:"outline",size:"sm",onClick:e,children:"Refresh"})]})}),(0,b.jsxs)(x.CardContent,{children:[i?(0,b.jsx)("div",{className:"space-y-4",children:p.map(a=>(0,b.jsx)(v,{requisition:a},a.id))}):(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)(K.Table,{children:[(0,b.jsx)(K.TableHeader,{children:(0,b.jsxs)(K.TableRow,{children:[(0,b.jsx)(K.TableHead,{children:"Title"}),(0,b.jsx)(K.TableHead,{children:"Number"}),(0,b.jsx)(K.TableHead,{children:"Date"}),(0,b.jsx)(K.TableHead,{children:"Items"}),(0,b.jsx)(K.TableHead,{children:"Total Qty"}),(0,b.jsx)(K.TableHead,{children:"Status"}),(0,b.jsx)(K.TableHead,{children:"Actions"})]})}),(0,b.jsx)(K.TableBody,{children:p.map(a=>{let c=a.items.reduce((a,b)=>a+b.quantity,0),d=a.items.filter(a=>a.urgentItem).length;return(0,b.jsxs)(K.TableRow,{children:[(0,b.jsx)(K.TableCell,{children:(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:a.title}),d>0&&(0,b.jsxs)("div",{className:"flex items-center gap-1 text-orange-600 text-xs mt-1",children:[(0,b.jsx)(aW.AlertTriangle,{size:10}),d," urgent"]})]})}),(0,b.jsx)(K.TableCell,{className:"font-mono text-sm",children:a.requisitionNumber}),(0,b.jsx)(K.TableCell,{children:(0,N.format)(a.createdAt,"MMM d, yyyy")}),(0,b.jsx)(K.TableCell,{children:a.items.length}),(0,b.jsx)(K.TableCell,{children:t(c)}),(0,b.jsx)(K.TableCell,{children:(0,b.jsx)(l.Badge,{className:(0,L.cn)("text-xs",r(a.status)),children:a.status})}),(0,b.jsx)(K.TableCell,{children:(0,b.jsxs)("div",{className:"flex gap-1",children:[(0,b.jsx)(s.Button,{variant:"outline",size:"sm",onClick:()=>k(a),children:(0,b.jsx)(bd.Eye,{size:14})}),(0,b.jsx)(s.Button,{variant:"outline",size:"sm",onClick:()=>u(a),children:(0,b.jsx)(A.Download,{size:14})}),(0,b.jsx)(s.Button,{variant:"outline",size:"sm",onClick:()=>f(a.id),children:(0,b.jsx)(ax.Trash2,{size:14})})]})})]},a.id)})})]})}),q>1&&(0,b.jsx)("div",{className:"mt-4",children:(0,b.jsx)(an.Pagination,{children:(0,b.jsxs)(an.PaginationContent,{children:[(0,b.jsx)(an.PaginationItem,{children:(0,b.jsx)(an.PaginationPrevious,{onClick:()=>o(Math.max(1,n-1)),className:1===n?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:q},(a,b)=>b+1).map(a=>(0,b.jsx)(an.PaginationItem,{children:(0,b.jsx)(an.PaginationLink,{onClick:()=>o(a),isActive:n===a,className:"cursor-pointer",children:a})},a)),(0,b.jsx)(an.PaginationItem,{children:(0,b.jsx)(an.PaginationNext,{onClick:()=>o(Math.min(q,n+1)),className:n===q?"pointer-events-none opacity-50":"cursor-pointer"})})]})})})]})]}),j&&(0,b.jsxs)(x.Card,{className:"fixed inset-4 z-50 overflow-auto bg-background border shadow-lg",children:[(0,b.jsx)(x.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(x.CardTitle,{children:j.title}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:[j.requisitionNumber," • ",(0,N.format)(j.createdAt,"PPP")]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(l.Badge,{className:(0,L.cn)("text-xs",r(j.status)),children:j.status}),(0,b.jsx)(s.Button,{variant:"outline",size:"sm",onClick:()=>k(null),children:"Close"})]})]})}),(0,b.jsx)(x.CardContent,{children:(0,b.jsxs)("div",{className:"space-y-4",children:[j.notes&&(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"font-medium mb-2",children:"Notes:"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:j.notes})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("h4",{className:"font-medium mb-2",children:["Items (",j.items.length,"):"]}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)(K.Table,{children:[(0,b.jsx)(K.TableHeader,{children:(0,b.jsxs)(K.TableRow,{children:[(0,b.jsx)(K.TableHead,{children:"Item"}),(0,b.jsx)(K.TableHead,{children:"Quantity"}),(0,b.jsx)(K.TableHead,{children:"Urgent"})]})}),(0,b.jsx)(K.TableBody,{children:j.items.map((a,c)=>(0,b.jsxs)(K.TableRow,{className:a.urgentItem?"bg-orange-50":"",children:[(0,b.jsx)(K.TableCell,{children:a.productName}),(0,b.jsx)(K.TableCell,{children:t(a.quantity)}),(0,b.jsx)(K.TableCell,{children:a.urgentItem&&(0,b.jsxs)(l.Badge,{variant:"destructive",className:"text-xs",children:[(0,b.jsx)(aW.AlertTriangle,{size:10,className:"mr-1"}),"Urgent"]})})]},c))})]})})]})]})})]})]})},bh=({row:a,index:c,onUpdateRow:d,onRemoveRow:e,onProductSelect:f,onInputFocus:g,onAddRowAfter:h,onKeyDown:i,onMoveRow:j,canRemove:k,isLastRow:m,totalRows:n})=>(0,b.jsxs)(x.Card,{className:(0,L.cn)("mb-4 shadow-sm",a.urgentItem&&"border-destructive"),children:[(0,b.jsx)(x.CardHeader,{className:"pb-3",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(x.CardTitle,{className:"text-sm font-medium",children:["Item #",c+1]}),a.urgentItem&&(0,b.jsxs)(l.Badge,{variant:"destructive",className:"text-xs",children:[(0,b.jsx)(aW.AlertTriangle,{size:10,className:"mr-1"}),"Urgent"]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(s.Button,{variant:"outline",size:"icon",onClick:()=>j(a.id,"up"),disabled:0===c,className:"h-8 w-8",children:(0,b.jsx)(az.ChevronUp,{size:14})}),(0,b.jsx)(s.Button,{variant:"outline",size:"icon",onClick:()=>j(a.id,"down"),disabled:c===n-1,className:"h-8 w-8",children:(0,b.jsx)(aA.ChevronDown,{size:14})}),(0,b.jsx)(s.Button,{variant:"outline",size:"icon",onClick:()=>e(a.id),disabled:!k,className:"h-8 w-8",children:(0,b.jsx)(ax.Trash2,{size:14})})]})]})}),(0,b.jsxs)(x.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("label",{className:"text-xs font-medium text-muted-foreground mb-1 block",children:"Product"}),(0,b.jsx)(y.Input,{placeholder:"Type to search products...",value:a.searchTerm,onChange:b=>d(a.id,"searchTerm",b.target.value),onFocus:()=>g(a.id),onKeyDown:b=>i(b,a.id),className:"w-full"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-xs font-medium text-muted-foreground mb-1 block",children:"Quantity"}),(0,b.jsx)(y.Input,{type:"number",min:"0",step:"1",value:a.quantity||"",onChange:b=>d(a.id,"quantity",parseInt(b.target.value)||0),onKeyDown:b=>i(b,a.id),placeholder:"0"})]}),(0,b.jsx)("div",{className:"flex items-end",children:(0,b.jsxs)("label",{className:"flex items-center gap-2 text-xs font-medium cursor-pointer",children:[(0,b.jsx)("input",{type:"checkbox",checked:a.urgentItem||!1,onChange:b=>d(a.id,"urgentItem",b.target.checked),className:"rounded"}),"Mark as urgent"]})})]}),m&&(0,b.jsx)("div",{className:"flex justify-center pt-2",children:(0,b.jsxs)(s.Button,{variant:"ghost",size:"sm",onClick:()=>h(a.id),className:"gap-2 text-muted-foreground hover:text-foreground",children:[(0,b.jsx)(aw.Plus,{size:14}),"Add row below"]})})]})]}),bi=()=>{let{user:a}=(0,d.useAuth)(),{products:i}=(0,f.useProducts)(a?.id,1e4),{settings:j}=(0,p.useBusinessSettings)(),{currentBusiness:k}=(0,e.useBusiness)(),{toast:l}=(0,g.useToast)(),m=(0,h.useIsMobile)(),[n,o]=(0,c.useState)([{id:"1",productId:"",productName:"",quantity:0,searchTerm:"",urgentItem:!1}]),[q,r]=(0,c.useState)(""),[t,v]=(0,c.useState)(""),[z,B]=(0,c.useState)(null),[C,D]=(0,c.useState)(!1),E=n.find(a=>a.id===z),{suggestions:F,isOpen:G,closePanel:H}=w(i,E?.searchTerm||""),I=i.filter(a=>a.quantity<=a.minimumStock),[J,L]=(0,c.useState)(!1),[M,P]=(0,c.useState)(1),Q=I.slice((M-1)*15,15*M),R=Math.ceil(I.length/15),{requisitions:S,isLoading:T,loadRequisitions:U,createRequisition:V,deleteRequisition:W}=((a,b)=>{let[d,e]=(0,c.useState)([]),[f,h]=(0,c.useState)(!0),{toast:i}=(0,g.useToast)(),j=async()=>{if(!a||!b){e([]),h(!1);return}try{h(!0);let c=await (0,a9.getRequisitionsAction)(a,b);if(c.success&&c.data)e(c.data.map(a=>({...a,createdAt:new Date(a.createdAt),updatedAt:new Date(a.updatedAt)})));else throw Error(c.error)}catch(a){console.error("Error loading requisitions:",a),i({title:"Error",description:"Failed to load requisitions. Please try again.",variant:"destructive"})}finally{h(!1)}};return(0,c.useEffect)(()=>{j()},[a,b]),{requisitions:d,isLoading:f,loadRequisitions:j,createRequisition:async(c,d,f)=>{if(!a||!b)return null;try{let g,h,j,k,l,m=(h=(g=new Date).getFullYear().toString().slice(-2),j=(g.getMonth()+1).toString().padStart(2,"0"),k=g.getDate().toString().padStart(2,"0"),l=g.getTime().toString().slice(-4),`REQ${h}${j}${k}${l}`),n=await (0,ba.createRequisitionAction)({userId:a,locationId:b,requisitionNumber:m,title:c,items:d,notes:f||null,status:"draft"});if(!n.success||!n.data)throw Error(n.error);let o=n.data,p={...o,createdAt:new Date(o.createdAt),updatedAt:new Date(o.updatedAt)};return e(a=>[p,...a]),i({title:"Requisition created",description:`Requisition ${m} has been created successfully.`}),p}catch(a){return console.error("Error creating requisition:",a),i({title:"Error",description:"Failed to create requisition. Please try again.",variant:"destructive"}),null}},updateRequisition:async(b,c)=>{if(!a)return!1;try{let d=await (0,bb.updateRequisitionAction)(b,a,c);if(!d.success||!d.data)throw Error(d.error);let f=d.data,g={...f,createdAt:new Date(f.createdAt),updatedAt:new Date(f.updatedAt)};return e(a=>a.map(a=>a.id===b?g:a)),i({title:"Requisition updated",description:"Requisition has been updated successfully."}),!0}catch(a){return console.error("Error updating requisition:",a),i({title:"Error",description:"Failed to update requisition. Please try again.",variant:"destructive"}),!1}},deleteRequisition:async b=>{if(!a)return!1;try{let c=await (0,bc.deleteRequisitionAction)(b,a);if(!c.success)throw Error(c.error);return e(a=>a.filter(a=>a.id!==b)),i({title:"Requisition deleted",description:"Requisition has been deleted successfully."}),!0}catch(a){return console.error("Error deleting requisition:",a),i({title:"Error",description:"Failed to delete requisition. Please try again.",variant:"destructive"}),!1}}}})(a?.id,k?.id),X=a=>Math.round(a).toLocaleString(),Y=n.reduce((a,b)=>{if(!b.productId||!b.quantity)return a;let c=i.find(a=>a.id===b.productId);return c?a+c.costPrice*b.quantity:a},0),Z=(0,c.useCallback)(()=>{let a={id:Date.now().toString(),productId:"",productName:"",quantity:0,searchTerm:"",urgentItem:!1};o(b=>[...b,a])},[]),$=(0,c.useCallback)(a=>{let b={id:Date.now().toString(),productId:"",productName:"",quantity:0,searchTerm:"",urgentItem:!1};o(c=>{let d=c.findIndex(b=>b.id===a),e=[...c];return e.splice(d+1,0,b),e})},[]),_=(0,c.useCallback)((a,b)=>{o(c=>{let d=c.findIndex(b=>b.id===a);if(-1===d)return c;let e="up"===b?d-1:d+1;if(e<0||e>=c.length)return c;let f=[...c];return[f[d],f[e]]=[f[e],f[d]],f})},[]),aa=(0,c.useCallback)((a,b)=>{"Enter"!==a.key||a.shiftKey||(a.preventDefault(),$(b))},[$]),ab=(0,c.useCallback)(a=>{n.length>1&&(o(b=>b.filter(b=>b.id!==a)),z===a&&B(null))},[n.length,z]),ac=(0,c.useCallback)((a,b,c)=>{o(d=>d.map(d=>{if(d.id===a){let a={...d,[b]:c};return"searchTerm"===b&&"string"==typeof c&&(i.find(a=>a.name.toLowerCase()===c.toLowerCase())||(a.productId="",a.productName="")),a}return d}))},[i]),ad=(0,c.useCallback)(a=>{z&&(o(b=>b.map(b=>b.id===z?{...b,productId:a.id,productName:a.name,searchTerm:a.name}:b)),B(null))},[z]),ae=(0,c.useCallback)(a=>{B(a)},[]),af=(0,c.useCallback)(a=>{if(n.find(b=>b.productId===a.id))return void l({title:"Item already added",description:`${a.name} is already in the requisition list.`,variant:"destructive"});let b={id:Date.now().toString(),productId:a.id,productName:a.name,quantity:Math.max(1,a.minimumStock-a.quantity),searchTerm:a.name,urgentItem:0===a.quantity};o(a=>[...a,b])},[n,l]),ag=()=>{let a=new Date,b=a.getFullYear().toString().slice(-2),c=(a.getMonth()+1).toString().padStart(2,"0"),d=a.getDate().toString().padStart(2,"0"),e=a.getTime().toString().slice(-4);return`REQ${b}${c}${d}${e}`},ah=(0,c.useCallback)(()=>{let a=new O.default,b=a.internal.pageSize.width;a.setFontSize(20),a.setFont("helvetica","bold"),a.text("PURCHASE REQUISITION",b/2,20,{align:"center"}),a.setFontSize(12),a.setFont("helvetica","normal"),a.text(`Business: ${j.businessName||"Your Business Name"}`,20,40),a.text(`Date: ${(0,N.format)(new Date,"PPP")}`,20,50),a.text(`Requisition #: ${ag()}`,20,60),q&&a.text(`Title: ${q}`,20,70);let c=n.filter(a=>a.productId&&a.quantity>0);if(0===c.length)a.text("No items to requisition.",20,90);else{let b=c.map((a,b)=>{let c=i.find(b=>b.id===a.productId),d=c?c.costPrice*a.quantity:0;return[b+1,a.productName,X(a.quantity),c?`${j.currency} ${X(c.costPrice)}`:"-",`${j.currency} ${X(d)}`,a.urgentItem?"Yes":"No"]});a.autoTable({head:[["#","Item Description","Qty","Unit Cost","Amount","Urgent"]],body:b,startY:q?80:70,theme:"grid",styles:{fontSize:10,cellPadding:3},headStyles:{fillColor:[41,128,185],textColor:255},columnStyles:{0:{cellWidth:15},1:{cellWidth:60},2:{cellWidth:20},3:{cellWidth:30},4:{cellWidth:30},5:{cellWidth:20}}});let d=c.reduce((a,b)=>a+b.quantity,0),e=c.filter(a=>a.urgentItem).length,f=a.lastAutoTable.finalY+20;a.setFont("helvetica","bold"),a.text("SUMMARY:",20,f),a.setFont("helvetica","normal"),a.text(`Total Items: ${c.length}`,20,f+10),a.text(`Total Quantity: ${X(d)}`,20,f+20),a.text(`Total Amount: ${j.currency} ${X(Y)}`,20,f+30),a.text(`Urgent Items: ${e}`,20,f+40)}if(t){let d=c.length>0?a.lastAutoTable.finalY+70:110;d>250&&(a.addPage(),d=30),a.setFont("helvetica","bold"),a.text("NOTES:",20,d),a.setFont("helvetica","normal");let e=a.splitTextToSize(t,b-40);a.text(e,20,d+10)}let d=a.internal.pageSize.height-30;a.setFontSize(10),a.text("Requested by: _____________________",20,d),a.text("Date: _____________",120,d),a.text("Approved by: _____________________",20,d+10),a.text("Date: _____________",120,d+10);let e=`Requisition_${ag()}.pdf`;return a.save(e),e},[n,q,t,j.businessName,i,j.currency,Y]),ai=(0,c.useCallback)(async()=>{if(!a||!k)return;let b=n.filter(a=>a.productId&&a.quantity>0);if(0===b.length)return void l({title:"No items to save",description:"Please add at least one item with a quantity greater than 0.",variant:"destructive"});if(!q.trim())return void l({title:"Title required",description:"Please enter a title for this requisition.",variant:"destructive"});D(!0);try{let a=b.map(a=>({id:a.id,productId:a.productId,productName:a.productName,quantity:a.quantity,urgentItem:a.urgentItem||!1}));await V(q,a,t),o([{id:Date.now().toString(),productId:"",productName:"",quantity:0,searchTerm:"",urgentItem:!1}]),r(""),v("")}catch(a){console.error("Error saving requisition:",a),l({title:"Error",description:"Failed to save requisition. Please try again.",variant:"destructive"})}finally{D(!1)}},[a,k,n,q,t,l,V]),aj=(0,c.useCallback)(()=>{if(0===n.filter(a=>a.productId&&a.quantity>0).length)return void l({title:"No items to download",description:"Please add at least one item with a quantity greater than 0.",variant:"destructive"});let a=ah();l({title:"PDF downloaded",description:`Requisition has been downloaded as ${a}.`})},[n,ah,l]),ak=n.reduce((a,b)=>a+b.quantity,0);return(0,b.jsxs)("div",{className:"space-y-4 md:space-y-6",children:[I.length>0&&(0,b.jsxs)(x.Card,{className:"border-orange-200 bg-orange-50",children:[(0,b.jsx)(x.CardHeader,{className:"pb-3",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)(x.CardTitle,{className:"text-orange-800 flex items-center gap-2",children:[(0,b.jsx)(aW.AlertTriangle,{size:20}),"Low Stock Items (",I.length,")"]}),!J&&I.length>15&&(0,b.jsx)(s.Button,{variant:"ghost",size:"sm",onClick:()=>L(!0),className:"text-orange-700 hover:text-orange-800",children:"View All"})]})}),(0,b.jsxs)(x.CardContent,{children:[(0,b.jsx)("p",{className:"text-sm text-orange-700 mb-3",children:"The following items are running low or out of stock. Click to add them to your requisition:"}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(J?Q:I.slice(0,5)).map(a=>(0,b.jsxs)(s.Button,{variant:"outline",size:"sm",onClick:()=>af(a),className:"text-xs border-orange-300 hover:bg-orange-100",children:[a.name," (",a.quantity,"/",a.minimumStock,")"]},a.id)),!J&&I.length>5&&(0,b.jsxs)("span",{className:"text-xs text-orange-600 self-center",children:["+",I.length-5," more items"]})]}),J&&(0,b.jsxs)("div",{className:"mt-4 flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(s.Button,{variant:"outline",size:"sm",onClick:()=>P(a=>Math.max(1,a-1)),disabled:1===M,children:[(0,b.jsx)(a8.ChevronLeft,{size:14}),"Previous"]}),(0,b.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Page ",M," of ",R]}),(0,b.jsxs)(s.Button,{variant:"outline",size:"sm",onClick:()=>P(a=>Math.min(R,a+1)),disabled:M===R,children:["Next",(0,b.jsx)(a2.ChevronRight,{size:14})]})]}),(0,b.jsx)(s.Button,{variant:"ghost",size:"sm",onClick:()=>{L(!1),P(1)},className:"text-orange-700 hover:text-orange-800",children:"Show Less"})]})]})]}),(0,b.jsxs)(x.Card,{className:"shadow-sm",children:[(0,b.jsx)(x.CardHeader,{className:"pb-3 md:pb-6",children:(0,b.jsxs)("div",{className:"space-y-3 md:space-y-0 md:flex md:items-start md:justify-between",children:[(0,b.jsxs)("div",{className:"space-y-3 flex-1",children:[(0,b.jsx)(x.CardTitle,{className:"text-base md:text-lg",children:"Purchase Requisition"}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium text-muted-foreground mb-1 block",children:"Requisition Title *"}),(0,b.jsx)(y.Input,{placeholder:"Enter requisition title",value:q,onChange:a=>r(a.target.value),className:"w-full"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium text-muted-foreground mb-1 block",children:"Notes"}),(0,b.jsx)(a7.Textarea,{placeholder:"Additional notes or requirements",value:t,onChange:a=>v(a.target.value),className:"w-full min-h-[60px]"})]})]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(s.Button,{onClick:Z,variant:"outline",className:"gap-2 flex-1 md:flex-none",children:[(0,b.jsx)(aw.Plus,{size:16})," Add Item"]}),(0,b.jsx)(s.Button,{onClick:ai,disabled:C,variant:"secondary",className:"gap-2 flex-1 md:flex-none",children:"Save"}),(0,b.jsxs)(s.Button,{onClick:aj,className:"gap-2 flex-1 md:flex-none",children:[(0,b.jsx)(A.Download,{size:16})," PDF"]})]})]})}),(0,b.jsxs)(x.CardContent,{className:"p-0 md:p-6",children:[m?(0,b.jsxs)("div",{className:"p-4 space-y-4",children:[n.map((a,c)=>(0,b.jsx)(bh,{row:a,index:c,onUpdateRow:ac,onRemoveRow:ab,onProductSelect:ad,onInputFocus:ae,onAddRowAfter:$,onKeyDown:aa,onMoveRow:_,canRemove:n.length>1,isLastRow:c===n.length-1,totalRows:n.length},a.id)),(0,b.jsx)(x.Card,{className:"bg-primary/5 border-primary/20",children:(0,b.jsx)(x.CardContent,{className:"p-4",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("span",{className:"font-medium",children:"Total Quantity:"}),(0,b.jsx)("span",{className:"text-lg font-bold text-primary",children:X(ak)})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("span",{className:"font-medium",children:"Total Amount:"}),(0,b.jsxs)("span",{className:"text-lg font-bold text-primary",children:[j.currency," ",X(Y)]})]})]})})})]}):(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)(K.Table,{children:[(0,b.jsx)(K.TableHeader,{children:(0,b.jsxs)(K.TableRow,{children:[(0,b.jsx)(K.TableHead,{className:"w-[250px]",children:"Item"}),(0,b.jsx)(K.TableHead,{className:"w-[80px]",children:"Qty"}),(0,b.jsx)(K.TableHead,{className:"w-[100px]",children:"Unit Cost"}),(0,b.jsx)(K.TableHead,{className:"w-[100px]",children:"Amount"}),(0,b.jsx)(K.TableHead,{className:"w-[80px]",children:"Urgent"}),(0,b.jsx)(K.TableHead,{className:"w-[140px]",children:"Actions"})]})}),(0,b.jsxs)(K.TableBody,{children:[n.map((a,c)=>{let d=i.find(b=>b.id===a.productId),e=d&&a.quantity?d.costPrice*a.quantity:0;return(0,b.jsxs)(K.TableRow,{className:a.urgentItem?"bg-destructive/5":"",children:[(0,b.jsx)(K.TableCell,{children:(0,b.jsx)("div",{className:"relative",children:(0,b.jsx)(y.Input,{placeholder:"Type to search products...",value:a.searchTerm,onChange:b=>ac(a.id,"searchTerm",b.target.value),onFocus:()=>ae(a.id),onKeyDown:b=>aa(b,a.id),className:"w-full"})})}),(0,b.jsx)(K.TableCell,{children:(0,b.jsx)(y.Input,{type:"number",min:"0",step:"1",value:a.quantity||"",onChange:b=>ac(a.id,"quantity",parseInt(b.target.value)||0),onKeyDown:b=>aa(b,a.id),placeholder:"0"})}),(0,b.jsx)(K.TableCell,{className:"text-sm",children:d?`${j.currency} ${X(d.costPrice)}`:"-"}),(0,b.jsx)(K.TableCell,{className:"text-sm font-medium",children:e>0?`${j.currency} ${X(e)}`:"-"}),(0,b.jsx)(K.TableCell,{children:(0,b.jsx)("input",{type:"checkbox",checked:a.urgentItem||!1,onChange:b=>ac(a.id,"urgentItem",b.target.checked),className:"rounded"})}),(0,b.jsx)(K.TableCell,{children:(0,b.jsxs)("div",{className:"flex gap-1",children:[(0,b.jsx)(s.Button,{variant:"outline",size:"icon",onClick:()=>_(a.id,"up"),disabled:0===c,className:"h-8 w-8",children:(0,b.jsx)(az.ChevronUp,{size:14})}),(0,b.jsx)(s.Button,{variant:"outline",size:"icon",onClick:()=>_(a.id,"down"),disabled:c===n.length-1,className:"h-8 w-8",children:(0,b.jsx)(aA.ChevronDown,{size:14})}),(0,b.jsx)(s.Button,{variant:"outline",size:"icon",onClick:()=>ab(a.id),disabled:1===n.length,className:"h-8 w-8",children:(0,b.jsx)(ax.Trash2,{size:14})})]})})]},a.id)}),(0,b.jsx)(K.TableRow,{className:"border-none",children:(0,b.jsx)(K.TableCell,{colSpan:6,className:"py-1 text-center",children:(0,b.jsxs)(s.Button,{variant:"ghost",size:"sm",onClick:()=>$(n[n.length-1].id),className:"gap-2 text-muted-foreground hover:text-foreground text-xs",children:[(0,b.jsx)(aw.Plus,{size:12}),"Add row below"]})})}),(0,b.jsxs)(K.TableRow,{className:"border-t-2",children:[(0,b.jsx)(K.TableCell,{className:"text-right font-medium",children:"Totals:"}),(0,b.jsx)(K.TableCell,{className:"font-bold text-lg",children:X(ak)}),(0,b.jsx)(K.TableCell,{}),(0,b.jsxs)(K.TableCell,{className:"font-bold text-lg",children:[j.currency," ",X(Y)]}),(0,b.jsx)(K.TableCell,{colSpan:2})]})]})]})}),0===n.length&&(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:'No items added. Click "Add Item" to start creating your requisition.'})]})]}),(0,b.jsx)(u,{suggestions:F,isOpen:G,onClose:H,onSelectProduct:ad,searchTerm:E?.searchTerm||""}),(0,b.jsx)(bg,{requisitions:S,isLoading:T,onRefresh:U,onDelete:W,businessName:j.businessName})]})};var bj=a.i(894944);let bk=(0,ai.default)("ListFilter",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M7 12h10",key:"b7w52i"}],["path",{d:"M10 18h4",key:"1ulq68"}]]),bl=(0,ai.default)("Truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]]),bm=(0,ai.default)("FileUp",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 12v6",key:"3ahymv"}],["path",{d:"m15 15-3-3-3 3",key:"15xj92"}]]),bn=(0,ai.default)("Scale",[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]]),bo=({isLoading:a,onRefresh:c,onDownloadTemplate:d,onCSVUpload:e})=>{let f=(0,i.useNavigate)(),g=(0,h.useIsMobile)(),{hasPermission:j}=(0,W.useProfiles)();return(0,b.jsx)("div",{className:"space-y-4",children:(0,b.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("div",{className:"flex items-center gap-2",children:(0,b.jsx)("h1",{className:"text-xl md:text-2xl lg:text-3xl font-bold text-sales-dark",children:"Inventory Overview"})}),(0,b.jsx)("p",{className:"text-sm md:text-base text-muted-foreground",children:"Monitor your inventory health and analyze sales performance"})]}),g?(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex gap-2",children:[j("inventory","create")&&(0,b.jsxs)(s.Button,{onClick:()=>f("/inventory/new"),className:"flex-1 gap-2 min-h-[44px]",children:[(0,b.jsx)(aw.Plus,{size:16})," Add Product"]}),(0,b.jsx)(s.Button,{onClick:c,variant:"outline",size:"icon",disabled:a,className:"shrink-0 min-h-[44px] min-w-[44px]",children:(0,b.jsx)(aa.RefreshCw,{className:`h-4 w-4 ${a?"animate-spin":""}`})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,b.jsxs)(s.Button,{onClick:()=>f("/products"),variant:"outline",className:"gap-1 text-xs min-h-[40px]",children:[(0,b.jsx)(bk,{size:14})," Products"]}),j("inventory","view")&&(0,b.jsxs)(s.Button,{onClick:()=>f("/inventory/carriage-inwards"),variant:"outline",className:"gap-1 text-xs min-h-[40px]",children:[(0,b.jsx)(bl,{size:14})," Carriage"]})]}),j("inventory","create")&&(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,b.jsxs)(s.Button,{onClick:d,variant:"outline",className:"gap-1 text-xs min-h-[40px]",children:[(0,b.jsx)(a0.FileDown,{size:14})," Template"]}),(0,b.jsxs)(s.Button,{onClick:e,variant:"outline",className:"gap-1 text-xs min-h-[40px]",children:[(0,b.jsx)(bm,{size:14})," Upload"]})]})]}):(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(s.Button,{onClick:c,variant:"outline",size:"icon",disabled:a,className:"relative",title:"Refresh data",children:[(0,b.jsx)(aa.RefreshCw,{className:`h-4 w-4 ${a?"animate-spin":""}`}),(0,b.jsx)("span",{className:"sr-only",children:"Refresh data"})]}),j("inventory","create")&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(s.Button,{onClick:d,variant:"outline",className:"gap-2",title:"Download CSV template",children:[(0,b.jsx)(a0.FileDown,{size:16})," CSV Template"]}),(0,b.jsxs)(s.Button,{onClick:e,variant:"outline",className:"gap-2",title:"Upload products via CSV",children:[(0,b.jsx)(bm,{size:16})," Upload CSV"]})]}),j("inventory","view")&&(0,b.jsxs)(s.Button,{onClick:()=>f("/inventory/carriage-inwards"),variant:"outline",className:"gap-2",children:[(0,b.jsx)(bl,{size:16})," Carriage Inwards"]}),j("inventory","stock_adjustment")&&(0,b.jsxs)(s.Button,{onClick:()=>f("/inventory/reconcile"),variant:"outline",className:"gap-2",title:"Reconcile stock discrepancies",children:[(0,b.jsx)(bn,{size:16})," Reconcile"]}),(0,b.jsxs)(s.Button,{onClick:()=>f("/products"),variant:"outline",className:"gap-2",children:[(0,b.jsx)(bk,{size:16})," All Products"]}),j("inventory","create")&&(0,b.jsxs)(s.Button,{onClick:()=>f("/inventory/new"),className:"gap-2",children:[(0,b.jsx)(aw.Plus,{size:16})," Add Product"]})]})]})})},bp=({filters:a,setFilters:d,products:e,onSearchChange:f,onSearchSubmit:g,onSearchFocus:i})=>{(0,h.useIsMobile)();let[j,k]=(0,c.useState)(a.search||"");return(0,c.useEffect)(()=>{k(a.search||"")},[a.search]),(0,b.jsxs)("div",{className:"relative w-full",children:[(0,b.jsx)(n.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),(0,b.jsx)(y.Input,{placeholder:"Search products...",value:j,onChange:a=>{k(a.target.value),f&&f(a)},onKeyDown:b=>{"Enter"===b.key&&(b.preventDefault(),g?g({target:{value:j}}):d({...a,search:j}))},onBlur:()=>{j!==a.search&&(g?g({target:{value:j}}):d({...a,search:j}))},onFocus:i,className:"pl-9 w-full bg-white transition-all duration-200 focus:shadow-md"})]})};var bq=a.i(335732),br=a.i(463242);let bs=({products:a,onExport:c,period:d="this-month"})=>{let{settings:e}=(0,p.useBusinessSettings)(),{canViewCostPrice:f,canViewProfit:g,canViewSellingPrice:h}=(0,X.useFinancialVisibility)(),j=(0,i.useNavigate)(),{currentPage:k,setCurrentPage:l,paginatedItems:m,totalPages:n}=(0,be.usePagination)({items:a,itemsPerPage:10});return(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("div",{className:"flex justify-end",children:(0,b.jsxs)(bq.DropdownMenu,{children:[(0,b.jsx)(bq.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsxs)(s.Button,{variant:"outline",size:"sm",className:"gap-2",children:[(0,b.jsx)(a0.FileDown,{size:16}),"Export",(0,b.jsx)(aA.ChevronDown,{size:16})]})}),(0,b.jsxs)(bq.DropdownMenuContent,{align:"end",children:[(0,b.jsx)(bq.DropdownMenuItem,{onClick:c||(()=>{let b=new Blob([["Rank,Item Description,Quantity Sold,Average Price,Total Amount,Average Cost,Total Cost,Total Profit",...a.map((a,b)=>[(b+1).toString(),a.description,a.totalQuantity.toString(),h?a.averagePrice.toFixed(2):"RESTRICTED",h?a.totalAmount.toFixed(2):"RESTRICTED",f?(a.averageCost||0).toFixed(2):"RESTRICTED",f?a.totalCost.toFixed(2):"RESTRICTED",g?a.totalProfit.toFixed(2):"RESTRICTED"]).map(a=>a.map(a=>`"${a}"`).join(","))].join("\n")],{type:"text/csv"}),c=window.URL.createObjectURL(b),e=document.createElement("a");e.href=c;let i=d.replace("-"," ").replace(/\b\w/g,a=>a.toUpperCase());e.download=`top-selling-items-${i.toLowerCase().replace(/\s+/g,"-")}-${new Date().toISOString().split("T")[0]}.csv`,e.click(),window.URL.revokeObjectURL(c)}),children:"Export as CSV"}),(0,b.jsx)(bq.DropdownMenuItem,{onClick:()=>{let b=new O.default("landscape"),c=d.replace("-"," ").replace(/\b\w/g,a=>a.toUpperCase());b.setFontSize(18),b.setFont(void 0,"bold"),b.text("Top Selling Items Report",14,22),b.setFontSize(12),b.setFont(void 0,"normal"),b.text(`Period: ${c}`,14,32),b.text(`Generated: ${new Date().toLocaleDateString()}`,14,40);let i=a.map((a,b)=>[(b+1).toString(),a.description.length>50?a.description.substring(0,47)+"...":a.description,a.totalQuantity.toString(),h?`${e.currency} ${(0,L.formatNumber)(a.averagePrice)}`:"RESTRICTED",h?`${e.currency} ${(0,L.formatNumber)(a.totalAmount)}`:"RESTRICTED",f?`${e.currency} ${(0,L.formatNumber)(a.averageCost||0)}`:"RESTRICTED",f?`${e.currency} ${(0,L.formatNumber)(a.totalCost)}`:"RESTRICTED",g?`${e.currency} ${(0,L.formatNumber)(a.totalProfit)}`:"RESTRICTED"]);(0,aZ.default)(b,{head:[["Rank","Item Description","Qty Sold","Avg Price","Total Amount","Avg Cost","Total Cost","Profit"]],body:i,startY:50,styles:{fontSize:9},headStyles:{fillColor:[66,139,202]},columnStyles:{0:{halign:"center",cellWidth:15},1:{cellWidth:80},2:{halign:"center",cellWidth:25},3:{halign:"right",cellWidth:30},4:{halign:"right",cellWidth:35},5:{halign:"right",cellWidth:30},6:{halign:"right",cellWidth:30},7:{halign:"right",cellWidth:30}}}),b.save(`top-selling-items-${c.toLowerCase().replace(/\s+/g,"-")}-${new Date().toISOString().split("T")[0]}.pdf`)},children:"Export as PDF"})]})]})}),(0,b.jsx)($.TooltipProvider,{children:(0,b.jsx)("div",{className:"overflow-x-auto rounded-md border",children:(0,b.jsxs)(K.Table,{children:[(0,b.jsx)(K.TableHeader,{children:(0,b.jsxs)(K.TableRow,{className:"bg-muted/50",children:[(0,b.jsx)(K.TableHead,{className:"w-[60px] min-w-[60px]",children:"Rank"}),(0,b.jsx)(K.TableHead,{className:"min-w-[200px]",children:"Item Description"}),(0,b.jsx)(K.TableHead,{className:"w-[100px] min-w-[100px] text-right",children:"Qty Sold"}),h&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(K.TableHead,{className:"w-[120px] min-w-[120px] text-right",children:"Avg Price"}),(0,b.jsx)(K.TableHead,{className:"w-[120px] min-w-[120px] text-right",children:"Total Amount"})]}),f&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(K.TableHead,{className:"w-[120px] min-w-[120px] text-right",children:"Avg Cost"}),(0,b.jsx)(K.TableHead,{className:"w-[120px] min-w-[120px] text-right",children:"Total Cost"})]}),g&&(0,b.jsx)(K.TableHead,{className:"w-[120px] min-w-[120px] text-right",children:"Profit"})]})}),(0,b.jsx)(K.TableBody,{children:0===a.length?(0,b.jsx)(K.TableRow,{children:(0,b.jsx)(K.TableCell,{colSpan:8,className:"text-center py-8 text-muted-foreground",children:"No sales data for the selected period"})}):m.map((a,c)=>{let d=a.productIds&&a.productIds.length>0?a.productIds[0]:null;return(0,b.jsxs)(K.TableRow,{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>d&&j(`/inventory/${d}`),children:[(0,b.jsx)(K.TableCell,{className:"text-center",children:(0,b.jsx)("span",{className:"text-xs bg-primary/10 text-primary rounded-full w-6 h-6 inline-flex items-center justify-center font-bold",children:(k-1)*10+c+1})}),(0,b.jsx)(K.TableCell,{className:"font-medium",children:(0,b.jsxs)($.Tooltip,{children:[(0,b.jsx)($.TooltipTrigger,{asChild:!0,children:(0,b.jsx)("span",{className:"cursor-help",children:a.description})}),(0,b.jsx)($.TooltipContent,{side:"top",className:"max-w-xs",children:(0,b.jsx)("p",{className:"font-bold break-words whitespace-normal",children:a.description})})]})}),(0,b.jsx)(K.TableCell,{className:"text-right font-medium text-green-600",children:a.totalQuantity%1==0?a.totalQuantity:a.totalQuantity.toFixed(2)}),h&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(K.TableCell,{className:"text-right font-medium tabular-nums",children:(0,L.formatCashCurrency)(a.averagePrice,e.currency)}),(0,b.jsx)(K.TableCell,{className:"text-right font-medium tabular-nums",children:(0,L.formatCashCurrency)(a.totalAmount,e.currency)})]}),f&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(K.TableCell,{className:"text-right font-medium tabular-nums",children:(0,L.formatCashCurrency)(a.averageCost||0,e.currency)}),(0,b.jsx)(K.TableCell,{className:"text-right font-medium tabular-nums",children:(0,L.formatCashCurrency)(a.totalCost,e.currency)})]}),g&&(0,b.jsx)(K.TableCell,{className:"text-right font-medium tabular-nums",children:(0,b.jsx)("span",{className:a.totalProfit>=0?"text-green-600":"text-red-600",children:(0,L.formatCashCurrency)(a.totalProfit,e.currency)})})]},`${a.description}-${c}`)})})]})})}),a.length>0&&(0,b.jsx)("div",{className:"mt-4",children:(0,b.jsx)(br.default,{currentPage:k,totalPages:n,onPageChange:l})})]})},bt=({topSellingProducts:a,period:c,onPeriodChange:d})=>(0,b.jsxs)(x.Card,{className:"shadow-sm border-t-0 bg-white",children:[(0,b.jsx)(x.CardHeader,{className:"pb-3 md:pb-6",children:(0,b.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[(0,b.jsx)(x.CardTitle,{className:"text-base md:text-lg",children:"Top Selling Products"}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:"Period:"}),(0,b.jsxs)(z.Select,{value:c,onValueChange:a=>d(a),children:[(0,b.jsx)(z.SelectTrigger,{className:"w-[180px]",children:(0,b.jsx)(z.SelectValue,{})}),(0,b.jsxs)(z.SelectContent,{children:[(0,b.jsx)(z.SelectItem,{value:"today",children:"Today"}),(0,b.jsx)(z.SelectItem,{value:"yesterday",children:"Yesterday"}),(0,b.jsx)(z.SelectItem,{value:"this-week",children:"This Week"}),(0,b.jsx)(z.SelectItem,{value:"last-week",children:"Last Week"}),(0,b.jsx)(z.SelectItem,{value:"this-month",children:"This Month"}),(0,b.jsx)(z.SelectItem,{value:"last-month",children:"Last Month"}),(0,b.jsx)(z.SelectItem,{value:"all-time",children:"All Time"})]})]})]})]})}),(0,b.jsx)(x.CardContent,{className:"p-0",children:(0,b.jsx)(bs,{products:a,period:c})})]});var bu=a.i(618155),bv=a.i(923665),bw=a.i(758042),bx=a.i(994222),by=a.i(54419),bz=a.i(659854),bA=a.i(48662);let bB=({products:a})=>{let c=[{name:"In Stock",value:a.filter(a=>a.quantity>a.minimumStock).reduce((a,b)=>a+b.quantity,0),fill:"#4ade80"},{name:"Low Stock",value:a.filter(a=>a.quantity>0&&a.quantity<=a.minimumStock).reduce((a,b)=>a+b.quantity,0),fill:"#f87171"},{name:"Minimum Level",value:a.reduce((a,b)=>a+b.minimumStock,0),fill:"#94a3b8"}];return(0,b.jsxs)("div",{className:"w-full",children:[(0,b.jsx)("div",{className:"h-[300px] w-full",children:(0,b.jsx)(bA.ResponsiveContainer,{width:"100%",height:"100%",children:(0,b.jsxs)(bu.BarChart,{data:c,margin:{top:20,right:30,left:20,bottom:5},children:[(0,b.jsx)(by.CartesianGrid,{strokeDasharray:"3 3"}),(0,b.jsx)(bw.XAxis,{dataKey:"name"}),(0,b.jsx)(bx.YAxis,{}),(0,b.jsx)(bz.Tooltip,{formatter:(a,b,c)=>[a,c.payload.name]}),(0,b.jsx)(bv.Bar,{dataKey:"value",fill:"#8884d8",barSize:40,children:c.map((a,c)=>(0,b.jsx)(bv.Bar,{dataKey:"value",fill:a.fill},`bar-${c}`))})]})})}),(0,b.jsxs)("div",{className:"flex justify-center mt-4 space-x-6",children:[(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)("div",{className:"w-3 h-3 bg-[#4ade80] rounded-full mr-2"}),(0,b.jsx)("span",{className:"text-sm",children:"In Stock"})]}),(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)("div",{className:"w-3 h-3 bg-[#f87171] rounded-full mr-2"}),(0,b.jsx)("span",{className:"text-sm",children:"Low Stock"})]}),(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)("div",{className:"w-3 h-3 bg-[#94a3b8] rounded-full mr-2"}),(0,b.jsx)("span",{className:"text-sm",children:"Minimum Level"})]})]})]})},bC=({products:a})=>(0,h.useIsMobile)()&&0===a.length?null:(0,b.jsxs)(x.Card,{className:"shadow-sm overflow-hidden",children:[(0,b.jsx)(x.CardHeader,{className:"pb-3 md:pb-6",children:(0,b.jsx)(x.CardTitle,{className:"text-base md:text-lg",children:"Stock Level Overview"})}),(0,b.jsx)(x.CardContent,{className:"pt-0",children:(0,b.jsx)(bB,{products:a})})]});var bD=a.i(937927);a.s(["default",0,()=>{let a,{user:l}=(0,d.useAuth)(),{currentBusiness:m,isLoading:n}=(0,e.useBusiness)(),{toast:o}=(0,g.useToast)(),p=(0,h.useIsMobile)(),{hasPermission:q}=(0,W.useProfiles)(),r=(0,i.useNavigate)(),{products:s,isLoading:t,isFetching:v,loadProducts:x,filters:y,setFilters:z,filteredProducts:A,totalCount:B,refetch:C}=(0,f.useProducts)(l?.id),{categories:E}=(0,av.useCategories)(l?.id),{bulkCreateProducts:F}=(0,at.useBulkProducts)(),{sales:I}=(0,D.useSalesData)(l?.id),[J,K]=c.default.useState(!1),[L,M]=c.default.useState("this-month"),[N,O]=c.default.useState(y.search||""),{data:P,refetch:Q}=useGlobalInventoryStats(m?.id),R=(0,bD.useQueryClient)();c.default.useEffect(()=>{O(y.search||"")},[y.search]);let{topSellingProducts:S}=(a=(0,c.useMemo)(()=>{let a=new Date;switch(L){case"today":return{from:(0,ab.startOfDay)(a),to:(0,ac.endOfDay)(a)};case"yesterday":let b=new Date(a);return b.setDate(b.getDate()-1),{from:(0,ab.startOfDay)(b),to:(0,ac.endOfDay)(b)};case"this-week":return{from:(0,ad.startOfWeek)(a),to:(0,ae.endOfWeek)(a)};case"last-week":let c=new Date(a);return c.setDate(c.getDate()-7),{from:(0,ad.startOfWeek)(c),to:(0,ae.endOfWeek)(c)};case"this-month":return{from:(0,af.startOfMonth)(a),to:(0,ag.endOfMonth)(a)};case"last-month":let d=new Date(a);return d.setMonth(d.getMonth()-1),{from:(0,af.startOfMonth)(d),to:(0,ag.endOfMonth)(d)};default:return{from:new Date(0),to:a}}},[L]),{topSellingProducts:(0,c.useMemo)(()=>{try{if(!I||0===I.length)return[];let b=I.filter(b=>{try{if(!b||"Quote"===b.paymentStatus)return!1;let c=new Date(b.date);if(isNaN(c.getTime()))return!1;return c>=a.from&&c<=a.to}catch(a){return console.warn("Error filtering sale:",a),!1}}),c=new Map;return b.forEach(a=>{try{if(!a.items||!Array.isArray(a.items))return;a.items.forEach(a=>{let b=a.description,d=a.price*a.quantity,e=G(a),f=d-e,g=(a.cost||0)*a.quantity,h=e-g,i=H(a);if(c.has(b)){let d=c.get(b);d.totalQuantity+=a.quantity,d.totalAmount+=e,d.totalCost+=g,d.totalProfit+=h,d.totalDiscount+=f,d.prices.push(i),d.costs.push(a.cost||0),a.productId&&!d.productIds.includes(a.productId)&&d.productIds.push(a.productId)}else c.set(b,{totalQuantity:a.quantity,totalAmount:e,totalCost:g,totalProfit:h,totalDiscount:f,prices:[i],costs:[a.cost||0],productIds:a.productId?[a.productId]:[]})})}catch(a){console.warn("Error processing sale items:",a)}}),Array.from(c.entries()).map(([a,b])=>({description:a,totalQuantity:b.totalQuantity,averagePrice:b.prices.reduce((a,b)=>a+b,0)/b.prices.length,totalAmount:b.totalAmount,totalCost:b.totalCost,totalProfit:b.totalProfit,totalDiscount:b.totalDiscount,averageCost:b.costs.reduce((a,b)=>a+b,0)/b.costs.length,productIds:b.productIds})).sort((a,b)=>b.totalQuantity-a.totalQuantity)}catch(a){return console.error("Error calculating top selling products:",a),[]}},[I,a]),dateRange:a}),{suggestions:T,isOpen:U,openPanel:V,closePanel:X}=w(s,N),Y=(0,c.useCallback)(async()=>{R.invalidateQueries({queryKey:["inventory_global_stats"]}),R.invalidateQueries({queryKey:["products"]}),await Q(),await C(),o({title:"Inventory refreshed",description:"Your inventory data and stats have been updated with fresh server data."})},[C,o,Q,R]),Z=(0,c.useCallback)(a=>{let b=a.target.value;O(b),b.length>=1?V():X()},[V,X]),$=(0,c.useCallback)(a=>{let b=a.target.value;z({...y,search:b}),b.length>0&&V()},[y,z,V]),aa=a=>{O(a.name),r(`/inventory/${a.id}`),X()},ah=(0,c.useCallback)(()=>{N&&V()},[N,V]),ai=c.default.useCallback(()=>{(0,au.generateProductCSVTemplate)(),o({title:"Template downloaded",description:"CSV template has been downloaded to your device."})},[o]),aj=c.default.useCallback(async a=>{try{await F(a),K(!1),await x()}catch(a){console.error("CSV upload failed:",a),o({title:"Upload failed",description:"There was an error uploading your products. Please try again.",variant:"destructive"})}},[F,x,o]);return n||!m||t?(0,b.jsx)(bj.default,{}):(0,b.jsxs)("div",{className:"p-2 md:p-6 space-y-4 md:space-y-6 max-w-full",children:[(0,b.jsx)(bo,{isLoading:t,onRefresh:Y,onDownloadTemplate:ai,onCSVUpload:()=>K(!0)}),(0,b.jsx)(as.default,{open:J,onOpenChange:K,onUpload:aj,categories:E.map(a=>a.name)}),(0,b.jsx)(j.default,{products:s,totalCountOverride:B,totalCostValueOverride:P?.totalCostValue,lowStockOverride:P?.lowStockCount,outOfStockOverride:P?.outOfStockCount,totalStockValueOverride:P?.totalStockValue}),(0,b.jsxs)(k.Tabs,{defaultValue:"overview",className:"space-y-3 md:space-y-6",children:[(0,b.jsxs)(k.TabsList,{className:`grid w-full ${p?"grid-cols-4 gap-1":"grid-cols-6"} h-auto p-1`,children:[(0,b.jsx)(k.TabsTrigger,{value:"overview",className:"text-xs md:text-sm px-1 md:px-2 py-2 min-h-[44px]",children:"Overview"}),(0,b.jsx)(k.TabsTrigger,{value:"requisition",className:"text-xs md:text-sm px-1 md:px-2 py-2 min-h-[44px]",children:p?"Request":"Requisition"}),q("inventory","stock_adjustment")&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(k.TabsTrigger,{value:"add-stock",className:"text-xs md:text-sm px-1 md:px-2 py-2 min-h-[44px]",children:"Restock"}),(0,b.jsx)(k.TabsTrigger,{value:"stock-count",className:"text-xs md:text-sm px-1 md:px-2 py-2 min-h-[44px]",children:p?"Count":"Stock Count"})]}),!p&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(k.TabsTrigger,{value:"sold-items",className:"text-xs md:text-sm px-1 md:px-2 py-2 min-h-[44px]",children:"Items Sold"}),(0,b.jsx)(k.TabsTrigger,{value:"stock-summary",className:"text-xs md:text-sm px-1 md:px-2 py-2 min-h-[44px]",children:"Stock Summary"})]})]}),p&&(0,b.jsx)("div",{className:"flex gap-1 overflow-x-auto pb-2",children:(0,b.jsxs)(k.TabsList,{className:"grid grid-cols-2 gap-1 w-auto min-w-fit p-1",children:[(0,b.jsx)(k.TabsTrigger,{value:"sold-items",className:"text-xs px-2 py-2 min-h-[44px] whitespace-nowrap",children:"Items Sold"}),(0,b.jsx)(k.TabsTrigger,{value:"stock-summary",className:"text-xs px-2 py-2 min-h-[44px] whitespace-nowrap",children:"Stock Summary"})]})}),(0,b.jsxs)(k.TabsContent,{value:"overview",className:"space-y-4 md:space-y-6",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(bp,{filters:y,setFilters:z,products:s,onSearchChange:Z,onSearchSubmit:$,onSearchFocus:ah}),p&&(0,b.jsx)("div",{className:"absolute top-full left-0 right-0 z-50 mt-1",children:(0,b.jsx)(u,{suggestions:T,isOpen:U,onClose:X,onSelectProduct:aa,searchTerm:N,isLoading:v})})]}),(0,b.jsx)(bC,{products:s}),(0,b.jsx)(bt,{topSellingProducts:S,period:L,onPeriodChange:M})]}),q("inventory","stock_adjustment")&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(k.TabsContent,{value:"add-stock",children:(0,b.jsx)(aQ,{})}),(0,b.jsx)(k.TabsContent,{value:"stock-count",children:(0,b.jsx)(a6,{})})]}),(0,b.jsx)(k.TabsContent,{value:"requisition",children:(0,b.jsx)(bi,{})}),(0,b.jsx)(k.TabsContent,{value:"sold-items",children:(0,b.jsx)(_,{})}),(0,b.jsx)(k.TabsContent,{value:"stock-summary",children:(0,b.jsx)(ar,{})})]}),!p&&(0,b.jsx)(u,{suggestions:T,isOpen:U,onClose:X,onSelectProduct:aa,searchTerm:N,isLoading:v})]})}],100321)}];

//# sourceMappingURL=src_pages_Inventory_tsx_c4404c11._.js.map