{"version":3,"sources":["../../../../src/utils/generateReceiptVectorPDF.ts"],"sourcesContent":["import jsPDF from 'jspdf';\r\nimport { ReceiptData } from '@/types/receipt';\r\n\r\ninterface VectorPDFOptions {\r\n  filename?: string;\r\n  orientation?: 'portrait' | 'landscape';\r\n  format?: 'a4' | 'letter';\r\n  margins?: {\r\n    top: number;\r\n    right: number;\r\n    bottom: number;\r\n    left: number;\r\n  };\r\n  returnBlob?: boolean;\r\n}\r\n\r\n// Helper function to format currency properly (e.g., \"Ush 25,000\")\r\nconst formatCurrency = (amount: number, currency: string = 'Ush'): string => {\r\n  const formatted = Math.round(amount).toLocaleString();\r\n  return `${currency} ${formatted}`;\r\n};\r\n\r\nexport const generateReceiptVectorPDF = async (\r\n  receiptData: ReceiptData,\r\n  options: VectorPDFOptions\r\n): Promise<void | Blob> => {\r\n  const {\r\n    filename,\r\n    orientation = 'portrait',\r\n    format = 'a4',\r\n    margins = { top: 20, right: 20, bottom: 20, left: 20 },\r\n    returnBlob = false\r\n  } = options;\r\n\r\n  const pdf = new jsPDF({\r\n    orientation,\r\n    unit: 'mm',\r\n    format,\r\n    compress: true\r\n  });\r\n\r\n  const pageWidth = pdf.internal.pageSize.getWidth();\r\n  const pageHeight = pdf.internal.pageSize.getHeight();\r\n  const contentWidth = pageWidth - margins.left - margins.right;\r\n  let currentY = margins.top;\r\n\r\n  // Define thinner line width\r\n  const STANDARD_LINE_WIDTH = 0.2;\r\n\r\n  // Helper functions\r\n  const setStandardLineWidth = () => {\r\n    pdf.setLineWidth(STANDARD_LINE_WIDTH);\r\n  };\r\n\r\n  const addText = (text: string, x: number, y: number, options: any = {}) => {\r\n    const { fontSize = 10, fontStyle = 'normal', align = 'left', maxWidth } = options;\r\n    pdf.setFontSize(fontSize);\r\n    pdf.setFont('helvetica', fontStyle);\r\n    \r\n    if (maxWidth) {\r\n      const lines = pdf.splitTextToSize(text, maxWidth);\r\n      pdf.text(lines, x, y, { align });\r\n      return lines.length * (fontSize * 0.35);\r\n    } else {\r\n      pdf.text(text, x, y, { align });\r\n      return fontSize * 0.35;\r\n    }\r\n  };\r\n\r\n  const addMultilineText = (text: string, x: number, y: number, maxWidth: number, options: any = {}) => {\r\n    const { fontSize = 10, fontStyle = 'normal', align = 'left', lineHeight = 1.2 } = options;\r\n    pdf.setFontSize(fontSize);\r\n    pdf.setFont('helvetica', fontStyle);\r\n    \r\n    const lines = pdf.splitTextToSize(text, maxWidth);\r\n    const lineSpacing = fontSize * 0.35 * lineHeight;\r\n    \r\n    lines.forEach((line: string, index: number) => {\r\n      pdf.text(line, x, y + (index * lineSpacing), { align });\r\n    });\r\n    \r\n    return lines.length * lineSpacing;\r\n  };\r\n\r\n  const addLine = (x1: number, y1: number, x2: number, y2: number) => {\r\n    setStandardLineWidth();\r\n    pdf.line(x1, y1, x2, y2);\r\n  };\r\n\r\n  const addRect = (x: number, y: number, width: number, height: number, style: 'S' | 'F' | 'FD' = 'S') => {\r\n    setStandardLineWidth();\r\n    pdf.rect(x, y, width, height, style);\r\n  };\r\n\r\n  // Function to draw page border\r\n  const drawPageBorder = () => {\r\n    addRect(margins.left, margins.top, contentWidth, pageHeight - margins.top - margins.bottom, 'S');\r\n  };\r\n\r\n  // Check if we need a new page and draw border\r\n  const checkPageBreak = (requiredSpace: number) => {\r\n    if (currentY + requiredSpace > pageHeight - margins.bottom) {\r\n      pdf.addPage();\r\n      currentY = margins.top + 10; // Add some top margin on new page\r\n      drawPageBorder(); // Draw border on new page\r\n      return true;\r\n    }\r\n    return false;\r\n  };\r\n\r\n  // Draw initial page border\r\n  drawPageBorder();\r\n\r\n  // Add padding inside border\r\n  const innerMargin = 8;\r\n  const innerLeft = margins.left + innerMargin;\r\n  const innerWidth = contentWidth - (innerMargin * 2);\r\n  currentY += innerMargin;\r\n\r\n  // Header section with logo on left, business info on right\r\n  const headerStartY = currentY;\r\n  \r\n  // Logo on the left (if available) - reduced size\r\n  if (receiptData.businessLogo) {\r\n    try {\r\n      const img = new Image();\r\n      img.crossOrigin = 'anonymous';\r\n      \r\n      await new Promise<void>((resolve, reject) => {\r\n        img.onload = () => {\r\n          try {\r\n            const canvas = document.createElement('canvas');\r\n            const ctx = canvas.getContext('2d');\r\n            if (ctx) {\r\n              canvas.width = img.width;\r\n              canvas.height = img.height;\r\n              ctx.drawImage(img, 0, 0);\r\n              \r\n              const dataURL = canvas.toDataURL('image/png');\r\n              \r\n              // Logo dimensions - reduced size for more professional look\r\n              const maxLogoHeight = 15; // Further reduced from 18\r\n              const aspectRatio = img.width / img.height;\r\n              const logoHeight = Math.min(maxLogoHeight, 15);\r\n              const logoWidth = logoHeight * aspectRatio;\r\n              \r\n              // Position logo on the left\r\n              pdf.addImage(dataURL, 'PNG', innerLeft, currentY, logoWidth, logoHeight);\r\n            }\r\n          } catch (error) {\r\n            console.error('Error adding logo to PDF:', error);\r\n          }\r\n          resolve();\r\n        };\r\n        \r\n        img.onerror = () => {\r\n          console.error('Error loading logo image');\r\n          resolve();\r\n        };\r\n        \r\n        img.src = receiptData.businessLogo;\r\n      });\r\n    } catch (error) {\r\n      console.error('Error processing logo:', error);\r\n    }\r\n  }\r\n\r\n  // Business information on the right - extended area with right alignment\r\n  const businessInfoX = innerLeft + innerWidth * 0.25; // Extended area starts earlier\r\n  const businessInfoWidth = innerWidth * 0.75; // Wider area for business info\r\n  const businessInfoRightX = innerLeft + innerWidth; // Right edge for alignment\r\n  let businessY = currentY;\r\n\r\n  if (receiptData.businessName) {\r\n    businessY += addText(receiptData.businessName, businessInfoRightX, businessY, {\r\n      fontSize: 14,\r\n      fontStyle: 'bold',\r\n      align: 'right'\r\n    });\r\n    businessY += 1.5; // Reduced spacing\r\n  }\r\n\r\n  if (receiptData.businessAddress) {\r\n    const lines = pdf.splitTextToSize(receiptData.businessAddress, businessInfoWidth);\r\n    const lineHeight = 10 * 0.35 * 0.9; // Further reduced line height\r\n    \r\n    lines.forEach((line: string, index: number) => {\r\n      pdf.setFontSize(10);\r\n      pdf.setFont('helvetica', 'normal');\r\n      pdf.text(line, businessInfoRightX, businessY + (index * lineHeight), { align: 'right' });\r\n    });\r\n    \r\n    businessY += lines.length * lineHeight + 0.5; // Reduced spacing\r\n  }\r\n\r\n  if (receiptData.businessPhone) {\r\n    businessY += addText(`Phone: ${receiptData.businessPhone}`, businessInfoRightX, businessY, {\r\n      fontSize: 9,\r\n      align: 'right'\r\n    });\r\n    businessY += 0.5; // Reduced spacing\r\n  }\r\n\r\n  if (receiptData.businessEmail) {\r\n    businessY += addText(`Email: ${receiptData.businessEmail}`, businessInfoRightX, businessY, {\r\n      fontSize: 9,\r\n      align: 'right'\r\n    });\r\n    businessY += 0.5; // Reduced spacing\r\n  }\r\n\r\n  // Move currentY to after header section - reduced spacing\r\n  currentY = Math.max(currentY + 18, businessY) + 5; // Further reduced spacing\r\n\r\n  // Check for page break after header\r\n  checkPageBreak(20);\r\n\r\n  // Horizontal line after header\r\n  addLine(innerLeft, currentY, innerLeft + innerWidth, currentY);\r\n  currentY += 6; // Reduced from 8\r\n\r\n  // Document title centered\r\n  currentY += addText(receiptData.documentTitle.toUpperCase(), pageWidth / 2, currentY, {\r\n    fontSize: 16,\r\n    fontStyle: 'bold',\r\n    align: 'center'\r\n  });\r\n  currentY += 4; // Reduced from 6\r\n\r\n  // Receipt details section - further reduced spacing\r\n  const detailsStartY = currentY;\r\n  \r\n  // Left side - Receipt details with minimal spacing\r\n  let leftY = detailsStartY;\r\n  leftY += addText(`${receiptData.documentNumberLabel} ${receiptData.receiptNumber}`, innerLeft, leftY, {\r\n    fontSize: 11,\r\n    fontStyle: 'bold'\r\n  });\r\n  leftY += 2; // Further reduced from 3\r\n  \r\n  leftY += addText(`Date: ${receiptData.date}`, innerLeft, leftY, {\r\n    fontSize: 10\r\n  });\r\n  leftY += 2; // Further reduced from 3\r\n  \r\n  leftY += addText(`Time: ${receiptData.time}`, innerLeft, leftY, {\r\n    fontSize: 10\r\n  });\r\n\r\n  // Right side - Payment status\r\n  const rightX = innerLeft + innerWidth * 0.7;\r\n  addText(`Status: ${receiptData.status}`, rightX, detailsStartY, {\r\n    fontSize: 11,\r\n    fontStyle: 'bold',\r\n    align: 'left'\r\n  });\r\n\r\n  currentY = leftY + 4; // Reduced from 6\r\n\r\n  // Customer information without labels\r\n  if (receiptData.customerName && receiptData.customerName.trim() !== '') {\r\n    checkPageBreak(30);\r\n    \r\n    currentY += addText('Customer Information:', innerLeft, currentY, {\r\n      fontSize: 11,\r\n      fontStyle: 'bold'\r\n    });\r\n    currentY += 3; // Reduced from 4\r\n\r\n    // Customer name without \"Name:\" label\r\n    currentY += addText(receiptData.customerName, innerLeft, currentY, {\r\n      fontSize: 10\r\n    });\r\n    currentY += 2.5; // Reduced spacing\r\n\r\n    if (receiptData.customerAddress && receiptData.customerAddress.trim() !== '') {\r\n      // Customer address without \"Address:\" label\r\n      const addressHeight = addMultilineText(receiptData.customerAddress, innerLeft, currentY, innerWidth * 0.8, {\r\n        fontSize: 10,\r\n        lineHeight: 1.0 // Reduced from 1.1\r\n      });\r\n      currentY += addressHeight;\r\n      currentY += 2.5; // Reduced spacing\r\n    }\r\n\r\n    if (receiptData.customerContact && receiptData.customerContact.trim() !== '') {\r\n      // Customer contact without \"Contact:\" label\r\n      currentY += addText(receiptData.customerContact, innerLeft, currentY, {\r\n        fontSize: 10\r\n      });\r\n      currentY += 2.5; // Reduced spacing\r\n    }\r\n\r\n    currentY += 3; // Reduced from 6\r\n  }\r\n\r\n  // Items table - check if any items have discounts to add discount column\r\n  const hasDiscounts = receiptData.items.some(item => \r\n    (item.discountPercentage || 0) > 0 || (item.discountAmount || 0) > 0\r\n  );\r\n  const tableHeaders = hasDiscounts \r\n    ? ['Description', 'Qty', 'Unit Price', 'Discount', 'Amount']\r\n    : ['Description', 'Qty', 'Unit Price', 'Amount'];\r\n  const colWidths = hasDiscounts\r\n    ? [innerWidth * 0.35, innerWidth * 0.15, innerWidth * 0.18, innerWidth * 0.12, innerWidth * 0.2]\r\n    : [innerWidth * 0.45, innerWidth * 0.15, innerWidth * 0.2, innerWidth * 0.2];\r\n  \r\n  // Table header background\r\n  pdf.setFillColor(245, 245, 245);\r\n  addRect(innerLeft, currentY - 2, innerWidth, 10, 'F');\r\n  \r\n  // Table header borders\r\n  addRect(innerLeft, currentY - 2, innerWidth, 10, 'S');\r\n  \r\n  // Table header text\r\n  let tableX = innerLeft;\r\n  tableHeaders.forEach((header, index) => {\r\n    addText(header, tableX + 3, currentY + 4, {\r\n      fontSize: 10,\r\n      fontStyle: 'bold'\r\n    });\r\n    // Add vertical lines between columns\r\n    if (index < tableHeaders.length - 1) {\r\n      addLine(tableX + colWidths[index], currentY - 2, tableX + colWidths[index], currentY + 8);\r\n    }\r\n    tableX += colWidths[index];\r\n  });\r\n  \r\n  currentY += 10;\r\n  \r\n  // Table rows with proper text wrapping and row separation\r\n  let subtotal = 0;\r\n  const minRowHeight = 8; // Minimum row height\r\n  \r\n  receiptData.items.forEach((item, index) => {\r\n    // Calculate required row height based on description text wrapping\r\n    pdf.setFontSize(9);\r\n    const descriptionLines = pdf.splitTextToSize(item.description, colWidths[0] - 6);\r\n    const calculatedRowHeight = Math.max(minRowHeight, descriptionLines.length * 3.5 + 4);\r\n    \r\n    // Check if we need a new page for this item\r\n    checkPageBreak(calculatedRowHeight + 5);\r\n    \r\n    const itemSubtotal = item.unitPrice * item.quantity;\r\n    const discountAmount = item.discountAmount || 0;\r\n    const itemTotal = item.amount; // This should already be calculated with discount applied\r\n    subtotal += itemTotal;\r\n    \r\n    // Alternate row background for better readability\r\n    if (index % 2 === 1) {\r\n      pdf.setFillColor(250, 250, 250);\r\n      addRect(innerLeft, currentY, innerWidth, calculatedRowHeight, 'F');\r\n    }\r\n    \r\n    // Row border\r\n    addRect(innerLeft, currentY, innerWidth, calculatedRowHeight, 'S');\r\n    \r\n    tableX = innerLeft;\r\n    \r\n    // Description with proper text wrapping\r\n    addMultilineText(item.description, tableX + 3, currentY + 4, colWidths[0] - 6, {\r\n      fontSize: 9,\r\n      lineHeight: 1.1\r\n    });\r\n    tableX += colWidths[0];\r\n    \r\n    // Add vertical line after description\r\n    addLine(tableX, currentY, tableX, currentY + calculatedRowHeight);\r\n    \r\n    // Quantity - centered in cell\r\n    addText(item.quantity.toString(), tableX + colWidths[1] - 3, currentY + calculatedRowHeight/2 + 1.5, {\r\n      fontSize: 9,\r\n      align: 'right'\r\n    });\r\n    tableX += colWidths[1];\r\n    \r\n    // Add vertical line after quantity\r\n    addLine(tableX, currentY, tableX, currentY + calculatedRowHeight);\r\n    \r\n    // Unit Price - right aligned\r\n    addText(formatCurrency(item.unitPrice, receiptData.currency), tableX + colWidths[2] - 3, currentY + calculatedRowHeight/2 + 1.5, {\r\n      fontSize: 9,\r\n      align: 'right'\r\n    });\r\n    tableX += colWidths[2];\r\n    \r\n    // Add vertical line after unit price\r\n    addLine(tableX, currentY, tableX, currentY + calculatedRowHeight);\r\n    \r\n    // Discount column (if applicable)\r\n    if (hasDiscounts) {\r\n      let discountText = '-';\r\n      if ((item.discountPercentage || 0) > 0) {\r\n        discountText = `${item.discountPercentage}%`;\r\n      } else if ((item.discountAmount || 0) > 0) {\r\n        discountText = formatCurrency(item.discountAmount, receiptData.currency);\r\n      }\r\n      addText(discountText, tableX + colWidths[3] - 3, currentY + calculatedRowHeight/2 + 1.5, {\r\n        fontSize: 9,\r\n        align: 'right'\r\n      });\r\n      tableX += colWidths[3];\r\n      \r\n      // Add vertical line after discount\r\n      addLine(tableX, currentY, tableX, currentY + calculatedRowHeight);\r\n    }\r\n    \r\n    // Amount - right aligned (final amount after discount)\r\n    const finalColumnIndex = hasDiscounts ? 4 : 3;\r\n    addText(formatCurrency(itemTotal, receiptData.currency), tableX + colWidths[finalColumnIndex] - 3, currentY + calculatedRowHeight/2 + 1.5, {\r\n      fontSize: 9,\r\n      align: 'right'\r\n    });\r\n    \r\n    currentY += calculatedRowHeight;\r\n    \r\n    // Add separator line between items (except for the last item)\r\n    if (index < receiptData.items.length - 1) {\r\n      addLine(innerLeft, currentY, innerLeft + innerWidth, currentY);\r\n    }\r\n  });\r\n  \r\n  currentY += 5; // Reduced from 10\r\n  \r\n  // Professional totals section with improved layout for large figures\r\n  checkPageBreak(70); // Increased space requirement for installment sales\r\n  \r\n  // Create a proper totals table without header\r\n  const totalsStartX = innerLeft + innerWidth * 0.45;\r\n  const totalsWidth = innerWidth * 0.55;\r\n  const labelWidth = totalsWidth * 0.55;\r\n  const valueWidth = totalsWidth * 0.45;\r\n  \r\n  // Calculate total discount for the totals section\r\n  const totalDiscount = receiptData.items.reduce((total, item) => {\r\n    const itemSubtotal = item.unitPrice * item.quantity;\r\n    const discountAmount = (item.discountType === 'amount') \r\n      ? (item.discountAmount || 0)\r\n      : (itemSubtotal * (item.discountPercentage || 0)) / 100;\r\n    return total + discountAmount;\r\n  }, 0);\r\n  \r\n  // Subtotal (before discount) row - only show if there are discounts\r\n  if (totalDiscount > 0) {\r\n    addRect(totalsStartX, currentY, totalsWidth, 8, 'S');\r\n    pdf.setFillColor(248, 248, 248);\r\n    addRect(totalsStartX, currentY, totalsWidth, 8, 'F');\r\n    \r\n    addText('Subtotal (before discount):', totalsStartX + 4, currentY + 5.5, {\r\n      fontSize: 10,\r\n      fontStyle: 'normal'\r\n    });\r\n    \r\n    // Vertical line separating label and value\r\n    addLine(totalsStartX + labelWidth, currentY, totalsStartX + labelWidth, currentY + 8);\r\n    \r\n    addText(formatCurrency(subtotal + totalDiscount, receiptData.currency), totalsStartX + labelWidth + valueWidth - 4, currentY + 5.5, {\r\n      fontSize: 10,\r\n      fontStyle: 'normal',\r\n      align: 'right'\r\n    });\r\n    currentY += 8;\r\n    \r\n    // Total discount row\r\n    addRect(totalsStartX, currentY, totalsWidth, 8, 'S');\r\n    pdf.setFillColor(255, 240, 220); // Light orange background\r\n    addRect(totalsStartX, currentY, totalsWidth, 8, 'F');\r\n    \r\n    addText('Total Discount:', totalsStartX + 4, currentY + 5.5, {\r\n      fontSize: 10,\r\n      fontStyle: 'normal'\r\n    });\r\n    \r\n    // Vertical line separating label and value\r\n    addLine(totalsStartX + labelWidth, currentY, totalsStartX + labelWidth, currentY + 8);\r\n    \r\n    addText(`-${formatCurrency(totalDiscount, receiptData.currency)}`, totalsStartX + labelWidth + valueWidth - 4, currentY + 5.5, {\r\n      fontSize: 10,\r\n      fontStyle: 'normal',\r\n      align: 'right'\r\n    });\r\n    currentY += 8;\r\n  }\r\n  \r\n  // Subtotal row (after discount or just subtotal if no discounts)\r\n  addRect(totalsStartX, currentY, totalsWidth, 8, 'S');\r\n  pdf.setFillColor(248, 248, 248);\r\n  addRect(totalsStartX, currentY, totalsWidth, 8, 'F');\r\n  \r\n  addText(totalDiscount > 0 ? 'Subtotal (after discount):' : 'Subtotal:', totalsStartX + 4, currentY + 5.5, {\r\n    fontSize: 10,\r\n    fontStyle: 'normal'\r\n  });\r\n  \r\n  // Vertical line separating label and value\r\n  addLine(totalsStartX + labelWidth, currentY, totalsStartX + labelWidth, currentY + 8);\r\n  \r\n  addText(formatCurrency(subtotal, receiptData.currency), totalsStartX + labelWidth + valueWidth - 4, currentY + 5.5, {\r\n    fontSize: 10,\r\n    fontStyle: 'normal',\r\n    align: 'right'\r\n  });\r\n  currentY += 8;\r\n  \r\n  // Tax row (if applicable)\r\n  if (receiptData.showTaxRow && receiptData.taxAmount > 0) {\r\n    addRect(totalsStartX, currentY, totalsWidth, 8, 'S');\r\n    pdf.setFillColor(250, 250, 250);\r\n    addRect(totalsStartX, currentY, totalsWidth, 8, 'F');\r\n    \r\n    addText(`Tax (${receiptData.taxRate}%):`, totalsStartX + 4, currentY + 5.5, {\r\n      fontSize: 10,\r\n      fontStyle: 'normal'\r\n    });\r\n    \r\n    // Vertical line separating label and value\r\n    addLine(totalsStartX + labelWidth, currentY, totalsStartX + labelWidth, currentY + 8);\r\n    \r\n    addText(formatCurrency(receiptData.taxAmount, receiptData.currency), totalsStartX + labelWidth + valueWidth - 4, currentY + 5.5, {\r\n      fontSize: 10,\r\n      fontStyle: 'normal',\r\n      align: 'right'\r\n    });\r\n    currentY += 8;\r\n  }\r\n  \r\n  // Total row with emphasis and larger height for big figures\r\n  addRect(totalsStartX, currentY, totalsWidth, 12, 'S');\r\n  pdf.setFillColor(220, 220, 220);\r\n  addRect(totalsStartX, currentY, totalsWidth, 12, 'F');\r\n  \r\n  addText('TOTAL:', totalsStartX + 4, currentY + 7.5, {\r\n    fontSize: 12,\r\n    fontStyle: 'bold'\r\n  });\r\n  \r\n  // Vertical line separating label and value\r\n  addLine(totalsStartX + labelWidth, currentY, totalsStartX + labelWidth, currentY + 12);\r\n  \r\n  addText(formatCurrency(receiptData.totalAmount, receiptData.currency), totalsStartX + labelWidth + valueWidth - 4, currentY + 7.5, {\r\n    fontSize: 12,\r\n    fontStyle: 'bold',\r\n    align: 'right'\r\n  });\r\n  currentY += 12;\r\n\r\n  // Add Amount Paid and Amount Due for installment sales\r\n  if (receiptData.isInstallmentSale) {\r\n    // Amount Paid row\r\n    if (receiptData.amountPaid !== undefined) {\r\n      addRect(totalsStartX, currentY, totalsWidth, 8, 'S');\r\n      pdf.setFillColor(240, 248, 255); // Light blue background\r\n      addRect(totalsStartX, currentY, totalsWidth, 8, 'F');\r\n      \r\n      addText('Amount Paid:', totalsStartX + 4, currentY + 5.5, {\r\n        fontSize: 10,\r\n        fontStyle: 'bold'\r\n      });\r\n      \r\n      // Vertical line separating label and value\r\n      addLine(totalsStartX + labelWidth, currentY, totalsStartX + labelWidth, currentY + 8);\r\n      \r\n      addText(formatCurrency(receiptData.amountPaid, receiptData.currency), totalsStartX + labelWidth + valueWidth - 4, currentY + 5.5, {\r\n        fontSize: 10,\r\n        fontStyle: 'bold',\r\n        align: 'right'\r\n      });\r\n      currentY += 8;\r\n    }\r\n    \r\n    // Amount Due row\r\n    if (receiptData.amountDue !== undefined) {\r\n      addRect(totalsStartX, currentY, totalsWidth, 8, 'S');\r\n      pdf.setFillColor(255, 240, 240); // Light red background\r\n      addRect(totalsStartX, currentY, totalsWidth, 8, 'F');\r\n      \r\n      addText('Amount Due:', totalsStartX + 4, currentY + 5.5, {\r\n        fontSize: 10,\r\n        fontStyle: 'bold'\r\n      });\r\n      \r\n      // Vertical line separating label and value\r\n      addLine(totalsStartX + labelWidth, currentY, totalsStartX + labelWidth, currentY + 8);\r\n      \r\n      addText(formatCurrency(receiptData.amountDue, receiptData.currency), totalsStartX + labelWidth + valueWidth - 4, currentY + 5.5, {\r\n        fontSize: 10,\r\n        fontStyle: 'bold',\r\n        align: 'right'\r\n      });\r\n      currentY += 8;\r\n    }\r\n  }\r\n  \r\n  currentY += 7; // Reduced from 15\r\n\r\n  // Amount in words with slightly increased spacing\r\n  if (receiptData.totalAmountInWords) {\r\n    checkPageBreak(20);\r\n    \r\n    currentY += 2; // Keep existing spacing\r\n    addText('Amount in words:', innerLeft, currentY, {\r\n      fontSize: 10,\r\n      fontStyle: 'bold'\r\n    });\r\n    currentY += 4; // Increased from 3 to 4\r\n    \r\n    // Better text wrapping for amount in words with increased line height\r\n    const amountText = `${receiptData.currency} ${receiptData.totalAmountInWords} only`;\r\n    const wordsHeight = addMultilineText(amountText, innerLeft, currentY, innerWidth * 0.9, {\r\n      fontSize: 10,\r\n      fontStyle: 'italic',\r\n      lineHeight: 1.4 // Increased from 1.2 to 1.4 for better spacing\r\n    });\r\n    currentY += wordsHeight + 4; // Increased from 3 to 4\r\n  }\r\n\r\n  // Improved Payment information table with reduced spacing\r\n  if (receiptData.hasPaymentInfo && receiptData.paymentMethods && receiptData.paymentMethods.length > 0) {\r\n    checkPageBreak(40);\r\n    \r\n    // Strong separator line with reduced spacing\r\n    addLine(innerLeft, currentY, innerLeft + innerWidth, currentY);\r\n    currentY += 5; // Reduced from 8\r\n\r\n    addText('Payment Information:', innerLeft, currentY, {\r\n      fontSize: 11,\r\n      fontStyle: 'bold'\r\n    });\r\n    currentY += 4; // Reduced from 6\r\n\r\n    // Payment table with better proportions\r\n    const paymentHeaders = ['Payment Method', 'Account Number', 'Account Name'];\r\n    const paymentColWidths = [innerWidth * 0.28, innerWidth * 0.36, innerWidth * 0.36];\r\n    \r\n    // Header background with stronger color\r\n    pdf.setFillColor(240, 240, 240);\r\n    const headerHeight = 10;\r\n    addRect(innerLeft, currentY - 2, innerWidth, headerHeight, 'F');\r\n    addRect(innerLeft, currentY - 2, innerWidth, headerHeight, 'S');\r\n    \r\n    // Header text with proper spacing\r\n    let paymentX = innerLeft;\r\n    paymentHeaders.forEach((header, index) => {\r\n      addText(header, paymentX + 4, currentY + 4, {\r\n        fontSize: 9,\r\n        fontStyle: 'bold'\r\n      });\r\n      if (index < paymentHeaders.length - 1) {\r\n        addLine(paymentX + paymentColWidths[index], currentY - 2, paymentX + paymentColWidths[index], currentY + headerHeight - 2);\r\n      }\r\n      paymentX += paymentColWidths[index];\r\n    });\r\n    \r\n    currentY += headerHeight;\r\n    \r\n    // Payment rows with consistent formatting\r\n    const validPayments = receiptData.paymentMethods.filter(payment => \r\n      payment.method.trim() || payment.accountNumber.trim() || payment.accountName.trim()\r\n    );\r\n    \r\n    validPayments.forEach((payment, index) => {\r\n      const rowHeight = 10;\r\n      checkPageBreak(rowHeight + 5);\r\n      \r\n      // Alternating row colors\r\n      if (index % 2 === 1) {\r\n        pdf.setFillColor(248, 248, 248);\r\n        addRect(innerLeft, currentY, innerWidth, rowHeight, 'F');\r\n      }\r\n      \r\n      // Row border\r\n      addRect(innerLeft, currentY, innerWidth, rowHeight, 'S');\r\n      \r\n      paymentX = innerLeft;\r\n      \r\n      // Payment method\r\n      addText(payment.method, paymentX + 4, currentY + 5, {\r\n        fontSize: 9,\r\n        fontStyle: 'bold'\r\n      });\r\n      paymentX += paymentColWidths[0];\r\n      addLine(paymentX, currentY, paymentX, currentY + rowHeight);\r\n      \r\n      // Account number\r\n      addText(payment.accountNumber, paymentX + 4, currentY + 5, {\r\n        fontSize: 9\r\n      });\r\n      paymentX += paymentColWidths[1];\r\n      addLine(paymentX, currentY, paymentX, currentY + rowHeight);\r\n      \r\n      // Account name\r\n      addText(payment.accountName, paymentX + 4, currentY + 5, {\r\n        fontSize: 9\r\n      });\r\n      \r\n      currentY += rowHeight;\r\n    });\r\n    \r\n    currentY += 4; // Reduced from 8\r\n  }\r\n\r\n  // Notes section (if available)\r\n  if (receiptData.notes && receiptData.notes.trim()) {\r\n    checkPageBreak(25);\r\n    \r\n    // Add separator line\r\n    addLine(innerLeft, currentY, innerLeft + innerWidth, currentY);\r\n    currentY += 4;\r\n    \r\n    // Notes title\r\n    addText('Notes:', innerLeft, currentY, {\r\n      fontSize: 11,\r\n      fontStyle: 'bold'\r\n    });\r\n    currentY += 6;\r\n    \r\n    // Notes content with text wrapping\r\n    const maxWidth = innerWidth - 8;\r\n    const lines = pdf.splitTextToSize(receiptData.notes, maxWidth);\r\n    \r\n    lines.forEach((line: string) => {\r\n      checkPageBreak(8);\r\n      addText(line, innerLeft + 4, currentY, {\r\n        fontSize: 10\r\n      });\r\n      currentY += 5;\r\n    });\r\n    \r\n    currentY += 4;\r\n  }\r\n\r\n  // Signature section (if available) with reduced spacing\r\n  if (receiptData.signature) {\r\n    try {\r\n      checkPageBreak(35);\r\n      \r\n      const img = new Image();\r\n      img.crossOrigin = 'anonymous';\r\n      \r\n      await new Promise<void>((resolve) => {\r\n        img.onload = () => {\r\n          try {\r\n            const canvas = document.createElement('canvas');\r\n            const ctx = canvas.getContext('2d');\r\n            if (ctx) {\r\n              canvas.width = img.width;\r\n              canvas.height = img.height;\r\n              ctx.drawImage(img, 0, 0);\r\n              \r\n              const dataURL = canvas.toDataURL('image/png');\r\n              \r\n              // Calculate signature dimensions while maintaining aspect ratio\r\n              const maxSigWidth = 40;\r\n              const maxSigHeight = 20;\r\n              const aspectRatio = img.width / img.height;\r\n              \r\n              let sigWidth, sigHeight;\r\n              \r\n              // Calculate dimensions based on aspect ratio\r\n              if (aspectRatio > (maxSigWidth / maxSigHeight)) {\r\n                // Image is wider, constrain by width\r\n                sigWidth = maxSigWidth;\r\n                sigHeight = maxSigWidth / aspectRatio;\r\n              } else {\r\n                // Image is taller, constrain by height\r\n                sigHeight = maxSigHeight;\r\n                sigWidth = maxSigHeight * aspectRatio;\r\n              }\r\n              \r\n              // Position signature on the right\r\n              const sigX = innerLeft + innerWidth - sigWidth;\r\n              \r\n              addLine(innerLeft, currentY, innerLeft + innerWidth, currentY);\r\n              currentY += 4; // Reduced from 6\r\n              \r\n              pdf.addImage(dataURL, 'PNG', sigX, currentY, sigWidth, sigHeight);\r\n              currentY += sigHeight + 2; // Reduced from 3\r\n              \r\n              addText('Authorized Signature', sigX + sigWidth / 2, currentY, {\r\n                fontSize: 8,\r\n                align: 'center'\r\n              });\r\n              currentY += 4; // Reduced from 6\r\n            }\r\n          } catch (error) {\r\n            console.error('Error adding signature to PDF:', error);\r\n          }\r\n          resolve();\r\n        };\r\n        \r\n        img.onerror = () => {\r\n          console.error('Error loading signature image');\r\n          resolve();\r\n        };\r\n        \r\n        img.src = receiptData.signature;\r\n      });\r\n    } catch (error) {\r\n      console.error('Error processing signature:', error);\r\n    }\r\n  }\r\n\r\n  // Footer message with reduced spacing\r\n  checkPageBreak(25);\r\n  currentY += 6; // Reduced from 8\r\n  addText('Thank you for your business!', pageWidth / 2, currentY, {\r\n    fontSize: 11,\r\n    fontStyle: 'bold',\r\n    align: 'center'\r\n  });\r\n  \r\n  currentY += 5; // Add spacing between messages\r\n  addText('Created by Gonza Systems', pageWidth / 2, currentY, {\r\n    fontSize: 9,\r\n    align: 'center'\r\n  });\r\n\r\n  // Return blob or download\r\n  if (returnBlob) {\r\n    return pdf.output('blob');\r\n  } else if (filename) {\r\n    pdf.save(filename);\r\n  }\r\n};\r\n"],"names":[],"mappings":"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"}