module.exports=[499239,a=>{"use strict";let b=(0,a.i(564375).default)("Package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["path",{d:"m3.3 7 7.703 4.734a2 2 0 0 0 1.994 0L20.7 7",key:"yx3hmr"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]);a.s(["Package",()=>b],499239)},369773,a=>{"use strict";let b=(0,a.i(564375).default)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);a.s(["AlertTriangle",()=>b],369773)},340001,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(799856),f=b([e]);function g({className:a,...b}){return(0,d.jsx)("div",{className:(0,e.cn)("animate-pulse rounded-md bg-muted",a),...b})}[e]=f.then?(await f)():f,a.s(["Skeleton",()=>g]),c()}catch(a){c(a)}},!1),132660,a=>{"use strict";let b=(0,a.i(564375).default)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);a.s(["Eye",()=>b],132660)},244577,a=>a.a(async(b,c)=>{try{let b=await a.y("@radix-ui/react-separator-9c701fca3c218349");a.n(b),c()}catch(a){c(a)}},!0),318674,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(244577),g=a.i(799856),h=b([f,g]);[f,g]=h.then?(await h)():h;let i=e.forwardRef(({className:a,orientation:b="horizontal",decorative:c=!0,...e},h)=>(0,d.jsx)(f.Root,{ref:h,decorative:c,orientation:b,className:(0,g.cn)("shrink-0 bg-border","horizontal"===b?"h-[1px] w-full":"h-full w-[1px]",a),...e}));i.displayName=f.Root.displayName,a.s(["Separator",()=>i]),c()}catch(a){c(a)}},!1),985522,a=>a.a(async(b,c)=>{try{var d=a.i(127669),e=a.i(108191),f=a.i(964889),g=a.i(852741),h=b([f]);[f]=h.then?(await h)():h,a.s(["useCategories",0,a=>{let[b,c]=(0,d.useState)([]),[h,i]=(0,d.useState)(!0),{toast:j}=(0,e.useToast)(),{currentBusiness:k}=(0,f.useBusiness)(),l=(0,d.useCallback)(async()=>{try{if(!k?.id){c([]),i(!1);return}i(!0);let a=await (0,g.getProductCategoriesAction)(k.id);if(!a.success||!a.data)throw Error(a.error||"Failed to fetch categories");let b=a.data.map(a=>({id:a.id,name:a.name,createdAt:a.createdAt?new Date(a.createdAt):a.created_at?new Date(a.created_at):void 0}));c(b)}catch(a){console.error("Error loading categories:",a),j({title:"Error",description:"Failed to load product categories.",variant:"destructive"})}finally{i(!1)}},[k?.id,j]);(0,d.useEffect)(()=>{l()},[l]);let m=async d=>{try{if(!a||!k?.id)return null;let e=b.find(a=>a.name.toLowerCase()===d.toLowerCase());if(e)return j({title:"Category exists",description:"This category already exists."}),e;let f=await (0,g.createProductCategoryAction)(k.id,a,d);if(!f.success||!f.data)throw Error(f.error);let h={id:f.data.id,name:f.data.name,createdAt:new Date(f.data.createdAt)};return c(a=>[...a,h]),j({title:"Success",description:"Category created successfully"}),h}catch(a){return console.error("Error creating category:",a),j({title:"Error",description:"Failed to create category.",variant:"destructive"}),null}},n=async(a,d)=>{try{if(b.find(b=>b.name.toLowerCase()===d.toLowerCase()&&b.id!==a))return j({title:"Category exists",description:"Another category with this name already exists."}),!1;let e=await (0,g.updateProductCategoryAction)(a,d);if(!e.success)throw Error(e.error);return c(b=>b.map(b=>b.id===a?{...b,name:d}:b)),j({title:"Success",description:"Category updated successfully"}),!0}catch(a){return console.error("Error updating category:",a),j({title:"Error",description:"Failed to update category.",variant:"destructive"}),!1}},o=async a=>{try{let b=await (0,g.deleteProductCategoryAction)(a);if(!b.success)return j({title:"Cannot delete category",description:b.error||"Failed to delete category.",variant:"destructive"}),!1;return c(b=>b.filter(b=>b.id!==a)),j({title:"Success",description:"Category deleted successfully"}),!0}catch(a){return console.error("Error deleting category:",a),j({title:"Error",description:"Failed to delete category.",variant:"destructive"}),!1}};return{categories:b,isLoading:h,loadCategories:l,createCategory:m,updateCategory:n,deleteCategory:o}}]),c()}catch(a){c(a)}},!1),73679,a=>{"use strict";let b=(0,a.i(564375).default)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);a.s(["CheckCircle",()=>b],73679)},86246,a=>{"use strict";let b=(0,a.i(564375).default)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);a.s(["Save",()=>b],86246)},933286,a=>{"use strict";let b=(0,a.i(564375).default)("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);a.s(["ArrowUp",()=>b],933286)},787769,a=>{"use strict";let b=(0,a.i(564375).default)("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);a.s(["ArrowDown",()=>b],787769)},745695,a=>{"use strict";var b=a.i(508171);a.s(["default",0,({message:a="Loading...",size:c="md",className:d=""})=>(0,b.jsxs)("div",{className:`flex flex-col items-center justify-center space-y-4 ${d}`,children:[(0,b.jsx)("img",{src:"/lovable-uploads/7f7549a3-e9df-4762-b8b9-8e041e34f55d.png",alt:"Loading",className:`${{sm:"w-8 h-8",md:"w-16 h-16",lg:"w-24 h-24"}[c]} animate-spin`}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:a})]})])},515016,a=>{"use strict";let b=(0,a.i(564375).default)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);a.s(["TrendingUp",()=>b],515016)},138203,a=>a.a(async(b,c)=>{try{let b=await a.y("@radix-ui/react-progress-9b55a0861c5fda1f");a.n(b),c()}catch(a){c(a)}},!0),482626,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(138203),g=a.i(799856),h=b([f,g]);[f,g]=h.then?(await h)():h;let i=e.forwardRef(({className:a,value:b,...c},e)=>(0,d.jsx)(f.Root,{ref:e,className:(0,g.cn)("relative h-4 w-full overflow-hidden rounded-full bg-gray-200",a),...c,children:(0,d.jsx)(f.Indicator,{className:"h-full w-full flex-1 transition-all",style:{transform:`translateX(-${100-(b||0)}%)`,backgroundColor:"#16a34a"}})}));i.displayName=f.Root.displayName,a.s(["Progress",()=>i]),c()}catch(a){c(a)}},!1),532987,a=>{"use strict";a.s(["generateProductCSVTemplate",0,()=>{let a=new Blob([["Product Name,Category,Description,Supplier,Creation Date,Initial Stock,Minimum Stock Level,Cost Price,Selling Price",...[['"Sample Product with, commas"',"Electronics",'"A detailed product description, with commas and other punctuation!"','"Supplier Name, Inc."',"15/01/2024","10","5","50.00","75.00"],["Simple Product Name","Home & Garden","Basic description without commas","Basic Supplier","2024-01-16","-5","0","-25.50","100.75"]].map(a=>a.join(","))].join("\n")],{type:"text/csv"}),b=window.URL.createObjectURL(a),c=document.createElement("a");c.href=b,c.download="product_template.csv",document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(b)},"generateTransactionCSVTemplate",0,()=>{let a=new Blob([["Date,Type,Amount,Description,Category,Payment Method,Person In Charge,To Account",...[["22/12/2025","cash_in","1500.00","Sales income from morning shift","Sales","Cash","John Doe",""],["22/12/2025","cash_out","200.50","Purchased cleaning supplies","Expenses","Cash","Jane Smith",""],["22/12/2025","transfer","5000.00","Moving funds to main safe","Internal","","Admin","Main Safe"]].map(a=>a.join(","))].join("\n")],{type:"text/csv"}),b=window.URL.createObjectURL(a),c=document.createElement("a");c.href=b,c.download="transaction_template.csv",document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(b)}])},168065,a=>a.a(async(b,c)=>{try{let b=await a.y("@radix-ui/react-dropdown-menu-37c3be7a592c068a");a.n(b),c()}catch(a){c(a)}},!0),535741,a=>{"use strict";let b=(0,a.i(564375).default)("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);a.s(["Circle",()=>b],535741)},589984,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(168065),g=a.i(597435),h=a.i(643228),i=a.i(535741),j=a.i(799856),k=b([f,j]);[f,j]=k.then?(await k)():k;let l=f.Root,m=f.Trigger;f.Group,f.Portal,f.Sub,f.RadioGroup,e.forwardRef(({className:a,inset:b,children:c,...e},g)=>{let i=a=>{a.stopPropagation()};return(0,d.jsxs)(f.SubTrigger,{ref:g,className:(0,j.cn)("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",b&&"pl-8",a),onTouchStart:i,onTouchEnd:i,onTouchMove:i,...e,children:[c,(0,d.jsx)(h.ChevronRight,{className:"ml-auto h-4 w-4"})]})}).displayName=f.SubTrigger.displayName,e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(f.SubContent,{ref:c,className:(0,j.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...b})).displayName=f.SubContent.displayName;let n=e.forwardRef(({className:a,sideOffset:b=4,...c},e)=>{let g=a=>{a.stopPropagation()};return(0,d.jsx)(f.Portal,{children:(0,d.jsx)(f.Content,{ref:e,sideOffset:b,className:(0,j.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),onTouchStart:g,onTouchEnd:g,onTouchMove:g,...c})})});n.displayName=f.Content.displayName;let o=e.forwardRef(({className:a,inset:b,...c},e)=>(0,d.jsx)(f.Item,{ref:e,className:(0,j.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",b&&"pl-8",a),...c}));o.displayName=f.Item.displayName,e.forwardRef(({className:a,children:b,checked:c,...e},h)=>(0,d.jsxs)(f.CheckboxItem,{ref:h,className:(0,j.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:c,...e,children:[(0,d.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,d.jsx)(f.ItemIndicator,{children:(0,d.jsx)(g.Check,{className:"h-4 w-4"})})}),b]})).displayName=f.CheckboxItem.displayName,e.forwardRef(({className:a,children:b,...c},e)=>(0,d.jsxs)(f.RadioItem,{ref:e,className:(0,j.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...c,children:[(0,d.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,d.jsx)(f.ItemIndicator,{children:(0,d.jsx)(i.Circle,{className:"h-2 w-2 fill-current"})})}),b]})).displayName=f.RadioItem.displayName;let p=e.forwardRef(({className:a,inset:b,...c},e)=>(0,d.jsx)(f.Label,{ref:e,className:(0,j.cn)("px-2 py-1.5 text-sm font-semibold",b&&"pl-8",a),...c}));p.displayName=f.Label.displayName;let q=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(f.Separator,{ref:c,className:(0,j.cn)("-mx-1 my-1 h-px bg-muted",a),...b}));q.displayName=f.Separator.displayName,a.s(["DropdownMenu",()=>l,"DropdownMenuContent",()=>n,"DropdownMenuItem",()=>o,"DropdownMenuLabel",()=>p,"DropdownMenuSeparator",()=>q,"DropdownMenuTrigger",()=>m]),c()}catch(a){c(a)}},!1),942348,a=>a.a(async(b,c)=>{try{var d=a.i(150848),e=a.i(348287),f=b([d]);async function g(a,b){try{let c={locationId:a};b&&(c.productId=b);let e=await d.db.productHistory.findMany({where:c,include:{product:{select:{name:!0,costPrice:!0,sellingPrice:!0,sku:!0}}},orderBy:[{createdAt:"desc"},{id:"desc"}]});return{success:!0,data:e.map(a=>({id:a.id,productId:a.productId,oldQuantity:a.previousQuantity,newQuantity:a.newQuantity,changeReason:a.changeReason,createdAt:a.createdAt.toISOString(),referenceId:a.referenceId,receiptNumber:a.receiptNumber,product:a.product?{name:a.product.name,costPrice:a.product.costPrice,sellingPrice:a.product.sellingPrice,itemNumber:a.product.sku}:void 0}))}}catch(a){return console.error("Error fetching stock history:",a),{success:!1,error:a.message}}}async function h(a){try{let b=await d.db.$transaction(async b=>{let c=await b.productHistory.create({data:{userId:a.userId,locationId:a.locationId,productId:a.productId,previousQuantity:a.previousQuantity,newQuantity:a.newQuantity,changeReason:a.changeReason,referenceId:a.referenceId||null,receiptNumber:a.receiptNumber||null,createdAt:a.createdAt?new Date(a.createdAt):void 0}});return await b.product.update({where:{id:a.productId},data:{stock:a.newQuantity}}),c});return(0,e.revalidatePath)("/inventory"),{success:!0,data:b}}catch(a){return console.error("Error creating stock history:",a),{success:!1,error:a.message}}}async function i(a,b){try{let c=await d.db.$transaction(async c=>{let d=await c.productHistory.findMany({where:{productId:a,locationId:b},orderBy:[{createdAt:"asc"},{id:"asc"}]});if(0===d.length)return{finalQuantity:0};let e=0,f=[];for(let a of d){let b=a.newQuantity-a.previousQuantity,d=e,g=d+b;(a.previousQuantity!==d||a.newQuantity!==g)&&f.push(c.productHistory.update({where:{id:a.id},data:{previousQuantity:d,newQuantity:g}})),e=g}return f.length>0&&await Promise.all(f),await c.product.update({where:{id:a},data:{stock:e}}),{finalQuantity:e}});return(0,e.revalidatePath)("/inventory"),{success:!0,data:c}}catch(a){return console.error("Error recalculating stock chain:",a),{success:!1,error:a.message}}}async function j(a,b){try{let c=await d.db.$transaction(async c=>{let d=await c.productHistory.findMany({where:{referenceId:a,locationId:b},select:{productId:!0}}),e=[...new Set(d.map(a=>a.productId))];for(let d of(await c.productHistory.deleteMany({where:{referenceId:a,locationId:b}}),e))await l(c,d,b);return{affectedProducts:e.length}});return(0,e.revalidatePath)("/inventory"),{success:!0,data:c}}catch(a){return console.error("Error deleting stock history by reference:",a),{success:!1,error:a.message}}}async function k(a,b,c){try{let f=await d.db.productHistory.updateMany({where:{referenceId:a,locationId:b},data:{createdAt:new Date(c)}});return(0,e.revalidatePath)("/inventory"),{success:!0,data:f}}catch(a){return console.error("Error updating stock history dates:",a),{success:!1,error:a.message}}}async function l(a,b,c){let d=await a.productHistory.findMany({where:{productId:b,locationId:c},orderBy:[{createdAt:"asc"},{id:"asc"}]}),e=0;for(let b of d){let c=b.newQuantity-b.previousQuantity,d=e,f=d+c;(b.previousQuantity!==d||b.newQuantity!==f)&&await a.productHistory.update({where:{id:b.id},data:{previousQuantity:d,newQuantity:f}}),e=f}await a.product.update({where:{id:b},data:{stock:e}})}async function m(a,b){try{let c=await d.db.requisition.findMany({where:{userId:a,locationId:b},orderBy:{createdAt:"desc"}});return{success:!0,data:c.map(a=>({id:a.id,userId:a.userId,locationId:a.branchId,requisitionNumber:a.requisitionNumber,title:a.title||"",items:a.items||[],notes:a.notes,status:a.status,createdAt:a.createdAt.toISOString(),updatedAt:a.updatedAt.toISOString()}))}}catch(a){return console.error("Error fetching requisitions:",a),{success:!1,error:a.message}}}async function n(a){try{let b=await d.db.requisition.create({data:{userId:a.userId,branchId:a.locationId,requisitionNumber:a.requisitionNumber,title:a.title,items:a.items,notes:a.notes,status:a.status||"draft"}});return(0,e.revalidatePath)("/requisitions"),{success:!0,data:{id:b.id,userId:b.userId,locationId:b.branchId,requisitionNumber:b.requisitionNumber,title:b.title||"",items:b.items||[],notes:b.notes,status:b.status,createdAt:b.createdAt.toISOString(),updatedAt:b.updatedAt.toISOString()}}}catch(a){return console.error("Error creating requisition:",a),{success:!1,error:a.message}}}async function o(a,b,c){try{let f=await d.db.requisition.update({where:{id:a,userId:b},data:{title:c.title,items:c.items,notes:c.notes,status:c.status,updatedAt:new Date}});return(0,e.revalidatePath)("/requisitions"),{success:!0,data:{id:f.id,userId:f.userId,locationId:f.branchId,requisitionNumber:f.requisitionNumber,title:f.title||"",items:f.items||[],notes:f.notes,status:f.status,createdAt:f.createdAt.toISOString(),updatedAt:f.updatedAt.toISOString()}}}catch(a){return console.error("Error updating requisition:",a),{success:!1,error:a.message}}}async function p(a,b){try{return await d.db.requisition.delete({where:{id:a,userId:b}}),(0,e.revalidatePath)("/requisitions"),{success:!0}}catch(a){return console.error("Error deleting requisition:",a),{success:!1,error:a.message}}}async function q(a,b,c){try{let e=new Date(b),f=new Date(c),g=await d.db.product.findMany({where:{branchId:a},include:{category:!0}}),h=await Promise.all(g.map(async b=>{let c=await d.db.productHistory.findMany({where:{productId:b.id,locationId:a,createdAt:{gte:e,lte:f}},orderBy:{createdAt:"asc"}}),g=0,h=0,i=0,j=0;c.forEach(a=>{let b=a.newQuantity-a.previousQuantity;"SALE"===a.changeReason?g+=Math.abs(b):"STOCK_IN"===a.changeReason||"RESTOCK"===a.changeReason?h+=b:b>0?i+=b:j+=Math.abs(b)});let k=await d.db.productHistory.findFirst({where:{productId:b.id,locationId:a,createdAt:{lte:f}},orderBy:{createdAt:"desc"}}),l=k?k.newQuantity:0,m=l-(h+i-g-j);return{productId:b.id,productName:b.name,itemNumber:b.sku||b.id,imageUrl:b.imageUrl,costPrice:Number(b.costPrice),sellingPrice:Number(b.sellingPrice),category:b.category?.name,openingStock:m,itemsSold:g,stockIn:h,transferOut:0,returnIn:0,returnOut:0,adjustmentsIn:i,adjustmentsOut:j,closingStock:l,revaluation:l*Number(b.costPrice)}}));return{success:!0,data:h}}catch(a){return console.error("Error generating stock summary report:",a),{success:!1,error:a.message}}}async function r(a,b){try{let c=await d.db.product.findUnique({where:{id:b},include:{category:!0}});if(!c)return{success:!1,error:"Product not found"};let e=await d.db.productHistory.findMany({where:{productId:b,locationId:a},orderBy:[{createdAt:"asc"},{id:"asc"}]}),f=await d.db.sale.findMany({where:{branchId:a},orderBy:{date:"asc"}}),g=e.length>0?e[0].newStock:0,h=e.length>0?e[0].createdAt:null,i=new Map,j=0;f.forEach(a=>{let c=(a.items||[]).filter(a=>a.productId===b).reduce((a,b)=>a+(Number(b.quantity)||0),0);if(c>0)if(h&&a.date<h)j+=c;else{let b=a.date.toISOString().split("T")[0],d=i.get(b)||{itemsSold:0,stockAdded:0,transferOut:0,returnIn:0,returnOut:0,adjustments:0};d.itemsSold+=c,i.set(b,d)}}),e.slice(1).forEach(a=>{let b=a.createdAt.toISOString().split("T")[0],c=a.newStock-a.oldStock,d=(a.changeReason||"").toLowerCase(),e=i.get(b)||{itemsSold:0,stockAdded:0,transferOut:0,returnIn:0,returnOut:0,adjustments:0};"RESTOCK"===a.type||d.includes("purchase")||d.includes("addition")?e.stockAdded+=c:d.includes("transfer out")?e.transferOut+=Math.abs(c):d.includes("customer return")?e.returnIn+=c:d.includes("return to supplier")?e.returnOut+=Math.abs(c):"SALE"!==a.type&&(e.adjustments+=c),i.set(b,e)});let k=Array.from(i.keys()).sort(),l=[],m=g;for(let a of k){let b=i.get(a),c=m,d=c-b.itemsSold+b.stockAdded-b.transferOut+b.returnIn-b.returnOut+b.adjustments;l.push({date:a,startingStock:c,...b,endingStock:d}),m=d}return{success:!0,data:{product:{id:c.id,name:c.name,quantity:c.stock,itemNumber:c.sku},currentStock:c.stock,calculatedStock:m,discrepancy:c.stock-m,openingStock:g,openingDate:h?.toISOString(),excludedSalesQty:j,dailyBreakdown:l}}}catch(a){return console.error("Error in reconciliation action:",a),{success:!1,error:a.message}}}async function s(a){try{let b=await d.db.product.findMany({where:{branchId:a},select:{id:!0,name:!0,stock:!0}}),c=[];for(let e of b){let b=await d.db.productHistory.findMany({where:{productId:e.id,locationId:a},orderBy:[{createdAt:"asc"},{id:"asc"}]});if(0===b.length)continue;let f=0,g=[];for(let a of b){let b=a.newStock-a.oldStock,c=f,d=c+b;(a.oldStock!==c||a.newStock!==d)&&g.push({entryId:a.id,createdAt:a.createdAt.toISOString(),changeReason:a.changeReason,currentPrevQty:a.oldStock,currentNewQty:a.newStock,fixedPrevQty:c,fixedNewQty:d}),f=d}(g.length>0||Math.abs(e.stock-f)>.001)&&c.push({productId:e.id,productName:e.name,totalEntries:b.length,brokenEntries:g,finalFixedQty:f,currentProductQty:e.stock})}return{success:!0,data:c}}catch(a){return{success:!1,error:a.message}}}async function t(a,b){try{let c=b||(await d.db.product.findMany({where:{branchId:a},select:{id:!0}})).map(a=>a.id),e=0,f=0;for(let b of c)try{await i(b,a),e++}catch(a){f++}return{success:!0,data:{repaired:e,failed:f}}}catch(a){return{success:!1,error:a.message}}}async function u(a){try{let b=await d.db.activityHistory.findMany({where:{entityId:{in:a}},select:{entityId:!0,entityName:!0}});return{success:!0,data:b}}catch(a){return{success:!1,error:a.message,data:[]}}}async function v(a,b){try{return await d.db.productHistory.updateMany({where:{id:{in:a}},data:{createdAt:new Date(b)}}),{success:!0}}catch(a){return{success:!1,error:a.message}}}[d]=f.then?(await f)():f,a.s(["createRequisitionAction",()=>n,"createStockHistoryAction",()=>h,"deleteRequisitionAction",()=>p,"deleteStockHistoryEntriesByReferenceAction",()=>j,"getActivityByEntityIdsAction",()=>u,"getProductReconciliationAction",()=>r,"getRequisitionsAction",()=>m,"getStockHistoryAction",()=>g,"getStockRepairsPreviewAction",()=>s,"getStockSummaryReportAction",()=>q,"recalculateStockChainAction",()=>i,"repairStockChainsAction",()=>t,"updateRequisitionAction",()=>o,"updateStockHistoryDatesAction",()=>v,"updateStockHistoryDatesByReferenceAction",()=>k]),c()}catch(a){c(a)}},!1),834122,a=>a.a(async(b,c)=>{try{var d=a.i(531811),e=a.i(964889),f=a.i(500885),g=a.i(942348),h=b([d,e,f,g]);[d,e,f,g]=h.then?(await h)():h,a.s(["useStockSummaryData",0,a=>{let{user:b}=(0,d.useAuth)(),{currentBusiness:c}=(0,e.useBusiness)(),h=(0,f.useQueryClient)(),i=async()=>{if(!b?.id||!c?.id||!a?.from||!a?.to)return[];try{let b=await (0,g.getStockSummaryReportAction)(c.id,a.from.toISOString(),a.to.toISOString());if(b.success&&b.data)return b.data;throw Error(b.error)}catch(a){throw console.error("[StockSummary] Error fetching report:",a.message),a}},{data:j=[],isLoading:k,refetch:l}=(0,f.useQuery)({queryKey:["stockSummary",c?.id,a.from?.toISOString(),a.to?.toISOString()],queryFn:i,enabled:!!b?.id&&!!c?.id&&!!a?.from&&!!a?.to,staleTime:3e5,gcTime:18e5});return{stockSummaryData:j,isLoading:k,loadStockSummaryData:l,clearCache:()=>{h.invalidateQueries({queryKey:["stockSummary"]})},clearAllLocationCaches:()=>{h.invalidateQueries({queryKey:["stockSummary"]})}}}]),c()}catch(a){c(a)}},!1),264397,a=>{"use strict";let b=(0,a.i(564375).default)("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);a.s(["TrendingDown",()=>b],264397)},54564,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(340001),f=b([e]);[e]=f.then?(await f)():f,a.s(["default",0,()=>(0,d.jsxs)("div",{className:"space-y-6",children:[(0,d.jsxs)("div",{className:"mb-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)(e.Skeleton,{className:"h-8 w-48 mb-2"}),(0,d.jsx)(e.Skeleton,{className:"h-4 w-64"})]}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)(e.Skeleton,{className:"h-9 w-9"}),(0,d.jsx)(e.Skeleton,{className:"h-9 w-24"}),(0,d.jsx)(e.Skeleton,{className:"h-9 w-32"})]})]}),(0,d.jsx)("div",{className:"mb-4",children:(0,d.jsx)(e.Skeleton,{className:"h-10 w-full max-w-md"})}),(0,d.jsx)("div",{className:"mb-6",children:(0,d.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[void 0,void 0,void 0,void 0].map((a,b)=>(0,d.jsx)(e.Skeleton,{className:"h-24"},b))})}),(0,d.jsx)(e.Skeleton,{className:"h-64 mb-6"}),(0,d.jsx)(e.Skeleton,{className:"h-96"})]})]),c()}catch(a){c(a)}},!1),142499,a=>a.a(async(b,c)=>{try{var d=a.i(127669),e=a.i(964889),f=a.i(942348),g=b([e,f]);[e,f]=g.then?(await g)():g,a.s(["useStockHistory",0,(a,b)=>{let[c,g]=(0,d.useState)([]),[h,i]=(0,d.useState)(!0),{currentBusiness:j}=(0,e.useBusiness)(),k=(0,d.useCallback)(async()=>{if(!a||!j){g([]),i(!1);return}try{i(!0);let a=await (0,f.getStockHistoryAction)(j.id,b);if(!a.success||!a.data)throw Error(a.error||"Failed to fetch stock history");let c=a.data.map(a=>({id:a.id,productId:a.productId,oldQuantity:a.oldQuantity,newQuantity:a.newQuantity,changeReason:a.changeReason,createdAt:new Date(a.createdAt),referenceId:a.referenceId,receiptNumber:a.receiptNumber,product:a.product}));g(c)}catch(a){console.error("Error loading stock history:",a)}finally{i(!1)}},[a,j?.id,b]);(0,d.useEffect)(()=>{k()},[k]);let l=async(b,c,d,e,g,h,i,l)=>{try{if(!a||!j)return!1;let m=l?`[${l}] | ${e}`:e,n=await (0,f.createStockHistoryAction)({userId:a,locationId:j.id,productId:b,previousQuantity:c,newQuantity:d,changeReason:m,referenceId:g,receiptNumber:i,createdAt:h?.toISOString()});if(!n.success)return console.error("Error creating stock history entry:",n.error),!1;return await k(),!0}catch(a){return console.error("Error creating stock history:",a),!1}},m=async a=>{try{if(!j)return!1;let b=await (0,f.deleteStockHistoryEntriesByReferenceAction)(a,j.id);if(!b.success)throw Error(b.error);return await k(),!0}catch(a){return console.error("Error deleting stock history entries:",a),!1}},n=async a=>{try{if(!j)return!1;let b=await (0,f.recalculateStockChainAction)(a,j.id);if(!b.success)throw Error(b.error);return await k(),!0}catch(a){return console.error("Error recalculating stock chain:",a),!1}},o=async(a,b)=>{try{if(!j)return!1;let c=await (0,f.updateStockHistoryDatesByReferenceAction)(a,j.id,b.toISOString());if(!c.success)throw Error(c.error);return await k(),!0}catch(a){return console.error("Error updating stock history dates:",a),!1}},p=async a=>{try{if(!j)return{repaired:0,failed:0};let a=await (0,f.repairStockChainsAction)(j.id);if(a.success&&a.data)return a.data;return{repaired:0,failed:0}}catch(a){return console.error("Error repairing all chains:",a),{repaired:0,failed:0}}},q=async a=>{try{if(!j)return[];let a=await (0,f.getStockRepairsPreviewAction)(j.id);if(a.success&&a.data)return a.data;return[]}catch(a){return console.error("Error previewing repairs:",a),[]}};return{stockHistory:c,isLoading:h,createStockHistoryEntry:l,deleteMultipleStockHistoryEntriesByReference:m,recalculateStockChain:n,updateStockHistoryDatesBySaleId:o,repairAllStockChains:p,previewStockChainRepairs:q,refreshHistory:k}}]),c()}catch(a){c(a)}},!1),338055,a=>a.a(async(b,c)=>{try{let b=await a.y("@radix-ui/react-tooltip-de39d7cf23eb9ed6");a.n(b),c()}catch(a){c(a)}},!0),767810,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(338055),g=a.i(799856),h=b([f,g]);[f,g]=h.then?(await h)():h;let i=f.Provider,j=f.Root,k=f.Trigger,l=e.forwardRef(({className:a,sideOffset:b=4,...c},e)=>(0,d.jsx)(f.Content,{ref:e,sideOffset:b,className:(0,g.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...c}));l.displayName=f.Content.displayName,a.s(["Tooltip",()=>j,"TooltipContent",()=>l,"TooltipProvider",()=>i,"TooltipTrigger",()=>k]),c()}catch(a){c(a)}},!1),584210,a=>{"use strict";var b=a.i(508171);let c=(0,a.i(564375).default)("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);a.s(["default",0,({imageUrl:a,alt:d,size:e="md"})=>{let f="sm"===e?"w-10 h-10":"w-12 h-12";return a?(0,b.jsx)("img",{src:a,alt:d,className:`${f} object-cover rounded-md`}):(0,b.jsx)("div",{className:`${f} bg-gray-100 flex items-center justify-center rounded-md`,children:(0,b.jsx)(c,{size:"sm"===e?16:18,className:"text-gray-400"})})}],584210)},219269,a=>{"use strict";a.s(["matchProductSearch",0,(a,b)=>{if(!b||!b.trim())return!0;let c=b.toLowerCase().trim().split(/\s+/),d=[String(a.name||""),String(a.description||""),String(a.category||""),String(a.supplier||""),String(a.itemNumber||""),String(a.barcode||""),String(a.manufacturerBarcode||"")].map(a=>a.toLowerCase());return c.every(a=>d.some(b=>b.includes(a)))}])},611602,a=>{a.v(b=>Promise.all(["server/chunks/ssr/[root-of-the-server]__4ddd119e._.js"].map(b=>a.l(b))).then(()=>b(653101)))},448814,a=>{a.v(b=>Promise.all(["server/chunks/ssr/[root-of-the-server]__267d2c71._.js"].map(b=>a.l(b))).then(()=>b(566767)))},127844,a=>{a.v(b=>Promise.all(["server/chunks/ssr/src_utils_thermalPrinterWeb_ts_d1bc1622._.js"].map(b=>a.l(b))).then(()=>b(894333)))},527338,a=>{a.v(a=>Promise.resolve().then(()=>a(560291)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__38089ccd._.js.map