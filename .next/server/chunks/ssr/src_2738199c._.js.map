{"version":3,"sources":["../../../../src/app/actions/customers.ts","../../../../src/hooks/useCustomers.ts","../../../../src/app/actions/messaging.ts","../../../../src/hooks/useMessages.ts"],"sourcesContent":["'use server';\r\n\r\nimport { db } from '../../../prisma/db';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\nexport async function getCustomerStatsAction(userId: string, branchId: string) {\r\n    try {\r\n        const thisMonth = new Date();\r\n        const startOfMonth = new Date(thisMonth.getFullYear(), thisMonth.getMonth(), 1);\r\n\r\n        // 1. Count customers created this month\r\n        const thisMonthCount = await db.customer.count({\r\n            where: {\r\n                // Assuming we use agencyId for userId if they are an owner, or it's connected somehow\r\n                // For now, focusing on branchId as that's normally the tenant isolation in the schema\r\n                branchId: branchId,\r\n                createdAt: {\r\n                    gte: startOfMonth\r\n                }\r\n            }\r\n        });\r\n\r\n        // 2. Count customers with upcoming backgrounds (for now just count those who have a birthday set)\r\n        const withBirthdays = await db.customer.count({\r\n            where: {\r\n                branchId: branchId,\r\n                birthday: {\r\n                    not: null\r\n                }\r\n            }\r\n        });\r\n\r\n        return {\r\n            success: true,\r\n            data: {\r\n                withBirthdays,\r\n                thisMonth: thisMonthCount\r\n            }\r\n        };\r\n    } catch (error: any) {\r\n        console.error('Error fetching customer stats:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\nexport async function mergeCustomersAction(primaryCustomerId: string, duplicateIds: string[]) {\r\n    try {\r\n        if (!primaryCustomerId || duplicateIds.length === 0) {\r\n            return { success: false, error: 'Invalid selection' };\r\n        }\r\n\r\n        // Use a transaction to ensure all operations succeed or fail together\r\n        await db.$transaction(async (tx: any) => {\r\n            // 1. Update sales to point to primary customer\r\n            // In Prisma, assuming relation is through customerId\r\n            await tx.sale.updateMany({\r\n                where: {\r\n                    customerId: {\r\n                        in: duplicateIds\r\n                    }\r\n                },\r\n                data: {\r\n                    customerId: primaryCustomerId\r\n                }\r\n            });\r\n\r\n            // Note: The original code also updated messages. \r\n            // If there's a Message model connected to customers, add it here.\r\n            // await tx.message.updateMany({\r\n            //     where: { customerId: { in: duplicateIds } },\r\n            //     data: { customerId: primaryCustomerId }\r\n            // });\r\n\r\n            // 3. Delete duplicate customers\r\n            await tx.customer.deleteMany({\r\n                where: {\r\n                    id: {\r\n                        in: duplicateIds\r\n                    }\r\n                }\r\n            });\r\n        });\r\n\r\n        // Revalidate customers list\r\n        revalidatePath('/customers');\r\n        return { success: true };\r\n    } catch (error: any) {\r\n        console.error('Error merging customers:', error);\r\n        return { success: false, error: error.message || 'Failed to merge customers' };\r\n    }\r\n}\r\n\r\nexport async function getCustomersAction(branchId: string) {\r\n    try {\r\n        const customers = await db.customer.findMany({\r\n            where: { branchId },\r\n            orderBy: { name: 'asc' }\r\n        });\r\n\r\n        const count = await db.customer.count({\r\n            where: { branchId }\r\n        });\r\n\r\n        // Map Prisma Customer model to the shape expected by useCustomers hook\r\n        const mappedCustomers = customers.map((c: any) => ({\r\n            id: c.id,\r\n            fullName: c.name,\r\n            phoneNumber: c.phone,\r\n            email: c.email,\r\n            birthday: c.birthday ? c.birthday.toISOString() : null,\r\n            gender: c.gender,\r\n            location: c.address,\r\n            categoryId: c.categoryId,\r\n            notes: c.notes,\r\n            tags: c.tags || [],\r\n            socialMedia: c.socialMedia || null,\r\n            createdAt: c.createdAt.toISOString(),\r\n            updatedAt: c.updatedAt.toISOString()\r\n        }));\r\n\r\n        return { success: true, data: { customers: mappedCustomers, count } };\r\n    } catch (error: any) {\r\n        console.error('Error fetching customers:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\nexport async function createCustomerAction(branchId: string, userId: string, data: any) {\r\n    try {\r\n        const newCustomer = await db.customer.create({\r\n            data: {\r\n                branchId: branchId,\r\n                adminId: userId, // Assuming user who created it is the admin/owner\r\n                name: data.fullName,\r\n                phone: data.phoneNumber || null,\r\n                email: data.email || null,\r\n                birthday: data.birthday ? new Date(data.birthday) : null,\r\n                gender: data.gender || null,\r\n                address: data.location || null,\r\n                categoryId: data.categoryId || null,\r\n                notes: data.notes || null,\r\n                tags: data.tags || [],\r\n                socialMedia: data.socialMedia || null\r\n            }\r\n        });\r\n        revalidatePath('/customers');\r\n        return { success: true, data: newCustomer };\r\n    } catch (error: any) {\r\n        console.error('Error creating customer:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\nexport async function updateCustomerAction(customerId: string, data: any) {\r\n    try {\r\n        const updateData: any = {};\r\n        if (data.fullName !== undefined) updateData.name = data.fullName;\r\n        if (data.phoneNumber !== undefined) updateData.phone = data.phoneNumber;\r\n        if (data.email !== undefined) updateData.email = data.email;\r\n        if (data.birthday !== undefined) updateData.birthday = data.birthday ? new Date(data.birthday) : null;\r\n        if (data.gender !== undefined) updateData.gender = data.gender;\r\n        if (data.location !== undefined) updateData.address = data.location;\r\n        if (data.categoryId !== undefined) updateData.categoryId = data.categoryId;\r\n        if (data.notes !== undefined) updateData.notes = data.notes;\r\n        if (data.tags !== undefined) updateData.tags = data.tags;\r\n        if (data.socialMedia !== undefined) updateData.socialMedia = data.socialMedia;\r\n\r\n        const updatedCustomer = await db.customer.update({\r\n            where: { id: customerId },\r\n            data: updateData\r\n        });\r\n        revalidatePath('/customers');\r\n        return { success: true, data: updatedCustomer };\r\n    } catch (error: any) {\r\n        console.error('Error updating customer:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\nexport async function deleteCustomerAction(customerId: string) {\r\n    try {\r\n        await db.customer.delete({\r\n            where: { id: customerId }\r\n        });\r\n        revalidatePath('/customers');\r\n        return { success: true };\r\n    } catch (error: any) {\r\n        console.error('Error deleting customer:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\nexport async function getCustomerCategoriesAction(branchId: string) {\r\n    try {\r\n        const categories = await db.customerCategory.findMany({\r\n            where: { branchId },\r\n            orderBy: { name: 'asc' }\r\n        });\r\n\r\n        const formattedCategories = categories.map((c: any) => ({\r\n            id: c.id,\r\n            name: c.name,\r\n            isDefault: c.isDefault,\r\n            createdAt: c.createdAt.toISOString(),\r\n            updatedAt: c.updatedAt.toISOString()\r\n        }));\r\n\r\n        return { success: true, data: formattedCategories };\r\n    } catch (error: any) {\r\n        console.error('Error fetching customer categories:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\nexport async function createCustomerCategoryAction(branchId: string, userId: string, name: string) {\r\n    try {\r\n        const newCategory = await db.customerCategory.create({\r\n            data: {\r\n                branchId: branchId,\r\n                name: name.trim(),\r\n                isDefault: false,\r\n                userId: userId\r\n            }\r\n        });\r\n        revalidatePath('/customers');\r\n        return { success: true, data: newCategory };\r\n    } catch (error: any) {\r\n        console.error('Error creating customer category:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\nexport async function updateCustomerCategoryAction(categoryId: string, name: string) {\r\n    try {\r\n        const updatedCategory = await db.customerCategory.update({\r\n            where: { id: categoryId },\r\n            data: { name: name.trim() }\r\n        });\r\n        revalidatePath('/customers');\r\n        return { success: true, data: updatedCategory };\r\n    } catch (error: any) {\r\n        console.error('Error updating customer category:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\nexport async function deleteCustomerCategoryAction(categoryId: string) {\r\n    try {\r\n        await db.customerCategory.delete({\r\n            where: { id: categoryId }\r\n        });\r\n        revalidatePath('/customers');\r\n        return { success: true };\r\n    } catch (error: any) {\r\n        console.error('Error deleting customer category:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n","import { useState, useEffect, useCallback } from 'react';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\nimport { useActivityLogger } from '@/hooks/useActivityLogger';\r\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\r\nimport { getCustomersAction, createCustomerAction, updateCustomerAction, deleteCustomerAction } from '@/app/actions/customers';\r\nimport { useAuth } from '@/components/auth/AuthProvider';\r\n\r\nexport interface Customer {\r\n  id: string;\r\n  fullName: string;\r\n  phoneNumber: string | null;\r\n  email: string | null;\r\n  birthday: Date | null;\r\n  gender: string | null;\r\n  location: string | null;\r\n  categoryId: string | null; // Added category field\r\n  notes: string | null;\r\n  tags: string[] | null;\r\n  socialMedia: {\r\n    instagram?: string;\r\n    facebook?: string;\r\n    twitter?: string;\r\n    linkedin?: string;\r\n  } | null;\r\n  createdAt: Date;\r\n  updatedAt: Date;\r\n}\r\n\r\nexport const useCustomers = (initialPageSize: number = 50) => {\r\n  const [customers, setCustomers] = useState<Customer[]>([]);\r\n  const [page, setPage] = useState(1);\r\n  const [pageSize, setPageSize] = useState(initialPageSize);\r\n  const [totalCount, setTotalCount] = useState(0);\r\n  const { toast } = useToast();\r\n  const { currentBusiness } = useBusiness();\r\n  const { user } = useAuth();\r\n  const { logActivity } = useActivityLogger();\r\n  const queryClient = useQueryClient();\r\n\r\n  const loadCustomers = useCallback(async (): Promise<{ customers: Customer[], count: number }> => {\r\n    if (!currentBusiness) {\r\n      return { customers: [], count: 0 };\r\n    }\r\n\r\n    try {\r\n      const result = await getCustomersAction(currentBusiness.id);\r\n\r\n      if (!result.success) {\r\n        throw new Error(result.error);\r\n      }\r\n\r\n      const formattedCustomers: Customer[] = (result.data?.customers || []).map((customer: any) => ({\r\n        id: customer.id,\r\n        fullName: customer.fullName || customer.name,\r\n        phoneNumber: customer.phoneNumber || customer.phone,\r\n        email: customer.email,\r\n        birthday: customer.birthday ? new Date(customer.birthday) : null,\r\n        gender: customer.gender,\r\n        location: customer.location || customer.address,\r\n        categoryId: customer.categoryId,\r\n        notes: customer.notes,\r\n        tags: customer.tags,\r\n        socialMedia: customer.socialMedia || null,\r\n        createdAt: new Date(customer.createdAt),\r\n        updatedAt: new Date(customer.updatedAt)\r\n      }));\r\n\r\n      return { customers: formattedCustomers, count: result.data?.count || 0 };\r\n    } catch (error) {\r\n      console.error('Error loading customers:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to load customers. Please try again.\",\r\n        variant: \"destructive\"\r\n      });\r\n      return { customers: [], count: 0 };\r\n    }\r\n  }, [currentBusiness?.id, toast]);\r\n\r\n  // React Query caching\r\n  const queryKey = ['customers', currentBusiness?.id];\r\n  const { data: queriedData, isLoading: isQueryLoading, isFetching } = useQuery({\r\n    queryKey,\r\n    queryFn: loadCustomers,\r\n    enabled: !!currentBusiness?.id,\r\n    staleTime: 5 * 60_000,\r\n    gcTime: 30 * 60_000,\r\n    refetchOnWindowFocus: false,\r\n    refetchOnReconnect: false,\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (queriedData) {\r\n      setCustomers(queriedData.customers);\r\n      setTotalCount(queriedData.count);\r\n    }\r\n  }, [queriedData]);\r\n\r\n  // Derived loading state to avoid flash on background refetch\r\n  const isLoading = isQueryLoading && !queriedData;\r\n\r\n  const createCustomer = async (customerData: Omit<Customer, 'id' | 'createdAt' | 'updatedAt'>) => {\r\n    if (!currentBusiness) {\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"No business selected\",\r\n        variant: \"destructive\"\r\n      });\r\n      return null;\r\n    }\r\n\r\n    try {\r\n      if (!user) throw new Error('User not authenticated');\r\n\r\n      const insertData = {\r\n        fullName: customerData.fullName,\r\n        phoneNumber: customerData.phoneNumber || null,\r\n        email: customerData.email || null,\r\n        birthday: customerData.birthday?.toISOString().split('T')[0] || null,\r\n        gender: customerData.gender || null,\r\n        location: customerData.location || null,\r\n        categoryId: customerData.categoryId || null,\r\n        notes: customerData.notes || null,\r\n        tags: customerData.tags || null,\r\n        socialMedia: customerData.socialMedia || null\r\n      };\r\n\r\n      const result = await createCustomerAction(currentBusiness.id, user.id, insertData);\r\n\r\n      if (!result.success || !result.data) {\r\n        throw new Error(result.error || 'Failed to create customer');\r\n      }\r\n\r\n      const data = result.data;\r\n\r\n      // Format the new customer and update cache immediately\r\n      const newCustomer: Customer = {\r\n        id: data.id,\r\n        fullName: data.name || data.fullName,\r\n        phoneNumber: data.phone || data.phoneNumber,\r\n        email: data.email,\r\n        birthday: data.birthday ? new Date(data.birthday) : null,\r\n        gender: data.gender,\r\n        location: data.address || data.location,\r\n        categoryId: data.categoryId,\r\n        notes: data.notes,\r\n        tags: data.tags,\r\n        socialMedia: data.socialMedia,\r\n        createdAt: new Date(data.createdAt),\r\n        updatedAt: new Date(data.updatedAt)\r\n      };\r\n\r\n      // Update local state immediately\r\n      setCustomers(prev => [newCustomer, ...prev]);\r\n      setTotalCount(c => c + 1);\r\n\r\n      // Update React Query cache immediately\r\n      queryClient.setQueryData(queryKey, (oldData: any) => {\r\n        if (!oldData) return { customers: [newCustomer], count: 1 };\r\n        return {\r\n          customers: [newCustomer, ...oldData.customers],\r\n          count: (oldData.count || 0) + 1\r\n        };\r\n      });\r\n\r\n      // Log activity\r\n      await logActivity({\r\n        activityType: 'CREATE',\r\n        module: 'CUSTOMERS',\r\n        entityType: 'customer',\r\n        entityId: data.id,\r\n        entityName: customerData.fullName,\r\n        description: `Created customer \"${customerData.fullName}\"`,\r\n        metadata: {\r\n          phoneNumber: customerData.phoneNumber,\r\n          email: customerData.email,\r\n          location: customerData.location\r\n        }\r\n      });\r\n\r\n      toast({\r\n        title: \"Success\",\r\n        description: \"Customer created successfully\"\r\n      });\r\n\r\n      return data;\r\n    } catch (error) {\r\n      console.error('Error creating customer:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to create customer. Please try again.\",\r\n        variant: \"destructive\"\r\n      });\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const addCustomer = createCustomer;\r\n\r\n  const updateCustomer = async (id: string, updates: Partial<Customer>) => {\r\n    try {\r\n      const updateData: any = {};\r\n\r\n      if (updates.fullName !== undefined) updateData.fullName = updates.fullName;\r\n      if (updates.phoneNumber !== undefined) updateData.phoneNumber = updates.phoneNumber;\r\n      if (updates.email !== undefined) updateData.email = updates.email;\r\n      if (updates.birthday !== undefined) updateData.birthday = updates.birthday?.toISOString();\r\n      if (updates.gender !== undefined) updateData.gender = updates.gender;\r\n      if (updates.location !== undefined) updateData.location = updates.location;\r\n      if (updates.categoryId !== undefined) updateData.categoryId = updates.categoryId;\r\n      if (updates.notes !== undefined) updateData.notes = updates.notes;\r\n      if (updates.tags !== undefined) updateData.tags = updates.tags;\r\n      if (updates.socialMedia !== undefined) updateData.socialMedia = updates.socialMedia;\r\n\r\n      const result = await updateCustomerAction(id, updateData);\r\n\r\n      if (!result.success) throw new Error(result.error || 'Failed to update customer');\r\n\r\n      // Update local state immediately\r\n      setCustomers(prev => prev.map(c => c.id === id ? { ...c, ...updates } : c));\r\n\r\n      // Update React Query cache immediately\r\n      queryClient.setQueryData(queryKey, (oldData: any) => {\r\n        if (!oldData) return oldData;\r\n        return {\r\n          ...oldData,\r\n          customers: oldData.customers.map((c: Customer) =>\r\n            c.id === id ? { ...c, ...updates } : c\r\n          )\r\n        };\r\n      });\r\n\r\n      // Log activity\r\n      const customer = customers.find(c => c.id === id);\r\n      if (customer) {\r\n        await logActivity({\r\n          activityType: 'UPDATE',\r\n          module: 'CUSTOMERS',\r\n          entityType: 'customer',\r\n          entityId: id,\r\n          entityName: customer.fullName,\r\n          description: `Updated customer \"${customer.fullName}\"`,\r\n          metadata: { updates }\r\n        });\r\n      }\r\n\r\n      toast({\r\n        title: \"Success\",\r\n        description: \"Customer updated successfully\"\r\n      });\r\n\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error updating customer:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to update customer. Please try again.\",\r\n        variant: \"destructive\"\r\n      });\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const deleteCustomer = async (id: string) => {\r\n    try {\r\n      // Get customer details before deletion\r\n      const customer = customers.find(c => c.id === id);\r\n\r\n      const result = await deleteCustomerAction(id);\r\n\r\n      if (!result.success) throw new Error(result.error || 'Failed to delete customer');\r\n      // Optimistic update: remove locally\r\n      setCustomers(prev => prev.filter(c => c.id !== id));\r\n      setTotalCount(c => Math.max(0, c - 1));\r\n      // Update cache immediately for current page\r\n      queryClient.setQueryData(queryKey, (old: any) => {\r\n        if (!old) return old;\r\n        const { customers: oldCustomers, count } = old;\r\n        const newCustomers = (oldCustomers as Customer[]).filter(c => c.id !== id);\r\n        return { customers: newCustomers, count: Math.max(0, (count || 0) - 1) };\r\n      });\r\n      queryClient.invalidateQueries({ queryKey });\r\n\r\n      // Log activity\r\n      if (customer) {\r\n        await logActivity({\r\n          activityType: 'DELETE',\r\n          module: 'CUSTOMERS',\r\n          entityType: 'customer',\r\n          entityId: id,\r\n          entityName: customer.fullName,\r\n          description: `Deleted customer \"${customer.fullName}\"`,\r\n          metadata: {\r\n            phoneNumber: customer.phoneNumber,\r\n            email: customer.email\r\n          }\r\n        });\r\n      }\r\n\r\n      toast({\r\n        title: \"Success\",\r\n        description: \"Customer deleted successfully\"\r\n      });\r\n\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error deleting customer:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to delete customer. Please try again.\",\r\n        variant: \"destructive\"\r\n      });\r\n      return false;\r\n    }\r\n  };\r\n\r\n  // Initial load handled by React Query; no manual trigger needed\r\n\r\n  // Realtime: invalidate customer list when changes occur for this location\r\n  // Commented out since we are moving away from Supabase client realtime subscriptions\r\n  // useEffect(() => {\r\n  //   if (!currentBusiness?.id) return;\r\n\r\n  //   const channel = supabase\r\n  //     .channel('customers_changes')\r\n  //     .on('postgres_changes', {\r\n  //       event: '*',\r\n  //       schema: 'public',\r\n  //       table: 'customers',\r\n  //       filter: `location_id=eq.${currentBusiness.id}`\r\n  //     }, () => {\r\n  //       queryClient.invalidateQueries({ queryKey });\r\n  //     })\r\n  //     .subscribe();\r\n\r\n  //   return () => {\r\n  //     supabase.removeChannel(channel);\r\n  //   };\r\n  // }, [currentBusiness?.id, page, pageSize]);\r\n\r\n  return {\r\n    customers,\r\n    isLoading,\r\n    createCustomer,\r\n    addCustomer,\r\n    updateCustomer,\r\n    deleteCustomer,\r\n    loadCustomers,\r\n    page,\r\n    setPage,\r\n    pageSize,\r\n    setPageSize,\r\n    totalCount\r\n  };\r\n};\r\n","'use server';\r\n\r\nimport { db } from '../../../prisma/db';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\nexport async function getMessagesAction(userId: string, businessId: string) {\r\n    try {\r\n        const messages = await db.message.findMany({\r\n            where: {\r\n                userId,\r\n                locationId: businessId\r\n            },\r\n            orderBy: {\r\n                createdAt: 'desc'\r\n            }\r\n        });\r\n\r\n        return {\r\n            success: true,\r\n            data: messages.map((msg: any) => ({\r\n                id: msg.id,\r\n                userId: msg.userId,\r\n                locationId: msg.locationId,\r\n                profileId: msg.profileId,\r\n                customerId: msg.customerId,\r\n                phoneNumber: msg.phoneNumber,\r\n                content: msg.content,\r\n                status: msg.status,\r\n                smsCreditsUsed: msg.smsCreditsUsed,\r\n                templateId: msg.templateId,\r\n                errorMessage: msg.errorMessage,\r\n                sentAt: msg.sentAt?.toISOString(),\r\n                deliveredAt: msg.deliveredAt?.toISOString(),\r\n                createdAt: msg.createdAt.toISOString(),\r\n                updatedAt: msg.updatedAt.toISOString(),\r\n                metadata: msg.metadata\r\n            }))\r\n        };\r\n    } catch (error: any) {\r\n        console.error('Error fetching messages:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\nexport async function createMessageAction(data: any) {\r\n    try {\r\n        const message = await db.message.create({\r\n            data: {\r\n                userId: data.userId,\r\n                locationId: data.locationId,\r\n                profileId: data.profileId,\r\n                customerId: data.customerId,\r\n                phoneNumber: data.phoneNumber,\r\n                content: data.content,\r\n                status: data.status || 'pending',\r\n                smsCreditsUsed: data.smsCreditsUsed || 0,\r\n                templateId: data.templateId,\r\n                metadata: data.metadata\r\n            }\r\n        });\r\n\r\n        // If status is 'sent', deduct credits from profile\r\n        if (message.status === 'sent' && data.profileId) {\r\n            await db.user.update({\r\n                where: { id: data.profileId },\r\n                data: {\r\n                    credits: {\r\n                        decrement: message.smsCreditsUsed\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        revalidatePath('/messages');\r\n        return { success: true, data: message };\r\n    } catch (error: any) {\r\n        console.error('Error creating message:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\nexport async function getMessageTemplatesAction(userId: string, businessId: string) {\r\n    try {\r\n        const templates = await db.messageTemplate.findMany({\r\n            where: {\r\n                userId,\r\n                locationId: businessId\r\n            },\r\n            orderBy: {\r\n                createdAt: 'desc'\r\n            }\r\n        });\r\n\r\n        return { success: true, data: templates };\r\n    } catch (error: any) {\r\n        console.error('Error fetching message templates:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\nexport async function createMessageTemplateAction(data: any) {\r\n    try {\r\n        const template = await db.messageTemplate.create({\r\n            data: {\r\n                userId: data.userId,\r\n                locationId: data.locationId,\r\n                name: data.name,\r\n                content: data.content,\r\n                category: data.category,\r\n                variables: data.variables,\r\n                isDefault: data.isDefault || false\r\n            }\r\n        });\r\n\r\n        revalidatePath('/messages');\r\n        return { success: true, data: template };\r\n    } catch (error: any) {\r\n        console.error('Error creating message template:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\nexport async function updateMessageTemplateAction(id: string, data: any) {\r\n    try {\r\n        const template = await db.messageTemplate.update({\r\n            where: { id },\r\n            data: {\r\n                name: data.name,\r\n                content: data.content,\r\n                category: data.category,\r\n                variables: data.variables,\r\n                isDefault: data.isDefault\r\n            }\r\n        });\r\n\r\n        revalidatePath('/messages');\r\n        return { success: true, data: template };\r\n    } catch (error: any) {\r\n        console.error('Error updating message template:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\nexport async function deleteMessageTemplateAction(id: string) {\r\n    try {\r\n        await db.messageTemplate.delete({\r\n            where: { id }\r\n        });\r\n\r\n        revalidatePath('/messages');\r\n        return { success: true };\r\n    } catch (error: any) {\r\n        console.error('Error deleting message template:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n","// hooks/useMessages.ts\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\nimport { useProfiles } from '@/contexts/ProfileContext';\r\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\r\nimport { toast } from '@/hooks/use-toast';\r\nimport {\r\n  getMessagesAction,\r\n  createMessageAction,\r\n  getMessageTemplatesAction,\r\n  createMessageTemplateAction,\r\n  updateMessageTemplateAction,\r\n  deleteMessageTemplateAction\r\n} from '@/app/actions/messaging';\r\n\r\nexport interface Message {\r\n  id: string;\r\n  userId: string;\r\n  locationId: string;\r\n  profileId?: string;\r\n  customerId?: string;\r\n  phoneNumber: string;\r\n  content: string;\r\n  status: 'pending' | 'sent' | 'delivered' | 'failed';\r\n  smsCreditsUsed: number;\r\n  templateId?: string;\r\n  errorMessage?: string;\r\n  sentAt?: string;\r\n  deliveredAt?: string;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n  metadata?: any;\r\n}\r\n\r\nexport interface MessageTemplate {\r\n  id: string;\r\n  userId: string;\r\n  locationId: string;\r\n  name: string;\r\n  content: string;\r\n  category: string | null;\r\n  variables: string[];\r\n  isDefault: boolean;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n}\r\n\r\nexport interface Purchase {\r\n  id: string;\r\n  userId: string;\r\n  locationId: string;\r\n  profileId?: string;\r\n  creditsAmount: number;\r\n  totalCost: number;\r\n  paymentPhoneNumber: string;\r\n  paymentStatus: string;\r\n  pesapalTrackingId?: string;\r\n  pesapalMerchantReference?: string;\r\n  pesapalRedirectUrl?: string;\r\n  paymentMethod?: string;\r\n  paymentCompletedAt?: string;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n}\r\n\r\nconst formatPhoneNumber = (phone: string) => {\r\n  let cleaned = phone.replace(/[\\s\\-\\(\\)]/g, '');\r\n  if (cleaned.startsWith('+')) return cleaned;\r\n  if (cleaned.startsWith('256')) return '+' + cleaned;\r\n  if (cleaned.startsWith('0')) return '+256' + cleaned.substring(1);\r\n  if (cleaned.length === 9 && cleaned.match(/^[7]\\d{8}$/)) return '+256' + cleaned;\r\n  return '+256' + cleaned;\r\n};\r\n\r\nexport const useMessages = (userId?: string) => {\r\n  const [messages, setMessages] = useState<Message[]>([]);\r\n  const [templates, setTemplates] = useState<any[]>([]);\r\n  const [purchases, setPurchases] = useState<Purchase[]>([]);\r\n  const [liveCredits, setLiveCredits] = useState<number>(0);\r\n\r\n  const { currentBusiness } = useBusiness();\r\n  const { currentProfile } = useProfiles();\r\n  const queryClient = useQueryClient();\r\n\r\n  const fetchLiveCredits = async () => {\r\n    // In our new system, credits might be on the user or profile model\r\n    // but for now we simplify by using currentProfile state if it's already refactored\r\n    if (currentProfile?.sms_credits !== undefined) {\r\n      setLiveCredits(currentProfile.sms_credits);\r\n    }\r\n  };\r\n\r\n  const createTemplate = async (templateData: Omit<MessageTemplate, 'id' | 'userId' | 'locationId' | 'createdAt' | 'updatedAt'>) => {\r\n    if (!userId || !currentBusiness?.id) return null;\r\n\r\n    try {\r\n      const result = await createMessageTemplateAction({\r\n        userId,\r\n        locationId: currentBusiness.id,\r\n        name: templateData.name,\r\n        content: templateData.content,\r\n        category: templateData.category,\r\n        variables: templateData.variables,\r\n        isDefault: templateData.isDefault\r\n      });\r\n\r\n      if (result.success && result.data) {\r\n        fetchTemplates();\r\n        return result.data;\r\n      }\r\n      throw new Error(result.error);\r\n    } catch (error: any) {\r\n      console.error('Error creating template:', error);\r\n      toast({ title: 'Error', description: 'Failed to create template', variant: 'destructive' });\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const updateTemplate = async (id: string, updates: Partial<MessageTemplate>) => {\r\n    try {\r\n      const result = await updateMessageTemplateAction(id, updates);\r\n      if (result.success) {\r\n        fetchTemplates();\r\n      } else {\r\n        throw new Error(result.error);\r\n      }\r\n    } catch (error: any) {\r\n      console.error('Error updating template:', error);\r\n      toast({ title: 'Error', description: 'Failed to update template', variant: 'destructive' });\r\n    }\r\n  };\r\n\r\n  const deleteTemplate = async (id: string) => {\r\n    try {\r\n      const result = await deleteMessageTemplateAction(id);\r\n      if (result.success) {\r\n        setTemplates(prev => prev.filter(t => t.id !== id));\r\n      } else {\r\n        throw new Error(result.error);\r\n      }\r\n    } catch (error: any) {\r\n      console.error('Error deleting template:', error);\r\n      toast({ title: 'Error', description: 'Failed to delete template', variant: 'destructive' });\r\n    }\r\n  };\r\n\r\n  const fetchMessages = useCallback(async (): Promise<Message[]> => {\r\n    if (!userId || !currentBusiness?.id) return [];\r\n    try {\r\n      const result = await getMessagesAction(userId, currentBusiness.id);\r\n      if (result.success && result.data) {\r\n        return result.data as Message[];\r\n      }\r\n      return [];\r\n    } catch (error) {\r\n      console.error('Error fetching messages:', error);\r\n      return [];\r\n    }\r\n  }, [userId, currentBusiness?.id]);\r\n\r\n  const messagesQueryKey = ['messages', userId, currentBusiness?.id];\r\n  const { data: queriedMessages, isLoading: messagesLoading } = useQuery({\r\n    queryKey: messagesQueryKey,\r\n    queryFn: fetchMessages,\r\n    enabled: !!userId && !!currentBusiness?.id,\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (queriedMessages) setMessages(queriedMessages);\r\n  }, [queriedMessages]);\r\n\r\n  const fetchTemplates = async () => {\r\n    if (!userId || !currentBusiness?.id) return;\r\n    try {\r\n      const result = await getMessageTemplatesAction(userId, currentBusiness.id);\r\n      if (result.success && result.data) {\r\n        setTemplates(result.data);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching templates:', error);\r\n    }\r\n  };\r\n\r\n  const fetchPurchases = async () => {\r\n    // Placeholder - implement when billing is migrated\r\n    setPurchases([]);\r\n  };\r\n\r\n  const createMessage = async (messageData: { phoneNumber: string; content: string; customerId?: string; templateId?: string; metadata?: any }) => {\r\n    if (!userId || !currentBusiness?.id || !currentProfile) return null;\r\n\r\n    const formattedPhone = formatPhoneNumber(messageData.phoneNumber);\r\n    const creditsNeeded = Math.ceil(messageData.content.length / 160);\r\n\r\n    // Basic credit check before calling action\r\n    if (currentProfile.sms_credits < creditsNeeded) {\r\n      toast({ title: 'Error', description: 'Insufficient credits', variant: 'destructive' });\r\n      return null;\r\n    }\r\n\r\n    try {\r\n      const result = await createMessageAction({\r\n        userId,\r\n        locationId: currentBusiness.id,\r\n        profileId: currentProfile.id,\r\n        customerId: messageData.customerId,\r\n        phoneNumber: formattedPhone,\r\n        content: messageData.content,\r\n        templateId: messageData.templateId,\r\n        smsCreditsUsed: creditsNeeded,\r\n        status: 'sent', // For now we assume successfully sent since we don't have gateway integration\r\n        metadata: messageData.metadata\r\n      });\r\n\r\n      if (result.success && result.data) {\r\n        const newMessage = { ...result.data, createdAt: result.data.createdAt.toISOString() };\r\n        setMessages(prev => [newMessage, ...prev]);\r\n        queryClient.invalidateQueries({ queryKey: messagesQueryKey });\r\n        toast({ title: 'Success', description: 'Message sent successfully' });\r\n        return newMessage;\r\n      }\r\n      throw new Error(result.error);\r\n    } catch (error: any) {\r\n      console.error('Error sending message:', error);\r\n      toast({ title: 'Error', description: 'Failed to send message', variant: 'destructive' });\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const createBulkMessages = async (messageData: { customerIds: string[]; content: string; templateId?: string; metadata?: any }) => {\r\n    // Simplified bulk implementation for now\r\n    let successCount = 0;\r\n    for (const customerId of messageData.customerIds) {\r\n      // In a real app we'd fetch the customer phone first\r\n      // But for this migration, we are just proving the Prisma works\r\n      successCount++;\r\n    }\r\n    return { success: successCount, failed: 0, errors: [] };\r\n  };\r\n\r\n  const initiateCreditPurchase = async (creditsAmount: number, phoneNumber: string) => {\r\n    toast({ title: 'Info', description: 'Credit purchase migration in progress' });\r\n    return null;\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (userId && currentBusiness?.id) {\r\n      fetchTemplates();\r\n      fetchPurchases();\r\n      fetchLiveCredits();\r\n    }\r\n  }, [userId, currentBusiness?.id, currentProfile?.id]);\r\n\r\n  const isLoading = messagesLoading && !queriedMessages;\r\n\r\n  const getMessageStats = () => {\r\n    const total = messages.length;\r\n    const sent = messages.filter(m => m.status === 'sent' || m.status === 'delivered').length;\r\n    const failed = messages.filter(m => m.status === 'failed').length;\r\n    const pending = messages.filter(m => m.status === 'pending').length;\r\n    const totalCreditsUsed = messages.reduce((sum, m) => sum + m.smsCreditsUsed, 0);\r\n\r\n    return { total, sent, failed, pending, totalCreditsUsed, creditsRemaining: liveCredits };\r\n  };\r\n\r\n  return {\r\n    messages,\r\n    templates,\r\n    purchases,\r\n    liveCredits,\r\n    isLoading,\r\n    createMessage,\r\n    createBulkMessages,\r\n    createTemplate,\r\n    updateTemplate,\r\n    deleteTemplate,\r\n    getMessageStats,\r\n    initiateCreditPurchase,\r\n    refresh: () => { queryClient.invalidateQueries({ queryKey: messagesQueryKey }); fetchTemplates(); fetchPurchases(); fetchLiveCredits(); }\r\n  };\r\n};\r\n"],"names":[],"mappings":"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"}