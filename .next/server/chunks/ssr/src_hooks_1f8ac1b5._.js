module.exports=[129743,a=>{"use strict";var b=a.i(572131),c=a.i(391956),d=a.i(169819),e=a.i(478793),f=a.i(433217),g=a.i(937927);let h=a=>({id:a.id,accountId:a.account_id,amount:Number(a.amount),transactionType:a.transaction_type,category:a.category,description:a.description,personInCharge:a.person_in_charge,tags:a.tags,date:new Date(a.date),paymentMethod:a.payment_method,receiptImage:a.receipt_image,createdAt:new Date(a.created_at),updatedAt:new Date(a.updated_at)});var i=a.i(405050);let j=(0,i.createServerReference)("6050d5e4425dec9de12384682af8632685a43503f6",i.callServer,void 0,i.findSourceMapURL,"getCashTransactionsAction"),k=(0,i.createServerReference)("4064724fc471e698ee76d294a980e2a65c0a9c856a",i.callServer,void 0,i.findSourceMapURL,"createCashTransactionAction"),l=(0,i.createServerReference)("60e4c60d7aa378a229209542057eb77c66409f1850",i.callServer,void 0,i.findSourceMapURL,"updateCashTransactionAction"),m=(0,i.createServerReference)("605e333b82184dfc91eaa2d1fe6090163e41e2aa78",i.callServer,void 0,i.findSourceMapURL,"deleteCashTransactionAction"),n=(0,i.createServerReference)("60233cf66a8bd607780138afb600e5b4300ab3ce36",i.callServer,void 0,i.findSourceMapURL,"getAccountOpeningBalanceAction"),o=(0,i.createServerReference)("402f81bafe02611b5b5687b2b85c12e36ea9604ccf",i.callServer,void 0,i.findSourceMapURL,"createBulkCashTransactionsAction");a.s(["useCashTransactions",0,a=>{let{user:i}=(0,c.useAuth)(),{currentBusiness:p}=(0,d.useBusiness)(),{toast:q}=(0,e.useToast)(),r=(0,g.useQueryClient)(),s=(0,b.useCallback)(async()=>{try{if(!i||!p)return[];let b=await j(p.id,a);if(!b.success||!b.data)throw Error(b.error||"Failed to fetch transactions");let c=b.data.map(a=>{let b={id:a.id,user_id:a.user_id,account_id:a.account_id,amount:Number(a.amount),transaction_type:a.transaction_type,category:a.category,description:a.description,person_in_charge:a.person_in_charge,tags:a.tags,date:a.date,payment_method:a.payment_method,receipt_image:a.receipt_image,created_at:a.created_at,updated_at:a.updated_at};return h(b)});return c.sort((a,b)=>{let c=new Date(b.date).getTime()-new Date(a.date).getTime();return 0!==c?c:new Date(b.createdAt).getTime()-new Date(a.createdAt).getTime()}),c}catch(a){return console.error("Error loading cash transactions:",a),q({title:"Error",description:"Failed to load cash transactions",variant:"destructive"}),[]}},[i,p?.id,a,q]),t=(0,b.useMemo)(()=>["cash_transactions",p?.id,i?.id,a],[p?.id,i?.id,a]),{data:u=[],isLoading:v}=(0,f.useQuery)({queryKey:t,queryFn:s,enabled:!!i&&!!p?.id,staleTime:3e4}),w=v&&0===u.length,x=async a=>{try{if(!i||!p)throw Error("User not authenticated");let b=await k({...a,userId:i.id,locationId:p.id});if(!b.success)throw Error(b.error);return q({title:"Success",description:"transfer"===a.transactionType?"Transfer completed successfully":"Cash transaction created successfully"}),r.invalidateQueries({queryKey:t}),Array.isArray(b.data)?h(b.data[0]):h(b.data)}catch(a){throw console.error("Error creating cash transaction:",a),q({title:"Error",description:"Failed to create cash transaction",variant:"destructive"}),a}},y=async a=>{try{if(!i||!p)throw Error("User not authenticated");let b=a.map(a=>({...a,userId:i.id,locationId:p.id})),c=await o(b);if(!c.success)throw Error(c.error);return q({title:"Success",description:`Successfully created ${a.length} transactions`}),r.invalidateQueries({queryKey:t}),c.data.map(a=>h(a))}catch(a){throw console.error("Error creating bulk transactions:",a),q({title:"Error",description:"Failed to create bulk transactions",variant:"destructive"}),a}},z=async(a,b)=>{try{let c=await l(a,b);if(!c.success)throw Error(c.error);return q({title:"Success",description:"Transaction updated successfully"}),r.invalidateQueries({queryKey:t}),h(c.data)}catch(a){return console.error("Error updating cash transaction:",a),q({title:"Error",description:"Failed to update transaction",variant:"destructive"}),null}},A=async(a,b)=>{try{if(!p)throw Error("No business selected");let c=await m(a,p.id);if(!c.success)throw Error(c.error);return q({title:"Success",description:"Cash transaction deleted successfully"}),r.invalidateQueries({queryKey:t}),b&&b(),!0}catch(a){return console.error("Error deleting cash transaction:",a),q({title:"Error",description:"Failed to delete cash transaction",variant:"destructive"}),!1}},B=(0,b.useCallback)(async a=>{try{if(!p)return 0;let b=await n(a,p.id);return b.success?b.data:0}catch(a){return 0}},[p?.id]),C=(0,b.useCallback)(async(a,b)=>{let c=a.toISOString().split("T")[0],d=u.filter(a=>a.date.toISOString().split("T")[0]===c);b&&(d=d.filter(a=>a.accountId===b));let e=d.filter(a=>"cash_in"===a.transactionType||"transfer_in"===a.transactionType).reduce((a,b)=>a+b.amount,0),f=d.filter(a=>"cash_out"===a.transactionType||"transfer_out"===a.transactionType).reduce((a,b)=>a+b.amount,0),g=d.filter(a=>"transfer_in"===a.transactionType).reduce((a,b)=>a+b.amount,0),h=d.filter(a=>"transfer_out"===a.transactionType).reduce((a,b)=>a+b.amount,0),i=new Date(a);i.setDate(i.getDate()-1);let j=i.toISOString().split("T")[0],k=u.filter(a=>a.date.toISOString().split("T")[0]<=j);b&&(k=k.filter(a=>a.accountId===b));let l=k.filter(a=>"cash_in"===a.transactionType||"transfer_in"===a.transactionType).reduce((a,b)=>a+b.amount,0),m=k.filter(a=>"cash_out"===a.transactionType||"transfer_out"===a.transactionType).reduce((a,b)=>a+b.amount,0),n=0;b&&(n=await B(b));let o=n+l-m;return{date:a,openingBalance:o,cashIn:e,cashOut:f,transfersIn:g,transfersOut:h,closingBalance:o+e-f}},[u,B]),D=(0,b.useCallback)(async(a,b,c)=>{let d=a.toISOString().split("T")[0],e=b.toISOString().split("T")[0],f=u.filter(a=>{let b=a.date.toISOString().split("T")[0];return b>=d&&b<=e});c&&(f=f.filter(a=>a.accountId===c));let g=f.filter(a=>"cash_in"===a.transactionType||"transfer_in"===a.transactionType).reduce((a,b)=>a+b.amount,0),h=f.filter(a=>"cash_out"===a.transactionType||"transfer_out"===a.transactionType).reduce((a,b)=>a+b.amount,0),i=f.filter(a=>"transfer_in"===a.transactionType).reduce((a,b)=>a+b.amount,0),j=f.filter(a=>"transfer_out"===a.transactionType).reduce((a,b)=>a+b.amount,0),k=new Date(a);k.setDate(k.getDate()-1);let l=k.toISOString().split("T")[0],m=u.filter(a=>a.date.toISOString().split("T")[0]<=l);c&&(m=m.filter(a=>a.accountId===c));let n=m.filter(a=>"cash_in"===a.transactionType||"transfer_in"===a.transactionType).reduce((a,b)=>a+b.amount,0),o=m.filter(a=>"cash_out"===a.transactionType||"transfer_out"===a.transactionType).reduce((a,b)=>a+b.amount,0),p=0;c&&(p=await B(c));let q=p+n-o;return{date:a,openingBalance:q,cashIn:g,cashOut:h,transfersIn:i,transfersOut:j,closingBalance:q+g-h}},[u,B]),E=(0,b.useCallback)(()=>{r.invalidateQueries({queryKey:t})},[r,t]);return(0,b.useMemo)(()=>({transactions:u,isLoading:w,createTransaction:x,createBulkTransactions:y,updateTransaction:z,deleteTransaction:A,getDailySummary:C,getDateRangeSummary:D,refreshTransactions:E}),[u,w,x,y,z,A,C,D,E])}],129743)},161990,a=>{"use strict";var b=a.i(572131),c=a.i(169819),d=a.i(478793),e=a.i(391956),f=a.i(405050);let g=(0,f.createServerReference)("40d192c7133b72d6eb22105e9bdccca4dd09d6c312",f.callServer,void 0,f.findSourceMapURL,"getSalesCategoriesAction"),h=(0,f.createServerReference)("78f34606537592502556e5eff8bf435c75821848df",f.callServer,void 0,f.findSourceMapURL,"createSalesCategoryAction"),i=(0,f.createServerReference)("601c76a41759792ff7ede8d55df9ffa468b0da22c2",f.callServer,void 0,f.findSourceMapURL,"updateSalesCategoryAction"),j=(0,f.createServerReference)("4048df543ea89e6b499e78c5496b2ff9ac8b3367ff",f.callServer,void 0,f.findSourceMapURL,"deleteSalesCategoryAction");a.s(["useSalesCategories",0,()=>{let[a,f]=(0,b.useState)([]),[k,l]=(0,b.useState)(!0),{currentBusiness:m}=(0,c.useBusiness)(),{user:n}=(0,e.useAuth)(),o=async()=>{if(!m){f([]),l(!1);return}try{let a=await g(m.id);if(a.success&&a.data)f(a.data);else throw Error(a.error)}catch(a){console.error("Error fetching sales categories:",a),(0,d.toast)({title:"Error",description:"Failed to fetch sales categories",variant:"destructive"})}finally{l(!1)}};return(0,b.useEffect)(()=>{o()},[m]),{categories:a,isLoading:k,createCategory:async a=>{if(!m||!n)return(0,d.toast)({title:"Error",description:"No business selected or user not authenticated",variant:"destructive"}),!1;try{let b=await h(m.id,n.id,a);if(b.success)return(0,d.toast)({title:"Success",description:"Sales category created successfully"}),o(),!0;throw Error(b.error)}catch(a){return console.error("Error creating sales category:",a),(0,d.toast)({title:"Error",description:"Failed to create sales category",variant:"destructive"}),!1}},updateCategory:async(a,b)=>{try{let c=await i(a,b);if(c.success)return(0,d.toast)({title:"Success",description:"Sales category updated successfully"}),o(),!0;throw Error(c.error)}catch(a){return console.error("Error updating sales category:",a),(0,d.toast)({title:"Error",description:"Failed to update sales category",variant:"destructive"}),!1}},deleteCategory:async a=>{try{let b=await j(a);if(b.success)return(0,d.toast)({title:"Success",description:"Sales category deleted successfully"}),o(),!0;throw Error(b.error)}catch(a){return console.error("Error deleting sales category:",a),(0,d.toast)({title:"Error",description:"Failed to delete sales category",variant:"destructive"}),!1}},createDefaultCategories:async()=>{if(m&&n)try{for(let a of["Retail","Online","Wholesale"])await h(m.id,n.id,a,!0);o()}catch(a){console.error("Error creating default categories:",a)}},refetch:o}}],161990)}];

//# sourceMappingURL=src_hooks_1f8ac1b5._.js.map