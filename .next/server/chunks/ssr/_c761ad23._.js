module.exports=[22464,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(702771),g=a.i(197499),h=a.i(734637),i=a.i(799856),j=b([f,g,i]);[f,g,i]=j.then?(await j)():j;let k=f.Root;f.Trigger,f.Close;let l=f.Portal,m=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(f.Overlay,{className:(0,i.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...b,ref:c}));m.displayName=f.Overlay.displayName;let n=(0,g.cva)("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),o=e.forwardRef(({side:a="right",className:b,children:c,...e},g)=>(0,d.jsxs)(l,{children:[(0,d.jsx)(m,{}),(0,d.jsxs)(f.Content,{ref:g,className:(0,i.cn)(n({side:a}),b),...e,children:[c,(0,d.jsxs)(f.Close,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[(0,d.jsx)(h.X,{className:"h-4 w-4"}),(0,d.jsx)("span",{className:"sr-only",children:"Close"})]})]})]}));o.displayName=f.Content.displayName;let p=({className:a,...b})=>(0,d.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-2 text-center sm:text-left",a),...b});p.displayName="SheetHeader";let q=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(f.Title,{ref:c,className:(0,i.cn)("text-lg font-semibold text-foreground",a),...b}));q.displayName=f.Title.displayName;let r=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(f.Description,{ref:c,className:(0,i.cn)("text-sm text-muted-foreground",a),...b}));r.displayName=f.Description.displayName,a.s(["Sheet",()=>k,"SheetContent",()=>o,"SheetDescription",()=>r,"SheetHeader",()=>p,"SheetTitle",()=>q]),c()}catch(a){c(a)}},!1),468103,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(899054),f=a.i(499239),g=a.i(957143),h=a.i(734637),i=a.i(224993),j=a.i(584210),k=a.i(22464),l=a.i(396465),m=a.i(567326),n=a.i(558277),o=b([e,i,k,l,m]);[e,i,k,l,m]=o.then?(await o)():o,a.s(["default",0,({suggestions:a,isOpen:b,onClose:c,onSelectProduct:o,searchTerm:p,isLoading:q=!1})=>{let{settings:r}=(0,i.useBusinessSettings)(),s=(0,n.useIsMobile)(),t=(a,b)=>{if(!b)return a;let c=b.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),e=RegExp(`(${c})`,"gi");return a.split(e).map((a,b)=>e.test(a)?(0,d.jsx)("span",{className:"bg-yellow-200 font-medium",children:a},b):(0,d.jsx)("span",{children:a},b))},u=a=>{o(a),c()};return s?b&&(0!==a.length||q)?(0,d.jsxs)("div",{className:"bg-white border border-gray-200 rounded-md shadow-lg max-h-80 overflow-y-auto",children:[(0,d.jsxs)("div",{className:"p-2 border-b bg-gray-50",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)(g.Search,{className:"h-4 w-4 text-gray-600"}),(0,d.jsx)("span",{className:"text-sm font-medium",children:"Suggestions"})]}),(0,d.jsx)(l.Button,{variant:"ghost",size:"icon",onClick:c,className:"h-6 w-6",children:(0,d.jsx)(h.X,{className:"h-3 w-3"})})]}),(0,d.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:q?"Searching for products...":a.length>0?`Found ${a.length} product${a.length>1?"s":""}`:"No products found"})]}),q&&(0,d.jsxs)("div",{className:"p-8 text-center bg-white",children:[(0,d.jsx)("div",{className:"h-6 w-6 border-2 border-primary border-t-transparent animate-spin rounded-full mx-auto mb-2"}),(0,d.jsx)("span",{className:"text-xs text-gray-500",children:"Searching..."})]}),!q&&a.length>0&&(0,d.jsx)("div",{className:"max-h-64 overflow-y-auto bg-primary",children:a.map(a=>(0,d.jsx)("div",{className:"p-3 hover:bg-primary-foreground/20 cursor-pointer border-b border-primary-foreground/20 last:border-b-0 bg-white mx-1 my-1 rounded",onClick:()=>u(a),children:(0,d.jsxs)("div",{className:"flex items-start gap-3",children:[(0,d.jsx)(j.default,{imageUrl:a.imageUrl,alt:a.name,size:"sm"}),(0,d.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,d.jsx)(f.Package,{className:"h-4 w-4 text-gray-400 flex-shrink-0"}),(0,d.jsx)("div",{className:"font-medium text-sm truncate",children:t(a.name,p)})]}),(0,d.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,d.jsx)(e.Badge,{variant:"outline",className:"text-xs",children:a.category}),(0,d.jsxs)("span",{className:"text-xs text-gray-500",children:["Item #: ",t(a.itemNumber,p)]})]}),(0,d.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-1",children:[(0,d.jsxs)("span",{children:["Qty: ",a.quantity%1==0?a.quantity:a.quantity.toFixed(2)]}),(0,d.jsxs)("span",{className:"font-medium",children:[r.currency," ",a.sellingPrice.toFixed(2)]})]}),a.description&&(0,d.jsx)("div",{className:"text-xs text-gray-500 truncate",children:t(a.description,p)}),a.supplier&&(0,d.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["Supplier: ",t(a.supplier,p)]})]})]})},a.id))}),!q&&0===a.length&&(0,d.jsxs)("div",{className:"p-8 text-center bg-white",children:[(0,d.jsx)(g.Search,{className:"h-8 w-8 text-gray-300 mx-auto mb-2"}),(0,d.jsxs)("p",{className:"text-xs text-gray-500",children:['No products found matching "',p,'"']})]}),a.length>=50&&(0,d.jsx)("div",{className:"p-3 border-t bg-primary text-center",children:(0,d.jsx)("span",{className:"text-xs text-primary-foreground",children:"Showing top 50 results. Keep typing to refine..."})})]}):null:(0,d.jsx)(k.Sheet,{open:b,onOpenChange:c,modal:!1,children:(0,d.jsxs)(k.SheetContent,{className:"w-full sm:w-[400px] sm:max-w-[400px] p-0 z-[100] pointer-events-auto flex flex-col bg-primary",side:"right",onOpenAutoFocus:a=>a.preventDefault(),onCloseAutoFocus:a=>a.preventDefault(),children:[(0,d.jsxs)(k.SheetHeader,{className:"p-4 border-b border-primary-foreground/20 bg-primary flex-shrink-0",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)(g.Search,{className:"h-4 w-4 text-primary-foreground"}),(0,d.jsx)(k.SheetTitle,{className:"text-base text-primary-foreground",children:"Product Suggestions"})]}),(0,d.jsx)(l.Button,{variant:"ghost",size:"icon",onClick:c,className:"h-8 w-8 text-primary-foreground hover:bg-primary-foreground/20",children:(0,d.jsx)(h.X,{className:"h-4 w-4"})})]}),(0,d.jsx)(k.SheetDescription,{className:"text-left text-primary-foreground/80",children:q?"Searching for products...":a.length>0?`Found ${a.length} product${a.length>1?"s":""} matching "${p}"`:`No products found matching "${p}"`})]}),q?(0,d.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center p-8 text-primary-foreground bg-primary",children:[(0,d.jsx)("div",{className:"h-8 w-8 border-2 border-primary-foreground border-t-transparent animate-spin rounded-full mb-4"}),(0,d.jsx)("p",{className:"text-sm",children:"Searching products..."})]}):a.length>0?(0,d.jsx)(m.ScrollArea,{className:"flex-1 h-0 bg-primary",children:(0,d.jsx)("div",{className:"p-2",children:a.map(a=>(0,d.jsx)("div",{className:"p-3 hover:bg-primary-foreground/20 cursor-pointer border-b border-primary-foreground/20 last:border-b-0 rounded-md mx-1 my-1 hover:shadow-sm transition-all bg-white",onClick:()=>u(a),children:(0,d.jsxs)("div",{className:"flex items-start gap-3",children:[(0,d.jsx)(j.default,{imageUrl:a.imageUrl,alt:a.name,size:"sm"}),(0,d.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,d.jsx)(f.Package,{className:"h-4 w-4 text-gray-400 flex-shrink-0"}),(0,d.jsx)("div",{className:"font-medium text-sm truncate",children:t(a.name,p)})]}),(0,d.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,d.jsx)(e.Badge,{variant:"outline",className:"text-xs",children:a.category}),(0,d.jsxs)("span",{className:"text-xs text-gray-500",children:["Item #: ",t(a.itemNumber,p)]})]}),(0,d.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-1",children:[(0,d.jsxs)("span",{children:["Qty: ",a.quantity%1==0?a.quantity:a.quantity.toFixed(2)]}),(0,d.jsxs)("span",{className:"font-medium",children:[r.currency," ",a.sellingPrice.toFixed(2)]})]}),a.description&&(0,d.jsx)("div",{className:"text-xs text-gray-500 truncate",children:t(a.description,p)}),a.supplier&&(0,d.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["Supplier: ",t(a.supplier,p)]})]})]})},a.id))})}):(0,d.jsxs)("div",{className:"p-8 text-center text-primary-foreground flex-1 flex flex-col items-center justify-center bg-primary",children:[(0,d.jsx)(g.Search,{className:"h-12 w-12 mx-auto mb-4 text-primary-foreground/50"}),(0,d.jsx)("p",{className:"text-sm",children:"No products found"}),(0,d.jsx)("p",{className:"text-xs mt-1",children:"Try adjusting your search term"})]}),a.length>=50&&(0,d.jsx)("div",{className:"p-3 border-t bg-primary text-center flex-shrink-0",children:(0,d.jsx)("span",{className:"text-xs text-primary-foreground",children:"Showing top 50 results. Keep typing to refine..."})})]})})}]),c()}catch(a){c(a)}},!1),840238,a=>{"use strict";var b=a.i(127669),c=a.i(219269);a.s(["useProductSuggestions",0,(a,d)=>{let[e,f]=(0,b.useState)(!1),g=(0,b.useMemo)(()=>{if(!d||d.length<1)return[];let b=a.filter(a=>(0,c.matchProductSearch)(a,d)),e=d.toLowerCase();return b.sort((a,b)=>{let c=String(a.name||"").toLowerCase(),d=String(b.name||"").toLowerCase(),f=String(a.itemNumber||"").toLowerCase(),g=String(b.itemNumber||"").toLowerCase();return f===e?-1:g===e?1:c===e?-1:d===e?1:f.startsWith(e)&&!g.startsWith(e)?-1:g.startsWith(e)&&!f.startsWith(e)?1:c.startsWith(e)&&!d.startsWith(e)?-1:d.startsWith(e)&&!c.startsWith(e)?1:c.localeCompare(d)}).slice(0,100)},[a,d]);return(0,b.useEffect)(()=>{d.length>=1&&g.length>0?f(!0):0===d.length&&f(!1)},[d,g.length]),{suggestions:g,isOpen:e,openPanel:()=>{f(!0)},closePanel:()=>{f(!1)}}}])},289820,a=>{"use strict";let b=a=>{let b=a.price*a.quantity,c=0;if("amount"===a.discountType)c=Number(a.discountAmount)||0;else if("percentage"===a.discountType)c=b*(Number(a.discountPercentage)||0)/100;else if(!a.discountType){let d=Number(a.discountPercentage)||0,e=Number(a.discountAmount)||0;d>0?c=b*d/100:e>0&&(c=e)}return b-c};a.s(["calculateItemActualAmount",0,b,"calculateItemActualPrice",0,a=>b(a)/a.quantity])},433340,a=>a.a(async(b,c)=>{try{var d=a.i(127669),e=a.i(531811),f=a.i(964889),g=a.i(385375),h=a.i(257257),i=a.i(837692),j=a.i(289820),k=a.i(500885),l=a.i(852741),m=b([e,f,g,k]);[e,f,g,k]=m.then?(await m)():m,a.s(["useSoldItemsData",0,(a,b,c,m)=>{let{user:n}=(0,e.useAuth)(),{currentBusiness:o}=(0,f.useBusiness)(),{sales:p,isLoading:q,clearSoldItemsCache:r}=(0,g.useSalesData)(n?.id,"desc"),{data:s,isLoading:t}=(0,k.useQuery)({queryKey:["inventory_check_map",o?.id],queryFn:async()=>{if(!o?.id||!n?.id)return new Map;let a=await (0,l.getProductsAction)({userId:n.id,businessId:o.id,pageSize:1e3}),b=new Map;return a&&a.products&&a.products.forEach(a=>{a.id&&b.set(a.id,!0),a.name&&b.set(a.name.trim().toLowerCase(),!0)}),b},enabled:!!o?.id&&!!n?.id,staleTime:3e5,gcTime:18e5});return{soldItems:(0,d.useMemo)(()=>{let d,e;if(!p||0===p.length)return[];if("specific-date"===a&&c)(d=new Date(c)).setHours(0,0,0,0),(e=new Date(c)).setHours(23,59,59,999);else if("custom"===a&&b.from&&b.to)d=b.from,e=b.to;else{let b=(0,h.getDateRangeFromFilter)(a);d=b.from,e=b.to}let f=p.filter(b=>{let f=new Date(b.date);return"specific-date"===a&&c?(0,i.isSameDay)(f,c)&&"Quote"!==b.paymentStatus:f>=d&&f<=e&&"Quote"!==b.paymentStatus}),g=new Map;f.forEach(a=>{a.items.forEach(a=>{let b=a.description,c=a.price*a.quantity,d=(0,j.calculateItemActualAmount)(a),e=c-d,f=(a.cost||0)*a.quantity,h=d-f,i=(0,j.calculateItemActualPrice)(a);if(g.has(b)){let c=g.get(b);c.totalQuantity+=a.quantity,c.totalAmount+=d,c.totalCost+=f,c.totalProfit+=h,c.totalDiscount+=e,c.prices.push(i),c.costs.push(a.cost||0),a.productId&&!c.productIds.includes(a.productId)&&c.productIds.push(a.productId)}else g.set(b,{totalQuantity:a.quantity,totalAmount:d,totalCost:f,totalProfit:h,totalDiscount:e,prices:[i],costs:[a.cost||0],productIds:a.productId?[a.productId]:[]})})});let k=Array.from(g.entries()).map(([a,b])=>({description:a,totalQuantity:b.totalQuantity,averagePrice:b.prices.reduce((a,b)=>a+b,0)/b.prices.length,totalAmount:b.totalAmount,totalCost:b.totalCost,totalProfit:b.totalProfit,totalDiscount:b.totalDiscount,averageCost:b.costs.reduce((a,b)=>a+b,0)/b.costs.length,productIds:b.productIds})).sort((a,b)=>b.totalAmount-a.totalAmount);return m&&s?k.filter(a=>{if(a.productIds.some(a=>s.has(a)))return!1;let b=a.description.trim().toLowerCase();return!s.has(b)}):k},[p,a,b,c,s,m]),isLoading:q||t,loadSoldItemsData:()=>{r()}}}]),c()}catch(a){c(a)}},!1),421075,a=>{"use strict";var b=a.i(127669);a.s(["useMobileOptimization",0,()=>{let[a,c]=(0,b.useState)({pageSize:20,enableVirtualScrolling:!1,reducedAnimations:!1,compactView:!1});return(0,b.useEffect)(()=>{let a=()=>{let a=window.innerWidth<768;c({pageSize:a?15:20,enableVirtualScrolling:a,reducedAnimations:"connection"in navigator&&navigator.connection?.effectiveType==="slow-2g"||navigator.connection?.effectiveType==="2g",compactView:a})};return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]),a}])},166080,a=>{"use strict";a.s(["exportSoldItemsToCSV",0,(a,b,c="USD",d=!1)=>{let e=new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}),f=a.map(a=>d?[a.description,a.totalQuantity.toString(),e.format(a.averageCost||0),e.format(a.totalCost)]:[a.description,a.totalQuantity.toString(),e.format(a.averagePrice),e.format(a.totalAmount),e.format(a.totalDiscount),e.format(a.totalCost),e.format(a.totalProfit)]),g=a.reduce((a,b)=>a+b.totalQuantity,0),h=a.reduce((a,b)=>a+b.totalAmount,0),i=a.reduce((a,b)=>a+b.totalDiscount,0),j=a.reduce((a,b)=>a+b.totalCost,0),k=a.reduce((a,b)=>a+b.totalProfit,0);f.push([""]),f.push(["SUMMARY","","","","","",""]),f.push(["Total Items",a.length.toString(),"","","","",""]),f.push(["Total Quantity",g.toString(),"","","","",""]),d?f.push(["Total Cost","","",e.format(j)]):(f.push(["Total Revenue","","",e.format(h),"","",""]),f.push(["Total Discount","","","",e.format(i),"",""]),f.push(["Total Cost","","","","",e.format(j),""]),f.push(["Total Profit","","","","","",e.format(k)]));let l=new Blob([[d?["Item","Quantity","Average Cost","Total Cost"]:["Item","Quantity","Average Price","Total Amount","Discount","Cost Amount","Profit"],...f].map(a=>a.map(a=>`"${a}"`).join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),m=document.createElement("a"),n=URL.createObjectURL(l);m.setAttribute("href",n),m.setAttribute("download",`${d?"cost_data_":""}sold_items_${b.replace(/\s+/g,"_")}_${new Date().toISOString().split("T")[0]}.csv`),m.style.visibility="hidden",document.body.appendChild(m),m.click(),document.body.removeChild(m)}])},582824,a=>{"use strict";var b=a.i(792071),c=a.i(959866);a.s(["exportSoldItemsToPDF",0,(a,d,e="USD",f=!1,g,h)=>{let i,j=new c.default({orientation:"portrait",unit:"mm",format:"a4",compress:!0}),k=j.internal.pageSize.getWidth(),l=j.internal.pageSize.getHeight(),m=k-15-15,n=15,o=f?[60,30,40,40]:[38,18,22,22,20,20,20],p=f?["Item","Quantity","Avg Cost","Total Cost"]:["Item","Quantity","Avg Price","Total","Discount","Cost","Profit"],q=()=>{j.setFontSize(8),j.setFont("helvetica","normal"),j.setTextColor(150,150,150),j.text("Created By Gonza Systems",k/2,l-10,{align:"center"}),j.setTextColor(0,0,0)},r=()=>{j.setFillColor(243,244,246),j.rect(15,n-2,m,10,"F"),j.setLineWidth(.3),j.rect(15,n-2,m,10),j.setFontSize(10),j.setFont("helvetica","bold");let a=15;p.forEach((b,c)=>{let d=o[c],e=j.getTextWidth(b),f=a+(d-e)/2;j.text(b,f,n+6),c<p.length-1&&j.line(a+d,n-2,a+d,n+10-2),a+=d}),n+=10},s=a=>n+a>l-15-15&&(q(),j.addPage(),n=15,r(),j.setFont("helvetica","normal"),j.setFontSize(9),!0),t=n;h&&(j.setFontSize(12),j.setFont("helvetica","bold"),j.text(h.businessName,15,n),n+=6,j.setFontSize(9),j.setFont("helvetica","normal"),j.text(h.businessAddress,15,n),n+=5,j.text(h.businessPhone,15,n),n+=5,j.text(h.businessEmail,15,n)),n=t,j.setFontSize(18),j.setFont("helvetica","bold");let u=f?`Items Cost Report (${e})`:`Items Sold Report (${e})`,v=j.getTextWidth(u);if(j.text(u,k-15-v,n),n+=10,g?.from&&g?.to){j.setFontSize(12),j.setFont("helvetica","normal");let a=(0,b.format)(g.from,"dd/MM/yyyy"),c=(0,b.format)(g.to,"dd/MM/yyyy"),d=a===c?a:`${a} - ${c}`,e=j.getTextWidth(d);j.text(d,k-15-e,n),n+=12}else{j.setFontSize(12),j.setFont("helvetica","normal");let a=(0,b.format)(new Date,"dd/MM/yyyy"),c=j.getTextWidth(a);j.text(a,k-15-c,n),n+=12}if(n=Math.max(n,t+25),0===a.length){j.setFontSize(14),j.setFont("helvetica","normal");let a="No items sold in the selected period.",b=j.getTextWidth(a);j.text(a,(k-b)/2,n+30)}else{s(20),r(),j.setFont("helvetica","normal"),j.setFontSize(8);let b=new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0});a.forEach((a,c)=>{s(13);let d=f?[a.description,a.totalQuantity.toString(),b.format(a.totalCost/a.totalQuantity),b.format(a.totalCost)]:[a.description,a.totalQuantity.toString(),b.format(a.averagePrice),b.format(a.totalAmount),b.format(a.totalDiscount||0),b.format(a.totalCost||0),b.format(a.totalProfit||0)];c%2==0&&(j.setFillColor(249,250,251),j.rect(15,n-1,m,8,"F")),j.setLineWidth(.1),j.rect(15,n-1,m,8);let e=15;d.forEach((a,b)=>{let c=o[b],f=a;if(0===b)for(;j.getTextWidth(f)>c-4&&f.length>3;)f=f.substring(0,f.length-4)+"...";let g=e+2;if(b>=1){let a=j.getTextWidth(f);g=e+(c-a)/2}j.text(f,g,n+5),b<d.length-1&&j.line(e+c,n-1,e+c,n+8-1),e+=c}),n+=8}),n+=10,s(45),j.setFontSize(16),j.setFont("helvetica","bold"),j.text("Summary",15,n),n+=8;let c=a.length,d=a.reduce((a,b)=>a+b.totalQuantity,0),e=a.reduce((a,b)=>a+b.totalAmount,0),g=a.reduce((a,b)=>a+(b.totalDiscount||0),0),h=a.reduce((a,b)=>a+(b.totalCost||0),0),i=a.reduce((a,b)=>a+(b.totalProfit||0),0),k=f?32:56;j.setFillColor(248,249,250),j.rect(15,n-3,m,k,"F"),j.setLineWidth(.3),j.setDrawColor(200,200,200),j.rect(15,n-3,m,k),j.setFontSize(11),j.setFont("helvetica","normal");let l=f?[["Total Items:",c.toString()],["Total Quantity:",d.toString()],["Total Cost:",b.format(h)]]:[["Total Items:",c.toString()],["Total Quantity:",d.toString()],["Total Revenue:",b.format(e)],["Total Discount:",b.format(g)],["Total Cost:",b.format(h)],["Total Profit:",b.format(i)]],p=n+6,q=30;l.forEach(([a,b])=>{j.setFont("helvetica","bold"),j.text(a,q,p),j.setFont("helvetica","normal");let c=q+j.getTextWidth(a)+5,d=15+m-15,e=j.getTextWidth(b);j.text(b,c+e>d?d-e:c,p),p+=8})}q();let w=f?"cost_data_":"";if(g?.from&&g?.to){let a=(0,b.format)(g.from,"yyyy-MM-dd"),c=(0,b.format)(g.to,"yyyy-MM-dd");i=a===c?`${w}sold_items_${a}.pdf`:`${w}sold_items_${a}_to_${c}.pdf`}else i=`${w}sold_items_${(0,b.format)(new Date,"yyyy-MM-dd")}.pdf`;j.save(i)}])},716869,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(747899),g=a.i(109254),h=a.i(540629),i=a.i(899054),j=a.i(396465),k=a.i(445916),l=a.i(126741),m=a.i(799856),n=a.i(792071),o=a.i(837692),p=a.i(257257),q=a.i(800735),r=a.i(805297),s=a.i(625250),t=b([g,h,i,j,m,q,r,s]);[g,h,i,j,m,q,r,s]=t.then?(await t)():t,a.s(["default",0,({isOpen:a,onOpenChange:b,itemDescription:c,sales:t,currency:u,dateFilter:v,dateRange:w,specificDate:x})=>{let y=(0,f.useNavigate)(),{hasPermission:z}=(0,r.useProfiles)(),{canViewSellingPrice:A}=(0,s.useFinancialVisibility)(),[B,C]=(0,e.useState)(null),[D,E]=(0,e.useState)(!1),F=(()=>{let a,b;if("specific-date"===v&&x)(a=new Date(x)).setHours(0,0,0,0),(b=new Date(x)).setHours(23,59,59,999);else if("custom"===v&&w.from&&w.to)a=w.from,b=w.to;else{let c=(0,p.getDateRangeFromFilter)(v);a=c.from,b=c.to}return t.filter(d=>{let e=new Date(d.date),f=!1;f="specific-date"===v&&x?(0,o.isSameDay)(e,x):e>=a&&e<=b;let g=d.items.some(a=>a.description===c),h="Quote"!==d.paymentStatus;return f&&g&&h})})();return(0,d.jsxs)(g.Dialog,{open:a,onOpenChange:b,children:[(0,d.jsxs)(g.DialogContent,{className:"max-w-5xl max-h-[80vh] overflow-y-auto",children:[(0,d.jsxs)(g.DialogHeader,{children:[(0,d.jsxs)(g.DialogTitle,{children:['Sales for "',c,'"']}),(0,d.jsxs)("p",{className:"text-sm text-muted-foreground",children:[F.length," sale",1!==F.length?"s":""," found in the selected period"]})]}),0===F.length?(0,d.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No sales found for this item in the selected period."}):(0,d.jsx)("div",{className:"overflow-x-auto",children:(0,d.jsxs)(h.Table,{children:[(0,d.jsx)(h.TableHeader,{children:(0,d.jsxs)(h.TableRow,{children:[(0,d.jsx)(h.TableHead,{children:"Date"}),(0,d.jsx)(h.TableHead,{children:"Receipt #"}),(0,d.jsx)(h.TableHead,{children:"Customer"}),(0,d.jsx)(h.TableHead,{className:"text-right",children:"Quantity"}),(0,d.jsx)(h.TableHead,{className:"text-right",children:"Unit Price"}),(0,d.jsx)(h.TableHead,{className:"text-right",children:"Total"}),(0,d.jsx)(h.TableHead,{children:"Status"}),(0,d.jsx)(h.TableHead,{className:"text-center",children:"Actions"})]})}),(0,d.jsx)(h.TableBody,{children:F.map(a=>{let e=a.items.find(a=>a.description===c);return e?(0,d.jsxs)(h.TableRow,{children:[(0,d.jsx)(h.TableCell,{children:(0,n.format)(a.date,"MMM d, yyyy")}),(0,d.jsxs)(h.TableCell,{className:"font-medium",children:["#",a.receiptNumber]}),(0,d.jsx)(h.TableCell,{children:a.customerName}),(0,d.jsx)(h.TableCell,{className:"text-right",children:e.quantity}),(0,d.jsx)(h.TableCell,{className:"text-right",children:A?(0,m.formatCashCurrency)(e.price,u):"•••"}),(0,d.jsx)(h.TableCell,{className:"text-right",children:A?(0,m.formatCashCurrency)(e.price*e.quantity,u):"•••"}),(0,d.jsx)(h.TableCell,{children:(0,d.jsx)(i.Badge,{variant:"Paid"===a.paymentStatus?"default":"NOT PAID"===a.paymentStatus?"destructive":"secondary",children:a.paymentStatus})}),(0,d.jsx)(h.TableCell,{className:"text-center",children:(0,d.jsxs)("div",{className:"flex justify-center gap-1",children:[(0,d.jsxs)(j.Button,{variant:"ghost",size:"sm",onClick:()=>{C(a),E(!0)},className:"h-8 w-8 p-0",title:"View Receipt",children:[(0,d.jsx)(l.Printer,{className:"h-4 w-4"}),(0,d.jsx)("span",{className:"sr-only",children:"View Receipt"})]}),z("sales","edit")&&(0,d.jsxs)(j.Button,{variant:"ghost",size:"sm",onClick:()=>{y("/new-sale",{state:{editSale:a}}),b(!1)},className:"h-8 w-8 p-0",title:"Edit Sale",children:[(0,d.jsx)(k.Edit,{className:"h-4 w-4"}),(0,d.jsx)("span",{className:"sr-only",children:"Edit Sale"})]})]})})]},a.id):null})})]})})]}),(0,d.jsx)(q.default,{isOpen:D,sale:B,currency:u,onOpenChange:()=>{E(!1),C(null)}})]})}]),c()}catch(a){c(a)}},!1),671419,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(811705),g=a.i(964889),h=a.i(396465),i=a.i(112779),j=a.i(688272),k=a.i(532572),l=a.i(199987),m=a.i(585459),n=a.i(957143),o=a.i(531811),p=a.i(385375),q=a.i(433340),r=a.i(421075),s=a.i(540629),t=a.i(799856),u=a.i(108191),v=a.i(755760),w=a.i(166080),x=a.i(582824),y=a.i(340001),z=a.i(224993),A=a.i(158799),B=a.i(393551),C=a.i(792071),D=a.i(716869),E=a.i(459502),F=a.i(257257),G=a.i(767810),H=a.i(625250),I=b([f,g,h,i,j,o,p,q,s,t,v,y,z,A,B,D,E,G,H]);[f,g,h,i,j,o,p,q,s,t,v,y,z,A,B,D,E,G,H]=I.then?(await I)():I,a.s(["default",0,()=>{let{user:a}=(0,o.useAuth)(),{currentBusiness:b}=(0,g.useBusiness)(),c=(0,r.useMobileOptimization)(),{sales:I}=(0,p.useSalesData)(a?.id,"desc"),{settings:J,isLoading:K}=(0,z.useBusinessSettings)(),{canViewCostPrice:L,canViewProfit:M,canViewSellingPrice:N}=(0,H.useFinancialVisibility)(),{toast:O}=(0,u.useToast)(),P=(0,e.useMemo)(()=>b?.id?`soldItemsFilters_${b.id}`:"soldItemsFilters",[b?.id]),Q=(0,e.useCallback)(()=>{try{let a=localStorage.getItem(P);if(a){let b=JSON.parse(a);return{dateFilter:b.dateFilter||"this-month",dateRange:b.dateRange?{from:b.dateRange.from?new Date(b.dateRange.from):void 0,to:b.dateRange.to?new Date(b.dateRange.to):void 0}:{from:void 0,to:void 0},specificDate:b.specificDate?new Date(b.specificDate):void 0,showOnlyNotInInventory:b.showOnlyNotInInventory||!1,showOnlyCostData:b.showOnlyCostData||!1}}}catch(a){console.error("Error loading persisted sold items filters:",a)}return{dateFilter:"this-month",dateRange:{from:void 0,to:void 0},specificDate:void 0,showOnlyNotInInventory:!1,showOnlyCostData:!1}},[P]),R=(0,e.useMemo)(()=>Q(),[Q]),[S,T]=(0,e.useState)(R.dateFilter),[U,V]=(0,e.useState)(R.dateRange),[W,X]=(0,e.useState)(R.specificDate),[Y,Z]=(0,e.useState)(null),[$,_]=(0,e.useState)(!1),[aa,ab]=(0,e.useState)(""),[ac,ad]=(0,e.useState)(R.showOnlyNotInInventory),[ae,af]=(0,e.useState)(R.showOnlyCostData),{soldItems:ag,isLoading:ah}=(0,q.useSoldItemsData)(S,U,W,ac);(0,e.useEffect)(()=>{let a={dateFilter:S,dateRange:{from:U.from?.toISOString(),to:U.to?.toISOString()},specificDate:W?.toISOString(),showOnlyNotInInventory:ac,showOnlyCostData:ae};localStorage.setItem(P,JSON.stringify(a))},[S,U,W,ac,ae,P]);let ai=(0,e.useMemo)(()=>{if(!aa.trim())return ag;let a=aa.toLowerCase();return ag.filter(b=>b.description.toLowerCase().includes(a))},[ag,aa]);return ah?(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center",children:[(0,d.jsx)(y.Skeleton,{className:"h-8 w-32"}),(0,d.jsxs)("div",{className:"flex gap-2",children:[(0,d.jsx)(y.Skeleton,{className:"h-8 w-20"}),(0,d.jsx)(y.Skeleton,{className:"h-8 w-20"})]})]}),(0,d.jsx)(y.Skeleton,{className:"h-48"})]}):(0,d.jsx)(G.TooltipProvider,{children:(0,d.jsxs)("div",{className:"space-y-6",children:[(0,d.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,d.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 items-start md:items-center",children:[(0,d.jsxs)(j.Select,{value:S,onValueChange:T,children:[(0,d.jsx)(j.SelectTrigger,{className:"w-full md:w-48",children:(0,d.jsx)(j.SelectValue,{placeholder:"Select period"})}),(0,d.jsxs)(j.SelectContent,{children:[(0,d.jsx)(j.SelectItem,{value:"today",children:"Today"}),(0,d.jsx)(j.SelectItem,{value:"yesterday",children:"Yesterday"}),(0,d.jsx)(j.SelectItem,{value:"this-week",children:"This Week"}),(0,d.jsx)(j.SelectItem,{value:"last-week",children:"Last Week"}),(0,d.jsx)(j.SelectItem,{value:"this-month",children:"This Month"}),(0,d.jsx)(j.SelectItem,{value:"last-month",children:"Last Month"}),(0,d.jsx)(j.SelectItem,{value:"this-year",children:"This Year"}),(0,d.jsx)(j.SelectItem,{value:"specific-date",children:"Specific Date"}),(0,d.jsx)(j.SelectItem,{value:"custom",children:"Custom Range"})]})]}),"specific-date"===S&&(0,d.jsx)("div",{className:"w-full md:w-auto",children:(0,d.jsxs)(A.Popover,{children:[(0,d.jsx)(A.PopoverTrigger,{asChild:!0,children:(0,d.jsxs)(h.Button,{variant:"outline",className:(0,t.cn)("w-full md:w-[240px] justify-start text-left font-normal bg-white",!W&&"text-muted-foreground"),children:[(0,d.jsx)(m.CalendarIcon,{className:"mr-2 h-4 w-4"}),W?(0,C.format)(W,"PPP"):(0,d.jsx)("span",{children:"Pick a specific date"})]})}),(0,d.jsx)(A.PopoverContent,{className:"w-auto p-0 z-[100] bg-white shadow-lg",align:"start",children:(0,d.jsx)(B.Calendar,{mode:"single",selected:W,onSelect:X,initialFocus:!0,className:"p-3 pointer-events-auto"})})]})}),"custom"===S&&(0,d.jsx)(v.default,{dateRange:U,onDateRangeChange:V})]}),(0,d.jsxs)("div",{className:"flex flex-col md:flex-row gap-2",children:[(0,d.jsxs)(h.Button,{variant:"outline",onClick:()=>{"specific-date"===S&&W||"custom"===S&&U.from&&U.to||(0,F.getDateRangeFromFilter)(S),(0,w.exportSoldItemsToCSV)(ai,"Current Period",J.currency,ae),O({title:"Export successful",description:"Sold items exported to CSV file."})},className:"gap-2 w-full md:w-auto",children:[(0,d.jsx)(l.FileText,{className:"h-4 w-4"}),"Export CSV"]}),(0,d.jsxs)(h.Button,{variant:"outline",onClick:()=>{let a;K?O({title:"Please wait",description:"Business settings are still loading. Please try again in a moment.",variant:"destructive"}):(a="specific-date"===S&&W?{from:W,to:W}:"custom"===S&&U.from&&U.to?U:(0,F.getDateRangeFromFilter)(S),(0,x.exportSoldItemsToPDF)(ai,"Current Period",J.currency,ae,a,{businessName:J.businessName,businessAddress:J.businessAddress,businessPhone:J.businessPhone,businessEmail:J.businessEmail}),O({title:"Export successful",description:"Sold items exported to PDF file."}))},className:"gap-2 w-full md:w-auto",children:[(0,d.jsx)(k.Download,{className:"h-4 w-4"}),"Export PDF"]})]})]}),(0,d.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsx)(n.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,d.jsx)(i.Input,{placeholder:"Search items...",value:aa,onChange:a=>ab(a.target.value),className:"pl-10"})]}),(0,d.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,d.jsx)(E.Checkbox,{id:"not-in-inventory",checked:ac,onCheckedChange:a=>{ad(!0===a)}}),(0,d.jsx)("label",{htmlFor:"not-in-inventory",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Show only items not in inventory"})]}),(0,d.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,d.jsx)(E.Checkbox,{id:"cost-data-only",checked:ae,onCheckedChange:a=>{af(!0===a)},disabled:!L}),(0,d.jsx)("label",{htmlFor:"cost-data-only",className:(0,t.cn)("text-sm font-medium leading-none",!L&&"opacity-50 cursor-not-allowed"),children:"Show only cost data (Item, Quantity, Average Cost, Total Cost)"})]})]})]}),(0,d.jsxs)(f.Card,{children:[(0,d.jsxs)(f.CardHeader,{children:[(0,d.jsxs)(f.CardTitle,{className:"text-lg",children:["Items Sold - ",(()=>{if("specific-date"===S&&W)return(0,C.format)(W,"dd/MM/yyyy");{if("custom"===S&&U.from&&U.to)return`${(0,C.format)(U.from,"dd/MM/yyyy")} to ${(0,C.format)(U.to,"dd/MM/yyyy")}`;let a=(0,F.getDateRangeFromFilter)(S);return a.from.toDateString()===a.to.toDateString()?(0,C.format)(a.from,"dd/MM/yyyy"):`${(0,C.format)(a.from,"dd/MM/yyyy")} to ${(0,C.format)(a.to,"dd/MM/yyyy")}`}})()]}),(0,d.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Click on an item to view all sales containing that item",aa&&` • Showing ${ai.length} of ${ag.length} items`,ac&&` • Filtered to show only items not in current inventory`,ae&&` • Showing only cost data`]})]}),(0,d.jsx)(f.CardContent,{className:"p-0",children:0===ai.length?(0,d.jsx)("div",{className:"p-8 text-center text-muted-foreground",children:aa?"No items found matching your search.":ac?"No sold items found that are not in current inventory.":"No items sold in the selected period."}):(0,d.jsx)("div",{className:"overflow-x-auto",children:(0,d.jsxs)(s.Table,{children:[(0,d.jsx)(s.TableHeader,{children:(0,d.jsxs)(s.TableRow,{children:[(0,d.jsx)(s.TableHead,{children:"Item"}),(0,d.jsx)(s.TableHead,{className:"text-right",children:"Qty"}),ae?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(s.TableHead,{className:"text-right",children:"Avg Cost"}),(0,d.jsx)(s.TableHead,{className:"text-right",children:"Total Cost"})]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(s.TableHead,{className:"text-right",children:"Avg Price"}),(0,d.jsx)(s.TableHead,{className:"text-right font-bold",children:"Total"}),(0,d.jsx)(s.TableHead,{className:"text-right hidden sm:table-cell",children:"Discount"}),L&&(0,d.jsx)(s.TableHead,{className:"text-right",children:"Cost"}),M&&(0,d.jsx)(s.TableHead,{className:"text-right",children:"Profit"})]})]})}),(0,d.jsx)(s.TableBody,{children:ai.slice(0,2*c.pageSize).map((a,b)=>(0,d.jsxs)(s.TableRow,{className:"cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>{var b;return b=a.description,void(Z(b),_(!0))},children:[(0,d.jsx)(s.TableCell,{className:"font-medium max-w-[200px] truncate",children:(0,d.jsxs)(G.Tooltip,{children:[(0,d.jsx)(G.TooltipTrigger,{asChild:!0,children:(0,d.jsx)("span",{className:"cursor-help",children:a.description})}),(0,d.jsx)(G.TooltipContent,{side:"top",className:"max-w-xs",children:(0,d.jsx)("div",{className:"space-y-1",children:(0,d.jsx)("p",{className:"font-bold break-words whitespace-normal",children:a.description})})})]})}),(0,d.jsx)(s.TableCell,{className:"text-right",children:a.totalQuantity}),ae?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(s.TableCell,{className:"text-right",children:L?(0,t.formatCashCurrency)(a.averageCost||0,J.currency):"•••"}),(0,d.jsx)(s.TableCell,{className:"text-right",children:L?(0,t.formatCashCurrency)(a.totalCost,J.currency):"•••"})]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(s.TableCell,{className:"text-right",children:N?(0,t.formatCashCurrency)(a.averagePrice,J.currency):"•••"}),(0,d.jsx)(s.TableCell,{className:"text-right font-medium",children:N?(0,t.formatCashCurrency)(a.totalAmount,J.currency):"•••"}),(0,d.jsx)(s.TableCell,{className:"text-right hidden sm:table-cell",children:N?(0,t.formatCashCurrency)(a.totalDiscount,J.currency):"•••"}),L&&(0,d.jsx)(s.TableCell,{className:"text-right text-sales-dark",children:(0,t.formatCashCurrency)(a.totalCost,J.currency)}),M&&(0,d.jsx)(s.TableCell,{className:"text-right font-semibold text-green-600",children:(0,t.formatCashCurrency)(a.totalProfit,J.currency)})]})]},b))})]})})})]}),ai.length>0&&(0,d.jsx)(f.Card,{children:(0,d.jsx)(f.CardContent,{className:"pt-6",children:ae?(0,d.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 text-center",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-sm text-muted-foreground",children:"Items"}),(0,d.jsx)("p",{className:"text-lg md:text-2xl font-bold",children:ai.length})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-sm text-muted-foreground",children:"Quantity"}),(0,d.jsx)("p",{className:"text-lg md:text-2xl font-bold",children:ai.reduce((a,b)=>a+b.totalQuantity,0)})]}),(0,d.jsxs)("div",{className:"flex flex-col items-center",children:[(0,d.jsx)("p",{className:"text-sm text-muted-foreground",children:"Total Cost"}),(0,d.jsx)("p",{className:"text-lg md:text-2xl font-bold",children:L?(0,t.formatCashCurrency)(ai.reduce((a,b)=>a+b.totalCost,0),J.currency):"•••"})]})]}):(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-center",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-sm text-muted-foreground",children:"Items"}),(0,d.jsx)("p",{className:"text-base sm:text-lg md:text-xl font-bold truncate",children:ai.length})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-sm text-muted-foreground",children:"Quantity"}),(0,d.jsx)("p",{className:"text-base sm:text-lg md:text-xl font-bold truncate",children:ai.reduce((a,b)=>a+b.totalQuantity,0)})]}),(0,d.jsxs)("div",{className:"flex flex-col items-center",children:[(0,d.jsx)("p",{className:"text-sm text-muted-foreground",children:"Revenue"}),(0,d.jsx)("p",{className:"text-base sm:text-lg md:text-xl font-bold truncate",children:N?(0,t.formatCashCurrency)(ai.reduce((a,b)=>a+b.totalAmount,0),J.currency):"•••"})]})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-center",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-sm text-muted-foreground",children:"Discount"}),(0,d.jsx)("p",{className:"text-base sm:text-lg md:text-xl font-bold truncate",children:N?(0,t.formatCashCurrency)(ai.reduce((a,b)=>a+b.totalDiscount,0),J.currency):"•••"})]}),L&&(0,d.jsxs)("div",{className:"flex flex-col items-center",children:[(0,d.jsx)("p",{className:"text-sm text-muted-foreground",children:"Cost"}),(0,d.jsx)("p",{className:"text-base sm:text-lg md:text-xl font-bold truncate",children:(0,t.formatCashCurrency)(ai.reduce((a,b)=>a+b.totalCost,0),J.currency)})]}),M&&(0,d.jsxs)("div",{className:"flex flex-col items-center",children:[(0,d.jsx)("p",{className:"text-sm text-muted-foreground",children:"Profit"}),(0,d.jsx)("p",{className:"text-base sm:text-lg md:text-xl font-bold truncate",children:(0,t.formatCashCurrency)(ai.reduce((a,b)=>a+b.totalProfit,0),J.currency)})]})]})]})})}),(0,d.jsx)(D.default,{isOpen:$,onOpenChange:_,itemDescription:Y||"",sales:I,currency:J.currency,dateFilter:S,dateRange:U,specificDate:W})]})})}]),c()}catch(a){c(a)}},!1),86195,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(396465),f=a.i(688272),g=a.i(532572),h=a.i(199987),i=a.i(585459),j=a.i(792071),k=a.i(755760),l=a.i(158799),m=a.i(393551),n=a.i(799856),o=b([e,f,k,l,m,n]);[e,f,k,l,m,n]=o.then?(await o)():o,a.s(["default",0,({period:a,setPeriod:b,dateRange:c,setDateRange:o,specificDay:p,setSpecificDay:q,onExportCSV:r,onExportPDF:s})=>(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[(0,d.jsx)("h3",{className:"text-lg font-semibold",children:"Stock Summary"}),(0,d.jsxs)("div",{className:"flex flex-col md:flex-row gap-2",children:[(0,d.jsxs)(e.Button,{onClick:r,variant:"outline",size:"sm",children:[(0,d.jsx)(g.Download,{className:"h-4 w-4 mr-2"}),"CSV"]}),(0,d.jsxs)(e.Button,{onClick:s,variant:"outline",size:"sm",children:[(0,d.jsx)(h.FileText,{className:"h-4 w-4 mr-2"}),"PDF"]})]})]}),(0,d.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,d.jsx)("div",{className:"w-full md:w-[200px]",children:(0,d.jsxs)(f.Select,{value:a,onValueChange:a=>b(a),children:[(0,d.jsx)(f.SelectTrigger,{className:"bg-white",children:(0,d.jsx)(f.SelectValue,{placeholder:"Select period"})}),(0,d.jsxs)(f.SelectContent,{className:"bg-white",children:[(0,d.jsx)(f.SelectItem,{value:"today",children:"Today"}),(0,d.jsx)(f.SelectItem,{value:"yesterday",children:"Yesterday"}),(0,d.jsx)(f.SelectItem,{value:"this-week",children:"This Week"}),(0,d.jsx)(f.SelectItem,{value:"last-week",children:"Last Week"}),(0,d.jsx)(f.SelectItem,{value:"this-month",children:"This Month"}),(0,d.jsx)(f.SelectItem,{value:"last-month",children:"Last Month"}),(0,d.jsx)(f.SelectItem,{value:"this-year",children:"This Year"}),(0,d.jsx)(f.SelectItem,{value:"all-time",children:"All Time"}),(0,d.jsx)(f.SelectItem,{value:"specific-day",children:"Specific Day"}),(0,d.jsx)(f.SelectItem,{value:"custom",children:"Custom Range"})]})]})}),"specific-day"===a&&(0,d.jsx)("div",{className:"w-full md:w-auto",children:(0,d.jsxs)(l.Popover,{children:[(0,d.jsx)(l.PopoverTrigger,{asChild:!0,children:(0,d.jsxs)(e.Button,{variant:"outline",className:(0,n.cn)("w-full md:w-[240px] justify-start text-left font-normal bg-white",!p&&"text-muted-foreground"),children:[(0,d.jsx)(i.CalendarIcon,{className:"mr-2 h-4 w-4"}),p?(0,j.format)(p,"PPP"):(0,d.jsx)("span",{children:"Pick a specific day"})]})}),(0,d.jsx)(l.PopoverContent,{className:"w-auto p-0 z-[100] bg-white shadow-lg",align:"start",children:(0,d.jsx)(m.Calendar,{mode:"single",selected:p,onSelect:q,initialFocus:!0,className:"p-3 pointer-events-auto"})})]})}),"custom"===a&&(0,d.jsx)(k.default,{dateRange:c,onDateRangeChange:o})]}),(0,d.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Showing data for: ",(0,d.jsx)("span",{className:"font-medium",children:(()=>{switch(a){case"today":return"Today";case"yesterday":return"Yesterday";case"this-week":return"This Week";case"last-week":return"Last Week";case"this-month":default:return"This Month";case"last-month":return"Last Month";case"this-year":return"This Year";case"all-time":return"All Time";case"specific-day":return"Specific Day";case"custom":return"Custom Range"}})()}),"specific-day"===a&&p&&(0,d.jsxs)("span",{className:"ml-2",children:["(",(0,j.format)(p,"MMM d, yyyy"),")"]}),"custom"===a&&c?.from&&c?.to&&(0,d.jsxs)("span",{className:"ml-2",children:["(",(0,j.format)(c.from,"MMM d, yyyy")," - ",(0,j.format)(c.to,"MMM d, yyyy"),")"]})]})]})]),c()}catch(a){c(a)}},!1),541009,a=>{"use strict";let b=(0,a.i(564375).default)("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);a.s(["ArrowUpDown",()=>b],541009)},178135,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(540629),g=a.i(112779),h=a.i(688272),i=a.i(957143),j=a.i(541009),k=a.i(933286),l=a.i(787769),m=a.i(396465),n=a.i(584210),o=a.i(745695),p=a.i(899054),q=a.i(964889),r=a.i(419068),s=a.i(767810),t=a.i(625250),u=b([f,g,h,m,p,q,r,s,t]);[f,g,h,m,p,q,r,s,t]=u.then?(await u)():u,a.s(["default",0,({data:a,isLoading:b,onProductClick:c,onFilteredDataChange:u,currentProducts:v=[]})=>{let{currentBusiness:w}=(0,q.useBusiness)(),{canViewCostPrice:x}=(0,t.useFinancialVisibility)(),y=()=>`stockSummaryTableFilters_${w?.id||"default"}`,z=(()=>{try{let a=localStorage.getItem(y());if(a)return JSON.parse(a)}catch(a){console.warn("Error loading persisted table filters:",a)}return{searchTerm:"",categoryFilter:"all",stockStatusFilter:"all",sortField:"productName",sortOrder:"asc"}})(),[A,B]=(0,e.useState)(z.searchTerm),[C,D]=(0,e.useState)(z.categoryFilter),[E,F]=(0,e.useState)(z.stockStatusFilter),[G,H]=(0,e.useState)(z.sortField),[I,J]=(0,e.useState)(z.sortOrder),[K,L]=(0,e.useState)(1);(0,e.useEffect)(()=>{localStorage.setItem(y(),JSON.stringify({searchTerm:A,categoryFilter:C,stockStatusFilter:E,sortField:G,sortOrder:I}))},[A,C,E,G,I,w?.id]);let M=(0,e.useMemo)(()=>Array.from(new Set(a.map(a=>a.category).filter(Boolean))).sort(),[a]),N=(0,e.useMemo)(()=>{let b=a.filter(a=>{if(A){let b=A.toLowerCase();if(!(a.productName.toLowerCase().includes(b)||a.itemNumber.toLowerCase().includes(b)||a.category&&a.category.toLowerCase().includes(b)))return!1}return("all"===C||a.category===C)&&("all"===E||("in-stock"!==E||!(a.closingStock<=0))&&("out-of-stock"!==E||!(a.closingStock>0))&&("low-stock"!==E||!(a.closingStock>10)&&!(a.closingStock<=0)))&&!0});return b.sort((a,b)=>{let c=0;switch(G){case"productName":c=a.productName.localeCompare(b.productName);break;case"category":c=(a.category||"").localeCompare(b.category||"");break;case"openingStock":c=a.openingStock-b.openingStock;break;case"itemsSold":c=a.itemsSold-b.itemsSold;break;case"stockIn":c=a.stockIn-b.stockIn;break;case"transferOut":c=a.transferOut-b.transferOut;break;case"returnIn":c=a.returnIn-b.returnIn;break;case"returnOut":c=a.returnOut-b.returnOut;break;case"closingStock":c=a.closingStock-b.closingStock}return"asc"===I?c:-c}),b},[a,A,C,E,G,I]),O=Math.ceil(N.length/15),P=(K-1)*15,Q=N.slice(P,P+15);(0,e.useEffect)(()=>{L(1)},[A,C,E]),(0,e.useEffect)(()=>{u&&u(N)},[N,u]);let R=a=>{G===a?J("asc"===I?"desc":"asc"):(H(a),J("asc"))},S=a=>G!==a?(0,d.jsx)(j.ArrowUpDown,{className:"h-4 w-4"}):"asc"===I?(0,d.jsx)(k.ArrowUp,{className:"h-4 w-4"}):(0,d.jsx)(l.ArrowDown,{className:"h-4 w-4"}),T=e.default.useMemo(()=>N.reduce((a,b)=>({openingStock:a.openingStock+b.openingStock,itemsSold:a.itemsSold+b.itemsSold,stockIn:a.stockIn+b.stockIn,transferOut:a.transferOut+b.transferOut,returnIn:a.returnIn+b.returnIn,returnOut:a.returnOut+b.returnOut,returnOut:a.returnOut+b.returnOut,adjustmentsIn:a.adjustmentsIn+(b.adjustmentsIn||0),adjustmentsOut:a.adjustmentsOut+(b.adjustmentsOut||0),closingStock:a.closingStock+b.closingStock}),{openingStock:0,itemsSold:0,stockIn:0,transferOut:0,returnIn:0,returnOut:0,adjustmentsIn:0,adjustmentsOut:0,closingStock:0}),[N]),U=a=>{L(a)};return b?(0,d.jsx)("div",{className:"flex justify-center py-8",children:(0,d.jsx)(o.default,{})}):(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,d.jsxs)("div",{className:"flex items-center relative flex-grow",children:[(0,d.jsx)(i.Search,{className:"h-4 w-4 absolute left-3 text-gray-400"}),(0,d.jsx)(g.Input,{placeholder:"Search products...",className:"pl-9",value:A,onChange:a=>B(a.target.value)})]}),(0,d.jsx)("div",{className:"min-w-[180px]",children:(0,d.jsxs)(h.Select,{value:C,onValueChange:D,children:[(0,d.jsx)(h.SelectTrigger,{children:(0,d.jsx)(h.SelectValue,{placeholder:"All Categories"})}),(0,d.jsxs)(h.SelectContent,{children:[(0,d.jsx)(h.SelectItem,{value:"all",children:"All Categories"}),M.map(a=>(0,d.jsx)(h.SelectItem,{value:a,children:a},a))]})]})}),(0,d.jsx)("div",{className:"min-w-[150px]",children:(0,d.jsxs)(h.Select,{value:E,onValueChange:F,children:[(0,d.jsx)(h.SelectTrigger,{children:(0,d.jsx)(h.SelectValue,{placeholder:"Stock Status"})}),(0,d.jsxs)(h.SelectContent,{children:[(0,d.jsx)(h.SelectItem,{value:"all",children:"All Stock"}),(0,d.jsx)(h.SelectItem,{value:"in-stock",children:"In Stock"}),(0,d.jsx)(h.SelectItem,{value:"low-stock",children:"Low Stock (≤10)"}),(0,d.jsx)(h.SelectItem,{value:"out-of-stock",children:"Out of Stock"})]})]})}),(0,d.jsxs)("div",{className:"flex items-center gap-4",children:[(0,d.jsxs)(p.Badge,{variant:"secondary",className:"text-xs",children:[N.length," ",1===N.length?"product":"products"," found"]}),O>1&&(0,d.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Page ",K," of ",O]})]})]}),(0,d.jsxs)(s.TooltipProvider,{children:[(0,d.jsxs)("div",{className:"overflow-x-auto",children:[(0,d.jsxs)(f.Table,{children:[(0,d.jsx)(f.TableHeader,{children:(0,d.jsxs)(f.TableRow,{children:[(0,d.jsx)(f.TableHead,{className:"w-[80px]",children:"Image"}),(0,d.jsx)(f.TableHead,{children:"Item #"}),(0,d.jsx)(f.TableHead,{children:(0,d.jsxs)(m.Button,{variant:"ghost",onClick:()=>R("productName"),className:"h-auto p-0 font-medium text-left justify-start hover:bg-transparent",children:["Product Name ",S("productName")]})}),(0,d.jsx)(f.TableHead,{children:(0,d.jsxs)(m.Button,{variant:"ghost",onClick:()=>R("category"),className:"h-auto p-0 font-medium text-left justify-start hover:bg-transparent",children:["Category ",S("category")]})}),(0,d.jsx)(f.TableHead,{className:"text-right",children:(0,d.jsxs)(m.Button,{variant:"ghost",onClick:()=>R("openingStock"),className:"h-auto p-0 font-medium text-right justify-end hover:bg-transparent",children:["Opening Stock ",S("openingStock")]})}),(0,d.jsx)(f.TableHead,{className:"text-right",children:(0,d.jsxs)(m.Button,{variant:"ghost",onClick:()=>R("stockIn"),className:"h-auto p-0 font-medium text-right justify-end hover:bg-transparent",children:["Stock In ",S("stockIn")]})}),(0,d.jsx)(f.TableHead,{className:"text-right",children:(0,d.jsx)(m.Button,{variant:"ghost",onClick:()=>R("transferOut"),className:"h-auto p-0 font-medium text-right justify-end hover:bg-transparent",children:"Stock Out"})}),(0,d.jsx)(f.TableHead,{className:"text-right",children:(0,d.jsxs)(m.Button,{variant:"ghost",onClick:()=>R("closingStock"),className:"h-auto p-0 font-medium text-right justify-end hover:bg-transparent",children:["Closing Stock ",S("closingStock")]})})]})}),(0,d.jsxs)(f.TableBody,{children:[Q.map(a=>{let b;return(0,d.jsxs)(f.TableRow,{className:`cursor-pointer hover:bg-muted/50 transition-colors ${(b=v.find(b=>b.id===a.productId))&&b.quantity!==a.closingStock?"bg-red-50 hover:bg-red-100 border-l-4 border-l-red-500":""}`,onClick:()=>c(a.productId),children:[(0,d.jsx)(f.TableCell,{children:(0,d.jsx)(n.default,{imageUrl:a.imageUrl,alt:a.productName,size:"sm"})}),(0,d.jsxs)(f.TableCell,{className:"font-medium truncate max-w-[120px]",children:["#",a.itemNumber]}),(0,d.jsx)(f.TableCell,{className:"truncate max-w-[200px]",children:(0,d.jsxs)(s.Tooltip,{children:[(0,d.jsx)(s.TooltipTrigger,{asChild:!0,children:(0,d.jsx)("span",{className:"cursor-help",children:a.productName})}),(0,d.jsx)(s.TooltipContent,{side:"top",className:"max-w-xs",children:(0,d.jsxs)("div",{className:"space-y-1",children:[(0,d.jsx)("p",{className:"font-bold break-words whitespace-normal",children:a.productName}),a.category&&(0,d.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Category: ",a.category]})]})})]})}),(0,d.jsx)(f.TableCell,{children:a.category||"-"}),(0,d.jsx)(f.TableCell,{className:"text-right",children:a.openingStock}),(0,d.jsx)(f.TableCell,{className:"text-right text-green-600 font-medium",children:a.stockIn+a.returnIn+(a.adjustmentsIn||0)}),(0,d.jsx)(f.TableCell,{className:"text-right text-red-600 font-medium",children:a.itemsSold+a.transferOut+a.returnOut+(a.adjustmentsOut||0)}),(0,d.jsx)(f.TableCell,{className:"text-right font-bold",children:a.closingStock})]},a.productId)}),N.length>0&&(0,d.jsxs)(f.TableRow,{className:"font-semibold bg-muted/50 border-t-2",children:[(0,d.jsx)(f.TableCell,{colSpan:4,children:"Total"}),(0,d.jsx)(f.TableCell,{className:"text-right",children:T.openingStock}),(0,d.jsx)(f.TableCell,{className:"text-right text-green-700",children:T.stockIn+T.returnIn+T.adjustmentsIn}),(0,d.jsx)(f.TableCell,{className:"text-right text-red-700",children:T.itemsSold+T.transferOut+T.returnOut+T.adjustmentsOut}),(0,d.jsx)(f.TableCell,{className:"text-right",children:T.closingStock})]})]})]}),0===N.length&&!b&&(0,d.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No products found matching your filters."})]}),O>1&&(0,d.jsx)("div",{className:"flex justify-center mt-6",children:(0,d.jsx)(r.Pagination,{children:(0,d.jsxs)(r.PaginationContent,{children:[(0,d.jsx)(r.PaginationItem,{children:(0,d.jsx)(r.PaginationPrevious,{onClick:()=>U(Math.max(1,K-1)),className:1===K?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:Math.min(5,O)},(a,b)=>{let c;return c=O<=5||K<=3?b+1:K>=O-2?O-4+b:K-2+b,(0,d.jsx)(r.PaginationItem,{children:(0,d.jsx)(r.PaginationLink,{onClick:()=>U(c),isActive:K===c,className:"cursor-pointer",children:c})},c)}),(0,d.jsx)(r.PaginationItem,{children:(0,d.jsx)(r.PaginationNext,{onClick:()=>U(Math.min(O,K+1)),className:K===O?"pointer-events-none opacity-50":"cursor-pointer"})})]})})})]})]})}]),c()}catch(a){c(a)}},!1),418333,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(811705),g=a.i(625250),h=a.i(224993),i=a.i(799856),j=b([f,g,h,i]);[f,g,h,i]=j.then?(await j)():j,a.s(["default",0,({data:a})=>{let{canViewCostPrice:b}=(0,g.useFinancialVisibility)(),{settings:c}=(0,h.useBusinessSettings)(),j=c?.currency||"UGX",k=a=>`${j} ${(0,i.formatNumber)(a)}`,l=e.default.useMemo(()=>{let b=a.reduce((a,b)=>({openingStock:a.openingStock+b.openingStock*b.costPrice,stockIn:a.stockIn+(b.stockIn+b.returnIn+(b.adjustmentsIn||0))*b.costPrice,stockOut:a.stockOut+(b.itemsSold+b.transferOut+b.returnOut+(b.adjustmentsOut||0))*b.costPrice}),{openingStock:0,stockIn:0,stockOut:0}),c=b.openingStock+b.stockIn-b.stockOut;return{...b,closingStock:c}},[a]);return 0===a.length?null:(0,d.jsxs)(f.Card,{children:[(0,d.jsx)(f.CardHeader,{children:(0,d.jsx)(f.CardTitle,{children:"Stock Summary Overview"})}),(0,d.jsx)(f.CardContent,{children:(0,d.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)("p",{className:"text-sm text-muted-foreground font-medium uppercase",children:"Opening Stock Value"}),(0,d.jsx)("p",{className:"text-xl font-bold text-blue-600",children:b?k(l.openingStock):"•••"})]}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)("p",{className:"text-sm text-muted-foreground font-medium uppercase",children:"Total Stock In Value"}),(0,d.jsx)("p",{className:"text-xl font-bold text-green-600",children:b?k(l.stockIn):"•••"})]}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)("p",{className:"text-sm text-muted-foreground font-medium uppercase",children:"Total Stock Out Value"}),(0,d.jsx)("p",{className:"text-xl font-bold text-red-600",children:b?k(l.stockOut):"•••"})]}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)("p",{className:"text-sm text-muted-foreground font-medium uppercase",children:"Closing Stock Value"}),(0,d.jsx)("p",{className:"text-xl font-bold text-purple-600",children:b?k(l.closingStock):"•••"})]})]})})]})}]),c()}catch(a){c(a)}},!1),431430,a=>{"use strict";var b=a.i(959866),c=a.i(792071);a.s(["exportStockSummaryToPDF",0,(a,d,e)=>{let f,g=new b.default({orientation:"landscape",unit:"mm",format:"a4",compress:!0}),h=g.internal.pageSize.getWidth(),i=g.internal.pageSize.getHeight(),j=h-15-15,k=15,l=()=>{g.setFontSize(8),g.setFont("helvetica","normal"),g.setTextColor(150,150,150),g.text("Created By Gonza Systems",h/2,i-10,{align:"center"}),g.setTextColor(0,0,0)},m=[20,50,30,25,25,25,25,25,25],n=["Item #","Product Name","Opening Stock","Items Sold","Stock In","Transfer Out","Return In","Return Out","Closing Stock"],o=()=>{g.setFillColor(243,244,246),g.rect(15,k-2,j,8,"F"),g.setLineWidth(.2),g.rect(15,k-2,j,8),g.setFontSize(9),g.setFont("helvetica","bold");let a=15;n.forEach((b,c)=>{let d=m[c],e=g.getTextWidth(b),f=a+(d-e)/2;g.text(b,f,k+5),c<n.length-1&&g.line(a+d,k-2,a+d,k+8-2),a+=d}),k+=8},p=a=>k+a>i-15-15&&(l(),g.addPage(),k=15,o(),g.setFont("helvetica","normal"),g.setFontSize(8),!0);g.setFontSize(18),g.setFont("helvetica","bold");let q="Stock Summary Report",r=g.getTextWidth(q);if(g.text(q,(h-r)/2,k),k+=8,e?.from&&e?.to){g.setFontSize(12),g.setFont("helvetica","normal");let a=(0,c.format)(e.from,"dd/MM/yyyy"),b=(0,c.format)(e.to,"dd/MM/yyyy"),d=a===b?a:`${a} - ${b}`,f=g.getTextWidth(d);g.text(d,(h-f)/2,k),k+=12}else{g.setFontSize(12),g.setFont("helvetica","normal");let a=(0,c.format)(new Date,"dd/MM/yyyy"),b=g.getTextWidth(a);g.text(a,(h-b)/2,k),k+=12}if(0===a.length){g.setFontSize(14),g.setFont("helvetica","normal");let a="No stock data available for the selected period.",b=g.getTextWidth(a);g.text(a,(h-b)/2,k+30)}else{p(18),o(),g.setFont("helvetica","normal"),g.setFontSize(8),a.forEach((a,b)=>{p(12);let c=[a.itemNumber,a.productName,a.openingStock.toString(),a.itemsSold.toString(),a.stockIn.toString(),a.transferOut.toString(),a.returnIn.toString(),a.returnOut.toString(),a.closingStock.toString()];b%2==0&&(g.setFillColor(249,250,251),g.rect(15,k-1,j,7,"F")),g.setLineWidth(.1),g.rect(15,k-1,j,7);let d=15;c.forEach((a,b)=>{let e=m[b],f=a;if(1===b)for(;g.getTextWidth(f)>e-2&&f.length>3;)f=f.substring(0,f.length-4)+"...";let h=d+1;if(b>=2){let a=g.getTextWidth(f);h=d+e-a-1}else if(0===b){let a=g.getTextWidth(f);h=d+(e-a)/2}g.text(f,h,k+4),b<c.length-1&&g.line(d+e,k-1,d+e,k+7-1),d+=e}),k+=7}),k+=15,p(35),g.setFontSize(16),g.setFont("helvetica","bold"),g.text("Summary",15,k),k+=8;let b=a.length,c=a.reduce((a,b)=>a+b.openingStock,0),d=a.reduce((a,b)=>a+b.itemsSold,0),e=a.reduce((a,b)=>a+b.stockIn,0),f=a.reduce((a,b)=>a+b.closingStock,0),h=.8*j;g.setFillColor(248,249,250),g.rect(15,k-3,h,30,"F"),g.setLineWidth(.3),g.setDrawColor(200,200,200),g.rect(15,k-3,h,30),g.setFontSize(11),g.setFont("helvetica","normal");let i=[["Total Products:",b.toString()],["Total Opening Stock:",c.toString()],["Total Items Sold:",d.toString()]],l=[["Total Stock In:",e.toString()],["Total Closing Stock:",f.toString()]],n=k+6,q=30,r=15+h/2+15;i.forEach(([a,b])=>{g.setFont("helvetica","bold"),g.text(a,q,n),g.setFont("helvetica","normal");let c=g.getTextWidth(a);g.text(b,q+c+5,n),n+=6}),n=k+6,l.forEach(([a,b])=>{g.setFont("helvetica","bold"),g.text(a,r,n),g.setFont("helvetica","normal");let c=g.getTextWidth(a);g.text(b,r+c+5,n),n+=6})}if(l(),e?.from&&e?.to){let a=(0,c.format)(e.from,"yyyy-MM-dd"),b=(0,c.format)(e.to,"yyyy-MM-dd");f=a===b?`stock-summary-${a}.pdf`:`stock-summary-${a}_to_${b}.pdf`}else f=`stock-summary-${(0,c.format)(new Date,"yyyy-MM-dd")}.pdf`;g.save(f)}])},710787,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(747899),g=a.i(811705),h=a.i(396465),i=a.i(506766),j=a.i(792071),k=a.i(665376),l=a.i(128069),m=a.i(122460),n=a.i(126554),o=a.i(759447),p=a.i(178465),q=a.i(86195),r=a.i(178135),s=a.i(418333),t=a.i(834122),u=a.i(482331),v=a.i(531811),w=a.i(431430),x=b([g,h,q,r,s,t,u,v]);[g,h,q,r,s,t,u,v]=x.then?(await x)():x,a.s(["default",0,()=>{let a=(0,f.useNavigate)(),{user:b}=(0,v.useAuth)(),{products:c}=(0,u.useProducts)(b?.id,1e4),x=(()=>{try{let a=localStorage.getItem("stockSummaryFilters");if(a){let b=JSON.parse(a);return{period:b.period||"this-month",dateRange:b.dateRange?{from:b.dateRange.from?new Date(b.dateRange.from):(0,o.startOfMonth)(new Date),to:b.dateRange.to?new Date(b.dateRange.to):(0,p.endOfMonth)(new Date)}:{from:(0,o.startOfMonth)(new Date),to:(0,p.endOfMonth)(new Date)},specificDay:b.specificDay?new Date(b.specificDay):void 0}}}catch(a){console.error("Error loading persisted stock summary filters:",a)}return{period:"all-time",dateRange:{from:new Date(2020,0,1),to:(0,l.endOfDay)(new Date)},specificDay:void 0}})(),[y,z]=(0,e.useState)("all-time"),[A,B]=(0,e.useState)(x.dateRange),[C,D]=(0,e.useState)(x.specificDay),[E,F]=(0,e.useState)([]),{stockSummaryData:G,isLoading:H,loadStockSummaryData:I,clearCache:J}=(0,t.useStockSummaryData)(A),K=async()=>{J(),await I()};return(0,e.useEffect)(()=>{let a=()=>{console.log("Stock updated, refreshing stock summary data"),J(),I()};return window.addEventListener("stock-updated",a),()=>{window.removeEventListener("stock-updated",a)}},[J,I]),(0,e.useEffect)(()=>{let a={period:y,dateRange:{from:A.from?.toISOString(),to:A.to?.toISOString()},specificDay:C?.toISOString()};localStorage.setItem("stockSummaryFilters",JSON.stringify(a))},[y,A,C]),(0,e.useEffect)(()=>{let a,b=new Date;switch(y){case"today":a={from:(0,k.startOfDay)(b),to:(0,l.endOfDay)(b)};break;case"yesterday":let c=new Date(b);c.setDate(c.getDate()-1),a={from:(0,k.startOfDay)(c),to:(0,l.endOfDay)(c)};break;case"this-week":a={from:(0,m.startOfWeek)(b),to:(0,n.endOfWeek)(b)};break;case"last-week":let d=new Date(b);d.setDate(d.getDate()-7),a={from:(0,m.startOfWeek)(d),to:(0,n.endOfWeek)(d)};break;case"this-month":a={from:(0,o.startOfMonth)(b),to:(0,p.endOfMonth)(b)};break;case"last-month":let e=new Date(b);e.setMonth(e.getMonth()-1),a={from:(0,o.startOfMonth)(e),to:(0,p.endOfMonth)(e)};break;case"this-year":a={from:new Date(b.getFullYear(),0,1),to:new Date(b.getFullYear(),11,31)};break;case"all-time":a={from:new Date(2020,0,1),to:(0,l.endOfDay)(b)};break;case"specific-day":if(!C)return;a={from:(0,k.startOfDay)(C),to:(0,l.endOfDay)(C)};break;default:return}B(a)},[y,C]),(0,d.jsxs)("div",{className:"space-y-6",children:[(0,d.jsx)(g.Card,{children:(0,d.jsxs)(g.CardContent,{className:"pt-6",children:[(0,d.jsx)("div",{className:"flex items-center justify-end mb-4",children:(0,d.jsxs)(h.Button,{onClick:K,variant:"outline",size:"sm",disabled:H,className:"gap-2",children:[(0,d.jsx)(i.RefreshCw,{className:`h-4 w-4 ${H?"animate-spin":""}`}),"Refresh Data"]})}),(0,d.jsx)(q.default,{period:y,setPeriod:z,dateRange:A,setDateRange:B,specificDay:C,setSpecificDay:D,onExportCSV:()=>{let a=E.map(a=>[a.itemNumber,a.productName,a.category||"",a.openingStock.toString(),a.itemsSold.toString(),a.stockIn.toString(),a.transferOut.toString(),a.returnIn.toString(),a.returnOut.toString(),a.closingStock.toString()]),b=["Item Number,Product Name,Category,Opening Stock,Items Sold,Stock In,Transfer Out,Return In,Return Out,Closing Stock",...a.map(a=>a.map(a=>`"${a}"`).join(","))].join("\n"),c=new Blob([b],{type:"text/csv"}),d=window.URL.createObjectURL(c),e=document.createElement("a");e.href=d,e.download=`stock-summary-filtered-${(0,j.format)(A?.from||new Date,"yyyy-MM-dd")}.csv`,e.click(),window.URL.revokeObjectURL(d)},onExportPDF:()=>{(0,w.exportStockSummaryToPDF)(E,"Current Period",A)}})]})}),(0,d.jsx)(g.Card,{children:(0,d.jsx)(g.CardContent,{className:"pt-6",children:(0,d.jsx)(r.default,{data:G,isLoading:H,onProductClick:b=>{a(`/inventory/${b}`)},onFilteredDataChange:a=>{F(a)},currentProducts:c})})}),(0,d.jsx)(s.default,{data:E})]})}]),c()}catch(a){c(a)}},!1),264524,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(688272),f=a.i(914619),g=b([e]);[e]=g.then?(await g)():g,a.s(["default",0,({selectedFilter:a,onFilterChange:b})=>(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)(f.Calendar,{size:16}),(0,d.jsxs)(e.Select,{value:a,onValueChange:b,children:[(0,d.jsx)(e.SelectTrigger,{className:"w-[180px]",children:(0,d.jsx)(e.SelectValue,{placeholder:"Select date range"})}),(0,d.jsxs)(e.SelectContent,{children:[(0,d.jsx)(e.SelectItem,{value:"today",children:"Today"}),(0,d.jsx)(e.SelectItem,{value:"yesterday",children:"Yesterday"}),(0,d.jsx)(e.SelectItem,{value:"this-week",children:"This Week"}),(0,d.jsx)(e.SelectItem,{value:"last-week",children:"Last Week"}),(0,d.jsx)(e.SelectItem,{value:"this-month",children:"This Month"}),(0,d.jsx)(e.SelectItem,{value:"last-month",children:"Last Month"}),(0,d.jsx)(e.SelectItem,{value:"this-year",children:"This Year"}),(0,d.jsx)(e.SelectItem,{value:"all",children:"All Time"})]})]})]})]),c()}catch(a){c(a)}},!1),847835,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(109254),g=a.i(396465),h=a.i(112779),i=a.i(397625),j=a.i(792071),k=a.i(108191),l=a.i(482331),m=a.i(531811),n=b([f,g,h,i,l,m]);[f,g,h,i,l,m]=n.then?(await n)():n,a.s(["EditGroupDateDialog",0,({open:a,onOpenChange:b,group:c,onConfirm:n})=>{let{user:o}=(0,m.useAuth)(),{products:p}=(0,l.useProducts)(o?.id),[q,r]=(0,e.useState)(""),[s,t]=(0,e.useState)(!1),[u,v]=(0,e.useState)(""),{toast:w}=(0,k.useToast)();(0,e.useEffect)(()=>{c&&(r((0,j.format)(new Date(c.date),"yyyy-MM-dd")),v(""))},[c]);let x=async()=>{if(c&&q&&(()=>{if(!c||!q)return!1;let a=new Date(q);for(let b of(a.setHours(23,59,59,999),c.entries)){let c=p.find(a=>a.id===b.productId);if(c&&c.createdAt){let b=new Date(c.createdAt);if(a<b)return v(`New date cannot be earlier than product creation date (${(0,j.format)(b,"PP")}) for ${c.name}.`),!1}}return!0})()){t(!0);try{await n(new Date(q))&&(w({title:"Dates updated",description:"All entries in this invoice have been updated to the new date."}),b(!1))}catch(a){console.error("Error updating group date:",a),w({title:"Update failed",description:"An error occurred while updating the dates.",variant:"destructive"})}finally{t(!1)}}};return c?(0,d.jsx)(f.Dialog,{open:a,onOpenChange:b,children:(0,d.jsxs)(f.DialogContent,{className:"sm:max-w-md",children:[(0,d.jsxs)(f.DialogHeader,{children:[(0,d.jsx)(f.DialogTitle,{children:"Edit Invoice Date"}),(0,d.jsxs)(f.DialogDescription,{children:["This will update the date for all ",c.entries.length," items in this invoice. Time settings for each item will be preserved."]})]}),(0,d.jsxs)("div",{className:"space-y-4 py-4",children:[(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(i.Label,{htmlFor:"date",children:"New Date"}),(0,d.jsx)(h.Input,{id:"date",type:"date",value:q,onChange:a=>{var b;return b=a.target.value,void(r(b),v(""))},className:u?"border-destructive":""}),u&&(0,d.jsx)("p",{className:"text-sm text-destructive",children:u})]}),(0,d.jsxs)("div",{className:"bg-muted p-3 rounded-lg text-sm space-y-1",children:[c.supplier&&(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{children:"Supplier:"})," ",c.supplier]}),c.invoice&&(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{children:"Invoice:"})," ",c.invoice]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{children:"Current Date:"})," ",(0,j.format)(new Date(c.date),"PP")]})]})]}),(0,d.jsxs)("div",{className:"flex justify-end gap-2 mt-4",children:[(0,d.jsx)(g.Button,{variant:"outline",onClick:()=>b(!1),disabled:s,children:"Cancel"}),(0,d.jsx)(g.Button,{onClick:x,disabled:s,children:s?"Updating...":"Update Dates"})]})]})}):null}]),c()}catch(a){c(a)}},!1),906775,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(893759),f=b([e]);[e]=f.then?(await f)():f,a.s(["DeleteInvoiceDialog",0,({open:a,onOpenChange:b,group:c,onConfirm:f})=>{let g=async()=>{if(!c)return;let a=c.entries.map(a=>a.id);await f(a)&&b(!1)};return c?(0,d.jsx)(e.AlertDialog,{open:a,onOpenChange:b,children:(0,d.jsxs)(e.AlertDialogContent,{children:[(0,d.jsxs)(e.AlertDialogHeader,{children:[(0,d.jsx)(e.AlertDialogTitle,{children:"Delete Entire Invoice"}),(0,d.jsxs)(e.AlertDialogDescription,{className:"space-y-2",children:[(0,d.jsx)("p",{children:"Are you sure you want to delete all stock entries for this invoice?"}),(0,d.jsxs)("div",{className:"bg-muted p-3 rounded-lg",children:[(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Supplier:"})," ",c.supplier]}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Invoice:"})," ",c.invoice]}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Items:"})," ",c.entries.length," products will be affected"]})]}),(0,d.jsx)("p",{className:"text-destructive text-sm",children:"This will permanently remove all stock history entries for this purchase and recalculate stock levels. This action cannot be undone."})]})]}),(0,d.jsxs)(e.AlertDialogFooter,{children:[(0,d.jsx)(e.AlertDialogCancel,{children:"Cancel"}),(0,d.jsx)(e.AlertDialogAction,{onClick:g,className:"bg-destructive hover:bg-destructive/90",children:"Delete Invoice"})]})]})}):null}]),c()}catch(a){c(a)}},!1),981169,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(811705),g=a.i(942348),h=a.i(540629),i=a.i(396465),j=a.i(112779),k=a.i(470167),l=a.i(445916),m=a.i(946032),n=a.i(957143),o=a.i(531811),p=a.i(142499),q=a.i(482331),r=a.i(224993),s=a.i(834122),t=a.i(747899),u=a.i(792071),v=a.i(257257),w=a.i(264524),x=a.i(386925),y=a.i(847835),z=a.i(239366),A=a.i(906775),B=a.i(767810),C=a.i(625250),D=b([f,g,h,i,j,o,p,q,r,s,w,x,y,z,A,B,C]);[f,g,h,i,j,o,p,q,r,s,w,x,y,z,A,B,C]=D.then?(await D)():D,a.s(["default",0,()=>{var a;let b,{user:c}=(0,o.useAuth)(),D=(0,t.useNavigate)(),{stockHistory:E,isLoading:F,updateStockHistoryEntry:G,deleteStockHistoryEntry:H,deleteMultipleStockHistoryEntries:I,recalculateProductStock:J,loadStockHistory:K}=(0,p.useStockHistory)(c?.id),{products:L,loadProducts:M}=(0,q.useProducts)(c?.id,1e4),{settings:N}=(0,r.useBusinessSettings)(),{clearAllLocationCaches:O}=(0,s.useStockSummaryData)({from:void 0,to:void 0}),{formatFinancial:P,canViewCostPrice:Q}=(0,C.useFinancialVisibility)(),[R,S]=(0,e.useState)("this-month"),[T,U]=(0,e.useState)(""),[V,W]=(0,e.useState)(""),[X,Y]=(0,e.useState)({open:!1,entry:null}),[Z,$]=(0,e.useState)({open:!1,group:null}),[_,aa]=(0,e.useState)({open:!1,entry:null}),[ab,ac]=(0,e.useState)({open:!1,group:null}),[ad,ae]=(0,e.useState)({}),[af,ag]=(0,e.useState)(!1);(0,e.useEffect)(()=>{let a=setTimeout(()=>{W(T)},300);return()=>clearTimeout(a)},[T]);let ah={USD:"$",EUR:"€",GBP:"£",NGN:"₦",GHS:"₵",KES:"KSh",ZAR:"R",EGP:"E£"}[a=N.currency]||a;(0,e.useEffect)(()=>{let a=()=>{K()};return window.addEventListener("stock-history-updated",a),()=>{window.removeEventListener("stock-history-updated",a)}},[K]),(0,e.useEffect)(()=>{(async()=>{if(!E.length||0===L.length||af)return;let a=Array.from(new Set(E.map(a=>a.productId).filter(a=>!!a&&!L.some(b=>b.id===a||b.itemNumber===a)&&!ad[a])));if(0!==a.length){ag(!0);try{let b=await (0,g.getActivityByEntityIdsAction)(a),c={...ad};b.success&&b.data&&b.data.forEach(a=>{a.entityId&&a.entityName&&!c[a.entityId]&&(c[a.entityId]=a.entityName)}),Object.keys(c).length>Object.keys(ad).length&&ae(c)}catch(a){console.error("Error scavenging names:",a)}finally{ag(!1)}}})()},[E,L,af,ad]);let ai=a=>parseFloat(a.toFixed(5)).toLocaleString(),aj="all"===R?null:(0,v.getDateRangeFromFilter)(R),{filteredBulkGroups:ak,filteredRegularGroups:al}=(0,e.useMemo)(()=>{try{if(F||!E.length)return{filteredBulkGroups:[],filteredRegularGroups:[]};let a=E.filter(a=>{try{let b=new Date(a.createdAt),c=!0;return aj&&(c=b>=aj.from&&b<=aj.to),c&&a.newQuantity>a.oldQuantity}catch{return!1}}),b=a.filter(a=>{let b=a.changeReason?.toLowerCase()||"";return b.includes("purchase:")||b.includes("invoice:")||b.includes("supplier:")||b.includes("session:")}),c=a.filter(a=>{let b=a.changeReason?.toLowerCase()||"";return!b.includes("purchase:")&&!b.includes("invoice:")&&!b.includes("supplier:")&&!b.includes("session:")}),d=b.reduce((a,b)=>{try{let c=b.changeReason?.match(/Session: (\d+)/),d=c?c[1]:b.createdAt.toString();if(!a[d]){let c=b.changeReason?.match(/Purchase: ([^|]+)/),e=b.changeReason?.match(/Invoice: ([^|]+)/);a[d]={date:b.createdAt,sessionId:d,supplier:c?c[1].trim():"Unknown Supplier",invoice:e?e[1].trim():"N/A",entries:[]}}return a[d].entries.push(b),a}catch{return a}},{});Object.values(d).forEach(a=>{try{a.entries.sort((a,b)=>{let c=a.changeReason?.match(/Seq: (\d+)/),d=b.changeReason?.match(/Seq: (\d+)/);return c&&d?parseInt(c[1])-parseInt(d[1]):new Date(a.createdAt).getTime()-new Date(b.createdAt).getTime()})}catch{}});let e=c.reduce((a,b)=>{try{let c=(0,u.format)(new Date(b.createdAt),"yyyy-MM-dd");return a[c]||(a[c]={date:b.createdAt,entries:[]}),a[c].entries.push(b),a}catch{return a}},{});Object.values(e).forEach(a=>{try{a.entries.sort((a,b)=>new Date(b.createdAt).getTime()-new Date(a.createdAt).getTime())}catch{}});let f=Object.values(d).sort((a,b)=>new Date(b.date).getTime()-new Date(a.date).getTime()),g=Object.values(e).sort((a,b)=>new Date(b.date).getTime()-new Date(a.date).getTime()),h=f.filter(a=>{if(!V.trim())return!0;try{let b=V.toLowerCase().trim(),c=a.supplier?.toLowerCase()?.includes(b)||!1,d=a.invoice?.toLowerCase()?.includes(b)||!1,e=a.entries.some(a=>{if(!a?.productId)return!1;try{return am(a).name.toLowerCase().includes(b)}catch{return!1}});return c||d||e}catch{return!1}}),i=g.filter(a=>{if(!V.trim())return!0;try{let b=V.toLowerCase().trim();return a.entries.some(a=>{try{if(!a?.productId)return a.changeReason?.toLowerCase()?.includes(b)||!1;let c=am(a).name.toLowerCase().includes(b),d=a.changeReason?.toLowerCase()?.includes(b)||!1;return c||d}catch{return!1}})}catch{return!1}});return{filteredBulkGroups:h,filteredRegularGroups:i}}catch(a){return console.error("Error in filtering logic:",a),{filteredBulkGroups:[],filteredRegularGroups:[]}}},[E,L,aj,V,F]),am=(0,e.useCallback)(a=>{try{if(!a)return{name:"Unknown",costPrice:0,sellingPrice:0};let{productId:b,changeReason:c,product:d}=a;if(d)return{name:d.name,costPrice:d.costPrice,sellingPrice:d.sellingPrice};let e=L.find(a=>a.id===b||a.itemNumber===b);if(e)return{name:e.name,costPrice:e.costPrice,sellingPrice:e.sellingPrice};if(c){let a=c.match(/^\[(.*?)\]\s*\|/);if(a)return{name:a[1],costPrice:0,sellingPrice:0}}if(ad[b])return{name:ad[b],costPrice:0,sellingPrice:0};let f=b||"";return{name:`Deleted Product (${f.length>8?f.slice(-8):f})`,costPrice:0,sellingPrice:0}}catch(a){return console.error("Error in getProductDetails:",a),{name:"Deleted Product",costPrice:0,sellingPrice:0}}},[L,ad]),an=a=>a.reduce((a,b)=>{let c=am(b),d=b.newQuantity-b.oldQuantity,e=d*c.costPrice;return{totalQty:a.totalQty+d,totalAmount:a.totalAmount+e}},{totalQty:0,totalAmount:0}),ao=a=>{D(`/inventory/${a}`)},ap=async(a,b,c,d)=>{let e=E.find(b=>b.id===a);if(!e)return!1;let f=await G(a,b,c,d);return f&&(O(),await Promise.all([J(e.productId),K()])),f},aq=async a=>{let b=E.find(b=>b.id===a);if(!b)return!1;let c=await H(a);return c&&(O(),await Promise.all([J(b.productId),K()])),c},ar=async a=>{if(!Z.group)return!1;let b=Z.group.entries.map(a=>a.id),c=Array.from(new Set(Z.group.entries.map(a=>a.productId)));try{let d=await (0,g.updateStockHistoryDatesAction)(b,a.toISOString());if(!d.success)throw Error(d.error);return await Promise.all(c.map(a=>J(a))),O(),await Promise.all([K(),M()]),!0}catch(a){return console.error("Error updating invoice date:",a),!1}},as=async a=>{let b=await I(a);return b&&(O(),await Promise.all([K(),M()]),window.dispatchEvent(new CustomEvent("stock-updated"))),b};return(0,d.jsxs)(f.Card,{className:"mt-6 shadow-sm",children:[(0,d.jsxs)(f.CardHeader,{className:"pb-3 md:pb-6",children:[(0,d.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)(k.History,{size:20}),(0,d.jsxs)("div",{children:[(0,d.jsx)(f.CardTitle,{className:"text-base md:text-lg",children:"Stock Input History"}),(0,d.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"View all stock additions and increases"})]})]}),(0,d.jsx)(w.default,{selectedFilter:R,onFilterChange:S})]}),(0,d.jsx)("div",{className:"mt-4",children:(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsx)(n.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),(0,d.jsx)(j.Input,{placeholder:"Search by supplier, invoice, or item name...",value:T,onChange:a=>U(a.target.value),className:"pl-10"})]})})]}),(0,d.jsx)(f.CardContent,{className:"p-0",children:F?(0,d.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,d.jsx)("div",{className:"text-sm text-muted-foreground",children:"Loading history..."})}):0===ak.length&&0===al.length?(0,d.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,d.jsx)(k.History,{size:48,className:"mx-auto mb-4 opacity-50"}),(0,d.jsx)("p",{children:T.trim()?"No matching stock history found.":"No stock input history found for the selected date range."})]}):(0,d.jsx)(B.TooltipProvider,{children:(0,d.jsxs)("div",{className:"space-y-6 p-4",children:[ak.length>0&&(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{className:"mb-4",children:[(0,d.jsx)("h3",{className:"text-lg font-semibold text-primary",children:"Stock Purchases"}),(0,d.jsx)("p",{className:"text-sm text-muted-foreground",children:"Stock purchased from suppliers"})]}),(0,d.jsx)("div",{className:"space-y-6",children:ak.map((a,b)=>{let c=an(a.entries);return(0,d.jsxs)("div",{className:"border rounded-lg overflow-hidden",children:[(0,d.jsx)("div",{className:"bg-primary/5 px-4 py-3 border-b",children:(0,d.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[(0,d.jsxs)("div",{className:"space-y-1",children:[(0,d.jsxs)("div",{className:"flex items-center gap-4",children:[(0,d.jsx)("h4",{className:"font-semibold text-base",children:(0,u.format)(new Date(a.date),"PPP")}),(0,d.jsxs)("span",{className:"text-xs bg-primary/20 text-primary px-2 py-1 rounded-full",children:[a.entries.length," item",a.entries.length>1?"s":""]})]}),(0,d.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center gap-1 md:gap-4 text-sm text-muted-foreground",children:[(0,d.jsxs)("span",{children:[(0,d.jsx)("strong",{children:"Supplier:"})," ",a.supplier]}),(0,d.jsxs)("span",{children:[(0,d.jsx)("strong",{children:"Invoice:"})," ",a.invoice]})]})]}),(0,d.jsxs)("div",{className:"flex gap-2",children:[(0,d.jsxs)(i.Button,{variant:"outline",size:"sm",onClick:()=>{$({open:!0,group:a})},className:"h-8 px-3 text-xs",children:[(0,d.jsx)(l.Edit,{className:"h-3 w-3 mr-1"}),"Edit Date"]}),(0,d.jsxs)(i.Button,{variant:"ghost",size:"sm",onClick:()=>{ac({open:!0,group:a})},className:"h-8 px-3 text-xs text-destructive hover:text-destructive",children:[(0,d.jsx)(m.Trash2,{className:"h-3 w-3 mr-1"}),"Delete Invoice"]})]})]})}),(0,d.jsx)("div",{className:"overflow-x-auto",children:(0,d.jsxs)(h.Table,{children:[(0,d.jsx)(h.TableHeader,{children:(0,d.jsxs)(h.TableRow,{children:[(0,d.jsx)(h.TableHead,{className:"w-[200px]",children:"Item"}),(0,d.jsx)(h.TableHead,{className:"w-[100px]",children:"Qty Added"}),(0,d.jsx)(h.TableHead,{className:"w-[100px]",children:"Price"}),(0,d.jsx)(h.TableHead,{className:"w-[100px]",children:"Amount"}),(0,d.jsx)(h.TableHead,{className:"w-[100px]",children:"Time"}),(0,d.jsx)(h.TableHead,{className:"w-[60px]",children:"Actions"})]})}),(0,d.jsxs)(h.TableBody,{children:[a.entries.map(a=>{let b=am(a),c=a.newQuantity-a.oldQuantity,e=b.costPrice,f=L.some(b=>b.id===a.productId||b.itemNumber===a.productId);return(0,d.jsxs)(h.TableRow,{children:[(0,d.jsx)(h.TableCell,{className:"font-medium",children:f?(0,d.jsxs)(B.Tooltip,{children:[(0,d.jsx)(B.TooltipTrigger,{asChild:!0,children:(0,d.jsx)("button",{onClick:()=>ao(a.productId),className:"text-left hover:text-primary hover:underline cursor-pointer transition-colors max-w-[200px] truncate",children:b.name})}),(0,d.jsx)(B.TooltipContent,{side:"top",className:"max-w-xs",children:(0,d.jsxs)("div",{className:"space-y-1",children:[(0,d.jsx)("p",{className:"font-bold break-words whitespace-normal",children:b.name}),a.changeReason&&(0,d.jsx)("p",{className:"text-xs text-muted-foreground",children:a.changeReason})]})})]}):(0,d.jsx)("span",{className:"max-w-[200px] truncate block",children:b.name})}),(0,d.jsxs)(h.TableCell,{className:"text-green-700 bg-green-50 font-medium px-3 py-2 rounded-lg border border-green-200",children:[a.oldQuantity," → ",a.newQuantity," (+",ai(c),")"]}),(0,d.jsx)(h.TableCell,{children:Q?`${ah}${P(e,"cost")}`:"•••"}),(0,d.jsx)(h.TableCell,{className:"font-medium",children:Q?`${ah}${ai(c*e)}`:"•••"}),(0,d.jsx)(h.TableCell,{className:"text-sm text-muted-foreground",children:(0,u.format)(new Date(a.createdAt),"p")}),(0,d.jsx)(h.TableCell,{children:(0,d.jsxs)("div",{className:"flex gap-1",children:[(0,d.jsx)(i.Button,{variant:"ghost",size:"sm",onClick:()=>Y({open:!0,entry:a}),className:"h-8 w-8 p-0",children:(0,d.jsx)(l.Edit,{className:"h-4 w-4"})}),(0,d.jsx)(i.Button,{variant:"ghost",size:"sm",onClick:()=>aa({open:!0,entry:a}),className:"h-8 w-8 p-0 text-destructive hover:text-destructive",children:(0,d.jsx)(m.Trash2,{className:"h-4 w-4"})})]})})]},a.id)}),(0,d.jsxs)(h.TableRow,{className:"bg-primary/5 font-semibold border-t-2",children:[(0,d.jsx)(h.TableCell,{className:"font-bold",children:"Total"}),(0,d.jsxs)(h.TableCell,{className:"text-green-700 bg-green-50 font-bold px-3 py-2 rounded-lg border border-green-200",children:["Total: +",ai(c.totalQty)]}),(0,d.jsx)(h.TableCell,{children:"-"}),(0,d.jsx)(h.TableCell,{className:"font-bold",children:Q?`${ah}${ai(c.totalAmount)}`:"•••"}),(0,d.jsx)(h.TableCell,{children:"-"}),(0,d.jsx)(h.TableCell,{children:"-"})]})]})]})})]},`purchase-${b}`)})})]}),al.length>0&&(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{className:"mb-4",children:[(0,d.jsx)("h3",{className:"text-lg font-semibold text-muted-foreground",children:"Regular Stock Additions"}),(0,d.jsx)("p",{className:"text-sm text-muted-foreground",children:"Individual stock additions and manual adjustments"})]}),(0,d.jsx)("div",{className:"space-y-4",children:al.map((a,b)=>{let c=an(a.entries);return(0,d.jsxs)("div",{className:"border rounded-lg overflow-hidden",children:[(0,d.jsx)("div",{className:"bg-muted/50 px-4 py-2 border-b",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsx)("h4",{className:"font-medium text-sm",children:(0,u.format)(new Date(a.date),"PPP")}),(0,d.jsx)("div",{className:"flex items-center gap-2",children:(0,d.jsxs)("span",{className:"text-xs text-muted-foreground",children:[a.entries.length," item",a.entries.length>1?"s":""]})})]})}),(0,d.jsx)("div",{className:"overflow-x-auto",children:(0,d.jsxs)(h.Table,{children:[(0,d.jsx)(h.TableHeader,{children:(0,d.jsxs)(h.TableRow,{children:[(0,d.jsx)(h.TableHead,{className:"w-[200px]",children:"Item"}),(0,d.jsx)(h.TableHead,{className:"w-[100px]",children:"Qty Added"}),(0,d.jsx)(h.TableHead,{className:"w-[100px]",children:"Price"}),(0,d.jsx)(h.TableHead,{className:"w-[100px]",children:"Amount"}),(0,d.jsx)(h.TableHead,{className:"w-[100px]",children:"Time"}),(0,d.jsx)(h.TableHead,{className:"w-[120px]",children:"Type"})]})}),(0,d.jsxs)(h.TableBody,{children:[a.entries.map(a=>{let b=am(a),c=a.newQuantity-a.oldQuantity,e=b.costPrice,f=L.some(b=>b.id===a.productId||b.itemNumber===a.productId);return(0,d.jsxs)(h.TableRow,{children:[(0,d.jsx)(h.TableCell,{className:"font-medium",children:f?(0,d.jsxs)(B.Tooltip,{children:[(0,d.jsx)(B.TooltipTrigger,{asChild:!0,children:(0,d.jsx)("button",{onClick:()=>ao(a.productId),className:"text-left hover:text-primary hover:underline cursor-pointer transition-colors max-w-[200px] truncate",children:b.name})}),(0,d.jsx)(B.TooltipContent,{side:"top",className:"max-w-xs",children:(0,d.jsxs)("div",{className:"space-y-1",children:[(0,d.jsx)("p",{className:"font-bold break-words whitespace-normal",children:b.name}),a.changeReason&&(0,d.jsx)("p",{className:"text-xs text-muted-foreground",children:a.changeReason})]})})]}):(0,d.jsx)("span",{className:"max-w-[200px] truncate block",children:b.name})}),(0,d.jsxs)(h.TableCell,{className:"text-green-700 bg-green-50 font-medium px-3 py-2 rounded-lg border border-green-200",children:[a.oldQuantity," → ",a.newQuantity," (+",ai(c),")"]}),(0,d.jsx)(h.TableCell,{children:Q?`${ah}${P(e,"cost")}`:"•••"}),(0,d.jsx)(h.TableCell,{className:"font-medium",children:Q?`${ah}${ai(c*e)}`:"•••"}),(0,d.jsx)(h.TableCell,{className:"text-sm text-muted-foreground",children:(0,u.format)(new Date(a.createdAt),"p")}),(0,d.jsx)(h.TableCell,{children:(0,d.jsx)("span",{className:"text-xs bg-muted text-muted-foreground px-2 py-1 rounded-full",children:a.changeReason})})]},a.id)}),(0,d.jsxs)(h.TableRow,{className:"bg-muted/30 font-semibold border-t-2",children:[(0,d.jsx)(h.TableCell,{className:"font-bold",children:"Total"}),(0,d.jsxs)(h.TableCell,{className:"text-green-700 bg-green-50 font-bold px-3 py-2 rounded-lg border border-green-200",children:["Total: +",ai(c.totalQty)]}),(0,d.jsx)(h.TableCell,{children:"-"}),(0,d.jsx)(h.TableCell,{className:"font-bold",children:Q?`${ah}${ai(c.totalAmount)}`:"•••"}),(0,d.jsx)(h.TableCell,{children:"-"}),(0,d.jsx)(h.TableCell,{children:"-"})]})]})]})})]},`regular-${b}`)})})]})]})})}),(0,d.jsx)(x.default,{open:X.open,onOpenChange:a=>Y({open:a,entry:null}),entry:X.entry,onConfirm:ap,productCreatedAt:X.entry&&(b=L.find(a=>a.id===X.entry?.productId))?new Date(b.createdAt):void 0}),(0,d.jsx)(z.default,{open:_.open,onOpenChange:a=>aa({open:a,entry:null}),entry:_.entry,onConfirm:aq}),(0,d.jsx)(A.DeleteInvoiceDialog,{open:ab.open,onOpenChange:a=>ac({open:a,group:null}),group:ab.group,onConfirm:as}),(0,d.jsx)(y.EditGroupDateDialog,{open:Z.open,onOpenChange:a=>$({open:a,group:null}),group:Z.group,onConfirm:ar})]})}]),c()}catch(a){c(a)}},!1),380695,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(396465),g=a.i(112779),h=a.i(811705),i=a.i(540629),j=a.i(158799),k=a.i(393551),l=a.i(493901),m=a.i(946032),n=a.i(86246),o=a.i(585459),p=a.i(493572),q=a.i(93538),r=a.i(531811),s=a.i(482331),t=a.i(108191),u=a.i(224993),v=a.i(558277),w=a.i(142499),x=a.i(468103),y=a.i(840238),z=a.i(981169),A=a.i(792071),B=a.i(799856),C=b([f,g,h,i,j,k,r,s,u,w,x,z,B]);[f,g,h,i,j,k,r,s,u,w,x,z,B]=C.then?(await C)():C;let D="bulkStockAddRows",E=({row:a,index:b,onUpdateRow:c,onRemoveRow:e,onProductSelect:i,onInputFocus:j,onAddRowAfter:k,onKeyDown:n,onMoveRow:o,settings:r,canRemove:s,products:t,stockEntryDate:u,isLastRow:v,totalRows:w})=>{let x,y=!!a.productId&&(()=>{let b=t.find(b=>b.id===a.productId);if(b){let a=new Date(b.createdAt),c=new Date(u),d=new Date(a.getFullYear(),a.getMonth(),a.getDate()),e=new Date(c.getFullYear(),c.getMonth(),c.getDate());return d.getTime()>e.getTime()}return!1})(),z=y?t.find(b=>b.id===a.productId):null;return(0,d.jsxs)(h.Card,{className:(0,B.cn)("mb-4 shadow-sm",y&&"border-destructive border-2"),children:[(0,d.jsx)(h.CardHeader,{className:"pb-3",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)(h.CardTitle,{className:"text-sm font-medium",children:["Item #",b+1]}),(0,d.jsxs)("div",{className:"flex gap-2",children:[(0,d.jsx)(f.Button,{variant:"outline",size:"icon",onClick:()=>o(a.id,"up"),disabled:0===b,className:"h-8 w-8",children:(0,d.jsx)(p.ChevronUp,{size:14})}),(0,d.jsx)(f.Button,{variant:"outline",size:"icon",onClick:()=>o(a.id,"down"),disabled:b===w-1,className:"h-8 w-8",children:(0,d.jsx)(q.ChevronDown,{size:14})}),(0,d.jsx)(f.Button,{variant:"outline",size:"icon",onClick:()=>e(a.id),disabled:!s,className:"h-8 w-8",children:(0,d.jsx)(m.Trash2,{size:14})})]})]})}),(0,d.jsxs)(h.CardContent,{className:"space-y-4",children:[(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsx)("label",{className:"text-xs font-medium text-muted-foreground mb-1 block",children:"Product"}),(0,d.jsx)(g.Input,{placeholder:"Type to search products...",value:a.searchTerm,onChange:b=>c(a.id,"searchTerm",b.target.value),onFocus:()=>j(a.id),onKeyDown:b=>n(b,a.id),className:(0,B.cn)("w-full",y&&"border-destructive")}),y&&z&&(0,d.jsxs)("p",{className:"text-xs text-destructive mt-1",children:["Product was created on ",(0,A.format)(new Date(z.createdAt),"PPP")," - after selected date"]})]}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-xs font-medium text-muted-foreground mb-1 block",children:"Quantity"}),(0,d.jsx)(g.Input,{type:"number",min:"0",step:"0.01",value:a.quantity||"",onChange:b=>c(a.id,"quantity",parseFloat(b.target.value)||0),onKeyDown:b=>n(b,a.id),placeholder:"0"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-xs font-medium text-muted-foreground mb-1 block",children:"Price"}),(0,d.jsx)(g.Input,{type:"number",min:"0",step:"0.01",value:a.price||"",onChange:b=>c(a.id,"price",parseFloat(b.target.value)||0),onKeyDown:b=>n(b,a.id),placeholder:"0.00"})]})]}),(0,d.jsx)("div",{className:"bg-muted/50 p-3 rounded-md",children:(0,d.jsxs)("div",{className:"flex justify-between items-center",children:[(0,d.jsx)("span",{className:"text-xs font-medium text-muted-foreground",children:"Amount:"}),(0,d.jsxs)("span",{className:"font-semibold",children:[r.currency," ",(x=a.amount,Math.round(x).toLocaleString())]})]})}),v&&(0,d.jsx)("div",{className:"flex justify-center pt-2",children:(0,d.jsxs)(f.Button,{variant:"ghost",size:"sm",onClick:()=>k(a.id),className:"gap-2 text-muted-foreground hover:text-foreground",children:[(0,d.jsx)(l.Plus,{size:14}),"Add row below"]})})]})]})};a.s(["default",0,()=>{let{user:a}=(0,r.useAuth)(),{products:b,updateProduct:c,loadProducts:C}=(0,s.useProducts)(a?.id,1e4),{settings:F}=(0,u.useBusinessSettings)(),{toast:G}=(0,t.useToast)(),H=(0,v.useIsMobile)(),{stockHistory:I,loadStockHistory:J}=(0,w.useStockHistory)(a?.id),K=a=>{let b=(()=>{if(0===I.length)return null;let a=[...I].sort((a,b)=>a.createdAt.getTime()-b.createdAt.getTime());return a[0]?.createdAt||null})();if(!b)return"";let c=new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0),d=new Date(b.getFullYear(),b.getMonth(),b.getDate(),0,0,0);return c.getTime()===d.getTime()?`Date cannot be the same as the initial stock entry date (${(0,A.format)(b,"PPP")})`:c.getTime()<d.getTime()?`Date cannot be earlier than initial stock date (${(0,A.format)(b,"PPP")})`:""},L=a=>Math.round(a).toLocaleString(),[M,N]=(0,e.useState)(new Date),[O,P]=(0,e.useState)(""),[Q,R]=(0,e.useState)(""),[S,T]=(0,e.useState)(()=>{try{let a=localStorage.getItem(D);if(a){let b=JSON.parse(a).map(a=>({...a,searchTerm:a.searchTerm||a.productName||""}));return b.length>0?b:[{id:"1",productId:"",productName:"",quantity:0,price:0,amount:0,searchTerm:""}]}}catch(a){console.error("Error loading saved stock rows:",a)}return[{id:"1",productId:"",productName:"",quantity:0,price:0,amount:0,searchTerm:""}]}),[U,V]=(0,e.useState)(!1),[W,X]=(0,e.useState)(null);(0,e.useEffect)(()=>{try{localStorage.setItem(D,JSON.stringify(S))}catch(a){console.error("Error saving stock rows:",a)}},[S]);let Y=(0,e.useCallback)(()=>{try{localStorage.removeItem(D)}catch(a){console.error("Error clearing stored data:",a)}},[]),Z=S.find(a=>a.id===W),{suggestions:$,isOpen:_,closePanel:aa}=(0,y.useProductSuggestions)(b,Z?.searchTerm||""),ab=(0,e.useCallback)(()=>{let a={id:Date.now().toString(),productId:"",productName:"",quantity:0,price:0,amount:0,searchTerm:""};T(b=>[...b,a])},[]),ac=(0,e.useCallback)(a=>{let b={id:Date.now().toString(),productId:"",productName:"",quantity:0,price:0,amount:0,searchTerm:""};T(c=>{let d=c.findIndex(b=>b.id===a),e=[...c];return e.splice(d+1,0,b),e})},[]),ad=(0,e.useCallback)((a,b)=>{T(c=>{let d=c.findIndex(b=>b.id===a);if(-1===d)return c;let e="up"===b?d-1:d+1;if(e<0||e>=c.length)return c;let f=[...c];return[f[d],f[e]]=[f[e],f[d]],f})},[]),ae=(0,e.useCallback)((a,b)=>{"Enter"!==a.key||a.shiftKey||(a.preventDefault(),ac(b))},[ac]),af=(0,e.useCallback)(a=>{S.length>1&&(T(b=>b.filter(b=>b.id!==a)),W===a&&X(null))},[S.length,W]),ag=(0,e.useCallback)((a,c,d)=>{T(e=>e.map(e=>{if(e.id===a){let a={...e,[c]:d};return"searchTerm"===c&&"string"==typeof d&&(b.find(a=>a.name.toLowerCase()===d.toLowerCase())||(a.productId="",a.productName="",a.price=0)),("quantity"===c||"price"===c)&&(a.amount=a.quantity*a.price),a}return e}))},[b]),ah=(0,e.useCallback)(a=>{W&&(T(b=>{let c=b.findIndex(b=>b.productId===a.id&&b.id!==W);if(-1!==c){let d=b.find(a=>a.id===W),e=d?.quantity||0,f=b.map((a,b)=>{if(b===c){let b=a.quantity+e;return{...a,quantity:b,amount:b*a.price}}return a}).filter(a=>a.id!==W);return G({title:"Product already in list",description:`Merged "${a.name}" quantity.`}),f.length>0?f:[{id:Date.now().toString(),productId:"",productName:"",quantity:0,price:0,amount:0,searchTerm:""}]}return b.map(b=>b.id===W?{...b,productId:a.id,productName:a.name,searchTerm:a.name,price:a.costPrice,amount:b.quantity*a.costPrice}:b)}),X(null))},[W,G]),ai=(0,e.useCallback)(a=>{X(a)},[]),aj=(0,e.useCallback)(()=>{let a=[];return S.forEach((c,d)=>{if(c.productId||a.push(`Row ${d+1}: Please select a product`),c.quantity<=0&&a.push(`Row ${d+1}: Quantity must be greater than 0`),c.price<0&&a.push(`Row ${d+1}: Price cannot be negative`),c.productId){let e=b.find(a=>a.id===c.productId);if(e){let b=new Date(e.createdAt),c=new Date(M),f=new Date(b.getFullYear(),b.getMonth(),b.getDate()),g=new Date(c.getFullYear(),c.getMonth(),c.getDate());f.getTime()>g.getTime()&&a.push(`Row ${d+1}: Product "${e.name}" was created on ${(0,A.format)(b,"PPP")} which is after the selected stock date`)}}}),a},[S,b,M]),ak=(0,e.useCallback)(async()=>{let a=aj(),d=K(M);if(d&&a.push(d),a.length>0)return void G({title:"Validation Error",description:a.join(", "),variant:"destructive"});V(!0);try{let a=0,d=0,e=new Map;S.forEach(a=>{if(a.productId)if(e.has(a.productId)){let b=e.get(a.productId);b.quantity+=a.quantity,b.price=a.price,b.amount=b.quantity*b.price}else e.set(a.productId,{...a})});let f=Array.from(e.values()),g=Date.now().toString(),h=`Purchase: ${O||"Unknown Supplier"} | Invoice: ${Q||"N/A"} | Session: ${g}`;for(let e=0;e<f.length;e++){let g=f[e],i=b.find(a=>a.id===g.productId);if(i){let b=i.quantity+g.quantity,f=`${h} | Seq: ${e+1}`;await c(g.productId,{quantity:b,costPrice:g.price},void 0,!1,f,M)?a++:d++}}if(a>0){G({title:"Stock Added Successfully",description:`Added stock for ${a} product${a>1?"s":""}`});let b={id:Date.now().toString(),productId:"",productName:"",quantity:0,price:0,amount:0,searchTerm:""};T([b]),P(""),R(""),Y(),await Promise.all([C(),J()]),setTimeout(()=>{window.dispatchEvent(new CustomEvent("inventory-updated")),window.dispatchEvent(new CustomEvent("stock-history-updated"))},100)}d>0&&G({title:"Some Updates Failed",description:`${d} product${d>1?"s":""} could not be updated`,variant:"destructive"})}catch(a){console.error("Error in bulk stock addition:",a),G({title:"Error",description:"Failed to add stock. Please try again.",variant:"destructive"})}finally{V(!1)}},[S,b,c,C,J,G,aj,Y,M,O,Q]),al=S.reduce((a,b)=>a+b.amount,0),am=S.reduce((a,b)=>a+b.quantity,0);return(0,d.jsxs)("div",{className:"space-y-4 md:space-y-6",children:[(0,d.jsxs)(h.Card,{className:"shadow-sm",children:[(0,d.jsx)(h.CardHeader,{className:"pb-3 md:pb-6",children:(0,d.jsxs)("div",{className:"space-y-3 md:space-y-0 md:flex md:items-center md:justify-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)(h.CardTitle,{className:"text-base md:text-lg",children:"Restock in Bulk"}),(0,d.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Add stock for multiple products at once"})]}),(0,d.jsxs)("div",{className:"space-y-3",children:[(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,d.jsxs)(j.Popover,{children:[(0,d.jsx)(j.PopoverTrigger,{asChild:!0,children:(0,d.jsxs)(f.Button,{variant:"outline",className:"gap-2 justify-start text-left font-normal w-full",children:[(0,d.jsx)(o.CalendarIcon,{size:16}),(0,A.format)(M,"MMM d, yyyy")]})}),(0,d.jsxs)(j.PopoverContent,{className:"w-auto p-0 z-[100] bg-white shadow-lg",align:"start",children:[(0,d.jsx)(k.Calendar,{mode:"single",selected:M,onSelect:a=>a&&N(a),disabled:a=>{let c=S.filter(a=>a.productId).map(a=>b.find(b=>b.id===a.productId)).filter(Boolean);if(0===c.length)return a<new Date("2000-01-01")||a>new Date;let d=c.reduce((a,b)=>{let c=new Date(b.createdAt);return!a||c<a?c:a},null);return a<(d||new Date("2000-01-01"))||a>new Date},className:(0,B.cn)("p-3 pointer-events-auto",K(M)&&"border-destructive"),initialFocus:!0}),K(M)&&(0,d.jsx)("div",{className:"p-3 border-t bg-destructive/5",children:(0,d.jsx)("p",{className:"text-sm text-destructive",children:K(M)})})]})]}),(0,d.jsx)(g.Input,{placeholder:"Supplier name",value:O,onChange:a=>P(a.target.value),className:"w-full"}),(0,d.jsx)(g.Input,{placeholder:"Invoice number",value:Q,onChange:a=>R(a.target.value),className:"w-full"})]}),(0,d.jsxs)("div",{className:"flex space-x-2",children:[(0,d.jsxs)(f.Button,{onClick:ab,variant:"outline",className:"gap-2 flex-1 md:flex-none",children:[(0,d.jsx)(l.Plus,{size:16})," Add Row"]}),(0,d.jsxs)(f.Button,{onClick:ak,disabled:U||0===S.length,className:"gap-2 flex-1 md:flex-none",children:[(0,d.jsx)(n.Save,{size:16}),U?"Saving...":`Save All (${S.length})`]})]})]})]})}),(0,d.jsxs)(h.CardContent,{className:"p-0 md:p-6",children:[H?(0,d.jsxs)("div",{className:"p-4 space-y-4",children:[S.map((a,c)=>(0,d.jsx)(E,{row:a,index:c,onUpdateRow:ag,onRemoveRow:af,onProductSelect:ah,onInputFocus:ai,onAddRowAfter:ac,onKeyDown:ae,onMoveRow:ad,settings:F,canRemove:S.length>1,products:b,stockEntryDate:M,isLastRow:c===S.length-1,totalRows:S.length},a.id)),(0,d.jsx)(h.Card,{className:"bg-primary/5 border-primary/20",children:(0,d.jsx)(h.CardContent,{className:"p-4",children:(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center",children:[(0,d.jsx)("span",{className:"font-medium",children:"Total Quantity:"}),(0,d.jsx)("span",{className:"text-lg font-bold text-primary",children:L(am)})]}),(0,d.jsxs)("div",{className:"flex justify-between items-center",children:[(0,d.jsx)("span",{className:"font-medium",children:"Total Amount:"}),(0,d.jsxs)("span",{className:"text-lg font-bold text-primary",children:[F.currency," ",L(al)]})]})]})})})]}):(0,d.jsx)("div",{className:"overflow-x-auto",children:(0,d.jsxs)(i.Table,{children:[(0,d.jsx)(i.TableHeader,{children:(0,d.jsxs)(i.TableRow,{children:[(0,d.jsx)(i.TableHead,{className:"w-[300px]",children:"Item"}),(0,d.jsx)(i.TableHead,{className:"w-[120px]",children:"Qty"}),(0,d.jsx)(i.TableHead,{className:"w-[120px]",children:"Price"}),(0,d.jsx)(i.TableHead,{className:"w-[120px]",children:"Amount"}),(0,d.jsx)(i.TableHead,{className:"w-[140px]",children:"Actions"})]})}),(0,d.jsxs)(i.TableBody,{children:[S.map((a,c)=>{let e=!!a.productId&&(()=>{let c=b.find(b=>b.id===a.productId);if(c){let a=new Date(c.createdAt),b=new Date(M),d=new Date(a.getFullYear(),a.getMonth(),a.getDate()),e=new Date(b.getFullYear(),b.getMonth(),b.getDate());return d.getTime()>e.getTime()}return!1})(),h=e?b.find(b=>b.id===a.productId):null;return(0,d.jsxs)(i.TableRow,{className:e?"border-destructive border-2 bg-destructive/5":"",children:[(0,d.jsx)(i.TableCell,{children:(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsx)(g.Input,{placeholder:"Type to search products...",value:a.searchTerm,onChange:b=>ag(a.id,"searchTerm",b.target.value),onFocus:()=>ai(a.id),onKeyDown:b=>ae(b,a.id),className:(0,B.cn)("w-full",e&&"border-destructive")}),e&&h&&(0,d.jsxs)("p",{className:"text-xs text-destructive mt-1",children:["Product was created on ",(0,A.format)(new Date(h.createdAt),"PPP")," - after selected date"]})]})}),(0,d.jsx)(i.TableCell,{children:(0,d.jsx)(g.Input,{type:"number",min:"0",step:"0.01",value:a.quantity||"",onChange:b=>ag(a.id,"quantity",parseFloat(b.target.value)||0),onKeyDown:b=>ae(b,a.id),placeholder:"0"})}),(0,d.jsx)(i.TableCell,{children:(0,d.jsx)(g.Input,{type:"number",min:"0",step:"0.01",value:a.price||"",onChange:b=>ag(a.id,"price",parseFloat(b.target.value)||0),onKeyDown:b=>ae(b,a.id),placeholder:"0.00"})}),(0,d.jsx)(i.TableCell,{children:(0,d.jsxs)("div",{className:"font-medium",children:[F.currency," ",L(a.amount)]})}),(0,d.jsx)(i.TableCell,{children:(0,d.jsxs)("div",{className:"flex gap-1",children:[(0,d.jsx)(f.Button,{variant:"outline",size:"icon",onClick:()=>ad(a.id,"up"),disabled:0===c,className:"h-8 w-8",children:(0,d.jsx)(p.ChevronUp,{size:14})}),(0,d.jsx)(f.Button,{variant:"outline",size:"icon",onClick:()=>ad(a.id,"down"),disabled:c===S.length-1,className:"h-8 w-8",children:(0,d.jsx)(q.ChevronDown,{size:14})}),(0,d.jsx)(f.Button,{variant:"outline",size:"icon",onClick:()=>af(a.id),disabled:1===S.length,className:"h-8 w-8",children:(0,d.jsx)(m.Trash2,{size:14})})]})})]},a.id)}),(0,d.jsx)(i.TableRow,{className:"border-none",children:(0,d.jsx)(i.TableCell,{colSpan:5,className:"py-1 text-center",children:(0,d.jsxs)(f.Button,{variant:"ghost",size:"sm",onClick:()=>ac(S[S.length-1].id),className:"gap-2 text-muted-foreground hover:text-foreground text-xs",children:[(0,d.jsx)(l.Plus,{size:12}),"Add row below"]})})}),(0,d.jsxs)(i.TableRow,{className:"border-t-2",children:[(0,d.jsx)(i.TableCell,{className:"text-right font-medium",children:"Total Quantity:"}),(0,d.jsx)(i.TableCell,{className:"font-bold text-lg",children:L(am)}),(0,d.jsx)(i.TableCell,{className:"text-right font-medium",children:"Total Amount:"}),(0,d.jsxs)(i.TableCell,{className:"font-bold text-lg",children:[F.currency," ",L(al)]}),(0,d.jsx)(i.TableCell,{})]})]})]})}),0===S.length&&(0,d.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:'No stock entries. Click "Add Row" to start adding stock.'})]})]}),(0,d.jsx)(x.default,{suggestions:$,isOpen:_,onClose:aa,onSelectProduct:ah,searchTerm:Z?.searchTerm||""}),(0,d.jsx)(z.default,{})]})}]),c()}catch(a){c(a)}},!1),600387,a=>{"use strict";let b=(0,a.i(564375).default)("ScanBarcode",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M8 7v10",key:"23sfjj"}],["path",{d:"M12 7v10",key:"jspqdw"}],["path",{d:"M17 7v10",key:"578dap"}]]);a.s(["ScanBarcode",()=>b],600387)},92339,a=>{"use strict";let b=(0,a.i(564375).default)("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);a.s(["ClipboardList",()=>b],92339)},350618,a=>a.a(async(b,c)=>{try{var d=a.i(792071),e=a.i(959866),f=a.i(647952),g=b([f]);[f]=g.then?(await g)():g,a.s(["exportStockCountToCSV",0,a=>{let b=a.map(a=>[a.product.name,a.product.barcode||"N/A",a.product.quantity.toString(),a.actualStock.toString(),a.variation.toString()]),c=["Product Name,Barcode,System Stock,Actual Stock,Variation",...b.map(a=>a.map(a=>`"${a.replace(/"/g,'""')}"`).join(","))].join("\n"),e=new Blob([c],{type:"text/csv;charset=utf-8;"}),f=URL.createObjectURL(e),g=document.createElement("a");g.setAttribute("href",f),g.setAttribute("download",`stock_count_${(0,d.format)(new Date,"yyyy-MM-dd_HHmm")}.csv`),document.body.appendChild(g),g.click(),document.body.removeChild(g)},"exportStockCountToPDF",0,(a,b="Gonza Systems",c)=>{let g=new e.default,h=g.internal.pageSize.getWidth();g.setFontSize(20);let i=c?.auditId?`Stock Count Report - ${c.auditId}`:`Stock Count / Audit Report ${c?.auditNumber?`#${c.auditNumber}`:""}`;if(g.text(i,14,22),g.setFontSize(11),g.setTextColor(100),g.text(`Business: ${b}`,14,30),g.text(`Date: ${(0,d.format)(new Date,"PPP p")}`,14,36),c?.auditorName||c?.contactPerson){let a=42;c.auditorName&&(g.text(`Auditor: ${c.auditorName}`,14,a),a+=6),c.contactPerson&&g.text(`Contact Person: ${c.contactPerson}`,14,a)}let j=a.map(a=>[a.product.name,a.product.barcode||"N/A",a.product.quantity.toString(),a.actualStock.toString(),{content:a.variation>0?`+${a.variation}`:a.variation.toString(),styles:{textColor:a.variation<0?[220,38,38]:a.variation>0?[22,163,74]:[100,116,139]}}]);(0,f.default)(g,{head:[["Product Name","Barcode","System","Actual","Variation"]],body:j,startY:c?.auditorName||c?.contactPerson?55:45,theme:"striped",headStyles:{fillColor:[59,130,246]},alternateRowStyles:{fillColor:[248,250,252]},margin:{top:45}});let k=g.lastAutoTable.finalY+25;k<g.internal.pageSize.getHeight()-40&&(g.setDrawColor(200),g.line(14,k,80,k),g.line(h-80,k,h-14,k),g.setFontSize(9),g.setTextColor(50),g.text("Auditor Signature",14,k+5),g.text("Stock Manager Signature",h-80,k+5));let l=g.internal.getNumberOfPages();for(let a=1;a<=l;a++)g.setPage(a),g.setFontSize(8),g.setTextColor(150),g.text("Created By Gonza Systems",g.internal.pageSize.getWidth()/2,g.internal.pageSize.getHeight()-10,{align:"center"});g.save(`stock_audit_${(0,d.format)(new Date,"yyyy-MM-dd_HHmm")}.pdf`)}]),c()}catch(a){c(a)}},!1),369576,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(396465),g=a.i(112779),h=a.i(811705),i=a.i(540629),j=a.i(148608),k=a.i(946032),l=a.i(86246),m=a.i(957143),n=a.i(600387),o=a.i(515016),p=a.i(264397),q=a.i(92339),r=a.i(120327),s=a.i(445916),t=a.i(369773),u=a.i(792071),v=a.i(531811),w=a.i(482331),x=a.i(169320),y=a.i(964889),z=a.i(483123),A=a.i(799856),B=a.i(350618),C=a.i(893759),D=a.i(532572),E=a.i(637610),F=a.i(470167),G=a.i(818703),H=a.i(643228),I=a.i(114748),J=a.i(142499),K=a.i(852741),L=b([f,g,h,i,j,v,w,x,y,A,B,C,J]);[f,g,h,i,j,v,w,x,y,A,B,C,J]=L.then?(await L)():L;let M="stockCountData",N=({rows:a,onUpdate:b,onRemove:c,isAuditMode:e,lastScannedId:h})=>(0,d.jsx)("div",{className:"overflow-x-auto",children:(0,d.jsxs)(i.Table,{children:[(0,d.jsx)(i.TableHeader,{children:(0,d.jsxs)(i.TableRow,{className:"bg-muted/50 border-b-2",children:[(0,d.jsx)(i.TableHead,{className:"min-w-[200px] font-bold text-gray-700",children:"Item Details"}),(0,d.jsx)(i.TableHead,{className:"text-center w-[120px] font-bold text-gray-700",children:"System"}),(0,d.jsx)(i.TableHead,{className:"text-center w-[150px] font-bold text-gray-700",children:"Actual Count"}),(0,d.jsx)(i.TableHead,{className:"text-center w-[150px] font-bold text-gray-700",children:"Variation"}),!e&&(0,d.jsx)(i.TableHead,{className:"text-right w-[80px]"})]})}),(0,d.jsx)(i.TableBody,{children:0===a.length?(0,d.jsx)(i.TableRow,{children:(0,d.jsx)(i.TableCell,{colSpan:e?4:5,className:"h-48 text-center bg-slate-50",children:(0,d.jsxs)("div",{className:"flex flex-col items-center gap-2 text-muted-foreground",children:[(0,d.jsx)(r.Filter,{className:"h-8 w-8 opacity-20"}),(0,d.jsx)("p",{children:e?"No products match your search":"No items recorded yet"})]})})}):a.map(({product:a,actualStock:j,variation:l})=>(0,d.jsxs)(i.TableRow,{id:`row-${a.id}`,className:(0,A.cn)("hover:bg-muted/30 transition-colors",0!==l&&"bg-orange-50/20",h===a.id&&"row-highlight"),children:[(0,d.jsxs)(i.TableCell,{className:"py-4",children:[(0,d.jsx)("div",{className:"font-bold text-gray-900 leading-tight",children:a.name}),(0,d.jsx)("div",{className:"text-[10px] text-muted-foreground font-mono mt-1 uppercase tracking-tighter",children:a.barcode||"NO BARCODE"})]}),(0,d.jsx)(i.TableCell,{className:"text-center text-sm font-medium text-slate-500",children:a.quantity}),(0,d.jsx)(i.TableCell,{className:"text-center",children:(0,d.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,d.jsx)(f.Button,{variant:"outline",size:"icon",className:"h-8 w-8 rounded-full",onClick:()=>b(a,-1,!0),children:"-"}),(0,d.jsx)(g.Input,{type:"number",className:"w-20 text-center font-black text-lg border-2",value:j,onChange:c=>b(a,parseFloat(c.target.value)||0,!1)}),(0,d.jsx)(f.Button,{variant:"outline",size:"icon",className:"h-8 w-8 rounded-full bg-slate-100",onClick:()=>b(a,1,!0),children:"+"})]})}),(0,d.jsx)(i.TableCell,{className:"text-center",children:(0,d.jsxs)("div",{className:(0,A.cn)("inline-flex items-center px-2.5 py-1 rounded-full text-xs font-black ring-1",l>0?"text-emerald-700 bg-emerald-50 ring-emerald-200":l<0?"text-rose-700 bg-rose-50 ring-rose-200":"text-slate-500 bg-slate-50 ring-slate-200"),children:[l>0?(0,d.jsx)(o.TrendingUp,{className:"h-3 w-3 mr-1"}):l<0?(0,d.jsx)(p.TrendingDown,{className:"h-3 w-3 mr-1"}):null,l>0?"+":"",l]})}),!e&&(0,d.jsx)(i.TableCell,{className:"text-right px-4",children:(0,d.jsx)(f.Button,{variant:"ghost",size:"icon",onClick:()=>c(a.id),className:"hover:bg-red-50 hover:text-red-600 rounded-full",children:(0,d.jsx)(k.Trash2,{className:"h-4 w-4"})})})]},a.id))})]})});a.s(["default",0,()=>{let{user:a}=(0,v.useAuth)(),b=a?.id,{currentBusiness:c}=(0,y.useBusiness)(),{products:o,updateProduct:p,updateProductsBulk:r,loadProducts:L}=(0,w.useProducts)(b,1e4),[O,P]=(0,e.useState)(!1),[Q,R]=(0,e.useState)(""),[S,T]=(0,e.useState)("quick"),[U,V]=(0,e.useState)(null),[W,X]=(0,e.useState)(!1),[Y,Z]=(0,e.useState)(null),[$,_]=(0,e.useState)(""),[aa,ab]=(0,e.useState)(""),[ac,ad]=(0,e.useState)(null),[ae,af]=(0,e.useState)(null),{stockHistory:ag,isLoading:ah,loadStockHistory:ai}=(0,J.useStockHistory)(b),[aj,ak]=(0,e.useState)(()=>{try{let a=localStorage.getItem(M);return a?JSON.parse(a):{}}catch(a){return{}}});(0,e.useEffect)(()=>{localStorage.setItem(M,JSON.stringify(aj))},[aj]);let al=(0,e.useCallback)((a,b,c=!0)=>{ak(d=>{let e=d[a.id]||0;return{...d,[a.id]:Math.max(0,c?e+b:b)}})},[]),am=(0,e.useCallback)(a=>{al(a,1,!0),V(a.id),x.toast.success(`Tally: ${a.name}`,{duration:1e3,position:"bottom-center"}),setTimeout(()=>V(null),2e3)},[al]);(0,e.useEffect)(()=>{if(U){let a=document.getElementById(`row-${U}`);a&&a.scrollIntoView({behavior:"smooth",block:"center"})}},[U]);let an=(0,e.useRef)(""),ao=(0,e.useRef)(Date.now());(0,e.useEffect)(()=>{let a=a=>{let b=a.target,d=Date.now(),e=d-ao.current;ao.current=d;let f=/^[a-zA-Z0-9\-_]$/.test(a.key),g="INPUT"===b.tagName||"TEXTAREA"===b.tagName||"true"===b.contentEditable;if(!g&&f&&(a.preventDefault(),a.stopPropagation()),"Enter"===a.key){let b=an.current.trim();if(b.length>=2){a.preventDefault(),a.stopPropagation(),console.log(`[StockCount Scanner] Processing: "${b}"`);let d=async a=>{let b=await (0,K.lookupProductByBarcodeAction)(a,c?.id||"");return b?(0,z.mapDbProductToProduct)(b):null};(async()=>{let a=await d(b);if(a){let c=a.barcode||a.itemNumber||b;console.log(`[StockCount Scanner] ✅ Server Match: ${a.name}`),console.log(`[StockCount Scanner] 🔗 Mapping "${b}" -> System Code "${c}"`),am(a)}else console.warn(`[StockCount Scanner] ❌ No server match for: "${b}"`)})(),an.current="";return}(!g||b.length>=2)&&(an.current="",a.preventDefault(),a.stopPropagation());return}1===a.key.length&&(e<60&&g&&f&&(a.preventDefault(),a.stopPropagation()),e>100?an.current=a.key:an.current+=a.key)};return window.addEventListener("keydown",a,!0),()=>window.removeEventListener("keydown",a,!0)},[b,c?.id]);let ap=(0,e.useMemo)(()=>o.filter(a=>aj.hasOwnProperty(a.id)).map(a=>{let b=aj[a.id];return void 0===b?null:{product:a,actualStock:b,variation:Number((b-a.quantity).toFixed(2))}}).filter(a=>null!==a),[aj,o,ac]),aq=(0,e.useMemo)(()=>{let a=Q.toLowerCase();return o.filter(b=>!Q||b.name.toLowerCase().includes(a)||b.barcode&&b.barcode.toLowerCase().includes(a)||b.itemNumber&&b.itemNumber.toLowerCase().includes(a)||b.manufacturerBarcode&&b.manufacturerBarcode.toLowerCase().includes(a)).map(a=>{let b=aj[a.id]??0;return{product:a,actualStock:b,variation:Number((b-a.quantity).toFixed(2))}})},[aj,o,Q]),ar=async a=>{let c=Object.keys(aj);if(0===c.length)return;if(O)return void console.warn("⚠️ Commit already in progress, ignoring duplicate call");P(!0),X(!1);let d=ac||crypto.randomUUID(),e=as.length+1,f=`AUD-${String(e).padStart(4,"0")}`,g=ac?"Stock Count Edit":"Stock Count Update",h=`${f} | ${g}${$?` | Auditor: ${$}`:""}${aa?` | Contact: ${aa}`:""}`;console.log("🔍 Stock Count Commit Debug:",{shouldUpdateInventory:a,affectedIds:c,sessionId:d,auditId:f,finalReason:h,userId:b,updateCount:c.length});try{if(a){let a=c.map(a=>o.find(b=>b.id===a)?{id:a,updated:{quantity:aj[a]}}:null).filter(a=>null!==a);if(a.length>0){if(ac){let a=as.find(a=>a.id===ac);if(a){let b=a.items.map(a=>a.id),c=Array.from(new Set(a.items.map(a=>a.productId)));for(let a of(await at(b),c))await au(a)}}if(await r(a,b,h,d))x.toast.success(`Inventory updated! ${a.length} items corrected.`);else throw Error("Bulk update failed")}}else x.toast.success("Audit completed and cleared (Inventory not changed).");ak({}),_(""),ab(""),ad(null),localStorage.removeItem(M),await L(),await ai()}catch(a){console.error("Commit error:",a),x.toast.error("An error occurred during completion.")}finally{P(!1)}},as=(0,e.useMemo)(()=>{let a=ag.filter(a=>a.changeReason?.includes("Stock Count Update")||a.changeReason?.includes("Stock Count Edit")),b={};return a.forEach(a=>{let c=a.referenceId||"unknown",d=a.changeReason?.match(/AUD-\d{4}/),e=d?d[0]:void 0,f=a.changeReason?.includes("Stock Count Edit")||!1;b[c]||(b[c]={id:c,date:a.createdAt,items:[],auditId:e,isEdited:!1}),f&&(b[c].isEdited=!0),b[c].items.find(b=>b.id===a.id)||b[c].items.push(a)}),Object.values(b).sort((a,b)=>a.date.getTime()-b.date.getTime()).map((a,b)=>({...a,auditNumber:b+1})).reverse()},[ag]),{deleteMultipleStockHistoryEntries:at,recalculateStockChain:au}=(0,J.useStockHistory)(b),av=async a=>{af(null),P(!0);try{let b=a.items.map(a=>a.id),c=Array.from(new Set(a.items.map(a=>a.productId)));if(await at(b)){for(let a of c)await au(a);x.toast.success("Audit deleted and stock restored!"),await L()}else x.toast.error("Failed to delete audit.")}catch(a){console.error("Delete session error:",a),x.toast.error("An error occurred.")}finally{P(!1)}};return(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsx)("style",{dangerouslySetInnerHTML:{__html:`
                @keyframes highlight-fade {
                    0% { background-color: rgba(59, 130, 246, 0.2); }
                    100% { background-color: transparent; }
                }
                .row-highlight {
                    animation: highlight-fade 2s ease-out forwards;
                }
            `}}),(0,d.jsxs)(h.Card,{className:"shadow-sm border-2",children:[(0,d.jsx)(h.CardHeader,{className:"pb-3 px-4 md:px-6 bg-muted/20",children:(0,d.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsxs)(h.CardTitle,{className:"text-xl flex items-center gap-2",children:[(0,d.jsx)(n.ScanBarcode,{className:"h-6 w-6 text-sales-primary"}),"Inventory Audit"]}),(0,d.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:'Counts are saved locally. Click "Complete Audit" to update the system.'})]}),(0,d.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,d.jsxs)("div",{className:"flex gap-1 mr-2 border-r pr-2",children:[(0,d.jsxs)(f.Button,{variant:"outline",size:"sm",onClick:()=>{let a="quick"===S?ap:aq;0===a.length?x.toast.error("No items to export."):(0,B.exportStockCountToCSV)(a)},disabled:"history"===S||"quick"===S&&0===ap.length||"audit"===S&&0===aq.length,className:"h-9 gap-2",children:[(0,d.jsx)(D.Download,{className:"h-4 w-4"}),"CSV"]}),(0,d.jsxs)(f.Button,{variant:"outline",size:"sm",onClick:()=>{let a="quick"===S?ap:aq;0===a.length?x.toast.error("No items to export."):(0,B.exportStockCountToPDF)(a,c?.name,{auditorName:$,contactPerson:aa})},disabled:"history"===S||"quick"===S&&0===ap.length||"audit"===S&&0===aq.length,className:"h-9 gap-2",children:[(0,d.jsx)(E.FileDown,{className:"h-4 w-4"}),"PDF"]})]}),(0,d.jsxs)(f.Button,{variant:"outline",onClick:()=>{0!==Object.keys(aj).length&&window.confirm("Clear all recorded counts? progress will be lost.")&&(ak({}),localStorage.removeItem(M),x.toast.info("Progress cleared."))},disabled:O||0===Object.keys(aj).length,className:"text-red-500 border-red-200 hover:bg-red-50 h-9",children:[(0,d.jsx)(k.Trash2,{className:"h-4 w-4 mr-2"}),"Reset"]}),(0,d.jsxs)(f.Button,{onClick:()=>X(!0),disabled:O||0===Object.keys(aj).length,className:"gap-2 bg-sales-primary hover:bg-sales-primary/90 shadow-md h-9 px-4",children:[(0,d.jsx)(l.Save,{className:"h-4 w-4"}),O?"Syncing...":"Complete Audit"]})]})]})}),(0,d.jsx)(h.CardContent,{className:"p-0",children:(0,d.jsxs)(j.Tabs,{value:S,onValueChange:T,className:"w-full",children:[(0,d.jsx)("div",{className:"px-4 md:px-6 pt-4 border-b",children:(0,d.jsxs)(j.TabsList,{className:"flex w-full md:w-[450px] mb-4 overflow-x-auto",children:[(0,d.jsxs)(j.TabsTrigger,{value:"quick",className:"flex-1 gap-2 whitespace-nowrap",children:[(0,d.jsx)(n.ScanBarcode,{className:"h-4 w-4"}),"Quick Scan"]}),(0,d.jsxs)(j.TabsTrigger,{value:"audit",className:"flex-1 gap-2 whitespace-nowrap",children:[(0,d.jsx)(q.ClipboardList,{className:"h-4 w-4"}),"Full List"]}),(0,d.jsxs)(j.TabsTrigger,{value:"history",className:"flex-1 gap-2 whitespace-nowrap",children:[(0,d.jsx)(F.History,{className:"h-4 w-4"}),"Audit History"]})]})}),(0,d.jsxs)(j.TabsContent,{value:"quick",className:"m-0",children:[(0,d.jsxs)("div",{className:"p-6 text-center bg-sales-primary/5 border-b",children:[(0,d.jsx)("div",{className:"inline-flex items-center justify-center p-3 rounded-full bg-white shadow-sm mb-4",children:(0,d.jsx)(n.ScanBarcode,{className:"h-8 w-8 text-sales-primary animate-pulse"})}),(0,d.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Scan to Start"}),(0,d.jsx)("p",{className:"text-sm text-muted-foreground max-w-xs mx-auto",children:"Just start scanning barcodes. Scanned items will appear below."})]}),(0,d.jsx)(N,{rows:ap,onUpdate:al,onRemove:a=>{let b={...aj};delete b[a],ak(b)},isAuditMode:!1,lastScannedId:U})]}),(0,d.jsxs)(j.TabsContent,{value:"audit",className:"space-y-4",children:[ac&&(0,d.jsxs)("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3 flex items-center gap-2 mx-4 md:mx-6 mt-4",children:[(0,d.jsx)(s.Edit,{className:"h-4 w-4 text-amber-600"}),(0,d.jsx)("span",{className:"text-sm font-medium text-amber-900",children:"Editing Mode: Only showing items from this audit session"})]}),(0,d.jsxs)("div",{className:"p-4 border-b flex items-center gap-4 bg-muted/10",children:[(0,d.jsxs)("div",{className:"relative flex-1 max-w-md",children:[(0,d.jsx)(m.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,d.jsx)(g.Input,{placeholder:"Search name or barcode...",className:"pl-10 barcode-friendly",value:Q,onChange:a=>R(a.target.value)})]}),(0,d.jsxs)("div",{className:"text-sm font-medium text-muted-foreground",children:["Showing ",aq.length," of ",o.length," items"]})]}),(0,d.jsx)(N,{rows:aq,onUpdate:al,isAuditMode:!0,lastScannedId:U})]}),(0,d.jsx)(j.TabsContent,{value:"history",className:"m-0 bg-slate-50/50",children:(0,d.jsx)("div",{className:"p-4 md:p-8",children:(0,d.jsx)("div",{className:"max-w-4xl mx-auto space-y-6",children:ah?(0,d.jsxs)("div",{className:"flex flex-col items-center justify-center py-20 gap-4",children:[(0,d.jsx)("div",{className:"w-8 h-8 border-4 border-sales-primary border-t-transparent rounded-full animate-spin"}),(0,d.jsx)("p",{className:"text-sm text-muted-foreground",children:"Loading history..."})]}):0===as.length?(0,d.jsxs)("div",{className:"flex flex-col items-center justify-center py-20 text-center space-y-3 bg-white border-2 border-dashed rounded-3xl",children:[(0,d.jsx)("div",{className:"p-4 rounded-full bg-slate-50",children:(0,d.jsx)(F.History,{className:"h-10 w-10 text-slate-300"})}),(0,d.jsxs)("div",{children:[(0,d.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:"No Audits Found"}),(0,d.jsx)("p",{className:"text-sm text-muted-foreground",children:"Once you complete a stock count, it will appear here."})]})]}):(0,d.jsx)("div",{className:"space-y-4",children:as.map(a=>(0,d.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm border overflow-hidden hover:shadow-md transition-all cursor-pointer group",onClick:()=>Z(Y===a.id?null:a.id),children:[(0,d.jsxs)("div",{className:"p-5 flex items-center justify-between gap-4",children:[(0,d.jsxs)("div",{className:"flex items-center gap-4",children:[(0,d.jsx)("div",{className:"h-12 w-12 rounded-xl bg-sales-primary/10 flex items-center justify-center",children:(0,d.jsx)(G.Clock,{className:"h-6 w-6 text-sales-primary"})}),(0,d.jsx)("div",{className:"flex items-center justify-between",children:(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{className:"font-bold text-gray-900 flex items-center gap-2",children:[a.auditId&&(0,d.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-mono font-bold bg-blue-100 text-blue-700 border border-blue-200",children:a.auditId}),(0,d.jsxs)("span",{children:["Audit #",a.auditNumber," — ",(0,u.format)(a.date,"PPP")]}),a.isEdited&&(0,d.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold bg-amber-100 text-amber-700 border border-amber-200",children:"Edited"})]}),(0,d.jsxs)("div",{className:"text-xs text-muted-foreground flex items-center gap-2",children:[(0,d.jsxs)("span",{className:"font-medium bg-slate-100 px-2 py-0.5 rounded-full",children:[a.items.length," Items"]}),(0,d.jsx)("span",{children:"•"}),(0,d.jsx)("span",{children:(0,u.format)(a.date,"p")})]})]})})]}),(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[(0,d.jsxs)("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity mr-2",children:[(0,d.jsx)(f.Button,{variant:"outline",size:"icon",className:"h-8 w-8 rounded-lg",onClick:b=>{let c;b.stopPropagation(),c=a.items.map(a=>({product:{...a.product,id:a.productId,quantity:a.oldQuantity},actualStock:a.newQuantity,variation:a.newQuantity-a.oldQuantity})),(0,B.exportStockCountToCSV)(c)},title:"Export CSV",children:(0,d.jsx)(D.Download,{className:"h-4 w-4"})}),(0,d.jsx)(f.Button,{variant:"outline",size:"icon",className:"h-8 w-8 rounded-lg",onClick:b=>{let d,e,f,g;b.stopPropagation(),d=a.items.map(a=>({product:{...a.product,id:a.productId,quantity:a.oldQuantity},actualStock:a.newQuantity,variation:a.newQuantity-a.oldQuantity})),f=(e=a.items[0]?.changeReason||"").match(/Auditor: ([^|]*)/),g=e.match(/Contact: ([^|]*)/),(0,B.exportStockCountToPDF)(d,c?.name,{auditNumber:a.auditNumber,auditorName:f?f[1].trim():void 0,contactPerson:g?g[1].trim():void 0,auditId:a.auditId})},title:"Export PDF",children:(0,d.jsx)(E.FileDown,{className:"h-4 w-4"})}),(0,d.jsx)(f.Button,{variant:"outline",size:"icon",className:"h-8 w-8 rounded-lg text-amber-600 hover:bg-amber-50 hover:text-amber-700 border-amber-100",onClick:b=>{let c,d,e,f;b.stopPropagation(),c={},a.items.forEach(a=>{c[a.productId]=a.newQuantity}),e=(d=a.items[0]?.changeReason||"").match(/Auditor: ([^|]*)/),f=d.match(/Contact: ([^|]*)/),ak(c),_(e?e[1].trim():""),ab(f?f[1].trim():""),ad(a.id),T("audit"),x.toast.info(`Editing Audit #${a.auditNumber}`)},title:"Edit Audit",children:(0,d.jsx)(s.Edit,{className:"h-4 w-4"})}),(0,d.jsx)(f.Button,{variant:"outline",size:"icon",className:"h-8 w-8 rounded-lg text-red-500 hover:bg-red-50 hover:text-red-600 border-red-100",onClick:b=>{b.stopPropagation(),af(a)},title:"Delete & Restore Stock",children:(0,d.jsx)(k.Trash2,{className:"h-4 w-4"})})]}),(0,d.jsx)(f.Button,{variant:"ghost",size:"icon",className:(0,A.cn)("rounded-full transition-transform",Y===a.id&&"rotate-90"),children:(0,d.jsx)(H.ChevronRight,{className:"h-5 w-5"})})]})]}),Y===a.id&&(0,d.jsx)("div",{className:"border-t bg-slate-50 p-5 pt-0",children:(0,d.jsx)("div",{className:"overflow-x-auto",children:(0,d.jsxs)(i.Table,{children:[(0,d.jsx)(i.TableHeader,{children:(0,d.jsxs)(i.TableRow,{className:"border-b bg-transparent hover:bg-transparent px-0",children:[(0,d.jsx)(i.TableHead,{className:"h-10 px-0",children:"Product"}),(0,d.jsx)(i.TableHead,{className:"h-10 text-center",children:"System"}),(0,d.jsx)(i.TableHead,{className:"h-10 text-center",children:"Actual"}),(0,d.jsx)(i.TableHead,{className:"h-10 text-right",children:"Var"})]})}),(0,d.jsx)(i.TableBody,{children:a.items.map(a=>(0,d.jsxs)(i.TableRow,{className:"hover:bg-transparent px-0",children:[(0,d.jsxs)(i.TableCell,{className:"px-0 py-3",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("div",{className:"font-medium text-sm",children:a.product?.name||"Deleted Product"}),a.changeReason?.includes("Stock Count Edit")&&(0,d.jsx)("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-[10px] font-bold bg-amber-100 text-amber-700 border border-amber-200",children:"EDITED"})]}),a.referenceId&&"unknown"!==a.referenceId&&(0,d.jsxs)("div",{className:"text-[10px] text-muted-foreground font-mono opacity-50",children:["Session: ",a.referenceId.split("-").pop()]})]}),(0,d.jsx)(i.TableCell,{className:"text-center text-sm py-3",children:a.oldQuantity}),(0,d.jsx)(i.TableCell,{className:"text-center text-sm py-3 font-bold",children:a.newQuantity}),(0,d.jsx)(i.TableCell,{className:"text-right py-3",children:(0,d.jsxs)("span",{className:(0,A.cn)("text-xs font-bold px-2 py-0.5 rounded-full",a.newQuantity>a.oldQuantity?"text-emerald-700 bg-emerald-100":a.newQuantity<a.oldQuantity?"text-rose-700 bg-rose-100":"text-slate-600 bg-slate-100"),children:[a.newQuantity-a.oldQuantity>0?"+":"",a.newQuantity-a.oldQuantity]})})]},a.id))})]})})})]},a.id))})})})})]})})]}),(0,d.jsx)("div",{className:"fixed bottom-6 right-6 pointer-events-none active:opacity-50 transition-opacity",children:(0,d.jsxs)("div",{className:"bg-black/80 text-white px-4 py-3 rounded-2xl shadow-2xl flex items-center gap-3 backdrop-blur-md border border-white/20",children:[(0,d.jsx)("div",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),(0,d.jsx)("span",{className:"text-xs font-bold tracking-widest uppercase",children:"Scanner Active"})]})}),(0,d.jsx)(C.AlertDialog,{open:W,onOpenChange:X,children:(0,d.jsxs)(C.AlertDialogContent,{className:"w-[95vw] sm:max-w-md rounded-xl",children:[(0,d.jsxs)(C.AlertDialogHeader,{children:[(0,d.jsx)(C.AlertDialogTitle,{children:"Complete Stock Audit"}),(0,d.jsxs)(C.AlertDialogDescription,{className:"flex flex-col gap-2",children:[(0,d.jsxs)("span",{children:["You have recorded counts for ",Object.keys(aj).length," items."]}),ac?(0,d.jsxs)("span",{className:"p-2 bg-amber-50 text-amber-800 rounded border border-amber-100 text-xs flex items-center gap-2",children:[(0,d.jsx)(I.Info,{className:"h-4 w-4 shrink-0 text-amber-500"}),"This will replace the previous records for this audit session with your new counts. All changes will be logged."]}):(0,d.jsx)("span",{children:"Fill in the details below to complete this session."})]})]}),(0,d.jsxs)("div",{className:"space-y-4 py-4",children:[(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)("label",{className:"text-xs font-bold text-muted-foreground uppercase",children:"Name"}),(0,d.jsx)(g.Input,{placeholder:"Auditor name...",value:$,onChange:a=>_(a.target.value),className:"h-10"})]}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)("label",{className:"text-xs font-bold text-muted-foreground uppercase",children:"Phone Number"}),(0,d.jsx)(g.Input,{placeholder:"Contact number...",value:aa,onChange:a=>ab(a.target.value),className:"h-10",type:"tel"})]})]}),(0,d.jsxs)("div",{className:"pt-2 border-t",children:[(0,d.jsx)("label",{className:"text-xs font-bold text-muted-foreground uppercase block mb-3",children:"Action"}),(0,d.jsxs)("div",{className:"grid grid-cols-1 gap-3",children:[(0,d.jsxs)(f.Button,{className:"w-full justify-start h-auto py-4 px-6 flex flex-col items-start gap-1 whitespace-normal text-left",onClick:()=>ar(!0),children:[(0,d.jsxs)("span",{className:"font-bold flex items-center gap-2 w-full text-left",children:[(0,d.jsx)(l.Save,{className:"h-4 w-4 shrink-0"}),"Update Inventory Stock"]}),(0,d.jsx)("span",{className:"text-xs font-normal opacity-80 w-full text-left",children:"This will change the quantities in your system to match what you counted."})]}),(0,d.jsxs)(f.Button,{variant:"outline",className:"w-full justify-start h-auto py-4 px-6 flex flex-col items-start gap-1 border-2 whitespace-normal text-left",onClick:()=>ar(!1),children:[(0,d.jsxs)("span",{className:"font-bold flex items-center gap-2 w-full text-left",children:[(0,d.jsx)(q.ClipboardList,{className:"h-4 w-4 shrink-0"}),"Finish Without Updating"]}),(0,d.jsx)("span",{className:"text-xs font-normal text-muted-foreground w-full text-left",children:"Just clear the list and finish. Use this if you already updated manually or just wanted a report."})]})]})]})]}),(0,d.jsx)(C.AlertDialogFooter,{children:(0,d.jsx)(C.AlertDialogCancel,{className:"w-full",children:"Cancel"})})]})}),(0,d.jsx)(C.AlertDialog,{open:!!ae,onOpenChange:a=>!a&&af(null),children:(0,d.jsxs)(C.AlertDialogContent,{className:"w-[95vw] sm:max-w-lg",children:[(0,d.jsxs)(C.AlertDialogHeader,{children:[(0,d.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,d.jsx)("div",{className:"h-12 w-12 rounded-full bg-red-100 flex items-center justify-center",children:(0,d.jsx)(t.AlertTriangle,{className:"h-6 w-6 text-red-600"})}),(0,d.jsxs)("div",{children:[(0,d.jsx)(C.AlertDialogTitle,{className:"text-lg",children:"Delete Audit Session?"}),ae&&(0,d.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:[ae.auditId||`Audit #${ae.auditNumber}`," • ",(0,u.format)(ae.date,"PPP")]})]})]}),(0,d.jsxs)(C.AlertDialogDescription,{className:"space-y-3 pt-2",children:[(0,d.jsxs)("p",{className:"text-base",children:["This action will ",(0,d.jsx)("strong",{children:"permanently delete"})," this audit session and all its records."]}),(0,d.jsx)("div",{className:"p-3 bg-amber-50 border border-amber-200 rounded-lg",children:(0,d.jsx)("p",{className:"text-sm text-amber-900 font-medium",children:"⚠️ Stock levels will be recalculated as if this audit never happened."})}),ae&&(0,d.jsxs)("div",{className:"text-sm text-muted-foreground",children:[(0,d.jsxs)("strong",{children:[ae.items.length," product entries"]})," will be removed from history."]}),(0,d.jsx)("p",{className:"text-sm font-medium text-red-600",children:"This action cannot be undone."})]})]}),(0,d.jsxs)(C.AlertDialogFooter,{className:"gap-2 sm:gap-2",children:[(0,d.jsx)(C.AlertDialogCancel,{className:"flex-1",children:"Cancel"}),(0,d.jsxs)(f.Button,{variant:"destructive",className:"flex-1",onClick:()=>ae&&av(ae),children:[(0,d.jsx)(k.Trash2,{className:"h-4 w-4 mr-2"}),"Delete Audit"]})]})]})})]})}]),c()}catch(a){c(a)}},!1),895881,a=>a.a(async(b,c)=>{try{var d=a.i(127669),e=a.i(108191),f=a.i(942348),g=b([f]);[f]=g.then?(await g)():g;a.s(["useRequisitions",0,(a,b)=>{let[c,g]=(0,d.useState)([]),[h,i]=(0,d.useState)(!0),{toast:j}=(0,e.useToast)(),k=async()=>{if(!a||!b){g([]),i(!1);return}try{i(!0);let c=await (0,f.getRequisitionsAction)(a,b);if(c.success&&c.data)g(c.data.map(a=>({...a,createdAt:new Date(a.createdAt),updatedAt:new Date(a.updatedAt)})));else throw Error(c.error)}catch(a){console.error("Error loading requisitions:",a),j({title:"Error",description:"Failed to load requisitions. Please try again.",variant:"destructive"})}finally{i(!1)}};(0,d.useEffect)(()=>{k()},[a,b]);let l=async(c,d,e)=>{if(!a||!b)return null;try{let h,i,k,l,m,n=(i=(h=new Date).getFullYear().toString().slice(-2),k=(h.getMonth()+1).toString().padStart(2,"0"),l=h.getDate().toString().padStart(2,"0"),m=h.getTime().toString().slice(-4),`REQ${i}${k}${l}${m}`),o=await (0,f.createRequisitionAction)({userId:a,locationId:b,requisitionNumber:n,title:c,items:d,notes:e||null,status:"draft"});if(!o.success||!o.data)throw Error(o.error);let p=o.data,q={...p,createdAt:new Date(p.createdAt),updatedAt:new Date(p.updatedAt)};return g(a=>[q,...a]),j({title:"Requisition created",description:`Requisition ${n} has been created successfully.`}),q}catch(a){return console.error("Error creating requisition:",a),j({title:"Error",description:"Failed to create requisition. Please try again.",variant:"destructive"}),null}},m=async(b,c)=>{if(!a)return!1;try{let d=await (0,f.updateRequisitionAction)(b,a,c);if(!d.success||!d.data)throw Error(d.error);let e=d.data,h={...e,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)};return g(a=>a.map(a=>a.id===b?h:a)),j({title:"Requisition updated",description:"Requisition has been updated successfully."}),!0}catch(a){return console.error("Error updating requisition:",a),j({title:"Error",description:"Failed to update requisition. Please try again.",variant:"destructive"}),!1}},n=async b=>{if(!a)return!1;try{let c=await (0,f.deleteRequisitionAction)(b,a);if(!c.success)throw Error(c.error);return g(a=>a.filter(a=>a.id!==b)),j({title:"Requisition deleted",description:"Requisition has been deleted successfully."}),!0}catch(a){return console.error("Error deleting requisition:",a),j({title:"Error",description:"Failed to delete requisition. Please try again.",variant:"destructive"}),!1}};return{requisitions:c,isLoading:h,loadRequisitions:k,createRequisition:l,updateRequisition:m,deleteRequisition:n}}]),c()}catch(a){c(a)}},!1),302955,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(811705),g=a.i(540629),h=a.i(396465),i=a.i(899054),j=a.i(532572),k=a.i(132660),l=a.i(946032),m=a.i(499239),n=a.i(369773),o=a.i(792071),p=a.i(558277),q=a.i(630227),r=a.i(419068),s=a.i(799856),t=b([f,g,h,i,r,s]);[f,g,h,i,r,s]=t.then?(await t)():t;let u=async(b,c)=>{let d=document.createElement("div");d.style.position="absolute",d.style.left="-9999px",d.style.width="800px",d.style.padding="40px",d.style.backgroundColor="white",d.style.fontFamily="Arial, sans-serif";let e=b.items.filter(a=>a.quantity>0),f=e.reduce((a,b)=>a+b.quantity,0),g=e.filter(a=>a.urgentItem).length;d.innerHTML=`
    <div style="text-align: center; margin-bottom: 40px;">
      <h1 style="color: #2563eb; font-size: 24px; margin: 0;">PURCHASE REQUISITION</h1>
    </div>
    
    <div style="margin-bottom: 30px;">
      <p><strong>Business:</strong> ${c}</p>
      <p><strong>Date:</strong> ${(0,o.format)(b.createdAt,"PPP")}</p>
      <p><strong>Requisition #:</strong> ${b.requisitionNumber}</p>
      <p><strong>Title:</strong> ${b.title}</p>
      <p><strong>Status:</strong> ${b.status.toUpperCase()}</p>
    </div>
    
    ${e.length>0?`
      <table style="width: 100%; border-collapse: collapse; margin-bottom: 30px;">
        <thead>
          <tr style="background-color: #2563eb; color: white;">
            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">#</th>
            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Item Description</th>
            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Quantity</th>
            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Urgent</th>
            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Supplier/Price</th>
          </tr>
        </thead>
        <tbody>
          ${e.map((a,b)=>`
            <tr style="${a.urgentItem?"background-color: #fef3c7;":""}">
              <td style="border: 1px solid #ddd; padding: 8px;">${b+1}</td>
              <td style="border: 1px solid #ddd; padding: 8px;">${a.productName}</td>
              <td style="border: 1px solid #ddd; padding: 8px;">${Math.round(a.quantity).toLocaleString()}</td>
              <td style="border: 1px solid #ddd; padding: 8px;">${a.urgentItem?"Yes":"No"}</td>
              <td style="border: 1px solid #ddd; padding: 8px;"></td>
            </tr>
          `).join("")}
        </tbody>
      </table>
      
      <div style="margin-bottom: 30px; padding: 15px; background-color: #f8fafc; border-radius: 8px;">
        <h3 style="margin: 0 0 10px 0; color: #1e40af;">SUMMARY</h3>
        <p><strong>Total Items:</strong> ${e.length}</p>
        <p><strong>Total Quantity:</strong> ${f.toLocaleString()}</p>
        <p><strong>Urgent Items:</strong> ${g}</p>
      </div>
    `:`
      <p>No items in this requisition.</p>
    `}
    
    ${b.notes?`
      <div style="margin-bottom: 30px;">
        <h3 style="color: #1e40af;">NOTES</h3>
        <p style="padding: 10px; background-color: #f1f5f9; border-radius: 4px;">${b.notes}</p>
      </div>
    `:""}
    
    <div style="margin-top: 60px;">
      <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
        <div>
          <p>Requested by: _____________________</p>
          <p>Date: _____________</p>
        </div>
        <div>
          <p>Approved by: _____________________</p>
          <p>Date: _____________</p>
        </div>
      </div>
    </div>
  `,document.body.appendChild(d);try{let{generateVectorPDF:c}=await a.A(611602);await c(d,{filename:`Requisition_${b.requisitionNumber}.pdf`,orientation:"portrait",format:"a4",margins:{top:10,right:10,bottom:10,left:10}})}finally{document.body.removeChild(d)}};a.s(["default",0,({requisitions:a,isLoading:b,onRefresh:c,onDelete:t,businessName:v="Your Business Name"})=>{let w=(0,p.useIsMobile)(),[x,y]=(0,e.useState)(null),{currentPage:z,setCurrentPage:A,paginatedItems:B,totalPages:C}=(0,q.usePagination)({items:a,itemsPerPage:10}),D=a=>{switch(a){case"draft":default:return"bg-gray-100 text-gray-800";case"submitted":return"bg-blue-100 text-blue-800";case"approved":return"bg-green-100 text-green-800";case"completed":return"bg-purple-100 text-purple-800"}},E=a=>Math.round(a).toLocaleString(),F=async a=>{try{console.log("Starting PDF generation for requisition:",a.requisitionNumber),await u(a,v),console.log("PDF generated successfully using alternative method")}catch(a){console.error("PDF generation failed:",a),console.error("Error message:",a.message),console.error("Error stack:",a.stack),alert(`Failed to generate PDF: ${a.message||"Unknown error occurred"}`)}},G=({requisition:a})=>{let b=a.items.reduce((a,b)=>a+b.quantity,0),c=a.items.filter(a=>a.urgentItem).length;return(0,d.jsxs)(f.Card,{className:"mb-4",children:[(0,d.jsx)(f.CardHeader,{className:"pb-3",children:(0,d.jsxs)("div",{className:"flex items-start justify-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)(f.CardTitle,{className:"text-sm font-medium",children:a.title}),(0,d.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[a.requisitionNumber," • ",(0,o.format)(a.createdAt,"MMM d, yyyy")]})]}),(0,d.jsx)(i.Badge,{className:(0,s.cn)("text-xs",D(a.status)),children:a.status})]})}),(0,d.jsxs)(f.CardContent,{className:"pt-0",children:[(0,d.jsxs)("div",{className:"space-y-2 text-xs",children:[(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-muted-foreground",children:"Items:"}),(0,d.jsx)("span",{children:a.items.length})]}),(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-muted-foreground",children:"Total Qty:"}),(0,d.jsx)("span",{children:E(b)})]}),c>0&&(0,d.jsxs)("div",{className:"flex justify-between text-orange-600",children:[(0,d.jsxs)("span",{className:"flex items-center gap-1",children:[(0,d.jsx)(n.AlertTriangle,{size:12}),"Urgent:"]}),(0,d.jsx)("span",{children:c})]})]}),(0,d.jsxs)("div",{className:"flex gap-2 mt-4",children:[(0,d.jsxs)(h.Button,{variant:"outline",size:"sm",onClick:()=>y(a),className:"flex-1",children:[(0,d.jsx)(k.Eye,{size:14,className:"mr-1"}),"View"]}),(0,d.jsxs)(h.Button,{variant:"outline",size:"sm",onClick:()=>F(a),className:"flex-1",children:[(0,d.jsx)(j.Download,{size:14,className:"mr-1"}),"PDF"]}),(0,d.jsx)(h.Button,{variant:"outline",size:"sm",onClick:()=>t(a.id),className:"px-2",children:(0,d.jsx)(l.Trash2,{size:14})})]})]})]})};return b?(0,d.jsx)(f.Card,{children:(0,d.jsx)(f.CardContent,{className:"p-6",children:(0,d.jsxs)("div",{className:"text-center py-8",children:[(0,d.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),(0,d.jsx)("p",{className:"mt-2 text-muted-foreground",children:"Loading requisitions..."})]})})}):0===a.length?(0,d.jsx)(f.Card,{children:(0,d.jsx)(f.CardContent,{className:"p-6",children:(0,d.jsxs)("div",{className:"text-center py-8",children:[(0,d.jsx)(m.Package,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,d.jsx)("h3",{className:"text-lg font-medium mb-2",children:"No requisitions yet"}),(0,d.jsx)("p",{className:"text-muted-foreground",children:"Create your first requisition to see it appear here."})]})})}):(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)(f.Card,{children:[(0,d.jsx)(f.CardHeader,{children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)(f.CardTitle,{children:["Saved Requisitions (",a.length,")"]}),(0,d.jsx)(h.Button,{variant:"outline",size:"sm",onClick:c,children:"Refresh"})]})}),(0,d.jsxs)(f.CardContent,{children:[w?(0,d.jsx)("div",{className:"space-y-4",children:B.map(a=>(0,d.jsx)(G,{requisition:a},a.id))}):(0,d.jsx)("div",{className:"overflow-x-auto",children:(0,d.jsxs)(g.Table,{children:[(0,d.jsx)(g.TableHeader,{children:(0,d.jsxs)(g.TableRow,{children:[(0,d.jsx)(g.TableHead,{children:"Title"}),(0,d.jsx)(g.TableHead,{children:"Number"}),(0,d.jsx)(g.TableHead,{children:"Date"}),(0,d.jsx)(g.TableHead,{children:"Items"}),(0,d.jsx)(g.TableHead,{children:"Total Qty"}),(0,d.jsx)(g.TableHead,{children:"Status"}),(0,d.jsx)(g.TableHead,{children:"Actions"})]})}),(0,d.jsx)(g.TableBody,{children:B.map(a=>{let b=a.items.reduce((a,b)=>a+b.quantity,0),c=a.items.filter(a=>a.urgentItem).length;return(0,d.jsxs)(g.TableRow,{children:[(0,d.jsx)(g.TableCell,{children:(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"font-medium",children:a.title}),c>0&&(0,d.jsxs)("div",{className:"flex items-center gap-1 text-orange-600 text-xs mt-1",children:[(0,d.jsx)(n.AlertTriangle,{size:10}),c," urgent"]})]})}),(0,d.jsx)(g.TableCell,{className:"font-mono text-sm",children:a.requisitionNumber}),(0,d.jsx)(g.TableCell,{children:(0,o.format)(a.createdAt,"MMM d, yyyy")}),(0,d.jsx)(g.TableCell,{children:a.items.length}),(0,d.jsx)(g.TableCell,{children:E(b)}),(0,d.jsx)(g.TableCell,{children:(0,d.jsx)(i.Badge,{className:(0,s.cn)("text-xs",D(a.status)),children:a.status})}),(0,d.jsx)(g.TableCell,{children:(0,d.jsxs)("div",{className:"flex gap-1",children:[(0,d.jsx)(h.Button,{variant:"outline",size:"sm",onClick:()=>y(a),children:(0,d.jsx)(k.Eye,{size:14})}),(0,d.jsx)(h.Button,{variant:"outline",size:"sm",onClick:()=>F(a),children:(0,d.jsx)(j.Download,{size:14})}),(0,d.jsx)(h.Button,{variant:"outline",size:"sm",onClick:()=>t(a.id),children:(0,d.jsx)(l.Trash2,{size:14})})]})})]},a.id)})})]})}),C>1&&(0,d.jsx)("div",{className:"mt-4",children:(0,d.jsx)(r.Pagination,{children:(0,d.jsxs)(r.PaginationContent,{children:[(0,d.jsx)(r.PaginationItem,{children:(0,d.jsx)(r.PaginationPrevious,{onClick:()=>A(Math.max(1,z-1)),className:1===z?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:C},(a,b)=>b+1).map(a=>(0,d.jsx)(r.PaginationItem,{children:(0,d.jsx)(r.PaginationLink,{onClick:()=>A(a),isActive:z===a,className:"cursor-pointer",children:a})},a)),(0,d.jsx)(r.PaginationItem,{children:(0,d.jsx)(r.PaginationNext,{onClick:()=>A(Math.min(C,z+1)),className:z===C?"pointer-events-none opacity-50":"cursor-pointer"})})]})})})]})]}),x&&(0,d.jsxs)(f.Card,{className:"fixed inset-4 z-50 overflow-auto bg-background border shadow-lg",children:[(0,d.jsx)(f.CardHeader,{children:(0,d.jsxs)("div",{className:"flex items-start justify-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)(f.CardTitle,{children:x.title}),(0,d.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:[x.requisitionNumber," • ",(0,o.format)(x.createdAt,"PPP")]})]}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)(i.Badge,{className:(0,s.cn)("text-xs",D(x.status)),children:x.status}),(0,d.jsx)(h.Button,{variant:"outline",size:"sm",onClick:()=>y(null),children:"Close"})]})]})}),(0,d.jsx)(f.CardContent,{children:(0,d.jsxs)("div",{className:"space-y-4",children:[x.notes&&(0,d.jsxs)("div",{children:[(0,d.jsx)("h4",{className:"font-medium mb-2",children:"Notes:"}),(0,d.jsx)("p",{className:"text-sm text-muted-foreground",children:x.notes})]}),(0,d.jsxs)("div",{children:[(0,d.jsxs)("h4",{className:"font-medium mb-2",children:["Items (",x.items.length,"):"]}),(0,d.jsx)("div",{className:"overflow-x-auto",children:(0,d.jsxs)(g.Table,{children:[(0,d.jsx)(g.TableHeader,{children:(0,d.jsxs)(g.TableRow,{children:[(0,d.jsx)(g.TableHead,{children:"Item"}),(0,d.jsx)(g.TableHead,{children:"Quantity"}),(0,d.jsx)(g.TableHead,{children:"Urgent"})]})}),(0,d.jsx)(g.TableBody,{children:x.items.map((a,b)=>(0,d.jsxs)(g.TableRow,{className:a.urgentItem?"bg-orange-50":"",children:[(0,d.jsx)(g.TableCell,{children:a.productName}),(0,d.jsx)(g.TableCell,{children:E(a.quantity)}),(0,d.jsx)(g.TableCell,{children:a.urgentItem&&(0,d.jsxs)(i.Badge,{variant:"destructive",className:"text-xs",children:[(0,d.jsx)(n.AlertTriangle,{size:10,className:"mr-1"}),"Urgent"]})})]},b))})]})})]})]})})]})]})}]),c()}catch(a){c(a)}},!1),526525,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(396465),g=a.i(112779),h=a.i(330281),i=a.i(811705),j=a.i(540629),k=a.i(899054),l=a.i(493901),m=a.i(946032),n=a.i(532572),o=a.i(493572),p=a.i(93538),q=a.i(369773),r=a.i(566571),s=a.i(643228),t=a.i(531811),u=a.i(482331),v=a.i(108191),w=a.i(224993),x=a.i(558277),y=a.i(964889),z=a.i(468103),A=a.i(840238),B=a.i(792071),C=a.i(799856),D=a.i(895881),E=a.i(302955),F=a.i(959866),G=a.i(647952),H=b([f,g,h,i,j,k,t,u,w,y,z,C,D,E,G]);[f,g,h,i,j,k,t,u,w,y,z,C,D,E,G]=H.then?(await H)():H;let I=({row:a,index:b,onUpdateRow:c,onRemoveRow:e,onProductSelect:h,onInputFocus:j,onAddRowAfter:n,onKeyDown:r,onMoveRow:s,canRemove:t,isLastRow:u,totalRows:v})=>(0,d.jsxs)(i.Card,{className:(0,C.cn)("mb-4 shadow-sm",a.urgentItem&&"border-destructive"),children:[(0,d.jsx)(i.CardHeader,{className:"pb-3",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsxs)(i.CardTitle,{className:"text-sm font-medium",children:["Item #",b+1]}),a.urgentItem&&(0,d.jsxs)(k.Badge,{variant:"destructive",className:"text-xs",children:[(0,d.jsx)(q.AlertTriangle,{size:10,className:"mr-1"}),"Urgent"]})]}),(0,d.jsxs)("div",{className:"flex gap-2",children:[(0,d.jsx)(f.Button,{variant:"outline",size:"icon",onClick:()=>s(a.id,"up"),disabled:0===b,className:"h-8 w-8",children:(0,d.jsx)(o.ChevronUp,{size:14})}),(0,d.jsx)(f.Button,{variant:"outline",size:"icon",onClick:()=>s(a.id,"down"),disabled:b===v-1,className:"h-8 w-8",children:(0,d.jsx)(p.ChevronDown,{size:14})}),(0,d.jsx)(f.Button,{variant:"outline",size:"icon",onClick:()=>e(a.id),disabled:!t,className:"h-8 w-8",children:(0,d.jsx)(m.Trash2,{size:14})})]})]})}),(0,d.jsxs)(i.CardContent,{className:"space-y-4",children:[(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsx)("label",{className:"text-xs font-medium text-muted-foreground mb-1 block",children:"Product"}),(0,d.jsx)(g.Input,{placeholder:"Type to search products...",value:a.searchTerm,onChange:b=>c(a.id,"searchTerm",b.target.value),onFocus:()=>j(a.id),onKeyDown:b=>r(b,a.id),className:"w-full"})]}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-xs font-medium text-muted-foreground mb-1 block",children:"Quantity"}),(0,d.jsx)(g.Input,{type:"number",min:"0",step:"1",value:a.quantity||"",onChange:b=>c(a.id,"quantity",parseInt(b.target.value)||0),onKeyDown:b=>r(b,a.id),placeholder:"0"})]}),(0,d.jsx)("div",{className:"flex items-end",children:(0,d.jsxs)("label",{className:"flex items-center gap-2 text-xs font-medium cursor-pointer",children:[(0,d.jsx)("input",{type:"checkbox",checked:a.urgentItem||!1,onChange:b=>c(a.id,"urgentItem",b.target.checked),className:"rounded"}),"Mark as urgent"]})})]}),u&&(0,d.jsx)("div",{className:"flex justify-center pt-2",children:(0,d.jsxs)(f.Button,{variant:"ghost",size:"sm",onClick:()=>n(a.id),className:"gap-2 text-muted-foreground hover:text-foreground",children:[(0,d.jsx)(l.Plus,{size:14}),"Add row below"]})})]})]});a.s(["default",0,()=>{let{user:a}=(0,t.useAuth)(),{products:b}=(0,u.useProducts)(a?.id,1e4),{settings:c}=(0,w.useBusinessSettings)(),{currentBusiness:k}=(0,y.useBusiness)(),{toast:C}=(0,v.useToast)(),G=(0,x.useIsMobile)(),[H,J]=(0,e.useState)([{id:"1",productId:"",productName:"",quantity:0,searchTerm:"",urgentItem:!1}]),[K,L]=(0,e.useState)(""),[M,N]=(0,e.useState)(""),[O,P]=(0,e.useState)(null),[Q,R]=(0,e.useState)(!1),S=H.find(a=>a.id===O),{suggestions:T,isOpen:U,closePanel:V}=(0,A.useProductSuggestions)(b,S?.searchTerm||""),W=b.filter(a=>a.quantity<=a.minimumStock),[X,Y]=(0,e.useState)(!1),[Z,$]=(0,e.useState)(1),_=W.slice((Z-1)*15,15*Z),aa=Math.ceil(W.length/15),{requisitions:ab,isLoading:ac,loadRequisitions:ad,createRequisition:ae,deleteRequisition:af}=(0,D.useRequisitions)(a?.id,k?.id),ag=a=>Math.round(a).toLocaleString(),ah=H.reduce((a,c)=>{if(!c.productId||!c.quantity)return a;let d=b.find(a=>a.id===c.productId);return d?a+d.costPrice*c.quantity:a},0),ai=(0,e.useCallback)(()=>{let a={id:Date.now().toString(),productId:"",productName:"",quantity:0,searchTerm:"",urgentItem:!1};J(b=>[...b,a])},[]),aj=(0,e.useCallback)(a=>{let b={id:Date.now().toString(),productId:"",productName:"",quantity:0,searchTerm:"",urgentItem:!1};J(c=>{let d=c.findIndex(b=>b.id===a),e=[...c];return e.splice(d+1,0,b),e})},[]),ak=(0,e.useCallback)((a,b)=>{J(c=>{let d=c.findIndex(b=>b.id===a);if(-1===d)return c;let e="up"===b?d-1:d+1;if(e<0||e>=c.length)return c;let f=[...c];return[f[d],f[e]]=[f[e],f[d]],f})},[]),al=(0,e.useCallback)((a,b)=>{"Enter"!==a.key||a.shiftKey||(a.preventDefault(),aj(b))},[aj]),am=(0,e.useCallback)(a=>{H.length>1&&(J(b=>b.filter(b=>b.id!==a)),O===a&&P(null))},[H.length,O]),an=(0,e.useCallback)((a,c,d)=>{J(e=>e.map(e=>{if(e.id===a){let a={...e,[c]:d};return"searchTerm"===c&&"string"==typeof d&&(b.find(a=>a.name.toLowerCase()===d.toLowerCase())||(a.productId="",a.productName="")),a}return e}))},[b]),ao=(0,e.useCallback)(a=>{O&&(J(b=>b.map(b=>b.id===O?{...b,productId:a.id,productName:a.name,searchTerm:a.name}:b)),P(null))},[O]),ap=(0,e.useCallback)(a=>{P(a)},[]),aq=(0,e.useCallback)(a=>{if(H.find(b=>b.productId===a.id))return void C({title:"Item already added",description:`${a.name} is already in the requisition list.`,variant:"destructive"});let b={id:Date.now().toString(),productId:a.id,productName:a.name,quantity:Math.max(1,a.minimumStock-a.quantity),searchTerm:a.name,urgentItem:0===a.quantity};J(a=>[...a,b])},[H,C]),ar=()=>{let a=new Date,b=a.getFullYear().toString().slice(-2),c=(a.getMonth()+1).toString().padStart(2,"0"),d=a.getDate().toString().padStart(2,"0"),e=a.getTime().toString().slice(-4);return`REQ${b}${c}${d}${e}`},as=(0,e.useCallback)(()=>{let a=new F.default,d=a.internal.pageSize.width;a.setFontSize(20),a.setFont("helvetica","bold"),a.text("PURCHASE REQUISITION",d/2,20,{align:"center"}),a.setFontSize(12),a.setFont("helvetica","normal"),a.text(`Business: ${c.businessName||"Your Business Name"}`,20,40),a.text(`Date: ${(0,B.format)(new Date,"PPP")}`,20,50),a.text(`Requisition #: ${ar()}`,20,60),K&&a.text(`Title: ${K}`,20,70);let e=H.filter(a=>a.productId&&a.quantity>0);if(0===e.length)a.text("No items to requisition.",20,90);else{let d=e.map((a,d)=>{let e=b.find(b=>b.id===a.productId),f=e?e.costPrice*a.quantity:0;return[d+1,a.productName,ag(a.quantity),e?`${c.currency} ${ag(e.costPrice)}`:"-",`${c.currency} ${ag(f)}`,a.urgentItem?"Yes":"No"]});a.autoTable({head:[["#","Item Description","Qty","Unit Cost","Amount","Urgent"]],body:d,startY:K?80:70,theme:"grid",styles:{fontSize:10,cellPadding:3},headStyles:{fillColor:[41,128,185],textColor:255},columnStyles:{0:{cellWidth:15},1:{cellWidth:60},2:{cellWidth:20},3:{cellWidth:30},4:{cellWidth:30},5:{cellWidth:20}}});let f=e.reduce((a,b)=>a+b.quantity,0),g=e.filter(a=>a.urgentItem).length,h=a.lastAutoTable.finalY+20;a.setFont("helvetica","bold"),a.text("SUMMARY:",20,h),a.setFont("helvetica","normal"),a.text(`Total Items: ${e.length}`,20,h+10),a.text(`Total Quantity: ${ag(f)}`,20,h+20),a.text(`Total Amount: ${c.currency} ${ag(ah)}`,20,h+30),a.text(`Urgent Items: ${g}`,20,h+40)}if(M){let b=e.length>0?a.lastAutoTable.finalY+70:110;b>250&&(a.addPage(),b=30),a.setFont("helvetica","bold"),a.text("NOTES:",20,b),a.setFont("helvetica","normal");let c=a.splitTextToSize(M,d-40);a.text(c,20,b+10)}let f=a.internal.pageSize.height-30;a.setFontSize(10),a.text("Requested by: _____________________",20,f),a.text("Date: _____________",120,f),a.text("Approved by: _____________________",20,f+10),a.text("Date: _____________",120,f+10);let g=`Requisition_${ar()}.pdf`;return a.save(g),g},[H,K,M,c.businessName,b,c.currency,ah]),at=(0,e.useCallback)(async()=>{if(!a||!k)return;let b=H.filter(a=>a.productId&&a.quantity>0);if(0===b.length)return void C({title:"No items to save",description:"Please add at least one item with a quantity greater than 0.",variant:"destructive"});if(!K.trim())return void C({title:"Title required",description:"Please enter a title for this requisition.",variant:"destructive"});R(!0);try{let a=b.map(a=>({id:a.id,productId:a.productId,productName:a.productName,quantity:a.quantity,urgentItem:a.urgentItem||!1}));await ae(K,a,M),J([{id:Date.now().toString(),productId:"",productName:"",quantity:0,searchTerm:"",urgentItem:!1}]),L(""),N("")}catch(a){console.error("Error saving requisition:",a),C({title:"Error",description:"Failed to save requisition. Please try again.",variant:"destructive"})}finally{R(!1)}},[a,k,H,K,M,C,ae]),au=(0,e.useCallback)(()=>{let a=H.filter(a=>a.productId&&a.quantity>0);if(0===a.length)return void C({title:"No items to download",description:"Please add at least one item with a quantity greater than 0.",variant:"destructive"});let b=as();C({title:"PDF downloaded",description:`Requisition has been downloaded as ${b}.`})},[H,as,C]),av=H.reduce((a,b)=>a+b.quantity,0);return(0,d.jsxs)("div",{className:"space-y-4 md:space-y-6",children:[W.length>0&&(0,d.jsxs)(i.Card,{className:"border-orange-200 bg-orange-50",children:[(0,d.jsx)(i.CardHeader,{className:"pb-3",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)(i.CardTitle,{className:"text-orange-800 flex items-center gap-2",children:[(0,d.jsx)(q.AlertTriangle,{size:20}),"Low Stock Items (",W.length,")"]}),!X&&W.length>15&&(0,d.jsx)(f.Button,{variant:"ghost",size:"sm",onClick:()=>Y(!0),className:"text-orange-700 hover:text-orange-800",children:"View All"})]})}),(0,d.jsxs)(i.CardContent,{children:[(0,d.jsx)("p",{className:"text-sm text-orange-700 mb-3",children:"The following items are running low or out of stock. Click to add them to your requisition:"}),(0,d.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(X?_:W.slice(0,5)).map(a=>(0,d.jsxs)(f.Button,{variant:"outline",size:"sm",onClick:()=>aq(a),className:"text-xs border-orange-300 hover:bg-orange-100",children:[a.name," (",a.quantity,"/",a.minimumStock,")"]},a.id)),!X&&W.length>5&&(0,d.jsxs)("span",{className:"text-xs text-orange-600 self-center",children:["+",W.length-5," more items"]})]}),X&&(0,d.jsxs)("div",{className:"mt-4 flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsxs)(f.Button,{variant:"outline",size:"sm",onClick:()=>$(a=>Math.max(1,a-1)),disabled:1===Z,children:[(0,d.jsx)(r.ChevronLeft,{size:14}),"Previous"]}),(0,d.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Page ",Z," of ",aa]}),(0,d.jsxs)(f.Button,{variant:"outline",size:"sm",onClick:()=>$(a=>Math.min(aa,a+1)),disabled:Z===aa,children:["Next",(0,d.jsx)(s.ChevronRight,{size:14})]})]}),(0,d.jsx)(f.Button,{variant:"ghost",size:"sm",onClick:()=>{Y(!1),$(1)},className:"text-orange-700 hover:text-orange-800",children:"Show Less"})]})]})]}),(0,d.jsxs)(i.Card,{className:"shadow-sm",children:[(0,d.jsx)(i.CardHeader,{className:"pb-3 md:pb-6",children:(0,d.jsxs)("div",{className:"space-y-3 md:space-y-0 md:flex md:items-start md:justify-between",children:[(0,d.jsxs)("div",{className:"space-y-3 flex-1",children:[(0,d.jsx)(i.CardTitle,{className:"text-base md:text-lg",children:"Purchase Requisition"}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-sm font-medium text-muted-foreground mb-1 block",children:"Requisition Title *"}),(0,d.jsx)(g.Input,{placeholder:"Enter requisition title",value:K,onChange:a=>L(a.target.value),className:"w-full"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"text-sm font-medium text-muted-foreground mb-1 block",children:"Notes"}),(0,d.jsx)(h.Textarea,{placeholder:"Additional notes or requirements",value:M,onChange:a=>N(a.target.value),className:"w-full min-h-[60px]"})]})]})]}),(0,d.jsxs)("div",{className:"flex gap-2",children:[(0,d.jsxs)(f.Button,{onClick:ai,variant:"outline",className:"gap-2 flex-1 md:flex-none",children:[(0,d.jsx)(l.Plus,{size:16})," Add Item"]}),(0,d.jsx)(f.Button,{onClick:at,disabled:Q,variant:"secondary",className:"gap-2 flex-1 md:flex-none",children:"Save"}),(0,d.jsxs)(f.Button,{onClick:au,className:"gap-2 flex-1 md:flex-none",children:[(0,d.jsx)(n.Download,{size:16})," PDF"]})]})]})}),(0,d.jsxs)(i.CardContent,{className:"p-0 md:p-6",children:[G?(0,d.jsxs)("div",{className:"p-4 space-y-4",children:[H.map((a,b)=>(0,d.jsx)(I,{row:a,index:b,onUpdateRow:an,onRemoveRow:am,onProductSelect:ao,onInputFocus:ap,onAddRowAfter:aj,onKeyDown:al,onMoveRow:ak,canRemove:H.length>1,isLastRow:b===H.length-1,totalRows:H.length},a.id)),(0,d.jsx)(i.Card,{className:"bg-primary/5 border-primary/20",children:(0,d.jsx)(i.CardContent,{className:"p-4",children:(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center",children:[(0,d.jsx)("span",{className:"font-medium",children:"Total Quantity:"}),(0,d.jsx)("span",{className:"text-lg font-bold text-primary",children:ag(av)})]}),(0,d.jsxs)("div",{className:"flex justify-between items-center",children:[(0,d.jsx)("span",{className:"font-medium",children:"Total Amount:"}),(0,d.jsxs)("span",{className:"text-lg font-bold text-primary",children:[c.currency," ",ag(ah)]})]})]})})})]}):(0,d.jsx)("div",{className:"overflow-x-auto",children:(0,d.jsxs)(j.Table,{children:[(0,d.jsx)(j.TableHeader,{children:(0,d.jsxs)(j.TableRow,{children:[(0,d.jsx)(j.TableHead,{className:"w-[250px]",children:"Item"}),(0,d.jsx)(j.TableHead,{className:"w-[80px]",children:"Qty"}),(0,d.jsx)(j.TableHead,{className:"w-[100px]",children:"Unit Cost"}),(0,d.jsx)(j.TableHead,{className:"w-[100px]",children:"Amount"}),(0,d.jsx)(j.TableHead,{className:"w-[80px]",children:"Urgent"}),(0,d.jsx)(j.TableHead,{className:"w-[140px]",children:"Actions"})]})}),(0,d.jsxs)(j.TableBody,{children:[H.map((a,e)=>{let h=b.find(b=>b.id===a.productId),i=h&&a.quantity?h.costPrice*a.quantity:0;return(0,d.jsxs)(j.TableRow,{className:a.urgentItem?"bg-destructive/5":"",children:[(0,d.jsx)(j.TableCell,{children:(0,d.jsx)("div",{className:"relative",children:(0,d.jsx)(g.Input,{placeholder:"Type to search products...",value:a.searchTerm,onChange:b=>an(a.id,"searchTerm",b.target.value),onFocus:()=>ap(a.id),onKeyDown:b=>al(b,a.id),className:"w-full"})})}),(0,d.jsx)(j.TableCell,{children:(0,d.jsx)(g.Input,{type:"number",min:"0",step:"1",value:a.quantity||"",onChange:b=>an(a.id,"quantity",parseInt(b.target.value)||0),onKeyDown:b=>al(b,a.id),placeholder:"0"})}),(0,d.jsx)(j.TableCell,{className:"text-sm",children:h?`${c.currency} ${ag(h.costPrice)}`:"-"}),(0,d.jsx)(j.TableCell,{className:"text-sm font-medium",children:i>0?`${c.currency} ${ag(i)}`:"-"}),(0,d.jsx)(j.TableCell,{children:(0,d.jsx)("input",{type:"checkbox",checked:a.urgentItem||!1,onChange:b=>an(a.id,"urgentItem",b.target.checked),className:"rounded"})}),(0,d.jsx)(j.TableCell,{children:(0,d.jsxs)("div",{className:"flex gap-1",children:[(0,d.jsx)(f.Button,{variant:"outline",size:"icon",onClick:()=>ak(a.id,"up"),disabled:0===e,className:"h-8 w-8",children:(0,d.jsx)(o.ChevronUp,{size:14})}),(0,d.jsx)(f.Button,{variant:"outline",size:"icon",onClick:()=>ak(a.id,"down"),disabled:e===H.length-1,className:"h-8 w-8",children:(0,d.jsx)(p.ChevronDown,{size:14})}),(0,d.jsx)(f.Button,{variant:"outline",size:"icon",onClick:()=>am(a.id),disabled:1===H.length,className:"h-8 w-8",children:(0,d.jsx)(m.Trash2,{size:14})})]})})]},a.id)}),(0,d.jsx)(j.TableRow,{className:"border-none",children:(0,d.jsx)(j.TableCell,{colSpan:6,className:"py-1 text-center",children:(0,d.jsxs)(f.Button,{variant:"ghost",size:"sm",onClick:()=>aj(H[H.length-1].id),className:"gap-2 text-muted-foreground hover:text-foreground text-xs",children:[(0,d.jsx)(l.Plus,{size:12}),"Add row below"]})})}),(0,d.jsxs)(j.TableRow,{className:"border-t-2",children:[(0,d.jsx)(j.TableCell,{className:"text-right font-medium",children:"Totals:"}),(0,d.jsx)(j.TableCell,{className:"font-bold text-lg",children:ag(av)}),(0,d.jsx)(j.TableCell,{}),(0,d.jsxs)(j.TableCell,{className:"font-bold text-lg",children:[c.currency," ",ag(ah)]}),(0,d.jsx)(j.TableCell,{colSpan:2})]})]})]})}),0===H.length&&(0,d.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:'No items added. Click "Add Item" to start creating your requisition.'})]})]}),(0,d.jsx)(z.default,{suggestions:T,isOpen:U,onClose:V,onSelectProduct:ao,searchTerm:S?.searchTerm||""}),(0,d.jsx)(E.default,{requisitions:ab,isLoading:ac,onRefresh:ad,onDelete:af,businessName:c.businessName})]})}]),c()}catch(a){c(a)}},!1),817921,a=>{"use strict";let b=(0,a.i(564375).default)("ListFilter",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M7 12h10",key:"b7w52i"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);a.s(["ListFilter",()=>b],817921)},878422,a=>{"use strict";let b=(0,a.i(564375).default)("Truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]]);a.s(["Truck",()=>b],878422)},828268,a=>{"use strict";let b=(0,a.i(564375).default)("FileUp",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 12v6",key:"3ahymv"}],["path",{d:"m15 15-3-3-3 3",key:"15xj92"}]]);a.s(["FileUp",()=>b],828268)},766150,a=>{"use strict";let b=(0,a.i(564375).default)("Scale",[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]]);a.s(["Scale",()=>b],766150)},767823,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(747899),f=a.i(396465),g=a.i(493901),h=a.i(506766),i=a.i(817921),j=a.i(878422),k=a.i(637610),l=a.i(828268),m=a.i(766150),n=a.i(558277),o=a.i(805297),p=b([f,o]);[f,o]=p.then?(await p)():p,a.s(["default",0,({isLoading:a,onRefresh:b,onDownloadTemplate:c,onCSVUpload:p})=>{let q=(0,e.useNavigate)(),r=(0,n.useIsMobile)(),{hasPermission:s}=(0,o.useProfiles)();return(0,d.jsx)("div",{className:"space-y-4",children:(0,d.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,d.jsxs)("div",{className:"space-y-1",children:[(0,d.jsx)("div",{className:"flex items-center gap-2",children:(0,d.jsx)("h1",{className:"text-xl md:text-2xl lg:text-3xl font-bold text-sales-dark",children:"Inventory Overview"})}),(0,d.jsx)("p",{className:"text-sm md:text-base text-muted-foreground",children:"Monitor your inventory health and analyze sales performance"})]}),r?(0,d.jsxs)("div",{className:"space-y-3",children:[(0,d.jsxs)("div",{className:"flex gap-2",children:[s("inventory","create")&&(0,d.jsxs)(f.Button,{onClick:()=>q("/inventory/new"),className:"flex-1 gap-2 min-h-[44px]",children:[(0,d.jsx)(g.Plus,{size:16})," Add Product"]}),(0,d.jsx)(f.Button,{onClick:b,variant:"outline",size:"icon",disabled:a,className:"shrink-0 min-h-[44px] min-w-[44px]",children:(0,d.jsx)(h.RefreshCw,{className:`h-4 w-4 ${a?"animate-spin":""}`})})]}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,d.jsxs)(f.Button,{onClick:()=>q("/products"),variant:"outline",className:"gap-1 text-xs min-h-[40px]",children:[(0,d.jsx)(i.ListFilter,{size:14})," Products"]}),s("inventory","view")&&(0,d.jsxs)(f.Button,{onClick:()=>q("/inventory/carriage-inwards"),variant:"outline",className:"gap-1 text-xs min-h-[40px]",children:[(0,d.jsx)(j.Truck,{size:14})," Carriage"]})]}),s("inventory","create")&&(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,d.jsxs)(f.Button,{onClick:c,variant:"outline",className:"gap-1 text-xs min-h-[40px]",children:[(0,d.jsx)(k.FileDown,{size:14})," Template"]}),(0,d.jsxs)(f.Button,{onClick:p,variant:"outline",className:"gap-1 text-xs min-h-[40px]",children:[(0,d.jsx)(l.FileUp,{size:14})," Upload"]})]})]}):(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsxs)(f.Button,{onClick:b,variant:"outline",size:"icon",disabled:a,className:"relative",title:"Refresh data",children:[(0,d.jsx)(h.RefreshCw,{className:`h-4 w-4 ${a?"animate-spin":""}`}),(0,d.jsx)("span",{className:"sr-only",children:"Refresh data"})]}),s("inventory","create")&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(f.Button,{onClick:c,variant:"outline",className:"gap-2",title:"Download CSV template",children:[(0,d.jsx)(k.FileDown,{size:16})," CSV Template"]}),(0,d.jsxs)(f.Button,{onClick:p,variant:"outline",className:"gap-2",title:"Upload products via CSV",children:[(0,d.jsx)(l.FileUp,{size:16})," Upload CSV"]})]}),s("inventory","view")&&(0,d.jsxs)(f.Button,{onClick:()=>q("/inventory/carriage-inwards"),variant:"outline",className:"gap-2",children:[(0,d.jsx)(j.Truck,{size:16})," Carriage Inwards"]}),s("inventory","stock_adjustment")&&(0,d.jsxs)(f.Button,{onClick:()=>q("/inventory/reconcile"),variant:"outline",className:"gap-2",title:"Reconcile stock discrepancies",children:[(0,d.jsx)(m.Scale,{size:16})," Reconcile"]}),(0,d.jsxs)(f.Button,{onClick:()=>q("/products"),variant:"outline",className:"gap-2",children:[(0,d.jsx)(i.ListFilter,{size:16})," All Products"]}),s("inventory","create")&&(0,d.jsxs)(f.Button,{onClick:()=>q("/inventory/new"),className:"gap-2",children:[(0,d.jsx)(g.Plus,{size:16})," Add Product"]})]})]})})}]),c()}catch(a){c(a)}},!1),254398,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(112779),g=a.i(957143),h=a.i(558277),i=b([f]);[f]=i.then?(await i)():i,a.s(["default",0,({filters:a,setFilters:b,products:c,onSearchChange:i,onSearchSubmit:j,onSearchFocus:k})=>{(0,h.useIsMobile)();let[l,m]=(0,e.useState)(a.search||"");return(0,e.useEffect)(()=>{let b=a.search||"";m(b)},[a.search]),(0,d.jsxs)("div",{className:"relative w-full",children:[(0,d.jsx)(g.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),(0,d.jsx)(f.Input,{placeholder:"Search products...",value:l,onChange:a=>{m(a.target.value),i&&i(a)},onKeyDown:c=>{"Enter"===c.key&&(c.preventDefault(),j?j({target:{value:l}}):b({...a,search:l}))},onBlur:()=>{l!==a.search&&(j?j({target:{value:l}}):b({...a,search:l}))},onFocus:k,className:"pl-9 w-full bg-white transition-all duration-200 focus:shadow-md"})]})}]),c()}catch(a){c(a)}},!1),114546,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(747899),f=a.i(540629),g=a.i(396465),h=a.i(589984),i=a.i(637610),j=a.i(93538),k=a.i(767810),l=a.i(799856),m=a.i(224993),n=a.i(625250),o=a.i(630227),p=a.i(996217),q=a.i(959866),r=a.i(647952),s=b([f,g,h,k,l,m,n,p,r]);[f,g,h,k,l,m,n,p,r]=s.then?(await s)():s,a.s(["default",0,({products:a,onExport:b,period:c="this-month"})=>{let{settings:s}=(0,m.useBusinessSettings)(),{canViewCostPrice:t,canViewProfit:u,canViewSellingPrice:v}=(0,n.useFinancialVisibility)(),w=(0,e.useNavigate)(),{currentPage:x,setCurrentPage:y,paginatedItems:z,totalPages:A}=(0,o.usePagination)({items:a,itemsPerPage:10});return(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsx)("div",{className:"flex justify-end",children:(0,d.jsxs)(h.DropdownMenu,{children:[(0,d.jsx)(h.DropdownMenuTrigger,{asChild:!0,children:(0,d.jsxs)(g.Button,{variant:"outline",size:"sm",className:"gap-2",children:[(0,d.jsx)(i.FileDown,{size:16}),"Export",(0,d.jsx)(j.ChevronDown,{size:16})]})}),(0,d.jsxs)(h.DropdownMenuContent,{align:"end",children:[(0,d.jsx)(h.DropdownMenuItem,{onClick:b||(()=>{let b=a.map((a,b)=>[(b+1).toString(),a.description,a.totalQuantity.toString(),v?a.averagePrice.toFixed(2):"RESTRICTED",v?a.totalAmount.toFixed(2):"RESTRICTED",t?(a.averageCost||0).toFixed(2):"RESTRICTED",t?a.totalCost.toFixed(2):"RESTRICTED",u?a.totalProfit.toFixed(2):"RESTRICTED"]),d=["Rank,Item Description,Quantity Sold,Average Price,Total Amount,Average Cost,Total Cost,Total Profit",...b.map(a=>a.map(a=>`"${a}"`).join(","))].join("\n"),e=new Blob([d],{type:"text/csv"}),f=window.URL.createObjectURL(e),g=document.createElement("a");g.href=f;let h=c.replace("-"," ").replace(/\b\w/g,a=>a.toUpperCase());g.download=`top-selling-items-${h.toLowerCase().replace(/\s+/g,"-")}-${new Date().toISOString().split("T")[0]}.csv`,g.click(),window.URL.revokeObjectURL(f)}),children:"Export as CSV"}),(0,d.jsx)(h.DropdownMenuItem,{onClick:()=>{let b=new q.default("landscape"),d=c.replace("-"," ").replace(/\b\w/g,a=>a.toUpperCase());b.setFontSize(18),b.setFont(void 0,"bold"),b.text("Top Selling Items Report",14,22),b.setFontSize(12),b.setFont(void 0,"normal"),b.text(`Period: ${d}`,14,32),b.text(`Generated: ${new Date().toLocaleDateString()}`,14,40);let e=a.map((a,b)=>[(b+1).toString(),a.description.length>50?a.description.substring(0,47)+"...":a.description,a.totalQuantity.toString(),v?`${s.currency} ${(0,l.formatNumber)(a.averagePrice)}`:"RESTRICTED",v?`${s.currency} ${(0,l.formatNumber)(a.totalAmount)}`:"RESTRICTED",t?`${s.currency} ${(0,l.formatNumber)(a.averageCost||0)}`:"RESTRICTED",t?`${s.currency} ${(0,l.formatNumber)(a.totalCost)}`:"RESTRICTED",u?`${s.currency} ${(0,l.formatNumber)(a.totalProfit)}`:"RESTRICTED"]);(0,r.default)(b,{head:[["Rank","Item Description","Qty Sold","Avg Price","Total Amount","Avg Cost","Total Cost","Profit"]],body:e,startY:50,styles:{fontSize:9},headStyles:{fillColor:[66,139,202]},columnStyles:{0:{halign:"center",cellWidth:15},1:{cellWidth:80},2:{halign:"center",cellWidth:25},3:{halign:"right",cellWidth:30},4:{halign:"right",cellWidth:35},5:{halign:"right",cellWidth:30},6:{halign:"right",cellWidth:30},7:{halign:"right",cellWidth:30}}}),b.save(`top-selling-items-${d.toLowerCase().replace(/\s+/g,"-")}-${new Date().toISOString().split("T")[0]}.pdf`)},children:"Export as PDF"})]})]})}),(0,d.jsx)(k.TooltipProvider,{children:(0,d.jsx)("div",{className:"overflow-x-auto rounded-md border",children:(0,d.jsxs)(f.Table,{children:[(0,d.jsx)(f.TableHeader,{children:(0,d.jsxs)(f.TableRow,{className:"bg-muted/50",children:[(0,d.jsx)(f.TableHead,{className:"w-[60px] min-w-[60px]",children:"Rank"}),(0,d.jsx)(f.TableHead,{className:"min-w-[200px]",children:"Item Description"}),(0,d.jsx)(f.TableHead,{className:"w-[100px] min-w-[100px] text-right",children:"Qty Sold"}),v&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(f.TableHead,{className:"w-[120px] min-w-[120px] text-right",children:"Avg Price"}),(0,d.jsx)(f.TableHead,{className:"w-[120px] min-w-[120px] text-right",children:"Total Amount"})]}),t&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(f.TableHead,{className:"w-[120px] min-w-[120px] text-right",children:"Avg Cost"}),(0,d.jsx)(f.TableHead,{className:"w-[120px] min-w-[120px] text-right",children:"Total Cost"})]}),u&&(0,d.jsx)(f.TableHead,{className:"w-[120px] min-w-[120px] text-right",children:"Profit"})]})}),(0,d.jsx)(f.TableBody,{children:0===a.length?(0,d.jsx)(f.TableRow,{children:(0,d.jsx)(f.TableCell,{colSpan:8,className:"text-center py-8 text-muted-foreground",children:"No sales data for the selected period"})}):z.map((a,b)=>{let c=a.productIds&&a.productIds.length>0?a.productIds[0]:null;return(0,d.jsxs)(f.TableRow,{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>c&&w(`/inventory/${c}`),children:[(0,d.jsx)(f.TableCell,{className:"text-center",children:(0,d.jsx)("span",{className:"text-xs bg-primary/10 text-primary rounded-full w-6 h-6 inline-flex items-center justify-center font-bold",children:(x-1)*10+b+1})}),(0,d.jsx)(f.TableCell,{className:"font-medium",children:(0,d.jsxs)(k.Tooltip,{children:[(0,d.jsx)(k.TooltipTrigger,{asChild:!0,children:(0,d.jsx)("span",{className:"cursor-help",children:a.description})}),(0,d.jsx)(k.TooltipContent,{side:"top",className:"max-w-xs",children:(0,d.jsx)("p",{className:"font-bold break-words whitespace-normal",children:a.description})})]})}),(0,d.jsx)(f.TableCell,{className:"text-right font-medium text-green-600",children:a.totalQuantity%1==0?a.totalQuantity:a.totalQuantity.toFixed(2)}),v&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(f.TableCell,{className:"text-right font-medium tabular-nums",children:(0,l.formatCashCurrency)(a.averagePrice,s.currency)}),(0,d.jsx)(f.TableCell,{className:"text-right font-medium tabular-nums",children:(0,l.formatCashCurrency)(a.totalAmount,s.currency)})]}),t&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(f.TableCell,{className:"text-right font-medium tabular-nums",children:(0,l.formatCashCurrency)(a.averageCost||0,s.currency)}),(0,d.jsx)(f.TableCell,{className:"text-right font-medium tabular-nums",children:(0,l.formatCashCurrency)(a.totalCost,s.currency)})]}),u&&(0,d.jsx)(f.TableCell,{className:"text-right font-medium tabular-nums",children:(0,d.jsx)("span",{className:a.totalProfit>=0?"text-green-600":"text-red-600",children:(0,l.formatCashCurrency)(a.totalProfit,s.currency)})})]},`${a.description}-${b}`)})})]})})}),a.length>0&&(0,d.jsx)("div",{className:"mt-4",children:(0,d.jsx)(p.default,{currentPage:x,totalPages:A,onPageChange:y})})]})}]),c()}catch(a){c(a)}},!1),607440,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(811705),f=a.i(688272),g=a.i(114546),h=b([e,f,g]);[e,f,g]=h.then?(await h)():h,a.s(["default",0,({topSellingProducts:a,period:b,onPeriodChange:c})=>(0,d.jsxs)(e.Card,{className:"shadow-sm border-t-0 bg-white",children:[(0,d.jsx)(e.CardHeader,{className:"pb-3 md:pb-6",children:(0,d.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[(0,d.jsx)(e.CardTitle,{className:"text-base md:text-lg",children:"Top Selling Products"}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("span",{className:"text-sm text-muted-foreground",children:"Period:"}),(0,d.jsxs)(f.Select,{value:b,onValueChange:a=>c(a),children:[(0,d.jsx)(f.SelectTrigger,{className:"w-[180px]",children:(0,d.jsx)(f.SelectValue,{})}),(0,d.jsxs)(f.SelectContent,{children:[(0,d.jsx)(f.SelectItem,{value:"today",children:"Today"}),(0,d.jsx)(f.SelectItem,{value:"yesterday",children:"Yesterday"}),(0,d.jsx)(f.SelectItem,{value:"this-week",children:"This Week"}),(0,d.jsx)(f.SelectItem,{value:"last-week",children:"Last Week"}),(0,d.jsx)(f.SelectItem,{value:"this-month",children:"This Month"}),(0,d.jsx)(f.SelectItem,{value:"last-month",children:"Last Month"}),(0,d.jsx)(f.SelectItem,{value:"all-time",children:"All Time"})]})]})]})]})}),(0,d.jsx)(e.CardContent,{className:"p-0",children:(0,d.jsx)(g.default,{products:a,period:b})})]})]),c()}catch(a){c(a)}},!1),288581,a=>{"use strict";var b=a.i(508171),c=a.i(379035),d=a.i(612485),e=a.i(742093),f=a.i(739362),g=a.i(855423),h=a.i(563641),i=a.i(698887);a.s(["default",0,({products:a})=>{let j=[{name:"In Stock",value:a.filter(a=>a.quantity>a.minimumStock).reduce((a,b)=>a+b.quantity,0),fill:"#4ade80"},{name:"Low Stock",value:a.filter(a=>a.quantity>0&&a.quantity<=a.minimumStock).reduce((a,b)=>a+b.quantity,0),fill:"#f87171"},{name:"Minimum Level",value:a.reduce((a,b)=>a+b.minimumStock,0),fill:"#94a3b8"}];return(0,b.jsxs)("div",{className:"w-full",children:[(0,b.jsx)("div",{className:"h-[300px] w-full",children:(0,b.jsx)(i.ResponsiveContainer,{width:"100%",height:"100%",children:(0,b.jsxs)(c.BarChart,{data:j,margin:{top:20,right:30,left:20,bottom:5},children:[(0,b.jsx)(g.CartesianGrid,{strokeDasharray:"3 3"}),(0,b.jsx)(e.XAxis,{dataKey:"name"}),(0,b.jsx)(f.YAxis,{}),(0,b.jsx)(h.Tooltip,{formatter:(a,b,c)=>[a,c.payload.name]}),(0,b.jsx)(d.Bar,{dataKey:"value",fill:"#8884d8",barSize:40,children:j.map((a,c)=>(0,b.jsx)(d.Bar,{dataKey:"value",fill:a.fill},`bar-${c}`))})]})})}),(0,b.jsxs)("div",{className:"flex justify-center mt-4 space-x-6",children:[(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)("div",{className:"w-3 h-3 bg-[#4ade80] rounded-full mr-2"}),(0,b.jsx)("span",{className:"text-sm",children:"In Stock"})]}),(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)("div",{className:"w-3 h-3 bg-[#f87171] rounded-full mr-2"}),(0,b.jsx)("span",{className:"text-sm",children:"Low Stock"})]}),(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)("div",{className:"w-3 h-3 bg-[#94a3b8] rounded-full mr-2"}),(0,b.jsx)("span",{className:"text-sm",children:"Minimum Level"})]})]})]})}])},920109,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(811705),f=a.i(288581),g=a.i(558277),h=b([e]);[e]=h.then?(await h)():h,a.s(["default",0,({products:a})=>(0,g.useIsMobile)()&&0===a.length?null:(0,d.jsxs)(e.Card,{className:"shadow-sm overflow-hidden",children:[(0,d.jsx)(e.CardHeader,{className:"pb-3 md:pb-6",children:(0,d.jsx)(e.CardTitle,{className:"text-base md:text-lg",children:"Stock Level Overview"})}),(0,d.jsx)(e.CardContent,{className:"pt-0",children:(0,d.jsx)(f.default,{products:a})})]})]),c()}catch(a){c(a)}},!1),288066,a=>{"use strict";var b=a.i(127669),c=a.i(665376),d=a.i(128069),e=a.i(122460),f=a.i(126554),g=a.i(759447),h=a.i(178465),i=a.i(289820);a.s(["useInventoryData",0,(a,j,k)=>{let l=(0,b.useMemo)(()=>{let a=new Date;switch(k){case"today":return{from:(0,c.startOfDay)(a),to:(0,d.endOfDay)(a)};case"yesterday":let b=new Date(a);return b.setDate(b.getDate()-1),{from:(0,c.startOfDay)(b),to:(0,d.endOfDay)(b)};case"this-week":return{from:(0,e.startOfWeek)(a),to:(0,f.endOfWeek)(a)};case"last-week":let i=new Date(a);return i.setDate(i.getDate()-7),{from:(0,e.startOfWeek)(i),to:(0,f.endOfWeek)(i)};case"this-month":return{from:(0,g.startOfMonth)(a),to:(0,h.endOfMonth)(a)};case"last-month":let j=new Date(a);return j.setMonth(j.getMonth()-1),{from:(0,g.startOfMonth)(j),to:(0,h.endOfMonth)(j)};default:return{from:new Date(0),to:a}}},[k]);return{topSellingProducts:(0,b.useMemo)(()=>{try{if(!j||0===j.length)return[];let a=j.filter(a=>{try{if(!a||"Quote"===a.paymentStatus)return!1;let b=new Date(a.date);if(isNaN(b.getTime()))return!1;return b>=l.from&&b<=l.to}catch(a){return console.warn("Error filtering sale:",a),!1}}),b=new Map;return a.forEach(a=>{try{if(!a.items||!Array.isArray(a.items))return;a.items.forEach(a=>{let c=a.description,d=a.price*a.quantity,e=(0,i.calculateItemActualAmount)(a),f=d-e,g=(a.cost||0)*a.quantity,h=e-g,j=(0,i.calculateItemActualPrice)(a);if(b.has(c)){let d=b.get(c);d.totalQuantity+=a.quantity,d.totalAmount+=e,d.totalCost+=g,d.totalProfit+=h,d.totalDiscount+=f,d.prices.push(j),d.costs.push(a.cost||0),a.productId&&!d.productIds.includes(a.productId)&&d.productIds.push(a.productId)}else b.set(c,{totalQuantity:a.quantity,totalAmount:e,totalCost:g,totalProfit:h,totalDiscount:f,prices:[j],costs:[a.cost||0],productIds:a.productId?[a.productId]:[]})})}catch(a){console.warn("Error processing sale items:",a)}}),Array.from(b.entries()).map(([a,b])=>({description:a,totalQuantity:b.totalQuantity,averagePrice:b.prices.reduce((a,b)=>a+b,0)/b.prices.length,totalAmount:b.totalAmount,totalCost:b.totalCost,totalProfit:b.totalProfit,totalDiscount:b.totalDiscount,averageCost:b.costs.reduce((a,b)=>a+b,0)/b.costs.length,productIds:b.productIds})).sort((a,b)=>b.totalQuantity-a.totalQuantity)}catch(a){return console.error("Error calculating top selling products:",a),[]}},[j,l]),dateRange:l}}])},574506,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(531811),g=a.i(964889),h=a.i(482331),i=a.i(108191),j=a.i(558277),k=a.i(747899),l=a.i(437322),m=a.i(148608),n=a.i(468103),o=a.i(840238),p=a.i(671419),q=a.i(710787),r=a.i(965549),s=a.i(217093),t=a.i(532987),u=a.i(985522),v=a.i(805297),w=a.i(380695),x=a.i(369576),y=a.i(526525),z=a.i(385375),A=a.i(54564),B=a.i(767823),C=a.i(254398),D=a.i(607440),E=a.i(920109),F=a.i(288066),G=a.i(500885),H=b([f,g,h,l,m,n,p,q,r,s,u,v,w,x,y,z,A,B,C,D,E,G]);[f,g,h,l,m,n,p,q,r,s,u,v,w,x,y,z,A,B,C,D,E,G]=H.then?(await H)():H,a.s(["default",0,()=>{let{user:a}=(0,f.useAuth)(),{currentBusiness:b,isLoading:c}=(0,g.useBusiness)(),{toast:H}=(0,i.useToast)(),I=(0,j.useIsMobile)(),{hasPermission:J}=(0,v.useProfiles)(),K=(0,k.useNavigate)(),{products:L,isLoading:M,isFetching:N,loadProducts:O,filters:P,setFilters:Q,filteredProducts:R,totalCount:S,refetch:T}=(0,h.useProducts)(a?.id),{categories:U}=(0,u.useCategories)(a?.id),{bulkCreateProducts:V}=(0,s.useBulkProducts)(),{sales:W}=(0,z.useSalesData)(a?.id),[X,Y]=e.default.useState(!1),[Z,$]=e.default.useState("this-month"),[_,aa]=e.default.useState(P.search||""),{data:ab,refetch:ac}=useGlobalInventoryStats(b?.id),ad=(0,G.useQueryClient)();e.default.useEffect(()=>{aa(P.search||"")},[P.search]);let{topSellingProducts:ae}=(0,F.useInventoryData)(R,W,Z),{suggestions:af,isOpen:ag,openPanel:ah,closePanel:ai}=(0,o.useProductSuggestions)(L,_),aj=(0,e.useCallback)(async()=>{ad.invalidateQueries({queryKey:["inventory_global_stats"]}),ad.invalidateQueries({queryKey:["products"]}),await ac(),await T(),H({title:"Inventory refreshed",description:"Your inventory data and stats have been updated with fresh server data."})},[T,H,ac,ad]),ak=(0,e.useCallback)(a=>{let b=a.target.value;aa(b),b.length>=1?ah():ai()},[ah,ai]),al=(0,e.useCallback)(a=>{let b=a.target.value;Q({...P,search:b}),b.length>0&&ah()},[P,Q,ah]),am=a=>{aa(a.name),K(`/inventory/${a.id}`),ai()},an=(0,e.useCallback)(()=>{_&&ah()},[_,ah]),ao=e.default.useCallback(()=>{(0,t.generateProductCSVTemplate)(),H({title:"Template downloaded",description:"CSV template has been downloaded to your device."})},[H]),ap=e.default.useCallback(async a=>{try{await V(a),Y(!1),await O()}catch(a){console.error("CSV upload failed:",a),H({title:"Upload failed",description:"There was an error uploading your products. Please try again.",variant:"destructive"})}},[V,O,H]);return c||!b||M?(0,d.jsx)(A.default,{}):(0,d.jsxs)("div",{className:"p-2 md:p-6 space-y-4 md:space-y-6 max-w-full",children:[(0,d.jsx)(B.default,{isLoading:M,onRefresh:aj,onDownloadTemplate:ao,onCSVUpload:()=>Y(!0)}),(0,d.jsx)(r.default,{open:X,onOpenChange:Y,onUpload:ap,categories:U.map(a=>a.name)}),(0,d.jsx)(l.default,{products:L,totalCountOverride:S,totalCostValueOverride:ab?.totalCostValue,lowStockOverride:ab?.lowStockCount,outOfStockOverride:ab?.outOfStockCount,totalStockValueOverride:ab?.totalStockValue}),(0,d.jsxs)(m.Tabs,{defaultValue:"overview",className:"space-y-3 md:space-y-6",children:[(0,d.jsxs)(m.TabsList,{className:`grid w-full ${I?"grid-cols-4 gap-1":"grid-cols-6"} h-auto p-1`,children:[(0,d.jsx)(m.TabsTrigger,{value:"overview",className:"text-xs md:text-sm px-1 md:px-2 py-2 min-h-[44px]",children:"Overview"}),(0,d.jsx)(m.TabsTrigger,{value:"requisition",className:"text-xs md:text-sm px-1 md:px-2 py-2 min-h-[44px]",children:I?"Request":"Requisition"}),J("inventory","stock_adjustment")&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(m.TabsTrigger,{value:"add-stock",className:"text-xs md:text-sm px-1 md:px-2 py-2 min-h-[44px]",children:"Restock"}),(0,d.jsx)(m.TabsTrigger,{value:"stock-count",className:"text-xs md:text-sm px-1 md:px-2 py-2 min-h-[44px]",children:I?"Count":"Stock Count"})]}),!I&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(m.TabsTrigger,{value:"sold-items",className:"text-xs md:text-sm px-1 md:px-2 py-2 min-h-[44px]",children:"Items Sold"}),(0,d.jsx)(m.TabsTrigger,{value:"stock-summary",className:"text-xs md:text-sm px-1 md:px-2 py-2 min-h-[44px]",children:"Stock Summary"})]})]}),I&&(0,d.jsx)("div",{className:"flex gap-1 overflow-x-auto pb-2",children:(0,d.jsxs)(m.TabsList,{className:"grid grid-cols-2 gap-1 w-auto min-w-fit p-1",children:[(0,d.jsx)(m.TabsTrigger,{value:"sold-items",className:"text-xs px-2 py-2 min-h-[44px] whitespace-nowrap",children:"Items Sold"}),(0,d.jsx)(m.TabsTrigger,{value:"stock-summary",className:"text-xs px-2 py-2 min-h-[44px] whitespace-nowrap",children:"Stock Summary"})]})}),(0,d.jsxs)(m.TabsContent,{value:"overview",className:"space-y-4 md:space-y-6",children:[(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsx)(C.default,{filters:P,setFilters:Q,products:L,onSearchChange:ak,onSearchSubmit:al,onSearchFocus:an}),I&&(0,d.jsx)("div",{className:"absolute top-full left-0 right-0 z-50 mt-1",children:(0,d.jsx)(n.default,{suggestions:af,isOpen:ag,onClose:ai,onSelectProduct:am,searchTerm:_,isLoading:N})})]}),(0,d.jsx)(E.default,{products:L}),(0,d.jsx)(D.default,{topSellingProducts:ae,period:Z,onPeriodChange:$})]}),J("inventory","stock_adjustment")&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(m.TabsContent,{value:"add-stock",children:(0,d.jsx)(w.default,{})}),(0,d.jsx)(m.TabsContent,{value:"stock-count",children:(0,d.jsx)(x.default,{})})]}),(0,d.jsx)(m.TabsContent,{value:"requisition",children:(0,d.jsx)(y.default,{})}),(0,d.jsx)(m.TabsContent,{value:"sold-items",children:(0,d.jsx)(p.default,{})}),(0,d.jsx)(m.TabsContent,{value:"stock-summary",children:(0,d.jsx)(q.default,{})})]}),!I&&(0,d.jsx)(n.default,{suggestions:af,isOpen:ag,onClose:ai,onSelectProduct:am,searchTerm:_,isLoading:N})]})}]),c()}catch(a){c(a)}},!1),20060,a=>a.a(async(b,c)=>{try{var d=a.i(579168),e=a.i(627068),f=a.i(332759),g=a.i(539141),h=a.i(706555),i=a.i(574506),j=a.i(509193),k=b([i]);[i]=k.then?(await k)():k;let l=(0,f.hoist)(i,"default"),m=(0,f.hoist)(i,"getStaticProps"),n=(0,f.hoist)(i,"getStaticPaths"),o=(0,f.hoist)(i,"getServerSideProps"),p=(0,f.hoist)(i,"config"),q=(0,f.hoist)(i,"reportWebVitals"),r=(0,f.hoist)(i,"unstable_getStaticProps"),s=(0,f.hoist)(i,"unstable_getStaticPaths"),t=(0,f.hoist)(i,"unstable_getStaticParams"),u=(0,f.hoist)(i,"unstable_getServerProps"),v=(0,f.hoist)(i,"unstable_getServerSideProps"),w=new d.PagesRouteModule({definition:{kind:e.RouteKind.PAGES,page:"/Inventory",pathname:"/Inventory",bundlePath:"",filename:""},distDir:".next",relativeProjectDir:"",components:{App:h.default,Document:g.default},userland:i}),x=(0,j.getHandler)({srcPage:"/Inventory",config:p,userland:i,routeModule:w,getStaticPaths:n,getStaticProps:m,getServerSideProps:o});a.s(["config",0,p,"default",0,l,"getServerSideProps",0,o,"getStaticPaths",0,n,"getStaticProps",0,m,"handler",0,x,"reportWebVitals",0,q,"routeModule",0,w,"unstable_getServerProps",0,u,"unstable_getServerSideProps",0,v,"unstable_getStaticParams",0,t,"unstable_getStaticPaths",0,s,"unstable_getStaticProps",0,r]),c()}catch(a){c(a)}},!1)];

//# sourceMappingURL=_c761ad23._.js.map