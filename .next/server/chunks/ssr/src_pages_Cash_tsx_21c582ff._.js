module.exports=[280071,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(169819),e=a.i(291914),f=a.i(875083),g=a.i(915618),h=a.i(699570),i=a.i(770094);let j=({onCreateAccount:a,canCreate:c=!0})=>((0,i.useIsMobile)(),(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold",children:"Cash Accounts"}),c&&(0,b.jsxs)(h.Button,{onClick:a,className:"gap-2",size:"default",children:[(0,b.jsx)(g.Plus,{className:"h-4 w-4"}),"New Cash Account"]})]}));var k=a.i(665967),l=a.i(591119),m=a.i(786304),n=a.i(417755),o=a.i(922520),p=a.i(257344),q=a.i(856738),r=a.i(596221),s=a.i(335732),t=a.i(129743),u=a.i(866102),v=a.i(486192);let w=({open:a,onOpenChange:c,account:d,transactionCount:e=0,details:f,onConfirm:g})=>{if(!d)return null;let h=e>0;return(0,b.jsx)(v.AlertDialog,{open:a,onOpenChange:c,children:(0,b.jsxs)(v.AlertDialogContent,{children:[(0,b.jsxs)(v.AlertDialogHeader,{children:[(0,b.jsx)(v.AlertDialogTitle,{children:"Delete Cash Account"}),(0,b.jsxs)(v.AlertDialogDescription,{className:"space-y-2",children:[(0,b.jsxs)("span",{className:"block",children:['Are you sure you want to delete the cash account "',d.name,'"?']}),h&&(0,b.jsxs)("span",{className:"block text-amber-600 font-medium",children:["This account has ",f||`${e} linked records`,"."]})]})]}),(0,b.jsxs)(v.AlertDialogFooter,{className:h?"flex-col gap-2 sm:flex-col":"",children:[(0,b.jsx)(v.AlertDialogCancel,{children:"Cancel"}),h?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(v.AlertDialogAction,{onClick:()=>g(!1),className:"bg-blue-600 hover:bg-blue-700",children:"Delete Account Only (Unlink Records)"}),(0,b.jsx)(v.AlertDialogAction,{onClick:()=>g(!0),className:"bg-red-600 hover:bg-red-700",children:"Delete Account & All Records"})]}):(0,b.jsx)(v.AlertDialogAction,{onClick:()=>g(!1),className:"bg-red-600 hover:bg-red-700",children:"Delete Account"})]})]})})};var x=a.i(368114),y=a.i(890914),z=a.i(400291);let A=({account:a,onAccountDeleted:d})=>{let f=(0,k.useNavigate)(),g=(0,i.useIsMobile)(),{deleteAccount:j,deleteAccountWithTransactions:v}=(0,e.useCashAccounts)(),{getDailySummary:A}=(0,t.useCashTransactions)(a.id),{settings:B}=(0,u.useBusinessSettings)(),{hasPermission:C}=(0,y.useProfiles)(),{canManageFinanceAccounts:D}=(0,z.useFinancialVisibility)(),E=C("finance","delete"),[F,G]=(0,c.useState)(!0),[H,I]=(0,c.useState)(!1),[J,K]=(0,c.useState)(0),[L,M]=(0,c.useState)(""),[N,O]=(0,c.useState)({date:new Date,openingBalance:0,cashIn:0,cashOut:0,transfersIn:0,transfersOut:0,closingBalance:0}),P=(0,c.useMemo)(()=>a=>(0,x.formatCashAmount)(a,B.currency||"USD"),[B.currency]),Q=(0,c.useCallback)(async()=>{G(!0);try{let b=await A(new Date,a.id);O(b)}catch(a){console.error("Error loading today's summary:",a)}finally{G(!1)}},[A,a.id]);(0,c.useEffect)(()=>{Q()},[Q]);let R=(0,c.useCallback)(async()=>{console.log("Delete button clicked for account:",a.id);try{let b=await j(a.id,d);console.log("Delete result:",b),b&&"object"==typeof b&&"hasTransactions"in b&&(b.hasTransactions?(console.log("Account has transactions, showing dialog"),K(b.transactionCount||0),M(b.details||""),I(!0)):b.success?console.log("Account deleted successfully without dialog"):console.log("Account deletion failed"))}catch(a){console.error("Unexpected error during deletion:",a)}},[j,a.id,d]),S=(0,c.useCallback)(async b=>{console.log("Confirm delete called with deleteTransactions:",b);try{let c=await v(a.id,b,d);console.log("Delete with transactions result:",c),c?(I(!1),console.log("Deletion successful, dialog closed")):console.log("Deletion failed")}catch(a){console.error("Error in handleConfirmDelete:",a)}},[v,a.id,d]),T=(0,c.useCallback)(()=>{f(`/cash/${a.id}`)},[f,a.id]);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(l.Card,{className:`hover:shadow-lg transition-all duration-200 cursor-pointer ${g?"shadow-sm border-gray-200":"hover:shadow-md"}`,children:[(0,b.jsxs)(l.CardHeader,{className:`flex flex-row items-center justify-between space-y-0 ${g?"pb-3":"pb-2"}`,children:[(0,b.jsxs)(l.CardTitle,{className:`${g?"text-base":"text-sm"} font-semibold flex items-center gap-2 text-gray-900`,children:[(0,b.jsx)(q.Wallet,{className:`${g?"h-5 w-5":"h-4 w-4"} text-primary`}),(0,b.jsx)("span",{className:"truncate",children:a.name}),a.isDefault&&(0,b.jsx)(m.Badge,{variant:"secondary",className:`${g?"text-xs px-2 py-0.5":"text-xs"} bg-primary/10 text-primary border-primary/20`,children:"Default"})]}),(0,b.jsxs)(s.DropdownMenu,{children:[(0,b.jsx)(s.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(h.Button,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-gray-100",children:(0,b.jsx)(n.MoreHorizontal,{className:"h-4 w-4 text-gray-500"})})}),(0,b.jsxs)(s.DropdownMenuContent,{align:"end",className:"bg-white border border-gray-200 shadow-lg",children:[(0,b.jsx)(s.DropdownMenuItem,{onClick:T,className:"hover:bg-gray-50",children:"View Details"}),E&&(0,b.jsx)(s.DropdownMenuItem,{onClick:R,className:"text-red-600 hover:bg-red-50",children:"Delete Account"})]})]})]}),(0,b.jsx)(l.CardContent,{onClick:T,className:g?"px-4 pb-4":"",children:(0,b.jsxs)("div",{className:`space-y-${g?"4":"3"}`,children:[(0,b.jsxs)("div",{className:g?"space-y-1":"",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-gray-900 flex items-center",children:F?(0,b.jsx)(r.Loader2,{className:"h-6 w-6 animate-spin text-muted-foreground"}):D?P(N.closingBalance):"•••"}),(0,b.jsx)("p",{className:`${g?"text-sm":"text-xs"} text-gray-500 font-medium`,children:"Current Balance"})]}),a.description&&(0,b.jsx)("p",{className:`${g?"text-sm leading-relaxed":"text-sm"} text-gray-600 line-clamp-2`,children:a.description}),(0,b.jsxs)("div",{className:`grid grid-cols-1 ${g?"gap-3":"gap-2"} text-sm`,children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-2 bg-green-50 rounded-md",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-green-700",children:[(0,b.jsx)(o.ArrowUpRight,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"font-medium",children:"Opening"})]}),(0,b.jsx)("span",{className:"font-semibold text-green-800 flex items-center",children:F?(0,b.jsx)(r.Loader2,{className:"h-4 w-4 animate-spin text-green-600"}):D?P(N.openingBalance):"•••"})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between p-2 bg-blue-50 rounded-md",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-blue-700",children:[(0,b.jsx)(p.ArrowDownRight,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"font-medium",children:"Today's Close"})]}),(0,b.jsx)("span",{className:"font-semibold text-blue-800 flex items-center",children:F?(0,b.jsx)(r.Loader2,{className:"h-4 w-4 animate-spin text-blue-600"}):D?P(N.closingBalance):"•••"})]})]}),(0,b.jsx)("div",{className:"pt-2",children:(0,b.jsx)(h.Button,{variant:"outline",size:g?"default":"sm",className:`w-full font-medium hover:bg-primary hover:text-white transition-colors ${g?"h-10":""}`,onClick:a=>{a.stopPropagation(),T()},children:"Manage Account"})})]})})]}),(0,b.jsx)(w,{open:H,onOpenChange:I,account:a,transactionCount:J,details:L,onConfirm:S})]})},B=({accounts:a,isLoading:c,onCreateAccount:d,onAccountDeleted:e,canCreate:f=!0})=>((0,i.useIsMobile)(),c)?(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:[1,2,3].map(a=>(0,b.jsx)("div",{className:"h-64 bg-gray-100 animate-pulse rounded-lg"},a))}):0===a.length?(0,b.jsxs)("div",{className:"text-center py-12",children:[(0,b.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No cash accounts"}),(0,b.jsx)("p",{className:"text-gray-500 mb-4",children:"Get started by creating your first cash account."}),f&&(0,b.jsxs)(h.Button,{onClick:d,className:"gap-2",children:[(0,b.jsx)(g.Plus,{className:"h-4 w-4"}),"Create Cash Account"]})]}):(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:a.map(a=>(0,b.jsx)(A,{account:a,onAccountDeleted:e},a.id))});var C=a.i(892984),D=a.i(391956),E=a.i(737139),F=a.i(871111),G=a.i(342928),H=a.i(672635),I=a.i(750054),J=a.i(985579),K=a.i(20286),L=a.i(206015),M=a.i(333140),N=a.i(866718),O=a.i(870430);let P=({taxPercentage:a,onTaxChange:c,netProfitLoss:d,formatCurrency:e})=>(0,b.jsxs)("div",{className:"flex items-center gap-4 p-4 bg-gray-50 rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(O.Label,{htmlFor:"tax-percentage",className:"text-sm font-medium",children:"Tax %:"}),(0,b.jsx)(N.Input,{id:"tax-percentage",type:"number",min:"0",max:"100",step:"0.1",value:a,onChange:a=>{c(Math.max(0,Math.min(100,parseFloat(a.target.value)||0)))},className:"w-20 h-8 text-center"})]}),(0,b.jsxs)("div",{className:"text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Tax Amount: "}),(0,b.jsx)("span",{className:"font-medium",children:e(d>0?d*a/100:0)})]})]});var Q=a.i(284505),R=a.i(104720);let S=(0,a.i(170106).default)("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);var T=a.i(256711),U=a.i(932596);let V=async a=>{let{data:b,dateRange:c,currency:d,businessName:e,dateFilter:f}=a,g=new U.default({orientation:"portrait",unit:"mm",format:"a4"}),h=g.internal.pageSize.getWidth(),i=g.internal.pageSize.getHeight(),j=20,k=()=>{g.setFontSize(8),g.setFont("helvetica","normal"),g.setTextColor(150,150,150),g.text("Created By Gonza Systems",h/2,i-10,{align:"center"}),g.setTextColor(0,0,0)},l=a=>`${d} ${a.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`;if(e){g.setFontSize(18),g.setFont("helvetica","bold");let a=g.getTextWidth(e);g.text(e,(h-a)/2,j),j+=10}g.setFontSize(16),g.setFont("helvetica","bold");let m="Profit & Loss Account",n=g.getTextWidth(m);g.text(m,(h-n)/2,j),j+=8,g.setFontSize(11),g.setFont("helvetica","normal");let o=((a,b)=>{if(b.from&&b.to){let c=b.from.getMonth()===b.to.getMonth()&&b.from.getFullYear()===b.to.getFullYear();if(b.from.toDateString()===b.to.toDateString())return(0,T.format)(b.from,"MMM dd, yyyy");if(c&&"this-month"===a)return(0,T.format)(b.from,"MMMM yyyy");if("this-year"===a)return(0,T.format)(b.from,"yyyy");else if("last-month"===a)return(0,T.format)(b.from,"MMMM yyyy");else if("this-week"===a||"last-week"===a)return`Week of ${(0,T.format)(b.from,"MMM dd")} - ${(0,T.format)(b.to,"MMM dd, yyyy")}`;else return`Custom Period: ${(0,T.format)(b.from,"MM/dd/yyyy")} - ${(0,T.format)(b.to,"MM/dd/yyyy")}`}return b.from?(0,T.format)(b.from,"MMM dd, yyyy"):"All Periods"})(f,c),p=g.getTextWidth(o);g.text(o,(h-p)/2,j),j+=15;let q=a=>{j>i-40&&(k(),g.addPage(),j=20),g.setFontSize(12),g.setFont("helvetica","bold"),g.text(a,20,j),j+=6},r=(a,b,c={})=>{let{isBold:d=!1,isSubtraction:e=!1,isTotal:f=!1,indent:m=!1,showNegativeSign:n=!1}=c;if(j>i-25&&(k(),g.addPage(),j=20),g.setFontSize(10),g.setFont("helvetica",d?"bold":"normal"),g.text(a,m?30:20,j),null!==b){let a;a=n&&b<0?`-${l(Math.abs(b))}`:e?`(${l(Math.abs(b))})`:l(Math.abs(b));let c=g.getTextWidth(a);g.text(a,h-20-c,j)}f&&(g.setLineWidth(.3),g.line(20,j+2,h-20,j+2),j+=2),j+=5},s=(a=3)=>{j+=a};q("SALES/REVENUE"),r("Sales/Revenue",b.sales,{indent:!0}),r("Sales Returns",b.salesReturns,{isSubtraction:!0,indent:!0}),r("NET SALES",b.netSales,{isBold:!0,isTotal:!0}),s(5),q("COST OF GOODS SOLD (COGS)"),r("Total Cost Sales",b.totalCostSales,{indent:!0}),r("Carriage Inwards",b.carriageInwards,{indent:!0}),r("TOTAL COST OF GOODS SOLD (COGS)",b.totalCOGS,{isBold:!0,isTotal:!0}),s(5),r("GROSS PROFIT",b.grossProfit,{isBold:!0,isTotal:!0,showNegativeSign:!0}),s(3),q("EXPENSES"),Object.entries(b.expensesByCategory).forEach(([a,b])=>{r(a.charAt(0).toUpperCase()+a.slice(1).toLowerCase(),b,{indent:!0})}),r("TOTAL EXPENSES",b.totalExpenses,{isBold:!0,isTotal:!0}),s(5),r("NET PROFIT / LOSS",b.netProfitLoss,{isBold:!0,isTotal:!0,showNegativeSign:!0}),r(`Tax (${b.taxPercentage}%)`,b.taxAmount,{indent:!0}),r("FINAL PROFIT AFTER TAX",b.finalProfitAfterTax,{isBold:!0,isTotal:!0,showNegativeSign:!0}),k();let t=`profit_loss_${c.from?(0,T.format)(c.from,"yyyy-MM-dd"):"current"}_to_${c.to?(0,T.format)(c.to,"yyyy-MM-dd"):"current"}.pdf`;g.save(t)};var W=a.i(478793);let X=({data:a,dateRange:d,currency:e,businessName:f,businessLogo:g,dateFilter:i})=>{let[j,k]=(0,c.useState)(!1),{toast:l}=(0,W.useToast)(),m=async()=>{try{k(!0),(a=>{let{data:b,dateRange:c,currency:d,businessName:e,dateFilter:f}=a,g=(a,b=!1)=>b&&a<0?`-${Math.abs(a).toFixed(0)}`:a.toFixed(0),h=[];h.push("PROFIT & LOSS ACCOUNT"),h.push(""),e&&h.push(`Business,${e}`),h.push(`Period,${((a,b)=>{if(b.from&&b.to){let c=b.from.getMonth()===b.to.getMonth()&&b.from.getFullYear()===b.to.getFullYear();if(b.from.toDateString()===b.to.toDateString())return(0,T.format)(b.from,"MMM dd, yyyy");if(c&&"this-month"===a)return(0,T.format)(b.from,"MMMM yyyy");if("this-year"===a)return(0,T.format)(b.from,"yyyy");else if("last-month"===a)return(0,T.format)(b.from,"MMMM yyyy");else if("this-week"===a||"last-week"===a)return`Week of ${(0,T.format)(b.from,"MMM dd")} - ${(0,T.format)(b.to,"MMM dd, yyyy")}`;else return`Custom Period: ${(0,T.format)(b.from,"MM/dd/yyyy")} - ${(0,T.format)(b.to,"MM/dd/yyyy")}`}return b.from?(0,T.format)(b.from,"MMM dd, yyyy"):"All Periods"})(f,c)}`),h.push(`Generated,${(0,T.format)(new Date,"MMM dd yyyy HH:mm")}`),h.push(`Currency,${d}`),h.push(""),h.push("DETAILS,AMOUNT"),h.push(""),h.push("SALES/REVENUE,"),h.push(`Sales/Revenue,${g(b.sales)}`),h.push(`Sales Returns,(${g(b.salesReturns)})`),h.push(`NET SALES,${g(b.netSales)}`),h.push(""),h.push("COST OF GOODS SOLD (COGS),"),h.push(`Total Cost Sales,${g(b.totalCostSales)}`),h.push(`Carriage Inwards,${g(b.carriageInwards)}`),h.push(`TOTAL COST OF GOODS SOLD (COGS),${g(b.totalCOGS)}`),h.push(""),h.push(`GROSS PROFIT,${g(b.grossProfit,!0)}`),h.push(""),h.push("EXPENSES,"),Object.entries(b.expensesByCategory).forEach(([a,b])=>{let c=a.charAt(0).toUpperCase()+a.slice(1).toLowerCase();h.push(`${c},${g(b)}`)}),h.push(`TOTAL EXPENSES,${g(b.totalExpenses)}`),h.push(""),h.push(`NET PROFIT / LOSS,${g(b.netProfitLoss,!0)}`),h.push(`Tax (${b.taxPercentage}%),${g(b.taxAmount)}`),h.push(`FINAL PROFIT AFTER TAX,${g(b.finalProfitAfterTax,!0)}`);let i=new Blob([h.join("\n")],{type:"text/csv;charset=utf-8;"}),j=document.createElement("a");if(void 0!==j.download){let a=URL.createObjectURL(i);j.setAttribute("href",a);let b=`profit_loss_${c.from?(0,T.format)(c.from,"yyyy-MM-dd"):"current"}_to_${c.to?(0,T.format)(c.to,"yyyy-MM-dd"):"current"}.csv`;j.setAttribute("download",b),j.style.visibility="hidden",document.body.appendChild(j),j.click(),document.body.removeChild(j)}})({data:a,dateRange:d,currency:e,businessName:f,dateFilter:i}),l({title:"Export Successful",description:"Profit & Loss Account exported to CSV successfully."})}catch(a){console.error("Error exporting CSV:",a),l({title:"Export Failed",description:"Failed to export Profit & Loss Account to CSV.",variant:"destructive"})}finally{k(!1)}},n=async()=>{try{k(!0),await V({data:a,dateRange:d,currency:e,businessName:f,businessLogo:g,dateFilter:i}),l({title:"Export Successful",description:"Profit & Loss Account exported to PDF successfully."})}catch(a){console.error("Error exporting PDF:",a),l({title:"Export Failed",description:"Failed to export Profit & Loss Account to PDF.",variant:"destructive"})}finally{k(!1)}};return(0,b.jsxs)(s.DropdownMenu,{children:[(0,b.jsx)(s.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsxs)(h.Button,{variant:"outline",size:"sm",disabled:j,children:[(0,b.jsx)(Q.Download,{className:"h-4 w-4 mr-2"}),"Export"]})}),(0,b.jsxs)(s.DropdownMenuContent,{children:[(0,b.jsxs)(s.DropdownMenuItem,{onClick:m,disabled:j,children:[(0,b.jsx)(S,{className:"h-4 w-4 mr-2"}),"Export as CSV"]}),(0,b.jsxs)(s.DropdownMenuItem,{onClick:n,disabled:j,children:[(0,b.jsx)(R.FileText,{className:"h-4 w-4 mr-2"}),"Export as PDF"]})]})]})},Y=({data:a,isLoading:c,formatCurrency:d,onTaxChange:e,dateRange:f,businessName:g,businessLogo:h,currency:i,dateFilter:j})=>{if(c)return(0,b.jsxs)(l.Card,{children:[(0,b.jsx)(l.CardHeader,{children:(0,b.jsx)(l.CardTitle,{children:"Profit & Loss Account"})}),(0,b.jsx)(l.CardContent,{children:(0,b.jsx)("div",{className:"space-y-3",children:[...Array(15)].map((a,c)=>(0,b.jsx)(M.Skeleton,{className:"h-8 w-full"},c))})})]});let k=[{detail:"SALES/REVENUE",amount:a.sales,isBold:!0},{detail:"SALES RETURNS",amount:a.salesReturns,isSubtraction:!0},{detail:"NET SALES",amount:a.netSales,isBold:!0,isTotal:!0},{detail:"",amount:null,isSpacer:!0},{detail:"COST OF GOODS SOLD (COGS)",amount:null,isHeader:!0},{detail:"TOTAL COST SALES",amount:a.totalCostSales},{detail:"CARRIAGE INWARDS",amount:a.carriageInwards},{detail:"TOTAL COST OF GOODS SOLD (COGS)",amount:a.totalCOGS,isBold:!0,isTotal:!0},{detail:"",amount:null,isSpacer:!0},{detail:"GROSS PROFIT",amount:a.grossProfit,isBold:!0,isTotal:!0},{detail:"",amount:null,isSpacer:!0},{detail:"EXPENSES",amount:null,isHeader:!0}];Object.entries(a.expensesByCategory).forEach(([a,b])=>{k.push({detail:a.toUpperCase(),amount:b})}),k.push({detail:"TOTAL EXPENSES",amount:a.totalExpenses,isBold:!0,isTotal:!0},{detail:"",amount:null,isSpacer:!0},{detail:"NET PROFIT / LOSS",amount:a.netProfitLoss,isBold:!0,isTotal:!0},{detail:"TAX",amount:a.taxAmount},{detail:"FINAL PROFIT AFTER TAX",amount:a.finalProfitAfterTax,isBold:!0,isTotal:!0});let m=a=>a.amount<0?"text-red-600":a.detail?.includes("PROFIT")&&a.amount>0?"text-green-600":a.detail?.includes("EXPENSE")||a.detail?.includes("TAX")?"text-red-600":"text-gray-900";return(0,b.jsxs)(l.Card,{children:[(0,b.jsx)(l.CardHeader,{children:(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)(l.CardTitle,{children:"Profit & Loss Account"}),(0,b.jsx)(X,{data:a,dateRange:f,currency:i,businessName:g,businessLogo:h,dateFilter:j})]})}),(0,b.jsxs)(l.CardContent,{className:"space-y-4",children:[(0,b.jsx)(P,{taxPercentage:a.taxPercentage,onTaxChange:e,netProfitLoss:a.netProfitLoss,formatCurrency:d}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)(L.Table,{children:[(0,b.jsx)(L.TableHeader,{children:(0,b.jsxs)(L.TableRow,{children:[(0,b.jsx)(L.TableHead,{className:"font-bold text-left",children:"DETAILS"}),(0,b.jsx)(L.TableHead,{className:"font-bold text-right",children:"AMOUNT"})]})}),(0,b.jsx)(L.TableBody,{children:k.map((a,c)=>a.isSpacer?(0,b.jsx)(L.TableRow,{children:(0,b.jsx)(L.TableCell,{colSpan:2,className:"h-4 border-0"})},c):a.isHeader?(0,b.jsx)(L.TableRow,{children:(0,b.jsx)(L.TableCell,{colSpan:2,className:"font-bold text-gray-800 bg-gray-50 border-0",children:a.detail})},c):(0,b.jsxs)(L.TableRow,{className:a.isTotal?"border-t-2 border-gray-300":"",children:[(0,b.jsx)(L.TableCell,{className:`${a.isBold?"font-bold":""} ${m(a)}`,children:a.detail}),(0,b.jsx)(L.TableCell,{className:`text-right ${a.isBold?"font-bold":""} ${m(a)}`,children:null!==a.amount?(0,b.jsxs)("span",{children:[a.isSubtraction&&"(",d(Math.abs(a.amount)),a.isSubtraction&&")"]}):null})]},c))})]})}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-6",children:[(0,b.jsx)(l.Card,{className:"border-blue-200 bg-blue-50",children:(0,b.jsxs)(l.CardContent,{className:"p-4 text-center",children:[(0,b.jsx)("p",{className:"text-sm text-blue-600 font-medium",children:"Gross Profit"}),(0,b.jsx)("p",{className:"text-lg font-bold text-blue-800",children:d(a.grossProfit)})]})}),(0,b.jsx)(l.Card,{className:`border-${a.netProfitLoss>=0?"green":"red"}-200 bg-${a.netProfitLoss>=0?"green":"red"}-50`,children:(0,b.jsxs)(l.CardContent,{className:"p-4 text-center",children:[(0,b.jsxs)("p",{className:`text-sm text-${a.netProfitLoss>=0?"green":"red"}-600 font-medium`,children:["Net ",a.netProfitLoss>=0?"Profit":"Loss"]}),(0,b.jsx)("p",{className:`text-lg font-bold text-${a.netProfitLoss>=0?"green":"red"}-800`,children:d(Math.abs(a.netProfitLoss))})]})}),(0,b.jsx)(l.Card,{className:`border-${a.finalProfitAfterTax>=0?"green":"red"}-200 bg-${a.finalProfitAfterTax>=0?"green":"red"}-50`,children:(0,b.jsxs)(l.CardContent,{className:"p-4 text-center",children:[(0,b.jsxs)("p",{className:`text-sm text-${a.finalProfitAfterTax>=0?"green":"red"}-600 font-medium`,children:["Final ",a.finalProfitAfterTax>=0?"Profit":"Loss"," After Tax"]}),(0,b.jsx)("p",{className:`text-lg font-bold text-${a.finalProfitAfterTax>=0?"green":"red"}-800`,children:d(Math.abs(a.finalProfitAfterTax))})]})})]})]})]})},Z=()=>{let{currentBusiness:a}=(0,d.useBusiness)(),{settings:e}=(0,u.useBusinessSettings)(),[f,g]=(0,c.useState)("this-month"),[h,i]=(0,c.useState)({from:void 0,to:void 0}),[j,k]=(0,c.useState)(void 0),[l,m]=(0,c.useState)(0),n="custom"===f,o="specific"===f;(0,c.useEffect)(()=>{"custom"===f?k(void 0):"specific"===f?i({from:void 0,to:void 0}):(i({from:void 0,to:void 0}),k(void 0))},[f]);let p=e?.currency||"USD",{profitLossData:q,isLoading:r}=((a,b,e,f=0)=>{let{user:g}=(0,D.useAuth)(),{currentBusiness:h}=(0,d.useBusiness)(),[i,j]=(0,c.useState)(!1),{sales:k,isLoading:l}=(0,E.useSalesData)(g?.id),{expenses:m,isLoading:n}=(0,F.useExpenses)(),{stockSummaryData:o,isLoading:p}=(0,G.useStockSummaryData)(b),{carriageInwards:q,isLoading:r}=(0,H.useCarriageInwards)();return{profitLossData:(0,c.useMemo)(()=>{let c,d;if("specific"===a&&e)(c=new Date(e)).setHours(0,0,0,0),(d=new Date(e)).setHours(23,59,59,999);else if("custom"===a&&b.from&&b.to)c=b.from,d=b.to;else{let b=(0,I.getDateRangeFromFilter)(a);c=b.from,d=b.to}let g=k.filter(b=>{let f=new Date(b.date);return"specific"===a&&e?(0,J.isSameDay)(f,e)&&"Quote"!==b.paymentStatus:f>=c&&f<=d&&"Quote"!==b.paymentStatus}),h=m.filter(b=>{let f=new Date(b.date);return"specific"===a&&e?(0,J.isSameDay)(f,e):f>=c&&f<=d}),i=q.filter(b=>{let f=new Date(b.date);return"specific"===a&&e?(0,J.isSameDay)(f,e):f>=c&&f<=d}),j=g.reduce((a,b)=>a+b.items.reduce((a,b)=>a+b.price*b.quantity,0),0),l=o.reduce((a,b)=>a+b.returnIn*b.sellingPrice,0),n=j-l,p=o.reduce((a,b)=>a+b.openingStock*b.costPrice,0),r=o.reduce((a,b)=>a+b.stockIn*b.costPrice,0),s=i.reduce((a,b)=>a+b.amount,0),t=o.reduce((a,b)=>a+b.closingStock*b.costPrice,0),u=g.reduce((a,b)=>a+b.items.reduce((a,b)=>a+(b.cost||0)*b.quantity,0),0),v=u+s,w=n-v,x={};h.forEach(a=>{let b=a.category||"Uncategorized";x[b]=(x[b]||0)+a.amount});let y=Object.values(x).reduce((a,b)=>a+b,0),z=w-y,A=z>0?z*f/100:0;return{sales:j,salesReturns:l,netSales:n,openingStock:p,purchases:r,carriageInwards:s,closingStock:t,totalCostSales:u,totalCOGS:v,grossProfit:w,expensesByCategory:x,totalExpenses:y,netProfitLoss:z,taxPercentage:f,taxAmount:A,finalProfitAfterTax:z-A}},[k,m,o,q,a,b,e,f]),isLoading:(0,c.useMemo)(()=>l||n||p||r,[l,n,p,r])}})(f,h,j,l),s=(0,c.useMemo)(()=>"custom"===f&&h.from&&h.to?h:"specific"===f&&j?{from:j,to:j}:"custom"!==f&&"specific"!==f?(0,I.getDateRangeFromFilter)(f):{from:void 0,to:void 0},[f,h,j]);return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Profit & Loss Account"}),(0,b.jsx)(K.default,{dateFilter:f,dateRange:h,specificDate:j,isCustomRange:n,isSpecificDate:o,onDateFilterChange:g,onDateRangeChange:i,onSpecificDateChange:k})]}),(0,b.jsx)(Y,{data:q,isLoading:r,formatCurrency:a=>new Intl.NumberFormat("en-US",{style:"currency",currency:p,minimumFractionDigits:2}).format(a),onTaxChange:m,dateRange:s,businessName:a?.name,businessLogo:e?.businessLogo,currency:p,dateFilter:f})]})},$=({accounts:a,isLoading:d,isDialogOpen:e,onDialogOpenChange:g,onCreateAccount:h,onAccountDeleted:i,canCreate:k=!0})=>{let[l,m]=c.default.useState(!1),n=()=>g(!0),o=async a=>{m(!0);try{await h(a)}finally{m(!1)}};return(0,b.jsxs)(f.Tabs,{defaultValue:"cash-accounts",className:"w-full",children:[(0,b.jsxs)(f.TabsList,{className:"grid w-full grid-cols-2",children:[(0,b.jsx)(f.TabsTrigger,{value:"cash-accounts",children:"Cash Accounts"}),(0,b.jsx)(f.TabsTrigger,{value:"profit-loss",children:"Profit & Loss"})]}),(0,b.jsxs)(f.TabsContent,{value:"cash-accounts",className:"space-y-6",children:[(0,b.jsx)(j,{onCreateAccount:n,canCreate:k}),(0,b.jsx)(B,{accounts:a,isLoading:d,onCreateAccount:n,onAccountDeleted:i,canCreate:k}),(0,b.jsx)(C.default,{open:e,onOpenChange:g,onSubmit:o,title:"Create New Cash Account",isSubmitting:l})]}),(0,b.jsx)(f.TabsContent,{value:"profit-loss",children:(0,b.jsx)(Z,{})})]})};var _=a.i(124348),aa=a.i(292e3);a.s(["default",0,()=>{let{currentBusiness:a,isLoading:f}=(0,d.useBusiness)(),g=(0,k.useNavigate)(),{accounts:i,isLoading:j,createAccount:l,refreshAccounts:m}=(0,e.useCashAccounts)(),{hasPermission:n,isLoading:o}=(0,y.useProfiles)(),[p,q]=(0,c.useState)(!1);(a=>{let b=(0,k.useNavigate)(),[d,e]=(0,c.useState)(!1);return(0,c.useEffect)(()=>{if(!d&&a.length>0){let c=localStorage.getItem("lastVisitedCashAccount"),d=localStorage.getItem("lastVisitedCashAccountUrl");if(c&&d){if(a.some(a=>a.id===c))return void b(d.replace(window.location.origin,""));localStorage.removeItem("lastVisitedCashAccount"),localStorage.removeItem("lastVisitedCashAccountUrl")}e(!0)}},[a,d,b])})(i);let r=async a=>{try{await l(a),q(!1)}catch(a){console.error("Error creating account:",a)}},s=async()=>{await m()};if(f||j||o)return(0,b.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,b.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})});if(!n("finance","view"))return(0,b.jsxs)("div",{className:"max-w-4xl mx-auto p-6",children:[(0,b.jsxs)(_.Alert,{variant:"destructive",children:[(0,b.jsx)(aa.AlertCircle,{className:"h-4 w-4"}),(0,b.jsx)(_.AlertTitle,{children:"Access Denied"}),(0,b.jsx)(_.AlertDescription,{children:"You do not have permission to view finance/cash accounts. Please contact your administrator if you believe this is an error."})]}),(0,b.jsx)("div",{className:"mt-4",children:(0,b.jsx)(h.Button,{onClick:()=>g("/"),variant:"outline",children:"Back to Dashboard"})})]});let t=n("finance","create");return(0,b.jsxs)("div",{className:"space-y-6 p-4 md:p-0",children:[(0,b.jsx)("h1",{className:"text-2xl md:text-3xl font-bold",children:"Finance"}),(0,b.jsx)($,{accounts:i,isLoading:f||!a||j,isDialogOpen:p,onDialogOpenChange:q,onCreateAccount:r,onAccountDeleted:s,canCreate:t})]})}],280071)}];

//# sourceMappingURL=src_pages_Cash_tsx_21c582ff._.js.map