module.exports=[419676,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(665967),e=a.i(357999),f=a.i(915618),g=a.i(922520),h=a.i(824569),i=a.i(773320),j=a.i(284505),k=a.i(400210),l=a.i(328790),m=a.i(257344),n=a.i(170106);let o=(0,n.default)("ArrowRightLeft",[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]]);var p=a.i(957064),q=a.i(501027),r=a.i(596221),s=a.i(699570),t=a.i(591119),u=a.i(169819),v=a.i(291914),w=a.i(129743),x=a.i(866102),y=a.i(770094),z=a.i(695245),A=a.i(814574),B=a.i(269876),C=a.i(866718),D=a.i(870430),E=a.i(429246),F=a.i(580701),G=a.i(177156),H=a.i(104720),I=a.i(633508),J=a.i(847449),K=a.i(371844),L=a.i(478793);let M=({open:a,onOpenChange:d,onSubmit:e,accounts:f,defaultAccountId:g,presetTransactionType:h})=>{let{register:i,handleSubmit:j,formState:{errors:k},reset:l,watch:m,setValue:n}=(0,z.useForm)({defaultValues:{accountId:g||"",transactionType:h||"cash_in",category:"",description:"",personInCharge:"",tags:[],date:new Date,paymentMethod:"",receiptImage:""}}),o=m("transactionType"),p=m("receiptImage"),q=(0,y.useIsMobile)(),[r,t]=(0,c.useState)(!1),[u,v]=(0,c.useState)(!1),{toast:w}=(0,L.useToast)();c.default.useEffect(()=>{if(a){let a=new Date,b=a.toISOString().split("T")[0];l({accountId:g||"",amount:void 0,transactionType:h||"cash_in",category:"",description:"",personInCharge:"",tags:[],date:a,paymentMethod:"",receiptImage:""}),h&&n("transactionType",h),n("date",b)}},[a,g,h,l,n]);let x=a=>a&&a.includes("pdf"),M=async a=>{console.log("Raw form data:",a),v(!0);try{let b;b=a.date instanceof Date?a.date:"string"==typeof a.date?new Date(a.date):new Date;let c={accountId:a.accountId,amount:Number(a.amount),transactionType:a.transactionType,toAccountId:a.toAccountId,category:a.category,description:a.description,personInCharge:a.personInCharge,tags:[],date:b,paymentMethod:a.paymentMethod,receiptImage:a.receiptImage};console.log("Processed form data being submitted:",c),await e(c)}finally{v(!1)}};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(A.Dialog,{open:a,onOpenChange:d,children:(0,b.jsxs)(A.DialogContent,{className:`${q?"max-h-[85vh] w-[95vw] max-w-none":"sm:max-w-[500px]"}`,children:[(0,b.jsx)(A.DialogHeader,{className:q?"pb-2":"",children:(0,b.jsx)(A.DialogTitle,{children:"New Transaction"})}),(0,b.jsx)(B.ScrollArea,{className:q?"h-[calc(85vh-120px)] pr-4":"max-h-[70vh]",children:(0,b.jsxs)("form",{onSubmit:j(M),className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(D.Label,{htmlFor:"accountId",children:"Account"}),(0,b.jsxs)(F.Select,{value:m("accountId"),onValueChange:a=>{n("accountId",a),setTimeout(()=>{let a=document.querySelectorAll('[role="combobox"]')[1];a?.focus()},100)},children:[(0,b.jsx)(F.SelectTrigger,{onKeyDown:a=>{"Enter"===a.key&&(a.preventDefault(),setTimeout(()=>{let a=document.querySelectorAll('[role="combobox"]')[1];a?.focus()},100))},children:(0,b.jsx)(F.SelectValue,{placeholder:"Select account"})}),(0,b.jsx)(F.SelectContent,{children:f.map(a=>(0,b.jsx)(F.SelectItem,{value:a.id,children:a.name},a.id))})]}),k.accountId&&(0,b.jsx)("p",{className:"text-sm text-red-600",children:k.accountId.message})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(D.Label,{htmlFor:"transactionType",children:"Transaction Type"}),(0,b.jsxs)(F.Select,{value:o,onValueChange:a=>{n("transactionType",a),setTimeout(()=>{if("transfer"===a){let a=document.querySelectorAll('[role="combobox"]')[2];a?.focus()}else document.getElementById("amount")?.focus()},100)},children:[(0,b.jsx)(F.SelectTrigger,{onKeyDown:a=>{"Enter"===a.key&&(a.preventDefault(),setTimeout(()=>{if("transfer"===o){let a=document.querySelectorAll('[role="combobox"]')[2];a?.focus()}else document.getElementById("amount")?.focus()},100))},children:(0,b.jsx)(F.SelectValue,{})}),(0,b.jsxs)(F.SelectContent,{children:[(0,b.jsx)(F.SelectItem,{value:"cash_in",children:"Cash In"}),(0,b.jsx)(F.SelectItem,{value:"cash_out",children:"Cash Out"}),(0,b.jsx)(F.SelectItem,{value:"transfer",children:"Transfer"})]})]})]}),"transfer"===o&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(D.Label,{htmlFor:"toAccountId",children:"To Account"}),(0,b.jsxs)(F.Select,{value:m("toAccountId")||"",onValueChange:a=>{n("toAccountId",a),setTimeout(()=>{document.getElementById("amount")?.focus()},100)},children:[(0,b.jsx)(F.SelectTrigger,{onKeyDown:a=>{"Enter"===a.key&&(a.preventDefault(),setTimeout(()=>{document.getElementById("amount")?.focus()},100))},children:(0,b.jsx)(F.SelectValue,{placeholder:"Select destination account"})}),(0,b.jsx)(F.SelectContent,{children:f.filter(a=>a.id!==m("accountId")).map(a=>(0,b.jsx)(F.SelectItem,{value:a.id,children:a.name},a.id))})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(D.Label,{htmlFor:"amount",children:"Amount"}),(0,b.jsx)(C.Input,{id:"amount",type:"number",step:"0.01",...i("amount",{required:"Amount is required",min:{value:.01,message:"Amount must be greater than 0"}}),onKeyDown:a=>{"Enter"===a.key&&(a.preventDefault(),document.getElementById("category")?.focus())},placeholder:"0.00"}),k.amount&&(0,b.jsx)("p",{className:"text-sm text-red-600",children:k.amount.message})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(D.Label,{htmlFor:"category",children:"Category (Optional)"}),(0,b.jsx)(C.Input,{id:"category",...i("category"),onKeyDown:a=>{"Enter"===a.key&&(a.preventDefault(),document.getElementById("description")?.focus())},placeholder:"e.g., Sales, Expense, Investment"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(D.Label,{htmlFor:"description",children:"Description"}),(0,b.jsx)(E.Textarea,{id:"description",...i("description",{required:"Description is required"}),onKeyDown:a=>{"Enter"!==a.key||a.shiftKey||(a.preventDefault(),document.getElementById("personInCharge")?.focus())},placeholder:"Transaction description",rows:3,className:q?"min-h-[80px]":""}),k.description&&(0,b.jsx)("p",{className:"text-sm text-red-600",children:k.description.message})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(D.Label,{htmlFor:"personInCharge",children:"Person in Charge (Optional)"}),(0,b.jsx)(C.Input,{id:"personInCharge",...i("personInCharge"),onKeyDown:a=>{"Enter"===a.key&&(a.preventDefault(),document.getElementById("paymentMethod")?.focus())},placeholder:"e.g., John Doe, Manager"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(D.Label,{htmlFor:"paymentMethod",children:"Payment Method (Optional)"}),(0,b.jsx)(C.Input,{id:"paymentMethod",...i("paymentMethod"),onKeyDown:a=>{"Enter"===a.key&&(a.preventDefault(),document.getElementById("date")?.focus())},placeholder:"e.g., Cash, Credit Card, Bank Transfer"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(D.Label,{htmlFor:"receiptImage",children:"Receipt (Image or PDF) (Optional)"}),(0,b.jsx)(C.Input,{id:"receiptImage",type:"file",accept:"image/*,.pdf",onChange:a=>{let b=a.target.files?.[0];if(b){let a=b.type.startsWith("image/"),c="application/pdf"===b.type;if(!a&&!c)return void w({title:"Error",description:"Please select an image or PDF file",variant:"destructive"});n("receiptImage",URL.createObjectURL(b))}},className:"cursor-pointer"}),p&&(0,b.jsx)("div",{className:"mt-2 relative",children:x(p)?(0,b.jsxs)("div",{className:"flex items-center gap-2 p-3 border rounded",children:[(0,b.jsx)(H.FileText,{className:"h-8 w-8 text-red-600"}),(0,b.jsx)("span",{className:"text-sm",children:"PDF Receipt"}),(0,b.jsx)(s.Button,{type:"button",variant:"destructive",size:"sm",className:"ml-auto h-6 w-6 rounded-full p-0",onClick:()=>{n("receiptImage","")},children:(0,b.jsx)(I.X,{className:"h-3 w-3"})})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("img",{src:p,alt:"Receipt preview",className:"max-w-full h-32 object-contain border rounded cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>t(!0)}),(0,b.jsx)(s.Button,{type:"button",variant:"secondary",size:"sm",className:"absolute top-2 right-2 opacity-80 hover:opacity-100",onClick:()=>t(!0),children:(0,b.jsx)(G.Eye,{className:"h-4 w-4"})})]})})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(D.Label,{htmlFor:"date",children:"Date"}),(0,b.jsx)(C.Input,{id:"date",type:"date",...i("date",{required:"Date is required"}),onKeyDown:a=>{if("Enter"===a.key){a.preventDefault();let b=document.querySelector('button[type="submit"]');b?.focus()}}}),k.date&&(0,b.jsx)("p",{className:"text-sm text-red-600",children:k.date.message})]}),(0,b.jsxs)("div",{className:`flex ${q?"flex-col gap-2":"justify-end space-x-2"} pt-4`,children:[(0,b.jsx)(s.Button,{type:"button",variant:"outline",onClick:()=>d(!1),className:q?"w-full":"",disabled:u,children:"Cancel"}),(0,b.jsx)(s.Button,{type:"submit",className:q?"w-full":"",disabled:u,children:u?(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(K.default,{size:"sm",className:"!space-y-0"}),(0,b.jsx)("span",{children:"Creating Transaction..."})]}):"Create Transaction"})]})]})})]})}),p&&!x(p)&&(0,b.jsx)(J.default,{isOpen:r,onOpenChange:t,imageUrl:p,imageAlt:"Receipt preview"})]})},N=({open:a,onOpenChange:d,onSubmit:e,transaction:f,accounts:g})=>{let{register:h,handleSubmit:i,formState:{errors:j},reset:k,watch:l,setValue:m}=(0,z.useForm)(),n=(0,y.useIsMobile)(),[o,p]=(0,c.useState)(!1),[q,r]=(0,c.useState)(!1),{toast:t}=(0,L.useToast)();c.default.useEffect(()=>{if(a&&f){let a=f.date.toISOString().split("T")[0];k({accountId:f.accountId||"",amount:f.amount,transactionType:"transfer_in"===f.transactionType||"transfer_out"===f.transactionType?"transfer":f.transactionType,category:f.category,description:f.description,personInCharge:f.personInCharge||"",tags:[],date:f.date,paymentMethod:f.paymentMethod||"",receiptImage:f.receiptImage||""}),m("date",a)}},[a,f,k,m]);let u=a=>a&&a.includes("pdf"),v=async a=>{if(f){r(!0);try{let b;if("string"==typeof a.date){let[c,d,e]=a.date.split("-").map(Number);b=new Date(c,d-1,e,12,0,0)}else b=a.date instanceof Date?a.date:new Date;let c={amount:Number(a.amount),category:a.category,description:a.description,personInCharge:a.personInCharge,tags:[],date:b,paymentMethod:a.paymentMethod,receiptImage:a.receiptImage};await e(f.id,c)}finally{r(!1)}}};return f?(f.date.toISOString().split("T")[0],(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(A.Dialog,{open:a,onOpenChange:d,children:(0,b.jsxs)(A.DialogContent,{className:`${n?"max-h-[85vh] w-[95vw] max-w-none":"sm:max-w-[500px]"}`,children:[(0,b.jsx)(A.DialogHeader,{className:n?"pb-2":"",children:(0,b.jsx)(A.DialogTitle,{children:"Edit Transaction"})}),(0,b.jsx)(B.ScrollArea,{className:n?"h-[calc(85vh-120px)] pr-4":"max-h-[70vh]",children:(0,b.jsxs)("form",{onSubmit:i(v),className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(D.Label,{htmlFor:"transactionType",children:"Transaction Type"}),(0,b.jsx)(C.Input,{value:f.transactionType.replace("_"," "),disabled:!0,className:"bg-gray-100"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(D.Label,{htmlFor:"amount",children:"Amount"}),(0,b.jsx)(C.Input,{id:"amount",type:"number",step:"1",...h("amount",{required:"Amount is required",min:{value:1,message:"Amount must be at least 1"}}),placeholder:"0"}),j.amount&&(0,b.jsx)("p",{className:"text-sm text-red-600",children:j.amount.message})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(D.Label,{htmlFor:"category",children:"Category (Optional)"}),(0,b.jsx)(C.Input,{id:"category",...h("category"),placeholder:"e.g., Sales, Expense, Investment"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(D.Label,{htmlFor:"description",children:"Description"}),(0,b.jsx)(E.Textarea,{id:"description",...h("description",{required:"Description is required"}),placeholder:"Transaction description",rows:3,className:n?"min-h-[80px]":""}),j.description&&(0,b.jsx)("p",{className:"text-sm text-red-600",children:j.description.message})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(D.Label,{htmlFor:"personInCharge",children:"Person in Charge (Optional)"}),(0,b.jsx)(C.Input,{id:"personInCharge",...h("personInCharge"),placeholder:"e.g., John Doe, Manager"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(D.Label,{htmlFor:"paymentMethod",children:"Payment Method (Optional)"}),(0,b.jsx)(C.Input,{id:"paymentMethod",...h("paymentMethod"),placeholder:"e.g., Cash, Credit Card, Bank Transfer"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(D.Label,{htmlFor:"receiptImage",children:"Receipt (Image or PDF) (Optional)"}),(0,b.jsx)(C.Input,{id:"receiptImage",type:"file",accept:"image/*,.pdf",onChange:a=>{let b=a.target.files?.[0];if(b){let a=b.type.startsWith("image/"),c="application/pdf"===b.type;if(!a&&!c)return void t({title:"Error",description:"Please select an image or PDF file",variant:"destructive"});m("receiptImage",URL.createObjectURL(b))}},className:"cursor-pointer"}),l("receiptImage")&&(0,b.jsx)("div",{className:"mt-2 relative",children:u(l("receiptImage"))?(0,b.jsxs)("div",{className:"flex items-center gap-2 p-3 border rounded",children:[(0,b.jsx)(H.FileText,{className:"h-8 w-8 text-red-600"}),(0,b.jsx)("span",{className:"text-sm",children:"PDF Receipt"}),(0,b.jsx)(s.Button,{type:"button",variant:"destructive",size:"sm",className:"ml-auto h-6 w-6 rounded-full p-0",onClick:()=>{m("receiptImage","")},children:(0,b.jsx)(I.X,{className:"h-3 w-3"})})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("img",{src:l("receiptImage"),alt:"Receipt preview",className:"max-w-full h-32 object-contain border rounded cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>p(!0)}),(0,b.jsx)(s.Button,{type:"button",variant:"secondary",size:"sm",className:"absolute top-2 right-2 opacity-80 hover:opacity-100",onClick:()=>p(!0),children:(0,b.jsx)(G.Eye,{className:"h-4 w-4"})})]})})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(D.Label,{htmlFor:"edit-date",children:"Date"}),(0,b.jsx)(C.Input,{id:"edit-date",type:"date",...h("date",{required:"Date is required"})}),j.date&&(0,b.jsx)("p",{className:"text-sm text-red-600",children:j.date.message})]}),(0,b.jsxs)("div",{className:`flex ${n?"flex-col gap-2":"justify-end space-x-2"} pt-4`,children:[(0,b.jsx)(s.Button,{type:"button",variant:"outline",onClick:()=>d(!1),className:n?"w-full":"",disabled:q,children:"Cancel"}),(0,b.jsx)(s.Button,{type:"submit",className:n?"w-full":"",disabled:q,children:q?(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(K.default,{size:"sm",className:"!space-y-0"}),(0,b.jsx)("span",{children:"Updating Transaction..."})]}):"Update Transaction"})]})]})})]})}),l("receiptImage")&&!u(l("receiptImage"))&&(0,b.jsx)(J.default,{isOpen:o,onOpenChange:p,imageUrl:l("receiptImage"),imageAlt:"Receipt preview"})]})):null};var O=a.i(625361),P=a.i(786304);let Q=({transaction:a,open:d,onOpenChange:e})=>{var f;let g,h=(0,y.useIsMobile)(),[i,j]=(0,c.useState)(!1),{settings:k}=(0,x.useBusinessSettings)();if(!a)return null;let l=(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Date"}),(0,b.jsx)("p",{className:"text-sm",children:a.date.toLocaleDateString()})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Amount"}),(0,b.jsx)("p",{className:`text-lg font-semibold ${"cash_in"===a.transactionType||"transfer_in"===a.transactionType?"text-green-600":"text-red-600"}`,children:(f=a.amount,g=k?.currency||"USD",new Intl.NumberFormat("en-US",{style:"currency",currency:g,minimumFractionDigits:0,maximumFractionDigits:0}).format(f))})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Transaction Type"}),(0,b.jsx)(P.Badge,{className:(a=>{switch(a){case"cash_in":case"transfer_in":return"bg-green-100 text-green-800";case"cash_out":case"transfer_out":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}})(a.transactionType),children:(a=>{switch(a){case"cash_in":return"Cash In";case"cash_out":return"Cash Out";case"transfer_in":return"Transfer In";case"transfer_out":return"Transfer Out";default:return a}})(a.transactionType)})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Description"}),(0,b.jsx)("p",{className:"text-sm",children:a.description})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Category"}),(0,b.jsx)("p",{className:"text-sm",children:a.category||"Not specified"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Payment Method"}),(0,b.jsx)("p",{className:"text-sm",children:a.paymentMethod||"Not specified"})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Person in Charge"}),(0,b.jsx)("p",{className:"text-sm",children:a.personInCharge||"Not specified"})]}),a.tags&&a.tags.length>0&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Tags"}),(0,b.jsx)("div",{className:"flex flex-wrap gap-1",children:a.tags.map((a,c)=>(0,b.jsx)(P.Badge,{variant:"outline",className:"text-xs",children:a},c))})]}),a.receiptImage&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Receipt"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("img",{src:a.receiptImage,alt:"Receipt",className:"max-w-full h-32 object-contain border rounded cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>j(!0)}),(0,b.jsx)(s.Button,{variant:"secondary",size:"sm",className:"absolute top-2 right-2 opacity-80 hover:opacity-100",onClick:()=>j(!0),children:(0,b.jsx)(G.Eye,{className:"h-4 w-4"})})]})]})]});return h?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(O.Drawer,{open:d,onOpenChange:e,children:(0,b.jsx)(O.DrawerContent,{className:"max-h-[85vh]",children:(0,b.jsxs)("div",{className:"relative px-4 py-6 pb-8",children:[(0,b.jsxs)(O.DrawerClose,{className:"absolute right-4 top-4 rounded-sm opacity-70 hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring",children:[(0,b.jsx)(I.X,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"sr-only",children:"Close"})]}),(0,b.jsx)(O.DrawerHeader,{className:"px-0 pb-4",children:(0,b.jsx)(O.DrawerTitle,{className:"text-lg",children:"Transaction Details"})}),(0,b.jsx)(B.ScrollArea,{className:"h-[calc(85vh-120px)] pr-4",children:l})]})})}),a.receiptImage&&(0,b.jsx)(J.default,{isOpen:i,onOpenChange:j,imageUrl:a.receiptImage,imageAlt:"Receipt image"})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(A.Dialog,{open:d,onOpenChange:e,children:(0,b.jsxs)(A.DialogContent,{className:"sm:max-w-[600px] max-h-[90vh]",children:[(0,b.jsx)(A.DialogHeader,{children:(0,b.jsx)(A.DialogTitle,{children:"Transaction Details"})}),(0,b.jsx)(B.ScrollArea,{className:"max-h-[70vh] pr-4",children:l})]})}),a.receiptImage&&(0,b.jsx)(J.default,{isOpen:i,onOpenChange:j,imageUrl:a.receiptImage,imageAlt:"Receipt image"})]})};var R=a.i(892984),S=a.i(256711),T=a.i(781560),U=a.i(206015),V=a.i(486192),W=a.i(932596),X=a.i(368114),Y=a.i(587532);let Z=({searchTerm:a,onSearchChange:c,transactionTypeFilter:d,onTransactionTypeFilterChange:e,onExportCSV:f,onExportPDF:g,totalTransactions:h})=>(0,b.jsxs)("div",{className:"space-y-4 mb-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(Y.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(C.Input,{placeholder:"Search transactions...",value:a,onChange:a=>c(a.target.value),className:"pl-10"})]}),(0,b.jsxs)(F.Select,{value:d,onValueChange:e,children:[(0,b.jsx)(F.SelectTrigger,{children:(0,b.jsx)(F.SelectValue,{placeholder:"All transaction types"})}),(0,b.jsxs)(F.SelectContent,{children:[(0,b.jsx)(F.SelectItem,{value:"all",children:"All Types"}),(0,b.jsx)(F.SelectItem,{value:"cash_in",children:"Cash In"}),(0,b.jsx)(F.SelectItem,{value:"cash_out",children:"Cash Out"}),(0,b.jsx)(F.SelectItem,{value:"transfer_in",children:"Transfer In"}),(0,b.jsx)(F.SelectItem,{value:"transfer_out",children:"Transfer Out"})]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(s.Button,{variant:"outline",size:"sm",onClick:f,className:"flex-1 sm:flex-none",children:[(0,b.jsx)(j.Download,{className:"h-4 w-4 mr-2"}),"CSV"]}),(0,b.jsxs)(s.Button,{variant:"outline",size:"sm",onClick:g,className:"flex-1 sm:flex-none",children:[(0,b.jsx)(H.FileText,{className:"h-4 w-4 mr-2"}),"PDF"]})]})]}),(0,b.jsxs)("div",{className:"text-sm text-muted-foreground",children:[h," transaction",1!==h?"s":""," found"]})]});var $=a.i(890914),_=a.i(400291);let aa=({transactions:a,accountId:d,showAccountColumn:f=!0,onEditTransaction:g,onViewTransaction:i,onTransactionDeleted:j})=>{let{deleteTransaction:k,transactions:l}=(0,w.useCashTransactions)(d||void 0),{accounts:m}=(0,v.useCashAccounts)(),{settings:n}=(0,x.useBusinessSettings)(),{hasPermission:o}=(0,$.useProfiles)(),{canManageFinanceAccounts:p}=(0,_.useFinancialVisibility)(),[q,r]=(0,c.useState)(null),t=(0,y.useIsMobile)(),u=o("finance","edit"),z=o("finance","delete"),[A,B]=(0,e.useSearchParams)(),[C,D]=(0,c.useState)(()=>A.get("search")||""),[E,F]=(0,c.useState)(()=>A.get("type")||"all");(0,c.useEffect)(()=>{let a=A.get("search")||"",b=A.get("type")||"all";D(a),F(b)},[A]);let H=a=>(0,X.formatCashAmount)(a,n.currency||"USD"),I=a=>{if(!a)return"Unknown Account";let b=m.find(b=>b.id===a);return b?.name||"Unknown Account"},J=a.filter(a=>{let b=a.description.toLowerCase().includes(C.toLowerCase())||a.category&&a.category.toLowerCase().includes(C.toLowerCase())||a.personInCharge&&a.personInCharge.toLowerCase().includes(C.toLowerCase())||I(a.accountId).toLowerCase().includes(C.toLowerCase()),c="all"===E||a.transactionType===E;return b&&c}),[K,L]=(0,c.useState)(1),M=Math.ceil(J.length/50),N=(K-1)*50,O=N+50,Q=J.slice(N,O);(0,c.useEffect)(()=>{L(1)},[C,E]);let R=a=>{switch(a){case"cash_in":return"bg-green-100 text-green-800 border-green-200";case"cash_out":return"bg-red-100 text-red-800 border-red-200";case"transfer_in":return"bg-blue-100 text-blue-800 border-blue-200";case"transfer_out":return"bg-orange-100 text-orange-800 border-orange-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},Y=a=>{switch(a){case"cash_in":return"Cash In";case"cash_out":return"Cash Out";case"transfer_in":return"Transfer In";case"transfer_out":return"Transfer Out";default:return a}},aa=a=>{switch(a){case"cash_in":case"transfer_in":return"text-green-600 font-semibold";case"cash_out":case"transfer_out":return"text-red-600 font-semibold";default:return"font-semibold"}},ab=async a=>{r(a);try{await k(a)&&j&&j()}catch(a){console.error("Error deleting transaction:",a)}finally{r(null)}},ac=async()=>{if(0===J.length)return void alert("No transactions to export");try{let a="";if(d){let b=m.find(a=>a.id===d);a=b?.name||""}let b=((a,b)=>{if(0===a.length)return 0;let c=new Date(a.reduce((a,b)=>b.date<a?b.date:a,a[0].date));c.setDate(c.getDate()-1);let d=c.toISOString().split("T")[0],e=l.filter(a=>a.date.toISOString().split("T")[0]<=d);b&&(e=e.filter(a=>a.accountId===b));let f=e.filter(a=>"cash_in"===a.transactionType||"transfer_in"===a.transactionType).reduce((a,b)=>a+b.amount,0),g=e.filter(a=>"cash_out"===a.transactionType||"transfer_out"===a.transactionType).reduce((a,b)=>a+b.amount,0),h=0;if(b){let a=m.find(a=>a.id===b);h=a?.openingBalance||0}return h+f-g})(J,d||void 0),c=(a=>{if(0===a.length)return;let b=a.map(a=>a.date);return{from:new Date(Math.min(...b.map(a=>a.getTime()))),to:new Date(Math.max(...b.map(a=>a.getTime())))}})(J);((a,b,c,d,e=0,f="USD",g,h)=>{let i;if(0===a.length)return alert("No transactions to export");let j=[...a].sort((a,b)=>{let c=b.date.getTime()-a.date.getTime();return 0!==c?c:b.createdAt.getTime()-a.createdAt.getTime()}),k=[...a].sort((a,b)=>{let c=a.date.getTime()-b.date.getTime();return 0!==c?c:a.createdAt.getTime()-b.createdAt.getTime()}),l=k.filter(a=>"cash_in"===a.transactionType).reduce((a,b)=>a+b.amount,0),m=k.filter(a=>"cash_out"===a.transactionType).reduce((a,b)=>a+b.amount,0),n=k.filter(a=>"transfer_in"===a.transactionType).reduce((a,b)=>a+b.amount,0),o=k.filter(a=>"transfer_out"===a.transactionType).reduce((a,b)=>a+b.amount,0),p=e,q=new Map;k.forEach(a=>{"cash_in"===a.transactionType?p+=a.amount:"cash_out"===a.transactionType?p-=a.amount:"transfer_in"===a.transactionType?p+=a.amount:"transfer_out"===a.transactionType&&(p-=a.amount),q.set(a.id,p)});let r=j.map(a=>({...a,balance:q.get(a.id)||0,formattedType:(a=>{switch(a){case"cash_in":return"Cash In";case"cash_out":return"Cash Out";case"transfer_in":return"Transfer In";case"transfer_out":return"Transfer Out";default:return a}})(a.transactionType)})),s=p,t=new W.default({orientation:"portrait",unit:"mm",format:"a4",compress:!0}),u=t.internal.pageSize.getWidth(),v=t.internal.pageSize.getHeight(),w=u-15-15,x=15,y=()=>{t.setFontSize(8),t.setFont("helvetica","normal"),t.setTextColor(150,150,150),t.text("Created By Gonza Systems",u/2,v-10,{align:"center"}),t.setTextColor(0,0,0)},z=[30,55,35,30,30],A=["Date","Description","Transaction Type","Amount","Balance"],B=()=>{t.setFillColor(243,244,246),t.rect(15,x-2,w,10,"F"),t.setLineWidth(.3),t.rect(15,x-2,w,10),t.setFontSize(11),t.setFont("helvetica","bold");let a=15;A.forEach((b,c)=>{let d=z[c],e=t.getTextWidth(b),f=a+(d-e)/2;t.text(b,f,x+6),c<A.length-1&&t.line(a+d,x-2,a+d,x+10-2),a+=d}),x+=10},C=a=>x+a>v-15-15&&(y(),t.addPage(),x=15,B(),t.setFont("helvetica","normal"),t.setFontSize(9),!0),D=x;h&&(t.setFontSize(12),t.setFont("helvetica","bold"),t.text(h.businessName,15,x),x+=6,t.setFontSize(9),t.setFont("helvetica","normal"),t.text(h.businessAddress,15,x),x+=5,t.text(h.businessPhone,15,x),x+=5,t.text(h.businessEmail,15,x)),x=D,t.setFontSize(18),t.setFont("helvetica","bold");let E=`Cash Transactions Report (${f})`,F=t.getTextWidth(E);if(t.text(E,u-15-F,x),x+=8,d){t.setFontSize(14),t.setFont("helvetica","normal");let a=t.getTextWidth(d);t.text(d,u-15-a,x),x+=6}if(g?.from&&g?.to){t.setFontSize(12),t.setFont("helvetica","normal");let a=(0,S.format)(g.from,"dd/MM/yyyy"),b=(0,S.format)(g.to,"dd/MM/yyyy"),c=a===b?a:`${a} - ${b}`,d=t.getTextWidth(c);t.text(c,u-15-d,x),x+=12}else{let b;if(t.setFontSize(12),t.setFont("helvetica","normal"),a.length>0){let c=a.map(a=>a.date),d=new Date(Math.min(...c.map(a=>a.getTime()))),e=new Date(Math.max(...c.map(a=>a.getTime()))),f=(0,S.format)(d,"dd/MM/yyyy"),g=(0,S.format)(e,"dd/MM/yyyy");b=f===g?f:`${f} - ${g}`}else b=(0,S.format)(new Date,"dd/MM/yyyy");let c=t.getTextWidth(b);t.text(b,u-15-c,x),x+=12}x=Math.max(x,D+25),C(20),B(),t.setFont("helvetica","normal"),t.setFontSize(9);let G=new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0});r.forEach((a,b)=>{C(13);let c="cash_out"===a.transactionType||"transfer_out"===a.transactionType?-a.amount:a.amount,d=[(0,S.format)(a.date,"dd/MM/yyyy"),a.description,a.formattedType,G.format(c),G.format(a.balance)];b%2==0&&(t.setFillColor(249,250,251),t.rect(15,x-1,w,8,"F")),t.setLineWidth(.1),t.rect(15,x-1,w,8);let e=15;d.forEach((a,b)=>{let c=z[b],f=a;if(1===b)for(;t.getTextWidth(f)>c-4&&f.length>3;)f=f.substring(0,f.length-4)+"...";else if(3===b||4===b){let a=9;for(t.setFontSize(a);t.getTextWidth(f)>c-4&&a>6;)a-=.5,t.setFontSize(a)}let g=e+2;if(3===b||4===b){let a=t.getTextWidth(f);g=e+c-a-2}t.setTextColor(0,0,0),t.text(f,g,x+5),t.setFontSize(9),b<d.length-1&&t.line(e+c,x-1,e+c,x+8-1),e+=c}),x+=8}),x+=10,C(35),t.setFontSize(16),t.setFont("helvetica","bold"),t.text("Summary",15,x),x+=8;let H=.9*w;t.setFillColor(248,249,250),t.rect(15,x-3,H,30,"F"),t.setLineWidth(.3),t.setDrawColor(200,200,200),t.rect(15,x-3,H,30),t.setFontSize(11),t.setFont("helvetica","normal");let I=[["Opening Balance:",G.format(e)],["Total Cash In:",G.format(l)],["Total Cash Out:",G.format(m)],["Final Balance:",G.format(s)]],J=[["Total Transfer In:",G.format(n)],["Total Transfer Out:",G.format(o)]],K=x+3,L=25,M=15+H/2+10;I.forEach(([a,b])=>{t.setFont("helvetica","bold"),t.text(a,L,K),t.setFont("helvetica","normal");let c=t.getTextWidth(a);t.text(b,L+c+5,K),K+=6}),K=x+3,J.forEach(([a,b])=>{t.setFont("helvetica","bold"),t.text(a,M,K),t.setFont("helvetica","normal");let c=t.getTextWidth(a);t.text(b,M+c+5,K),K+=6}),y();let N=d?d.replace(/[^a-z0-9]/gi,"-").toLowerCase()+"-":"";if(g?.from&&g?.to){let a=(0,S.format)(g.from,"yyyy-MM-dd"),b=(0,S.format)(g.to,"yyyy-MM-dd");i=a===b?`cash-transactions-${N}${a}.pdf`:`cash-transactions-${N}${a}_to_${b}.pdf`}else i=`cash-transactions-${N}${(0,S.format)(new Date,"yyyy-MM-dd")}.pdf`;t.save(i)})(J,0,0,a,b,n.currency||"USD",c,{businessName:n.businessName||"Your Business Name",businessAddress:n.businessAddress||"Your Business Address",businessPhone:n.businessPhone||"(123) 456-7890",businessEmail:n.businessEmail||"support@yourbusiness.com"})}catch(a){console.error("Error exporting PDF:",a),alert("Failed to export PDF. Please try again.")}};return 0===a.length?(0,b.jsx)("div",{className:"text-center py-8 text-gray-500",children:(0,b.jsx)("p",{children:"No transactions found."})}):(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)(Z,{searchTerm:C,onSearchChange:a=>{D(a);let b=new URLSearchParams(A);a?b.set("search",a):b.delete("search"),B(b)},transactionTypeFilter:E,onTransactionTypeFilterChange:a=>{F(a);let b=new URLSearchParams(A);a&&"all"!==a?b.set("type",a):b.delete("type"),B(b)},onExportCSV:()=>{0===J.length?alert("No transactions to export"):((a,b,c,d="USD")=>{if(0===a.length)return alert("No transactions to export");let e=new Blob([[["Date","Type","Account","Description","Category","Person in Charge","Amount","Payment Method"],...a.map(a=>[(0,S.format)(a.date,"yyyy-MM-dd"),a.transactionType.replace("_"," "),b(a.accountId),`"${a.description.replace(/"/g,'""')}"`,a.category,a.personInCharge||"",a.amount.toString(),a.paymentMethod||""])].map(a=>a.join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),f=document.createElement("a");if(void 0!==f.download){let a=URL.createObjectURL(e);f.setAttribute("href",a),f.setAttribute("download",`cash-transactions-${d}-${(0,S.format)(new Date,"yyyy-MM-dd")}.csv`),f.style.visibility="hidden",document.body.appendChild(f),f.click(),document.body.removeChild(f)}})(J,I,0)},onExportPDF:ac,totalTransactions:J.length}),0===J.length?(0,b.jsx)("div",{className:"text-center py-8 text-gray-500",children:(0,b.jsx)("p",{children:"No transactions found matching your filters."})}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"flex justify-between items-center text-sm text-muted-foreground",children:[(0,b.jsxs)("span",{children:["Showing ",N+1,"-",Math.min(O,J.length)," of ",J.length," transactions"]}),M>1&&(0,b.jsxs)("span",{children:["Page ",K," of ",M]})]}),t?(0,b.jsx)("div",{className:"space-y-4",children:Q.map(a=>(0,b.jsxs)("div",{className:"bg-white rounded-lg border p-4 space-y-3",children:[(0,b.jsxs)("div",{className:"flex justify-between items-start",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("div",{className:"font-medium text-sm",children:a.description}),(0,b.jsxs)("div",{className:"text-xs text-gray-500",children:[(0,S.format)(a.date,"MMM d, yyyy"),a.personInCharge&&` • ${a.personInCharge}`]})]}),(0,b.jsx)(P.Badge,{className:`text-xs ${R(a.transactionType)}`,children:Y(a.transactionType)})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("span",{className:`text-lg ${aa(a.transactionType)}`,children:p?H(a.amount):"•••"}),(0,b.jsxs)("div",{className:"flex gap-1",children:[i&&(0,b.jsx)(s.Button,{variant:"ghost",size:"sm",onClick:()=>i(a),className:"h-8 w-8 p-0",children:(0,b.jsx)(G.Eye,{className:"h-4 w-4"})}),g&&u&&(0,b.jsx)(s.Button,{variant:"ghost",size:"sm",onClick:()=>g(a),className:"h-8 w-8 p-0",children:(0,b.jsx)(h.Edit,{className:"h-4 w-4"})}),z&&(0,b.jsxs)(V.AlertDialog,{children:[(0,b.jsx)(V.AlertDialogTrigger,{asChild:!0,children:(0,b.jsx)(s.Button,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-red-600 hover:text-red-700",disabled:q===a.id,children:(0,b.jsx)(T.Trash2,{className:"h-4 w-4"})})}),(0,b.jsxs)(V.AlertDialogContent,{children:[(0,b.jsxs)(V.AlertDialogHeader,{children:[(0,b.jsx)(V.AlertDialogTitle,{children:"Delete Transaction"}),(0,b.jsx)(V.AlertDialogDescription,{children:"Are you sure you want to delete this transaction? This action cannot be undone."})]}),(0,b.jsxs)(V.AlertDialogFooter,{children:[(0,b.jsx)(V.AlertDialogCancel,{children:"Cancel"}),(0,b.jsx)(V.AlertDialogAction,{onClick:()=>ab(a.id),className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})]})]}),(0,b.jsxs)("div",{className:"space-y-1 text-sm text-gray-600",children:[f&&(0,b.jsxs)("div",{children:["Account: ",I(a.accountId)]}),a.category&&(0,b.jsx)("div",{className:"bg-blue-50 px-2 py-1 rounded-md border border-blue-200",children:(0,b.jsxs)("span",{className:"text-blue-800 font-medium",children:["Category: ",a.category]})}),a.paymentMethod&&(0,b.jsxs)("div",{children:["Payment: ",a.paymentMethod]}),a.tags&&a.tags.length>0&&(0,b.jsx)("div",{className:"flex flex-wrap gap-1 mt-2",children:a.tags.map((a,c)=>(0,b.jsx)(P.Badge,{variant:"secondary",className:"text-xs",children:a},c))})]})]},a.id))}):(0,b.jsx)("div",{className:"rounded-md border",children:(0,b.jsxs)(U.Table,{children:[(0,b.jsx)(U.TableHeader,{children:(0,b.jsxs)(U.TableRow,{children:[(0,b.jsx)(U.TableHead,{children:"Date"}),(0,b.jsx)(U.TableHead,{children:"Description"}),(0,b.jsx)(U.TableHead,{children:"Type"}),(0,b.jsx)(U.TableHead,{className:"text-right",children:"Amount"}),(0,b.jsx)(U.TableHead,{children:"Category"}),f&&(0,b.jsx)(U.TableHead,{children:"Account"}),(0,b.jsx)(U.TableHead,{children:"Person in Charge"}),(0,b.jsx)(U.TableHead,{children:"Payment Method"}),(0,b.jsx)(U.TableHead,{children:"Tags"}),(0,b.jsx)(U.TableHead,{className:"text-right",children:"Actions"})]})}),(0,b.jsx)(U.TableBody,{children:Q.map(a=>(0,b.jsxs)(U.TableRow,{children:[(0,b.jsx)(U.TableCell,{className:"font-medium",children:(0,S.format)(a.date,"MMM d, yyyy")}),(0,b.jsx)(U.TableCell,{children:a.description}),(0,b.jsx)(U.TableCell,{children:(0,b.jsx)(P.Badge,{className:R(a.transactionType),children:Y(a.transactionType)})}),(0,b.jsx)(U.TableCell,{className:`text-right ${aa(a.transactionType)}`,children:p?H(a.amount):"•••"}),(0,b.jsx)(U.TableCell,{children:a.category?(0,b.jsx)("div",{className:"bg-blue-50 px-2 py-1 rounded-md border border-blue-200 inline-block",children:(0,b.jsx)("span",{className:"text-blue-800 font-medium",children:a.category})}):"-"}),f&&(0,b.jsx)(U.TableCell,{children:I(a.accountId)}),(0,b.jsx)(U.TableCell,{children:a.personInCharge||"-"}),(0,b.jsx)(U.TableCell,{children:a.paymentMethod||"-"}),(0,b.jsx)(U.TableCell,{children:a.tags&&a.tags.length>0?(0,b.jsx)("div",{className:"flex flex-wrap gap-1",children:a.tags.map((a,c)=>(0,b.jsx)(P.Badge,{variant:"secondary",className:"text-xs",children:a},c))}):"-"}),(0,b.jsx)(U.TableCell,{className:"text-right",children:(0,b.jsxs)("div",{className:"flex gap-1 justify-end",children:[i&&(0,b.jsx)(s.Button,{variant:"ghost",size:"sm",onClick:()=>i(a),className:"h-8 w-8 p-0",children:(0,b.jsx)(G.Eye,{className:"h-4 w-4"})}),g&&o("finance","edit")&&(0,b.jsx)(s.Button,{variant:"ghost",size:"sm",onClick:()=>g(a),className:"h-8 w-8 p-0",children:(0,b.jsx)(h.Edit,{className:"h-4 w-4"})}),o("finance","delete")&&(0,b.jsxs)(V.AlertDialog,{children:[(0,b.jsx)(V.AlertDialogTrigger,{asChild:!0,children:(0,b.jsx)(s.Button,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-red-600 hover:text-red-700",disabled:q===a.id,children:(0,b.jsx)(T.Trash2,{className:"h-4 w-4"})})}),(0,b.jsxs)(V.AlertDialogContent,{children:[(0,b.jsxs)(V.AlertDialogHeader,{children:[(0,b.jsx)(V.AlertDialogTitle,{children:"Delete Transaction"}),(0,b.jsx)(V.AlertDialogDescription,{children:"Are you sure you want to delete this transaction? This action cannot be undone."})]}),(0,b.jsxs)(V.AlertDialogFooter,{children:[(0,b.jsx)(V.AlertDialogCancel,{children:"Cancel"}),(0,b.jsx)(V.AlertDialogAction,{onClick:()=>ab(a.id),className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})]})})]},a.id))})]})}),M>1&&(0,b.jsxs)("div",{className:"flex justify-center items-center space-x-2 mt-6",children:[(0,b.jsx)(s.Button,{variant:"outline",size:"sm",onClick:()=>L(a=>Math.max(a-1,1)),disabled:1===K,children:"Previous"}),(0,b.jsx)("div",{className:"flex space-x-1",children:Array.from({length:Math.min(5,M)},(a,c)=>{let d;return d=M<=5||K<=3?c+1:K>=M-2?M-4+c:K-2+c,(0,b.jsx)(s.Button,{variant:K===d?"default":"outline",size:"sm",onClick:()=>L(d),className:"w-8 h-8 p-0",children:d},d)})}),(0,b.jsx)(s.Button,{variant:"outline",size:"sm",onClick:()=>L(a=>Math.min(a+1,M)),disabled:K===M,children:"Next"})]})]})]})};var ab=a.i(609635),ac=a.i(65052),ad=a.i(355258),ae=a.i(322658);let af=(0,n.default)("CalendarDays",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);var ag=a.i(724669),ah=a.i(653277);let ai=({accountId:a})=>{let[d,f]=(0,e.useSearchParams)(),[g,h]=(0,c.useState)(()=>{let a=d.get("summaryPeriod");return a&&["daily","weekly","monthly","custom"].includes(a)?a:"daily"}),[i,j]=(0,c.useState)(()=>{let a=d.get("summaryDate");return a?new Date(a):new Date}),[k,l]=(0,c.useState)(()=>{let a=d.get("summaryStartDate");return a?new Date(a):new Date}),[m,n]=(0,c.useState)(()=>{let a=d.get("summaryEndDate");return a?new Date(a):new Date});(0,c.useEffect)(()=>{let a=d.get("summaryPeriod"),b=d.get("summaryDate"),c=d.get("summaryStartDate"),e=d.get("summaryEndDate");a&&["daily","weekly","monthly","custom"].includes(a)?h(a):h("daily"),b&&j(new Date(b)),c&&l(new Date(c)),e&&n(new Date(e))},[d]);let[p,q]=(0,c.useState)(!1),[r,u]=(0,c.useState)(!1),[z,A]=(0,c.useState)(null),[B,E]=(0,c.useState)(null),[G,H]=(0,c.useState)({date:new Date,openingBalance:0,cashIn:0,cashOut:0,transfersIn:0,transfersOut:0,closingBalance:0}),{getDailySummary:I,getDateRangeSummary:J,transactions:K,updateTransaction:L,refreshTransactions:M}=(0,w.useCashTransactions)(a),{accounts:O,refreshAccounts:P}=(0,v.useCashAccounts)(),{settings:R}=(0,x.useBusinessSettings)();(0,y.useIsMobile)();let{canManageFinanceAccounts:T}=(0,_.useFinancialVisibility)(),U=(0,c.useCallback)(a=>(0,X.formatCashAmount)(a,R.currency||"USD"),[R.currency]),V=a=>{j(a);let b=new URLSearchParams(d),c=(0,S.format)(a,"yyyy-MM-dd");c!==(0,S.format)(new Date,"yyyy-MM-dd")?b.set("summaryDate",c):b.delete("summaryDate"),f(b)},W=a=>{l(a);let b=new URLSearchParams(d);b.set("summaryPeriod","custom"),b.set("summaryStartDate",(0,S.format)(a,"yyyy-MM-dd")),f(b)},Y=a=>{n(a);let b=new URLSearchParams(d);b.set("summaryPeriod","custom"),b.set("summaryEndDate",(0,S.format)(a,"yyyy-MM-dd")),f(b)},Z=(0,c.useCallback)(a=>{V(new Date(a.target.value))},[]),$=(0,c.useCallback)(a=>{W(new Date(a.target.value))},[]),ai=(0,c.useCallback)(a=>{Y(new Date(a.target.value))},[]),aj=(0,c.useCallback)(()=>{let a=new Date;V(a),W(a),Y(a)},[]),ak=(0,c.useMemo)(()=>{switch(g){case"weekly":return{start:(0,ab.startOfWeek)(i,{weekStartsOn:1}),end:(0,ac.endOfWeek)(i,{weekStartsOn:1})};case"monthly":return{start:(0,ad.startOfMonth)(i),end:(0,ae.endOfMonth)(i)};case"custom":return{start:k,end:m};default:return{start:i,end:i}}},[g,i,k,m]),al=(0,c.useCallback)(async()=>{try{let b;if("daily"===g)b=await I(i,a);else{let{start:c,end:d}=ak;b=await J(c,d,a)}H(b)}catch(a){console.error("Error loading summary:",a)}},[g,i,ak,a,I,J]);(0,c.useEffect)(()=>{let a;return a=setTimeout(async()=>{await al()},100),()=>{a&&clearTimeout(a)}},[al,K]);let am=(0,c.useMemo)(()=>{let{start:b,end:c}=ak,d=b.toISOString().split("T")[0],e=c.toISOString().split("T")[0],f=K.filter(a=>{let b=a.date.toISOString().split("T")[0];return b>=d&&b<=e});return a&&(f=f.filter(b=>b.accountId===a)),f},[K,ak,a]),an=(0,c.useCallback)(a=>{A(a),q(!0)},[]),ao=(0,c.useCallback)(a=>{E(a),u(!0)},[]),ap=(0,c.useCallback)(async(a,b)=>{try{await L(a,b),u(!1),E(null),await Promise.all([M(),P()]),await al()}catch(a){console.error("Error updating transaction:",a)}},[L,M,P,al]),aq=(0,c.useCallback)(async()=>{try{await Promise.all([M(),P()]),await al(),console.log("Successfully refreshed data after transaction deletion")}catch(a){console.error("Error refreshing data after transaction deletion:",a)}},[M,P,al]),ar=(0,c.useMemo)(()=>{let{start:a,end:b}=ak;switch(g){case"weekly":return`Week of ${(0,S.format)(a,"MMM d")} - ${(0,S.format)(b,"MMM d, yyyy")}`;case"monthly":return(0,S.format)(i,"MMMM yyyy");case"custom":return`${(0,S.format)(a,"MMM d")} - ${(0,S.format)(b,"MMM d, yyyy")}`;default:return(0,S.format)(i,"MMMM d, yyyy")}},[ak,g,i]);return(0,b.jsxs)("div",{className:"space-y-4 md:space-y-6",children:[(0,b.jsxs)(t.Card,{children:[(0,b.jsx)(t.CardHeader,{className:"pb-3 md:pb-6",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)(t.CardTitle,{className:"flex items-center gap-2 text-lg md:text-xl",children:[(0,b.jsx)(af,{className:"h-5 w-5"}),(0,b.jsx)("span",{className:"break-words",children:"Cash Summary"})]}),(0,b.jsx)("div",{className:"text-sm md:text-base font-medium text-muted-foreground",children:ar}),(0,b.jsx)("div",{className:"space-y-3",children:(0,b.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)(D.Label,{htmlFor:"period",className:"text-xs font-medium",children:"Period"}),(0,b.jsxs)(F.Select,{value:g,onValueChange:a=>{h(a);let b=new URLSearchParams(d);"daily"!==a?b.set("summaryPeriod",a):b.delete("summaryPeriod"),f(b)},children:[(0,b.jsx)(F.SelectTrigger,{className:"h-9 text-sm",children:(0,b.jsx)(F.SelectValue,{})}),(0,b.jsxs)(F.SelectContent,{children:[(0,b.jsx)(F.SelectItem,{value:"daily",children:"Daily"}),(0,b.jsx)(F.SelectItem,{value:"weekly",children:"Weekly"}),(0,b.jsx)(F.SelectItem,{value:"monthly",children:"Monthly"}),(0,b.jsx)(F.SelectItem,{value:"custom",children:"Custom Range"})]})]})]}),"custom"===g?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)(D.Label,{htmlFor:"startDate",className:"text-xs font-medium",children:"Start Date"}),(0,b.jsx)(C.Input,{id:"startDate",type:"date",value:(0,S.format)(k,"yyyy-MM-dd"),onChange:$,className:"h-9 text-sm"})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)(D.Label,{htmlFor:"endDate",className:"text-xs font-medium",children:"End Date"}),(0,b.jsx)(C.Input,{id:"endDate",type:"date",value:(0,S.format)(m,"yyyy-MM-dd"),onChange:ai,className:"h-9 text-sm"})]})]}):(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)(D.Label,{htmlFor:"date",className:"text-xs font-medium",children:"Date"}),(0,b.jsx)(C.Input,{id:"date",type:"date",value:(0,S.format)(i,"yyyy-MM-dd"),onChange:Z,className:"h-9 text-sm"})]}),(0,b.jsx)("div",{className:"flex items-end",children:(0,b.jsx)(s.Button,{variant:"outline",size:"sm",onClick:aj,className:"h-9 text-sm",children:"Today"})})]})})]})}),(0,b.jsxs)(t.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-3 md:gap-4",children:[(0,b.jsxs)("div",{className:"space-y-3 p-5 md:p-6 bg-muted/50 rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-xs md:text-sm text-muted-foreground",children:[(0,b.jsx)(ag.TrendingUp,{className:"h-4 w-4 md:h-5 md:w-5"}),(0,b.jsx)("span",{className:"font-medium",children:"Opening"})]}),(0,b.jsx)("div",{className:"text-lg md:text-xl font-semibold break-all leading-tight",children:T?U(G.openingBalance):"•••"})]}),(0,b.jsxs)("div",{className:"space-y-3 p-5 md:p-6 bg-green-50 rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-xs md:text-sm text-green-600",children:[(0,b.jsx)(ag.TrendingUp,{className:"h-4 w-4 md:h-5 md:w-5"}),(0,b.jsx)("span",{className:"font-medium",children:"Cash In"})]}),(0,b.jsx)("div",{className:"text-lg md:text-xl font-semibold text-green-600 break-all leading-tight",children:T?U(G.cashIn):"•••"})]}),(0,b.jsxs)("div",{className:"space-y-3 p-5 md:p-6 bg-red-50 rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-xs md:text-sm text-red-600",children:[(0,b.jsx)(ah.TrendingDown,{className:"h-4 w-4 md:h-5 md:w-5"}),(0,b.jsx)("span",{className:"font-medium",children:"Cash Out"})]}),(0,b.jsx)("div",{className:"text-lg md:text-xl font-semibold text-red-600 break-all leading-tight",children:T?U(G.cashOut):"•••"})]}),(0,b.jsxs)("div",{className:"space-y-3 p-5 md:p-6 bg-blue-50 rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-xs md:text-sm text-blue-600",children:[(0,b.jsx)(o,{className:"h-4 w-4 md:h-5 md:w-5"}),(0,b.jsx)("span",{className:"font-medium",children:"Transfer In"})]}),(0,b.jsx)("div",{className:"text-lg md:text-xl font-semibold text-blue-600 break-all leading-tight",children:T?U(G.transfersIn):"•••"})]}),(0,b.jsxs)("div",{className:"space-y-3 p-5 md:p-6 bg-orange-50 rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-xs md:text-sm text-orange-600",children:[(0,b.jsx)(o,{className:"h-4 w-4 md:h-5 md:w-5"}),(0,b.jsx)("span",{className:"font-medium",children:"Transfer Out"})]}),(0,b.jsx)("div",{className:"text-lg md:text-xl font-semibold text-orange-600 break-all leading-tight",children:T?U(G.transfersOut):"•••"})]}),(0,b.jsxs)("div",{className:"space-y-3 p-5 md:p-6 bg-slate-50 rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-xs md:text-sm text-muted-foreground",children:[(0,b.jsx)(ag.TrendingUp,{className:"h-4 w-4 md:h-5 md:w-5"}),(0,b.jsx)("span",{className:"font-medium",children:"Closing"})]}),(0,b.jsx)("div",{className:"text-lg md:text-xl font-semibold break-all leading-tight",children:T?U(G.closingBalance):"•••"})]})]}),(0,b.jsx)("div",{className:"pt-3 md:pt-4 border-t",children:(0,b.jsxs)("div",{className:"text-sm md:text-base text-muted-foreground",children:["Net Change:",(0,b.jsx)("span",{className:`ml-1 font-semibold break-all ${G.closingBalance-G.openingBalance>=0?"text-green-600":"text-red-600"}`,children:T?U(G.closingBalance-G.openingBalance):"•••"})]})})]})]}),(0,b.jsxs)(t.Card,{children:[(0,b.jsx)(t.CardHeader,{className:"pb-3 md:pb-6",children:(0,b.jsxs)(t.CardTitle,{className:"text-lg md:text-xl",children:[(0,b.jsx)("span",{className:"break-words",children:"Transactions"}),(0,b.jsxs)("span",{className:"text-sm font-normal text-muted-foreground ml-2",children:["(",am.length," transaction",1!==am.length?"s":"",")"]})]})}),(0,b.jsx)(t.CardContent,{className:"px-3 md:px-6",children:(0,b.jsx)(aa,{transactions:am,accountId:a,showAccountColumn:!a,onViewTransaction:an,onEditTransaction:ao,onTransactionDeleted:aq})})]}),(0,b.jsx)(Q,{open:p,onOpenChange:q,transaction:z}),(0,b.jsx)(N,{open:r,onOpenChange:u,onSubmit:ap,transaction:B,accounts:O})]})};var aj=a.i(320146),ak=a.i(599209),al=a.i(941675),am=a.i(795490),an=a.i(585668),ao=a.i(114548),ap=a.i(797063),aq=a.i(391956),ar=a.i(124348);let as="bulk_transactions_draft",at=({className:a})=>(0,b.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:a,children:[(0,b.jsx)("path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4"}),(0,b.jsx)("path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5"}),(0,b.jsx)("path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z"})]}),au=({open:a,onOpenChange:d,accountId:e,onSuccess:g})=>{let h=(0,y.useIsMobile)(),{user:i}=(0,aq.useAuth)(),{accounts:j}=(0,v.useCashAccounts)(),{createBulkTransactions:k}=(0,w.useCashTransactions)(e),[l,m]=(0,c.useState)([]),[n,o]=(0,c.useState)(new Date),[p,q]=(0,c.useState)(!1);(0,c.useEffect)(()=>{if(!a)return;let b=localStorage.getItem(as);if(b)try{let a=JSON.parse(b);m(a.map(a=>({...a,date:new Date(a.date)})))}catch(a){console.error("Failed to parse draft",a),r()}else m([]),r()},[a]),(0,c.useEffect)(()=>{l.length>0?localStorage.setItem(as,JSON.stringify(l)):localStorage.removeItem(as)},[l]);let r=()=>{let a={id:Math.random().toString(36).substr(2,9),accountId:e,amount:0,transactionType:"cash_in",description:"",category:"Other",paymentMethod:"Cash",personInCharge:"",tags:[],date:n,receiptImage:""};m(b=>[...b,a])},u=a=>{m(b=>b.filter(b=>b.id!==a)),1===l.length&&r()},x=(a,b)=>{m(c=>c.map(c=>c.id===a?{...c,...b}:c))},z=(a,b)=>{let c=l.findIndex(b=>b.id===a);if(c<0||"up"===b&&0===c||"down"===b&&c===l.length-1)return;let d=[...l],e="up"===b?c-1:c+1;[d[c],d[e]]=[d[e],d[c]],m(d)},B=async()=>{let a=l.filter(a=>a.amount>0&&""!==a.description.trim());if(0===a.length)return void alert("Please enter at least one valid transaction with amount and description");if(a.filter(a=>"transfer"===a.transactionType&&!a.toAccountId).length>0)return void alert("Please select a destination account for all transfers");q(!0);try{await k(a.map(({id:a,...b})=>({...b}))),localStorage.removeItem(as),g()}catch(a){console.error("Bulk save failed",a),alert("Failed to save transactions. Please check your network connection.")}finally{q(!1)}};return(0,b.jsx)(A.Dialog,{open:a,onOpenChange:a=>!p&&d(a),children:(0,b.jsxs)(A.DialogContent,{className:"max-w-6xl w-[95vw] h-[95vh] sm:h-[90vh] flex flex-col p-0 overflow-hidden shadow-2xl border-none",children:[(0,b.jsx)(A.DialogHeader,{className:"p-6 pb-2 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-slate-900 dark:to-slate-800 border-b",children:(0,b.jsx)("div",{className:"flex justify-between items-start",children:(0,b.jsxs)("div",{children:[(0,b.jsxs)(A.DialogTitle,{className:"text-xl font-bold text-slate-800 dark:text-slate-100 flex items-center gap-2",children:[(0,b.jsx)(at,{className:"h-5 w-5 text-blue-600"}),"Bulk Transaction Entry"]}),(0,b.jsx)(A.DialogDescription,{className:"text-slate-500 dark:text-slate-400 mt-1",children:"Add multiple records at once. Each row can have its own date and details."})]})})}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto p-4 sm:p-6 space-y-6 bg-slate-50/30 dark:bg-slate-950/30",children:(0,b.jsxs)("div",{className:"bg-white dark:bg-slate-900 rounded-xl p-4 shadow-sm border space-y-4",children:[(0,b.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[(0,b.jsx)("div",{className:"flex items-center gap-2 text-sm text-slate-600 dark:text-slate-400",children:(0,b.jsxs)(ar.Alert,{className:"bg-blue-50/50 dark:bg-blue-900/10 border-blue-100 dark:border-blue-900 py-2",children:[(0,b.jsx)(ap.Info,{className:"h-4 w-4 text-blue-500"}),(0,b.jsxs)(ar.AlertDescription,{className:"text-[11px] sm:text-xs",children:["Use the ",(0,b.jsx)("strong",{children:"Default Date"})," to quickly set dates for newly added rows."]})]})}),(0,b.jsxs)("div",{className:"flex items-center gap-3 w-full md:w-auto",children:[(0,b.jsxs)("div",{className:"flex-1 md:flex-initial",children:[(0,b.jsx)("p",{className:"text-[10px] font-semibold text-muted-foreground uppercase mb-1 ml-1",children:"Default Date"}),(0,b.jsxs)(ak.Popover,{children:[(0,b.jsx)(ak.PopoverTrigger,{asChild:!0,children:(0,b.jsxs)(s.Button,{variant:"outline",className:(0,X.cn)("justify-start text-left font-normal w-full md:w-[200px] h-10 shadow-sm",!n&&"text-muted-foreground"),children:[(0,b.jsx)(al.Calendar,{className:"mr-2 h-4 w-4 text-blue-500"}),n?(0,S.format)(n,"PPP"):(0,b.jsx)("span",{children:"Pick a date"})]})}),(0,b.jsx)(ak.PopoverContent,{className:"w-auto p-0 z-[80]",align:"end",children:(0,b.jsx)(aj.Calendar,{mode:"single",selected:n,onSelect:a=>a&&o(a),initialFocus:!0})})]})]}),(0,b.jsx)("div",{className:"flex items-end h-full",children:(0,b.jsxs)(s.Button,{onClick:r,variant:"secondary",className:"gap-2 h-10 font-semibold border border-slate-200 dark:border-slate-800",children:[(0,b.jsx)(f.Plus,{className:"h-4 w-4"}),"Add Row"]})})]})]}),(0,b.jsx)("div",{className:"min-h-[200px]",children:h?(0,b.jsx)("div",{className:"space-y-4 px-1",children:l.map((a,c)=>(0,b.jsxs)(t.Card,{className:"overflow-hidden border-l-4 border-l-primary/30",children:[(0,b.jsxs)(t.CardHeader,{className:"flex flex-row items-center justify-between p-3 pb-2 bg-muted/20",children:[(0,b.jsxs)(t.CardTitle,{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:["Transaction ",c+1]}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(s.Button,{size:"icon",variant:"ghost",className:"h-8 w-8 text-muted-foreground",onClick:()=>z(a.id,"up"),children:(0,b.jsx)(am.ArrowUp,{className:"h-4 w-4"})}),(0,b.jsx)(s.Button,{size:"icon",variant:"ghost",className:"h-8 w-8 text-destructive/70",onClick:()=>u(a.id),children:(0,b.jsx)(T.Trash2,{className:"h-4 w-4"})})]})]}),(0,b.jsxs)(t.CardContent,{className:"p-3 space-y-3",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,b.jsxs)(ak.Popover,{children:[(0,b.jsx)(ak.PopoverTrigger,{asChild:!0,children:(0,b.jsxs)(s.Button,{variant:"outline",size:"sm",className:(0,X.cn)("w-full justify-start text-left font-normal h-9",!a.date&&"text-muted-foreground"),children:[(0,b.jsx)(al.Calendar,{className:"mr-2 h-3 w-3"}),(0,b.jsx)("span",{className:"truncate text-xs",children:a.date?(0,S.format)(a.date,"MMM dd, yyyy"):"Date"})]})}),(0,b.jsx)(ak.PopoverContent,{className:"w-auto p-0 z-[70]",align:"start",children:(0,b.jsx)(aj.Calendar,{mode:"single",selected:a.date,onSelect:b=>b&&x(a.id,{date:b}),initialFocus:!0})})]}),(0,b.jsxs)(F.Select,{value:a.transactionType,onValueChange:b=>x(a.id,{transactionType:b}),children:[(0,b.jsx)(F.SelectTrigger,{className:"h-9 text-xs",children:(0,b.jsx)(F.SelectValue,{})}),(0,b.jsxs)(F.SelectContent,{children:[(0,b.jsx)(F.SelectItem,{value:"cash_in",children:"Cash In"}),(0,b.jsx)(F.SelectItem,{value:"cash_out",children:"Cash Out"}),(0,b.jsx)(F.SelectItem,{value:"transfer",children:"Transfer"})]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,b.jsx)(C.Input,{type:"number",placeholder:"Amount",value:a.amount||"",onChange:b=>x(a.id,{amount:Number(b.target.value)}),className:"h-9 font-medium"}),(0,b.jsxs)(F.Select,{value:a.category,onValueChange:b=>x(a.id,{category:b}),children:[(0,b.jsx)(F.SelectTrigger,{className:"h-9 text-xs",children:(0,b.jsx)(F.SelectValue,{})}),(0,b.jsxs)(F.SelectContent,{children:[(0,b.jsx)(F.SelectItem,{value:"Sales",children:"Sales"}),(0,b.jsx)(F.SelectItem,{value:"Expenses",children:"Expenses"}),(0,b.jsx)(F.SelectItem,{value:"Payroll",children:"Payroll"}),(0,b.jsx)(F.SelectItem,{value:"Other",children:"Other"})]})]})]}),"transfer"===a.transactionType&&(0,b.jsxs)(F.Select,{value:a.toAccountId,onValueChange:b=>x(a.id,{toAccountId:b}),children:[(0,b.jsx)(F.SelectTrigger,{className:"h-9 text-xs",children:(0,b.jsx)(F.SelectValue,{placeholder:"Target Account"})}),(0,b.jsx)(F.SelectContent,{children:j.filter(a=>a.id!==e).map(a=>(0,b.jsx)(F.SelectItem,{value:a.id,children:a.name},a.id))})]}),(0,b.jsx)(C.Input,{placeholder:"Description",value:a.description,onChange:b=>x(a.id,{description:b.target.value}),className:"h-9"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,b.jsx)(C.Input,{placeholder:"Payment Method",value:a.paymentMethod,onChange:b=>x(a.id,{paymentMethod:b.target.value}),className:"h-8 text-[11px]"}),(0,b.jsx)(C.Input,{placeholder:"Person In Charge",value:a.personInCharge,onChange:b=>x(a.id,{personInCharge:b.target.value}),className:"h-8 text-[11px]"})]})]})]},a.id))}):(0,b.jsx)("div",{className:"overflow-x-auto rounded-md border",children:(0,b.jsxs)(U.Table,{children:[(0,b.jsx)(U.TableHeader,{className:"bg-muted/50",children:(0,b.jsxs)(U.TableRow,{children:[(0,b.jsx)(U.TableHead,{className:"w-[140px]",children:"Date"}),(0,b.jsx)(U.TableHead,{className:"w-[130px]",children:"Type"}),(0,b.jsx)(U.TableHead,{className:"w-[130px]",children:"Amount"}),(0,b.jsx)(U.TableHead,{children:"Description"}),(0,b.jsx)(U.TableHead,{className:"w-[140px]",children:"Category"}),(0,b.jsx)(U.TableHead,{className:"w-[150px]",children:"Details"}),(0,b.jsx)(U.TableHead,{className:"w-[120px] text-right",children:"Actions"})]})}),(0,b.jsx)(U.TableBody,{children:l.map(a=>(0,b.jsxs)(U.TableRow,{className:"hover:bg-muted/30 transition-colors",children:[(0,b.jsx)(U.TableCell,{children:(0,b.jsxs)(ak.Popover,{children:[(0,b.jsx)(ak.PopoverTrigger,{asChild:!0,children:(0,b.jsxs)(s.Button,{variant:"outline",size:"sm",className:(0,X.cn)("w-full justify-start text-left font-normal h-9",!a.date&&"text-muted-foreground"),children:[(0,b.jsx)(al.Calendar,{className:"mr-2 h-3 w-3 shrink-0"}),(0,b.jsx)("span",{className:"truncate",children:a.date?(0,S.format)(a.date,"MMM dd, yyyy"):"Date"})]})}),(0,b.jsx)(ak.PopoverContent,{className:"w-auto p-0 z-[70]",align:"start",children:(0,b.jsx)(aj.Calendar,{mode:"single",selected:a.date,onSelect:b=>b&&x(a.id,{date:b}),initialFocus:!0})})]})}),(0,b.jsxs)(U.TableCell,{children:[(0,b.jsxs)(F.Select,{value:a.transactionType,onValueChange:b=>x(a.id,{transactionType:b}),children:[(0,b.jsx)(F.SelectTrigger,{className:"h-9",children:(0,b.jsx)(F.SelectValue,{})}),(0,b.jsxs)(F.SelectContent,{children:[(0,b.jsx)(F.SelectItem,{value:"cash_in",children:"Cash In"}),(0,b.jsx)(F.SelectItem,{value:"cash_out",children:"Cash Out"}),(0,b.jsx)(F.SelectItem,{value:"transfer",children:"Transfer"})]})]}),"transfer"===a.transactionType&&(0,b.jsx)("div",{className:"mt-1.5",children:(0,b.jsxs)(F.Select,{value:a.toAccountId,onValueChange:b=>x(a.id,{toAccountId:b}),children:[(0,b.jsx)(F.SelectTrigger,{className:"text-[10px] h-7 px-2",children:(0,b.jsx)(F.SelectValue,{placeholder:"To Account"})}),(0,b.jsx)(F.SelectContent,{children:j.filter(a=>a.id!==e).map(a=>(0,b.jsx)(F.SelectItem,{value:a.id,children:a.name},a.id))})]})})]}),(0,b.jsx)(U.TableCell,{children:(0,b.jsx)(C.Input,{type:"number",value:a.amount||"",onChange:b=>x(a.id,{amount:Number(b.target.value)}),className:"h-9 font-medium",placeholder:"0.00"})}),(0,b.jsx)(U.TableCell,{children:(0,b.jsx)(C.Input,{value:a.description,onChange:b=>x(a.id,{description:b.target.value}),placeholder:"Description...",className:"h-9"})}),(0,b.jsx)(U.TableCell,{children:(0,b.jsxs)(F.Select,{value:a.category,onValueChange:b=>x(a.id,{category:b}),children:[(0,b.jsx)(F.SelectTrigger,{className:"h-9",children:(0,b.jsx)(F.SelectValue,{})}),(0,b.jsxs)(F.SelectContent,{children:[(0,b.jsx)(F.SelectItem,{value:"Sales",children:"Sales"}),(0,b.jsx)(F.SelectItem,{value:"Expenses",children:"Expenses"}),(0,b.jsx)(F.SelectItem,{value:"Payroll",children:"Payroll"}),(0,b.jsx)(F.SelectItem,{value:"Other",children:"Other"})]})]})}),(0,b.jsxs)(U.TableCell,{className:"space-y-1",children:[(0,b.jsx)(C.Input,{placeholder:"Payment Method",value:a.paymentMethod,onChange:b=>x(a.id,{paymentMethod:b.target.value}),className:"text-[10px] h-7 px-1.5"}),(0,b.jsx)(C.Input,{placeholder:"Person In Charge",value:a.personInCharge,onChange:b=>x(a.id,{personInCharge:b.target.value}),className:"text-[10px] h-7 px-1.5"})]}),(0,b.jsx)(U.TableCell,{className:"text-right",children:(0,b.jsxs)("div",{className:"flex items-center justify-end gap-0.5",children:[(0,b.jsx)(s.Button,{size:"icon",variant:"ghost",className:"h-7 w-7 text-muted-foreground",onClick:()=>z(a.id,"up"),children:(0,b.jsx)(am.ArrowUp,{className:"h-3.5 w-3.5"})}),(0,b.jsx)(s.Button,{size:"icon",variant:"ghost",className:"h-7 w-7 text-muted-foreground",onClick:()=>z(a.id,"down"),children:(0,b.jsx)(an.ArrowDown,{className:"h-3.5 w-3.5"})}),(0,b.jsx)(s.Button,{size:"icon",variant:"ghost",className:"h-7 w-7 text-destructive/70 hover:text-destructive hover:bg-destructive/10",onClick:()=>u(a.id),children:(0,b.jsx)(T.Trash2,{className:"h-3.5 w-3.5"})})]})})]},a.id))})]})})})]})}),(0,b.jsxs)("div",{className:"flex justify-between items-center p-6 border-t bg-white dark:bg-slate-900 shrink-0",children:[(0,b.jsxs)("div",{className:"text-sm font-medium text-slate-500",children:["Total Valid: ",(0,b.jsx)("span",{className:"text-indigo-600 dark:text-indigo-400 font-bold",children:l.filter(a=>a.amount>0).length})]}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsxs)(s.Button,{variant:"ghost",onClick:()=>{p||d(!1)},disabled:p,className:"gap-2 hover:bg-slate-100 dark:hover:bg-slate-800",children:[(0,b.jsx)(I.X,{className:"h-4 w-4"}),"Cancel"]}),(0,b.jsxs)(s.Button,{onClick:B,disabled:p,className:"gap-2 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 shadow-md transition-all active:scale-[0.98]",children:[p?(0,b.jsx)(ao.Save,{className:"h-4 w-4 animate-spin"}):(0,b.jsx)(ao.Save,{className:"h-4 w-4"}),"Save ",l.filter(a=>a.amount>0).length," Transactions"]})]})]})]})})};var av=a.i(173390),aw=a.i(292e3),ax=a.i(816201);let ay=(0,n.default)("MoveRight",[["path",{d:"M18 8L22 12L18 16",key:"1r0oui"}],["path",{d:"M2 12H22",key:"1m8cig"}]]);var az=a.i(175750),aA=a.i(899078);let aB=({open:a,onOpenChange:d,accountId:e,onUploadComplete:f})=>{let{createBulkTransactions:g}=(0,w.useCashTransactions)(e),{accounts:h}=(0,v.useCashAccounts)(),[k,l]=(0,c.useState)({step:"select",file:null,validRows:[],errors:[],totalRows:0,uploadProgress:0,successCount:0,failureCount:0,currentTransactionIndex:0}),m=(0,c.useRef)(null),[n,o]=(0,c.useState)(!1),[p,q]=(0,c.useState)(!1),r=a=>{let b=new Date,c=a.Date,d=c?.toString();if(d)if(c instanceof Date)b=c;else{let a=d.match(/^(\d{1,2})[/-](\d{1,2})[/-](\d{4})$/);if(a){let[,c,d,e]=a;b=new Date(parseInt(e),parseInt(d)-1,parseInt(c))}else{let a=new Date(d);isNaN(a.getTime())||(b=a)}}isNaN(b.getTime())&&(b=new Date);let f="";if(a.Type?.toLowerCase()==="transfer"&&a["To Account"]){let b=h?.find(b=>b.name.toLowerCase()===a["To Account"]?.toString().toLowerCase()&&b.id!==e);b&&(f=b.id)}return{accountId:e||"",amount:parseFloat(a.Amount?.toString().replace(/[^0-9.-]/g,"")||"0"),transactionType:a.Type?.toLowerCase()||"cash_in",toAccountId:f,category:a.Category||"Other",description:a.Description||"",paymentMethod:a["Payment Method"]||"Cash",personInCharge:a["Person In Charge"]||"",tags:[],date:b,receiptImage:""}},u=async a=>{let b,c=a.name.endsWith(".xlsx")||a.name.endsWith(".xls"),d=a.name.endsWith(".csv");if(!c&&!d)return void alert("Please select a CSV or Excel file");if(c){let c=await a.arrayBuffer(),d=az.read(c,{cellDates:!0}),f=d.SheetNames[0],g=d.Sheets[f],i=az.utils.sheet_to_json(g).map(a=>({Date:a.Date||"",Type:a.Type||"",Amount:a.Amount||"",Description:a.Description||"",Category:a.Category||"","Payment Method":a["Payment Method"]||"","Person In Charge":a["Person In Charge"]||"","To Account":a["To Account"]||""})),j=[],k=[];i.forEach((a,b)=>{let c=(0,aA.validateTransactionCSVRow)(a,b+2);a.Type?.toLowerCase()==="transfer"&&a["To Account"]&&(h?.find(b=>b.name.toLowerCase()===a["To Account"]?.toString().toLowerCase()&&b.id!==e)||c.push({row:b+2,field:"To Account",message:`Account "${a["To Account"]}" not found or is the current account.`})),0===c.length?j.push(a):k.push(...c)}),b={validRows:j,errors:k,totalRows:i.length}}else{let c=await a.text();b=(0,aA.parseTransactionCSV)(c);let d=[],f=[];b.validRows.forEach((a,b)=>{a.Type?.toLowerCase()==="transfer"&&a["To Account"]?h?.find(b=>b.name.toLowerCase()===a["To Account"]?.toString().toLowerCase()&&b.id!==e)?f.push(a):d.push({row:b+2,field:"To Account",message:`Account "${a["To Account"]}" not found.`}):f.push(a)}),b.errors.push(...d),b.validRows=f}l({...k,step:"preview",file:a,validRows:b.validRows,errors:b.errors,totalRows:b.totalRows})},x=async()=>{l(a=>({...a,step:"uploading",uploadProgress:0,currentTransactionIndex:0})),q(!0);let a=k.validRows.map(r);try{await g(a),l(b=>({...b,step:"complete",uploadProgress:100,successCount:a.length,failureCount:0,currentTransactionIndex:a.length}))}catch(b){console.error("Bulk upload failed:",b),l(b=>({...b,step:"complete",uploadProgress:100,successCount:0,failureCount:a.length,currentTransactionIndex:a.length}))}finally{q(!1)}};return(0,b.jsx)(A.Dialog,{open:a,onOpenChange:a=>!p&&d(a),children:(0,b.jsxs)(A.DialogContent,{className:"sm:max-w-[550px] p-0 overflow-hidden rounded-3xl border-none shadow-2xl",children:[(0,b.jsxs)(A.DialogHeader,{className:"p-8 pb-4 bg-gradient-to-b from-slate-50/50 to-white dark:from-slate-900 dark:to-slate-950",children:[(0,b.jsxs)(A.DialogTitle,{className:"flex items-center gap-3 text-2xl font-black tracking-tight text-slate-900 dark:text-slate-50",children:[(0,b.jsx)("div",{className:"bg-blue-600 p-2 rounded-xl text-white",children:(0,b.jsx)(i.Upload,{className:"h-6 w-6"})}),"Financial Importer"]}),(0,b.jsx)(A.DialogDescription,{className:"text-slate-500 dark:text-slate-400 font-medium mt-1",children:"Scale your data management by importing bulk CSV logs."})]}),(0,b.jsxs)("div",{className:"px-8 pb-8 pt-0",children:["select"===k.step&&(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:(0,X.cn)("border-4 border-dashed rounded-2xl p-10 text-center cursor-pointer transition-all duration-300",n?"border-blue-500 bg-blue-50/50 scale-[1.01] shadow-lg":"border-slate-200 dark:border-slate-800 hover:border-blue-400 hover:bg-slate-50/50 dark:hover:bg-slate-900/50"),onDrop:a=>{a.preventDefault(),o(!1);let b=a.dataTransfer.files[0];b&&u(b)},onDragOver:a=>{a.preventDefault(),o(!0)},onDragLeave:()=>{o(!1)},onClick:()=>m.current?.click(),children:[(0,b.jsx)("div",{className:"bg-blue-100 dark:bg-blue-900/30 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 animate-bounce-slow",children:(0,b.jsx)(i.Upload,{className:"h-8 w-8 text-blue-600 dark:text-blue-400"})}),(0,b.jsx)("p",{className:"text-xl font-bold text-slate-900 dark:text-slate-100 mb-2",children:"Click or Drag File to Upload"}),(0,b.jsx)("p",{className:"text-sm text-slate-500 dark:text-slate-400 max-w-xs mx-auto mb-6",children:"Select your transaction data file. **CSV** and **Excel (.xlsx, .xls)** files are supported for bulk processing."}),(0,b.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,b.jsx)("div",{className:"h-1 w-8 bg-slate-200 dark:bg-slate-800 rounded-full"}),(0,b.jsx)("span",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest",children:"Multi-Format Support"}),(0,b.jsx)("div",{className:"h-1 w-8 bg-slate-200 dark:bg-slate-800 rounded-full"})]})]}),(0,b.jsxs)("div",{className:"border rounded-xl overflow-hidden bg-white dark:bg-slate-900 shadow-sm",children:[(0,b.jsxs)("div",{className:"bg-slate-50 dark:bg-slate-800/50 px-4 py-2 border-b flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(ap.Info,{className:"h-4 w-4 text-blue-500"}),(0,b.jsx)("span",{className:"text-xs font-bold text-slate-700 dark:text-slate-300",children:"DATA FORMAT GUIDE"})]}),(0,b.jsx)("span",{className:"text-[10px] text-slate-400 font-medium",children:"Headers are required"})]}),(0,b.jsx)("div",{className:"overflow-x-auto p-0",children:(0,b.jsxs)(U.Table,{children:[(0,b.jsx)(U.TableHeader,{children:(0,b.jsxs)(U.TableRow,{className:"bg-slate-100/30 dark:bg-slate-900/30",children:[(0,b.jsx)(U.TableHead,{className:"text-[10px] uppercase h-8 py-0",children:"Date"}),(0,b.jsx)(U.TableHead,{className:"text-[10px] uppercase h-8 py-0",children:"Type"}),(0,b.jsx)(U.TableHead,{className:"text-[10px] uppercase h-8 py-0",children:"Amount"}),(0,b.jsx)(U.TableHead,{className:"text-[10px] uppercase h-8 py-0",children:"Description"}),(0,b.jsx)(U.TableHead,{className:"text-[10px] uppercase h-8 py-0",children:"Category"})]})}),(0,b.jsxs)(U.TableBody,{children:[(0,b.jsxs)(U.TableRow,{className:"h-8 py-0",children:[(0,b.jsx)(U.TableCell,{className:"text-[11px] py-1 text-slate-600 font-mono",children:"22/12/2025"}),(0,b.jsx)(U.TableCell,{className:"text-[11px] py-1 text-green-600 font-semibold italic",children:"cash_in"}),(0,b.jsx)(U.TableCell,{className:"text-[11px] py-1 text-slate-800 font-bold",children:"1500.00"}),(0,b.jsx)(U.TableCell,{className:"text-[11px] py-1 truncate max-w-[80px]",children:"Product Sale #44"}),(0,b.jsx)(U.TableCell,{className:"text-[11px] py-1",children:"Sales"})]}),(0,b.jsxs)(U.TableRow,{className:"h-8 py-0 border-none",children:[(0,b.jsx)(U.TableCell,{className:"text-[11px] py-1 text-slate-600 font-mono",children:"21/12/2025"}),(0,b.jsx)(U.TableCell,{className:"text-[11px] py-1 text-red-600 font-semibold italic",children:"cash_out"}),(0,b.jsx)(U.TableCell,{className:"text-[11px] py-1 text-slate-800 font-bold",children:"450.00"}),(0,b.jsx)(U.TableCell,{className:"text-[11px] py-1 truncate max-w-[80px]",children:"Office Supplies"}),(0,b.jsx)(U.TableCell,{className:"text-[11px] py-1",children:"Expenses"})]})]})]})}),(0,b.jsxs)("div",{className:"p-3 bg-blue-50/30 dark:bg-blue-900/10 text-[10px] text-blue-600 dark:text-blue-400 leading-relaxed border-t italic",children:[(0,b.jsx)("strong",{children:"Note:"})," Allowed types are: ",(0,b.jsx)("code",{className:"bg-blue-100 dark:bg-blue-900/30 px-1 rounded mx-0.5",children:"cash_in"}),", ",(0,b.jsx)("code",{className:"bg-blue-100 dark:bg-blue-900/30 px-1 rounded mx-0.5",children:"cash_out"}),", ",(0,b.jsx)("code",{className:"bg-blue-100 dark:bg-blue-900/30 px-1 rounded mx-0.5",children:"transfer"})]})]}),(0,b.jsx)("input",{ref:m,type:"file",accept:".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel",onChange:a=>{let b=a.target.files?.[0];b&&u(b)},className:"hidden"})]}),"preview"===k.step&&(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"bg-slate-50 dark:bg-slate-900 p-4 rounded-xl border border-slate-200 dark:border-slate-800",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,b.jsx)(H.FileText,{className:"h-5 w-5 text-blue-600"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-sm font-bold text-slate-900 dark:text-slate-100",children:k.file?.name}),(0,b.jsx)("p",{className:"text-[10px] text-slate-500",children:"File attached and analyzed"})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,b.jsx)(t.Card,{className:"shadow-none bg-emerald-50/50 dark:bg-emerald-900/10 border-emerald-100 dark:border-emerald-900/30 overflow-hidden",children:(0,b.jsxs)(t.CardContent,{className:"p-4",children:[(0,b.jsx)("div",{className:"text-2xl font-black text-emerald-600 dark:text-emerald-400",children:k.validRows.length}),(0,b.jsx)("p",{className:"text-[10px] font-bold text-emerald-700 dark:text-emerald-500 uppercase",children:"Valid Rows"})]})}),(0,b.jsx)(t.Card,{className:"shadow-none bg-rose-50/50 dark:bg-rose-900/10 border-rose-100 dark:border-rose-900/30 overflow-hidden",children:(0,b.jsxs)(t.CardContent,{className:"p-4",children:[(0,b.jsx)("div",{className:"text-2xl font-black text-rose-600 dark:text-rose-400",children:k.errors.length}),(0,b.jsx)("p",{className:"text-[10px] font-bold text-rose-700 dark:text-rose-500 uppercase",children:"Invalid"})]})}),(0,b.jsx)(t.Card,{className:"shadow-none bg-blue-50/50 dark:bg-blue-900/10 border-blue-100 dark:border-blue-900/30 overflow-hidden text-center",children:(0,b.jsxs)(t.CardContent,{className:"p-4 flex flex-col items-center justify-center",children:[(0,b.jsxs)("div",{className:"text-sm font-black text-blue-600 dark:text-blue-400 flex items-center gap-1",children:[Math.round(k.validRows.length/k.totalRows*100)||0,"%",(0,b.jsx)(ay,{className:"h-3 w-3"})]}),(0,b.jsx)("p",{className:"text-[10px] font-bold text-blue-700 dark:text-blue-500 uppercase",children:"Integrity"})]})})]})]}),k.errors.length>0&&(0,b.jsxs)(ar.Alert,{variant:"destructive",className:"bg-rose-50/50 dark:bg-rose-900/10 border-rose-200 dark:border-rose-900",children:[(0,b.jsx)(aw.AlertCircle,{className:"h-4 w-4 text-rose-600"}),(0,b.jsxs)(ar.AlertDescription,{className:"text-xs text-rose-700 dark:text-rose-400 leading-relaxed font-medium",children:["Found ",k.errors.length," rows with errors that will be skipped during the process.",(0,b.jsxs)(s.Button,{variant:"link",className:"p-0 h-auto ml-2 text-rose-700 dark:text-rose-400 underline font-bold",onClick:()=>(0,aA.generateErrorLogCSV)(k.errors,"transaction_upload_errors.csv"),children:[(0,b.jsx)(j.Download,{className:"h-3 w-3 mr-1 inline"}),"View Error Details"]})]})]}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)(s.Button,{variant:"ghost",className:"flex-1 hover:bg-slate-100 dark:hover:bg-slate-800",onClick:()=>l(a=>({...a,step:"select"})),children:"Choose Different File"}),(0,b.jsxs)(s.Button,{className:"flex-1 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 shadow-md font-bold transition-all active:scale-[0.98]",onClick:x,disabled:0===k.validRows.length,children:["Proceed with ",k.validRows.length," Records"]})]})]}),"uploading"===k.step&&(0,b.jsxs)("div",{className:"space-y-8 py-4",children:[(0,b.jsxs)("div",{className:"text-center space-y-2",children:[(0,b.jsxs)("div",{className:"relative w-20 h-20 mx-auto",children:[(0,b.jsx)("div",{className:"absolute inset-0 rounded-full border-4 border-slate-100 dark:border-slate-800"}),(0,b.jsx)("div",{className:"absolute inset-0 rounded-full border-4 border-t-blue-500 animate-spin"}),(0,b.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,b.jsx)(i.Upload,{className:"h-8 w-8 text-blue-500/50"})})]}),(0,b.jsx)("h3",{className:"text-lg font-bold text-slate-800 dark:text-slate-200",children:"Processing Data..."}),(0,b.jsx)("p",{className:"text-xs text-slate-500 dark:text-slate-400 italic",children:"This will only take a few moments"})]}),(0,b.jsxs)("div",{className:"space-y-2 px-4 text-center",children:[(0,b.jsx)(av.Progress,{value:k.uploadProgress,className:"h-2 w-full bg-slate-100 dark:bg-slate-800"}),(0,b.jsxs)("span",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest",children:[Math.round(k.uploadProgress),"% Complete"]})]}),(0,b.jsxs)(ar.Alert,{className:"bg-slate-50 dark:bg-slate-900 border-slate-200 dark:border-slate-800",children:[(0,b.jsx)(ap.Info,{className:"h-4 w-4 text-slate-400"}),(0,b.jsx)(ar.AlertDescription,{className:"text-xs text-slate-500 dark:text-slate-400 font-medium",children:"We are verifying and persisting each transaction. Please keep your browser window active."})]})]}),"complete"===k.step&&(0,b.jsxs)("div",{className:"space-y-6 pt-4 text-center",children:[(0,b.jsx)("div",{className:"bg-emerald-100 dark:bg-emerald-900/30 w-20 h-20 rounded-full flex items-center justify-center mx-auto shadow-inner",children:(0,b.jsx)(ax.CheckCircle,{className:"h-10 w-10 text-emerald-600 dark:text-emerald-400"})}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("h3",{className:"text-xl font-black text-slate-900 dark:text-slate-100",children:"Synchronized Successfully!"}),(0,b.jsxs)("p",{className:"text-sm text-slate-500 dark:text-slate-400 leading-relaxed font-medium",children:["A total of ",(0,b.jsxs)("span",{className:"text-emerald-600 dark:text-emerald-400 font-bold",children:[k.successCount," transactions"]})," have been merged into the financial ledger.",k.failureCount>0&&(0,b.jsxs)("span",{className:"text-rose-500 font-bold",children:[" (",k.failureCount," entries reported issues)"]})]})]}),(0,b.jsx)(s.Button,{onClick:()=>{if(p)return;let a="complete"===k.step&&k.successCount>0;l({step:"select",file:null,validRows:[],errors:[],totalRows:0,uploadProgress:0,successCount:0,failureCount:0,currentTransactionIndex:0}),d(!1),a&&f()},className:"w-full h-12 rounded-xl text-lg font-bold shadow-lg transition-all hover:translate-y-[-2px] active:translate-y-[0px] bg-slate-900 hover:bg-black dark:bg-white dark:text-black dark:hover:bg-slate-200",children:"Return to Dashboard"})]})]})]})})};var aC=a.i(150897);a.s(["default",0,()=>{let{accountId:a}=(0,d.useParams)(),n=(0,d.useNavigate)(),[z]=(0,e.useSearchParams)(),A=(0,y.useIsMobile)(),{currentBusiness:B,isLoading:C}=(0,u.useBusiness)(),{accounts:D,isLoading:E,updateAccount:F,refreshAccounts:G}=(0,v.useCashAccounts)(),{transactions:H,createTransaction:I,updateTransaction:J,refreshTransactions:L,deleteTransaction:O,getDailySummary:P}=(0,w.useCashTransactions)(a),{settings:S}=(0,x.useBusinessSettings)(),{hasPermission:T,isLoading:U}=(0,$.useProfiles)(),{canManageFinanceAccounts:V}=(0,_.useFinancialVisibility)(),[W,Y]=(0,c.useState)(!1),[Z,ab]=(0,c.useState)(!1),[ac,ad]=(0,c.useState)(!1),[ae,af]=(0,c.useState)(!1),[ag,ah]=(0,c.useState)(!1),[aj,ak]=(0,c.useState)(!1),[al,am]=(0,c.useState)(null),[an,ao]=(0,c.useState)(null),[ap,aq]=(0,c.useState)(0),[as,at]=(0,c.useState)(!0),[av,ax]=(0,c.useState)(!1),[ay,az]=(0,c.useState)(0),[aA,aD]=(0,c.useState)("cash_in"),[aE,aF]=(0,c.useState)(!1),aG=D.find(b=>b.id===a);(0,c.useEffect)(()=>{if(a){let b=window.location.pathname+window.location.search;localStorage.setItem("lastVisitedCashAccount",a),localStorage.setItem("lastVisitedCashAccountUrl",b)}},[a,z]),(0,c.useEffect)(()=>{a&&(async()=>{at(!0);try{let b=await P(new Date,a);aq(b.closingBalance)}finally{at(!1)}})()},[a,P,H]);let aH=async()=>{ax(!0);try{if(await Promise.all([G(),L()]),a){at(!0);let b=await P(new Date,a);aq(b.closingBalance),at(!1)}az(a=>a+1)}catch(a){console.error("Error refreshing data:",a)}finally{ax(!1)}},aI=async()=>{await Promise.all([L(),G()]),a&&(at(!0),aq((await P(new Date,a)).closingBalance),at(!1)),az(a=>a+1)},aJ=async b=>{try{if(await I(b),Y(!1),await Promise.all([L(),G()]),a){at(!0);let b=await P(new Date,a);aq(b.closingBalance),at(!1)}az(a=>a+1)}catch(a){console.error("Error creating transaction:",a)}},aK=async(b,c)=>{try{if(await J(b,c),ab(!1),am(null),await Promise.all([L(),G()]),a){at(!0);let b=await P(new Date,a);aq(b.closingBalance),at(!1)}az(a=>a+1)}catch(a){console.error("Error updating transaction:",a)}},aL=async b=>{aF(!0);try{if(a){await F(a,b),ak(!1),at(!0);let c=await P(new Date,a);aq(c.closingBalance),at(!1)}}catch(a){console.error("Error updating account:",a)}finally{aF(!1)}},aM=a=>{aD(a),Y(!0)};if(C||!B||E||U)return(0,b.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,b.jsx)(K.default,{message:"Loading cash account details..."})});if(!T("finance","view"))return(0,b.jsxs)("div",{className:"max-w-4xl mx-auto p-6",children:[(0,b.jsxs)(ar.Alert,{variant:"destructive",children:[(0,b.jsx)(aw.AlertCircle,{className:"h-4 w-4"}),(0,b.jsx)(ar.AlertTitle,{children:"Access Denied"}),(0,b.jsx)(ar.AlertDescription,{children:"You do not have permission to view cash accounts. Please contact your administrator if you believe this is an error."})]}),(0,b.jsx)("div",{className:"mt-4",children:(0,b.jsx)(s.Button,{onClick:()=>n("/"),variant:"outline",children:"Back to Dashboard"})})]});let aN=T("finance","create"),aO=T("finance","edit");return aG?(0,b.jsxs)("div",{className:"space-y-6 p-4 md:p-0",children:[(0,b.jsx)(M,{open:W,onOpenChange:Y,onSubmit:aJ,accounts:D,defaultAccountId:a,presetTransactionType:aA}),(0,b.jsx)(N,{open:Z,onOpenChange:ab,onSubmit:aK,transaction:al,accounts:D}),(0,b.jsx)(Q,{open:ag,onOpenChange:ah,transaction:an}),(0,b.jsx)(R.default,{open:aj,onOpenChange:ak,onSubmit:aL,title:"Edit Cash Account",initialData:{name:aG.name,description:aG.description||"",openingBalance:aG.openingBalance,isDefault:aG.isDefault},isSubmitting:aE}),(0,b.jsx)(aB,{open:ae,onOpenChange:af,accountId:a||"",onUploadComplete:()=>{af(!1),aH()}}),(0,b.jsx)(au,{open:ac,onOpenChange:ad,accountId:a||"",onSuccess:()=>{ad(!1),aH()}}),(0,b.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[(0,b.jsx)("div",{className:"flex items-center gap-3",children:(0,b.jsxs)(s.Button,{variant:"ghost",size:"sm",type:"button",onClick:()=>{localStorage.removeItem("lastVisitedCashAccount"),localStorage.removeItem("lastVisitedCashAccountUrl"),n("/cash")},className:"gap-2 px-2 md:px-3",children:[(0,b.jsx)(k.ArrowLeft,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"Back to Cash"}),(0,b.jsx)("span",{className:"sm:hidden",children:"Back"})]})}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("h1",{className:"text-2xl md:text-3xl font-bold break-words",children:aG.name}),aG.description&&(0,b.jsx)("p",{className:"text-sm md:text-base text-muted-foreground",children:aG.description}),(0,b.jsx)("div",{className:"text-lg md:text-xl font-semibold",children:as?(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{children:"Current Balance:"}),(0,b.jsx)(r.Loader2,{className:"h-4 w-4 animate-spin text-muted-foreground"})]}):(0,b.jsxs)("span",{children:["Current Balance: ",V?(0,X.formatCashAmount)(ap,S.currency||"USD"):"•••"]})})]}),(0,b.jsx)("div",{className:"flex flex-wrap gap-2 sm:gap-3",children:aO&&(0,b.jsxs)(s.Button,{type:"button",variant:"outline",onClick:()=>ak(!0),className:"gap-2 text-sm",size:A?"sm":"default",children:[(0,b.jsx)(h.Edit,{className:"h-4 w-4"}),"Edit Account"]})})]}),(0,b.jsx)(t.Card,{className:"border-none shadow-md overflow-hidden bg-gradient-to-br from-white to-slate-50 dark:from-slate-900 dark:to-slate-950",children:(0,b.jsxs)("div",{className:"p-4 sm:p-6 space-y-4",children:[(0,b.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("h3",{className:"text-lg font-bold tracking-tight",children:"Transaction Center"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Manage your account entries efficiently"})]}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,b.jsx)(s.Button,{type:"button",onClick:aH,disabled:av,variant:"ghost",size:"icon",className:"h-9 w-9 rounded-full hover:bg-white dark:hover:bg-slate-800 shadow-sm border",title:"Refresh Data",children:(0,b.jsx)(l.RefreshCcw,{className:(0,X.cn)("h-4 w-4",av&&"animate-spin")})}),(0,b.jsx)(s.Button,{type:"button",variant:"ghost",size:"icon",onClick:aC.generateTransactionCSVTemplate,className:"h-9 w-9 rounded-full hover:bg-white dark:hover:bg-slate-800 shadow-sm border",title:"Download CSV Template",children:(0,b.jsx)(j.Download,{className:"h-4 w-4"})})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:[(0,b.jsxs)(s.Button,{type:"button",onClick:()=>Y(!0),disabled:!aN,className:(0,X.cn)("h-auto py-4 flex flex-col items-center justify-center gap-2 text-white shadow-lg border-none active:scale-[0.98] transition-all",aN?"bg-blue-600 hover:bg-blue-700":"bg-slate-400 cursor-not-allowed opacity-60"),children:[(0,b.jsx)("div",{className:"bg-white/20 p-2 rounded-lg",children:(0,b.jsx)(f.Plus,{className:"h-5 w-5"})}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("span",{className:"block font-bold",children:"New Entry"}),(0,b.jsx)("span",{className:"block text-[10px] opacity-80 font-medium",children:"Single Transaction"})]})]}),(0,b.jsxs)(s.Button,{type:"button",onClick:()=>ad(!0),variant:"outline",disabled:!aN,className:(0,X.cn)("h-auto py-4 flex flex-col items-center justify-center gap-2 border-slate-200 dark:border-slate-800 shadow-sm active:scale-[0.98] transition-all",aN?"hover:bg-indigo-50/50 dark:hover:bg-indigo-900/10 hover:border-indigo-200":"opacity-60 cursor-not-allowed"),children:[(0,b.jsx)("div",{className:"bg-indigo-100 dark:bg-indigo-900/30 p-2 rounded-lg text-indigo-600 dark:text-indigo-400",children:(0,b.jsx)(p.LayoutGrid,{className:"h-5 w-5"})}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("span",{className:"block font-bold",children:"Bulk Entry"}),(0,b.jsx)("span",{className:"block text-[10px] text-muted-foreground font-medium",children:"Manual Batch"})]})]}),(0,b.jsxs)(s.Button,{type:"button",onClick:()=>af(!0),variant:"outline",disabled:!aN,className:(0,X.cn)("h-auto py-4 flex flex-col items-center justify-center gap-2 border-slate-200 dark:border-slate-800 shadow-sm col-span-1 sm:col-span-2 lg:col-span-1 active:scale-[0.98] transition-all",aN?"hover:bg-emerald-50/50 dark:hover:bg-emerald-900/10 hover:border-emerald-200":"opacity-60 cursor-not-allowed"),children:[(0,b.jsx)("div",{className:"bg-emerald-100 dark:bg-emerald-900/30 p-2 rounded-lg text-emerald-600 dark:text-emerald-400",children:(0,b.jsx)(i.Upload,{className:"h-5 w-5"})}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("span",{className:"block font-bold",children:"Import CSV"}),(0,b.jsx)("span",{className:"block text-[10px] text-muted-foreground font-medium",children:"Process Legacy Logs"})]})]})]})]})}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 px-1",children:[(0,b.jsx)(q.Zap,{className:"h-4 w-4 text-amber-500 fill-amber-500"}),(0,b.jsx)("h4",{className:"text-sm font-bold uppercase tracking-wider text-slate-500",children:"Quick Shortcuts"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[(0,b.jsxs)(s.Button,{type:"button",variant:"outline",onClick:()=>aM("cash_in"),disabled:!aN,className:(0,X.cn)("group justify-between h-12 border-green-100 dark:border-green-900/30 transition-all font-semibold",aN?"hover:bg-green-50 dark:hover:bg-green-900/10 hover:border-green-300":"opacity-60 cursor-not-allowed"),children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"bg-green-100 dark:bg-green-900/30 p-1.5 rounded-md text-green-600",children:(0,b.jsx)(g.ArrowUpRight,{className:"h-4 w-4"})}),(0,b.jsx)("span",{className:"text-green-700 dark:text-green-400",children:"Cash In"})]}),aN&&(0,b.jsx)(f.Plus,{className:"h-3 w-3 text-green-300 opacity-0 group-hover:opacity-100 transition-opacity"})]}),(0,b.jsxs)(s.Button,{type:"button",variant:"outline",onClick:()=>aM("cash_out"),disabled:!aN,className:(0,X.cn)("group justify-between h-12 border-red-100 dark:border-red-900/30 transition-all font-semibold",aN?"hover:bg-red-50 dark:hover:bg-red-900/10 hover:border-red-300":"opacity-60 cursor-not-allowed"),children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"bg-red-100 dark:bg-red-900/30 p-1.5 rounded-md text-red-600",children:(0,b.jsx)(m.ArrowDownRight,{className:"h-4 w-4"})}),(0,b.jsx)("span",{className:"text-red-700 dark:text-red-400",children:"Cash Out"})]}),aN&&(0,b.jsx)(f.Plus,{className:"h-3 w-3 text-red-300 opacity-0 group-hover:opacity-100 transition-opacity"})]}),(0,b.jsxs)(s.Button,{type:"button",variant:"outline",onClick:()=>aM("transfer"),disabled:!aN,className:(0,X.cn)("group justify-between h-12 border-blue-100 dark:border-blue-900/30 transition-all font-semibold",aN?"hover:bg-blue-50 dark:hover:bg-blue-900/10 hover:border-blue-300":"opacity-60 cursor-not-allowed"),children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"bg-blue-100 dark:bg-blue-900/30 p-1.5 rounded-md text-blue-600",children:(0,b.jsx)(o,{className:"h-4 w-4"})}),(0,b.jsx)("span",{className:"text-blue-700 dark:text-blue-400",children:"Transfer"})]}),aN&&(0,b.jsx)(f.Plus,{className:"h-3 w-3 text-blue-300 opacity-0 group-hover:opacity-100 transition-opacity"})]})]})]}),(0,b.jsx)(ai,{accountId:a},ay),(0,b.jsxs)(t.Card,{children:[(0,b.jsx)(t.CardHeader,{className:"pb-3 md:pb-6",children:(0,b.jsx)(t.CardTitle,{className:"text-lg md:text-xl",children:"Recent Transactions"})}),(0,b.jsx)(t.CardContent,{className:"px-3 md:px-6",children:(0,b.jsx)(aa,{transactions:H,accountId:a,showAccountColumn:!1,onEditTransaction:a=>{am(a),ab(!0)},onViewTransaction:a=>{ao(a),ah(!0)},onTransactionDeleted:aI})})]})]}):(0,b.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Account not found"}),(0,b.jsx)(s.Button,{onClick:()=>n("/cash"),children:"Back to Cash Accounts"})]})})}],419676)}];

//# sourceMappingURL=src_pages_CashAccount_tsx_3b489577._.js.map