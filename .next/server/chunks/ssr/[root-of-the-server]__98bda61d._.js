module.exports=[463021,(a,b,c)=>{b.exports=a.x("@prisma/client-2c3a283f134fdcb6",()=>require("@prisma/client-2c3a283f134fdcb6"))},723862,a=>a.a(async(b,c)=>{try{let b=await a.y("pg-587764f78a6c7a9c");a.n(b),c()}catch(a){c(a)}},!0),180490,a=>{a.v({name:"dotenv",version:"16.6.1",description:"Loads environment variables from .env file",main:"lib/main.js",types:"lib/main.d.ts",exports:{".":{types:"./lib/main.d.ts",require:"./lib/main.js",default:"./lib/main.js"},"./config":"./config.js","./config.js":"./config.js","./lib/env-options":"./lib/env-options.js","./lib/env-options.js":"./lib/env-options.js","./lib/cli-options":"./lib/cli-options.js","./lib/cli-options.js":"./lib/cli-options.js","./package.json":"./package.json"},scripts:{"dts-check":"tsc --project tests/types/tsconfig.json",lint:"standard",pretest:"npm run lint && npm run dts-check",test:"tap run --allow-empty-coverage --disable-coverage --timeout=60000","test:coverage":"tap run --show-full-coverage --timeout=60000 --coverage-report=text --coverage-report=lcov",prerelease:"npm test",release:"standard-version"},repository:{type:"git",url:"git://github.com/motdotla/dotenv.git"},homepage:"https://github.com/motdotla/dotenv#readme",funding:"https://dotenvx.com",keywords:["dotenv","env",".env","environment","variables","config","settings"],readmeFilename:"README.md",license:"BSD-2-Clause",devDependencies:{"@types/node":"^18.11.3",decache:"^4.6.2",sinon:"^14.0.1",standard:"^17.0.0","standard-version":"^9.5.0",tap:"^19.2.0",typescript:"^4.8.4"},engines:{node:">=12"},browser:{fs:!1}})},522734,(a,b,c)=>{b.exports=a.x("fs",()=>require("fs"))},632502,a=>a.a(async(b,c)=>{try{var d=a.i(137936),e=a.i(319343),f=a.i(713095),g=b([e]);async function h(a){try{let b=await e.db.branchSettings.findUnique({where:{branchId:a}});if(!b)return null;return{id:b.id,business_name:b.businessName,business_address:b.address,business_phone:b.phone,business_email:b.email,business_logo:b.logo,currency:b.currency,signature:b.signatureImage,metadata:b.metadata||{}}}catch(a){return console.error("Error fetching business settings:",a),null}}async function i(a,b,c){try{if(!await e.db.branch.findFirst({where:{id:a,OR:[{adminId:b},{users:{some:{id:b}}}]}}))return{success:!1,error:"Unauthorized to update branch settings"};let d={businessName:c.business_name,address:c.business_address,phone:c.business_phone,email:c.business_email,logo:c.business_logo,currency:c.currency,signatureImage:c.signature,metadata:c.metadata},f=await e.db.branchSettings.upsert({where:{branchId:a},update:d,create:{branchId:a,...d}});return{success:!0,data:{id:f.id,business_name:f.businessName,business_address:f.address,business_phone:f.phone,business_email:f.email,business_logo:f.logo,currency:f.currency,signature:f.signatureImage,metadata:f.metadata}}}catch(a){return console.error("Error upserting business settings:",a),{success:!1,error:a.message||"Failed to update settings"}}}async function j(a){try{let b=await e.db.user.findUnique({where:{id:a},select:{isFrozen:!0,createdAt:!0,subscriptions:{where:{status:"active"},orderBy:{endDate:"desc"},take:1},branches:{select:{id:!0}}}});if(!b)return null;let c=b.subscriptions[0],d=new Date,f=c?Math.ceil((c.endDate.getTime()-d.getTime())/864e5):0;return{is_frozen:b.isFrozen,location_limit:1,billing_amount:c?Number(c.amount):5e4,billing_duration:"Monthly",days_remaining:Math.max(0,f),next_billing_date:c?.endDate.toISOString()||""}}catch(a){return console.error("Error fetching account status:",a),{is_frozen:!1,location_limit:1,billing_amount:5e4,billing_duration:"Monthly",days_remaining:30,next_billing_date:""}}}async function k(a){try{let b=await e.db.branchSettings.findUnique({where:{branchId:a}});if(!b)return null;return{id:b.id,location_id:b.branchId,business_name:b.businessName,business_address:b.address,business_phone:b.phone,business_email:b.email,business_logo:b.logo,completed:!!b.businessName&&!!b.phone,is_frozen:!1}}catch(a){return console.error("Error fetching onboarding status:",a),null}}[e]=g.then?(await g)():g,(0,f.ensureServerEntryExports)([h,i,j,k]),(0,d.registerServerReference)(h,"40290a4fc6b8571a026afeb877566edb807919e482",null),(0,d.registerServerReference)(i,"70837cf9b9b85e45a6367e7e3a592457c34a990d2e",null),(0,d.registerServerReference)(j,"4011d3f24165a1ff4c6519d47357cf1974ec9d298f",null),(0,d.registerServerReference)(k,"40ee1dba433f3b3dc0f2791052194d1420c0946197",null),a.s(["getAccountStatusAction",()=>j,"getBusinessSettingsAction",()=>h,"getOnboardingStatusAction",()=>k,"upsertBusinessSettingsAction",()=>i]),c()}catch(a){c(a)}},!1),962602,a=>a.a(async(b,c)=>{try{var d=a.i(137936),e=a.i(319343),f=a.i(713095),g=b([e]);async function h(a){try{return(await e.db.transaction.findMany({where:{userId:a,type:"subscription",status:{in:["completed","success"]}},orderBy:{createdAt:"desc"}})).map(a=>({id:a.id,created_at:a.createdAt.toISOString(),billing_cycle:a.billingCycle,amount:a.amount,payment_status:a.status,pesapal_tracking_id:a.pesapalOrderTrackingId}))}catch(a){return console.error("Error fetching subscription payments:",a),[]}}async function i(a,b,c,d,f){try{let b=crypto.randomUUID();await e.db.transaction.create({data:{id:b,userId:a,pesapalMerchantReference:b,amount:c,status:"pending",type:"subscription",billingCycle:d}});let g=process.env.VITE_SUPABASE_URL||"https://ujgxxcgemmfmfsbngnqo.supabase.co",h=process.env.VITE_SUPABASE_ANON_KEY||process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;if(!g||!h)throw Error("Supabase credentials missing for Edge Function invocation");let i=await fetch(`${g}/functions/v1/pesapal-payment`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},body:JSON.stringify({purchaseId:b,amount:c,phoneNumber:f,description:`Subscription Renewal - ${d} Plan`})});if(!i.ok){let a=await i.json();throw Error(a.error||"Failed to invoke payment function")}let j=await i.json();if(j?.redirect_url)return await e.db.transaction.update({where:{id:b},data:{pesapalOrderTrackingId:j.order_tracking_id}}),{success:!0,redirect_url:j.redirect_url};throw Error("No redirect URL returned from Pesapal")}catch(a){return console.error("Error initiating subscription payment:",a),{success:!1,error:a.message}}}[e]=g.then?(await g)():g,(0,f.ensureServerEntryExports)([h,i]),(0,d.registerServerReference)(h,"40ba16ec3b325b2283f3e465df8c454e2cd68b45a2",null),(0,d.registerServerReference)(i,"7cf9757e320c46f955c6d99f3b8c16f72db910a81d",null),a.s(["getSubscriptionPaymentsAction",()=>h,"initiateSubscriptionPaymentAction",()=>i]),c()}catch(a){c(a)}},!1),293735,a=>a.a(async(b,c)=>{try{var d=a.i(719789),e=a.i(657141),f=a.i(480453),g=a.i(632502),h=a.i(962602),i=b([d,e,f,g,h]);[d,e,f,g,h]=i.then?(await i)():i,a.s([]),c()}catch(a){c(a)}},!1),283049,a=>a.a(async(b,c)=>{try{var d=a.i(293735),e=a.i(719789),f=a.i(657141),g=a.i(480453),h=a.i(632502),i=a.i(962602),j=b([d,e,f,g,h,i]);[d,e,f,g,h,i]=j.then?(await j)():j,a.s(["4011d3f24165a1ff4c6519d47357cf1974ec9d298f",()=>h.getAccountStatusAction,"4071ca673ee83cf4e327275e6cacdae94950b7fa0e",()=>g.getProfilesAction,"4085da50dd0bf206cb5893edda258b1fb6087fb94b",()=>e.signUpAction,"408ffa5a6991ba3e64aa45862bed880555b1e6c2ac",()=>f.removeBusinessPasswordAction,"4097618b1feff5bb1f466d7ef73901ab8f5cb1ab7d",()=>f.getBusinessLocationsAction,"40a4b8447ff959c91ed080f8a56d7de9480694b288",()=>g.deleteProfileAction,"40ba16ec3b325b2283f3e465df8c454e2cd68b45a2",()=>i.getSubscriptionPaymentsAction,"40ee1dba433f3b3dc0f2791052194d1420c0946197",()=>h.getOnboardingStatusAction,"600c0285b1a230950447aea12ad4361b35b7957acf",()=>f.deleteBusinessAction,"601f435e1ee906932885a36b02b1480071685e0cc2",()=>e.signInAction,"6028252923753001f049a6422f229f06bbec8b1f79",()=>g.updateProfileAction,"60364422a73402f3b5e59fb0aa7bbc8b9374b14ab5",()=>f.verifyBusinessPasswordAction,"606359dfb6b88f4f4b756b5c416007efbe2fcb1fcc",()=>f.setBusinessPasswordAction,"608339c001209003cae74bf0c032c55c8444c1ef85",()=>g.createProfileAction,"60b753a09691b4217e6751307f35f59cee17dc35d7",()=>f.resetBusinessAction,"60d7c3d2a9fae9e08d24867d93fe36b7505e38a2e0",()=>f.createBusinessAction,"70837cf9b9b85e45a6367e7e3a592457c34a990d2e",()=>h.upsertBusinessSettingsAction,"70dd23d5987603253209c3c012d3079124803d1be2",()=>f.updateBusinessAction,"7cf9757e320c46f955c6d99f3b8c16f72db910a81d",()=>i.initiateSubscriptionPaymentAction]),c()}catch(a){c(a)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__98bda61d._.js.map