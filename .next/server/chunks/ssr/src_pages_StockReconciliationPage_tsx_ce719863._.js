module.exports=[198093,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(391956),e=a.i(169819),f=a.i(591119),g=a.i(866718),h=a.i(699570),i=a.i(814574),j=a.i(786304),k=a.i(269876),l=a.i(292e3),m=a.i(816201),n=a.i(653277),o=a.i(724669),p=a.i(170106);let q=(0,p.default)("PackagePlus",[["path",{d:"M16 16h6",key:"100bgy"}],["path",{d:"M19 13v6",key:"85cyf1"}],["path",{d:"M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14",key:"e7tb2h"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["line",{x1:"12",x2:"12",y1:"22",y2:"12",key:"a4e8g8"}]]),r=(0,p.default)("PackageMinus",[["path",{d:"M16 16h6",key:"100bgy"}],["path",{d:"M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14",key:"e7tb2h"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["line",{x1:"12",x2:"12",y1:"22",y2:"12",key:"a4e8g8"}]]);var s=a.i(823292),t=a.i(866102),u=a.i(400291),v=a.i(156171),w=a.i(3048);let x=({product:a,onClose:g,onReconciled:p})=>{let{user:x}=(0,d.useAuth)(),{currentBusiness:y}=(0,e.useBusiness)(),{settings:z}=(0,t.useBusinessSettings)(),{canViewCostPrice:A,canViewSellingPrice:B,formatFinancial:C}=(0,u.useFinancialVisibility)(),[D,E]=(0,c.useState)(!1),[F,G]=(0,c.useState)(!1),[H,I]=(0,c.useState)(!0),[J,K]=(0,c.useState)({currentStock:0,openingStock:0,itemsSold:0,stockAdded:0,transferOut:0,returnIn:0,returnOut:0,adjustments:0,calculatedClosingStock:0,discrepancy:0,openingDate:null,excludedSalesQty:0,dailyBreakdown:[]}),[L,M]=(0,c.useState)(a.costPrice||0),[N,O]=(0,c.useState)(a.sellingPrice||0);(0,c.useEffect)(()=>{M(a.costPrice||0),O(a.sellingPrice||0)},[a.id,a.costPrice,a.sellingPrice]),(0,c.useEffect)(()=>{(async()=>{if(y?.id){I(!0);try{let b=await (0,v.getProductReconciliationAction)(y.id,a.id);b.success&&b.data?K(b.data):s.toast.error(b.error||"Failed to calculate reconciliation data")}catch(a){console.error("Error calculating reconciliation:",a),s.toast.error("An unexpected error occurred during reconciliation calculation")}finally{I(!1)}}})()},[y?.id,a.id]);let P=J.currentStock*(a.costPrice||0),Q=J.currentStock*(a.sellingPrice||0),R=J.calculatedClosingStock*L,S=J.calculatedClosingStock*N,T=R-P,U=S-Q,V=Math.abs(J.discrepancy)>.01,W=async()=>{if(x?.id&&y?.id){E(!0);try{if(await (0,w.updateProductAction)(a.id,{userId:x.id,quantity:J.calculatedClosingStock,costPrice:L,sellingPrice:N,customChangeReason:"Stock Reconciliation"}))s.toast.success(`Stock reconciled successfully! Corrected ${Math.abs(J.discrepancy).toFixed(2)} units.`),p(),g();else throw Error("Update failed")}catch(a){console.error("Error reconciling stock:",a),s.toast.error("Failed to reconcile stock. Please try again.")}finally{E(!1)}}};return(0,b.jsx)(i.Dialog,{open:!0,onOpenChange:g,children:(0,b.jsxs)(i.DialogContent,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsxs)(i.DialogHeader,{children:[(0,b.jsxs)(i.DialogTitle,{className:"flex items-center gap-2",children:[V?(0,b.jsx)(l.AlertCircle,{className:"h-5 w-5 text-orange-500"}):(0,b.jsx)(m.CheckCircle,{className:"h-5 w-5 text-green-500"}),"Stock Reconciliation - ",a.name]}),(0,b.jsx)(i.DialogDescription,{children:"Review stock calculations and apply corrections if needed"})]}),H?(0,b.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,b.jsx)("div",{className:"text-muted-foreground",children:"Loading reconciliation data..."})}):(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{className:"pb-3",children:(0,b.jsx)(f.CardTitle,{className:"text-sm font-medium",children:"Current Stock"})}),(0,b.jsx)(f.CardContent,{children:(0,b.jsx)("div",{className:"text-2xl font-bold",children:J.currentStock.toFixed(2)})})]}),(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{className:"pb-3",children:(0,b.jsx)(f.CardTitle,{className:"text-sm font-medium",children:"Calculated Stock"})}),(0,b.jsx)(f.CardContent,{children:(0,b.jsx)("div",{className:"text-2xl font-bold",children:J.calculatedClosingStock.toFixed(2)})})]})]}),(0,b.jsxs)(f.Card,{className:"border-sales-primary/20 bg-sales-primary/5",children:[(0,b.jsx)(f.CardHeader,{className:"pb-3",children:(0,b.jsxs)(f.CardTitle,{className:"text-base flex items-center gap-2",children:[(0,b.jsx)(o.TrendingUp,{className:"h-4 w-4 text-sales-primary"}),"Valuation & Price Adjustment"]})}),(0,b.jsxs)(f.CardContent,{children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-6",children:[A&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:"Adjustment Cost Price"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground text-sm",children:z.currency}),(0,b.jsx)("input",{type:"number",value:L,onChange:a=>M(Number(a.target.value)),className:"w-full pl-12 pr-4 py-2 bg-white border rounded-md text-sm focus:ring-2 focus:ring-sales-primary/20 outline-none transition-all"})]}),(0,b.jsx)("p",{className:"text-[10px] text-muted-foreground",children:"Affects Cost Value"})]}),B&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:"Adjustment Selling Price"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground text-sm",children:z.currency}),(0,b.jsx)("input",{type:"number",value:N,onChange:a=>O(Number(a.target.value)),className:"w-full pl-12 pr-4 py-2 bg-white border rounded-md text-sm focus:ring-2 focus:ring-sales-primary/20 outline-none transition-all"})]}),(0,b.jsx)("p",{className:"text-[10px] text-muted-foreground",children:"Affects Stock Value"})]})]}),(0,b.jsxs)("div",{className:"mt-4 pt-4 border-t border-sales-primary/10 grid grid-cols-2 gap-4",children:[A&&(0,b.jsxs)("div",{className:"p-3 rounded-lg bg-white border shadow-sm",children:[(0,b.jsx)("p",{className:"text-[10px] font-bold text-muted-foreground uppercase mb-1",children:"Cost Valuation Impact"}),(0,b.jsx)("div",{className:"flex items-end justify-between",children:(0,b.jsxs)("span",{className:`text-base font-bold ${T>=0?"text-emerald-600":"text-rose-600"}`,children:[T>=0?"+":"",C(T,"cost")]})})]}),B&&(0,b.jsxs)("div",{className:"p-3 rounded-lg bg-white border shadow-sm",children:[(0,b.jsx)("p",{className:"text-[10px] font-bold text-muted-foreground uppercase mb-1",children:"Stock Valuation Impact"}),(0,b.jsx)("div",{className:"flex items-end justify-between",children:(0,b.jsxs)("span",{className:`text-base font-bold ${U>=0?"text-violet-600":"text-rose-600"}`,children:[U>=0?"+":"",C(U,"selling")]})})]})]})]})]}),(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsx)(f.CardTitle,{className:"text-base",children:"Stock Calculation Summary"})}),(0,b.jsxs)(f.CardContent,{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:"Opening Stock"}),(0,b.jsx)("span",{className:"font-medium",children:J.openingStock.toFixed(2)})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center text-red-600",children:[(0,b.jsxs)("span",{className:"text-sm flex items-center gap-1",children:[(0,b.jsx)(n.TrendingDown,{className:"h-4 w-4"}),"Items Sold"]}),(0,b.jsxs)("span",{className:"font-medium",children:["- ",J.itemsSold.toFixed(2)]})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center text-emerald-600",children:[(0,b.jsxs)("span",{className:"text-sm flex items-center gap-1",children:[(0,b.jsx)(q,{className:"h-4 w-4"}),"Stock Added"]}),(0,b.jsxs)("span",{className:"font-medium",children:["+ ",J.stockAdded.toFixed(2)]})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center text-orange-600",children:[(0,b.jsxs)("span",{className:"text-sm flex items-center gap-1",children:[(0,b.jsx)(r,{className:"h-4 w-4"}),"Transfer Out"]}),(0,b.jsxs)("span",{className:"font-medium",children:["- ",J.transferOut.toFixed(2)]})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center text-blue-600",children:[(0,b.jsxs)("span",{className:"text-sm flex items-center gap-1",children:[(0,b.jsx)(q,{className:"h-4 w-4"}),"Return In"]}),(0,b.jsxs)("span",{className:"font-medium",children:["+ ",J.returnIn.toFixed(2)]})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center text-purple-600",children:[(0,b.jsxs)("span",{className:"text-sm flex items-center gap-1",children:[(0,b.jsx)(r,{className:"h-4 w-4"}),"Return Out"]}),(0,b.jsxs)("span",{className:"font-medium",children:["- ",J.returnOut.toFixed(2)]})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center text-amber-600",children:[(0,b.jsxs)("span",{className:"text-sm flex items-center gap-1",children:[(0,b.jsx)(l.AlertCircle,{className:"h-4 w-4"}),"Manual Adjustments"]}),(0,b.jsxs)("span",{className:"font-medium",children:[J.adjustments>0?"+":"",J.adjustments.toFixed(2)]})]}),(0,b.jsxs)("div",{className:"border-t pt-3 flex justify-between items-center font-semibold text-lg",children:[(0,b.jsx)("span",{children:"Calculated Closing Stock"}),(0,b.jsx)("span",{children:J.calculatedClosingStock.toFixed(2)})]}),V&&(0,b.jsxs)("div",{className:`border-t pt-3 flex justify-between items-center ${J.discrepancy>0?"text-green-600":"text-red-600"}`,children:[(0,b.jsx)("span",{className:"font-semibold",children:"Actual vs Calculated Discrepancy"}),(0,b.jsxs)(j.Badge,{variant:J.discrepancy>0?"default":"destructive",children:[J.discrepancy>0?"+":"",J.discrepancy.toFixed(2)," units"]})]})]})]}),(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsx)(f.CardTitle,{className:"text-base",children:"Daily Breakdown"})}),(0,b.jsx)(f.CardContent,{children:(0,b.jsx)(k.ScrollArea,{className:"h-[300px] pr-4",children:(0,b.jsx)("div",{className:"space-y-3",children:0===J.dailyBreakdown.length?(0,b.jsx)("div",{className:"text-center text-muted-foreground py-8",children:"No transactions found for this product"}):J.dailyBreakdown.map((a,c)=>(0,b.jsxs)(f.Card,{className:"p-3 bg-slate-50",children:[(0,b.jsx)("div",{className:"font-semibold text-sm mb-2 text-slate-700",children:new Date(a.date).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"})}),(0,b.jsxs)("div",{className:"space-y-1.5 text-xs",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Starting Stock:"}),(0,b.jsx)("span",{className:"font-medium",children:a.startingStock.toFixed(2)})]}),a.itemsSold>0&&(0,b.jsxs)("div",{className:"flex justify-between text-red-600",children:[(0,b.jsx)("span",{children:"Items Sold:"}),(0,b.jsxs)("span",{className:"font-medium",children:["-",a.itemsSold.toFixed(2)]})]}),a.stockAdded>0&&(0,b.jsxs)("div",{className:"flex justify-between text-emerald-600",children:[(0,b.jsx)("span",{children:"Stock Added:"}),(0,b.jsxs)("span",{className:"font-medium",children:["+",a.stockAdded.toFixed(2)]})]}),a.transferOut>0&&(0,b.jsxs)("div",{className:"flex justify-between text-orange-600",children:[(0,b.jsx)("span",{children:"Transfer Out:"}),(0,b.jsxs)("span",{className:"font-medium",children:["-",a.transferOut.toFixed(2)]})]}),a.returnIn>0&&(0,b.jsxs)("div",{className:"flex justify-between text-blue-600",children:[(0,b.jsx)("span",{children:"Return In:"}),(0,b.jsxs)("span",{className:"font-medium",children:["+",a.returnIn.toFixed(2)]})]}),a.returnOut>0&&(0,b.jsxs)("div",{className:"flex justify-between text-purple-600",children:[(0,b.jsx)("span",{children:"Return Out:"}),(0,b.jsxs)("span",{className:"font-medium",children:["-",a.returnOut.toFixed(2)]})]}),0!==a.adjustments&&(0,b.jsxs)("div",{className:"flex justify-between text-amber-600",children:[(0,b.jsx)("span",{children:"Adjustments:"}),(0,b.jsxs)("span",{className:"font-medium",children:[a.adjustments>0?"+":"",a.adjustments.toFixed(2)]})]}),(0,b.jsxs)("div",{className:"flex justify-between pt-1.5 border-t border-slate-200",children:[(0,b.jsx)("span",{className:"font-semibold text-slate-700",children:"Ending Stock:"}),(0,b.jsx)("span",{className:"font-bold text-slate-900",children:a.endingStock.toFixed(2)})]})]})]},c))})})})]}),V&&F&&(0,b.jsxs)(f.Card,{className:"bg-blue-50 border-blue-200",children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsx)(f.CardTitle,{className:"text-base text-blue-900",children:"Preview Correction"})}),(0,b.jsxs)(f.CardContent,{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-sm text-blue-800",children:"Current (Recorded):"}),(0,b.jsxs)("span",{className:"font-medium text-blue-900",children:[J.currentStock.toFixed(2)," units"]})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-sm text-blue-800",children:"Calculated (History):"}),(0,b.jsxs)("span",{className:"font-medium text-blue-900",children:[J.calculatedClosingStock.toFixed(2)," units"]})]}),(0,b.jsxs)("div",{className:"flex justify-between pt-2 border-t border-blue-200",children:[(0,b.jsx)("span",{className:"text-sm font-semibold text-blue-800",children:"Correction Amount:"}),(0,b.jsxs)("span",{className:"font-semibold text-blue-900",children:[J.discrepancy>0?"+":"",Math.abs(J.discrepancy).toFixed(2)," units"]})]})]})]}),!V&&(0,b.jsxs)("div",{className:"flex items-center gap-2 p-4 bg-green-50 border border-green-200 rounded-lg",children:[(0,b.jsx)(m.CheckCircle,{className:"h-5 w-5 text-green-600"}),(0,b.jsx)("p",{className:"text-sm text-green-800",children:"Stock levels are accurate based on transaction history."})]})]}),(0,b.jsxs)(i.DialogFooter,{children:[(0,b.jsx)(h.Button,{variant:"outline",onClick:g,children:"Cancel"}),V&&(0,b.jsx)(b.Fragment,{children:F?(0,b.jsx)(h.Button,{onClick:W,disabled:D,className:"bg-blue-600 hover:bg-blue-700",children:D?"Applying...":"Apply Correction"}):(0,b.jsx)(h.Button,{onClick:()=>G(!0),children:"Preview Correction"})})]})]})})};var y=a.i(894944),z=a.i(433217);let A=(0,p.default)("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);var B=a.i(890914),C=a.i(124348),D=a.i(665967),E=a.i(124565),F=a.i(913334),G=a.i(770288);a.s(["default",0,()=>{let{user:a}=(0,d.useAuth)(),m=(0,D.useNavigate)(),{currentBusiness:o,isLoading:p}=(0,e.useBusiness)(),{hasPermission:r,isLoading:t}=(0,B.useProfiles)(),[u,H]=(0,c.useState)(""),[I,J]=c.default.useState(null),[K,L]=(0,c.useState)(!1),[M,N]=(0,c.useState)(!1),[O,P]=(0,c.useState)(!1),[Q,R]=(0,c.useState)([]),[S,T]=(0,c.useState)(null),[U,V]=(0,c.useState)(!1),[W,X]=(0,c.useState)([]),[Y,Z]=(0,c.useState)(!1),[$,_]=(0,c.useState)(!1),{data:aa=[],isLoading:ab}=(0,z.useQuery)({queryKey:["all-products-reconciliation",a?.id,o?.id],queryFn:async()=>a?.id&&o?.id?await (0,w.getAllProductsAction)(a.id,o.id):[],enabled:!!a?.id&&!!o?.id,staleTime:12e4}),ac=(0,c.useMemo)(()=>{if(!u.trim())return[];let a=u.toLowerCase();return aa.filter(b=>b.name.toLowerCase().includes(a)||b.itemNumber?.toLowerCase().includes(a)||b.category?.toLowerCase().includes(a)||b.supplier?.toLowerCase().includes(a)||b.description?.toLowerCase().includes(a))},[aa,u]),ad=async()=>{if(o?.id){V(!0);try{let a=await (0,F.repairStockChainsAction)(o.id);if(a.success&&a.data){let{repaired:b,failed:c}=a.data;0===c?s.toast.success(`Stock chains repaired successfully for ${b} product(s).`):s.toast.warning(`Repaired ${b} product(s). ${c} failed.`)}}catch(a){console.error("Error repairing stock chains:",a),s.toast.error("Failed to repair stock chains.")}finally{V(!1),Z(!1)}}},ae=async()=>{if(o?.id){_(!0);try{let a=await (0,E.getStockRepairsPreviewAction)(o.id);a.success&&a.data&&(X(a.data),0===a.data.length?s.toast.success("No broken stock chains found!"):Z(!0))}catch(a){console.error("Error previewing stock repairs:",a),s.toast.error("Failed to preview stock repairs.")}finally{_(!1)}}},af=async()=>{if(!o?.id)return;N(!0);let a=[];try{for(let b of aa){let c=await (0,v.getProductReconciliationAction)(o.id,b.id);c.success&&c.data&&Math.abs(c.data.discrepancy)>.01&&a.push(c.data)}R(a),P(!0)}catch(a){console.error("Error calculating preview:",a),s.toast.error("Failed to calculate reconciliation preview.")}finally{N(!1)}},ag=async()=>{if(a?.id&&o?.id&&0!==Q.length){L(!0);try{let b=0,c=0;for(let d of Q)try{let c=await (0,G.createStockHistoryAction)({userId:a.id,locationId:o.id,productId:d.product.id,previousQuantity:d.currentStock,newQuantity:d.calculatedStock,changeReason:"Bulk Stock Reconciliation",createdAt:new Date().toISOString()});if(c.success)b++;else throw Error(c.error)}catch(a){c++,console.error(`Failed to reconcile ${d.product.name}:`,a)}s.toast.success(`Bulk reconciliation complete! Updated ${b} product(s).`),c>0&&s.toast.error(`${c} product(s) failed.`),P(!1),R([])}catch(a){console.error("Bulk reconciliation error:",a),s.toast.error("Failed to complete bulk reconciliation.")}finally{L(!1)}}};return p||t||!o?(0,b.jsx)(y.default,{}):r("inventory","stock_adjustment")?(0,b.jsxs)("div",{className:"p-2 md:p-6 space-y-4 md:space-y-6 max-w-full",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("h1",{className:"text-xl md:text-2xl lg:text-3xl font-bold text-sales-dark",children:"Stock Reconciliation"}),(0,b.jsx)("p",{className:"text-sm md:text-base text-muted-foreground",children:"Select a product, preview the correction, then apply."})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(h.Button,{onClick:ae,disabled:U||$||ab||0===aa.length,variant:"outline",size:"lg",children:[(0,b.jsx)(l.AlertCircle,{className:"h-4 w-4 mr-2"}),$?"Scanning...":"Preview Repairs"]}),(0,b.jsxs)(h.Button,{onClick:ad,disabled:U||$||ab||0===aa.length,variant:"secondary",size:"lg",children:[(0,b.jsx)(A,{className:"h-4 w-4 mr-2"}),U?"Repairing...":"Quick Repair All"]}),(0,b.jsx)(h.Button,{onClick:af,disabled:M||ab||0===aa.length,size:"lg",children:M?"Calculating...":"Reconcile All Products"})]})]}),(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsx)(f.CardTitle,{className:"text-base",children:"Search Product"})}),(0,b.jsxs)(f.CardContent,{className:"space-y-3",children:[(0,b.jsx)(g.Input,{placeholder:"Search by name, item number, category, or supplier",value:u,onChange:a=>H(a.target.value)}),u&&(0,b.jsx)("div",{className:"border rounded-md",children:(0,b.jsx)(k.ScrollArea,{className:"max-h-96",children:(0,b.jsxs)("ul",{className:"divide-y",children:[ab&&(0,b.jsx)("li",{className:"p-3 text-sm text-muted-foreground",children:"Loading products..."}),!ab&&0===ac.length&&(0,b.jsx)("li",{className:"p-3 text-sm text-muted-foreground",children:"No matching products found"}),(!ab&&ac).map(a=>(0,b.jsxs)("li",{className:"p-3 hover:bg-muted/40 cursor-pointer",onClick:()=>J(a),children:[(0,b.jsx)("div",{className:"font-medium",children:a.name}),(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:[a.itemNumber?`Item: ${a.itemNumber}`:"—"," • Qty: ",a.quantity," • Cat: ",a.category||"—"]})]},a.id))]})})})]})]}),I&&(0,b.jsx)(x,{product:I,onClose:()=>J(null),onReconciled:()=>J(null)}),(0,b.jsx)(i.Dialog,{open:O,onOpenChange:P,children:(0,b.jsxs)(i.DialogContent,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsxs)(i.DialogHeader,{children:[(0,b.jsxs)(i.DialogTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(l.AlertCircle,{className:"h-5 w-5 text-orange-500"}),"Bulk Reconciliation Preview"]}),(0,b.jsxs)(i.DialogDescription,{children:[Q.length," product(s) with discrepancies found."]})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{className:"pb-3",children:(0,b.jsx)(f.CardTitle,{className:"text-sm",children:"Products to Update"})}),(0,b.jsx)(f.CardContent,{children:(0,b.jsx)("div",{className:"text-2xl font-bold",children:Q.length})})]}),(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{className:"pb-3",children:(0,b.jsx)(f.CardTitle,{className:"text-sm",children:"Total Adjustment"})}),(0,b.jsx)(f.CardContent,{children:(0,b.jsxs)("div",{className:"text-2xl font-bold",children:[Q.reduce((a,b)=>a+Math.abs(b.discrepancy),0).toFixed(2)," units"]})})]})]}),(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsx)(f.CardTitle,{className:"text-base",children:"Products with Discrepancies"})}),(0,b.jsx)(f.CardContent,{children:(0,b.jsx)(k.ScrollArea,{className:"h-[400px]",children:(0,b.jsx)("div",{className:"space-y-2",children:Q.map(a=>(0,b.jsx)(f.Card,{className:"p-3 cursor-pointer hover:bg-muted/50",onClick:()=>T(a),children:(0,b.jsxs)("div",{className:"flex justify-between items-start",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("div",{className:"font-semibold",children:a.product.name}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:a.product.itemNumber&&`Item: ${a.product.itemNumber}`})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsxs)("div",{className:"text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Current:"})," ",Number(a.currentStock).toFixed(2)]}),(0,b.jsxs)("div",{className:"text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Calculated:"})," ",Number(a.calculatedStock).toFixed(2)]}),(0,b.jsxs)(j.Badge,{variant:a.discrepancy>0?"default":"destructive",className:"mt-1",children:[a.discrepancy>0?"+":"",a.discrepancy.toFixed(2)]})]})]})},a.product.id))})})})]})]}),(0,b.jsxs)(i.DialogFooter,{children:[(0,b.jsx)(h.Button,{variant:"outline",onClick:()=>P(!1),disabled:K,children:"Cancel"}),(0,b.jsx)(h.Button,{onClick:ag,disabled:K,children:K?"Applying...":`Apply Reconciliation (${Q.length} products)`})]})]})}),S&&(0,b.jsx)(i.Dialog,{open:!!S,onOpenChange:()=>T(null),children:(0,b.jsxs)(i.DialogContent,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsxs)(i.DialogHeader,{children:[(0,b.jsx)(i.DialogTitle,{children:S.product.name}),(0,b.jsx)(i.DialogDescription,{children:"Detailed reconciliation breakdown"})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{className:"pb-3",children:(0,b.jsx)(f.CardTitle,{className:"text-sm",children:"Current Stock"})}),(0,b.jsx)(f.CardContent,{children:(0,b.jsx)("div",{className:"text-2xl font-bold",children:Number(S.currentStock).toFixed(2)})})]}),(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{className:"pb-3",children:(0,b.jsx)(f.CardTitle,{className:"text-sm",children:"Calculated Stock"})}),(0,b.jsx)(f.CardContent,{children:(0,b.jsx)("div",{className:"text-2xl font-bold",children:Number(S.calculatedStock).toFixed(2)})})]})]}),(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsx)(f.CardTitle,{className:"text-base",children:"Stock Calculation"})}),(0,b.jsxs)(f.CardContent,{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:"Opening Stock"}),(0,b.jsx)("span",{className:"font-medium",children:Number(S.openingStock).toFixed(2)})]}),(0,b.jsxs)("div",{className:"flex justify-between text-red-600",children:[(0,b.jsxs)("span",{className:"text-sm flex items-center gap-1",children:[(0,b.jsx)(n.TrendingDown,{className:"h-4 w-4"})," Items Sold"]}),(0,b.jsxs)("span",{className:"font-medium",children:["-",Number(S.itemsSold).toFixed(2)]})]}),(0,b.jsxs)("div",{className:"flex justify-between text-emerald-600",children:[(0,b.jsxs)("span",{className:"text-sm flex items-center gap-1",children:[(0,b.jsx)(q,{className:"h-4 w-4"})," Stock Added"]}),(0,b.jsxs)("span",{className:"font-medium",children:["+",Number(S.stockAdded).toFixed(2)]})]}),(0,b.jsxs)("div",{className:"border-t pt-3 flex justify-between font-semibold",children:[(0,b.jsx)("span",{children:"Calculated Closing Stock"}),(0,b.jsx)("span",{children:Number(S.calculatedStock).toFixed(2)})]})]})]})]}),(0,b.jsx)(i.DialogFooter,{children:(0,b.jsx)(h.Button,{onClick:()=>T(null),children:"Close"})})]})})]}):(0,b.jsxs)("div",{className:"max-w-4xl mx-auto p-6",children:[(0,b.jsxs)(C.Alert,{variant:"destructive",children:[(0,b.jsx)(l.AlertCircle,{className:"h-4 w-4"}),(0,b.jsx)(C.AlertTitle,{children:"Access Denied"}),(0,b.jsx)(C.AlertDescription,{children:"You do not have permission to access stock reconciliation."})]}),(0,b.jsx)("div",{className:"mt-4",children:(0,b.jsx)(h.Button,{onClick:()=>m("/inventory"),variant:"outline",children:"Back to Inventory"})})]})}],198093)}];

//# sourceMappingURL=src_pages_StockReconciliationPage_tsx_ce719863._.js.map