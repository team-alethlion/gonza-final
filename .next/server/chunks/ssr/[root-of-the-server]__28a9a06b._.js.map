{"version":3,"sources":["turbopack:///[project]/node_modules/dotenv/package.json","../../../../src/app/actions/business-settings.ts","../../../../.next-internal/server/app/products/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["{\"name\":\"dotenv\",\"version\":\"16.6.1\",\"description\":\"Loads environment variables from .env file\",\"main\":\"lib/main.js\",\"types\":\"lib/main.d.ts\",\"exports\":{\".\":{\"types\":\"./lib/main.d.ts\",\"require\":\"./lib/main.js\",\"default\":\"./lib/main.js\"},\"./config\":\"./config.js\",\"./config.js\":\"./config.js\",\"./lib/env-options\":\"./lib/env-options.js\",\"./lib/env-options.js\":\"./lib/env-options.js\",\"./lib/cli-options\":\"./lib/cli-options.js\",\"./lib/cli-options.js\":\"./lib/cli-options.js\",\"./package.json\":\"./package.json\"},\"scripts\":{\"dts-check\":\"tsc --project tests/types/tsconfig.json\",\"lint\":\"standard\",\"pretest\":\"npm run lint && npm run dts-check\",\"test\":\"tap run --allow-empty-coverage --disable-coverage --timeout=60000\",\"test:coverage\":\"tap run --show-full-coverage --timeout=60000 --coverage-report=text --coverage-report=lcov\",\"prerelease\":\"npm test\",\"release\":\"standard-version\"},\"repository\":{\"type\":\"git\",\"url\":\"git://github.com/motdotla/dotenv.git\"},\"homepage\":\"https://github.com/motdotla/dotenv#readme\",\"funding\":\"https://dotenvx.com\",\"keywords\":[\"dotenv\",\"env\",\".env\",\"environment\",\"variables\",\"config\",\"settings\"],\"readmeFilename\":\"README.md\",\"license\":\"BSD-2-Clause\",\"devDependencies\":{\"@types/node\":\"^18.11.3\",\"decache\":\"^4.6.2\",\"sinon\":\"^14.0.1\",\"standard\":\"^17.0.0\",\"standard-version\":\"^9.5.0\",\"tap\":\"^19.2.0\",\"typescript\":\"^4.8.4\"},\"engines\":{\"node\":\">=12\"},\"browser\":{\"fs\":false}}","'use server';\r\n\r\nimport { db } from '../../../prisma/db';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\nexport async function getBusinessSettingsAction(branchId: string) {\r\n    try {\r\n        const settings = await db.branchSettings.findUnique({\r\n            where: { branchId }\r\n        });\r\n\r\n        if (!settings) {\r\n            return null;\r\n        }\r\n\r\n        return {\r\n            id: settings.id,\r\n            business_name: settings.businessName,\r\n            business_address: settings.address,\r\n            business_phone: settings.phone,\r\n            business_email: settings.email,\r\n            business_logo: settings.logo,\r\n            currency: settings.currency,\r\n            signature: settings.signatureImage,\r\n            metadata: settings.metadata || {}\r\n        };\r\n    } catch (error) {\r\n        console.error('Error fetching business settings:', error);\r\n        return null;\r\n    }\r\n}\r\n\r\nexport async function upsertBusinessSettingsAction(branchId: string, userId: string, updateData: any) {\r\n    try {\r\n        // Validate user access to branch\r\n        const branch = await db.branch.findFirst({\r\n            where: {\r\n                id: branchId,\r\n                OR: [\r\n                    { adminId: userId },\r\n                    { users: { some: { id: userId } } }\r\n                ]\r\n            }\r\n        });\r\n\r\n        if (!branch) {\r\n            return { success: false, error: 'Unauthorized to update branch settings' };\r\n        }\r\n\r\n        const data = {\r\n            businessName: updateData.business_name,\r\n            address: updateData.business_address,\r\n            phone: updateData.business_phone,\r\n            email: updateData.business_email,\r\n            logo: updateData.business_logo,\r\n            currency: updateData.currency,\r\n            signatureImage: updateData.signature,\r\n            metadata: updateData.metadata\r\n        };\r\n\r\n        const upserted = await db.branchSettings.upsert({\r\n            where: { branchId: branchId },\r\n            update: data,\r\n            create: {\r\n                branchId: branchId,\r\n                ...data\r\n            }\r\n        });\r\n\r\n        return {\r\n            success: true,\r\n            data: {\r\n                id: upserted.id,\r\n                business_name: upserted.businessName,\r\n                business_address: upserted.address,\r\n                business_phone: upserted.phone,\r\n                business_email: upserted.email,\r\n                business_logo: upserted.logo,\r\n                currency: upserted.currency,\r\n                signature: upserted.signatureImage,\r\n                metadata: upserted.metadata\r\n            }\r\n        };\r\n    } catch (error: any) {\r\n        console.error('Error upserting business settings:', error);\r\n        return { success: false, error: error.message || 'Failed to update settings' };\r\n    }\r\n}\r\n\r\nexport async function getAccountStatusAction(userId: string) {\r\n    try {\r\n        const user = await db.user.findUnique({\r\n            where: { id: userId },\r\n            select: {\r\n                isFrozen: true,\r\n                createdAt: true,\r\n                subscriptions: {\r\n                    where: { status: 'active' },\r\n                    orderBy: { endDate: 'desc' },\r\n                    take: 1\r\n                },\r\n                branches: {\r\n                    select: { id: true }\r\n                }\r\n            }\r\n        });\r\n\r\n        if (!user) return null;\r\n\r\n        const activeSub = user.subscriptions[0];\r\n        const now = new Date();\r\n        const daysRemaining = activeSub ? Math.ceil((activeSub.endDate.getTime() - now.getTime()) / (1000 * 60 * 60 * 24)) : 0;\r\n\r\n        return {\r\n            is_frozen: user.isFrozen,\r\n            location_limit: 1, // Traditional limit or from subscription\r\n            billing_amount: activeSub ? Number(activeSub.amount) : 50000,\r\n            billing_duration: 'Monthly',\r\n            days_remaining: Math.max(0, daysRemaining),\r\n            next_billing_date: activeSub?.endDate.toISOString() || ''\r\n        };\r\n    } catch (error) {\r\n        console.error('Error fetching account status:', error);\r\n        return { is_frozen: false, location_limit: 1, billing_amount: 50000, billing_duration: 'Monthly', days_remaining: 30, next_billing_date: '' };\r\n    }\r\n}\r\n\r\nexport async function getOnboardingStatusAction(locationId: string) {\r\n    try {\r\n        const settings = await db.branchSettings.findUnique({\r\n            where: { branchId: locationId }\r\n        });\r\n\r\n        if (!settings) return null;\r\n\r\n        return {\r\n            id: settings.id,\r\n            location_id: settings.branchId,\r\n            business_name: settings.businessName,\r\n            business_address: settings.address,\r\n            business_phone: settings.phone,\r\n            business_email: settings.email,\r\n            business_logo: settings.logo,\r\n            completed: !!settings.businessName && !!settings.phone, // Simplified completion check\r\n            is_frozen: false // Should come from branch or user status\r\n        };\r\n    } catch (error) {\r\n        console.error('Error fetching onboarding status:', error);\r\n        return null;\r\n    }\r\n}\r\n","export {signInAction as '601f435e1ee906932885a36b02b1480071685e0cc2'} from 'ACTIONS_MODULE0'\nexport {signUpAction as '4085da50dd0bf206cb5893edda258b1fb6087fb94b'} from 'ACTIONS_MODULE0'\nexport {setBusinessPasswordAction as '606359dfb6b88f4f4b756b5c416007efbe2fcb1fcc'} from 'ACTIONS_MODULE1'\nexport {verifyBusinessPasswordAction as '60364422a73402f3b5e59fb0aa7bbc8b9374b14ab5'} from 'ACTIONS_MODULE1'\nexport {removeBusinessPasswordAction as '408ffa5a6991ba3e64aa45862bed880555b1e6c2ac'} from 'ACTIONS_MODULE1'\nexport {getBusinessLocationsAction as '4097618b1feff5bb1f466d7ef73901ab8f5cb1ab7d'} from 'ACTIONS_MODULE1'\nexport {createBusinessAction as '60d7c3d2a9fae9e08d24867d93fe36b7505e38a2e0'} from 'ACTIONS_MODULE1'\nexport {updateBusinessAction as '70dd23d5987603253209c3c012d3079124803d1be2'} from 'ACTIONS_MODULE1'\nexport {deleteBusinessAction as '600c0285b1a230950447aea12ad4361b35b7957acf'} from 'ACTIONS_MODULE1'\nexport {resetBusinessAction as '60b753a09691b4217e6751307f35f59cee17dc35d7'} from 'ACTIONS_MODULE1'\nexport {getProfilesAction as '4071ca673ee83cf4e327275e6cacdae94950b7fa0e'} from 'ACTIONS_MODULE2'\nexport {createProfileAction as '608339c001209003cae74bf0c032c55c8444c1ef85'} from 'ACTIONS_MODULE2'\nexport {updateProfileAction as '6028252923753001f049a6422f229f06bbec8b1f79'} from 'ACTIONS_MODULE2'\nexport {deleteProfileAction as '40a4b8447ff959c91ed080f8a56d7de9480694b288'} from 'ACTIONS_MODULE2'\nexport {signOutAction as '00d7265d135808e9c70b4e1d48649ff9e645425b5c'} from 'ACTIONS_MODULE0'\nexport {signUpAction as '4085da50dd0bf206cb5893edda258b1fb6087fb94b'} from 'ACTIONS_MODULE0'\nexport {signInAction as '601f435e1ee906932885a36b02b1480071685e0cc2'} from 'ACTIONS_MODULE0'\nexport {resetPasswordAction as '60b4ae0f406ec773d479f8c810284331e005276a79'} from 'ACTIONS_MODULE0'\nexport {removeBusinessPasswordAction as '408ffa5a6991ba3e64aa45862bed880555b1e6c2ac'} from 'ACTIONS_MODULE1'\nexport {getBusinessLocationsAction as '4097618b1feff5bb1f466d7ef73901ab8f5cb1ab7d'} from 'ACTIONS_MODULE1'\nexport {deleteBusinessAction as '600c0285b1a230950447aea12ad4361b35b7957acf'} from 'ACTIONS_MODULE1'\nexport {verifyBusinessPasswordAction as '60364422a73402f3b5e59fb0aa7bbc8b9374b14ab5'} from 'ACTIONS_MODULE1'\nexport {setBusinessPasswordAction as '606359dfb6b88f4f4b756b5c416007efbe2fcb1fcc'} from 'ACTIONS_MODULE1'\nexport {resetBusinessAction as '60b753a09691b4217e6751307f35f59cee17dc35d7'} from 'ACTIONS_MODULE1'\nexport {createBusinessAction as '60d7c3d2a9fae9e08d24867d93fe36b7505e38a2e0'} from 'ACTIONS_MODULE1'\nexport {updateBusinessAction as '70dd23d5987603253209c3c012d3079124803d1be2'} from 'ACTIONS_MODULE1'\nexport {getAccountStatusAction as '4011d3f24165a1ff4c6519d47357cf1974ec9d298f'} from 'ACTIONS_MODULE3'\nexport {getBusinessSettingsAction as '40290a4fc6b8571a026afeb877566edb807919e482'} from 'ACTIONS_MODULE3'\nexport {getOnboardingStatusAction as '40ee1dba433f3b3dc0f2791052194d1420c0946197'} from 'ACTIONS_MODULE3'\nexport {upsertBusinessSettingsAction as '70837cf9b9b85e45a6367e7e3a592457c34a990d2e'} from 'ACTIONS_MODULE3'\nexport {deleteRoleAction as '4051b0115f438ba3dd6196d0c8dbb545e2e4fbd8c4'} from 'ACTIONS_MODULE2'\nexport {getRolesAction as '4052909717fb7c5829a34f18b1cedd1784304b0419'} from 'ACTIONS_MODULE2'\nexport {getProfilesAction as '4071ca673ee83cf4e327275e6cacdae94950b7fa0e'} from 'ACTIONS_MODULE2'\nexport {deleteProfileAction as '40a4b8447ff959c91ed080f8a56d7de9480694b288'} from 'ACTIONS_MODULE2'\nexport {updateProfileAction as '6028252923753001f049a6422f229f06bbec8b1f79'} from 'ACTIONS_MODULE2'\nexport {createProfileAction as '608339c001209003cae74bf0c032c55c8444c1ef85'} from 'ACTIONS_MODULE2'\nexport {upsertRoleAction as '60fb2389f1a7f9190d01c7bd2da1f5e38add1594cd'} from 'ACTIONS_MODULE2'\n"],"names":[],"mappings":"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"}