{"version":3,"sources":["turbopack:///[project]/node_modules/dotenv/package.json","../../../../src/app/actions/expenses.ts","../../../../.next-internal/server/app/business-management/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["{\"name\":\"dotenv\",\"version\":\"16.6.1\",\"description\":\"Loads environment variables from .env file\",\"main\":\"lib/main.js\",\"types\":\"lib/main.d.ts\",\"exports\":{\".\":{\"types\":\"./lib/main.d.ts\",\"require\":\"./lib/main.js\",\"default\":\"./lib/main.js\"},\"./config\":\"./config.js\",\"./config.js\":\"./config.js\",\"./lib/env-options\":\"./lib/env-options.js\",\"./lib/env-options.js\":\"./lib/env-options.js\",\"./lib/cli-options\":\"./lib/cli-options.js\",\"./lib/cli-options.js\":\"./lib/cli-options.js\",\"./package.json\":\"./package.json\"},\"scripts\":{\"dts-check\":\"tsc --project tests/types/tsconfig.json\",\"lint\":\"standard\",\"pretest\":\"npm run lint && npm run dts-check\",\"test\":\"tap run --allow-empty-coverage --disable-coverage --timeout=60000\",\"test:coverage\":\"tap run --show-full-coverage --timeout=60000 --coverage-report=text --coverage-report=lcov\",\"prerelease\":\"npm test\",\"release\":\"standard-version\"},\"repository\":{\"type\":\"git\",\"url\":\"git://github.com/motdotla/dotenv.git\"},\"homepage\":\"https://github.com/motdotla/dotenv#readme\",\"funding\":\"https://dotenvx.com\",\"keywords\":[\"dotenv\",\"env\",\".env\",\"environment\",\"variables\",\"config\",\"settings\"],\"readmeFilename\":\"README.md\",\"license\":\"BSD-2-Clause\",\"devDependencies\":{\"@types/node\":\"^18.11.3\",\"decache\":\"^4.6.2\",\"sinon\":\"^14.0.1\",\"standard\":\"^17.0.0\",\"standard-version\":\"^9.5.0\",\"tap\":\"^19.2.0\",\"typescript\":\"^4.8.4\"},\"engines\":{\"node\":\">=12\"},\"browser\":{\"fs\":false}}","'use server';\r\n\r\nimport { db } from '../../../prisma/db';\r\n\r\nexport async function getExpensesForChartAction(\r\n    branchId: string,\r\n    from?: string,\r\n    to?: string\r\n): Promise<{ date: string; amount: number }[]> {\r\n    try {\r\n        const where: any = { branchId };\r\n        if (from || to) {\r\n            where.date = {};\r\n            if (from) where.date.gte = new Date(from);\r\n            if (to) where.date.lte = new Date(to);\r\n        }\r\n        const expenses = await db.expense.findMany({\r\n            where,\r\n            select: { date: true, amount: true },\r\n        });\r\n        return expenses.map((e: any) => ({\r\n            date: e.date.toISOString(),\r\n            amount: Number(e.amount),\r\n        }));\r\n    } catch (error) {\r\n        console.error('[getExpensesForChartAction]', error);\r\n        return [];\r\n    }\r\n}\r\n\r\nexport async function getBusinessBackupDataAction(userId: string, branchId: string) {\r\n    try {\r\n        const [\r\n            products,\r\n            categories,\r\n            stockHistory,\r\n            sales,\r\n            customers,\r\n            expenses,\r\n            expenseCategories,\r\n            tasks,\r\n            taskCategories,\r\n            carriageInwards,\r\n        ] = await Promise.all([\r\n            db.product.findMany({ where: { branchId } }),\r\n            db.category.findMany({ where: { branchId } }),\r\n            db.productHistory.findMany({ where: { locationId: branchId } }),\r\n            db.sale.findMany({ where: { branchId } }),\r\n            db.customer.findMany({ where: { branchId } }),\r\n            db.expense.findMany({ where: { branchId } }),\r\n            db.expenseCategory.findMany({ where: { branchId } }),\r\n            db.task.findMany({ where: { branchId } }),\r\n            db.taskCategory.findMany({ where: { branchId } }),\r\n            db.carriageInward.findMany({ where: { branchId } }),\r\n        ]);\r\n\r\n        return {\r\n            success: true,\r\n            data: {\r\n                products,\r\n                product_categories: categories,\r\n                stock_history: stockHistory,\r\n                sales,\r\n                customers,\r\n                expenses,\r\n                expense_categories: expenseCategories,\r\n                tasks,\r\n                task_categories: taskCategories,\r\n                carriage_inwards: carriageInwards,\r\n            },\r\n        };\r\n    } catch (error: any) {\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\nexport async function createSubscriptionPaymentAction(\r\n    purchaseId: string,\r\n    userId: string,\r\n    branchId: string,\r\n    amount: number,\r\n    billingCycle: string\r\n) {\r\n    try {\r\n        // Use a raw query or custom model if subscription_payments is not in Prisma schema\r\n        // For now, log and return â€“ implement when schema supports it\r\n        console.log('[createSubscriptionPaymentAction] Payment record:', { purchaseId, userId, branchId, amount, billingCycle });\r\n        return { success: true };\r\n    } catch (error: any) {\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\nexport async function getLatestSubscriptionPaymentAction(userId: string) {\r\n    try {\r\n        // Return null if subscription_payments table isn't in Prisma schema yet\r\n        return { success: true, data: null };\r\n    } catch (error: any) {\r\n        return { success: false, data: null, error: error.message };\r\n    }\r\n}\r\n","export {signInAction as '601f435e1ee906932885a36b02b1480071685e0cc2'} from 'ACTIONS_MODULE0'\nexport {signUpAction as '4085da50dd0bf206cb5893edda258b1fb6087fb94b'} from 'ACTIONS_MODULE0'\nexport {setBusinessPasswordAction as '606359dfb6b88f4f4b756b5c416007efbe2fcb1fcc'} from 'ACTIONS_MODULE1'\nexport {verifyBusinessPasswordAction as '60364422a73402f3b5e59fb0aa7bbc8b9374b14ab5'} from 'ACTIONS_MODULE1'\nexport {removeBusinessPasswordAction as '408ffa5a6991ba3e64aa45862bed880555b1e6c2ac'} from 'ACTIONS_MODULE1'\nexport {getBusinessLocationsAction as '4097618b1feff5bb1f466d7ef73901ab8f5cb1ab7d'} from 'ACTIONS_MODULE1'\nexport {createBusinessAction as '60d7c3d2a9fae9e08d24867d93fe36b7505e38a2e0'} from 'ACTIONS_MODULE1'\nexport {updateBusinessAction as '70dd23d5987603253209c3c012d3079124803d1be2'} from 'ACTIONS_MODULE1'\nexport {deleteBusinessAction as '600c0285b1a230950447aea12ad4361b35b7957acf'} from 'ACTIONS_MODULE1'\nexport {resetBusinessAction as '60b753a09691b4217e6751307f35f59cee17dc35d7'} from 'ACTIONS_MODULE1'\nexport {getProfilesAction as '4071ca673ee83cf4e327275e6cacdae94950b7fa0e'} from 'ACTIONS_MODULE2'\nexport {createProfileAction as '608339c001209003cae74bf0c032c55c8444c1ef85'} from 'ACTIONS_MODULE2'\nexport {updateProfileAction as '6028252923753001f049a6422f229f06bbec8b1f79'} from 'ACTIONS_MODULE2'\nexport {deleteProfileAction as '40a4b8447ff959c91ed080f8a56d7de9480694b288'} from 'ACTIONS_MODULE2'\nexport {getBusinessBackupDataAction as '60cb37a955a3f0fc9842da415e4b6b6c26c486a212'} from 'ACTIONS_MODULE3'\n"],"names":[],"mappings":"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"}