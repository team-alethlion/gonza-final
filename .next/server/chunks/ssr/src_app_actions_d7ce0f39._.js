module.exports=[849664,a=>a.a(async(b,c)=>{try{var d=a.i(137936),e=a.i(319343),f=a.i(118558),g=a.i(713095),h=b([e]);async function i(a,b){try{let a=new Date,c=new Date(a.getFullYear(),a.getMonth(),1),d=await e.db.customer.count({where:{branchId:b,createdAt:{gte:c}}}),f=await e.db.customer.count({where:{branchId:b,birthday:{not:null}}});return{success:!0,data:{withBirthdays:f,thisMonth:d}}}catch(a){return console.error("Error fetching customer stats:",a),{success:!1,error:a.message}}}async function j(a,b){try{if(!a||0===b.length)return{success:!1,error:"Invalid selection"};return await e.db.$transaction(async c=>{await c.sale.updateMany({where:{customerId:{in:b}},data:{customerId:a}}),await c.customer.deleteMany({where:{id:{in:b}}})}),(0,f.revalidatePath)("/customers"),{success:!0}}catch(a){return console.error("Error merging customers:",a),{success:!1,error:a.message||"Failed to merge customers"}}}async function k(a){try{let b=await e.db.customer.findMany({where:{branchId:a},orderBy:{name:"asc"}}),c=await e.db.customer.count({where:{branchId:a}}),d=b.map(a=>({id:a.id,fullName:a.name,phoneNumber:a.phone,email:a.email,birthday:a.birthday?a.birthday.toISOString():null,gender:a.gender,location:a.address,categoryId:a.categoryId,notes:a.notes,tags:a.tags||[],socialMedia:a.socialMedia||null,createdAt:a.createdAt.toISOString(),updatedAt:a.updatedAt.toISOString()}));return{success:!0,data:{customers:d,count:c}}}catch(a){return console.error("Error fetching customers:",a),{success:!1,error:a.message}}}async function l(a,b,c){try{let d=await e.db.customer.create({data:{branchId:a,adminId:b,name:c.fullName,phone:c.phoneNumber||null,email:c.email||null,birthday:c.birthday?new Date(c.birthday):null,gender:c.gender||null,address:c.location||null,categoryId:c.categoryId||null,notes:c.notes||null,tags:c.tags||[],socialMedia:c.socialMedia||null}});return(0,f.revalidatePath)("/customers"),{success:!0,data:d}}catch(a){return console.error("Error creating customer:",a),{success:!1,error:a.message}}}async function m(a,b){try{let c={};void 0!==b.fullName&&(c.name=b.fullName),void 0!==b.phoneNumber&&(c.phone=b.phoneNumber),void 0!==b.email&&(c.email=b.email),void 0!==b.birthday&&(c.birthday=b.birthday?new Date(b.birthday):null),void 0!==b.gender&&(c.gender=b.gender),void 0!==b.location&&(c.address=b.location),void 0!==b.categoryId&&(c.categoryId=b.categoryId),void 0!==b.notes&&(c.notes=b.notes),void 0!==b.tags&&(c.tags=b.tags),void 0!==b.socialMedia&&(c.socialMedia=b.socialMedia);let d=await e.db.customer.update({where:{id:a},data:c});return(0,f.revalidatePath)("/customers"),{success:!0,data:d}}catch(a){return console.error("Error updating customer:",a),{success:!1,error:a.message}}}async function n(a){try{return await e.db.customer.delete({where:{id:a}}),(0,f.revalidatePath)("/customers"),{success:!0}}catch(a){return console.error("Error deleting customer:",a),{success:!1,error:a.message}}}async function o(a){try{let b=(await e.db.customerCategory.findMany({where:{branchId:a},orderBy:{name:"asc"}})).map(a=>({id:a.id,name:a.name,isDefault:a.isDefault,createdAt:a.createdAt.toISOString(),updatedAt:a.updatedAt.toISOString()}));return{success:!0,data:b}}catch(a){return console.error("Error fetching customer categories:",a),{success:!1,error:a.message}}}async function p(a,b,c){try{let d=await e.db.customerCategory.create({data:{branchId:a,name:c.trim(),isDefault:!1,userId:b}});return(0,f.revalidatePath)("/customers"),{success:!0,data:d}}catch(a){return console.error("Error creating customer category:",a),{success:!1,error:a.message}}}async function q(a,b){try{let c=await e.db.customerCategory.update({where:{id:a},data:{name:b.trim()}});return(0,f.revalidatePath)("/customers"),{success:!0,data:c}}catch(a){return console.error("Error updating customer category:",a),{success:!1,error:a.message}}}async function r(a){try{return await e.db.customerCategory.delete({where:{id:a}}),(0,f.revalidatePath)("/customers"),{success:!0}}catch(a){return console.error("Error deleting customer category:",a),{success:!1,error:a.message}}}[e]=h.then?(await h)():h,(0,g.ensureServerEntryExports)([i,j,k,l,m,n,o,p,q,r]),(0,d.registerServerReference)(i,"600ac80e87b60a5c02e2c4c1f0b6a0a7dc2d33be23",null),(0,d.registerServerReference)(j,"601c2e81e5452f88769b0bfbde3086892068006dee",null),(0,d.registerServerReference)(k,"40227d1c2ed5cbf6324cf519682235031f0a3138a5",null),(0,d.registerServerReference)(l,"708938753470d59bd6fa4ddf41a8a3581263dd393b",null),(0,d.registerServerReference)(m,"609ad415d8b556837c750a19320a30ea6d4beaf896",null),(0,d.registerServerReference)(n,"40f9d32b0ea15e5c8f0b3441eec79ddb30815f1c83",null),(0,d.registerServerReference)(o,"40696a4456c7690d29b12ef602356cbc9be3c34a97",null),(0,d.registerServerReference)(p,"70b04375c8b1e7a5a64b19d8153628c90f1150c267",null),(0,d.registerServerReference)(q,"605890db4ca201299b68a3100db491232317cf530d",null),(0,d.registerServerReference)(r,"4032dd367fa6b4bfc08062e47a1ca2ffb5e5eb04b0",null),a.s(["createCustomerAction",()=>l,"createCustomerCategoryAction",()=>p,"deleteCustomerAction",()=>n,"deleteCustomerCategoryAction",()=>r,"getCustomerCategoriesAction",()=>o,"getCustomerStatsAction",()=>i,"getCustomersAction",()=>k,"mergeCustomersAction",()=>j,"updateCustomerAction",()=>m,"updateCustomerCategoryAction",()=>q]),c()}catch(a){c(a)}},!1),404123,a=>a.a(async(b,c)=>{try{var d=a.i(137936),e=a.i(319343),f=a.i(118558),g=a.i(713095),h=b([e]);async function i(a,b){try{let c={locationId:a};b&&(c.productId=b);let d=await e.db.productHistory.findMany({where:c,include:{product:{select:{name:!0,costPrice:!0,sellingPrice:!0,sku:!0}}},orderBy:[{createdAt:"desc"},{id:"desc"}]});return{success:!0,data:d.map(a=>({id:a.id,productId:a.productId,oldQuantity:a.previousQuantity,newQuantity:a.newQuantity,changeReason:a.changeReason,createdAt:a.createdAt.toISOString(),referenceId:a.referenceId,receiptNumber:a.receiptNumber,product:a.product?{name:a.product.name,costPrice:a.product.costPrice,sellingPrice:a.product.sellingPrice,itemNumber:a.product.sku}:void 0}))}}catch(a){return console.error("Error fetching stock history:",a),{success:!1,error:a.message}}}async function j(a){try{let b=await e.db.$transaction(async b=>{let c=await b.productHistory.create({data:{userId:a.userId,locationId:a.locationId,productId:a.productId,previousQuantity:a.previousQuantity,newQuantity:a.newQuantity,changeReason:a.changeReason,referenceId:a.referenceId||null,receiptNumber:a.receiptNumber||null,createdAt:a.createdAt?new Date(a.createdAt):void 0}});return await b.product.update({where:{id:a.productId},data:{stock:a.newQuantity}}),c});return(0,f.revalidatePath)("/inventory"),{success:!0,data:b}}catch(a){return console.error("Error creating stock history:",a),{success:!1,error:a.message}}}async function k(a,b){try{let c=await e.db.$transaction(async c=>{let d=await c.productHistory.findMany({where:{productId:a,locationId:b},orderBy:[{createdAt:"asc"},{id:"asc"}]});if(0===d.length)return{finalQuantity:0};let e=0,f=[];for(let a of d){let b=a.newQuantity-a.previousQuantity,d=e,g=d+b;(a.previousQuantity!==d||a.newQuantity!==g)&&f.push(c.productHistory.update({where:{id:a.id},data:{previousQuantity:d,newQuantity:g}})),e=g}return f.length>0&&await Promise.all(f),await c.product.update({where:{id:a},data:{stock:e}}),{finalQuantity:e}});return(0,f.revalidatePath)("/inventory"),{success:!0,data:c}}catch(a){return console.error("Error recalculating stock chain:",a),{success:!1,error:a.message}}}async function l(a,b){try{let c=await e.db.$transaction(async c=>{let d=await c.productHistory.findMany({where:{referenceId:a,locationId:b},select:{productId:!0}}),e=[...new Set(d.map(a=>a.productId))];for(let d of(await c.productHistory.deleteMany({where:{referenceId:a,locationId:b}}),e))await n(c,d,b);return{affectedProducts:e.length}});return(0,f.revalidatePath)("/inventory"),{success:!0,data:c}}catch(a){return console.error("Error deleting stock history by reference:",a),{success:!1,error:a.message}}}async function m(a,b,c){try{let d=await e.db.productHistory.updateMany({where:{referenceId:a,locationId:b},data:{createdAt:new Date(c)}});return(0,f.revalidatePath)("/inventory"),{success:!0,data:d}}catch(a){return console.error("Error updating stock history dates:",a),{success:!1,error:a.message}}}async function n(a,b,c){let d=await a.productHistory.findMany({where:{productId:b,locationId:c},orderBy:[{createdAt:"asc"},{id:"asc"}]}),e=0;for(let b of d){let c=b.newQuantity-b.previousQuantity,d=e,f=d+c;(b.previousQuantity!==d||b.newQuantity!==f)&&await a.productHistory.update({where:{id:b.id},data:{previousQuantity:d,newQuantity:f}}),e=f}await a.product.update({where:{id:b},data:{stock:e}})}async function o(a,b){try{let c=await e.db.requisition.findMany({where:{userId:a,locationId:b},orderBy:{createdAt:"desc"}});return{success:!0,data:c.map(a=>({id:a.id,userId:a.userId,locationId:a.branchId,requisitionNumber:a.requisitionNumber,title:a.title||"",items:a.items||[],notes:a.notes,status:a.status,createdAt:a.createdAt.toISOString(),updatedAt:a.updatedAt.toISOString()}))}}catch(a){return console.error("Error fetching requisitions:",a),{success:!1,error:a.message}}}async function p(a){try{let b=await e.db.requisition.create({data:{userId:a.userId,branchId:a.locationId,requisitionNumber:a.requisitionNumber,title:a.title,items:a.items,notes:a.notes,status:a.status||"draft"}});return(0,f.revalidatePath)("/requisitions"),{success:!0,data:{id:b.id,userId:b.userId,locationId:b.branchId,requisitionNumber:b.requisitionNumber,title:b.title||"",items:b.items||[],notes:b.notes,status:b.status,createdAt:b.createdAt.toISOString(),updatedAt:b.updatedAt.toISOString()}}}catch(a){return console.error("Error creating requisition:",a),{success:!1,error:a.message}}}async function q(a,b,c){try{let d=await e.db.requisition.update({where:{id:a,userId:b},data:{title:c.title,items:c.items,notes:c.notes,status:c.status,updatedAt:new Date}});return(0,f.revalidatePath)("/requisitions"),{success:!0,data:{id:d.id,userId:d.userId,locationId:d.branchId,requisitionNumber:d.requisitionNumber,title:d.title||"",items:d.items||[],notes:d.notes,status:d.status,createdAt:d.createdAt.toISOString(),updatedAt:d.updatedAt.toISOString()}}}catch(a){return console.error("Error updating requisition:",a),{success:!1,error:a.message}}}async function r(a,b){try{return await e.db.requisition.delete({where:{id:a,userId:b}}),(0,f.revalidatePath)("/requisitions"),{success:!0}}catch(a){return console.error("Error deleting requisition:",a),{success:!1,error:a.message}}}async function s(a,b,c){try{let d=new Date(b),f=new Date(c),g=await e.db.product.findMany({where:{branchId:a},include:{category:!0}}),h=await Promise.all(g.map(async b=>{let c=await e.db.productHistory.findMany({where:{productId:b.id,locationId:a,createdAt:{gte:d,lte:f}},orderBy:{createdAt:"asc"}}),g=0,h=0,i=0,j=0;c.forEach(a=>{let b=a.newQuantity-a.previousQuantity;"SALE"===a.changeReason?g+=Math.abs(b):"STOCK_IN"===a.changeReason||"RESTOCK"===a.changeReason?h+=b:b>0?i+=b:j+=Math.abs(b)});let k=await e.db.productHistory.findFirst({where:{productId:b.id,locationId:a,createdAt:{lte:f}},orderBy:{createdAt:"desc"}}),l=k?k.newQuantity:0,m=l-(h+i-g-j);return{productId:b.id,productName:b.name,itemNumber:b.sku||b.id,imageUrl:b.imageUrl,costPrice:Number(b.costPrice),sellingPrice:Number(b.sellingPrice),category:b.category?.name,openingStock:m,itemsSold:g,stockIn:h,transferOut:0,returnIn:0,returnOut:0,adjustmentsIn:i,adjustmentsOut:j,closingStock:l,revaluation:l*Number(b.costPrice)}}));return{success:!0,data:h}}catch(a){return console.error("Error generating stock summary report:",a),{success:!1,error:a.message}}}async function t(a,b){try{let c=await e.db.product.findUnique({where:{id:b},include:{category:!0}});if(!c)return{success:!1,error:"Product not found"};let d=await e.db.productHistory.findMany({where:{productId:b,locationId:a},orderBy:[{createdAt:"asc"},{id:"asc"}]}),f=await e.db.sale.findMany({where:{branchId:a},orderBy:{date:"asc"}}),g=d.length>0?d[0].newStock:0,h=d.length>0?d[0].createdAt:null,i=new Map,j=0;f.forEach(a=>{let c=(a.items||[]).filter(a=>a.productId===b).reduce((a,b)=>a+(Number(b.quantity)||0),0);if(c>0)if(h&&a.date<h)j+=c;else{let b=a.date.toISOString().split("T")[0],d=i.get(b)||{itemsSold:0,stockAdded:0,transferOut:0,returnIn:0,returnOut:0,adjustments:0};d.itemsSold+=c,i.set(b,d)}}),d.slice(1).forEach(a=>{let b=a.createdAt.toISOString().split("T")[0],c=a.newStock-a.oldStock,d=(a.changeReason||"").toLowerCase(),e=i.get(b)||{itemsSold:0,stockAdded:0,transferOut:0,returnIn:0,returnOut:0,adjustments:0};"RESTOCK"===a.type||d.includes("purchase")||d.includes("addition")?e.stockAdded+=c:d.includes("transfer out")?e.transferOut+=Math.abs(c):d.includes("customer return")?e.returnIn+=c:d.includes("return to supplier")?e.returnOut+=Math.abs(c):"SALE"!==a.type&&(e.adjustments+=c),i.set(b,e)});let k=Array.from(i.keys()).sort(),l=[],m=g;for(let a of k){let b=i.get(a),c=m,d=c-b.itemsSold+b.stockAdded-b.transferOut+b.returnIn-b.returnOut+b.adjustments;l.push({date:a,startingStock:c,...b,endingStock:d}),m=d}return{success:!0,data:{product:{id:c.id,name:c.name,quantity:c.stock,itemNumber:c.sku},currentStock:c.stock,calculatedStock:m,discrepancy:c.stock-m,openingStock:g,openingDate:h?.toISOString(),excludedSalesQty:j,dailyBreakdown:l}}}catch(a){return console.error("Error in reconciliation action:",a),{success:!1,error:a.message}}}async function u(a){try{let b=await e.db.product.findMany({where:{branchId:a},select:{id:!0,name:!0,stock:!0}}),c=[];for(let d of b){let b=await e.db.productHistory.findMany({where:{productId:d.id,locationId:a},orderBy:[{createdAt:"asc"},{id:"asc"}]});if(0===b.length)continue;let f=0,g=[];for(let a of b){let b=a.newStock-a.oldStock,c=f,d=c+b;(a.oldStock!==c||a.newStock!==d)&&g.push({entryId:a.id,createdAt:a.createdAt.toISOString(),changeReason:a.changeReason,currentPrevQty:a.oldStock,currentNewQty:a.newStock,fixedPrevQty:c,fixedNewQty:d}),f=d}(g.length>0||Math.abs(d.stock-f)>.001)&&c.push({productId:d.id,productName:d.name,totalEntries:b.length,brokenEntries:g,finalFixedQty:f,currentProductQty:d.stock})}return{success:!0,data:c}}catch(a){return{success:!1,error:a.message}}}async function v(a,b){try{let c=b||(await e.db.product.findMany({where:{branchId:a},select:{id:!0}})).map(a=>a.id),d=0,f=0;for(let b of c)try{await k(b,a),d++}catch(a){f++}return{success:!0,data:{repaired:d,failed:f}}}catch(a){return{success:!1,error:a.message}}}async function w(a){try{let b=await e.db.activityHistory.findMany({where:{entityId:{in:a}},select:{entityId:!0,entityName:!0}});return{success:!0,data:b}}catch(a){return{success:!1,error:a.message,data:[]}}}async function x(a,b){try{return await e.db.productHistory.updateMany({where:{id:{in:a}},data:{createdAt:new Date(b)}}),{success:!0}}catch(a){return{success:!1,error:a.message}}}[e]=h.then?(await h)():h,(0,g.ensureServerEntryExports)([i,j,k,l,m,o,p,q,r,s,t,u,v,w,x]),(0,d.registerServerReference)(i,"6055d418bbb34217108fb09f6c6e07a1977765bffb",null),(0,d.registerServerReference)(j,"40193ce83d40b7dbf7c2991866f6d090da71bf2f59",null),(0,d.registerServerReference)(k,"60b4fb287dfbc2b628cca363587f00d76a36f3623b",null),(0,d.registerServerReference)(l,"60428e59105c2448bb202e52e31bf2d4492d8468f7",null),(0,d.registerServerReference)(m,"70e0c90d8c965637b3ae61b1f0dd8fc9a41ea083d6",null),(0,d.registerServerReference)(o,"60048cacdf8f6ab02d12e637338fb3a82838e3ab18",null),(0,d.registerServerReference)(p,"40e343dbe89cc3fb8304b10c9c62480d17ad426333",null),(0,d.registerServerReference)(q,"701e152aafbc4d4daee38965467b93e083a6e967b4",null),(0,d.registerServerReference)(r,"605622308fa711a2f7465dc0a63c7e00dbe7c0418e",null),(0,d.registerServerReference)(s,"7022b270c26116cc720c0fe09926fa8749c32b0ea9",null),(0,d.registerServerReference)(t,"605a5ac8c70aa01eb0dd29483cb3c24316ae309de0",null),(0,d.registerServerReference)(u,"406e0d925bc965618c40bddb0b2011bea951e9b025",null),(0,d.registerServerReference)(v,"60a33152b65e6ef5593ff2b5c1d0a77d09216fe7e5",null),(0,d.registerServerReference)(w,"4035262824370ccd2af8788671f3cc8435d165a93b",null),(0,d.registerServerReference)(x,"60eb8a3f21a0957ca35a2a3606c2b8e1d21977469d",null),a.s(["createRequisitionAction",()=>p,"createStockHistoryAction",()=>j,"deleteRequisitionAction",()=>r,"deleteStockHistoryEntriesByReferenceAction",()=>l,"getActivityByEntityIdsAction",()=>w,"getProductReconciliationAction",()=>t,"getRequisitionsAction",()=>o,"getStockHistoryAction",()=>i,"getStockRepairsPreviewAction",()=>u,"getStockSummaryReportAction",()=>s,"recalculateStockChainAction",()=>k,"repairStockChainsAction",()=>v,"updateRequisitionAction",()=>q,"updateStockHistoryDatesAction",()=>x,"updateStockHistoryDatesByReferenceAction",()=>m]),c()}catch(a){c(a)}},!1)];

//# sourceMappingURL=src_app_actions_d7ce0f39._.js.map