module.exports=[470167,a=>{"use strict";let b=(0,a.i(564375).default)("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);a.s(["History",()=>b],470167)},386925,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(109254),g=a.i(396465),h=a.i(112779),i=a.i(397625),j=a.i(792071),k=a.i(108191),l=a.i(805297),m=b([f,g,h,i,l]);[f,g,h,i,l]=m.then?(await m)():m,a.s(["default",0,({open:a,onOpenChange:b,entry:c,onConfirm:m,isInitialStock:n=!1,stockHistory:o=[],productCreatedAt:p})=>{let[q,r]=(0,e.useState)(0),[s,t]=(0,e.useState)(""),[u,v]=(0,e.useState)(!1),[w,x]=(0,e.useState)(""),{toast:y}=(0,k.useToast)(),{hasPermission:z}=(0,l.useProfiles)();(0,e.useEffect)(()=>{c&&(r(c.newQuantity-c.oldQuantity),t(c.changeReason),x(""))},[c]);let A=(a,b)=>b<0&&a>0?"Cannot change from negative to positive value.":b>0&&a<0?"Cannot change from positive to negative value.":"",B=a=>{if(""===a){r(""),x("");return}let b=parseInt(a)||0,c=""===q?0:q,d=A(b,c);d?x(d):(r(b),x(""))},C=async(a=!1)=>{if(!c)return;let d=""===q?0:q,e=c.newQuantity-c.oldQuantity,f=A(d,e);if(f)return void y({title:"Invalid quantity change",description:f,variant:"destructive"});let g=c.oldQuantity+d;if(!s.trim())return void y({title:"Invalid reason",description:"Please provide a reason for this stock change",variant:"destructive"});v(!0);try{await m(c.id,g,s.trim())?(y({title:"Stock history updated",description:"The stock history entry has been updated successfully."}),b(!1)):y({title:"Update failed",description:"Failed to update stock history entry. Please try again.",variant:"destructive"})}catch(a){console.error("Error updating stock history:",a),y({title:"Error",description:"An error occurred while updating the stock history.",variant:"destructive"})}finally{v(!1)}},D=()=>{b(!1)};if(!c)return null;if(n)return(0,d.jsx)(f.Dialog,{open:a,onOpenChange:b,children:(0,d.jsxs)(f.DialogContent,{className:"sm:max-w-md",children:[(0,d.jsxs)(f.DialogHeader,{children:[(0,d.jsx)(f.DialogTitle,{children:"Edit Initial Stock Entry"}),(0,d.jsx)(f.DialogDescription,{children:"This is the initial stock entry. You can modify quantity, reason, and date, but the date must be earlier than all other stock transactions."})]}),(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(i.Label,{htmlFor:"quantity",children:"Quantity Change"}),(0,d.jsx)(h.Input,{id:"quantity",type:"number",value:q,onChange:a=>B(a.target.value),className:w?"border-destructive border-2 bg-destructive/5 focus:border-destructive focus:ring-destructive":""}),w&&(0,d.jsx)("p",{className:"text-sm text-destructive",children:w})]}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(i.Label,{htmlFor:"reason",children:"Change Reason"}),(0,d.jsx)(h.Input,{id:"reason",value:s,onChange:a=>t(a.target.value),placeholder:"Enter reason for stock change"})]})]}),(0,d.jsxs)("div",{className:"flex justify-end gap-2 mt-6",children:[(0,d.jsx)(g.Button,{variant:"outline",onClick:D,disabled:u,children:"Cancel"}),(0,d.jsx)(g.Button,{onClick:()=>C(),disabled:u||!z("inventory","stock_adjustment"),children:u?"Updating...":"Update Entry"})]})]})});if(["Sale","Delete sale","Deleted Sale","Sale qty edit"].some(a=>c.changeReason.toLowerCase().includes(a.toLowerCase())))return(0,d.jsx)(f.Dialog,{open:a,onOpenChange:b,children:(0,d.jsxs)(f.DialogContent,{className:"sm:max-w-md",children:[(0,d.jsxs)(f.DialogHeader,{children:[(0,d.jsx)(f.DialogTitle,{children:"Cannot Edit Sale-Related Entry"}),(0,d.jsx)(f.DialogDescription,{children:"This stock history entry was created by a sales operation and can only be modified through the Edit Sale form."})]}),(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{className:"bg-muted p-3 rounded-lg space-y-2",children:[(0,d.jsx)("div",{className:"font-medium",children:"Entry Details:"}),(0,d.jsxs)("div",{className:"text-sm space-y-1",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{children:"Date:"})," ",(0,j.format)(c.createdAt,"PPP p")]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{children:"Change:"})," ",c.oldQuantity," → ",c.newQuantity]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{children:"Reason:"})," ",c.changeReason.replace("Deleted sale","Deleted Sale")]})]})]}),(0,d.jsx)("div",{className:"bg-blue-50 border border-blue-200 p-3 rounded-lg",children:(0,d.jsxs)("div",{className:"text-blue-800 text-sm",children:[(0,d.jsx)("strong",{children:"Note:"})," To modify this entry, please use the Edit Sale form in the Sales section."]})})]}),(0,d.jsx)("div",{className:"flex justify-end gap-2 mt-6",children:(0,d.jsx)(g.Button,{variant:"outline",onClick:()=>b(!1),children:"Close"})})]})});let E=c.newQuantity-c.oldQuantity,F=""===q?0:q,G=c.oldQuantity+F;return(0,d.jsx)(f.Dialog,{open:a,onOpenChange:b,children:(0,d.jsxs)(f.DialogContent,{className:"sm:max-w-md",children:[(0,d.jsxs)(f.DialogHeader,{children:[(0,d.jsx)(f.DialogTitle,{children:"Edit Stock History Entry"}),(0,d.jsx)(f.DialogDescription,{children:"Modify the details of this stock history entry. The product's current stock will be recalculated after saving."})]}),(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)(i.Label,{className:"text-muted-foreground",children:"Original"}),(0,d.jsxs)("div",{className:"font-medium",children:[c.oldQuantity," → ",c.newQuantity]}),(0,d.jsxs)("div",{className:`text-xs ${E>=0?"text-green-600":"text-red-600"}`,children:[E>=0?"+":"",E]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)(i.Label,{className:"text-muted-foreground",children:"New"}),(0,d.jsxs)("div",{className:"font-medium",children:[c.oldQuantity," → ",G]}),(0,d.jsxs)("div",{className:`text-xs ${F>=0?"text-green-600":"text-red-600"}`,children:[F>=0?"+":"",F]})]})]}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(i.Label,{htmlFor:"quantity",children:"Quantity Change"}),(0,d.jsx)(h.Input,{id:"quantity",type:"number",value:q,onChange:a=>B(a.target.value),className:w?"border-destructive border-2 bg-destructive/5 focus:border-destructive focus:ring-destructive":""}),c&&(0,d.jsxs)("p",{className:"text-xs text-muted-foreground",children:["⚠️ ",(""===q?0:q)<0?"Current change is negative - you cannot change to positive values":"Current change is positive - you cannot change to negative values"]}),w&&(0,d.jsx)("p",{className:"text-sm text-destructive",children:w})]}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(i.Label,{htmlFor:"reason",children:"Change Reason"}),(0,d.jsx)(h.Input,{id:"reason",value:s,onChange:a=>t(a.target.value),placeholder:"Enter reason for stock change"})]})]}),(0,d.jsxs)("div",{className:"flex justify-end gap-2 mt-6",children:[(0,d.jsx)(g.Button,{variant:"outline",onClick:D,disabled:u,children:"Cancel"}),(0,d.jsx)(g.Button,{onClick:()=>C(),disabled:u||!z("inventory","stock_adjustment"),children:u?"Updating...":"Update Entry"})]})]})})}]),c()}catch(a){c(a)}},!1),239366,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(893759),g=a.i(792071),h=a.i(108191),i=a.i(369773),j=b([f]);[f]=j.then?(await j)():j,a.s(["default",0,({open:a,onOpenChange:b,entry:c,onConfirm:j})=>{let[k,l]=(0,e.useState)(!1),{toast:m}=(0,h.useToast)(),n=async()=>{if(c){l(!0);try{await j(c.id)?(m({title:"Stock history deleted",description:"The stock history entry has been deleted and stock recalculated."}),b(!1)):m({title:"Delete failed",description:"Failed to delete stock history entry. Please try again.",variant:"destructive"})}catch(a){console.error("Error deleting stock history:",a),m({title:"Error",description:"An error occurred while deleting the stock history.",variant:"destructive"})}finally{l(!1)}}};if(!c)return null;if(["Sale","Delete sale","Deleted Sale","Sale qty edit"].some(a=>c.changeReason.toLowerCase().includes(a.toLowerCase())))return(0,d.jsx)(f.AlertDialog,{open:a,onOpenChange:b,children:(0,d.jsxs)(f.AlertDialogContent,{children:[(0,d.jsxs)(f.AlertDialogHeader,{children:[(0,d.jsxs)(f.AlertDialogTitle,{className:"flex items-center gap-2",children:[(0,d.jsx)(i.AlertTriangle,{className:"h-5 w-5 text-blue-600"}),"Cannot Delete Sale-Related Entry"]}),(0,d.jsxs)(f.AlertDialogDescription,{className:"space-y-3",children:[(0,d.jsx)("p",{children:"This stock history entry was created by a sales operation and cannot be deleted directly."}),(0,d.jsxs)("div",{className:"bg-muted p-3 rounded-lg space-y-2",children:[(0,d.jsx)("div",{className:"font-medium",children:"Entry Details:"}),(0,d.jsxs)("div",{className:"text-sm space-y-1",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{children:"Date:"})," ",(0,g.format)(c.createdAt,"PPP p")]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{children:"Change:"})," ",c.oldQuantity," → ",c.newQuantity]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{children:"Reason:"})," ",c.changeReason.replace("Deleted sale","Deleted Sale")]})]})]}),(0,d.jsx)("div",{className:"bg-blue-50 border border-blue-200 p-3 rounded-lg",children:(0,d.jsxs)("div",{className:"text-blue-800 text-sm",children:[(0,d.jsx)("strong",{children:"Note:"})," To remove this entry, please edit or delete the corresponding sale in the Sales section."]})})]})]}),(0,d.jsx)(f.AlertDialogFooter,{children:(0,d.jsx)(f.AlertDialogCancel,{children:"Close"})})]})});let o=c.newQuantity-c.oldQuantity;return(0,d.jsx)(f.AlertDialog,{open:a,onOpenChange:b,children:(0,d.jsxs)(f.AlertDialogContent,{children:[(0,d.jsxs)(f.AlertDialogHeader,{children:[(0,d.jsxs)(f.AlertDialogTitle,{className:"flex items-center gap-2",children:[(0,d.jsx)(i.AlertTriangle,{className:"h-5 w-5 text-destructive"}),"Delete Stock History Entry"]}),(0,d.jsxs)(f.AlertDialogDescription,{className:"space-y-3",children:[(0,d.jsx)("p",{children:"Are you sure you want to delete this stock history entry? This action cannot be undone."}),(0,d.jsxs)("div",{className:"bg-muted p-3 rounded-lg space-y-2",children:[(0,d.jsx)("div",{className:"font-medium",children:"Entry Details:"}),(0,d.jsxs)("div",{className:"text-sm space-y-1",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{children:"Date:"})," ",(0,g.format)(c.createdAt,"PPP p")]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{children:"Change:"})," ",c.oldQuantity," → ",c.newQuantity]}),(0,d.jsxs)("div",{className:`${o>=0?"text-green-600":"text-red-600"}`,children:[(0,d.jsx)("strong",{children:"Impact:"})," ",o>=0?"+":"",o," units"]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{children:"Reason:"})," ",c.changeReason.replace("Deleted sale","Deleted Sale")]})]})]}),(0,d.jsx)("div",{className:"bg-amber-50 border border-amber-200 p-3 rounded-lg",children:(0,d.jsxs)("div",{className:"text-amber-800 text-sm",children:[(0,d.jsx)("strong",{children:"Warning:"})," After deletion, the product's current stock will be automatically recalculated based on the remaining stock history entries."]})})]})]}),(0,d.jsxs)(f.AlertDialogFooter,{children:[(0,d.jsx)(f.AlertDialogCancel,{disabled:k,children:"Cancel"}),(0,d.jsx)(f.AlertDialogAction,{onClick:n,disabled:k,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:k?"Deleting...":"Delete Entry"})]})]})})}]),c()}catch(a){c(a)}},!1)];

//# sourceMappingURL=_08958d14._.js.map