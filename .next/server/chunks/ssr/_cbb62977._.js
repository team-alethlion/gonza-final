module.exports=[23747,a=>{"use strict";let b=(0,a.i(564375).default)("PackagePlus",[["path",{d:"M16 16h6",key:"100bgy"}],["path",{d:"M19 13v6",key:"85cyf1"}],["path",{d:"M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14",key:"e7tb2h"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["line",{x1:"12",x2:"12",y1:"22",y2:"12",key:"a4e8g8"}]]);a.s(["PackagePlus",()=>b],23747)},557251,a=>{"use strict";let b=(0,a.i(564375).default)("PackageMinus",[["path",{d:"M16 16h6",key:"100bgy"}],["path",{d:"M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14",key:"e7tb2h"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["line",{x1:"12",x2:"12",y1:"22",y2:"12",key:"a4e8g8"}]]);a.s(["PackageMinus",()=>b],557251)},139941,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(396465),g=a.i(109254),h=a.i(811705),i=a.i(899054),j=a.i(567326),k=a.i(436028),l=a.i(73679),m=a.i(264397),n=a.i(515016),o=a.i(23747),p=a.i(557251),q=a.i(531811),r=a.i(169320),s=a.i(964889),t=a.i(224993),u=a.i(625250),v=a.i(942348),w=a.i(852741),x=b([f,g,h,i,j,q,r,s,t,u,v]);[f,g,h,i,j,q,r,s,t,u,v]=x.then?(await x)():x,a.s(["default",0,({product:a,onClose:b,onReconciled:c})=>{let{user:x}=(0,q.useAuth)(),{currentBusiness:y}=(0,s.useBusiness)(),{settings:z}=(0,t.useBusinessSettings)(),{canViewCostPrice:A,canViewSellingPrice:B,formatFinancial:C}=(0,u.useFinancialVisibility)(),[D,E]=(0,e.useState)(!1),[F,G]=(0,e.useState)(!1),[H,I]=(0,e.useState)(!0),[J,K]=(0,e.useState)({currentStock:0,openingStock:0,itemsSold:0,stockAdded:0,transferOut:0,returnIn:0,returnOut:0,adjustments:0,calculatedClosingStock:0,discrepancy:0,openingDate:null,excludedSalesQty:0,dailyBreakdown:[]}),[L,M]=(0,e.useState)(a.costPrice||0),[N,O]=(0,e.useState)(a.sellingPrice||0);(0,e.useEffect)(()=>{M(a.costPrice||0),O(a.sellingPrice||0)},[a.id,a.costPrice,a.sellingPrice]),(0,e.useEffect)(()=>{(async()=>{if(y?.id){I(!0);try{let b=await (0,v.getProductReconciliationAction)(y.id,a.id);b.success&&b.data?K(b.data):r.toast.error(b.error||"Failed to calculate reconciliation data")}catch(a){console.error("Error calculating reconciliation:",a),r.toast.error("An unexpected error occurred during reconciliation calculation")}finally{I(!1)}}})()},[y?.id,a.id]);let P=J.currentStock*(a.costPrice||0),Q=J.currentStock*(a.sellingPrice||0),R=J.calculatedClosingStock*L,S=J.calculatedClosingStock*N,T=R-P,U=S-Q,V=Math.abs(J.discrepancy)>.01,W=async()=>{if(x?.id&&y?.id){E(!0);try{if(await (0,w.updateProductAction)(a.id,{userId:x.id,quantity:J.calculatedClosingStock,costPrice:L,sellingPrice:N,customChangeReason:"Stock Reconciliation"}))r.toast.success(`Stock reconciled successfully! Corrected ${Math.abs(J.discrepancy).toFixed(2)} units.`),c(),b();else throw Error("Update failed")}catch(a){console.error("Error reconciling stock:",a),r.toast.error("Failed to reconcile stock. Please try again.")}finally{E(!1)}}};return(0,d.jsx)(g.Dialog,{open:!0,onOpenChange:b,children:(0,d.jsxs)(g.DialogContent,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,d.jsxs)(g.DialogHeader,{children:[(0,d.jsxs)(g.DialogTitle,{className:"flex items-center gap-2",children:[V?(0,d.jsx)(k.AlertCircle,{className:"h-5 w-5 text-orange-500"}):(0,d.jsx)(l.CheckCircle,{className:"h-5 w-5 text-green-500"}),"Stock Reconciliation - ",a.name]}),(0,d.jsx)(g.DialogDescription,{children:"Review stock calculations and apply corrections if needed"})]}),H?(0,d.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,d.jsx)("div",{className:"text-muted-foreground",children:"Loading reconciliation data..."})}):(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,d.jsxs)(h.Card,{children:[(0,d.jsx)(h.CardHeader,{className:"pb-3",children:(0,d.jsx)(h.CardTitle,{className:"text-sm font-medium",children:"Current Stock"})}),(0,d.jsx)(h.CardContent,{children:(0,d.jsx)("div",{className:"text-2xl font-bold",children:J.currentStock.toFixed(2)})})]}),(0,d.jsxs)(h.Card,{children:[(0,d.jsx)(h.CardHeader,{className:"pb-3",children:(0,d.jsx)(h.CardTitle,{className:"text-sm font-medium",children:"Calculated Stock"})}),(0,d.jsx)(h.CardContent,{children:(0,d.jsx)("div",{className:"text-2xl font-bold",children:J.calculatedClosingStock.toFixed(2)})})]})]}),(0,d.jsxs)(h.Card,{className:"border-sales-primary/20 bg-sales-primary/5",children:[(0,d.jsx)(h.CardHeader,{className:"pb-3",children:(0,d.jsxs)(h.CardTitle,{className:"text-base flex items-center gap-2",children:[(0,d.jsx)(n.TrendingUp,{className:"h-4 w-4 text-sales-primary"}),"Valuation & Price Adjustment"]})}),(0,d.jsxs)(h.CardContent,{children:[(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-6",children:[A&&(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)("label",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:"Adjustment Cost Price"}),(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground text-sm",children:z.currency}),(0,d.jsx)("input",{type:"number",value:L,onChange:a=>M(Number(a.target.value)),className:"w-full pl-12 pr-4 py-2 bg-white border rounded-md text-sm focus:ring-2 focus:ring-sales-primary/20 outline-none transition-all"})]}),(0,d.jsx)("p",{className:"text-[10px] text-muted-foreground",children:"Affects Cost Value"})]}),B&&(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)("label",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:"Adjustment Selling Price"}),(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground text-sm",children:z.currency}),(0,d.jsx)("input",{type:"number",value:N,onChange:a=>O(Number(a.target.value)),className:"w-full pl-12 pr-4 py-2 bg-white border rounded-md text-sm focus:ring-2 focus:ring-sales-primary/20 outline-none transition-all"})]}),(0,d.jsx)("p",{className:"text-[10px] text-muted-foreground",children:"Affects Stock Value"})]})]}),(0,d.jsxs)("div",{className:"mt-4 pt-4 border-t border-sales-primary/10 grid grid-cols-2 gap-4",children:[A&&(0,d.jsxs)("div",{className:"p-3 rounded-lg bg-white border shadow-sm",children:[(0,d.jsx)("p",{className:"text-[10px] font-bold text-muted-foreground uppercase mb-1",children:"Cost Valuation Impact"}),(0,d.jsx)("div",{className:"flex items-end justify-between",children:(0,d.jsxs)("span",{className:`text-base font-bold ${T>=0?"text-emerald-600":"text-rose-600"}`,children:[T>=0?"+":"",C(T,"cost")]})})]}),B&&(0,d.jsxs)("div",{className:"p-3 rounded-lg bg-white border shadow-sm",children:[(0,d.jsx)("p",{className:"text-[10px] font-bold text-muted-foreground uppercase mb-1",children:"Stock Valuation Impact"}),(0,d.jsx)("div",{className:"flex items-end justify-between",children:(0,d.jsxs)("span",{className:`text-base font-bold ${U>=0?"text-violet-600":"text-rose-600"}`,children:[U>=0?"+":"",C(U,"selling")]})})]})]})]})]}),(0,d.jsxs)(h.Card,{children:[(0,d.jsx)(h.CardHeader,{children:(0,d.jsx)(h.CardTitle,{className:"text-base",children:"Stock Calculation Summary"})}),(0,d.jsxs)(h.CardContent,{className:"space-y-3",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center",children:[(0,d.jsx)("span",{className:"text-sm text-muted-foreground",children:"Opening Stock"}),(0,d.jsx)("span",{className:"font-medium",children:J.openingStock.toFixed(2)})]}),(0,d.jsxs)("div",{className:"flex justify-between items-center text-red-600",children:[(0,d.jsxs)("span",{className:"text-sm flex items-center gap-1",children:[(0,d.jsx)(m.TrendingDown,{className:"h-4 w-4"}),"Items Sold"]}),(0,d.jsxs)("span",{className:"font-medium",children:["- ",J.itemsSold.toFixed(2)]})]}),(0,d.jsxs)("div",{className:"flex justify-between items-center text-emerald-600",children:[(0,d.jsxs)("span",{className:"text-sm flex items-center gap-1",children:[(0,d.jsx)(o.PackagePlus,{className:"h-4 w-4"}),"Stock Added"]}),(0,d.jsxs)("span",{className:"font-medium",children:["+ ",J.stockAdded.toFixed(2)]})]}),(0,d.jsxs)("div",{className:"flex justify-between items-center text-orange-600",children:[(0,d.jsxs)("span",{className:"text-sm flex items-center gap-1",children:[(0,d.jsx)(p.PackageMinus,{className:"h-4 w-4"}),"Transfer Out"]}),(0,d.jsxs)("span",{className:"font-medium",children:["- ",J.transferOut.toFixed(2)]})]}),(0,d.jsxs)("div",{className:"flex justify-between items-center text-blue-600",children:[(0,d.jsxs)("span",{className:"text-sm flex items-center gap-1",children:[(0,d.jsx)(o.PackagePlus,{className:"h-4 w-4"}),"Return In"]}),(0,d.jsxs)("span",{className:"font-medium",children:["+ ",J.returnIn.toFixed(2)]})]}),(0,d.jsxs)("div",{className:"flex justify-between items-center text-purple-600",children:[(0,d.jsxs)("span",{className:"text-sm flex items-center gap-1",children:[(0,d.jsx)(p.PackageMinus,{className:"h-4 w-4"}),"Return Out"]}),(0,d.jsxs)("span",{className:"font-medium",children:["- ",J.returnOut.toFixed(2)]})]}),(0,d.jsxs)("div",{className:"flex justify-between items-center text-amber-600",children:[(0,d.jsxs)("span",{className:"text-sm flex items-center gap-1",children:[(0,d.jsx)(k.AlertCircle,{className:"h-4 w-4"}),"Manual Adjustments"]}),(0,d.jsxs)("span",{className:"font-medium",children:[J.adjustments>0?"+":"",J.adjustments.toFixed(2)]})]}),(0,d.jsxs)("div",{className:"border-t pt-3 flex justify-between items-center font-semibold text-lg",children:[(0,d.jsx)("span",{children:"Calculated Closing Stock"}),(0,d.jsx)("span",{children:J.calculatedClosingStock.toFixed(2)})]}),V&&(0,d.jsxs)("div",{className:`border-t pt-3 flex justify-between items-center ${J.discrepancy>0?"text-green-600":"text-red-600"}`,children:[(0,d.jsx)("span",{className:"font-semibold",children:"Actual vs Calculated Discrepancy"}),(0,d.jsxs)(i.Badge,{variant:J.discrepancy>0?"default":"destructive",children:[J.discrepancy>0?"+":"",J.discrepancy.toFixed(2)," units"]})]})]})]}),(0,d.jsxs)(h.Card,{children:[(0,d.jsx)(h.CardHeader,{children:(0,d.jsx)(h.CardTitle,{className:"text-base",children:"Daily Breakdown"})}),(0,d.jsx)(h.CardContent,{children:(0,d.jsx)(j.ScrollArea,{className:"h-[300px] pr-4",children:(0,d.jsx)("div",{className:"space-y-3",children:0===J.dailyBreakdown.length?(0,d.jsx)("div",{className:"text-center text-muted-foreground py-8",children:"No transactions found for this product"}):J.dailyBreakdown.map((a,b)=>(0,d.jsxs)(h.Card,{className:"p-3 bg-slate-50",children:[(0,d.jsx)("div",{className:"font-semibold text-sm mb-2 text-slate-700",children:new Date(a.date).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"})}),(0,d.jsxs)("div",{className:"space-y-1.5 text-xs",children:[(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-muted-foreground",children:"Starting Stock:"}),(0,d.jsx)("span",{className:"font-medium",children:a.startingStock.toFixed(2)})]}),a.itemsSold>0&&(0,d.jsxs)("div",{className:"flex justify-between text-red-600",children:[(0,d.jsx)("span",{children:"Items Sold:"}),(0,d.jsxs)("span",{className:"font-medium",children:["-",a.itemsSold.toFixed(2)]})]}),a.stockAdded>0&&(0,d.jsxs)("div",{className:"flex justify-between text-emerald-600",children:[(0,d.jsx)("span",{children:"Stock Added:"}),(0,d.jsxs)("span",{className:"font-medium",children:["+",a.stockAdded.toFixed(2)]})]}),a.transferOut>0&&(0,d.jsxs)("div",{className:"flex justify-between text-orange-600",children:[(0,d.jsx)("span",{children:"Transfer Out:"}),(0,d.jsxs)("span",{className:"font-medium",children:["-",a.transferOut.toFixed(2)]})]}),a.returnIn>0&&(0,d.jsxs)("div",{className:"flex justify-between text-blue-600",children:[(0,d.jsx)("span",{children:"Return In:"}),(0,d.jsxs)("span",{className:"font-medium",children:["+",a.returnIn.toFixed(2)]})]}),a.returnOut>0&&(0,d.jsxs)("div",{className:"flex justify-between text-purple-600",children:[(0,d.jsx)("span",{children:"Return Out:"}),(0,d.jsxs)("span",{className:"font-medium",children:["-",a.returnOut.toFixed(2)]})]}),0!==a.adjustments&&(0,d.jsxs)("div",{className:"flex justify-between text-amber-600",children:[(0,d.jsx)("span",{children:"Adjustments:"}),(0,d.jsxs)("span",{className:"font-medium",children:[a.adjustments>0?"+":"",a.adjustments.toFixed(2)]})]}),(0,d.jsxs)("div",{className:"flex justify-between pt-1.5 border-t border-slate-200",children:[(0,d.jsx)("span",{className:"font-semibold text-slate-700",children:"Ending Stock:"}),(0,d.jsx)("span",{className:"font-bold text-slate-900",children:a.endingStock.toFixed(2)})]})]})]},b))})})})]}),V&&F&&(0,d.jsxs)(h.Card,{className:"bg-blue-50 border-blue-200",children:[(0,d.jsx)(h.CardHeader,{children:(0,d.jsx)(h.CardTitle,{className:"text-base text-blue-900",children:"Preview Correction"})}),(0,d.jsxs)(h.CardContent,{className:"space-y-2",children:[(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-sm text-blue-800",children:"Current (Recorded):"}),(0,d.jsxs)("span",{className:"font-medium text-blue-900",children:[J.currentStock.toFixed(2)," units"]})]}),(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-sm text-blue-800",children:"Calculated (History):"}),(0,d.jsxs)("span",{className:"font-medium text-blue-900",children:[J.calculatedClosingStock.toFixed(2)," units"]})]}),(0,d.jsxs)("div",{className:"flex justify-between pt-2 border-t border-blue-200",children:[(0,d.jsx)("span",{className:"text-sm font-semibold text-blue-800",children:"Correction Amount:"}),(0,d.jsxs)("span",{className:"font-semibold text-blue-900",children:[J.discrepancy>0?"+":"",Math.abs(J.discrepancy).toFixed(2)," units"]})]})]})]}),!V&&(0,d.jsxs)("div",{className:"flex items-center gap-2 p-4 bg-green-50 border border-green-200 rounded-lg",children:[(0,d.jsx)(l.CheckCircle,{className:"h-5 w-5 text-green-600"}),(0,d.jsx)("p",{className:"text-sm text-green-800",children:"Stock levels are accurate based on transaction history."})]})]}),(0,d.jsxs)(g.DialogFooter,{children:[(0,d.jsx)(f.Button,{variant:"outline",onClick:b,children:"Cancel"}),V&&(0,d.jsx)(d.Fragment,{children:F?(0,d.jsx)(f.Button,{onClick:W,disabled:D,className:"bg-blue-600 hover:bg-blue-700",children:D?"Applying...":"Apply Correction"}):(0,d.jsx)(f.Button,{onClick:()=>G(!0),children:"Preview Correction"})})]})]})})}]),c()}catch(a){c(a)}},!1),148347,a=>{"use strict";let b=(0,a.i(564375).default)("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);a.s(["Wrench",()=>b],148347)},128151,a=>a.a(async(b,c)=>{try{var d=a.i(508171),e=a.i(127669),f=a.i(531811),g=a.i(964889),h=a.i(811705),i=a.i(112779),j=a.i(396465),k=a.i(109254),l=a.i(899054),m=a.i(567326),n=a.i(139941),o=a.i(54564),p=a.i(500885),q=a.i(169320),r=a.i(436028),s=a.i(264397),t=a.i(23747),u=a.i(148347),v=a.i(805297),w=a.i(289118),x=a.i(747899),y=a.i(852741),z=a.i(942348),A=b([f,g,h,i,j,k,l,m,n,o,p,q,v,w,z]);[f,g,h,i,j,k,l,m,n,o,p,q,v,w,z]=A.then?(await A)():A,a.s(["default",0,()=>{let{user:a}=(0,f.useAuth)(),b=(0,x.useNavigate)(),{currentBusiness:c,isLoading:A}=(0,g.useBusiness)(),{hasPermission:B,isLoading:C}=(0,v.useProfiles)(),[D,E]=(0,e.useState)(""),[F,G]=e.default.useState(null),[H,I]=(0,e.useState)(!1),[J,K]=(0,e.useState)(!1),[L,M]=(0,e.useState)(!1),[N,O]=(0,e.useState)([]),[P,Q]=(0,e.useState)(null),[R,S]=(0,e.useState)(!1),[T,U]=(0,e.useState)([]),[V,W]=(0,e.useState)(!1),[X,Y]=(0,e.useState)(!1),{data:Z=[],isLoading:$}=(0,p.useQuery)({queryKey:["all-products-reconciliation",a?.id,c?.id],queryFn:async()=>a?.id&&c?.id?await (0,y.getAllProductsAction)(a.id,c.id):[],enabled:!!a?.id&&!!c?.id,staleTime:12e4}),_=(0,e.useMemo)(()=>{if(!D.trim())return[];let a=D.toLowerCase();return Z.filter(b=>b.name.toLowerCase().includes(a)||b.itemNumber?.toLowerCase().includes(a)||b.category?.toLowerCase().includes(a)||b.supplier?.toLowerCase().includes(a)||b.description?.toLowerCase().includes(a))},[Z,D]),aa=async()=>{if(c?.id){S(!0);try{let a=await (0,z.repairStockChainsAction)(c.id);if(a.success&&a.data){let{repaired:b,failed:c}=a.data;0===c?q.toast.success(`Stock chains repaired successfully for ${b} product(s).`):q.toast.warning(`Repaired ${b} product(s). ${c} failed.`)}}catch(a){console.error("Error repairing stock chains:",a),q.toast.error("Failed to repair stock chains.")}finally{S(!1),W(!1)}}},ab=async()=>{if(c?.id){Y(!0);try{let a=await (0,z.getStockRepairsPreviewAction)(c.id);a.success&&a.data&&(U(a.data),0===a.data.length?q.toast.success("No broken stock chains found!"):W(!0))}catch(a){console.error("Error previewing stock repairs:",a),q.toast.error("Failed to preview stock repairs.")}finally{Y(!1)}}},ac=async()=>{if(!c?.id)return;K(!0);let a=[];try{for(let b of Z){let d=await (0,z.getProductReconciliationAction)(c.id,b.id);d.success&&d.data&&Math.abs(d.data.discrepancy)>.01&&a.push(d.data)}O(a),M(!0)}catch(a){console.error("Error calculating preview:",a),q.toast.error("Failed to calculate reconciliation preview.")}finally{K(!1)}},ad=async()=>{if(a?.id&&c?.id&&0!==N.length){I(!0);try{let b=0,d=0;for(let e of N)try{let d=await (0,z.createStockHistoryAction)({userId:a.id,locationId:c.id,productId:e.product.id,previousQuantity:e.currentStock,newQuantity:e.calculatedStock,changeReason:"Bulk Stock Reconciliation",createdAt:new Date().toISOString()});if(d.success)b++;else throw Error(d.error)}catch(a){d++,console.error(`Failed to reconcile ${e.product.name}:`,a)}q.toast.success(`Bulk reconciliation complete! Updated ${b} product(s).`),d>0&&q.toast.error(`${d} product(s) failed.`),M(!1),O([])}catch(a){console.error("Bulk reconciliation error:",a),q.toast.error("Failed to complete bulk reconciliation.")}finally{I(!1)}}};return A||C||!c?(0,d.jsx)(o.default,{}):B("inventory","stock_adjustment")?(0,d.jsxs)("div",{className:"p-2 md:p-6 space-y-4 md:space-y-6 max-w-full",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,d.jsxs)("div",{className:"space-y-1",children:[(0,d.jsx)("h1",{className:"text-xl md:text-2xl lg:text-3xl font-bold text-sales-dark",children:"Stock Reconciliation"}),(0,d.jsx)("p",{className:"text-sm md:text-base text-muted-foreground",children:"Select a product, preview the correction, then apply."})]}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsxs)(j.Button,{onClick:ab,disabled:R||X||$||0===Z.length,variant:"outline",size:"lg",children:[(0,d.jsx)(r.AlertCircle,{className:"h-4 w-4 mr-2"}),X?"Scanning...":"Preview Repairs"]}),(0,d.jsxs)(j.Button,{onClick:aa,disabled:R||X||$||0===Z.length,variant:"secondary",size:"lg",children:[(0,d.jsx)(u.Wrench,{className:"h-4 w-4 mr-2"}),R?"Repairing...":"Quick Repair All"]}),(0,d.jsx)(j.Button,{onClick:ac,disabled:J||$||0===Z.length,size:"lg",children:J?"Calculating...":"Reconcile All Products"})]})]}),(0,d.jsxs)(h.Card,{children:[(0,d.jsx)(h.CardHeader,{children:(0,d.jsx)(h.CardTitle,{className:"text-base",children:"Search Product"})}),(0,d.jsxs)(h.CardContent,{className:"space-y-3",children:[(0,d.jsx)(i.Input,{placeholder:"Search by name, item number, category, or supplier",value:D,onChange:a=>E(a.target.value)}),D&&(0,d.jsx)("div",{className:"border rounded-md",children:(0,d.jsx)(m.ScrollArea,{className:"max-h-96",children:(0,d.jsxs)("ul",{className:"divide-y",children:[$&&(0,d.jsx)("li",{className:"p-3 text-sm text-muted-foreground",children:"Loading products..."}),!$&&0===_.length&&(0,d.jsx)("li",{className:"p-3 text-sm text-muted-foreground",children:"No matching products found"}),(!$&&_).map(a=>(0,d.jsxs)("li",{className:"p-3 hover:bg-muted/40 cursor-pointer",onClick:()=>G(a),children:[(0,d.jsx)("div",{className:"font-medium",children:a.name}),(0,d.jsxs)("div",{className:"text-xs text-muted-foreground",children:[a.itemNumber?`Item: ${a.itemNumber}`:"—"," • Qty: ",a.quantity," • Cat: ",a.category||"—"]})]},a.id))]})})})]})]}),F&&(0,d.jsx)(n.default,{product:F,onClose:()=>G(null),onReconciled:()=>G(null)}),(0,d.jsx)(k.Dialog,{open:L,onOpenChange:M,children:(0,d.jsxs)(k.DialogContent,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[(0,d.jsxs)(k.DialogHeader,{children:[(0,d.jsxs)(k.DialogTitle,{className:"flex items-center gap-2",children:[(0,d.jsx)(r.AlertCircle,{className:"h-5 w-5 text-orange-500"}),"Bulk Reconciliation Preview"]}),(0,d.jsxs)(k.DialogDescription,{children:[N.length," product(s) with discrepancies found."]})]}),(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,d.jsxs)(h.Card,{children:[(0,d.jsx)(h.CardHeader,{className:"pb-3",children:(0,d.jsx)(h.CardTitle,{className:"text-sm",children:"Products to Update"})}),(0,d.jsx)(h.CardContent,{children:(0,d.jsx)("div",{className:"text-2xl font-bold",children:N.length})})]}),(0,d.jsxs)(h.Card,{children:[(0,d.jsx)(h.CardHeader,{className:"pb-3",children:(0,d.jsx)(h.CardTitle,{className:"text-sm",children:"Total Adjustment"})}),(0,d.jsx)(h.CardContent,{children:(0,d.jsxs)("div",{className:"text-2xl font-bold",children:[N.reduce((a,b)=>a+Math.abs(b.discrepancy),0).toFixed(2)," units"]})})]})]}),(0,d.jsxs)(h.Card,{children:[(0,d.jsx)(h.CardHeader,{children:(0,d.jsx)(h.CardTitle,{className:"text-base",children:"Products with Discrepancies"})}),(0,d.jsx)(h.CardContent,{children:(0,d.jsx)(m.ScrollArea,{className:"h-[400px]",children:(0,d.jsx)("div",{className:"space-y-2",children:N.map(a=>(0,d.jsx)(h.Card,{className:"p-3 cursor-pointer hover:bg-muted/50",onClick:()=>Q(a),children:(0,d.jsxs)("div",{className:"flex justify-between items-start",children:[(0,d.jsxs)("div",{className:"flex-1",children:[(0,d.jsx)("div",{className:"font-semibold",children:a.product.name}),(0,d.jsx)("div",{className:"text-xs text-muted-foreground",children:a.product.itemNumber&&`Item: ${a.product.itemNumber}`})]}),(0,d.jsxs)("div",{className:"text-right",children:[(0,d.jsxs)("div",{className:"text-sm",children:[(0,d.jsx)("span",{className:"text-muted-foreground",children:"Current:"})," ",Number(a.currentStock).toFixed(2)]}),(0,d.jsxs)("div",{className:"text-sm",children:[(0,d.jsx)("span",{className:"text-muted-foreground",children:"Calculated:"})," ",Number(a.calculatedStock).toFixed(2)]}),(0,d.jsxs)(l.Badge,{variant:a.discrepancy>0?"default":"destructive",className:"mt-1",children:[a.discrepancy>0?"+":"",a.discrepancy.toFixed(2)]})]})]})},a.product.id))})})})]})]}),(0,d.jsxs)(k.DialogFooter,{children:[(0,d.jsx)(j.Button,{variant:"outline",onClick:()=>M(!1),disabled:H,children:"Cancel"}),(0,d.jsx)(j.Button,{onClick:ad,disabled:H,children:H?"Applying...":`Apply Reconciliation (${N.length} products)`})]})]})}),P&&(0,d.jsx)(k.Dialog,{open:!!P,onOpenChange:()=>Q(null),children:(0,d.jsxs)(k.DialogContent,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,d.jsxs)(k.DialogHeader,{children:[(0,d.jsx)(k.DialogTitle,{children:P.product.name}),(0,d.jsx)(k.DialogDescription,{children:"Detailed reconciliation breakdown"})]}),(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,d.jsxs)(h.Card,{children:[(0,d.jsx)(h.CardHeader,{className:"pb-3",children:(0,d.jsx)(h.CardTitle,{className:"text-sm",children:"Current Stock"})}),(0,d.jsx)(h.CardContent,{children:(0,d.jsx)("div",{className:"text-2xl font-bold",children:Number(P.currentStock).toFixed(2)})})]}),(0,d.jsxs)(h.Card,{children:[(0,d.jsx)(h.CardHeader,{className:"pb-3",children:(0,d.jsx)(h.CardTitle,{className:"text-sm",children:"Calculated Stock"})}),(0,d.jsx)(h.CardContent,{children:(0,d.jsx)("div",{className:"text-2xl font-bold",children:Number(P.calculatedStock).toFixed(2)})})]})]}),(0,d.jsxs)(h.Card,{children:[(0,d.jsx)(h.CardHeader,{children:(0,d.jsx)(h.CardTitle,{className:"text-base",children:"Stock Calculation"})}),(0,d.jsxs)(h.CardContent,{className:"space-y-3",children:[(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-sm text-muted-foreground",children:"Opening Stock"}),(0,d.jsx)("span",{className:"font-medium",children:Number(P.openingStock).toFixed(2)})]}),(0,d.jsxs)("div",{className:"flex justify-between text-red-600",children:[(0,d.jsxs)("span",{className:"text-sm flex items-center gap-1",children:[(0,d.jsx)(s.TrendingDown,{className:"h-4 w-4"})," Items Sold"]}),(0,d.jsxs)("span",{className:"font-medium",children:["-",Number(P.itemsSold).toFixed(2)]})]}),(0,d.jsxs)("div",{className:"flex justify-between text-emerald-600",children:[(0,d.jsxs)("span",{className:"text-sm flex items-center gap-1",children:[(0,d.jsx)(t.PackagePlus,{className:"h-4 w-4"})," Stock Added"]}),(0,d.jsxs)("span",{className:"font-medium",children:["+",Number(P.stockAdded).toFixed(2)]})]}),(0,d.jsxs)("div",{className:"border-t pt-3 flex justify-between font-semibold",children:[(0,d.jsx)("span",{children:"Calculated Closing Stock"}),(0,d.jsx)("span",{children:Number(P.calculatedStock).toFixed(2)})]})]})]})]}),(0,d.jsx)(k.DialogFooter,{children:(0,d.jsx)(j.Button,{onClick:()=>Q(null),children:"Close"})})]})})]}):(0,d.jsxs)("div",{className:"max-w-4xl mx-auto p-6",children:[(0,d.jsxs)(w.Alert,{variant:"destructive",children:[(0,d.jsx)(r.AlertCircle,{className:"h-4 w-4"}),(0,d.jsx)(w.AlertTitle,{children:"Access Denied"}),(0,d.jsx)(w.AlertDescription,{children:"You do not have permission to access stock reconciliation."})]}),(0,d.jsx)("div",{className:"mt-4",children:(0,d.jsx)(j.Button,{onClick:()=>b("/inventory"),variant:"outline",children:"Back to Inventory"})})]})}]),c()}catch(a){c(a)}},!1),169748,a=>a.a(async(b,c)=>{try{var d=a.i(579168),e=a.i(627068),f=a.i(332759),g=a.i(539141),h=a.i(706555),i=a.i(128151),j=a.i(509193),k=b([i]);[i]=k.then?(await k)():k;let l=(0,f.hoist)(i,"default"),m=(0,f.hoist)(i,"getStaticProps"),n=(0,f.hoist)(i,"getStaticPaths"),o=(0,f.hoist)(i,"getServerSideProps"),p=(0,f.hoist)(i,"config"),q=(0,f.hoist)(i,"reportWebVitals"),r=(0,f.hoist)(i,"unstable_getStaticProps"),s=(0,f.hoist)(i,"unstable_getStaticPaths"),t=(0,f.hoist)(i,"unstable_getStaticParams"),u=(0,f.hoist)(i,"unstable_getServerProps"),v=(0,f.hoist)(i,"unstable_getServerSideProps"),w=new d.PagesRouteModule({definition:{kind:e.RouteKind.PAGES,page:"/StockReconciliationPage",pathname:"/StockReconciliationPage",bundlePath:"",filename:""},distDir:".next",relativeProjectDir:"",components:{App:h.default,Document:g.default},userland:i}),x=(0,j.getHandler)({srcPage:"/StockReconciliationPage",config:p,userland:i,routeModule:w,getStaticPaths:n,getStaticProps:m,getServerSideProps:o});a.s(["config",0,p,"default",0,l,"getServerSideProps",0,o,"getStaticPaths",0,n,"getStaticProps",0,m,"handler",0,x,"reportWebVitals",0,q,"routeModule",0,w,"unstable_getServerProps",0,u,"unstable_getServerSideProps",0,v,"unstable_getStaticParams",0,t,"unstable_getStaticPaths",0,s,"unstable_getStaticProps",0,r]),c()}catch(a){c(a)}},!1)];

//# sourceMappingURL=_cbb62977._.js.map