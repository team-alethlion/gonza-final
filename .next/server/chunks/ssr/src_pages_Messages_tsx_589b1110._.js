module.exports=[216439,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(391956),e=a.i(169819),f=a.i(225126),g=a.i(100260),h=a.i(890914),i=a.i(563588),j=a.i(915618),k=a.i(104720),l=a.i(911156),m=a.i(660246),n=a.i(699570);let o=({onNewMessage:a,onNewTemplate:c,onTopUp:d,onBulkMessage:e,smsCredits:f,canCreate:g=!0})=>(0,b.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-2",children:[(0,b.jsx)(i.MessageSquare,{className:"w-8 h-8 text-blue-600"}),"Messages"]}),(0,b.jsx)("p",{className:"text-gray-500 mt-1",children:"Send SMS to your customers"})]}),(0,b.jsx)("div",{className:"flex flex-wrap items-center gap-3",children:g&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(n.Button,{onClick:d,variant:"outline",className:"flex items-center gap-2 border-green-500 text-green-700 hover:bg-green-50",children:[(0,b.jsx)(l.CreditCard,{className:"w-4 h-4"}),"Top Up"]}),(0,b.jsxs)(n.Button,{onClick:c,variant:"outline",className:"flex items-center gap-2",children:[(0,b.jsx)(k.FileText,{className:"w-4 h-4"}),"New Template"]}),(0,b.jsxs)(n.Button,{onClick:e,variant:"outline",className:"flex items-center gap-2 border-purple-500 text-purple-700 hover:bg-purple-50",children:[(0,b.jsx)(m.Users,{className:"w-4 h-4"}),"Bulk SMS"]}),(0,b.jsxs)(n.Button,{onClick:a,className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700",children:[(0,b.jsx)(j.Plus,{className:"w-4 h-4"}),"New Message"]})]})})]});var p=a.i(816201),q=a.i(862722),r=a.i(641710),s=a.i(856738);let t=({stats:a})=>{let c=a.creditsRemaining<=50,d=a.creditsRemaining<=20;return(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[(0,b.jsxs)("div",{className:`p-5 rounded-xl shadow-sm border-2 transition-all hover:shadow-lg ${d?"bg-red-50 border-red-400":c?"bg-amber-50 border-amber-400":"bg-emerald-50 border-emerald-400"}`,children:[(0,b.jsxs)("div",{className:`flex items-center gap-3 mb-2 ${d?"text-red-700":c?"text-amber-700":"text-emerald-700"}`,children:[(0,b.jsx)(s.Wallet,{className:"w-5 h-5"}),(0,b.jsx)("span",{className:"text-sm font-medium",children:"Credit Bal."})]}),(0,b.jsx)("p",{className:`text-3xl font-bold ${d?"text-red-700":c?"text-amber-700":"text-emerald-700"}`,children:a.creditsRemaining.toLocaleString()})]}),(0,b.jsxs)("div",{className:"bg-white p-5 rounded-xl shadow-sm border border-gray-200 hover:shadow-md transition-shadow",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 text-gray-600 mb-2",children:[(0,b.jsx)(i.MessageSquare,{className:"w-5 h-5"}),(0,b.jsx)("span",{className:"text-sm font-medium",children:"Total"})]}),(0,b.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:a.total.toLocaleString()})]}),(0,b.jsxs)("div",{className:"bg-white p-5 rounded-xl shadow-sm border border-gray-200 hover:shadow-md transition-shadow",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 text-green-600 mb-2",children:[(0,b.jsx)(p.CheckCircle,{className:"w-5 h-5"}),(0,b.jsx)("span",{className:"text-sm font-medium",children:"Sent"})]}),(0,b.jsx)("p",{className:"text-3xl font-bold text-green-600",children:a.sent.toLocaleString()})]}),(0,b.jsxs)("div",{className:"bg-white p-5 rounded-xl shadow-sm border border-gray-200 hover:shadow-md transition-shadow",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 text-amber-600 mb-2",children:[(0,b.jsx)(r.Clock,{className:"w-5 h-5"}),(0,b.jsx)("span",{className:"text-sm font-medium",children:"Pending"})]}),(0,b.jsx)("p",{className:"text-3xl font-bold text-amber-600",children:a.pending})]}),(0,b.jsxs)("div",{className:"bg-white p-5 rounded-xl shadow-sm border border-gray-200 hover:shadow-md transition-shadow",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 text-red-600 mb-2",children:[(0,b.jsx)(q.XCircle,{className:"w-5 h-5"}),(0,b.jsx)("span",{className:"text-sm font-medium",children:"Failed"})]}),(0,b.jsx)("p",{className:"text-3xl font-bold text-red-600",children:a.failed})]}),(0,b.jsxs)("div",{className:"bg-white p-5 rounded-xl shadow-sm border border-gray-200 hover:shadow-md transition-shadow",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 text-blue-600 mb-2",children:[(0,b.jsx)(l.CreditCard,{className:"w-5 h-5"}),(0,b.jsx)("span",{className:"text-sm font-medium",children:"Credits Used"})]}),(0,b.jsx)("p",{className:"text-3xl font-bold text-blue-600",children:a.totalCreditsUsed.toLocaleString()})]})]})};var u=a.i(587532),v=a.i(581464),w=a.i(866718),x=a.i(580701);let y=({messages:a,customers:c,searchTerm:d,setSearchTerm:e,statusFilter:f,setStatusFilter:g})=>{let h=a=>a?c.find(b=>b.id===a):null,j=a.filter(a=>{let b=h(a.customerId),c=b?b.full_name||b.fullName||b.name:"",e=a.phoneNumber,g=a.content,i=!d||c.toLowerCase().includes(d.toLowerCase())||e.toLowerCase().includes(d.toLowerCase())||g.toLowerCase().includes(d.toLowerCase()),j="all"===f||a.status===f;return i&&j});return(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,b.jsxs)("div",{className:"flex-1 relative",children:[(0,b.jsx)(u.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),(0,b.jsx)(w.Input,{type:"text",placeholder:"Search messages...",value:d,onChange:a=>e(a.target.value),className:"pl-10"})]}),(0,b.jsxs)(x.Select,{value:f,onValueChange:g,children:[(0,b.jsxs)(x.SelectTrigger,{className:"w-full md:w-48",children:[(0,b.jsx)(v.Filter,{className:"w-4 h-4 mr-2"}),(0,b.jsx)(x.SelectValue,{placeholder:"Filter by status"})]}),(0,b.jsxs)(x.SelectContent,{children:[(0,b.jsx)(x.SelectItem,{value:"all",children:"All Messages"}),(0,b.jsx)(x.SelectItem,{value:"pending",children:"Pending"}),(0,b.jsx)(x.SelectItem,{value:"sent",children:"Sent"}),(0,b.jsx)(x.SelectItem,{value:"failed",children:"Failed"})]})]})]}),(0,b.jsx)("div",{className:"space-y-3",children:0===j.length?(0,b.jsxs)("div",{className:"text-center py-12 bg-white rounded-lg border",children:[(0,b.jsx)(i.MessageSquare,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),(0,b.jsx)("p",{className:"text-gray-500",children:"No messages found"})]}):j.map(a=>{let c=h(a.customerId),d=c?c.full_name||c.fullName||c.name:"";return(0,b.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow border hover:shadow-md transition-shadow",children:[(0,b.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,b.jsx)("div",{children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("p",{className:"font-medium text-gray-900",children:d?`${d} (${a.phoneNumber})`:a.phoneNumber}),(0,b.jsx)("span",{className:`text-xs px-2 py-1 rounded-full ${{pending:"bg-amber-100 text-amber-800",sent:"bg-green-100 text-green-800",delivered:"bg-blue-100 text-blue-800",failed:"bg-red-100 text-red-800"}[a.status]||"bg-gray-100 text-gray-800"}`,children:a.status})]})}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("p",{className:"text-xs text-gray-400",children:new Date(a.createdAt).toLocaleDateString()}),(0,b.jsx)("p",{className:"text-xs text-gray-400",children:new Date(a.createdAt).toLocaleTimeString()})]})]}),(0,b.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:a.content}),(0,b.jsxs)("div",{className:"flex justify-between items-center text-xs text-gray-400",children:[(0,b.jsxs)("span",{children:[a.smsCreditsUsed," credit",a.smsCreditsUsed>1?"s":""," used"]}),a.errorMessage&&(0,b.jsx)("span",{className:"text-red-600",children:a.errorMessage})]})]},a.id)})})]})},z=(0,a.i(170106).default)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);var A=a.i(814574),B=a.i(429246);let C=({open:a,onClose:d,onSend:e,customers:f,templates:g})=>{let[h,i]=(0,c.useState)(""),[j,k]=(0,c.useState)(""),[l,m]=(0,c.useState)("none"),[o,p]=(0,c.useState)("none"),[q,r]=(0,c.useState)(!1),[s,t]=(0,c.useState)(null),[u,v]=(0,c.useState)("");(0,c.useEffect)(()=>{a||(i(""),k(""),m("none"),p("none"),t(null),v(""))},[a]),(0,c.useEffect)(()=>{l&&"none"!==l&&i(y(f.find(a=>a.id===l)))},[l,f]),(0,c.useEffect)(()=>{if(o&&"none"!==o){let a=g.find(a=>a.id===o);a&&k(a.content)}},[o,g]);let y=a=>(a?.phone_number||a?.phoneNumber||a?.phone||a?.contact||"").trim(),C=(0,c.useMemo)(()=>{let a=(u||"").toLowerCase();return f.filter(a=>y(a)).filter(b=>{let c=(b.full_name||b.fullName||b.name||"").toLowerCase(),d=y(b).toLowerCase();return!a||c.includes(a)||d.includes(a)})},[f,u]),D=async()=>{if(!h||!j)return;r(!0);let a=await e({phoneNumber:h,content:j,customerId:l&&"none"!==l?l:void 0,templateId:o&&"none"!==o?o:void 0});r(!1),t({success:a.success,failed:a.failed,errors:a.errors||[]}),0===(a.failed||0)&&setTimeout(()=>d(),3e3)},E=j.length,F=Math.ceil(E/160)||1;return(0,b.jsx)(A.Dialog,{open:a,onOpenChange:d,children:(0,b.jsxs)(A.DialogContent,{className:"sm:max-w-lg max-h-[90vh] overflow-y-auto",children:[(0,b.jsx)(A.DialogHeader,{children:(0,b.jsxs)(A.DialogTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(z,{className:"w-5 h-5"}),"Send New Message"]})}),s?(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:`p-4 rounded-lg border ${0===s.failed?"bg-green-50 border-green-200":"bg-amber-50 border-amber-200"}`,children:[(0,b.jsx)("h3",{className:"font-semibold text-lg mb-2",children:0===s.failed?"✅ Message Sent Successfully!":"⚠️ Sending Completed with Errors"}),(0,b.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,b.jsxs)("p",{className:"text-green-700",children:["✓ Successfully sent: ",s.success]}),s.failed>0&&(0,b.jsxs)("p",{className:"text-red-700",children:["✗ Failed: ",s.failed]})]})]}),s.errors.length>0&&(0,b.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,b.jsx)("h4",{className:"font-semibold text-red-900 mb-2",children:"Errors:"}),(0,b.jsx)("ul",{className:"text-sm text-red-800 space-y-1 max-h-[200px] overflow-y-auto",children:s.errors.map((a,c)=>(0,b.jsxs)("li",{children:["• ",a]},c))})]}),(0,b.jsx)(n.Button,{onClick:d,className:"w-full",children:"Close"})]}):(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Select Customer (Optional)"}),(0,b.jsxs)(x.Select,{value:l,onValueChange:m,children:[(0,b.jsx)(x.SelectTrigger,{className:"w-full",children:(0,b.jsx)(x.SelectValue,{placeholder:"Search or select a customer..."})}),(0,b.jsxs)(x.SelectContent,{className:"max-h-[300px] overflow-y-auto",children:[(0,b.jsx)("div",{className:"p-2",children:(0,b.jsx)(w.Input,{type:"text",placeholder:"Type to search...",value:u,onChange:a=>v(a.target.value),className:"mb-2"})}),(0,b.jsx)(x.SelectItem,{value:"none",children:"None - Enter Customer Name or Phone Number"}),C.map(a=>(0,b.jsxs)(x.SelectItem,{value:a.id,children:[a.full_name||a.fullName||a.name||"Unnamed Customer"," - ",y(a)]},a.id))]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Phone Number *"}),(0,b.jsx)(w.Input,{type:"tel",placeholder:"+256700000000",value:h,onChange:a=>i(a.target.value),className:"w-full"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Use Template (Optional)"}),(0,b.jsxs)(x.Select,{value:o,onValueChange:p,children:[(0,b.jsx)(x.SelectTrigger,{className:"w-full",children:(0,b.jsx)(x.SelectValue,{placeholder:"Choose a template..."})}),(0,b.jsxs)(x.SelectContent,{className:"max-h-[300px] overflow-y-auto",children:[(0,b.jsx)(x.SelectItem,{value:"none",children:"None - Type custom message"}),g.map(a=>(0,b.jsx)(x.SelectItem,{value:a.id,children:a.name},a.id))]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Message * (Max 160 Characters)"}),(0,b.jsx)(B.Textarea,{placeholder:"Type your message...",value:j,onChange:a=>k(a.target.value),rows:5,required:!0,className:"w-full resize-none"}),(0,b.jsxs)("div",{className:"flex justify-between mt-1 text-xs text-gray-500",children:[(0,b.jsxs)("span",{children:[E," characters"]}),(0,b.jsxs)("span",{children:[F," SMS credit",F>1?"s":""," will be used"]})]})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[(0,b.jsx)(n.Button,{variant:"outline",onClick:d,disabled:q,children:"Cancel"}),(0,b.jsx)(n.Button,{onClick:D,disabled:!h||!j||q,className:"bg-blue-600 hover:bg-blue-700",children:q?(0,b.jsx)("span",{className:"animate-spin mr-2",children:"⏳"}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(z,{className:"w-4 h-4 mr-2"}),"Send Message"]})})]})]})]})})};var D=a.i(114548);let E=[{value:"ThankYou",label:"Thank You (After Sale)"},{value:"Birthday",label:"Birthday Wishes"},{value:"PaymentReminder",label:"Payment Reminder"},{value:"Holiday",label:"Public Holiday"},{value:"Inactive",label:"We Miss You / Inactive Customer"},{value:"Custom",label:"Custom"}],F=({open:a,onClose:d,onSave:e,initialData:f})=>{let[g,h]=(0,c.useState)(""),[i,j]=(0,c.useState)(""),[l,m]=(0,c.useState)(""),[o,p]=(0,c.useState)(""),[q,r]=(0,c.useState)([]),[s,t]=(0,c.useState)(!1);(0,c.useEffect)(()=>{a&&f?(h(f.name),j(f.content),m(f.category||""),p(f.category&&!E.some(a=>a.value===f.category)?f.category:""),r(f.variables||[])):a||(h(""),j(""),m(""),p(""),r([]))},[a,f]);let u=async()=>{if(!g||!i)return;let a="Custom"===l?o:l;t(!0);let b=await e({name:g,content:i,category:a||void 0,variables:q,isDefault:!1});t(!1),b&&d()};return(0,b.jsx)(A.Dialog,{open:a,onOpenChange:a=>{a||d()},children:(0,b.jsxs)(A.DialogContent,{className:"sm:max-w-lg max-h-[80vh] overflow-y-auto",children:[(0,b.jsx)(A.DialogHeader,{children:(0,b.jsxs)(A.DialogTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(k.FileText,{className:"w-5 h-5"}),f?"Edit Template":"Create New Template"]})}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Template Name *"}),(0,b.jsx)(B.Textarea,{placeholder:"e.g., Welcome Message",value:g,onChange:a=>h(a.target.value),rows:1,className:"resize-none"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Category *"}),(0,b.jsxs)(x.Select,{value:l,onValueChange:m,children:[(0,b.jsx)(x.SelectTrigger,{children:(0,b.jsx)(x.SelectValue,{placeholder:"Select category..."})}),(0,b.jsx)(x.SelectContent,{children:E.map(a=>(0,b.jsx)(x.SelectItem,{value:a.value,children:a.label},a.value))})]}),"Custom"===l&&(0,b.jsx)(B.Textarea,{placeholder:"Type custom category...",value:o,onChange:a=>p(a.target.value),rows:1,className:"mt-2 resize-none"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Message Content *"}),(0,b.jsx)(B.Textarea,{placeholder:"Type your template here... Use {variable} for dynamic content",value:i,onChange:a=>{let b;j(a.target.value),(b=a.target.value.match(/\{([^}]+)\}/g))?r([...new Set(b.map(a=>a.slice(1,-1)))]):r([])},rows:6,className:"resize-none"}),(0,b.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Use curly braces for variables: ","{customer_name}",", ","{customer_phone}",", etc."]})]}),q.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Detected Variables"}),(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:q.map(a=>(0,b.jsx)("span",{className:"text-xs px-2 py-1 bg-blue-50 text-blue-600 rounded",children:a},a))})]}),(0,b.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[(0,b.jsx)("p",{className:"text-xs font-medium text-blue-900 mb-2",children:"Available Variables"}),(0,b.jsxs)("div",{className:"text-xs text-blue-800 space-y-1",children:[(0,b.jsxs)("p",{children:["• ",(0,b.jsx)("code",{className:"bg-blue-100 px-1 rounded",children:"{customer_name}"})," - Full customer name"]}),(0,b.jsxs)("p",{children:["• ",(0,b.jsx)("code",{className:"bg-blue-100 px-1 rounded",children:"{first_name}"})," - Customer first name"]}),(0,b.jsxs)("p",{children:["• ",(0,b.jsx)("code",{className:"bg-blue-100 px-1 rounded",children:"{last_name}"})," - Customer last name"]}),(0,b.jsxs)("p",{children:["• ",(0,b.jsx)("code",{className:"bg-blue-100 px-1 rounded",children:"{customer_phone}"})," - Customer phone number"]}),(0,b.jsxs)("p",{children:["• ",(0,b.jsx)("code",{className:"bg-blue-100 px-1 rounded",children:"{customer_email}"})," - Customer email"]})]}),(0,b.jsx)("p",{className:"text-xs text-blue-700 mt-2",children:"These will be automatically replaced when sending to a customer"})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-2 pt-4",children:[(0,b.jsx)(n.Button,{variant:"outline",onClick:d,disabled:s,children:"Cancel"}),(0,b.jsxs)(n.Button,{onClick:u,disabled:!g||!i||!l||"Custom"===l&&!o||s,className:"bg-blue-600 hover:bg-blue-700",children:[(0,b.jsx)(D.Save,{className:"w-4 h-4 mr-2"}),s?"Saving...":"Save Template"]})]})]})]})})};var G=a.i(790166);let H={get url(){return`file://${a.P("src/components/messages/TopUpCreditsDialog.tsx")}`}},I=({open:a,onClose:d,onTopUp:e})=>{let[f,g]=(0,c.useState)(10),[h,i]=(0,c.useState)(""),[j,k]=(0,c.useState)(!1),m=Number(H.env.VITE_SMS_CREDIT_COST||100),o=f*m;(0,c.useEffect)(()=>{console.log("[TopUpCreditsDialog] Dialog open state:",a),a&&(console.log("[TopUpCreditsDialog] Dialog opened — resetting form"),g(10),i(""),k(!1))},[a]),(0,c.useEffect)(()=>{console.log("[TopUpCreditsDialog] Current state → Credits:",f,"| Phone:",h,"| Total Cost: UGX",o.toLocaleString())},[f,h,o]);let p=async()=>{if(console.log("[TopUpCreditsDialog] Top-up requested!"),console.log("   → Credits:",f),console.log("   → Phone Number:",h),console.log("   → Total Cost: UGX",o.toLocaleString()),!h||f<1)return void console.warn("[TopUpCreditsDialog] Invalid input — blocking submit");k(!0),console.log("[TopUpCreditsDialog] Calling onTopUp...");try{let a=await e(f,h);console.log("[TopUpCreditsDialog] onTopUp result:",a?"SUCCESS":"FAILED"),a?(console.log("[TopUpCreditsDialog] Payment successful → closing dialog"),d()):console.error("[TopUpCreditsDialog] Payment failed (returned false)")}catch(a){console.error("[TopUpCreditsDialog] onTopUp threw an error:",a)}finally{k(!1)}};return(0,b.jsx)(A.Dialog,{open:a,onOpenChange:d,children:(0,b.jsxs)(A.DialogContent,{className:"sm:max-w-lg",children:[(0,b.jsx)(A.DialogHeader,{children:(0,b.jsxs)(A.DialogTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(l.CreditCard,{className:"w-5 h-5"}),"Top Up SMS Credits"]})}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Number of Credits *"}),(0,b.jsx)(w.Input,{type:"number",min:"1",value:f,onChange:a=>{let b=Math.max(1,parseInt(a.target.value)||1);console.log("[TopUpCreditsDialog] Credits input changed →",b),g(b)},className:"text-lg font-semibold"}),(0,b.jsx)("div",{className:"mt-3 flex flex-wrap gap-2",children:[10,25,50,100].map(a=>(0,b.jsxs)("button",{type:"button",onClick:()=>{console.log("[TopUpCreditsDialog] Quick amount clicked →",a,"credits"),g(a)},className:`px-3 py-1 text-sm rounded-md border transition-colors ${f===a?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300 hover:border-blue-400"}`,children:[a," credits"]},a))})]}),(0,b.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("span",{className:"text-sm text-gray-600",children:"Credit Cost:"}),(0,b.jsxs)("span",{className:"text-sm font-medium",children:["UGX ",m," per credit"]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("span",{className:"text-sm text-gray-600",children:"Quantity:"}),(0,b.jsxs)("span",{className:"text-sm font-medium",children:[f," credits"]})]}),(0,b.jsx)("div",{className:"border-t border-blue-300 pt-2 mt-2",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-base font-semibold text-gray-900",children:"Total Amount:"}),(0,b.jsxs)("span",{className:"text-xl font-bold text-blue-600",children:["UGX ",o.toLocaleString()]})]})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Mobile Money Phone Number *"}),(0,b.jsx)(w.Input,{type:"tel",placeholder:"+256700000000",value:h,onChange:a=>{console.log("[TopUpCreditsDialog] Phone number changed →",a.target.value),i(a.target.value)}}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"You will receive a payment prompt on this number"})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-2 pt-4",children:[(0,b.jsx)(n.Button,{variant:"outline",onClick:d,disabled:j,children:"Cancel"}),(0,b.jsxs)(n.Button,{onClick:p,disabled:!h||f<1||j,className:"bg-green-600 hover:bg-green-700",children:[(0,b.jsx)(G.DollarSign,{className:"w-4 h-4 mr-2"}),j?"Processing...":`Pay UGX ${o.toLocaleString()}`]})]})]})]})})};var J=a.i(292e3),K=a.i(315055),L=a.i(737139),M=a.i(148817),N=a.i(668465),O=a.i(724793);let P=({open:a,onClose:d,onSend:f,customers:g,templates:h=[],searchTerm:i,setSearchTerm:j})=>{let[k,l]=(0,c.useState)(""),[o,p]=(0,c.useState)([]),[q,r]=(0,c.useState)("none"),[s,t]=(0,c.useState)(!1),[u,v]=(0,c.useState)("all"),[y,C]=(0,c.useState)("90days"),[D,E]=(0,c.useState)(null),{currentBusiness:F}=(0,e.useBusiness)(),{sales:G,isLoading:H}=(0,L.useSalesData)(F?.id),I=a=>a.charAt(0).toUpperCase()+a.slice(1),P=(0,c.useMemo)(()=>{let a={};if(!G||0===G.length)return a;let b=new Date,c=b;switch(y){case"30days":c=(0,M.subDays)(b,30);break;case"60days":c=(0,M.subDays)(b,60);break;case"90days":c=(0,M.subDays)(b,90);break;case"6months":c=(0,N.subMonths)(b,6);break;case"1year":c=(0,O.subYears)(b,1)}return g.forEach(b=>{let d=(b.full_name||b.fullName||b.name||"").toLowerCase(),e=G.filter(a=>a.customerId===b.id||a.customerName?.toLowerCase().trim()===d),f=new Set;0===e.length?f.add("inactive"):(new Date(Math.max(...e.map(a=>new Date(a.date).getTime())))<c&&f.add("inactive"),e.forEach(a=>{let b=(a.paymentStatus||"").toUpperCase().trim();"PAID"===b?f.add("paid"):"QUOTE"===b?f.add("quote"):"INSTALLMENT SALE"===b?f.add("installment"):["NOT PAID","UNPAID","OPEN"].includes(b)&&f.add("unpaid")})),a[b.id]=f}),a},[g,G,y]);(0,c.useEffect)(()=>{a||(l(""),p([]),r("none"),v("all"),E(null))},[a]),(0,c.useEffect)(()=>{if(q&&"none"!==q){let a=h.find(a=>a.id===q);a&&l(a.content)}},[q,h]);let Q=a=>a.phone_number||a.phoneNumber||a.phone||a.contact||"",R=(0,c.useMemo)(()=>g.filter(a=>{let b=Q(a)||"";if(!b)return!1;let c=(a.full_name||a.fullName||a.name||"").toLowerCase(),d=(i||"").toLowerCase(),e=!d||c.includes(d)||b.toLowerCase().includes(d),f=P[a.id]||new Set,g=!0;return"all"!==u&&(g=f.has(u)),e&&g}),[g,i,u,P]),S=a=>{p(b=>b.includes(a)?b.filter(b=>b!==a):[...b,a])},T=async()=>{if(!k||0===o.length)return;t(!0);let a=await f({customerIds:o,content:k,templateId:"none"!==q?q:void 0});t(!1),E(a),0===a.failed&&setTimeout(()=>d(),3e3)},U=o.length*Math.ceil((k.length||1)/160);return H?(0,b.jsx)(A.Dialog,{open:a,onOpenChange:d,children:(0,b.jsx)(A.DialogContent,{className:"sm:max-w-3xl max-h-[90vh] overflow-y-auto",children:(0,b.jsx)("div",{className:"p-4 text-center text-gray-500",children:"Loading sales data..."})})}):(0,b.jsx)(A.Dialog,{open:a,onOpenChange:d,children:(0,b.jsxs)(A.DialogContent,{className:"sm:max-w-3xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsx)(A.DialogHeader,{children:(0,b.jsxs)(A.DialogTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(m.Users,{className:"w-5 h-5"}),"Send Bulk SMS"]})}),D?(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:`p-4 rounded-lg border ${0===D.failed?"bg-green-50 border-green-200":"bg-amber-50 border-amber-200"}`,children:[(0,b.jsx)("h3",{className:"font-semibold text-lg mb-2",children:0===D.failed?"✅ Messages Sent Successfully!":"⚠️ Sending Complete with Errors"}),(0,b.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,b.jsxs)("p",{className:"text-green-700",children:["✓ Successfully sent: ",D.success]}),D.failed>0&&(0,b.jsxs)("p",{className:"text-red-700",children:["✗ Failed: ",D.failed]})]})]}),D.errors.length>0&&(0,b.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,b.jsx)("h4",{className:"font-semibold text-red-900 mb-2",children:"Errors:"}),(0,b.jsx)("ul",{className:"text-sm text-red-800 space-y-1 max-h-[200px] overflow-y-auto",children:D.errors.map((a,c)=>(0,b.jsxs)("li",{children:["• ",a]},c))})]}),(0,b.jsx)(n.Button,{onClick:d,className:"w-full",children:"Close"})]}):(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Use Template (Optional)"}),(0,b.jsxs)(x.Select,{value:q,onValueChange:r,children:[(0,b.jsx)(x.SelectTrigger,{className:"w-full",children:(0,b.jsx)(x.SelectValue,{placeholder:"Choose a template..."})}),(0,b.jsxs)(x.SelectContent,{className:"max-h-[300px] overflow-y-auto",children:[(0,b.jsx)(x.SelectItem,{value:"none",children:"None - Type custom message"}),h.map(a=>(0,b.jsx)(x.SelectItem,{value:a.id,children:a.name},a.id))]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Message * (Max 160 Characters)"}),(0,b.jsx)(B.Textarea,{placeholder:"Type your message here... Use {customer_name} for personalization",value:k,onChange:a=>l(a.target.value),rows:4,maxLength:160,required:!0,className:"resize-none w-full"}),(0,b.jsxs)("div",{className:"flex justify-between mt-1 text-xs text-gray-500",children:[(0,b.jsxs)("span",{children:[k.length," characters"]}),(0,b.jsxs)("span",{className:"font-medium text-blue-600",children:[U," total SMS credits will be used"]})]})]}),(0,b.jsxs)("div",{className:"flex gap-2 mb-2 flex-wrap items-center",children:[["all","paid","unpaid","quote","installment","inactive"].map(a=>(0,b.jsx)(n.Button,{size:"sm",variant:u===a?"default":"outline",onClick:()=>v(a),children:I(a)},a)),"inactive"===u&&(0,b.jsxs)(x.Select,{value:y,onValueChange:a=>C(a),children:[(0,b.jsx)(x.SelectTrigger,{className:"w-[120px] text-xs",children:(0,b.jsx)(x.SelectValue,{placeholder:"Select period"})}),(0,b.jsxs)(x.SelectContent,{children:[(0,b.jsx)(x.SelectItem,{value:"30days",children:"30 days"}),(0,b.jsx)(x.SelectItem,{value:"60days",children:"60 days"}),(0,b.jsx)(x.SelectItem,{value:"90days",children:"90 days"}),(0,b.jsx)(x.SelectItem,{value:"6months",children:"6 months"}),(0,b.jsx)(x.SelectItem,{value:"1year",children:"1 year"})]})]}),(0,b.jsx)(n.Button,{size:"sm",variant:"outline",onClick:()=>{o.length===R.length?p([]):p(R.map(a=>a.id))},children:o.length===R.length?`Deselect All ${I(u)} Customers`:`Select All ${I(u)} Customers`})]}),(0,b.jsx)(w.Input,{type:"text",placeholder:"Search customers...",value:i,onChange:a=>j(a.target.value),className:"mb-2"}),(0,b.jsx)("div",{className:"border rounded-lg max-h-[300px] overflow-y-auto",children:0===R.length?(0,b.jsxs)("div",{className:"p-4 text-center text-gray-500",children:[(0,b.jsx)(J.AlertCircle,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),(0,b.jsx)("p",{children:"No customers match your search"})]}):R.map(a=>{let c=Q(a),d=Array.from(P[a.id]||[]);return(0,b.jsxs)("div",{className:"flex items-center gap-3 p-3 hover:bg-gray-50 border-b last:border-b-0 cursor-pointer",onClick:()=>S(a.id),children:[(0,b.jsx)(K.Checkbox,{checked:o.includes(a.id),onCheckedChange:()=>S(a.id)}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"font-medium text-gray-900",children:a.full_name||a.fullName||a.name||"Unnamed Customer"}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:c}),(0,b.jsxs)("span",{className:"text-xs text-gray-400",children:["Status: ",d.map(a=>a.toUpperCase()).join(", ")]})]})]},a.id)})}),(0,b.jsxs)("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[(0,b.jsx)(n.Button,{variant:"outline",onClick:d,disabled:s,children:"Cancel"}),(0,b.jsx)(n.Button,{onClick:T,disabled:0===o.length||!k||s,className:"bg-blue-600 hover:bg-blue-700",children:s?(0,b.jsx)("span",{className:"animate-spin mr-2",children:"⏳"}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(z,{className:"w-4 h-4 mr-2"}),"Send to ",o.length," Customer",1!==o.length?"s":""]})})]})]})]})})},Q=({purchases:a})=>0===a.length?(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow border p-8 text-center",children:[(0,b.jsx)(l.CreditCard,{className:"w-12 h-12 mx-auto text-gray-400 mb-3"}),(0,b.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"No Purchase History"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Your credit purchase history will appear here."})]}):(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow border overflow-hidden",children:[(0,b.jsx)("div",{className:"px-6 py-4 border-b bg-gray-50",children:(0,b.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[(0,b.jsx)(l.CreditCard,{className:"w-5 h-5"}),"Purchase History"]})}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,b.jsx)("thead",{className:"bg-gray-50",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Credits"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Cost"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Payment Phone"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Payment Method"})]})}),(0,b.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:a.map(a=>(0,b.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(a.created_at||a.createdAt||"").toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})}),(0,b.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:[(a.credits_amount||a.creditsAmount||0).toLocaleString()," credits"]}),(0,b.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["UGX ",(a.total_cost||a.totalCost||0).toLocaleString()]}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:a.payment_phone_number||a.paymentPhoneNumber||"-"}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(a=>{switch(a.toLowerCase()){case"completed":return(0,b.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[(0,b.jsx)(p.CheckCircle,{className:"w-3 h-3"}),"Completed"]});case"pending":return(0,b.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[(0,b.jsx)(r.Clock,{className:"w-3 h-3"}),"Pending"]});case"failed":return(0,b.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[(0,b.jsx)(q.XCircle,{className:"w-3 h-3"}),"Failed"]});default:return(0,b.jsx)("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:a})}})(a.payment_status||a.paymentStatus||"pending")}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:a.payment_method||a.paymentMethod||"-"})]},a.id))})]})})]}),R=({messages:a})=>{let[d,e]=(0,c.useState)(null);return 0===a.length?(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow border p-8 text-center",children:[(0,b.jsx)(z,{className:"w-12 h-12 mx-auto text-gray-400 mb-3"}),(0,b.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"No Usage History"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Your sent messages will appear here."})]}):(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow border overflow-hidden",children:[(0,b.jsx)("div",{className:"px-6 py-4 border-b bg-gray-50",children:(0,b.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[(0,b.jsx)(i.MessageSquare,{className:"w-5 h-5"}),"Usage History"]})}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,b.jsx)("thead",{className:"bg-gray-50",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date Sent"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Phone Number"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Message"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Credits Used"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"})]})}),(0,b.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:a.map(a=>{let c=a.sms_credits_used||a.smsCreditsUsed||0;return(0,b.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(a.sent_at||a.sentAt||a.created_at||a.createdAt||"").toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:a.phone_number||a.phoneNumber||"-"}),(0,b.jsx)("td",{className:"px-6 py-4 text-sm text-gray-900 max-w-md",children:(0,b.jsx)("div",{children:d===a.id?(0,b.jsxs)("div",{className:"whitespace-pre-wrap",children:[a.content,(0,b.jsx)("button",{onClick:()=>e(null),className:"text-blue-600 hover:text-blue-800 ml-2 text-xs",children:"Show less"})]}):(0,b.jsxs)("div",{children:[((a,b=50)=>a.length<=b?a:a.substring(0,b)+"...")(a.content),a.content.length>50&&(0,b.jsx)("button",{onClick:()=>e(a.id),className:"text-blue-600 hover:text-blue-800 ml-2 text-xs",children:"Show more"})]})})}),(0,b.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:[c," credit",c>1?"s":""]}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(a=>{switch(a.toLowerCase()){case"sent":case"delivered":return(0,b.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[(0,b.jsx)(p.CheckCircle,{className:"w-3 h-3"}),"delivered"===a?"Delivered":"Sent"]});case"pending":return(0,b.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[(0,b.jsx)(r.Clock,{className:"w-3 h-3"}),"Pending"]});case"failed":return(0,b.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[(0,b.jsx)(q.XCircle,{className:"w-3 h-3"}),"Failed"]});default:return(0,b.jsx)("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:a})}})(a.status)})]},a.id)})})]})})]})};var S=a.i(875083),T=a.i(124348),U=a.i(400210),V=a.i(665967);a.s(["default",0,()=>{let{user:a}=(0,d.useAuth)(),{currentBusiness:i,isLoading:j}=(0,e.useBusiness)(),{currentProfile:k,hasPermission:l,isLoading:m}=(0,h.useProfiles)(),p=(0,V.useNavigate)(),q=l("messages","view"),r=l("messages","create"),s=l("messages","edit"),u=l("messages","delete"),{messages:v,templates:w,purchases:x,isLoading:z,createMessage:A,createBulkMessages:B,createTemplate:D,updateTemplate:E,deleteTemplate:G,initiateCreditPurchase:H,getMessageStats:K}=(0,f.useMessages)(a?.id),{customers:L}=(0,g.useCustomers)(),[M,N]=(0,c.useState)(!1),[O,W]=(0,c.useState)(!1),[X,Y]=(0,c.useState)(!1),[Z,$]=(0,c.useState)(!1),[_,aa]=(0,c.useState)(void 0),[ab,ac]=(0,c.useState)("messages"),[ad,ae]=(0,c.useState)(""),[af,ag]=(0,c.useState)("all"),ah=K(),ai=async a=>{try{return await A(a),{success:1,failed:0,errors:[]}}catch(a){return console.error("Failed to send message:",a),{success:0,failed:1,errors:[a instanceof Error?a.message:"Unknown error"]}}},aj=(0,c.useCallback)(async a=>{try{return await B(a)}catch(a){return console.error("Failed to send bulk messages:",a),alert(a instanceof Error?a.message:"Failed to send messages"),{success:0,failed:0,errors:[a instanceof Error?a.message:"Unknown error"]}}},[B]),ak=(0,c.useCallback)(async a=>(_?await E(_.id,a):await D(a),W(!1),aa(void 0),!0),[_,E,D]),al=(0,c.useCallback)(a=>{aa(a),W(!0)},[]),am=(0,c.useCallback)(async a=>{confirm("Are you sure you want to delete this template?")&&await G(a)},[G]),an=(0,c.useCallback)(async(a,b)=>{try{let c=await H(a,b);return window.open(c.redirectUrl,"_blank"),$(!1),!0}catch(a){return console.error("Failed to initiate top-up:",a),alert(a instanceof Error?a.message:"Failed to initiate payment"),!1}},[H]);if(j||!i||z||m)return(0,b.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,b.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(!q)return(0,b.jsxs)("div",{className:"max-w-4xl mx-auto p-6",children:[(0,b.jsxs)(T.Alert,{variant:"destructive",children:[(0,b.jsx)(J.AlertCircle,{className:"h-4 w-4"}),(0,b.jsx)(T.AlertTitle,{children:"Access Denied"}),(0,b.jsx)(T.AlertDescription,{children:"You do not have permission to view the messaging module. Please contact your administrator if you believe this is an error."})]}),(0,b.jsx)("div",{className:"mt-4",children:(0,b.jsxs)(n.Button,{onClick:()=>p("/"),variant:"outline",className:"gap-2",children:[(0,b.jsx)(U.ArrowLeft,{className:"h-4 w-4"}),"Back to Dashboard"]})})]});let ao=v.filter(a=>{let b=a.phoneNumber||"",c=a.content||"",d=b.toLowerCase().includes(ad.toLowerCase())||c.toLowerCase().includes(ad.toLowerCase()),e="all"===af||a.status===af;return d&&e});return(0,b.jsxs)("div",{className:"space-y-8",children:[(0,b.jsx)(o,{onNewMessage:()=>N(!0),onNewTemplate:()=>{aa(void 0),W(!0)},onTopUp:()=>$(!0),onBulkMessage:()=>Y(!0),smsCredits:k?.sms_credits||0,canCreate:r}),(0,b.jsx)(t,{stats:ah}),(0,b.jsxs)(S.Tabs,{value:ab,onValueChange:ac,className:"w-full",children:[(0,b.jsxs)(S.TabsList,{className:"grid w-full max-w-2xl grid-cols-3",children:[(0,b.jsx)(S.TabsTrigger,{value:"messages",children:"Messages"}),(0,b.jsx)(S.TabsTrigger,{value:"templates",children:"Templates"}),(0,b.jsx)(S.TabsTrigger,{value:"history",children:"History"})]}),(0,b.jsx)(S.TabsContent,{value:"messages",className:"space-y-4 mt-6",children:(0,b.jsx)(y,{messages:ao,customers:L,searchTerm:ad,setSearchTerm:ae,statusFilter:af,setStatusFilter:ag})}),(0,b.jsx)(S.TabsContent,{value:"templates",className:"space-y-4 mt-6",children:(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:w.map(a=>(0,b.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow border hover:shadow-md transition-shadow",children:[(0,b.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,b.jsx)("h3",{className:"font-semibold text-lg",children:a.name}),(0,b.jsxs)("div",{className:"flex gap-2",children:[s&&(0,b.jsx)("button",{onClick:()=>al(a),className:"text-blue-600 hover:text-blue-800 text-sm",children:"Edit"}),u&&(0,b.jsx)("button",{onClick:()=>am(a.id),className:"text-red-600 hover:text-red-800 text-sm",children:"Delete"})]})]}),a.category&&(0,b.jsx)("span",{className:"text-xs px-2 py-1 bg-gray-100 rounded-full text-gray-600",children:a.category}),(0,b.jsx)("p",{className:"text-sm text-gray-600 mt-2 line-clamp-3",children:a.content}),a.variables.length>0&&(0,b.jsx)("div",{className:"mt-2 flex flex-wrap gap-1",children:a.variables.map(a=>(0,b.jsx)("span",{className:"text-xs px-2 py-0.5 bg-blue-50 text-blue-600 rounded",children:a},a))})]},a.id))})}),(0,b.jsxs)(S.TabsContent,{value:"history",className:"space-y-6 mt-6",children:[(0,b.jsx)(Q,{purchases:x}),(0,b.jsx)(R,{messages:v})]})]}),(0,b.jsx)(F,{open:O,onClose:()=>{W(!1),aa(void 0)},onSave:ak,initialData:_}),(0,b.jsx)(I,{open:Z,onClose:()=>$(!1),onTopUp:an}),(0,b.jsx)(C,{open:M,onClose:()=>N(!1),onSend:ai,customers:L,templates:w}),(0,b.jsx)(P,{open:X,onClose:()=>Y(!1),onSend:aj,customers:L,templates:w,searchTerm:ad,setSearchTerm:ae})]})}],216439)}];

//# sourceMappingURL=src_pages_Messages_tsx_589b1110._.js.map