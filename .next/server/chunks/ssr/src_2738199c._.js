module.exports=[202529,a=>a.a(async(b,c)=>{try{var d=a.i(150848),e=a.i(348287),f=b([d]);async function g(a){try{let b=await d.db.customer.findMany({where:{branchId:a},orderBy:{name:"asc"}}),c=await d.db.customer.count({where:{branchId:a}}),e=b.map(a=>({id:a.id,fullName:a.name,phoneNumber:a.phone,email:a.email,birthday:a.birthday?a.birthday.toISOString():null,gender:a.gender,location:a.address,categoryId:a.categoryId,notes:a.notes,tags:a.tags||[],socialMedia:a.socialMedia||null,createdAt:a.createdAt.toISOString(),updatedAt:a.updatedAt.toISOString()}));return{success:!0,data:{customers:e,count:c}}}catch(a){return console.error("Error fetching customers:",a),{success:!1,error:a.message}}}async function h(a,b,c){try{let f=await d.db.customer.create({data:{branchId:a,adminId:b,name:c.fullName,phone:c.phoneNumber||null,email:c.email||null,birthday:c.birthday?new Date(c.birthday):null,gender:c.gender||null,address:c.location||null,categoryId:c.categoryId||null,notes:c.notes||null,tags:c.tags||[],socialMedia:c.socialMedia||null}});return(0,e.revalidatePath)("/customers"),{success:!0,data:f}}catch(a){return console.error("Error creating customer:",a),{success:!1,error:a.message}}}async function i(a,b){try{let c={};void 0!==b.fullName&&(c.name=b.fullName),void 0!==b.phoneNumber&&(c.phone=b.phoneNumber),void 0!==b.email&&(c.email=b.email),void 0!==b.birthday&&(c.birthday=b.birthday?new Date(b.birthday):null),void 0!==b.gender&&(c.gender=b.gender),void 0!==b.location&&(c.address=b.location),void 0!==b.categoryId&&(c.categoryId=b.categoryId),void 0!==b.notes&&(c.notes=b.notes),void 0!==b.tags&&(c.tags=b.tags),void 0!==b.socialMedia&&(c.socialMedia=b.socialMedia);let f=await d.db.customer.update({where:{id:a},data:c});return(0,e.revalidatePath)("/customers"),{success:!0,data:f}}catch(a){return console.error("Error updating customer:",a),{success:!1,error:a.message}}}async function j(a){try{return await d.db.customer.delete({where:{id:a}}),(0,e.revalidatePath)("/customers"),{success:!0}}catch(a){return console.error("Error deleting customer:",a),{success:!1,error:a.message}}}async function k(a){try{let b=(await d.db.customerCategory.findMany({where:{branchId:a},orderBy:{name:"asc"}})).map(a=>({id:a.id,name:a.name,isDefault:a.isDefault,createdAt:a.createdAt.toISOString(),updatedAt:a.updatedAt.toISOString()}));return{success:!0,data:b}}catch(a){return console.error("Error fetching customer categories:",a),{success:!1,error:a.message}}}async function l(a,b,c){try{let f=await d.db.customerCategory.create({data:{branchId:a,name:c.trim(),isDefault:!1,userId:b}});return(0,e.revalidatePath)("/customers"),{success:!0,data:f}}catch(a){return console.error("Error creating customer category:",a),{success:!1,error:a.message}}}async function m(a,b){try{let c=await d.db.customerCategory.update({where:{id:a},data:{name:b.trim()}});return(0,e.revalidatePath)("/customers"),{success:!0,data:c}}catch(a){return console.error("Error updating customer category:",a),{success:!1,error:a.message}}}async function n(a){try{return await d.db.customerCategory.delete({where:{id:a}}),(0,e.revalidatePath)("/customers"),{success:!0}}catch(a){return console.error("Error deleting customer category:",a),{success:!1,error:a.message}}}[d]=f.then?(await f)():f,a.s(["createCustomerAction",()=>h,"createCustomerCategoryAction",()=>l,"deleteCustomerAction",()=>j,"deleteCustomerCategoryAction",()=>n,"getCustomerCategoriesAction",()=>k,"getCustomersAction",()=>g,"updateCustomerAction",()=>i,"updateCustomerCategoryAction",()=>m]),c()}catch(a){c(a)}},!1),101056,a=>a.a(async(b,c)=>{try{var d=a.i(127669),e=a.i(108191),f=a.i(964889),g=a.i(895363),h=a.i(500885),i=a.i(202529),j=a.i(531811),k=b([f,g,h,i,j]);[f,g,h,i,j]=k.then?(await k)():k,a.s(["useCustomers",0,(a=50)=>{let[b,c]=(0,d.useState)([]),[k,l]=(0,d.useState)(1),[m,n]=(0,d.useState)(a),[o,p]=(0,d.useState)(0),{toast:q}=(0,e.useToast)(),{currentBusiness:r}=(0,f.useBusiness)(),{user:s}=(0,j.useAuth)(),{logActivity:t}=(0,g.useActivityLogger)(),u=(0,h.useQueryClient)(),v=(0,d.useCallback)(async()=>{if(!r)return{customers:[],count:0};try{let a=await (0,i.getCustomersAction)(r.id);if(!a.success)throw Error(a.error);return{customers:(a.data?.customers||[]).map(a=>({id:a.id,fullName:a.fullName||a.name,phoneNumber:a.phoneNumber||a.phone,email:a.email,birthday:a.birthday?new Date(a.birthday):null,gender:a.gender,location:a.location||a.address,categoryId:a.categoryId,notes:a.notes,tags:a.tags,socialMedia:a.socialMedia||null,createdAt:new Date(a.createdAt),updatedAt:new Date(a.updatedAt)})),count:a.data?.count||0}}catch(a){return console.error("Error loading customers:",a),q({title:"Error",description:"Failed to load customers. Please try again.",variant:"destructive"}),{customers:[],count:0}}},[r?.id,q]),w=["customers",r?.id],{data:x,isLoading:y,isFetching:z}=(0,h.useQuery)({queryKey:w,queryFn:v,enabled:!!r?.id,staleTime:3e5,gcTime:18e5,refetchOnWindowFocus:!1,refetchOnReconnect:!1});(0,d.useEffect)(()=>{x&&(c(x.customers),p(x.count))},[x]);let A=y&&!x,B=async a=>{if(!r)return q({title:"Error",description:"No business selected",variant:"destructive"}),null;try{if(!s)throw Error("User not authenticated");let b={fullName:a.fullName,phoneNumber:a.phoneNumber||null,email:a.email||null,birthday:a.birthday?.toISOString().split("T")[0]||null,gender:a.gender||null,location:a.location||null,categoryId:a.categoryId||null,notes:a.notes||null,tags:a.tags||null,socialMedia:a.socialMedia||null},d=await (0,i.createCustomerAction)(r.id,s.id,b);if(!d.success||!d.data)throw Error(d.error||"Failed to create customer");let e=d.data,f={id:e.id,fullName:e.name||e.fullName,phoneNumber:e.phone||e.phoneNumber,email:e.email,birthday:e.birthday?new Date(e.birthday):null,gender:e.gender,location:e.address||e.location,categoryId:e.categoryId,notes:e.notes,tags:e.tags,socialMedia:e.socialMedia,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)};return c(a=>[f,...a]),p(a=>a+1),u.setQueryData(w,a=>a?{customers:[f,...a.customers],count:(a.count||0)+1}:{customers:[f],count:1}),await t({activityType:"CREATE",module:"CUSTOMERS",entityType:"customer",entityId:e.id,entityName:a.fullName,description:`Created customer "${a.fullName}"`,metadata:{phoneNumber:a.phoneNumber,email:a.email,location:a.location}}),q({title:"Success",description:"Customer created successfully"}),e}catch(a){return console.error("Error creating customer:",a),q({title:"Error",description:"Failed to create customer. Please try again.",variant:"destructive"}),null}},C=async(a,d)=>{try{let e={};void 0!==d.fullName&&(e.fullName=d.fullName),void 0!==d.phoneNumber&&(e.phoneNumber=d.phoneNumber),void 0!==d.email&&(e.email=d.email),void 0!==d.birthday&&(e.birthday=d.birthday?.toISOString()),void 0!==d.gender&&(e.gender=d.gender),void 0!==d.location&&(e.location=d.location),void 0!==d.categoryId&&(e.categoryId=d.categoryId),void 0!==d.notes&&(e.notes=d.notes),void 0!==d.tags&&(e.tags=d.tags),void 0!==d.socialMedia&&(e.socialMedia=d.socialMedia);let f=await (0,i.updateCustomerAction)(a,e);if(!f.success)throw Error(f.error||"Failed to update customer");c(b=>b.map(b=>b.id===a?{...b,...d}:b)),u.setQueryData(w,b=>b?{...b,customers:b.customers.map(b=>b.id===a?{...b,...d}:b)}:b);let g=b.find(b=>b.id===a);return g&&await t({activityType:"UPDATE",module:"CUSTOMERS",entityType:"customer",entityId:a,entityName:g.fullName,description:`Updated customer "${g.fullName}"`,metadata:{updates:d}}),q({title:"Success",description:"Customer updated successfully"}),!0}catch(a){return console.error("Error updating customer:",a),q({title:"Error",description:"Failed to update customer. Please try again.",variant:"destructive"}),!1}},D=async a=>{try{let d=b.find(b=>b.id===a),e=await (0,i.deleteCustomerAction)(a);if(!e.success)throw Error(e.error||"Failed to delete customer");return c(b=>b.filter(b=>b.id!==a)),p(a=>Math.max(0,a-1)),u.setQueryData(w,b=>{if(!b)return b;let{customers:c,count:d}=b;return{customers:c.filter(b=>b.id!==a),count:Math.max(0,(d||0)-1)}}),u.invalidateQueries({queryKey:w}),d&&await t({activityType:"DELETE",module:"CUSTOMERS",entityType:"customer",entityId:a,entityName:d.fullName,description:`Deleted customer "${d.fullName}"`,metadata:{phoneNumber:d.phoneNumber,email:d.email}}),q({title:"Success",description:"Customer deleted successfully"}),!0}catch(a){return console.error("Error deleting customer:",a),q({title:"Error",description:"Failed to delete customer. Please try again.",variant:"destructive"}),!1}};return{customers:b,isLoading:A,createCustomer:B,addCustomer:B,updateCustomer:C,deleteCustomer:D,loadCustomers:v,page:k,setPage:l,pageSize:m,setPageSize:n,totalCount:o}}]),c()}catch(a){c(a)}},!1),828615,a=>a.a(async(b,c)=>{try{var d=a.i(150848),e=a.i(348287),f=b([d]);async function g(a,b){try{let c=await d.db.message.findMany({where:{userId:a,locationId:b},orderBy:{createdAt:"desc"}});return{success:!0,data:c.map(a=>({id:a.id,userId:a.userId,locationId:a.locationId,profileId:a.profileId,customerId:a.customerId,phoneNumber:a.phoneNumber,content:a.content,status:a.status,smsCreditsUsed:a.smsCreditsUsed,templateId:a.templateId,errorMessage:a.errorMessage,sentAt:a.sentAt?.toISOString(),deliveredAt:a.deliveredAt?.toISOString(),createdAt:a.createdAt.toISOString(),updatedAt:a.updatedAt.toISOString(),metadata:a.metadata}))}}catch(a){return console.error("Error fetching messages:",a),{success:!1,error:a.message}}}async function h(a){try{let b=await d.db.message.create({data:{userId:a.userId,locationId:a.locationId,profileId:a.profileId,customerId:a.customerId,phoneNumber:a.phoneNumber,content:a.content,status:a.status||"pending",smsCreditsUsed:a.smsCreditsUsed||0,templateId:a.templateId,metadata:a.metadata}});return"sent"===b.status&&a.profileId&&await d.db.user.update({where:{id:a.profileId},data:{credits:{decrement:b.smsCreditsUsed}}}),(0,e.revalidatePath)("/messages"),{success:!0,data:b}}catch(a){return console.error("Error creating message:",a),{success:!1,error:a.message}}}async function i(a,b){try{let c=await d.db.messageTemplate.findMany({where:{userId:a,locationId:b},orderBy:{createdAt:"desc"}});return{success:!0,data:c}}catch(a){return console.error("Error fetching message templates:",a),{success:!1,error:a.message}}}async function j(a){try{let b=await d.db.messageTemplate.create({data:{userId:a.userId,locationId:a.locationId,name:a.name,content:a.content,category:a.category,variables:a.variables,isDefault:a.isDefault||!1}});return(0,e.revalidatePath)("/messages"),{success:!0,data:b}}catch(a){return console.error("Error creating message template:",a),{success:!1,error:a.message}}}async function k(a,b){try{let c=await d.db.messageTemplate.update({where:{id:a},data:{name:b.name,content:b.content,category:b.category,variables:b.variables,isDefault:b.isDefault}});return(0,e.revalidatePath)("/messages"),{success:!0,data:c}}catch(a){return console.error("Error updating message template:",a),{success:!1,error:a.message}}}async function l(a){try{return await d.db.messageTemplate.delete({where:{id:a}}),(0,e.revalidatePath)("/messages"),{success:!0}}catch(a){return console.error("Error deleting message template:",a),{success:!1,error:a.message}}}[d]=f.then?(await f)():f,a.s(["createMessageAction",()=>h,"createMessageTemplateAction",()=>j,"deleteMessageTemplateAction",()=>l,"getMessageTemplatesAction",()=>i,"getMessagesAction",()=>g,"updateMessageTemplateAction",()=>k]),c()}catch(a){c(a)}},!1),704500,a=>a.a(async(b,c)=>{try{var d=a.i(127669),e=a.i(964889),f=a.i(805297),g=a.i(500885),h=a.i(108191),i=a.i(828615),j=b([e,f,g,i]);[e,f,g,i]=j.then?(await j)():j,a.s(["useMessages",0,a=>{let[b,c]=(0,d.useState)([]),[j,k]=(0,d.useState)([]),[l,m]=(0,d.useState)([]),[n,o]=(0,d.useState)(0),{currentBusiness:p}=(0,e.useBusiness)(),{currentProfile:q}=(0,f.useProfiles)(),r=(0,g.useQueryClient)(),s=async()=>{q?.sms_credits!==void 0&&o(q.sms_credits)},t=async b=>{if(!a||!p?.id)return null;try{let c=await (0,i.createMessageTemplateAction)({userId:a,locationId:p.id,name:b.name,content:b.content,category:b.category,variables:b.variables,isDefault:b.isDefault});if(c.success&&c.data)return A(),c.data;throw Error(c.error)}catch(a){return console.error("Error creating template:",a),(0,h.toast)({title:"Error",description:"Failed to create template",variant:"destructive"}),null}},u=async(a,b)=>{try{let c=await (0,i.updateMessageTemplateAction)(a,b);if(c.success)A();else throw Error(c.error)}catch(a){console.error("Error updating template:",a),(0,h.toast)({title:"Error",description:"Failed to update template",variant:"destructive"})}},v=async a=>{try{let b=await (0,i.deleteMessageTemplateAction)(a);if(b.success)k(b=>b.filter(b=>b.id!==a));else throw Error(b.error)}catch(a){console.error("Error deleting template:",a),(0,h.toast)({title:"Error",description:"Failed to delete template",variant:"destructive"})}},w=(0,d.useCallback)(async()=>{if(!a||!p?.id)return[];try{let b=await (0,i.getMessagesAction)(a,p.id);if(b.success&&b.data)return b.data;return[]}catch(a){return console.error("Error fetching messages:",a),[]}},[a,p?.id]),x=["messages",a,p?.id],{data:y,isLoading:z}=(0,g.useQuery)({queryKey:x,queryFn:w,enabled:!!a&&!!p?.id});(0,d.useEffect)(()=>{y&&c(y)},[y]);let A=async()=>{if(a&&p?.id)try{let b=await (0,i.getMessageTemplatesAction)(a,p.id);b.success&&b.data&&k(b.data)}catch(a){console.error("Error fetching templates:",a)}},B=async()=>{m([])},C=async b=>{let d;if(!a||!p?.id||!q)return null;let e=(d=b.phoneNumber.replace(/[\s\-\(\)]/g,"")).startsWith("+")?d:d.startsWith("256")?"+"+d:d.startsWith("0")?"+256"+d.substring(1):(9===d.length&&d.match(/^[7]\d{8}$/),"+256"+d),f=Math.ceil(b.content.length/160);if(q.sms_credits<f)return(0,h.toast)({title:"Error",description:"Insufficient credits",variant:"destructive"}),null;try{let d=await (0,i.createMessageAction)({userId:a,locationId:p.id,profileId:q.id,customerId:b.customerId,phoneNumber:e,content:b.content,templateId:b.templateId,smsCreditsUsed:f,status:"sent",metadata:b.metadata});if(d.success&&d.data){let a={...d.data,createdAt:d.data.createdAt.toISOString()};return c(b=>[a,...b]),r.invalidateQueries({queryKey:x}),(0,h.toast)({title:"Success",description:"Message sent successfully"}),a}throw Error(d.error)}catch(a){return console.error("Error sending message:",a),(0,h.toast)({title:"Error",description:"Failed to send message",variant:"destructive"}),null}},D=async a=>{let b=0;for(let c of a.customerIds)b++;return{success:b,failed:0,errors:[]}},E=async(a,b)=>((0,h.toast)({title:"Info",description:"Credit purchase migration in progress"}),null);(0,d.useEffect)(()=>{a&&p?.id&&(A(),B(),s())},[a,p?.id,q?.id]);let F=z&&!y;return{messages:b,templates:j,purchases:l,liveCredits:n,isLoading:F,createMessage:C,createBulkMessages:D,createTemplate:t,updateTemplate:u,deleteTemplate:v,getMessageStats:()=>{let a=b.length,c=b.filter(a=>"sent"===a.status||"delivered"===a.status).length,d=b.filter(a=>"failed"===a.status).length,e=b.filter(a=>"pending"===a.status).length,f=b.reduce((a,b)=>a+b.smsCreditsUsed,0);return{total:a,sent:c,failed:d,pending:e,totalCreditsUsed:f,creditsRemaining:n}},initiateCreditPurchase:E,refresh:()=>{r.invalidateQueries({queryKey:x}),A(),B(),s()}}}]),c()}catch(a){c(a)}},!1)];

//# sourceMappingURL=src_2738199c._.js.map