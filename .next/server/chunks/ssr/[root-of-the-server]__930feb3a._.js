module.exports=[108191,a=>{"use strict";var b=a.i(127669);let c=0,d=new Map,e=a=>{if(d.has(a))return;let b=setTimeout(()=>{d.delete(a),h({type:"REMOVE_TOAST",toastId:a})},1e6);d.set(a,b)},f=[],g={toasts:[]};function h(a){g=((a,b)=>{switch(b.type){case"ADD_TOAST":return{...a,toasts:[b.toast,...a.toasts].slice(0,1)};case"UPDATE_TOAST":return{...a,toasts:a.toasts.map(a=>a.id===b.toast.id?{...a,...b.toast}:a)};case"DISMISS_TOAST":{let{toastId:c}=b;return c?e(c):a.toasts.forEach(a=>{e(a.id)}),{...a,toasts:a.toasts.map(a=>a.id===c||void 0===c?{...a,open:!1}:a)}}case"REMOVE_TOAST":if(void 0===b.toastId)return{...a,toasts:[]};return{...a,toasts:a.toasts.filter(a=>a.id!==b.toastId)}}})(g,a),f.forEach(a=>{a(g)})}function i({...a}){let b=(c=(c+1)%Number.MAX_SAFE_INTEGER).toString(),d=()=>h({type:"DISMISS_TOAST",toastId:b});return h({type:"ADD_TOAST",toast:{...a,id:b,open:!0,onOpenChange:a=>{a||d()}}}),{id:b,dismiss:d,update:a=>h({type:"UPDATE_TOAST",toast:{...a,id:b}})}}function j(){let[a,c]=b.useState(g);return b.useEffect(()=>(f.push(c),()=>{let a=f.indexOf(c);a>-1&&f.splice(a,1)}),[a]),{...a,toast:i,dismiss:a=>h({type:"DISMISS_TOAST",toastId:a})}}a.s(["toast",()=>i,"useToast",()=>j])},204618,a=>a.a(async(b,c)=>{try{var d=a.i(150848),e=a.i(644950),f=b([d,e]);async function g(a){try{return(await d.db.branch.findMany({where:{adminId:a},orderBy:[{createdAt:"desc"},{name:"asc"}]})).map((a,b)=>({id:a.id,name:a.name,user_id:a.adminId,is_default:0===b,created_at:a.createdAt.toISOString(),updated_at:a.updatedAt.toISOString(),switch_password_hash:a.accessPassword}))}catch(a){return console.error("Error fetching business locations:",a),[]}}async function h(a,b){try{let c=await d.db.branch.create({data:{name:b,location:"Main Location",adminId:a}});return{success:!0,data:{id:c.id,name:c.name,user_id:c.adminId,is_default:!1,created_at:c.createdAt.toISOString(),updated_at:c.updatedAt.toISOString(),switch_password_hash:c.accessPassword}}}catch(a){return console.error("Error creating business:",a),{success:!1,error:"Failed to create business"}}}async function i(a,b,c){try{let e=await d.db.branch.update({where:{id:a,adminId:b},data:{name:c}});return{success:!0,data:{id:e.id,name:e.name,user_id:e.adminId,is_default:!1,created_at:e.createdAt.toISOString(),updated_at:e.updatedAt.toISOString(),switch_password_hash:e.accessPassword}}}catch(a){return console.error("Error updating business:",a),{success:!1,error:"Failed to update business"}}}async function j(a,b){try{return await d.db.branch.delete({where:{id:a,adminId:b}}),{success:!0}}catch(a){return console.error("Error deleting business:",a),{success:!1,error:"Failed to delete business"}}}async function k(a,b){try{return await d.db.$transaction(async b=>{await b.productHistory.deleteMany({where:{locationId:a}}),await b.sale.deleteMany({where:{branchId:a}}),await b.product.deleteMany({where:{branchId:a}}),await b.customer.deleteMany({where:{branchId:a}}),await b.activityHistory.deleteMany({where:{branchId:a}})}),{success:!0}}catch(a){return console.error("Error resetting business:",a),{success:!1,error:a.message}}}async function l(a,b){try{let c=await e.default.hash(b,10);return await d.db.branch.update({where:{id:a},data:{accessPassword:c}}),{success:!0}}catch(a){return console.error("Error setting business password:",a),{success:!1,error:a.message}}}async function m(a,b){try{let c=await d.db.branch.findUnique({where:{id:a},select:{accessPassword:!0}});if(!c?.accessPassword)return{success:!0,verified:!0};let f=await e.default.compare(b,c.accessPassword);return{success:!0,verified:f}}catch(a){return console.error("Error verifying business password:",a),{success:!1,verified:!1,error:a.message}}}async function n(a){try{return await d.db.branch.update({where:{id:a},data:{accessPassword:null}}),{success:!0}}catch(a){return console.error("Error removing business password:",a),{success:!1,error:a.message}}}[d,e]=f.then?(await f)():f,a.s(["createBusinessAction",()=>h,"deleteBusinessAction",()=>j,"getBusinessLocationsAction",()=>g,"removeBusinessPasswordAction",()=>n,"resetBusinessAction",()=>k,"setBusinessPasswordAction",()=>l,"updateBusinessAction",()=>i,"verifyBusinessPasswordAction",()=>m]),c()}catch(a){c(a)}},!1),332613,a=>a.a(async(b,c)=>{try{var d=a.i(127669),e=a.i(108191),f=a.i(204618),g=b([f]);[f]=g.then?(await g)():g,a.s(["useBusinessPassword",0,()=>{let[a,b]=(0,d.useState)(!1),{toast:c}=(0,e.useToast)(),g="verified_businesses",h=()=>{try{let a=sessionStorage.getItem(g);return a?new Set(JSON.parse(a)):new Set}catch{return new Set}},i=a=>{try{let b=h();b.add(a),sessionStorage.setItem(g,JSON.stringify(Array.from(b)))}catch(a){console.error("Error storing verified business:",a)}},j=async(a,d)=>{b(!0);try{let b=await (0,f.setBusinessPasswordAction)(a,d);if(b.success)return c({title:"Password Set Successfully",description:"Your business is now password protected."}),!0;return c({title:"Failed to Set Password",description:b.error||"Please try again later.",variant:"destructive"}),!1}catch(a){return console.error("Error setting business password:",a),c({title:"Failed to Set Password",description:"An unexpected error occurred.",variant:"destructive"}),!1}finally{b(!1)}},k=async(a,d)=>{b(!0);try{let b=await (0,f.verifyBusinessPasswordAction)(a,d);if(b.success&&b.verified)return i(a),!0;return c({title:"Incorrect Password",description:"The password you entered is incorrect.",variant:"destructive"}),!1}catch(a){return console.error("Error verifying business password:",a),c({title:"Verification Error",description:"An unexpected error occurred.",variant:"destructive"}),!1}finally{b(!1)}},l=async a=>{b(!0);try{let b=await (0,f.removeBusinessPasswordAction)(a);if(!b.success)return c({title:"Failed to Remove Password",description:b.error||"Please try again later.",variant:"destructive"}),!1;{let b=h();return b.delete(a),sessionStorage.setItem(g,JSON.stringify(Array.from(b))),!0}}catch(a){return console.error("Error removing business password:",a),c({title:"Failed to Remove Password",description:"Please try again later.",variant:"destructive"}),!1}finally{b(!1)}};return{isLoading:a,setBusinessPassword:j,verifyBusinessPassword:k,removeBusinessPassword:l,isBusinessVerified:a=>h().has(a),setBusinessVerified:i,clearVerifiedBusinesses:()=>{try{sessionStorage.removeItem(g)}catch(a){console.error("Error clearing verified businesses:",a)}}}}]),c()}catch(a){c(a)}},!1),964889,a=>a.a(async(b,c)=>{try{a.i(508171);var d=a.i(127669),e=a.i(531811),f=a.i(332613);a.i(108191);var g=a.i(204618),h=b([e,f,g]);[e,f,g]=h.then?(await h)():h;let i=(0,d.createContext)(void 0);a.s(["useBusiness",0,()=>{let a=(0,d.useContext)(i);if(void 0===a)throw Error("useBusiness must be used within a BusinessProvider");return a}]),c()}catch(a){c(a)}},!1),500885,a=>a.a(async(b,c)=>{try{let b=await a.y("@tanstack/react-query-a07b84a9a4b6bf2a");a.n(b),c()}catch(a){c(a)}},!0),709766,a=>a.a(async(b,c)=>{try{var d=a.i(150848),e=b([d]);async function f(a){try{let b=await d.db.branchSettings.findUnique({where:{branchId:a}});if(!b)return null;return{id:b.id,business_name:b.businessName,business_address:b.address,business_phone:b.phone,business_email:b.email,business_logo:b.logo,currency:b.currency,signature:b.signatureImage,metadata:b.metadata||{}}}catch(a){return console.error("Error fetching business settings:",a),null}}async function g(a,b,c){try{if(!await d.db.branch.findFirst({where:{id:a,OR:[{adminId:b},{users:{some:{id:b}}}]}}))return{success:!1,error:"Unauthorized to update branch settings"};let e={businessName:c.business_name,address:c.business_address,phone:c.business_phone,email:c.business_email,logo:c.business_logo,currency:c.currency,signatureImage:c.signature,metadata:c.metadata},f=await d.db.branchSettings.upsert({where:{branchId:a},update:e,create:{branchId:a,...e}});return{success:!0,data:{id:f.id,business_name:f.businessName,business_address:f.address,business_phone:f.phone,business_email:f.email,business_logo:f.logo,currency:f.currency,signature:f.signatureImage,metadata:f.metadata}}}catch(a){return console.error("Error upserting business settings:",a),{success:!1,error:a.message||"Failed to update settings"}}}async function h(a){try{let b=await d.db.user.findUnique({where:{id:a},select:{isFrozen:!0,createdAt:!0,subscriptions:{where:{status:"active"},orderBy:{endDate:"desc"},take:1},branches:{select:{id:!0}}}});if(!b)return null;let c=b.subscriptions[0],e=new Date,f=c?Math.ceil((c.endDate.getTime()-e.getTime())/864e5):0;return{is_frozen:b.isFrozen,location_limit:1,billing_amount:c?Number(c.amount):5e4,billing_duration:"Monthly",days_remaining:Math.max(0,f),next_billing_date:c?.endDate.toISOString()||""}}catch(a){return console.error("Error fetching account status:",a),{is_frozen:!1,location_limit:1,billing_amount:5e4,billing_duration:"Monthly",days_remaining:30,next_billing_date:""}}}async function i(a){try{let b=await d.db.branchSettings.findUnique({where:{branchId:a}});if(!b)return null;return{id:b.id,location_id:b.branchId,business_name:b.businessName,business_address:b.address,business_phone:b.phone,business_email:b.email,business_logo:b.logo,completed:!!b.businessName&&!!b.phone,is_frozen:!1}}catch(a){return console.error("Error fetching onboarding status:",a),null}}[d]=e.then?(await e)():e,a.s(["getAccountStatusAction",()=>h,"getBusinessSettingsAction",()=>f,"getOnboardingStatusAction",()=>i,"upsertBusinessSettingsAction",()=>g]),c()}catch(a){c(a)}},!1),224993,a=>a.a(async(b,c)=>{try{var d=a.i(127669),e=a.i(500885),f=a.i(108191),g=a.i(964889),h=a.i(709766),i=b([e,g,h]);[e,g,h]=i.then?(await i)():i;let j=()=>({businessName:"",businessAddress:"",businessPhone:"",businessEmail:"",currency:"UGX",paymentInfo:"",defaultPrintFormat:"standard"});a.s(["parsePaymentInfo",0,a=>{if(!a||""===a.trim())return[];let b=a.split("\n").filter(a=>""!==a.trim()),c=[];for(let a=0;a<b.length;a+=3)a+2<b.length&&c.push({method:b[a].trim(),accountNumber:b[a+1].trim(),accountName:b[a+2].trim()});return c},"useBusinessSettings",0,()=>{let[a,b]=(0,d.useState)(j()),[c,i]=(0,d.useState)(!1),{toast:k}=(0,f.useToast)(),{currentBusiness:l}=(0,g.useBusiness)(),m=async()=>{if(!l)return j();try{let a=await (0,h.getBusinessSettingsAction)(l.id);if(!a)return j();{let b=a.metadata&&"object"==typeof a.metadata&&a.metadata.payment_info||"";return{id:a.id,businessName:a.business_name||"",businessAddress:a.business_address||"",businessPhone:a.business_phone||"",businessEmail:a.business_email||"",businessLogo:a.business_logo||void 0,currency:a.currency||"UGX",signature:a.signature||void 0,paymentInfo:b,defaultPrintFormat:a.metadata&&"object"==typeof a.metadata&&a.metadata.default_print_format||"standard",defaultPrinterName:a.metadata&&"object"==typeof a.metadata&&a.metadata.default_printer_name||"",defaultPrinterType:a.metadata&&"object"==typeof a.metadata&&a.metadata.default_printer_type||"USB",printerPaperSize:a.metadata&&"object"==typeof a.metadata&&a.metadata.printer_paper_size||"58mm"}}}catch(a){return console.error("Error loading business settings:",a),k({title:"Error",description:"Failed to load business settings. Please try again.",variant:"destructive"}),j()}},n=async b=>{if(!l)return console.error("No business selected for updating settings"),k({title:"Error",description:"No business selected",variant:"destructive"}),!1;try{let c={payment_info:b.hasOwnProperty("paymentInfo")?b.paymentInfo:a.paymentInfo||"",default_print_format:b.hasOwnProperty("defaultPrintFormat")?b.defaultPrintFormat:a.defaultPrintFormat||"standard",default_printer_name:b.hasOwnProperty("defaultPrinterName")?b.defaultPrinterName:a.defaultPrinterName||"",default_printer_type:b.hasOwnProperty("defaultPrinterType")?b.defaultPrinterType:a.defaultPrinterType||"USB",printer_paper_size:b.hasOwnProperty("printerPaperSize")?b.printerPaperSize:a.printerPaperSize||"58mm"},d={business_name:b.hasOwnProperty("businessName")?b.businessName:a.businessName,business_address:b.hasOwnProperty("businessAddress")?b.businessAddress:a.businessAddress,business_phone:b.hasOwnProperty("businessPhone")?b.businessPhone:a.businessPhone,business_email:b.hasOwnProperty("businessEmail")?b.businessEmail:a.businessEmail,business_logo:b.hasOwnProperty("businessLogo")?b.businessLogo:a.businessLogo,currency:b.hasOwnProperty("currency")?b.currency:a.currency,signature:b.hasOwnProperty("signature")?b.signature:a.signature,metadata:c},e=await (0,h.upsertBusinessSettingsAction)(l.id,"00000000-0000-0000-0000-000000000000",d);if(!e.success)throw console.error("Supabase error updating business settings:",e.error),Error(e.error);return k({title:"Success",description:"Business settings updated successfully"}),r(),!0}catch(a){return console.error("Error updating business settings:",a),k({title:"Error",description:"Failed to update business settings. Please try again.",variant:"destructive"}),!1}},{data:o,isLoading:p,isFetching:q,refetch:r}=(0,e.useQuery)({queryKey:["businessSettings",l?.id],queryFn:m,enabled:!!l?.id,staleTime:3e5,gcTime:18e5,refetchOnWindowFocus:!1,refetchOnReconnect:!1});return(0,d.useEffect)(()=>{o?b(o):l||b(j())},[o,l]),(0,d.useEffect)(()=>{i(p||q)},[p,q]),{settings:a,isLoading:c,updateSettings:n,loadSettings:m}}]),c()}catch(a){c(a)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__930feb3a._.js.map