{"version":3,"sources":["../../../../src/hooks/useSaleDraft.ts","../../../../src/hooks/useNewSaleDraft.ts","../../../../src/hooks/useSaleProductSelection.ts","../../../../src/hooks/useNewSaleActions.ts","../../../../src/components/sales/NewSaleLoadingState.tsx","../../../../src/components/sales/NewSaleNoBusinessState.tsx","../../../../src/components/sales/NewSaleAuthWarning.tsx","../../../../src/utils/generateReceiptNumber.ts","../../../../src/hooks/sale-form/useFormState.ts","../../../../src/hooks/sale-form/useFormHandlers.ts","../../../../src/hooks/sale-form/useItemManagement.ts","../../../../src/hooks/sale-form/useCustomerSelection.ts","../../../../src/hooks/sale-form/useFormValidation.ts","../../../../src/hooks/sale-form/useFormCalculations.ts","../../../../src/hooks/useLocalPaymentChanges.ts","../../../../src/hooks/sale-form/usePaymentOperations.ts","../../../../src/hooks/useSaleFormLogic.ts","../../../../src/hooks/useCashTransactionOperations.ts","../../../../node_modules/lucide-react/src/icons/rotate-ccw.ts","../../../../src/components/sales/SaleDatePicker.tsx","../../../../src/hooks/useCustomerCategories.ts","../../../../src/components/sales/CustomerInformation.tsx","../../../../src/components/sales/SaleFormHeader.tsx","../../../../node_modules/lucide-react/src/icons/eraser.ts","../../../../src/components/ui/collapsible.tsx","../../../../src/components/ProductSaleItemInput.tsx","../../../../src/components/sales/SaleItems.tsx","../../../../src/components/sales/TaxRateInput.tsx","../../../../src/components/sales/SaleTotals.tsx","../../../../src/components/sales/SaleItemsManager.tsx","../../../../src/components/sales/PaymentStatusSelector.tsx","../../../../node_modules/lucide-react/src/icons/pen-line.ts","../../../../node_modules/lucide-react/src/icons/link.ts","../../../../src/components/sales/InstallmentPaymentHistory.tsx","../../../../src/components/sales/InstallmentPaymentInput.tsx","../../../../src/components/sales/CashAccountSelection.tsx","../../../../src/components/sales/SaleCategorySelector.tsx","../../../../src/components/sales/SalePaymentSection.tsx","../../../../src/components/sales/SaleFormActions.tsx","../../../../src/components/SalesForm.tsx","../../../../src/components/customers/CustomerForm.tsx","../../../../src/components/customers/NewCustomerDialog.tsx","../../../../src/components/sales/DraftNotification.tsx","../../../../src/components/sales/NewSaleContent.tsx","../../../../src/pages/NewSale.tsx","../../../../node_modules/next/src/build/templates/pages.ts"],"sourcesContent":["import { useState, useEffect, useCallback, useMemo } from 'react';\r\nimport { SaleFormData } from '@/types';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\n\r\nexport const useSaleDraft = () => {\r\n  const [hasDraft, setHasDraft] = useState(false);\r\n  const { currentBusiness } = useBusiness();\r\n\r\n  const DRAFT_STORAGE_KEY = useMemo(() =>\r\n    currentBusiness?.id ? `sale_draft_${currentBusiness.id}` : 'sale_draft'\r\n    , [currentBusiness?.id]);\r\n\r\n  // Check if draft exists\r\n  const checkForDraft = useCallback(() => {\r\n    const draft = localStorage.getItem(DRAFT_STORAGE_KEY);\r\n    const draftExists = !!draft;\r\n    setHasDraft(draftExists);\r\n    return draftExists;\r\n  }, [DRAFT_STORAGE_KEY]);\r\n\r\n  // Check for draft on mount and when business changes\r\n  useEffect(() => {\r\n    if (currentBusiness?.id) {\r\n      checkForDraft();\r\n    }\r\n  }, [checkForDraft, currentBusiness?.id]);\r\n\r\n  const saveDraft = useCallback((formData: SaleFormData, selectedDate: Date) => {\r\n    if (!currentBusiness?.id) return;\r\n\r\n    const draftData = {\r\n      formData,\r\n      selectedDate: selectedDate.toISOString(),\r\n      savedAt: new Date().toISOString()\r\n    };\r\n\r\n    localStorage.setItem(DRAFT_STORAGE_KEY, JSON.stringify(draftData));\r\n    setHasDraft(true);\r\n  }, [DRAFT_STORAGE_KEY, currentBusiness?.id]);\r\n\r\n  const loadDraft = useCallback(() => {\r\n    const draft = localStorage.getItem(DRAFT_STORAGE_KEY);\r\n    if (draft) {\r\n      try {\r\n        const parsedDraft = JSON.parse(draft);\r\n        return {\r\n          formData: parsedDraft.formData,\r\n          selectedDate: new Date(parsedDraft.selectedDate),\r\n          savedAt: new Date(parsedDraft.savedAt)\r\n        };\r\n      } catch (error) {\r\n        console.error('Error parsing draft:', error);\r\n        localStorage.removeItem(DRAFT_STORAGE_KEY);\r\n        setHasDraft(false);\r\n        return null;\r\n      }\r\n    }\r\n    return null;\r\n  }, [DRAFT_STORAGE_KEY]);\r\n\r\n  const clearDraft = useCallback(() => {\r\n    localStorage.removeItem(DRAFT_STORAGE_KEY);\r\n    setHasDraft(false);\r\n  }, [DRAFT_STORAGE_KEY]);\r\n\r\n  return {\r\n    hasDraft,\r\n    saveDraft,\r\n    loadDraft,\r\n    clearDraft,\r\n    checkForDraft\r\n  };\r\n};\r\n","import { useEffect, useState } from 'react';\r\nimport { useSaleDraft } from '@/hooks/useSaleDraft';\r\nimport { Sale } from '@/types';\r\n\r\nexport const useNewSaleDraft = (editSale?: Sale) => {\r\n  const [showDraftNotification, setShowDraftNotification] = useState(false);\r\n  const [draftData, setDraftData] = useState<any>(null);\r\n\r\n  const { hasDraft, loadDraft, clearDraft, checkForDraft } = useSaleDraft();\r\n\r\n  // Automatically load draft on component mount\r\n  useEffect(() => {\r\n    if (!editSale) {\r\n      const loadDraftAutomatically = () => {\r\n        if (checkForDraft()) {\r\n          const draft = loadDraft();\r\n          if (draft) {\r\n            setDraftData(draft);\r\n          }\r\n        }\r\n      };\r\n\r\n      // Load immediately\r\n      loadDraftAutomatically();\r\n    }\r\n  }, [editSale, checkForDraft, loadDraft]);\r\n\r\n  const handleLoadDraft = () => {\r\n    // Clear the draft data after it's been loaded into the form\r\n    setDraftData(null);\r\n  };\r\n\r\n  const handleDismissDraft = () => {\r\n    clearDraft();\r\n    setShowDraftNotification(false);\r\n    setDraftData(null);\r\n  };\r\n\r\n  return {\r\n    showDraftNotification: false, // Always false for seamless auto-loading\r\n    draftData,\r\n    handleLoadDraft,\r\n    handleDismissDraft,\r\n    clearDraft\r\n  };\r\n};","import { useState } from 'react';\r\nimport { Product, SaleItem } from '@/types';\r\nimport { useProducts } from './useProducts';\r\nimport { useInventoryActions } from './useInventoryActions';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\n\r\nexport const useSaleProductSelection = (userId: string | undefined) => {\r\n  const { products } = useProducts(userId);\r\n  const { currentBusiness } = useBusiness();\r\n  const { deductStockForSale, adjustStockForEditedSale } = useInventoryActions(userId);\r\n  const [selectedProducts, setSelectedProducts] = useState<Record<string, string | null>>({});\r\n\r\n  const selectProduct = (itemIndex: number, productId: string | null) => {\r\n    setSelectedProducts(prev => ({\r\n      ...prev,\r\n      [itemIndex]: productId\r\n    }));\r\n  };\r\n\r\n  const getProductForItem = (itemIndex: number): Product | null => {\r\n    const productId = selectedProducts[itemIndex];\r\n    if (!productId) return null;\r\n\r\n    return products.find(p => p.id === productId) || null;\r\n  };\r\n\r\n  const updateInventoryForSale = async (\r\n    items: SaleItem[],\r\n    paymentStatus?: string,\r\n    saleDate?: Date,\r\n    saleId?: string,\r\n    receiptNumber?: string\r\n  ) => {\r\n    // Only skip inventory if still a quote\r\n    if (paymentStatus === 'Quote') return true;\r\n\r\n    return deductStockForSale(items, saleId, saleDate, receiptNumber, currentBusiness?.id);\r\n  };\r\n\r\n\r\n  const updateInventoryForEditedSale = async (\r\n    originalItems: SaleItem[],\r\n    newItems: SaleItem[],\r\n    newStatus?: string,\r\n    saleDate?: Date,\r\n    saleId?: string,\r\n    receiptNumber?: string,\r\n    originalStatus?: string\r\n  ) => {\r\n    // Determine if we should add back original items and deduct new items\r\n    const shouldRestoreOriginal = originalStatus !== 'Quote';\r\n    const shouldDeductNew = newStatus !== 'Quote';\r\n\r\n    // If neither status affects inventory, we can skip\r\n    if (!shouldRestoreOriginal && !shouldDeductNew) return true;\r\n\r\n    // Filter lists based on status. \r\n    // If original was Quote, we DO NOT restore (empty list).\r\n    // If new is Quote, we DO NOT deduct (empty list).\r\n    const itemsToRestore = shouldRestoreOriginal ? originalItems : [];\r\n    const itemsToDeduct = shouldDeductNew ? newItems : [];\r\n\r\n    return adjustStockForEditedSale(itemsToRestore, itemsToDeduct, saleId, saleDate, receiptNumber, currentBusiness?.id);\r\n  };\r\n\r\n  return {\r\n    products,\r\n    selectedProducts,\r\n    selectProduct,\r\n    getProductForItem,\r\n    updateInventoryForSale,\r\n    updateInventoryForEditedSale\r\n  };\r\n};\r\n","import { useState, useCallback } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { useAuth } from '@/components/auth/AuthProvider';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { useCustomers, Customer } from '@/hooks/useCustomers';\r\nimport { useSalesData } from '@/hooks/useSalesData';\r\nimport { useSaleProductSelection } from '@/hooks/useSaleProductSelection';\r\nimport { Sale } from '@/types';\r\nimport { toast } from 'sonner';\r\nimport { useActivityLogger } from '@/hooks/useActivityLogger';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\nimport { generateThermalReceipt } from '@/utils/generateThermalReceipt';\r\nimport { print } from '@/utils/thermalPrinterPlug';\r\nimport { useBusinessSettings } from '@/hooks/useBusinessSettings';\r\nimport { getCustomerByNameAction, updateSaleCustomerAction, deleteSaleAction } from '@/app/actions/sales';\r\n\r\nexport const useNewSaleActions = (editSale?: Sale, onSaveSuccess?: () => void) => {\r\n  const router = useRouter();\r\n  const { user } = useAuth();\r\n  const { toast: uiToast } = useToast();\r\n  const { customers, createCustomer } = useCustomers();\r\n  const { addSale, updateSale } = useSalesData(user?.id);\r\n  const { updateInventoryForSale, updateInventoryForEditedSale } = useSaleProductSelection(user?.id);\r\n  const { logActivity } = useActivityLogger();\r\n  const { currentBusiness } = useBusiness();\r\n  const { settings } = useBusinessSettings();\r\n\r\n  const [isReceiptOpen, setIsReceiptOpen] = useState(false);\r\n  const [completedSale, setCompletedSale] = useState<Sale | null>(null);\r\n  const [newCustomerDialogOpen, setNewCustomerDialogOpen] = useState(false);\r\n  const [includePaymentInfo, setIncludePaymentInfo] = useState(true);\r\n\r\n  const handleSaleComplete = useCallback(async (\r\n    sale: Sale,\r\n    showReceipt: boolean = false,\r\n    includePaymentInfo: boolean = true,\r\n    selectedCategoryId?: string,\r\n    clearDraft?: () => void,\r\n    saleDate?: Date,\r\n    thermalPrintAfterSave: boolean = false\r\n  ) => {\r\n    // Clear draft when sale is completed\r\n    if (!editSale && clearDraft) {\r\n      clearDraft();\r\n    }\r\n\r\n    // Only save customer to customers database if they don't exist already\r\n    if (user?.id && sale.customerName.trim()) {\r\n      let customerId = sale.customerId;\r\n\r\n      // If no customerId provided, check if customer already exists by name\r\n      if (!customerId) {\r\n        const existingCustomer = await getCustomerByNameAction(\r\n          currentBusiness?.id || '',\r\n          sale.customerName.trim()\r\n        );\r\n\r\n        if (existingCustomer) {\r\n          customerId = existingCustomer.id;\r\n        } else {\r\n          try {\r\n            const newCustomer = await createCustomer({\r\n              fullName: sale.customerName,\r\n              phoneNumber: sale.customerContact || null,\r\n              location: sale.customerAddress || null,\r\n              email: null,\r\n              birthday: null,\r\n              gender: null,\r\n              categoryId: selectedCategoryId || null,\r\n              notes: null,\r\n              tags: null,\r\n              socialMedia: null\r\n            });\r\n            if (newCustomer) {\r\n              customerId = newCustomer.id;\r\n              toast.success(`Added ${sale.customerName} to your customers list`);\r\n            }\r\n          } catch (error) {\r\n            console.error('Error adding customer:', error);\r\n          }\r\n        }\r\n      }\r\n\r\n      if (customerId && sale.id) {\r\n        try {\r\n          await updateSaleCustomerAction(sale.id, customerId);\r\n        } catch (error) {\r\n          console.error('Error associating sale with customer:', error);\r\n        }\r\n      }\r\n    }\r\n\r\n    // Update inventory for sale (new or edit)\r\n    let inventorySuccess = false;\r\n    if (editSale) {\r\n      // For edits, restore original items and subtract new ones\r\n      inventorySuccess = await updateInventoryForEditedSale(editSale.items, sale.items, sale.paymentStatus, undefined, sale.id, sale.receiptNumber, editSale.paymentStatus);\r\n    } else {\r\n      // For new sale, subtract sold items\r\n      // Use provided saleDate or undefined (which defaults to current time in updateInventoryForSale)\r\n      inventorySuccess = await updateInventoryForSale(sale.items, sale.paymentStatus, saleDate, sale.id, sale.receiptNumber);\r\n    }\r\n\r\n    if (!inventorySuccess) {\r\n      console.error('Inventory update failed. Initiating rollback...');\r\n\r\n      // ROLLBACK STRATEGY\r\n      if (!editSale) {\r\n        const rollbackSuccess = await deleteSaleAction(sale.id);\r\n        if (!rollbackSuccess) {\r\n          console.error('CRITICAL: Failed to rollback sale after inventory failure');\r\n          uiToast({\r\n            title: \"Critical Error\",\r\n            description: \"Inventory failed to update, and we could not cancel the sale. Please contact support.\",\r\n            variant: \"destructive\"\r\n          });\r\n        } else {\r\n          uiToast({\r\n            title: \"Sale Cancelled\",\r\n            description: \"Inventory update failed, so the sale was cancelled to ensure data consistency.\",\r\n            variant: \"destructive\"\r\n          });\r\n        }\r\n      } else {\r\n        // If it was an edit, we might want to revert the sale changes in the database\r\n        // For now, we just warn the user that inventory wasn't updated\r\n        uiToast({\r\n          title: \"Inventory Update Failed\",\r\n          description: \"The sale was saved, but inventory could not be updated. Please check stock levels manually.\",\r\n          variant: \"destructive\"\r\n        });\r\n        // Ideally we would revert the DB update here too, but that requires passing the original DB state\r\n      }\r\n\r\n      // STOP PROCESSING\r\n      throw new Error('Inventory update failed');\r\n    }\r\n\r\n    // Calculate total amount from items for accurate logging\r\n    const itemsTotal = sale.items.reduce((sum, item) => {\r\n      const itemTotal = item.price * item.quantity;\r\n      const discountAmount = item.discountType === 'amount'\r\n        ? (item.discountAmount || 0)\r\n        : (itemTotal * (item.discountPercentage || 0) / 100);\r\n      return sum + (itemTotal - discountAmount);\r\n    }, 0);\r\n\r\n    const taxAmount = sale.taxRate ? (itemsTotal * sale.taxRate / 100) : 0;\r\n    const grandTotal = itemsTotal + taxAmount;\r\n\r\n    // Log activity with comprehensive details\r\n    await logActivity({\r\n      activityType: editSale ? 'UPDATE' : 'CREATE',\r\n      module: 'SALES',\r\n      entityType: 'sale',\r\n      entityId: sale.id,\r\n      entityName: `Sale #${sale.receiptNumber}`,\r\n      description: `${editSale ? 'Updated' : 'Created'} sale for ${sale.customerName} - Total: UGX ${grandTotal.toLocaleString()}`,\r\n      metadata: {\r\n        receiptNumber: sale.receiptNumber,\r\n        customerName: sale.customerName,\r\n        customerAddress: sale.customerAddress,\r\n        customerContact: sale.customerContact,\r\n        totalAmount: grandTotal,\r\n        amountPaid: sale.amountPaid,\r\n        profit: sale.profit,\r\n        paymentStatus: sale.paymentStatus,\r\n        taxRate: sale.taxRate,\r\n        itemCount: sale.items.length,\r\n        items: sale.items.map(item => ({\r\n          description: item.description,\r\n          quantity: item.quantity,\r\n          price: item.price,\r\n          cost: item.cost,\r\n          total: item.quantity * item.price,\r\n          discountPercentage: item.discountPercentage,\r\n          discountAmount: item.discountAmount\r\n        })),\r\n        notes: sale.notes\r\n      }\r\n    });\r\n\r\n    uiToast({\r\n      title: editSale ? \"Sale Updated\" : \"Sale Created\",\r\n      description: `${editSale ? \"Updated\" : \"Created\"} sale for ${sale.customerName}. ${sale.paymentStatus === 'NOT PAID' ? 'Inventory has been updated for this credit sale.' : ''}`,\r\n    });\r\n\r\n    // Clear sold items cache to force refresh\r\n    const keys = Object.keys(localStorage);\r\n    keys.forEach(key => {\r\n      if (key.startsWith('soldItems_')) {\r\n        localStorage.removeItem(key);\r\n      }\r\n    });\r\n\r\n    // Store the completed sale\r\n    setCompletedSale(sale);\r\n\r\n    // ⚡️ INSTANT UPDATE: Add/update sale in cache immediately (like your campaign example)\r\n    if (editSale) {\r\n      updateSale(sale);\r\n    } else {\r\n      addSale(sale);\r\n    }\r\n\r\n    // Store payment info preference\r\n    setIncludePaymentInfo(includePaymentInfo);\r\n\r\n    // Show receipt dialog if requested\r\n    if (showReceipt) {\r\n      setIsReceiptOpen(true);\r\n\r\n      // If thermal auto-print is enabled, trigger it\r\n      if (thermalPrintAfterSave) {\r\n        try {\r\n          const thermalData = await generateThermalReceipt(sale, settings);\r\n          await print(thermalData, settings.defaultPrinterName);\r\n        } catch (printErr) {\r\n          console.error('Auto-print failed:', printErr);\r\n          toast.error('Automated thermal printing failed');\r\n        }\r\n      }\r\n    } else {\r\n      // If it's a new sale and we have a success callback, use it (to clear form)\r\n      // Otherwise navigate to sales list\r\n      if (!editSale && onSaveSuccess) {\r\n        onSaveSuccess();\r\n      } else {\r\n        router.push('/sales');\r\n      }\r\n    }\r\n  }, [user?.id, createCustomer, editSale, uiToast, router, logActivity, addSale, updateSale, onSaveSuccess]);\r\n\r\n  const handleReceiptClose = useCallback(() => {\r\n    setIsReceiptOpen(false);\r\n    // If it's a new sale and we have a success callback, use it (to clear form)\r\n    // Otherwise navigate to sales list\r\n    if (!editSale && onSaveSuccess) {\r\n      onSaveSuccess();\r\n    } else {\r\n      router.push('/sales');\r\n    }\r\n  }, [router, editSale, onSaveSuccess]);\r\n\r\n  const handleAddCustomer = useCallback(async (customerData: Omit<Customer, 'id' | 'createdAt' | 'updatedAt'>) => {\r\n    if (!user?.id) return false;\r\n    try {\r\n      const newCustomer = await createCustomer(customerData);\r\n      if (newCustomer) {\r\n        setNewCustomerDialogOpen(false);\r\n        return true;\r\n      }\r\n      return false;\r\n    } catch (error) {\r\n      console.error('Error adding customer:', error);\r\n      return false;\r\n    }\r\n  }, [user?.id, createCustomer]);\r\n\r\n  const handleOpenNewCustomerDialog = useCallback(() => {\r\n    setNewCustomerDialogOpen(true);\r\n  }, []);\r\n\r\n  return {\r\n    isReceiptOpen,\r\n    completedSale,\r\n    newCustomerDialogOpen,\r\n    includePaymentInfo,\r\n    customers,\r\n    handleSaleComplete,\r\n    handleReceiptClose,\r\n    handleAddCustomer,\r\n    handleOpenNewCustomerDialog,\r\n    setNewCustomerDialogOpen\r\n  };\r\n};","import React from 'react';\r\n\r\n\r\nconst NewSaleLoadingState: React.FC = () => {\r\n  return (\r\n    <div className=\"max-w-4xl mx-auto p-6\">\r\n      <div className=\"animate-pulse\">\r\n        <div className=\"h-8 bg-gray-200 rounded w-48 mb-4\"></div>\r\n        <div className=\"h-64 bg-gray-200 rounded\"></div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default NewSaleLoadingState;","import React from 'react';\r\nimport { useRouter } from 'next/navigation';\r\n\r\nconst NewSaleNoBusinessState: React.FC = () => {\r\n  const router = useRouter();\r\n\r\n  return (\r\n    <div className=\"max-w-4xl mx-auto p-6\">\r\n      <div className=\"bg-amber-50 border border-amber-200 p-4 rounded-md\">\r\n        <p className=\"text-amber-800 mb-4\">\r\n          No business location found. Please create a business location to manage sales.\r\n        </p>\r\n        <button\r\n          onClick={() => router.push('/business-management')}\r\n          className=\"bg-amber-600 text-white px-4 py-2 rounded hover:bg-amber-700\"\r\n        >\r\n          Manage Business Locations\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default NewSaleNoBusinessState;","import React from 'react';\r\n\r\nconst NewSaleAuthWarning: React.FC = () => {\r\n  return (\r\n    <div className=\"bg-amber-50 border border-amber-200 p-4 rounded-md mb-6\">\r\n      <p className=\"text-amber-800\">\r\n        You need to be signed in to create or edit sales. All sales are saved to your Supabase database.\r\n      </p>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default NewSaleAuthWarning;","import { getNextReceiptNumberAction } from '@/app/actions/inventory';\r\n\r\n/**\r\n * Generate a sequential receipt number using Prisma action.\r\n */\r\nexport const generateReceiptNumber = async (locationId?: string): Promise<string> => {\r\n  try {\r\n    if (!locationId) {\r\n      console.error('Location ID is required for receipt number generation');\r\n      return '000001';\r\n    }\r\n\r\n    const result = await getNextReceiptNumberAction(locationId);\r\n\r\n    if (result.success && result.data) {\r\n      return result.data;\r\n    }\r\n\r\n    console.error('Error generating receipt number:', result.error);\r\n    return '000001';\r\n  } catch (error) {\r\n    console.error('Error generating receipt number:', error);\r\n    return '000001';\r\n  }\r\n};\r\n","import { useState, useCallback, useEffect } from 'react';\r\nimport { SaleFormData, FormErrors, SaleItem } from '@/types';\r\n\r\nconst emptyItem: SaleItem = {\r\n  description: '',\r\n  quantity: 1,\r\n  price: 0,\r\n  cost: 0,\r\n};\r\n\r\ninterface UseFormStateProps {\r\n  initialData?: any;\r\n  defaultPaymentStatus: string;\r\n}\r\n\r\nexport const useFormState = ({ initialData, defaultPaymentStatus }: UseFormStateProps) => {\r\n  const [formData, setFormData] = useState<SaleFormData>({\r\n    customerName: initialData?.customerName || '',\r\n    customerAddress: initialData?.customerAddress || '',\r\n    customerContact: initialData?.customerContact || '',\r\n    customerId: initialData?.customerId || '', // Added customerId\r\n    items: initialData?.items || [{ ...emptyItem }],\r\n    paymentStatus: defaultPaymentStatus as 'Paid' | 'NOT PAID' | 'Quote' | 'Installment Sale',\r\n    taxRate: initialData?.taxRate || 0,\r\n    amountPaid: (initialData && initialData.paymentStatus === 'Installment Sale') ? 0 : (initialData?.amountPaid || 0),\r\n    amountDue: initialData?.amountDue || 0,\r\n    notes: initialData?.notes || '',\r\n    categoryId: initialData?.categoryId || ''\r\n  });\r\n\r\n  const [errors, setErrors] = useState<FormErrors>({});\r\n  const [taxRateInput, setTaxRateInput] = useState<string>(\r\n    initialData?.taxRate ? initialData.taxRate.toString() : ''\r\n  );\r\n  const [printAfterSave, setPrintAfterSave] = useState<boolean>(true);\r\n  const [thermalPrintAfterSave, setThermalPrintAfterSave] = useState<boolean>(false);\r\n  const [includePaymentInfo, setIncludePaymentInfo] = useState<boolean>(true);\r\n  const [selectedCustomerCategoryId, setSelectedCustomerCategoryId] = useState<string>('');\r\n  const [paymentDate, setPaymentDate] = useState<Date>(new Date());\r\n\r\n  // Cash account integration states\r\n  const [linkToCash, setLinkToCash] = useState<boolean>(false);\r\n  const [selectedCashAccountId, setSelectedCashAccountId] = useState<string>('');\r\n  const [cashTransactionId, setCashTransactionId] = useState<string | null>(null);\r\n  const [originalPaymentStatus, setOriginalPaymentStatus] = useState<string>(defaultPaymentStatus);\r\n  const [formRecentlyCleared, setFormRecentlyCleared] = useState<boolean>(false);\r\n\r\n  const clearFormState = useCallback((onDateReset?: () => void) => {\r\n    setFormData({\r\n      customerName: '',\r\n      customerAddress: '',\r\n      customerContact: '',\r\n      customerId: '', // Clear customerId\r\n      items: [{ ...emptyItem }],\r\n      paymentStatus: defaultPaymentStatus as 'Paid' | 'NOT PAID' | 'Quote' | 'Installment Sale',\r\n      taxRate: 0,\r\n      amountPaid: 0,\r\n      amountDue: 0,\r\n      notes: '',\r\n      categoryId: ''\r\n    });\r\n    setTaxRateInput('');\r\n    setSelectedCustomerCategoryId('');\r\n    setPaymentDate(new Date());\r\n    setLinkToCash(false);\r\n    setErrors({});\r\n    setFormRecentlyCleared(true);\r\n    if (onDateReset) {\r\n      onDateReset();\r\n    }\r\n  }, [defaultPaymentStatus]);\r\n\r\n  // Sync with initialData if it arrives late or changes\r\n  useEffect(() => {\r\n    if (initialData) {\r\n      setFormData(prev => ({\r\n        ...prev,\r\n        customerName: initialData.customerName || prev.customerName,\r\n        customerAddress: initialData.customerAddress || prev.customerAddress,\r\n        customerContact: initialData.customerContact || prev.customerContact,\r\n        customerId: initialData.customerId || prev.customerId,\r\n        // Only override items if we have them in initialData and current items are empty/default\r\n        items: (initialData.items && initialData.items.length > 0) ? initialData.items : prev.items,\r\n        // Ensure payment status syncs\r\n        paymentStatus: (initialData.paymentStatus as 'Paid' | 'NOT PAID' | 'Quote' | 'Installment Sale') || prev.paymentStatus,\r\n        taxRate: initialData.taxRate !== undefined ? initialData.taxRate : prev.taxRate,\r\n        amountPaid: initialData.amountPaid !== undefined ? initialData.amountPaid : prev.amountPaid,\r\n        amountDue: initialData.amountDue !== undefined ? initialData.amountDue : prev.amountDue,\r\n        notes: initialData.notes || prev.notes,\r\n        categoryId: initialData.categoryId || prev.categoryId // Sync Category ID\r\n      }));\r\n\r\n      if (initialData.categoryId) {\r\n        // Also ensure formRecentlyCleared doesn't block it\r\n        setFormRecentlyCleared(false);\r\n      }\r\n\r\n      // Update tax rate input too\r\n      if (initialData.taxRate !== undefined) {\r\n        setTaxRateInput(initialData.taxRate.toString());\r\n      }\r\n    }\r\n  }, [initialData]);\r\n\r\n  return {\r\n    // State\r\n    formData,\r\n    errors,\r\n    taxRateInput,\r\n    printAfterSave,\r\n    thermalPrintAfterSave,\r\n    includePaymentInfo,\r\n    selectedCustomerCategoryId,\r\n    paymentDate,\r\n    linkToCash,\r\n    selectedCashAccountId,\r\n    cashTransactionId,\r\n    originalPaymentStatus,\r\n    formRecentlyCleared,\r\n\r\n    // Setters\r\n    setFormData,\r\n    setErrors,\r\n    setTaxRateInput,\r\n    setPrintAfterSave,\r\n    setThermalPrintAfterSave,\r\n    setIncludePaymentInfo,\r\n    setSelectedCustomerCategoryId,\r\n    setPaymentDate,\r\n    setLinkToCash,\r\n    setSelectedCashAccountId,\r\n    setCashTransactionId,\r\n    setOriginalPaymentStatus,\r\n    setFormRecentlyCleared,\r\n\r\n    // Actions\r\n    clearFormState,\r\n  };\r\n};","import { useCallback } from 'react';\r\nimport { SaleFormData, FormErrors } from '@/types';\r\n\r\ninterface UseFormHandlersProps {\r\n  formData: SaleFormData;\r\n  setFormData: React.Dispatch<React.SetStateAction<SaleFormData>>;\r\n  errors: FormErrors;\r\n  setErrors: React.Dispatch<React.SetStateAction<FormErrors>>;\r\n  setTaxRateInput: React.Dispatch<React.SetStateAction<string>>;\r\n  setLinkToCash: React.Dispatch<React.SetStateAction<boolean>>;\r\n}\r\n\r\nexport const useFormHandlers = ({\r\n  formData,\r\n  setFormData,\r\n  errors,\r\n  setErrors,\r\n  setTaxRateInput,\r\n  setLinkToCash,\r\n}: UseFormHandlersProps) => {\r\n  const handleChange = useCallback((e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {\r\n    const { name, value } = e.target;\r\n\r\n    if (name === 'taxRate') {\r\n      setTaxRateInput(value);\r\n      const normalizedValue = value.replace(/,/g, '');\r\n      const numValue = normalizedValue === '' ? 0 : parseFloat(normalizedValue);\r\n      setFormData(prev => ({ ...prev, taxRate: isNaN(numValue) ? 0 : numValue }));\r\n    } else {\r\n      setFormData(prev => ({ ...prev, [name]: value }));\r\n    }\r\n\r\n    if (errors[name as keyof FormErrors]) {\r\n      setErrors(prev => ({ ...prev, [name]: undefined }));\r\n    }\r\n  }, [errors, setFormData, setErrors, setTaxRateInput]);\r\n\r\n  const handleSelectChange = useCallback((value: string) => {\r\n    const newPaymentStatus = value as 'Paid' | 'NOT PAID' | 'Quote' | 'Installment Sale';\r\n    setFormData(prev => ({ ...prev, paymentStatus: newPaymentStatus }));\r\n\r\n    if (value !== 'Paid' && value !== 'Installment Sale') {\r\n      setLinkToCash(false);\r\n    }\r\n\r\n    if (value !== 'Installment Sale') {\r\n      setFormData(prev => ({\r\n        ...prev,\r\n        paymentStatus: newPaymentStatus,\r\n        amountPaid: 0,\r\n        amountDue: 0\r\n      }));\r\n    }\r\n  }, [setFormData, setLinkToCash]);\r\n\r\n  const handleAmountPaidChange = useCallback((amount: number, grandTotal: number) => {\r\n    const amountDue = Math.max(0, grandTotal - amount);\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      amountPaid: amount,\r\n      amountDue: amountDue,\r\n    }));\r\n  }, [setFormData]);\r\n\r\n  const handlePaymentDateChange = useCallback((date: Date) => {\r\n    // This will be handled by the parent component's setPaymentDate\r\n  }, []);\r\n\r\n  return {\r\n    handleChange,\r\n    handleSelectChange,\r\n    handleAmountPaidChange,\r\n    handlePaymentDateChange,\r\n  };\r\n};","import { useCallback } from 'react';\r\nimport { SaleFormData, SaleItem } from '@/types';\r\n\r\nconst emptyItem: SaleItem = {\r\n  description: '',\r\n  quantity: 1,\r\n  price: 0,\r\n  cost: 0,\r\n};\r\n\r\ninterface UseItemManagementProps {\r\n  formData: SaleFormData;\r\n  setFormData: React.Dispatch<React.SetStateAction<SaleFormData>>;\r\n}\r\n\r\nexport const useItemManagement = ({ formData, setFormData }: UseItemManagementProps) => {\r\n  const handleAddItem = useCallback(() => {\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      items: [...prev.items, { ...emptyItem }]\r\n    }));\r\n  }, [setFormData]);\r\n\r\n  const handleAddItemWithProduct = useCallback((product: any) => {\r\n    setFormData(prev => {\r\n      // Check if product already exists in items\r\n      const existingItemIndex = prev.items.findIndex(item => item.productId === product.id);\r\n\r\n      if (existingItemIndex !== -1) {\r\n        const newItems = [...prev.items];\r\n        newItems[existingItemIndex] = {\r\n          ...newItems[existingItemIndex],\r\n          quantity: newItems[existingItemIndex].quantity + 1\r\n        };\r\n        return { ...prev, items: newItems };\r\n      }\r\n\r\n      const newItem: SaleItem = {\r\n        productId: product.id,\r\n        description: product.name,\r\n        quantity: 1,\r\n        price: product.sellingPrice,\r\n        cost: product.costPrice,\r\n      };\r\n\r\n      // If the first item is empty, replace it\r\n      if (prev.items.length === 1 && !prev.items[0].description && !prev.items[0].productId) {\r\n        return { ...prev, items: [newItem] };\r\n      }\r\n\r\n      return { ...prev, items: [...prev.items, newItem] };\r\n    });\r\n  }, [setFormData]);\r\n\r\n  const handleUpdateItem = useCallback((index: number, updatedItem: SaleItem) => {\r\n    setFormData(prev => {\r\n      // If this item has a productId, check if it already exists in another row\r\n      if (updatedItem.productId) {\r\n        const existingItemIndex = prev.items.findIndex((item, i) =>\r\n          i !== index && item.productId === updatedItem.productId\r\n        );\r\n\r\n        if (existingItemIndex !== -1) {\r\n          // Duplicate found! Merge this item into the existing one\r\n          const newItems = [...prev.items];\r\n          const existingItem = newItems[existingItemIndex];\r\n\r\n          newItems[existingItemIndex] = {\r\n            ...existingItem,\r\n            quantity: existingItem.quantity + updatedItem.quantity\r\n          };\r\n\r\n          // If there's more than one item, remove the current (duplicate) row\r\n          if (newItems.length > 1) {\r\n            newItems.splice(index, 1);\r\n          } else {\r\n            // If it's the only item (unlikely for a duplicate but safe), reset it\r\n            newItems[index] = { ...emptyItem };\r\n          }\r\n\r\n          return { ...prev, items: newItems };\r\n        }\r\n      }\r\n\r\n      const newItems = [...prev.items];\r\n      newItems[index] = updatedItem;\r\n      return { ...prev, items: newItems };\r\n    });\r\n  }, [setFormData]);\r\n\r\n  const handleRemoveItem = useCallback((index: number) => {\r\n    setFormData(prev => {\r\n      if (prev.items.length === 1) return prev;\r\n      const newItems = prev.items.filter((_, i) => i !== index);\r\n      return { ...prev, items: newItems };\r\n    });\r\n  }, [setFormData]);\r\n\r\n  return {\r\n    handleAddItem,\r\n    handleAddItemWithProduct,\r\n    handleUpdateItem,\r\n    handleRemoveItem,\r\n  };\r\n};","import { useCallback } from 'react';\r\nimport { SaleFormData, Customer } from '@/types';\r\n\r\ninterface UseCustomerSelectionProps {\r\n  setFormData: React.Dispatch<React.SetStateAction<SaleFormData>>;\r\n  setSelectedCustomerCategoryId: React.Dispatch<React.SetStateAction<string>>;\r\n}\r\n\r\nexport const useCustomerSelection = ({\r\n  setFormData,\r\n  setSelectedCustomerCategoryId,\r\n}: UseCustomerSelectionProps) => {\r\n  const handleSelectCustomer = useCallback((customer: Customer) => {\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      customerName: customer.fullName,\r\n      customerAddress: customer.location || '',\r\n      customerContact: customer.phoneNumber || '',\r\n      customerId: customer.id, // Save customer ID\r\n    }));\r\n    setSelectedCustomerCategoryId(customer.categoryId || '');\r\n  }, [setFormData, setSelectedCustomerCategoryId]);\r\n\r\n  const handleCategoryChange = useCallback((categoryId: string) => {\r\n    setSelectedCustomerCategoryId(categoryId);\r\n  }, [setSelectedCustomerCategoryId]);\r\n\r\n  return {\r\n    handleSelectCustomer,\r\n    handleCategoryChange,\r\n  };\r\n};","import { useCallback } from 'react';\r\nimport { SaleFormData, FormErrors } from '@/types';\r\n\r\ninterface UseFormValidationProps {\r\n  formData: SaleFormData;\r\n  linkToCash: boolean;\r\n  selectedCashAccountId: string;\r\n  initialData?: any;\r\n  formRecentlyCleared: boolean;\r\n  setErrors: React.Dispatch<React.SetStateAction<FormErrors>>;\r\n}\r\n\r\nexport const useFormValidation = ({\r\n  formData,\r\n  linkToCash,\r\n  selectedCashAccountId,\r\n  initialData,\r\n  formRecentlyCleared,\r\n  setErrors,\r\n}: UseFormValidationProps) => {\r\n  const validateForm = useCallback((grandTotal: number, saleDate?: Date): boolean => {\r\n    const newErrors: FormErrors = {};\r\n\r\n    if (!formData.customerName.trim()) {\r\n      newErrors.customerName = 'Customer name is required';\r\n    }\r\n\r\n    if (formData.taxRate < 0) {\r\n      newErrors.taxRate = 'Tax rate cannot be negative';\r\n    }\r\n\r\n    // Filter out completely empty items (placeholder items)\r\n    const nonEmptyItems = formData.items.filter(item =>\r\n      item.description.trim() !== '' || item.quantity > 0 || item.price > 0\r\n    );\r\n\r\n    const hasInvalidItems = nonEmptyItems.some(item =>\r\n      !item.description.trim() ||\r\n      item.quantity <= 0 ||\r\n      item.price < 0 ||\r\n      item.cost < 0\r\n    );\r\n\r\n    if (hasInvalidItems) {\r\n      newErrors.items = 'All items must have a description, positive quantity, and non-negative price/cost';\r\n    }\r\n\r\n    // Note: Removed product creation date validation as it was too strict\r\n    // and prevented loading drafts. Products can exist before a sale is backdated.\r\n    // The validation was: if product createdAt > saleDate, reject the sale\r\n    // This is overly restrictive for legitimate use cases like loading drafts.\r\n\r\n\r\n    if (linkToCash && (formData.paymentStatus === 'Paid' || formData.paymentStatus === 'Installment Sale') && !selectedCashAccountId) {\r\n      newErrors.cashAccount = 'Select a cash account when linking payments';\r\n    }\r\n\r\n    if (formData.paymentStatus === 'Installment Sale' && !initialData) {\r\n      if (!formData.amountPaid || formData.amountPaid <= 0) {\r\n        newErrors.amountPaid = 'Enter an initial payment greater than 0';\r\n      }\r\n      if (formData.amountPaid && formData.amountPaid > grandTotal) {\r\n        newErrors.amountPaid = 'Amount paid cannot exceed total';\r\n      }\r\n    }\r\n\r\n    if (formData.paymentStatus === 'Installment Sale' && initialData && formData.amountPaid) {\r\n      if (formData.amountPaid > grandTotal) {\r\n        newErrors.amountPaid = 'Amount paid cannot exceed total';\r\n      }\r\n    }\r\n    setErrors(newErrors);\r\n    return Object.keys(newErrors).length === 0;\r\n  }, [formData, linkToCash, selectedCashAccountId, initialData, formRecentlyCleared, setErrors]);\r\n\r\n  return {\r\n    validateForm,\r\n  };\r\n};","import { useCallback } from 'react';\r\nimport { SaleItem } from '@/types';\r\n\r\ninterface UseFormCalculationsProps {\r\n  taxRate: number;\r\n}\r\n\r\nexport const useFormCalculations = ({ taxRate }: UseFormCalculationsProps) => {\r\n  const calculateTotalAmount = useCallback((items: SaleItem[]): number => {\r\n    return items.reduce((total, item) => {\r\n      const subtotal = item.price * item.quantity;\r\n      const discountAmount = item.discountType === 'amount' \r\n        ? (item.discountAmount || 0)\r\n        : (subtotal * (item.discountPercentage || 0)) / 100;\r\n      return total + (subtotal - discountAmount);\r\n    }, 0);\r\n  }, []);\r\n\r\n  const calculateTaxAmount = useCallback((total: number): number => {\r\n    return total * (taxRate / 100);\r\n  }, [taxRate]);\r\n\r\n  return {\r\n    calculateTotalAmount,\r\n    calculateTaxAmount,\r\n  };\r\n};","\r\nimport { useState } from 'react';\r\nimport { InstallmentPayment } from '@/hooks/useInstallmentPayments';\r\n\r\nexport interface PaymentChange {\r\n  id: string;\r\n  type: 'update' | 'delete';\r\n  originalPayment: InstallmentPayment;\r\n  updatedData?: { amount?: number; notes?: string; paymentDate?: Date; };\r\n}\r\n\r\nexport const useLocalPaymentChanges = () => {\r\n  const [pendingChanges, setPendingChanges] = useState<PaymentChange[]>([]);\r\n\r\n  const addPaymentChange = (change: PaymentChange) => {\r\n    setPendingChanges(prev => {\r\n      // Remove any existing change for this payment\r\n      const filtered = prev.filter(c => c.id !== change.id);\r\n      return [...filtered, change];\r\n    });\r\n  };\r\n\r\n  const removePaymentChange = (paymentId: string) => {\r\n    setPendingChanges(prev => prev.filter(c => c.id !== paymentId));\r\n  };\r\n\r\n  const clearChanges = () => {\r\n    setPendingChanges([]);\r\n  };\r\n\r\n  const getModifiedPayments = (originalPayments: InstallmentPayment[]): InstallmentPayment[] => {\r\n    return originalPayments\r\n      .filter(payment => {\r\n        // Filter out deleted payments\r\n        const deleteChange = pendingChanges.find(c => c.id === payment.id && c.type === 'delete');\r\n        return !deleteChange;\r\n      })\r\n      .map(payment => {\r\n        // Apply updates to payments\r\n        const updateChange = pendingChanges.find(c => c.id === payment.id && c.type === 'update');\r\n        if (updateChange && updateChange.updatedData) {\r\n          return {\r\n            ...payment,\r\n            amount: updateChange.updatedData.amount ?? payment.amount,\r\n            notes: updateChange.updatedData.notes ?? payment.notes,\r\n            paymentDate: updateChange.updatedData.paymentDate ?? payment.paymentDate,\r\n          };\r\n        }\r\n        return payment;\r\n      });\r\n  };\r\n\r\n  const hasChanges = pendingChanges.length > 0;\r\n\r\n  return {\r\n    pendingChanges,\r\n    addPaymentChange,\r\n    removePaymentChange,\r\n    clearChanges,\r\n    getModifiedPayments,\r\n    hasChanges\r\n  };\r\n};\r\n","import { useCallback } from 'react';\r\nimport { useInstallmentPayments } from '@/hooks/useInstallmentPayments';\r\nimport { useLocalPaymentChanges } from '@/hooks/useLocalPaymentChanges';\r\n\r\ninterface UsePaymentOperationsProps {\r\n  initialDataId?: string;\r\n}\r\n\r\nexport const usePaymentOperations = ({ initialDataId }: UsePaymentOperationsProps) => {\r\n  const { \r\n    payments, \r\n    createPayment: createInstallmentPayment, \r\n    updatePayment: updateInstallmentPayment, \r\n    deletePayment: deleteInstallmentPayment \r\n  } = useInstallmentPayments(initialDataId);\r\n\r\n  const { \r\n    pendingChanges, \r\n    addPaymentChange, \r\n    clearChanges, \r\n    getModifiedPayments, \r\n    hasChanges \r\n  } = useLocalPaymentChanges();\r\n\r\n  const processPendingPaymentChanges = useCallback(async () => {\r\n    for (const change of pendingChanges) {\r\n      if (change.type === 'update') {\r\n        await updateInstallmentPayment(change.id, change.updatedData);\r\n      } else if (change.type === 'delete') {\r\n        await deleteInstallmentPayment(change.id);\r\n      }\r\n    }\r\n    clearChanges();\r\n  }, [pendingChanges, updateInstallmentPayment, deleteInstallmentPayment, clearChanges]);\r\n\r\n  return {\r\n    // Payment state\r\n    payments,\r\n    pendingChanges,\r\n    hasChanges,\r\n    \r\n    // Payment methods\r\n    createInstallmentPayment,\r\n    updateInstallmentPayment,\r\n    deleteInstallmentPayment,\r\n    addPaymentChange,\r\n    clearChanges,\r\n    getModifiedPayments,\r\n    processPendingPaymentChanges,\r\n  };\r\n};","import { useCallback } from 'react';\r\nimport { useFormState } from './sale-form/useFormState';\r\nimport { useFormHandlers } from './sale-form/useFormHandlers';\r\nimport { useItemManagement } from './sale-form/useItemManagement';\r\nimport { useCustomerSelection } from './sale-form/useCustomerSelection';\r\nimport { useFormValidation } from './sale-form/useFormValidation';\r\nimport { useFormCalculations } from './sale-form/useFormCalculations';\r\nimport { usePaymentOperations } from './sale-form/usePaymentOperations';\r\n\r\ninterface UseSaleFormLogicProps {\r\n  initialData?: any;\r\n  defaultPaymentStatus: string;\r\n  cashAccounts: any[];\r\n}\r\n\r\nexport const useSaleFormLogic = ({\r\n  initialData,\r\n  defaultPaymentStatus,\r\n  cashAccounts\r\n}: UseSaleFormLogicProps) => {\r\n  // Form state management\r\n  const {\r\n    formData,\r\n    errors,\r\n    taxRateInput,\r\n    printAfterSave,\r\n    thermalPrintAfterSave,\r\n    includePaymentInfo,\r\n    selectedCustomerCategoryId,\r\n    paymentDate,\r\n    linkToCash,\r\n    selectedCashAccountId,\r\n    cashTransactionId,\r\n    originalPaymentStatus,\r\n    formRecentlyCleared,\r\n    setFormData,\r\n    setErrors,\r\n    setTaxRateInput,\r\n    setPrintAfterSave,\r\n    setThermalPrintAfterSave,\r\n    setIncludePaymentInfo,\r\n    setSelectedCustomerCategoryId,\r\n    setPaymentDate,\r\n    setLinkToCash,\r\n    setSelectedCashAccountId,\r\n    setCashTransactionId,\r\n    setOriginalPaymentStatus,\r\n    setFormRecentlyCleared,\r\n    clearFormState,\r\n  } = useFormState({ initialData, defaultPaymentStatus });\r\n\r\n  // Form handlers\r\n  const {\r\n    handleChange,\r\n    handleSelectChange,\r\n    handleAmountPaidChange,\r\n    handlePaymentDateChange,\r\n  } = useFormHandlers({\r\n    formData,\r\n    setFormData,\r\n    errors,\r\n    setErrors,\r\n    setTaxRateInput,\r\n    setLinkToCash,\r\n  });\r\n\r\n  // Item management\r\n  const {\r\n    handleAddItem,\r\n    handleAddItemWithProduct,\r\n    handleUpdateItem,\r\n    handleRemoveItem,\r\n  } = useItemManagement({ formData, setFormData });\r\n\r\n  // Customer selection\r\n  const {\r\n    handleSelectCustomer,\r\n    handleCategoryChange,\r\n  } = useCustomerSelection({\r\n    setFormData,\r\n    setSelectedCustomerCategoryId,\r\n  });\r\n\r\n  // Form validation\r\n  const { validateForm } = useFormValidation({\r\n    formData,\r\n    linkToCash,\r\n    selectedCashAccountId,\r\n    initialData,\r\n    formRecentlyCleared,\r\n    setErrors,\r\n  });\r\n\r\n  // Calculations\r\n  const {\r\n    calculateTotalAmount,\r\n    calculateTaxAmount,\r\n  } = useFormCalculations({ taxRate: formData.taxRate });\r\n\r\n  // Payment operations\r\n  const {\r\n    payments,\r\n    pendingChanges,\r\n    hasChanges,\r\n    createInstallmentPayment,\r\n    updateInstallmentPayment,\r\n    deleteInstallmentPayment,\r\n    addPaymentChange,\r\n    clearChanges,\r\n    getModifiedPayments,\r\n    processPendingPaymentChanges,\r\n  } = usePaymentOperations({ initialDataId: initialData?.id });\r\n\r\n  // Enhanced payment date change handler\r\n  const handlePaymentDateChangeEnhanced = useCallback((date: Date) => {\r\n    setPaymentDate(date);\r\n  }, [setPaymentDate]);\r\n\r\n  // Enhanced clear form that can reset date and draft\r\n  const clearForm = useCallback((onDateReset?: () => void, onDraftClear?: () => void) => {\r\n    clearFormState(onDateReset);\r\n    clearChanges();\r\n    if (onDraftClear) {\r\n      onDraftClear();\r\n    }\r\n  }, [clearFormState, clearChanges]);\r\n\r\n  // Enhanced handlers that reset the formRecentlyCleared flag\r\n  const handleChangeEnhanced = useCallback((e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {\r\n    if (formRecentlyCleared) {\r\n      setFormRecentlyCleared(false);\r\n    }\r\n    handleChange(e);\r\n  }, [formRecentlyCleared, setFormRecentlyCleared, handleChange]);\r\n\r\n  const handleSelectChangeEnhanced = useCallback((value: string) => {\r\n    if (formRecentlyCleared) {\r\n      setFormRecentlyCleared(false);\r\n    }\r\n    handleSelectChange(value);\r\n  }, [formRecentlyCleared, setFormRecentlyCleared, handleSelectChange]);\r\n\r\n  // Enhanced item handlers that reset the formRecentlyCleared flag\r\n  const handleAddItemEnhanced = useCallback((product?: any) => {\r\n    if (formRecentlyCleared) {\r\n      setFormRecentlyCleared(false);\r\n    }\r\n\r\n    // Check if product is actually an event (from onClick) or a valid product object\r\n    // Events have 'type' or 'target' properties, products have 'id' or 'name'\r\n    const isEvent = product && (product.nativeEvent || product.preventDefault || product.stopPropagation || (product.type && product.target));\r\n\r\n    if (product && !isEvent) {\r\n      handleAddItemWithProduct(product);\r\n    } else {\r\n      handleAddItem();\r\n    }\r\n  }, [formRecentlyCleared, setFormRecentlyCleared, handleAddItem, handleAddItemWithProduct]);\r\n\r\n  const handleUpdateItemEnhanced = useCallback((index: number, updatedItem: any) => {\r\n    if (formRecentlyCleared) {\r\n      setFormRecentlyCleared(false);\r\n    }\r\n    handleUpdateItem(index, updatedItem);\r\n  }, [formRecentlyCleared, setFormRecentlyCleared, handleUpdateItem]);\r\n\r\n  const handleRemoveItemEnhanced = useCallback((index: number) => {\r\n    if (formRecentlyCleared) {\r\n      setFormRecentlyCleared(false);\r\n    }\r\n    handleRemoveItem(index);\r\n  }, [formRecentlyCleared, setFormRecentlyCleared, handleRemoveItem]);\r\n\r\n  // Enhanced customer handlers that reset the formRecentlyCleared flag\r\n  const handleSelectCustomerEnhanced = useCallback((customer: any) => {\r\n    if (formRecentlyCleared) {\r\n      setFormRecentlyCleared(false);\r\n    }\r\n    handleSelectCustomer(customer);\r\n  }, [formRecentlyCleared, setFormRecentlyCleared, handleSelectCustomer]);\r\n\r\n  const handleCategoryChangeEnhanced = useCallback((categoryId: string) => {\r\n    if (formRecentlyCleared) {\r\n      setFormRecentlyCleared(false);\r\n    }\r\n    handleCategoryChange(categoryId);\r\n  }, [formRecentlyCleared, setFormRecentlyCleared, handleCategoryChange]);\r\n\r\n  // Sales category change handler\r\n  const handleSalesCategoryChange = useCallback((categoryId: string) => {\r\n    if (formRecentlyCleared) {\r\n      setFormRecentlyCleared(false);\r\n    }\r\n    setFormData(prev => ({ ...prev, categoryId }));\r\n  }, [formRecentlyCleared, setFormRecentlyCleared, setFormData]);\r\n\r\n  return {\r\n    // State\r\n    formData,\r\n    errors,\r\n    taxRateInput,\r\n    printAfterSave,\r\n    thermalPrintAfterSave,\r\n    includePaymentInfo,\r\n    selectedCustomerCategoryId,\r\n    paymentDate,\r\n    linkToCash,\r\n    selectedCashAccountId,\r\n    cashTransactionId,\r\n    originalPaymentStatus,\r\n    formRecentlyCleared,\r\n    payments,\r\n    pendingChanges,\r\n    hasChanges,\r\n\r\n    // Setters\r\n    setFormData,\r\n    setTaxRateInput,\r\n    setPrintAfterSave,\r\n    setThermalPrintAfterSave,\r\n    setIncludePaymentInfo,\r\n    setLinkToCash,\r\n    setSelectedCashAccountId,\r\n    setCashTransactionId,\r\n    setOriginalPaymentStatus,\r\n\r\n    // Handlers\r\n    handleChange: handleChangeEnhanced,\r\n    handleSelectChange: handleSelectChangeEnhanced,\r\n    handleAddItem: handleAddItemEnhanced,\r\n    handleUpdateItem: handleUpdateItemEnhanced,\r\n    handleRemoveItem: handleRemoveItemEnhanced,\r\n    handleSelectCustomer: handleSelectCustomerEnhanced,\r\n    handleCategoryChange: handleCategoryChangeEnhanced,\r\n    handleSalesCategoryChange,\r\n    handleAmountPaidChange,\r\n    handlePaymentDateChange: handlePaymentDateChangeEnhanced,\r\n    clearForm,\r\n\r\n    // Utils\r\n    calculateTotalAmount,\r\n    calculateTaxAmount,\r\n    validateForm,\r\n    processPendingPaymentChanges,\r\n\r\n    // Payment methods\r\n    createInstallmentPayment,\r\n    updateInstallmentPayment,\r\n    deleteInstallmentPayment,\r\n    addPaymentChange,\r\n    clearChanges,\r\n    getModifiedPayments,\r\n  };\r\n};","import { useCallback } from 'react';\r\nimport { toast } from 'sonner';\r\nimport { useCashTransactions } from '@/hooks/useCashTransactions';\r\nimport { findCashTransactionAction } from '@/app/actions/finance';\r\n\r\nexport const useCashTransactionOperations = () => {\r\n  const {\r\n    createTransaction: createCashTransaction,\r\n    updateTransaction: updateCashTransaction,\r\n    deleteTransaction: deleteCashTransaction\r\n  } = useCashTransactions();\r\n\r\n  const createCashTransactionForSale = useCallback(async (\r\n    sale: any,\r\n    amount: number,\r\n    linkToCash: boolean,\r\n    selectedCashAccountId: string,\r\n    selectedDate: Date,\r\n    paymentStatus: string\r\n  ) => {\r\n    if (!linkToCash || !selectedCashAccountId || paymentStatus !== 'Paid') {\r\n      return null;\r\n    }\r\n\r\n    try {\r\n      const description = `Sale to ${sale.customerName || sale.customer_name || 'Customer'} - Receipt #${sale.receiptNumber || sale.receipt_number || 'N/A'}`;\r\n\r\n      const cashTransaction = await createCashTransaction({\r\n        accountId: selectedCashAccountId,\r\n        amount: amount,\r\n        transactionType: 'cash_in',\r\n        category: 'Cash sale',\r\n        description: description,\r\n        date: selectedDate,\r\n        personInCharge: '',\r\n        tags: [],\r\n        paymentMethod: '',\r\n        receiptImage: ''\r\n      });\r\n\r\n      return cashTransaction?.id || null;\r\n    } catch (error) {\r\n      console.error('Error creating cash transaction:', error);\r\n      toast.error('Failed to create cash transaction');\r\n      return null;\r\n    }\r\n  }, [createCashTransaction]);\r\n\r\n  const updateCashTransactionForSale = useCallback(async (\r\n    sale: any,\r\n    amount: number,\r\n    cashTransactionId: string | null,\r\n    originalPaymentStatus: string,\r\n    paymentStatus: string,\r\n    linkToCash: boolean,\r\n    selectedCashAccountId: string,\r\n    selectedDate: Date\r\n  ) => {\r\n    try {\r\n      const description = `Sale to ${sale.customerName || sale.customer_name || 'Customer'} - Receipt #${sale.receiptNumber || sale.receipt_number || 'N/A'}`;\r\n\r\n      const validCashAccountId = selectedCashAccountId && selectedCashAccountId.trim() !== '';\r\n\r\n      if (!cashTransactionId && linkToCash && paymentStatus === 'Paid' && validCashAccountId) {\r\n        const cashTransaction = await createCashTransaction({\r\n          accountId: selectedCashAccountId,\r\n          amount: amount,\r\n          transactionType: 'cash_in',\r\n          category: 'Cash sale',\r\n          description: description,\r\n          date: selectedDate,\r\n          personInCharge: '',\r\n          tags: [],\r\n          paymentMethod: '',\r\n          receiptImage: ''\r\n        });\r\n        return cashTransaction?.id || null;\r\n      }\r\n\r\n      if (!cashTransactionId) {\r\n        return null;\r\n      }\r\n\r\n      if (originalPaymentStatus === 'Paid' && paymentStatus === 'Installment Sale') {\r\n        await deleteCashTransaction(cashTransactionId);\r\n        return null;\r\n      }\r\n\r\n      if (linkToCash && paymentStatus === 'Paid' && validCashAccountId) {\r\n        await updateCashTransaction(cashTransactionId, {\r\n          amount: amount,\r\n          category: 'Cash sale',\r\n          description: description,\r\n          date: selectedDate\r\n        });\r\n        return cashTransactionId;\r\n      } else {\r\n        await deleteCashTransaction(cashTransactionId);\r\n        return null;\r\n      }\r\n    } catch (error) {\r\n      console.error('Error updating cash transaction:', error);\r\n      toast.error('Failed to update cash transaction');\r\n      return cashTransactionId;\r\n    }\r\n  }, [createCashTransaction, updateCashTransaction, deleteCashTransaction]);\r\n\r\n  const createInstallmentPaymentWithCash = useCallback(async (\r\n    saleId: string,\r\n    amount: number,\r\n    saleDescription: string,\r\n    linkToCash: boolean,\r\n    selectedCashAccountId: string,\r\n    locationId: string,\r\n    createInstallmentPayment: any\r\n  ) => {\r\n    if (amount <= 0) {\r\n      return null;\r\n    }\r\n\r\n    if (!linkToCash || !selectedCashAccountId) {\r\n      return await createInstallmentPayment({\r\n        saleId,\r\n        amount\r\n      });\r\n    }\r\n\r\n    return await createInstallmentPayment({\r\n      saleId,\r\n      amount,\r\n      accountId: selectedCashAccountId,\r\n      locationId,\r\n      date: new Date()\r\n    });\r\n  }, []);\r\n\r\n  const findCashTransactionForSale = useCallback(async (cashTransactionId: string) => {\r\n    try {\r\n      const result = await findCashTransactionAction(cashTransactionId);\r\n      if (result.success && result.data) {\r\n        return result.data.accountId;\r\n      }\r\n    } catch (error) {\r\n      console.error('Error finding cash transaction:', error);\r\n    }\r\n    return null;\r\n  }, []);\r\n\r\n  return {\r\n    createCashTransactionForSale,\r\n    updateCashTransactionForSale,\r\n    createInstallmentPaymentWithCash,\r\n    findCashTransactionForSale,\r\n  };\r\n};","import createLucideIcon from '../createLucideIcon';\n\n/**\n * @component @name RotateCcw\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMyAxMmE5IDkgMCAxIDAgOS05IDkuNzUgOS43NSAwIDAgMC02Ljc0IDIuNzRMMyA4IiAvPgogIDxwYXRoIGQ9Ik0zIDN2NWg1IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/rotate-ccw\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst RotateCcw = createLucideIcon('RotateCcw', [\n  ['path', { d: 'M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8', key: '1357e3' }],\n  ['path', { d: 'M3 3v5h5', key: '1xhq8a' }],\n]);\n\nexport default RotateCcw;\n","\r\nimport React from \"react\";\r\nimport { format } from \"date-fns\";\r\nimport { CalendarIcon } from \"lucide-react\";\r\nimport { Calendar } from \"@/components/ui/calendar\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\ninterface SaleDatePickerProps {\r\n  selectedDate: Date;\r\n  onDateChange: (date: Date) => void;\r\n}\r\n\r\nconst SaleDatePicker: React.FC<SaleDatePickerProps> = ({\r\n  selectedDate,\r\n  onDateChange,\r\n}) => {\r\n  const handleDateSelect = (date: Date | undefined) => {\r\n    if (date) {\r\n      // Ensure the date is set to noon to avoid timezone issues\r\n      const adjustedDate = new Date(date.getFullYear(), date.getMonth(), date.getDate(), 12, 0, 0);\r\n      onDateChange(adjustedDate);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"grid gap-3\">\r\n      <Label htmlFor=\"date\">Date</Label>\r\n      <Popover>\r\n        <PopoverTrigger asChild>\r\n          <Button\r\n            variant={\"outline\"}\r\n            className={cn(\r\n              \"w-full justify-start text-left font-normal\",\r\n              !selectedDate && \"text-muted-foreground\"\r\n            )}\r\n          >\r\n            <CalendarIcon className=\"mr-2 h-4 w-4\" />\r\n            {selectedDate ? format(selectedDate, \"PPP\") : <span>Pick a date</span>}\r\n          </Button>\r\n        </PopoverTrigger>\r\n        <PopoverContent className=\"w-auto p-0\" align=\"start\">\r\n          <Calendar\r\n            mode=\"single\"\r\n            selected={selectedDate}\r\n            onSelect={handleDateSelect}\r\n            initialFocus\r\n            className={cn(\"p-3 pointer-events-auto\")}\r\n          />\r\n        </PopoverContent>\r\n      </Popover>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SaleDatePicker;\r\n","import { useState, useEffect } from 'react';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\nimport { toast } from '@/hooks/use-toast';\r\nimport { useAuth } from '@/components/auth/AuthProvider';\r\nimport {\r\n  getCustomerCategoriesAction,\r\n  createCustomerCategoryAction,\r\n  updateCustomerCategoryAction,\r\n  deleteCustomerCategoryAction\r\n} from '@/app/actions/customers';\r\n\r\nexport interface CustomerCategory {\r\n  id: string;\r\n  name: string;\r\n  isDefault: boolean;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n}\r\n\r\nexport const useCustomerCategories = () => {\r\n  const [categories, setCategories] = useState<CustomerCategory[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const { currentBusiness } = useBusiness();\r\n  const { user } = useAuth();\r\n\r\n  const fetchCategories = async () => {\r\n    if (!currentBusiness) {\r\n      setCategories([]);\r\n      setIsLoading(false);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const result = await getCustomerCategoriesAction(currentBusiness.id);\r\n      if (result.success && result.data) {\r\n        setCategories(result.data as any);\r\n      } else {\r\n        throw new Error(result.error);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching customer categories:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to fetch customer categories\",\r\n        variant: \"destructive\",\r\n      });\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchCategories();\r\n  }, [currentBusiness]);\r\n\r\n  const createCategory = async (name: string) => {\r\n    if (!currentBusiness || !user) {\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"No business selected or user not authenticated\",\r\n        variant: \"destructive\",\r\n      });\r\n      return false;\r\n    }\r\n\r\n    try {\r\n      const result = await createCustomerCategoryAction(currentBusiness.id, user.id, name);\r\n      if (result.success) {\r\n        toast({\r\n          title: \"Success\",\r\n          description: \"Customer category created successfully\",\r\n        });\r\n        fetchCategories();\r\n        return true;\r\n      } else {\r\n        throw new Error(result.error);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error creating customer category:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to create customer category\",\r\n        variant: \"destructive\",\r\n      });\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const updateCategory = async (id: string, name: string) => {\r\n    try {\r\n      const result = await updateCustomerCategoryAction(id, name);\r\n      if (result.success) {\r\n        toast({\r\n          title: \"Success\",\r\n          description: \"Customer category updated successfully\",\r\n        });\r\n        fetchCategories();\r\n        return true;\r\n      } else {\r\n        throw new Error(result.error);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error updating customer category:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to update customer category\",\r\n        variant: \"destructive\",\r\n      });\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const deleteCategory = async (id: string) => {\r\n    try {\r\n      const result = await deleteCustomerCategoryAction(id);\r\n      if (result.success) {\r\n        toast({\r\n          title: \"Success\",\r\n          description: \"Customer category deleted successfully\",\r\n        });\r\n        fetchCategories();\r\n        return true;\r\n      } else {\r\n        throw new Error(result.error);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error deleting customer category:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to delete customer category\",\r\n        variant: \"destructive\",\r\n      });\r\n      return false;\r\n    }\r\n  };\r\n\r\n  return {\r\n    categories,\r\n    isLoading,\r\n    createCategory,\r\n    updateCategory,\r\n    deleteCategory,\r\n    refetch: fetchCategories,\r\n  };\r\n};\r\n","\r\nimport React, { useState, useEffect } from \"react\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Customer } from \"@/types\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Check } from \"lucide-react\";\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport { useCustomerCategories } from \"@/hooks/useCustomerCategories\";\r\n\r\ninterface CustomerInformationProps {\r\n  customerName: string;\r\n  customerAddress: string;\r\n  customerContact: string;\r\n  notes?: string;\r\n  onCustomerInfoChange: (e: React.ChangeEvent<HTMLInputElement>) => void;\r\n  errors: {\r\n    customerName?: string;\r\n  };\r\n  customers?: Customer[];\r\n  onAddNewCustomer?: () => void;\r\n  onSelectCustomer?: (customer: Customer) => void;\r\n  selectedCategoryId?: string;\r\n  onCategoryChange?: (categoryId: string) => void;\r\n}\r\n\r\nconst CustomerInformation: React.FC<CustomerInformationProps> = ({\r\n  customerName,\r\n  customerAddress,\r\n  customerContact,\r\n  notes = '',\r\n  onCustomerInfoChange,\r\n  errors,\r\n  customers = [],\r\n  onAddNewCustomer,\r\n  onSelectCustomer,\r\n  selectedCategoryId,\r\n  onCategoryChange,\r\n}) => {\r\n  const [showSuggestions, setShowSuggestions] = useState(false);\r\n  const [searchValue, setSearchValue] = useState(\"\");\r\n  const [selectedCustomerCategory, setSelectedCustomerCategory] = useState<string>(\"\");\r\n  const { categories } = useCustomerCategories();\r\n\r\n  // Filter customers based on search input\r\n  const filteredCustomers = customers?.filter((customer) =>\r\n    customer.fullName.toLowerCase().includes(searchValue.toLowerCase())\r\n  ) || [];\r\n\r\n  // Reset search value when customerName changes externally\r\n  useEffect(() => {\r\n    setSearchValue(customerName);\r\n\r\n    // Update customer category when customer name changes\r\n    if (customerName.trim()) {\r\n      const customer = customers.find(c => c.fullName === customerName);\r\n      if (customer && customer.categoryId) {\r\n        const category = categories.find(cat => cat.id === customer.categoryId);\r\n        setSelectedCustomerCategory(category?.name || \"\");\r\n      } else {\r\n        setSelectedCustomerCategory(\"\");\r\n      }\r\n    } else {\r\n      setSelectedCustomerCategory(\"\");\r\n    }\r\n  }, [customerName, customers, categories]);\r\n\r\n  // Update selected category display when selectedCategoryId changes\r\n  useEffect(() => {\r\n    if (selectedCategoryId) {\r\n      const category = categories.find(cat => cat.id === selectedCategoryId);\r\n      setSelectedCustomerCategory(category?.name || \"\");\r\n    } else {\r\n      setSelectedCustomerCategory(\"\");\r\n    }\r\n  }, [selectedCategoryId, categories]);\r\n\r\n  // Handle customer selection\r\n  const handleSelectCustomer = (customer: Customer) => {\r\n    setShowSuggestions(false);\r\n    if (onSelectCustomer) {\r\n      onSelectCustomer(customer);\r\n    }\r\n\r\n    // Update category when customer is selected\r\n    if (customer.categoryId) {\r\n      const category = categories.find(cat => cat.id === customer.categoryId);\r\n      setSelectedCustomerCategory(category?.name || \"\");\r\n      if (onCategoryChange) {\r\n        onCategoryChange(customer.categoryId);\r\n      }\r\n    } else {\r\n      setSelectedCustomerCategory(\"\");\r\n      if (onCategoryChange) {\r\n        onCategoryChange(\"\");\r\n      }\r\n    }\r\n  };\r\n\r\n  // Handle search input change\r\n  const handleSearchChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const value = e.target.value;\r\n    setSearchValue(value);\r\n    onCustomerInfoChange(e);\r\n\r\n    // Show suggestions when typing\r\n    if (value.trim()) {\r\n      setShowSuggestions(true);\r\n    } else {\r\n      setShowSuggestions(false);\r\n      setSelectedCustomerCategory(\"\");\r\n      if (onCategoryChange) {\r\n        onCategoryChange(\"\");\r\n      }\r\n    }\r\n  };\r\n\r\n  // Handle blur event - hide suggestions after a delay\r\n  const handleBlur = () => {\r\n    setTimeout(() => {\r\n      setShowSuggestions(false);\r\n    }, 200);\r\n  };\r\n\r\n  // Handle category selection for new customers\r\n  const handleCategorySelect = (categoryId: string) => {\r\n    if (categoryId === \"none\") {\r\n      setSelectedCustomerCategory(\"\");\r\n      if (onCategoryChange) {\r\n        onCategoryChange(\"\");\r\n      }\r\n    } else {\r\n      const category = categories.find(cat => cat.id === categoryId);\r\n      if (category) {\r\n        setSelectedCustomerCategory(category.name);\r\n        if (onCategoryChange) {\r\n          onCategoryChange(categoryId);\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  // Get category name by ID\r\n  const getCategoryName = (categoryId: string | null) => {\r\n    if (!categoryId) return null;\r\n    const category = categories.find(cat => cat.id === categoryId);\r\n    return category?.name || null;\r\n  };\r\n\r\n  // Check if this is an existing customer (has a match in customers list)\r\n  const isExistingCustomer = customerName.trim() && customers.some(c => c.fullName === customerName);\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      <h3 className=\"text-lg font-semibold\">Customer Information</h3>\r\n\r\n      <div className=\"grid gap-3\">\r\n        <Label htmlFor=\"customerName\">Customer Name</Label>\r\n        <div className=\"flex flex-col space-y-2 relative\">\r\n          <Input\r\n            id=\"customerName\"\r\n            name=\"customerName\"\r\n            value={customerName}\r\n            onChange={handleSearchChange}\r\n            onFocus={() => searchValue.trim() && setShowSuggestions(true)}\r\n            onBlur={handleBlur}\r\n            onKeyDown={(e) => {\r\n              if (e.key === 'Enter') {\r\n                e.preventDefault();\r\n                document.getElementById('customerAddress')?.focus();\r\n              }\r\n            }}\r\n            className={cn(\r\n              errors.customerName ? 'border-red-500' : '',\r\n              \"w-full\"\r\n            )}\r\n            placeholder=\"Start typing customer name...\"\r\n            autoComplete=\"off\"\r\n          />\r\n\r\n          {/* Suggestions dropdown */}\r\n          {showSuggestions && (\r\n            <div className=\"absolute top-full left-0 right-0 mt-1 bg-white dark:bg-gray-800 border rounded-md shadow-lg z-50 max-h-60 overflow-y-auto\">\r\n              {filteredCustomers.length > 0 ? (\r\n                filteredCustomers.map((customer) => {\r\n                  const categoryName = getCategoryName(customer.categoryId || null);\r\n                  return (\r\n                    <div\r\n                      key={customer.id}\r\n                      className=\"px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer border-b last:border-0 border-gray-100 dark:border-gray-700 transition-colors\"\r\n                      onMouseDown={(e) => {\r\n                        e.preventDefault(); // Prevent input blur from firing before selection\r\n                        handleSelectCustomer(customer);\r\n                      }}\r\n                    >\r\n                      <div className=\"flex items-start justify-between gap-2\">\r\n                        <div className=\"flex-1 min-w-0\">\r\n                          <div className=\"flex items-center gap-2 mb-0.5\">\r\n                            {customerName === customer.fullName && (\r\n                              <Check className=\"h-4 w-4 text-green-500 shrink-0\" />\r\n                            )}\r\n                            <span className=\"font-medium text-sm truncate uppercase tracking-tight\">\r\n                              {customer.fullName}\r\n                            </span>\r\n                            {categoryName && (\r\n                              <span className=\"text-[10px] font-bold bg-primary/10 text-primary px-1.5 py-0.5 rounded leading-none uppercase\">\r\n                                {categoryName}\r\n                              </span>\r\n                            )}\r\n                          </div>\r\n\r\n                          <div className=\"flex flex-wrap gap-x-3 gap-y-1 text-xs text-muted-foreground mt-1\">\r\n                            {customer.location && (\r\n                              <span className=\"flex items-center gap-1\">\r\n                                <span className=\"opacity-70 italic text-[11px]\">at</span> {customer.location}\r\n                              </span>\r\n                            )}\r\n                            {customer.phoneNumber && (\r\n                              <span className=\"flex items-center gap-1\">\r\n                                <span className=\"opacity-70 tabular-nums\">{customer.phoneNumber}</span>\r\n                              </span>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  );\r\n                })\r\n              ) : (\r\n                <div className=\"px-4 py-6 text-center text-muted-foreground\">\r\n                  <p className=\"text-sm\">No customers found</p>\r\n                  <p className=\"text-xs opacity-70 mt-1\">Try a different search or add a new customer</p>\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          {errors.customerName && (\r\n            <p className=\"text-red-500 text-xs\">{errors.customerName}</p>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"grid gap-3\">\r\n        <Label htmlFor=\"customerAddress\">Customer Address</Label>\r\n        <Input\r\n          id=\"customerAddress\"\r\n          name=\"customerAddress\"\r\n          value={customerAddress}\r\n          onChange={onCustomerInfoChange}\r\n          onKeyDown={(e) => {\r\n            if (e.key === 'Enter') {\r\n              e.preventDefault();\r\n              document.getElementById('customerContact')?.focus();\r\n            }\r\n          }}\r\n        />\r\n      </div>\r\n\r\n      <div className=\"grid gap-3\">\r\n        <Label htmlFor=\"customerContact\">Customer Contact</Label>\r\n        <Input\r\n          id=\"customerContact\"\r\n          name=\"customerContact\"\r\n          value={customerContact}\r\n          onChange={onCustomerInfoChange}\r\n          onKeyDown={(e) => {\r\n            if (e.key === 'Enter') {\r\n              e.preventDefault();\r\n              const categoryInput = document.getElementById('customerCategory');\r\n              const categorySelect = document.querySelector('[role=\"combobox\"]') as HTMLElement;\r\n              if (categoryInput) {\r\n                categoryInput.focus();\r\n              } else if (categorySelect) {\r\n                categorySelect.focus();\r\n              } else {\r\n                document.getElementById('description-0')?.focus();\r\n              }\r\n            }\r\n          }}\r\n        />\r\n      </div>\r\n\r\n      <div className=\"grid gap-3\">\r\n        <Label htmlFor=\"customerCategory\">Customer Category</Label>\r\n        {isExistingCustomer ? (\r\n          <Input\r\n            id=\"customerCategory\"\r\n            value={selectedCustomerCategory}\r\n            readOnly\r\n            className=\"bg-gray-50 dark:bg-gray-800\"\r\n            placeholder=\"Category from existing customer\"\r\n            onKeyDown={(e) => {\r\n              if (e.key === 'Enter') {\r\n                e.preventDefault();\r\n                document.getElementById('description-0')?.focus();\r\n              }\r\n            }}\r\n          />\r\n        ) : (\r\n          <Select\r\n            value={selectedCategoryId || \"none\"}\r\n            onValueChange={handleCategorySelect}\r\n            onOpenChange={(open) => {\r\n              if (!open) {\r\n                // When select closes, focus next field after a brief delay\r\n                setTimeout(() => {\r\n                  document.getElementById('description-0')?.focus();\r\n                }, 100);\r\n              }\r\n            }}\r\n          >\r\n            <SelectTrigger\r\n              onKeyDown={(e) => {\r\n                if (e.key === 'Enter') {\r\n                  // Let the select handle the Enter key, then focus next field\r\n                  setTimeout(() => {\r\n                    document.getElementById('description-0')?.focus();\r\n                  }, 100);\r\n                }\r\n              }}\r\n            >\r\n              <SelectValue placeholder=\"Select a category\" />\r\n            </SelectTrigger>\r\n            <SelectContent>\r\n              <SelectItem value=\"none\">No Category</SelectItem>\r\n              {categories\r\n                .filter(category => category.id && category.id.trim() !== \"\")\r\n                .map((category) => (\r\n                  <SelectItem key={category.id} value={category.id}>\r\n                    {category.name}\r\n                  </SelectItem>\r\n                ))\r\n              }\r\n            </SelectContent>\r\n          </Select>\r\n        )}\r\n      </div>\r\n\r\n\r\n      {onAddNewCustomer && (\r\n        <Button\r\n          type=\"button\"\r\n          variant=\"outline\"\r\n          onClick={onAddNewCustomer}\r\n          className=\"w-full mt-2\"\r\n        >\r\n          Add New Customer\r\n        </Button>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CustomerInformation;\r\n","import React from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { ArrowLeft, RotateCcw } from 'lucide-react';\r\nimport SaleDatePicker from '@/components/sales/SaleDatePicker';\r\nimport CustomerInformation from '@/components/sales/CustomerInformation';\r\nimport { Customer, FormErrors } from '@/types';\r\n\r\ninterface SaleFormHeaderProps {\r\n  isEditing: boolean;\r\n  selectedDate: Date;\r\n  onDateChange: (date: Date) => void;\r\n  customerName: string;\r\n  customerAddress: string;\r\n  customerContact: string;\r\n  notes?: string;\r\n  onCustomerInfoChange: (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => void;\r\n  errors: FormErrors;\r\n  customers: Customer[];\r\n  onAddNewCustomer?: () => void;\r\n  onSelectCustomer: (customer: Customer) => void;\r\n  selectedCategoryId: string;\r\n  onCategoryChange: (categoryId: string) => void;\r\n  onClearForm?: () => void;\r\n}\r\n\r\nconst SaleFormHeader: React.FC<SaleFormHeaderProps> = ({\r\n  isEditing,\r\n  selectedDate,\r\n  onDateChange,\r\n  customerName,\r\n  customerAddress,\r\n  customerContact,\r\n  notes,\r\n  onCustomerInfoChange,\r\n  errors,\r\n  customers,\r\n  onAddNewCustomer,\r\n  onSelectCustomer,\r\n  selectedCategoryId,\r\n  onCategoryChange,\r\n  onClearForm,\r\n}) => {\r\n  const router = useRouter();\r\n\r\n  const handleBackClick = () => {\r\n    router.push('/sales');\r\n  };\r\n\r\n  return (\r\n    <Card className=\"mb-6\">\r\n      <CardHeader>\r\n        <div className=\"flex items-center justify-between\">\r\n          <div className=\"flex items-center gap-3\">\r\n            <Button\r\n              variant=\"ghost\"\r\n              size=\"icon\"\r\n              onClick={handleBackClick}\r\n              type=\"button\"\r\n              className=\"h-8 w-8\"\r\n            >\r\n              <ArrowLeft className=\"h-4 w-4\" />\r\n            </Button>\r\n\r\n            <div>\r\n              <CardTitle>{isEditing ? 'Edit Sale' : 'New Sale'}</CardTitle>\r\n              <CardDescription>Enter the sale details below</CardDescription>\r\n            </div>\r\n          </div>\r\n          {!isEditing && onClearForm && (\r\n            <Button\r\n              variant=\"outline\"\r\n              size=\"sm\"\r\n              onClick={onClearForm}\r\n              type=\"button\"\r\n              className=\"flex items-center gap-2\"\r\n            >\r\n              <RotateCcw className=\"h-4 w-4\" />\r\n              Clear Form\r\n            </Button>\r\n          )}\r\n        </div>\r\n      </CardHeader>\r\n      <CardContent className=\"space-y-6\">\r\n        <SaleDatePicker\r\n          selectedDate={selectedDate}\r\n          onDateChange={onDateChange}\r\n        />\r\n\r\n        <CustomerInformation\r\n          customerName={customerName}\r\n          customerAddress={customerAddress}\r\n          customerContact={customerContact}\r\n          notes={notes}\r\n          onCustomerInfoChange={onCustomerInfoChange}\r\n          errors={errors}\r\n          customers={customers}\r\n          onAddNewCustomer={onAddNewCustomer}\r\n          onSelectCustomer={onSelectCustomer}\r\n          selectedCategoryId={selectedCategoryId}\r\n          onCategoryChange={onCategoryChange}\r\n        />\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default SaleFormHeader;","import createLucideIcon from '../createLucideIcon';\n\n/**\n * @component @name Eraser\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJtNyAyMS00LjMtNC4zYy0xLTEtMS0yLjUgMC0zLjRsOS42LTkuNmMxLTEgMi41LTEgMy40IDBsNS42IDUuNmMxIDEgMSAyLjUgMCAzLjRMMTMgMjEiIC8+CiAgPHBhdGggZD0iTTIyIDIxSDciIC8+CiAgPHBhdGggZD0ibTUgMTEgOSA5IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/eraser\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Eraser = createLucideIcon('Eraser', [\n  [\n    'path',\n    {\n      d: 'm7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21',\n      key: '182aya',\n    },\n  ],\n  ['path', { d: 'M22 21H7', key: 't4ddhn' }],\n  ['path', { d: 'm5 11 9 9', key: '1mo9qw' }],\n]);\n\nexport default Eraser;\n","import * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\r\n\r\nconst Collapsible = CollapsiblePrimitive.Root\r\n\r\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\r\n\r\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\r\n\r\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\r\n","import React, { useState, useEffect, useCallback, useMemo } from 'react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Textarea } from '@/components/ui/textarea';\r\nimport { Trash2, Eye, EyeOff, Eraser } from 'lucide-react';\r\nimport { SaleItem } from '@/types';\r\nimport { formatNumber, formatNumberInput, parseNumberInput } from '@/lib/utils';\r\nimport { useBusinessSettings } from '@/hooks/useBusinessSettings';\r\nimport { Product } from '@/types';\r\nimport { getAllProductsAction } from '@/app/actions/products';\r\nimport { useAuth } from '@/components/auth/AuthProvider';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\nimport { toast } from 'sonner';\r\nimport { useIsMobile } from '@/hooks/use-mobile';\r\nimport ProductImage from '@/components/inventory/ProductImage';\r\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from '@/components/ui/tooltip';\r\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from '@/components/ui/collapsible';\r\nimport { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { useQuery } from '@tanstack/react-query';\r\n// Removed direct Supabase import\r\n\r\nimport { matchProductSearch } from '@/utils/searchUtils';\r\nimport { useFinancialVisibility } from '@/hooks/useFinancialVisibility';\r\n\r\ninterface ProductSaleItemInputProps {\r\n  item: SaleItem;\r\n  index: number;\r\n  onUpdate: (index: number, item: SaleItem) => void;\r\n  onRemove: (index: number) => void;\r\n  saleDate?: string;\r\n}\r\n\r\nconst ProductSaleItemInput: React.FC<ProductSaleItemInputProps> = ({\r\n  item,\r\n  index,\r\n  onUpdate,\r\n  onRemove,\r\n  saleDate\r\n}) => {\r\n  const {\r\n    settings\r\n  } = useBusinessSettings();\r\n  const currency = settings.currency || 'USD';\r\n  const {\r\n    user\r\n  } = useAuth();\r\n  const { currentBusiness } = useBusiness();\r\n  const { canViewCostPrice, canViewSellingPrice, formatFinancial } = useFinancialVisibility();\r\n  const [newProductName, setNewProductName] = useState<string>(item.description || '');\r\n  const isMobile = useIsMobile();\r\n  const [costVisible, setCostVisible] = useState(false);\r\n  const [showSuggestions, setShowSuggestions] = useState(false);\r\n\r\n  // Local state for numeric inputs with smart formatting (commas + decimals)\r\n  const [quantityInput, setQuantityInput] = useState(formatNumberInput(item.quantity?.toString() || '0'));\r\n  const [priceInput, setPriceInput] = useState(formatNumberInput(item.price?.toString() || '0'));\r\n  const [costInput, setCostInput] = useState(formatNumberInput(item.cost?.toString() || '0'));\r\n  const [discountAmountInput, setDiscountAmountInput] = useState(formatNumberInput(item.discountAmount?.toString() || '0'));\r\n  const [discountPercentInput, setDiscountPercentInput] = useState(formatNumberInput(item.discountPercentage?.toString() || '0'));\r\n\r\n  // Debounce search term to prevent filtering on every keystroke\r\n  const [debouncedSearchTerm, setDebouncedSearchTerm] = useState(item.description || '');\r\n\r\n  useEffect(() => {\r\n    const timer = setTimeout(() => {\r\n      setDebouncedSearchTerm(newProductName);\r\n    }, 300); // 300ms debounce\r\n    return () => clearTimeout(timer);\r\n  }, [newProductName]);\r\n\r\n  // Load all products directly with React Query (bypass useProducts filtering)\r\n  const { data: allProducts = [] } = useQuery({\r\n    queryKey: ['all-products', user?.id, currentBusiness?.id],\r\n    queryFn: async () => {\r\n      if (!user?.id || !currentBusiness?.id) return [];\r\n      return await getAllProductsAction(user.id, currentBusiness.id);\r\n    },\r\n    enabled: !!user?.id && !!currentBusiness?.id,\r\n    staleTime: 5 * 60_000, // Cache for 5 minutes\r\n  });\r\n\r\n  // Instant client-side filtering (now debounced and supporting multi-word search)\r\n  const filteredProducts = useMemo(() => {\r\n    if (!debouncedSearchTerm.trim()) {\r\n      return [];\r\n    }\r\n\r\n    return allProducts\r\n      .filter(product => matchProductSearch(product, debouncedSearchTerm))\r\n      .slice(0, 20); // Limit to 20 results for display\r\n  }, [allProducts, debouncedSearchTerm]);\r\n\r\n  // Update state when item changes (important for edit mode or external updates)\r\n  useEffect(() => {\r\n    setNewProductName(item.description || '');\r\n\r\n    // Only update local state if the numeric value actually changed from outside\r\n    // This prevents cursor jumping or formatting issues while typing\r\n    const currentQty = parseFloat(quantityInput.replace(/,/g, '')) || 0;\r\n    if (Math.abs(currentQty - item.quantity) > 0.001) {\r\n      setQuantityInput(item.quantity === 0 && quantityInput === '' ? '' : item.quantity.toString());\r\n    }\r\n\r\n    const currentPrice = parseFloat(priceInput.replace(/,/g, '')) || 0;\r\n    if (Math.abs(currentPrice - item.price) > 0.001) {\r\n      setPriceInput(item.price === 0 && priceInput === '' ? '' : item.price.toString());\r\n    }\r\n\r\n    const currentCost = parseFloat(costInput.replace(/,/g, '')) || 0;\r\n    if (Math.abs(currentCost - item.cost) > 0.001) {\r\n      setCostInput(item.cost === 0 && costInput === '' ? '' : item.cost.toString());\r\n    }\r\n\r\n    const currentDiscAmount = parseFloat(discountAmountInput.replace(/,/g, '')) || 0;\r\n    if (Math.abs(currentDiscAmount - (item.discountAmount || 0)) > 0.001) {\r\n      setDiscountAmountInput(item.discountAmount?.toString() || '0');\r\n    }\r\n\r\n    const currentDiscPercent = parseFloat(discountPercentInput.replace(/,/g, '')) || 0;\r\n    if (Math.abs(currentDiscPercent - (item.discountPercentage || 0)) > 0.001) {\r\n      setDiscountPercentInput(item.discountPercentage?.toString() || '0');\r\n    }\r\n  }, [item.description, item.quantity, item.price, item.cost, item.discountAmount, item.discountPercentage]);\r\n\r\n\r\n  // Calculate the total for this item\r\n  const subtotal = item.price * item.quantity;\r\n  const discountAmount = item.discountType === 'amount'\r\n    ? (item.discountAmount || 0)\r\n    : (subtotal * (item.discountPercentage || 0)) / 100;\r\n  const itemTotal = subtotal - discountAmount;\r\n\r\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {\r\n    const {\r\n      name,\r\n      value\r\n    } = e.target;\r\n\r\n    if (name === 'description') {\r\n      setNewProductName(value);\r\n      // Show suggestions when typing in the description field\r\n      setShowSuggestions(value.trim() !== '');\r\n      return;\r\n    }\r\n\r\n    // Handle numeric inputs with smart formatting (commas + decimals)\r\n    const formatted = formatNumberInput(value);\r\n    const numValue = parseNumberInput(value);\r\n\r\n    if (name === 'quantity') {\r\n      setQuantityInput(formatted);\r\n      onUpdate(index, { ...item, quantity: numValue });\r\n      return;\r\n    }\r\n\r\n    if (name === 'price') {\r\n      setPriceInput(formatted);\r\n      onUpdate(index, { ...item, price: numValue });\r\n      return;\r\n    }\r\n\r\n    if (name === 'cost') {\r\n      setCostInput(formatted);\r\n      onUpdate(index, { ...item, cost: numValue });\r\n      return;\r\n    }\r\n\r\n    if (name === 'discountAmount') {\r\n      setDiscountAmountInput(formatted);\r\n      onUpdate(index, { ...item, discountAmount: numValue });\r\n      return;\r\n    }\r\n\r\n    if (name === 'discountPercentage') {\r\n      setDiscountPercentInput(formatted);\r\n      onUpdate(index, { ...item, discountPercentage: numValue });\r\n      return;\r\n    }\r\n\r\n    // Default fallback\r\n    const updatedItem = {\r\n      ...item,\r\n      [name]: numValue\r\n    };\r\n    onUpdate(index, updatedItem);\r\n  };\r\n\r\n  const handleDescriptionBlur = () => {\r\n    if (newProductName !== item.description) {\r\n      onUpdate(index, { ...item, description: newProductName });\r\n    }\r\n  };\r\n\r\n\r\n  const handleTotalCostChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const value = parseNumberInput(e.target.value);\r\n    // If setting total cost, we calculate unit cost\r\n    const quantity = item.quantity || 1;\r\n    const newUnitCost = value / quantity;\r\n\r\n    // Update local state for cost with formatting\r\n    setCostInput(formatNumberInput(newUnitCost.toString()));\r\n\r\n    const updatedItem = {\r\n      ...item,\r\n      cost: newUnitCost\r\n    };\r\n    onUpdate(index, updatedItem);\r\n  };\r\n\r\n  // Toggle cost visibility\r\n  const toggleCostVisibility = () => {\r\n    setCostVisible(!costVisible);\r\n  };\r\n\r\n  // Handle clear form button click\r\n  const handleClearForm = () => {\r\n    // Reset states\r\n    setNewProductName('');\r\n    setShowSuggestions(false);\r\n\r\n    // Keep current quantity but reset everything else\r\n    const currentQuantity = item.quantity;\r\n    const clearedItem = {\r\n      ...item,\r\n      description: '',\r\n      price: 0,\r\n      cost: 0,\r\n      productId: null,\r\n      discountAmount: 0,\r\n      discountPercentage: 0\r\n    };\r\n\r\n    // Explicitly set inputs\r\n    setPriceInput('0');\r\n    setCostInput('0');\r\n    setDiscountAmountInput('0');\r\n    setDiscountPercentInput('0');\r\n    // Quantity input stays same as current valid quantity\r\n    // setQuantityInput(currentQuantity.toString()); \r\n\r\n    // Update the item\r\n    onUpdate(index, clearedItem);\r\n\r\n    toast.success('Item cleared');\r\n  };\r\n\r\n  // Handle product selection from suggestions\r\n  const handleProductSelect = (product: Product) => {\r\n    setNewProductName(product.name);\r\n    setShowSuggestions(false);\r\n\r\n    // Update local inputs with formatting\r\n    setPriceInput(formatNumberInput(product.sellingPrice.toString()));\r\n    setCostInput(formatNumberInput(product.costPrice.toString()));\r\n\r\n    const updatedItem = {\r\n      ...item,\r\n      description: product.name,\r\n      price: product.sellingPrice,\r\n      cost: product.costPrice,\r\n      productId: product.id\r\n    };\r\n    onUpdate(index, updatedItem);\r\n  };\r\n\r\n  // Check if selected product was created after the sale date\r\n  const selectedProduct = item.productId ? filteredProducts.find(p => p.id === item.productId) : null;\r\n  const showDateWarning = selectedProduct && saleDate && (() => {\r\n    const productCreatedDate = new Date(selectedProduct.createdAt);\r\n    const saleDateOnly = new Date(saleDate).setHours(0, 0, 0, 0);\r\n    const productCreatedDateOnly = new Date(productCreatedDate.getFullYear(), productCreatedDate.getMonth(), productCreatedDate.getDate()).getTime();\r\n    return productCreatedDateOnly > saleDateOnly;\r\n  })();\r\n\r\n  return (\r\n    <div className=\"space-y-4 p-4 border rounded-lg bg-gray-50\">\r\n      <div className=\"flex justify-between items-start\">\r\n        <h3 className=\"text-sm font-medium\">Item {index + 1}</h3>\r\n        <div className=\"flex space-x-2\">\r\n          {/* Clear form button */}\r\n          <Button\r\n            variant=\"outline\"\r\n            size=\"sm\"\r\n            onClick={handleClearForm}\r\n            className=\"text-gray-600 hover:text-gray-800\"\r\n          >\r\n            <Eraser className=\"h-4 w-4 mr-1\" />\r\n            <span className=\"hidden sm:inline\">Clear</span>\r\n          </Button>\r\n\r\n          <Button\r\n            variant=\"ghost\"\r\n            size=\"sm\"\r\n            onClick={() => onRemove(index)}\r\n            className=\"text-destructive hover:text-destructive\"\r\n          >\r\n            <Trash2 className=\"h-4 w-4\" />\r\n            <span className=\"sr-only\">Remove Item</span>\r\n          </Button>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"space-y-2\">\r\n        <Label htmlFor={`description-${index}`} className=\"text-sm font-medium\">Product / Service</Label>\r\n        <div className=\"flex space-x-2\">\r\n          <div className=\"flex-grow relative\">\r\n            <Textarea\r\n              id={`description-${index}`}\r\n              name=\"description\"\r\n              value={newProductName}\r\n              onChange={handleChange}\r\n              placeholder=\"Enter product name\"\r\n              onFocus={() => newProductName.trim() !== '' && setShowSuggestions(true)}\r\n              onBlur={handleDescriptionBlur}\r\n              onKeyDown={(e) => {\r\n                if (e.key === 'Enter' && !e.shiftKey) {\r\n                  e.preventDefault();\r\n                  document.getElementById(`quantity-${index}`)?.focus();\r\n                }\r\n              }}\r\n              className={isMobile ? \"min-h-16 text-base\" : \"\"}\r\n            />\r\n\r\n            {/* Display auto-suggestions when typing */}\r\n            {showSuggestions && newProductName.trim() !== '' && filteredProducts.length > 0 && (\r\n              <div className=\"absolute z-10 mt-1 w-full bg-white border rounded-md shadow-lg max-h-60 overflow-auto\">\r\n                {filteredProducts.map((product) => (\r\n                  <div\r\n                    key={product.id}\r\n                    className=\"px-4 py-2 hover:bg-gray-100 cursor-pointer flex justify-between items-center\"\r\n                    onClick={() => handleProductSelect(product)}\r\n                  >\r\n                    <div className=\"flex items-center\">\r\n                      <ProductImage imageUrl={product.imageUrl} alt={product.name} size=\"sm\" />\r\n                      <div className=\"ml-3\">\r\n                        <div className=\"font-medium flex items-center gap-2\">\r\n                          {product.name}\r\n                          {product.category && (\r\n                            <Badge variant=\"secondary\" className=\"text-[10px] px-1.5 py-0 h-4 bg-gray-100 text-gray-500 font-normal\">\r\n                              {product.category}\r\n                            </Badge>\r\n                          )}\r\n                        </div>\r\n                        <div className=\"text-xs text-gray-500\">\r\n                          {canViewSellingPrice ? `${currency} ${product.sellingPrice.toFixed(2)}` : 'Price Hidden'}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"text-xs\">\r\n                      {parseFloat(product.quantity.toFixed(5)).toString()} in stock\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Date warning */}\r\n          {showDateWarning && (\r\n            <div className=\"mt-2 p-3 bg-red-50 border border-red-200 rounded-md\">\r\n              <p className=\"text-sm text-red-700 font-medium\">\r\n                🚫 Error: This product was created after the sale date. The sale cannot be created or updated.\r\n              </p>\r\n              <p className=\"text-xs text-red-600 mt-1\">\r\n                Please adjust the sale date or select a different product to continue.\r\n              </p>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {isMobile ? (\r\n        // Mobile layout: 2x2 grid for better touch experience\r\n        <div className=\"space-y-4\">\r\n          {/* First row: Quantity and Price */}\r\n          <div className=\"grid grid-cols-2 gap-3\">\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor={`quantity-${index}`} className=\"text-sm font-medium\">Quantity</Label>\r\n              <Input\r\n                id={`quantity-${index}`}\r\n                name=\"quantity\"\r\n                type=\"text\"\r\n                inputMode=\"decimal\"\r\n                value={quantityInput}\r\n                onChange={handleChange}\r\n                onKeyDown={(e) => {\r\n                  if (e.key === 'Enter') {\r\n                    e.preventDefault();\r\n                    document.getElementById(`price-${index}`)?.focus();\r\n                  }\r\n                }}\r\n                className=\"h-12 text-lg\"\r\n              />\r\n            </div>\r\n\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor={`price-${index}`} className=\"text-sm font-medium\">Price per unit</Label>\r\n              <Input\r\n                id={`price-${index}`}\r\n                name=\"price\"\r\n                type=\"text\"\r\n                inputMode=\"decimal\"\r\n                value={priceInput}\r\n                onChange={handleChange}\r\n                onKeyDown={(e) => {\r\n                  if (e.key === 'Enter') {\r\n                    e.preventDefault();\r\n                    const nextField = document.getElementById(`price-${index}`) as HTMLElement;\r\n                    nextField?.focus();\r\n                  }\r\n                }}\r\n                className=\"h-12 text-lg\"\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n\r\n          {/* Second row: Discount and Cost */}\r\n          <div className=\"grid grid-cols-2 gap-3\">\r\n            <div className=\"space-y-2\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <Label className=\"text-sm font-medium\">Discount</Label>\r\n                <select\r\n                  value={item.discountType || 'percentage'}\r\n                  onChange={(e) => {\r\n                    const discountType = e.target.value as 'percentage' | 'amount';\r\n                    const updatedItem = { ...item, discountType };\r\n                    if (discountType === 'percentage') {\r\n                      updatedItem.discountAmount = 0;\r\n                      setDiscountAmountInput('0');\r\n                    } else {\r\n                      updatedItem.discountPercentage = 0;\r\n                      setDiscountPercentInput('0');\r\n                    }\r\n                    onUpdate(index, updatedItem);\r\n                  }}\r\n                  className=\"flex-shrink-0 w-12 h-8 text-xs border border-input bg-background px-1 rounded-md\"\r\n                >\r\n                  <option value=\"percentage\">%</option>\r\n                  <option value=\"amount\">{currency}</option>\r\n                </select>\r\n              </div>\r\n              <Input\r\n                name={item.discountType === 'amount' ? 'discountAmount' : 'discountPercentage'}\r\n                type=\"text\"\r\n                inputMode=\"decimal\"\r\n                value={item.discountType === 'amount' ? discountAmountInput : discountPercentInput}\r\n                onChange={handleChange}\r\n                placeholder=\"0\"\r\n                onKeyDown={(e) => {\r\n                  if (e.key === 'Enter') {\r\n                    e.preventDefault();\r\n                    document.getElementById('taxRate')?.focus();\r\n                  }\r\n                }}\r\n                className=\"h-12 text-lg\"\r\n              />\r\n            </div>\r\n\r\n            {canViewCostPrice && (\r\n              <div className=\"space-y-2\">\r\n                <Collapsible open={costVisible} onOpenChange={setCostVisible}>\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <Label className=\"text-sm font-medium text-gray-500\">\r\n                      Cost Info\r\n                    </Label>\r\n                    <CollapsibleTrigger asChild>\r\n                      <Button variant=\"ghost\" size=\"sm\" className=\"p-1 h-8 w-8\">\r\n                        {costVisible ? <EyeOff className=\"h-4 w-4 text-gray-500\" /> : <Eye className=\"h-4 w-4 text-gray-500\" />}\r\n                      </Button>\r\n                    </CollapsibleTrigger>\r\n                  </div>\r\n                  <CollapsibleContent className=\"space-y-4 pt-2\">\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor={`cost-${index}`} className=\"text-xs text-gray-500\">Cost per unit</Label>\r\n                      <Input\r\n                        id={`cost-${index}`}\r\n                        name=\"cost\"\r\n                        type=\"text\"\r\n                        inputMode=\"decimal\"\r\n                        value={costInput}\r\n                        onChange={handleChange}\r\n                        className=\"h-12 text-lg\"\r\n                      />\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor={`total-cost-${index}`} className=\"text-xs text-gray-500\">Total Cost</Label>\r\n                      <Input\r\n                        id={`total-cost-${index}`}\r\n                        name=\"totalCost\"\r\n                        type=\"text\"\r\n                        inputMode=\"decimal\"\r\n                        value={formatNumber(item.cost * item.quantity)}\r\n                        onChange={handleTotalCostChange}\r\n                        className=\"h-12 text-lg font-semibold bg-gray-50\"\r\n                      />\r\n                    </div>\r\n                    <p className=\"text-xs text-muted-foreground\">(Internal use only)</p>\r\n                  </CollapsibleContent>\r\n                </Collapsible>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      ) : (\r\n        // Desktop layout: Original 4-column grid\r\n        <div className=\"grid grid-cols-4 gap-4\">\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor={`quantity-${index}`}>Quantity</Label>\r\n            <Input\r\n              id={`quantity-${index}`}\r\n              name=\"quantity\"\r\n              type=\"text\"\r\n              inputMode=\"decimal\"\r\n              value={quantityInput}\r\n              onChange={handleChange}\r\n              onKeyDown={(e) => {\r\n                if (e.key === 'Enter') {\r\n                  e.preventDefault();\r\n                  document.getElementById(`price-${index}`)?.focus();\r\n                }\r\n              }}\r\n            />\r\n          </div>\r\n\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor={`price-${index}`}>Price per unit</Label>\r\n            <Input\r\n              id={`price-${index}`}\r\n              name=\"price\"\r\n              type=\"text\"\r\n              inputMode=\"decimal\"\r\n              value={priceInput}\r\n              onChange={handleChange}\r\n              onKeyDown={(e) => {\r\n                if (e.key === 'Enter') {\r\n                  e.preventDefault();\r\n                  const nextField = document.querySelector(`input[name=\"${item.discountType === 'amount' ? 'discountAmount' : 'discountPercentage'}\"]`) as HTMLElement;\r\n                  nextField?.focus();\r\n                }\r\n              }}\r\n            />\r\n          </div>\r\n\r\n\r\n          <div className=\"space-y-2\">\r\n            <Label>Discount</Label>\r\n            <div className=\"flex gap-1\">\r\n              <select\r\n                value={item.discountType || 'percentage'}\r\n                onChange={(e) => {\r\n                  const discountType = e.target.value as 'percentage' | 'amount';\r\n                  const updatedItem = { ...item, discountType };\r\n                  if (discountType === 'percentage') {\r\n                    updatedItem.discountAmount = 0;\r\n                    setDiscountAmountInput('0');\r\n                  } else {\r\n                    updatedItem.discountPercentage = 0;\r\n                    setDiscountPercentInput('0');\r\n                  }\r\n                  onUpdate(index, updatedItem);\r\n                }}\r\n                className=\"flex-shrink-0 w-12 text-xs border border-input bg-background px-1 py-2 rounded-md\"\r\n              >\r\n                <option value=\"percentage\">%</option>\r\n                <option value=\"amount\">{currency}</option>\r\n              </select>\r\n              <Input\r\n                name={item.discountType === 'amount' ? 'discountAmount' : 'discountPercentage'}\r\n                type=\"text\"\r\n                inputMode=\"decimal\"\r\n                value={item.discountType === 'amount' ? discountAmountInput : discountPercentInput}\r\n                onChange={handleChange}\r\n                placeholder=\"0\"\r\n                onKeyDown={(e) => {\r\n                  if (e.key === 'Enter') {\r\n                    e.preventDefault();\r\n                    document.getElementById('taxRate')?.focus();\r\n                  }\r\n                }}\r\n                className=\"flex-1\"\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          {canViewCostPrice && (\r\n            <div className=\"space-y-2\">\r\n              <Popover>\r\n                <div className=\"flex items-center justify-between\">\r\n                  <Label className=\"text-gray-500\">\r\n                    Cost Info\r\n                  </Label>\r\n                  <TooltipProvider>\r\n                    <Tooltip>\r\n                      <TooltipTrigger asChild>\r\n                        <PopoverTrigger asChild>\r\n                          <Button variant=\"ghost\" size=\"sm\" className=\"p-0 h-6 w-6\">\r\n                            <Eye className=\"h-4 w-4 text-gray-500\" />\r\n                          </Button>\r\n                        </PopoverTrigger>\r\n                      </TooltipTrigger>\r\n                      <TooltipContent>\r\n                        <p>Click to view/edit cost</p>\r\n                      </TooltipContent>\r\n                    </Tooltip>\r\n                  </TooltipProvider>\r\n                </div>\r\n                <PopoverContent className=\"w-64 p-4 bg-white shadow-xl border\">\r\n                  <div className=\"space-y-4\">\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor={`cost-popover-${index}`} className=\"text-xs\">Cost per unit</Label>\r\n                      <Input\r\n                        id={`cost-popover-${index}`}\r\n                        name=\"cost\"\r\n                        type=\"text\"\r\n                        inputMode=\"decimal\"\r\n                        value={costInput}\r\n                        onChange={handleChange}\r\n                      />\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor={`total-cost-popover-${index}`} className=\"text-xs\">Total Cost (for {item.quantity} units)</Label>\r\n                      <Input\r\n                        id={`total-cost-popover-${index}`}\r\n                        name=\"totalCost\"\r\n                        type=\"text\"\r\n                        value={formatNumber(item.cost * item.quantity)}\r\n                        onChange={handleTotalCostChange}\r\n                        className=\"font-bold bg-gray-50\"\r\n                      />\r\n                    </div>\r\n                    <div className=\"pt-2 border-t\">\r\n                      <p className=\"text-[10px] text-muted-foreground\">Costs entered here only apply to this specific sale and do not change the product's base price in inventory.</p>\r\n                    </div>\r\n                  </div>\r\n                </PopoverContent>\r\n              </Popover>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {/* Item Total */}\r\n      <div className=\"pt-2 border-t mt-2\">\r\n        <div className=\"flex justify-end items-center space-y-1 flex-col\">\r\n          {((item.discountPercentage || 0) > 0 || (item.discountAmount || 0) > 0) && (\r\n            <div className=\"flex justify-end items-center w-full\">\r\n              <span className=\"text-xs text-muted-foreground mr-2\">Subtotal:</span>\r\n              <span className=\"text-xs text-muted-foreground line-through\">\r\n                {currency} {formatNumber(subtotal)}\r\n              </span>\r\n            </div>\r\n          )}\r\n          {((item.discountPercentage || 0) > 0 || (item.discountAmount || 0) > 0) && (\r\n            <div className=\"flex justify-end items-center w-full\">\r\n              <span className=\"text-xs text-green-600 mr-2\">\r\n                Discount {item.discountType === 'amount' ? '' : `(${item.discountPercentage}%)`}:\r\n              </span>\r\n              <span className=\"text-xs text-green-600\">\r\n                -{currency} {formatNumber(discountAmount)}\r\n              </span>\r\n            </div>\r\n          )}\r\n          <div className=\"flex justify-end items-center w-full\">\r\n            <span className=\"text-sm font-medium mr-2\">Total:</span>\r\n            <span className=\"text-sm font-bold\">\r\n              {currency} {formatNumber(itemTotal)}\r\n            </span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ProductSaleItemInput;\r\n","\r\nimport React from \"react\";\r\nimport { Plus } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { SaleItem } from \"@/types\";\r\nimport ProductSaleItemInput from \"@/components/ProductSaleItemInput\";\r\n\r\ninterface SaleItemsProps {\r\n  items: SaleItem[];\r\n  onAddItem: () => void;\r\n  onUpdateItem: (index: number, updatedItem: SaleItem) => void;\r\n  onRemoveItem: (index: number) => void;\r\n  saleDate?: string;\r\n}\r\n\r\nconst SaleItems: React.FC<SaleItemsProps> = ({\r\n  items,\r\n  onAddItem,\r\n  onUpdateItem,\r\n  onRemoveItem,\r\n  saleDate,\r\n}) => {\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      <h3 className=\"text-lg font-semibold\">Items/Services</h3>\r\n\r\n      <div className=\"space-y-4\">\r\n        {items.map((item, index) => (\r\n          <div\r\n            key={index}\r\n            id={`sale-item-${index}`}\r\n          >\r\n            <ProductSaleItemInput\r\n              item={item}\r\n              index={index}\r\n              onUpdate={onUpdateItem}\r\n              onRemove={onRemoveItem}\r\n              saleDate={saleDate}\r\n            />\r\n          </div>\r\n        ))}\r\n\r\n        <Button\r\n          type=\"button\"\r\n          variant=\"outline\"\r\n          size=\"sm\"\r\n          onClick={() => onAddItem()}\r\n          className=\"gap-1 w-full mt-2\"\r\n        >\r\n          <Plus className=\"h-4 w-4\" />\r\n          Add Item\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SaleItems;\r\n","\r\nimport React from \"react\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\n\r\ninterface TaxRateInputProps {\r\n  taxRateInput: string;\r\n  onTaxRateChange: (e: React.ChangeEvent<HTMLInputElement>) => void;\r\n  errors: {\r\n    taxRate?: string;\r\n  };\r\n}\r\n\r\nconst TaxRateInput: React.FC<TaxRateInputProps> = ({\r\n  taxRateInput,\r\n  onTaxRateChange,\r\n  errors,\r\n}) => {\r\n  return (\r\n    <div className=\"grid gap-3\">\r\n      <Label htmlFor=\"taxRate\">Tax Rate (%)</Label>\r\n      <Input\r\n        id=\"taxRate\"\r\n        name=\"taxRate\"\r\n        type=\"text\"\r\n        inputMode=\"decimal\"\r\n        value={taxRateInput}\r\n        onChange={onTaxRateChange}\r\n        onKeyDown={(e) => {\r\n          if (e.key === 'Enter') {\r\n            e.preventDefault();\r\n            // Focus the payment status selector\r\n            const paymentStatusSelect = document.querySelector('[data-payment-status-select=\"true\"]') as HTMLElement;\r\n            if (paymentStatusSelect) {\r\n              paymentStatusSelect.focus();\r\n            } else {\r\n              // Fallback to submit button\r\n              const submitButton = document.querySelector('button[type=\"submit\"]') as HTMLElement;\r\n              submitButton?.focus();\r\n            }\r\n          }\r\n        }}\r\n        className={errors.taxRate ? 'border-red-500' : ''}\r\n      />\r\n      {errors.taxRate && (\r\n        <p className=\"text-red-500 text-xs\">{errors.taxRate}</p>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default TaxRateInput;\r\n","\r\nimport React from \"react\";\r\nimport { formatNumber } from \"@/lib/utils\";\r\n\r\ninterface SaleTotalsProps {\r\n  totalAmount: number;\r\n  taxAmount: number;\r\n  grandTotal: number;\r\n  taxRate: number;\r\n  currency: string;\r\n}\r\n\r\nconst SaleTotals: React.FC<SaleTotalsProps> = ({\r\n  totalAmount,\r\n  taxAmount,\r\n  grandTotal,\r\n  taxRate,\r\n  currency,\r\n}) => {\r\n  // Check if we should show the tax row\r\n  const showTaxRow = taxRate > 0;\r\n\r\n  return (\r\n    <div className=\"bg-slate-50 p-4 rounded-md border\">\r\n      <div className=\"flex flex-col space-y-2\">\r\n        <div className=\"flex justify-between items-center bg-gray-100 px-2 py-1 rounded-sm\">\r\n          <h3 className=\"font-medium\">Subtotal</h3>\r\n          <span className=\"font-medium\">\r\n            {currency} {formatNumber(totalAmount)}\r\n          </span>\r\n        </div>\r\n        {showTaxRow && (\r\n          <div className=\"flex justify-between items-center bg-gray-100 px-2 py-1 rounded-sm\">\r\n            <h3 className=\"font-medium\">Tax ({taxRate}%)</h3>\r\n            <span className=\"font-medium\">\r\n              {currency} {formatNumber(taxAmount)}\r\n            </span>\r\n          </div>\r\n        )}\r\n        <div className=\"h-px bg-gray-300 my-1\"></div>\r\n        <div className=\"flex justify-between items-center bg-gray-100 px-2 py-1 rounded-sm\">\r\n          <h3 className=\"font-semibold\">Grand Total</h3>\r\n          <span className=\"text-xl font-bold\">\r\n            {currency} {formatNumber(grandTotal)}\r\n          </span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SaleTotals;\r\n","import React from 'react';\r\nimport { Card, CardContent } from '@/components/ui/card';\r\nimport SaleItems from '@/components/sales/SaleItems';\r\nimport TaxRateInput from '@/components/sales/TaxRateInput';\r\nimport SaleTotals from '@/components/sales/SaleTotals';\r\nimport { SaleItem, FormErrors } from '@/types';\r\n\r\ninterface SaleItemsManagerProps {\r\n  items: SaleItem[];\r\n  onAddItem: () => void;\r\n  onUpdateItem: (index: number, updatedItem: SaleItem) => void;\r\n  onRemoveItem: (index: number) => void;\r\n  taxRateInput: string;\r\n  onTaxRateChange: (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => void;\r\n  errors: FormErrors;\r\n  totalAmount: number;\r\n  taxAmount: number;\r\n  grandTotal: number;\r\n  taxRate: number;\r\n  currency: string;\r\n  saleDate?: string;\r\n}\r\n\r\nconst SaleItemsManager: React.FC<SaleItemsManagerProps> = ({\r\n  items,\r\n  onAddItem,\r\n  onUpdateItem,\r\n  onRemoveItem,\r\n  taxRateInput,\r\n  onTaxRateChange,\r\n  errors,\r\n  totalAmount,\r\n  taxAmount,\r\n  grandTotal,\r\n  taxRate,\r\n  currency,\r\n  saleDate,\r\n}) => {\r\n  // Track previous items to detect changes\r\n  const prevItemsRef = React.useRef<SaleItem[]>(items);\r\n\r\n  // Auto-scroll to the SPECIFIC item that was added or updated\r\n  React.useEffect(() => {\r\n    const prevItems = prevItemsRef.current;\r\n\r\n    // Find the index of the item that changed\r\n    let changedIndex = -1;\r\n\r\n    // Case 1: Item added (new array is longer)\r\n    if (items.length > prevItems.length) {\r\n      changedIndex = items.length - 1;\r\n    }\r\n    // Case 2: Item updated (length same, check quantities)\r\n    else if (items.length === prevItems.length) {\r\n      changedIndex = items.findIndex((item, index) => {\r\n        const prevItem = prevItems[index];\r\n        return prevItem && item.quantity !== prevItem.quantity;\r\n      });\r\n    }\r\n\r\n    // Update previous ref for next render\r\n    prevItemsRef.current = items;\r\n\r\n    // Perform scroll if a change was detected\r\n    if (changedIndex !== -1) {\r\n      // Use setTimeout to ensure DOM has updated\r\n      setTimeout(() => {\r\n        const element = document.getElementById(`sale-item-${changedIndex}`);\r\n        if (element) {\r\n          element.scrollIntoView({ behavior: 'smooth', block: 'center' });\r\n        }\r\n      }, 150);\r\n    }\r\n  }, [items]);\r\n\r\n  return (\r\n    <Card className=\"mb-6\">\r\n      <CardContent className=\"pt-6 space-y-6\">\r\n        <SaleItems\r\n          items={items}\r\n          onAddItem={onAddItem}\r\n          onUpdateItem={onUpdateItem}\r\n          onRemoveItem={onRemoveItem}\r\n          saleDate={saleDate}\r\n        />\r\n\r\n        <TaxRateInput\r\n          taxRateInput={taxRateInput}\r\n          onTaxRateChange={onTaxRateChange}\r\n          errors={errors}\r\n        />\r\n\r\n        <SaleTotals\r\n          totalAmount={totalAmount}\r\n          taxAmount={taxAmount}\r\n          grandTotal={grandTotal}\r\n          taxRate={taxRate}\r\n          currency={currency}\r\n        />\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default SaleItemsManager;","\r\nimport React from \"react\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\n\r\ninterface PaymentStatusSelectorProps {\r\n  paymentStatus: string;\r\n  onPaymentStatusChange: (value: string) => void;\r\n}\r\n\r\nconst PaymentStatusSelector: React.FC<PaymentStatusSelectorProps> = ({\r\n  paymentStatus,\r\n  onPaymentStatusChange,\r\n}) => {\r\n  return (\r\n    <div className=\"grid gap-3\">\r\n      <Label htmlFor=\"paymentStatus\">Payment Status</Label>\r\n      <Select\r\n        value={paymentStatus}\r\n        onValueChange={onPaymentStatusChange}\r\n      >\r\n        <SelectTrigger \r\n          className=\"w-full\"\r\n          data-payment-status-select=\"true\"\r\n          onKeyDown={(e) => {\r\n            if (e.key === 'Enter') {\r\n              e.preventDefault();\r\n              // Focus the cash account switch\r\n              const cashAccountSwitch = document.querySelector('[data-cash-account-switch=\"true\"]') as HTMLElement;\r\n              if (cashAccountSwitch) {\r\n                cashAccountSwitch.focus();\r\n              } else {\r\n                // Fallback to submit button if no cash account section\r\n                const submitButton = document.querySelector('button[type=\"submit\"]') as HTMLElement;\r\n                submitButton?.focus();\r\n              }\r\n            }\r\n          }}\r\n        >\r\n          <SelectValue placeholder=\"Select payment status\" />\r\n        </SelectTrigger>\r\n        <SelectContent>\r\n          <SelectItem value=\"Paid\">Paid</SelectItem>\r\n          <SelectItem value=\"NOT PAID\">NOT PAID</SelectItem>\r\n          <SelectItem value=\"Quote\">Quote</SelectItem>\r\n          <SelectItem value=\"Installment Sale\">Installment Sale</SelectItem>\r\n        </SelectContent>\r\n      </Select>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PaymentStatusSelector;\r\n","import createLucideIcon from '../createLucideIcon';\n\n/**\n * @component @name PenLine\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMTIgMjBoOSIgLz4KICA8cGF0aCBkPSJNMTYuMzc2IDMuNjIyYTEgMSAwIDAgMSAzLjAwMiAzLjAwMkw3LjM2OCAxOC42MzVhMiAyIDAgMCAxLS44NTUuNTA2bC0yLjg3Mi44MzhhLjUuNSAwIDAgMS0uNjItLjYybC44MzgtMi44NzJhMiAyIDAgMCAxIC41MDYtLjg1NHoiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/pen-line\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst PenLine = createLucideIcon('PenLine', [\n  ['path', { d: 'M12 20h9', key: 't2du7b' }],\n  [\n    'path',\n    {\n      d: 'M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z',\n      key: '1ykcvy',\n    },\n  ],\n]);\n\nexport default PenLine;\n","import createLucideIcon from '../createLucideIcon';\n\n/**\n * @component @name Link\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMTAgMTNhNSA1IDAgMCAwIDcuNTQuNTRsMy0zYTUgNSAwIDAgMC03LjA3LTcuMDdsLTEuNzIgMS43MSIgLz4KICA8cGF0aCBkPSJNMTQgMTFhNSA1IDAgMCAwLTcuNTQtLjU0bC0zIDNhNSA1IDAgMCAwIDcuMDcgNy4wN2wxLjcxLTEuNzEiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/link\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Link = createLucideIcon('Link', [\n  ['path', { d: 'M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71', key: '1cjeqo' }],\n  ['path', { d: 'M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71', key: '19qd67' }],\n]);\n\nexport default Link;\n","import React, { useState } from 'react';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Calendar } from '@/components/ui/calendar';\r\nimport { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover';\r\nimport { formatNumber, cn } from '@/lib/utils';\r\nimport { InstallmentPayment } from '@/hooks/useInstallmentPayments';\r\nimport { PaymentChange } from '@/hooks/useLocalPaymentChanges';\r\nimport { format } from 'date-fns';\r\nimport { Trash2, Clock, Check, X, Edit3, Link, CalendarIcon } from 'lucide-react';\r\n\r\ninterface CashAccount {\r\n  id: string;\r\n  name: string;\r\n  description?: string;\r\n  isDefault: boolean;\r\n}\r\n\r\ninterface InstallmentPaymentHistoryProps {\r\n  payments: InstallmentPayment[];\r\n  currency: string;\r\n  isLoading?: boolean;\r\n  pendingChanges?: PaymentChange[];\r\n  isLocalMode?: boolean;\r\n  onStageChange?: (change: PaymentChange) => void;\r\n  cashAccounts?: CashAccount[];\r\n  onLinkToCash?: (paymentId: string, accountId: string) => Promise<void>;\r\n  onUpdatePayment?: (paymentId: string, updates: { amount?: number; notes?: string; paymentDate?: Date }) => Promise<void>;\r\n}\r\n\r\nconst InstallmentPaymentHistory: React.FC<InstallmentPaymentHistoryProps> = ({\r\n  payments,\r\n  currency,\r\n  isLoading,\r\n  pendingChanges = [],\r\n  isLocalMode = false,\r\n  onStageChange,\r\n  cashAccounts = [],\r\n  onLinkToCash,\r\n  onUpdatePayment,\r\n}) => {\r\n  const [editingPayment, setEditingPayment] = useState<string | null>(null);\r\n  const [editingField, setEditingField] = useState<'amount' | 'notes' | 'date' | null>(null);\r\n  const [editAmount, setEditAmount] = useState<string>(''); // Changed to string to allow empty value\r\n  const [editNotes, setEditNotes] = useState<string>('');\r\n  const [editDate, setEditDate] = useState<Date | undefined>(undefined);\r\n  const [linkingPayment, setLinkingPayment] = useState<string | null>(null);\r\n  const [selectedAccountId, setSelectedAccountId] = useState<string>('');\r\n\r\n  const handleStartEdit = (payment: InstallmentPayment, field?: 'amount' | 'notes' | 'date') => {\r\n    setEditingPayment(payment.id);\r\n    setEditingField(field || null);\r\n    setEditAmount(getDisplayAmount(payment).toString()); // Convert to string\r\n    setEditNotes(getDisplayNotes(payment) || '');\r\n    setEditDate(payment.paymentDate);\r\n  };\r\n\r\n  const handleDoubleClickAmount = (payment: InstallmentPayment) => {\r\n    if (!isLocalMode || !onStageChange) return;\r\n    const status = getPaymentStatus(payment.id);\r\n    if (status === 'deleted') return;\r\n    \r\n    handleStartEdit(payment, 'amount');\r\n  };\r\n\r\n  const handleDoubleClickNotes = (payment: InstallmentPayment) => {\r\n    if (!isLocalMode || !onStageChange) return;\r\n    const status = getPaymentStatus(payment.id);\r\n    if (status === 'deleted') return;\r\n    \r\n    handleStartEdit(payment, 'notes');\r\n  };\r\n\r\n  const handleDoubleClickDate = async (payment: InstallmentPayment) => {\r\n    if (!onUpdatePayment) return;\r\n    const status = getPaymentStatus(payment.id);\r\n    if (status === 'deleted') return;\r\n    \r\n    handleStartEdit(payment, 'date');\r\n  };\r\n\r\n  const handleDateSelect = async (payment: InstallmentPayment, date: Date | undefined) => {\r\n    if (!date || !onUpdatePayment) return;\r\n    \r\n    console.log('🔵 Date selected:', {\r\n      paymentId: payment.id,\r\n      oldDate: payment.paymentDate,\r\n      newDate: date,\r\n      formattedNew: format(date, 'yyyy-MM-dd')\r\n    });\r\n    \r\n    try {\r\n      await onUpdatePayment(payment.id, { paymentDate: date });\r\n      console.log('✅ Date update successful');\r\n      \r\n      // Update local state immediately for instant UI feedback\r\n      if (onStageChange) {\r\n        onStageChange({\r\n          id: payment.id,\r\n          type: 'update',\r\n          originalPayment: payment,\r\n          updatedData: { paymentDate: date }\r\n        });\r\n      }\r\n      \r\n      // Clear editing state only after successful update\r\n      setEditingPayment(null);\r\n      setEditingField(null);\r\n      setEditDate(undefined);\r\n    } catch (error) {\r\n      console.error('❌ Error updating payment date:', error);\r\n      // Reset to original date on error\r\n      setEditDate(payment.paymentDate);\r\n    }\r\n  };\r\n\r\n  const handleSaveEdit = async (payment: InstallmentPayment) => {\r\n    if (!onStageChange && !onUpdatePayment) return;\r\n\r\n    // Convert string back to number, default to 0 if empty or invalid\r\n    const numericAmount = editAmount === '' ? 0 : parseFloat(editAmount) || 0;\r\n\r\n    if (onStageChange) {\r\n      // Local mode - stage the update\r\n      onStageChange({\r\n        id: payment.id,\r\n        type: 'update',\r\n        originalPayment: payment,\r\n        updatedData: {\r\n          amount: numericAmount,\r\n          notes: editNotes.trim() || undefined\r\n        }\r\n      });\r\n    } else if (onUpdatePayment) {\r\n      // Direct update mode - skip date updates as they're handled separately\r\n      await onUpdatePayment(payment.id, {\r\n        amount: editingField === 'amount' ? numericAmount : undefined,\r\n        notes: editingField === 'notes' ? (editNotes.trim() || undefined) : undefined,\r\n      });\r\n    }\r\n\r\n    setEditingPayment(null);\r\n    setEditingField(null);\r\n  };\r\n\r\n  const handleCancelEdit = () => {\r\n    setEditingPayment(null);\r\n    setEditingField(null);\r\n    setEditAmount('');\r\n    setEditNotes('');\r\n    setEditDate(undefined);\r\n  };\r\n\r\n  const handleStageDelete = (payment: InstallmentPayment) => {\r\n    if (!onStageChange) return;\r\n    \r\n    // Show different confirmation messages based on payment amount\r\n    const isZeroPayment = payment.amount === 0;\r\n    const confirmMessage = isZeroPayment \r\n      ? 'Are you sure you want to remove this zero-amount payment entry?'\r\n      : 'Are you sure you want to mark this payment for deletion?';\r\n    \r\n    if (window.confirm(confirmMessage)) {\r\n      console.log('🟡 STAGING deletion locally - NO DATABASE CALL');\r\n      \r\n      // Stage the deletion directly without any async operations\r\n      onStageChange({\r\n        id: payment.id,\r\n        type: 'delete',\r\n        originalPayment: payment\r\n      });\r\n      \r\n      console.log('✅ Deletion staged successfully');\r\n    }\r\n  };\r\n\r\n  const getPaymentStatus = (paymentId: string) => {\r\n    const change = pendingChanges.find(c => c.id === paymentId);\r\n    if (change?.type === 'delete') return 'deleted';\r\n    if (change?.type === 'update') return 'modified';\r\n    return 'original';\r\n  };\r\n\r\n  const getDisplayAmount = (payment: InstallmentPayment) => {\r\n    const change = pendingChanges.find(c => c.id === payment.id && c.type === 'update');\r\n    return change?.updatedData?.amount || payment.amount;\r\n  };\r\n\r\n  const getDisplayNotes = (payment: InstallmentPayment) => {\r\n    const change = pendingChanges.find(c => c.id === payment.id && c.type === 'update');\r\n    return change?.updatedData?.notes || payment.notes;\r\n  };\r\n\r\n  // Helper function to check if a payment can be deleted\r\n  const canDeletePayment = (payment: InstallmentPayment) => {\r\n    if (!isLocalMode || !onStageChange) return false;\r\n    const status = getPaymentStatus(payment.id);\r\n    return status !== 'deleted'; // Allow deletion of any payment that's not already marked for deletion\r\n  };\r\n\r\n  const handleStartCashLink = (paymentId: string) => {\r\n    setLinkingPayment(paymentId);\r\n    setSelectedAccountId('');\r\n  };\r\n\r\n  const handleCancelCashLink = () => {\r\n    setLinkingPayment(null);\r\n    setSelectedAccountId('');\r\n  };\r\n\r\n  const handleConfirmCashLink = async (payment: InstallmentPayment) => {\r\n    if (!onLinkToCash || !selectedAccountId) return;\r\n    \r\n    try {\r\n      await onLinkToCash(payment.id, selectedAccountId);\r\n      setLinkingPayment(null);\r\n      setSelectedAccountId('');\r\n    } catch (error) {\r\n      console.error('Error linking payment to cash account:', error);\r\n    }\r\n  };\r\n\r\n  const getCashAccountName = (cashTransactionId?: string) => {\r\n    if (!cashTransactionId) return null;\r\n    // This is a simplified version - in a real implementation, you might want to\r\n    // fetch the actual account name or pass it as part of the payment data\r\n    return 'Linked';\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <Card className=\"border-blue-200 bg-blue-50\">\r\n        <CardHeader className=\"pb-3\">\r\n          <CardTitle className=\"text-sm text-blue-800\">Payment History</CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"text-sm text-muted-foreground\">Loading payment history...</div>\r\n        </CardContent>\r\n      </Card>\r\n    );\r\n  }\r\n\r\n  if (payments.length === 0) {\r\n    return (\r\n      <Card className=\"border-blue-200 bg-blue-50\">\r\n        <CardHeader className=\"pb-3\">\r\n          <CardTitle className=\"text-sm text-blue-800\">Payment History</CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"text-sm text-muted-foreground\">No payments recorded yet</div>\r\n        </CardContent>\r\n      </Card>\r\n    );\r\n  }\r\n\r\n  const totalPaid = payments.reduce((sum, payment) => {\r\n    const status = getPaymentStatus(payment.id);\r\n    if (status === 'deleted') return sum;\r\n    return sum + getDisplayAmount(payment);\r\n  }, 0);\r\n\r\n  const showInlineEdit = isLocalMode && onStageChange;\r\n  console.log('InstallmentPaymentHistory - isLocalMode:', isLocalMode, 'onStageChange:', !!onStageChange, 'showInlineEdit:', showInlineEdit);\r\n\r\n  return (\r\n    <Card className=\"border-blue-200 bg-blue-50\">\r\n      <CardHeader className=\"pb-3\">\r\n        <CardTitle className=\"text-sm text-blue-800 flex items-center justify-between\">\r\n          <div className=\"flex items-center gap-2\">\r\n            Payment History\r\n            {isLocalMode && <Clock className=\"h-3 w-3 text-amber-600\" />}\r\n            {pendingChanges.length > 0 && (\r\n              <Badge variant=\"outline\" className=\"text-xs bg-amber-100 text-amber-800 border-amber-300\">\r\n                {pendingChanges.length} staged\r\n              </Badge>\r\n            )}\r\n          </div>\r\n          <Badge variant=\"secondary\" className=\"bg-blue-100 text-blue-800 text-xs\">\r\n            Total: {currency} {formatNumber(totalPaid)}\r\n          </Badge>\r\n        </CardTitle>\r\n      </CardHeader>\r\n      <CardContent className=\"p-3 sm:p-6\">\r\n        {/* Desktop editing instructions */}\r\n        {showInlineEdit && (\r\n          <div className=\"hidden sm:block mb-4 text-xs text-muted-foreground bg-blue-50 p-2 rounded border border-blue-200\">\r\n            💡 Double-click on amount or notes to edit. Click delete button to remove payments (including zero amounts).\r\n          </div>\r\n        )}\r\n\r\n        {/* Mobile Card Layout */}\r\n        <div className=\"block sm:hidden space-y-3\">\r\n          {payments.map((payment) => {\r\n            const status = getPaymentStatus(payment.id);\r\n            const displayAmount = getDisplayAmount(payment);\r\n            const displayNotes = getDisplayNotes(payment);\r\n            const isEditing = editingPayment === payment.id;\r\n            const canDelete = canDeletePayment(payment);\r\n            \r\n            return (\r\n              <div \r\n                key={payment.id} \r\n                className={`bg-white rounded-lg p-3 border shadow-sm ${\r\n                  status === 'deleted' ? 'border-red-200 bg-red-50 opacity-60' :\r\n                  status === 'modified' ? 'border-amber-200 bg-amber-50' :\r\n                  'border-gray-200'\r\n                }`}\r\n              >\r\n                 <div className=\"flex justify-between items-start mb-2\">\r\n                   <div className=\"flex items-center gap-2\">\r\n                     {isEditing && editingField === 'date' ? (\r\n                       <Popover>\r\n                         <PopoverTrigger asChild>\r\n                           <Button\r\n                             variant=\"outline\"\r\n                             size=\"sm\"\r\n                             className={cn(\r\n                               \"h-7 text-xs justify-start text-left font-normal\",\r\n                               !editDate && \"text-muted-foreground\"\r\n                             )}\r\n                           >\r\n                             <CalendarIcon className=\"mr-2 h-3 w-3\" />\r\n                             {editDate ? format(editDate, \"MMM dd, yyyy\") : <span>Pick a date</span>}\r\n                           </Button>\r\n                         </PopoverTrigger>\r\n                         <PopoverContent className=\"w-auto p-0\" align=\"start\">\r\n                            <Calendar\r\n                              mode=\"single\"\r\n                              selected={editDate}\r\n                              onSelect={(date) => handleDateSelect(payment, date)}\r\n                              initialFocus\r\n                              className={cn(\"p-3 pointer-events-auto\")}\r\n                            />\r\n                         </PopoverContent>\r\n                       </Popover>\r\n                     ) : (\r\n                       <div \r\n                         className={`text-xs text-muted-foreground ${onUpdatePayment ? 'cursor-pointer hover:text-blue-600' : ''}`}\r\n                         onClick={() => onUpdatePayment && handleDoubleClickDate(payment)}\r\n                         title={onUpdatePayment ? 'Click to edit date' : ''}\r\n                       >\r\n                         {format(payment.paymentDate, 'MMM dd, yyyy')}\r\n                       </div>\r\n                     )}\r\n                     {status === 'deleted' && (\r\n                       <Badge variant=\"outline\" className=\"text-xs bg-red-100 text-red-800 border-red-300\">\r\n                         To Delete\r\n                       </Badge>\r\n                     )}\r\n                     {status === 'modified' && (\r\n                       <Badge variant=\"outline\" className=\"text-xs bg-amber-100 text-amber-800 border-amber-300\">\r\n                         Modified\r\n                       </Badge>\r\n                     )}\r\n                   </div>\r\n                   {isEditing && editingField === 'amount' ? (\r\n                     <div className=\"flex flex-col gap-2 min-w-0 flex-1 ml-2\">\r\n                       <Input\r\n                         type=\"number\"\r\n                         value={editAmount}\r\n                         onChange={(e) => setEditAmount(e.target.value)} // Allow empty string\r\n                         className=\"h-7 text-xs\"\r\n                         step=\"0.01\"\r\n                         min=\"0\"\r\n                         placeholder=\"0\"\r\n                       />\r\n                     </div>\r\n                   ) : (\r\n                     <div className={`text-sm font-semibold ${status === 'deleted' ? 'line-through' : ''}`}>\r\n                       {currency} {formatNumber(displayAmount)}\r\n                     </div>\r\n                   )}\r\n                </div>\r\n                 \r\n                 {isEditing ? (\r\n                   <div className=\"space-y-2\">\r\n                     {editingField === 'notes' && (\r\n                       <Input\r\n                         value={editNotes}\r\n                         onChange={(e) => setEditNotes(e.target.value)}\r\n                         placeholder=\"Payment notes\"\r\n                         className=\"h-7 text-xs\"\r\n                       />\r\n                     )}\r\n                     <div className=\"flex justify-end gap-2\">\r\n                       <Button\r\n                         size=\"sm\"\r\n                         variant=\"outline\"\r\n                         className=\"h-6 px-2 text-xs\"\r\n                         onClick={handleCancelEdit}\r\n                       >\r\n                         <X className=\"h-3 w-3\" />\r\n                       </Button>\r\n                       <Button\r\n                         size=\"sm\"\r\n                         className=\"h-6 px-2 text-xs\"\r\n                         onClick={() => handleSaveEdit(payment)}\r\n                       >\r\n                         <Check className=\"h-3 w-3\" />\r\n                       </Button>\r\n                     </div>\r\n                   </div>\r\n                 ) : (\r\n                  <>\r\n                     {displayNotes && (\r\n                       <div \r\n                         className={`text-xs text-muted-foreground mb-3 ${status === 'deleted' ? 'line-through' : ''} ${onUpdatePayment ? 'cursor-pointer hover:text-blue-600' : ''}`}\r\n                         onClick={() => onUpdatePayment && handleStartEdit(payment, 'notes')}\r\n                         title={onUpdatePayment ? 'Click to edit notes' : ''}\r\n                       >\r\n                         {displayNotes}\r\n                       </div>\r\n                     )}\r\n                    \r\n                    {/* Cash Account Section for Mobile */}\r\n                    <div className=\"mb-3\">\r\n                      <div className=\"text-xs text-muted-foreground mb-1\">Cash Account:</div>\r\n                      {linkingPayment === payment.id ? (\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <Select\r\n                            value={selectedAccountId}\r\n                            onValueChange={setSelectedAccountId}\r\n                          >\r\n                            <SelectTrigger className=\"h-7 text-xs flex-1\">\r\n                              <SelectValue placeholder=\"Select account\" />\r\n                            </SelectTrigger>\r\n                            <SelectContent>\r\n                              {cashAccounts.map((account) => (\r\n                                <SelectItem key={account.id} value={account.id}>\r\n                                  <div className=\"flex items-center\">\r\n                                    <span>{account.name}</span>\r\n                                    {account.isDefault && (\r\n                                      <span className=\"ml-1 text-xs bg-blue-100 text-blue-800 px-1 py-0.5 rounded\">\r\n                                        Default\r\n                                      </span>\r\n                                    )}\r\n                                  </div>\r\n                                </SelectItem>\r\n                              ))}\r\n                            </SelectContent>\r\n                          </Select>\r\n                          <Button\r\n                            size=\"sm\"\r\n                            variant=\"ghost\"\r\n                            className=\"h-7 w-7 p-0 text-gray-500 hover:text-gray-700\"\r\n                            onClick={handleCancelCashLink}\r\n                          >\r\n                            <X className=\"h-3 w-3\" />\r\n                          </Button>\r\n                          <Button\r\n                            size=\"sm\"\r\n                            variant=\"ghost\"\r\n                            className=\"h-7 w-7 p-0 text-green-500 hover:text-green-700\"\r\n                            onClick={() => handleConfirmCashLink(payment)}\r\n                            disabled={!selectedAccountId}\r\n                          >\r\n                            <Check className=\"h-3 w-3\" />\r\n                          </Button>\r\n                        </div>\r\n                      ) : (\r\n                         <div className=\"flex items-center gap-2\">\r\n                           {payment.cashTransactionId ? (\r\n                             <Badge variant=\"outline\" className=\"text-xs bg-green-100 text-green-800 border-green-300\">\r\n                               Linked\r\n                             </Badge>\r\n                           ) : (\r\n                             <>\r\n                               <span className=\"text-xs text-muted-foreground\">Not linked</span>\r\n                               {onLinkToCash && cashAccounts.length > 0 && (\r\n                                 <Button\r\n                                   size=\"sm\"\r\n                                   variant=\"ghost\"\r\n                                   className=\"h-7 w-7 p-0 text-blue-500 hover:text-blue-700\"\r\n                                   onClick={() => handleStartCashLink(payment.id)}\r\n                                   title=\"Link to cash account\"\r\n                                 >\r\n                                   <Link className=\"h-3 w-3\" />\r\n                                 </Button>\r\n                               )}\r\n                             </>\r\n                           )}\r\n                         </div>\r\n                      )}\r\n                    </div>\r\n                    \r\n                    {showInlineEdit && canDelete && (\r\n                      <div className=\"flex justify-end gap-2\">\r\n                        <Button\r\n                          size=\"sm\"\r\n                          variant=\"outline\"\r\n                          className=\"h-7 px-2 text-xs text-blue-600 hover:text-blue-700 border-blue-200 hover:border-blue-300\"\r\n                          onClick={() => handleStartEdit(payment)}\r\n                        >\r\n                          <Edit3 className=\"h-3 w-3 mr-1\" />\r\n                          Edit\r\n                        </Button>\r\n                        <Button\r\n                          size=\"sm\"\r\n                          variant=\"outline\"\r\n                          className=\"h-7 px-2 text-xs text-red-600 hover:text-red-700 border-red-200 hover:border-red-300\"\r\n                          onClick={() => handleStageDelete(payment)}\r\n                        >\r\n                          <Trash2 className=\"h-3 w-3 mr-1\" />\r\n                          Delete\r\n                        </Button>\r\n                      </div>\r\n                    )}\r\n                  </>\r\n                )}\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n\r\n        {/* Desktop Table Layout */}\r\n        <div className=\"hidden sm:block overflow-x-auto\">\r\n          <Table>\r\n            <TableHeader>\r\n              <TableRow>\r\n                <TableHead className=\"text-xs\">Date</TableHead>\r\n                <TableHead className=\"text-xs text-right\">Amount</TableHead>\r\n                <TableHead className=\"text-xs\">Notes</TableHead>\r\n                <TableHead className=\"text-xs\">Cash Account</TableHead>\r\n                {showInlineEdit && (\r\n                  <TableHead className=\"text-xs w-16\">Actions</TableHead>\r\n                )}\r\n              </TableRow>\r\n            </TableHeader>\r\n            <TableBody>\r\n              {payments.map((payment) => {\r\n                const status = getPaymentStatus(payment.id);\r\n                const displayAmount = getDisplayAmount(payment);\r\n                const displayNotes = getDisplayNotes(payment);\r\n                const isEditingThis = editingPayment === payment.id;\r\n                const isEditingAmount = isEditingThis && editingField === 'amount';\r\n                const isEditingNotes = isEditingThis && editingField === 'notes';\r\n                const canDelete = canDeletePayment(payment);\r\n                \r\n                return (\r\n                  <TableRow \r\n                    key={payment.id}\r\n                    className={\r\n                      status === 'deleted' ? 'bg-red-50 opacity-60' : \r\n                      status === 'modified' ? 'bg-amber-50' : ''\r\n                    }\r\n                  >\r\n                     <TableCell className=\"text-xs\">\r\n                       <div className=\"flex items-center gap-2\">\r\n                         {editingPayment === payment.id && editingField === 'date' ? (\r\n                           <div className=\"flex items-center gap-1\">\r\n                             <Popover>\r\n                               <PopoverTrigger asChild>\r\n                                 <Button\r\n                                   variant=\"outline\"\r\n                                   size=\"sm\"\r\n                                   className={cn(\r\n                                     \"h-7 text-xs justify-start text-left font-normal w-32\",\r\n                                     !editDate && \"text-muted-foreground\"\r\n                                   )}\r\n                                 >\r\n                                   <CalendarIcon className=\"mr-2 h-3 w-3\" />\r\n                                   {editDate ? format(editDate, \"MMM dd, yyyy\") : <span>Pick a date</span>}\r\n                                 </Button>\r\n                               </PopoverTrigger>\r\n                               <PopoverContent className=\"w-auto p-0\" align=\"start\">\r\n                         <Calendar\r\n                           mode=\"single\"\r\n                           selected={editDate}\r\n                           onSelect={(date) => handleDateSelect(payment, date)}\r\n                           initialFocus\r\n                           className={cn(\"p-3 pointer-events-auto\")}\r\n                         />\r\n                               </PopoverContent>\r\n                             </Popover>\r\n                             <Button\r\n                               size=\"sm\"\r\n                               variant=\"ghost\"\r\n                               className=\"h-6 w-6 p-0 text-gray-500 hover:text-gray-700\"\r\n                               onClick={handleCancelEdit}\r\n                             >\r\n                               <X className=\"h-3 w-3\" />\r\n                             </Button>\r\n                             <Button\r\n                               size=\"sm\"\r\n                               variant=\"ghost\"\r\n                               className=\"h-6 w-6 p-0 text-green-500 hover:text-green-700\"\r\n                               onClick={() => handleSaveEdit(payment)}\r\n                             >\r\n                               <Check className=\"h-3 w-3\" />\r\n                             </Button>\r\n                           </div>\r\n                         ) : (\r\n                           <span \r\n                             className={`cursor-pointer hover:bg-gray-100 px-2 py-1 rounded ${\r\n                               status === 'deleted' ? 'line-through' : ''\r\n                             } ${onUpdatePayment ? 'hover:bg-blue-50' : ''}`}\r\n                             onClick={() => onUpdatePayment && handleDoubleClickDate(payment)}\r\n                             title={onUpdatePayment ? 'Click to edit date' : ''}\r\n                           >\r\n                             {format(payment.paymentDate, 'MMM dd, yyyy')}\r\n                           </span>\r\n                         )}\r\n                         {status === 'deleted' && (\r\n                           <Badge variant=\"outline\" className=\"text-xs bg-red-100 text-red-800 border-red-300\">\r\n                             To Delete\r\n                           </Badge>\r\n                         )}\r\n                         {status === 'modified' && (\r\n                           <Badge variant=\"outline\" className=\"text-xs bg-amber-100 text-amber-800 border-amber-300\">\r\n                             Modified\r\n                           </Badge>\r\n                         )}\r\n                       </div>\r\n                     </TableCell>\r\n                    <TableCell className=\"text-xs text-right\">\r\n                      {isEditingAmount ? (\r\n                        <div className=\"flex items-center gap-1 justify-end\">\r\n                          <Input\r\n                            type=\"number\"\r\n                            value={editAmount}\r\n                            onChange={(e) => setEditAmount(e.target.value)} // Allow empty string\r\n                            className=\"h-7 text-xs w-24\"\r\n                            step=\"0.01\"\r\n                            min=\"0\"\r\n                            autoFocus\r\n                            placeholder=\"0\"\r\n                          />\r\n                          <Button\r\n                            size=\"sm\"\r\n                            variant=\"ghost\"\r\n                            className=\"h-6 w-6 p-0 text-gray-500 hover:text-gray-700\"\r\n                            onClick={handleCancelEdit}\r\n                          >\r\n                            <X className=\"h-3 w-3\" />\r\n                          </Button>\r\n                          <Button\r\n                            size=\"sm\"\r\n                            variant=\"ghost\"\r\n                            className=\"h-6 w-6 p-0 text-green-500 hover:text-green-700\"\r\n                            onClick={() => handleSaveEdit(payment)}\r\n                          >\r\n                            <Check className=\"h-3 w-3\" />\r\n                          </Button>\r\n                        </div>\r\n                      ) : (\r\n                        <span \r\n                          className={`font-medium cursor-pointer hover:bg-gray-100 px-2 py-1 rounded ${\r\n                            status === 'deleted' ? 'line-through' : ''\r\n                          } ${showInlineEdit && canDelete ? 'hover:bg-blue-50' : ''}`}\r\n                          onDoubleClick={() => handleDoubleClickAmount(payment)}\r\n                          title={showInlineEdit && canDelete ? 'Double-click to edit' : ''}\r\n                        >\r\n                          {currency} {formatNumber(displayAmount)}\r\n                        </span>\r\n                      )}\r\n                    </TableCell>\r\n                    <TableCell className=\"text-xs\">\r\n                      {isEditingNotes ? (\r\n                        <div className=\"flex items-center gap-1\">\r\n                          <Input\r\n                            value={editNotes}\r\n                            onChange={(e) => setEditNotes(e.target.value)}\r\n                            placeholder=\"Payment notes\"\r\n                            className=\"h-7 text-xs\"\r\n                            autoFocus\r\n                          />\r\n                          <Button\r\n                            size=\"sm\"\r\n                            variant=\"ghost\"\r\n                            className=\"h-6 w-6 p-0 text-gray-500 hover:text-gray-700\"\r\n                            onClick={handleCancelEdit}\r\n                          >\r\n                            <X className=\"h-3 w-3\" />\r\n                          </Button>\r\n                          <Button\r\n                            size=\"sm\"\r\n                            variant=\"ghost\"\r\n                            className=\"h-6 w-6 p-0 text-green-500 hover:text-green-700\"\r\n                            onClick={() => handleSaveEdit(payment)}\r\n                          >\r\n                            <Check className=\"h-3 w-3\" />\r\n                          </Button>\r\n                        </div>\r\n                      ) : (\r\n                        <span \r\n                          className={`text-muted-foreground cursor-pointer hover:bg-gray-100 px-2 py-1 rounded ${\r\n                            status === 'deleted' ? 'line-through' : ''\r\n                          } ${showInlineEdit && canDelete ? 'hover:bg-blue-50' : ''}`}\r\n                          onDoubleClick={() => handleDoubleClickNotes(payment)}\r\n                          title={showInlineEdit && canDelete ? 'Double-click to edit' : ''}\r\n                        >\r\n                          {displayNotes || '-'}\r\n                        </span>\r\n                       )}\r\n                     </TableCell>\r\n                     <TableCell className=\"text-xs\">\r\n                       {linkingPayment === payment.id ? (\r\n                         <div className=\"flex items-center gap-1\">\r\n                           <Select\r\n                             value={selectedAccountId}\r\n                             onValueChange={setSelectedAccountId}\r\n                           >\r\n                             <SelectTrigger className=\"h-7 text-xs w-32\">\r\n                               <SelectValue placeholder=\"Select account\" />\r\n                             </SelectTrigger>\r\n                             <SelectContent>\r\n                               {cashAccounts.map((account) => (\r\n                                 <SelectItem key={account.id} value={account.id}>\r\n                                   <div className=\"flex items-center\">\r\n                                     <span>{account.name}</span>\r\n                                     {account.isDefault && (\r\n                                       <span className=\"ml-1 text-xs bg-blue-100 text-blue-800 px-1 py-0.5 rounded\">\r\n                                         Default\r\n                                       </span>\r\n                                     )}\r\n                                   </div>\r\n                                 </SelectItem>\r\n                               ))}\r\n                             </SelectContent>\r\n                           </Select>\r\n                           <Button\r\n                             size=\"sm\"\r\n                             variant=\"ghost\"\r\n                             className=\"h-6 w-6 p-0 text-gray-500 hover:text-gray-700\"\r\n                             onClick={handleCancelCashLink}\r\n                           >\r\n                             <X className=\"h-3 w-3\" />\r\n                           </Button>\r\n                           <Button\r\n                             size=\"sm\"\r\n                             variant=\"ghost\"\r\n                             className=\"h-6 w-6 p-0 text-green-500 hover:text-green-700\"\r\n                             onClick={() => handleConfirmCashLink(payment)}\r\n                             disabled={!selectedAccountId}\r\n                           >\r\n                             <Check className=\"h-3 w-3\" />\r\n                           </Button>\r\n                         </div>\r\n                       ) : (\r\n                          <div className=\"flex items-center gap-1\">\r\n                            {payment.cashTransactionId ? (\r\n                              <Badge variant=\"outline\" className=\"text-xs bg-green-100 text-green-800 border-green-300\">\r\n                                Linked\r\n                              </Badge>\r\n                            ) : (\r\n                              onLinkToCash && cashAccounts.length > 0 && (\r\n                                <Button\r\n                                  size=\"sm\"\r\n                                  variant=\"ghost\"\r\n                                  className=\"h-6 w-6 p-0 text-blue-500 hover:text-blue-700\"\r\n                                  onClick={() => handleStartCashLink(payment.id)}\r\n                                  title=\"Link to cash account\"\r\n                                >\r\n                                  <Link className=\"h-3 w-3\" />\r\n                                </Button>\r\n                              )\r\n                            )}\r\n                          </div>\r\n                       )}\r\n                     </TableCell>\r\n                    {showInlineEdit && (\r\n                      <TableCell className=\"text-xs\">\r\n                        {!isEditingThis && canDelete && (\r\n                          <Button\r\n                            size=\"sm\"\r\n                            variant=\"ghost\"\r\n                            className=\"h-6 w-6 p-0 text-red-500 hover:text-red-700\"\r\n                            onClick={() => handleStageDelete(payment)}\r\n                            title=\"Delete payment\"\r\n                          >\r\n                            <Trash2 className=\"h-3 w-3\" />\r\n                          </Button>\r\n                        )}\r\n                      </TableCell>\r\n                    )}\r\n                  </TableRow>\r\n                );\r\n              })}\r\n            </TableBody>\r\n          </Table>\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default InstallmentPaymentHistory;\r\n","\r\nimport React, { useState } from 'react';\r\nimport { format } from 'date-fns';\r\nimport { CalendarIcon } from 'lucide-react';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Calendar } from '@/components/ui/calendar';\r\nimport { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover';\r\nimport { formatNumber, formatNumberInput, parseNumberInput, cn } from '@/lib/utils';\r\nimport { InstallmentPayment } from '@/hooks/useInstallmentPayments';\r\nimport { PaymentChange } from '@/hooks/useLocalPaymentChanges';\r\nimport InstallmentPaymentHistory from './InstallmentPaymentHistory';\r\n\r\ninterface InstallmentPaymentInputProps {\r\n  amountPaid: number;\r\n  amountDue: number;\r\n  grandTotal: number;\r\n  currency: string;\r\n  onAmountPaidChange: (amount: number) => void;\r\n  onPaymentDateChange?: (date: Date) => void;\r\n  paymentDate?: Date;\r\n  maxAmount: number;\r\n  saleId?: string;\r\n  onPaymentStatusChange?: (status: 'Paid' | 'Installment Sale') => void;\r\n  isEditing?: boolean;\r\n  payments?: InstallmentPayment[];\r\n  pendingChanges?: PaymentChange[];\r\n  onStagePaymentChange?: (change: PaymentChange) => void;\r\n  cashAccounts?: any[];\r\n  onLinkToCash?: (paymentId: string, accountId: string) => Promise<void>;\r\n  onUpdatePayment?: (paymentId: string, updates: { amount?: number; notes?: string; paymentDate?: Date }) => Promise<void>;\r\n}\r\n\r\nconst InstallmentPaymentInput: React.FC<InstallmentPaymentInputProps> = ({\r\n  amountPaid,\r\n  amountDue,\r\n  grandTotal,\r\n  currency,\r\n  onAmountPaidChange,\r\n  onPaymentDateChange,\r\n  paymentDate,\r\n  maxAmount,\r\n  saleId,\r\n  onPaymentStatusChange,\r\n  isEditing = false,\r\n  payments = [],\r\n  pendingChanges = [],\r\n  onStagePaymentChange,\r\n  cashAccounts = [],\r\n  onLinkToCash,\r\n  onUpdatePayment,\r\n}) => {\r\n  const [selectedDate, setSelectedDate] = useState<Date>(paymentDate || new Date());\r\n\r\n  // Local string state for amount input with smart formatting (commas + decimals)\r\n  const [amountPaidInput, setAmountPaidInput] = useState(formatNumberInput(amountPaid?.toString() || '0'));\r\n\r\n  // Sync local state when prop changes externally\r\n  React.useEffect(() => {\r\n    // Only update if the numeric deviation is significant to avoid fighting with the user's typing\r\n    const currentVal = parseNumberInput(amountPaidInput);\r\n    if (Math.abs(currentVal - amountPaid) > 0.001) {\r\n      setAmountPaidInput(formatNumberInput(amountPaid.toString()));\r\n    }\r\n  }, [amountPaid]);\r\n\r\n\r\n  // Calculate total from payment history, considering pending changes\r\n  const getModifiedPayments = () => {\r\n    return payments\r\n      .filter(payment => {\r\n        // Filter out deleted payments\r\n        const deleteChange = pendingChanges.find(c => c.id === payment.id && c.type === 'delete');\r\n        return !deleteChange;\r\n      })\r\n      .map(payment => {\r\n        // Apply updates to payments\r\n        const updateChange = pendingChanges.find(c => c.id === payment.id && c.type === 'update');\r\n        if (updateChange && updateChange.updatedData) {\r\n          return {\r\n            ...payment,\r\n            amount: updateChange.updatedData.amount ?? payment.amount,\r\n            notes: updateChange.updatedData.notes ?? payment.notes,\r\n          };\r\n        }\r\n        return payment;\r\n      });\r\n  };\r\n\r\n  const modifiedPayments = getModifiedPayments();\r\n  const totalPaidFromHistory = modifiedPayments.reduce((sum, payment) => sum + payment.amount, 0);\r\n  const remainingAmount = Math.max(0, grandTotal - totalPaidFromHistory);\r\n  const isFullyPaid = totalPaidFromHistory >= grandTotal;\r\n\r\n  const handleAmountPaidChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const rawInput = e.target.value;\r\n\r\n    // Apply smart formatting (commas + decimals preserved)\r\n    const formatted = formatNumberInput(rawInput);\r\n    setAmountPaidInput(formatted);\r\n\r\n    const value = parseNumberInput(rawInput);\r\n\r\n    // Ensure amount paid doesn't exceed remaining amount\r\n    const validAmount = Math.min(value, remainingAmount);\r\n\r\n    onAmountPaidChange(validAmount);\r\n  };\r\n\r\n  const handleDateChange = (date: Date | undefined) => {\r\n    if (date) {\r\n      setSelectedDate(date);\r\n      onPaymentDateChange?.(date);\r\n    }\r\n  };\r\n\r\n  // Force current payment to 0 if fully paid\r\n  const displayAmountPaid = isFullyPaid ? 0 : (amountPaid || 0);\r\n\r\n  console.log('InstallmentPaymentInput - isEditing:', isEditing, 'has onStagePaymentChange:', !!onStagePaymentChange);\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      <Card className=\"border-blue-200 bg-blue-50\">\r\n        <CardHeader className=\"pb-3\">\r\n          <CardTitle className=\"text-sm text-blue-800\">Installment Payment Details</CardTitle>\r\n        </CardHeader>\r\n        <CardContent className=\"space-y-4\">\r\n          <div className=\"grid gap-3\">\r\n            <Label htmlFor=\"amountPaid\" className=\"text-sm font-medium\">Amount Paid (Current Payment)</Label>\r\n            <Input\r\n              id=\"amountPaid\"\r\n              type=\"text\"\r\n              inputMode=\"decimal\"\r\n              value={amountPaidInput}\r\n              onChange={handleAmountPaidChange}\r\n              placeholder=\"Enter amount paid\"\r\n              disabled={isFullyPaid}\r\n              className=\"text-base\"\r\n            />\r\n          </div>\r\n\r\n          <div className=\"grid gap-3\">\r\n            <Label className=\"text-sm font-medium\">Payment Date</Label>\r\n            <Popover>\r\n              <PopoverTrigger asChild>\r\n                <Button\r\n                  variant=\"outline\"\r\n                  className={cn(\r\n                    \"w-full justify-start text-left font-normal\",\r\n                    !selectedDate && \"text-muted-foreground\"\r\n                  )}\r\n                  disabled={isFullyPaid}\r\n                >\r\n                  <CalendarIcon className=\"mr-2 h-4 w-4\" />\r\n                  {selectedDate ? format(selectedDate, \"PPP\") : <span>Pick a date</span>}\r\n                </Button>\r\n              </PopoverTrigger>\r\n              <PopoverContent className=\"w-auto p-0\" align=\"start\">\r\n                <Calendar\r\n                  mode=\"single\"\r\n                  selected={selectedDate}\r\n                  onSelect={handleDateChange}\r\n                  initialFocus\r\n                  className={cn(\"p-3 pointer-events-auto\")}\r\n                />\r\n              </PopoverContent>\r\n            </Popover>\r\n          </div>\r\n\r\n          {/* Mobile-first responsive grid */}\r\n          <div className=\"space-y-3 sm:space-y-0 sm:grid sm:grid-cols-2 sm:gap-4\">\r\n            <div className=\"flex justify-between sm:block\">\r\n              <span className=\"text-sm text-muted-foreground\">Total Amount:</span>\r\n              <span className=\"text-sm font-semibold sm:block\">{currency} {formatNumber(grandTotal)}</span>\r\n            </div>\r\n            <div className=\"flex justify-between sm:block\">\r\n              <span className=\"text-sm text-muted-foreground\">Total Paid (History):</span>\r\n              <span className=\"text-sm font-semibold text-green-600 sm:block\">{currency} {formatNumber(totalPaidFromHistory)}</span>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"space-y-3 sm:space-y-0 sm:grid sm:grid-cols-2 sm:gap-4\">\r\n            <div className=\"flex justify-between sm:block\">\r\n              <span className=\"text-sm text-muted-foreground\">Current Payment:</span>\r\n              <span className=\"text-sm font-semibold text-blue-600 sm:block\">{currency} {formatNumber(displayAmountPaid)}</span>\r\n            </div>\r\n            <div className=\"flex justify-between sm:block\">\r\n              <span className=\"text-sm text-muted-foreground\">Amount Due:</span>\r\n              <span className=\"text-sm font-semibold text-red-600 sm:block\">{currency} {formatNumber(Math.max(0, remainingAmount - displayAmountPaid))}</span>\r\n            </div>\r\n          </div>\r\n\r\n          {(totalPaidFromHistory + displayAmountPaid) >= grandTotal && displayAmountPaid > 0 && (\r\n            <div className=\"text-sm text-green-600 font-medium bg-green-50 p-3 rounded border border-green-200\">\r\n              ✓ Full payment received - you can manually change status to Paid if needed\r\n            </div>\r\n          )}\r\n\r\n          {isFullyPaid && (\r\n            <div className=\"text-sm text-green-600 font-medium bg-green-50 p-3 rounded border border-green-200\">\r\n              ✓ Sale fully paid - you can manually change status to Paid if needed\r\n            </div>\r\n          )}\r\n\r\n          {/* Show notice when editing with pending changes */}\r\n          {isEditing && pendingChanges.length > 0 && (\r\n            <div className=\"text-sm text-amber-600 font-medium bg-amber-50 p-3 rounded border border-amber-200\">\r\n              ℹ️ {pendingChanges.length} payment change(s) staged. Changes will be saved when you click \"Update Sale\".\r\n            </div>\r\n          )}\r\n\r\n          {/* Show notice when editing without pending changes */}\r\n          {isEditing && pendingChanges.length === 0 && payments.length > 0 && (\r\n            <div className=\"text-sm text-blue-600 font-medium bg-blue-50 p-3 rounded border border-blue-200\">\r\n              ℹ️ You can edit payment history. Changes will be saved when you click \"Update Sale\".\r\n            </div>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {saleId && (\r\n        <InstallmentPaymentHistory\r\n          payments={payments}\r\n          currency={currency}\r\n          isLoading={false}\r\n          pendingChanges={pendingChanges}\r\n          isLocalMode={isEditing}\r\n          onStageChange={onStagePaymentChange}\r\n          cashAccounts={cashAccounts}\r\n          onLinkToCash={onLinkToCash}\r\n          onUpdatePayment={onUpdatePayment}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default InstallmentPaymentInput;\r\n","\r\nimport React from 'react';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Switch } from '@/components/ui/switch';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\n\r\ninterface CashAccount {\r\n  id: string;\r\n  name: string;\r\n  description?: string;\r\n  isDefault: boolean;\r\n}\r\n\r\ninterface CashAccountSelectionProps {\r\n  linkToCash: boolean;\r\n  onLinkToCashChange: (checked: boolean) => void;\r\n  selectedCashAccountId: string;\r\n  onCashAccountChange: (accountId: string) => void;\r\n  cashAccounts: CashAccount[];\r\n  paymentStatus: string;\r\n}\r\n\r\nconst CashAccountSelection: React.FC<CashAccountSelectionProps> = ({\r\n  linkToCash,\r\n  onLinkToCashChange,\r\n  selectedCashAccountId,\r\n  onCashAccountChange,\r\n  cashAccounts,\r\n  paymentStatus\r\n}) => {\r\n  // Only show cash account selection for Paid and Installment Sale statuses\r\n  const shouldShowCashSelection = paymentStatus === 'Paid' || paymentStatus === 'Installment Sale';\r\n  \r\n  if (!shouldShowCashSelection) {\r\n    return null;\r\n  }\r\n\r\n  const getCardTitle = () => {\r\n    if (paymentStatus === 'Installment Sale') {\r\n      return 'Link Partial Payment to Cash Account';\r\n    }\r\n    return 'Link to Cash Account';\r\n  };\r\n\r\n  const getDescription = () => {\r\n    if (paymentStatus === 'Installment Sale') {\r\n      return 'Record the partial payment in a cash account';\r\n    }\r\n    return 'Record this payment in a cash account';\r\n  };\r\n\r\n  return (\r\n    <Card className=\"border-green-200 bg-green-50\">\r\n      <CardHeader className=\"pb-3\">\r\n        <CardTitle className=\"text-sm text-green-800\">{getCardTitle()}</CardTitle>\r\n      </CardHeader>\r\n      <CardContent className=\"space-y-4\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <div className=\"space-y-0.5\">\r\n            <Label htmlFor=\"link-to-cash\">Link to Cash Account</Label>\r\n            <div className=\"text-sm text-muted-foreground\">\r\n              {getDescription()}\r\n            </div>\r\n          </div>\r\n          <Switch\r\n            id=\"link-to-cash\"\r\n            checked={linkToCash}\r\n            onCheckedChange={onLinkToCashChange}\r\n            data-cash-account-switch=\"true\"\r\n            onKeyDown={(e: React.KeyboardEvent) => {\r\n              if (e.key === 'Enter') {\r\n                e.preventDefault();\r\n                if (linkToCash) {\r\n                  // Focus the cash account select if enabled\r\n                  const cashAccountSelect = document.querySelector('[data-cash-account-select=\"true\"]') as HTMLElement;\r\n                  cashAccountSelect?.focus();\r\n                } else {\r\n                  // Go to submit button if not enabled\r\n                  const submitButton = document.querySelector('button[type=\"submit\"]') as HTMLElement;\r\n                  submitButton?.focus();\r\n                }\r\n              }\r\n            }}\r\n          />\r\n        </div>\r\n        \r\n        {linkToCash && (\r\n          <div className=\"grid gap-3\">\r\n            <Label htmlFor=\"cash-account\">Select Cash Account</Label>\r\n            <Select\r\n              value={selectedCashAccountId}\r\n              onValueChange={onCashAccountChange}\r\n            >\r\n              <SelectTrigger \r\n                className=\"w-full\"\r\n                data-cash-account-select=\"true\"\r\n                onKeyDown={(e) => {\r\n                  if (e.key === 'Enter') {\r\n                    e.preventDefault();\r\n                    // Focus the create sale button\r\n                    const submitButton = document.querySelector('button[type=\"submit\"]') as HTMLElement;\r\n                    submitButton?.focus();\r\n                  }\r\n                }}\r\n              >\r\n                <SelectValue placeholder=\"Select a cash account\" />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                {cashAccounts.map((account) => (\r\n                  <SelectItem key={account.id} value={account.id}>\r\n                    <div className=\"flex items-center\">\r\n                      <span>{account.name}</span>\r\n                      {account.isDefault && (\r\n                        <span className=\"ml-2 text-xs bg-blue-100 text-blue-800 px-1.5 py-0.5 rounded\">\r\n                          Default\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                  </SelectItem>\r\n                ))}\r\n              </SelectContent>\r\n            </Select>\r\n            {selectedCashAccountId && (\r\n              <div className=\"text-sm text-muted-foreground\">\r\n                {paymentStatus === 'Installment Sale' \r\n                  ? 'The partial payment amount will be recorded in this account'\r\n                  : 'The full payment amount will be recorded in this account'\r\n                }\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default CashAccountSelection;\r\n","import React from 'react';\r\nimport { Label } from '@/components/ui/label';\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from '@/components/ui/select';\r\nimport { useSalesCategories } from '@/hooks/useSalesCategories';\r\nimport { SalesCategory } from '@/types';\r\n\r\ninterface SaleCategorySelectorProps {\r\n  value?: string;\r\n  onChange: (value: string) => void;\r\n  label?: string;\r\n  placeholder?: string;\r\n}\r\n\r\nconst SaleCategorySelector: React.FC<SaleCategorySelectorProps> = ({\r\n  value,\r\n  onChange,\r\n  label = \"Sales Source\",\r\n  placeholder = \"Select category (optional)\"\r\n}) => {\r\n  const { categories, isLoading } = useSalesCategories();\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"space-y-2\">\r\n        <Label>{label}</Label>\r\n        <Select disabled>\r\n          <SelectTrigger>\r\n            <SelectValue placeholder=\"Loading...\" />\r\n          </SelectTrigger>\r\n        </Select>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-2\">\r\n      <Label>{label}</Label>\r\n      <Select value={value || \"none\"} onValueChange={(val) => {\r\n        onChange(val === \"none\" ? \"\" : val);\r\n      }}>\r\n        <SelectTrigger>\r\n          <SelectValue placeholder={placeholder} />\r\n        </SelectTrigger>\r\n        <SelectContent>\r\n          <SelectItem value=\"none\">No source</SelectItem>\r\n          {categories.map((category: SalesCategory) => (\r\n            <SelectItem key={category.id} value={category.id}>\r\n              {category.name}\r\n            </SelectItem>\r\n          ))}\r\n        </SelectContent>\r\n      </Select>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SaleCategorySelector;","import React from 'react';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport PaymentStatusSelector from '@/components/sales/PaymentStatusSelector';\r\nimport InstallmentPaymentInput from '@/components/sales/InstallmentPaymentInput';\r\nimport InstallmentPaymentHistory from '@/components/sales/InstallmentPaymentHistory';\r\nimport CashAccountSelection from '@/components/sales/CashAccountSelection';\r\nimport SaleCategorySelector from '@/components/sales/SaleCategorySelector';\r\nimport { PaymentChange } from '@/hooks/useLocalPaymentChanges';\r\n\r\ninterface SalePaymentSectionProps {\r\n  paymentStatus: string;\r\n  onPaymentStatusChange: (value: string) => void;\r\n  isInstallmentSale: boolean;\r\n  amountPaid: number;\r\n  amountDue: number;\r\n  grandTotal: number;\r\n  currency: string;\r\n  onAmountPaidChange: (amount: number) => void;\r\n  onPaymentDateChange?: (date: Date) => void;\r\n  paymentDate?: Date;\r\n  saleId?: string;\r\n  onPaymentStatusChangeFromInstallment: (newStatus: string, saleId?: string) => Promise<void>;\r\n  isEditing: boolean;\r\n  payments: any[];\r\n  pendingChanges: any[];\r\n  onStagePaymentChange?: (change: PaymentChange) => void;\r\n  linkToCash: boolean;\r\n  onLinkToCashChange: (value: boolean) => void;\r\n  selectedCashAccountId: string;\r\n  onCashAccountChange: (value: string) => void;\r\n  cashAccounts: any[];\r\n  hasPaidWithHistory: boolean;\r\n  onLinkPaymentToCash?: (paymentId: string, accountId: string) => Promise<void>;\r\n  onUpdatePayment?: (paymentId: string, updates: { amount?: number; notes?: string; paymentDate?: Date }) => Promise<void>;\r\n  notes?: string;\r\n  onNotesChange?: (e: React.ChangeEvent<HTMLInputElement>) => void;\r\n  categoryId?: string;\r\n  onCategoryChange?: (value: string) => void;\r\n}\r\n\r\nconst SalePaymentSection: React.FC<SalePaymentSectionProps> = ({\r\n  paymentStatus,\r\n  onPaymentStatusChange,\r\n  isInstallmentSale,\r\n  amountPaid,\r\n  amountDue,\r\n  grandTotal,\r\n  currency,\r\n  onAmountPaidChange,\r\n  onPaymentDateChange,\r\n  paymentDate,\r\n  saleId,\r\n  onPaymentStatusChangeFromInstallment,\r\n  isEditing,\r\n  payments,\r\n  pendingChanges,\r\n  onStagePaymentChange,\r\n  linkToCash,\r\n  onLinkToCashChange,\r\n  selectedCashAccountId,\r\n  onCashAccountChange,\r\n  cashAccounts,\r\n  hasPaidWithHistory,\r\n  onLinkPaymentToCash,\r\n  onUpdatePayment,\r\n  notes = '',\r\n  onNotesChange,\r\n  categoryId = '',\r\n  onCategoryChange,\r\n}) => {\r\n  return (\r\n    <Card className=\"mb-6\">\r\n      <CardHeader>\r\n        <CardTitle>Payment Information</CardTitle>\r\n      </CardHeader>\r\n      <CardContent className=\"space-y-6\">\r\n        <PaymentStatusSelector\r\n          paymentStatus={paymentStatus}\r\n          onPaymentStatusChange={onPaymentStatusChange}\r\n        />\r\n\r\n        {isInstallmentSale && (\r\n          <InstallmentPaymentInput\r\n            amountPaid={amountPaid}\r\n            amountDue={amountDue}\r\n            grandTotal={grandTotal}\r\n            currency={currency}\r\n            onAmountPaidChange={onAmountPaidChange}\r\n            onPaymentDateChange={onPaymentDateChange}\r\n            paymentDate={paymentDate}\r\n            maxAmount={grandTotal}\r\n            saleId={saleId}\r\n            onPaymentStatusChange={onPaymentStatusChangeFromInstallment}\r\n            isEditing={isEditing}\r\n            payments={payments}\r\n            pendingChanges={pendingChanges}\r\n            onStagePaymentChange={isEditing ? onStagePaymentChange : undefined}\r\n            cashAccounts={cashAccounts}\r\n            onLinkToCash={onLinkPaymentToCash}\r\n            onUpdatePayment={onUpdatePayment}\r\n          />\r\n        )}\r\n\r\n        {hasPaidWithHistory && (\r\n          <Card className=\"border-green-200 bg-green-50\">\r\n            <CardHeader className=\"pb-3\">\r\n              <CardTitle className=\"text-sm text-green-800\">Payment History (Sale Completed)</CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <InstallmentPaymentHistory\r\n                payments={payments}\r\n                currency={currency}\r\n                isLoading={false}\r\n                pendingChanges={pendingChanges}\r\n                isLocalMode={isEditing}\r\n                onStageChange={isEditing ? onStagePaymentChange : undefined}\r\n                cashAccounts={cashAccounts}\r\n                onLinkToCash={onLinkPaymentToCash}\r\n                onUpdatePayment={onUpdatePayment}\r\n              />\r\n            </CardContent>\r\n          </Card>\r\n        )}\r\n\r\n        <CashAccountSelection\r\n          linkToCash={linkToCash}\r\n          onLinkToCashChange={onLinkToCashChange}\r\n          selectedCashAccountId={selectedCashAccountId}\r\n          onCashAccountChange={onCashAccountChange}\r\n          cashAccounts={cashAccounts}\r\n          paymentStatus={paymentStatus}\r\n        />\r\n\r\n        {onCategoryChange && (\r\n          <SaleCategorySelector\r\n            value={categoryId}\r\n            onChange={onCategoryChange}\r\n          />\r\n        )}\r\n\r\n        <div className=\"grid gap-3\">\r\n          <Label htmlFor=\"saleNotes\">Notes</Label>\r\n          <Input\r\n            id=\"saleNotes\"\r\n            name=\"notes\"\r\n            value={notes}\r\n            onChange={onNotesChange}\r\n            placeholder=\"Order notes (will appear on receipt)\"\r\n          />\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default SalePaymentSection;","import React, { useEffect, useState, useMemo } from \"react\";\r\nimport { useBusiness } from \"@/contexts/BusinessContext\";\r\nimport { useBusinessSettings } from \"@/hooks/useBusinessSettings\";\r\nimport { useAuth } from \"@/components/auth/AuthProvider\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Checkbox } from \"@/components/ui/checkbox\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Card, CardContent } from \"@/components/ui/card\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { Loader2, MessageSquare, Printer } from \"lucide-react\";\r\nimport { useMessages } from \"@/hooks/useMessages\";\r\nimport { checkBridgeStatus } from \"@/utils/thermalPrinterPlug\";\r\nimport {\r\n  Select,\r\n  SelectTrigger,\r\n  SelectValue,\r\n  SelectContent,\r\n  SelectItem,\r\n} from \"@/components/ui/select\";\r\n\r\ninterface SaleFormActionsProps {\r\n  loading: boolean;\r\n  isEditing: boolean;\r\n  onCancel: () => void;\r\n  onClearForm?: () => void;\r\n  printAfterSave: boolean;\r\n  onPrintAfterSaveChange: (checked: boolean) => void;\r\n  thermalPrintAfterSave?: boolean;\r\n  onThermalPrintAfterSaveChange?: (checked: boolean) => void;\r\n  paymentStatus: string;\r\n  includePaymentInfo: boolean;\r\n  onIncludePaymentInfoChange: (checked: boolean) => void;\r\n  hasPendingPaymentChanges?: boolean;\r\n\r\n  sendSMS?: boolean;\r\n  onSendSMSChange?: (checked: boolean) => void;\r\n  smsMessage?: string;\r\n  onSMSMessageChange?: (message: string) => void;\r\n  customerName?: string;\r\n  customerHasPhone?: boolean;\r\n  disabled?: boolean;\r\n}\r\n\r\nconst SaleFormActions: React.FC<SaleFormActionsProps> = ({\r\n  loading,\r\n  isEditing,\r\n  onCancel,\r\n  onClearForm,\r\n  printAfterSave,\r\n  onPrintAfterSaveChange,\r\n  thermalPrintAfterSave = false,\r\n  onThermalPrintAfterSaveChange,\r\n  paymentStatus,\r\n  includePaymentInfo,\r\n  onIncludePaymentInfoChange,\r\n  hasPendingPaymentChanges = false,\r\n  sendSMS = false,\r\n  onSendSMSChange,\r\n  smsMessage = \"\",\r\n  onSMSMessageChange,\r\n  customerName = \"\",\r\n  customerHasPhone = false,\r\n  disabled = false,\r\n}) => {\r\n  const { user } = useAuth();\r\n  const userId = user?.id;\r\n  const { currentBusiness } = useBusiness();\r\n  const { settings } = useBusinessSettings();\r\n  const [isBridgeOnline, setIsBridgeOnline] = useState(false);\r\n\r\n  const { templates = [], isLoading: templatesLoading } = useMessages(userId);\r\n\r\n  const [selectedTemplateId, setSelectedTemplateId] = useState<string>(\"\");\r\n\r\n  useEffect(() => {\r\n    const checkBridge = async () => {\r\n      const isOnline = await checkBridgeStatus();\r\n      setIsBridgeOnline(isOnline);\r\n    };\r\n    checkBridge();\r\n  }, []);\r\n\r\n  const FALLBACK_PLACEHOLDER =\r\n    \"Thank you for your purchase, {customer_name}! We appreciate your business.\";\r\n\r\n  // Comprehensive default template\r\n  // Comprehensive default template\r\n  const DEFAULT_TEMPLATE = \"Thank you for your purchase from {business_name} We truly appreciate your support and trust in our Business. If you need any assistance or have any questions about your order, please feel free to reach out, on {business_number} We look forward to serving you again!\";\r\n\r\n  // --- Utility function moved up ---\r\n  const fillTemplate = (template: string, name: string) => {\r\n    let result = template;\r\n    if (name) {\r\n      result = result\r\n        .replace(/\\{customer_name\\}/gi, name)\r\n        .replace(/\\{first_name\\}/gi, name.split(\" \")[0] || \"\")\r\n        .replace(/\\{last_name\\}/gi, name.split(\" \").slice(1).join(\" \") || \"\");\r\n    }\r\n    // Replace business placeholders\r\n    result = result\r\n      .replace(/\\{business_name\\}/gi, currentBusiness?.name || \"[Business Name]\")\r\n      .replace(/\\{business_number\\}/gi, settings.businessPhone || \"[Business Number]\");\r\n    return result;\r\n  };\r\n\r\n  // Filter ThankYou templates\r\n  const thankYouTemplates = useMemo(() => {\r\n    return templates.filter(\r\n      (t) => t.category && String(t.category).trim() === \"ThankYou\"\r\n    );\r\n  }, [templates]);\r\n\r\n  // --- Unified effect for template auto-fill ---\r\n  useEffect(() => {\r\n    if (!sendSMS || !onSMSMessageChange) return;\r\n\r\n    let templateToUse = DEFAULT_TEMPLATE;\r\n\r\n    // Handle template selection\r\n    if (selectedTemplateId === 'default') {\r\n      templateToUse = DEFAULT_TEMPLATE;\r\n    } else if (selectedTemplateId && thankYouTemplates.length > 0) {\r\n      const tpl = thankYouTemplates.find((t) => t.id === selectedTemplateId);\r\n      if (tpl) {\r\n        templateToUse = tpl.content;\r\n      }\r\n    } else if (!selectedTemplateId) {\r\n      // Auto-set to default\r\n      setSelectedTemplateId('default');\r\n    }\r\n\r\n    const filledMessage = fillTemplate(templateToUse, customerName);\r\n    onSMSMessageChange(filledMessage);\r\n  }, [\r\n    sendSMS,\r\n    customerName,\r\n    thankYouTemplates,\r\n    selectedTemplateId,\r\n    onSMSMessageChange,\r\n  ]);\r\n\r\n  const handleTemplateChange = (id: string) => {\r\n    setSelectedTemplateId(id);\r\n\r\n    let templateContent = DEFAULT_TEMPLATE;\r\n    if (id === 'default') {\r\n      templateContent = DEFAULT_TEMPLATE;\r\n    } else {\r\n      const tpl = thankYouTemplates.find((t) => t.id === id);\r\n      if (tpl) {\r\n        templateContent = tpl.content;\r\n      }\r\n    }\r\n\r\n    const filled = fillTemplate(templateContent, customerName);\r\n    onSMSMessageChange?.(filled);\r\n  };\r\n\r\n  const messageLength = smsMessage.length;\r\n  const smsCredits = Math.ceil(messageLength / 160) || 1;\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      {/* Print & Payment Options */}\r\n      <Card className=\"border-gray-200\">\r\n        <CardContent className=\"pt-6 space-y-4\">\r\n          <div className=\"flex items-center space-x-2\">\r\n            <Checkbox\r\n              id=\"printAfterSave\"\r\n              checked={printAfterSave}\r\n              onCheckedChange={onPrintAfterSaveChange}\r\n            />\r\n            <Label className=\"text-sm\">\r\n              Show receipt after {isEditing ? \"updating\" : \"creating\"} sale\r\n            </Label>\r\n          </div>\r\n\r\n          {isBridgeOnline && onThermalPrintAfterSaveChange && (\r\n            <div className=\"flex items-center space-x-2\">\r\n              <Checkbox\r\n                id=\"thermalPrintAfterSave\"\r\n                checked={thermalPrintAfterSave}\r\n                onCheckedChange={onThermalPrintAfterSaveChange}\r\n              />\r\n              <Label className=\"text-sm flex items-center gap-1.5 text-green-700 font-medium\">\r\n                <Printer className=\"w-3.5 h-3.5\" />\r\n                Auto-print (Thermal Bridge)\r\n              </Label>\r\n            </div>\r\n          )}\r\n\r\n          {(paymentStatus === \"Paid\" || paymentStatus === \"Installment Sale\") && (\r\n            <div className=\"flex items-center space-x-2\">\r\n              <Checkbox\r\n                id=\"includePaymentInfo\"\r\n                checked={includePaymentInfo}\r\n                onCheckedChange={onIncludePaymentInfoChange}\r\n              />\r\n              <Label className=\"text-sm\">\r\n                Include payment information in receipt\r\n              </Label>\r\n            </div>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* SMS Section */}\r\n      {onSendSMSChange && onSMSMessageChange && (\r\n        <Card\r\n          className={`border-blue-200 ${sendSMS ? \"bg-blue-50/50\" : \"bg-gray-50\"\r\n            }`}\r\n        >\r\n          <CardContent className=\"pt-6 space-y-4\">\r\n            <div className=\"flex items-start space-x-3\">\r\n              <Checkbox\r\n                id=\"sendSMS\"\r\n                checked={sendSMS}\r\n                onCheckedChange={onSendSMSChange}\r\n                disabled={!customerHasPhone}\r\n              />\r\n              <div className=\"flex-1\">\r\n                <Label className=\"text-base font-medium flex items-center gap-2\">\r\n                  <MessageSquare className=\"w-5 h-5 text-blue-600\" />\r\n                  Send Thank You SMS\r\n                </Label>\r\n                {!customerHasPhone && (\r\n                  <p className=\"text-xs text-amber-600 mt-1\">\r\n                    Customer phone number required to send SMS\r\n                  </p>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {sendSMS && customerHasPhone && (\r\n              <div className=\"space-y-4 pl-8 border-l-4 border-blue-300 bg-blue-50/30 -m-4 p-4 rounded-r-lg\">\r\n                {/* Template Selector */}\r\n                <div>\r\n                  <Label className=\"text-sm font-medium\">Template</Label>\r\n                  {templatesLoading ? (\r\n                    <div className=\"text-sm text-gray-500 flex items-center gap-2 mt-1\">\r\n                      <Loader2 className=\"w-4 h-4 animate-spin\" />\r\n                      Loading templates...\r\n                    </div>\r\n                  ) : (\r\n                    <Select\r\n                      value={selectedTemplateId || \"default\"}\r\n                      onValueChange={handleTemplateChange}\r\n                    >\r\n                      <SelectTrigger className=\"mt-1\">\r\n                        <SelectValue placeholder=\"Choose a thank you template...\" />\r\n                      </SelectTrigger>\r\n                      <SelectContent>\r\n                        <SelectItem value=\"default\">\r\n                          Default Template\r\n                        </SelectItem>\r\n                        {thankYouTemplates.map((t) => (\r\n                          <SelectItem key={t.id} value={t.id}>\r\n                            {t.name}\r\n                          </SelectItem>\r\n                        ))}\r\n                      </SelectContent>\r\n                    </Select>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Message */}\r\n                <div>\r\n                  <Label className=\"text-sm font-medium\">Message</Label>\r\n                  <Textarea\r\n                    value={smsMessage}\r\n                    onChange={(e) => onSMSMessageChange?.(e.target.value)}\r\n                    placeholder=\"Your message will appear here...\"\r\n                    rows={4}\r\n                    className=\"mt-1 resize-none text-sm font-medium\"\r\n                  />\r\n                  <div className=\"flex justify-between items-center mt-2 text-xs text-gray-600\">\r\n                    <span>{messageLength} characters</span>\r\n                    <span className=\"font-semibold text-blue-600\">\r\n                      {smsCredits} SMS credit{smsCredits > 1 ? \"s\" : \"\"} will\r\n                      be used\r\n                    </span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {/* Rest of your buttons */}\r\n      {hasPendingPaymentChanges && (\r\n        <div className=\"text-sm text-amber-600 bg-amber-50 p-3 rounded border border-amber-200\">\r\n          Pending payment changes will be applied when updating.\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"flex gap-4 pt-4\">\r\n        <Button\r\n          type=\"button\"\r\n          variant=\"outline\"\r\n          onClick={onCancel}\r\n          disabled={loading}\r\n          className=\"flex-1\"\r\n        >\r\n          Cancel\r\n        </Button>\r\n        {!isEditing && onClearForm && (\r\n          <Button\r\n            type=\"button\"\r\n            variant=\"outline\"\r\n            onClick={onClearForm}\r\n            disabled={loading}\r\n            className=\"flex-1\"\r\n          >\r\n            Clear Form\r\n          </Button>\r\n        )}\r\n        <Button\r\n          type=\"submit\"\r\n          disabled={loading || disabled}\r\n          className=\"flex-1 bg-blue-600 hover:bg-blue-700\"\r\n        >\r\n          {loading ? (\r\n            <>\r\n              <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\r\n              {isEditing ? \"Updating...\" : \"Creating...\"}\r\n            </>\r\n          ) : isEditing ? (\r\n            \"Update Sale\"\r\n          ) : (\r\n            \"Create Sale\"\r\n          )}\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SaleFormActions;\r\n","// SalesForm.tsx\r\nimport React, { useState, useEffect, useRef, useMemo } from 'react';\r\nimport { useRouter, useSearchParams } from 'next/navigation';\r\nimport { toast } from 'sonner';\r\nimport { Sale, SaleFormData, SaleItem, mapSaleToDbSale, Customer, Product } from '@/types';\r\nimport { useAuth } from '@/components/auth/AuthProvider';\r\nimport { calculateProfit } from '@/utils/calculateProfit';\r\nimport { generateReceiptNumber } from '@/utils/generateReceiptNumber';\r\nimport { lookupProductByBarcodeAction, getProductsForBarcodeScannerAction, updateSaleCashTransactionAction } from '@/app/actions/products';\r\nimport { useBusinessSettings } from '@/hooks/useBusinessSettings';\r\nimport { useProducts } from '@/hooks/useProducts';\r\nimport { useSaleProductSelection } from '@/hooks/useSaleProductSelection';\r\nimport { useCashAccounts } from '@/hooks/useCashAccounts';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\nimport { useSaleDraft } from '@/hooks/useSaleDraft';\r\nimport { useSaleFormLogic } from '@/hooks/useSaleFormLogic';\r\nimport { useCashTransactionOperations } from '@/hooks/useCashTransactionOperations';\r\nimport { useInstallmentPayments } from '@/hooks/useInstallmentPayments';\r\nimport { useStockHistory } from '@/hooks/useStockHistory';\r\nimport { useMessages } from '@/hooks/useMessages'; // This is the key fix!\r\nimport { useQuery } from '@tanstack/react-query';\r\nimport { upsertSaleAction } from '@/app/actions/sales';\r\n\r\n// Components\r\nimport SaleFormHeader from '@/components/sales/SaleFormHeader';\r\nimport SaleItemsManager from '@/components/sales/SaleItemsManager';\r\nimport SalePaymentSection from '@/components/sales/SalePaymentSection';\r\nimport SaleFormActions from '@/components/sales/SaleFormActions';\r\nimport SaleCategorySelector from '@/components/sales/SaleCategorySelector';\r\nimport { mapDbProductToProduct } from '@/types';\r\n\r\ninterface SalesFormProps {\r\n  initialData?: Sale;\r\n  onSaleComplete?: (sale: Sale, showReceipt?: boolean, includePaymentInfo?: boolean, selectedCustomerCategoryId?: string, onClearDraft?: () => void, saleDate?: Date, thermalPrintAfterSave?: boolean) => void;\r\n  currency?: string;\r\n  customers?: Customer[];\r\n  onAddNewCustomer?: () => void;\r\n  draftData?: any;\r\n  onClearDraft?: () => void;\r\n}\r\n\r\nconst SalesForm: React.FC<SalesFormProps> = ({\r\n  initialData,\r\n  onSaleComplete,\r\n  currency = 'USD',\r\n  customers = [],\r\n  onAddNewCustomer,\r\n  draftData,\r\n  onClearDraft,\r\n}) => {\r\n  const router = useRouter();\r\n  const searchParams = useSearchParams();\r\n  const [loading, setLoading] = useState(false);\r\n  const [selectedDate, setSelectedDate] = useState<Date>(initialData?.date || new Date());\r\n\r\n  // Note: defaultPaymentStatus might need to come from props since we don't have location.state\r\n  const defaultPaymentStatus = initialData?.paymentStatus || 'Paid';\r\n\r\n  const { settings } = useBusinessSettings();\r\n  const { user } = useAuth();\r\n  const { updateInventoryForSale, updateInventoryForEditedSale } = useSaleProductSelection(user?.id);\r\n  const { accounts: cashAccounts } = useCashAccounts();\r\n  const { currentBusiness } = useBusiness();\r\n\r\n  // DEBUG: Check if initialData has categoryId\r\n  useEffect(() => {\r\n    if (initialData) {\r\n      console.log('SalesForm initialData:', initialData);\r\n      console.log('SalesForm initialData.categoryId:', initialData.categoryId);\r\n      console.log('SalesForm initialData.notes:', initialData.notes);\r\n    }\r\n  }, [initialData]);\r\n\r\n  const { saveDraft } = useSaleDraft();\r\n  const { updateStockHistoryDatesBySaleId } = useStockHistory(user?.id);\r\n  const autoSaveTimeoutRef = useRef<NodeJS.Timeout>();\r\n  const isClearingRef = useRef(false);\r\n\r\n  const [isSubmitted, setIsSubmitted] = useState(false);\r\n\r\n  // Key: Use the proper messaging hook\r\n  const { createMessage, templates = [] } = useMessages(user?.id);\r\n  const [selectedTemplateId, setSelectedTemplateId] = useState<string | null>(null);\r\n  const [sendSMS, setSendSMS] = useState(true);\r\n\r\n  // Comprehensive default SMS template\r\n  // Comprehensive default SMS template\r\n  const defaultSMSTemplate = \"Thank you for your purchase from {business_name} We truly appreciate your support and trust in our Business. If you need any assistance or have any questions about your order, please feel free to reach out, on {business_number} We look forward to serving you again!\";\r\n\r\n  const [smsMessage, setSMSMessage] = useState(defaultSMSTemplate);\r\n\r\n  // Custom hooks\r\n  const {\r\n    formData,\r\n    errors,\r\n    taxRateInput,\r\n    printAfterSave,\r\n    thermalPrintAfterSave,\r\n    includePaymentInfo,\r\n    selectedCustomerCategoryId,\r\n    paymentDate,\r\n    linkToCash,\r\n    selectedCashAccountId,\r\n    cashTransactionId,\r\n    originalPaymentStatus,\r\n    formRecentlyCleared,\r\n    payments,\r\n    pendingChanges,\r\n    hasChanges,\r\n    setFormData,\r\n    setTaxRateInput,\r\n    setPrintAfterSave,\r\n    setThermalPrintAfterSave,\r\n    setIncludePaymentInfo,\r\n    setLinkToCash,\r\n    setSelectedCashAccountId,\r\n    setCashTransactionId,\r\n    setOriginalPaymentStatus,\r\n    handleChange,\r\n    handleSelectChange,\r\n    handleAddItem,\r\n    handleUpdateItem,\r\n    handleRemoveItem,\r\n    handleSelectCustomer,\r\n    handleCategoryChange,\r\n    handleSalesCategoryChange,\r\n    handleAmountPaidChange,\r\n    handlePaymentDateChange,\r\n    calculateTotalAmount,\r\n    calculateTaxAmount,\r\n    validateForm,\r\n    processPendingPaymentChanges,\r\n    createInstallmentPayment,\r\n    updateInstallmentPayment,\r\n    deleteInstallmentPayment,\r\n    addPaymentChange,\r\n    clearChanges,\r\n    getModifiedPayments,\r\n    clearForm,\r\n  } = useSaleFormLogic({\r\n    initialData,\r\n    defaultPaymentStatus,\r\n    cashAccounts\r\n  });\r\n\r\n  const {\r\n    createCashTransactionForSale,\r\n    updateCashTransactionForSale,\r\n    createInstallmentPaymentWithCash,\r\n    findCashTransactionForSale,\r\n  } = useCashTransactionOperations();\r\n\r\n  const {\r\n    payments: installmentPayments,\r\n    linkPaymentToCashAccount,\r\n    unlinkPaymentFromCashAccount,\r\n    updatePayment: updatePaymentOriginal\r\n  } = useInstallmentPayments(initialData?.id);\r\n\r\n  const updatePayment = async (paymentId: string, updates: { amount?: number; notes?: string; paymentDate?: Date }) => {\r\n    await updatePaymentOriginal(paymentId, updates);\r\n  };\r\n\r\n  const [saleCompleted, setSaleCompleted] = useState(false);\r\n\r\n  // Wrapper for clear form to manage the ref and prevent race conditions\r\n  const handleClearForm = () => {\r\n    isClearingRef.current = true;\r\n    if (clearForm) {\r\n      clearForm(() => setSelectedDate(new Date()), onClearDraft);\r\n    }\r\n  };\r\n\r\n  // Reset ref after render\r\n  useEffect(() => {\r\n    isClearingRef.current = false;\r\n  });\r\n\r\n  // Auto-save draft\r\n  const autoSaveDraft = React.useCallback(() => {\r\n    // Check ref to prevent saving during clear operation\r\n    if (isClearingRef.current) return;\r\n\r\n    if (!initialData && !loading && !saleCompleted && !formRecentlyCleared) {\r\n      const hasData = formData.customerName.trim() ||\r\n        formData.customerAddress.trim() ||\r\n        formData.customerContact.trim() ||\r\n        formData.items.some(item => item.description.trim() || item.quantity !== 1 || item.price !== 0);\r\n\r\n      if (hasData) {\r\n        saveDraft(formData, selectedDate);\r\n      }\r\n    }\r\n  }, [formData, selectedDate, initialData, loading, saveDraft, saleCompleted, formRecentlyCleared]);\r\n\r\n  useEffect(() => {\r\n    if (autoSaveTimeoutRef.current) clearTimeout(autoSaveTimeoutRef.current);\r\n    autoSaveTimeoutRef.current = setTimeout(autoSaveDraft, 2000);\r\n    return () => {\r\n      if (autoSaveTimeoutRef.current) clearTimeout(autoSaveTimeoutRef.current);\r\n      autoSaveDraft(); // Save on unmount to capture data before navigation\r\n    };\r\n  }, [autoSaveDraft]);\r\n\r\n  useEffect(() => {\r\n    const handleBeforeUnload = () => autoSaveDraft();\r\n    const handleVisibilityChange = () => document.hidden && autoSaveDraft();\r\n    window.addEventListener('beforeunload', handleBeforeUnload);\r\n    document.addEventListener('visibilitychange', handleVisibilityChange);\r\n    return () => {\r\n      window.removeEventListener('beforeunload', handleBeforeUnload);\r\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\r\n    };\r\n  }, [autoSaveDraft]);\r\n\r\n  useEffect(() => {\r\n    if (draftData && !initialData) {\r\n      setFormData(draftData.formData);\r\n      setSelectedDate(draftData.selectedDate);\r\n      setTaxRateInput(draftData.formData.taxRate?.toString() || '');\r\n      // Removed onClearDraft call to keep draft until sale is saved/completed\r\n    }\r\n  }, [draftData, initialData, setFormData, setTaxRateInput]);\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      if (initialData?.cashTransactionId) {\r\n        setLinkToCash(true);\r\n        setCashTransactionId(initialData.cashTransactionId);\r\n        const accountId = await findCashTransactionForSale(initialData.cashTransactionId);\r\n        if (accountId) setSelectedCashAccountId(accountId);\r\n      }\r\n      if (cashAccounts.length > 0 && !selectedCashAccountId && !initialData?.cashTransactionId) {\r\n        const defaultAccount = cashAccounts.find(acc => acc.isDefault) || cashAccounts[0];\r\n        setSelectedCashAccountId(defaultAccount.id);\r\n      }\r\n    })();\r\n  }, [initialData, cashAccounts, findCashTransactionForSale, setSelectedCashAccountId]);\r\n\r\n  const calculateTotalProfit = (items: SaleItem[]) => {\r\n    return items.reduce((total, item) => {\r\n      // Calculate the effective price after discount (same logic as revenue calculation)\r\n      const subtotal = item.price * item.quantity;\r\n      const discountAmount = item.discountType === 'amount'\r\n        ? (item.discountAmount || 0)\r\n        : (subtotal * (item.discountPercentage || 0)) / 100;\r\n      const effectiveRevenue = subtotal - discountAmount;\r\n      const totalCost = item.cost * item.quantity;\r\n      const itemProfit = effectiveRevenue - totalCost;\r\n\r\n      return total + itemProfit;\r\n    }, 0);\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n\r\n    const totalAmount = calculateTotalAmount(formData.items);\r\n    const taxAmount = calculateTaxAmount(totalAmount);\r\n    const grandTotal = totalAmount + taxAmount;\r\n\r\n    if (!validateForm(grandTotal, selectedDate)) {\r\n      // Show specific error from errors object if available\r\n      if (errors.customerName) {\r\n        toast.error(errors.customerName);\r\n      } else if (errors.taxRate) {\r\n        toast.error(errors.taxRate);\r\n      } else {\r\n        toast.error('Please fill in all required fields correctly');\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (formData.items.length === 0 || formData.items.every(item => !item.description.trim())) {\r\n      toast.error('Please add at least one valid item');\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    try {\r\n      let receiptNumber = initialData?.receiptNumber || await generateReceiptNumber(currentBusiness?.id || '');\r\n      const profit = calculateTotalProfit(formData.items);\r\n      let finalCashTransactionId = cashTransactionId;\r\n\r\n      if (initialData) {\r\n        finalCashTransactionId = await updateCashTransactionForSale(\r\n          { id: initialData.id, customerName: formData.customerName, receiptNumber: initialData.receiptNumber, items: formData.items },\r\n          grandTotal, cashTransactionId, originalPaymentStatus, formData.paymentStatus, linkToCash, selectedCashAccountId, selectedDate\r\n        );\r\n        setCashTransactionId(finalCashTransactionId);\r\n      }\r\n\r\n      const saleDbData = mapSaleToDbSale(\r\n        formData,\r\n        selectedDate,\r\n        profit,\r\n        receiptNumber,\r\n        user?.id || '',\r\n        currentBusiness?.id || '',\r\n        finalCashTransactionId\r\n      );\r\n\r\n      const { success, data: saleResult, error } = await upsertSaleAction(saleDbData, !!initialData, initialData?.id);\r\n\r\n      if (!success || !saleResult) throw new Error(error || 'Failed to save sale');\r\n      const result = saleResult as any;\r\n\r\n      const sale: Sale = {\r\n        id: result.id,\r\n        receiptNumber: result.receiptNumber,\r\n        customerName: result.customerName,\r\n        customerAddress: result.customerAddress || '',\r\n        customerContact: result.customerContact || '',\r\n        customerId: result.customerId || undefined,\r\n        items: result.items,\r\n        paymentStatus: result.paymentStatus,\r\n        profit: result.profit,\r\n        date: new Date(result.date),\r\n        taxRate: result.taxRate ? Number(result.taxRate) : 0,\r\n        cashTransactionId: result.cashTransactionId || undefined,\r\n        amountPaid: result.amountPaid ? Number(result.amountPaid) : undefined,\r\n        amountDue: result.amountDue ? Number(result.amountDue) : undefined,\r\n        notes: result.notes || '',\r\n        categoryId: result.categoryId || undefined,\r\n        createdAt: new Date(result.createdAt),\r\n      };\r\n\r\n      // Handle inventory, payments, etc.\r\n      if (initialData) {\r\n        // Inventory updates for edits are now handled in onSaleComplete callback in useNewSaleActions.ts\r\n        // This prevents double deduction bug where stock was reduced twice for edited sales\r\n\r\n        if (hasChanges) await processPendingPaymentChanges();\r\n        if (formData.paymentStatus === 'Installment Sale' && formData.amountPaid) {\r\n          await createInstallmentPayment({ saleId: sale.id, amount: formData.amountPaid, notes: sale.items.map(i => i.description).join(', '), paymentDate, accountId: linkToCash ? selectedCashAccountId : undefined, locationId: currentBusiness?.id });\r\n          setFormData(prev => ({ ...prev, amountPaid: 0 }));\r\n        }\r\n\r\n\r\n        if (initialData.date.getTime() !== selectedDate.getTime()) {\r\n          await updateStockHistoryDatesBySaleId(sale.id, selectedDate);\r\n        }\r\n      } else {\r\n        const newCashId = await createCashTransactionForSale(sale, grandTotal, linkToCash, selectedCashAccountId, selectedDate, formData.paymentStatus);\r\n        if (newCashId) {\r\n          await updateSaleCashTransactionAction(sale.id, newCashId);\r\n          sale.cashTransactionId = newCashId;\r\n        }\r\n        if (formData.paymentStatus === 'Installment Sale' && formData.amountPaid) {\r\n          await createInstallmentPaymentWithCash(sale.id, formData.amountPaid, sale.items.map(i => i.description).join(', '), linkToCash, selectedCashAccountId, currentBusiness?.id || '', createInstallmentPayment);\r\n        }\r\n        // Inventory update removed from here - it's handled by onSaleComplete callback in useNewSaleActions.ts\r\n        // This prevents double deduction bug where stock was reduced twice for new sales\r\n      }\r\n\r\n      // Clear draft\r\n      if (draftData && onClearDraft) onClearDraft();\r\n\r\n      // IMPORTANT: execute onSaleComplete (which updates inventory) BEFORE showing success\r\n      // If inventory fails, it will throw, identifying the sale as failed\r\n      if (onSaleComplete) {\r\n        await onSaleComplete(sale, printAfterSave, includePaymentInfo, selectedCustomerCategoryId, undefined, selectedDate, thermalPrintAfterSave);\r\n      }\r\n\r\n      toast.success(initialData ? 'Sale updated successfully!' : 'Sale recorded successfully!');\r\n\r\n      // Send Thank You SMS with comprehensive template\r\n      if (sendSMS && formData.customerContact && !initialData) {\r\n        // Generate items list\r\n        const itemsList = formData.items\r\n          .map(item => `• ${item.description} (Qty: ${item.quantity})`)\r\n          .join('\\r\\n');\r\n\r\n        const personalizedMessage = smsMessage\r\n          .replace(/\\{customer_name\\}/gi, formData.customerName || 'Valued Customer')\r\n          .replace(/\\{receipt_number\\}/gi, sale.receiptNumber)\r\n          .replace(/\\{items_list\\}/gi, itemsList)\r\n          .replace(/\\{currency\\}/gi, settings.currency || 'UGX')\r\n          .replace(/\\{amount\\}/gi, grandTotal.toLocaleString())\r\n          .replace(/\\{business_contact\\}/gi, settings.businessPhone || 'our office')\r\n          .replace(/\\{business_name\\}/gi, currentBusiness?.name || 'Our Business');\r\n\r\n        try {\r\n          await createMessage({\r\n            phoneNumber: formData.customerContact,\r\n            content: personalizedMessage,\r\n            customerId: customers.find(c => c.phoneNumber === formData.customerContact)?.id,\r\n            metadata: { sale_id: sale.id, receipt_number: sale.receiptNumber, type: 'thank_you' }\r\n          });\r\n          toast.success('Thank you SMS sent successfully!');\r\n        } catch (smsError: any) {\r\n          toast.error('Sale saved, but failed to send SMS: ' + smsError.message);\r\n        }\r\n      }\r\n\r\n      setSaleCompleted(true);\r\n      setIsSubmitted(true);\r\n\r\n      setSaleCompleted(true);\r\n      setIsSubmitted(true);\r\n\r\n      if (!onSaleComplete) {\r\n        router.push('/sales');\r\n      }\r\n\r\n    } catch (error: any) {\r\n      console.error('Error submitting sale:', error);\r\n      setIsSubmitted(false);\r\n      toast.error(error.message || 'An error occurred. Please try again.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // ⚡️ Performance: Memoize expensive calculations to prevent recomputing on every render\r\n  const totalAmount = useMemo(\r\n    () => calculateTotalAmount(formData.items),\r\n    [formData.items]\r\n  );\r\n\r\n  const taxAmount = useMemo(\r\n    () => calculateTaxAmount(totalAmount),\r\n    [totalAmount, formData.taxRate]\r\n  );\r\n\r\n  const grandTotal = useMemo(\r\n    () => totalAmount + taxAmount,\r\n    [totalAmount, taxAmount]\r\n  );\r\n\r\n  // Barcode Scanner Integration\r\n  const { data: allProducts = [] } = useQuery({\r\n    queryKey: ['all-products-for-scanner', user?.id, currentBusiness?.id],\r\n    queryFn: async () => {\r\n      if (!user?.id || !currentBusiness?.id) return [];\r\n      const data = await getProductsForBarcodeScannerAction(currentBusiness.id);\r\n      return (data || []).map(mapDbProductToProduct) as Product[];\r\n    },\r\n    enabled: !!user?.id && !!currentBusiness?.id,\r\n    staleTime: 5 * 60_000,\r\n  });\r\n\r\n  const scannerBufferRef = useRef('');\r\n  const lastKeyTimeRef = useRef(Date.now());\r\n\r\n  useEffect(() => {\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      const target = e.target as HTMLElement;\r\n      const currentTime = Date.now();\r\n      const delay = currentTime - lastKeyTimeRef.current;\r\n      lastKeyTimeRef.current = currentTime;\r\n\r\n      // Ignore special keys\r\n      if (e.key === 'Shift' || e.key === 'Control' || e.key === 'Alt' || e.key === 'Meta') {\r\n        return;\r\n      }\r\n\r\n      // Threshold increased to 60ms for broader scanner compatibility\r\n      const isRapidTyping = delay < 60;\r\n      const isAlphanumeric = /^[a-zA-Z0-9\\-_]$/.test(e.key);\r\n\r\n      // Aggressive Interception: If NOT in an input field, suppress ALL alphanumeric keys\r\n      // This prevents the \"leakage\" into the console that causes ReferenceError.\r\n      const isInput = target.tagName === 'INPUT' || target.tagName === 'TEXTAREA' || target.contentEditable === 'true';\r\n      if (!isInput && isAlphanumeric) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      }\r\n\r\n      // Handle Enter key - this is typically the suffix of a scan\r\n      if (e.key === 'Enter') {\r\n        const scannedBarcode = scannerBufferRef.current.trim();\r\n        if (scannedBarcode.length >= 2) {\r\n          // Always prevent Enter from being processed by browser/console\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n\r\n          console.log(`[Scanner] Processing: \"${scannedBarcode}\"`);\r\n\r\n          // Perform direct server-side lookup via Prisma action\r\n          const performServerLookup = async (code: string): Promise<Product | null> => {\r\n            const result = await lookupProductByBarcodeAction(code, currentBusiness?.id || '');\r\n            return result ? mapDbProductToProduct(result) : null;\r\n          };\r\n\r\n          const handleScan = async () => {\r\n            const product = await performServerLookup(scannedBarcode);\r\n\r\n            if (product) {\r\n              const referenceCode = product.barcode || product.itemNumber || scannedBarcode;\r\n              console.log(`[Scanner] ✅ Server Match: ${product.name}`);\r\n              console.log(`[Scanner] 🔗 Mapping \"${scannedBarcode}\" -> System Code \"${referenceCode}\"`);\r\n\r\n              handleAddItem(product);\r\n              toast.success(`Scanned: ${product.name} (${referenceCode})`);\r\n            } else {\r\n              console.warn(`[Scanner] ❌ No server match for: \"${scannedBarcode}\"`);\r\n            }\r\n          };\r\n\r\n          handleScan();\r\n          scannerBufferRef.current = '';\r\n          return;\r\n        }\r\n        scannerBufferRef.current = '';\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        return;\r\n      }\r\n\r\n      // Add character to buffer\r\n      if (e.key.length === 1) {\r\n        // Only prevent default if this is rapid typing (scanner) AND in an input field\r\n        // OR if not in an input field at all\r\n        if (isRapidTyping && isInput && isAlphanumeric) {\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n        }\r\n\r\n        // Update buffer\r\n        if (delay > 100) {\r\n          scannerBufferRef.current = e.key;\r\n        } else {\r\n          scannerBufferRef.current += e.key;\r\n        }\r\n      }\r\n    };\r\n\r\n    window.addEventListener('keydown', handleKeyDown, true);\r\n    return () => window.removeEventListener('keydown', handleKeyDown, true);\r\n  }, [user?.id, currentBusiness?.id]);\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n      <SaleFormHeader\r\n        isEditing={!!initialData}\r\n        selectedDate={selectedDate}\r\n        onDateChange={setSelectedDate}\r\n        customerName={formData.customerName}\r\n        customerAddress={formData.customerAddress}\r\n        customerContact={formData.customerContact}\r\n        notes={formData.notes}\r\n        onCustomerInfoChange={handleChange}\r\n        errors={errors}\r\n        customers={customers}\r\n        onAddNewCustomer={onAddNewCustomer}\r\n        onSelectCustomer={handleSelectCustomer}\r\n        selectedCategoryId={selectedCustomerCategoryId}\r\n        onCategoryChange={handleCategoryChange}\r\n        onClearForm={!initialData ? handleClearForm : undefined}\r\n      />\r\n\r\n\r\n      <SaleItemsManager\r\n        items={formData.items}\r\n        onAddItem={handleAddItem}\r\n        onUpdateItem={handleUpdateItem}\r\n        onRemoveItem={handleRemoveItem}\r\n        taxRateInput={taxRateInput}\r\n        onTaxRateChange={handleChange}\r\n        errors={errors}\r\n        totalAmount={totalAmount}\r\n        taxAmount={taxAmount}\r\n        grandTotal={grandTotal}\r\n        taxRate={formData.taxRate || 0}\r\n        currency={settings.currency}\r\n        saleDate={selectedDate.toISOString()}\r\n      />\r\n\r\n      <SalePaymentSection\r\n        paymentStatus={formData.paymentStatus}\r\n        onPaymentStatusChange={handleSelectChange}\r\n        isInstallmentSale={formData.paymentStatus === 'Installment Sale'}\r\n        amountPaid={formData.amountPaid || 0}\r\n        amountDue={formData.amountDue || 0}\r\n        grandTotal={grandTotal}\r\n        currency={settings.currency}\r\n        onAmountPaidChange={(amount) => handleAmountPaidChange(amount, grandTotal)}\r\n        onPaymentDateChange={handlePaymentDateChange}\r\n        paymentDate={paymentDate}\r\n        saleId={initialData?.id}\r\n        isEditing={!!initialData}\r\n        payments={getModifiedPayments(payments)}\r\n        pendingChanges={pendingChanges}\r\n        onStagePaymentChange={initialData ? addPaymentChange : undefined}\r\n        linkToCash={linkToCash}\r\n        onLinkToCashChange={setLinkToCash}\r\n        selectedCashAccountId={selectedCashAccountId}\r\n        onCashAccountChange={setSelectedCashAccountId}\r\n        cashAccounts={cashAccounts}\r\n        hasPaidWithHistory={formData.paymentStatus === 'Paid' && payments.length > 0}\r\n        onLinkPaymentToCash={(paymentId, accountId) => linkPaymentToCashAccount(paymentId, accountId, currentBusiness?.id || '')}\r\n        onUpdatePayment={updatePayment}\r\n        onPaymentStatusChangeFromInstallment={async (newStatus) => handleSelectChange(newStatus)}\r\n        notes={formData.notes}\r\n        onNotesChange={handleChange}\r\n        categoryId={formData.categoryId || ''}\r\n        onCategoryChange={handleSalesCategoryChange}\r\n      />\r\n\r\n      <SaleFormActions\r\n        loading={loading}\r\n        isEditing={!!initialData}\r\n        onCancel={() => router.push('/sales')}\r\n        onClearForm={!initialData ? handleClearForm : undefined}\r\n        printAfterSave={printAfterSave}\r\n        onPrintAfterSaveChange={setPrintAfterSave}\r\n        thermalPrintAfterSave={thermalPrintAfterSave}\r\n        onThermalPrintAfterSaveChange={setThermalPrintAfterSave}\r\n        paymentStatus={formData.paymentStatus}\r\n        includePaymentInfo={includePaymentInfo}\r\n        onIncludePaymentInfoChange={setIncludePaymentInfo}\r\n        hasPendingPaymentChanges={hasChanges}\r\n        sendSMS={sendSMS}\r\n        onSendSMSChange={setSendSMS}\r\n        smsMessage={smsMessage}\r\n        onSMSMessageChange={setSMSMessage}\r\n        customerHasPhone={!!formData.customerContact}\r\n        customerName={formData.customerName}\r\n        disabled={isSubmitted}\r\n      />\r\n\r\n    </form>\r\n  );\r\n};\r\n\r\nexport default SalesForm;","\r\nimport React from \"react\";\r\nimport { Customer } from \"@/types\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Calendar as CalendarIcon } from \"lucide-react\";\r\nimport { Calendar } from \"@/components/ui/calendar\";\r\nimport {\r\n  Popover,\r\n  PopoverContent,\r\n  PopoverTrigger,\r\n} from \"@/components/ui/popover\";\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport { format } from \"date-fns\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { X } from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { useForm } from \"react-hook-form\";\r\nimport { DialogFooter } from \"@/components/ui/dialog\";\r\nimport { useCustomerCategories } from \"@/hooks/useCustomerCategories\";\r\n\r\ninterface CustomerFormProps {\r\n  initialData?: Customer;\r\n  onSubmit: (data: Partial<Customer>) => Promise<boolean>;\r\n  onCancel: () => void;\r\n}\r\n\r\nconst CustomerForm: React.FC<CustomerFormProps> = ({\r\n  initialData,\r\n  onSubmit,\r\n  onCancel,\r\n}) => {\r\n  const [isSubmitting, setIsSubmitting] = React.useState(false);\r\n  const { categories } = useCustomerCategories();\r\n  \r\n  // Initialize date state with proper timezone handling \r\n  const [date, setDate] = React.useState<Date | undefined>(() => {\r\n    if (initialData?.birthday) {\r\n      console.log('Initial birthday from props:', initialData.birthday);\r\n      return initialData.birthday;\r\n    }\r\n    return undefined;\r\n  });\r\n  \r\n  // Initialize category selection - use \"none\" instead of empty string\r\n  const [selectedCategoryId, setSelectedCategoryId] = React.useState<string>(\r\n    initialData?.categoryId || \"none\"\r\n  );\r\n  \r\n  // Log the initial birthday from props to help debug\r\n  React.useEffect(() => {\r\n    if (initialData?.birthday) {\r\n      console.log('Initial birthday from props:', initialData.birthday);\r\n      console.log('Is Date object:', initialData.birthday instanceof Date);\r\n      console.log('Date string:', initialData.birthday.toString());\r\n    }\r\n  }, [initialData?.birthday]);\r\n  \r\n  const [socialMedia, setSocialMedia] = React.useState({\r\n    facebook: initialData?.socialMedia?.facebook || \"\",\r\n    instagram: initialData?.socialMedia?.instagram || \"\",\r\n    twitter: initialData?.socialMedia?.twitter || \"\",\r\n    linkedin: initialData?.socialMedia?.linkedin || \"\",\r\n    other: initialData?.socialMedia?.other || \"\",\r\n  });\r\n  \r\n  const [tags, setTags] = React.useState<string[]>(initialData?.tags || []);\r\n  const [tagInput, setTagInput] = React.useState(\"\");\r\n  const [selectedGender, setSelectedGender] = React.useState(initialData?.gender || \"\");\r\n\r\n  const { register, handleSubmit, formState: { errors } } = useForm({\r\n    defaultValues: {\r\n      fullName: initialData?.fullName || \"\",\r\n      email: initialData?.email || \"\",\r\n      phoneNumber: initialData?.phoneNumber || \"\",\r\n      location: initialData?.location || \"\",\r\n      gender: initialData?.gender || \"\",\r\n      notes: initialData?.notes || \"\",\r\n    },\r\n  });\r\n\r\n  const addTag = () => {\r\n    if (tagInput.trim() !== \"\" && !tags.includes(tagInput.trim())) {\r\n      setTags([...tags, tagInput.trim()]);\r\n      setTagInput(\"\");\r\n    }\r\n  };\r\n\r\n  const removeTag = (tagToRemove: string) => {\r\n    setTags(tags.filter((tag) => tag !== tagToRemove));\r\n  };\r\n\r\n  const handleSocialMediaChange = (\r\n    e: React.ChangeEvent<HTMLInputElement>,\r\n    platform: string\r\n  ) => {\r\n    setSocialMedia({\r\n      ...socialMedia,\r\n      [platform]: e.target.value,\r\n    });\r\n  };\r\n\r\n  const onFormSubmit = async (data: any) => {\r\n    setIsSubmitting(true);\r\n    try {\r\n      // Log the date to help debug\r\n      console.log('Selected date before submission:', date);\r\n      \r\n      const customerData: Partial<Customer> = {\r\n        ...data,\r\n        gender: selectedGender,\r\n        birthday: date, // This is the Date object that needs to be correctly handled\r\n        categoryId: selectedCategoryId === \"none\" ? null : selectedCategoryId, // Convert \"none\" back to null\r\n        socialMedia: Object.keys(socialMedia).length > 0 ? socialMedia : null,\r\n        tags: tags.length > 0 ? tags : null,\r\n      };\r\n      \r\n      console.log('Submitting customer data:', customerData);\r\n      await onSubmit(customerData);\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  // Generate years for the dropdown (100 years back from current year)\r\n  const currentYear = new Date().getFullYear();\r\n  const years = Array.from({ length: 100 }, (_, i) => currentYear - i);\r\n  \r\n  // Months array for the dropdown\r\n  const months = [\r\n    { value: 0, label: \"January\" },\r\n    { value: 1, label: \"February\" },\r\n    { value: 2, label: \"March\" },\r\n    { value: 3, label: \"April\" },\r\n    { value: 4, label: \"May\" },\r\n    { value: 5, label: \"June\" },\r\n    { value: 6, label: \"July\" },\r\n    { value: 7, label: \"August\" },\r\n    { value: 8, label: \"September\" },\r\n    { value: 9, label: \"October\" },\r\n    { value: 10, label: \"November\" },\r\n    { value: 11, label: \"December\" },\r\n  ];\r\n\r\n  // Handle date selection directly from calendar\r\n  const handleDateSelect = (selectedDate: Date | undefined) => {\r\n    console.log('Date selected from calendar:', selectedDate);\r\n    \r\n    if (selectedDate) {\r\n      // When selecting a date, set it at noon UTC to avoid timezone issues\r\n      const year = selectedDate.getFullYear();\r\n      const month = selectedDate.getMonth();\r\n      const day = selectedDate.getDate();\r\n      \r\n      // Create new date at UTC noon to prevent date shifts\r\n      const correctedDate = new Date(Date.UTC(year, month, day, 12, 0, 0));\r\n      console.log('Corrected date with UTC noon:', correctedDate);\r\n      \r\n      setDate(correctedDate);\r\n    } else {\r\n      setDate(undefined);\r\n    }\r\n  };\r\n\r\n  // Handle year selection with proper date validation\r\n  const handleYearSelect = (year: string) => {\r\n    try {\r\n      const yearNum = parseInt(year);\r\n      const newDate = date ? new Date(date) : new Date();\r\n      \r\n      // Create a UTC date at noon to prevent timezone issues\r\n      const correctedDate = new Date(Date.UTC(\r\n        yearNum,\r\n        newDate.getMonth(),\r\n        newDate.getDate(),\r\n        12, 0, 0\r\n      ));\r\n      \r\n      // Check if the resulting date is valid\r\n      if (!isNaN(correctedDate.getTime())) {\r\n        setDate(correctedDate);\r\n        console.log('Year selected, new date:', correctedDate);\r\n      } else {\r\n        console.error('Invalid date after setting year:', year);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error setting year:', error);\r\n    }\r\n  };\r\n\r\n  // Handle month selection with proper date validation\r\n  const handleMonthSelect = (month: string) => {\r\n    try {\r\n      const monthNum = parseInt(month);\r\n      const newDate = date ? new Date(date) : new Date();\r\n      \r\n      // Create a UTC date at noon to prevent timezone issues\r\n      const correctedDate = new Date(Date.UTC(\r\n        newDate.getFullYear(),\r\n        monthNum,\r\n        newDate.getDate(),\r\n        12, 0, 0\r\n      ));\r\n      \r\n      // Check if the resulting date is valid\r\n      if (!isNaN(correctedDate.getTime())) {\r\n        setDate(correctedDate);\r\n        console.log('Month selected, new date:', correctedDate);\r\n      } else {\r\n        console.error('Invalid date after setting month:', month);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error setting month:', error);\r\n    }\r\n  };\r\n\r\n  // Filter categories to ensure no empty IDs\r\n  const validCategories = categories.filter(category => category.id && category.id.trim() !== '');\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit(onFormSubmit)}>\r\n      <div className=\"space-y-6\">\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"fullName\">Full Name*</Label>\r\n            <Input\r\n              id=\"fullName\"\r\n              {...register(\"fullName\", { required: \"Name is required\" })}\r\n              className={cn(errors.fullName && \"border-red-500\")}\r\n            />\r\n            {errors.fullName && (\r\n              <p className=\"text-red-500 text-xs\">\r\n                {errors.fullName.message as string}\r\n              </p>\r\n            )}\r\n          </div>\r\n\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"category\">Category</Label>\r\n            <Select\r\n              value={selectedCategoryId}\r\n              onValueChange={setSelectedCategoryId}\r\n            >\r\n              <SelectTrigger id=\"category\">\r\n                <SelectValue placeholder=\"Select category\" />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                <SelectItem value=\"none\">No Category</SelectItem>\r\n                {validCategories.map((category) => (\r\n                  <SelectItem key={category.id} value={category.id}>\r\n                    {category.name}\r\n                  </SelectItem>\r\n                ))}\r\n              </SelectContent>\r\n            </Select>\r\n          </div>\r\n\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"email\">Email Address</Label>\r\n            <Input\r\n              id=\"email\"\r\n              type=\"email\"\r\n              {...register(\"email\", {\r\n                pattern: {\r\n                  value: /^[A-Z0-9._%+-]+@[A-Z0-9.-]+\\.[A-Z]{2,}$/i,\r\n                  message: \"Invalid email address\",\r\n                },\r\n              })}\r\n              className={cn(errors.email && \"border-red-500\")}\r\n            />\r\n            {errors.email && (\r\n              <p className=\"text-red-500 text-xs\">{errors.email.message as string}</p>\r\n            )}\r\n          </div>\r\n\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"phoneNumber\">Phone Number</Label>\r\n            <Input id=\"phoneNumber\" {...register(\"phoneNumber\")} />\r\n          </div>\r\n\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"location\">Location</Label>\r\n            <Input id=\"location\" {...register(\"location\")} />\r\n          </div>\r\n\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"gender\">Gender</Label>\r\n            <Select\r\n              value={selectedGender}\r\n              onValueChange={setSelectedGender}\r\n            >\r\n              <SelectTrigger id=\"gender\">\r\n                <SelectValue placeholder=\"Select gender\" />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                <SelectItem value=\"male\">Male</SelectItem>\r\n                <SelectItem value=\"female\">Female</SelectItem>\r\n                <SelectItem value=\"non-binary\">Non-binary</SelectItem>\r\n                <SelectItem value=\"prefer-not-to-say\">\r\n                  Prefer not to say\r\n                </SelectItem>\r\n              </SelectContent>\r\n            </Select>\r\n          </div>\r\n\r\n          <div className=\"space-y-2\">\r\n            <Label>Birthday</Label>\r\n            <div className=\"flex flex-col gap-2\">\r\n              <div className=\"flex flex-row gap-2\">\r\n                <div className=\"flex-1\">\r\n                  <Popover>\r\n                    <PopoverTrigger asChild>\r\n                      <Button\r\n                        variant=\"outline\"\r\n                        className=\"w-full justify-between\"\r\n                      >\r\n                        {date ? date.getDate() : \"Day\"}\r\n                        <CalendarIcon className=\"h-4 w-4 opacity-50\" />\r\n                      </Button>\r\n                    </PopoverTrigger>\r\n                    <PopoverContent className=\"w-auto p-0\" align=\"start\">\r\n                      <Calendar\r\n                        mode=\"single\"\r\n                        selected={date}\r\n                        onSelect={handleDateSelect}\r\n                        initialFocus\r\n                        captionLayout=\"buttons\"\r\n                        className=\"p-3 pointer-events-auto\"\r\n                        classNames={{\r\n                          caption_label: \"hidden\",\r\n                          dropdown: \"hidden\",\r\n                        }}\r\n                      />\r\n                    </PopoverContent>\r\n                  </Popover>\r\n                </div>\r\n                <div className=\"flex-1\">\r\n                  <Select\r\n                    value={date ? String(date.getMonth()) : undefined}\r\n                    onValueChange={handleMonthSelect}\r\n                  >\r\n                    <SelectTrigger>\r\n                      <SelectValue placeholder=\"Month\" />\r\n                    </SelectTrigger>\r\n                    <SelectContent>\r\n                      {months.map((month) => (\r\n                        <SelectItem key={month.value} value={String(month.value)}>\r\n                          {month.label}\r\n                        </SelectItem>\r\n                      ))}\r\n                    </SelectContent>\r\n                  </Select>\r\n                </div>\r\n                <div className=\"flex-1\">\r\n                  <Select\r\n                    value={date ? String(date.getFullYear()) : undefined}\r\n                    onValueChange={handleYearSelect}\r\n                  >\r\n                    <SelectTrigger>\r\n                      <SelectValue placeholder=\"Year\" />\r\n                    </SelectTrigger>\r\n                    <SelectContent>\r\n                      {years.map((year) => (\r\n                        <SelectItem key={year} value={String(year)}>\r\n                          {year}\r\n                        </SelectItem>\r\n                      ))}\r\n                    </SelectContent>\r\n                  </Select>\r\n                </div>\r\n              </div>\r\n              {date && (\r\n                <div className=\"text-sm text-muted-foreground\">\r\n                  Selected: {date ? format(date, \"PPP\") : \"No date selected\"}\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"space-y-2\">\r\n          <Label>Tags</Label>\r\n          <div className=\"flex flex-wrap gap-1 mb-2\">\r\n            {tags.map((tag) => (\r\n              <Badge key={tag} variant=\"secondary\">\r\n                {tag}\r\n                <button\r\n                  type=\"button\"\r\n                  className=\"ml-1 rounded-full hover:bg-gray-200\"\r\n                  onClick={() => removeTag(tag)}\r\n                >\r\n                  <X className=\"h-3 w-3\" />\r\n                  <span className=\"sr-only\">Remove tag</span>\r\n                </button>\r\n              </Badge>\r\n            ))}\r\n          </div>\r\n          <div className=\"flex gap-2\">\r\n            <Input\r\n              value={tagInput}\r\n              onChange={(e) => setTagInput(e.target.value)}\r\n              placeholder=\"Add tag\"\r\n              onKeyDown={(e) => e.key === \"Enter\" && (e.preventDefault(), addTag())}\r\n            />\r\n            <Button type=\"button\" onClick={addTag} variant=\"outline\">\r\n              Add\r\n            </Button>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"space-y-2\">\r\n          <Label>Social Media</Label>\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\r\n            <div className=\"space-y-1\">\r\n              <Label htmlFor=\"facebook\" className=\"text-xs\">\r\n                Facebook\r\n              </Label>\r\n              <Input\r\n                id=\"facebook\"\r\n                value={socialMedia.facebook}\r\n                onChange={(e) => handleSocialMediaChange(e, \"facebook\")}\r\n                placeholder=\"Username or URL\"\r\n              />\r\n            </div>\r\n            <div className=\"space-y-1\">\r\n              <Label htmlFor=\"instagram\" className=\"text-xs\">\r\n                Instagram\r\n              </Label>\r\n              <Input\r\n                id=\"instagram\"\r\n                value={socialMedia.instagram}\r\n                onChange={(e) => handleSocialMediaChange(e, \"instagram\")}\r\n                placeholder=\"Username without @\"\r\n              />\r\n            </div>\r\n            <div className=\"space-y-1\">\r\n              <Label htmlFor=\"twitter\" className=\"text-xs\">\r\n                Twitter/X\r\n              </Label>\r\n              <Input\r\n                id=\"twitter\"\r\n                value={socialMedia.twitter}\r\n                onChange={(e) => handleSocialMediaChange(e, \"twitter\")}\r\n                placeholder=\"Username without @\"\r\n              />\r\n            </div>\r\n            <div className=\"space-y-1\">\r\n              <Label htmlFor=\"linkedin\" className=\"text-xs\">\r\n                LinkedIn\r\n              </Label>\r\n              <Input\r\n                id=\"linkedin\"\r\n                value={socialMedia.linkedin}\r\n                onChange={(e) => handleSocialMediaChange(e, \"linkedin\")}\r\n                placeholder=\"Profile URL or username\"\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"space-y-2\">\r\n          <Label>Birthday</Label>\r\n          <div className=\"flex flex-col gap-2\">\r\n            <div className=\"flex flex-row gap-2\">\r\n              <div className=\"flex-1\">\r\n                <Popover>\r\n                  <PopoverTrigger asChild>\r\n                    <Button\r\n                      variant=\"outline\"\r\n                      className=\"w-full justify-between\"\r\n                    >\r\n                      {date ? date.getDate() : \"Day\"}\r\n                      <CalendarIcon className=\"h-4 w-4 opacity-50\" />\r\n                    </Button>\r\n                  </PopoverTrigger>\r\n                  <PopoverContent className=\"w-auto p-0\" align=\"start\">\r\n                    <Calendar\r\n                      mode=\"single\"\r\n                      selected={date}\r\n                      onSelect={handleDateSelect}\r\n                      initialFocus\r\n                      captionLayout=\"buttons\"\r\n                      className=\"p-3 pointer-events-auto\"\r\n                      classNames={{\r\n                        caption_label: \"hidden\",\r\n                        dropdown: \"hidden\",\r\n                      }}\r\n                    />\r\n                  </PopoverContent>\r\n                </Popover>\r\n              </div>\r\n              <div className=\"flex-1\">\r\n                <Select\r\n                  value={date ? String(date.getMonth()) : undefined}\r\n                  onValueChange={handleMonthSelect}\r\n                >\r\n                  <SelectTrigger>\r\n                    <SelectValue placeholder=\"Month\" />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    {months.map((month) => (\r\n                      <SelectItem key={month.value} value={String(month.value)}>\r\n                        {month.label}\r\n                      </SelectItem>\r\n                    ))}\r\n                  </SelectContent>\r\n                </Select>\r\n              </div>\r\n              <div className=\"flex-1\">\r\n                <Select\r\n                  value={date ? String(date.getFullYear()) : undefined}\r\n                  onValueChange={handleYearSelect}\r\n                >\r\n                  <SelectTrigger>\r\n                    <SelectValue placeholder=\"Year\" />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    {years.map((year) => (\r\n                      <SelectItem key={year} value={String(year)}>\r\n                        {year}\r\n                      </SelectItem>\r\n                    ))}\r\n                  </SelectContent>\r\n                </Select>\r\n              </div>\r\n            </div>\r\n            {date && (\r\n              <div className=\"text-sm text-muted-foreground\">\r\n                Selected: {date ? format(date, \"PPP\") : \"No date selected\"}\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"space-y-2\">\r\n          <Label htmlFor=\"notes\">Notes</Label>\r\n          <Textarea\r\n            id=\"notes\"\r\n            {...register(\"notes\")}\r\n            rows={4}\r\n            placeholder=\"Add any notes about this customer...\"\r\n          />\r\n        </div>\r\n\r\n        <DialogFooter>\r\n          <Button variant=\"outline\" type=\"button\" onClick={onCancel}>\r\n            Cancel\r\n          </Button>\r\n          <Button type=\"submit\" disabled={isSubmitting}>\r\n            {isSubmitting ? \"Saving...\" : \"Save Changes\"}\r\n          </Button>\r\n        </DialogFooter>\r\n      </div>\r\n    </form>\r\n  );\r\n};\r\n\r\nexport default CustomerForm;\r\n","\r\nimport React from 'react';\r\nimport { \r\n  Dialog, \r\n  DialogContent, \r\n  DialogDescription, \r\n  DialogHeader, \r\n  DialogTitle \r\n} from '@/components/ui/dialog';\r\nimport { Customer } from '@/types';\r\nimport CustomerForm from './CustomerForm';\r\nimport { ScrollArea } from '@/components/ui/scroll-area';\r\n\r\ninterface NewCustomerDialogProps {\r\n  open: boolean;\r\n  onClose: () => void;\r\n  onAddCustomer: (data: Partial<Customer>) => void;\r\n  initialData?: Customer;\r\n}\r\n\r\nconst NewCustomerDialog: React.FC<NewCustomerDialogProps> = ({ \r\n  open, \r\n  onClose, \r\n  onAddCustomer, \r\n  initialData \r\n}) => {\r\n  const handleSubmit = async (data: Partial<Customer>) => {\r\n    onAddCustomer(data);\r\n    return true;\r\n  };\r\n\r\n  const isEditing = !!initialData;\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={onClose}>\r\n      <DialogContent className=\"max-w-2xl max-h-[90vh]\">\r\n        <DialogHeader>\r\n          <DialogTitle>{isEditing ? 'Edit Customer' : 'Add New Customer'}</DialogTitle>\r\n          <DialogDescription>\r\n            Fill in the customer details below. Only name is required.\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n        <ScrollArea className=\"h-[calc(80vh-8rem)]\">\r\n          <div className=\"px-1\">\r\n            <CustomerForm \r\n              onSubmit={handleSubmit}\r\n              onCancel={onClose}\r\n              initialData={initialData}\r\n            />\r\n          </div>\r\n        </ScrollArea>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default NewCustomerDialog;\r\n","\r\nimport React from 'react';\r\nimport { Alert, AlertDescription } from '@/components/ui/alert';\r\nimport { Button } from '@/components/ui/button';\r\nimport { FileText, X } from 'lucide-react';\r\n\r\ninterface DraftNotificationProps {\r\n  onLoadDraft: () => void;\r\n  onDismiss: () => void;\r\n  savedAt: Date;\r\n}\r\n\r\nconst DraftNotification: React.FC<DraftNotificationProps> = ({\r\n  onLoadDraft,\r\n  onDismiss,\r\n  savedAt\r\n}) => {\r\n  const formatTime = (date: Date) => {\r\n    return date.toLocaleString(undefined, {\r\n      month: 'short',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    });\r\n  };\r\n\r\n  return (\r\n    <Alert className=\"mb-4 border-blue-200 bg-blue-50\">\r\n      <FileText className=\"h-4 w-4 text-blue-600\" />\r\n      <AlertDescription className=\"flex items-center justify-between\">\r\n        <div className=\"flex-1\">\r\n          <span className=\"text-blue-800 font-medium\">Draft found!</span>\r\n          <span className=\"text-blue-700 ml-2\">\r\n            Saved on {formatTime(savedAt)}\r\n          </span>\r\n        </div>\r\n        <div className=\"flex gap-2 ml-4\">\r\n          <Button\r\n            size=\"sm\"\r\n            onClick={onLoadDraft}\r\n            className=\"bg-blue-600 hover:bg-blue-700 text-white\"\r\n          >\r\n            Load Draft\r\n          </Button>\r\n          <Button\r\n            size=\"sm\"\r\n            variant=\"ghost\"\r\n            onClick={onDismiss}\r\n            className=\"text-blue-600 hover:text-blue-700 hover:bg-blue-100\"\r\n          >\r\n            <X className=\"h-4 w-4\" />\r\n          </Button>\r\n        </div>\r\n      </AlertDescription>\r\n    </Alert>\r\n  );\r\n};\r\n\r\nexport default DraftNotification;\r\n","import React from 'react';\r\nimport SalesForm from '@/components/SalesForm';\r\nimport ReceiptDialog from '@/components/sales/ReceiptDialog';\r\nimport NewCustomerDialog from '@/components/customers/NewCustomerDialog';\r\nimport DraftNotification from '@/components/sales/DraftNotification';\r\nimport { Sale } from '@/types';\r\n\r\ninterface NewSaleContentProps {\r\n  editSale?: Sale;\r\n  currency: string;\r\n  showDraftNotification: boolean;\r\n  draftData: any;\r\n  onLoadDraft: () => void;\r\n  onDismissDraft: () => void;\r\n  onSaleComplete: (sale: Sale, showReceipt?: boolean, includePaymentInfo?: boolean, selectedCategoryId?: string, onClearDraft?: () => void, saleDate?: Date, thermalPrintAfterSave?: boolean) => void;\r\n  onClearDraft: () => void;\r\n  customers: any[];\r\n  onAddNewCustomer: () => void;\r\n  isReceiptOpen: boolean;\r\n  completedSale: Sale | null;\r\n  includePaymentInfo: boolean;\r\n  onReceiptClose: () => void;\r\n  newCustomerDialogOpen: boolean;\r\n  onCloseNewCustomerDialog: () => void;\r\n  onAddCustomer: (customerData: any) => Promise<boolean>;\r\n}\r\n\r\nconst NewSaleContent: React.FC<NewSaleContentProps> = ({\r\n  editSale,\r\n  currency,\r\n  showDraftNotification,\r\n  draftData,\r\n  onLoadDraft,\r\n  onDismissDraft,\r\n  onSaleComplete,\r\n  onClearDraft,\r\n  customers,\r\n  onAddNewCustomer,\r\n  isReceiptOpen,\r\n  completedSale,\r\n  includePaymentInfo,\r\n  onReceiptClose,\r\n  newCustomerDialogOpen,\r\n  onCloseNewCustomerDialog,\r\n  onAddCustomer\r\n}) => {\r\n  return (\r\n    <>\r\n      {showDraftNotification && draftData && (\r\n        <DraftNotification\r\n          onLoadDraft={onLoadDraft}\r\n          onDismiss={onDismissDraft}\r\n          savedAt={draftData.savedAt}\r\n        />\r\n      )}\r\n\r\n      <SalesForm\r\n        initialData={editSale}\r\n        onSaleComplete={onSaleComplete}\r\n        currency={currency}\r\n        customers={customers}\r\n        onAddNewCustomer={onAddNewCustomer}\r\n        draftData={draftData}\r\n        onClearDraft={onClearDraft}\r\n      />\r\n\r\n      <ReceiptDialog\r\n        isOpen={isReceiptOpen}\r\n        sale={completedSale}\r\n        currency={currency}\r\n        onOpenChange={onReceiptClose}\r\n        includePaymentInfo={includePaymentInfo}\r\n      />\r\n\r\n      <NewCustomerDialog\r\n        open={newCustomerDialogOpen}\r\n        onClose={onCloseNewCustomerDialog}\r\n        onAddCustomer={onAddCustomer}\r\n      />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default NewSaleContent;","import React from 'react';\r\nimport { useLocation, useNavigate } from 'react-router-dom';\r\nimport { Sale } from '@/types';\r\nimport { useAuth } from '@/components/auth/AuthProvider';\r\nimport { useBusinessSettings } from '@/hooks/useBusinessSettings';\r\nimport { useBusiness } from '@/contexts/BusinessContext';\r\nimport { useNewSaleDraft } from '@/hooks/useNewSaleDraft';\r\nimport { useNewSaleActions } from '@/hooks/useNewSaleActions';\r\nimport NewSaleLoadingState from '@/components/sales/NewSaleLoadingState';\r\nimport NewSaleNoBusinessState from '@/components/sales/NewSaleNoBusinessState';\r\nimport NewSaleAuthWarning from '@/components/sales/NewSaleAuthWarning';\r\nimport NewSaleContent from '@/components/sales/NewSaleContent';\r\nimport { useProfiles } from '@/contexts/ProfileContext';\r\nimport { AlertCircle } from 'lucide-react';\r\nimport { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';\r\nimport { Button } from '@/components/ui/button';\r\nimport LoadingSpinner from '@/components/LoadingSpinner';\r\n\r\nconst NewSale = () => {\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const { user } = useAuth();\r\n  const { settings } = useBusinessSettings();\r\n  const { currentBusiness, isLoading: businessLoading } = useBusiness();\r\n  const { hasPermission, isLoading: profilesLoading } = useProfiles();\r\n  const editSale = location.state?.editSale as Sale | undefined;\r\n\r\n  // Use a key to force re-mounting of the form component to clear all state\r\n  const [formKey, setFormKey] = React.useState(0);\r\n\r\n  const handleResetForm = React.useCallback(() => {\r\n    setFormKey(prev => prev + 1);\r\n  }, []);\r\n\r\n  const {\r\n    showDraftNotification,\r\n    draftData,\r\n    handleLoadDraft,\r\n    handleDismissDraft,\r\n    clearDraft\r\n  } = useNewSaleDraft(editSale);\r\n\r\n  const {\r\n    isReceiptOpen,\r\n    completedSale,\r\n    newCustomerDialogOpen,\r\n    includePaymentInfo,\r\n    customers,\r\n    handleSaleComplete,\r\n    handleReceiptClose,\r\n    handleAddCustomer,\r\n    handleOpenNewCustomerDialog,\r\n    setNewCustomerDialogOpen\r\n  } = useNewSaleActions(editSale, handleResetForm);\r\n\r\n  // Show loading while business context or profiles is loading\r\n  if (businessLoading || profilesLoading) {\r\n    return <NewSaleLoadingState />;\r\n  }\r\n\r\n  // Show message if no business is selected\r\n  if (!currentBusiness) {\r\n    return <NewSaleNoBusinessState />;\r\n  }\r\n\r\n  // Permission Check\r\n  const canEdit = editSale ? hasPermission('sales', 'edit') : true;\r\n  const canCreate = !editSale ? hasPermission('sales', 'create') : true;\r\n\r\n  if (!canEdit || !canCreate) {\r\n    return (\r\n      <div className=\"max-w-4xl mx-auto p-6\">\r\n        <Alert variant=\"destructive\">\r\n          <AlertCircle className=\"h-4 w-4\" />\r\n          <AlertTitle>Access Denied</AlertTitle>\r\n          <AlertDescription>\r\n            You do not have permission to {editSale ? 'edit this sale' : 'create a new sale'}.\r\n            Please contact your administrator if you believe this is an error.\r\n          </AlertDescription>\r\n        </Alert>\r\n        <div className=\"mt-4\">\r\n          <Button onClick={() => navigate('/sales')} variant=\"outline\">\r\n            Back to Sales\r\n          </Button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const wrappedHandleSaleComplete = (sale: Sale, showReceipt?: boolean, includePaymentInfo?: boolean, selectedCategoryId?: string, onClearDraft?: () => void, saleDate?: Date, thermalPrintAfterSave?: boolean) => {\r\n    return handleSaleComplete(sale, showReceipt, includePaymentInfo, selectedCategoryId, clearDraft || onClearDraft, saleDate, thermalPrintAfterSave);\r\n  };\r\n\r\n  return (\r\n    <div className=\"max-w-4xl mx-auto\">\r\n      {!user && <NewSaleAuthWarning />}\r\n\r\n      <NewSaleContent\r\n        key={formKey}\r\n        editSale={editSale}\r\n        currency={settings.currency}\r\n        showDraftNotification={showDraftNotification}\r\n        draftData={draftData}\r\n        onLoadDraft={handleLoadDraft}\r\n        onDismissDraft={handleDismissDraft}\r\n        onSaleComplete={wrappedHandleSaleComplete}\r\n        onClearDraft={clearDraft}\r\n        customers={customers || []}\r\n        onAddNewCustomer={handleOpenNewCustomerDialog}\r\n        isReceiptOpen={isReceiptOpen}\r\n        completedSale={completedSale}\r\n        includePaymentInfo={includePaymentInfo}\r\n        onReceiptClose={handleReceiptClose}\r\n        newCustomerDialogOpen={newCustomerDialogOpen}\r\n        onCloseNewCustomerDialog={() => setNewCustomerDialogOpen(false)}\r\n        onAddCustomer={handleAddCustomer}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default NewSale;\r\n","import { PagesRouteModule } from '../../server/route-modules/pages/module.compiled'\nimport { RouteKind } from '../../server/route-kind'\n\nimport { hoist } from './helpers'\n\n// Import the app and document modules.\nimport * as document from 'VAR_MODULE_DOCUMENT'\nimport * as app from 'VAR_MODULE_APP'\n\n// Import the userland code.\nimport * as userland from 'VAR_USERLAND'\nimport { getHandler } from '../../server/route-modules/pages/pages-handler'\n\n// Re-export the component (should be the default export).\nexport default hoist(userland, 'default')\n\n// Re-export methods.\nexport const getStaticProps = hoist(userland, 'getStaticProps')\nexport const getStaticPaths = hoist(userland, 'getStaticPaths')\nexport const getServerSideProps = hoist(userland, 'getServerSideProps')\nexport const config = hoist(userland, 'config')\nexport const reportWebVitals = hoist(userland, 'reportWebVitals')\n\n// Re-export legacy methods.\nexport const unstable_getStaticProps = hoist(\n  userland,\n  'unstable_getStaticProps'\n)\nexport const unstable_getStaticPaths = hoist(\n  userland,\n  'unstable_getStaticPaths'\n)\nexport const unstable_getStaticParams = hoist(\n  userland,\n  'unstable_getStaticParams'\n)\nexport const unstable_getServerProps = hoist(\n  userland,\n  'unstable_getServerProps'\n)\nexport const unstable_getServerSideProps = hoist(\n  userland,\n  'unstable_getServerSideProps'\n)\n\n// Create and export the route module that will be consumed.\nexport const routeModule = new PagesRouteModule({\n  definition: {\n    kind: RouteKind.PAGES,\n    page: 'VAR_DEFINITION_PAGE',\n    pathname: 'VAR_DEFINITION_PATHNAME',\n    // The following aren't used in production.\n    bundlePath: '',\n    filename: '',\n  },\n  distDir: process.env.__NEXT_RELATIVE_DIST_DIR || '',\n  relativeProjectDir: process.env.__NEXT_RELATIVE_PROJECT_DIR || '',\n  components: {\n    // default export might not exist when optimized for data only\n    App: app.default,\n    Document: document.default,\n  },\n  userland,\n})\n\nexport const handler = getHandler({\n  srcPage: 'VAR_DEFINITION_PAGE',\n  config,\n  userland,\n  routeModule,\n  getStaticPaths,\n  getStaticProps,\n  getServerSideProps,\n})\n"],"names":["PagesRouteModule","RouteKind","hoist","document","app","userland","getHandler","getStaticProps","getStaticPaths","getServerSideProps","config","reportWebVitals","unstable_getStaticProps","unstable_getStaticPaths","unstable_getStaticParams","unstable_getServerProps","unstable_getServerSideProps","routeModule","definition","kind","PAGES","page","pathname","bundlePath","filename","distDir","process","env","__NEXT_RELATIVE_DIST_DIR","relativeProjectDir","__NEXT_RELATIVE_PROJECT_DIR","components","App","default","Document","handler","srcPage"],"mappings":"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","ignoreList":[18,23,31,32,45]}